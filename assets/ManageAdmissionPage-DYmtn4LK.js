import{x as C,f as x,j as e}from"./index-DE8wu5Ou.js";import{r as t,u as A}from"./react-vendor-Cc0P4_ZX.js";import{i as E,X as D}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const $=()=>{const[r,l]=t.useState(""),[d,n]=t.useState([]),[m,i]=t.useState(!1),[j,c]=t.useState(!1),v=A(),h=t.useRef(null);t.useEffect(()=>{const s=a=>{h.current&&!h.current.contains(a.target)&&c(!1)};return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[]);const o=t.useCallback(C.debounce(async s=>{if(s.trim().length<2){n([]),i(!1);return}i(!0);try{const a=new URLSearchParams({search:encodeURIComponent(s),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),f=await x(`/api/patients?${a.toString()}`);if(!f.ok)throw new Error("Failed to fetch patients");const k=await f.json();n(k.patients)}catch{n([])}finally{i(!1)}},400),[]);t.useEffect(()=>(r?(i(!0),o(r)):(n([]),o.cancel(),i(!1)),()=>o.cancel()),[r,o]);const N=s=>{v(`/patient/${encodeURIComponent(s.id)}/admission-billing`)},b=()=>{l(""),n([]),c(!1)},w=s=>s.slice(0,1).toUpperCase(),[y,u]=t.useState(!1),[g,p]=t.useState(!1),S=async()=>{p(!0);try{const s=await x("/api/patients/discharge-all",{method:"POST"}),a=await s.json();s.ok?(alert(a.message),n([]),l("")):alert(a.message||"Failed to discharge patients")}catch(s){console.error("Bulk discharge error:",s),alert("An error occurred while processing bulk discharge.")}finally{p(!1),u(!1)}};return e.jsxs("div",{className:"ma-container",children:[e.jsxs("div",{className:"ma-header-section",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"ma-title",children:"Manage Admission"}),e.jsx("p",{className:"ma-subtitle",children:"Search for a patient to admit, discharge, or view billing details"})]}),e.jsx("button",{className:"ma-discharge-all-btn",onClick:()=>u(!0),children:"Discharge Everyone"})]}),y&&e.jsx("div",{className:"ma-modal-overlay",children:e.jsxs("div",{className:"ma-modal-content",children:[e.jsx("h3",{children:"Confirm Bulk Discharge"}),e.jsxs("p",{children:["Are you sure you want to discharge ",e.jsx("strong",{children:"ALL"})," currently admitted patients?"]}),e.jsx("div",{className:"ma-modal-warning",children:e.jsx("p",{children:"⚠️ This will finalize bills for all admitted patients."})}),e.jsxs("div",{className:"ma-modal-actions",children:[e.jsx("button",{className:"ma-modal-cancel",onClick:()=>u(!1),disabled:g,children:"Cancel"}),e.jsx("button",{className:"ma-modal-confirm",onClick:S,disabled:g,children:g?"Processing...":"Yes, Discharge All"})]})]})}),e.jsxs("div",{className:"ma-search-wrapper",ref:h,children:[m?e.jsxs("div",{className:"ma-loading-spinner",children:[e.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):e.jsx(E,{className:"ma-search-icon",size:20}),e.jsx("input",{type:"text",value:r,onChange:s=>{l(s.target.value),c(!0)},onFocus:()=>c(!0),placeholder:"Search by Name, Phone, or Token...",className:"ma-search-input",autoFocus:!0}),r&&e.jsx("div",{className:"ma-clear-icon",onClick:b,children:e.jsx(D,{size:18})}),e.jsxs("div",{className:`ma-results-dropdown ${j&&(d.length>0||m)?"open":""}`,children:[d.map(s=>{const a=s.admission_date&&!s.discharge_date;return e.jsxs("div",{onClick:()=>N(s),className:"ma-result-item",children:[e.jsxs("div",{className:"ma-patient-info",children:[e.jsx("div",{className:"ma-avatar",children:w(s.name)}),e.jsxs("div",{className:"ma-patient-text",children:[e.jsxs("h4",{children:[s.name,e.jsxs("span",{className:"ma-patient-token",children:["#",s.token]})]}),e.jsxs("p",{className:"ma-patient-subtext",children:[s.phone||"No phone"," • ",s.age?`${s.age} Y`:""," • ",s.gender||""]})]})]}),e.jsx("div",{className:`ma-badge ${a?"ma-badge-admitted":"ma-badge-discharged"}`,children:a?"ADMITTED":"NOT ADMITTED"})]},s.id)}),r.length>2&&!m&&d.length===0&&e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:['No patients found matching "',r,'"']})]})]})]})};export{$ as default};
