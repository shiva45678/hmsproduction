import{z as N,j as s,H as S,I as P}from"./index-jGjkutd2.js";import{u as y,r}from"./react-vendor-Cc0P4_ZX.js";/* empty css                           */import{Q as f,aE as k}from"./ui-vendor-B5keALZQ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const L=()=>{const l=y(),[n,x]=r.useState([]),[t,d]=r.useState(""),[g,u]=r.useState(!0),[p,a]=r.useState(null),[o,b]=r.useState(!1),[h,c]=r.useState(null),m=r.useCallback(async()=>{a(null);try{const i=(await N()).filter(v=>v.status==="active");x(i),i.length>0&&!t&&d(i[0].id)}catch(e){console.error("Error fetching plans:",e),a(`Failed to load subscription plans: ${e.message}`)}},[]);r.useEffect(()=>{(async()=>{u(!0);try{const i=await S();if(i&&i.short_url){window.location.href=i.short_url,a("You have a pending subscription. Redirecting to payment...");return}await m()}catch(i){console.error("Error during initial page load:",i),a(`An unexpected error occurred: ${i.message}`)}finally{u(!1)}})()},[m]);const j=async()=>{if(!t){c("Please select a clinic subscription plan.");return}const e=n.find(i=>i.id===t);if(!e){c("Selected plan details not found.");return}b(!0),c(null);try{console.log("Initiating Razorpay clinic subscription for plan:",e);const i=await P(t);if(i&&i.short_url)window.location.href=i.short_url;else throw new Error("Failed to get Razorpay clinic subscription link from backend.")}catch(i){console.error("Error starting clinic subscription:",i),c(`Failed to start clinic subscription: ${i.message}`),b(!1)}};return g?s.jsx("div",{className:"loading-state-subscription",children:"Loading clinic plans..."}):p?s.jsxs("div",{className:"subscription-page-container",children:[s.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[s.jsx("strong",{children:"Error: "}),s.jsx("span",{children:p})]}),s.jsx("button",{onClick:()=>l(-1),className:"back-button",children:s.jsx(f,{size:16})})]}):s.jsxs("div",{className:"subscription-page-container",children:[s.jsx("button",{onClick:()=>l(-1),className:"back-button",children:s.jsx(f,{size:16})}),s.jsxs("h1",{children:[s.jsx(k,{size:28}),"Buy Pro Plan for Clinic"]}),h&&s.jsx("div",{className:"error-alert-subscription",role:"alert",children:s.jsx("span",{children:h})}),s.jsxs("div",{className:"subscription-form",children:[s.jsx("h2",{children:"Available Pro Plans"}),n.length===0?s.jsx("p",{className:"empty-state",children:"No active clinic subscription plans found."}):s.jsx("div",{className:"subscription-plan-list",children:n.map(e=>s.jsxs("div",{className:`subscription-plan-card ${t===e.id?"selected-plan":""}`,onClick:()=>d(e.id),children:[s.jsx("h3",{children:e.name}),s.jsxs("p",{className:"price",children:["â‚¹",Number(e.price).toFixed(2)]}),s.jsxs("p",{className:"duration",children:["Every ",e.interval," ",e.period,e.interval>1?"s":""]}),e.description&&s.jsx("p",{children:e.description})]},e.id))})]}),s.jsx("div",{className:"flex justify-end",children:s.jsxs("button",{onClick:j,disabled:!t||o||n.length===0,className:"subscription-btn",children:[o&&s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),o?"Initiating Payment...":"Buy Pro Plan"]})})]})};export{L as default};
