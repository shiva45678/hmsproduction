import{u as v,d as C,e as T,q as c,f as a,j as t,S as p,L as P,g as b}from"./index-DE8wu5Ou.js";import{r as o,u as F}from"./react-vendor-Cc0P4_ZX.js";import{i as S,a as I}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const E="_container_15l0t_5",L="_visualContainer_15l0t_31",A="_brandTitle_15l0t_49",B="_searchBar_15l0t_105",K="_searchIconWrapper_15l0t_153",R="_searchIcon_15l0t_153",Q="_placeholderText_15l0t_177",W="_shortcutHint_15l0t_197",$="_key_15l0t_213",M="_plus_15l0t_237",H="_micButtonWrapper_15l0t_247",V="_micIcon_15l0t_295",D="_newlyRegisteredSection_15l0t_491",O="_recentList_15l0t_509",Y="_recentPatientPill_15l0t_523",z="_recentNameContainer_15l0t_549",U="_recentInfo_15l0t_561",G="_newlyRegisteredLabel_15l0t_599",J="_recentName_15l0t_549",X="_recentToken_15l0t_763",s={container:E,visualContainer:L,brandTitle:A,searchBar:B,searchIconWrapper:K,searchIcon:R,placeholderText:Q,shortcutHint:W,key:$,plus:M,micButtonWrapper:H,micIcon:V,newlyRegisteredSection:D,recentList:O,recentPatientPill:Y,recentNameContainer:z,recentInfo:U,newlyRegisteredLabel:G,recentName:J,recentToken:X},j="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",Z={apiKey:j},ce=()=>{const{openCommandBar:l,isOpen:y,setPreFilledQuery:d}=v(),[N,u]=o.useState(!1),[h,_]=o.useState(null),g=F(),k=e=>{e.stopPropagation(),u(!0)};o.useEffect(()=>{h&&(u(!1),d&&d(h),l(),_(null))},[h,l,d]);const r=C(),{data:m,isLoading:f}=T({queryKey:["recentPatients"],queryFn:async()=>{const e=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),n=await a(`/api/patients?${e.toString()}`);if(!n.ok)throw new Error("Failed to fetch recent patients");return n.json()},staleTime:60*1e3});o.useEffect(()=>{r.prefetchQuery({queryKey:c.clinicSettings,queryFn:async()=>{const e=await a("/api/clinics/settings");if(!e.ok)throw new Error("Failed to fetch clinic settings");return e.json()},staleTime:30*60*1e3}),r.prefetchQuery({queryKey:c.drugs.all,queryFn:async()=>{const e=await a("/api/drugs");if(!e.ok)throw new Error("Failed to fetch drugs");const n=await e.json();return n.drugs||n},staleTime:10*60*1e3}),r.prefetchQuery({queryKey:c.labTests.all,queryFn:async()=>{const e=await a("/api/lab-tests");if(!e.ok)throw new Error("Failed to fetch lab tests");return e.json()},staleTime:10*60*1e3})},[r]);const x=(m==null?void 0:m.patients)||[],q=e=>{e&&(r.prefetchQuery({queryKey:c.patients.context(e),queryFn:async()=>{const n=await a(`/api/patients/${e}/context`);if(!n.ok)throw new Error("Failed to fetch patient context");return n.json()},staleTime:5*60*1e3}),r.prefetchQuery({queryKey:c.patientDebts.balance(e),queryFn:async()=>{const n=await a(`/api/patient-debts/${e}/balance`);return n.ok?n.json():{netDebt:0}},staleTime:1*60*1e3}),r.prefetchQuery({queryKey:c.queue.latest(e),queryFn:async()=>{const n=await a(`/api/queue/patient/${e}/latest`);if(!n.ok)throw new Error("Failed to fetch latest queue status");const i=await n.json();return i!=null&&i._id&&r.prefetchQuery({queryKey:c.queue.entry(i._id),queryFn:async()=>{const w=await a(`/api/queue/doctor/complaint/${i._id}`);if(!w.ok)throw new Error("Failed to fetch complaint record");return w.json()},staleTime:1*60*1e3}),i},staleTime:5e3}))};return t.jsxs("div",{className:s.container,children:[t.jsxs("div",{className:s.visualContainer,children:[t.jsx("h1",{className:s.brandTitle,children:"Newtons Ai"}),!y&&t.jsxs("div",{className:s.searchBar,onClick:()=>l(),children:[t.jsx("div",{className:s.searchIconWrapper,children:t.jsx(S,{className:s.searchIcon})}),t.jsx("span",{className:s.placeholderText,children:"Search or Ask AI..."}),t.jsx("div",{className:s.micButtonWrapper,onClick:k,children:t.jsx(I,{className:s.micIcon})}),t.jsxs("div",{className:s.shortcutHint,children:[t.jsx("span",{className:s.key,children:"Ctrl"}),t.jsx("span",{className:s.plus,children:"+"}),t.jsx("span",{className:s.key,children:"K"})]})]}),!y&&(f||x.length>0)&&t.jsxs("div",{className:s.newlyRegisteredSection,children:[t.jsx("div",{className:s.newlyRegisteredLabel,children:"Newly Registered"}),t.jsx("div",{className:s.recentList,children:f?[1,2,3,4,5].map(e=>t.jsxs("div",{className:s.recentPatientPill,style:{cursor:"default"},children:[t.jsxs("div",{className:s.recentNameContainer,children:[t.jsx(p,{width:100,height:18}),t.jsx(p,{width:30,height:20})]}),t.jsx("div",{className:s.recentInfo,children:t.jsx(p,{width:80,height:14})})]},e)):x.map(e=>t.jsxs("div",{className:s.recentPatientPill,onClick:()=>g(`/dashboard/edit-complaint/patient/${e.id}`),onMouseEnter:()=>e.id&&q(e.id),children:[t.jsxs("div",{className:s.recentNameContainer,children:[t.jsx("span",{className:s.recentName,children:e.name||"New Patient"}),t.jsxs("span",{className:s.recentToken,children:["#",e.token]})]}),t.jsxs("div",{className:s.recentInfo,children:[e.age?`${e.age} yrs`:"",e.age&&e.gender?" / ":"",e.gender||""]})]},e.id))})]})]}),N&&j&&t.jsx(P,{options:Z,children:t.jsx(b,{onClose:()=>u(!1),patientData:null,tokenNumber:null,onAiSummaryChange:_})})]})};export{ce as default};
