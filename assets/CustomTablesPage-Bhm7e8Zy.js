import{j as e,f as m}from"./index-CRA8Xzko.js";import{u as z,r as o}from"./react-vendor-Cc0P4_ZX.js";/* empty css                         */import{aM as D,e as x,m as L,aa as b,X as M}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const R=()=>{const v=z(),[N,g]=o.useState([]),[f,u]=o.useState(!0),[,C]=o.useState(null),[y,r]=o.useState(!1),[i,h]=o.useState(null),[n,l]=o.useState({name:"",description:"",columns:[]}),d=async()=>{u(!0);try{const s=await m("/api/custom-tables");if(!s.ok)throw new Error("Failed to fetch tables");const a=await s.json();g(a)}catch(s){C(s.message)}finally{u(!1)}};o.useEffect(()=>{d()},[]);const j=s=>{s?(h(s),l({name:s.name,description:s.description,columns:[...s.columns]})):(h(null),l({name:"",description:"",columns:[]})),r(!0)},T=async()=>{try{const s=i?`/api/custom-tables/${i.id}`:"/api/custom-tables";if(!(await m(s,{method:i?"PUT":"POST",body:JSON.stringify(n)})).ok)throw new Error("Failed to save table");r(!1),d()}catch(s){alert(s.message)}},w=async s=>{if(confirm("Are you sure? This will delete all data in this table!"))try{await m(`/api/custom-tables/${s}`,{method:"DELETE"}),d()}catch(a){alert(a.message)}},k=()=>{l(s=>({...s,columns:[...s.columns,{key:`col_${Date.now()}`,label:"New Column",type:"text"}]}))},p=(s,a,t)=>{const c=[...n.columns];c[s]={...c[s],[a]:t},a==="label"&&(c[s].key=t.toLowerCase().replace(/[^a-z0-9]/g,"_")),l(S=>({...S,columns:c}))},E=s=>{l(a=>({...a,columns:a.columns.filter((t,c)=>c!==s)}))};return e.jsxs("div",{className:"custom-tables-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsxs("h1",{children:[e.jsx(D,{size:24})," Custom Tables Manager"]}),e.jsxs("button",{className:"primary-button",onClick:()=>j(),children:[e.jsx(x,{size:16})," Create New Table"]})]}),f?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"tables-grid",children:N.map(s=>e.jsxs("div",{className:"table-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{children:s.name}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>j(s),children:e.jsx(L,{size:16})}),e.jsx("button",{onClick:()=>w(s.id),className:"danger",children:e.jsx(b,{size:16})})]})]}),e.jsx("p",{className:"description",children:s.description||"No description"}),e.jsxs("div",{className:"column-preview",children:[s.columns.length," columns defined"]}),e.jsx("button",{className:"secondary-button",onClick:()=>v(`/custom-tables/${s.id}`),children:"View Data & Records"})]},s.id))}),y&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:i?"Edit Table":"Create New Table"}),e.jsx("button",{onClick:()=>r(!1),children:e.jsx(M,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Table Name"}),e.jsx("input",{value:n.name,onChange:s=>l({...n,name:s.target.value}),placeholder:"e.g., Equipment Log"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>l({...n,description:s.target.value})})]}),e.jsxs("div",{className:"columns-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Columns"}),e.jsx("button",{onClick:k,className:"icon-button",children:e.jsx(x,{size:16})})]}),n.columns.map((s,a)=>e.jsxs("div",{className:"column-row",children:[e.jsx("input",{value:s.label,onChange:t=>p(a,"label",t.target.value),placeholder:"Column Name"}),e.jsxs("select",{value:s.type,onChange:t=>p(a,"type",t.target.value),children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),e.jsx("button",{onClick:()=>E(a),className:"danger",children:e.jsx(b,{size:14})})]},a))]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{onClick:T,className:"primary-button",children:"Save Table"})})]})})]})};export{R as default};
