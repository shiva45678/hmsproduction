import{f as v,p as Ne,t as je,j as t,S as b,M as ke,o as we}from"./index-CRA8Xzko.js";import{u as Pe,f as ve,r as l}from"./react-vendor-Cc0P4_ZX.js";import{W as _e,e as Ce,aa as Se}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Te=()=>{const D=Pe(),L=ve(),[c,J]=l.useState(null),[N,ne]=l.useState([]),[m,d]=l.useState([]),[u,_]=l.useState(""),[$,k]=l.useState([]),[W,h]=l.useState(null),[O,w]=l.useState(!1),[p,H]=l.useState(null),[Z,F]=l.useState(!0),[g,K]=l.useState(""),[q,C]=l.useState([]),[P,j]=l.useState(!1),[T,y]=l.useState(null),[U,re]=l.useState(!1),[E,oe]=l.useState(!1),[V,A]=l.useState([]),[ie,X]=l.useState(!1),[Y,R]=l.useState(null),I=/^\+?[0-9\s\-().]{7,20}$/,le=/^[a-zA-Z\s'-]{2,}$/,M=l.useCallback(async()=>{try{const e=await v("/api/drugs");if(!e.ok)throw new Error("Failed to fetch drugs");const s=await e.json(),n=s.drugs||s||[];ne(n)}catch(e){console.error("Failed to fetch available drugs:",e),h("Could not load drug list. "+e.message)}},[]),ee=l.useCallback(async e=>{X(!0),R(null);try{const s=await v(`/api/pharmacy-orders/patient/${e}`);if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.message||`HTTP error! status: ${s.status}`)}const n=await s.json();A(n||[])}catch(s){console.error("Failed to fetch previous pharmacy orders:",s),R(`Could not load previous orders: ${s.message}`)}finally{X(!1)}},[]);l.useEffect(()=>{var e;M(),(e=L.state)!=null&&e.patient?S(L.state.patient):F(!0)},[M,L.state]),l.useEffect(()=>{c!=null&&c.id?ee(c.id):A([])},[c,ee]);const te=l.useMemo(()=>new Ne(N,{keys:["name","brand_name"],threshold:.3}),[N]);l.useEffect(()=>{if(!u){k([]);return}const e=te.search(u).map(s=>s.item);k(e.slice(0,10))},[u,te]);const ce=l.useMemo(()=>je(async e=>{if(e.trim().length<2){C([]),j(!1),y(null);return}j(!0),y(null);try{const s=new URLSearchParams({search:encodeURIComponent(e),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),n=await v(`/api/patients?${s.toString()}`);if(!n.ok){const r=await n.text();throw new Error(`API Error (${n.status}): ${r||n.statusText}`)}const a=await n.json();C(a.patients)}catch(s){console.error("Error searching patients:",s),y(s.message||"Failed to search patients."),C([])}finally{j(!1)}},300),[I]),de=e=>{const s=e.target.value;K(s),re(I.test(s)),oe(le.test(s)&&!I.test(s)),j(!0),ce(s)},S=l.useCallback(e=>{J(e),F(!1),K(""),C([]),y(null)},[]),se=l.useCallback(async e=>{if(!g||e==="phone"&&!U||e==="name"&&!E){y(`Invalid ${e} to create a new patient.`);return}j(!0),y(null);try{const n=await v("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e==="name"?g:"direct pharmacy",phone:e==="phone"?g:null,age:null,gender:null,token:null})});if(!n.ok){const r=await n.json();throw new Error(r.message||`Failed to create patient: ${n.statusText}`)}const a=await n.json();alert(`New patient "${a.name}" created with ${e==="phone"?`phone ${a.phone}`:`name ${a.name}`}.`),S(a)}catch(s){console.error("Error creating new patient:",s),y(s.message||"Failed to create new patient.")}finally{j(!1)}},[g,U,E,S]),me=()=>{J(null),F(!0),d([]),h(null),A([])},ue=e=>{if(m.some(s=>s.drug_id===e.id)){const s=e.name||e.brand_name||"This drug";h(`${s} is already in the order.`),setTimeout(()=>h(null),3e3),_(""),k([]);return}d(s=>[...s,{drug_id:e.id,name:e.name||e.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,tabletsPerDay:1,numberOfDays:1,mrp:Number(e.mrp)||0,originalMrp:Number(e.mrp)||0,stock:e.stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(e.mrp)||0)/(f(e.pack)||1),pack:e.pack}]),_(""),k([])},he=()=>{const e=u.trim();if(!e){h("Please enter a drug name to navigate to the add drug page."),setTimeout(()=>h(null),3e3);return}D("/dashboard/inventory/add",{state:{initialDrugName:e}}),_(""),k([])},f=e=>{if(!e)return null;const s=e.match(/(?:\d+x)?(\d+)/);return s?parseInt(s[1],10):null},pe=e=>{d(s=>s.filter(n=>(n.drug_id??n.name)!==e))},Q=(e,s)=>{d(n=>n.map(a=>{if((a.drug_id??a.name)===e&&a.isLoose){const o=f(a.pack),i=Math.max(0,s),x=i*(o??1)+(a.looseUnits??0);return{...a,loosePacks:i,looseQuantity:x,pack_quantity:i}}return a}))},z=(e,s)=>{d(n=>n.map(a=>{if((a.drug_id??a.name)===e&&a.isLoose){const o=f(a.pack),i=Math.max(0,s),x=(a.loosePacks??0)*(o??1)+i;return{...a,looseUnits:i,looseQuantity:x}}return a}))},xe=e=>{const s=[];e.medications.forEach(n=>{if(m.find(r=>r.drug_id&&n.drug_id&&r.drug_id===n.drug_id||r.name.toLowerCase()===n.name.toLowerCase()))d(r=>r.map(o=>{if(o.drug_id&&n.drug_id&&o.drug_id===n.drug_id||o.name.toLowerCase()===n.name.toLowerCase()){const i=(o.pack_quantity??0)+(n.pack_quantity??0),x=(o.loose_quantity??0)+(n.loose_quantity??0),be=n.tabletsPerDay??o.tabletsPerDay,ye=n.numberOfDays??o.numberOfDays,G=f(o.pack),B=i*(G??1)+x;return{...o,pack_quantity:i,loose_quantity:x,directions_to_use:n.directions_to_use??o.directions_to_use,tabletsPerDay:be,numberOfDays:ye,looseQuantity:B,loosePacks:Math.floor(B/(G??1)),looseUnits:B%(G??1)}}return o}));else{let r=n.drug_id,o=n.drug_id?N.find(i=>i.id===n.drug_id):void 0;if(!r&&n.name){const i=N.find(x=>x.name&&x.name.toLowerCase()===n.name.toLowerCase());i&&(r=i.id,o=i)}s.push({drug_id:r,name:n.name,pack_quantity:n.pack_quantity??0,loose_quantity:n.loose_quantity??0,directions_to_use:n.directions_to_use,tabletsPerDay:n.tabletsPerDay??1,numberOfDays:n.numberOfDays??1,mrp:o?o.mrp:n.pack_price,originalMrp:o?o.mrp:n.pack_price,stock:o?o.stock:n.stock,isLoose:!0,loosePacks:0,looseUnits:(n.pack_quantity??0)*(f((o==null?void 0:o.pack)||n.pack)??1)+(n.loose_quantity??0),looseQuantity:(n.pack_quantity??0)*(f((o==null?void 0:o.pack)||n.pack)??1)+(n.loose_quantity??0),pricePerLooseUnit:(o?Number(o.mrp):Number(n.pack_price)||0)/(f((o==null?void 0:o.pack)||n.pack)||1),pack:(o==null?void 0:o.pack)||n.pack})}}),d(n=>[...n,...s]),e.prescriptionForUnavailableDrugs&&(!p||!p.includes(e.prescriptionForUnavailableDrugs))&&H(n=>n?`${n}

-- From Order ${e.id.substring(0,8)} --
${e.prescriptionForUnavailableDrugs}`:e.prescriptionForUnavailableDrugs),h("Medications from previous order added to current order."),setTimeout(()=>h(null),3e3)},fe=async e=>{if(e.preventDefault(),h(null),w(!0),!c){h("No patient selected for the order."),w(!1);return}if(m.length===0&&!(p!=null&&p.trim())){h("Please add at least one medication or provide a prescription for unavailable drugs."),w(!1);return}const s=m.filter(a=>{const r=a.looseQuantity??0;return r<=0||a.stock!==void 0&&r>a.stock});if(s.length>0){h(`Invalid quantity or insufficient stock for: ${s.map(a=>a.name).join(", ")}`),w(!1);return}const n={patient_id:c.id,items:m.map(a=>{const r=a.mrp??0,o=a.pricePerLooseUnit??0,i=o*(a.looseQuantity??0);return{drug_id:a.drug_id===void 0?null:a.drug_id,name:a.name,pack_quantity:a.loosePacks??0,loose_quantity:a.looseUnits??0,pack_price:r,loose_price:o,total_price:i,price:a.originalMrp??0,directions_to_use:a.directions_to_use===void 0?null:a.directions_to_use,tabletsPerDay:a.tabletsPerDay??1,numberOfDays:a.numberOfDays??1}}),order_total:ae,prescription_for_unavailable_drugs:p};try{const a=await v("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok){const r=await a.json();throw new Error(r.message||`Failed to create order: ${a.statusText}`)}alert(`Pharmacy order created successfully for ${c.name}!`),D(-1)}catch(a){console.error("Failed to create pharmacy order:",a),h(a.message||"Failed to create order. Please try again.")}finally{w(!1)}},ae=l.useMemo(()=>m.reduce((e,s)=>{const n=s.isLoose?s.pricePerLooseUnit??0:s.mrp??0,a=s.isLoose?s.looseQuantity??0:s.quantity??0;return e+n*a},0),[m]),ge=(Number(ae)||0).toFixed(2);return t.jsxs("div",{className:"add-pharmacy-order-page p-4 md:p-6 max-w-5xl mx-auto",children:[" ",t.jsxs("div",{className:"page-header flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 pb-4",children:[" ",t.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[t.jsxs("button",{onClick:()=>D(-1),className:"back-button p-2 rounded-full mr-3",title:"Go Back",children:[t.jsx(_e,{size:20})," "]}),t.jsx("h2",{className:"text-2xl",children:"Create New Pharmacy Order"})," "]})]}),Z&&t.jsxs("div",{className:"content-section",children:[" ",t.jsx("h3",{className:"section-title",children:"Select Patient"})," ",t.jsxs("div",{className:"mb-3 relative",children:[t.jsx("label",{htmlFor:"patient-search",className:"form-label",children:"Search Patient (Name, Token, or Phone)"})," ",t.jsx("input",{type:"text",id:"patient-search",placeholder:"Search by Name, Token No, or Phone No (min 2 chars)...",value:g,onChange:de,className:"custom-text-input mt-1",autoFocus:!0})]}),T&&t.jsx("div",{className:"ai-function-status error mb-3 p-3",children:T})," ",P?t.jsx("div",{className:"patient-search-results items-loading mt-1",children:[1,2,3].map(e=>t.jsx("div",{className:"px-4 py-3 border-b border-gray-100 last:border-0",children:t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[t.jsx(b,{width:40,height:20}),t.jsx(b,{width:120,height:20})]}),t.jsx("div",{className:"mt-1 sm:mt-0",children:t.jsx(b,{width:150,height:16})})]})},e))}):q.length>0&&t.jsxs("div",{className:"patient-search-results max-h-64 overflow-y-auto rounded-md shadow-sm mt-1 z-10",children:[" ",t.jsxs("ul",{children:[" ",q.map(e=>t.jsxs("li",{onClick:()=>S({id:e.id,name:e.name,token:e.token,age:e.age,gender:e.gender,phone:e.phone}),children:[t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[t.jsxs("div",{className:"font-medium",children:[t.jsxs("span",{className:"patient-token mr-2",children:["#",e.token]}),e.name]}),t.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:mt-0",children:[e.age?`${e.age} yrs`:"Age N/A",e.gender?` / ${e.gender}`:" / Gender N/A",e.phone&&t.jsxs("span",{className:"hidden sm:inline",children:[" / ",e.phone]})]})]}),e.phone&&t.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:hidden",children:["Phone: ",e.phone]})]},e.id))]})]}),g.length>=2&&!P&&q.length===0&&!T&&t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"text-gray-400 mt-2 text-sm",children:['No patients found matching "',g,'".']}),U&&t.jsx("button",{type:"button",onClick:()=>se("phone"),className:"create-patient-button mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",disabled:P,children:'Create "direct pharmacy" Patient with this Phone'}),E&&t.jsx("button",{type:"button",onClick:()=>se("name"),className:"create-patient-button mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ml-2",disabled:P,children:"Create Patient with this Name"})]}),g.length<2&&!P&&t.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"Enter at least 2 characters to search."})]}),c&&!Z&&t.jsxs("form",{onSubmit:fe,children:[t.jsxs("div",{className:"selected-patient-info content-section flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[" ",t.jsxs("div",{children:[t.jsxs("h3",{className:"section-title",children:[" ","Patient: ",t.jsx("span",{className:"font-normal",children:c.name})]}),t.jsxs("p",{className:"text-sm mt-1",children:["Token: ",t.jsx("span",{className:"font-medium",children:c.token??"N/A"}),c.age&&`  •  Age: ${c.age}`,c.gender&&`  •  Gender: ${c.gender}`,c.phone&&`  •  Phone: ${c.phone}`]}),t.jsxs("p",{className:"text-xs mt-1",title:`Patient UUID: ${c.id}`,children:["ID: ",c.id.substring(0,12),"..."]})]}),t.jsx("button",{type:"button",onClick:me,className:"change-patient-button mt-2 sm:mt-0 px-3 py-1.5 border rounded-md text-sm font-medium focus:outline-none focus:ring-2",children:"Change Patient"})]}),W&&t.jsx("div",{className:"ai-function-status error mb-4 p-3",children:W})," ",ie?t.jsxs("div",{className:"content-section mt-4",children:[t.jsx("h3",{className:"section-title",children:"Previous Orders"}),t.jsx("div",{className:"space-y-4",children:[1,2].map(e=>t.jsxs("div",{className:"previous-order-card p-4 border rounded-lg shadow-sm bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-center mb-4",children:[t.jsx(b,{width:180,height:20}),t.jsx(b,{width:80,height:24,style:{borderRadius:"12px"}})]}),t.jsxs("div",{className:"space-y-2 mb-4",children:[t.jsx(b,{width:"90%",height:16}),t.jsx(b,{width:"70%",height:16})]}),t.jsx(b,{width:"100%",height:36,style:{borderRadius:"6px"}})]},e))})]}):Y?t.jsx("div",{className:"ai-function-status error mb-4 p-3",children:Y}):V.length>0?t.jsxs("div",{className:"content-section mt-4",children:[t.jsx("h3",{className:"section-title",children:"Previous Orders"}),t.jsx("div",{className:"space-y-4",children:V.map(e=>t.jsxs("div",{className:"previous-order-card p-4 border rounded-lg shadow-sm bg-gray-50",children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsxs("p",{className:"font-semibold text-gray-800",children:["Order Date: ",new Date(e.date).toLocaleDateString()]}),t.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${e.status==="dispensed"?"bg-green-100 text-green-800":e.status==="pending"?"bg-yellow-100 text-yellow-800":e.status==="cancelled"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),t.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 mb-3",children:e.medications.map((s,n)=>t.jsxs("li",{children:[t.jsx("strong",{children:s.name}),": ",s.quantity," Qty",s.directions_to_use&&` - Directions: ${s.directions_to_use}`]},n))}),e.prescriptionForUnavailableDrugs&&t.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[t.jsx("span",{className:"font-semibold",children:"Prescription for Unavailable:"}),t.jsxs("div",{className:"prose prose-sm max-w-none",children:[" ",t.jsx(ke,{remarkPlugins:[we],children:e.prescriptionForUnavailableDrugs})]})]}),t.jsxs("button",{type:"button",onClick:()=>xe(e),className:"add-previous-meds-button mt-3 px-3 py-1.5 text-sm font-medium rounded-md flex items-center justify-center",children:[t.jsx(Ce,{size:16,className:"mr-1"})," Add Medications to Current Order"]})]},e.id))})]}):c&&t.jsx("div",{className:"content-section text-center py-4 mt-4",children:t.jsx("p",{className:"text-gray-500",children:"No previous orders found for this patient."})}),t.jsxs("div",{className:"mb-4 content-section",children:[t.jsx("label",{htmlFor:"prescription-unavailable",className:"form-label",children:"Prescription for Unavailable Drugs (Optional)"}),t.jsx("textarea",{id:"prescription-unavailable",rows:3,value:p??"",onChange:e=>H(e.target.value||null),placeholder:"Enter prescription details for any drugs that are currently unavailable...",className:"custom-text-input mt-1 w-full"})]}),t.jsxs("div",{className:"mb-4 relative content-section",children:[" ",t.jsx("label",{htmlFor:"drug-search",className:"form-label",children:"Add Medication"})," ",t.jsx("input",{type:"text",id:"drug-search",placeholder:"Search for drug name or type to add custom...",value:u,onChange:e=>_(e.target.value),className:"custom-text-input mt-1"}),u&&t.jsxs("div",{className:"drug-search-dropdown mt-1 w-full max-h-60 rounded-md border shadow-lg overflow-auto focus:outline-none sm:text-sm z-20",children:[" ",$.length>0&&t.jsxs("ul",{children:[" ",$.map(e=>t.jsxs("li",{onClick:()=>ue(e),className:"cursor-pointer select-none relative",children:[t.jsx("span",{className:"font-medium block truncate",children:e.name||e.brand_name}),t.jsxs("span",{className:"drug-stock-price text-xs",children:[" ","(Stock: ",e.stock??"N/A",", MRP: ₹",Number(e.mrp||0).toFixed(2),")"]})]},e.id))]}),u.trim()&&!N.some(e=>e.name&&e.name.toLowerCase()===u.trim().toLowerCase()||e.brand_name&&e.brand_name.toLowerCase()===u.trim().toLowerCase())&&t.jsxs("div",{onClick:he,className:"add-custom-drug-button cursor-pointer text-sm font-medium",role:"button",children:['Add "',u.trim(),'" as new item']}),u.trim()&&$.length===0&&N.some(e=>e.name&&e.name.toLowerCase()===u.trim().toLowerCase()||e.brand_name&&e.brand_name.toLowerCase()===u.trim().toLowerCase())&&t.jsx("p",{className:"text-gray-400 py-2.5 px-4 text-sm",children:"Drug already selected or no new matches."})]})]}),t.jsxs("div",{className:"order-items-section content-section max-h-96 overflow-y-auto",children:[" ",t.jsx("h4",{className:"section-title",children:"Order Items"})," ",m.length===0&&t.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No medications added yet."}),m.length>0&&t.jsx("ul",{className:"space-y-4",children:m.map(e=>{const s=e.drug_id??e.name,n=!e.drug_id;return t.jsxs("li",{className:"order-item-card text-sm",children:[" ",t.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[t.jsxs("div",{className:"flex-grow mb-2 md:mb-0",children:[t.jsxs("span",{className:`item-name block text-base ${n?"custom":""}`,children:[" ",e.name,n?" (custom)":""]}),!n&&e.pricePerLooseUnit!==void 0&&t.jsxs("span",{className:"item-details text-xs",children:[" ","@ ₹",(Number(e.pricePerLooseUnit)||0).toFixed(2)," per loose unit"]}),e.stock!==void 0&&t.jsxs("span",{className:`item-details text-xs ml-2 ${e.stock<=10?"item-stock low":""}`,children:[" ","(Stock: ",e.stock,")"]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2",children:[t.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[t.jsx("label",{htmlFor:`loose-packs-${s}`,className:"dosage-label",children:"Packs:"}),t.jsxs("div",{className:"quantity-control",children:[t.jsx("button",{type:"button",onClick:()=>Q(s,(e.loosePacks??0)-1),className:"quantity-btn",children:"-"}),t.jsx("input",{type:"number",id:`loose-packs-${s}`,min:"0",value:e.loosePacks||"",onChange:a=>{const r=parseInt(a.target.value,10);Q(s,isNaN(r)?0:r)},onFocus:a=>a.target.select(),className:"dosage-input text-sm text-right"}),t.jsx("button",{type:"button",onClick:()=>Q(s,(e.loosePacks??0)+1),className:"quantity-btn",children:"+"})]})]}),t.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[t.jsx("label",{htmlFor:`loose-units-${s}`,className:"dosage-label",children:"Loose:"}),t.jsxs("div",{className:"quantity-control",children:[t.jsx("button",{type:"button",onClick:()=>z(s,(e.looseUnits??0)-1),className:"quantity-btn",children:"-"}),t.jsx("input",{type:"number",id:`loose-units-${s}`,min:"0",value:e.looseUnits||"",onChange:a=>{const r=parseInt(a.target.value,10);z(s,isNaN(r)?0:r)},onFocus:a=>a.target.select(),className:"dosage-input text-sm text-right"}),t.jsx("button",{type:"button",onClick:()=>z(s,(e.looseUnits??0)+1),className:"quantity-btn",children:"+"})]}),e.pack&&t.jsxs("span",{className:"ml-2 text-sm text-gray-400",children:["(",e.pack.split("x")[1]||e.pack," per pack)"]})]})]}),t.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3 mt-2 md:mt-0 md:flex-col md:items-end",children:[t.jsxs("div",{className:"w-28 text-right font-semibold",children:[" ","₹",(Number((e.pricePerLooseUnit??0)*(e.looseQuantity??0))||0).toFixed(2)]}),t.jsx("button",{type:"button",onClick:()=>pe(s),className:"remove-item-button p-1.5 -m-1.5 rounded-full",title:"Remove Item",children:t.jsx(Se,{size:18})})]})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2 mt-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{htmlFor:`tablets-per-day-${s}`,className:"dosage-label",children:"Per Day:"}),t.jsxs("div",{className:"quantity-control",children:[t.jsx("button",{type:"button",onClick:()=>d(a=>a.map(r=>r.drug_id===s?{...r,tabletsPerDay:Math.max(1,(r.tabletsPerDay??1)-1)}:r)),className:"quantity-btn",children:"-"}),t.jsx("input",{type:"number",id:`tablets-per-day-${s}`,min:"1",value:e.tabletsPerDay??1,onChange:a=>{const r=parseInt(a.target.value,10);d(o=>o.map(i=>i.drug_id===s?{...i,tabletsPerDay:isNaN(r)?1:Math.max(1,r)}:i))},onFocus:a=>a.target.select(),className:"dosage-input text-sm text-right"}),t.jsx("button",{type:"button",onClick:()=>d(a=>a.map(r=>r.drug_id===s?{...r,tabletsPerDay:(r.tabletsPerDay??1)+1}:r)),className:"quantity-btn",children:"+"})]})]}),t.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[t.jsx("label",{htmlFor:`number-of-days-${s}`,className:"dosage-label",children:"No. Days:"}),t.jsxs("div",{className:"quantity-control",children:[t.jsx("button",{type:"button",onClick:()=>d(a=>a.map(r=>r.drug_id===s?{...r,numberOfDays:Math.max(1,(r.numberOfDays??1)-1)}:r)),className:"quantity-btn",children:"-"}),t.jsx("input",{type:"number",id:`number-of-days-${s}`,min:"1",value:e.numberOfDays??1,onChange:a=>{const r=parseInt(a.target.value,10);d(o=>o.map(i=>i.drug_id===s?{...i,numberOfDays:isNaN(r)?1:Math.max(1,r)}:i))},onFocus:a=>a.target.select(),className:"dosage-input text-sm text-right"}),t.jsx("button",{type:"button",onClick:()=>d(a=>a.map(r=>r.drug_id===s?{...r,numberOfDays:(r.numberOfDays??1)+1}:r)),className:"quantity-btn",children:"+"})]})]})]}),t.jsx("div",{className:"flex items-center mt-2",children:e.pack&&f(e.pack)&&t.jsx("span",{className:"ml-4 text-sm text-gray-400",children:(()=>{const a=f(e.pack),r=e.looseQuantity??0;if(a&&a>0){const o=Math.floor(r/a),i=r%a;return`(Subtract: ${o} packs, ${i} loose)`}return""})()})}),t.jsxs("div",{className:"mt-2",children:[t.jsx("label",{htmlFor:`directions-${s}`,className:"dosage-label",children:"Directions:"}),t.jsx("input",{type:"text",id:`directions-${s}`,placeholder:"e.g., 'After food', 'Twice a day'",value:e.directions_to_use??"",onChange:a=>{const r=a.target.value;d(o=>o.map(i=>(i.drug_id??i.name)===s?{...i,directions_to_use:r}:i))},className:"dosage-input text-sm w-full mt-1"})]})]},s)})})]}),m.length>0&&t.jsx("div",{className:"mt-6 text-right pr-4",children:t.jsxs("span",{className:"grand-total font-bold",children:[" ","Grand Total: ₹",ge]})}),t.jsx("div",{className:"mt-8 flex justify-end",children:t.jsx("button",{type:"submit",disabled:O||m.length===0&&!(p!=null&&p.trim()),className:`submit-order-button inline-flex items-center justify-center text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 ${O||m.length===0&&!(p!=null&&p.trim())?"":"hover:opacity-90"}`,children:O?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"spinner animate-spin rounded-full h-5 w-5 border-2 mr-3"})," ","Creating Order..."]}):"Create Order"})})]})]})};export{Te as default};
