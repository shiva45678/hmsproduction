import{j as e,f as T,t as pe}from"./index-DpOfI1um.js";import{r as i,u as xe}from"./react-vendor-Cc0P4_ZX.js";import{X as F,f as K,ar as Q,aa as ue,e as ee,i as te,v as me,a7 as ge}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const je=({patient:f,onClose:x,onSave:C})=>{const[u,v]=i.useState({name:f.name,age:f.age,gender:f.gender,phone:f.phone||""}),[N,g]=i.useState(!1),l=async d=>{d.preventDefault(),g(!0);try{await C({...u,phone:u.phone||void 0}),x()}catch(w){console.error(w),alert("Failed to update patient")}finally{g(!1)}};return e.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"modal-content",style:{backgroundColor:"white",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 4px 20px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",color:"#333"},children:"Edit Patient Details"}),e.jsx("button",{onClick:x,style:{border:"none",background:"none",cursor:"pointer",color:"#666"},children:e.jsx(F,{size:20})})]}),e.jsxs("form",{onSubmit:l,style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Name"}),e.jsx("input",{type:"text",value:u.name,onChange:d=>v({...u,name:d.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},required:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Age"}),e.jsx("input",{type:"number",value:u.age||"",onChange:d=>v({...u,age:parseInt(d.target.value)||0}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Gender"}),e.jsxs("select",{value:u.gender||"",onChange:d=>v({...u,gender:d.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem",width:"100%"},children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Phone"}),e.jsx("input",{type:"tel",value:u.phone,onChange:d=>v({...u,phone:d.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},placeholder:"Optional"})]}),e.jsx("button",{type:"submit",className:"save-btn",style:{marginTop:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},disabled:N,children:N?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(K,{size:18})," Save Changes"]})})]})]})})},ve=({selectedTeeth:f,toothConditions:x={},onToothClick:C})=>{const u=Array.from({length:16},(o,h)=>h+1),v=Array.from({length:16},(o,h)=>32-h),N=o=>{if(!o||o.length===0)return{};const h=[];let p=!1,S=!1;o.forEach(b=>{b==="condition-filling"&&h.push("#3b82f6"),b==="condition-rct"&&h.push("#a855f7"),b==="condition-extraction"&&(h.push("#fee2e2"),p=!0),b==="condition-crown"&&(h.push("#fef3c7"),S=!0)});const y={};if(h.length>1){const b=100/h.length,I=h.map((k,z)=>`${k} ${z*b}%, ${k} ${(z+1)*b}%`).join(", ");y.background=`linear-gradient(to bottom, ${I})`,y.opacity=.9}return p&&(y.borderColor="#ef4444"),S&&(y.borderColor="#f59e0b",y.borderWidth="2px"),y},g=o=>{const h=f.includes(o),p=x[o]||[],S=p.length===1?p[0]:p.length>0?"condition-mixed":"",y=p.length>1?N(p):{},b=l(p)||d(p)?w(p):{};return e.jsxs("div",{onClick:()=>C(o),className:`tooth-item ${h?"selected":""} ${S}`,style:b,title:`Tooth ${o}: ${p.join(", ")}`,children:[e.jsx("div",{className:"tooth-number",children:o}),e.jsx("div",{className:"tooth-graphic",style:l(p)?{borderColor:"#f59e0b"}:{},children:e.jsx("div",{className:"tooth-fill",style:y})})]},o)},l=o=>o.includes("condition-crown"),d=o=>o.includes("condition-extraction"),w=o=>{const h={};return o.includes("condition-extraction")&&(h.borderColor="#ef4444",h.backgroundColor="rgba(239, 68, 68, 0.1)",h.opacity=.8),h};return e.jsxs("div",{className:"chart-container-inner",children:[e.jsxs("div",{className:"arch-row",children:[e.jsx("div",{className:"quadrant",children:u.slice(0,8).map(o=>g(o))}),e.jsx("div",{className:"quadrant",children:u.slice(8).map(o=>g(o))})]}),e.jsxs("div",{className:"midline-divider",children:[e.jsx("div",{className:"divider-line"}),e.jsx("span",{className:"chart-label",style:{fontSize:"0.7rem"},children:"Lingual"}),e.jsx("div",{className:"divider-line"})]}),e.jsxs("div",{className:"arch-row",children:[e.jsx("div",{className:"quadrant",children:v.slice(0,8).map(o=>g(o))}),e.jsx("div",{className:"quadrant",children:v.slice(8).map(o=>g(o))})]}),e.jsxs("div",{className:"chart-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box"}),e.jsx("span",{children:"Normal"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box selected"}),e.jsx("span",{children:"Selected"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box filling"}),e.jsx("span",{children:"Filling"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box rct"}),e.jsx("span",{children:"RCT"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box crown"}),e.jsx("span",{children:"Crown"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box extraction"}),e.jsx("span",{children:"Extraction"})]})]})]})},ye=({onClose:f,onUpdate:x})=>{const[C,u]=i.useState([]),[v,N]=i.useState(!0),[g,l]=i.useState(null),[d,w]=i.useState({}),[o,h]=i.useState(!1),[p,S]=i.useState({name:"",cost:0,type:"general"});i.useEffect(()=>{y()},[]);const y=async()=>{N(!0);try{const n=await T("/api/dental/procedures");if(n.ok){const j=await n.json();u(j)}}catch(n){console.error(n)}finally{N(!1)}},b=async()=>{if(!(!p.name||!p.cost))try{(await T("/api/dental/procedures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok&&(h(!1),S({name:"",cost:0,type:"general"}),y(),x())}catch(n){console.error(n)}},I=async n=>{try{(await T(`/api/dental/procedures/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).ok&&(l(null),w({}),y(),x())}catch(j){console.error(j)}},k=async n=>{if(window.confirm("Are you sure you want to delete this procedure?"))try{(await T(`/api/dental/procedures/${n}`,{method:"DELETE"})).ok&&(y(),x())}catch(j){console.error(j)}},z=n=>{l(n.id),w({name:n.name,cost:n.cost,type:n.type})};return e.jsx("div",{className:"manage-procedures-modal-overlay",children:e.jsxs("div",{className:"manage-procedures-modal-content",children:[e.jsxs("div",{className:"manage-procedures-modal-header",children:[e.jsx("h2",{className:"manage-procedures-modal-title",children:"Manage Procedures"}),e.jsx("button",{onClick:f,className:"manage-procedures-close-btn",children:e.jsx(F,{size:20})})]}),e.jsx("div",{className:"manage-procedures-list-container",children:v?e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading procedures..."}):e.jsxs("table",{className:"manage-procedures-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Name"}),e.jsx("th",{style:{width:"20%"},children:"Type"}),e.jsx("th",{style:{width:"20%"},children:"Cost (₹)"}),e.jsx("th",{style:{width:"20%"},children:"Actions"})]})}),e.jsx("tbody",{children:C.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center",padding:"20px",color:"#888"},children:"No procedures found. Add one below."})}):C.map(n=>e.jsx("tr",{children:g===n.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",className:"edit-input",value:d.name||"",onChange:j=>w({...d,name:j.target.value}),placeholder:"Procedure Name"})}),e.jsx("td",{children:e.jsxs("select",{className:"edit-select",value:d.type||"general",onChange:j=>w({...d,type:j.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"})]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"edit-input",value:d.cost||0,onChange:j=>w({...d,cost:parseFloat(j.target.value)}),placeholder:"Cost"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>I(n.id),className:"action-btn btn-save",title:"Save",children:e.jsx(K,{size:18})}),e.jsx("button",{onClick:()=>l(null),className:"action-btn btn-cancel",title:"Cancel",children:e.jsx(F,{size:18})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:n.name}),e.jsx("td",{children:e.jsx("span",{className:`procedure-badge badge-${n.type}`,children:n.type})}),e.jsxs("td",{style:{fontWeight:500},children:["₹",n.cost]}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>z(n),className:"action-btn btn-edit",title:"Edit",children:e.jsx(Q,{size:18})}),e.jsx("button",{onClick:()=>k(n.id),className:"action-btn btn-delete",title:"Delete",children:e.jsx(ue,{size:18})})]})]})},n.id))})]})}),e.jsx("div",{className:"add-procedure-section",children:o?e.jsxs("div",{className:"add-procedure-card",children:[e.jsx("h4",{className:"add-procedure-title",children:"Add New Procedure"}),e.jsxs("div",{className:"add-form-grid",children:[e.jsx("input",{type:"text",className:"form-input",placeholder:"Procedure Name",value:p.name||"",onChange:n=>S({...p,name:n.target.value})}),e.jsxs("select",{className:"form-select",value:p.type||"general",onChange:n=>S({...p,type:n.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"})]}),e.jsx("input",{type:"number",className:"form-input",placeholder:"Cost",value:p.cost||"",onChange:n=>S({...p,cost:parseFloat(n.target.value)})}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{onClick:b,className:"btn-primary",children:"Save"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Cancel"})]})]})]}):e.jsxs("button",{onClick:()=>h(!0),className:"add-trigger-btn",children:[e.jsx(ee,{size:18})," Add New Procedure"]})})]})})},fe=({toothNumber:f,procedures:x,onSelect:C,onClose:u})=>{const[v,N]=i.useState(""),g=i.useMemo(()=>x.filter(l=>l.name.toLowerCase().includes(v.toLowerCase())),[x,v]);return e.jsxs("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:[e.jsxs("div",{className:"modal-content",style:{backgroundColor:"var(--dp-card-bg)",borderRadius:"12px",width:"100%",maxWidth:"400px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",animation:"scaleUp 0.2s ease-out"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--dp-border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--dp-bg)"},children:[e.jsxs("h3",{style:{margin:0,color:"var(--dp-text)",fontSize:"1.1rem"},children:["Tooth ",f," Procedures"]}),e.jsx("button",{onClick:u,style:{background:"none",border:"none",color:"var(--dp-text-sec)",cursor:"pointer",padding:"4px"},children:e.jsx(F,{size:20})})]}),e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--dp-border)"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx(te,{size:16,style:{position:"absolute",left:"12px",color:"var(--dp-text-sec)"}}),e.jsx("input",{type:"text",placeholder:"Search procedures...",value:v,onChange:l=>N(l.target.value),style:{width:"100%",padding:"8px 12px 8px 36px",borderRadius:"8px",border:"1px solid var(--dp-border)",backgroundColor:"var(--dp-bg)",color:"var(--dp-text)",fontSize:"0.9rem",outline:"none"},autoFocus:!0})]})}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:g.length===0?e.jsx("div",{style:{padding:"24px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.9rem"},children:"No procedures found."}):e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:g.map(l=>e.jsxs("button",{onClick:()=>C(l),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"none",background:"transparent",borderBottom:"1px solid var(--dp-border)",cursor:"pointer",textAlign:"left",transition:"background-color 0.1s"},className:"procedure-modal-item",onMouseOver:d=>d.currentTarget.style.backgroundColor="var(--dp-bg)",onMouseOut:d=>d.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--dp-text)",fontWeight:500,fontSize:"0.95rem"},children:l.name}),e.jsx("div",{style:{color:"var(--dp-text-sec)",fontSize:"0.8rem",textTransform:"capitalize"},children:l.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--dp-primary)",fontWeight:600,fontSize:"0.9rem"},children:[e.jsxs("span",{children:["₹",l.cost]}),e.jsx(ee,{size:16})]})]},l.id))})})]}),e.jsx("style",{children:`
                @keyframes scaleUp {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
            `})]})},Z=/^\+?[0-9\s\-().]{7,20}$/,be=/^[a-zA-Z\s'-]{2,}$/,Te=()=>{const f=xe(),[x,C]=i.useState(""),[u,v]=i.useState([]),[N,g]=i.useState(!1),[l,d]=i.useState(null),[w,o]=i.useState(!1),[h,p]=i.useState(!1),[S,y]=i.useState(!1),[b,I]=i.useState([]),[k,z]=i.useState([]),[n,j]=i.useState({}),[R,B]=i.useState(""),[L,U]=i.useState(!1),[A,W]=i.useState("plan"),[D,H]=i.useState([]),[O,se]=i.useState([]),[ne,q]=i.useState(!1);i.useEffect(()=>{G()},[]);const G=async()=>{try{const t=await T("/api/dental/procedures");if(t.ok){const s=await t.json();se(s)}}catch(t){console.error("Error fetching procedures",t)}};i.useEffect(()=>{(async()=>{if(!l){H([]);return}try{const s=await T(`/api/dental/patient/${l.id}`);if(s.ok){const r=await s.json();H(r)}}catch(s){console.error("Error fetching history",s)}})()},[l]);const J=i.useMemo(()=>pe(async t=>{if(!t.trim()||t.length<2){v([]),g(!1);return}g(!0);try{const s=await T(`/api/patients?search=${encodeURIComponent(t)}&limit=10`);if(s.ok){const r=await s.json();v(r.patients||[])}}catch(s){console.error("Search error:",s)}finally{g(!1)}},300),[]);i.useEffect(()=>{J(x)},[x,J]);const ae=t=>{const s=t.target.value;C(s),p(Z.test(s)),y(be.test(s)&&!Z.test(s))},re=async t=>{if(!(!x||t==="phone"&&!h||t==="name"&&!S)){g(!0);try{const r=await T("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t==="name"?x:"direct dental",phone:t==="phone"?x:null,age:null,gender:null,token:null})});if(r.ok){const a=await r.json();_({id:a.id,name:a.name,token:a.token??null,age:a.age??null,gender:a.gender??null,phone:a.phone})}else alert("Failed to create patient")}catch(s){console.error("Error creating patient:",s),alert("Error creating patient")}finally{g(!1)}}},_=t=>{d(t),C(""),v([])},le=()=>{d(null),I([]),z([]),j({}),B("")},ie=async t=>{if(!l)return;const s=await T(`/api/patients/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(s.ok)await s.json(),d(r=>r?{...r,...t}:null);else throw new Error("Failed to update")},[E,$]=i.useState(null),oe=t=>{$(t)},ce=t=>{if(!E)return;const s={instanceId:crypto.randomUUID(),procedureId:t.id,name:t.name,price:t.cost,type:t.type};j(r=>{const a=r[E]||[];return{...r,[E]:[...a,s]}}),I(r=>r.includes(E)?r:[...r,E]),$(null)},de=()=>{const t={},s=(a,c)=>{t[a]||(t[a]=[]);const m=`condition-${c}`;t[a].includes(m)||t[a].push(m)};return[...D].sort((a,c)=>new Date(a.date).getTime()-new Date(c.date).getTime()).forEach(a=>{a.teeth&&Array.isArray(a.teeth)&&a.teeth.forEach(c=>{c.procedures&&c.procedures.length>0&&c.procedures.forEach(m=>{var Y;let P=(Y=a.selected_procedures)==null?void 0:Y.find(M=>M.id===m);P||(P=O.find(M=>M.id===m)),P&&P.type!=="general"&&s(c.toothNumber,P.type)})})}),Object.keys(n).forEach(a=>{const c=parseInt(a),m=n[c];m&&m.length>0&&m.forEach(P=>{P.type!=="general"&&s(c,P.type)})}),t},V=(t,s)=>{s?(j(r=>{const a={...r};return a[s]=(r[s]||[]).filter(c=>c.instanceId!==t),a[s].length===0&&delete a[s],a}),I(r=>r)):z(r=>r.filter(a=>a.instanceId!==t))},X=(t,s,r)=>{r?j(a=>({...a,[r]:(a[r]||[]).map(c=>c.instanceId===t?{...c,price:s}:c)})):z(a=>a.map(c=>c.instanceId===t?{...c,price:s}:c))},he=async()=>{if(l){U(!0);try{const s=[...k,...Object.values(n).flat()].map(m=>({id:m.procedureId,name:m.name,cost:m.price,type:m.type})),a=Object.keys(n).map(Number).map(m=>({toothNumber:m,procedures:(n[m]||[]).map(P=>P.procedureId),notes:""})),c=await T("/api/dental",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:l.id,teeth:a,selectedProcedures:s,notes:R})});if(c.ok){const m=await c.json();f(`/dashboard/dental-billing/${m.id}`)}else alert("Failed to save dental record.")}catch(t){console.error(t),alert("Error saving record.")}finally{U(!1)}}};return e.jsxs("div",{className:"dental-page-container",children:[e.jsxs("header",{className:"dental-header",children:[e.jsxs("div",{className:"dental-title-group",children:[e.jsx(me,{className:"dental-title-icon"}),e.jsxs("div",{children:[e.jsx("h1",{className:"dental-title",children:"Dental Procedure"}),e.jsx("p",{className:"dental-subtitle",children:"Create new dental records and bills"})]})]}),e.jsx("button",{onClick:()=>f(-1),className:"dental-back-btn",children:"Back"})]}),l?e.jsxs("div",{className:"dental-workspace",children:[e.jsxs("div",{className:"patient-header-card",children:[e.jsxs("div",{className:"patient-info-group",children:[e.jsx("div",{className:"patient-avatar",children:l.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"patient-details",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("h3",{children:l.name}),e.jsx("button",{onClick:()=>o(!0),className:"icon-button text-gray-500 hover:text-blue-600",style:{padding:0,border:"none",background:"transparent",cursor:"pointer"},children:e.jsx(Q,{size:14})})]}),e.jsxs("p",{children:[l.gender," / ",l.age," yrs • ",l.phone]})]})]}),e.jsx("button",{onClick:le,className:"close-patient-btn",title:"Change Patient",children:e.jsx(F,{size:20})})]}),e.jsxs("div",{className:"dental-grid",children:[e.jsxs("div",{className:"chart-section",children:[e.jsx("div",{className:"dental-card chart-card-scroll",children:e.jsx(ve,{selectedTeeth:b,toothConditions:de(),onToothClick:oe})}),e.jsxs("div",{className:"dental-card notes-container",children:[e.jsx("h4",{className:"section-title-sm",children:"Clinical Notes"}),e.jsx("textarea",{className:"notes-area",placeholder:"Enter clinical findings...",value:R,onChange:t=>B(t.target.value)})]})]}),e.jsx("div",{className:"dental-card procedures-section",children:e.jsxs("div",{className:"treatment-plan-container",style:{borderTop:"none"},children:[e.jsxs("div",{className:"sidebar-tabs",children:[e.jsx("button",{onClick:()=>W("plan"),className:A==="plan"?"active":"",children:"Treatment Plan"}),e.jsx("button",{onClick:()=>W("history"),className:A==="history"?"active":"",children:"Visit History"})]}),e.jsx("div",{className:"treatment-plan-list custom-scrollbar",children:A==="plan"?e.jsx(e.Fragment,{children:k.length===0&&Object.keys(n).length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"Select a tooth to add procedures."}):e.jsxs(e.Fragment,{children:[k.length>0&&e.jsxs("div",{className:"plan-group",children:[e.jsx("h4",{children:"General"}),k.map(t=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:t.name,children:t.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:t.price,onChange:s=>X(t.instanceId,parseFloat(s.target.value)||0),className:"cost-input"}),e.jsx("button",{onClick:()=>V(t.instanceId),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(F,{size:14})})]})]},t.instanceId))]}),Object.entries(n).map(([t,s])=>s.length===0?null:e.jsxs("div",{className:"plan-group",children:[e.jsxs("h4",{children:["Tooth ",t]}),s.map(r=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:r.name,children:r.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:r.price,onChange:a=>X(r.instanceId,parseFloat(a.target.value)||0,parseInt(t)),className:"cost-input"}),e.jsx("button",{onClick:()=>V(r.instanceId,parseInt(t)),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(F,{size:14})})]})]},r.instanceId))]},t))]})}):e.jsx("div",{className:"history-list",children:D.length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"No past visits found."}):D.map(t=>e.jsxs("div",{className:"history-record-card",children:[e.jsxs("div",{className:"history-record-header",children:[e.jsx("span",{className:"record-date",children:new Date(t.date).toLocaleDateString()}),e.jsx("span",{className:"record-status",children:t.status})]}),e.jsxs("div",{className:"history-record-body",children:[t.teeth.map(s=>e.jsxs("div",{className:"history-tooth-group",children:[e.jsxs("strong",{children:["Tooth ",s.toothNumber,":"]})," ",s.procedures.map(r=>{const a=t.selected_procedures.find(c=>c.id===r)||O.find(c=>c.id===r);return a?a.name:r}).join(", ")]},s.toothNumber)),t.notes&&e.jsx("p",{className:"history-notes",children:e.jsxs("em",{children:["Notes: ",t.notes]})})]})]},t.id))})}),e.jsx("div",{className:"action-footer",children:e.jsx("button",{onClick:he,className:"save-btn",disabled:L||k.length===0&&Object.keys(n).length===0,children:L?"Saving...":"Save & Bill"})})]})})]})]}):e.jsxs("div",{className:"patient-search-container",children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:700,marginBottom:"24px",color:"var(--dp-text)"},children:"Who is this for?"}),e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(te,{className:"search-icon-overlay",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name or phone...",className:"dental-search-input",value:x,onChange:ae,autoFocus:!0}),N&&e.jsx("div",{className:"search-spinner"})]}),u.length>0&&e.jsx("div",{className:"search-results-dropdown",children:u.map(t=>e.jsxs("div",{onClick:()=>_(t),className:"search-result-item",children:[e.jsxs("div",{children:[e.jsx("span",{className:"patient-name-highlight",children:t.name}),e.jsxs("div",{className:"patient-meta",children:[t.age," yrs / ",t.gender," • ",t.phone]})]}),e.jsx(ge,{size:18,color:"var(--dp-text-sec)"})]},t.id))}),x.length>=2&&!N&&u.length===0&&e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsxs("p",{style:{color:"var(--dp-text-sec)",marginBottom:"15px"},children:['No patients found matching "',x,'".']}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"15px"},children:(h||S)&&e.jsxs("button",{type:"button",onClick:()=>re(h?"phone":"name"),className:"register-new-btn",style:{backgroundColor:"var(--dp-card-bg)",border:"1px solid var(--dp-primary)",padding:"8px 16px",borderRadius:"8px"},children:['Create "',x,'"']})})]}),e.jsx("div",{style:{marginTop:"32px"},children:e.jsx("button",{onClick:()=>q(!0),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Manage Procedures"})})]}),w&&l&&e.jsx(je,{patient:l,onClose:()=>o(!1),onSave:ie}),ne&&e.jsx(ye,{onClose:()=>q(!1),onUpdate:G}),E!==null&&e.jsx(fe,{toothNumber:E,procedures:O,onSelect:ce,onClose:()=>$(null)})]})};export{Te as default};
