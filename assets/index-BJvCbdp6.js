var AA=Object.defineProperty;var DA=(e,n,t)=>n in e?AA(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var ui=(e,n,t)=>DA(e,typeof n!="symbol"?n+"":n,t);function PA(e,n){for(var t=0;t<n.length;t++){const r=n[t];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const o=Object.getOwnPropertyDescriptor(r,a);o&&Object.defineProperty(e,a,o.get?o:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=t(a);fetch(a.href,o)}})();var ju=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ah(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Hv={exports:{}},Pm={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mN;function IA(){if(mN)return Pm;mN=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function t(r,a,o){var l=null;if(o!==void 0&&(l=""+o),a.key!==void 0&&(l=""+a.key),"key"in a){o={};for(var h in a)h!=="key"&&(o[h]=a[h])}else o=a;return a=o.ref,{$$typeof:e,type:r,key:l,ref:a!==void 0?a:null,props:o}}return Pm.Fragment=n,Pm.jsx=t,Pm.jsxs=t,Pm}var gN;function MA(){return gN||(gN=1,Hv.exports=IA()),Hv.exports}var i=MA(),Gv={exports:{}},un={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yN;function RA(){if(yN)return un;yN=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),g=Symbol.iterator;function b(A){return A===null||typeof A!="object"?null:(A=g&&A[g]||A["@@iterator"],typeof A=="function"?A:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,T={};function E(A,te,xe){this.props=A,this.context=te,this.refs=T,this.updater=xe||v}E.prototype.isReactComponent={},E.prototype.setState=function(A,te){if(typeof A!="object"&&typeof A!="function"&&A!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,A,te,"setState")},E.prototype.forceUpdate=function(A){this.updater.enqueueForceUpdate(this,A,"forceUpdate")};function C(){}C.prototype=E.prototype;function P(A,te,xe){this.props=A,this.context=te,this.refs=T,this.updater=xe||v}var I=P.prototype=new C;I.constructor=P,S(I,E.prototype),I.isPureReactComponent=!0;var q=Array.isArray,L={H:null,A:null,T:null,S:null,V:null},O=Object.prototype.hasOwnProperty;function B(A,te,xe,M,Se,$e){return xe=$e.ref,{$$typeof:e,type:A,key:te,ref:xe!==void 0?xe:null,props:$e}}function $(A,te){return B(A.type,te,void 0,void 0,void 0,A.props)}function F(A){return typeof A=="object"&&A!==null&&A.$$typeof===e}function z(A){var te={"=":"=0",":":"=2"};return"$"+A.replace(/[=:]/g,function(xe){return te[xe]})}var U=/\/+/g;function V(A,te){return typeof A=="object"&&A!==null&&A.key!=null?z(""+A.key):te.toString(36)}function ee(){}function ie(A){switch(A.status){case"fulfilled":return A.value;case"rejected":throw A.reason;default:switch(typeof A.status=="string"?A.then(ee,ee):(A.status="pending",A.then(function(te){A.status==="pending"&&(A.status="fulfilled",A.value=te)},function(te){A.status==="pending"&&(A.status="rejected",A.reason=te)})),A.status){case"fulfilled":return A.value;case"rejected":throw A.reason}}throw A}function ae(A,te,xe,M,Se){var $e=typeof A;($e==="undefined"||$e==="boolean")&&(A=null);var he=!1;if(A===null)he=!0;else switch($e){case"bigint":case"string":case"number":he=!0;break;case"object":switch(A.$$typeof){case e:case n:he=!0;break;case f:return he=A._init,ae(he(A._payload),te,xe,M,Se)}}if(he)return Se=Se(A),he=M===""?"."+V(A,0):M,q(Se)?(xe="",he!=null&&(xe=he.replace(U,"$&/")+"/"),ae(Se,te,xe,"",function(de){return de})):Se!=null&&(F(Se)&&(Se=$(Se,xe+(Se.key==null||A&&A.key===Se.key?"":(""+Se.key).replace(U,"$&/")+"/")+he)),te.push(Se)),1;he=0;var ge=M===""?".":M+":";if(q(A))for(var me=0;me<A.length;me++)M=A[me],$e=ge+V(M,me),he+=ae(M,te,xe,$e,Se);else if(me=b(A),typeof me=="function")for(A=me.call(A),me=0;!(M=A.next()).done;)M=M.value,$e=ge+V(M,me++),he+=ae(M,te,xe,$e,Se);else if($e==="object"){if(typeof A.then=="function")return ae(ie(A),te,xe,M,Se);throw te=String(A),Error("Objects are not valid as a React child (found: "+(te==="[object Object]"?"object with keys {"+Object.keys(A).join(", ")+"}":te)+"). If you meant to render a collection of children, use an array instead.")}return he}function J(A,te,xe){if(A==null)return A;var M=[],Se=0;return ae(A,M,"","",function($e){return te.call(xe,$e,Se++)}),M}function K(A){if(A._status===-1){var te=A._result;te=te(),te.then(function(xe){(A._status===0||A._status===-1)&&(A._status=1,A._result=xe)},function(xe){(A._status===0||A._status===-1)&&(A._status=2,A._result=xe)}),A._status===-1&&(A._status=0,A._result=te)}if(A._status===1)return A._result.default;throw A._result}var W=typeof reportError=="function"?reportError:function(A){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var te=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof A=="object"&&A!==null&&typeof A.message=="string"?String(A.message):String(A),error:A});if(!window.dispatchEvent(te))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",A);return}console.error(A)};function re(){}return un.Children={map:J,forEach:function(A,te,xe){J(A,function(){te.apply(this,arguments)},xe)},count:function(A){var te=0;return J(A,function(){te++}),te},toArray:function(A){return J(A,function(te){return te})||[]},only:function(A){if(!F(A))throw Error("React.Children.only expected to receive a single React element child.");return A}},un.Component=E,un.Fragment=t,un.Profiler=a,un.PureComponent=P,un.StrictMode=r,un.Suspense=d,un.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=L,un.__COMPILER_RUNTIME={__proto__:null,c:function(A){return L.H.useMemoCache(A)}},un.cache=function(A){return function(){return A.apply(null,arguments)}},un.cloneElement=function(A,te,xe){if(A==null)throw Error("The argument must be a React element, but you passed "+A+".");var M=S({},A.props),Se=A.key,$e=void 0;if(te!=null)for(he in te.ref!==void 0&&($e=void 0),te.key!==void 0&&(Se=""+te.key),te)!O.call(te,he)||he==="key"||he==="__self"||he==="__source"||he==="ref"&&te.ref===void 0||(M[he]=te[he]);var he=arguments.length-2;if(he===1)M.children=xe;else if(1<he){for(var ge=Array(he),me=0;me<he;me++)ge[me]=arguments[me+2];M.children=ge}return B(A.type,Se,void 0,void 0,$e,M)},un.createContext=function(A){return A={$$typeof:l,_currentValue:A,_currentValue2:A,_threadCount:0,Provider:null,Consumer:null},A.Provider=A,A.Consumer={$$typeof:o,_context:A},A},un.createElement=function(A,te,xe){var M,Se={},$e=null;if(te!=null)for(M in te.key!==void 0&&($e=""+te.key),te)O.call(te,M)&&M!=="key"&&M!=="__self"&&M!=="__source"&&(Se[M]=te[M]);var he=arguments.length-2;if(he===1)Se.children=xe;else if(1<he){for(var ge=Array(he),me=0;me<he;me++)ge[me]=arguments[me+2];Se.children=ge}if(A&&A.defaultProps)for(M in he=A.defaultProps,he)Se[M]===void 0&&(Se[M]=he[M]);return B(A,$e,void 0,void 0,null,Se)},un.createRef=function(){return{current:null}},un.forwardRef=function(A){return{$$typeof:h,render:A}},un.isValidElement=F,un.lazy=function(A){return{$$typeof:f,_payload:{_status:-1,_result:A},_init:K}},un.memo=function(A,te){return{$$typeof:u,type:A,compare:te===void 0?null:te}},un.startTransition=function(A){var te=L.T,xe={};L.T=xe;try{var M=A(),Se=L.S;Se!==null&&Se(xe,M),typeof M=="object"&&M!==null&&typeof M.then=="function"&&M.then(re,W)}catch($e){W($e)}finally{L.T=te}},un.unstable_useCacheRefresh=function(){return L.H.useCacheRefresh()},un.use=function(A){return L.H.use(A)},un.useActionState=function(A,te,xe){return L.H.useActionState(A,te,xe)},un.useCallback=function(A,te){return L.H.useCallback(A,te)},un.useContext=function(A){return L.H.useContext(A)},un.useDebugValue=function(){},un.useDeferredValue=function(A,te){return L.H.useDeferredValue(A,te)},un.useEffect=function(A,te,xe){var M=L.H;if(typeof xe=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return M.useEffect(A,te)},un.useId=function(){return L.H.useId()},un.useImperativeHandle=function(A,te,xe){return L.H.useImperativeHandle(A,te,xe)},un.useInsertionEffect=function(A,te){return L.H.useInsertionEffect(A,te)},un.useLayoutEffect=function(A,te){return L.H.useLayoutEffect(A,te)},un.useMemo=function(A,te){return L.H.useMemo(A,te)},un.useOptimistic=function(A,te){return L.H.useOptimistic(A,te)},un.useReducer=function(A,te,xe){return L.H.useReducer(A,te,xe)},un.useRef=function(A){return L.H.useRef(A)},un.useState=function(A){return L.H.useState(A)},un.useSyncExternalStore=function(A,te,xe){return L.H.useSyncExternalStore(A,te,xe)},un.useTransition=function(){return L.H.useTransition()},un.version="19.1.0",un}var xN;function lw(){return xN||(xN=1,Gv.exports=RA()),Gv.exports}var w=lw();const Fn=ah(w),bN=PA({__proto__:null,default:Fn},[w]);var Yv={exports:{}},Im={},Wv={exports:{}},Qv={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vN;function OA(){return vN||(vN=1,function(e){function n(J,K){var W=J.length;J.push(K);e:for(;0<W;){var re=W-1>>>1,A=J[re];if(0<a(A,K))J[re]=K,J[W]=A,W=re;else break e}}function t(J){return J.length===0?null:J[0]}function r(J){if(J.length===0)return null;var K=J[0],W=J.pop();if(W!==K){J[0]=W;e:for(var re=0,A=J.length,te=A>>>1;re<te;){var xe=2*(re+1)-1,M=J[xe],Se=xe+1,$e=J[Se];if(0>a(M,W))Se<A&&0>a($e,M)?(J[re]=$e,J[Se]=W,re=Se):(J[re]=M,J[xe]=W,re=xe);else if(Se<A&&0>a($e,W))J[re]=$e,J[Se]=W,re=Se;else break e}}return K}function a(J,K){var W=J.sortIndex-K.sortIndex;return W!==0?W:J.id-K.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;e.unstable_now=function(){return o.now()}}else{var l=Date,h=l.now();e.unstable_now=function(){return l.now()-h}}var d=[],u=[],f=1,g=null,b=3,v=!1,S=!1,T=!1,E=!1,C=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function q(J){for(var K=t(u);K!==null;){if(K.callback===null)r(u);else if(K.startTime<=J)r(u),K.sortIndex=K.expirationTime,n(d,K);else break;K=t(u)}}function L(J){if(T=!1,q(J),!S)if(t(d)!==null)S=!0,O||(O=!0,V());else{var K=t(u);K!==null&&ae(L,K.startTime-J)}}var O=!1,B=-1,$=5,F=-1;function z(){return E?!0:!(e.unstable_now()-F<$)}function U(){if(E=!1,O){var J=e.unstable_now();F=J;var K=!0;try{e:{S=!1,T&&(T=!1,P(B),B=-1),v=!0;var W=b;try{t:{for(q(J),g=t(d);g!==null&&!(g.expirationTime>J&&z());){var re=g.callback;if(typeof re=="function"){g.callback=null,b=g.priorityLevel;var A=re(g.expirationTime<=J);if(J=e.unstable_now(),typeof A=="function"){g.callback=A,q(J),K=!0;break t}g===t(d)&&r(d),q(J)}else r(d);g=t(d)}if(g!==null)K=!0;else{var te=t(u);te!==null&&ae(L,te.startTime-J),K=!1}}break e}finally{g=null,b=W,v=!1}K=void 0}}finally{K?V():O=!1}}}var V;if(typeof I=="function")V=function(){I(U)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,ie=ee.port2;ee.port1.onmessage=U,V=function(){ie.postMessage(null)}}else V=function(){C(U,0)};function ae(J,K){B=C(function(){J(e.unstable_now())},K)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(J){J.callback=null},e.unstable_forceFrameRate=function(J){0>J||125<J?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<J?Math.floor(1e3/J):5},e.unstable_getCurrentPriorityLevel=function(){return b},e.unstable_next=function(J){switch(b){case 1:case 2:case 3:var K=3;break;default:K=b}var W=b;b=K;try{return J()}finally{b=W}},e.unstable_requestPaint=function(){E=!0},e.unstable_runWithPriority=function(J,K){switch(J){case 1:case 2:case 3:case 4:case 5:break;default:J=3}var W=b;b=J;try{return K()}finally{b=W}},e.unstable_scheduleCallback=function(J,K,W){var re=e.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?re+W:re):W=re,J){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=W+A,J={id:f++,callback:K,priorityLevel:J,startTime:W,expirationTime:A,sortIndex:-1},W>re?(J.sortIndex=W,n(u,J),t(d)===null&&J===t(u)&&(T?(P(B),B=-1):T=!0,ae(L,W-re))):(J.sortIndex=A,n(d,J),S||v||(S=!0,O||(O=!0,V()))),J},e.unstable_shouldYield=z,e.unstable_wrapCallback=function(J){var K=b;return function(){var W=b;b=K;try{return J.apply(this,arguments)}finally{b=W}}}}(Qv)),Qv}var wN;function LA(){return wN||(wN=1,Wv.exports=OA()),Wv.exports}var Jv={exports:{}},Xr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NN;function FA(){if(NN)return Xr;NN=1;var e=lw();function n(d){var u="https://react.dev/errors/"+d;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)u+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+d+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(n(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function o(d,u,f){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:g==null?null:""+g,children:d,containerInfo:u,implementation:f}}var l=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(d,u){if(d==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Xr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Xr.createPortal=function(d,u){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(n(299));return o(d,u,null,f)},Xr.flushSync=function(d){var u=l.T,f=r.p;try{if(l.T=null,r.p=2,d)return d()}finally{l.T=u,r.p=f,r.d.f()}},Xr.preconnect=function(d,u){typeof d=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,r.d.C(d,u))},Xr.prefetchDNS=function(d){typeof d=="string"&&r.d.D(d)},Xr.preinit=function(d,u){if(typeof d=="string"&&u&&typeof u.as=="string"){var f=u.as,g=h(f,u.crossOrigin),b=typeof u.integrity=="string"?u.integrity:void 0,v=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;f==="style"?r.d.S(d,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:g,integrity:b,fetchPriority:v}):f==="script"&&r.d.X(d,{crossOrigin:g,integrity:b,fetchPriority:v,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Xr.preinitModule=function(d,u){if(typeof d=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var f=h(u.as,u.crossOrigin);r.d.M(d,{crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&r.d.M(d)},Xr.preload=function(d,u){if(typeof d=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var f=u.as,g=h(f,u.crossOrigin);r.d.L(d,f,{crossOrigin:g,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Xr.preloadModule=function(d,u){if(typeof d=="string")if(u){var f=h(u.as,u.crossOrigin);r.d.m(d,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:f,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else r.d.m(d)},Xr.requestFormReset=function(d){r.d.r(d)},Xr.unstable_batchedUpdates=function(d,u){return d(u)},Xr.useFormState=function(d,u,f){return l.H.useFormState(d,u,f)},Xr.useFormStatus=function(){return l.H.useHostTransitionStatus()},Xr.version="19.1.0",Xr}var SN;function CC(){if(SN)return Jv.exports;SN=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Jv.exports=FA(),Jv.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jN;function $A(){if(jN)return Im;jN=1;var e=LA(),n=lw(),t=CC();function r(s){var c="https://react.dev/errors/"+s;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)c+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+s+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function o(s){var c=s,p=s;if(s.alternate)for(;c.return;)c=c.return;else{s=c;do c=s,(c.flags&4098)!==0&&(p=c.return),s=c.return;while(s)}return c.tag===3?p:null}function l(s){if(s.tag===13){var c=s.memoizedState;if(c===null&&(s=s.alternate,s!==null&&(c=s.memoizedState)),c!==null)return c.dehydrated}return null}function h(s){if(o(s)!==s)throw Error(r(188))}function d(s){var c=s.alternate;if(!c){if(c=o(s),c===null)throw Error(r(188));return c!==s?null:s}for(var p=s,x=c;;){var N=p.return;if(N===null)break;var D=N.alternate;if(D===null){if(x=N.return,x!==null){p=x;continue}break}if(N.child===D.child){for(D=N.child;D;){if(D===p)return h(N),s;if(D===x)return h(N),c;D=D.sibling}throw Error(r(188))}if(p.return!==x.return)p=N,x=D;else{for(var H=!1,Z=N.child;Z;){if(Z===p){H=!0,p=N,x=D;break}if(Z===x){H=!0,x=N,p=D;break}Z=Z.sibling}if(!H){for(Z=D.child;Z;){if(Z===p){H=!0,p=D,x=N;break}if(Z===x){H=!0,x=D,p=N;break}Z=Z.sibling}if(!H)throw Error(r(189))}}if(p.alternate!==x)throw Error(r(190))}if(p.tag!==3)throw Error(r(188));return p.stateNode.current===p?s:c}function u(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s;for(s=s.child;s!==null;){if(c=u(s),c!==null)return c;s=s.sibling}return null}var f=Object.assign,g=Symbol.for("react.element"),b=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),P=Symbol.for("react.consumer"),I=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),L=Symbol.for("react.suspense"),O=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),F=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),U=Symbol.iterator;function V(s){return s===null||typeof s!="object"?null:(s=U&&s[U]||s["@@iterator"],typeof s=="function"?s:null)}var ee=Symbol.for("react.client.reference");function ie(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===ee?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case S:return"Fragment";case E:return"Profiler";case T:return"StrictMode";case L:return"Suspense";case O:return"SuspenseList";case F:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case v:return"Portal";case I:return(s.displayName||"Context")+".Provider";case P:return(s._context.displayName||"Context")+".Consumer";case q:var c=s.render;return s=s.displayName,s||(s=c.displayName||c.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case B:return c=s.displayName||null,c!==null?c:ie(s.type)||"Memo";case $:c=s._payload,s=s._init;try{return ie(s(c))}catch{}}return null}var ae=Array.isArray,J=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},re=[],A=-1;function te(s){return{current:s}}function xe(s){0>A||(s.current=re[A],re[A]=null,A--)}function M(s,c){A++,re[A]=s.current,s.current=c}var Se=te(null),$e=te(null),he=te(null),ge=te(null);function me(s,c){switch(M(he,c),M($e,s),M(Se,null),c.nodeType){case 9:case 11:s=(s=c.documentElement)&&(s=s.namespaceURI)?xi(s):0;break;default:if(s=c.tagName,c=c.namespaceURI)c=xi(c),s=ji(c,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}xe(Se),M(Se,s)}function de(){xe(Se),xe($e),xe(he)}function Le(s){s.memoizedState!==null&&M(ge,s);var c=Se.current,p=ji(c,s.type);c!==p&&(M($e,s),M(Se,p))}function He(s){$e.current===s&&(xe(Se),xe($e)),ge.current===s&&(xe(ge),yu._currentValue=W)}var pe=Object.prototype.hasOwnProperty,ne=e.unstable_scheduleCallback,Pe=e.unstable_cancelCallback,Ye=e.unstable_shouldYield,rt=e.unstable_requestPaint,ut=e.unstable_now,je=e.unstable_getCurrentPriorityLevel,Qe=e.unstable_ImmediatePriority,ze=e.unstable_UserBlockingPriority,dt=e.unstable_NormalPriority,Ze=e.unstable_LowPriority,ct=e.unstable_IdlePriority,ft=e.log,fe=e.unstable_setDisableYieldValue,Q=null,ue=null;function De(s){if(typeof ft=="function"&&fe(s),ue&&typeof ue.setStrictMode=="function")try{ue.setStrictMode(Q,s)}catch{}}var Ge=Math.clz32?Math.clz32:Me,ye=Math.log,Ne=Math.LN2;function Me(s){return s>>>=0,s===0?32:31-(ye(s)/Ne|0)|0}var Fe=256,ve=4194304;function ke(s){var c=s&42;if(c!==0)return c;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ee(s,c,p){var x=s.pendingLanes;if(x===0)return 0;var N=0,D=s.suspendedLanes,H=s.pingedLanes;s=s.warmLanes;var Z=x&134217727;return Z!==0?(x=Z&~D,x!==0?N=ke(x):(H&=Z,H!==0?N=ke(H):p||(p=Z&~s,p!==0&&(N=ke(p))))):(Z=x&~D,Z!==0?N=ke(Z):H!==0?N=ke(H):p||(p=x&~s,p!==0&&(N=ke(p)))),N===0?0:c!==0&&c!==N&&(c&D)===0&&(D=N&-N,p=c&-c,D>=p||D===32&&(p&4194048)!==0)?c:N}function Ve(s,c){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&c)===0}function Ke(s,c){switch(s){case 1:case 2:case 4:case 8:case 64:return c+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vt(){var s=Fe;return Fe<<=1,(Fe&4194048)===0&&(Fe=256),s}function wt(){var s=ve;return ve<<=1,(ve&62914560)===0&&(ve=4194304),s}function nt(s){for(var c=[],p=0;31>p;p++)c.push(s);return c}function bt(s,c){s.pendingLanes|=c,c!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Mt(s,c,p,x,N,D){var H=s.pendingLanes;s.pendingLanes=p,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=p,s.entangledLanes&=p,s.errorRecoveryDisabledLanes&=p,s.shellSuspendCounter=0;var Z=s.entanglements,we=s.expirationTimes,Ue=s.hiddenUpdates;for(p=H&~p;0<p;){var et=31-Ge(p),ot=1<<et;Z[et]=0,we[et]=-1;var We=Ue[et];if(We!==null)for(Ue[et]=null,et=0;et<We.length;et++){var qe=We[et];qe!==null&&(qe.lane&=-536870913)}p&=~ot}x!==0&&tt(s,x,0),D!==0&&N===0&&s.tag!==0&&(s.suspendedLanes|=D&~(H&~c))}function tt(s,c,p){s.pendingLanes|=c,s.suspendedLanes&=~c;var x=31-Ge(c);s.entangledLanes|=c,s.entanglements[x]=s.entanglements[x]|1073741824|p&4194090}function Nt(s,c){var p=s.entangledLanes|=c;for(s=s.entanglements;p;){var x=31-Ge(p),N=1<<x;N&c|s[x]&c&&(s[x]|=c),p&=~N}}function Lt(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function pn(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Kt(){var s=K.p;return s!==0?s:(s=window.event,s===void 0?32:px(s.type))}function ln(s,c){var p=K.p;try{return K.p=s,c()}finally{K.p=p}}var Dt=Math.random().toString(36).slice(2),mn="__reactFiber$"+Dt,Dn="__reactProps$"+Dt,ii="__reactContainer$"+Dt,Ie="__reactEvents$"+Dt,pt="__reactListeners$"+Dt,mt="__reactHandles$"+Dt,rn="__reactResources$"+Dt,Xt="__reactMarker$"+Dt;function Zn(s){delete s[mn],delete s[Dn],delete s[Ie],delete s[pt],delete s[mt]}function Bi(s){var c=s[mn];if(c)return c;for(var p=s.parentNode;p;){if(c=p[ii]||p[mn]){if(p=c.alternate,c.child!==null||p!==null&&p.child!==null)for(s=nx(s);s!==null;){if(p=s[mn])return p;s=nx(s)}return c}s=p,p=s.parentNode}return null}function Qi(s){if(s=s[mn]||s[ii]){var c=s.tag;if(c===5||c===6||c===13||c===26||c===27||c===3)return s}return null}function Mi(s){var c=s.tag;if(c===5||c===26||c===27||c===6)return s.stateNode;throw Error(r(33))}function hr(s){var c=s[rn];return c||(c=s[rn]={hoistableStyles:new Map,hoistableScripts:new Map}),c}function Mn(s){s[Xt]=!0}var Li=new Set,fr={};function aa(s,c){fi(s,c),fi(s+"Capture",c)}function fi(s,c){for(fr[s]=c,s=0;s<c.length;s++)Li.add(c[s])}var Pn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pr={},sr={};function Ol(s){return pe.call(sr,s)?!0:pe.call(pr,s)?!1:Pn.test(s)?sr[s]=!0:(pr[s]=!0,!1)}function or(s,c,p){if(Ol(c))if(p===null)s.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":s.removeAttribute(c);return;case"boolean":var x=c.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){s.removeAttribute(c);return}}s.setAttribute(c,""+p)}}function Fa(s,c,p){if(p===null)s.removeAttribute(c);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(c);return}s.setAttribute(c,""+p)}}function Sr(s,c,p,x){if(x===null)s.removeAttribute(p);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(p);return}s.setAttributeNS(c,p,""+x)}}var Gs,Ys;function $a(s){if(Gs===void 0)try{throw Error()}catch(p){var c=p.stack.trim().match(/\n( *(at )?)/);Gs=c&&c[1]||"",Ys=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Gs+s+Ys}var Ws=!1;function Iu(s,c){if(!s||Ws)return"";Ws=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(c){var ot=function(){throw Error()};if(Object.defineProperty(ot.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ot,[])}catch(qe){var We=qe}Reflect.construct(s,[],ot)}else{try{ot.call()}catch(qe){We=qe}s.call(ot.prototype)}}else{try{throw Error()}catch(qe){We=qe}(ot=s())&&typeof ot.catch=="function"&&ot.catch(function(){})}}catch(qe){if(qe&&We&&typeof qe.stack=="string")return[qe.stack,We.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var D=x.DetermineComponentFrameRoot(),H=D[0],Z=D[1];if(H&&Z){var we=H.split(`
`),Ue=Z.split(`
`);for(N=x=0;x<we.length&&!we[x].includes("DetermineComponentFrameRoot");)x++;for(;N<Ue.length&&!Ue[N].includes("DetermineComponentFrameRoot");)N++;if(x===we.length||N===Ue.length)for(x=we.length-1,N=Ue.length-1;1<=x&&0<=N&&we[x]!==Ue[N];)N--;for(;1<=x&&0<=N;x--,N--)if(we[x]!==Ue[N]){if(x!==1||N!==1)do if(x--,N--,0>N||we[x]!==Ue[N]){var et=`
`+we[x].replace(" at new "," at ");return s.displayName&&et.includes("<anonymous>")&&(et=et.replace("<anonymous>",s.displayName)),et}while(1<=x&&0<=N);break}}}finally{Ws=!1,Error.prepareStackTrace=p}return(p=s?s.displayName||s.name:"")?$a(p):""}function ch(s){switch(s.tag){case 26:case 27:case 5:return $a(s.type);case 16:return $a("Lazy");case 13:return $a("Suspense");case 19:return $a("SuspenseList");case 0:case 15:return Iu(s.type,!1);case 11:return Iu(s.type.render,!1);case 1:return Iu(s.type,!0);case 31:return $a("Activity");default:return""}}function _c(s){try{var c="";do c+=ch(s),s=s.return;while(s);return c}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function jr(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Qs(s){var c=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(c==="checkbox"||c==="radio")}function Cc(s){var c=Qs(s)?"checked":"value",p=Object.getOwnPropertyDescriptor(s.constructor.prototype,c),x=""+s[c];if(!s.hasOwnProperty(c)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var N=p.get,D=p.set;return Object.defineProperty(s,c,{configurable:!0,get:function(){return N.call(this)},set:function(H){x=""+H,D.call(this,H)}}),Object.defineProperty(s,c,{enumerable:p.enumerable}),{getValue:function(){return x},setValue:function(H){x=""+H},stopTracking:function(){s._valueTracker=null,delete s[c]}}}}function Js(s){s._valueTracker||(s._valueTracker=Cc(s))}function kc(s){if(!s)return!1;var c=s._valueTracker;if(!c)return!0;var p=c.getValue(),x="";return s&&(x=Qs(s)?s.checked?"true":"false":s.value),s=x,s!==p?(c.setValue(s),!0):!1}function ya(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Mu=/[\n"\\]/g;function lr(s){return s.replace(Mu,function(c){return"\\"+c.charCodeAt(0).toString(16)+" "})}function Ll(s,c,p,x,N,D,H,Z){s.name="",H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?s.type=H:s.removeAttribute("type"),c!=null?H==="number"?(c===0&&s.value===""||s.value!=c)&&(s.value=""+jr(c)):s.value!==""+jr(c)&&(s.value=""+jr(c)):H!=="submit"&&H!=="reset"||s.removeAttribute("value"),c!=null?$o(s,H,jr(c)):p!=null?$o(s,H,jr(p)):x!=null&&s.removeAttribute("value"),N==null&&D!=null&&(s.defaultChecked=!!D),N!=null&&(s.checked=N&&typeof N!="function"&&typeof N!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?s.name=""+jr(Z):s.removeAttribute("name")}function Fo(s,c,p,x,N,D,H,Z){if(D!=null&&typeof D!="function"&&typeof D!="symbol"&&typeof D!="boolean"&&(s.type=D),c!=null||p!=null){if(!(D!=="submit"&&D!=="reset"||c!=null))return;p=p!=null?""+jr(p):"",c=c!=null?""+jr(c):p,Z||c===s.value||(s.value=c),s.defaultValue=c}x=x??N,x=typeof x!="function"&&typeof x!="symbol"&&!!x,s.checked=Z?s.checked:!!x,s.defaultChecked=!!x,H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"&&(s.name=H)}function $o(s,c,p){c==="number"&&ya(s.ownerDocument)===s||s.defaultValue===""+p||(s.defaultValue=""+p)}function za(s,c,p,x){if(s=s.options,c){c={};for(var N=0;N<p.length;N++)c["$"+p[N]]=!0;for(p=0;p<s.length;p++)N=c.hasOwnProperty("$"+s[p].value),s[p].selected!==N&&(s[p].selected=N),N&&x&&(s[p].defaultSelected=!0)}else{for(p=""+jr(p),c=null,N=0;N<s.length;N++){if(s[N].value===p){s[N].selected=!0,x&&(s[N].defaultSelected=!0);return}c!==null||s[N].disabled||(c=s[N])}c!==null&&(c.selected=!0)}}function zo(s,c,p){if(c!=null&&(c=""+jr(c),c!==s.value&&(s.value=c),p==null)){s.defaultValue!==c&&(s.defaultValue=c);return}s.defaultValue=p!=null?""+jr(p):""}function Ks(s,c,p,x){if(c==null){if(x!=null){if(p!=null)throw Error(r(92));if(ae(x)){if(1<x.length)throw Error(r(93));x=x[0]}p=x}p==null&&(p=""),c=p}p=jr(c),s.defaultValue=p,x=s.textContent,x===p&&x!==""&&x!==null&&(s.value=x)}function ms(s,c){if(c){var p=s.firstChild;if(p&&p===s.lastChild&&p.nodeType===3){p.nodeValue=c;return}}s.textContent=c}var Ba=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Fl(s,c,p){var x=c.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?x?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="":x?s.setProperty(c,p):typeof p!="number"||p===0||Ba.has(c)?c==="float"?s.cssFloat=p:s[c]=(""+p).trim():s[c]=p+"px"}function $l(s,c,p){if(c!=null&&typeof c!="object")throw Error(r(62));if(s=s.style,p!=null){for(var x in p)!p.hasOwnProperty(x)||c!=null&&c.hasOwnProperty(x)||(x.indexOf("--")===0?s.setProperty(x,""):x==="float"?s.cssFloat="":s[x]="");for(var N in c)x=c[N],c.hasOwnProperty(N)&&p[N]!==x&&Fl(s,N,x)}else for(var D in c)c.hasOwnProperty(D)&&Fl(s,D,c[D])}function gs(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var zl=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Tc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xs(s){return Tc.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Bo=null;function Bl(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var mr=null,ys=null;function Ec(s){var c=Qi(s);if(c&&(s=c.stateNode)){var p=s[Dn]||null;e:switch(s=c.stateNode,c.type){case"input":if(Ll(s,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),c=p.name,p.type==="radio"&&c!=null){for(p=s;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+lr(""+c)+'"][type="radio"]'),c=0;c<p.length;c++){var x=p[c];if(x!==s&&x.form===s.form){var N=x[Dn]||null;if(!N)throw Error(r(90));Ll(x,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(c=0;c<p.length;c++)x=p[c],x.form===s.form&&kc(x)}break e;case"textarea":zo(s,p.value,p.defaultValue);break e;case"select":c=p.value,c!=null&&za(s,!!p.multiple,c,!1)}}}var Ua=!1;function Ru(s,c,p){if(Ua)return s(c,p);Ua=!0;try{var x=s(c);return x}finally{if(Ua=!1,(mr!==null||ys!==null)&&(af(),mr&&(c=mr,s=ys,ys=mr=null,Ec(c),s)))for(c=0;c<s.length;c++)Ec(s[c])}}function Zs(s,c){var p=s.stateNode;if(p===null)return null;var x=p[Dn]||null;if(x===null)return null;p=x[c];e:switch(c){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(s=s.type,x=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!x;break e;default:s=!1}if(s)return null;if(p&&typeof p!="function")throw Error(r(231,c,typeof p));return p}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Uo=!1;if(xa)try{var qo={};Object.defineProperty(qo,"passive",{get:function(){Uo=!0}}),window.addEventListener("test",qo,qo),window.removeEventListener("test",qo,qo)}catch{Uo=!1}var qa=null,Ac=null,Ul=null;function Ou(){if(Ul)return Ul;var s,c=Ac,p=c.length,x,N="value"in qa?qa.value:qa.textContent,D=N.length;for(s=0;s<p&&c[s]===N[s];s++);var H=p-s;for(x=1;x<=H&&c[p-x]===N[D-x];x++);return Ul=N.slice(s,1<x?1-x:void 0)}function Bn(s){var c=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&c===13&&(s=13)):s=c,s===10&&(s=13),32<=s||s===13?s:0}function $n(){return!0}function Lu(){return!1}function cr(s){function c(p,x,N,D,H){this._reactName=p,this._targetInst=N,this.type=x,this.nativeEvent=D,this.target=H,this.currentTarget=null;for(var Z in s)s.hasOwnProperty(Z)&&(p=s[Z],this[Z]=p?p(D):D[Z]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?$n:Lu,this.isPropagationStopped=Lu,this}return f(c.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=$n)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=$n)},persist:function(){},isPersistent:$n}),c}var xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ql=cr(xs),Vo=f({},xs,{view:0,detail:0}),uh=cr(Vo),eo,to,Ni,Va=f({},Vo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ba,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ni&&(Ni&&s.type==="mousemove"?(eo=s.screenX-Ni.screenX,to=s.screenY-Ni.screenY):to=eo=0,Ni=s),eo)},movementY:function(s){return"movementY"in s?s.movementY:to}}),Ha=cr(Va),Dc=f({},Va,{dataTransfer:0}),Vl=cr(Dc),_r=f({},Vo,{relatedTarget:0}),no=cr(_r),dh=f({},xs,{animationName:0,elapsedTime:0,pseudoElement:0}),Pc=cr(dh),Ic=f({},xs,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Fu=cr(Ic),Un=f({},xs,{data:0}),Ji=cr(Un),Mc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hl={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ho(s){var c=this.nativeEvent;return c.getModifierState?c.getModifierState(s):(s=Hl[s])?!!c[s]:!1}function ba(){return Ho}var Gl=f({},Vo,{key:function(s){if(s.key){var c=Mc[s.key]||s.key;if(c!=="Unidentified")return c}return s.type==="keypress"?(s=Bn(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?gr[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ba,charCode:function(s){return s.type==="keypress"?Bn(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Bn(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),bs=cr(Gl),ri=f({},Va,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sa=cr(ri),Go=f({},Vo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ba}),Yo=cr(Go),Rc=f({},xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),vs=cr(Rc),Oc=f({},Va,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),gp=cr(Oc),hh=f({},xs,{newState:0,oldState:0}),ws=cr(hh),io=[9,13,27,32],Ns=xa&&"CompositionEvent"in window,Ga=null;xa&&"documentMode"in document&&(Ga=document.documentMode);var Lc=xa&&"TextEvent"in window&&!Ga,Wo=xa&&(!Ns||Ga&&8<Ga&&11>=Ga),ro=" ",Qo=!1;function $u(s,c){switch(s){case"keyup":return io.indexOf(c.keyCode)!==-1;case"keydown":return c.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function va(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Ss=!1;function fh(s,c){switch(s){case"compositionend":return va(c);case"keypress":return c.which!==32?null:(Qo=!0,ro);case"textInput":return s=c.data,s===ro&&Qo?null:s;default:return null}}function ao(s,c){if(Ss)return s==="compositionend"||!Ns&&$u(s,c)?(s=Ou(),Ul=Ac=qa=null,Ss=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(c.ctrlKey||c.altKey||c.metaKey)||c.ctrlKey&&c.altKey){if(c.char&&1<c.char.length)return c.char;if(c.which)return String.fromCharCode(c.which)}return null;case"compositionend":return Wo&&c.locale!=="ko"?null:c.data;default:return null}}var Ri={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function js(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c==="input"?!!Ri[s.type]:c==="textarea"}function _s(s,c,p,x){mr?ys?ys.push(x):ys=[x]:mr=x,c=hf(c,"onChange"),0<c.length&&(p=new ql("onChange","change",null,p,x),s.push({event:p,listeners:c}))}var so=null,Ya=null;function ph(s){Wy(s,0)}function Fc(s){var c=Mi(s);if(kc(c))return s}function mh(s,c){if(s==="change")return c}var gh=!1;if(xa){var zu;if(xa){var Cs="oninput"in document;if(!Cs){var yh=document.createElement("div");yh.setAttribute("oninput","return;"),Cs=typeof yh.oninput=="function"}zu=Cs}else zu=!1;gh=zu&&(!document.documentMode||9<document.documentMode)}function xh(){so&&(so.detachEvent("onpropertychange",$c),Ya=so=null)}function $c(s){if(s.propertyName==="value"&&Fc(Ya)){var c=[];_s(c,Ya,s,Bl(s)),Ru(ph,c)}}function bh(s,c,p){s==="focusin"?(xh(),so=c,Ya=p,so.attachEvent("onpropertychange",$c)):s==="focusout"&&xh()}function ks(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Fc(Ya)}function Jo(s,c){if(s==="click")return Fc(c)}function Bu(s,c){if(s==="input"||s==="change")return Fc(c)}function vh(s,c){return s===c&&(s!==0||1/s===1/c)||s!==s&&c!==c}var Cr=typeof Object.is=="function"?Object.is:vh;function kr(s,c){if(Cr(s,c))return!0;if(typeof s!="object"||s===null||typeof c!="object"||c===null)return!1;var p=Object.keys(s),x=Object.keys(c);if(p.length!==x.length)return!1;for(x=0;x<p.length;x++){var N=p[x];if(!pe.call(c,N)||!Cr(s[N],c[N]))return!1}return!0}function zr(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Uu(s,c){var p=zr(s);s=0;for(var x;p;){if(p.nodeType===3){if(x=s+p.textContent.length,s<=c&&x>=c)return{node:p,offset:c-s};s=x}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=zr(p)}}function wh(s,c){return s&&c?s===c?!0:s&&s.nodeType===3?!1:c&&c.nodeType===3?wh(s,c.parentNode):"contains"in s?s.contains(c):s.compareDocumentPosition?!!(s.compareDocumentPosition(c)&16):!1:!1}function Nh(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var c=ya(s.document);c instanceof s.HTMLIFrameElement;){try{var p=typeof c.contentWindow.location.href=="string"}catch{p=!1}if(p)s=c.contentWindow;else break;c=ya(s.document)}return c}function qu(s){var c=s&&s.nodeName&&s.nodeName.toLowerCase();return c&&(c==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||c==="textarea"||s.contentEditable==="true")}var Ts=xa&&"documentMode"in document&&11>=document.documentMode,Tr=null,Ki=null,Ae=null,Xe=!1;function Je(s,c,p){var x=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Xe||Tr==null||Tr!==ya(x)||(x=Tr,"selectionStart"in x&&qu(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Ae&&kr(Ae,x)||(Ae=x,x=hf(Ki,"onSelect"),0<x.length&&(c=new ql("onSelect","select",null,c,p),s.push({event:c,listeners:x}),c.target=Tr)))}function _t(s,c){var p={};return p[s.toLowerCase()]=c.toLowerCase(),p["Webkit"+s]="webkit"+c,p["Moz"+s]="moz"+c,p}var zt={animationend:_t("Animation","AnimationEnd"),animationiteration:_t("Animation","AnimationIteration"),animationstart:_t("Animation","AnimationStart"),transitionrun:_t("Transition","TransitionRun"),transitionstart:_t("Transition","TransitionStart"),transitioncancel:_t("Transition","TransitionCancel"),transitionend:_t("Transition","TransitionEnd")},wn={},Si={};xa&&(Si=document.createElement("div").style,"AnimationEvent"in window||(delete zt.animationend.animation,delete zt.animationiteration.animation,delete zt.animationstart.animation),"TransitionEvent"in window||delete zt.transitionend.transition);function jn(s){if(wn[s])return wn[s];if(!zt[s])return s;var c=zt[s],p;for(p in c)if(c.hasOwnProperty(p)&&p in Si)return wn[s]=c[p];return s}var zc=jn("animationend"),Vu=jn("animationiteration"),Er=jn("animationstart"),Bc=jn("transitionrun"),yp=jn("transitionstart"),Ko=jn("transitioncancel"),Yl=jn("transitionend"),Wl=new Map,Rn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Rn.push("scrollEnd");function oa(s,c){Wl.set(s,c),aa(c,[s])}var Hu=new WeakMap;function _i(s,c){if(typeof s=="object"&&s!==null){var p=Hu.get(s);return p!==void 0?p:(c={value:s,source:c,stack:_c(c)},Hu.set(s,c),c)}return{value:s,source:c,stack:_c(c)}}var Br=[],Xo=0,Gu=0;function oo(){for(var s=Xo,c=Gu=Xo=0;c<s;){var p=Br[c];Br[c++]=null;var x=Br[c];Br[c++]=null;var N=Br[c];Br[c++]=null;var D=Br[c];if(Br[c++]=null,x!==null&&N!==null){var H=x.pending;H===null?N.next=N:(N.next=H.next,H.next=N),x.pending=N}D!==0&&Ql(p,N,D)}}function Ar(s,c,p,x){Br[Xo++]=s,Br[Xo++]=c,Br[Xo++]=p,Br[Xo++]=x,Gu|=x,s.lanes|=x,s=s.alternate,s!==null&&(s.lanes|=x)}function Zo(s,c,p,x){return Ar(s,c,p,x),Dr(s)}function lo(s,c){return Ar(s,null,null,c),Dr(s)}function Ql(s,c,p){s.lanes|=p;var x=s.alternate;x!==null&&(x.lanes|=p);for(var N=!1,D=s.return;D!==null;)D.childLanes|=p,x=D.alternate,x!==null&&(x.childLanes|=p),D.tag===22&&(s=D.stateNode,s===null||s._visibility&1||(N=!0)),s=D,D=D.return;return s.tag===3?(D=s.stateNode,N&&c!==null&&(N=31-Ge(p),s=D.hiddenUpdates,x=s[N],x===null?s[N]=[c]:x.push(c),c.lane=p|536870912),D):null}function Dr(s){if(50<cu)throw cu=0,lm=null,Error(r(185));for(var c=s.return;c!==null;)s=c,c=s.return;return s.tag===3?s.stateNode:null}var co={};function Jl(s,c,p,x){this.tag=s,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=c,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yr(s,c,p,x){return new Jl(s,c,p,x)}function Es(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Xi(s,c){var p=s.alternate;return p===null?(p=yr(s.tag,c,s.key,s.mode),p.elementType=s.elementType,p.type=s.type,p.stateNode=s.stateNode,p.alternate=s,s.alternate=p):(p.pendingProps=c,p.type=s.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=s.flags&65011712,p.childLanes=s.childLanes,p.lanes=s.lanes,p.child=s.child,p.memoizedProps=s.memoizedProps,p.memoizedState=s.memoizedState,p.updateQueue=s.updateQueue,c=s.dependencies,p.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext},p.sibling=s.sibling,p.index=s.index,p.ref=s.ref,p.refCleanup=s.refCleanup,p}function el(s,c){s.flags&=65011714;var p=s.alternate;return p===null?(s.childLanes=0,s.lanes=c,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=p.childLanes,s.lanes=p.lanes,s.child=p.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=p.memoizedProps,s.memoizedState=p.memoizedState,s.updateQueue=p.updateQueue,s.type=p.type,c=p.dependencies,s.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),s}function Uc(s,c,p,x,N,D){var H=0;if(x=s,typeof s=="function")Es(s)&&(H=1);else if(typeof s=="string")H=Dv(s,p,Se.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case F:return s=yr(31,p,c,N),s.elementType=F,s.lanes=D,s;case S:return uo(p.children,N,D,c);case T:H=8,N|=24;break;case E:return s=yr(12,p,c,N|2),s.elementType=E,s.lanes=D,s;case L:return s=yr(13,p,c,N),s.elementType=L,s.lanes=D,s;case O:return s=yr(19,p,c,N),s.elementType=O,s.lanes=D,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case C:case I:H=10;break e;case P:H=9;break e;case q:H=11;break e;case B:H=14;break e;case $:H=16,x=null;break e}H=29,p=Error(r(130,s===null?"null":typeof s,"")),x=null}return c=yr(H,p,c,N),c.elementType=s,c.type=x,c.lanes=D,c}function uo(s,c,p,x){return s=yr(7,s,x,c),s.lanes=p,s}function Yu(s,c,p){return s=yr(6,s,null,c),s.lanes=p,s}function tl(s,c,p){return c=yr(4,s.children!==null?s.children:[],s.key,c),c.lanes=p,c.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},c}var Wa=[],Qa=0,Kl=null,nl=0,Pr=[],G=0,le=null,se=1,_e="";function it(s,c){Wa[Qa++]=nl,Wa[Qa++]=Kl,Kl=s,nl=c}function St(s,c,p){Pr[G++]=se,Pr[G++]=_e,Pr[G++]=le,le=s;var x=se;s=_e;var N=32-Ge(x)-1;x&=~(1<<N),p+=1;var D=32-Ge(c)+N;if(30<D){var H=N-N%5;D=(x&(1<<H)-1).toString(32),x>>=H,N-=H,se=1<<32-Ge(c)+N|p<<N|x,_e=D+s}else se=1<<D|p<<N|x,_e=s}function Pt(s){s.return!==null&&(it(s,1),St(s,1,0))}function Et(s){for(;s===Kl;)Kl=Wa[--Qa],Wa[Qa]=null,nl=Wa[--Qa],Wa[Qa]=null;for(;s===le;)le=Pr[--G],Pr[G]=null,_e=Pr[--G],Pr[G]=null,se=Pr[--G],Pr[G]=null}var _n=null,Gn=null,an=!1,Ur=null,Oi=!1,qc=Error(r(519));function wa(s){var c=Error(r(418,""));throw il(_i(c,s)),qc}function Tg(s){var c=s.stateNode,p=s.type,x=s.memoizedProps;switch(c[mn]=s,c[Dn]=x,p){case"dialog":vn("cancel",c),vn("close",c);break;case"iframe":case"object":case"embed":vn("load",c);break;case"video":case"audio":for(p=0;p<Rd.length;p++)vn(Rd[p],c);break;case"source":vn("error",c);break;case"img":case"image":case"link":vn("error",c),vn("load",c);break;case"details":vn("toggle",c);break;case"input":vn("invalid",c),Fo(c,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0),Js(c);break;case"select":vn("invalid",c);break;case"textarea":vn("invalid",c),Ks(c,x.value,x.defaultValue,x.children),Js(c)}p=x.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||c.textContent===""+p||x.suppressHydrationWarning===!0||Ky(c.textContent,p)?(x.popover!=null&&(vn("beforetoggle",c),vn("toggle",c)),x.onScroll!=null&&vn("scroll",c),x.onScrollEnd!=null&&vn("scrollend",c),x.onClick!=null&&(c.onclick=ff),c=!0):c=!1,c||wa(s)}function Eg(s){for(_n=s.return;_n;)switch(_n.tag){case 5:case 13:Oi=!1;return;case 27:case 3:Oi=!0;return;default:_n=_n.return}}function Wu(s){if(s!==_n)return!1;if(!an)return Eg(s),an=!0,!1;var c=s.tag,p;if((p=c!==3&&c!==27)&&((p=c===5)&&(p=s.type,p=!(p!=="form"&&p!=="button")||mf(s.type,s.memoizedProps)),p=!p),p&&Gn&&wa(s),Eg(s),c===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));e:{for(s=s.nextSibling,c=0;s;){if(s.nodeType===8)if(p=s.data,p==="/$"){if(c===0){Gn=ts(s.nextSibling);break e}c--}else p!=="$"&&p!=="$!"&&p!=="$?"||c++;s=s.nextSibling}Gn=null}}else c===27?(c=Gn,ka(s.type)?(s=Nm,Nm=null,Gn=s):Gn=c):Gn=_n?ts(s.stateNode.nextSibling):null;return!0}function Qu(){Gn=_n=null,an=!1}function Ag(){var s=Ur;return s!==null&&(Jr===null?Jr=s:Jr.push.apply(Jr,s),Ur=null),s}function il(s){Ur===null?Ur=[s]:Ur.push(s)}var Xl=te(null),rl=null,X=null;function la(s,c,p){M(Xl,c._currentValue),c._currentValue=p}function Na(s){s._currentValue=Xl.current,xe(Xl)}function qr(s,c,p){for(;s!==null;){var x=s.alternate;if((s.childLanes&c)!==c?(s.childLanes|=c,x!==null&&(x.childLanes|=c)):x!==null&&(x.childLanes&c)!==c&&(x.childLanes|=c),s===p)break;s=s.return}}function gn(s,c,p,x){var N=s.child;for(N!==null&&(N.return=s);N!==null;){var D=N.dependencies;if(D!==null){var H=N.child;D=D.firstContext;e:for(;D!==null;){var Z=D;D=N;for(var we=0;we<c.length;we++)if(Z.context===c[we]){D.lanes|=p,Z=D.alternate,Z!==null&&(Z.lanes|=p),qr(D.return,p,s),x||(H=null);break e}D=Z.next}}else if(N.tag===18){if(H=N.return,H===null)throw Error(r(341));H.lanes|=p,D=H.alternate,D!==null&&(D.lanes|=p),qr(H,p,s),H=null}else H=N.child;if(H!==null)H.return=N;else for(H=N;H!==null;){if(H===s){H=null;break}if(N=H.sibling,N!==null){N.return=H.return,H=N;break}H=H.return}N=H}}function Ju(s,c,p,x){s=null;for(var N=c,D=!1;N!==null;){if(!D){if((N.flags&524288)!==0)D=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var H=N.alternate;if(H===null)throw Error(r(387));if(H=H.memoizedProps,H!==null){var Z=N.type;Cr(N.pendingProps.value,H.value)||(s!==null?s.push(Z):s=[Z])}}else if(N===ge.current){if(H=N.alternate,H===null)throw Error(r(387));H.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(s!==null?s.push(yu):s=[yu])}N=N.return}s!==null&&gn(c,s,p,x),c.flags|=262144}function Sh(s){for(s=s.firstContext;s!==null;){if(!Cr(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Zl(s){rl=s,X=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Ci(s){return Dg(rl,s)}function jh(s,c){return rl===null&&Zl(s),Dg(s,c)}function Dg(s,c){var p=c._currentValue;if(c={context:c,memoizedValue:p,next:null},X===null){if(s===null)throw Error(r(308));X=c,s.dependencies={lanes:0,firstContext:c},s.flags|=524288}else X=X.next=c;return p}var tv=typeof AbortController<"u"?AbortController:function(){var s=[],c=this.signal={aborted:!1,addEventListener:function(p,x){s.push(x)}};this.abort=function(){c.aborted=!0,s.forEach(function(p){return p()})}},nv=e.unstable_scheduleCallback,iv=e.unstable_NormalPriority,ai={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function xp(){return{controller:new tv,data:new Map,refCount:0}}function Ku(s){s.refCount--,s.refCount===0&&nv(iv,function(){s.controller.abort()})}var Xu=null,bp=0,Vc=0,Vr=null;function rv(s,c){if(Xu===null){var p=Xu=[];bp=0,Vc=df(),Vr={status:"pending",value:void 0,then:function(x){p.push(x)}}}return bp++,c.then(Pg,Pg),c}function Pg(){if(--bp===0&&Xu!==null){Vr!==null&&(Vr.status="fulfilled");var s=Xu;Xu=null,Vc=0,Vr=null;for(var c=0;c<s.length;c++)(0,s[c])()}}function av(s,c){var p=[],x={status:"pending",value:null,reason:null,then:function(N){p.push(N)}};return s.then(function(){x.status="fulfilled",x.value=c;for(var N=0;N<p.length;N++)(0,p[N])(c)},function(N){for(x.status="rejected",x.reason=N,N=0;N<p.length;N++)(0,p[N])(void 0)}),x}var Ig=J.S;J.S=function(s,c){typeof c=="object"&&c!==null&&typeof c.then=="function"&&rv(s,c),Ig!==null&&Ig(s,c)};var ec=te(null);function ho(){var s=ec.current;return s!==null?s:ci.pooledCache}function _h(s,c){c===null?M(ec,ec.current):M(ec,c.pool)}function Mg(){var s=ho();return s===null?null:{parent:ai._currentValue,pool:s}}var Ir=Error(r(460)),Rg=Error(r(474)),Ch=Error(r(542)),vp={then:function(){}};function Og(s){return s=s.status,s==="fulfilled"||s==="rejected"}function kh(){}function wp(s,c,p){switch(p=s[p],p===void 0?s.push(c):p!==c&&(c.then(kh,kh),c=p),c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,Fg(s),s;default:if(typeof c.status=="string")c.then(kh,kh);else{if(s=ci,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=c,s.status="pending",s.then(function(x){if(c.status==="pending"){var N=c;N.status="fulfilled",N.value=x}},function(x){if(c.status==="pending"){var N=c;N.status="rejected",N.reason=x}})}switch(c.status){case"fulfilled":return c.value;case"rejected":throw s=c.reason,Fg(s),s}throw Hc=c,Ir}}var Hc=null;function Lg(){if(Hc===null)throw Error(r(459));var s=Hc;return Hc=null,s}function Fg(s){if(s===Ir||s===Ch)throw Error(r(483))}var As=!1;function tc(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Gc(s,c){s=s.updateQueue,c.updateQueue===s&&(c.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function al(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function fo(s,c,p){var x=s.updateQueue;if(x===null)return null;if(x=x.shared,(Wn&2)!==0){var N=x.pending;return N===null?c.next=c:(c.next=N.next,N.next=c),x.pending=c,c=Dr(s),Ql(s,null,p),c}return Ar(s,x,c,p),Dr(s)}function Zu(s,c,p){if(c=c.updateQueue,c!==null&&(c=c.shared,(p&4194048)!==0)){var x=c.lanes;x&=s.pendingLanes,p|=x,c.lanes=p,Nt(s,p)}}function Ja(s,c){var p=s.updateQueue,x=s.alternate;if(x!==null&&(x=x.updateQueue,p===x)){var N=null,D=null;if(p=p.firstBaseUpdate,p!==null){do{var H={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};D===null?N=D=H:D=D.next=H,p=p.next}while(p!==null);D===null?N=D=c:D=D.next=c}else N=D=c;p={baseState:x.baseState,firstBaseUpdate:N,lastBaseUpdate:D,shared:x.shared,callbacks:x.callbacks},s.updateQueue=p;return}s=p.lastBaseUpdate,s===null?p.firstBaseUpdate=c:s.next=c,p.lastBaseUpdate=c}var ed=!1;function Ka(){if(ed){var s=Vr;if(s!==null)throw s}}function xr(s,c,p,x){ed=!1;var N=s.updateQueue;As=!1;var D=N.firstBaseUpdate,H=N.lastBaseUpdate,Z=N.shared.pending;if(Z!==null){N.shared.pending=null;var we=Z,Ue=we.next;we.next=null,H===null?D=Ue:H.next=Ue,H=we;var et=s.alternate;et!==null&&(et=et.updateQueue,Z=et.lastBaseUpdate,Z!==H&&(Z===null?et.firstBaseUpdate=Ue:Z.next=Ue,et.lastBaseUpdate=we))}if(D!==null){var ot=N.baseState;H=0,et=Ue=we=null,Z=D;do{var We=Z.lane&-536870913,qe=We!==Z.lane;if(qe?(In&We)===We:(x&We)===We){We!==0&&We===Vc&&(ed=!0),et!==null&&(et=et.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var qt=s,Ut=Z;We=c;var ti=p;switch(Ut.tag){case 1:if(qt=Ut.payload,typeof qt=="function"){ot=qt.call(ti,ot,We);break e}ot=qt;break e;case 3:qt.flags=qt.flags&-65537|128;case 0:if(qt=Ut.payload,We=typeof qt=="function"?qt.call(ti,ot,We):qt,We==null)break e;ot=f({},ot,We);break e;case 2:As=!0}}We=Z.callback,We!==null&&(s.flags|=64,qe&&(s.flags|=8192),qe=N.callbacks,qe===null?N.callbacks=[We]:qe.push(We))}else qe={lane:We,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},et===null?(Ue=et=qe,we=ot):et=et.next=qe,H|=We;if(Z=Z.next,Z===null){if(Z=N.shared.pending,Z===null)break;qe=Z,Z=qe.next,qe.next=null,N.lastBaseUpdate=qe,N.shared.pending=null}}while(!0);et===null&&(we=ot),N.baseState=we,N.firstBaseUpdate=Ue,N.lastBaseUpdate=et,D===null&&(N.shared.lanes=0),pl|=H,s.lanes=H,s.memoizedState=ot}}function $g(s,c){if(typeof s!="function")throw Error(r(191,s));s.call(c)}function Np(s,c){var p=s.callbacks;if(p!==null)for(s.callbacks=null,s=0;s<p.length;s++)$g(p[s],c)}var nc=te(null),sl=te(0);function po(s,c){s=So,M(sl,s),M(nc,c),So=s|c.baseLanes}function Th(){M(sl,So),M(nc,nc.current)}function Sp(){So=sl.current,xe(nc),xe(sl)}var Xa=0,cn=null,Yn=null,Nn=null,Yc=!1,ic=!1,br=!1,Wc=0,ol=0,Sa=null,zg=0;function Cn(){throw Error(r(321))}function td(s,c){if(c===null)return!1;for(var p=0;p<c.length&&p<s.length;p++)if(!Cr(s[p],c[p]))return!1;return!0}function jp(s,c,p,x,N,D){return Xa=D,cn=c,c.memoizedState=null,c.updateQueue=null,c.lanes=0,J.H=s===null||s.memoizedState===null?Zg:Up,br=!1,D=p(x,N),br=!1,ic&&(D=Ug(c,p,x,N)),Bg(s),D}function Bg(s){J.H=hd;var c=Yn!==null&&Yn.next!==null;if(Xa=0,Nn=Yn=cn=null,Yc=!1,ol=0,Sa=null,c)throw Error(r(300));s===null||Zi||(s=s.dependencies,s!==null&&Sh(s)&&(Zi=!0))}function Ug(s,c,p,x){cn=s;var N=0;do{if(ic&&(Sa=null),ol=0,ic=!1,25<=N)throw Error(r(301));if(N+=1,Nn=Yn=null,s.updateQueue!=null){var D=s.updateQueue;D.lastEffect=null,D.events=null,D.stores=null,D.memoCache!=null&&(D.memoCache.index=0)}J.H=ey,D=c(p,x)}while(ic);return D}function _p(){var s=J.H,c=s.useState()[0];return c=typeof c.then=="function"?nd(c):c,s=s.useState()[0],(Yn!==null?Yn.memoizedState:null)!==s&&(cn.flags|=1024),c}function Cp(){var s=Wc!==0;return Wc=0,s}function rc(s,c,p){c.updateQueue=s.updateQueue,c.flags&=-2053,s.lanes&=~p}function Eh(s){if(Yc){for(s=s.memoizedState;s!==null;){var c=s.queue;c!==null&&(c.pending=null),s=s.next}Yc=!1}Xa=0,Nn=Yn=cn=null,ic=!1,ol=Wc=0,Sa=null}function Hr(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Nn===null?cn.memoizedState=Nn=s:Nn=Nn.next=s,Nn}function Fi(){if(Yn===null){var s=cn.alternate;s=s!==null?s.memoizedState:null}else s=Yn.next;var c=Nn===null?cn.memoizedState:Nn.next;if(c!==null)Nn=c,Yn=s;else{if(s===null)throw cn.alternate===null?Error(r(467)):Error(r(310));Yn=s,s={memoizedState:Yn.memoizedState,baseState:Yn.baseState,baseQueue:Yn.baseQueue,queue:Yn.queue,next:null},Nn===null?cn.memoizedState=Nn=s:Nn=Nn.next=s}return Nn}function ac(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function nd(s){var c=ol;return ol+=1,Sa===null&&(Sa=[]),s=wp(Sa,s,c),c=cn,(Nn===null?c.memoizedState:Nn.next)===null&&(c=c.alternate,J.H=c===null||c.memoizedState===null?Zg:Up),s}function Ah(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return nd(s);if(s.$$typeof===I)return Ci(s)}throw Error(r(438,String(s)))}function id(s){var c=null,p=cn.updateQueue;if(p!==null&&(c=p.memoCache),c==null){var x=cn.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(c={data:x.data.map(function(N){return N.slice()}),index:0})))}if(c==null&&(c={data:[],index:0}),p===null&&(p=ac(),cn.updateQueue=p),p.memoCache=c,p=c.data[c.index],p===void 0)for(p=c.data[c.index]=Array(s),x=0;x<s;x++)p[x]=z;return c.index++,p}function Ds(s,c){return typeof c=="function"?c(s):c}function Dh(s){var c=Fi();return kp(c,Yn,s)}function kp(s,c,p){var x=s.queue;if(x===null)throw Error(r(311));x.lastRenderedReducer=p;var N=s.baseQueue,D=x.pending;if(D!==null){if(N!==null){var H=N.next;N.next=D.next,D.next=H}c.baseQueue=N=D,x.pending=null}if(D=s.baseState,N===null)s.memoizedState=D;else{c=N.next;var Z=H=null,we=null,Ue=c,et=!1;do{var ot=Ue.lane&-536870913;if(ot!==Ue.lane?(In&ot)===ot:(Xa&ot)===ot){var We=Ue.revertLane;if(We===0)we!==null&&(we=we.next={lane:0,revertLane:0,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null}),ot===Vc&&(et=!0);else if((Xa&We)===We){Ue=Ue.next,We===Vc&&(et=!0);continue}else ot={lane:0,revertLane:Ue.revertLane,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},we===null?(Z=we=ot,H=D):we=we.next=ot,cn.lanes|=We,pl|=We;ot=Ue.action,br&&p(D,ot),D=Ue.hasEagerState?Ue.eagerState:p(D,ot)}else We={lane:ot,revertLane:Ue.revertLane,action:Ue.action,hasEagerState:Ue.hasEagerState,eagerState:Ue.eagerState,next:null},we===null?(Z=we=We,H=D):we=we.next=We,cn.lanes|=ot,pl|=ot;Ue=Ue.next}while(Ue!==null&&Ue!==c);if(we===null?H=D:we.next=Z,!Cr(D,s.memoizedState)&&(Zi=!0,et&&(p=Vr,p!==null)))throw p;s.memoizedState=D,s.baseState=H,s.baseQueue=we,x.lastRenderedState=D}return N===null&&(x.lanes=0),[s.memoizedState,x.dispatch]}function Tp(s){var c=Fi(),p=c.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=s;var x=p.dispatch,N=p.pending,D=c.memoizedState;if(N!==null){p.pending=null;var H=N=N.next;do D=s(D,H.action),H=H.next;while(H!==N);Cr(D,c.memoizedState)||(Zi=!0),c.memoizedState=D,c.baseQueue===null&&(c.baseState=D),p.lastRenderedState=D}return[D,x]}function Ep(s,c,p){var x=cn,N=Fi(),D=an;if(D){if(p===void 0)throw Error(r(407));p=p()}else p=c();var H=!Cr((Yn||N).memoizedState,p);H&&(N.memoizedState=p,Zi=!0),N=N.queue;var Z=Ih.bind(null,x,N,s);if(sd(2048,8,Z,[s]),N.getSnapshot!==c||H||Nn!==null&&Nn.memoizedState.tag&1){if(x.flags|=2048,Qc(9,Fh(),qg.bind(null,x,N,p,c),null),ci===null)throw Error(r(349));D||(Xa&124)!==0||Ph(x,c,p)}return p}function Ph(s,c,p){s.flags|=16384,s={getSnapshot:c,value:p},c=cn.updateQueue,c===null?(c=ac(),cn.updateQueue=c,c.stores=[s]):(p=c.stores,p===null?c.stores=[s]:p.push(s))}function qg(s,c,p,x){c.value=p,c.getSnapshot=x,Ap(c)&&Dp(s)}function Ih(s,c,p){return p(function(){Ap(c)&&Dp(s)})}function Ap(s){var c=s.getSnapshot;s=s.value;try{var p=c();return!Cr(s,p)}catch{return!0}}function Dp(s){var c=lo(s,2);c!==null&&fa(c,s,2)}function Mh(s){var c=Hr();if(typeof s=="function"){var p=s;if(s=p(),br){De(!0);try{p()}finally{De(!1)}}}return c.memoizedState=c.baseState=s,c.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:s},c}function rd(s,c,p,x){return s.baseState=p,kp(s,Yn,typeof x=="function"?x:Ds)}function sv(s,c,p,x,N){if(Uh(s))throw Error(r(485));if(s=c.action,s!==null){var D={payload:N,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(H){D.listeners.push(H)}};J.T!==null?p(!0):D.isTransition=!1,x(D),p=c.pending,p===null?(D.next=c.pending=D,Pp(c,D)):(D.next=p.next,c.pending=p.next=D)}}function Pp(s,c){var p=c.action,x=c.payload,N=s.state;if(c.isTransition){var D=J.T,H={};J.T=H;try{var Z=p(N,x),we=J.S;we!==null&&we(H,Z),Ip(s,c,Z)}catch(Ue){Rh(s,c,Ue)}finally{J.T=D}}else try{D=p(N,x),Ip(s,c,D)}catch(Ue){Rh(s,c,Ue)}}function Ip(s,c,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(x){Vg(s,c,x)},function(x){return Rh(s,c,x)}):Vg(s,c,p)}function Vg(s,c,p){c.status="fulfilled",c.value=p,Hg(c),s.state=p,c=s.pending,c!==null&&(p=c.next,p===c?s.pending=null:(p=p.next,c.next=p,Pp(s,p)))}function Rh(s,c,p){var x=s.pending;if(s.pending=null,x!==null){x=x.next;do c.status="rejected",c.reason=p,Hg(c),c=c.next;while(c!==x)}s.action=null}function Hg(s){s=s.listeners;for(var c=0;c<s.length;c++)(0,s[c])()}function Oh(s,c){return c}function Mp(s,c){if(an){var p=ci.formState;if(p!==null){e:{var x=cn;if(an){if(Gn){t:{for(var N=Gn,D=Oi;N.nodeType!==8;){if(!D){N=null;break t}if(N=ts(N.nextSibling),N===null){N=null;break t}}D=N.data,N=D==="F!"||D==="F"?N:null}if(N){Gn=ts(N.nextSibling),x=N.data==="F!";break e}}wa(x)}x=!1}x&&(c=p[0])}}return p=Hr(),p.memoizedState=p.baseState=c,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Oh,lastRenderedState:c},p.queue=x,p=$p.bind(null,cn,x),x.dispatch=p,x=Mh(!1),D=zp.bind(null,cn,!1,x.queue),x=Hr(),N={state:c,dispatch:null,action:s,pending:null},x.queue=N,p=sv.bind(null,cn,N,D,p),N.dispatch=p,x.memoizedState=s,[c,p,!1]}function Lh(s){var c=Fi();return Gg(c,Yn,s)}function Gg(s,c,p){if(c=kp(s,c,Oh)[0],s=Dh(Ds)[0],typeof c=="object"&&c!==null&&typeof c.then=="function")try{var x=nd(c)}catch(H){throw H===Ir?Ch:H}else x=c;c=Fi();var N=c.queue,D=N.dispatch;return p!==c.memoizedState&&(cn.flags|=2048,Qc(9,Fh(),Rp.bind(null,N,p),null)),[x,D,s]}function Rp(s,c){s.action=c}function sn(s){var c=Fi(),p=Yn;if(p!==null)return Gg(c,p,s);Fi(),c=c.memoizedState,p=Fi();var x=p.queue.dispatch;return p.memoizedState=s,[c,x,!1]}function Qc(s,c,p,x){return s={tag:s,create:p,deps:x,inst:c,next:null},c=cn.updateQueue,c===null&&(c=ac(),cn.updateQueue=c),p=c.lastEffect,p===null?c.lastEffect=s.next=s:(x=p.next,p.next=s,s.next=x,c.lastEffect=s),s}function Fh(){return{destroy:void 0,resource:void 0}}function Jc(){return Fi().memoizedState}function ad(s,c,p,x){var N=Hr();x=x===void 0?null:x,cn.flags|=s,N.memoizedState=Qc(1|c,Fh(),p,x)}function sd(s,c,p,x){var N=Fi();x=x===void 0?null:x;var D=N.memoizedState.inst;Yn!==null&&x!==null&&td(x,Yn.memoizedState.deps)?N.memoizedState=Qc(c,D,p,x):(cn.flags|=s,N.memoizedState=Qc(1|c,D,p,x))}function Yg(s,c){ad(8390656,8,s,c)}function ca(s,c){sd(2048,8,s,c)}function Wg(s,c){return sd(4,2,s,c)}function od(s,c){return sd(4,4,s,c)}function $h(s,c){if(typeof c=="function"){s=s();var p=c(s);return function(){typeof p=="function"?p():c(null)}}if(c!=null)return s=s(),c.current=s,function(){c.current=null}}function Op(s,c,p){p=p!=null?p.concat([s]):null,sd(4,4,$h.bind(null,c,s),p)}function zh(){}function Gr(s,c){var p=Fi();c=c===void 0?null:c;var x=p.memoizedState;return c!==null&&td(c,x[1])?x[0]:(p.memoizedState=[s,c],s)}function mo(s,c){var p=Fi();c=c===void 0?null:c;var x=p.memoizedState;if(c!==null&&td(c,x[1]))return x[0];if(x=s(),br){De(!0);try{s()}finally{De(!1)}}return p.memoizedState=[x,c],x}function ld(s,c,p){return p===void 0||(Xa&1073741824)!==0?s.memoizedState=c:(s.memoizedState=p,s=ky(),cn.lanes|=s,pl|=s,p)}function Lp(s,c,p,x){return Cr(p,c)?p:nc.current!==null?(s=ld(s,p,x),Cr(s,c)||(Zi=!0),s):(Xa&42)===0?(Zi=!0,s.memoizedState=p):(s=ky(),cn.lanes|=s,pl|=s,c)}function cd(s,c,p,x,N){var D=K.p;K.p=D!==0&&8>D?D:8;var H=J.T,Z={};J.T=Z,zp(s,!1,c,p);try{var we=N(),Ue=J.S;if(Ue!==null&&Ue(Z,we),we!==null&&typeof we=="object"&&typeof we.then=="function"){var et=av(we,x);sc(s,c,et,wr(s))}else sc(s,c,x,wr(s))}catch(ot){sc(s,c,{then:function(){},status:"rejected",reason:ot},wr())}finally{K.p=D,J.T=H}}function Qg(){}function ud(s,c,p,x){if(s.tag!==5)throw Error(r(476));var N=Fp(s).queue;cd(s,N,c,W,p===null?Qg:function(){return Bh(s),p(x)})}function Fp(s){var c=s.memoizedState;if(c!==null)return c;c={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:W},next:null};var p={};return c.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:p},next:null},s.memoizedState=c,s=s.alternate,s!==null&&(s.memoizedState=c),c}function Bh(s){var c=Fp(s).next.queue;sc(s,c,{},wr())}function dd(){return Ci(yu)}function go(){return Fi().memoizedState}function Jg(){return Fi().memoizedState}function ll(s){for(var c=s.return;c!==null;){switch(c.tag){case 24:case 3:var p=wr();s=al(p);var x=fo(c,s,p);x!==null&&(fa(x,c,p),Zu(x,c,p)),c={cache:xp()},s.payload=c;return}c=c.return}}function Kg(s,c,p){var x=wr();p={lane:x,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},Uh(s)?Xg(c,p):(p=Zo(s,c,p,x),p!==null&&(fa(p,s,x),Bp(p,c,x)))}function $p(s,c,p){var x=wr();sc(s,c,p,x)}function sc(s,c,p,x){var N={lane:x,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(Uh(s))Xg(c,N);else{var D=s.alternate;if(s.lanes===0&&(D===null||D.lanes===0)&&(D=c.lastRenderedReducer,D!==null))try{var H=c.lastRenderedState,Z=D(H,p);if(N.hasEagerState=!0,N.eagerState=Z,Cr(Z,H))return Ar(s,c,N,0),ci===null&&oo(),!1}catch{}finally{}if(p=Zo(s,c,N,x),p!==null)return fa(p,s,x),Bp(p,c,x),!0}return!1}function zp(s,c,p,x){if(x={lane:2,revertLane:df(),action:x,hasEagerState:!1,eagerState:null,next:null},Uh(s)){if(c)throw Error(r(479))}else c=Zo(s,p,x,2),c!==null&&fa(c,s,2)}function Uh(s){var c=s.alternate;return s===cn||c!==null&&c===cn}function Xg(s,c){ic=Yc=!0;var p=s.pending;p===null?c.next=c:(c.next=p.next,p.next=c),s.pending=c}function Bp(s,c,p){if((p&4194048)!==0){var x=c.lanes;x&=s.pendingLanes,p|=x,c.lanes=p,Nt(s,p)}}var hd={readContext:Ci,use:Ah,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn},Zg={readContext:Ci,use:Ah,useCallback:function(s,c){return Hr().memoizedState=[s,c===void 0?null:c],s},useContext:Ci,useEffect:Yg,useImperativeHandle:function(s,c,p){p=p!=null?p.concat([s]):null,ad(4194308,4,$h.bind(null,c,s),p)},useLayoutEffect:function(s,c){return ad(4194308,4,s,c)},useInsertionEffect:function(s,c){ad(4,2,s,c)},useMemo:function(s,c){var p=Hr();c=c===void 0?null:c;var x=s();if(br){De(!0);try{s()}finally{De(!1)}}return p.memoizedState=[x,c],x},useReducer:function(s,c,p){var x=Hr();if(p!==void 0){var N=p(c);if(br){De(!0);try{p(c)}finally{De(!1)}}}else N=c;return x.memoizedState=x.baseState=N,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:N},x.queue=s,s=s.dispatch=Kg.bind(null,cn,s),[x.memoizedState,s]},useRef:function(s){var c=Hr();return s={current:s},c.memoizedState=s},useState:function(s){s=Mh(s);var c=s.queue,p=$p.bind(null,cn,c);return c.dispatch=p,[s.memoizedState,p]},useDebugValue:zh,useDeferredValue:function(s,c){var p=Hr();return ld(p,s,c)},useTransition:function(){var s=Mh(!1);return s=cd.bind(null,cn,s.queue,!0,!1),Hr().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,c,p){var x=cn,N=Hr();if(an){if(p===void 0)throw Error(r(407));p=p()}else{if(p=c(),ci===null)throw Error(r(349));(In&124)!==0||Ph(x,c,p)}N.memoizedState=p;var D={value:p,getSnapshot:c};return N.queue=D,Yg(Ih.bind(null,x,D,s),[s]),x.flags|=2048,Qc(9,Fh(),qg.bind(null,x,D,p,c),null),p},useId:function(){var s=Hr(),c=ci.identifierPrefix;if(an){var p=_e,x=se;p=(x&~(1<<32-Ge(x)-1)).toString(32)+p,c=""+c+"R"+p,p=Wc++,0<p&&(c+="H"+p.toString(32)),c+=""}else p=zg++,c=""+c+"r"+p.toString(32)+"";return s.memoizedState=c},useHostTransitionStatus:dd,useFormState:Mp,useActionState:Mp,useOptimistic:function(s){var c=Hr();c.memoizedState=c.baseState=s;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return c.queue=p,c=zp.bind(null,cn,!0,p),p.dispatch=c,[s,c]},useMemoCache:id,useCacheRefresh:function(){return Hr().memoizedState=ll.bind(null,cn)}},Up={readContext:Ci,use:Ah,useCallback:Gr,useContext:Ci,useEffect:ca,useImperativeHandle:Op,useInsertionEffect:Wg,useLayoutEffect:od,useMemo:mo,useReducer:Dh,useRef:Jc,useState:function(){return Dh(Ds)},useDebugValue:zh,useDeferredValue:function(s,c){var p=Fi();return Lp(p,Yn.memoizedState,s,c)},useTransition:function(){var s=Dh(Ds)[0],c=Fi().memoizedState;return[typeof s=="boolean"?s:nd(s),c]},useSyncExternalStore:Ep,useId:go,useHostTransitionStatus:dd,useFormState:Lh,useActionState:Lh,useOptimistic:function(s,c){var p=Fi();return rd(p,Yn,s,c)},useMemoCache:id,useCacheRefresh:Jg},ey={readContext:Ci,use:Ah,useCallback:Gr,useContext:Ci,useEffect:ca,useImperativeHandle:Op,useInsertionEffect:Wg,useLayoutEffect:od,useMemo:mo,useReducer:Tp,useRef:Jc,useState:function(){return Tp(Ds)},useDebugValue:zh,useDeferredValue:function(s,c){var p=Fi();return Yn===null?ld(p,s,c):Lp(p,Yn.memoizedState,s,c)},useTransition:function(){var s=Tp(Ds)[0],c=Fi().memoizedState;return[typeof s=="boolean"?s:nd(s),c]},useSyncExternalStore:Ep,useId:go,useHostTransitionStatus:dd,useFormState:sn,useActionState:sn,useOptimistic:function(s,c){var p=Fi();return Yn!==null?rd(p,Yn,s,c):(p.baseState=s,[s,p.queue.dispatch])},useMemoCache:id,useCacheRefresh:Jg},Ui=null,Yr=0;function qh(s){var c=Yr;return Yr+=1,Ui===null&&(Ui=[]),wp(Ui,s,c)}function fd(s,c){c=c.props.ref,s.ref=c!==void 0?c:null}function oc(s,c){throw c.$$typeof===g?Error(r(525)):(s=Object.prototype.toString.call(c),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(c).join(", ")+"}":s)))}function lc(s){var c=s._init;return c(s._payload)}function qp(s){function c(Re,Te){if(s){var Be=Re.deletions;Be===null?(Re.deletions=[Te],Re.flags|=16):Be.push(Te)}}function p(Re,Te){if(!s)return null;for(;Te!==null;)c(Re,Te),Te=Te.sibling;return null}function x(Re){for(var Te=new Map;Re!==null;)Re.key!==null?Te.set(Re.key,Re):Te.set(Re.index,Re),Re=Re.sibling;return Te}function N(Re,Te){return Re=Xi(Re,Te),Re.index=0,Re.sibling=null,Re}function D(Re,Te,Be){return Re.index=Be,s?(Be=Re.alternate,Be!==null?(Be=Be.index,Be<Te?(Re.flags|=67108866,Te):Be):(Re.flags|=67108866,Te)):(Re.flags|=1048576,Te)}function H(Re){return s&&Re.alternate===null&&(Re.flags|=67108866),Re}function Z(Re,Te,Be,at){return Te===null||Te.tag!==6?(Te=Yu(Be,Re.mode,at),Te.return=Re,Te):(Te=N(Te,Be),Te.return=Re,Te)}function we(Re,Te,Be,at){var It=Be.type;return It===S?et(Re,Te,Be.props.children,at,Be.key):Te!==null&&(Te.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===$&&lc(It)===Te.type)?(Te=N(Te,Be.props),fd(Te,Be),Te.return=Re,Te):(Te=Uc(Be.type,Be.key,Be.props,null,Re.mode,at),fd(Te,Be),Te.return=Re,Te)}function Ue(Re,Te,Be,at){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==Be.containerInfo||Te.stateNode.implementation!==Be.implementation?(Te=tl(Be,Re.mode,at),Te.return=Re,Te):(Te=N(Te,Be.children||[]),Te.return=Re,Te)}function et(Re,Te,Be,at,It){return Te===null||Te.tag!==7?(Te=uo(Be,Re.mode,at,It),Te.return=Re,Te):(Te=N(Te,Be),Te.return=Re,Te)}function ot(Re,Te,Be){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Te=Yu(""+Te,Re.mode,Be),Te.return=Re,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case b:return Be=Uc(Te.type,Te.key,Te.props,null,Re.mode,Be),fd(Be,Te),Be.return=Re,Be;case v:return Te=tl(Te,Re.mode,Be),Te.return=Re,Te;case $:var at=Te._init;return Te=at(Te._payload),ot(Re,Te,Be)}if(ae(Te)||V(Te))return Te=uo(Te,Re.mode,Be,null),Te.return=Re,Te;if(typeof Te.then=="function")return ot(Re,qh(Te),Be);if(Te.$$typeof===I)return ot(Re,jh(Re,Te),Be);oc(Re,Te)}return null}function We(Re,Te,Be,at){var It=Te!==null?Te.key:null;if(typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint")return It!==null?null:Z(Re,Te,""+Be,at);if(typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case b:return Be.key===It?we(Re,Te,Be,at):null;case v:return Be.key===It?Ue(Re,Te,Be,at):null;case $:return It=Be._init,Be=It(Be._payload),We(Re,Te,Be,at)}if(ae(Be)||V(Be))return It!==null?null:et(Re,Te,Be,at,null);if(typeof Be.then=="function")return We(Re,Te,qh(Be),at);if(Be.$$typeof===I)return We(Re,Te,jh(Re,Be),at);oc(Re,Be)}return null}function qe(Re,Te,Be,at,It){if(typeof at=="string"&&at!==""||typeof at=="number"||typeof at=="bigint")return Re=Re.get(Be)||null,Z(Te,Re,""+at,It);if(typeof at=="object"&&at!==null){switch(at.$$typeof){case b:return Re=Re.get(at.key===null?Be:at.key)||null,we(Te,Re,at,It);case v:return Re=Re.get(at.key===null?Be:at.key)||null,Ue(Te,Re,at,It);case $:var yn=at._init;return at=yn(at._payload),qe(Re,Te,Be,at,It)}if(ae(at)||V(at))return Re=Re.get(Be)||null,et(Te,Re,at,It,null);if(typeof at.then=="function")return qe(Re,Te,Be,qh(at),It);if(at.$$typeof===I)return qe(Re,Te,Be,jh(Te,at),It);oc(Te,at)}return null}function qt(Re,Te,Be,at){for(var It=null,yn=null,Ot=Te,Vt=Te=0,nr=null;Ot!==null&&Vt<Be.length;Vt++){Ot.index>Vt?(nr=Ot,Ot=null):nr=Ot.sibling;var On=We(Re,Ot,Be[Vt],at);if(On===null){Ot===null&&(Ot=nr);break}s&&Ot&&On.alternate===null&&c(Re,Ot),Te=D(On,Te,Vt),yn===null?It=On:yn.sibling=On,yn=On,Ot=nr}if(Vt===Be.length)return p(Re,Ot),an&&it(Re,Vt),It;if(Ot===null){for(;Vt<Be.length;Vt++)Ot=ot(Re,Be[Vt],at),Ot!==null&&(Te=D(Ot,Te,Vt),yn===null?It=Ot:yn.sibling=Ot,yn=Ot);return an&&it(Re,Vt),It}for(Ot=x(Ot);Vt<Be.length;Vt++)nr=qe(Ot,Re,Vt,Be[Vt],at),nr!==null&&(s&&nr.alternate!==null&&Ot.delete(nr.key===null?Vt:nr.key),Te=D(nr,Te,Vt),yn===null?It=nr:yn.sibling=nr,yn=nr);return s&&Ot.forEach(function(jl){return c(Re,jl)}),an&&it(Re,Vt),It}function Ut(Re,Te,Be,at){if(Be==null)throw Error(r(151));for(var It=null,yn=null,Ot=Te,Vt=Te=0,nr=null,On=Be.next();Ot!==null&&!On.done;Vt++,On=Be.next()){Ot.index>Vt?(nr=Ot,Ot=null):nr=Ot.sibling;var jl=We(Re,Ot,On.value,at);if(jl===null){Ot===null&&(Ot=nr);break}s&&Ot&&jl.alternate===null&&c(Re,Ot),Te=D(jl,Te,Vt),yn===null?It=jl:yn.sibling=jl,yn=jl,Ot=nr}if(On.done)return p(Re,Ot),an&&it(Re,Vt),It;if(Ot===null){for(;!On.done;Vt++,On=Be.next())On=ot(Re,On.value,at),On!==null&&(Te=D(On,Te,Vt),yn===null?It=On:yn.sibling=On,yn=On);return an&&it(Re,Vt),It}for(Ot=x(Ot);!On.done;Vt++,On=Be.next())On=qe(Ot,Re,Vt,On.value,at),On!==null&&(s&&On.alternate!==null&&Ot.delete(On.key===null?Vt:On.key),Te=D(On,Te,Vt),yn===null?It=On:yn.sibling=On,yn=On);return s&&Ot.forEach(function(Uv){return c(Re,Uv)}),an&&it(Re,Vt),It}function ti(Re,Te,Be,at){if(typeof Be=="object"&&Be!==null&&Be.type===S&&Be.key===null&&(Be=Be.props.children),typeof Be=="object"&&Be!==null){switch(Be.$$typeof){case b:e:{for(var It=Be.key;Te!==null;){if(Te.key===It){if(It=Be.type,It===S){if(Te.tag===7){p(Re,Te.sibling),at=N(Te,Be.props.children),at.return=Re,Re=at;break e}}else if(Te.elementType===It||typeof It=="object"&&It!==null&&It.$$typeof===$&&lc(It)===Te.type){p(Re,Te.sibling),at=N(Te,Be.props),fd(at,Be),at.return=Re,Re=at;break e}p(Re,Te);break}else c(Re,Te);Te=Te.sibling}Be.type===S?(at=uo(Be.props.children,Re.mode,at,Be.key),at.return=Re,Re=at):(at=Uc(Be.type,Be.key,Be.props,null,Re.mode,at),fd(at,Be),at.return=Re,Re=at)}return H(Re);case v:e:{for(It=Be.key;Te!==null;){if(Te.key===It)if(Te.tag===4&&Te.stateNode.containerInfo===Be.containerInfo&&Te.stateNode.implementation===Be.implementation){p(Re,Te.sibling),at=N(Te,Be.children||[]),at.return=Re,Re=at;break e}else{p(Re,Te);break}else c(Re,Te);Te=Te.sibling}at=tl(Be,Re.mode,at),at.return=Re,Re=at}return H(Re);case $:return It=Be._init,Be=It(Be._payload),ti(Re,Te,Be,at)}if(ae(Be))return qt(Re,Te,Be,at);if(V(Be)){if(It=V(Be),typeof It!="function")throw Error(r(150));return Be=It.call(Be),Ut(Re,Te,Be,at)}if(typeof Be.then=="function")return ti(Re,Te,qh(Be),at);if(Be.$$typeof===I)return ti(Re,Te,jh(Re,Be),at);oc(Re,Be)}return typeof Be=="string"&&Be!==""||typeof Be=="number"||typeof Be=="bigint"?(Be=""+Be,Te!==null&&Te.tag===6?(p(Re,Te.sibling),at=N(Te,Be),at.return=Re,Re=at):(p(Re,Te),at=Yu(Be,Re.mode,at),at.return=Re,Re=at),H(Re)):p(Re,Te)}return function(Re,Te,Be,at){try{Yr=0;var It=ti(Re,Te,Be,at);return Ui=null,It}catch(Ot){if(Ot===Ir||Ot===Ch)throw Ot;var yn=yr(29,Ot,null,Re.mode);return yn.lanes=at,yn.return=Re,yn}finally{}}}var cc=qp(!0),ty=qp(!1),ua=te(null),Mr=null;function ja(s){var c=s.alternate;M(ki,ki.current&1),M(ua,s),Mr===null&&(c===null||nc.current!==null||c.memoizedState!==null)&&(Mr=s)}function ny(s){if(s.tag===22){if(M(ki,ki.current),M(ua,s),Mr===null){var c=s.alternate;c!==null&&c.memoizedState!==null&&(Mr=s)}}else yo()}function yo(){M(ki,ki.current),M(ua,ua.current)}function Ps(s){xe(ua),Mr===s&&(Mr=null),xe(ki)}var ki=te(0);function pd(s){for(var c=s;c!==null;){if(c.tag===13){var p=c.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||Or(p)))return c}else if(c.tag===19&&c.memoizedProps.revealOrder!==void 0){if((c.flags&128)!==0)return c}else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return null;c=c.return}c.sibling.return=c.return,c=c.sibling}return null}function Kc(s,c,p,x){c=s.memoizedState,p=p(x,c),p=p==null?c:f({},c,p),s.memoizedState=p,s.lanes===0&&(s.updateQueue.baseState=p)}var md={enqueueSetState:function(s,c,p){s=s._reactInternals;var x=wr(),N=al(x);N.payload=c,p!=null&&(N.callback=p),c=fo(s,N,x),c!==null&&(fa(c,s,x),Zu(c,s,x))},enqueueReplaceState:function(s,c,p){s=s._reactInternals;var x=wr(),N=al(x);N.tag=1,N.payload=c,p!=null&&(N.callback=p),c=fo(s,N,x),c!==null&&(fa(c,s,x),Zu(c,s,x))},enqueueForceUpdate:function(s,c){s=s._reactInternals;var p=wr(),x=al(p);x.tag=2,c!=null&&(x.callback=c),c=fo(s,x,p),c!==null&&(fa(c,s,p),Zu(c,s,p))}};function gd(s,c,p,x,N,D,H){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(x,D,H):c.prototype&&c.prototype.isPureReactComponent?!kr(p,x)||!kr(N,D):!0}function iy(s,c,p,x){s=c.state,typeof c.componentWillReceiveProps=="function"&&c.componentWillReceiveProps(p,x),typeof c.UNSAFE_componentWillReceiveProps=="function"&&c.UNSAFE_componentWillReceiveProps(p,x),c.state!==s&&md.enqueueReplaceState(c,c.state,null)}function cl(s,c){var p=c;if("ref"in c){p={};for(var x in c)x!=="ref"&&(p[x]=c[x])}if(s=s.defaultProps){p===c&&(p=f({},p));for(var N in s)p[N]===void 0&&(p[N]=s[N])}return p}var uc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var c=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(c))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function Vp(s){uc(s)}function Vh(s){console.error(s)}function ry(s){uc(s)}function yd(s,c){try{var p=s.onUncaughtError;p(c.value,{componentStack:c.stack})}catch(x){setTimeout(function(){throw x})}}function Is(s,c,p){try{var x=s.onCaughtError;x(p.value,{componentStack:p.stack,errorBoundary:c.tag===1?c.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function Hh(s,c,p){return p=al(p),p.tag=3,p.payload={element:null},p.callback=function(){yd(s,c)},p}function Hp(s){return s=al(s),s.tag=3,s}function ay(s,c,p,x){var N=p.type.getDerivedStateFromError;if(typeof N=="function"){var D=x.value;s.payload=function(){return N(D)},s.callback=function(){Is(c,p,x)}}var H=p.stateNode;H!==null&&typeof H.componentDidCatch=="function"&&(s.callback=function(){Is(c,p,x),typeof N!="function"&&(ml===null?ml=new Set([this]):ml.add(this));var Z=x.stack;this.componentDidCatch(x.value,{componentStack:Z!==null?Z:""})})}function sy(s,c,p,x,N){if(p.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(c=p.alternate,c!==null&&Ju(c,p,N,!0),p=ua.current,p!==null){switch(p.tag){case 13:return Mr===null?um():p.alternate===null&&Ti===0&&(Ti=3),p.flags&=-257,p.flags|=65536,p.lanes=N,x===vp?p.flags|=16384:(c=p.updateQueue,c===null?p.updateQueue=new Set([x]):c.add(x),fm(s,x,N)),!1;case 22:return p.flags|=65536,x===vp?p.flags|=16384:(c=p.updateQueue,c===null?(c={transitions:null,markerInstances:null,retryQueue:new Set([x])},p.updateQueue=c):(p=c.retryQueue,p===null?c.retryQueue=new Set([x]):p.add(x)),fm(s,x,N)),!1}throw Error(r(435,p.tag))}return fm(s,x,N),um(),!1}if(an)return c=ua.current,c!==null?((c.flags&65536)===0&&(c.flags|=256),c.flags|=65536,c.lanes=N,x!==qc&&(s=Error(r(422),{cause:x}),il(_i(s,p)))):(x!==qc&&(c=Error(r(423),{cause:x}),il(_i(c,p))),s=s.current.alternate,s.flags|=65536,N&=-N,s.lanes|=N,x=_i(x,p),N=Hh(s.stateNode,x,N),Ja(s,N),Ti!==4&&(Ti=2)),!1;var D=Error(r(520),{cause:x});if(D=_i(D,p),kd===null?kd=[D]:kd.push(D),Ti!==4&&(Ti=2),c===null)return!0;x=_i(x,p),p=c;do{switch(p.tag){case 3:return p.flags|=65536,s=N&-N,p.lanes|=s,s=Hh(p.stateNode,x,s),Ja(p,s),!1;case 1:if(c=p.type,D=p.stateNode,(p.flags&128)===0&&(typeof c.getDerivedStateFromError=="function"||D!==null&&typeof D.componentDidCatch=="function"&&(ml===null||!ml.has(D))))return p.flags|=65536,N&=-N,p.lanes|=N,N=Hp(N),ay(N,s,p,x),Ja(p,N),!1}p=p.return}while(p!==null);return!1}var oy=Error(r(461)),Zi=!1;function pi(s,c,p,x){c.child=s===null?ty(c,null,p,x):cc(c,s.child,p,x)}function Gh(s,c,p,x,N){p=p.render;var D=c.ref;if("ref"in x){var H={};for(var Z in x)Z!=="ref"&&(H[Z]=x[Z])}else H=x;return Zl(c),x=jp(s,c,p,H,D,N),Z=Cp(),s!==null&&!Zi?(rc(s,c,N),xo(s,c,N)):(an&&Z&&Pt(c),c.flags|=1,pi(s,c,x,N),c.child)}function Yh(s,c,p,x,N){if(s===null){var D=p.type;return typeof D=="function"&&!Es(D)&&D.defaultProps===void 0&&p.compare===null?(c.tag=15,c.type=D,Wh(s,c,D,x,N)):(s=Uc(p.type,null,x,c,c.mode,N),s.ref=c.ref,s.return=c,c.child=s)}if(D=s.child,!Za(s,N)){var H=D.memoizedProps;if(p=p.compare,p=p!==null?p:kr,p(H,x)&&s.ref===c.ref)return xo(s,c,N)}return c.flags|=1,s=Xi(D,x),s.ref=c.ref,s.return=c,c.child=s}function Wh(s,c,p,x,N){if(s!==null){var D=s.memoizedProps;if(kr(D,x)&&s.ref===c.ref)if(Zi=!1,c.pendingProps=x=D,Za(s,N))(s.flags&131072)!==0&&(Zi=!0);else return c.lanes=s.lanes,xo(s,c,N)}return Xc(s,c,p,x,N)}function xd(s,c,p){var x=c.pendingProps,N=x.children,D=s!==null?s.memoizedState:null;if(x.mode==="hidden"){if((c.flags&128)!==0){if(x=D!==null?D.baseLanes|p:p,s!==null){for(N=c.child=s.child,D=0;N!==null;)D=D|N.lanes|N.childLanes,N=N.sibling;c.childLanes=D&~x}else c.childLanes=0,c.child=null;return dc(s,c,x,p)}if((p&536870912)!==0)c.memoizedState={baseLanes:0,cachePool:null},s!==null&&_h(c,D!==null?D.cachePool:null),D!==null?po(c,D):Th(),ny(c);else return c.lanes=c.childLanes=536870912,dc(s,c,D!==null?D.baseLanes|p:p,p)}else D!==null?(_h(c,D.cachePool),po(c,D),yo(),c.memoizedState=null):(s!==null&&_h(c,null),Th(),yo());return pi(s,c,N,p),c.child}function dc(s,c,p,x){var N=ho();return N=N===null?null:{parent:ai._currentValue,pool:N},c.memoizedState={baseLanes:p,cachePool:N},s!==null&&_h(c,null),Th(),ny(c),s!==null&&Ju(s,c,x,!0),null}function $t(s,c){var p=c.ref;if(p===null)s!==null&&s.ref!==null&&(c.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(r(284));(s===null||s.ref!==p)&&(c.flags|=4194816)}}function Xc(s,c,p,x,N){return Zl(c),p=jp(s,c,p,x,void 0,N),x=Cp(),s!==null&&!Zi?(rc(s,c,N),xo(s,c,N)):(an&&x&&Pt(c),c.flags|=1,pi(s,c,p,N),c.child)}function Qh(s,c,p,x,N,D){return Zl(c),c.updateQueue=null,p=Ug(c,x,p,N),Bg(s),x=Cp(),s!==null&&!Zi?(rc(s,c,D),xo(s,c,D)):(an&&x&&Pt(c),c.flags|=1,pi(s,c,p,D),c.child)}function ul(s,c,p,x,N){if(Zl(c),c.stateNode===null){var D=co,H=p.contextType;typeof H=="object"&&H!==null&&(D=Ci(H)),D=new p(x,D),c.memoizedState=D.state!==null&&D.state!==void 0?D.state:null,D.updater=md,c.stateNode=D,D._reactInternals=c,D=c.stateNode,D.props=x,D.state=c.memoizedState,D.refs={},tc(c),H=p.contextType,D.context=typeof H=="object"&&H!==null?Ci(H):co,D.state=c.memoizedState,H=p.getDerivedStateFromProps,typeof H=="function"&&(Kc(c,p,H,x),D.state=c.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof D.getSnapshotBeforeUpdate=="function"||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(H=D.state,typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount(),H!==D.state&&md.enqueueReplaceState(D,D.state,null),xr(c,x,D,N),Ka(),D.state=c.memoizedState),typeof D.componentDidMount=="function"&&(c.flags|=4194308),x=!0}else if(s===null){D=c.stateNode;var Z=c.memoizedProps,we=cl(p,Z);D.props=we;var Ue=D.context,et=p.contextType;H=co,typeof et=="object"&&et!==null&&(H=Ci(et));var ot=p.getDerivedStateFromProps;et=typeof ot=="function"||typeof D.getSnapshotBeforeUpdate=="function",Z=c.pendingProps!==Z,et||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(Z||Ue!==H)&&iy(c,D,x,H),As=!1;var We=c.memoizedState;D.state=We,xr(c,x,D,N),Ka(),Ue=c.memoizedState,Z||We!==Ue||As?(typeof ot=="function"&&(Kc(c,p,ot,x),Ue=c.memoizedState),(we=As||gd(c,p,we,x,We,Ue,H))?(et||typeof D.UNSAFE_componentWillMount!="function"&&typeof D.componentWillMount!="function"||(typeof D.componentWillMount=="function"&&D.componentWillMount(),typeof D.UNSAFE_componentWillMount=="function"&&D.UNSAFE_componentWillMount()),typeof D.componentDidMount=="function"&&(c.flags|=4194308)):(typeof D.componentDidMount=="function"&&(c.flags|=4194308),c.memoizedProps=x,c.memoizedState=Ue),D.props=x,D.state=Ue,D.context=H,x=we):(typeof D.componentDidMount=="function"&&(c.flags|=4194308),x=!1)}else{D=c.stateNode,Gc(s,c),H=c.memoizedProps,et=cl(p,H),D.props=et,ot=c.pendingProps,We=D.context,Ue=p.contextType,we=co,typeof Ue=="object"&&Ue!==null&&(we=Ci(Ue)),Z=p.getDerivedStateFromProps,(Ue=typeof Z=="function"||typeof D.getSnapshotBeforeUpdate=="function")||typeof D.UNSAFE_componentWillReceiveProps!="function"&&typeof D.componentWillReceiveProps!="function"||(H!==ot||We!==we)&&iy(c,D,x,we),As=!1,We=c.memoizedState,D.state=We,xr(c,x,D,N),Ka();var qe=c.memoizedState;H!==ot||We!==qe||As||s!==null&&s.dependencies!==null&&Sh(s.dependencies)?(typeof Z=="function"&&(Kc(c,p,Z,x),qe=c.memoizedState),(et=As||gd(c,p,et,x,We,qe,we)||s!==null&&s.dependencies!==null&&Sh(s.dependencies))?(Ue||typeof D.UNSAFE_componentWillUpdate!="function"&&typeof D.componentWillUpdate!="function"||(typeof D.componentWillUpdate=="function"&&D.componentWillUpdate(x,qe,we),typeof D.UNSAFE_componentWillUpdate=="function"&&D.UNSAFE_componentWillUpdate(x,qe,we)),typeof D.componentDidUpdate=="function"&&(c.flags|=4),typeof D.getSnapshotBeforeUpdate=="function"&&(c.flags|=1024)):(typeof D.componentDidUpdate!="function"||H===s.memoizedProps&&We===s.memoizedState||(c.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||H===s.memoizedProps&&We===s.memoizedState||(c.flags|=1024),c.memoizedProps=x,c.memoizedState=qe),D.props=x,D.state=qe,D.context=we,x=et):(typeof D.componentDidUpdate!="function"||H===s.memoizedProps&&We===s.memoizedState||(c.flags|=4),typeof D.getSnapshotBeforeUpdate!="function"||H===s.memoizedProps&&We===s.memoizedState||(c.flags|=1024),x=!1)}return D=x,$t(s,c),x=(c.flags&128)!==0,D||x?(D=c.stateNode,p=x&&typeof p.getDerivedStateFromError!="function"?null:D.render(),c.flags|=1,s!==null&&x?(c.child=cc(c,s.child,null,N),c.child=cc(c,null,p,N)):pi(s,c,p,N),c.memoizedState=D.state,s=c.child):s=xo(s,c,N),s}function ly(s,c,p,x){return Qu(),c.flags|=256,pi(s,c,p,x),c.child}var bd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Jh(s){return{baseLanes:s,cachePool:Mg()}}function er(s,c,p){return s=s!==null?s.childLanes&~p:0,c&&(s|=Ca),s}function cy(s,c,p){var x=c.pendingProps,N=!1,D=(c.flags&128)!==0,H;if((H=D)||(H=s!==null&&s.memoizedState===null?!1:(ki.current&2)!==0),H&&(N=!0,c.flags&=-129),H=(c.flags&32)!==0,c.flags&=-33,s===null){if(an){if(N?ja(c):yo(),an){var Z=Gn,we;if(we=Z){e:{for(we=Z,Z=Oi;we.nodeType!==8;){if(!Z){Z=null;break e}if(we=ts(we.nextSibling),we===null){Z=null;break e}}Z=we}Z!==null?(c.memoizedState={dehydrated:Z,treeContext:le!==null?{id:se,overflow:_e}:null,retryLane:536870912,hydrationErrors:null},we=yr(18,null,null,0),we.stateNode=Z,we.return=c,c.child=we,_n=c,Gn=null,we=!0):we=!1}we||wa(c)}if(Z=c.memoizedState,Z!==null&&(Z=Z.dehydrated,Z!==null))return Or(Z)?c.lanes=32:c.lanes=536870912,null;Ps(c)}return Z=x.children,x=x.fallback,N?(yo(),N=c.mode,Z=vd({mode:"hidden",children:Z},N),x=uo(x,N,p,null),Z.return=c,x.return=c,Z.sibling=x,c.child=Z,N=c.child,N.memoizedState=Jh(p),N.childLanes=er(s,H,p),c.memoizedState=bd,x):(ja(c),Gp(c,Z))}if(we=s.memoizedState,we!==null&&(Z=we.dehydrated,Z!==null)){if(D)c.flags&256?(ja(c),c.flags&=-257,c=Yp(s,c,p)):c.memoizedState!==null?(yo(),c.child=s.child,c.flags|=128,c=null):(yo(),N=x.fallback,Z=c.mode,x=vd({mode:"visible",children:x.children},Z),N=uo(N,Z,p,null),N.flags|=2,x.return=c,N.return=c,x.sibling=N,c.child=x,cc(c,s.child,null,p),x=c.child,x.memoizedState=Jh(p),x.childLanes=er(s,H,p),c.memoizedState=bd,c=N);else if(ja(c),Or(Z)){if(H=Z.nextSibling&&Z.nextSibling.dataset,H)var Ue=H.dgst;H=Ue,x=Error(r(419)),x.stack="",x.digest=H,il({value:x,source:null,stack:null}),c=Yp(s,c,p)}else if(Zi||Ju(s,c,p,!1),H=(p&s.childLanes)!==0,Zi||H){if(H=ci,H!==null&&(x=p&-p,x=(x&42)!==0?1:Lt(x),x=(x&(H.suspendedLanes|p))!==0?0:x,x!==0&&x!==we.retryLane))throw we.retryLane=x,lo(s,x),fa(H,s,x),oy;Z.data==="$?"||um(),c=Yp(s,c,p)}else Z.data==="$?"?(c.flags|=192,c.child=s.child,c=null):(s=we.treeContext,Gn=ts(Z.nextSibling),_n=c,an=!0,Ur=null,Oi=!1,s!==null&&(Pr[G++]=se,Pr[G++]=_e,Pr[G++]=le,se=s.id,_e=s.overflow,le=c),c=Gp(c,x.children),c.flags|=4096);return c}return N?(yo(),N=x.fallback,Z=c.mode,we=s.child,Ue=we.sibling,x=Xi(we,{mode:"hidden",children:x.children}),x.subtreeFlags=we.subtreeFlags&65011712,Ue!==null?N=Xi(Ue,N):(N=uo(N,Z,p,null),N.flags|=2),N.return=c,x.return=c,x.sibling=N,c.child=x,x=N,N=c.child,Z=s.child.memoizedState,Z===null?Z=Jh(p):(we=Z.cachePool,we!==null?(Ue=ai._currentValue,we=we.parent!==Ue?{parent:Ue,pool:Ue}:we):we=Mg(),Z={baseLanes:Z.baseLanes|p,cachePool:we}),N.memoizedState=Z,N.childLanes=er(s,H,p),c.memoizedState=bd,x):(ja(c),p=s.child,s=p.sibling,p=Xi(p,{mode:"visible",children:x.children}),p.return=c,p.sibling=null,s!==null&&(H=c.deletions,H===null?(c.deletions=[s],c.flags|=16):H.push(s)),c.child=p,c.memoizedState=null,p)}function Gp(s,c){return c=vd({mode:"visible",children:c},s.mode),c.return=s,s.child=c}function vd(s,c){return s=yr(22,s,null,c),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function Yp(s,c,p){return cc(c,s.child,null,p),s=Gp(c,c.pendingProps.children),s.flags|=2,c.memoizedState=null,s}function Wp(s,c,p){s.lanes|=c;var x=s.alternate;x!==null&&(x.lanes|=c),qr(s.return,c,p)}function Qp(s,c,p,x,N){var D=s.memoizedState;D===null?s.memoizedState={isBackwards:c,rendering:null,renderingStartTime:0,last:x,tail:p,tailMode:N}:(D.isBackwards=c,D.rendering=null,D.renderingStartTime=0,D.last=x,D.tail=p,D.tailMode=N)}function uy(s,c,p){var x=c.pendingProps,N=x.revealOrder,D=x.tail;if(pi(s,c,x.children,p),x=ki.current,(x&2)!==0)x=x&1|2,c.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=c.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Wp(s,p,c);else if(s.tag===19)Wp(s,p,c);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===c)break e;for(;s.sibling===null;){if(s.return===null||s.return===c)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}x&=1}switch(M(ki,x),N){case"forwards":for(p=c.child,N=null;p!==null;)s=p.alternate,s!==null&&pd(s)===null&&(N=p),p=p.sibling;p=N,p===null?(N=c.child,c.child=null):(N=p.sibling,p.sibling=null),Qp(c,!1,N,p,D);break;case"backwards":for(p=null,N=c.child,c.child=null;N!==null;){if(s=N.alternate,s!==null&&pd(s)===null){c.child=N;break}s=N.sibling,N.sibling=p,p=N,N=s}Qp(c,!0,p,null,D);break;case"together":Qp(c,!1,null,null,void 0);break;default:c.memoizedState=null}return c.child}function xo(s,c,p){if(s!==null&&(c.dependencies=s.dependencies),pl|=c.lanes,(p&c.childLanes)===0)if(s!==null){if(Ju(s,c,p,!1),(p&c.childLanes)===0)return null}else return null;if(s!==null&&c.child!==s.child)throw Error(r(153));if(c.child!==null){for(s=c.child,p=Xi(s,s.pendingProps),c.child=p,p.return=c;s.sibling!==null;)s=s.sibling,p=p.sibling=Xi(s,s.pendingProps),p.return=c;p.sibling=null}return c.child}function Za(s,c){return(s.lanes&c)!==0?!0:(s=s.dependencies,!!(s!==null&&Sh(s)))}function Rr(s,c,p){switch(c.tag){case 3:me(c,c.stateNode.containerInfo),la(c,ai,s.memoizedState.cache),Qu();break;case 27:case 5:Le(c);break;case 4:me(c,c.stateNode.containerInfo);break;case 10:la(c,c.type,c.memoizedProps.value);break;case 13:var x=c.memoizedState;if(x!==null)return x.dehydrated!==null?(ja(c),c.flags|=128,null):(p&c.child.childLanes)!==0?cy(s,c,p):(ja(c),s=xo(s,c,p),s!==null?s.sibling:null);ja(c);break;case 19:var N=(s.flags&128)!==0;if(x=(p&c.childLanes)!==0,x||(Ju(s,c,p,!1),x=(p&c.childLanes)!==0),N){if(x)return uy(s,c,p);c.flags|=128}if(N=c.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),M(ki,ki.current),x)break;return null;case 22:case 23:return c.lanes=0,xd(s,c,p);case 24:la(c,ai,s.memoizedState.cache)}return xo(s,c,p)}function Kh(s,c,p){if(s!==null)if(s.memoizedProps!==c.pendingProps)Zi=!0;else{if(!Za(s,p)&&(c.flags&128)===0)return Zi=!1,Rr(s,c,p);Zi=(s.flags&131072)!==0}else Zi=!1,an&&(c.flags&1048576)!==0&&St(c,nl,c.index);switch(c.lanes=0,c.tag){case 16:e:{s=c.pendingProps;var x=c.elementType,N=x._init;if(x=N(x._payload),c.type=x,typeof x=="function")Es(x)?(s=cl(x,s),c.tag=1,c=ul(null,c,x,s,p)):(c.tag=0,c=Xc(null,c,x,s,p));else{if(x!=null){if(N=x.$$typeof,N===q){c.tag=11,c=Gh(null,c,x,s,p);break e}else if(N===B){c.tag=14,c=Yh(null,c,x,s,p);break e}}throw c=ie(x)||x,Error(r(306,c,""))}}return c;case 0:return Xc(s,c,c.type,c.pendingProps,p);case 1:return x=c.type,N=cl(x,c.pendingProps),ul(s,c,x,N,p);case 3:e:{if(me(c,c.stateNode.containerInfo),s===null)throw Error(r(387));x=c.pendingProps;var D=c.memoizedState;N=D.element,Gc(s,c),xr(c,x,null,p);var H=c.memoizedState;if(x=H.cache,la(c,ai,x),x!==D.cache&&gn(c,[ai],p,!0),Ka(),x=H.element,D.isDehydrated)if(D={element:x,isDehydrated:!1,cache:H.cache},c.updateQueue.baseState=D,c.memoizedState=D,c.flags&256){c=ly(s,c,x,p);break e}else if(x!==N){N=_i(Error(r(424)),c),il(N),c=ly(s,c,x,p);break e}else{switch(s=c.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Gn=ts(s.firstChild),_n=c,an=!0,Ur=null,Oi=!0,p=ty(c,null,x,p),c.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(Qu(),x===N){c=xo(s,c,p);break e}pi(s,c,x,p)}c=c.child}return c;case 26:return $t(s,c),s===null?(p=sx(c.type,null,c.pendingProps,null))?c.memoizedState=p:an||(p=c.type,s=c.pendingProps,x=pc(he.current).createElement(p),x[mn]=c,x[Dn]=s,Hi(x,p,s),Mn(x),c.stateNode=x):c.memoizedState=sx(c.type,s.memoizedProps,c.pendingProps,s.memoizedState),null;case 27:return Le(c),s===null&&an&&(x=c.stateNode=ix(c.type,c.pendingProps,he.current),_n=c,Oi=!0,N=Gn,ka(c.type)?(Nm=N,Gn=ts(x.firstChild)):Gn=N),pi(s,c,c.pendingProps.children,p),$t(s,c),s===null&&(c.flags|=4194304),c.child;case 5:return s===null&&an&&((N=x=Gn)&&(x=tx(x,c.type,c.pendingProps,Oi),x!==null?(c.stateNode=x,_n=c,Gn=ts(x.firstChild),Oi=!1,N=!0):N=!1),N||wa(c)),Le(c),N=c.type,D=c.pendingProps,H=s!==null?s.memoizedProps:null,x=D.children,mf(N,D)?x=null:H!==null&&mf(N,H)&&(c.flags|=32),c.memoizedState!==null&&(N=jp(s,c,_p,null,null,p),yu._currentValue=N),$t(s,c),pi(s,c,x,p),c.child;case 6:return s===null&&an&&((s=p=Gn)&&(p=yf(p,c.pendingProps,Oi),p!==null?(c.stateNode=p,_n=c,Gn=null,s=!0):s=!1),s||wa(c)),null;case 13:return cy(s,c,p);case 4:return me(c,c.stateNode.containerInfo),x=c.pendingProps,s===null?c.child=cc(c,null,x,p):pi(s,c,x,p),c.child;case 11:return Gh(s,c,c.type,c.pendingProps,p);case 7:return pi(s,c,c.pendingProps,p),c.child;case 8:return pi(s,c,c.pendingProps.children,p),c.child;case 12:return pi(s,c,c.pendingProps.children,p),c.child;case 10:return x=c.pendingProps,la(c,c.type,x.value),pi(s,c,x.children,p),c.child;case 9:return N=c.type._context,x=c.pendingProps.children,Zl(c),N=Ci(N),x=x(N),c.flags|=1,pi(s,c,x,p),c.child;case 14:return Yh(s,c,c.type,c.pendingProps,p);case 15:return Wh(s,c,c.type,c.pendingProps,p);case 19:return uy(s,c,p);case 31:return x=c.pendingProps,p=c.mode,x={mode:x.mode,children:x.children},s===null?(p=vd(x,p),p.ref=c.ref,c.child=p,p.return=c,c=p):(p=Xi(s.child,x),p.ref=c.ref,c.child=p,p.return=c,c=p),c;case 22:return xd(s,c,p);case 24:return Zl(c),x=Ci(ai),s===null?(N=ho(),N===null&&(N=ci,D=xp(),N.pooledCache=D,D.refCount++,D!==null&&(N.pooledCacheLanes|=p),N=D),c.memoizedState={parent:x,cache:N},tc(c),la(c,ai,N)):((s.lanes&p)!==0&&(Gc(s,c),xr(c,null,null,p),Ka()),N=s.memoizedState,D=c.memoizedState,N.parent!==x?(N={parent:x,cache:x},c.memoizedState=N,c.lanes===0&&(c.memoizedState=c.updateQueue.baseState=N),la(c,ai,x)):(x=D.cache,la(c,ai,x),x!==N.cache&&gn(c,[ai],p,!0))),pi(s,c,c.pendingProps.children,p),c.child;case 29:throw c.pendingProps}throw Error(r(156,c.tag))}function bo(s){s.flags|=4}function Xh(s,c){if(c.type!=="stylesheet"||(c.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Gi(c)){if(c=ua.current,c!==null&&((In&4194048)===In?Mr!==null:(In&62914560)!==In&&(In&536870912)===0||c!==Mr))throw Hc=vp,Rg;s.flags|=8192}}function Zh(s,c){c!==null&&(s.flags|=4),s.flags&16384&&(c=s.tag!==22?wt():536870912,s.lanes|=c,au|=c)}function wd(s,c){if(!an)switch(s.tailMode){case"hidden":c=s.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?s.tail=null:p.sibling=null;break;case"collapsed":p=s.tail;for(var x=null;p!==null;)p.alternate!==null&&(x=p),p=p.sibling;x===null?c||s.tail===null?s.tail=null:s.tail.sibling=null:x.sibling=null}}function si(s){var c=s.alternate!==null&&s.alternate.child===s.child,p=0,x=0;if(c)for(var N=s.child;N!==null;)p|=N.lanes|N.childLanes,x|=N.subtreeFlags&65011712,x|=N.flags&65011712,N.return=s,N=N.sibling;else for(N=s.child;N!==null;)p|=N.lanes|N.childLanes,x|=N.subtreeFlags,x|=N.flags,N.return=s,N=N.sibling;return s.subtreeFlags|=x,s.childLanes=p,c}function dy(s,c,p){var x=c.pendingProps;switch(Et(c),c.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return si(c),null;case 1:return si(c),null;case 3:return p=c.stateNode,x=null,s!==null&&(x=s.memoizedState.cache),c.memoizedState.cache!==x&&(c.flags|=2048),Na(ai),de(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(s===null||s.child===null)&&(Wu(c)?bo(c):s===null||s.memoizedState.isDehydrated&&(c.flags&256)===0||(c.flags|=1024,Ag())),si(c),null;case 26:return p=c.memoizedState,s===null?(bo(c),p!==null?(si(c),Xh(c,p)):(si(c),c.flags&=-16777217)):p?p!==s.memoizedState?(bo(c),si(c),Xh(c,p)):(si(c),c.flags&=-16777217):(s.memoizedProps!==x&&bo(c),si(c),c.flags&=-16777217),null;case 27:He(c),p=he.current;var N=c.type;if(s!==null&&c.stateNode!=null)s.memoizedProps!==x&&bo(c);else{if(!x){if(c.stateNode===null)throw Error(r(166));return si(c),null}s=Se.current,Wu(c)?Tg(c):(s=ix(N,x,p),c.stateNode=s,bo(c))}return si(c),null;case 5:if(He(c),p=c.type,s!==null&&c.stateNode!=null)s.memoizedProps!==x&&bo(c);else{if(!x){if(c.stateNode===null)throw Error(r(166));return si(c),null}if(s=Se.current,Wu(c))Tg(c);else{switch(N=pc(he.current),s){case 1:s=N.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:s=N.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":s=N.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":s=N.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":s=N.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof x.is=="string"?N.createElement("select",{is:x.is}):N.createElement("select"),x.multiple?s.multiple=!0:x.size&&(s.size=x.size);break;default:s=typeof x.is=="string"?N.createElement(p,{is:x.is}):N.createElement(p)}}s[mn]=c,s[Dn]=x;e:for(N=c.child;N!==null;){if(N.tag===5||N.tag===6)s.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===c)break e;for(;N.sibling===null;){if(N.return===null||N.return===c)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}c.stateNode=s;e:switch(Hi(s,p,x),p){case"button":case"input":case"select":case"textarea":s=!!x.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&bo(c)}}return si(c),c.flags&=-16777217,null;case 6:if(s&&c.stateNode!=null)s.memoizedProps!==x&&bo(c);else{if(typeof x!="string"&&c.stateNode===null)throw Error(r(166));if(s=he.current,Wu(c)){if(s=c.stateNode,p=c.memoizedProps,x=null,N=_n,N!==null)switch(N.tag){case 27:case 5:x=N.memoizedProps}s[mn]=c,s=!!(s.nodeValue===p||x!==null&&x.suppressHydrationWarning===!0||Ky(s.nodeValue,p)),s||wa(c)}else s=pc(s).createTextNode(x),s[mn]=c,c.stateNode=s}return si(c),null;case 13:if(x=c.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(N=Wu(c),x!==null&&x.dehydrated!==null){if(s===null){if(!N)throw Error(r(318));if(N=c.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(r(317));N[mn]=c}else Qu(),(c.flags&128)===0&&(c.memoizedState=null),c.flags|=4;si(c),N=!1}else N=Ag(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=N),N=!0;if(!N)return c.flags&256?(Ps(c),c):(Ps(c),null)}if(Ps(c),(c.flags&128)!==0)return c.lanes=p,c;if(p=x!==null,s=s!==null&&s.memoizedState!==null,p){x=c.child,N=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(N=x.alternate.memoizedState.cachePool.pool);var D=null;x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(D=x.memoizedState.cachePool.pool),D!==N&&(x.flags|=2048)}return p!==s&&p&&(c.child.flags|=8192),Zh(c,c.updateQueue),si(c),null;case 4:return de(),s===null&&xm(c.stateNode.containerInfo),si(c),null;case 10:return Na(c.type),si(c),null;case 19:if(xe(ki),N=c.memoizedState,N===null)return si(c),null;if(x=(c.flags&128)!==0,D=N.rendering,D===null)if(x)wd(N,!1);else{if(Ti!==0||s!==null&&(s.flags&128)!==0)for(s=c.child;s!==null;){if(D=pd(s),D!==null){for(c.flags|=128,wd(N,!1),s=D.updateQueue,c.updateQueue=s,Zh(c,s),c.subtreeFlags=0,s=p,p=c.child;p!==null;)el(p,s),p=p.sibling;return M(ki,ki.current&1|2),c.child}s=s.sibling}N.tail!==null&&ut()>su&&(c.flags|=128,x=!0,wd(N,!1),c.lanes=4194304)}else{if(!x)if(s=pd(D),s!==null){if(c.flags|=128,x=!0,s=s.updateQueue,c.updateQueue=s,Zh(c,s),wd(N,!0),N.tail===null&&N.tailMode==="hidden"&&!D.alternate&&!an)return si(c),null}else 2*ut()-N.renderingStartTime>su&&p!==536870912&&(c.flags|=128,x=!0,wd(N,!1),c.lanes=4194304);N.isBackwards?(D.sibling=c.child,c.child=D):(s=N.last,s!==null?s.sibling=D:c.child=D,N.last=D)}return N.tail!==null?(c=N.tail,N.rendering=c,N.tail=c.sibling,N.renderingStartTime=ut(),c.sibling=null,s=ki.current,M(ki,x?s&1|2:s&1),c):(si(c),null);case 22:case 23:return Ps(c),Sp(),x=c.memoizedState!==null,s!==null?s.memoizedState!==null!==x&&(c.flags|=8192):x&&(c.flags|=8192),x?(p&536870912)!==0&&(c.flags&128)===0&&(si(c),c.subtreeFlags&6&&(c.flags|=8192)):si(c),p=c.updateQueue,p!==null&&Zh(c,p.retryQueue),p=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),x=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(x=c.memoizedState.cachePool.pool),x!==p&&(c.flags|=2048),s!==null&&xe(ec),null;case 24:return p=null,s!==null&&(p=s.memoizedState.cache),c.memoizedState.cache!==p&&(c.flags|=2048),Na(ai),si(c),null;case 25:return null;case 30:return null}throw Error(r(156,c.tag))}function hy(s,c){switch(Et(c),c.tag){case 1:return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 3:return Na(ai),de(),s=c.flags,(s&65536)!==0&&(s&128)===0?(c.flags=s&-65537|128,c):null;case 26:case 27:case 5:return He(c),null;case 13:if(Ps(c),s=c.memoizedState,s!==null&&s.dehydrated!==null){if(c.alternate===null)throw Error(r(340));Qu()}return s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 19:return xe(ki),null;case 4:return de(),null;case 10:return Na(c.type),null;case 22:case 23:return Ps(c),Sp(),s!==null&&xe(ec),s=c.flags,s&65536?(c.flags=s&-65537|128,c):null;case 24:return Na(ai),null;case 25:return null;default:return null}}function fy(s,c){switch(Et(c),c.tag){case 3:Na(ai),de();break;case 26:case 27:case 5:He(c);break;case 4:de();break;case 13:Ps(c);break;case 19:xe(ki);break;case 10:Na(c.type);break;case 22:case 23:Ps(c),Sp(),s!==null&&xe(ec);break;case 24:Na(ai)}}function Nd(s,c){try{var p=c.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var N=x.next;p=N;do{if((p.tag&s)===s){x=void 0;var D=p.create,H=p.inst;x=D(),H.destroy=x}p=p.next}while(p!==N)}}catch(Z){oi(c,c.return,Z)}}function dl(s,c,p){try{var x=c.updateQueue,N=x!==null?x.lastEffect:null;if(N!==null){var D=N.next;x=D;do{if((x.tag&s)===s){var H=x.inst,Z=H.destroy;if(Z!==void 0){H.destroy=void 0,N=c;var we=p,Ue=Z;try{Ue()}catch(et){oi(N,we,et)}}}x=x.next}while(x!==D)}}catch(et){oi(c,c.return,et)}}function py(s){var c=s.updateQueue;if(c!==null){var p=s.stateNode;try{Np(c,p)}catch(x){oi(s,s.return,x)}}}function Jp(s,c,p){p.props=cl(s.type,s.memoizedProps),p.state=s.memoizedState;try{p.componentWillUnmount()}catch(x){oi(s,c,x)}}function Zc(s,c){try{var p=s.ref;if(p!==null){switch(s.tag){case 26:case 27:case 5:var x=s.stateNode;break;case 30:x=s.stateNode;break;default:x=s.stateNode}typeof p=="function"?s.refCleanup=p(x):p.current=x}}catch(N){oi(s,c,N)}}function Ms(s,c){var p=s.ref,x=s.refCleanup;if(p!==null)if(typeof x=="function")try{x()}catch(N){oi(s,c,N)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(N){oi(s,c,N)}else p.current=null}function ef(s){var c=s.type,p=s.memoizedProps,x=s.stateNode;try{e:switch(c){case"button":case"input":case"select":case"textarea":p.autoFocus&&x.focus();break e;case"img":p.src?x.src=p.src:p.srcSet&&(x.srcset=p.srcSet)}}catch(N){oi(s,s.return,N)}}function tf(s,c,p){try{var x=s.stateNode;wv(x,s.type,p,c),x[Dn]=c}catch(N){oi(s,s.return,N)}}function eu(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ka(s.type)||s.tag===4}function Sd(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||eu(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ka(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function nf(s,c,p){var x=s.tag;if(x===5||x===6)s=s.stateNode,c?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(s,c):(c=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,c.appendChild(s),p=p._reactRootContainer,p!=null||c.onclick!==null||(c.onclick=ff));else if(x!==4&&(x===27&&ka(s.type)&&(p=s.stateNode,c=null),s=s.child,s!==null))for(nf(s,c,p),s=s.sibling;s!==null;)nf(s,c,p),s=s.sibling}function jd(s,c,p){var x=s.tag;if(x===5||x===6)s=s.stateNode,c?p.insertBefore(s,c):p.appendChild(s);else if(x!==4&&(x===27&&ka(s.type)&&(p=s.stateNode),s=s.child,s!==null))for(jd(s,c,p),s=s.sibling;s!==null;)jd(s,c,p),s=s.sibling}function _d(s){var c=s.stateNode,p=s.memoizedProps;try{for(var x=s.type,N=c.attributes;N.length;)c.removeAttributeNode(N[0]);Hi(c,x,p),c[mn]=s,c[Dn]=p}catch(D){oi(s,s.return,D)}}var Rs=!1,Vn=!1,vo=!1,my=typeof WeakSet=="function"?WeakSet:Set,qi=null;function ov(s,c){if(s=s.containerInfo,es=wf,s=Nh(s),qu(s)){if("selectionStart"in s)var p={start:s.selectionStart,end:s.selectionEnd};else e:{p=(p=s.ownerDocument)&&p.defaultView||window;var x=p.getSelection&&p.getSelection();if(x&&x.rangeCount!==0){p=x.anchorNode;var N=x.anchorOffset,D=x.focusNode;x=x.focusOffset;try{p.nodeType,D.nodeType}catch{p=null;break e}var H=0,Z=-1,we=-1,Ue=0,et=0,ot=s,We=null;t:for(;;){for(var qe;ot!==p||N!==0&&ot.nodeType!==3||(Z=H+N),ot!==D||x!==0&&ot.nodeType!==3||(we=H+x),ot.nodeType===3&&(H+=ot.nodeValue.length),(qe=ot.firstChild)!==null;)We=ot,ot=qe;for(;;){if(ot===s)break t;if(We===p&&++Ue===N&&(Z=H),We===D&&++et===x&&(we=H),(qe=ot.nextSibling)!==null)break;ot=We,We=ot.parentNode}ot=qe}p=Z===-1||we===-1?null:{start:Z,end:we}}else p=null}p=p||{start:0,end:0}}else p=null;for(pf={focusedElem:s,selectionRange:p},wf=!1,qi=c;qi!==null;)if(c=qi,s=c.child,(c.subtreeFlags&1024)!==0&&s!==null)s.return=c,qi=s;else for(;qi!==null;){switch(c=qi,D=c.alternate,s=c.flags,c.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&D!==null){s=void 0,p=c,N=D.memoizedProps,D=D.memoizedState,x=p.stateNode;try{var qt=cl(p.type,N,p.elementType===p.type);s=x.getSnapshotBeforeUpdate(qt,D),x.__reactInternalSnapshotBeforeUpdate=s}catch(Ut){oi(p,p.return,Ut)}}break;case 3:if((s&1024)!==0){if(s=c.stateNode.containerInfo,p=s.nodeType,p===9)wm(s);else if(p===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":wm(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=c.sibling,s!==null){s.return=c.return,qi=s;break}qi=c.return}}function gy(s,c,p){var x=p.flags;switch(p.tag){case 0:case 11:case 15:hl(s,p),x&4&&Nd(5,p);break;case 1:if(hl(s,p),x&4)if(s=p.stateNode,c===null)try{s.componentDidMount()}catch(H){oi(p,p.return,H)}else{var N=cl(p.type,c.memoizedProps);c=c.memoizedState;try{s.componentDidUpdate(N,c,s.__reactInternalSnapshotBeforeUpdate)}catch(H){oi(p,p.return,H)}}x&64&&py(p),x&512&&Zc(p,p.return);break;case 3:if(hl(s,p),x&64&&(s=p.updateQueue,s!==null)){if(c=null,p.child!==null)switch(p.child.tag){case 27:case 5:c=p.child.stateNode;break;case 1:c=p.child.stateNode}try{Np(s,c)}catch(H){oi(p,p.return,H)}}break;case 27:c===null&&x&4&&_d(p);case 26:case 5:hl(s,p),c===null&&x&4&&ef(p),x&512&&Zc(p,p.return);break;case 12:hl(s,p);break;case 13:hl(s,p),x&4&&by(s,p),x&64&&(s=p.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(p=lf.bind(null,p),hu(s,p))));break;case 22:if(x=p.memoizedState!==null||Rs,!x){c=c!==null&&c.memoizedState!==null||Vn,N=Rs;var D=Vn;Rs=x,(Vn=c)&&!D?No(s,p,(p.subtreeFlags&8772)!==0):hl(s,p),Rs=N,Vn=D}break;case 30:break;default:hl(s,p)}}function yy(s){var c=s.alternate;c!==null&&(s.alternate=null,yy(c)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(c=s.stateNode,c!==null&&Zn(c)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var yi=null,Wr=!1;function wo(s,c,p){for(p=p.child;p!==null;)xy(s,c,p),p=p.sibling}function xy(s,c,p){if(ue&&typeof ue.onCommitFiberUnmount=="function")try{ue.onCommitFiberUnmount(Q,p)}catch{}switch(p.tag){case 26:Vn||Ms(p,c),wo(s,c,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:Vn||Ms(p,c);var x=yi,N=Wr;ka(p.type)&&(yi=p.stateNode,Wr=!1),wo(s,c,p),Od(p.stateNode),yi=x,Wr=N;break;case 5:Vn||Ms(p,c);case 6:if(x=yi,N=Wr,yi=null,wo(s,c,p),yi=x,Wr=N,yi!==null)if(Wr)try{(yi.nodeType===9?yi.body:yi.nodeName==="HTML"?yi.ownerDocument.body:yi).removeChild(p.stateNode)}catch(D){oi(p,c,D)}else try{yi.removeChild(p.stateNode)}catch(D){oi(p,c,D)}break;case 18:yi!==null&&(Wr?(s=yi,gf(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,p.stateNode),Vd(s)):gf(yi,p.stateNode));break;case 4:x=yi,N=Wr,yi=p.stateNode.containerInfo,Wr=!0,wo(s,c,p),yi=x,Wr=N;break;case 0:case 11:case 14:case 15:Vn||dl(2,p,c),Vn||dl(4,p,c),wo(s,c,p);break;case 1:Vn||(Ms(p,c),x=p.stateNode,typeof x.componentWillUnmount=="function"&&Jp(p,c,x)),wo(s,c,p);break;case 21:wo(s,c,p);break;case 22:Vn=(x=Vn)||p.memoizedState!==null,wo(s,c,p),Vn=x;break;default:wo(s,c,p)}}function by(s,c){if(c.memoizedState===null&&(s=c.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Vd(s)}catch(p){oi(c,c.return,p)}}function lv(s){switch(s.tag){case 13:case 19:var c=s.stateNode;return c===null&&(c=s.stateNode=new my),c;case 22:return s=s.stateNode,c=s._retryCache,c===null&&(c=s._retryCache=new my),c;default:throw Error(r(435,s.tag))}}function Kp(s,c){var p=lv(s);c.forEach(function(x){var N=pv.bind(null,s,x);p.has(x)||(p.add(x),x.then(N,N))})}function da(s,c){var p=c.deletions;if(p!==null)for(var x=0;x<p.length;x++){var N=p[x],D=s,H=c,Z=H;e:for(;Z!==null;){switch(Z.tag){case 27:if(ka(Z.type)){yi=Z.stateNode,Wr=!1;break e}break;case 5:yi=Z.stateNode,Wr=!1;break e;case 3:case 4:yi=Z.stateNode.containerInfo,Wr=!0;break e}Z=Z.return}if(yi===null)throw Error(r(160));xy(D,H,N),yi=null,Wr=!1,D=N.alternate,D!==null&&(D.return=null),N.return=null}if(c.subtreeFlags&13878)for(c=c.child;c!==null;)Xp(c,s),c=c.sibling}var _a=null;function Xp(s,c){var p=s.alternate,x=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:da(c,s),Qr(s),x&4&&(dl(3,s,s.return),Nd(3,s),dl(5,s,s.return));break;case 1:da(c,s),Qr(s),x&512&&(Vn||p===null||Ms(p,p.return)),x&64&&Rs&&(s=s.updateQueue,s!==null&&(x=s.callbacks,x!==null&&(p=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=p===null?x:p.concat(x))));break;case 26:var N=_a;if(da(c,s),Qr(s),x&512&&(Vn||p===null||Ms(p,p.return)),x&4){var D=p!==null?p.memoizedState:null;if(x=s.memoizedState,p===null)if(x===null)if(s.stateNode===null){e:{x=s.type,p=s.memoizedProps,N=N.ownerDocument||N;t:switch(x){case"title":D=N.getElementsByTagName("title")[0],(!D||D[Xt]||D[mn]||D.namespaceURI==="http://www.w3.org/2000/svg"||D.hasAttribute("itemprop"))&&(D=N.createElement(x),N.head.insertBefore(D,N.querySelector("head > title"))),Hi(D,x,p),D[mn]=s,Mn(D),x=D;break e;case"link":var H=cx("link","href",N).get(x+(p.href||""));if(H){for(var Z=0;Z<H.length;Z++)if(D=H[Z],D.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&D.getAttribute("rel")===(p.rel==null?null:p.rel)&&D.getAttribute("title")===(p.title==null?null:p.title)&&D.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){H.splice(Z,1);break t}}D=N.createElement(x),Hi(D,x,p),N.head.appendChild(D);break;case"meta":if(H=cx("meta","content",N).get(x+(p.content||""))){for(Z=0;Z<H.length;Z++)if(D=H[Z],D.getAttribute("content")===(p.content==null?null:""+p.content)&&D.getAttribute("name")===(p.name==null?null:p.name)&&D.getAttribute("property")===(p.property==null?null:p.property)&&D.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&D.getAttribute("charset")===(p.charSet==null?null:p.charSet)){H.splice(Z,1);break t}}D=N.createElement(x),Hi(D,x,p),N.head.appendChild(D);break;default:throw Error(r(468,x))}D[mn]=s,Mn(D),x=D}s.stateNode=x}else ux(N,s.type,s.stateNode);else s.stateNode=lx(N,x,s.memoizedProps);else D!==x?(D===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):D.count--,x===null?ux(N,s.type,s.stateNode):lx(N,x,s.memoizedProps)):x===null&&s.stateNode!==null&&tf(s,s.memoizedProps,p.memoizedProps)}break;case 27:da(c,s),Qr(s),x&512&&(Vn||p===null||Ms(p,p.return)),p!==null&&x&4&&tf(s,s.memoizedProps,p.memoizedProps);break;case 5:if(da(c,s),Qr(s),x&512&&(Vn||p===null||Ms(p,p.return)),s.flags&32){N=s.stateNode;try{ms(N,"")}catch(qe){oi(s,s.return,qe)}}x&4&&s.stateNode!=null&&(N=s.memoizedProps,tf(s,N,p!==null?p.memoizedProps:N)),x&1024&&(vo=!0);break;case 6:if(da(c,s),Qr(s),x&4){if(s.stateNode===null)throw Error(r(162));x=s.memoizedProps,p=s.stateNode;try{p.nodeValue=x}catch(qe){oi(s,s.return,qe)}}break;case 3:if(gu=null,N=_a,_a=nn(c.containerInfo),da(c,s),_a=N,Qr(s),x&4&&p!==null&&p.memoizedState.isDehydrated)try{Vd(c.containerInfo)}catch(qe){oi(s,s.return,qe)}vo&&(vo=!1,vy(s));break;case 4:x=_a,_a=nn(s.stateNode.containerInfo),da(c,s),Qr(s),_a=x;break;case 12:da(c,s),Qr(s);break;case 13:da(c,s),Qr(s),s.child.flags&8192&&s.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(am=ut()),x&4&&(x=s.updateQueue,x!==null&&(s.updateQueue=null,Kp(s,x)));break;case 22:N=s.memoizedState!==null;var we=p!==null&&p.memoizedState!==null,Ue=Rs,et=Vn;if(Rs=Ue||N,Vn=et||we,da(c,s),Vn=et,Rs=Ue,Qr(s),x&8192)e:for(c=s.stateNode,c._visibility=N?c._visibility&-2:c._visibility|1,N&&(p===null||we||Rs||Vn||hc(s)),p=null,c=s;;){if(c.tag===5||c.tag===26){if(p===null){we=p=c;try{if(D=we.stateNode,N)H=D.style,typeof H.setProperty=="function"?H.setProperty("display","none","important"):H.display="none";else{Z=we.stateNode;var ot=we.memoizedProps.style,We=ot!=null&&ot.hasOwnProperty("display")?ot.display:null;Z.style.display=We==null||typeof We=="boolean"?"":(""+We).trim()}}catch(qe){oi(we,we.return,qe)}}}else if(c.tag===6){if(p===null){we=c;try{we.stateNode.nodeValue=N?"":we.memoizedProps}catch(qe){oi(we,we.return,qe)}}}else if((c.tag!==22&&c.tag!==23||c.memoizedState===null||c===s)&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break e;for(;c.sibling===null;){if(c.return===null||c.return===s)break e;p===c&&(p=null),c=c.return}p===c&&(p=null),c.sibling.return=c.return,c=c.sibling}x&4&&(x=s.updateQueue,x!==null&&(p=x.retryQueue,p!==null&&(x.retryQueue=null,Kp(s,p))));break;case 19:da(c,s),Qr(s),x&4&&(x=s.updateQueue,x!==null&&(s.updateQueue=null,Kp(s,x)));break;case 30:break;case 21:break;default:da(c,s),Qr(s)}}function Qr(s){var c=s.flags;if(c&2){try{for(var p,x=s.return;x!==null;){if(eu(x)){p=x;break}x=x.return}if(p==null)throw Error(r(160));switch(p.tag){case 27:var N=p.stateNode,D=Sd(s);jd(s,D,N);break;case 5:var H=p.stateNode;p.flags&32&&(ms(H,""),p.flags&=-33);var Z=Sd(s);jd(s,Z,H);break;case 3:case 4:var we=p.stateNode.containerInfo,Ue=Sd(s);nf(s,Ue,we);break;default:throw Error(r(161))}}catch(et){oi(s,s.return,et)}s.flags&=-3}c&4096&&(s.flags&=-4097)}function vy(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var c=s;vy(c),c.tag===5&&c.flags&1024&&c.stateNode.reset(),s=s.sibling}}function hl(s,c){if(c.subtreeFlags&8772)for(c=c.child;c!==null;)gy(s,c.alternate,c),c=c.sibling}function hc(s){for(s=s.child;s!==null;){var c=s;switch(c.tag){case 0:case 11:case 14:case 15:dl(4,c,c.return),hc(c);break;case 1:Ms(c,c.return);var p=c.stateNode;typeof p.componentWillUnmount=="function"&&Jp(c,c.return,p),hc(c);break;case 27:Od(c.stateNode);case 26:case 5:Ms(c,c.return),hc(c);break;case 22:c.memoizedState===null&&hc(c);break;case 30:hc(c);break;default:hc(c)}s=s.sibling}}function No(s,c,p){for(p=p&&(c.subtreeFlags&8772)!==0,c=c.child;c!==null;){var x=c.alternate,N=s,D=c,H=D.flags;switch(D.tag){case 0:case 11:case 15:No(N,D,p),Nd(4,D);break;case 1:if(No(N,D,p),x=D,N=x.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Ue){oi(x,x.return,Ue)}if(x=D,N=x.updateQueue,N!==null){var Z=x.stateNode;try{var we=N.shared.hiddenCallbacks;if(we!==null)for(N.shared.hiddenCallbacks=null,N=0;N<we.length;N++)$g(we[N],Z)}catch(Ue){oi(x,x.return,Ue)}}p&&H&64&&py(D),Zc(D,D.return);break;case 27:_d(D);case 26:case 5:No(N,D,p),p&&x===null&&H&4&&ef(D),Zc(D,D.return);break;case 12:No(N,D,p);break;case 13:No(N,D,p),p&&H&4&&by(N,D);break;case 22:D.memoizedState===null&&No(N,D,p),Zc(D,D.return);break;case 30:break;default:No(N,D,p)}c=c.sibling}}function Zp(s,c){var p=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),s=null,c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(s=c.memoizedState.cachePool.pool),s!==p&&(s!=null&&s.refCount++,p!=null&&Ku(p))}function em(s,c){s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&Ku(s))}function Os(s,c,p,x){if(c.subtreeFlags&10256)for(c=c.child;c!==null;)wy(s,c,p,x),c=c.sibling}function wy(s,c,p,x){var N=c.flags;switch(c.tag){case 0:case 11:case 15:Os(s,c,p,x),N&2048&&Nd(9,c);break;case 1:Os(s,c,p,x);break;case 3:Os(s,c,p,x),N&2048&&(s=null,c.alternate!==null&&(s=c.alternate.memoizedState.cache),c=c.memoizedState.cache,c!==s&&(c.refCount++,s!=null&&Ku(s)));break;case 12:if(N&2048){Os(s,c,p,x),s=c.stateNode;try{var D=c.memoizedProps,H=D.id,Z=D.onPostCommit;typeof Z=="function"&&Z(H,c.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(we){oi(c,c.return,we)}}else Os(s,c,p,x);break;case 13:Os(s,c,p,x);break;case 23:break;case 22:D=c.stateNode,H=c.alternate,c.memoizedState!==null?D._visibility&2?Os(s,c,p,x):Cd(s,c):D._visibility&2?Os(s,c,p,x):(D._visibility|=2,tu(s,c,p,x,(c.subtreeFlags&10256)!==0)),N&2048&&Zp(H,c);break;case 24:Os(s,c,p,x),N&2048&&em(c.alternate,c);break;default:Os(s,c,p,x)}}function tu(s,c,p,x,N){for(N=N&&(c.subtreeFlags&10256)!==0,c=c.child;c!==null;){var D=s,H=c,Z=p,we=x,Ue=H.flags;switch(H.tag){case 0:case 11:case 15:tu(D,H,Z,we,N),Nd(8,H);break;case 23:break;case 22:var et=H.stateNode;H.memoizedState!==null?et._visibility&2?tu(D,H,Z,we,N):Cd(D,H):(et._visibility|=2,tu(D,H,Z,we,N)),N&&Ue&2048&&Zp(H.alternate,H);break;case 24:tu(D,H,Z,we,N),N&&Ue&2048&&em(H.alternate,H);break;default:tu(D,H,Z,we,N)}c=c.sibling}}function Cd(s,c){if(c.subtreeFlags&10256)for(c=c.child;c!==null;){var p=s,x=c,N=x.flags;switch(x.tag){case 22:Cd(p,x),N&2048&&Zp(x.alternate,x);break;case 24:Cd(p,x),N&2048&&em(x.alternate,x);break;default:Cd(p,x)}c=c.sibling}}var vr=8192;function nu(s){if(s.subtreeFlags&vr)for(s=s.child;s!==null;)Ny(s),s=s.sibling}function Ny(s){switch(s.tag){case 26:nu(s),s.flags&vr&&s.memoizedState!==null&&Iv(_a,s.memoizedState,s.memoizedProps);break;case 5:nu(s);break;case 3:case 4:var c=_a;_a=nn(s.stateNode.containerInfo),nu(s),_a=c;break;case 22:s.memoizedState===null&&(c=s.alternate,c!==null&&c.memoizedState!==null?(c=vr,vr=16777216,nu(s),vr=c):nu(s));break;default:nu(s)}}function Sy(s){var c=s.alternate;if(c!==null&&(s=c.child,s!==null)){c.child=null;do c=s.sibling,s.sibling=null,s=c;while(s!==null)}}function iu(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var x=c[p];qi=x,_y(x,s)}Sy(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)jy(s),s=s.sibling}function jy(s){switch(s.tag){case 0:case 11:case 15:iu(s),s.flags&2048&&dl(9,s,s.return);break;case 3:iu(s);break;case 12:iu(s);break;case 22:var c=s.stateNode;s.memoizedState!==null&&c._visibility&2&&(s.return===null||s.return.tag!==13)?(c._visibility&=-3,rf(s)):iu(s);break;default:iu(s)}}function rf(s){var c=s.deletions;if((s.flags&16)!==0){if(c!==null)for(var p=0;p<c.length;p++){var x=c[p];qi=x,_y(x,s)}Sy(s)}for(s=s.child;s!==null;){switch(c=s,c.tag){case 0:case 11:case 15:dl(8,c,c.return),rf(c);break;case 22:p=c.stateNode,p._visibility&2&&(p._visibility&=-3,rf(c));break;default:rf(c)}s=s.sibling}}function _y(s,c){for(;qi!==null;){var p=qi;switch(p.tag){case 0:case 11:case 15:dl(8,p,c);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var x=p.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:Ku(p.memoizedState.cache)}if(x=p.child,x!==null)x.return=p,qi=x;else e:for(p=s;qi!==null;){x=qi;var N=x.sibling,D=x.return;if(yy(x),x===p){qi=null;break e}if(N!==null){N.return=D,qi=N;break e}qi=D}}}var cv={getCacheForType:function(s){var c=Ci(ai),p=c.data.get(s);return p===void 0&&(p=s(),c.data.set(s,p)),p}},tm=typeof WeakMap=="function"?WeakMap:Map,Wn=0,ci=null,bn=null,In=0,Qn=0,ha=null,fl=!1,ru=!1,nm=!1,So=0,Ti=0,pl=0,fc=0,im=0,Ca=0,au=0,kd=null,Jr=null,rm=!1,am=0,su=1/0,Td=null,ml=null,ur=0,gl=null,ou=null,lu=0,sm=0,om=null,Cy=null,cu=0,lm=null;function wr(){if((Wn&2)!==0&&In!==0)return In&-In;if(J.T!==null){var s=Vc;return s!==0?s:df()}return Kt()}function ky(){Ca===0&&(Ca=(In&536870912)===0||an?vt():536870912);var s=ua.current;return s!==null&&(s.flags|=32),Ca}function fa(s,c,p){(s===ci&&(Qn===2||Qn===9)||s.cancelPendingCommit!==null)&&(uu(s,0),yl(s,In,Ca,!1)),bt(s,p),((Wn&2)===0||s!==ci)&&(s===ci&&((Wn&2)===0&&(fc|=p),Ti===4&&yl(s,In,Ca,!1)),Ls(s))}function Ty(s,c,p){if((Wn&6)!==0)throw Error(r(327));var x=!p&&(c&124)===0&&(c&s.expiredLanes)===0||Ve(s,c),N=x?hv(s,c):dm(s,c,!0),D=x;do{if(N===0){ru&&!x&&yl(s,c,0,!1);break}else{if(p=s.current.alternate,D&&!uv(p)){N=dm(s,c,!1),D=!1;continue}if(N===2){if(D=c,s.errorRecoveryDisabledLanes&D)var H=0;else H=s.pendingLanes&-536870913,H=H!==0?H:H&536870912?536870912:0;if(H!==0){c=H;e:{var Z=s;N=kd;var we=Z.current.memoizedState.isDehydrated;if(we&&(uu(Z,H).flags|=256),H=dm(Z,H,!1),H!==2){if(nm&&!we){Z.errorRecoveryDisabledLanes|=D,fc|=D,N=4;break e}D=Jr,Jr=N,D!==null&&(Jr===null?Jr=D:Jr.push.apply(Jr,D))}N=H}if(D=!1,N!==2)continue}}if(N===1){uu(s,0),yl(s,c,0,!0);break}e:{switch(x=s,D=N,D){case 0:case 1:throw Error(r(345));case 4:if((c&4194048)!==c)break;case 6:yl(x,c,Ca,!fl);break e;case 2:Jr=null;break;case 3:case 5:break;default:throw Error(r(329))}if((c&62914560)===c&&(N=am+300-ut(),10<N)){if(yl(x,c,Ca,!fl),Ee(x,0,!0)!==0)break e;x.timeoutHandle=Xy(Ey.bind(null,x,p,Jr,Td,rm,c,Ca,fc,au,fl,D,2,-0,0),N);break e}Ey(x,p,Jr,Td,rm,c,Ca,fc,au,fl,D,0,-0,0)}}break}while(!0);Ls(s)}function Ey(s,c,p,x,N,D,H,Z,we,Ue,et,ot,We,qe){if(s.timeoutHandle=-1,ot=c.subtreeFlags,(ot&8192||(ot&16785408)===16785408)&&(tr={stylesheets:null,count:0,unsuspend:Pv},Ny(c),ot=Mv(),ot!==null)){s.cancelPendingCommit=ot(Ed.bind(null,s,c,D,p,x,N,H,Z,we,et,1,We,qe)),yl(s,D,H,!Ue);return}Ed(s,c,D,p,x,N,H,Z,we)}function uv(s){for(var c=s;;){var p=c.tag;if((p===0||p===11||p===15)&&c.flags&16384&&(p=c.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var x=0;x<p.length;x++){var N=p[x],D=N.getSnapshot;N=N.value;try{if(!Cr(D(),N))return!1}catch{return!1}}if(p=c.child,c.subtreeFlags&16384&&p!==null)p.return=c,c=p;else{if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return!0;c=c.return}c.sibling.return=c.return,c=c.sibling}}return!0}function yl(s,c,p,x){c&=~im,c&=~fc,s.suspendedLanes|=c,s.pingedLanes&=~c,x&&(s.warmLanes|=c),x=s.expirationTimes;for(var N=c;0<N;){var D=31-Ge(N),H=1<<D;x[D]=-1,N&=~H}p!==0&&tt(s,p,c)}function af(){return(Wn&6)===0?(Pd(0),!1):!0}function cm(){if(bn!==null){if(Qn===0)var s=bn.return;else s=bn,X=rl=null,Eh(s),Ui=null,Yr=0,s=bn;for(;s!==null;)fy(s.alternate,s),s=s.return;bn=null}}function uu(s,c){var p=s.timeoutHandle;p!==-1&&(s.timeoutHandle=-1,Sv(p)),p=s.cancelPendingCommit,p!==null&&(s.cancelPendingCommit=null,p()),cm(),ci=s,bn=p=Xi(s.current,null),In=c,Qn=0,ha=null,fl=!1,ru=Ve(s,c),nm=!1,au=Ca=im=fc=pl=Ti=0,Jr=kd=null,rm=!1,(c&8)!==0&&(c|=c&32);var x=s.entangledLanes;if(x!==0)for(s=s.entanglements,x&=c;0<x;){var N=31-Ge(x),D=1<<N;c|=s[N],x&=~D}return So=c,oo(),p}function Ay(s,c){cn=null,J.H=hd,c===Ir||c===Ch?(c=Lg(),Qn=3):c===Rg?(c=Lg(),Qn=4):Qn=c===oy?8:c!==null&&typeof c=="object"&&typeof c.then=="function"?6:1,ha=c,bn===null&&(Ti=1,yd(s,_i(c,s.current)))}function Dy(){var s=J.H;return J.H=hd,s===null?hd:s}function Py(){var s=J.A;return J.A=cv,s}function um(){Ti=4,fl||(In&4194048)!==In&&ua.current!==null||(ru=!0),(pl&134217727)===0&&(fc&134217727)===0||ci===null||yl(ci,In,Ca,!1)}function dm(s,c,p){var x=Wn;Wn|=2;var N=Dy(),D=Py();(ci!==s||In!==c)&&(Td=null,uu(s,c)),c=!1;var H=Ti;e:do try{if(Qn!==0&&bn!==null){var Z=bn,we=ha;switch(Qn){case 8:cm(),H=6;break e;case 3:case 2:case 9:case 6:ua.current===null&&(c=!0);var Ue=Qn;if(Qn=0,ha=null,du(s,Z,we,Ue),p&&ru){H=0;break e}break;default:Ue=Qn,Qn=0,ha=null,du(s,Z,we,Ue)}}dv(),H=Ti;break}catch(et){Ay(s,et)}while(!0);return c&&s.shellSuspendCounter++,X=rl=null,Wn=x,J.H=N,J.A=D,bn===null&&(ci=null,In=0,oo()),H}function dv(){for(;bn!==null;)hm(bn)}function hv(s,c){var p=Wn;Wn|=2;var x=Dy(),N=Py();ci!==s||In!==c?(Td=null,su=ut()+500,uu(s,c)):ru=Ve(s,c);e:do try{if(Qn!==0&&bn!==null){c=bn;var D=ha;t:switch(Qn){case 1:Qn=0,ha=null,du(s,c,D,1);break;case 2:case 9:if(Og(D)){Qn=0,ha=null,My(c);break}c=function(){Qn!==2&&Qn!==9||ci!==s||(Qn=7),Ls(s)},D.then(c,c);break e;case 3:Qn=7;break e;case 4:Qn=5;break e;case 7:Og(D)?(Qn=0,ha=null,My(c)):(Qn=0,ha=null,du(s,c,D,7));break;case 5:var H=null;switch(bn.tag){case 26:H=bn.memoizedState;case 5:case 27:var Z=bn;if(!H||Gi(H)){Qn=0,ha=null;var we=Z.sibling;if(we!==null)bn=we;else{var Ue=Z.return;Ue!==null?(bn=Ue,sf(Ue)):bn=null}break t}}Qn=0,ha=null,du(s,c,D,5);break;case 6:Qn=0,ha=null,du(s,c,D,6);break;case 8:cm(),Ti=6;break e;default:throw Error(r(462))}}Iy();break}catch(et){Ay(s,et)}while(!0);return X=rl=null,J.H=x,J.A=N,Wn=p,bn!==null?0:(ci=null,In=0,oo(),Ti)}function Iy(){for(;bn!==null&&!Ye();)hm(bn)}function hm(s){var c=Kh(s.alternate,s,So);s.memoizedProps=s.pendingProps,c===null?sf(s):bn=c}function My(s){var c=s,p=c.alternate;switch(c.tag){case 15:case 0:c=Qh(p,c,c.pendingProps,c.type,void 0,In);break;case 11:c=Qh(p,c,c.pendingProps,c.type.render,c.ref,In);break;case 5:Eh(c);default:fy(p,c),c=bn=el(c,So),c=Kh(p,c,So)}s.memoizedProps=s.pendingProps,c===null?sf(s):bn=c}function du(s,c,p,x){X=rl=null,Eh(c),Ui=null,Yr=0;var N=c.return;try{if(sy(s,N,c,p,In)){Ti=1,yd(s,_i(p,s.current)),bn=null;return}}catch(D){if(N!==null)throw bn=N,D;Ti=1,yd(s,_i(p,s.current)),bn=null;return}c.flags&32768?(an||x===1?s=!0:ru||(In&536870912)!==0?s=!1:(fl=s=!0,(x===2||x===9||x===3||x===6)&&(x=ua.current,x!==null&&x.tag===13&&(x.flags|=16384))),Ry(c,s)):sf(c)}function sf(s){var c=s;do{if((c.flags&32768)!==0){Ry(c,fl);return}s=c.return;var p=dy(c.alternate,c,So);if(p!==null){bn=p;return}if(c=c.sibling,c!==null){bn=c;return}bn=c=s}while(c!==null);Ti===0&&(Ti=5)}function Ry(s,c){do{var p=hy(s.alternate,s);if(p!==null){p.flags&=32767,bn=p;return}if(p=s.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!c&&(s=s.sibling,s!==null)){bn=s;return}bn=s=p}while(s!==null);Ti=6,bn=null}function Ed(s,c,p,x,N,D,H,Z,we){s.cancelPendingCommit=null;do of();while(ur!==0);if((Wn&6)!==0)throw Error(r(327));if(c!==null){if(c===s.current)throw Error(r(177));if(D=c.lanes|c.childLanes,D|=Gu,Mt(s,p,D,H,Z,we),s===ci&&(bn=ci=null,In=0),ou=c,gl=s,lu=p,sm=D,om=N,Cy=x,(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,qy(dt,function(){return zy(),null})):(s.callbackNode=null,s.callbackPriority=0),x=(c.flags&13878)!==0,(c.subtreeFlags&13878)!==0||x){x=J.T,J.T=null,N=K.p,K.p=2,H=Wn,Wn|=4;try{ov(s,c,p)}finally{Wn=H,K.p=N,J.T=x}}ur=1,Oy(),Ly(),Fy()}}function Oy(){if(ur===1){ur=0;var s=gl,c=ou,p=(c.flags&13878)!==0;if((c.subtreeFlags&13878)!==0||p){p=J.T,J.T=null;var x=K.p;K.p=2;var N=Wn;Wn|=4;try{Xp(c,s);var D=pf,H=Nh(s.containerInfo),Z=D.focusedElem,we=D.selectionRange;if(H!==Z&&Z&&Z.ownerDocument&&wh(Z.ownerDocument.documentElement,Z)){if(we!==null&&qu(Z)){var Ue=we.start,et=we.end;if(et===void 0&&(et=Ue),"selectionStart"in Z)Z.selectionStart=Ue,Z.selectionEnd=Math.min(et,Z.value.length);else{var ot=Z.ownerDocument||document,We=ot&&ot.defaultView||window;if(We.getSelection){var qe=We.getSelection(),qt=Z.textContent.length,Ut=Math.min(we.start,qt),ti=we.end===void 0?Ut:Math.min(we.end,qt);!qe.extend&&Ut>ti&&(H=ti,ti=Ut,Ut=H);var Re=Uu(Z,Ut),Te=Uu(Z,ti);if(Re&&Te&&(qe.rangeCount!==1||qe.anchorNode!==Re.node||qe.anchorOffset!==Re.offset||qe.focusNode!==Te.node||qe.focusOffset!==Te.offset)){var Be=ot.createRange();Be.setStart(Re.node,Re.offset),qe.removeAllRanges(),Ut>ti?(qe.addRange(Be),qe.extend(Te.node,Te.offset)):(Be.setEnd(Te.node,Te.offset),qe.addRange(Be))}}}}for(ot=[],qe=Z;qe=qe.parentNode;)qe.nodeType===1&&ot.push({element:qe,left:qe.scrollLeft,top:qe.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<ot.length;Z++){var at=ot[Z];at.element.scrollLeft=at.left,at.element.scrollTop=at.top}}wf=!!es,pf=es=null}finally{Wn=N,K.p=x,J.T=p}}s.current=c,ur=2}}function Ly(){if(ur===2){ur=0;var s=gl,c=ou,p=(c.flags&8772)!==0;if((c.subtreeFlags&8772)!==0||p){p=J.T,J.T=null;var x=K.p;K.p=2;var N=Wn;Wn|=4;try{gy(s,c.alternate,c)}finally{Wn=N,K.p=x,J.T=p}}ur=3}}function Fy(){if(ur===4||ur===3){ur=0,rt();var s=gl,c=ou,p=lu,x=Cy;(c.subtreeFlags&10256)!==0||(c.flags&10256)!==0?ur=5:(ur=0,ou=gl=null,$y(s,s.pendingLanes));var N=s.pendingLanes;if(N===0&&(ml=null),pn(p),c=c.stateNode,ue&&typeof ue.onCommitFiberRoot=="function")try{ue.onCommitFiberRoot(Q,c,void 0,(c.current.flags&128)===128)}catch{}if(x!==null){c=J.T,N=K.p,K.p=2,J.T=null;try{for(var D=s.onRecoverableError,H=0;H<x.length;H++){var Z=x[H];D(Z.value,{componentStack:Z.stack})}}finally{J.T=c,K.p=N}}(lu&3)!==0&&of(),Ls(s),N=s.pendingLanes,(p&4194090)!==0&&(N&42)!==0?s===lm?cu++:(cu=0,lm=s):cu=0,Pd(0)}}function $y(s,c){(s.pooledCacheLanes&=c)===0&&(c=s.pooledCache,c!=null&&(s.pooledCache=null,Ku(c)))}function of(s){return Oy(),Ly(),Fy(),zy()}function zy(){if(ur!==5)return!1;var s=gl,c=sm;sm=0;var p=pn(lu),x=J.T,N=K.p;try{K.p=32>p?32:p,J.T=null,p=om,om=null;var D=gl,H=lu;if(ur=0,ou=gl=null,lu=0,(Wn&6)!==0)throw Error(r(331));var Z=Wn;if(Wn|=4,jy(D.current),wy(D,D.current,H,p),Wn=Z,Pd(0,!1),ue&&typeof ue.onPostCommitFiberRoot=="function")try{ue.onPostCommitFiberRoot(Q,D)}catch{}return!0}finally{K.p=N,J.T=x,$y(s,c)}}function By(s,c,p){c=_i(p,c),c=Hh(s.stateNode,c,2),s=fo(s,c,2),s!==null&&(bt(s,2),Ls(s))}function oi(s,c,p){if(s.tag===3)By(s,s,p);else for(;c!==null;){if(c.tag===3){By(c,s,p);break}else if(c.tag===1){var x=c.stateNode;if(typeof c.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(ml===null||!ml.has(x))){s=_i(p,s),p=Hp(2),x=fo(c,p,2),x!==null&&(ay(p,x,c,s),bt(x,2),Ls(x));break}}c=c.return}}function fm(s,c,p){var x=s.pingCache;if(x===null){x=s.pingCache=new tm;var N=new Set;x.set(c,N)}else N=x.get(c),N===void 0&&(N=new Set,x.set(c,N));N.has(p)||(nm=!0,N.add(p),s=fv.bind(null,s,c,p),c.then(s,s))}function fv(s,c,p){var x=s.pingCache;x!==null&&x.delete(c),s.pingedLanes|=s.suspendedLanes&p,s.warmLanes&=~p,ci===s&&(In&p)===p&&(Ti===4||Ti===3&&(In&62914560)===In&&300>ut()-am?(Wn&2)===0&&uu(s,0):im|=p,au===In&&(au=0)),Ls(s)}function Uy(s,c){c===0&&(c=wt()),s=lo(s,c),s!==null&&(bt(s,c),Ls(s))}function lf(s){var c=s.memoizedState,p=0;c!==null&&(p=c.retryLane),Uy(s,p)}function pv(s,c){var p=0;switch(s.tag){case 13:var x=s.stateNode,N=s.memoizedState;N!==null&&(p=N.retryLane);break;case 19:x=s.stateNode;break;case 22:x=s.stateNode._retryCache;break;default:throw Error(r(314))}x!==null&&x.delete(c),Uy(s,p)}function qy(s,c){return ne(s,c)}var Ad=null,xl=null,cf=!1,Dd=!1,uf=!1,bl=0;function Ls(s){s!==xl&&s.next===null&&(xl===null?Ad=xl=s:xl=xl.next=s),Dd=!0,cf||(cf=!0,pm())}function Pd(s,c){if(!uf&&Dd){uf=!0;do for(var p=!1,x=Ad;x!==null;){if(s!==0){var N=x.pendingLanes;if(N===0)var D=0;else{var H=x.suspendedLanes,Z=x.pingedLanes;D=(1<<31-Ge(42|s)+1)-1,D&=N&~(H&~Z),D=D&201326741?D&201326741|1:D?D|2:0}D!==0&&(p=!0,Hy(x,D))}else D=In,D=Ee(x,x===ci?D:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(D&3)===0||Ve(x,D)||(p=!0,Hy(x,D));x=x.next}while(p);uf=!1}}function mv(){Id()}function Id(){Dd=cf=!1;var s=0;bl!==0&&(Nv()&&(s=bl),bl=0);for(var c=ut(),p=null,x=Ad;x!==null;){var N=x.next,D=Md(x,c);D===0?(x.next=null,p===null?Ad=N:p.next=N,N===null&&(xl=p)):(p=x,(s!==0||(D&3)!==0)&&(Dd=!0)),x=N}Pd(s)}function Md(s,c){for(var p=s.suspendedLanes,x=s.pingedLanes,N=s.expirationTimes,D=s.pendingLanes&-62914561;0<D;){var H=31-Ge(D),Z=1<<H,we=N[H];we===-1?((Z&p)===0||(Z&x)!==0)&&(N[H]=Ke(Z,c)):we<=c&&(s.expiredLanes|=Z),D&=~Z}if(c=ci,p=In,p=Ee(s,s===c?p:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),x=s.callbackNode,p===0||s===c&&(Qn===2||Qn===9)||s.cancelPendingCommit!==null)return x!==null&&x!==null&&Pe(x),s.callbackNode=null,s.callbackPriority=0;if((p&3)===0||Ve(s,p)){if(c=p&-p,c===s.callbackPriority)return c;switch(x!==null&&Pe(x),pn(p)){case 2:case 8:p=ze;break;case 32:p=dt;break;case 268435456:p=ct;break;default:p=dt}return x=Vy.bind(null,s),p=ne(p,x),s.callbackPriority=c,s.callbackNode=p,c}return x!==null&&x!==null&&Pe(x),s.callbackPriority=2,s.callbackNode=null,2}function Vy(s,c){if(ur!==0&&ur!==5)return s.callbackNode=null,s.callbackPriority=0,null;var p=s.callbackNode;if(of()&&s.callbackNode!==p)return null;var x=In;return x=Ee(s,s===ci?x:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),x===0?null:(Ty(s,x,c),Md(s,ut()),s.callbackNode!=null&&s.callbackNode===p?Vy.bind(null,s):null)}function Hy(s,c){if(of())return null;Ty(s,c,!0)}function pm(){jv(function(){(Wn&6)!==0?ne(Qe,mv):Id()})}function df(){return bl===0&&(bl=vt()),bl}function Gy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Xs(""+s)}function Yy(s,c){var p=c.ownerDocument.createElement("input");return p.name=c.name,p.value=c.value,s.id&&p.setAttribute("form",s.id),c.parentNode.insertBefore(p,c),s=new FormData(s),p.parentNode.removeChild(p),s}function gv(s,c,p,x,N){if(c==="submit"&&p&&p.stateNode===N){var D=Gy((N[Dn]||null).action),H=x.submitter;H&&(c=(c=H[Dn]||null)?Gy(c.formAction):H.getAttribute("formAction"),c!==null&&(D=c,H=null));var Z=new ql("action","action",null,x,N);s.push({event:Z,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(bl!==0){var we=H?Yy(N,H):new FormData(N);ud(p,{pending:!0,data:we,method:N.method,action:D},null,we)}}else typeof D=="function"&&(Z.preventDefault(),we=H?Yy(N,H):new FormData(N),ud(p,{pending:!0,data:we,method:N.method,action:D},D,we))},currentTarget:N}]})}}for(var mm=0;mm<Rn.length;mm++){var gm=Rn[mm],yv=gm.toLowerCase(),xv=gm[0].toUpperCase()+gm.slice(1);oa(yv,"on"+xv)}oa(zc,"onAnimationEnd"),oa(Vu,"onAnimationIteration"),oa(Er,"onAnimationStart"),oa("dblclick","onDoubleClick"),oa("focusin","onFocus"),oa("focusout","onBlur"),oa(Bc,"onTransitionRun"),oa(yp,"onTransitionStart"),oa(Ko,"onTransitionCancel"),oa(Yl,"onTransitionEnd"),fi("onMouseEnter",["mouseout","mouseover"]),fi("onMouseLeave",["mouseout","mouseover"]),fi("onPointerEnter",["pointerout","pointerover"]),fi("onPointerLeave",["pointerout","pointerover"]),aa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),aa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),aa("onBeforeInput",["compositionend","keypress","textInput","paste"]),aa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),aa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),aa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Rd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),bv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Rd));function Wy(s,c){c=(c&4)!==0;for(var p=0;p<s.length;p++){var x=s[p],N=x.event;x=x.listeners;e:{var D=void 0;if(c)for(var H=x.length-1;0<=H;H--){var Z=x[H],we=Z.instance,Ue=Z.currentTarget;if(Z=Z.listener,we!==D&&N.isPropagationStopped())break e;D=Z,N.currentTarget=Ue;try{D(N)}catch(et){uc(et)}N.currentTarget=null,D=we}else for(H=0;H<x.length;H++){if(Z=x[H],we=Z.instance,Ue=Z.currentTarget,Z=Z.listener,we!==D&&N.isPropagationStopped())break e;D=Z,N.currentTarget=Ue;try{D(N)}catch(et){uc(et)}N.currentTarget=null,D=we}}}}function vn(s,c){var p=c[Ie];p===void 0&&(p=c[Ie]=new Set);var x=s+"__bubble";p.has(x)||(Qy(c,s,2,!1),p.add(x))}function ym(s,c,p){var x=0;c&&(x|=4),Qy(p,s,x,c)}var Kr="_reactListening"+Math.random().toString(36).slice(2);function xm(s){if(!s[Kr]){s[Kr]=!0,Li.forEach(function(p){p!=="selectionchange"&&(bv.has(p)||ym(p,!1,s),ym(p,!0,s))});var c=s.nodeType===9?s:s.ownerDocument;c===null||c[Kr]||(c[Kr]=!0,ym("selectionchange",!1,c))}}function Qy(s,c,p,x){switch(px(c)){case 2:var N=Lv;break;case 8:N=xu;break;default:N=Tm}p=N.bind(null,c,p,s),N=void 0,!Uo||c!=="touchstart"&&c!=="touchmove"&&c!=="wheel"||(N=!0),x?N!==void 0?s.addEventListener(c,p,{capture:!0,passive:N}):s.addEventListener(c,p,!0):N!==void 0?s.addEventListener(c,p,{passive:N}):s.addEventListener(c,p,!1)}function jo(s,c,p,x,N){var D=x;if((c&1)===0&&(c&2)===0&&x!==null)e:for(;;){if(x===null)return;var H=x.tag;if(H===3||H===4){var Z=x.stateNode.containerInfo;if(Z===N)break;if(H===4)for(H=x.return;H!==null;){var we=H.tag;if((we===3||we===4)&&H.stateNode.containerInfo===N)return;H=H.return}for(;Z!==null;){if(H=Bi(Z),H===null)return;if(we=H.tag,we===5||we===6||we===26||we===27){x=D=H;continue e}Z=Z.parentNode}}x=x.return}Ru(function(){var Ue=D,et=Bl(p),ot=[];e:{var We=Wl.get(s);if(We!==void 0){var qe=ql,qt=s;switch(s){case"keypress":if(Bn(p)===0)break e;case"keydown":case"keyup":qe=bs;break;case"focusin":qt="focus",qe=no;break;case"focusout":qt="blur",qe=no;break;case"beforeblur":case"afterblur":qe=no;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qe=Ha;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qe=Vl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qe=Yo;break;case zc:case Vu:case Er:qe=Pc;break;case Yl:qe=vs;break;case"scroll":case"scrollend":qe=uh;break;case"wheel":qe=gp;break;case"copy":case"cut":case"paste":qe=Fu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qe=sa;break;case"toggle":case"beforetoggle":qe=ws}var Ut=(c&4)!==0,ti=!Ut&&(s==="scroll"||s==="scrollend"),Re=Ut?We!==null?We+"Capture":null:We;Ut=[];for(var Te=Ue,Be;Te!==null;){var at=Te;if(Be=at.stateNode,at=at.tag,at!==5&&at!==26&&at!==27||Be===null||Re===null||(at=Zs(Te,Re),at!=null&&Ut.push(Jt(Te,at,Be))),ti)break;Te=Te.return}0<Ut.length&&(We=new qe(We,qt,null,p,et),ot.push({event:We,listeners:Ut}))}}if((c&7)===0){e:{if(We=s==="mouseover"||s==="pointerover",qe=s==="mouseout"||s==="pointerout",We&&p!==Bo&&(qt=p.relatedTarget||p.fromElement)&&(Bi(qt)||qt[ii]))break e;if((qe||We)&&(We=et.window===et?et:(We=et.ownerDocument)?We.defaultView||We.parentWindow:window,qe?(qt=p.relatedTarget||p.toElement,qe=Ue,qt=qt?Bi(qt):null,qt!==null&&(ti=o(qt),Ut=qt.tag,qt!==ti||Ut!==5&&Ut!==27&&Ut!==6)&&(qt=null)):(qe=null,qt=Ue),qe!==qt)){if(Ut=Ha,at="onMouseLeave",Re="onMouseEnter",Te="mouse",(s==="pointerout"||s==="pointerover")&&(Ut=sa,at="onPointerLeave",Re="onPointerEnter",Te="pointer"),ti=qe==null?We:Mi(qe),Be=qt==null?We:Mi(qt),We=new Ut(at,Te+"leave",qe,p,et),We.target=ti,We.relatedTarget=Be,at=null,Bi(et)===Ue&&(Ut=new Ut(Re,Te+"enter",qt,p,et),Ut.target=Be,Ut.relatedTarget=ti,at=Ut),ti=at,qe&&qt)t:{for(Ut=qe,Re=qt,Te=0,Be=Ut;Be;Be=Vi(Be))Te++;for(Be=0,at=Re;at;at=Vi(at))Be++;for(;0<Te-Be;)Ut=Vi(Ut),Te--;for(;0<Be-Te;)Re=Vi(Re),Be--;for(;Te--;){if(Ut===Re||Re!==null&&Ut===Re.alternate)break t;Ut=Vi(Ut),Re=Vi(Re)}Ut=null}else Ut=null;qe!==null&&Ei(ot,We,qe,Ut,!1),qt!==null&&ti!==null&&Ei(ot,ti,qt,Ut,!0)}}e:{if(We=Ue?Mi(Ue):window,qe=We.nodeName&&We.nodeName.toLowerCase(),qe==="select"||qe==="input"&&We.type==="file")var It=mh;else if(js(We))if(gh)It=Bu;else{It=ks;var yn=bh}else qe=We.nodeName,!qe||qe.toLowerCase()!=="input"||We.type!=="checkbox"&&We.type!=="radio"?Ue&&gs(Ue.elementType)&&(It=mh):It=Jo;if(It&&(It=It(s,Ue))){_s(ot,It,p,et);break e}yn&&yn(s,We,Ue),s==="focusout"&&Ue&&We.type==="number"&&Ue.memoizedProps.value!=null&&$o(We,"number",We.value)}switch(yn=Ue?Mi(Ue):window,s){case"focusin":(js(yn)||yn.contentEditable==="true")&&(Tr=yn,Ki=Ue,Ae=null);break;case"focusout":Ae=Ki=Tr=null;break;case"mousedown":Xe=!0;break;case"contextmenu":case"mouseup":case"dragend":Xe=!1,Je(ot,p,et);break;case"selectionchange":if(Ts)break;case"keydown":case"keyup":Je(ot,p,et)}var Ot;if(Ns)e:{switch(s){case"compositionstart":var Vt="onCompositionStart";break e;case"compositionend":Vt="onCompositionEnd";break e;case"compositionupdate":Vt="onCompositionUpdate";break e}Vt=void 0}else Ss?$u(s,p)&&(Vt="onCompositionEnd"):s==="keydown"&&p.keyCode===229&&(Vt="onCompositionStart");Vt&&(Wo&&p.locale!=="ko"&&(Ss||Vt!=="onCompositionStart"?Vt==="onCompositionEnd"&&Ss&&(Ot=Ou()):(qa=et,Ac="value"in qa?qa.value:qa.textContent,Ss=!0)),yn=hf(Ue,Vt),0<yn.length&&(Vt=new Ji(Vt,s,null,p,et),ot.push({event:Vt,listeners:yn}),Ot?Vt.data=Ot:(Ot=va(p),Ot!==null&&(Vt.data=Ot)))),(Ot=Lc?fh(s,p):ao(s,p))&&(Vt=hf(Ue,"onBeforeInput"),0<Vt.length&&(yn=new Ji("onBeforeInput","beforeinput",null,p,et),ot.push({event:yn,listeners:Vt}),yn.data=Ot)),gv(ot,s,Ue,p,et)}Wy(ot,c)})}function Jt(s,c,p){return{instance:s,listener:c,currentTarget:p}}function hf(s,c){for(var p=c+"Capture",x=[];s!==null;){var N=s,D=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||D===null||(N=Zs(s,p),N!=null&&x.unshift(Jt(s,N,D)),N=Zs(s,c),N!=null&&x.push(Jt(s,N,D))),s.tag===3)return x;s=s.return}return[]}function Vi(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function Ei(s,c,p,x,N){for(var D=c._reactName,H=[];p!==null&&p!==x;){var Z=p,we=Z.alternate,Ue=Z.stateNode;if(Z=Z.tag,we!==null&&we===x)break;Z!==5&&Z!==26&&Z!==27||Ue===null||(we=Ue,N?(Ue=Zs(p,D),Ue!=null&&H.unshift(Jt(p,Ue,we))):N||(Ue=Zs(p,D),Ue!=null&&H.push(Jt(p,Ue,we)))),p=p.return}H.length!==0&&s.push({event:c,listeners:H})}var vv=/\r\n?/g,vl=/\u0000|\uFFFD/g;function Jy(s){return(typeof s=="string"?s:""+s).replace(vv,`
`).replace(vl,"")}function Ky(s,c){return c=Jy(c),Jy(s)===c}function ff(){}function ei(s,c,p,x,N,D){switch(p){case"children":typeof x=="string"?c==="body"||c==="textarea"&&x===""||ms(s,x):(typeof x=="number"||typeof x=="bigint")&&c!=="body"&&ms(s,""+x);break;case"className":Fa(s,"class",x);break;case"tabIndex":Fa(s,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":Fa(s,p,x);break;case"style":$l(s,x,D);break;case"data":if(c!=="object"){Fa(s,"data",x);break}case"src":case"href":if(x===""&&(c!=="a"||p!=="href")){s.removeAttribute(p);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){s.removeAttribute(p);break}x=Xs(""+x),s.setAttribute(p,x);break;case"action":case"formAction":if(typeof x=="function"){s.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof D=="function"&&(p==="formAction"?(c!=="input"&&ei(s,c,"name",N.name,N,null),ei(s,c,"formEncType",N.formEncType,N,null),ei(s,c,"formMethod",N.formMethod,N,null),ei(s,c,"formTarget",N.formTarget,N,null)):(ei(s,c,"encType",N.encType,N,null),ei(s,c,"method",N.method,N,null),ei(s,c,"target",N.target,N,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){s.removeAttribute(p);break}x=Xs(""+x),s.setAttribute(p,x);break;case"onClick":x!=null&&(s.onclick=ff);break;case"onScroll":x!=null&&vn("scroll",s);break;case"onScrollEnd":x!=null&&vn("scrollend",s);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(r(61));if(p=x.__html,p!=null){if(N.children!=null)throw Error(r(60));s.innerHTML=p}}break;case"multiple":s.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":s.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){s.removeAttribute("xlink:href");break}p=Xs(""+x),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?s.setAttribute(p,""+x):s.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?s.setAttribute(p,""):s.removeAttribute(p);break;case"capture":case"download":x===!0?s.setAttribute(p,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?s.setAttribute(p,x):s.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?s.setAttribute(p,x):s.removeAttribute(p);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?s.removeAttribute(p):s.setAttribute(p,x);break;case"popover":vn("beforetoggle",s),vn("toggle",s),or(s,"popover",x);break;case"xlinkActuate":Sr(s,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":Sr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":Sr(s,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":Sr(s,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":Sr(s,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":Sr(s,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":Sr(s,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":Sr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":Sr(s,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":or(s,"is",x);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=zl.get(p)||p,or(s,p,x))}}function bm(s,c,p,x,N,D){switch(p){case"style":$l(s,x,D);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(r(61));if(p=x.__html,p!=null){if(N.children!=null)throw Error(r(60));s.innerHTML=p}}break;case"children":typeof x=="string"?ms(s,x):(typeof x=="number"||typeof x=="bigint")&&ms(s,""+x);break;case"onScroll":x!=null&&vn("scroll",s);break;case"onScrollEnd":x!=null&&vn("scrollend",s);break;case"onClick":x!=null&&(s.onclick=ff);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fr.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(N=p.endsWith("Capture"),c=p.slice(2,N?p.length-7:void 0),D=s[Dn]||null,D=D!=null?D[p]:null,typeof D=="function"&&s.removeEventListener(c,D,N),typeof x=="function")){typeof D!="function"&&D!==null&&(p in s?s[p]=null:s.hasAttribute(p)&&s.removeAttribute(p)),s.addEventListener(c,x,N);break e}p in s?s[p]=x:x===!0?s.setAttribute(p,""):or(s,p,x)}}}function Hi(s,c,p){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":vn("error",s),vn("load",s);var x=!1,N=!1,D;for(D in p)if(p.hasOwnProperty(D)){var H=p[D];if(H!=null)switch(D){case"src":x=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ei(s,c,D,H,p,null)}}N&&ei(s,c,"srcSet",p.srcSet,p,null),x&&ei(s,c,"src",p.src,p,null);return;case"input":vn("invalid",s);var Z=D=H=N=null,we=null,Ue=null;for(x in p)if(p.hasOwnProperty(x)){var et=p[x];if(et!=null)switch(x){case"name":N=et;break;case"type":H=et;break;case"checked":we=et;break;case"defaultChecked":Ue=et;break;case"value":D=et;break;case"defaultValue":Z=et;break;case"children":case"dangerouslySetInnerHTML":if(et!=null)throw Error(r(137,c));break;default:ei(s,c,x,et,p,null)}}Fo(s,D,Z,we,Ue,H,N,!1),Js(s);return;case"select":vn("invalid",s),x=H=D=null;for(N in p)if(p.hasOwnProperty(N)&&(Z=p[N],Z!=null))switch(N){case"value":D=Z;break;case"defaultValue":H=Z;break;case"multiple":x=Z;default:ei(s,c,N,Z,p,null)}c=D,p=H,s.multiple=!!x,c!=null?za(s,!!x,c,!1):p!=null&&za(s,!!x,p,!0);return;case"textarea":vn("invalid",s),D=N=x=null;for(H in p)if(p.hasOwnProperty(H)&&(Z=p[H],Z!=null))switch(H){case"value":x=Z;break;case"defaultValue":N=Z;break;case"children":D=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(r(91));break;default:ei(s,c,H,Z,p,null)}Ks(s,x,N,D),Js(s);return;case"option":for(we in p)if(p.hasOwnProperty(we)&&(x=p[we],x!=null))switch(we){case"selected":s.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:ei(s,c,we,x,p,null)}return;case"dialog":vn("beforetoggle",s),vn("toggle",s),vn("cancel",s),vn("close",s);break;case"iframe":case"object":vn("load",s);break;case"video":case"audio":for(x=0;x<Rd.length;x++)vn(Rd[x],s);break;case"image":vn("error",s),vn("load",s);break;case"details":vn("toggle",s);break;case"embed":case"source":case"link":vn("error",s),vn("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ue in p)if(p.hasOwnProperty(Ue)&&(x=p[Ue],x!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,c));default:ei(s,c,Ue,x,p,null)}return;default:if(gs(c)){for(et in p)p.hasOwnProperty(et)&&(x=p[et],x!==void 0&&bm(s,c,et,x,p,void 0));return}}for(Z in p)p.hasOwnProperty(Z)&&(x=p[Z],x!=null&&ei(s,c,Z,x,p,null))}function wv(s,c,p,x){switch(c){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,D=null,H=null,Z=null,we=null,Ue=null,et=null;for(qe in p){var ot=p[qe];if(p.hasOwnProperty(qe)&&ot!=null)switch(qe){case"checked":break;case"value":break;case"defaultValue":we=ot;default:x.hasOwnProperty(qe)||ei(s,c,qe,null,x,ot)}}for(var We in x){var qe=x[We];if(ot=p[We],x.hasOwnProperty(We)&&(qe!=null||ot!=null))switch(We){case"type":D=qe;break;case"name":N=qe;break;case"checked":Ue=qe;break;case"defaultChecked":et=qe;break;case"value":H=qe;break;case"defaultValue":Z=qe;break;case"children":case"dangerouslySetInnerHTML":if(qe!=null)throw Error(r(137,c));break;default:qe!==ot&&ei(s,c,We,qe,x,ot)}}Ll(s,H,Z,we,Ue,et,D,N);return;case"select":qe=H=Z=We=null;for(D in p)if(we=p[D],p.hasOwnProperty(D)&&we!=null)switch(D){case"value":break;case"multiple":qe=we;default:x.hasOwnProperty(D)||ei(s,c,D,null,x,we)}for(N in x)if(D=x[N],we=p[N],x.hasOwnProperty(N)&&(D!=null||we!=null))switch(N){case"value":We=D;break;case"defaultValue":Z=D;break;case"multiple":H=D;default:D!==we&&ei(s,c,N,D,x,we)}c=Z,p=H,x=qe,We!=null?za(s,!!p,We,!1):!!x!=!!p&&(c!=null?za(s,!!p,c,!0):za(s,!!p,p?[]:"",!1));return;case"textarea":qe=We=null;for(Z in p)if(N=p[Z],p.hasOwnProperty(Z)&&N!=null&&!x.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:ei(s,c,Z,null,x,N)}for(H in x)if(N=x[H],D=p[H],x.hasOwnProperty(H)&&(N!=null||D!=null))switch(H){case"value":We=N;break;case"defaultValue":qe=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(r(91));break;default:N!==D&&ei(s,c,H,N,x,D)}zo(s,We,qe);return;case"option":for(var qt in p)if(We=p[qt],p.hasOwnProperty(qt)&&We!=null&&!x.hasOwnProperty(qt))switch(qt){case"selected":s.selected=!1;break;default:ei(s,c,qt,null,x,We)}for(we in x)if(We=x[we],qe=p[we],x.hasOwnProperty(we)&&We!==qe&&(We!=null||qe!=null))switch(we){case"selected":s.selected=We&&typeof We!="function"&&typeof We!="symbol";break;default:ei(s,c,we,We,x,qe)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ut in p)We=p[Ut],p.hasOwnProperty(Ut)&&We!=null&&!x.hasOwnProperty(Ut)&&ei(s,c,Ut,null,x,We);for(Ue in x)if(We=x[Ue],qe=p[Ue],x.hasOwnProperty(Ue)&&We!==qe&&(We!=null||qe!=null))switch(Ue){case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(r(137,c));break;default:ei(s,c,Ue,We,x,qe)}return;default:if(gs(c)){for(var ti in p)We=p[ti],p.hasOwnProperty(ti)&&We!==void 0&&!x.hasOwnProperty(ti)&&bm(s,c,ti,void 0,x,We);for(et in x)We=x[et],qe=p[et],!x.hasOwnProperty(et)||We===qe||We===void 0&&qe===void 0||bm(s,c,et,We,x,qe);return}}for(var Re in p)We=p[Re],p.hasOwnProperty(Re)&&We!=null&&!x.hasOwnProperty(Re)&&ei(s,c,Re,null,x,We);for(ot in x)We=x[ot],qe=p[ot],!x.hasOwnProperty(ot)||We===qe||We==null&&qe==null||ei(s,c,ot,We,x,qe)}var es=null,pf=null;function pc(s){return s.nodeType===9?s:s.ownerDocument}function xi(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ji(s,c){if(s===0)switch(c){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&c==="foreignObject"?0:s}function mf(s,c){return s==="textarea"||s==="noscript"||typeof c.children=="string"||typeof c.children=="number"||typeof c.children=="bigint"||typeof c.dangerouslySetInnerHTML=="object"&&c.dangerouslySetInnerHTML!==null&&c.dangerouslySetInnerHTML.__html!=null}var vm=null;function Nv(){var s=window.event;return s&&s.type==="popstate"?s===vm?!1:(vm=s,!0):(vm=null,!1)}var Xy=typeof setTimeout=="function"?setTimeout:void 0,Sv=typeof clearTimeout=="function"?clearTimeout:void 0,Zy=typeof Promise=="function"?Promise:void 0,jv=typeof queueMicrotask=="function"?queueMicrotask:typeof Zy<"u"?function(s){return Zy.resolve(null).then(s).catch(ex)}:Xy;function ex(s){setTimeout(function(){throw s})}function ka(s){return s==="head"}function gf(s,c){var p=c,x=0,N=0;do{var D=p.nextSibling;if(s.removeChild(p),D&&D.nodeType===8)if(p=D.data,p==="/$"){if(0<x&&8>x){p=x;var H=s.ownerDocument;if(p&1&&Od(H.documentElement),p&2&&Od(H.body),p&4)for(p=H.head,Od(p),H=p.firstChild;H;){var Z=H.nextSibling,we=H.nodeName;H[Xt]||we==="SCRIPT"||we==="STYLE"||we==="LINK"&&H.rel.toLowerCase()==="stylesheet"||p.removeChild(H),H=Z}}if(N===0){s.removeChild(D),Vd(c);return}N--}else p==="$"||p==="$?"||p==="$!"?N++:x=p.charCodeAt(0)-48;else x=0;p=D}while(p);Vd(c)}function wm(s){var c=s.firstChild;for(c&&c.nodeType===10&&(c=c.nextSibling);c;){var p=c;switch(c=c.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":wm(p),Zn(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}s.removeChild(p)}}function tx(s,c,p,x){for(;s.nodeType===1;){var N=p;if(s.nodeName.toLowerCase()!==c.toLowerCase()){if(!x&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(x){if(!s[Xt])switch(c){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(D=s.getAttribute("rel"),D==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(D!==N.rel||s.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||s.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||s.getAttribute("title")!==(N.title==null?null:N.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(D=s.getAttribute("src"),(D!==(N.src==null?null:N.src)||s.getAttribute("type")!==(N.type==null?null:N.type)||s.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&D&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(c==="input"&&s.type==="hidden"){var D=N.name==null?null:""+N.name;if(N.type==="hidden"&&s.getAttribute("name")===D)return s}else return s;if(s=ts(s.nextSibling),s===null)break}return null}function yf(s,c,p){if(c==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!p||(s=ts(s.nextSibling),s===null))return null;return s}function Or(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function hu(s,c){var p=s.ownerDocument;if(s.data!=="$?"||p.readyState==="complete")c();else{var x=function(){c(),p.removeEventListener("DOMContentLoaded",x)};p.addEventListener("DOMContentLoaded",x),s._reactRetry=x}}function ts(s){for(;s!=null;s=s.nextSibling){var c=s.nodeType;if(c===1||c===3)break;if(c===8){if(c=s.data,c==="$"||c==="$!"||c==="$?"||c==="F!"||c==="F")break;if(c==="/$")return null}}return s}var Nm=null;function nx(s){s=s.previousSibling;for(var c=0;s;){if(s.nodeType===8){var p=s.data;if(p==="$"||p==="$!"||p==="$?"){if(c===0)return s;c--}else p==="/$"&&c++}s=s.previousSibling}return null}function ix(s,c,p){switch(c=pc(p),s){case"html":if(s=c.documentElement,!s)throw Error(r(452));return s;case"head":if(s=c.head,!s)throw Error(r(453));return s;case"body":if(s=c.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function Od(s){for(var c=s.attributes;c.length;)s.removeAttributeNode(c[0]);Zn(s)}var pa=new Map,Fs=new Set;function nn(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var $s=K.d;K.d={f:Ta,r:rx,D:_v,C:ax,L:xf,m:Cv,X:Tv,S:kv,M:Ev};function Ta(){var s=$s.f(),c=af();return s||c}function rx(s){var c=Qi(s);c!==null&&c.tag===5&&c.type==="form"?Bh(c):$s.r(s)}var fu=typeof document>"u"?null:document;function qn(s,c,p){var x=fu;if(x&&typeof c=="string"&&c){var N=lr(c);N='link[rel="'+s+'"][href="'+N+'"]',typeof p=="string"&&(N+='[crossorigin="'+p+'"]'),Fs.has(N)||(Fs.add(N),s={rel:s,crossOrigin:p,href:c},x.querySelector(N)===null&&(c=x.createElement("link"),Hi(c,"link",s),Mn(c),x.head.appendChild(c)))}}function _v(s){$s.D(s),qn("dns-prefetch",s,null)}function ax(s,c){$s.C(s,c),qn("preconnect",s,c)}function xf(s,c,p){$s.L(s,c,p);var x=fu;if(x&&s&&c){var N='link[rel="preload"][as="'+lr(c)+'"]';c==="image"&&p&&p.imageSrcSet?(N+='[imagesrcset="'+lr(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(N+='[imagesizes="'+lr(p.imageSizes)+'"]')):N+='[href="'+lr(s)+'"]';var D=N;switch(c){case"style":D=pu(s);break;case"script":D=mu(s)}pa.has(D)||(s=f({rel:"preload",href:c==="image"&&p&&p.imageSrcSet?void 0:s,as:c},p),pa.set(D,s),x.querySelector(N)!==null||c==="style"&&x.querySelector(Ld(D))||c==="script"&&x.querySelector(Fd(D))||(c=x.createElement("link"),Hi(c,"link",s),Mn(c),x.head.appendChild(c)))}}function Cv(s,c){$s.m(s,c);var p=fu;if(p&&s){var x=c&&typeof c.as=="string"?c.as:"script",N='link[rel="modulepreload"][as="'+lr(x)+'"][href="'+lr(s)+'"]',D=N;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":D=mu(s)}if(!pa.has(D)&&(s=f({rel:"modulepreload",href:s},c),pa.set(D,s),p.querySelector(N)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(Fd(D)))return}x=p.createElement("link"),Hi(x,"link",s),Mn(x),p.head.appendChild(x)}}}function kv(s,c,p){$s.S(s,c,p);var x=fu;if(x&&s){var N=hr(x).hoistableStyles,D=pu(s);c=c||"default";var H=N.get(D);if(!H){var Z={loading:0,preload:null};if(H=x.querySelector(Ld(D)))Z.loading=5;else{s=f({rel:"stylesheet",href:s,"data-precedence":c},p),(p=pa.get(D))&&$d(s,p);var we=H=x.createElement("link");Mn(we),Hi(we,"link",s),we._p=new Promise(function(Ue,et){we.onload=Ue,we.onerror=et}),we.addEventListener("load",function(){Z.loading|=1}),we.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,bf(H,c,x)}H={type:"stylesheet",instance:H,count:1,state:Z},N.set(D,H)}}}function Tv(s,c){$s.X(s,c);var p=fu;if(p&&s){var x=hr(p).hoistableScripts,N=mu(s),D=x.get(N);D||(D=p.querySelector(Fd(N)),D||(s=f({src:s,async:!0},c),(c=pa.get(N))&&Sm(s,c),D=p.createElement("script"),Mn(D),Hi(D,"link",s),p.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},x.set(N,D))}}function Ev(s,c){$s.M(s,c);var p=fu;if(p&&s){var x=hr(p).hoistableScripts,N=mu(s),D=x.get(N);D||(D=p.querySelector(Fd(N)),D||(s=f({src:s,async:!0,type:"module"},c),(c=pa.get(N))&&Sm(s,c),D=p.createElement("script"),Mn(D),Hi(D,"link",s),p.head.appendChild(D)),D={type:"script",instance:D,count:1,state:null},x.set(N,D))}}function sx(s,c,p,x){var N=(N=he.current)?nn(N):null;if(!N)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(c=pu(p.href),p=hr(N).hoistableStyles,x=p.get(c),x||(x={type:"style",instance:null,count:0,state:null},p.set(c,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){s=pu(p.href);var D=hr(N).hoistableStyles,H=D.get(s);if(H||(N=N.ownerDocument||N,H={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},D.set(s,H),(D=N.querySelector(Ld(s)))&&!D._p&&(H.instance=D,H.state.loading=5),pa.has(s)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},pa.set(s,p),D||Av(N,s,p,H.state))),c&&x===null)throw Error(r(528,""));return H}if(c&&x!==null)throw Error(r(529,""));return null;case"script":return c=p.async,p=p.src,typeof p=="string"&&c&&typeof c!="function"&&typeof c!="symbol"?(c=mu(p),p=hr(N).hoistableScripts,x=p.get(c),x||(x={type:"script",instance:null,count:0,state:null},p.set(c,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function pu(s){return'href="'+lr(s)+'"'}function Ld(s){return'link[rel="stylesheet"]['+s+"]"}function ox(s){return f({},s,{"data-precedence":s.precedence,precedence:null})}function Av(s,c,p,x){s.querySelector('link[rel="preload"][as="style"]['+c+"]")?x.loading=1:(c=s.createElement("link"),x.preload=c,c.addEventListener("load",function(){return x.loading|=1}),c.addEventListener("error",function(){return x.loading|=2}),Hi(c,"link",p),Mn(c),s.head.appendChild(c))}function mu(s){return'[src="'+lr(s)+'"]'}function Fd(s){return"script[async]"+s}function lx(s,c,p){if(c.count++,c.instance===null)switch(c.type){case"style":var x=s.querySelector('style[data-href~="'+lr(p.href)+'"]');if(x)return c.instance=x,Mn(x),x;var N=f({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return x=(s.ownerDocument||s).createElement("style"),Mn(x),Hi(x,"style",N),bf(x,p.precedence,s),c.instance=x;case"stylesheet":N=pu(p.href);var D=s.querySelector(Ld(N));if(D)return c.state.loading|=4,c.instance=D,Mn(D),D;x=ox(p),(N=pa.get(N))&&$d(x,N),D=(s.ownerDocument||s).createElement("link"),Mn(D);var H=D;return H._p=new Promise(function(Z,we){H.onload=Z,H.onerror=we}),Hi(D,"link",x),c.state.loading|=4,bf(D,p.precedence,s),c.instance=D;case"script":return D=mu(p.src),(N=s.querySelector(Fd(D)))?(c.instance=N,Mn(N),N):(x=p,(N=pa.get(D))&&(x=f({},p),Sm(x,N)),s=s.ownerDocument||s,N=s.createElement("script"),Mn(N),Hi(N,"link",x),s.head.appendChild(N),c.instance=N);case"void":return null;default:throw Error(r(443,c.type))}else c.type==="stylesheet"&&(c.state.loading&4)===0&&(x=c.instance,c.state.loading|=4,bf(x,p.precedence,s));return c.instance}function bf(s,c,p){for(var x=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=x.length?x[x.length-1]:null,D=N,H=0;H<x.length;H++){var Z=x[H];if(Z.dataset.precedence===c)D=Z;else if(D!==N)break}D?D.parentNode.insertBefore(s,D.nextSibling):(c=p.nodeType===9?p.head:p,c.insertBefore(s,c.firstChild))}function $d(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.title==null&&(s.title=c.title)}function Sm(s,c){s.crossOrigin==null&&(s.crossOrigin=c.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=c.referrerPolicy),s.integrity==null&&(s.integrity=c.integrity)}var gu=null;function cx(s,c,p){if(gu===null){var x=new Map,N=gu=new Map;N.set(p,x)}else N=gu,x=N.get(p),x||(x=new Map,N.set(p,x));if(x.has(s))return x;for(x.set(s,null),p=p.getElementsByTagName(s),N=0;N<p.length;N++){var D=p[N];if(!(D[Xt]||D[mn]||s==="link"&&D.getAttribute("rel")==="stylesheet")&&D.namespaceURI!=="http://www.w3.org/2000/svg"){var H=D.getAttribute(c)||"";H=s+H;var Z=x.get(H);Z?Z.push(D):x.set(H,[D])}}return x}function ux(s,c,p){s=s.ownerDocument||s,s.head.insertBefore(p,c==="title"?s.querySelector("head > title"):null)}function Dv(s,c,p){if(p===1||c.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof c.precedence!="string"||typeof c.href!="string"||c.href==="")break;return!0;case"link":if(typeof c.rel!="string"||typeof c.href!="string"||c.href===""||c.onLoad||c.onError)break;switch(c.rel){case"stylesheet":return s=c.disabled,typeof c.precedence=="string"&&s==null;default:return!0}case"script":if(c.async&&typeof c.async!="function"&&typeof c.async!="symbol"&&!c.onLoad&&!c.onError&&c.src&&typeof c.src=="string")return!0}return!1}function Gi(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var tr=null;function Pv(){}function Iv(s,c,p){if(tr===null)throw Error(r(475));var x=tr;if(c.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(c.state.loading&4)===0){if(c.instance===null){var N=pu(p.href),D=s.querySelector(Ld(N));if(D){s=D._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(x.count++,x=zd.bind(x),s.then(x,x)),c.state.loading|=4,c.instance=D,Mn(D);return}D=s.ownerDocument||s,p=ox(p),(N=pa.get(N))&&$d(p,N),D=D.createElement("link"),Mn(D);var H=D;H._p=new Promise(function(Z,we){H.onload=Z,H.onerror=we}),Hi(D,"link",p),c.instance=D}x.stylesheets===null&&(x.stylesheets=new Map),x.stylesheets.set(c,s),(s=c.state.preload)&&(c.state.loading&3)===0&&(x.count++,c=zd.bind(x),s.addEventListener("load",c),s.addEventListener("error",c))}}function Mv(){if(tr===null)throw Error(r(475));var s=tr;return s.stylesheets&&s.count===0&&jm(s,s.stylesheets),0<s.count?function(c){var p=setTimeout(function(){if(s.stylesheets&&jm(s,s.stylesheets),s.unsuspend){var x=s.unsuspend;s.unsuspend=null,x()}},6e4);return s.unsuspend=c,function(){s.unsuspend=null,clearTimeout(p)}}:null}function zd(){if(this.count--,this.count===0){if(this.stylesheets)jm(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var vf=null;function jm(s,c){s.stylesheets=null,s.unsuspend!==null&&(s.count++,vf=new Map,c.forEach(Rv,s),vf=null,zd.call(s))}function Rv(s,c){if(!(c.state.loading&4)){var p=vf.get(s);if(p)var x=p.get(null);else{p=new Map,vf.set(s,p);for(var N=s.querySelectorAll("link[data-precedence],style[data-precedence]"),D=0;D<N.length;D++){var H=N[D];(H.nodeName==="LINK"||H.getAttribute("media")!=="not all")&&(p.set(H.dataset.precedence,H),x=H)}x&&p.set(null,x)}N=c.instance,H=N.getAttribute("data-precedence"),D=p.get(H)||x,D===x&&p.set(null,N),p.set(H,N),this.count++,x=zd.bind(this),N.addEventListener("load",x),N.addEventListener("error",x),D?D.parentNode.insertBefore(N,D.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(N,s.firstChild)),c.state.loading|=4}}var yu={$$typeof:I,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function Ov(s,c,p,x,N,D,H,Z){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=nt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=nt(0),this.hiddenUpdates=nt(null),this.identifierPrefix=x,this.onUncaughtError=N,this.onCaughtError=D,this.onRecoverableError=H,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function dx(s,c,p,x,N,D,H,Z,we,Ue,et,ot){return s=new Ov(s,c,p,H,Z,we,Ue,ot),c=1,D===!0&&(c|=24),D=yr(3,null,null,c),s.current=D,D.stateNode=s,c=xp(),c.refCount++,s.pooledCache=c,c.refCount++,D.memoizedState={element:x,isDehydrated:p,cache:c},tc(D),s}function hx(s){return s?(s=co,s):co}function _m(s,c,p,x,N,D){N=hx(N),x.context===null?x.context=N:x.pendingContext=N,x=al(c),x.payload={element:p},D=D===void 0?null:D,D!==null&&(x.callback=D),p=fo(s,x,c),p!==null&&(fa(p,s,c),Zu(p,s,c))}function Cm(s,c){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var p=s.retryLane;s.retryLane=p!==0&&p<c?p:c}}function km(s,c){Cm(s,c),(s=s.alternate)&&Cm(s,c)}function fx(s){if(s.tag===13){var c=lo(s,67108864);c!==null&&fa(c,s,67108864),km(s,67108864)}}var wf=!0;function Lv(s,c,p,x){var N=J.T;J.T=null;var D=K.p;try{K.p=2,Tm(s,c,p,x)}finally{K.p=D,J.T=N}}function xu(s,c,p,x){var N=J.T;J.T=null;var D=K.p;try{K.p=8,Tm(s,c,p,x)}finally{K.p=D,J.T=N}}function Tm(s,c,p,x){if(wf){var N=Em(x);if(N===null)jo(s,c,x,Nf,p),mx(s,x);else if($v(N,s,c,p,x))x.stopPropagation();else if(mx(s,x),c&4&&-1<Fv.indexOf(s)){for(;N!==null;){var D=Qi(N);if(D!==null)switch(D.tag){case 3:if(D=D.stateNode,D.current.memoizedState.isDehydrated){var H=ke(D.pendingLanes);if(H!==0){var Z=D;for(Z.pendingLanes|=2,Z.entangledLanes|=2;H;){var we=1<<31-Ge(H);Z.entanglements[1]|=we,H&=~we}Ls(D),(Wn&6)===0&&(su=ut()+500,Pd(0))}}break;case 13:Z=lo(D,2),Z!==null&&fa(Z,D,2),af(),km(D,2)}if(D=Em(x),D===null&&jo(s,c,x,Nf,p),D===N)break;N=D}N!==null&&x.stopPropagation()}else jo(s,c,x,null,p)}}function Em(s){return s=Bl(s),Am(s)}var Nf=null;function Am(s){if(Nf=null,s=Bi(s),s!==null){var c=o(s);if(c===null)s=null;else{var p=c.tag;if(p===13){if(s=l(c),s!==null)return s;s=null}else if(p===3){if(c.stateNode.current.memoizedState.isDehydrated)return c.tag===3?c.stateNode.containerInfo:null;s=null}else c!==s&&(s=null)}}return Nf=s,null}function px(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(je()){case Qe:return 2;case ze:return 8;case dt:case Ze:return 32;case ct:return 268435456;default:return 32}default:return 32}}var Sf=!1,_o=null,wl=null,Nl=null,Bd=new Map,Ud=new Map,Sl=[],Fv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function mx(s,c){switch(s){case"focusin":case"focusout":_o=null;break;case"dragenter":case"dragleave":wl=null;break;case"mouseover":case"mouseout":Nl=null;break;case"pointerover":case"pointerout":Bd.delete(c.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ud.delete(c.pointerId)}}function qd(s,c,p,x,N,D){return s===null||s.nativeEvent!==D?(s={blockedOn:c,domEventName:p,eventSystemFlags:x,nativeEvent:D,targetContainers:[N]},c!==null&&(c=Qi(c),c!==null&&fx(c)),s):(s.eventSystemFlags|=x,c=s.targetContainers,N!==null&&c.indexOf(N)===-1&&c.push(N),s)}function $v(s,c,p,x,N){switch(c){case"focusin":return _o=qd(_o,s,c,p,x,N),!0;case"dragenter":return wl=qd(wl,s,c,p,x,N),!0;case"mouseover":return Nl=qd(Nl,s,c,p,x,N),!0;case"pointerover":var D=N.pointerId;return Bd.set(D,qd(Bd.get(D)||null,s,c,p,x,N)),!0;case"gotpointercapture":return D=N.pointerId,Ud.set(D,qd(Ud.get(D)||null,s,c,p,x,N)),!0}return!1}function gx(s){var c=Bi(s.target);if(c!==null){var p=o(c);if(p!==null){if(c=p.tag,c===13){if(c=l(p),c!==null){s.blockedOn=c,ln(s.priority,function(){if(p.tag===13){var x=wr();x=Lt(x);var N=lo(p,x);N!==null&&fa(N,p,x),km(p,x)}});return}}else if(c===3&&p.stateNode.current.memoizedState.isDehydrated){s.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}s.blockedOn=null}function jf(s){if(s.blockedOn!==null)return!1;for(var c=s.targetContainers;0<c.length;){var p=Em(s.nativeEvent);if(p===null){p=s.nativeEvent;var x=new p.constructor(p.type,p);Bo=x,p.target.dispatchEvent(x),Bo=null}else return c=Qi(p),c!==null&&fx(c),s.blockedOn=p,!1;c.shift()}return!0}function yx(s,c,p){jf(s)&&p.delete(c)}function zv(){Sf=!1,_o!==null&&jf(_o)&&(_o=null),wl!==null&&jf(wl)&&(wl=null),Nl!==null&&jf(Nl)&&(Nl=null),Bd.forEach(yx),Ud.forEach(yx)}function _f(s,c){s.blockedOn===c&&(s.blockedOn=null,Sf||(Sf=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,zv)))}var Cf=null;function xx(s){Cf!==s&&(Cf=s,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){Cf===s&&(Cf=null);for(var c=0;c<s.length;c+=3){var p=s[c],x=s[c+1],N=s[c+2];if(typeof x!="function"){if(Am(x||p)===null)continue;break}var D=Qi(p);D!==null&&(s.splice(c,3),c-=3,ud(D,{pending:!0,data:N,method:p.method,action:x},x,N))}}))}function Vd(s){function c(we){return _f(we,s)}_o!==null&&_f(_o,s),wl!==null&&_f(wl,s),Nl!==null&&_f(Nl,s),Bd.forEach(c),Ud.forEach(c);for(var p=0;p<Sl.length;p++){var x=Sl[p];x.blockedOn===s&&(x.blockedOn=null)}for(;0<Sl.length&&(p=Sl[0],p.blockedOn===null);)gx(p),p.blockedOn===null&&Sl.shift();if(p=(s.ownerDocument||s).$$reactFormReplay,p!=null)for(x=0;x<p.length;x+=3){var N=p[x],D=p[x+1],H=N[Dn]||null;if(typeof D=="function")H||xx(p);else if(H){var Z=null;if(D&&D.hasAttribute("formAction")){if(N=D,H=D[Dn]||null)Z=H.formAction;else if(Am(N)!==null)continue}else Z=H.action;typeof Z=="function"?p[x+1]=Z:(p.splice(x,3),x-=3),xx(p)}}}function Dm(s){this._internalRoot=s}kf.prototype.render=Dm.prototype.render=function(s){var c=this._internalRoot;if(c===null)throw Error(r(409));var p=c.current,x=wr();_m(p,x,s,c,null,null)},kf.prototype.unmount=Dm.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var c=s.containerInfo;_m(s.current,2,null,s,null,null),af(),c[ii]=null}};function kf(s){this._internalRoot=s}kf.prototype.unstable_scheduleHydration=function(s){if(s){var c=Kt();s={blockedOn:null,target:s,priority:c};for(var p=0;p<Sl.length&&c!==0&&c<Sl[p].priority;p++);Sl.splice(p,0,s),p===0&&gx(s)}};var bx=n.version;if(bx!=="19.1.0")throw Error(r(527,bx,"19.1.0"));K.findDOMNode=function(s){var c=s._reactInternals;if(c===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=d(c),s=s!==null?u(s):null,s=s===null?null:s.stateNode,s};var Bv={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:J,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tf.isDisabled&&Tf.supportsFiber)try{Q=Tf.inject(Bv),ue=Tf}catch{}}return Im.createRoot=function(s,c){if(!a(s))throw Error(r(299));var p=!1,x="",N=Vp,D=Vh,H=ry,Z=null;return c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(x=c.identifierPrefix),c.onUncaughtError!==void 0&&(N=c.onUncaughtError),c.onCaughtError!==void 0&&(D=c.onCaughtError),c.onRecoverableError!==void 0&&(H=c.onRecoverableError),c.unstable_transitionCallbacks!==void 0&&(Z=c.unstable_transitionCallbacks)),c=dx(s,1,!1,null,null,p,x,N,D,H,Z,null),s[ii]=c.current,xm(s),new Dm(c)},Im.hydrateRoot=function(s,c,p){if(!a(s))throw Error(r(299));var x=!1,N="",D=Vp,H=Vh,Z=ry,we=null,Ue=null;return p!=null&&(p.unstable_strictMode===!0&&(x=!0),p.identifierPrefix!==void 0&&(N=p.identifierPrefix),p.onUncaughtError!==void 0&&(D=p.onUncaughtError),p.onCaughtError!==void 0&&(H=p.onCaughtError),p.onRecoverableError!==void 0&&(Z=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(we=p.unstable_transitionCallbacks),p.formState!==void 0&&(Ue=p.formState)),c=dx(s,1,!0,c,p??null,x,N,D,H,Z,we,Ue),c.context=hx(null),p=c.current,x=wr(),x=Lt(x),N=al(x),N.callback=null,fo(p,N,x),p=x,c.current.lanes=p,bt(c,p),Ls(c),s[ii]=c.current,xm(s),new kf(c)},Im.version="19.1.0",Im}var _N;function zA(){if(_N)return Yv.exports;_N=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Yv.exports=$A(),Yv.exports}var BA=zA();function UA(e={}){const{nonce:n,locale:t,onScriptLoadSuccess:r,onScriptLoadError:a}=e,[o,l]=w.useState(!1),h=w.useRef(r);h.current=r;const d=w.useRef(a);return d.current=a,w.useEffect(()=>{const u=document.createElement("script");return u.src="https://accounts.google.com/gsi/client",t&&(u.src+=`?hl=${t}`),u.async=!0,u.defer=!0,u.nonce=n,u.onload=()=>{var f;l(!0),(f=h.current)===null||f===void 0||f.call(h)},u.onerror=()=>{var f;l(!1),(f=d.current)===null||f===void 0||f.call(d)},document.body.appendChild(u),()=>{document.body.removeChild(u)}},[n]),o}const kC=w.createContext(null);function qA({clientId:e,nonce:n,locale:t,onScriptLoadSuccess:r,onScriptLoadError:a,children:o}){const l=UA({nonce:n,onScriptLoadSuccess:r,onScriptLoadError:a,locale:t}),h=w.useMemo(()=>({locale:t,clientId:e,scriptLoadedSuccessfully:l}),[e,l]);return Fn.createElement(kC.Provider,{value:h},o)}function VA(){const e=w.useContext(kC);if(!e)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return e}function HA(e){var n;return(n=e==null?void 0:e.clientId)!==null&&n!==void 0?n:e==null?void 0:e.client_id}const GA={large:40,medium:32,small:20};function YA({onSuccess:e,onError:n,useOneTap:t,promptMomentNotification:r,type:a="standard",theme:o="outline",size:l="large",text:h,shape:d,logo_alignment:u,width:f,click_listener:g,state:b,containerProps:v,...S}){const T=w.useRef(null),{clientId:E,locale:C,scriptLoadedSuccessfully:P}=VA(),I=w.useRef(e);I.current=e;const q=w.useRef(n);q.current=n;const L=w.useRef(r);return L.current=r,w.useEffect(()=>{var O,B,$,F,z,U,V,ee,ie;if(P)return($=(B=(O=window==null?void 0:window.google)===null||O===void 0?void 0:O.accounts)===null||B===void 0?void 0:B.id)===null||$===void 0||$.initialize({client_id:E,callback:ae=>{var J;if(!(ae!=null&&ae.credential))return(J=q.current)===null||J===void 0?void 0:J.call(q);const{credential:K,select_by:W}=ae;I.current({credential:K,clientId:HA(ae),select_by:W})},...S}),(U=(z=(F=window==null?void 0:window.google)===null||F===void 0?void 0:F.accounts)===null||z===void 0?void 0:z.id)===null||U===void 0||U.renderButton(T.current,{type:a,theme:o,size:l,text:h,shape:d,logo_alignment:u,width:f,locale:C,click_listener:g,state:b}),t&&((ie=(ee=(V=window==null?void 0:window.google)===null||V===void 0?void 0:V.accounts)===null||ee===void 0?void 0:ee.id)===null||ie===void 0||ie.prompt(L.current)),()=>{var ae,J,K;t&&((K=(J=(ae=window==null?void 0:window.google)===null||ae===void 0?void 0:ae.accounts)===null||J===void 0?void 0:J.id)===null||K===void 0||K.cancel())}},[E,P,t,a,o,l,h,d,u,f,C]),Fn.createElement("div",{...v,ref:T,style:{height:GA[l],...v==null?void 0:v.style}})}var Mm={},CN;function WA(){if(CN)return Mm;CN=1,Object.defineProperty(Mm,"__esModule",{value:!0}),Mm.parse=l,Mm.serialize=u;const e=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,n=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,r=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{const b=function(){};return b.prototype=Object.create(null),b})();function l(b,v){const S=new o,T=b.length;if(T<2)return S;const E=(v==null?void 0:v.decode)||f;let C=0;do{const P=b.indexOf("=",C);if(P===-1)break;const I=b.indexOf(";",C),q=I===-1?T:I;if(P>q){C=b.lastIndexOf(";",P-1)+1;continue}const L=h(b,C,P),O=d(b,P,L),B=b.slice(L,O);if(S[B]===void 0){let $=h(b,P+1,q),F=d(b,q,$);const z=E(b.slice($,F));S[B]=z}C=q+1}while(C<T);return S}function h(b,v,S){do{const T=b.charCodeAt(v);if(T!==32&&T!==9)return v}while(++v<S);return S}function d(b,v,S){for(;v>S;){const T=b.charCodeAt(--v);if(T!==32&&T!==9)return v+1}return S}function u(b,v,S){const T=(S==null?void 0:S.encode)||encodeURIComponent;if(!e.test(b))throw new TypeError(`argument name is invalid: ${b}`);const E=T(v);if(!n.test(E))throw new TypeError(`argument val is invalid: ${v}`);let C=b+"="+E;if(!S)return C;if(S.maxAge!==void 0){if(!Number.isInteger(S.maxAge))throw new TypeError(`option maxAge is invalid: ${S.maxAge}`);C+="; Max-Age="+S.maxAge}if(S.domain){if(!t.test(S.domain))throw new TypeError(`option domain is invalid: ${S.domain}`);C+="; Domain="+S.domain}if(S.path){if(!r.test(S.path))throw new TypeError(`option path is invalid: ${S.path}`);C+="; Path="+S.path}if(S.expires){if(!g(S.expires)||!Number.isFinite(S.expires.valueOf()))throw new TypeError(`option expires is invalid: ${S.expires}`);C+="; Expires="+S.expires.toUTCString()}if(S.httpOnly&&(C+="; HttpOnly"),S.secure&&(C+="; Secure"),S.partitioned&&(C+="; Partitioned"),S.priority)switch(typeof S.priority=="string"?S.priority.toLowerCase():void 0){case"low":C+="; Priority=Low";break;case"medium":C+="; Priority=Medium";break;case"high":C+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${S.priority}`)}if(S.sameSite)switch(typeof S.sameSite=="string"?S.sameSite.toLowerCase():S.sameSite){case!0:case"strict":C+="; SameSite=Strict";break;case"lax":C+="; SameSite=Lax";break;case"none":C+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${S.sameSite}`)}return C}function f(b){if(b.indexOf("%")===-1)return b;try{return decodeURIComponent(b)}catch{return b}}function g(b){return a.call(b)==="[object Date]"}return Mm}WA();var kN="popstate";function QA(e={}){function n(r,a){let{pathname:o,search:l,hash:h}=r.location;return n1("",{pathname:o,search:l,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(r,a){return typeof a=="string"?a:rg(a)}return KA(n,t,null,e)}function Di(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Po(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function JA(){return Math.random().toString(36).substring(2,10)}function TN(e,n){return{usr:e.state,key:e.key,idx:n}}function n1(e,n,t=null,r){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof n=="string"?sp(n):n,state:t,key:n&&n.key||r||JA()}}function rg({pathname:e="/",search:n="",hash:t=""}){return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),t&&t!=="#"&&(e+=t.charAt(0)==="#"?t:"#"+t),e}function sp(e){let n={};if(e){let t=e.indexOf("#");t>=0&&(n.hash=e.substring(t),e=e.substring(0,t));let r=e.indexOf("?");r>=0&&(n.search=e.substring(r),e=e.substring(0,r)),e&&(n.pathname=e)}return n}function KA(e,n,t,r={}){let{window:a=document.defaultView,v5Compat:o=!1}=r,l=a.history,h="POP",d=null,u=f();u==null&&(u=0,l.replaceState({...l.state,idx:u},""));function f(){return(l.state||{idx:null}).idx}function g(){h="POP";let E=f(),C=E==null?null:E-u;u=E,d&&d({action:h,location:T.location,delta:C})}function b(E,C){h="PUSH";let P=n1(T.location,E,C);u=f()+1;let I=TN(P,u),q=T.createHref(P);try{l.pushState(I,"",q)}catch(L){if(L instanceof DOMException&&L.name==="DataCloneError")throw L;a.location.assign(q)}o&&d&&d({action:h,location:T.location,delta:1})}function v(E,C){h="REPLACE";let P=n1(T.location,E,C);u=f();let I=TN(P,u),q=T.createHref(P);l.replaceState(I,"",q),o&&d&&d({action:h,location:T.location,delta:0})}function S(E){return XA(E)}let T={get action(){return h},get location(){return e(a,l)},listen(E){if(d)throw new Error("A history only accepts one active listener");return a.addEventListener(kN,g),d=E,()=>{a.removeEventListener(kN,g),d=null}},createHref(E){return n(a,E)},createURL:S,encodeLocation(E){let C=S(E);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:b,replace:v,go(E){return l.go(E)}};return T}function XA(e,n=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Di(t,"No window.location.(origin|href) available to create URL");let r=typeof e=="string"?e:rg(e);return r=r.replace(/ $/,"%20"),!n&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function TC(e,n,t="/"){return ZA(e,n,t,!1)}function ZA(e,n,t,r){let a=typeof n=="string"?sp(n):n,o=bc(a.pathname||"/",t);if(o==null)return null;let l=EC(e);eD(l);let h=null;for(let d=0;h==null&&d<l.length;++d){let u=dD(o);h=cD(l[d],u,r)}return h}function EC(e,n=[],t=[],r=""){let a=(o,l,h)=>{let d={relativePath:h===void 0?o.path||"":h,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};d.relativePath.startsWith("/")&&(Di(d.relativePath.startsWith(r),`Absolute route path "${d.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(r.length));let u=yc([r,d.relativePath]),f=t.concat(d);o.children&&o.children.length>0&&(Di(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${u}".`),EC(o.children,n,f,u)),!(o.path==null&&!o.index)&&n.push({path:u,score:oD(u,o.index),routesMeta:f})};return e.forEach((o,l)=>{var h;if(o.path===""||!((h=o.path)!=null&&h.includes("?")))a(o,l);else for(let d of AC(o.path))a(o,l,d)}),n}function AC(e){let n=e.split("/");if(n.length===0)return[];let[t,...r]=n,a=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return a?[o,""]:[o];let l=AC(r.join("/")),h=[];return h.push(...l.map(d=>d===""?o:[o,d].join("/"))),a&&h.push(...l),h.map(d=>e.startsWith("/")&&d===""?"/":d)}function eD(e){e.sort((n,t)=>n.score!==t.score?t.score-n.score:lD(n.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var tD=/^:[\w-]+$/,nD=3,iD=2,rD=1,aD=10,sD=-2,EN=e=>e==="*";function oD(e,n){let t=e.split("/"),r=t.length;return t.some(EN)&&(r+=sD),n&&(r+=iD),t.filter(a=>!EN(a)).reduce((a,o)=>a+(tD.test(o)?nD:o===""?rD:aD),r)}function lD(e,n){return e.length===n.length&&e.slice(0,-1).every((r,a)=>r===n[a])?e[e.length-1]-n[n.length-1]:0}function cD(e,n,t=!1){let{routesMeta:r}=e,a={},o="/",l=[];for(let h=0;h<r.length;++h){let d=r[h],u=h===r.length-1,f=o==="/"?n:n.slice(o.length)||"/",g=nb({path:d.relativePath,caseSensitive:d.caseSensitive,end:u},f),b=d.route;if(!g&&u&&t&&!r[r.length-1].route.index&&(g=nb({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},f)),!g)return null;Object.assign(a,g.params),l.push({params:a,pathname:yc([o,g.pathname]),pathnameBase:mD(yc([o,g.pathnameBase])),route:b}),g.pathnameBase!=="/"&&(o=yc([o,g.pathnameBase]))}return l}function nb(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[t,r]=uD(e.path,e.caseSensitive,e.end),a=n.match(t);if(!a)return null;let o=a[0],l=o.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:r.reduce((u,{paramName:f,isOptional:g},b)=>{if(f==="*"){let S=h[b]||"";l=o.slice(0,o.length-S.length).replace(/(.)\/+$/,"$1")}const v=h[b];return g&&!v?u[f]=void 0:u[f]=(v||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:l,pattern:e}}function uD(e,n=!1,t=!0){Po(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,h,d)=>(r.push({paramName:h,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(r.push({paramName:"*"}),a+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?a+="\\/*$":e!==""&&e!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,n?void 0:"i"),r]}function dD(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Po(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),e}}function bc(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let t=n.endsWith("/")?n.length-1:n.length,r=e.charAt(t);return r&&r!=="/"?null:e.slice(t)||"/"}function hD(e,n="/"){let{pathname:t,search:r="",hash:a=""}=typeof e=="string"?sp(e):e;return{pathname:t?t.startsWith("/")?t:fD(t,n):n,search:gD(r),hash:yD(a)}}function fD(e,n){let t=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(a=>{a===".."?t.length>1&&t.pop():a!=="."&&t.push(a)}),t.length>1?t.join("/"):"/"}function Kv(e,n,t,r){return`Cannot include a '${e}' character in a manually specified \`to.${n}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pD(e){return e.filter((n,t)=>t===0||n.route.path&&n.route.path.length>0)}function cw(e){let n=pD(e);return n.map((t,r)=>r===n.length-1?t.pathname:t.pathnameBase)}function uw(e,n,t,r=!1){let a;typeof e=="string"?a=sp(e):(a={...e},Di(!a.pathname||!a.pathname.includes("?"),Kv("?","pathname","search",a)),Di(!a.pathname||!a.pathname.includes("#"),Kv("#","pathname","hash",a)),Di(!a.search||!a.search.includes("#"),Kv("#","search","hash",a)));let o=e===""||a.pathname==="",l=o?"/":a.pathname,h;if(l==null)h=t;else{let g=n.length-1;if(!r&&l.startsWith("..")){let b=l.split("/");for(;b[0]==="..";)b.shift(),g-=1;a.pathname=b.join("/")}h=g>=0?n[g]:"/"}let d=hD(a,h),u=l&&l!=="/"&&l.endsWith("/"),f=(o||l===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(u||f)&&(d.pathname+="/"),d}var yc=e=>e.join("/").replace(/\/\/+/g,"/"),mD=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),gD=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,yD=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function xD(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}var DC=["POST","PUT","PATCH","DELETE"];new Set(DC);var bD=["GET",...DC];new Set(bD);var op=w.createContext(null);op.displayName="DataRouter";var Ab=w.createContext(null);Ab.displayName="DataRouterState";var PC=w.createContext({isTransitioning:!1});PC.displayName="ViewTransition";var vD=w.createContext(new Map);vD.displayName="Fetchers";var wD=w.createContext(null);wD.displayName="Await";var Oo=w.createContext(null);Oo.displayName="Navigation";var gg=w.createContext(null);gg.displayName="Location";var Lo=w.createContext({outlet:null,matches:[],isDataRoute:!1});Lo.displayName="Route";var dw=w.createContext(null);dw.displayName="RouteError";function ND(e,{relative:n}={}){Di(lp(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=w.useContext(Oo),{hash:a,pathname:o,search:l}=yg(e,{relative:n}),h=o;return t!=="/"&&(h=o==="/"?t:yc([t,o])),r.createHref({pathname:h,search:l,hash:a})}function lp(){return w.useContext(gg)!=null}function $r(){return Di(lp(),"useLocation() may be used only in the context of a <Router> component."),w.useContext(gg).location}var IC="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function MC(e){w.useContext(Oo).static||w.useLayoutEffect(e)}function Ft(){let{isDataRoute:e}=w.useContext(Lo);return e?RD():SD()}function SD(){Di(lp(),"useNavigate() may be used only in the context of a <Router> component.");let e=w.useContext(op),{basename:n,navigator:t}=w.useContext(Oo),{matches:r}=w.useContext(Lo),{pathname:a}=$r(),o=JSON.stringify(cw(r)),l=w.useRef(!1);return MC(()=>{l.current=!0}),w.useCallback((d,u={})=>{if(Po(l.current,IC),!l.current)return;if(typeof d=="number"){t.go(d);return}let f=uw(d,JSON.parse(o),a,u.relative==="path");e==null&&n!=="/"&&(f.pathname=f.pathname==="/"?n:yc([n,f.pathname])),(u.replace?t.replace:t.push)(f,u.state,u)},[n,t,o,a,e])}w.createContext(null);function ia(){let{matches:e}=w.useContext(Lo),n=e[e.length-1];return n?n.params:{}}function yg(e,{relative:n}={}){let{matches:t}=w.useContext(Lo),{pathname:r}=$r(),a=JSON.stringify(cw(t));return w.useMemo(()=>uw(e,JSON.parse(a),r,n==="path"),[e,a,r,n])}function jD(e,n){return RC(e,n)}function RC(e,n,t,r){var P;Di(lp(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a,static:o}=w.useContext(Oo),{matches:l}=w.useContext(Lo),h=l[l.length-1],d=h?h.params:{},u=h?h.pathname:"/",f=h?h.pathnameBase:"/",g=h&&h.route;{let I=g&&g.path||"";OC(u,!g||I.endsWith("*")||I.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${I}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${I}"> to <Route path="${I==="/"?"*":`${I}/*`}">.`)}let b=$r(),v;if(n){let I=typeof n=="string"?sp(n):n;Di(f==="/"||((P=I.pathname)==null?void 0:P.startsWith(f)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${f}" but pathname "${I.pathname}" was given in the \`location\` prop.`),v=I}else v=b;let S=v.pathname||"/",T=S;if(f!=="/"){let I=f.replace(/^\//,"").split("/");T="/"+S.replace(/^\//,"").split("/").slice(I.length).join("/")}let E=!o&&t&&t.matches&&t.matches.length>0?t.matches:TC(e,{pathname:T});Po(g||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Po(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let C=ED(E&&E.map(I=>Object.assign({},I,{params:Object.assign({},d,I.params),pathname:yc([f,a.encodeLocation?a.encodeLocation(I.pathname).pathname:I.pathname]),pathnameBase:I.pathnameBase==="/"?f:yc([f,a.encodeLocation?a.encodeLocation(I.pathnameBase).pathname:I.pathnameBase])})),l,t,r);return n&&C?w.createElement(gg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},C):C}function _D(){let e=MD(),n=xD(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),t=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},l=null;return console.error("Error handled by React Router default ErrorBoundary:",e),l=w.createElement(w.Fragment,null,w.createElement("p",null," Hey developer "),w.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",w.createElement("code",{style:o},"ErrorBoundary")," or"," ",w.createElement("code",{style:o},"errorElement")," prop on your route.")),w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},n),t?w.createElement("pre",{style:a},t):null,l)}var CD=w.createElement(_D,null),kD=class extends w.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?w.createElement(Lo.Provider,{value:this.props.routeContext},w.createElement(dw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function TD({routeContext:e,match:n,children:t}){let r=w.useContext(op);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),w.createElement(Lo.Provider,{value:e},t)}function ED(e,n=[],t=null,r=null){if(e==null){if(!t)return null;if(t.errors)e=t.matches;else if(n.length===0&&!t.initialized&&t.matches.length>0)e=t.matches;else return null}let a=e,o=t==null?void 0:t.errors;if(o!=null){let d=a.findIndex(u=>u.route.id&&(o==null?void 0:o[u.route.id])!==void 0);Di(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),a=a.slice(0,Math.min(a.length,d+1))}let l=!1,h=-1;if(t)for(let d=0;d<a.length;d++){let u=a[d];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(h=d),u.route.id){let{loaderData:f,errors:g}=t,b=u.route.loader&&!f.hasOwnProperty(u.route.id)&&(!g||g[u.route.id]===void 0);if(u.route.lazy||b){l=!0,h>=0?a=a.slice(0,h+1):a=[a[0]];break}}}return a.reduceRight((d,u,f)=>{let g,b=!1,v=null,S=null;t&&(g=o&&u.route.id?o[u.route.id]:void 0,v=u.route.errorElement||CD,l&&(h<0&&f===0?(OC("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,S=null):h===f&&(b=!0,S=u.route.hydrateFallbackElement||null)));let T=n.concat(a.slice(0,f+1)),E=()=>{let C;return g?C=v:b?C=S:u.route.Component?C=w.createElement(u.route.Component,null):u.route.element?C=u.route.element:C=d,w.createElement(TD,{match:u,routeContext:{outlet:d,matches:T,isDataRoute:t!=null},children:C})};return t&&(u.route.ErrorBoundary||u.route.errorElement||f===0)?w.createElement(kD,{location:t.location,revalidation:t.revalidation,component:v,error:g,children:E(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):E()},null)}function hw(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function AD(e){let n=w.useContext(op);return Di(n,hw(e)),n}function DD(e){let n=w.useContext(Ab);return Di(n,hw(e)),n}function PD(e){let n=w.useContext(Lo);return Di(n,hw(e)),n}function fw(e){let n=PD(e),t=n.matches[n.matches.length-1];return Di(t.route.id,`${e} can only be used on routes that contain a unique "id"`),t.route.id}function ID(){return fw("useRouteId")}function MD(){var r;let e=w.useContext(dw),n=DD("useRouteError"),t=fw("useRouteError");return e!==void 0?e:(r=n.errors)==null?void 0:r[t]}function RD(){let{router:e}=AD("useNavigate"),n=fw("useNavigate"),t=w.useRef(!1);return MC(()=>{t.current=!0}),w.useCallback(async(a,o={})=>{Po(t.current,IC),t.current&&(typeof a=="number"?e.navigate(a):await e.navigate(a,{fromRouteId:n,...o}))},[e,n])}var AN={};function OC(e,n,t){!n&&!AN[e]&&(AN[e]=!0,Po(!1,t))}w.memo(OD);function OD({routes:e,future:n,state:t}){return RC(e,void 0,t,n)}function Hn({to:e,replace:n,state:t,relative:r}){Di(lp(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=w.useContext(Oo);Po(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:o}=w.useContext(Lo),{pathname:l}=$r(),h=Ft(),d=uw(e,cw(o),l,r==="path"),u=JSON.stringify(d);return w.useEffect(()=>{h(JSON.parse(u),{replace:n,state:t,relative:r})},[h,u,r,n,t]),null}function jt(e){Di(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function LD({basename:e="/",children:n=null,location:t,navigationType:r="POP",navigator:a,static:o=!1}){Di(!lp(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=e.replace(/^\/*/,"/"),h=w.useMemo(()=>({basename:l,navigator:a,static:o,future:{}}),[l,a,o]);typeof t=="string"&&(t=sp(t));let{pathname:d="/",search:u="",hash:f="",state:g=null,key:b="default"}=t,v=w.useMemo(()=>{let S=bc(d,l);return S==null?null:{location:{pathname:S,search:u,hash:f,state:g,key:b},navigationType:r}},[l,d,u,f,g,b,r]);return Po(v!=null,`<Router basename="${l}"> is not able to match the URL "${d}${u}${f}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:w.createElement(Oo.Provider,{value:h},w.createElement(gg.Provider,{children:n,value:v}))}function Ff({children:e,location:n}){return jD(i1(e),n)}function i1(e,n=[]){let t=[];return w.Children.forEach(e,(r,a)=>{if(!w.isValidElement(r))return;let o=[...n,a];if(r.type===w.Fragment){t.push.apply(t,i1(r.props.children,o));return}Di(r.type===jt,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Di(!r.props.index||!r.props.children,"An index route cannot have child routes.");let l={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(l.children=i1(r.props.children,o)),t.push(l)}),t}var Gx="get",Yx="application/x-www-form-urlencoded";function Db(e){return e!=null&&typeof e.tagName=="string"}function FD(e){return Db(e)&&e.tagName.toLowerCase()==="button"}function $D(e){return Db(e)&&e.tagName.toLowerCase()==="form"}function zD(e){return Db(e)&&e.tagName.toLowerCase()==="input"}function BD(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function UD(e,n){return e.button===0&&(!n||n==="_self")&&!BD(e)}var vx=null;function qD(){if(vx===null)try{new FormData(document.createElement("form"),0),vx=!1}catch{vx=!0}return vx}var VD=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Xv(e){return e!=null&&!VD.has(e)?(Po(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Yx}"`),null):e}function HD(e,n){let t,r,a,o,l;if($D(e)){let h=e.getAttribute("action");r=h?bc(h,n):null,t=e.getAttribute("method")||Gx,a=Xv(e.getAttribute("enctype"))||Yx,o=new FormData(e)}else if(FD(e)||zD(e)&&(e.type==="submit"||e.type==="image")){let h=e.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=e.getAttribute("formaction")||h.getAttribute("action");if(r=d?bc(d,n):null,t=e.getAttribute("formmethod")||h.getAttribute("method")||Gx,a=Xv(e.getAttribute("formenctype"))||Xv(h.getAttribute("enctype"))||Yx,o=new FormData(h,e),!qD()){let{name:u,type:f,value:g}=e;if(f==="image"){let b=u?`${u}.`:"";o.append(`${b}x`,"0"),o.append(`${b}y`,"0")}else u&&o.append(u,g)}}else{if(Db(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Gx,r=null,a=Yx,l=e}return o&&a==="text/plain"&&(l=o,o=void 0),{action:r,method:t.toLowerCase(),encType:a,formData:o,body:l}}function pw(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}async function GD(e,n){if(e.id in n)return n[e.id];try{let t=await import(e.module);return n[e.id]=t,t}catch(t){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function YD(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function WD(e,n,t){let r=await Promise.all(e.map(async a=>{let o=n.routes[a.route.id];if(o){let l=await GD(o,t);return l.links?l.links():[]}return[]}));return XD(r.flat(1).filter(YD).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function DN(e,n,t,r,a,o){let l=(d,u)=>t[u]?d.route.id!==t[u].route.id:!0,h=(d,u)=>{var f;return t[u].pathname!==d.pathname||((f=t[u].route.path)==null?void 0:f.endsWith("*"))&&t[u].params["*"]!==d.params["*"]};return o==="assets"?n.filter((d,u)=>l(d,u)||h(d,u)):o==="data"?n.filter((d,u)=>{var g;let f=r.routes[d.route.id];if(!f||!f.hasLoader)return!1;if(l(d,u)||h(d,u))return!0;if(d.route.shouldRevalidate){let b=d.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:((g=t[0])==null?void 0:g.params)||{},nextUrl:new URL(e,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof b=="boolean")return b}return!0}):[]}function QD(e,n,{includeHydrateFallback:t}={}){return JD(e.map(r=>{let a=n.routes[r.route.id];if(!a)return[];let o=[a.module];return a.clientActionModule&&(o=o.concat(a.clientActionModule)),a.clientLoaderModule&&(o=o.concat(a.clientLoaderModule)),t&&a.hydrateFallbackModule&&(o=o.concat(a.hydrateFallbackModule)),a.imports&&(o=o.concat(a.imports)),o}).flat(1))}function JD(e){return[...new Set(e)]}function KD(e){let n={},t=Object.keys(e).sort();for(let r of t)n[r]=e[r];return n}function XD(e,n){let t=new Set;return new Set(n),e.reduce((r,a)=>{let o=JSON.stringify(KD(a));return t.has(o)||(t.add(o),r.push({key:o,link:a})),r},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var ZD=new Set([100,101,204,205]);function eP(e,n){let t=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return t.pathname==="/"?t.pathname="_root.data":n&&bc(t.pathname,n)==="/"?t.pathname=`${n.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function LC(){let e=w.useContext(op);return pw(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function tP(){let e=w.useContext(Ab);return pw(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var mw=w.createContext(void 0);mw.displayName="FrameworkContext";function FC(){let e=w.useContext(mw);return pw(e,"You must render this element inside a <HydratedRouter> element"),e}function nP(e,n){let t=w.useContext(mw),[r,a]=w.useState(!1),[o,l]=w.useState(!1),{onFocus:h,onBlur:d,onMouseEnter:u,onMouseLeave:f,onTouchStart:g}=n,b=w.useRef(null);w.useEffect(()=>{if(e==="render"&&l(!0),e==="viewport"){let T=C=>{C.forEach(P=>{l(P.isIntersecting)})},E=new IntersectionObserver(T,{threshold:.5});return b.current&&E.observe(b.current),()=>{E.disconnect()}}},[e]),w.useEffect(()=>{if(r){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[r]);let v=()=>{a(!0)},S=()=>{a(!1),l(!1)};return t?e!=="intent"?[o,b,{}]:[o,b,{onFocus:Rm(h,v),onBlur:Rm(d,S),onMouseEnter:Rm(u,v),onMouseLeave:Rm(f,S),onTouchStart:Rm(g,v)}]:[!1,b,{}]}function Rm(e,n){return t=>{e&&e(t),t.defaultPrevented||n(t)}}function iP({page:e,...n}){let{router:t}=LC(),r=w.useMemo(()=>TC(t.routes,e,t.basename),[t.routes,e,t.basename]);return r?w.createElement(aP,{page:e,matches:r,...n}):null}function rP(e){let{manifest:n,routeModules:t}=FC(),[r,a]=w.useState([]);return w.useEffect(()=>{let o=!1;return WD(e,n,t).then(l=>{o||a(l)}),()=>{o=!0}},[e,n,t]),r}function aP({page:e,matches:n,...t}){let r=$r(),{manifest:a,routeModules:o}=FC(),{basename:l}=LC(),{loaderData:h,matches:d}=tP(),u=w.useMemo(()=>DN(e,n,d,a,r,"data"),[e,n,d,a,r]),f=w.useMemo(()=>DN(e,n,d,a,r,"assets"),[e,n,d,a,r]),g=w.useMemo(()=>{if(e===r.pathname+r.search+r.hash)return[];let S=new Set,T=!1;if(n.forEach(C=>{var I;let P=a.routes[C.route.id];!P||!P.hasLoader||(!u.some(q=>q.route.id===C.route.id)&&C.route.id in h&&((I=o[C.route.id])!=null&&I.shouldRevalidate)||P.hasClientLoader?T=!0:S.add(C.route.id))}),S.size===0)return[];let E=eP(e,l);return T&&S.size>0&&E.searchParams.set("_routes",n.filter(C=>S.has(C.route.id)).map(C=>C.route.id).join(",")),[E.pathname+E.search]},[l,h,r,a,u,n,e,o]),b=w.useMemo(()=>QD(f,a),[f,a]),v=rP(f);return w.createElement(w.Fragment,null,g.map(S=>w.createElement("link",{key:S,rel:"prefetch",as:"fetch",href:S,...t})),b.map(S=>w.createElement("link",{key:S,rel:"modulepreload",href:S,...t})),v.map(({key:S,link:T})=>w.createElement("link",{key:S,...T})))}function sP(...e){return n=>{e.forEach(t=>{typeof t=="function"?t(n):t!=null&&(t.current=n)})}}var $C=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{$C&&(window.__reactRouterVersion="7.6.0")}catch{}function oP({basename:e,children:n,window:t}){let r=w.useRef();r.current==null&&(r.current=QA({window:t,v5Compat:!0}));let a=r.current,[o,l]=w.useState({action:a.action,location:a.location}),h=w.useCallback(d=>{w.startTransition(()=>l(d))},[l]);return w.useLayoutEffect(()=>a.listen(h),[a,h]),w.createElement(LD,{basename:e,children:n,location:o.location,navigationType:o.action,navigator:a})}var zC=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Hs=w.forwardRef(function({onClick:n,discover:t="render",prefetch:r="none",relative:a,reloadDocument:o,replace:l,state:h,target:d,to:u,preventScrollReset:f,viewTransition:g,...b},v){let{basename:S}=w.useContext(Oo),T=typeof u=="string"&&zC.test(u),E,C=!1;if(typeof u=="string"&&T&&(E=u,$C))try{let F=new URL(window.location.href),z=u.startsWith("//")?new URL(F.protocol+u):new URL(u),U=bc(z.pathname,S);z.origin===F.origin&&U!=null?u=U+z.search+z.hash:C=!0}catch{Po(!1,`<Link to="${u}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let P=ND(u,{relative:a}),[I,q,L]=nP(r,b),O=dP(u,{replace:l,state:h,target:d,preventScrollReset:f,relative:a,viewTransition:g});function B(F){n&&n(F),F.defaultPrevented||O(F)}let $=w.createElement("a",{...b,...L,href:E||P,onClick:C||o?n:B,ref:sP(v,q),target:d,"data-discover":!T&&t==="render"?"true":void 0});return I&&!T?w.createElement(w.Fragment,null,$,w.createElement(iP,{page:P})):$});Hs.displayName="Link";var lP=w.forwardRef(function({"aria-current":n="page",caseSensitive:t=!1,className:r="",end:a=!1,style:o,to:l,viewTransition:h,children:d,...u},f){let g=yg(l,{relative:u.relative}),b=$r(),v=w.useContext(Ab),{navigator:S,basename:T}=w.useContext(Oo),E=v!=null&&gP(g)&&h===!0,C=S.encodeLocation?S.encodeLocation(g).pathname:g.pathname,P=b.pathname,I=v&&v.navigation&&v.navigation.location?v.navigation.location.pathname:null;t||(P=P.toLowerCase(),I=I?I.toLowerCase():null,C=C.toLowerCase()),I&&T&&(I=bc(I,T)||I);const q=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let L=P===C||!a&&P.startsWith(C)&&P.charAt(q)==="/",O=I!=null&&(I===C||!a&&I.startsWith(C)&&I.charAt(C.length)==="/"),B={isActive:L,isPending:O,isTransitioning:E},$=L?n:void 0,F;typeof r=="function"?F=r(B):F=[r,L?"active":null,O?"pending":null,E?"transitioning":null].filter(Boolean).join(" ");let z=typeof o=="function"?o(B):o;return w.createElement(Hs,{...u,"aria-current":$,className:F,ref:f,style:z,to:l,viewTransition:h},typeof d=="function"?d(B):d)});lP.displayName="NavLink";var cP=w.forwardRef(({discover:e="render",fetcherKey:n,navigate:t,reloadDocument:r,replace:a,state:o,method:l=Gx,action:h,onSubmit:d,relative:u,preventScrollReset:f,viewTransition:g,...b},v)=>{let S=pP(),T=mP(h,{relative:u}),E=l.toLowerCase()==="get"?"get":"post",C=typeof h=="string"&&zC.test(h),P=I=>{if(d&&d(I),I.defaultPrevented)return;I.preventDefault();let q=I.nativeEvent.submitter,L=(q==null?void 0:q.getAttribute("formmethod"))||l;S(q||I.currentTarget,{fetcherKey:n,method:L,navigate:t,replace:a,state:o,relative:u,preventScrollReset:f,viewTransition:g})};return w.createElement("form",{ref:v,method:E,action:T,onSubmit:r?d:P,...b,"data-discover":!C&&e==="render"?"true":void 0})});cP.displayName="Form";function uP(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function BC(e){let n=w.useContext(op);return Di(n,uP(e)),n}function dP(e,{target:n,replace:t,state:r,preventScrollReset:a,relative:o,viewTransition:l}={}){let h=Ft(),d=$r(),u=yg(e,{relative:o});return w.useCallback(f=>{if(UD(f,n)){f.preventDefault();let g=t!==void 0?t:rg(d)===rg(u);h(e,{replace:g,state:r,preventScrollReset:a,relative:o,viewTransition:l})}},[d,h,u,t,r,n,e,a,o,l])}var hP=0,fP=()=>`__${String(++hP)}__`;function pP(){let{router:e}=BC("useSubmit"),{basename:n}=w.useContext(Oo),t=ID();return w.useCallback(async(r,a={})=>{let{action:o,method:l,encType:h,formData:d,body:u}=HD(r,n);if(a.navigate===!1){let f=a.fetcherKey||fP();await e.fetch(f,t,a.action||o,{preventScrollReset:a.preventScrollReset,formData:d,body:u,formMethod:a.method||l,formEncType:a.encType||h,flushSync:a.flushSync})}else await e.navigate(a.action||o,{preventScrollReset:a.preventScrollReset,formData:d,body:u,formMethod:a.method||l,formEncType:a.encType||h,replace:a.replace,state:a.state,fromRouteId:t,flushSync:a.flushSync,viewTransition:a.viewTransition})},[e,n,t])}function mP(e,{relative:n}={}){let{basename:t}=w.useContext(Oo),r=w.useContext(Lo);Di(r,"useFormAction must be used inside a RouteContext");let[a]=r.matches.slice(-1),o={...yg(e||".",{relative:n})},l=$r();if(e==null){o.search=l.search;let h=new URLSearchParams(o.search),d=h.getAll("index");if(d.some(f=>f==="")){h.delete("index"),d.filter(g=>g).forEach(g=>h.append("index",g));let f=h.toString();o.search=f?`?${f}`:""}}return(!e||e===".")&&a.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:yc([t,o.pathname])),rg(o)}function gP(e,n={}){let t=w.useContext(PC);Di(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=BC("useViewTransitionState"),a=yg(e,{relative:n.relative});if(!t.isTransitioning)return!1;let o=bc(t.currentLocation.pathname,r)||t.currentLocation.pathname,l=bc(t.nextLocation.pathname,r)||t.nextLocation.pathname;return nb(a.pathname,l)!=null||nb(a.pathname,o)!=null}[...ZD];var yP=CC();class xP extends w.Component{constructor(){super(...arguments);ui(this,"state",{hasError:!1})}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,r){console.error("Uncaught error:",t,r)}render(){return this.state.hasError?i.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"red",border:"1px solid red",borderRadius:"5px"},children:[i.jsx("h1",{children:"Something went wrong."}),i.jsx("p",{children:"We are sorry for the inconvenience. Please try again later."})]}):this.props.children}}class bP{constructor(){ui(this,"requestCount",0);ui(this,"listeners",[])}subscribe(n){return this.listeners.push(n),()=>{this.listeners=this.listeners.filter(t=>t!==n)}}notify(){const n=this.requestCount>0;this.listeners.forEach(t=>t(n))}addRequest(){this.requestCount++,this.notify()}removeRequest(){this.requestCount--,this.requestCount<0&&(this.requestCount=0),this.notify()}}const ko=new bP,vP="https://backend.newtons.in",wP=()=>localStorage.getItem("authToken"),ce=async(e,n={})=>{const t=wP(),r={...n.headers};t&&(r.Authorization=`Bearer ${t}`),!(n.body instanceof FormData)&&!r["Content-Type"]&&(r["Content-Type"]="application/json");const a=r;let o=e.startsWith("/")?e:`/${e}`;o.startsWith("/api/")||(o=`/api${o}`);const l=`${vP}${o}`;ko.addRequest();try{console.log(`Making API call to: ${l}`);const h=await fetch(l,{...n,headers:a});if(h.status===401)throw console.error("Unauthorized access - Token might be invalid or expired. Logging out."),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),window.location.href="/login",new Error("Unauthorized");if(!h.ok){let d=`HTTP error! status: ${h.status}`;try{const u=await h.json();d=(u==null?void 0:u.message)||(u==null?void 0:u.error)||d}catch{}throw console.error(`API Error: ${h.status} ${h.statusText} - ${d}`),new Error(d)}return h}catch(h){throw h instanceof TypeError&&h.message==="Failed to fetch"?console.error("API Fetch Error: Network error or CORS issue. Check backend CORS configuration.",h):console.error("API Fetch Error:",h),h}finally{ko.removeRequest()}},NP=({onLoginSuccess:e})=>{const[n,t]=w.useState(""),[r,a]=w.useState(""),[o,l]=w.useState(null),[h,d]=w.useState(!1),u=Ft(),f=async b=>{b.preventDefault(),d(!0),l(null);try{const v=await ce("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r})});if(!v.ok){let T=`Login failed with status: ${v.status}`;try{T=(await v.json()).message||T}catch{try{const C=await v.text();C&&(T=`${T} - ${C}`)}catch{}}throw new Error(T)}const S=await v.json();console.log("Login successful:",S),localStorage.setItem("authToken",S.token),localStorage.setItem("currentUser",JSON.stringify(S.user)),S.user.clinic_id&&localStorage.setItem("currentClinicId",S.user.clinic_id),e(S.user),S.user.role==="doctor"?u("/dashboard/queue"):u("/dashboard")}catch(v){console.error("Login failed:",v),l(v.message||"Login failed. Please check your credentials.")}finally{d(!1)}},g=async b=>{d(!0),l(null);try{const v=await ce("/api/auth/google",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({credential:b.credential})});if(!v.ok)throw new Error("Google login failed");const S=await v.json();localStorage.setItem("authToken",S.token),localStorage.setItem("currentUser",JSON.stringify(S.user)),S.user.clinic_id&&localStorage.setItem("currentClinicId",S.user.clinic_id),e(S.user),S.user.role==="doctor"?u("/dashboard/queue"):u("/dashboard")}catch(v){console.error("Google login error:",v),l("Google login failed. Please try again.")}finally{d(!1)}};return i.jsx("div",{className:"auth-page-container",children:i.jsxs("div",{className:"auth-form-card",children:[i.jsx("h2",{className:"auth-title",children:"Newtons AI HMS"}),i.jsx("p",{className:"auth-subtitle",children:"Hospital Management System"}),i.jsxs("form",{onSubmit:f,className:"auth-form",children:[i.jsx("div",{className:"form-group",children:i.jsxs("div",{className:"auth-floating-input",children:[i.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:n,onChange:b=>t(b.target.value),className:"auth-text-input",placeholder:" "}),i.jsx("label",{htmlFor:"email",children:"Email Address"})]})}),i.jsx("div",{className:"form-group",children:i.jsxs("div",{className:"auth-floating-input",children:[i.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:r,onChange:b=>a(b.target.value),className:"auth-text-input",placeholder:" "}),i.jsx("label",{htmlFor:"password",children:"Password"})]})}),o&&i.jsx("div",{className:"auth-error-message",children:i.jsx("p",{children:o})}),i.jsx("div",{className:"form-group",children:i.jsx("button",{type:"submit",disabled:h,className:`auth-submit-button ${h?"loading":""}`,children:h?"Signing in...":"Sign In"})}),i.jsx("div",{className:"auth-divider",children:i.jsx("span",{children:"OR"})}),i.jsx("div",{className:"google-login-container",children:i.jsx(YA,{onSuccess:g,onError:()=>{l("Google Login Failed")},useOneTap:!0,theme:"outline",size:"large",width:"100%"})})]}),i.jsxs("div",{className:"auth-navigation-link-container",children:["Don't have an account?"," ",i.jsx(Hs,{to:"/register",className:"auth-navigation-link",children:"Register a new clinic"})]}),i.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})},SP=()=>{const[e,n]=w.useState(""),[t,r]=w.useState(""),[a,o]=w.useState(""),[l,h]=w.useState(""),[d,u]=w.useState(null),[f,g]=w.useState(!1),b=Ft(),v=async S=>{S.preventDefault(),g(!0),u(null);try{const T=await ce("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicName:e,userName:t,userEmail:a,userPassword:l})}),E=await T.json();if(!T.ok)throw new Error(E.message||`HTTP error! status: ${T.status}`);console.log("Registration successful:",E),alert("Registration successful! Please log in."),b("/login")}catch(T){console.error("Registration failed:",T),u(T.message||"Registration failed. Please try again.")}finally{g(!1)}};return i.jsx("div",{className:"auth-page-container",children:i.jsxs("div",{className:"auth-form-card",children:[i.jsx("h2",{className:"auth-title",children:"Newtons Ai HMS"}),i.jsx("p",{className:"auth-subtitle",children:"Register Clinic & Admin"}),i.jsxs("form",{onSubmit:v,className:"auth-form",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"clinicName",children:"Clinic Name"}),i.jsx("input",{id:"clinicName",name:"clinicName",type:"text",required:!0,value:e,onChange:S=>n(S.target.value),className:"auth-text-input",placeholder:"Your Clinic's Name"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"userName",children:"Your Name (Admin)"}),i.jsx("input",{id:"userName",name:"userName",type:"text",required:!0,value:t,onChange:S=>r(S.target.value),className:"auth-text-input",placeholder:"Your Full Name"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"userEmail",children:"Your Email (Admin Login)"}),i.jsx("input",{id:"userEmail",name:"userEmail",type:"email",autoComplete:"email",required:!0,value:a,onChange:S=>o(S.target.value),className:"auth-text-input",placeholder:"you@example.com"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"userPassword",children:"Password"}),i.jsx("input",{id:"userPassword",name:"userPassword",type:"password",required:!0,minLength:6,value:l,onChange:S=>h(S.target.value),className:"auth-text-input",placeholder:"Min. 6 characters"})]}),d&&i.jsx("div",{className:"auth-error-message",children:i.jsx("p",{children:d})}),i.jsx("div",{className:"form-group",children:i.jsx("button",{type:"submit",disabled:f,className:`auth-submit-button ${f?"loading":""}`,children:f?"Registering...":"Register Clinic & Admin"})})]}),i.jsxs("div",{className:"auth-navigation-link-container",children:["Already have an account?"," ",i.jsx(Hs,{to:"/login",className:"auth-navigation-link",children:"Sign in"})]}),i.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})};var UC={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},PN=Fn.createContext&&Fn.createContext(UC),jP=["attr","size","title"];function _P(e,n){if(e==null)return{};var t=CP(e,n),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(n.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}function CP(e,n){if(e==null)return{};var t={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(n.indexOf(r)>=0)continue;t[r]=e[r]}return t}function ib(){return ib=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},ib.apply(this,arguments)}function IN(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function rb(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?IN(Object(t),!0).forEach(function(r){kP(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):IN(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function kP(e,n,t){return n=TP(n),n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function TP(e){var n=EP(e,"string");return typeof n=="symbol"?n:n+""}function EP(e,n){if(typeof e!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,n);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function qC(e){return e&&e.map((n,t)=>Fn.createElement(n.tag,rb({key:t},n.attr),qC(n.child)))}function ps(e){return n=>Fn.createElement(AP,ib({attr:rb({},e.attr)},n),qC(e.child))}function AP(e){var n=t=>{var{attr:r,size:a,title:o}=e,l=_P(e,jP),h=a||t.size||"1em",d;return t.className&&(d=t.className),e.className&&(d=(d?d+" ":"")+e.className),Fn.createElement("svg",ib({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,l,{className:d,style:rb(rb({color:e.color||t.color},t.style),e.style),height:h,width:h,xmlns:"http://www.w3.org/2000/svg"}),o&&Fn.createElement("title",null,o),e.children)};return PN!==void 0?Fn.createElement(PN.Consumer,null,t=>n(t)):n(UC)}function Ef(e){return ps({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM96 424c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm96-192c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm128 368c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"},child:[]}]})(e)}function DP(e){return ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(e)}function MN(e){return ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(e)}function $f(e){return ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(e)}function Om(e){return ps({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480 320a96 96 0 1 0-96-96 96 96 0 0 0 96 96zm48 32a22.88 22.88 0 0 0-7.06 1.09 124.76 124.76 0 0 1-81.89 0A22.82 22.82 0 0 0 432 352a112 112 0 0 0-112 112.62c.14 26.26 21.73 47.38 48 47.38h224c26.27 0 47.86-21.12 48-47.38A112 112 0 0 0 528 352zm-198.09 10.45A145.19 145.19 0 0 1 352 344.62V128a32 32 0 0 0-32-32h-32V32a32 32 0 0 0-32-32H96a32 32 0 0 0-32 32v64H32a32 32 0 0 0-32 32v368a16 16 0 0 0 16 16h288.31A78.62 78.62 0 0 1 288 464.79a143.06 143.06 0 0 1 41.91-102.34zM144 404a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm48-122a6 6 0 0 1-6 6h-20a6 6 0 0 1-6-6v-26h-26a6 6 0 0 1-6-6v-20a6 6 0 0 1 6-6h26V70a6 6 0 0 1 6-6h20a6 6 0 0 1 6 6v26h26a6 6 0 0 1 6 6v20a6 6 0 0 1-6 6h-26zm80 250a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12z"},child:[]}]})(e)}function wx(e){return ps({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M352 288h-16v-88c0-4.42-3.58-8-8-8h-13.58c-4.74 0-9.37 1.4-13.31 4.03l-15.33 10.22a7.994 7.994 0 0 0-2.22 11.09l8.88 13.31a7.994 7.994 0 0 0 11.09 2.22l.47-.31V288h-16c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h64c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM608 64H32C14.33 64 0 78.33 0 96v320c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V96c0-17.67-14.33-32-32-32zM48 400v-64c35.35 0 64 28.65 64 64H48zm0-224v-64h64c0 35.35-28.65 64-64 64zm272 192c-53.02 0-96-50.15-96-112 0-61.86 42.98-112 96-112s96 50.14 96 112c0 61.87-43 112-96 112zm272 32h-64c0-35.35 28.65-64 64-64v64zm0-224c-35.35 0-64-28.65-64-64h64v64z"},child:[]}]})(e)}function Nx(e){return ps({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M112 32C50.1 32 0 82.1 0 144v224c0 61.9 50.1 112 112 112s112-50.1 112-112V144c0-61.9-50.1-112-112-112zm48 224H64V144c0-26.5 21.5-48 48-48s48 21.5 48 48v112zm139.7-29.7c-3.5-3.5-9.4-3.1-12.3.8-45.3 62.5-40.4 150.1 15.9 206.4 56.3 56.3 143.9 61.2 206.4 15.9 4-2.9 4.3-8.8.8-12.3L299.7 226.3zm229.8-19c-56.3-56.3-143.9-61.2-206.4-15.9-4 2.9-4.3 8.8-.8 12.3l210.8 210.8c3.5 3.5 9.4 3.1 12.3-.8 45.3-62.6 40.5-150.1-15.9-206.4z"},child:[]}]})(e)}function zf(e){return ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(e)}function VC(e){return ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(e)}function RN(e){return ps({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M447.1 112c-34.2.5-62.3 28.4-63 62.6-.5 24.3 12.5 45.6 32 56.8V344c0 57.3-50.2 104-112 104-60 0-109.2-44.1-111.9-99.2C265 333.8 320 269.2 320 192V36.6c0-11.4-8.1-21.3-19.3-23.5L237.8.5c-13-2.6-25.6 5.8-28.2 18.8L206.4 35c-2.6 13 5.8 25.6 18.8 28.2l30.7 6.1v121.4c0 52.9-42.2 96.7-95.1 97.2-53.4.5-96.9-42.7-96.9-96V69.4l30.7-6.1c13-2.6 21.4-15.2 18.8-28.2l-3.1-15.7C107.7 6.4 95.1-2 82.1.6L19.3 13C8.1 15.3 0 25.1 0 36.6V192c0 77.3 55.1 142 128.1 156.8C130.7 439.2 208.6 512 304 512c97 0 176-75.4 176-168V231.4c19.1-11.1 32-31.7 32-55.4 0-35.7-29.2-64.5-64.9-64zm.9 80c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16z"},child:[]}]})(e)}function HC(e){return ps({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function Zv(e){return ps({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zM104 424c0 13.3 10.7 24 24 24s24-10.7 24-24-10.7-24-24-24-24 10.7-24 24zm216-135.4v49c36.5 7.4 64 39.8 64 78.4v41.7c0 7.6-5.4 14.2-12.9 15.7l-32.2 6.4c-4.3.9-8.5-1.9-9.4-6.3l-3.1-15.7c-.9-4.3 1.9-8.6 6.3-9.4l19.3-3.9V416c0-62.8-96-65.1-96 1.9v26.7l19.3 3.9c4.3.9 7.1 5.1 6.3 9.4l-3.1 15.7c-.9 4.3-5.1 7.1-9.4 6.3l-31.2-4.2c-7.9-1.1-13.8-7.8-13.8-15.9V416c0-38.6 27.5-70.9 64-78.4v-45.2c-2.2.7-4.4 1.1-6.6 1.9-18 6.3-37.3 9.8-57.4 9.8s-39.4-3.5-57.4-9.8c-7.4-2.6-14.9-4.2-22.6-5.2v81.6c23.1 6.9 40 28.1 40 53.4 0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.3 16.9-46.5 40-53.4v-80.4C48.5 301 0 355.8 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-72-56.8-130.3-128-133.8z"},child:[]}]})(e)}function Lm(e){return ps({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(e)}const gw={superadmin:[{title:"Admin Pages",links:[{path:"/dashboard",name:"Super Admin Dashboard",icon:$f},{path:"/dashboard/clinic-subscriptions",name:"Clinic Subscriptions",icon:Om},{path:"/dashboard/users",name:"User Management",icon:Lm}]}],admin:[{title:"Dashboard",links:[{path:"/dashboard",name:"Admin Dashboard",icon:$f}]},{title:"Staff Management",links:[{path:"/dashboard/clinic-hub",name:"Clinic Hub",icon:Om},{path:"/dashboard/staff/add",name:"Add Staff",icon:Zv}]},{title:"Patient Management",links:[{path:"/dashboard/patients/add",name:"Add Patient",icon:Om},{path:"/dashboard/patients",name:"All Patients",icon:Lm},{path:"/dashboard/search-patient",name:"Search Patient",icon:zf}]},{title:"Inventory & Pharmacy",links:[{path:"/dashboard/analysis",name:"Inventory Analysis",icon:Ef},{path:"/dashboard/inventory",name:"Pharmacy Inventory",icon:Nx},{path:"/dashboard/purchase",name:"Add Drug",icon:Nx},{path:"/dashboard/recurring-medications",name:"Recurring Medications",icon:Ef},{path:"/dashboard/distributors",name:"Distributor Management",icon:Lm}]},{title:"Queue & Subscriptions",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:RN},{path:"/dashboard/subscriptions",name:"Manage Subscriptions",icon:wx},{path:"/dashboard/subscriptions/add",name:"Add Subscription Plan",icon:wx}]}],doctor:[{title:"Patient & Admissions",links:[{path:"/dashboard/search-patient",name:"Patient Search",icon:zf},{path:"/dashboard/add-patient",name:"Add Patient",icon:Om},{path:"/manage-admission",name:"Manage Admission",icon:Zv}]},{title:"Lab & Billing",links:[{path:"/create-lab-order",name:"Create Lab Order",icon:MN},{path:"/billing",name:"Billing",icon:wx}]},{title:"Queue",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:RN}]}],receptionist:[{title:"Reception",links:[{path:"/dashboard",name:"Reception Dashboard",icon:$f}]},{title:"Patient Management",links:[{path:"/dashboard/all-patients",name:"All Patients",icon:Lm},{path:"/dashboard/patients/add",name:"Add Patient",icon:Om},{path:"/dashboard/search-patient",name:"Search Patient",icon:zf}]},{title:"Billing & Admissions",links:[{path:"/billing",name:"Billing",icon:wx},{path:"/manage-admission",name:"Manage Admission",icon:Zv}]}],lab:[{title:"Lab Operations",links:[{path:"/dashboard",name:"Lab Dashboard",icon:$f},{path:"/lab-inventory",name:"Lab Test Inventory",icon:MN},{path:"/lab/search-report",name:"Search Lab Report",icon:zf}]}],pharmacy:[{title:"Pharmacy Operations",links:[{path:"/dashboard",name:"Pharmacy Queue",icon:$f},{path:"/dashboard/inventory",name:"Pharmacy Inventory",icon:Nx},{path:"/dashboard/purchase",name:"Add Drug",icon:Nx},{path:"/dashboard/add-order",name:"Add Pharmacy Order",icon:Ef},{path:"/dashboard/recurring-medications",name:"Recurring Medications",icon:Ef},{path:"/dashboard/distributors",name:"Distributor Management",icon:Lm},{path:"/dashboard/refill-reminders",name:"Refill Reminders",icon:Ef}]},{title:"Analysis & Settings",links:[{path:"/dashboard/analysis",name:"Inventory Analysis",icon:Ef},{path:"/dashboard/settings",name:"Pharmacy Settings",icon:DP},{path:"/dashboard/search-patient-records",name:"Search Patient Records",icon:zf}]}]},PP=({user:e,onLogout:n,userRole:t,isOpen:r,onClose:a})=>{const o=$r(),[l,h]=w.useState(""),d=gw[t]||[],[u,f]=w.useState(500),g=w.useRef(!1),b=w.useCallback(E=>{g.current=!0,E.preventDefault()},[]),v=w.useCallback(()=>{g.current=!1},[]),S=w.useCallback(E=>{if(g.current){const C=window.innerWidth-E.clientX;C>250&&C<window.innerWidth*.8&&f(C)}},[]);w.useEffect(()=>(window.addEventListener("mousemove",S),window.addEventListener("mouseup",v),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",v)}),[S,v]);const T=d.map(E=>({...E,links:E.links.filter(C=>C.name.toLowerCase().includes(l.toLowerCase()))})).filter(E=>E.links.length>0);return i.jsxs("div",{className:`side-panel ${r?"open":""}`,style:{width:`${u}px`},children:[i.jsx("div",{className:"resizer",onMouseDown:b}),i.jsxs("div",{className:"side-panel-header",children:[i.jsx(Hs,{to:"/dashboard",className:"home-button",onClick:a,title:"Go to Dashboard",children:i.jsx($f,{})}),i.jsxs("div",{className:"search-container",children:[i.jsx(zf,{className:"search-icon"}),i.jsx("input",{type:"text",placeholder:"Search pages...",className:"search-bar",value:l,onChange:E=>h(E.target.value)})]}),i.jsx("button",{className:"side-panel-close-button",onClick:a,"aria-label":"Close panel",children:i.jsx(HC,{})})]}),i.jsx("nav",{children:T.map((E,C)=>i.jsxs("div",{className:"page-section",children:[i.jsx("div",{className:"page-title",children:E.title}),i.jsx("ul",{className:"sub-page-list",children:E.links.map(P=>{const I=P.icon;return i.jsx("li",{children:i.jsxs(Hs,{to:P.path,className:o.pathname===P.path?"active":"",onClick:a,children:[I&&i.jsx(I,{})," ",i.jsx("span",{children:P.name})]})},P.path)})})]},C))}),i.jsxs("div",{className:"user-info-section",children:[i.jsxs("div",{className:"user-name",children:["Welcome back, ",i.jsx("strong",{children:e.name})]}),i.jsxs("button",{onClick:n,className:"logout-button-sidebar",children:[i.jsx(VC,{})," Sign Out"]})]})]})},IP=({user:e,onLogout:n,userRole:t,isOpen:r,onClose:a,roleNavigation:o})=>{const l=$r(),h=o[t]||[];return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:`mobile-side-panel-overlay ${r?"open":""}`,onClick:a}),i.jsxs("div",{className:`mobile-side-panel ${r?"open":""}`,children:[i.jsxs("div",{className:"mobile-side-panel-header",children:[i.jsx("h3",{children:"Menu"}),i.jsx("button",{className:"mobile-close-button",onClick:a,"aria-label":"Close panel",children:i.jsx(HC,{})})]}),i.jsx("nav",{children:h.map((d,u)=>i.jsxs("div",{className:"page-section",children:[i.jsx("div",{className:"page-title",children:d.title}),i.jsx("ul",{className:"sub-page-list",children:d.links.map(f=>{const g=f.icon;return i.jsx("li",{children:i.jsxs(Hs,{to:f.path,className:l.pathname===f.path?"active":"",onClick:a,children:[g&&i.jsx(g,{})," ",f.name]})},f.path)})})]},u))}),i.jsxs("div",{className:"user-info-section",children:[i.jsxs("div",{className:"user-name",children:["Welcome back, ",i.jsx("strong",{children:e.name})]}),i.jsxs("button",{onClick:n,className:"logout-button-sidebar",children:[i.jsx(VC,{})," Sign Out"]})]})]})]})};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MP=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),RP=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(n,t,r)=>r?r.toUpperCase():t.toLowerCase()),ON=e=>{const n=RP(e);return n.charAt(0).toUpperCase()+n.slice(1)},GC=(...e)=>e.filter((n,t,r)=>!!n&&n.trim()!==""&&r.indexOf(n)===t).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var OP={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LP=w.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:a="",children:o,iconNode:l,...h},d)=>w.createElement("svg",{ref:d,...OP,width:n,height:n,stroke:e,strokeWidth:r?Number(t)*24/Number(n):t,className:GC("lucide",a),...h},[...l.map(([u,f])=>w.createElement(u,f)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=(e,n)=>{const t=w.forwardRef(({className:r,...a},o)=>w.createElement(LP,{ref:o,iconNode:n,className:GC(`lucide-${MP(ON(e))}`,`lucide-${e}`,r),...a}));return t.displayName=ON(e),t};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FP=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],$P=gt("activity",FP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zP=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Nu=gt("arrow-down",zP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BP=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],fn=gt("arrow-left",BP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UP=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],qP=gt("arrow-right",UP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VP=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],To=gt("arrow-up",VP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HP=[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]],LN=gt("banknote",HP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GP=[["path",{d:"M4.5 3h15",key:"c7n0jr"}],["path",{d:"M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3",key:"m1uhx7"}],["path",{d:"M6 14h12",key:"4cwo0f"}]],Pb=gt("beaker",GP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YP=[["path",{d:"M2 20v-8a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v8",key:"1k78r4"}],["path",{d:"M4 10V6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v4",key:"fb3tl2"}],["path",{d:"M12 4v6",key:"1dcgq2"}],["path",{d:"M2 18h20",key:"ajqnye"}]],WP=gt("bed-double",YP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QP=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],JP=gt("bell",QP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KP=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M22 8c0-2.3-.8-4.3-2-6",key:"5bb3ad"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}],["path",{d:"M4 2C2.8 3.7 2 5.7 2 8",key:"tap9e0"}]],XP=gt("bell-ring",KP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZP=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],cs=gt("bot",ZP);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eI=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],YC=gt("brain",eI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tI=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],WC=gt("building",tI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nI=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 14V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"bce9hv"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m16 20 2 2 4-4",key:"13tcca"}]],ab=gt("calendar-check-2",nI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iI=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],rI=gt("calendar-days",iI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aI=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Xf=gt("calendar",aI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sI=[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]],QC=gt("chart-no-axes-column",sI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oI=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Vs=gt("check",oI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lI=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],sb=gt("chevron-down",lI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cI=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ib=gt("chevron-left",cI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uI=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],xg=gt("chevron-right",uI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dI=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],r1=gt("chevron-up",dI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],mi=gt("circle-alert",hI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fI=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Nr=gt("circle-check-big",fI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],mI=gt("circle-minus",pI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],gc=gt("circle-plus",gI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],xI=gt("circle-user",yI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bI=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],FN=gt("clipboard-list",bI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vI=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],JC=gt("clipboard",vI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wI=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],NI=gt("clock",wI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SI=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],jI=gt("copy",SI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=[["polyline",{points:"9 10 4 15 9 20",key:"r3jprv"}],["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}]],CI=gt("corner-down-left",_I);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],Hf=gt("credit-card",kI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TI=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ag=gt("dollar-sign",TI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EI=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],KC=gt("eye-off",EI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AI=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],sg=gt("eye",AI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DI=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],PI=gt("file-check",DI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const II=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ds=gt("file-text",II);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MI=[["path",{d:"M14 2v6a2 2 0 0 0 .245.96l5.51 10.08A2 2 0 0 1 18 22H6a2 2 0 0 1-1.755-2.96l5.51-10.08A2 2 0 0 0 10 8V2",key:"18mbvz"}],["path",{d:"M6.453 15h11.094",key:"3shlmq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}]],a1=gt("flask-conical",MI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RI=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],XC=gt("funnel",RI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OI=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],Uf=gt("hash",OI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LI=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]],ZC=gt("house",LI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FI=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],yw=gt("image",FI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $I=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],qs=gt("info",$I);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zI=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],BI=gt("key",zI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UI=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],qI=gt("layout-dashboard",UI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VI=[["path",{d:"M10 12h11",key:"6m4ad9"}],["path",{d:"M10 18h11",key:"11hvi2"}],["path",{d:"M10 6h11",key:"c7qv1k"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]],HI=gt("list-ordered",VI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GI=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],YI=gt("list",GI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WI=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Gf=gt("loader-circle",WI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QI=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],JI=gt("lock",QI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KI=[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],XI=gt("mic-off",KI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZI=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],e2=gt("mic",ZI);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eM=[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]],xw=gt("minimize-2",eM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tM=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],nM=gt("monitor",tM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iM=[["path",{d:"M12 22v-9",key:"x3hkom"}],["path",{d:"M15.17 2.21a1.67 1.67 0 0 1 1.63 0L21 4.57a1.93 1.93 0 0 1 0 3.36L8.82 14.79a1.655 1.655 0 0 1-1.64 0L3 12.43a1.93 1.93 0 0 1 0-3.36z",key:"2ntwy6"}],["path",{d:"M20 13v3.87a2.06 2.06 0 0 1-1.11 1.83l-6 3.08a1.93 1.93 0 0 1-1.78 0l-6-3.08A2.06 2.06 0 0 1 4 16.87V13",key:"1pmm1c"}],["path",{d:"M21 12.43a1.93 1.93 0 0 0 0-3.36L8.83 2.2a1.64 1.64 0 0 0-1.63 0L3 4.57a1.93 1.93 0 0 0 0 3.36l12.18 6.86a1.636 1.636 0 0 0 1.63 0z",key:"12ttoo"}]],rM=gt("package-open",iM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aM=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Eo=gt("package",aM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sM=[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]],oM=gt("paperclip",sM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lM=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],cM=gt("pause",lM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],og=gt("pen",uM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dM=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ss=gt("pencil",dM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hM=[["path",{d:"m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z",key:"wa1lgi"}],["path",{d:"m8.5 8.5 7 7",key:"rvfmvr"}]],Io=gt("pill",hM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fM=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],pM=gt("play",fM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Pl=gt("plus",mM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gM=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],Ao=gt("printer",gM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yM=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Il=gt("refresh-cw",yM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xM=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],bM=gt("repeat",xM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vM=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],wM=gt("rotate-ccw",vM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NM=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],vc=gt("save",NM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SM=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],Pi=gt("search",SM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jM=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Mb=gt("send",jM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M6 10H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2",key:"4b9dqc"}],["path",{d:"M6 14H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2h-2",key:"22nnkd"}],["path",{d:"M6 6h.01",key:"1utrut"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"m13 6-4 6h6l-4 6",key:"14hqih"}]],ob=gt("server-crash",_M);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Km=gt("settings",CM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kM=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],t2=gt("share-2",kM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],e0=gt("shield-check",TM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EM=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],n2=gt("shopping-cart",EM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AM=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],t0=gt("smartphone",AM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]],s1=gt("sparkles",DM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PM=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],eh=gt("square-pen",PM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],MM=gt("stethoscope",IM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RM=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],OM=gt("tag",RM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LM=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],Wi=gt("trash-2",LM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FM=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],$M=gt("trending-up",FM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zM=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],i2=gt("triangle-alert",zM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BM=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],UM=gt("truck",BM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],VM=gt("upload",qM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],GM=gt("user-check",HM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],o1=gt("user-plus",YM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Mo=gt("user",WM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],Zf=gt("users",QM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],KM=gt("video",JM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XM=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],Xd=gt("wallet",XM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZM=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Sn=gt("x",ZM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eR=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],tR=gt("zap",eR);function nR(e,n){const t={};return(e[e.length-1]===""?[...e,""]:e).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const iR=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,rR=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,aR={};function $N(e,n){return(aR.jsx?rR:iR).test(e)}const sR=/[ \t\n\f\r]/g;function oR(e){return typeof e=="object"?e.type==="text"?zN(e.value):!1:zN(e)}function zN(e){return e.replace(sR,"")===""}let bg=class{constructor(n,t,r){this.normal=t,this.property=n,r&&(this.space=r)}};bg.prototype.normal={};bg.prototype.property={};bg.prototype.space=void 0;function r2(e,n){const t={},r={};for(const a of e)Object.assign(t,a.property),Object.assign(r,a.normal);return new bg(t,r,n)}function l1(e){return e.toLowerCase()}let Ra=class{constructor(n,t){this.attribute=t,this.property=n}};Ra.prototype.attribute="";Ra.prototype.booleanish=!1;Ra.prototype.boolean=!1;Ra.prototype.commaOrSpaceSeparated=!1;Ra.prototype.commaSeparated=!1;Ra.prototype.defined=!1;Ra.prototype.mustUseProperty=!1;Ra.prototype.number=!1;Ra.prototype.overloadedBoolean=!1;Ra.prototype.property="";Ra.prototype.spaceSeparated=!1;Ra.prototype.space=void 0;let lR=0;const on=sh(),ir=sh(),a2=sh(),yt=sh(),bi=sh(),Yf=sh(),rs=sh();function sh(){return 2**++lR}const c1=Object.freeze(Object.defineProperty({__proto__:null,boolean:on,booleanish:ir,commaOrSpaceSeparated:rs,commaSeparated:Yf,number:yt,overloadedBoolean:a2,spaceSeparated:bi},Symbol.toStringTag,{value:"Module"})),n0=Object.keys(c1);let bw=class extends Ra{constructor(n,t,r,a){let o=-1;if(super(n,t),BN(this,"space",a),typeof r=="number")for(;++o<n0.length;){const l=n0[o];BN(this,n0[o],(r&c1[l])===c1[l])}}};bw.prototype.defined=!0;function BN(e,n,t){t&&(e[n]=t)}function cp(e){const n={},t={};for(const[r,a]of Object.entries(e.properties)){const o=new bw(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),n[r]=o,t[l1(r)]=r,t[l1(o.attribute)]=r}return new bg(n,t,e.space)}const s2=cp({properties:{ariaActiveDescendant:null,ariaAtomic:ir,ariaAutoComplete:null,ariaBusy:ir,ariaChecked:ir,ariaColCount:yt,ariaColIndex:yt,ariaColSpan:yt,ariaControls:bi,ariaCurrent:null,ariaDescribedBy:bi,ariaDetails:null,ariaDisabled:ir,ariaDropEffect:bi,ariaErrorMessage:null,ariaExpanded:ir,ariaFlowTo:bi,ariaGrabbed:ir,ariaHasPopup:null,ariaHidden:ir,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:bi,ariaLevel:yt,ariaLive:null,ariaModal:ir,ariaMultiLine:ir,ariaMultiSelectable:ir,ariaOrientation:null,ariaOwns:bi,ariaPlaceholder:null,ariaPosInSet:yt,ariaPressed:ir,ariaReadOnly:ir,ariaRelevant:null,ariaRequired:ir,ariaRoleDescription:bi,ariaRowCount:yt,ariaRowIndex:yt,ariaRowSpan:yt,ariaSelected:ir,ariaSetSize:yt,ariaSort:null,ariaValueMax:yt,ariaValueMin:yt,ariaValueNow:yt,ariaValueText:null,role:null},transform(e,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function o2(e,n){return n in e?e[n]:n}function l2(e,n){return o2(e,n.toLowerCase())}const cR=cp({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Yf,acceptCharset:bi,accessKey:bi,action:null,allow:null,allowFullScreen:on,allowPaymentRequest:on,allowUserMedia:on,alt:null,as:null,async:on,autoCapitalize:null,autoComplete:bi,autoFocus:on,autoPlay:on,blocking:bi,capture:null,charSet:null,checked:on,cite:null,className:bi,cols:yt,colSpan:null,content:null,contentEditable:ir,controls:on,controlsList:bi,coords:yt|Yf,crossOrigin:null,data:null,dateTime:null,decoding:null,default:on,defer:on,dir:null,dirName:null,disabled:on,download:a2,draggable:ir,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:on,formTarget:null,headers:bi,height:yt,hidden:on,high:yt,href:null,hrefLang:null,htmlFor:bi,httpEquiv:bi,id:null,imageSizes:null,imageSrcSet:null,inert:on,inputMode:null,integrity:null,is:null,isMap:on,itemId:null,itemProp:bi,itemRef:bi,itemScope:on,itemType:bi,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:on,low:yt,manifest:null,max:null,maxLength:yt,media:null,method:null,min:null,minLength:yt,multiple:on,muted:on,name:null,nonce:null,noModule:on,noValidate:on,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:on,optimum:yt,pattern:null,ping:bi,placeholder:null,playsInline:on,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:on,referrerPolicy:null,rel:bi,required:on,reversed:on,rows:yt,rowSpan:yt,sandbox:bi,scope:null,scoped:on,seamless:on,selected:on,shadowRootClonable:on,shadowRootDelegatesFocus:on,shadowRootMode:null,shape:null,size:yt,sizes:null,slot:null,span:yt,spellCheck:ir,src:null,srcDoc:null,srcLang:null,srcSet:null,start:yt,step:null,style:null,tabIndex:yt,target:null,title:null,translate:null,type:null,typeMustMatch:on,useMap:null,value:ir,width:yt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:bi,axis:null,background:null,bgColor:null,border:yt,borderColor:null,bottomMargin:yt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:on,declare:on,event:null,face:null,frame:null,frameBorder:null,hSpace:yt,leftMargin:yt,link:null,longDesc:null,lowSrc:null,marginHeight:yt,marginWidth:yt,noResize:on,noHref:on,noShade:on,noWrap:on,object:null,profile:null,prompt:null,rev:null,rightMargin:yt,rules:null,scheme:null,scrolling:ir,standby:null,summary:null,text:null,topMargin:yt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:yt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:on,disableRemotePlayback:on,prefix:null,property:null,results:yt,security:null,unselectable:null},space:"html",transform:l2}),uR=cp({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:rs,accentHeight:yt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:yt,amplitude:yt,arabicForm:null,ascent:yt,attributeName:null,attributeType:null,azimuth:yt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:yt,by:null,calcMode:null,capHeight:yt,className:bi,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:yt,diffuseConstant:yt,direction:null,display:null,dur:null,divisor:yt,dominantBaseline:null,download:on,dx:null,dy:null,edgeMode:null,editable:null,elevation:yt,enableBackground:null,end:null,event:null,exponent:yt,externalResourcesRequired:null,fill:null,fillOpacity:yt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Yf,g2:Yf,glyphName:Yf,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:yt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:yt,horizOriginX:yt,horizOriginY:yt,id:null,ideographic:yt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:yt,k:yt,k1:yt,k2:yt,k3:yt,k4:yt,kernelMatrix:rs,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:yt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:yt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:yt,overlineThickness:yt,paintOrder:null,panose1:null,path:null,pathLength:yt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:bi,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:yt,pointsAtY:yt,pointsAtZ:yt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:rs,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:rs,rev:rs,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:rs,requiredFeatures:rs,requiredFonts:rs,requiredFormats:rs,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:yt,specularExponent:yt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:yt,strikethroughThickness:yt,string:null,stroke:null,strokeDashArray:rs,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:yt,strokeOpacity:yt,strokeWidth:null,style:null,surfaceScale:yt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:rs,tabIndex:yt,tableValues:null,target:null,targetX:yt,targetY:yt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:rs,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:yt,underlineThickness:yt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:yt,values:null,vAlphabetic:yt,vMathematical:yt,vectorEffect:null,vHanging:yt,vIdeographic:yt,version:null,vertAdvY:yt,vertOriginX:yt,vertOriginY:yt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:yt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:o2}),c2=cp({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,n){return"xlink:"+n.slice(5).toLowerCase()}}),u2=cp({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:l2}),d2=cp({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,n){return"xml:"+n.slice(3).toLowerCase()}}),dR={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},hR=/[A-Z]/g,UN=/-[a-z]/g,fR=/^data[-\w.:]+$/i;function pR(e,n){const t=l1(n);let r=n,a=Ra;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&fR.test(n)){if(n.charAt(4)==="-"){const o=n.slice(5).replace(UN,gR);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=n.slice(4);if(!UN.test(o)){let l=o.replace(hR,mR);l.charAt(0)!=="-"&&(l="-"+l),n="data"+l}}a=bw}return new a(r,n)}function mR(e){return"-"+e.toLowerCase()}function gR(e){return e.charAt(1).toUpperCase()}const yR=r2([s2,cR,c2,u2,d2],"html"),vw=r2([s2,uR,c2,u2,d2],"svg");function xR(e){return e.join(" ").trim()}var Af={},i0,qN;function bR(){if(qN)return i0;qN=1;var e=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,t=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,a=/^:\s*/,o=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,l=/^[;\s]*/,h=/^\s+|\s+$/g,d=`
`,u="/",f="*",g="",b="comment",v="declaration";i0=function(T,E){if(typeof T!="string")throw new TypeError("First argument must be a string");if(!T)return[];E=E||{};var C=1,P=1;function I(ee){var ie=ee.match(n);ie&&(C+=ie.length);var ae=ee.lastIndexOf(d);P=~ae?ee.length-ae:P+ee.length}function q(){var ee={line:C,column:P};return function(ie){return ie.position=new L(ee),$(),ie}}function L(ee){this.start=ee,this.end={line:C,column:P},this.source=E.source}L.prototype.content=T;function O(ee){var ie=new Error(E.source+":"+C+":"+P+": "+ee);if(ie.reason=ee,ie.filename=E.source,ie.line=C,ie.column=P,ie.source=T,!E.silent)throw ie}function B(ee){var ie=ee.exec(T);if(ie){var ae=ie[0];return I(ae),T=T.slice(ae.length),ie}}function $(){B(t)}function F(ee){var ie;for(ee=ee||[];ie=z();)ie!==!1&&ee.push(ie);return ee}function z(){var ee=q();if(!(u!=T.charAt(0)||f!=T.charAt(1))){for(var ie=2;g!=T.charAt(ie)&&(f!=T.charAt(ie)||u!=T.charAt(ie+1));)++ie;if(ie+=2,g===T.charAt(ie-1))return O("End of comment missing");var ae=T.slice(2,ie-2);return P+=2,I(ae),T=T.slice(ie),P+=2,ee({type:b,comment:ae})}}function U(){var ee=q(),ie=B(r);if(ie){if(z(),!B(a))return O("property missing ':'");var ae=B(o),J=ee({type:v,property:S(ie[0].replace(e,g)),value:ae?S(ae[0].replace(e,g)):g});return B(l),J}}function V(){var ee=[];F(ee);for(var ie;ie=U();)ie!==!1&&(ee.push(ie),F(ee));return ee}return $(),V()};function S(T){return T?T.replace(h,g):g}return i0}var VN;function vR(){if(VN)return Af;VN=1;var e=Af&&Af.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Af,"__esModule",{value:!0}),Af.default=t;var n=e(bR());function t(r,a){var o=null;if(!r||typeof r!="string")return o;var l=(0,n.default)(r),h=typeof a=="function";return l.forEach(function(d){if(d.type==="declaration"){var u=d.property,f=d.value;h?a(u,f,d):f&&(o=o||{},o[u]=f)}}),o}return Af}var Fm={},HN;function wR(){if(HN)return Fm;HN=1,Object.defineProperty(Fm,"__esModule",{value:!0}),Fm.camelCase=void 0;var e=/^--[a-zA-Z0-9_-]+$/,n=/-([a-z])/g,t=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,a=/^-(ms)-/,o=function(u){return!u||t.test(u)||e.test(u)},l=function(u,f){return f.toUpperCase()},h=function(u,f){return"".concat(f,"-")},d=function(u,f){return f===void 0&&(f={}),o(u)?u:(u=u.toLowerCase(),f.reactCompat?u=u.replace(a,h):u=u.replace(r,h),u.replace(n,l))};return Fm.camelCase=d,Fm}var $m,GN;function NR(){if(GN)return $m;GN=1;var e=$m&&$m.__importDefault||function(a){return a&&a.__esModule?a:{default:a}},n=e(vR()),t=wR();function r(a,o){var l={};return!a||typeof a!="string"||(0,n.default)(a,function(h,d){h&&d&&(l[(0,t.camelCase)(h,o)]=d)}),l}return r.default=r,$m=r,$m}var SR=NR();const jR=ah(SR),h2=f2("end"),ww=f2("start");function f2(e){return n;function n(t){const r=t&&t.position&&t.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function _R(e){const n=ww(e),t=h2(e);if(n&&t)return{start:n,end:t}}function Xm(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?YN(e.position):"start"in e||"end"in e?YN(e):"line"in e||"column"in e?u1(e):""}function u1(e){return WN(e&&e.line)+":"+WN(e&&e.column)}function YN(e){return u1(e&&e.start)+"-"+u1(e&&e.end)}function WN(e){return e&&typeof e=="number"?e:1}let ra=class extends Error{constructor(n,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let a="",o={},l=!1;if(t&&("line"in t&&"column"in t?o={place:t}:"start"in t&&"end"in t?o={place:t}:"type"in t?o={ancestors:[t],place:t.position}:o={...t}),typeof n=="string"?a=n:!o.cause&&n&&(l=!0,a=n.message,o.cause=n),!o.ruleId&&!o.source&&typeof r=="string"){const d=r.indexOf(":");d===-1?o.ruleId=r:(o.source=r.slice(0,d),o.ruleId=r.slice(d+1))}if(!o.place&&o.ancestors&&o.ancestors){const d=o.ancestors[o.ancestors.length-1];d&&(o.place=d.position)}const h=o.place&&"start"in o.place?o.place.start:o.place;this.ancestors=o.ancestors||void 0,this.cause=o.cause||void 0,this.column=h?h.column:void 0,this.fatal=void 0,this.file,this.message=a,this.line=h?h.line:void 0,this.name=Xm(o.place)||"1:1",this.place=o.place||void 0,this.reason=this.message,this.ruleId=o.ruleId||void 0,this.source=o.source||void 0,this.stack=l&&o.cause&&typeof o.cause.stack=="string"?o.cause.stack:"",this.actual,this.expected,this.note,this.url}};ra.prototype.file="";ra.prototype.name="";ra.prototype.reason="";ra.prototype.message="";ra.prototype.stack="";ra.prototype.column=void 0;ra.prototype.line=void 0;ra.prototype.ancestors=void 0;ra.prototype.cause=void 0;ra.prototype.fatal=void 0;ra.prototype.place=void 0;ra.prototype.ruleId=void 0;ra.prototype.source=void 0;const Nw={}.hasOwnProperty,CR=new Map,kR=/[A-Z]/g,TR=new Set(["table","tbody","thead","tfoot","tr"]),ER=new Set(["td","th"]),p2="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function AR(e,n){if(!n||n.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=n.filePath||void 0;let r;if(n.development){if(typeof n.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=FR(t,n.jsxDEV)}else{if(typeof n.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof n.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=LR(t,n.jsx,n.jsxs)}const a={Fragment:n.Fragment,ancestors:[],components:n.components||{},create:r,elementAttributeNameCase:n.elementAttributeNameCase||"react",evaluater:n.createEvaluater?n.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:n.ignoreInvalidStyle||!1,passKeys:n.passKeys!==!1,passNode:n.passNode||!1,schema:n.space==="svg"?vw:yR,stylePropertyNameCase:n.stylePropertyNameCase||"dom",tableCellAlignToStyle:n.tableCellAlignToStyle!==!1},o=m2(a,e,void 0);return o&&typeof o!="string"?o:a.create(e,a.Fragment,{children:o||void 0},void 0)}function m2(e,n,t){if(n.type==="element")return DR(e,n,t);if(n.type==="mdxFlowExpression"||n.type==="mdxTextExpression")return PR(e,n);if(n.type==="mdxJsxFlowElement"||n.type==="mdxJsxTextElement")return MR(e,n,t);if(n.type==="mdxjsEsm")return IR(e,n);if(n.type==="root")return RR(e,n,t);if(n.type==="text")return OR(e,n)}function DR(e,n,t){const r=e.schema;let a=r;n.tagName.toLowerCase()==="svg"&&r.space==="html"&&(a=vw,e.schema=a),e.ancestors.push(n);const o=y2(e,n.tagName,!1),l=$R(e,n);let h=jw(e,n);return TR.has(n.tagName)&&(h=h.filter(function(d){return typeof d=="string"?!oR(d):!0})),g2(e,l,o,n),Sw(l,h),e.ancestors.pop(),e.schema=r,e.create(n,o,l,t)}function PR(e,n){if(n.data&&n.data.estree&&e.evaluater){const r=n.data.estree.body[0];return r.type,e.evaluater.evaluateExpression(r.expression)}lg(e,n.position)}function IR(e,n){if(n.data&&n.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(n.data.estree);lg(e,n.position)}function MR(e,n,t){const r=e.schema;let a=r;n.name==="svg"&&r.space==="html"&&(a=vw,e.schema=a),e.ancestors.push(n);const o=n.name===null?e.Fragment:y2(e,n.name,!0),l=zR(e,n),h=jw(e,n);return g2(e,l,o,n),Sw(l,h),e.ancestors.pop(),e.schema=r,e.create(n,o,l,t)}function RR(e,n,t){const r={};return Sw(r,jw(e,n)),e.create(n,e.Fragment,r,t)}function OR(e,n){return n.value}function g2(e,n,t,r){typeof t!="string"&&t!==e.Fragment&&e.passNode&&(n.node=r)}function Sw(e,n){if(n.length>0){const t=n.length>1?n:n[0];t&&(e.children=t)}}function LR(e,n,t){return r;function r(a,o,l,h){const u=Array.isArray(l.children)?t:n;return h?u(o,l,h):u(o,l)}}function FR(e,n){return t;function t(r,a,o,l){const h=Array.isArray(o.children),d=ww(r);return n(a,o,l,h,{columnNumber:d?d.column-1:void 0,fileName:e,lineNumber:d?d.line:void 0},void 0)}}function $R(e,n){const t={};let r,a;for(a in n.properties)if(a!=="children"&&Nw.call(n.properties,a)){const o=BR(e,a,n.properties[a]);if(o){const[l,h]=o;e.tableCellAlignToStyle&&l==="align"&&typeof h=="string"&&ER.has(n.tagName)?r=h:t[l]=h}}if(r){const o=t.style||(t.style={});o[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function zR(e,n){const t={};for(const r of n.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&e.evaluater){const o=r.data.estree.body[0];o.type;const l=o.expression;l.type;const h=l.properties[0];h.type,Object.assign(t,e.evaluater.evaluateExpression(h.argument))}else lg(e,n.position);else{const a=r.name;let o;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&e.evaluater){const h=r.value.data.estree.body[0];h.type,o=e.evaluater.evaluateExpression(h.expression)}else lg(e,n.position);else o=r.value===null?!0:r.value;t[a]=o}return t}function jw(e,n){const t=[];let r=-1;const a=e.passKeys?new Map:CR;for(;++r<n.children.length;){const o=n.children[r];let l;if(e.passKeys){const d=o.type==="element"?o.tagName:o.type==="mdxJsxFlowElement"||o.type==="mdxJsxTextElement"?o.name:void 0;if(d){const u=a.get(d)||0;l=d+"-"+u,a.set(d,u+1)}}const h=m2(e,o,l);h!==void 0&&t.push(h)}return t}function BR(e,n,t){const r=pR(e.schema,n);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?nR(t):xR(t)),r.property==="style"){let a=typeof t=="object"?t:UR(e,String(t));return e.stylePropertyNameCase==="css"&&(a=qR(a)),["style",a]}return[e.elementAttributeNameCase==="react"&&r.space?dR[r.property]||r.property:r.attribute,t]}}function UR(e,n){try{return jR(n,{reactCompat:!0})}catch(t){if(e.ignoreInvalidStyle)return{};const r=t,a=new ra("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw a.file=e.filePath||void 0,a.url=p2+"#cannot-parse-style-attribute",a}}function y2(e,n,t){let r;if(!t)r={type:"Literal",value:n};else if(n.includes(".")){const a=n.split(".");let o=-1,l;for(;++o<a.length;){const h=$N(a[o])?{type:"Identifier",name:a[o]}:{type:"Literal",value:a[o]};l=l?{type:"MemberExpression",object:l,property:h,computed:!!(o&&h.type==="Literal"),optional:!1}:h}r=l}else r=$N(n)&&!/^[a-z]/.test(n)?{type:"Identifier",name:n}:{type:"Literal",value:n};if(r.type==="Literal"){const a=r.value;return Nw.call(e.components,a)?e.components[a]:a}if(e.evaluater)return e.evaluater.evaluateExpression(r);lg(e)}function lg(e,n){const t=new ra("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:n,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=e.filePath||void 0,t.url=p2+"#cannot-handle-mdx-estrees-without-createevaluater",t}function qR(e){const n={};let t;for(t in e)Nw.call(e,t)&&(n[VR(t)]=e[t]);return n}function VR(e){let n=e.replace(kR,HR);return n.slice(0,3)==="ms-"&&(n="-"+n),n}function HR(e){return"-"+e.toLowerCase()}const r0={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},GR={};function _w(e,n){const t=GR,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,a=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return x2(e,r,a)}function x2(e,n,t){if(YR(e)){if("value"in e)return e.type==="html"&&!t?"":e.value;if(n&&"alt"in e&&e.alt)return e.alt;if("children"in e)return QN(e.children,n,t)}return Array.isArray(e)?QN(e,n,t):""}function QN(e,n,t){const r=[];let a=-1;for(;++a<e.length;)r[a]=x2(e[a],n,t);return r.join("")}function YR(e){return!!(e&&typeof e=="object")}const JN=document.createElement("i");function Cw(e){const n="&"+e+";";JN.innerHTML=n;const t=JN.textContent;return t.charCodeAt(t.length-1)===59&&e!=="semi"||t===n?!1:t}function hs(e,n,t,r){const a=e.length;let o=0,l;if(n<0?n=-n>a?0:a+n:n=n>a?a:n,t=t>0?t:0,r.length<1e4)l=Array.from(r),l.unshift(n,t),e.splice(...l);else for(t&&e.splice(n,t);o<r.length;)l=r.slice(o,o+1e4),l.unshift(n,0),e.splice(...l),o+=1e4,n+=1e4}function zs(e,n){return e.length>0?(hs(e,e.length,0,n),e):n}const KN={}.hasOwnProperty;function b2(e){const n={};let t=-1;for(;++t<e.length;)WR(n,e[t]);return n}function WR(e,n){let t;for(t in n){const a=(KN.call(e,t)?e[t]:void 0)||(e[t]={}),o=n[t];let l;if(o)for(l in o){KN.call(a,l)||(a[l]=[]);const h=o[l];QR(a[l],Array.isArray(h)?h:h?[h]:[])}}}function QR(e,n){let t=-1;const r=[];for(;++t<n.length;)(n[t].add==="after"?e:r).push(n[t]);hs(e,0,0,r)}function v2(e,n){const t=Number.parseInt(e,n);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}function Do(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ga=ku(/[A-Za-z]/),ta=ku(/[\dA-Za-z]/),JR=ku(/[#-'*+\--9=?A-Z^-~]/);function lb(e){return e!==null&&(e<32||e===127)}const d1=ku(/\d/),KR=ku(/[\dA-Fa-f]/),XR=ku(/[!-/:-@[-`{-~]/);function Ht(e){return e!==null&&e<-2}function gi(e){return e!==null&&(e<0||e===32)}function An(e){return e===-2||e===-1||e===32}const Rb=ku(new RegExp("\\p{P}|\\p{S}","u")),th=ku(/\s/);function ku(e){return n;function n(t){return t!==null&&t>-1&&e.test(String.fromCharCode(t))}}function up(e){const n=[];let t=-1,r=0,a=0;for(;++t<e.length;){const o=e.charCodeAt(t);let l="";if(o===37&&ta(e.charCodeAt(t+1))&&ta(e.charCodeAt(t+2)))a=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(l=String.fromCharCode(o));else if(o>55295&&o<57344){const h=e.charCodeAt(t+1);o<56320&&h>56319&&h<57344?(l=String.fromCharCode(o,h),a=1):l=""}else l=String.fromCharCode(o);l&&(n.push(e.slice(r,t),encodeURIComponent(l)),r=t+a+1,l=""),a&&(t+=a,a=0)}return n.join("")+e.slice(r)}function zn(e,n,t,r){const a=r?r-1:Number.POSITIVE_INFINITY;let o=0;return l;function l(d){return An(d)?(e.enter(t),h(d)):n(d)}function h(d){return An(d)&&o++<a?(e.consume(d),h):(e.exit(t),n(d))}}const ZR={tokenize:e4};function e4(e){const n=e.attempt(this.parser.constructs.contentInitial,r,a);let t;return n;function r(h){if(h===null){e.consume(h);return}return e.enter("lineEnding"),e.consume(h),e.exit("lineEnding"),zn(e,n,"linePrefix")}function a(h){return e.enter("paragraph"),o(h)}function o(h){const d=e.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=d),t=d,l(h)}function l(h){if(h===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(h);return}return Ht(h)?(e.consume(h),e.exit("chunkText"),o):(e.consume(h),l)}}const t4={tokenize:n4},XN={tokenize:i4};function n4(e){const n=this,t=[];let r=0,a,o,l;return h;function h(I){if(r<t.length){const q=t[r];return n.containerState=q[1],e.attempt(q[0].continuation,d,u)(I)}return u(I)}function d(I){if(r++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,a&&P();const q=n.events.length;let L=q,O;for(;L--;)if(n.events[L][0]==="exit"&&n.events[L][1].type==="chunkFlow"){O=n.events[L][1].end;break}C(r);let B=q;for(;B<n.events.length;)n.events[B][1].end={...O},B++;return hs(n.events,L+1,0,n.events.slice(q)),n.events.length=B,u(I)}return h(I)}function u(I){if(r===t.length){if(!a)return b(I);if(a.currentConstruct&&a.currentConstruct.concrete)return S(I);n.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return n.containerState={},e.check(XN,f,g)(I)}function f(I){return a&&P(),C(r),b(I)}function g(I){return n.parser.lazy[n.now().line]=r!==t.length,l=n.now().offset,S(I)}function b(I){return n.containerState={},e.attempt(XN,v,S)(I)}function v(I){return r++,t.push([n.currentConstruct,n.containerState]),b(I)}function S(I){if(I===null){a&&P(),C(0),e.consume(I);return}return a=a||n.parser.flow(n.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:o}),T(I)}function T(I){if(I===null){E(e.exit("chunkFlow"),!0),C(0),e.consume(I);return}return Ht(I)?(e.consume(I),E(e.exit("chunkFlow")),r=0,n.interrupt=void 0,h):(e.consume(I),T)}function E(I,q){const L=n.sliceStream(I);if(q&&L.push(null),I.previous=o,o&&(o.next=I),o=I,a.defineSkip(I.start),a.write(L),n.parser.lazy[I.start.line]){let O=a.events.length;for(;O--;)if(a.events[O][1].start.offset<l&&(!a.events[O][1].end||a.events[O][1].end.offset>l))return;const B=n.events.length;let $=B,F,z;for(;$--;)if(n.events[$][0]==="exit"&&n.events[$][1].type==="chunkFlow"){if(F){z=n.events[$][1].end;break}F=!0}for(C(r),O=B;O<n.events.length;)n.events[O][1].end={...z},O++;hs(n.events,$+1,0,n.events.slice(B)),n.events.length=O}}function C(I){let q=t.length;for(;q-- >I;){const L=t[q];n.containerState=L[1],L[0].exit.call(n,e)}t.length=I}function P(){a.write([null]),o=void 0,a=void 0,n.containerState._closeFlow=void 0}}function i4(e,n,t){return zn(e,e.attempt(this.parser.constructs.document,n,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function ep(e){if(e===null||gi(e)||th(e))return 1;if(Rb(e))return 2}function Ob(e,n,t){const r=[];let a=-1;for(;++a<e.length;){const o=e[a].resolveAll;o&&!r.includes(o)&&(n=o(n,t),r.push(o))}return n}const h1={name:"attention",resolveAll:r4,tokenize:a4};function r4(e,n){let t=-1,r,a,o,l,h,d,u,f;for(;++t<e.length;)if(e[t][0]==="enter"&&e[t][1].type==="attentionSequence"&&e[t][1]._close){for(r=t;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&n.sliceSerialize(e[r][1]).charCodeAt(0)===n.sliceSerialize(e[t][1]).charCodeAt(0)){if((e[r][1]._close||e[t][1]._open)&&(e[t][1].end.offset-e[t][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[t][1].end.offset-e[t][1].start.offset)%3))continue;d=e[r][1].end.offset-e[r][1].start.offset>1&&e[t][1].end.offset-e[t][1].start.offset>1?2:1;const g={...e[r][1].end},b={...e[t][1].start};ZN(g,-d),ZN(b,d),l={type:d>1?"strongSequence":"emphasisSequence",start:g,end:{...e[r][1].end}},h={type:d>1?"strongSequence":"emphasisSequence",start:{...e[t][1].start},end:b},o={type:d>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[t][1].start}},a={type:d>1?"strong":"emphasis",start:{...l.start},end:{...h.end}},e[r][1].end={...l.start},e[t][1].start={...h.end},u=[],e[r][1].end.offset-e[r][1].start.offset&&(u=zs(u,[["enter",e[r][1],n],["exit",e[r][1],n]])),u=zs(u,[["enter",a,n],["enter",l,n],["exit",l,n],["enter",o,n]]),u=zs(u,Ob(n.parser.constructs.insideSpan.null,e.slice(r+1,t),n)),u=zs(u,[["exit",o,n],["enter",h,n],["exit",h,n],["exit",a,n]]),e[t][1].end.offset-e[t][1].start.offset?(f=2,u=zs(u,[["enter",e[t][1],n],["exit",e[t][1],n]])):f=0,hs(e,r-1,t-r+3,u),t=r+u.length-f-2;break}}for(t=-1;++t<e.length;)e[t][1].type==="attentionSequence"&&(e[t][1].type="data");return e}function a4(e,n){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,a=ep(r);let o;return l;function l(d){return o=d,e.enter("attentionSequence"),h(d)}function h(d){if(d===o)return e.consume(d),h;const u=e.exit("attentionSequence"),f=ep(d),g=!f||f===2&&a||t.includes(d),b=!a||a===2&&f||t.includes(r);return u._open=!!(o===42?g:g&&(a||!b)),u._close=!!(o===42?b:b&&(f||!g)),n(d)}}function ZN(e,n){e.column+=n,e.offset+=n,e._bufferIndex+=n}const s4={name:"autolink",tokenize:o4};function o4(e,n,t){let r=0;return a;function a(v){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),o}function o(v){return ga(v)?(e.consume(v),l):v===64?t(v):u(v)}function l(v){return v===43||v===45||v===46||ta(v)?(r=1,h(v)):u(v)}function h(v){return v===58?(e.consume(v),r=0,d):(v===43||v===45||v===46||ta(v))&&r++<32?(e.consume(v),h):(r=0,u(v))}function d(v){return v===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),n):v===null||v===32||v===60||lb(v)?t(v):(e.consume(v),d)}function u(v){return v===64?(e.consume(v),f):JR(v)?(e.consume(v),u):t(v)}function f(v){return ta(v)?g(v):t(v)}function g(v){return v===46?(e.consume(v),r=0,f):v===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),n):b(v)}function b(v){if((v===45||ta(v))&&r++<63){const S=v===45?b:g;return e.consume(v),S}return t(v)}}const vg={partial:!0,tokenize:l4};function l4(e,n,t){return r;function r(o){return An(o)?zn(e,a,"linePrefix")(o):a(o)}function a(o){return o===null||Ht(o)?n(o):t(o)}}const w2={continuation:{tokenize:u4},exit:d4,name:"blockQuote",tokenize:c4};function c4(e,n,t){const r=this;return a;function a(l){if(l===62){const h=r.containerState;return h.open||(e.enter("blockQuote",{_container:!0}),h.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(l),e.exit("blockQuoteMarker"),o}return t(l)}function o(l){return An(l)?(e.enter("blockQuotePrefixWhitespace"),e.consume(l),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),n):(e.exit("blockQuotePrefix"),n(l))}}function u4(e,n,t){const r=this;return a;function a(l){return An(l)?zn(e,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):o(l)}function o(l){return e.attempt(w2,n,t)(l)}}function d4(e){e.exit("blockQuote")}const N2={name:"characterEscape",tokenize:h4};function h4(e,n,t){return r;function r(o){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(o),e.exit("escapeMarker"),a}function a(o){return XR(o)?(e.enter("characterEscapeValue"),e.consume(o),e.exit("characterEscapeValue"),e.exit("characterEscape"),n):t(o)}}const S2={name:"characterReference",tokenize:f4};function f4(e,n,t){const r=this;let a=0,o,l;return h;function h(g){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(g),e.exit("characterReferenceMarker"),d}function d(g){return g===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(g),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),o=31,l=ta,f(g))}function u(g){return g===88||g===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(g),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),o=6,l=KR,f):(e.enter("characterReferenceValue"),o=7,l=d1,f(g))}function f(g){if(g===59&&a){const b=e.exit("characterReferenceValue");return l===ta&&!Cw(r.sliceSerialize(b))?t(g):(e.enter("characterReferenceMarker"),e.consume(g),e.exit("characterReferenceMarker"),e.exit("characterReference"),n)}return l(g)&&a++<o?(e.consume(g),f):t(g)}}const eS={partial:!0,tokenize:m4},tS={concrete:!0,name:"codeFenced",tokenize:p4};function p4(e,n,t){const r=this,a={partial:!0,tokenize:L};let o=0,l=0,h;return d;function d(O){return u(O)}function u(O){const B=r.events[r.events.length-1];return o=B&&B[1].type==="linePrefix"?B[2].sliceSerialize(B[1],!0).length:0,h=O,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),f(O)}function f(O){return O===h?(l++,e.consume(O),f):l<3?t(O):(e.exit("codeFencedFenceSequence"),An(O)?zn(e,g,"whitespace")(O):g(O))}function g(O){return O===null||Ht(O)?(e.exit("codeFencedFence"),r.interrupt?n(O):e.check(eS,T,q)(O)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),b(O))}function b(O){return O===null||Ht(O)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),g(O)):An(O)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),zn(e,v,"whitespace")(O)):O===96&&O===h?t(O):(e.consume(O),b)}function v(O){return O===null||Ht(O)?g(O):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),S(O))}function S(O){return O===null||Ht(O)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),g(O)):O===96&&O===h?t(O):(e.consume(O),S)}function T(O){return e.attempt(a,q,E)(O)}function E(O){return e.enter("lineEnding"),e.consume(O),e.exit("lineEnding"),C}function C(O){return o>0&&An(O)?zn(e,P,"linePrefix",o+1)(O):P(O)}function P(O){return O===null||Ht(O)?e.check(eS,T,q)(O):(e.enter("codeFlowValue"),I(O))}function I(O){return O===null||Ht(O)?(e.exit("codeFlowValue"),P(O)):(e.consume(O),I)}function q(O){return e.exit("codeFenced"),n(O)}function L(O,B,$){let F=0;return z;function z(ae){return O.enter("lineEnding"),O.consume(ae),O.exit("lineEnding"),U}function U(ae){return O.enter("codeFencedFence"),An(ae)?zn(O,V,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(ae):V(ae)}function V(ae){return ae===h?(O.enter("codeFencedFenceSequence"),ee(ae)):$(ae)}function ee(ae){return ae===h?(F++,O.consume(ae),ee):F>=l?(O.exit("codeFencedFenceSequence"),An(ae)?zn(O,ie,"whitespace")(ae):ie(ae)):$(ae)}function ie(ae){return ae===null||Ht(ae)?(O.exit("codeFencedFence"),B(ae)):$(ae)}}}function m4(e,n,t){const r=this;return a;function a(l){return l===null?t(l):(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),o)}function o(l){return r.parser.lazy[r.now().line]?t(l):n(l)}}const a0={name:"codeIndented",tokenize:y4},g4={partial:!0,tokenize:x4};function y4(e,n,t){const r=this;return a;function a(u){return e.enter("codeIndented"),zn(e,o,"linePrefix",5)(u)}function o(u){const f=r.events[r.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?l(u):t(u)}function l(u){return u===null?d(u):Ht(u)?e.attempt(g4,l,d)(u):(e.enter("codeFlowValue"),h(u))}function h(u){return u===null||Ht(u)?(e.exit("codeFlowValue"),l(u)):(e.consume(u),h)}function d(u){return e.exit("codeIndented"),n(u)}}function x4(e,n,t){const r=this;return a;function a(l){return r.parser.lazy[r.now().line]?t(l):Ht(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),a):zn(e,o,"linePrefix",5)(l)}function o(l){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?n(l):Ht(l)?a(l):t(l)}}const b4={name:"codeText",previous:w4,resolve:v4,tokenize:N4};function v4(e){let n=e.length-4,t=3,r,a;if((e[t][1].type==="lineEnding"||e[t][1].type==="space")&&(e[n][1].type==="lineEnding"||e[n][1].type==="space")){for(r=t;++r<n;)if(e[r][1].type==="codeTextData"){e[t][1].type="codeTextPadding",e[n][1].type="codeTextPadding",t+=2,n-=2;break}}for(r=t-1,n++;++r<=n;)a===void 0?r!==n&&e[r][1].type!=="lineEnding"&&(a=r):(r===n||e[r][1].type==="lineEnding")&&(e[a][1].type="codeTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),n-=r-a-2,r=a+2),a=void 0);return e}function w4(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function N4(e,n,t){let r=0,a,o;return l;function l(g){return e.enter("codeText"),e.enter("codeTextSequence"),h(g)}function h(g){return g===96?(e.consume(g),r++,h):(e.exit("codeTextSequence"),d(g))}function d(g){return g===null?t(g):g===32?(e.enter("space"),e.consume(g),e.exit("space"),d):g===96?(o=e.enter("codeTextSequence"),a=0,f(g)):Ht(g)?(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),d):(e.enter("codeTextData"),u(g))}function u(g){return g===null||g===32||g===96||Ht(g)?(e.exit("codeTextData"),d(g)):(e.consume(g),u)}function f(g){return g===96?(e.consume(g),a++,f):a===r?(e.exit("codeTextSequence"),e.exit("codeText"),n(g)):(o.type="codeTextData",u(g))}}let S4=class{constructor(n){this.left=n?[...n]:[],this.right=[]}get(n){if(n<0||n>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+n+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return n<this.left.length?this.left[n]:this.right[this.right.length-n+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(n,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(n,r):n>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-n+this.left.length).reverse():this.left.slice(n).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(n,t,r){const a=t||0;this.setCursor(Math.trunc(n));const o=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return r&&zm(this.left,r),o.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(n){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(n)}pushMany(n){this.setCursor(Number.POSITIVE_INFINITY),zm(this.left,n)}unshift(n){this.setCursor(0),this.right.push(n)}unshiftMany(n){this.setCursor(0),zm(this.right,n.reverse())}setCursor(n){if(!(n===this.left.length||n>this.left.length&&this.right.length===0||n<0&&this.left.length===0))if(n<this.left.length){const t=this.left.splice(n,Number.POSITIVE_INFINITY);zm(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-n,Number.POSITIVE_INFINITY);zm(this.left,t.reverse())}}};function zm(e,n){let t=0;if(n.length<1e4)e.push(...n);else for(;t<n.length;)e.push(...n.slice(t,t+1e4)),t+=1e4}function j2(e){const n={};let t=-1,r,a,o,l,h,d,u;const f=new S4(e);for(;++t<f.length;){for(;t in n;)t=n[t];if(r=f.get(t),t&&r[1].type==="chunkFlow"&&f.get(t-1)[1].type==="listItemPrefix"&&(d=r[1]._tokenizer.events,o=0,o<d.length&&d[o][1].type==="lineEndingBlank"&&(o+=2),o<d.length&&d[o][1].type==="content"))for(;++o<d.length&&d[o][1].type!=="content";)d[o][1].type==="chunkText"&&(d[o][1]._isInFirstContentOfListItem=!0,o++);if(r[0]==="enter")r[1].contentType&&(Object.assign(n,j4(f,t)),t=n[t],u=!0);else if(r[1]._container){for(o=t,a=void 0;o--;)if(l=f.get(o),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(a&&(f.get(a)[1].type="lineEndingBlank"),l[1].type="lineEnding",a=o);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;a&&(r[1].end={...f.get(a)[1].start},h=f.slice(a,t),h.unshift(r),f.splice(a,t-a+1,h))}}return hs(e,0,Number.POSITIVE_INFINITY,f.slice(0)),!u}function j4(e,n){const t=e.get(n)[1],r=e.get(n)[2];let a=n-1;const o=[];let l=t._tokenizer;l||(l=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const h=l.events,d=[],u={};let f,g,b=-1,v=t,S=0,T=0;const E=[T];for(;v;){for(;e.get(++a)[1]!==v;);o.push(a),v._tokenizer||(f=r.sliceStream(v),v.next||f.push(null),g&&l.defineSkip(v.start),v._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(f),v._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),g=v,v=v.next}for(v=t;++b<h.length;)h[b][0]==="exit"&&h[b-1][0]==="enter"&&h[b][1].type===h[b-1][1].type&&h[b][1].start.line!==h[b][1].end.line&&(T=b+1,E.push(T),v._tokenizer=void 0,v.previous=void 0,v=v.next);for(l.events=[],v?(v._tokenizer=void 0,v.previous=void 0):E.pop(),b=E.length;b--;){const C=h.slice(E[b],E[b+1]),P=o.pop();d.push([P,P+C.length-1]),e.splice(P,2,C)}for(d.reverse(),b=-1;++b<d.length;)u[S+d[b][0]]=S+d[b][1],S+=d[b][1]-d[b][0]-1;return u}const _4={resolve:k4,tokenize:T4},C4={partial:!0,tokenize:E4};function k4(e){return j2(e),e}function T4(e,n){let t;return r;function r(h){return e.enter("content"),t=e.enter("chunkContent",{contentType:"content"}),a(h)}function a(h){return h===null?o(h):Ht(h)?e.check(C4,l,o)(h):(e.consume(h),a)}function o(h){return e.exit("chunkContent"),e.exit("content"),n(h)}function l(h){return e.consume(h),e.exit("chunkContent"),t.next=e.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,a}}function E4(e,n,t){const r=this;return a;function a(l){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),zn(e,o,"linePrefix")}function o(l){if(l===null||Ht(l))return t(l);const h=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?n(l):e.interrupt(r.parser.constructs.flow,t,n)(l)}}function _2(e,n,t,r,a,o,l,h,d){const u=d||Number.POSITIVE_INFINITY;let f=0;return g;function g(C){return C===60?(e.enter(r),e.enter(a),e.enter(o),e.consume(C),e.exit(o),b):C===null||C===32||C===41||lb(C)?t(C):(e.enter(r),e.enter(l),e.enter(h),e.enter("chunkString",{contentType:"string"}),T(C))}function b(C){return C===62?(e.enter(o),e.consume(C),e.exit(o),e.exit(a),e.exit(r),n):(e.enter(h),e.enter("chunkString",{contentType:"string"}),v(C))}function v(C){return C===62?(e.exit("chunkString"),e.exit(h),b(C)):C===null||C===60||Ht(C)?t(C):(e.consume(C),C===92?S:v)}function S(C){return C===60||C===62||C===92?(e.consume(C),v):v(C)}function T(C){return!f&&(C===null||C===41||gi(C))?(e.exit("chunkString"),e.exit(h),e.exit(l),e.exit(r),n(C)):f<u&&C===40?(e.consume(C),f++,T):C===41?(e.consume(C),f--,T):C===null||C===32||C===40||lb(C)?t(C):(e.consume(C),C===92?E:T)}function E(C){return C===40||C===41||C===92?(e.consume(C),T):T(C)}}function C2(e,n,t,r,a,o){const l=this;let h=0,d;return u;function u(v){return e.enter(r),e.enter(a),e.consume(v),e.exit(a),e.enter(o),f}function f(v){return h>999||v===null||v===91||v===93&&!d||v===94&&!h&&"_hiddenFootnoteSupport"in l.parser.constructs?t(v):v===93?(e.exit(o),e.enter(a),e.consume(v),e.exit(a),e.exit(r),n):Ht(v)?(e.enter("lineEnding"),e.consume(v),e.exit("lineEnding"),f):(e.enter("chunkString",{contentType:"string"}),g(v))}function g(v){return v===null||v===91||v===93||Ht(v)||h++>999?(e.exit("chunkString"),f(v)):(e.consume(v),d||(d=!An(v)),v===92?b:g)}function b(v){return v===91||v===92||v===93?(e.consume(v),h++,g):g(v)}}function k2(e,n,t,r,a,o){let l;return h;function h(b){return b===34||b===39||b===40?(e.enter(r),e.enter(a),e.consume(b),e.exit(a),l=b===40?41:b,d):t(b)}function d(b){return b===l?(e.enter(a),e.consume(b),e.exit(a),e.exit(r),n):(e.enter(o),u(b))}function u(b){return b===l?(e.exit(o),d(l)):b===null?t(b):Ht(b)?(e.enter("lineEnding"),e.consume(b),e.exit("lineEnding"),zn(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),f(b))}function f(b){return b===l||b===null||Ht(b)?(e.exit("chunkString"),u(b)):(e.consume(b),b===92?g:f)}function g(b){return b===l||b===92?(e.consume(b),f):f(b)}}function Zm(e,n){let t;return r;function r(a){return Ht(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),t=!0,r):An(a)?zn(e,r,t?"linePrefix":"lineSuffix")(a):n(a)}}const A4={name:"definition",tokenize:P4},D4={partial:!0,tokenize:I4};function P4(e,n,t){const r=this;let a;return o;function o(v){return e.enter("definition"),l(v)}function l(v){return C2.call(r,e,h,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(v)}function h(v){return a=Do(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),v===58?(e.enter("definitionMarker"),e.consume(v),e.exit("definitionMarker"),d):t(v)}function d(v){return gi(v)?Zm(e,u)(v):u(v)}function u(v){return _2(e,f,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(v)}function f(v){return e.attempt(D4,g,g)(v)}function g(v){return An(v)?zn(e,b,"whitespace")(v):b(v)}function b(v){return v===null||Ht(v)?(e.exit("definition"),r.parser.defined.push(a),n(v)):t(v)}}function I4(e,n,t){return r;function r(h){return gi(h)?Zm(e,a)(h):t(h)}function a(h){return k2(e,o,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(h)}function o(h){return An(h)?zn(e,l,"whitespace")(h):l(h)}function l(h){return h===null||Ht(h)?n(h):t(h)}}const M4={name:"hardBreakEscape",tokenize:R4};function R4(e,n,t){return r;function r(o){return e.enter("hardBreakEscape"),e.consume(o),a}function a(o){return Ht(o)?(e.exit("hardBreakEscape"),n(o)):t(o)}}const O4={name:"headingAtx",resolve:L4,tokenize:F4};function L4(e,n){let t=e.length-2,r=3,a,o;return e[r][1].type==="whitespace"&&(r+=2),t-2>r&&e[t][1].type==="whitespace"&&(t-=2),e[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&e[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(a={type:"atxHeadingText",start:e[r][1].start,end:e[t][1].end},o={type:"chunkText",start:e[r][1].start,end:e[t][1].end,contentType:"text"},hs(e,r,t-r+1,[["enter",a,n],["enter",o,n],["exit",o,n],["exit",a,n]])),e}function F4(e,n,t){let r=0;return a;function a(f){return e.enter("atxHeading"),o(f)}function o(f){return e.enter("atxHeadingSequence"),l(f)}function l(f){return f===35&&r++<6?(e.consume(f),l):f===null||gi(f)?(e.exit("atxHeadingSequence"),h(f)):t(f)}function h(f){return f===35?(e.enter("atxHeadingSequence"),d(f)):f===null||Ht(f)?(e.exit("atxHeading"),n(f)):An(f)?zn(e,h,"whitespace")(f):(e.enter("atxHeadingText"),u(f))}function d(f){return f===35?(e.consume(f),d):(e.exit("atxHeadingSequence"),h(f))}function u(f){return f===null||f===35||gi(f)?(e.exit("atxHeadingText"),h(f)):(e.consume(f),u)}}const $4=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],nS=["pre","script","style","textarea"],z4={concrete:!0,name:"htmlFlow",resolveTo:q4,tokenize:V4},B4={partial:!0,tokenize:G4},U4={partial:!0,tokenize:H4};function q4(e){let n=e.length;for(;n--&&!(e[n][0]==="enter"&&e[n][1].type==="htmlFlow"););return n>1&&e[n-2][1].type==="linePrefix"&&(e[n][1].start=e[n-2][1].start,e[n+1][1].start=e[n-2][1].start,e.splice(n-2,2)),e}function V4(e,n,t){const r=this;let a,o,l,h,d;return u;function u(M){return f(M)}function f(M){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(M),g}function g(M){return M===33?(e.consume(M),b):M===47?(e.consume(M),o=!0,T):M===63?(e.consume(M),a=3,r.interrupt?n:A):ga(M)?(e.consume(M),l=String.fromCharCode(M),E):t(M)}function b(M){return M===45?(e.consume(M),a=2,v):M===91?(e.consume(M),a=5,h=0,S):ga(M)?(e.consume(M),a=4,r.interrupt?n:A):t(M)}function v(M){return M===45?(e.consume(M),r.interrupt?n:A):t(M)}function S(M){const Se="CDATA[";return M===Se.charCodeAt(h++)?(e.consume(M),h===Se.length?r.interrupt?n:V:S):t(M)}function T(M){return ga(M)?(e.consume(M),l=String.fromCharCode(M),E):t(M)}function E(M){if(M===null||M===47||M===62||gi(M)){const Se=M===47,$e=l.toLowerCase();return!Se&&!o&&nS.includes($e)?(a=1,r.interrupt?n(M):V(M)):$4.includes(l.toLowerCase())?(a=6,Se?(e.consume(M),C):r.interrupt?n(M):V(M)):(a=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(M):o?P(M):I(M))}return M===45||ta(M)?(e.consume(M),l+=String.fromCharCode(M),E):t(M)}function C(M){return M===62?(e.consume(M),r.interrupt?n:V):t(M)}function P(M){return An(M)?(e.consume(M),P):z(M)}function I(M){return M===47?(e.consume(M),z):M===58||M===95||ga(M)?(e.consume(M),q):An(M)?(e.consume(M),I):z(M)}function q(M){return M===45||M===46||M===58||M===95||ta(M)?(e.consume(M),q):L(M)}function L(M){return M===61?(e.consume(M),O):An(M)?(e.consume(M),L):I(M)}function O(M){return M===null||M===60||M===61||M===62||M===96?t(M):M===34||M===39?(e.consume(M),d=M,B):An(M)?(e.consume(M),O):$(M)}function B(M){return M===d?(e.consume(M),d=null,F):M===null||Ht(M)?t(M):(e.consume(M),B)}function $(M){return M===null||M===34||M===39||M===47||M===60||M===61||M===62||M===96||gi(M)?L(M):(e.consume(M),$)}function F(M){return M===47||M===62||An(M)?I(M):t(M)}function z(M){return M===62?(e.consume(M),U):t(M)}function U(M){return M===null||Ht(M)?V(M):An(M)?(e.consume(M),U):t(M)}function V(M){return M===45&&a===2?(e.consume(M),J):M===60&&a===1?(e.consume(M),K):M===62&&a===4?(e.consume(M),te):M===63&&a===3?(e.consume(M),A):M===93&&a===5?(e.consume(M),re):Ht(M)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(B4,xe,ee)(M)):M===null||Ht(M)?(e.exit("htmlFlowData"),ee(M)):(e.consume(M),V)}function ee(M){return e.check(U4,ie,xe)(M)}function ie(M){return e.enter("lineEnding"),e.consume(M),e.exit("lineEnding"),ae}function ae(M){return M===null||Ht(M)?ee(M):(e.enter("htmlFlowData"),V(M))}function J(M){return M===45?(e.consume(M),A):V(M)}function K(M){return M===47?(e.consume(M),l="",W):V(M)}function W(M){if(M===62){const Se=l.toLowerCase();return nS.includes(Se)?(e.consume(M),te):V(M)}return ga(M)&&l.length<8?(e.consume(M),l+=String.fromCharCode(M),W):V(M)}function re(M){return M===93?(e.consume(M),A):V(M)}function A(M){return M===62?(e.consume(M),te):M===45&&a===2?(e.consume(M),A):V(M)}function te(M){return M===null||Ht(M)?(e.exit("htmlFlowData"),xe(M)):(e.consume(M),te)}function xe(M){return e.exit("htmlFlow"),n(M)}}function H4(e,n,t){const r=this;return a;function a(l){return Ht(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),o):t(l)}function o(l){return r.parser.lazy[r.now().line]?t(l):n(l)}}function G4(e,n,t){return r;function r(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(vg,n,t)}}const Y4={name:"htmlText",tokenize:W4};function W4(e,n,t){const r=this;let a,o,l;return h;function h(A){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(A),d}function d(A){return A===33?(e.consume(A),u):A===47?(e.consume(A),L):A===63?(e.consume(A),I):ga(A)?(e.consume(A),$):t(A)}function u(A){return A===45?(e.consume(A),f):A===91?(e.consume(A),o=0,S):ga(A)?(e.consume(A),P):t(A)}function f(A){return A===45?(e.consume(A),v):t(A)}function g(A){return A===null?t(A):A===45?(e.consume(A),b):Ht(A)?(l=g,K(A)):(e.consume(A),g)}function b(A){return A===45?(e.consume(A),v):g(A)}function v(A){return A===62?J(A):A===45?b(A):g(A)}function S(A){const te="CDATA[";return A===te.charCodeAt(o++)?(e.consume(A),o===te.length?T:S):t(A)}function T(A){return A===null?t(A):A===93?(e.consume(A),E):Ht(A)?(l=T,K(A)):(e.consume(A),T)}function E(A){return A===93?(e.consume(A),C):T(A)}function C(A){return A===62?J(A):A===93?(e.consume(A),C):T(A)}function P(A){return A===null||A===62?J(A):Ht(A)?(l=P,K(A)):(e.consume(A),P)}function I(A){return A===null?t(A):A===63?(e.consume(A),q):Ht(A)?(l=I,K(A)):(e.consume(A),I)}function q(A){return A===62?J(A):I(A)}function L(A){return ga(A)?(e.consume(A),O):t(A)}function O(A){return A===45||ta(A)?(e.consume(A),O):B(A)}function B(A){return Ht(A)?(l=B,K(A)):An(A)?(e.consume(A),B):J(A)}function $(A){return A===45||ta(A)?(e.consume(A),$):A===47||A===62||gi(A)?F(A):t(A)}function F(A){return A===47?(e.consume(A),J):A===58||A===95||ga(A)?(e.consume(A),z):Ht(A)?(l=F,K(A)):An(A)?(e.consume(A),F):J(A)}function z(A){return A===45||A===46||A===58||A===95||ta(A)?(e.consume(A),z):U(A)}function U(A){return A===61?(e.consume(A),V):Ht(A)?(l=U,K(A)):An(A)?(e.consume(A),U):F(A)}function V(A){return A===null||A===60||A===61||A===62||A===96?t(A):A===34||A===39?(e.consume(A),a=A,ee):Ht(A)?(l=V,K(A)):An(A)?(e.consume(A),V):(e.consume(A),ie)}function ee(A){return A===a?(e.consume(A),a=void 0,ae):A===null?t(A):Ht(A)?(l=ee,K(A)):(e.consume(A),ee)}function ie(A){return A===null||A===34||A===39||A===60||A===61||A===96?t(A):A===47||A===62||gi(A)?F(A):(e.consume(A),ie)}function ae(A){return A===47||A===62||gi(A)?F(A):t(A)}function J(A){return A===62?(e.consume(A),e.exit("htmlTextData"),e.exit("htmlText"),n):t(A)}function K(A){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(A),e.exit("lineEnding"),W}function W(A){return An(A)?zn(e,re,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):re(A)}function re(A){return e.enter("htmlTextData"),l(A)}}const kw={name:"labelEnd",resolveAll:X4,resolveTo:Z4,tokenize:eO},Q4={tokenize:tO},J4={tokenize:nO},K4={tokenize:iO};function X4(e){let n=-1;const t=[];for(;++n<e.length;){const r=e[n][1];if(t.push(e[n]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const a=r.type==="labelImage"?4:2;r.type="data",n+=a}}return e.length!==t.length&&hs(e,0,e.length,t),e}function Z4(e,n){let t=e.length,r=0,a,o,l,h;for(;t--;)if(a=e[t][1],o){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[t][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(l){if(e[t][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(o=t,a.type!=="labelLink")){r=2;break}}else a.type==="labelEnd"&&(l=t);const d={type:e[o][1].type==="labelLink"?"link":"image",start:{...e[o][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[o][1].start},end:{...e[l][1].end}},f={type:"labelText",start:{...e[o+r+2][1].end},end:{...e[l-2][1].start}};return h=[["enter",d,n],["enter",u,n]],h=zs(h,e.slice(o+1,o+r+3)),h=zs(h,[["enter",f,n]]),h=zs(h,Ob(n.parser.constructs.insideSpan.null,e.slice(o+r+4,l-3),n)),h=zs(h,[["exit",f,n],e[l-2],e[l-1],["exit",u,n]]),h=zs(h,e.slice(l+1)),h=zs(h,[["exit",d,n]]),hs(e,o,e.length,h),e}function eO(e,n,t){const r=this;let a=r.events.length,o,l;for(;a--;)if((r.events[a][1].type==="labelImage"||r.events[a][1].type==="labelLink")&&!r.events[a][1]._balanced){o=r.events[a][1];break}return h;function h(b){return o?o._inactive?g(b):(l=r.parser.defined.includes(Do(r.sliceSerialize({start:o.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(b),e.exit("labelMarker"),e.exit("labelEnd"),d):t(b)}function d(b){return b===40?e.attempt(Q4,f,l?f:g)(b):b===91?e.attempt(J4,f,l?u:g)(b):l?f(b):g(b)}function u(b){return e.attempt(K4,f,g)(b)}function f(b){return n(b)}function g(b){return o._balanced=!0,t(b)}}function tO(e,n,t){return r;function r(g){return e.enter("resource"),e.enter("resourceMarker"),e.consume(g),e.exit("resourceMarker"),a}function a(g){return gi(g)?Zm(e,o)(g):o(g)}function o(g){return g===41?f(g):_2(e,l,h,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function l(g){return gi(g)?Zm(e,d)(g):f(g)}function h(g){return t(g)}function d(g){return g===34||g===39||g===40?k2(e,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function u(g){return gi(g)?Zm(e,f)(g):f(g)}function f(g){return g===41?(e.enter("resourceMarker"),e.consume(g),e.exit("resourceMarker"),e.exit("resource"),n):t(g)}}function nO(e,n,t){const r=this;return a;function a(h){return C2.call(r,e,o,l,"reference","referenceMarker","referenceString")(h)}function o(h){return r.parser.defined.includes(Do(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?n(h):t(h)}function l(h){return t(h)}}function iO(e,n,t){return r;function r(o){return e.enter("reference"),e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),a}function a(o){return o===93?(e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),e.exit("reference"),n):t(o)}}const rO={name:"labelStartImage",resolveAll:kw.resolveAll,tokenize:aO};function aO(e,n,t){const r=this;return a;function a(h){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(h),e.exit("labelImageMarker"),o}function o(h){return h===91?(e.enter("labelMarker"),e.consume(h),e.exit("labelMarker"),e.exit("labelImage"),l):t(h)}function l(h){return h===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(h):n(h)}}const sO={name:"labelStartLink",resolveAll:kw.resolveAll,tokenize:oO};function oO(e,n,t){const r=this;return a;function a(l){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelLink"),o}function o(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):n(l)}}const s0={name:"lineEnding",tokenize:lO};function lO(e,n){return t;function t(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),zn(e,n,"linePrefix")}}const Wx={name:"thematicBreak",tokenize:cO};function cO(e,n,t){let r=0,a;return o;function o(u){return e.enter("thematicBreak"),l(u)}function l(u){return a=u,h(u)}function h(u){return u===a?(e.enter("thematicBreakSequence"),d(u)):r>=3&&(u===null||Ht(u))?(e.exit("thematicBreak"),n(u)):t(u)}function d(u){return u===a?(e.consume(u),r++,d):(e.exit("thematicBreakSequence"),An(u)?zn(e,h,"whitespace")(u):h(u))}}const Aa={continuation:{tokenize:fO},exit:mO,name:"list",tokenize:hO},uO={partial:!0,tokenize:gO},dO={partial:!0,tokenize:pO};function hO(e,n,t){const r=this,a=r.events[r.events.length-1];let o=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,l=0;return h;function h(v){const S=r.containerState.type||(v===42||v===43||v===45?"listUnordered":"listOrdered");if(S==="listUnordered"?!r.containerState.marker||v===r.containerState.marker:d1(v)){if(r.containerState.type||(r.containerState.type=S,e.enter(S,{_container:!0})),S==="listUnordered")return e.enter("listItemPrefix"),v===42||v===45?e.check(Wx,t,u)(v):u(v);if(!r.interrupt||v===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),d(v)}return t(v)}function d(v){return d1(v)&&++l<10?(e.consume(v),d):(!r.interrupt||l<2)&&(r.containerState.marker?v===r.containerState.marker:v===41||v===46)?(e.exit("listItemValue"),u(v)):t(v)}function u(v){return e.enter("listItemMarker"),e.consume(v),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||v,e.check(vg,r.interrupt?t:f,e.attempt(uO,b,g))}function f(v){return r.containerState.initialBlankLine=!0,o++,b(v)}function g(v){return An(v)?(e.enter("listItemPrefixWhitespace"),e.consume(v),e.exit("listItemPrefixWhitespace"),b):t(v)}function b(v){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,n(v)}}function fO(e,n,t){const r=this;return r.containerState._closeFlow=void 0,e.check(vg,a,o);function a(h){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,zn(e,n,"listItemIndent",r.containerState.size+1)(h)}function o(h){return r.containerState.furtherBlankLines||!An(h)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,l(h)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(dO,n,l)(h))}function l(h){return r.containerState._closeFlow=!0,r.interrupt=void 0,zn(e,e.attempt(Aa,n,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(h)}}function pO(e,n,t){const r=this;return zn(e,a,"listItemIndent",r.containerState.size+1);function a(o){const l=r.events[r.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===r.containerState.size?n(o):t(o)}}function mO(e){e.exit(this.containerState.type)}function gO(e,n,t){const r=this;return zn(e,a,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(o){const l=r.events[r.events.length-1];return!An(o)&&l&&l[1].type==="listItemPrefixWhitespace"?n(o):t(o)}}const iS={name:"setextUnderline",resolveTo:yO,tokenize:xO};function yO(e,n){let t=e.length,r,a,o;for(;t--;)if(e[t][0]==="enter"){if(e[t][1].type==="content"){r=t;break}e[t][1].type==="paragraph"&&(a=t)}else e[t][1].type==="content"&&e.splice(t,1),!o&&e[t][1].type==="definition"&&(o=t);const l={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",o?(e.splice(a,0,["enter",l,n]),e.splice(o+1,0,["exit",e[r][1],n]),e[r][1].end={...e[o][1].end}):e[r][1]=l,e.push(["exit",l,n]),e}function xO(e,n,t){const r=this;let a;return o;function o(u){let f=r.events.length,g;for(;f--;)if(r.events[f][1].type!=="lineEnding"&&r.events[f][1].type!=="linePrefix"&&r.events[f][1].type!=="content"){g=r.events[f][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||g)?(e.enter("setextHeadingLine"),a=u,l(u)):t(u)}function l(u){return e.enter("setextHeadingLineSequence"),h(u)}function h(u){return u===a?(e.consume(u),h):(e.exit("setextHeadingLineSequence"),An(u)?zn(e,d,"lineSuffix")(u):d(u))}function d(u){return u===null||Ht(u)?(e.exit("setextHeadingLine"),n(u)):t(u)}}const bO={tokenize:vO};function vO(e){const n=this,t=e.attempt(vg,r,e.attempt(this.parser.constructs.flowInitial,a,zn(e,e.attempt(this.parser.constructs.flow,a,e.attempt(_4,a)),"linePrefix")));return t;function r(o){if(o===null){e.consume(o);return}return e.enter("lineEndingBlank"),e.consume(o),e.exit("lineEndingBlank"),n.currentConstruct=void 0,t}function a(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),n.currentConstruct=void 0,t}}const wO={resolveAll:E2()},NO=T2("string"),SO=T2("text");function T2(e){return{resolveAll:E2(e==="text"?jO:void 0),tokenize:n};function n(t){const r=this,a=this.parser.constructs[e],o=t.attempt(a,l,h);return l;function l(f){return u(f)?o(f):h(f)}function h(f){if(f===null){t.consume(f);return}return t.enter("data"),t.consume(f),d}function d(f){return u(f)?(t.exit("data"),o(f)):(t.consume(f),d)}function u(f){if(f===null)return!0;const g=a[f];let b=-1;if(g)for(;++b<g.length;){const v=g[b];if(!v.previous||v.previous.call(r,r.previous))return!0}return!1}}}function E2(e){return n;function n(t,r){let a=-1,o;for(;++a<=t.length;)o===void 0?t[a]&&t[a][1].type==="data"&&(o=a,a++):(!t[a]||t[a][1].type!=="data")&&(a!==o+2&&(t[o][1].end=t[a-1][1].end,t.splice(o+2,a-o-2),a=o+2),o=void 0);return e?e(t,r):t}}function jO(e,n){let t=0;for(;++t<=e.length;)if((t===e.length||e[t][1].type==="lineEnding")&&e[t-1][1].type==="data"){const r=e[t-1][1],a=n.sliceStream(r);let o=a.length,l=-1,h=0,d;for(;o--;){const u=a[o];if(typeof u=="string"){for(l=u.length;u.charCodeAt(l-1)===32;)h++,l--;if(l)break;l=-1}else if(u===-2)d=!0,h++;else if(u!==-1){o++;break}}if(n._contentTypeTextTrailing&&t===e.length&&(h=0),h){const u={type:t===e.length||d||h<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:o?l:r.start._bufferIndex+l,_index:r.start._index+o,line:r.end.line,column:r.end.column-h,offset:r.end.offset-h},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(e.splice(t,0,["enter",u,n],["exit",u,n]),t+=2)}t++}return e}const _O={42:Aa,43:Aa,45:Aa,48:Aa,49:Aa,50:Aa,51:Aa,52:Aa,53:Aa,54:Aa,55:Aa,56:Aa,57:Aa,62:w2},CO={91:A4},kO={[-2]:a0,[-1]:a0,32:a0},TO={35:O4,42:Wx,45:[iS,Wx],60:z4,61:iS,95:Wx,96:tS,126:tS},EO={38:S2,92:N2},AO={[-5]:s0,[-4]:s0,[-3]:s0,33:rO,38:S2,42:h1,60:[s4,Y4],91:sO,92:[M4,N2],93:kw,95:h1,96:b4},DO={null:[h1,wO]},PO={null:[42,95]},IO={null:[]},MO=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:PO,contentInitial:CO,disable:IO,document:_O,flow:TO,flowInitial:kO,insideSpan:DO,string:EO,text:AO},Symbol.toStringTag,{value:"Module"}));function RO(e,n,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const a={},o=[];let l=[],h=[];const d={attempt:B(L),check:B(O),consume:P,enter:I,exit:q,interrupt:B(O,{interrupt:!0})},u={code:null,containerState:{},defineSkip:T,events:[],now:S,parser:e,previous:null,sliceSerialize:b,sliceStream:v,write:g};let f=n.tokenize.call(u,d);return n.resolveAll&&o.push(n),u;function g(U){return l=zs(l,U),E(),l[l.length-1]!==null?[]:($(n,0),u.events=Ob(o,u.events,u),u.events)}function b(U,V){return LO(v(U),V)}function v(U){return OO(l,U)}function S(){const{_bufferIndex:U,_index:V,line:ee,column:ie,offset:ae}=r;return{_bufferIndex:U,_index:V,line:ee,column:ie,offset:ae}}function T(U){a[U.line]=U.column,z()}function E(){let U;for(;r._index<l.length;){const V=l[r._index];if(typeof V=="string")for(U=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===U&&r._bufferIndex<V.length;)C(V.charCodeAt(r._bufferIndex));else C(V)}}function C(U){f=f(U)}function P(U){Ht(U)?(r.line++,r.column=1,r.offset+=U===-3?2:1,z()):U!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===l[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=U}function I(U,V){const ee=V||{};return ee.type=U,ee.start=S(),u.events.push(["enter",ee,u]),h.push(ee),ee}function q(U){const V=h.pop();return V.end=S(),u.events.push(["exit",V,u]),V}function L(U,V){$(U,V.from)}function O(U,V){V.restore()}function B(U,V){return ee;function ee(ie,ae,J){let K,W,re,A;return Array.isArray(ie)?xe(ie):"tokenize"in ie?xe([ie]):te(ie);function te(he){return ge;function ge(me){const de=me!==null&&he[me],Le=me!==null&&he.null,He=[...Array.isArray(de)?de:de?[de]:[],...Array.isArray(Le)?Le:Le?[Le]:[]];return xe(He)(me)}}function xe(he){return K=he,W=0,he.length===0?J:M(he[W])}function M(he){return ge;function ge(me){return A=F(),re=he,he.partial||(u.currentConstruct=he),he.name&&u.parser.constructs.disable.null.includes(he.name)?$e():he.tokenize.call(V?Object.assign(Object.create(u),V):u,d,Se,$e)(me)}}function Se(he){return U(re,A),ae}function $e(he){return A.restore(),++W<K.length?M(K[W]):J}}}function $(U,V){U.resolveAll&&!o.includes(U)&&o.push(U),U.resolve&&hs(u.events,V,u.events.length-V,U.resolve(u.events.slice(V),u)),U.resolveTo&&(u.events=U.resolveTo(u.events,u))}function F(){const U=S(),V=u.previous,ee=u.currentConstruct,ie=u.events.length,ae=Array.from(h);return{from:ie,restore:J};function J(){r=U,u.previous=V,u.currentConstruct=ee,u.events.length=ie,h=ae,z()}}function z(){r.line in a&&r.column<2&&(r.column=a[r.line],r.offset+=a[r.line]-1)}}function OO(e,n){const t=n.start._index,r=n.start._bufferIndex,a=n.end._index,o=n.end._bufferIndex;let l;if(t===a)l=[e[t].slice(r,o)];else{if(l=e.slice(t,a),r>-1){const h=l[0];typeof h=="string"?l[0]=h.slice(r):l.shift()}o>0&&l.push(e[a].slice(0,o))}return l}function LO(e,n){let t=-1;const r=[];let a;for(;++t<e.length;){const o=e[t];let l;if(typeof o=="string")l=o;else switch(o){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=n?" ":"	";break}case-1:{if(!n&&a)continue;l=" ";break}default:l=String.fromCharCode(o)}a=o===-2,r.push(l)}return r.join("")}function FO(e){const r={constructs:b2([MO,...(e||{}).extensions||[]]),content:a(ZR),defined:[],document:a(t4),flow:a(bO),lazy:{},string:a(NO),text:a(SO)};return r;function a(o){return l;function l(h){return RO(r,o,h)}}}function $O(e){for(;!j2(e););return e}const rS=/[\0\t\n\r]/g;function zO(){let e=1,n="",t=!0,r;return a;function a(o,l,h){const d=[];let u,f,g,b,v;for(o=n+(typeof o=="string"?o.toString():new TextDecoder(l||void 0).decode(o)),g=0,n="",t&&(o.charCodeAt(0)===65279&&g++,t=void 0);g<o.length;){if(rS.lastIndex=g,u=rS.exec(o),b=u&&u.index!==void 0?u.index:o.length,v=o.charCodeAt(b),!u){n=o.slice(g);break}if(v===10&&g===b&&r)d.push(-3),r=void 0;else switch(r&&(d.push(-5),r=void 0),g<b&&(d.push(o.slice(g,b)),e+=b-g),v){case 0:{d.push(65533),e++;break}case 9:{for(f=Math.ceil(e/4)*4,d.push(-2);e++<f;)d.push(-1);break}case 10:{d.push(-4),e=1;break}default:r=!0,e=1}g=b+1}return h&&(r&&d.push(-5),n&&d.push(n),d.push(null)),d}}const BO=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function UO(e){return e.replace(BO,qO)}function qO(e,n,t){if(n)return n;if(t.charCodeAt(0)===35){const a=t.charCodeAt(1),o=a===120||a===88;return v2(t.slice(o?2:1),o?16:10)}return Cw(t)||e}const A2={}.hasOwnProperty;function VO(e,n,t){return typeof n!="string"&&(t=n,n=void 0),HO(t)($O(FO(t).document().write(zO()(e,n,!0))))}function HO(e){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(Qe),autolinkProtocol:F,autolinkEmail:F,atxHeading:o(Ye),blockQuote:o(Le),characterEscape:F,characterReference:F,codeFenced:o(He),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:o(He,l),codeText:o(pe,l),codeTextData:F,data:F,codeFlowValue:F,definition:o(ne),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:o(Pe),hardBreakEscape:o(rt),hardBreakTrailing:o(rt),htmlFlow:o(ut,l),htmlFlowData:F,htmlText:o(ut,l),htmlTextData:F,image:o(je),label:l,link:o(Qe),listItem:o(dt),listItemValue:b,listOrdered:o(ze,g),listUnordered:o(ze),paragraph:o(Ze),reference:M,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:o(Ye),strong:o(ct),thematicBreak:o(fe)},exit:{atxHeading:d(),atxHeadingSequence:L,autolink:d(),autolinkEmail:de,autolinkProtocol:me,blockQuote:d(),characterEscapeValue:z,characterReferenceMarkerHexadecimal:$e,characterReferenceMarkerNumeric:$e,characterReferenceValue:he,characterReference:ge,codeFenced:d(E),codeFencedFence:T,codeFencedFenceInfo:v,codeFencedFenceMeta:S,codeFlowValue:z,codeIndented:d(C),codeText:d(ae),codeTextData:z,data:z,definition:d(),definitionDestinationString:q,definitionLabelString:P,definitionTitleString:I,emphasis:d(),hardBreakEscape:d(V),hardBreakTrailing:d(V),htmlFlow:d(ee),htmlFlowData:z,htmlText:d(ie),htmlTextData:z,image:d(K),label:re,labelText:W,lineEnding:U,link:d(J),listItem:d(),listOrdered:d(),listUnordered:d(),paragraph:d(),referenceString:Se,resourceDestinationString:A,resourceTitleString:te,resource:xe,setextHeading:d($),setextHeadingLineSequence:B,setextHeadingText:O,strong:d(),thematicBreak:d()}};D2(n,(e||{}).mdastExtensions||[]);const t={};return r;function r(Q){let ue={type:"root",children:[]};const De={stack:[ue],tokenStack:[],config:n,enter:h,exit:u,buffer:l,resume:f,data:t},Ge=[];let ye=-1;for(;++ye<Q.length;)if(Q[ye][1].type==="listOrdered"||Q[ye][1].type==="listUnordered")if(Q[ye][0]==="enter")Ge.push(ye);else{const Ne=Ge.pop();ye=a(Q,Ne,ye)}for(ye=-1;++ye<Q.length;){const Ne=n[Q[ye][0]];A2.call(Ne,Q[ye][1].type)&&Ne[Q[ye][1].type].call(Object.assign({sliceSerialize:Q[ye][2].sliceSerialize},De),Q[ye][1])}if(De.tokenStack.length>0){const Ne=De.tokenStack[De.tokenStack.length-1];(Ne[1]||aS).call(De,void 0,Ne[0])}for(ue.position={start:bu(Q.length>0?Q[0][1].start:{line:1,column:1,offset:0}),end:bu(Q.length>0?Q[Q.length-2][1].end:{line:1,column:1,offset:0})},ye=-1;++ye<n.transforms.length;)ue=n.transforms[ye](ue)||ue;return ue}function a(Q,ue,De){let Ge=ue-1,ye=-1,Ne=!1,Me,Fe,ve,ke;for(;++Ge<=De;){const Ee=Q[Ge];switch(Ee[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ee[0]==="enter"?ye++:ye--,ke=void 0;break}case"lineEndingBlank":{Ee[0]==="enter"&&(Me&&!ke&&!ye&&!ve&&(ve=Ge),ke=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:ke=void 0}if(!ye&&Ee[0]==="enter"&&Ee[1].type==="listItemPrefix"||ye===-1&&Ee[0]==="exit"&&(Ee[1].type==="listUnordered"||Ee[1].type==="listOrdered")){if(Me){let Ve=Ge;for(Fe=void 0;Ve--;){const Ke=Q[Ve];if(Ke[1].type==="lineEnding"||Ke[1].type==="lineEndingBlank"){if(Ke[0]==="exit")continue;Fe&&(Q[Fe][1].type="lineEndingBlank",Ne=!0),Ke[1].type="lineEnding",Fe=Ve}else if(!(Ke[1].type==="linePrefix"||Ke[1].type==="blockQuotePrefix"||Ke[1].type==="blockQuotePrefixWhitespace"||Ke[1].type==="blockQuoteMarker"||Ke[1].type==="listItemIndent"))break}ve&&(!Fe||ve<Fe)&&(Me._spread=!0),Me.end=Object.assign({},Fe?Q[Fe][1].start:Ee[1].end),Q.splice(Fe||Ge,0,["exit",Me,Ee[2]]),Ge++,De++}if(Ee[1].type==="listItemPrefix"){const Ve={type:"listItem",_spread:!1,start:Object.assign({},Ee[1].start),end:void 0};Me=Ve,Q.splice(Ge,0,["enter",Ve,Ee[2]]),Ge++,De++,ve=void 0,ke=!0}}}return Q[ue][1]._spread=Ne,De}function o(Q,ue){return De;function De(Ge){h.call(this,Q(Ge),Ge),ue&&ue.call(this,Ge)}}function l(){this.stack.push({type:"fragment",children:[]})}function h(Q,ue,De){this.stack[this.stack.length-1].children.push(Q),this.stack.push(Q),this.tokenStack.push([ue,De||void 0]),Q.position={start:bu(ue.start),end:void 0}}function d(Q){return ue;function ue(De){Q&&Q.call(this,De),u.call(this,De)}}function u(Q,ue){const De=this.stack.pop(),Ge=this.tokenStack.pop();if(Ge)Ge[0].type!==Q.type&&(ue?ue.call(this,Q,Ge[0]):(Ge[1]||aS).call(this,Q,Ge[0]));else throw new Error("Cannot close `"+Q.type+"` ("+Xm({start:Q.start,end:Q.end})+"): its not open");De.position.end=bu(Q.end)}function f(){return _w(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function b(Q){if(this.data.expectingFirstListItemValue){const ue=this.stack[this.stack.length-2];ue.start=Number.parseInt(this.sliceSerialize(Q),10),this.data.expectingFirstListItemValue=void 0}}function v(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.lang=Q}function S(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.meta=Q}function T(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function E(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function C(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q.replace(/(\r?\n|\r)$/g,"")}function P(Q){const ue=this.resume(),De=this.stack[this.stack.length-1];De.label=ue,De.identifier=Do(this.sliceSerialize(Q)).toLowerCase()}function I(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.title=Q}function q(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.url=Q}function L(Q){const ue=this.stack[this.stack.length-1];if(!ue.depth){const De=this.sliceSerialize(Q).length;ue.depth=De}}function O(){this.data.setextHeadingSlurpLineEnding=!0}function B(Q){const ue=this.stack[this.stack.length-1];ue.depth=this.sliceSerialize(Q).codePointAt(0)===61?1:2}function $(){this.data.setextHeadingSlurpLineEnding=void 0}function F(Q){const De=this.stack[this.stack.length-1].children;let Ge=De[De.length-1];(!Ge||Ge.type!=="text")&&(Ge=ft(),Ge.position={start:bu(Q.start),end:void 0},De.push(Ge)),this.stack.push(Ge)}function z(Q){const ue=this.stack.pop();ue.value+=this.sliceSerialize(Q),ue.position.end=bu(Q.end)}function U(Q){const ue=this.stack[this.stack.length-1];if(this.data.atHardBreak){const De=ue.children[ue.children.length-1];De.position.end=bu(Q.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&n.canContainEols.includes(ue.type)&&(F.call(this,Q),z.call(this,Q))}function V(){this.data.atHardBreak=!0}function ee(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function ie(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function ae(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function J(){const Q=this.stack[this.stack.length-1];if(this.data.inReference){const ue=this.data.referenceType||"shortcut";Q.type+="Reference",Q.referenceType=ue,delete Q.url,delete Q.title}else delete Q.identifier,delete Q.label;this.data.referenceType=void 0}function K(){const Q=this.stack[this.stack.length-1];if(this.data.inReference){const ue=this.data.referenceType||"shortcut";Q.type+="Reference",Q.referenceType=ue,delete Q.url,delete Q.title}else delete Q.identifier,delete Q.label;this.data.referenceType=void 0}function W(Q){const ue=this.sliceSerialize(Q),De=this.stack[this.stack.length-2];De.label=UO(ue),De.identifier=Do(ue).toLowerCase()}function re(){const Q=this.stack[this.stack.length-1],ue=this.resume(),De=this.stack[this.stack.length-1];if(this.data.inReference=!0,De.type==="link"){const Ge=Q.children;De.children=Ge}else De.alt=ue}function A(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.url=Q}function te(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.title=Q}function xe(){this.data.inReference=void 0}function M(){this.data.referenceType="collapsed"}function Se(Q){const ue=this.resume(),De=this.stack[this.stack.length-1];De.label=ue,De.identifier=Do(this.sliceSerialize(Q)).toLowerCase(),this.data.referenceType="full"}function $e(Q){this.data.characterReferenceType=Q.type}function he(Q){const ue=this.sliceSerialize(Q),De=this.data.characterReferenceType;let Ge;De?(Ge=v2(ue,De==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Ge=Cw(ue);const ye=this.stack[this.stack.length-1];ye.value+=Ge}function ge(Q){const ue=this.stack.pop();ue.position.end=bu(Q.end)}function me(Q){z.call(this,Q);const ue=this.stack[this.stack.length-1];ue.url=this.sliceSerialize(Q)}function de(Q){z.call(this,Q);const ue=this.stack[this.stack.length-1];ue.url="mailto:"+this.sliceSerialize(Q)}function Le(){return{type:"blockquote",children:[]}}function He(){return{type:"code",lang:null,meta:null,value:""}}function pe(){return{type:"inlineCode",value:""}}function ne(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Pe(){return{type:"emphasis",children:[]}}function Ye(){return{type:"heading",depth:0,children:[]}}function rt(){return{type:"break"}}function ut(){return{type:"html",value:""}}function je(){return{type:"image",title:null,url:"",alt:null}}function Qe(){return{type:"link",title:null,url:"",children:[]}}function ze(Q){return{type:"list",ordered:Q.type==="listOrdered",start:null,spread:Q._spread,children:[]}}function dt(Q){return{type:"listItem",spread:Q._spread,checked:null,children:[]}}function Ze(){return{type:"paragraph",children:[]}}function ct(){return{type:"strong",children:[]}}function ft(){return{type:"text",value:""}}function fe(){return{type:"thematicBreak"}}}function bu(e){return{line:e.line,column:e.column,offset:e.offset}}function D2(e,n){let t=-1;for(;++t<n.length;){const r=n[t];Array.isArray(r)?D2(e,r):GO(e,r)}}function GO(e,n){let t;for(t in n)if(A2.call(n,t))switch(t){case"canContainEols":{const r=n[t];r&&e[t].push(...r);break}case"transforms":{const r=n[t];r&&e[t].push(...r);break}case"enter":case"exit":{const r=n[t];r&&Object.assign(e[t],r);break}}}function aS(e,n){throw e?new Error("Cannot close `"+e.type+"` ("+Xm({start:e.start,end:e.end})+"): a different token (`"+n.type+"`, "+Xm({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+Xm({start:n.start,end:n.end})+") is still open")}function YO(e){const n=this;n.parser=t;function t(r){return VO(r,{...n.data("settings"),...e,extensions:n.data("micromarkExtensions")||[],mdastExtensions:n.data("fromMarkdownExtensions")||[]})}}function WO(e,n){const t={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(n),!0)};return e.patch(n,t),e.applyData(n,t)}function QO(e,n){const t={type:"element",tagName:"br",properties:{},children:[]};return e.patch(n,t),[e.applyData(n,t),{type:"text",value:`
`}]}function JO(e,n){const t=n.value?n.value+`
`:"",r={};n.lang&&(r.className=["language-"+n.lang]);let a={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return n.meta&&(a.data={meta:n.meta}),e.patch(n,a),a=e.applyData(n,a),a={type:"element",tagName:"pre",properties:{},children:[a]},e.patch(n,a),a}function KO(e,n){const t={type:"element",tagName:"del",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function XO(e,n){const t={type:"element",tagName:"em",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function ZO(e,n){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(n.identifier).toUpperCase(),a=up(r.toLowerCase()),o=e.footnoteOrder.indexOf(r);let l,h=e.footnoteCounts.get(r);h===void 0?(h=0,e.footnoteOrder.push(r),l=e.footnoteOrder.length):l=o+1,h+=1,e.footnoteCounts.set(r,h);const d={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+a,id:t+"fnref-"+a+(h>1?"-"+h:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};e.patch(n,d);const u={type:"element",tagName:"sup",properties:{},children:[d]};return e.patch(n,u),e.applyData(n,u)}function eL(e,n){const t={type:"element",tagName:"h"+n.depth,properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function tL(e,n){if(e.options.allowDangerousHtml){const t={type:"raw",value:n.value};return e.patch(n,t),e.applyData(n,t)}}function P2(e,n){const t=n.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return[{type:"text",value:"!["+n.alt+r}];const a=e.all(n),o=a[0];o&&o.type==="text"?o.value="["+o.value:a.unshift({type:"text",value:"["});const l=a[a.length-1];return l&&l.type==="text"?l.value+=r:a.push({type:"text",value:r}),a}function nL(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return P2(e,n);const a={src:up(r.url||""),alt:n.alt};r.title!==null&&r.title!==void 0&&(a.title=r.title);const o={type:"element",tagName:"img",properties:a,children:[]};return e.patch(n,o),e.applyData(n,o)}function iL(e,n){const t={src:up(n.url)};n.alt!==null&&n.alt!==void 0&&(t.alt=n.alt),n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"img",properties:t,children:[]};return e.patch(n,r),e.applyData(n,r)}function rL(e,n){const t={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};e.patch(n,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return e.patch(n,r),e.applyData(n,r)}function aL(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return P2(e,n);const a={href:up(r.url||"")};r.title!==null&&r.title!==void 0&&(a.title=r.title);const o={type:"element",tagName:"a",properties:a,children:e.all(n)};return e.patch(n,o),e.applyData(n,o)}function sL(e,n){const t={href:up(n.url)};n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"a",properties:t,children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function oL(e,n,t){const r=e.all(n),a=t?lL(t):I2(n),o={},l=[];if(typeof n.checked=="boolean"){const f=r[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},r.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let h=-1;for(;++h<r.length;){const f=r[h];(a||h!==0||f.type!=="element"||f.tagName!=="p")&&l.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!a?l.push(...f.children):l.push(f)}const d=r[r.length-1];d&&(a||d.type!=="element"||d.tagName!=="p")&&l.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:o,children:l};return e.patch(n,u),e.applyData(n,u)}function lL(e){let n=!1;if(e.type==="list"){n=e.spread||!1;const t=e.children;let r=-1;for(;!n&&++r<t.length;)n=I2(t[r])}return n}function I2(e){const n=e.spread;return n??e.children.length>1}function cL(e,n){const t={},r=e.all(n);let a=-1;for(typeof n.start=="number"&&n.start!==1&&(t.start=n.start);++a<r.length;){const l=r[a];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const o={type:"element",tagName:n.ordered?"ol":"ul",properties:t,children:e.wrap(r,!0)};return e.patch(n,o),e.applyData(n,o)}function uL(e,n){const t={type:"element",tagName:"p",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function dL(e,n){const t={type:"root",children:e.wrap(e.all(n))};return e.patch(n,t),e.applyData(n,t)}function hL(e,n){const t={type:"element",tagName:"strong",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function fL(e,n){const t=e.all(n),r=t.shift(),a=[];if(r){const l={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(n.children[0],l),a.push(l)}if(t.length>0){const l={type:"element",tagName:"tbody",properties:{},children:e.wrap(t,!0)},h=ww(n.children[1]),d=h2(n.children[n.children.length-1]);h&&d&&(l.position={start:h,end:d}),a.push(l)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(a,!0)};return e.patch(n,o),e.applyData(n,o)}function pL(e,n,t){const r=t?t.children:void 0,o=(r?r.indexOf(n):1)===0?"th":"td",l=t&&t.type==="table"?t.align:void 0,h=l?l.length:n.children.length;let d=-1;const u=[];for(;++d<h;){const g=n.children[d],b={},v=l?l[d]:void 0;v&&(b.align=v);let S={type:"element",tagName:o,properties:b,children:[]};g&&(S.children=e.all(g),e.patch(g,S),S=e.applyData(g,S)),u.push(S)}const f={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(n,f),e.applyData(n,f)}function mL(e,n){const t={type:"element",tagName:"td",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}const sS=9,oS=32;function gL(e){const n=String(e),t=/\r?\n|\r/g;let r=t.exec(n),a=0;const o=[];for(;r;)o.push(lS(n.slice(a,r.index),a>0,!0),r[0]),a=r.index+r[0].length,r=t.exec(n);return o.push(lS(n.slice(a),a>0,!1)),o.join("")}function lS(e,n,t){let r=0,a=e.length;if(n){let o=e.codePointAt(r);for(;o===sS||o===oS;)r++,o=e.codePointAt(r)}if(t){let o=e.codePointAt(a-1);for(;o===sS||o===oS;)a--,o=e.codePointAt(a-1)}return a>r?e.slice(r,a):""}function yL(e,n){const t={type:"text",value:gL(String(n.value))};return e.patch(n,t),e.applyData(n,t)}function xL(e,n){const t={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(n,t),e.applyData(n,t)}const bL={blockquote:WO,break:QO,code:JO,delete:KO,emphasis:XO,footnoteReference:ZO,heading:eL,html:tL,imageReference:nL,image:iL,inlineCode:rL,linkReference:aL,link:sL,listItem:oL,list:cL,paragraph:uL,root:dL,strong:hL,table:fL,tableCell:mL,tableRow:pL,text:yL,thematicBreak:xL,toml:Sx,yaml:Sx,definition:Sx,footnoteDefinition:Sx};function Sx(){}const M2=-1,Lb=0,eg=1,cb=2,Tw=3,Ew=4,Aw=5,Dw=6,R2=7,O2=8,cS=typeof self=="object"?self:globalThis,vL=(e,n)=>{const t=(a,o)=>(e.set(o,a),a),r=a=>{if(e.has(a))return e.get(a);const[o,l]=n[a];switch(o){case Lb:case M2:return t(l,a);case eg:{const h=t([],a);for(const d of l)h.push(r(d));return h}case cb:{const h=t({},a);for(const[d,u]of l)h[r(d)]=r(u);return h}case Tw:return t(new Date(l),a);case Ew:{const{source:h,flags:d}=l;return t(new RegExp(h,d),a)}case Aw:{const h=t(new Map,a);for(const[d,u]of l)h.set(r(d),r(u));return h}case Dw:{const h=t(new Set,a);for(const d of l)h.add(r(d));return h}case R2:{const{name:h,message:d}=l;return t(new cS[h](d),a)}case O2:return t(BigInt(l),a);case"BigInt":return t(Object(BigInt(l)),a);case"ArrayBuffer":return t(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:h}=new Uint8Array(l);return t(new DataView(h),l)}}return t(new cS[o](l),a)};return r},uS=e=>vL(new Map,e)(0),Df="",{toString:wL}={},{keys:NL}=Object,Bm=e=>{const n=typeof e;if(n!=="object"||!e)return[Lb,n];const t=wL.call(e).slice(8,-1);switch(t){case"Array":return[eg,Df];case"Object":return[cb,Df];case"Date":return[Tw,Df];case"RegExp":return[Ew,Df];case"Map":return[Aw,Df];case"Set":return[Dw,Df];case"DataView":return[eg,t]}return t.includes("Array")?[eg,t]:t.includes("Error")?[R2,t]:[cb,t]},jx=([e,n])=>e===Lb&&(n==="function"||n==="symbol"),SL=(e,n,t,r)=>{const a=(l,h)=>{const d=r.push(l)-1;return t.set(h,d),d},o=l=>{if(t.has(l))return t.get(l);let[h,d]=Bm(l);switch(h){case Lb:{let f=l;switch(d){case"bigint":h=O2,f=l.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+d);f=null;break;case"undefined":return a([M2],l)}return a([h,f],l)}case eg:{if(d){let b=l;return d==="DataView"?b=new Uint8Array(l.buffer):d==="ArrayBuffer"&&(b=new Uint8Array(l)),a([d,[...b]],l)}const f=[],g=a([h,f],l);for(const b of l)f.push(o(b));return g}case cb:{if(d)switch(d){case"BigInt":return a([d,l.toString()],l);case"Boolean":case"Number":case"String":return a([d,l.valueOf()],l)}if(n&&"toJSON"in l)return o(l.toJSON());const f=[],g=a([h,f],l);for(const b of NL(l))(e||!jx(Bm(l[b])))&&f.push([o(b),o(l[b])]);return g}case Tw:return a([h,l.toISOString()],l);case Ew:{const{source:f,flags:g}=l;return a([h,{source:f,flags:g}],l)}case Aw:{const f=[],g=a([h,f],l);for(const[b,v]of l)(e||!(jx(Bm(b))||jx(Bm(v))))&&f.push([o(b),o(v)]);return g}case Dw:{const f=[],g=a([h,f],l);for(const b of l)(e||!jx(Bm(b)))&&f.push(o(b));return g}}const{message:u}=l;return a([h,{name:d,message:u}],l)};return o},dS=(e,{json:n,lossy:t}={})=>{const r=[];return SL(!(n||t),!!n,new Map,r)(e),r},ub=typeof structuredClone=="function"?(e,n)=>n&&("json"in n||"lossy"in n)?uS(dS(e,n)):structuredClone(e):(e,n)=>uS(dS(e,n));function jL(e,n){const t=[{type:"text",value:""}];return n>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(n)}]}),t}function _L(e,n){return"Back to reference "+(e+1)+(n>1?"-"+n:"")}function CL(e){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",t=e.options.footnoteBackContent||jL,r=e.options.footnoteBackLabel||_L,a=e.options.footnoteLabel||"Footnotes",o=e.options.footnoteLabelTagName||"h2",l=e.options.footnoteLabelProperties||{className:["sr-only"]},h=[];let d=-1;for(;++d<e.footnoteOrder.length;){const u=e.footnoteById.get(e.footnoteOrder[d]);if(!u)continue;const f=e.all(u),g=String(u.identifier).toUpperCase(),b=up(g.toLowerCase());let v=0;const S=[],T=e.footnoteCounts.get(g);for(;T!==void 0&&++v<=T;){S.length>0&&S.push({type:"text",value:" "});let P=typeof t=="string"?t:t(d,v);typeof P=="string"&&(P={type:"text",value:P}),S.push({type:"element",tagName:"a",properties:{href:"#"+n+"fnref-"+b+(v>1?"-"+v:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(d,v),className:["data-footnote-backref"]},children:Array.isArray(P)?P:[P]})}const E=f[f.length-1];if(E&&E.type==="element"&&E.tagName==="p"){const P=E.children[E.children.length-1];P&&P.type==="text"?P.value+=" ":E.children.push({type:"text",value:" "}),E.children.push(...S)}else f.push(...S);const C={type:"element",tagName:"li",properties:{id:n+"fn-"+b},children:e.wrap(f,!0)};e.patch(u,C),h.push(C)}if(h.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...ub(l),id:"footnote-label"},children:[{type:"text",value:a}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(h,!0)},{type:"text",value:`
`}]}}const Fb=function(e){if(e==null)return AL;if(typeof e=="function")return $b(e);if(typeof e=="object")return Array.isArray(e)?kL(e):TL(e);if(typeof e=="string")return EL(e);throw new Error("Expected function, string, or object as test")};function kL(e){const n=[];let t=-1;for(;++t<e.length;)n[t]=Fb(e[t]);return $b(r);function r(...a){let o=-1;for(;++o<n.length;)if(n[o].apply(this,a))return!0;return!1}}function TL(e){const n=e;return $b(t);function t(r){const a=r;let o;for(o in e)if(a[o]!==n[o])return!1;return!0}}function EL(e){return $b(n);function n(t){return t&&t.type===e}}function $b(e){return n;function n(t,r,a){return!!(DL(t)&&e.call(this,t,typeof r=="number"?r:void 0,a||void 0))}}function AL(){return!0}function DL(e){return e!==null&&typeof e=="object"&&"type"in e}const L2=[],PL=!0,f1=!1,IL="skip";function F2(e,n,t,r){let a;typeof n=="function"&&typeof t!="function"?(r=t,t=n):a=n;const o=Fb(a),l=r?-1:1;h(e,void 0,[])();function h(d,u,f){const g=d&&typeof d=="object"?d:{};if(typeof g.type=="string"){const v=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(b,"name",{value:"node ("+(d.type+(v?"<"+v+">":""))+")"})}return b;function b(){let v=L2,S,T,E;if((!n||o(d,u,f[f.length-1]||void 0))&&(v=ML(t(d,f)),v[0]===f1))return v;if("children"in d&&d.children){const C=d;if(C.children&&v[0]!==IL)for(T=(r?C.children.length:-1)+l,E=f.concat(C);T>-1&&T<C.children.length;){const P=C.children[T];if(S=h(P,T,E)(),S[0]===f1)return S;T=typeof S[1]=="number"?S[1]:T+l}}return v}}}function ML(e){return Array.isArray(e)?e:typeof e=="number"?[PL,e]:e==null?L2:[e]}function Pw(e,n,t,r){let a,o,l;typeof n=="function"?(o=void 0,l=n,a=t):(o=n,l=t,a=r),F2(e,o,h,a);function h(d,u){const f=u[u.length-1],g=f?f.children.indexOf(d):void 0;return l(d,g,f)}}const p1={}.hasOwnProperty,RL={};function OL(e,n){const t=n||RL,r=new Map,a=new Map,o=new Map,l={...bL,...t.handlers},h={all:u,applyData:FL,definitionById:r,footnoteById:a,footnoteCounts:o,footnoteOrder:[],handlers:l,one:d,options:t,patch:LL,wrap:zL};return Pw(e,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?r:a,b=String(f.identifier).toUpperCase();g.has(b)||g.set(b,f)}}),h;function d(f,g){const b=f.type,v=h.handlers[b];if(p1.call(h.handlers,b)&&v)return v(h,f,g);if(h.options.passThrough&&h.options.passThrough.includes(b)){if("children"in f){const{children:T,...E}=f,C=ub(E);return C.children=h.all(f),C}return ub(f)}return(h.options.unknownHandler||$L)(h,f,g)}function u(f){const g=[];if("children"in f){const b=f.children;let v=-1;for(;++v<b.length;){const S=h.one(b[v],f);if(S){if(v&&b[v-1].type==="break"&&(!Array.isArray(S)&&S.type==="text"&&(S.value=hS(S.value)),!Array.isArray(S)&&S.type==="element")){const T=S.children[0];T&&T.type==="text"&&(T.value=hS(T.value))}Array.isArray(S)?g.push(...S):g.push(S)}}}return g}}function LL(e,n){e.position&&(n.position=_R(e))}function FL(e,n){let t=n;if(e&&e.data){const r=e.data.hName,a=e.data.hChildren,o=e.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const l="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:l}}t.type==="element"&&o&&Object.assign(t.properties,ub(o)),"children"in t&&t.children&&a!==null&&a!==void 0&&(t.children=a)}return t}function $L(e,n){const t=n.data||{},r="value"in n&&!(p1.call(t,"hProperties")||p1.call(t,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function zL(e,n){const t=[];let r=-1;for(n&&t.push({type:"text",value:`
`});++r<e.length;)r&&t.push({type:"text",value:`
`}),t.push(e[r]);return n&&e.length>0&&t.push({type:"text",value:`
`}),t}function hS(e){let n=0,t=e.charCodeAt(n);for(;t===9||t===32;)n++,t=e.charCodeAt(n);return e.slice(n)}function fS(e,n){const t=OL(e,n),r=t.one(e,void 0),a=CL(t),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return a&&o.children.push({type:"text",value:`
`},a),o}function BL(e,n){return e&&"run"in e?async function(t,r){const a=fS(t,{file:r,...n});await e.run(a,r)}:function(t,r){return fS(t,{file:r,...e||n})}}function pS(e){if(e)throw e}var o0,mS;function UL(){if(mS)return o0;mS=1;var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=function(u){return typeof Array.isArray=="function"?Array.isArray(u):n.call(u)==="[object Array]"},o=function(u){if(!u||n.call(u)!=="[object Object]")return!1;var f=e.call(u,"constructor"),g=u.constructor&&u.constructor.prototype&&e.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!f&&!g)return!1;var b;for(b in u);return typeof b>"u"||e.call(u,b)},l=function(u,f){t&&f.name==="__proto__"?t(u,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):u[f.name]=f.newValue},h=function(u,f){if(f==="__proto__")if(e.call(u,f)){if(r)return r(u,f).value}else return;return u[f]};return o0=function d(){var u,f,g,b,v,S,T=arguments[0],E=1,C=arguments.length,P=!1;for(typeof T=="boolean"&&(P=T,T=arguments[1]||{},E=2),(T==null||typeof T!="object"&&typeof T!="function")&&(T={});E<C;++E)if(u=arguments[E],u!=null)for(f in u)g=h(T,f),b=h(u,f),T!==b&&(P&&b&&(o(b)||(v=a(b)))?(v?(v=!1,S=g&&a(g)?g:[]):S=g&&o(g)?g:{},l(T,{name:f,newValue:d(P,S,b)})):typeof b<"u"&&l(T,{name:f,newValue:b}));return T},o0}var qL=UL();const l0=ah(qL);function m1(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function VL(){const e=[],n={run:t,use:r};return n;function t(...a){let o=-1;const l=a.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);h(null,...a);function h(d,...u){const f=e[++o];let g=-1;if(d){l(d);return}for(;++g<a.length;)(u[g]===null||u[g]===void 0)&&(u[g]=a[g]);a=u,f?HL(f,h)(...u):l(null,...u)}}function r(a){if(typeof a!="function")throw new TypeError("Expected `middelware` to be a function, not "+a);return e.push(a),n}}function HL(e,n){let t;return r;function r(...l){const h=e.length>l.length;let d;h&&l.push(a);try{d=e.apply(this,l)}catch(u){const f=u;if(h&&t)throw f;return a(f)}h||(d&&d.then&&typeof d.then=="function"?d.then(o,a):d instanceof Error?a(d):o(d))}function a(l,...h){t||(t=!0,n(l,...h))}function o(l){a(null,l)}}const _l={basename:GL,dirname:YL,extname:WL,join:QL,sep:"/"};function GL(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');wg(e);let t=0,r=-1,a=e.length,o;if(n===void 0||n.length===0||n.length>e.length){for(;a--;)if(e.codePointAt(a)===47){if(o){t=a+1;break}}else r<0&&(o=!0,r=a+1);return r<0?"":e.slice(t,r)}if(n===e)return"";let l=-1,h=n.length-1;for(;a--;)if(e.codePointAt(a)===47){if(o){t=a+1;break}}else l<0&&(o=!0,l=a+1),h>-1&&(e.codePointAt(a)===n.codePointAt(h--)?h<0&&(r=a):(h=-1,r=l));return t===r?r=l:r<0&&(r=e.length),e.slice(t,r)}function YL(e){if(wg(e),e.length===0)return".";let n=-1,t=e.length,r;for(;--t;)if(e.codePointAt(t)===47){if(r){n=t;break}}else r||(r=!0);return n<0?e.codePointAt(0)===47?"/":".":n===1&&e.codePointAt(0)===47?"//":e.slice(0,n)}function WL(e){wg(e);let n=e.length,t=-1,r=0,a=-1,o=0,l;for(;n--;){const h=e.codePointAt(n);if(h===47){if(l){r=n+1;break}continue}t<0&&(l=!0,t=n+1),h===46?a<0?a=n:o!==1&&(o=1):a>-1&&(o=-1)}return a<0||t<0||o===0||o===1&&a===t-1&&a===r+1?"":e.slice(a,t)}function QL(...e){let n=-1,t;for(;++n<e.length;)wg(e[n]),e[n]&&(t=t===void 0?e[n]:t+"/"+e[n]);return t===void 0?".":JL(t)}function JL(e){wg(e);const n=e.codePointAt(0)===47;let t=KL(e,!n);return t.length===0&&!n&&(t="."),t.length>0&&e.codePointAt(e.length-1)===47&&(t+="/"),n?"/"+t:t}function KL(e,n){let t="",r=0,a=-1,o=0,l=-1,h,d;for(;++l<=e.length;){if(l<e.length)h=e.codePointAt(l);else{if(h===47)break;h=47}if(h===47){if(!(a===l-1||o===1))if(a!==l-1&&o===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(d=t.lastIndexOf("/"),d!==t.length-1){d<0?(t="",r=0):(t=t.slice(0,d),r=t.length-1-t.lastIndexOf("/")),a=l,o=0;continue}}else if(t.length>0){t="",r=0,a=l,o=0;continue}}n&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+e.slice(a+1,l):t=e.slice(a+1,l),r=l-a-1;a=l,o=0}else h===46&&o>-1?o++:o=-1}return t}function wg(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const XL={cwd:ZL};function ZL(){return"/"}function g1(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function e3(e){if(typeof e=="string")e=new URL(e);else if(!g1(e)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(e.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return t3(e)}function t3(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const n=e.pathname;let t=-1;for(;++t<n.length;)if(n.codePointAt(t)===37&&n.codePointAt(t+1)===50){const r=n.codePointAt(t+2);if(r===70||r===102){const a=new TypeError("File URL path must not include encoded / characters");throw a.code="ERR_INVALID_FILE_URL_PATH",a}}return decodeURIComponent(n)}const c0=["history","path","basename","stem","extname","dirname"];let $2=class{constructor(n){let t;n?g1(n)?t={path:n}:typeof n=="string"||n3(n)?t={value:n}:t=n:t={},this.cwd="cwd"in t?"":XL.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<c0.length;){const o=c0[r];o in t&&t[o]!==void 0&&t[o]!==null&&(this[o]=o==="history"?[...t[o]]:t[o])}let a;for(a in t)c0.includes(a)||(this[a]=t[a])}get basename(){return typeof this.path=="string"?_l.basename(this.path):void 0}set basename(n){d0(n,"basename"),u0(n,"basename"),this.path=_l.join(this.dirname||"",n)}get dirname(){return typeof this.path=="string"?_l.dirname(this.path):void 0}set dirname(n){gS(this.basename,"dirname"),this.path=_l.join(n||"",this.basename)}get extname(){return typeof this.path=="string"?_l.extname(this.path):void 0}set extname(n){if(u0(n,"extname"),gS(this.dirname,"extname"),n){if(n.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=_l.join(this.dirname,this.stem+(n||""))}get path(){return this.history[this.history.length-1]}set path(n){g1(n)&&(n=e3(n)),d0(n,"path"),this.path!==n&&this.history.push(n)}get stem(){return typeof this.path=="string"?_l.basename(this.path,this.extname):void 0}set stem(n){d0(n,"stem"),u0(n,"stem"),this.path=_l.join(this.dirname||"",n+(this.extname||""))}fail(n,t,r){const a=this.message(n,t,r);throw a.fatal=!0,a}info(n,t,r){const a=this.message(n,t,r);return a.fatal=void 0,a}message(n,t,r){const a=new ra(n,t,r);return this.path&&(a.name=this.path+":"+a.name,a.file=this.path),a.fatal=!1,this.messages.push(a),a}toString(n){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(n||void 0).decode(this.value)}};function u0(e,n){if(e&&e.includes(_l.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+_l.sep+"`")}function d0(e,n){if(!e)throw new Error("`"+n+"` cannot be empty")}function gS(e,n){if(!e)throw new Error("Setting `"+n+"` requires `path` to be set too")}function n3(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const i3=function(e){const r=this.constructor.prototype,a=r[e],o=function(){return a.apply(o,arguments)};return Object.setPrototypeOf(o,r),o},r3={}.hasOwnProperty;let a3=class z2 extends i3{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=VL()}copy(){const n=new z2;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];n.use(...r)}return n.data(l0(!0,{},this.namespace)),n}data(n,t){return typeof n=="string"?arguments.length===2?(p0("data",this.frozen),this.namespace[n]=t,this):r3.call(this.namespace,n)&&this.namespace[n]||void 0:n?(p0("data",this.frozen),this.namespace=n,this):this.namespace}freeze(){if(this.frozen)return this;const n=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const a=t.call(n,...r);typeof a=="function"&&this.transformers.use(a)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(n){this.freeze();const t=_x(n),r=this.parser||this.Parser;return h0("parse",r),r(String(t),t)}process(n,t){const r=this;return this.freeze(),h0("process",this.parser||this.Parser),f0("process",this.compiler||this.Compiler),t?a(void 0,t):new Promise(a);function a(o,l){const h=_x(n),d=r.parse(h);r.run(d,h,function(f,g,b){if(f||!g||!b)return u(f);const v=g,S=r.stringify(v,b);l3(S)?b.value=S:b.result=S,u(f,b)});function u(f,g){f||!g?l(f):o?o(g):t(void 0,g)}}}processSync(n){let t=!1,r;return this.freeze(),h0("processSync",this.parser||this.Parser),f0("processSync",this.compiler||this.Compiler),this.process(n,a),xS("processSync","process",t),r;function a(o,l){t=!0,pS(o),r=l}}run(n,t,r){yS(n),this.freeze();const a=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?o(void 0,r):new Promise(o);function o(l,h){const d=_x(t);a.run(n,d,u);function u(f,g,b){const v=g||n;f?h(f):l?l(v):r(void 0,v,b)}}}runSync(n,t){let r=!1,a;return this.run(n,t,o),xS("runSync","run",r),a;function o(l,h){pS(l),a=h,r=!0}}stringify(n,t){this.freeze();const r=_x(t),a=this.compiler||this.Compiler;return f0("stringify",a),yS(n),a(n,r)}use(n,...t){const r=this.attachers,a=this.namespace;if(p0("use",this.frozen),n!=null)if(typeof n=="function")d(n,t);else if(typeof n=="object")Array.isArray(n)?h(n):l(n);else throw new TypeError("Expected usable value, not `"+n+"`");return this;function o(u){if(typeof u=="function")d(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[f,...g]=u;d(f,g)}else l(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function l(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");h(u.plugins),u.settings&&(a.settings=l0(!0,a.settings,u.settings))}function h(u){let f=-1;if(u!=null)if(Array.isArray(u))for(;++f<u.length;){const g=u[f];o(g)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function d(u,f){let g=-1,b=-1;for(;++g<r.length;)if(r[g][0]===u){b=g;break}if(b===-1)r.push([u,...f]);else if(f.length>0){let[v,...S]=f;const T=r[b][1];m1(T)&&m1(v)&&(v=l0(!0,T,v)),r[b]=[u,v,...S]}}}};const s3=new a3().freeze();function h0(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function f0(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function p0(e,n){if(n)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function yS(e){if(!m1(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function xS(e,n,t){if(!t)throw new Error("`"+e+"` finished async. Use `"+n+"` instead")}function _x(e){return o3(e)?e:new $2(e)}function o3(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function l3(e){return typeof e=="string"||c3(e)}function c3(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const u3="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",bS=[],vS={allowDangerousHtml:!0},d3=/^(https?|ircs?|mailto|xmpp)$/i,h3=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function Bs(e){const n=f3(e),t=p3(e);return m3(n.runSync(n.parse(t),t),e)}function f3(e){const n=e.rehypePlugins||bS,t=e.remarkPlugins||bS,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...vS}:vS;return s3().use(YO).use(t).use(BL,r).use(n)}function p3(e){const n=e.children||"",t=new $2;return typeof n=="string"&&(t.value=n),t}function m3(e,n){const t=n.allowedElements,r=n.allowElement,a=n.components,o=n.disallowedElements,l=n.skipHtml,h=n.unwrapDisallowed,d=n.urlTransform||g3;for(const f of h3)Object.hasOwn(n,f.from)&&(""+f.from+(f.to?"use `"+f.to+"` instead":"remove it")+u3+f.id,void 0);return Pw(e,u),AR(e,{Fragment:i.Fragment,components:a,ignoreInvalidStyle:!0,jsx:i.jsx,jsxs:i.jsxs,passKeys:!0,passNode:!0});function u(f,g,b){if(f.type==="raw"&&b&&typeof g=="number")return l?b.children.splice(g,1):b.children[g]={type:"text",value:f.value},g;if(f.type==="element"){let v;for(v in r0)if(Object.hasOwn(r0,v)&&Object.hasOwn(f.properties,v)){const S=f.properties[v],T=r0[v];(T===null||T.includes(f.tagName))&&(f.properties[v]=d(String(S||""),v,f))}}if(f.type==="element"){let v=t?!t.includes(f.tagName):o?o.includes(f.tagName):!1;if(!v&&r&&typeof g=="number"&&(v=!r(f,g,b)),v&&b&&typeof g=="number")return h&&f.children?b.children.splice(g,1,...f.children):b.children.splice(g,1),g}}}function g3(e){const n=e.indexOf(":"),t=e.indexOf("?"),r=e.indexOf("#"),a=e.indexOf("/");return n===-1||a!==-1&&n>a||t!==-1&&n>t||r!==-1&&n>r||d3.test(e.slice(0,n))?e:""}function wS(e,n){const t=String(e);if(typeof n!="string")throw new TypeError("Expected character");let r=0,a=t.indexOf(n);for(;a!==-1;)r++,a=t.indexOf(n,a+n.length);return r}function y3(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function x3(e,n,t){const a=Fb((t||{}).ignore||[]),o=b3(n);let l=-1;for(;++l<o.length;)F2(e,"text",h);function h(u,f){let g=-1,b;for(;++g<f.length;){const v=f[g],S=b?b.children:void 0;if(a(v,S?S.indexOf(v):void 0,b))return;b=v}if(b)return d(u,f)}function d(u,f){const g=f[f.length-1],b=o[l][0],v=o[l][1];let S=0;const E=g.children.indexOf(u);let C=!1,P=[];b.lastIndex=0;let I=b.exec(u.value);for(;I;){const q=I.index,L={index:I.index,input:I.input,stack:[...f,u]};let O=v(...I,L);if(typeof O=="string"&&(O=O.length>0?{type:"text",value:O}:void 0),O===!1?b.lastIndex=q+1:(S!==q&&P.push({type:"text",value:u.value.slice(S,q)}),Array.isArray(O)?P.push(...O):O&&P.push(O),S=q+I[0].length,C=!0),!b.global)break;I=b.exec(u.value)}return C?(S<u.value.length&&P.push({type:"text",value:u.value.slice(S)}),g.children.splice(E,1,...P)):P=[u],E+P.length}}function b3(e){const n=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const t=!e[0]||Array.isArray(e[0])?e:[e];let r=-1;for(;++r<t.length;){const a=t[r];n.push([v3(a[0]),w3(a[1])])}return n}function v3(e){return typeof e=="string"?new RegExp(y3(e),"g"):e}function w3(e){return typeof e=="function"?e:function(){return e}}const m0="phrasing",g0=["autolink","link","image","label"];function N3(){return{transforms:[E3],enter:{literalAutolink:j3,literalAutolinkEmail:y0,literalAutolinkHttp:y0,literalAutolinkWww:y0},exit:{literalAutolink:T3,literalAutolinkEmail:k3,literalAutolinkHttp:_3,literalAutolinkWww:C3}}}function S3(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:m0,notInConstruct:g0},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:m0,notInConstruct:g0},{character:":",before:"[ps]",after:"\\/",inConstruct:m0,notInConstruct:g0}]}}function j3(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function y0(e){this.config.enter.autolinkProtocol.call(this,e)}function _3(e){this.config.exit.autolinkProtocol.call(this,e)}function C3(e){this.config.exit.data.call(this,e);const n=this.stack[this.stack.length-1];n.type,n.url="http://"+this.sliceSerialize(e)}function k3(e){this.config.exit.autolinkEmail.call(this,e)}function T3(e){this.exit(e)}function E3(e){x3(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,A3],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),D3]],{ignore:["link","linkReference"]})}function A3(e,n,t,r,a){let o="";if(!B2(a)||(/^w/i.test(n)&&(t=n+t,n="",o="http://"),!P3(t)))return!1;const l=I3(t+r);if(!l[0])return!1;const h={type:"link",title:null,url:o+n+l[0],children:[{type:"text",value:n+l[0]}]};return l[1]?[h,{type:"text",value:l[1]}]:h}function D3(e,n,t,r){return!B2(r,!0)||/[-\d_]$/.test(t)?!1:{type:"link",title:null,url:"mailto:"+n+"@"+t,children:[{type:"text",value:n+"@"+t}]}}function P3(e){const n=e.split(".");return!(n.length<2||n[n.length-1]&&(/_/.test(n[n.length-1])||!/[a-zA-Z\d]/.test(n[n.length-1]))||n[n.length-2]&&(/_/.test(n[n.length-2])||!/[a-zA-Z\d]/.test(n[n.length-2])))}function I3(e){const n=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!n)return[e,void 0];e=e.slice(0,n.index);let t=n[0],r=t.indexOf(")");const a=wS(e,"(");let o=wS(e,")");for(;r!==-1&&a>o;)e+=t.slice(0,r+1),t=t.slice(r+1),r=t.indexOf(")"),o++;return[e,t]}function B2(e,n){const t=e.input.charCodeAt(e.index-1);return(e.index===0||th(t)||Rb(t))&&(!n||t!==47)}U2.peek=U3;function M3(){this.buffer()}function R3(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function O3(){this.buffer()}function L3(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function F3(e){const n=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Do(this.sliceSerialize(e)).toLowerCase(),t.label=n}function $3(e){this.exit(e)}function z3(e){const n=this.resume(),t=this.stack[this.stack.length-1];t.type,t.identifier=Do(this.sliceSerialize(e)).toLowerCase(),t.label=n}function B3(e){this.exit(e)}function U3(){return"["}function U2(e,n,t,r){const a=t.createTracker(r);let o=a.move("[^");const l=t.enter("footnoteReference"),h=t.enter("reference");return o+=a.move(t.safe(t.associationId(e),{after:"]",before:o})),h(),l(),o+=a.move("]"),o}function q3(){return{enter:{gfmFootnoteCallString:M3,gfmFootnoteCall:R3,gfmFootnoteDefinitionLabelString:O3,gfmFootnoteDefinition:L3},exit:{gfmFootnoteCallString:F3,gfmFootnoteCall:$3,gfmFootnoteDefinitionLabelString:z3,gfmFootnoteDefinition:B3}}}function V3(e){let n=!1;return e&&e.firstLineBlank&&(n=!0),{handlers:{footnoteDefinition:t,footnoteReference:U2},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function t(r,a,o,l){const h=o.createTracker(l);let d=h.move("[^");const u=o.enter("footnoteDefinition"),f=o.enter("label");return d+=h.move(o.safe(o.associationId(r),{before:d,after:"]"})),f(),d+=h.move("]:"),r.children&&r.children.length>0&&(h.shift(4),d+=h.move((n?`
`:" ")+o.indentLines(o.containerFlow(r,h.current()),n?q2:H3))),u(),d}}function H3(e,n,t){return n===0?e:q2(e,n,t)}function q2(e,n,t){return(t?"":"    ")+e}const G3=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];V2.peek=K3;function Y3(){return{canContainEols:["delete"],enter:{strikethrough:Q3},exit:{strikethrough:J3}}}function W3(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:G3}],handlers:{delete:V2}}}function Q3(e){this.enter({type:"delete",children:[]},e)}function J3(e){this.exit(e)}function V2(e,n,t,r){const a=t.createTracker(r),o=t.enter("strikethrough");let l=a.move("~~");return l+=t.containerPhrasing(e,{...a.current(),before:l,after:"~"}),l+=a.move("~~"),o(),l}function K3(){return"~"}function X3(e){return e.length}function Z3(e,n){const t=n||{},r=(t.align||[]).concat(),a=t.stringLength||X3,o=[],l=[],h=[],d=[];let u=0,f=-1;for(;++f<e.length;){const T=[],E=[];let C=-1;for(e[f].length>u&&(u=e[f].length);++C<e[f].length;){const P=eF(e[f][C]);if(t.alignDelimiters!==!1){const I=a(P);E[C]=I,(d[C]===void 0||I>d[C])&&(d[C]=I)}T.push(P)}l[f]=T,h[f]=E}let g=-1;if(typeof r=="object"&&"length"in r)for(;++g<u;)o[g]=NS(r[g]);else{const T=NS(r);for(;++g<u;)o[g]=T}g=-1;const b=[],v=[];for(;++g<u;){const T=o[g];let E="",C="";T===99?(E=":",C=":"):T===108?E=":":T===114&&(C=":");let P=t.alignDelimiters===!1?1:Math.max(1,d[g]-E.length-C.length);const I=E+"-".repeat(P)+C;t.alignDelimiters!==!1&&(P=E.length+P+C.length,P>d[g]&&(d[g]=P),v[g]=P),b[g]=I}l.splice(1,0,b),h.splice(1,0,v),f=-1;const S=[];for(;++f<l.length;){const T=l[f],E=h[f];g=-1;const C=[];for(;++g<u;){const P=T[g]||"";let I="",q="";if(t.alignDelimiters!==!1){const L=d[g]-(E[g]||0),O=o[g];O===114?I=" ".repeat(L):O===99?L%2?(I=" ".repeat(L/2+.5),q=" ".repeat(L/2-.5)):(I=" ".repeat(L/2),q=I):q=" ".repeat(L)}t.delimiterStart!==!1&&!g&&C.push("|"),t.padding!==!1&&!(t.alignDelimiters===!1&&P==="")&&(t.delimiterStart!==!1||g)&&C.push(" "),t.alignDelimiters!==!1&&C.push(I),C.push(P),t.alignDelimiters!==!1&&C.push(q),t.padding!==!1&&C.push(" "),(t.delimiterEnd!==!1||g!==u-1)&&C.push("|")}S.push(t.delimiterEnd===!1?C.join("").replace(/ +$/,""):C.join(""))}return S.join(`
`)}function eF(e){return e==null?"":String(e)}function NS(e){const n=typeof e=="string"?e.codePointAt(0):0;return n===67||n===99?99:n===76||n===108?108:n===82||n===114?114:0}function tF(e,n,t,r){const a=t.enter("blockquote"),o=t.createTracker(r);o.move("> "),o.shift(2);const l=t.indentLines(t.containerFlow(e,o.current()),nF);return a(),l}function nF(e,n,t){return">"+(t?"":" ")+e}function iF(e,n){return SS(e,n.inConstruct,!0)&&!SS(e,n.notInConstruct,!1)}function SS(e,n,t){if(typeof n=="string"&&(n=[n]),!n||n.length===0)return t;let r=-1;for(;++r<n.length;)if(e.includes(n[r]))return!0;return!1}function jS(e,n,t,r){let a=-1;for(;++a<t.unsafe.length;)if(t.unsafe[a].character===`
`&&iF(t.stack,t.unsafe[a]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function rF(e,n){const t=String(e);let r=t.indexOf(n),a=r,o=0,l=0;if(typeof n!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===a?++o>l&&(l=o):o=1,a=r+n.length,r=t.indexOf(n,a);return l}function aF(e,n){return!!(n.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function sF(e){const n=e.options.fence||"`";if(n!=="`"&&n!=="~")throw new Error("Cannot serialize code with `"+n+"` for `options.fence`, expected `` ` `` or `~`");return n}function oF(e,n,t,r){const a=sF(t),o=e.value||"",l=a==="`"?"GraveAccent":"Tilde";if(aF(e,t)){const g=t.enter("codeIndented"),b=t.indentLines(o,lF);return g(),b}const h=t.createTracker(r),d=a.repeat(Math.max(rF(o,a)+1,3)),u=t.enter("codeFenced");let f=h.move(d);if(e.lang){const g=t.enter(`codeFencedLang${l}`);f+=h.move(t.safe(e.lang,{before:f,after:" ",encode:["`"],...h.current()})),g()}if(e.lang&&e.meta){const g=t.enter(`codeFencedMeta${l}`);f+=h.move(" "),f+=h.move(t.safe(e.meta,{before:f,after:`
`,encode:["`"],...h.current()})),g()}return f+=h.move(`
`),o&&(f+=h.move(o+`
`)),f+=h.move(d),u(),f}function lF(e,n,t){return(t?"":"    ")+e}function Iw(e){const n=e.options.quote||'"';if(n!=='"'&&n!=="'")throw new Error("Cannot serialize title with `"+n+"` for `options.quote`, expected `\"`, or `'`");return n}function cF(e,n,t,r){const a=Iw(t),o=a==='"'?"Quote":"Apostrophe",l=t.enter("definition");let h=t.enter("label");const d=t.createTracker(r);let u=d.move("[");return u+=d.move(t.safe(t.associationId(e),{before:u,after:"]",...d.current()})),u+=d.move("]: "),h(),!e.url||/[\0- \u007F]/.test(e.url)?(h=t.enter("destinationLiteral"),u+=d.move("<"),u+=d.move(t.safe(e.url,{before:u,after:">",...d.current()})),u+=d.move(">")):(h=t.enter("destinationRaw"),u+=d.move(t.safe(e.url,{before:u,after:e.title?" ":`
`,...d.current()}))),h(),e.title&&(h=t.enter(`title${o}`),u+=d.move(" "+a),u+=d.move(t.safe(e.title,{before:u,after:a,...d.current()})),u+=d.move(a),h()),l(),u}function uF(e){const n=e.options.emphasis||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize emphasis with `"+n+"` for `options.emphasis`, expected `*`, or `_`");return n}function cg(e){return"&#x"+e.toString(16).toUpperCase()+";"}function db(e,n,t){const r=ep(e),a=ep(n);return r===void 0?a===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}H2.peek=dF;function H2(e,n,t,r){const a=uF(t),o=t.enter("emphasis"),l=t.createTracker(r),h=l.move(a);let d=l.move(t.containerPhrasing(e,{after:a,before:h,...l.current()}));const u=d.charCodeAt(0),f=db(r.before.charCodeAt(r.before.length-1),u,a);f.inside&&(d=cg(u)+d.slice(1));const g=d.charCodeAt(d.length-1),b=db(r.after.charCodeAt(0),g,a);b.inside&&(d=d.slice(0,-1)+cg(g));const v=l.move(a);return o(),t.attentionEncodeSurroundingInfo={after:b.outside,before:f.outside},h+d+v}function dF(e,n,t){return t.options.emphasis||"*"}function hF(e,n){let t=!1;return Pw(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,f1}),!!((!e.depth||e.depth<3)&&_w(e)&&(n.options.setext||t))}function fF(e,n,t,r){const a=Math.max(Math.min(6,e.depth||1),1),o=t.createTracker(r);if(hF(e,t)){const f=t.enter("headingSetext"),g=t.enter("phrasing"),b=t.containerPhrasing(e,{...o.current(),before:`
`,after:`
`});return g(),f(),b+`
`+(a===1?"=":"-").repeat(b.length-(Math.max(b.lastIndexOf("\r"),b.lastIndexOf(`
`))+1))}const l="#".repeat(a),h=t.enter("headingAtx"),d=t.enter("phrasing");o.move(l+" ");let u=t.containerPhrasing(e,{before:"# ",after:`
`,...o.current()});return/^[\t ]/.test(u)&&(u=cg(u.charCodeAt(0))+u.slice(1)),u=u?l+" "+u:l,t.options.closeAtx&&(u+=" "+l),d(),h(),u}G2.peek=pF;function G2(e){return e.value||""}function pF(){return"<"}Y2.peek=mF;function Y2(e,n,t,r){const a=Iw(t),o=a==='"'?"Quote":"Apostrophe",l=t.enter("image");let h=t.enter("label");const d=t.createTracker(r);let u=d.move("![");return u+=d.move(t.safe(e.alt,{before:u,after:"]",...d.current()})),u+=d.move("]("),h(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(h=t.enter("destinationLiteral"),u+=d.move("<"),u+=d.move(t.safe(e.url,{before:u,after:">",...d.current()})),u+=d.move(">")):(h=t.enter("destinationRaw"),u+=d.move(t.safe(e.url,{before:u,after:e.title?" ":")",...d.current()}))),h(),e.title&&(h=t.enter(`title${o}`),u+=d.move(" "+a),u+=d.move(t.safe(e.title,{before:u,after:a,...d.current()})),u+=d.move(a),h()),u+=d.move(")"),l(),u}function mF(){return"!"}W2.peek=gF;function W2(e,n,t,r){const a=e.referenceType,o=t.enter("imageReference");let l=t.enter("label");const h=t.createTracker(r);let d=h.move("![");const u=t.safe(e.alt,{before:d,after:"]",...h.current()});d+=h.move(u+"]["),l();const f=t.stack;t.stack=[],l=t.enter("reference");const g=t.safe(t.associationId(e),{before:d,after:"]",...h.current()});return l(),t.stack=f,o(),a==="full"||!u||u!==g?d+=h.move(g+"]"):a==="shortcut"?d=d.slice(0,-1):d+=h.move("]"),d}function gF(){return"!"}Q2.peek=yF;function Q2(e,n,t){let r=e.value||"",a="`",o=-1;for(;new RegExp("(^|[^`])"+a+"([^`]|$)").test(r);)a+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++o<t.unsafe.length;){const l=t.unsafe[o],h=t.compilePattern(l);let d;if(l.atBreak)for(;d=h.exec(r);){let u=d.index;r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(d.index+1)}}return a+r+a}function yF(){return"`"}function J2(e,n){const t=_w(e);return!!(!n.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(t===e.url||"mailto:"+t===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}K2.peek=xF;function K2(e,n,t,r){const a=Iw(t),o=a==='"'?"Quote":"Apostrophe",l=t.createTracker(r);let h,d;if(J2(e,t)){const f=t.stack;t.stack=[],h=t.enter("autolink");let g=l.move("<");return g+=l.move(t.containerPhrasing(e,{before:g,after:">",...l.current()})),g+=l.move(">"),h(),t.stack=f,g}h=t.enter("link"),d=t.enter("label");let u=l.move("[");return u+=l.move(t.containerPhrasing(e,{before:u,after:"](",...l.current()})),u+=l.move("]("),d(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(d=t.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(t.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(d=t.enter("destinationRaw"),u+=l.move(t.safe(e.url,{before:u,after:e.title?" ":")",...l.current()}))),d(),e.title&&(d=t.enter(`title${o}`),u+=l.move(" "+a),u+=l.move(t.safe(e.title,{before:u,after:a,...l.current()})),u+=l.move(a),d()),u+=l.move(")"),h(),u}function xF(e,n,t){return J2(e,t)?"<":"["}X2.peek=bF;function X2(e,n,t,r){const a=e.referenceType,o=t.enter("linkReference");let l=t.enter("label");const h=t.createTracker(r);let d=h.move("[");const u=t.containerPhrasing(e,{before:d,after:"]",...h.current()});d+=h.move(u+"]["),l();const f=t.stack;t.stack=[],l=t.enter("reference");const g=t.safe(t.associationId(e),{before:d,after:"]",...h.current()});return l(),t.stack=f,o(),a==="full"||!u||u!==g?d+=h.move(g+"]"):a==="shortcut"?d=d.slice(0,-1):d+=h.move("]"),d}function bF(){return"["}function Mw(e){const n=e.options.bullet||"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bullet`, expected `*`, `+`, or `-`");return n}function vF(e){const n=Mw(e),t=e.options.bulletOther;if(!t)return n==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===n)throw new Error("Expected `bullet` (`"+n+"`) and `bulletOther` (`"+t+"`) to be different");return t}function wF(e){const n=e.options.bulletOrdered||".";if(n!=="."&&n!==")")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOrdered`, expected `.` or `)`");return n}function Z2(e){const n=e.options.rule||"*";if(n!=="*"&&n!=="-"&&n!=="_")throw new Error("Cannot serialize rules with `"+n+"` for `options.rule`, expected `*`, `-`, or `_`");return n}function NF(e,n,t,r){const a=t.enter("list"),o=t.bulletCurrent;let l=e.ordered?wF(t):Mw(t);const h=e.ordered?l==="."?")":".":vF(t);let d=n&&t.bulletLastUsed?l===t.bulletLastUsed:!1;if(!e.ordered){const f=e.children?e.children[0]:void 0;if((l==="*"||l==="-")&&f&&(!f.children||!f.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(d=!0),Z2(t)===l&&f){let g=-1;for(;++g<e.children.length;){const b=e.children[g];if(b&&b.type==="listItem"&&b.children&&b.children[0]&&b.children[0].type==="thematicBreak"){d=!0;break}}}}d&&(l=h),t.bulletCurrent=l;const u=t.containerFlow(e,r);return t.bulletLastUsed=l,t.bulletCurrent=o,a(),u}function SF(e){const n=e.options.listItemIndent||"one";if(n!=="tab"&&n!=="one"&&n!=="mixed")throw new Error("Cannot serialize items with `"+n+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return n}function jF(e,n,t,r){const a=SF(t);let o=t.bulletCurrent||Mw(t);n&&n.type==="list"&&n.ordered&&(o=(typeof n.start=="number"&&n.start>-1?n.start:1)+(t.options.incrementListMarker===!1?0:n.children.indexOf(e))+o);let l=o.length+1;(a==="tab"||a==="mixed"&&(n&&n.type==="list"&&n.spread||e.spread))&&(l=Math.ceil(l/4)*4);const h=t.createTracker(r);h.move(o+" ".repeat(l-o.length)),h.shift(l);const d=t.enter("listItem"),u=t.indentLines(t.containerFlow(e,h.current()),f);return d(),u;function f(g,b,v){return b?(v?"":" ".repeat(l))+g:(v?o:o+" ".repeat(l-o.length))+g}}function _F(e,n,t,r){const a=t.enter("paragraph"),o=t.enter("phrasing"),l=t.containerPhrasing(e,r);return o(),a(),l}const CF=Fb(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function kF(e,n,t,r){return(e.children.some(function(l){return CF(l)})?t.containerPhrasing:t.containerFlow).call(t,e,r)}function TF(e){const n=e.options.strong||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize strong with `"+n+"` for `options.strong`, expected `*`, or `_`");return n}ek.peek=EF;function ek(e,n,t,r){const a=TF(t),o=t.enter("strong"),l=t.createTracker(r),h=l.move(a+a);let d=l.move(t.containerPhrasing(e,{after:a,before:h,...l.current()}));const u=d.charCodeAt(0),f=db(r.before.charCodeAt(r.before.length-1),u,a);f.inside&&(d=cg(u)+d.slice(1));const g=d.charCodeAt(d.length-1),b=db(r.after.charCodeAt(0),g,a);b.inside&&(d=d.slice(0,-1)+cg(g));const v=l.move(a+a);return o(),t.attentionEncodeSurroundingInfo={after:b.outside,before:f.outside},h+d+v}function EF(e,n,t){return t.options.strong||"*"}function AF(e,n,t,r){return t.safe(e.value,r)}function DF(e){const n=e.options.ruleRepetition||3;if(n<3)throw new Error("Cannot serialize rules with repetition `"+n+"` for `options.ruleRepetition`, expected `3` or more");return n}function PF(e,n,t){const r=(Z2(t)+(t.options.ruleSpaces?" ":"")).repeat(DF(t));return t.options.ruleSpaces?r.slice(0,-1):r}const tk={blockquote:tF,break:jS,code:oF,definition:cF,emphasis:H2,hardBreak:jS,heading:fF,html:G2,image:Y2,imageReference:W2,inlineCode:Q2,link:K2,linkReference:X2,list:NF,listItem:jF,paragraph:_F,root:kF,strong:ek,text:AF,thematicBreak:PF};function IF(){return{enter:{table:MF,tableData:_S,tableHeader:_S,tableRow:OF},exit:{codeText:LF,table:RF,tableData:x0,tableHeader:x0,tableRow:x0}}}function MF(e){const n=e._align;this.enter({type:"table",align:n.map(function(t){return t==="none"?null:t}),children:[]},e),this.data.inTable=!0}function RF(e){this.exit(e),this.data.inTable=void 0}function OF(e){this.enter({type:"tableRow",children:[]},e)}function x0(e){this.exit(e)}function _S(e){this.enter({type:"tableCell",children:[]},e)}function LF(e){let n=this.resume();this.data.inTable&&(n=n.replace(/\\([\\|])/g,FF));const t=this.stack[this.stack.length-1];t.type,t.value=n,this.exit(e)}function FF(e,n){return n==="|"?n:e}function $F(e){const n=e||{},t=n.tableCellPadding,r=n.tablePipeAlign,a=n.stringLength,o=t?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:b,table:l,tableCell:d,tableRow:h}};function l(v,S,T,E){return u(f(v,T,E),v.align)}function h(v,S,T,E){const C=g(v,T,E),P=u([C]);return P.slice(0,P.indexOf(`
`))}function d(v,S,T,E){const C=T.enter("tableCell"),P=T.enter("phrasing"),I=T.containerPhrasing(v,{...E,before:o,after:o});return P(),C(),I}function u(v,S){return Z3(v,{align:S,alignDelimiters:r,padding:t,stringLength:a})}function f(v,S,T){const E=v.children;let C=-1;const P=[],I=S.enter("table");for(;++C<E.length;)P[C]=g(E[C],S,T);return I(),P}function g(v,S,T){const E=v.children;let C=-1;const P=[],I=S.enter("tableRow");for(;++C<E.length;)P[C]=d(E[C],v,S,T);return I(),P}function b(v,S,T){let E=tk.inlineCode(v,S,T);return T.stack.includes("tableCell")&&(E=E.replace(/\|/g,"\\$&")),E}}function zF(){return{exit:{taskListCheckValueChecked:CS,taskListCheckValueUnchecked:CS,paragraph:UF}}}function BF(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:qF}}}function CS(e){const n=this.stack[this.stack.length-2];n.type,n.checked=e.type==="taskListCheckValueChecked"}function UF(e){const n=this.stack[this.stack.length-2];if(n&&n.type==="listItem"&&typeof n.checked=="boolean"){const t=this.stack[this.stack.length-1];t.type;const r=t.children[0];if(r&&r.type==="text"){const a=n.children;let o=-1,l;for(;++o<a.length;){const h=a[o];if(h.type==="paragraph"){l=h;break}}l===t&&(r.value=r.value.slice(1),r.value.length===0?t.children.shift():t.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,t.position.start=Object.assign({},r.position.start)))}}this.exit(e)}function qF(e,n,t,r){const a=e.children[0],o=typeof e.checked=="boolean"&&a&&a.type==="paragraph",l="["+(e.checked?"x":" ")+"] ",h=t.createTracker(r);o&&h.move(l);let d=tk.listItem(e,n,t,{...r,...h.current()});return o&&(d=d.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),d;function u(f){return f+l}}function VF(){return[N3(),q3(),Y3(),IF(),zF()]}function HF(e){return{extensions:[S3(),V3(e),W3(),$F(e),BF()]}}const GF={tokenize:XF,partial:!0},nk={tokenize:ZF,partial:!0},ik={tokenize:e5,partial:!0},rk={tokenize:t5,partial:!0},YF={tokenize:n5,partial:!0},ak={name:"wwwAutolink",tokenize:JF,previous:ok},sk={name:"protocolAutolink",tokenize:KF,previous:lk},Sc={name:"emailAutolink",tokenize:QF,previous:ck},Rl={};function WF(){return{text:Rl}}let Hd=48;for(;Hd<123;)Rl[Hd]=Sc,Hd++,Hd===58?Hd=65:Hd===91&&(Hd=97);Rl[43]=Sc;Rl[45]=Sc;Rl[46]=Sc;Rl[95]=Sc;Rl[72]=[Sc,sk];Rl[104]=[Sc,sk];Rl[87]=[Sc,ak];Rl[119]=[Sc,ak];function QF(e,n,t){const r=this;let a,o;return l;function l(g){return!y1(g)||!ck.call(r,r.previous)||Rw(r.events)?t(g):(e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),h(g))}function h(g){return y1(g)?(e.consume(g),h):g===64?(e.consume(g),d):t(g)}function d(g){return g===46?e.check(YF,f,u)(g):g===45||g===95||ta(g)?(o=!0,e.consume(g),d):f(g)}function u(g){return e.consume(g),a=!0,d}function f(g){return o&&a&&ga(r.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),n(g)):t(g)}}function JF(e,n,t){const r=this;return a;function a(l){return l!==87&&l!==119||!ok.call(r,r.previous)||Rw(r.events)?t(l):(e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(GF,e.attempt(nk,e.attempt(ik,o),t),t)(l))}function o(l){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),n(l)}}function KF(e,n,t){const r=this;let a="",o=!1;return l;function l(g){return(g===72||g===104)&&lk.call(r,r.previous)&&!Rw(r.events)?(e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),a+=String.fromCodePoint(g),e.consume(g),h):t(g)}function h(g){if(ga(g)&&a.length<5)return a+=String.fromCodePoint(g),e.consume(g),h;if(g===58){const b=a.toLowerCase();if(b==="http"||b==="https")return e.consume(g),d}return t(g)}function d(g){return g===47?(e.consume(g),o?u:(o=!0,d)):t(g)}function u(g){return g===null||lb(g)||gi(g)||th(g)||Rb(g)?t(g):e.attempt(nk,e.attempt(ik,f),t)(g)}function f(g){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),n(g)}}function XF(e,n,t){let r=0;return a;function a(l){return(l===87||l===119)&&r<3?(r++,e.consume(l),a):l===46&&r===3?(e.consume(l),o):t(l)}function o(l){return l===null?t(l):n(l)}}function ZF(e,n,t){let r,a,o;return l;function l(u){return u===46||u===95?e.check(rk,d,h)(u):u===null||gi(u)||th(u)||u!==45&&Rb(u)?d(u):(o=!0,e.consume(u),l)}function h(u){return u===95?r=!0:(a=r,r=void 0),e.consume(u),l}function d(u){return a||r||!o?t(u):n(u)}}function e5(e,n){let t=0,r=0;return a;function a(l){return l===40?(t++,e.consume(l),a):l===41&&r<t?o(l):l===33||l===34||l===38||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===60||l===63||l===93||l===95||l===126?e.check(rk,n,o)(l):l===null||gi(l)||th(l)?n(l):(e.consume(l),a)}function o(l){return l===41&&r++,e.consume(l),a}}function t5(e,n,t){return r;function r(h){return h===33||h===34||h===39||h===41||h===42||h===44||h===46||h===58||h===59||h===63||h===95||h===126?(e.consume(h),r):h===38?(e.consume(h),o):h===93?(e.consume(h),a):h===60||h===null||gi(h)||th(h)?n(h):t(h)}function a(h){return h===null||h===40||h===91||gi(h)||th(h)?n(h):r(h)}function o(h){return ga(h)?l(h):t(h)}function l(h){return h===59?(e.consume(h),r):ga(h)?(e.consume(h),l):t(h)}}function n5(e,n,t){return r;function r(o){return e.consume(o),a}function a(o){return ta(o)?t(o):n(o)}}function ok(e){return e===null||e===40||e===42||e===95||e===91||e===93||e===126||gi(e)}function lk(e){return!ga(e)}function ck(e){return!(e===47||y1(e))}function y1(e){return e===43||e===45||e===46||e===95||ta(e)}function Rw(e){let n=e.length,t=!1;for(;n--;){const r=e[n][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){t=!0;break}if(r._gfmAutolinkLiteralWalkedInto){t=!1;break}}return e.length>0&&!t&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),t}const i5={tokenize:d5,partial:!0};function r5(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:l5,continuation:{tokenize:c5},exit:u5}},text:{91:{name:"gfmFootnoteCall",tokenize:o5},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:a5,resolveTo:s5}}}}function a5(e,n,t){const r=this;let a=r.events.length;const o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l;for(;a--;){const d=r.events[a][1];if(d.type==="labelImage"){l=d;break}if(d.type==="gfmFootnoteCall"||d.type==="labelLink"||d.type==="label"||d.type==="image"||d.type==="link")break}return h;function h(d){if(!l||!l._balanced)return t(d);const u=Do(r.sliceSerialize({start:l.end,end:r.now()}));return u.codePointAt(0)!==94||!o.includes(u.slice(1))?t(d):(e.enter("gfmFootnoteCallLabelMarker"),e.consume(d),e.exit("gfmFootnoteCallLabelMarker"),n(d))}}function s5(e,n){let t=e.length;for(;t--;)if(e[t][1].type==="labelImage"&&e[t][0]==="enter"){e[t][1];break}e[t+1][1].type="data",e[t+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},e[t+3][1].start),end:Object.assign({},e[e.length-1][1].end)},a={type:"gfmFootnoteCallMarker",start:Object.assign({},e[t+3][1].end),end:Object.assign({},e[t+3][1].end)};a.end.column++,a.end.offset++,a.end._bufferIndex++;const o={type:"gfmFootnoteCallString",start:Object.assign({},a.end),end:Object.assign({},e[e.length-1][1].start)},l={type:"chunkString",contentType:"string",start:Object.assign({},o.start),end:Object.assign({},o.end)},h=[e[t+1],e[t+2],["enter",r,n],e[t+3],e[t+4],["enter",a,n],["exit",a,n],["enter",o,n],["enter",l,n],["exit",l,n],["exit",o,n],e[e.length-2],e[e.length-1],["exit",r,n]];return e.splice(t,e.length-t+1,...h),e}function o5(e,n,t){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o=0,l;return h;function h(g){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(g),e.exit("gfmFootnoteCallLabelMarker"),d}function d(g){return g!==94?t(g):(e.enter("gfmFootnoteCallMarker"),e.consume(g),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",u)}function u(g){if(o>999||g===93&&!l||g===null||g===91||gi(g))return t(g);if(g===93){e.exit("chunkString");const b=e.exit("gfmFootnoteCallString");return a.includes(Do(r.sliceSerialize(b)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(g),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),n):t(g)}return gi(g)||(l=!0),o++,e.consume(g),g===92?f:u}function f(g){return g===91||g===92||g===93?(e.consume(g),o++,u):u(g)}}function l5(e,n,t){const r=this,a=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o,l=0,h;return d;function d(S){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(S),e.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(S){return S===94?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(S),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",f):t(S)}function f(S){if(l>999||S===93&&!h||S===null||S===91||gi(S))return t(S);if(S===93){e.exit("chunkString");const T=e.exit("gfmFootnoteDefinitionLabelString");return o=Do(r.sliceSerialize(T)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(S),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),b}return gi(S)||(h=!0),l++,e.consume(S),S===92?g:f}function g(S){return S===91||S===92||S===93?(e.consume(S),l++,f):f(S)}function b(S){return S===58?(e.enter("definitionMarker"),e.consume(S),e.exit("definitionMarker"),a.includes(o)||a.push(o),zn(e,v,"gfmFootnoteDefinitionWhitespace")):t(S)}function v(S){return n(S)}}function c5(e,n,t){return e.check(vg,n,e.attempt(i5,n,t))}function u5(e){e.exit("gfmFootnoteDefinition")}function d5(e,n,t){const r=this;return zn(e,a,"gfmFootnoteDefinitionIndent",5);function a(o){const l=r.events[r.events.length-1];return l&&l[1].type==="gfmFootnoteDefinitionIndent"&&l[2].sliceSerialize(l[1],!0).length===4?n(o):t(o)}}function h5(e){let t=(e||{}).singleTilde;const r={name:"strikethrough",tokenize:o,resolveAll:a};return t==null&&(t=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function a(l,h){let d=-1;for(;++d<l.length;)if(l[d][0]==="enter"&&l[d][1].type==="strikethroughSequenceTemporary"&&l[d][1]._close){let u=d;for(;u--;)if(l[u][0]==="exit"&&l[u][1].type==="strikethroughSequenceTemporary"&&l[u][1]._open&&l[d][1].end.offset-l[d][1].start.offset===l[u][1].end.offset-l[u][1].start.offset){l[d][1].type="strikethroughSequence",l[u][1].type="strikethroughSequence";const f={type:"strikethrough",start:Object.assign({},l[u][1].start),end:Object.assign({},l[d][1].end)},g={type:"strikethroughText",start:Object.assign({},l[u][1].end),end:Object.assign({},l[d][1].start)},b=[["enter",f,h],["enter",l[u][1],h],["exit",l[u][1],h],["enter",g,h]],v=h.parser.constructs.insideSpan.null;v&&hs(b,b.length,0,Ob(v,l.slice(u+1,d),h)),hs(b,b.length,0,[["exit",g,h],["enter",l[d][1],h],["exit",l[d][1],h],["exit",f,h]]),hs(l,u-1,d-u+3,b),d=u+b.length-2;break}}for(d=-1;++d<l.length;)l[d][1].type==="strikethroughSequenceTemporary"&&(l[d][1].type="data");return l}function o(l,h,d){const u=this.previous,f=this.events;let g=0;return b;function b(S){return u===126&&f[f.length-1][1].type!=="characterEscape"?d(S):(l.enter("strikethroughSequenceTemporary"),v(S))}function v(S){const T=ep(u);if(S===126)return g>1?d(S):(l.consume(S),g++,v);if(g<2&&!t)return d(S);const E=l.exit("strikethroughSequenceTemporary"),C=ep(S);return E._open=!C||C===2&&!!T,E._close=!T||T===2&&!!C,h(S)}}}class f5{constructor(){this.map=[]}add(n,t,r){p5(this,n,t,r)}consume(n){if(this.map.sort(function(o,l){return o[0]-l[0]}),this.map.length===0)return;let t=this.map.length;const r=[];for(;t>0;)t-=1,r.push(n.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),n.length=this.map[t][0];r.push(n.slice()),n.length=0;let a=r.pop();for(;a;){for(const o of a)n.push(o);a=r.pop()}this.map.length=0}}function p5(e,n,t,r){let a=0;if(!(t===0&&r.length===0)){for(;a<e.map.length;){if(e.map[a][0]===n){e.map[a][1]+=t,e.map[a][2].push(...r);return}a+=1}e.map.push([n,t,r])}}function m5(e,n){let t=!1;const r=[];for(;n<e.length;){const a=e[n];if(t){if(a[0]==="enter")a[1].type==="tableContent"&&r.push(e[n+1][1].type==="tableDelimiterMarker"?"left":"none");else if(a[1].type==="tableContent"){if(e[n-1][1].type==="tableDelimiterMarker"){const o=r.length-1;r[o]=r[o]==="left"?"center":"right"}}else if(a[1].type==="tableDelimiterRow")break}else a[0]==="enter"&&a[1].type==="tableDelimiterRow"&&(t=!0);n+=1}return r}function g5(){return{flow:{null:{name:"table",tokenize:y5,resolveAll:x5}}}}function y5(e,n,t){const r=this;let a=0,o=0,l;return h;function h(z){let U=r.events.length-1;for(;U>-1;){const ie=r.events[U][1].type;if(ie==="lineEnding"||ie==="linePrefix")U--;else break}const V=U>-1?r.events[U][1].type:null,ee=V==="tableHead"||V==="tableRow"?O:d;return ee===O&&r.parser.lazy[r.now().line]?t(z):ee(z)}function d(z){return e.enter("tableHead"),e.enter("tableRow"),u(z)}function u(z){return z===124||(l=!0,o+=1),f(z)}function f(z){return z===null?t(z):Ht(z)?o>1?(o=0,r.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(z),e.exit("lineEnding"),v):t(z):An(z)?zn(e,f,"whitespace")(z):(o+=1,l&&(l=!1,a+=1),z===124?(e.enter("tableCellDivider"),e.consume(z),e.exit("tableCellDivider"),l=!0,f):(e.enter("data"),g(z)))}function g(z){return z===null||z===124||gi(z)?(e.exit("data"),f(z)):(e.consume(z),z===92?b:g)}function b(z){return z===92||z===124?(e.consume(z),g):g(z)}function v(z){return r.interrupt=!1,r.parser.lazy[r.now().line]?t(z):(e.enter("tableDelimiterRow"),l=!1,An(z)?zn(e,S,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(z):S(z))}function S(z){return z===45||z===58?E(z):z===124?(l=!0,e.enter("tableCellDivider"),e.consume(z),e.exit("tableCellDivider"),T):L(z)}function T(z){return An(z)?zn(e,E,"whitespace")(z):E(z)}function E(z){return z===58?(o+=1,l=!0,e.enter("tableDelimiterMarker"),e.consume(z),e.exit("tableDelimiterMarker"),C):z===45?(o+=1,C(z)):z===null||Ht(z)?q(z):L(z)}function C(z){return z===45?(e.enter("tableDelimiterFiller"),P(z)):L(z)}function P(z){return z===45?(e.consume(z),P):z===58?(l=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(z),e.exit("tableDelimiterMarker"),I):(e.exit("tableDelimiterFiller"),I(z))}function I(z){return An(z)?zn(e,q,"whitespace")(z):q(z)}function q(z){return z===124?S(z):z===null||Ht(z)?!l||a!==o?L(z):(e.exit("tableDelimiterRow"),e.exit("tableHead"),n(z)):L(z)}function L(z){return t(z)}function O(z){return e.enter("tableRow"),B(z)}function B(z){return z===124?(e.enter("tableCellDivider"),e.consume(z),e.exit("tableCellDivider"),B):z===null||Ht(z)?(e.exit("tableRow"),n(z)):An(z)?zn(e,B,"whitespace")(z):(e.enter("data"),$(z))}function $(z){return z===null||z===124||gi(z)?(e.exit("data"),B(z)):(e.consume(z),z===92?F:$)}function F(z){return z===92||z===124?(e.consume(z),$):$(z)}}function x5(e,n){let t=-1,r=!0,a=0,o=[0,0,0,0],l=[0,0,0,0],h=!1,d=0,u,f,g;const b=new f5;for(;++t<e.length;){const v=e[t],S=v[1];v[0]==="enter"?S.type==="tableHead"?(h=!1,d!==0&&(kS(b,n,d,u,f),f=void 0,d=0),u={type:"table",start:Object.assign({},S.start),end:Object.assign({},S.end)},b.add(t,0,[["enter",u,n]])):S.type==="tableRow"||S.type==="tableDelimiterRow"?(r=!0,g=void 0,o=[0,0,0,0],l=[0,t+1,0,0],h&&(h=!1,f={type:"tableBody",start:Object.assign({},S.start),end:Object.assign({},S.end)},b.add(t,0,[["enter",f,n]])),a=S.type==="tableDelimiterRow"?2:f?3:1):a&&(S.type==="data"||S.type==="tableDelimiterMarker"||S.type==="tableDelimiterFiller")?(r=!1,l[2]===0&&(o[1]!==0&&(l[0]=l[1],g=Cx(b,n,o,a,void 0,g),o=[0,0,0,0]),l[2]=t)):S.type==="tableCellDivider"&&(r?r=!1:(o[1]!==0&&(l[0]=l[1],g=Cx(b,n,o,a,void 0,g)),o=l,l=[o[1],t,0,0])):S.type==="tableHead"?(h=!0,d=t):S.type==="tableRow"||S.type==="tableDelimiterRow"?(d=t,o[1]!==0?(l[0]=l[1],g=Cx(b,n,o,a,t,g)):l[1]!==0&&(g=Cx(b,n,l,a,t,g)),a=0):a&&(S.type==="data"||S.type==="tableDelimiterMarker"||S.type==="tableDelimiterFiller")&&(l[3]=t)}for(d!==0&&kS(b,n,d,u,f),b.consume(n.events),t=-1;++t<n.events.length;){const v=n.events[t];v[0]==="enter"&&v[1].type==="table"&&(v[1]._align=m5(n.events,t))}return e}function Cx(e,n,t,r,a,o){const l=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",h="tableContent";t[0]!==0&&(o.end=Object.assign({},Bf(n.events,t[0])),e.add(t[0],0,[["exit",o,n]]));const d=Bf(n.events,t[1]);if(o={type:l,start:Object.assign({},d),end:Object.assign({},d)},e.add(t[1],0,[["enter",o,n]]),t[2]!==0){const u=Bf(n.events,t[2]),f=Bf(n.events,t[3]),g={type:h,start:Object.assign({},u),end:Object.assign({},f)};if(e.add(t[2],0,[["enter",g,n]]),r!==2){const b=n.events[t[2]],v=n.events[t[3]];if(b[1].end=Object.assign({},v[1].end),b[1].type="chunkText",b[1].contentType="text",t[3]>t[2]+1){const S=t[2]+1,T=t[3]-t[2]-1;e.add(S,T,[])}}e.add(t[3]+1,0,[["exit",g,n]])}return a!==void 0&&(o.end=Object.assign({},Bf(n.events,a)),e.add(a,0,[["exit",o,n]]),o=void 0),o}function kS(e,n,t,r,a){const o=[],l=Bf(n.events,t);a&&(a.end=Object.assign({},l),o.push(["exit",a,n])),r.end=Object.assign({},l),o.push(["exit",r,n]),e.add(t+1,0,o)}function Bf(e,n){const t=e[n],r=t[0]==="enter"?"start":"end";return t[1][r]}const b5={name:"tasklistCheck",tokenize:w5};function v5(){return{text:{91:b5}}}function w5(e,n,t){const r=this;return a;function a(d){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?t(d):(e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(d),e.exit("taskListCheckMarker"),o)}function o(d){return gi(d)?(e.enter("taskListCheckValueUnchecked"),e.consume(d),e.exit("taskListCheckValueUnchecked"),l):d===88||d===120?(e.enter("taskListCheckValueChecked"),e.consume(d),e.exit("taskListCheckValueChecked"),l):t(d)}function l(d){return d===93?(e.enter("taskListCheckMarker"),e.consume(d),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),h):t(d)}function h(d){return Ht(d)?n(d):An(d)?e.check({tokenize:N5},n,t)(d):t(d)}}function N5(e,n,t){return zn(e,r,"whitespace");function r(a){return a===null?t(a):n(a)}}function S5(e){return b2([WF(),r5(),h5(e),g5(),v5()])}const j5={};function os(e){const n=this,t=e||j5,r=n.data(),a=r.micromarkExtensions||(r.micromarkExtensions=[]),o=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),l=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);a.push(S5(t)),o.push(VF()),l.push(HF(t))}const x1=()=>{const e=localStorage.getItem("currentClinicId");return e||(console.warn("getCurrentClinicId: Clinic ID not found. Returning null. Ensure this is implemented correctly."),null)},nh=()=>localStorage.getItem("authToken"),_5="_container_6q5ye_3",C5="_title_6q5ye_29",k5="_filtersContainer_6q5ye_145",T5="_dateInputLabel_6q5ye_197",E5="_dateInput_6q5ye_197",A5="_fetchButton_6q5ye_279",D5="_dashboardGrid_6q5ye_333",P5="_sectionContainer_6q5ye_345",I5="_sectionTitle_6q5ye_371",M5="_totalRevenue_6q5ye_407",R5="_totalRevenueAmount_6q5ye_477",O5="_revenueGrid_6q5ye_505",L5="_revenueCard_6q5ye_519",F5="_revenueCardTitle_6q5ye_555",$5="_revenueCardAmount_6q5ye_587",z5="_revenueCardList_6q5ye_609",B5="_tableContainer_6q5ye_681",U5="_styledTable_6q5ye_707",q5="_capitalize_6q5ye_805",V5="_textRight_6q5ye_813",H5="_textGreen_6q5ye_823",G5="_textRed_6q5ye_833",Y5="_textOrange_6q5ye_843",W5="_reasonDistribution_6q5ye_865",Q5="_loadingContainer_6q5ye_911",J5="_breathingBall_6q5ye_931",K5="_errorAlert_6q5ye_981",X5="_noDataMessage_6q5ye_1007",Ct={container:_5,title:C5,filtersContainer:k5,dateInputLabel:T5,dateInput:E5,fetchButton:A5,dashboardGrid:D5,sectionContainer:P5,sectionTitle:I5,totalRevenue:M5,totalRevenueAmount:R5,revenueGrid:O5,revenueCard:L5,revenueCardTitle:F5,revenueCardAmount:$5,revenueCardList:z5,tableContainer:B5,styledTable:U5,capitalize:q5,textRight:V5,textGreen:H5,textRed:G5,textOrange:Y5,reasonDistribution:W5,loadingContainer:Q5,breathingBall:J5,errorAlert:K5,noDataMessage:X5},Z5="_chatWidget_cavd0_7",e6="_chatToggleBtn_cavd0_31",t6="_chatWindow_cavd0_107",n6="_chatHeader_cavd0_179",i6="_chatHeaderTitle_cavd0_209",r6="_chatMessages_cavd0_237",a6="_messageBubble_cavd0_323",s6="_messageIcon_cavd0_363",o6="_userMessage_cavd0_391",l6="_messageContent_cavd0_421",c6="_aiMessage_cavd0_447",u6="_emptyChatState_cavd0_985",d6="_emptyChatIcon_cavd0_1009",h6="_suggestionChips_cavd0_1039",f6="_chatInputArea_cavd0_1127",p6="_sendBtn_cavd0_1231",m6="_typingIndicator_cavd0_1317",g6="_aiAttachBtn_cavd0_1783",y6="_aiImagePreviewBox_cavd0_1845",x6="_aiImagePreviewThumbnail_cavd0_1855",b6="_aiImageRemoveBadge_cavd0_1871",v6="_chatInputAreaInput_cavd0_1905",Tt={chatWidget:Z5,chatToggleBtn:e6,chatWindow:t6,chatHeader:n6,chatHeaderTitle:i6,chatMessages:r6,messageBubble:a6,messageIcon:s6,userMessage:o6,messageContent:l6,aiMessage:c6,emptyChatState:u6,emptyChatIcon:d6,suggestionChips:h6,chatInputArea:f6,sendBtn:p6,typingIndicator:m6,aiAttachBtn:g6,aiImagePreviewBox:y6,aiImagePreviewThumbnail:x6,aiImageRemoveBadge:b6,chatInputAreaInput:v6};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let w6,N6;function S6(){return{geminiUrl:w6,vertexUrl:N6}}function j6(e,n,t){var r,a,o;if(!(!((r=e.httpOptions)===null||r===void 0)&&r.baseUrl)){const l=S6();return e.vertexai?(a=l.vertexUrl)!==null&&a!==void 0?a:n:(o=l.geminiUrl)!==null&&o!==void 0?o:t}return e.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ng{}function en(e,n){const t=/\{([^}]+)\}/g;return e.replace(t,(r,a)=>{if(Object.prototype.hasOwnProperty.call(n,a)){const o=n[a];return o!=null?String(o):""}else throw new Error(`Key '${a}' not found in valueMap.`)})}function _(e,n,t){for(let o=0;o<n.length-1;o++){const l=n[o];if(l.endsWith("[]")){const h=l.slice(0,-2);if(!(h in e))if(Array.isArray(t))e[h]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(e[h])){const d=e[h];if(Array.isArray(t))for(let u=0;u<d.length;u++){const f=d[u];_(f,n.slice(o+1),t[u])}else for(const u of d)_(u,n.slice(o+1),t)}return}else if(l.endsWith("[0]")){const h=l.slice(0,-3);h in e||(e[h]=[{}]);const d=e[h];_(d[0],n.slice(o+1),t);return}(!e[l]||typeof e[l]!="object")&&(e[l]={}),e=e[l]}const r=n[n.length-1],a=e[r];if(a!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===a)return;if(typeof a=="object"&&typeof t=="object"&&a!==null&&t!==null)Object.assign(a,t);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else e[r]=t}function j(e,n){try{if(n.length===1&&n[0]==="_self")return e;for(let t=0;t<n.length;t++){if(typeof e!="object"||e===null)return;const r=n[t];if(r.endsWith("[]")){const a=r.slice(0,-2);if(a in e){const o=e[a];return Array.isArray(o)?o.map(l=>j(l,n.slice(t+1))):void 0}else return}else e=e[r]}return e}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ii(e,n){if(!n||typeof n!="string")throw new Error("model is required and must be a string");if(e.isVertexAI()){if(n.startsWith("publishers/")||n.startsWith("projects/")||n.startsWith("models/"))return n;if(n.indexOf("/")>=0){const t=n.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${n}`}else return n.startsWith("models/")||n.startsWith("tunedModels/")?n:`models/${n}`}function uk(e,n){const t=Ii(e,n);return t?t.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:t.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${t}`:t:""}function dk(e,n){return Array.isArray(n)?n.map(t=>hb(e,t)):[hb(e,n)]}function hb(e,n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function _6(e,n){const t=hb(e,n);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function C6(e,n){const t=hb(e,n);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw new Error(`Unsupported mime type: ${t.mimeType}`)}function TS(e,n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function hk(e,n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(t=>TS(e,t)):[TS(e,n)]}function b1(e){return e!=null&&typeof e=="object"&&"parts"in e&&Array.isArray(e.parts)}function ES(e){return e!=null&&typeof e=="object"&&"functionCall"in e}function AS(e){return e!=null&&typeof e=="object"&&"functionResponse"in e}function Pa(e,n){if(n==null)throw new Error("ContentUnion is required");return b1(n)?n:{role:"user",parts:hk(e,n)}}function fk(e,n){if(!n)return[];if(e.isVertexAI()&&Array.isArray(n))return n.flatMap(t=>{const r=Pa(e,t);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(e.isVertexAI()){const t=Pa(e,n);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(n)?n.map(t=>Pa(e,t)):[Pa(e,n)]}function Tu(e,n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(ES(n)||AS(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Pa(e,n)]}const t=[],r=[],a=b1(n[0]);for(const o of n){const l=b1(o);if(l!=a)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)t.push(o);else{if(ES(o)||AS(o))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");r.push(o)}}return a||t.push({role:"user",parts:hk(e,r)}),t}function pk(e,n){return n}function mk(e,n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function zb(e,n){return n}function Bb(e,n){if(!Array.isArray(n))throw new Error("tool is required and must be an array of Tools");return n}function k6(e,n,t,r=1){const a=!n.startsWith(`${t}/`)&&n.split("/").length===r;return e.isVertexAI()?n.startsWith("projects/")?n:n.startsWith("locations/")?`projects/${e.getProject()}/${n}`:n.startsWith(`${t}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:a?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}/${n}`:n:a?`${t}/${n}`:n}function Eu(e,n){if(typeof n!="string")throw new Error("name must be a string");return k6(e,n,"cachedContents")}function gk(e,n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function Au(e,n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function T6(e){return e!=null&&typeof e=="object"&&"name"in e}function E6(e){return e!=null&&typeof e=="object"&&"video"in e}function A6(e){return e!=null&&typeof e=="object"&&"uri"in e}function yk(e,n){var t;let r;if(T6(n)&&(r=n.name),!(A6(n)&&(r=n.uri,r===void 0))&&!(E6(n)&&(r=(t=n.video)===null||t===void 0?void 0:t.uri,r===void 0))){if(typeof n=="string"&&(r=n),r===void 0)throw new Error("Could not extract file name from the provided input.");if(r.startsWith("https://")){const o=r.split("files/")[1].match(/[a-z0-9]+/);if(o===null)throw new Error(`Could not extract file name from URI ${r}`);r=o[0]}else r.startsWith("files/")&&(r=r.split("files/")[1]);return r}}function xk(e,n){let t;return e.isVertexAI()?t=n?"publishers/google/models":"models":t=n?"models":"tunedModels",t}function bk(e,n){for(const t of["models","tunedModels","publisherModels"])if(D6(n,t))return n[t];return[]}function D6(e,n){return e!==null&&typeof e=="object"&&n in e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function P6(e,n){const t={};if(j(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=j(n,["data"]);r!=null&&_(t,["data"],r);const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function I6(e,n){const t={};if(j(n,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const r=j(n,["thought"]);r!=null&&_(t,["thought"],r);const a=j(n,["inlineData"]);a!=null&&_(t,["inlineData"],P6(e,a));const o=j(n,["codeExecutionResult"]);o!=null&&_(t,["codeExecutionResult"],o);const l=j(n,["executableCode"]);l!=null&&_(t,["executableCode"],l);const h=j(n,["fileData"]);h!=null&&_(t,["fileData"],h);const d=j(n,["functionCall"]);d!=null&&_(t,["functionCall"],d);const u=j(n,["functionResponse"]);u!=null&&_(t,["functionResponse"],u);const f=j(n,["text"]);return f!=null&&_(t,["text"],f),t}function DS(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>I6(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function M6(){return{}}function R6(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function O6(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],R6(e,r)),t}function L6(e,n){const t={};if(j(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");j(n,["googleSearch"])!=null&&_(t,["googleSearch"],M6());const a=j(n,["googleSearchRetrieval"]);if(a!=null&&_(t,["googleSearchRetrieval"],O6(e,a)),j(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(j(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const o=j(n,["codeExecution"]);o!=null&&_(t,["codeExecution"],o);const l=j(n,["functionDeclarations"]);return l!=null&&_(t,["functionDeclarations"],l),t}function F6(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["allowedFunctionNames"]);return a!=null&&_(t,["allowedFunctionNames"],a),t}function $6(e,n){const t={},r=j(n,["functionCallingConfig"]);if(r!=null&&_(t,["functionCallingConfig"],F6(e,r)),j(n,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return t}function z6(e,n,t){const r={},a=j(n,["ttl"]);t!==void 0&&a!=null&&_(t,["ttl"],a);const o=j(n,["expireTime"]);t!==void 0&&o!=null&&_(t,["expireTime"],o);const l=j(n,["displayName"]);t!==void 0&&l!=null&&_(t,["displayName"],l);const h=j(n,["contents"]);if(t!==void 0&&h!=null){let g=Tu(e,h);Array.isArray(g)&&(g=g.map(b=>DS(e,b))),_(t,["contents"],g)}const d=j(n,["systemInstruction"]);t!==void 0&&d!=null&&_(t,["systemInstruction"],DS(e,Pa(e,d)));const u=j(n,["tools"]);if(t!==void 0&&u!=null){let g=u;Array.isArray(g)&&(g=g.map(b=>L6(e,b))),_(t,["tools"],g)}const f=j(n,["toolConfig"]);return t!==void 0&&f!=null&&_(t,["toolConfig"],$6(e,f)),r}function B6(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["model"],uk(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],z6(e,a,t)),t}function U6(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function q6(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function V6(e,n,t){const r={},a=j(n,["ttl"]);t!==void 0&&a!=null&&_(t,["ttl"],a);const o=j(n,["expireTime"]);return t!==void 0&&o!=null&&_(t,["expireTime"],o),r}function H6(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],V6(e,a,t)),t}function G6(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);return t!==void 0&&o!=null&&_(t,["_query","pageToken"],o),r}function Y6(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],G6(e,r,t)),t}function W6(e,n){const t={},r=j(n,["displayName"]);r!=null&&_(t,["displayName"],r);const a=j(n,["data"]);a!=null&&_(t,["data"],a);const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function Q6(e,n){const t={},r=j(n,["videoMetadata"]);r!=null&&_(t,["videoMetadata"],r);const a=j(n,["thought"]);a!=null&&_(t,["thought"],a);const o=j(n,["inlineData"]);o!=null&&_(t,["inlineData"],W6(e,o));const l=j(n,["codeExecutionResult"]);l!=null&&_(t,["codeExecutionResult"],l);const h=j(n,["executableCode"]);h!=null&&_(t,["executableCode"],h);const d=j(n,["fileData"]);d!=null&&_(t,["fileData"],d);const u=j(n,["functionCall"]);u!=null&&_(t,["functionCall"],u);const f=j(n,["functionResponse"]);f!=null&&_(t,["functionResponse"],f);const g=j(n,["text"]);return g!=null&&_(t,["text"],g),t}function PS(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Q6(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function J6(){return{}}function K6(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function X6(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],K6(e,r)),t}function Z6(){return{}}function e$(e,n){const t={},r=j(n,["apiKeyString"]);return r!=null&&_(t,["apiKeyString"],r),t}function t$(e,n){const t={},r=j(n,["apiKeyConfig"]);r!=null&&_(t,["apiKeyConfig"],e$(e,r));const a=j(n,["authType"]);a!=null&&_(t,["authType"],a);const o=j(n,["googleServiceAccountConfig"]);o!=null&&_(t,["googleServiceAccountConfig"],o);const l=j(n,["httpBasicAuthConfig"]);l!=null&&_(t,["httpBasicAuthConfig"],l);const h=j(n,["oauthConfig"]);h!=null&&_(t,["oauthConfig"],h);const d=j(n,["oidcConfig"]);return d!=null&&_(t,["oidcConfig"],d),t}function n$(e,n){const t={},r=j(n,["authConfig"]);return r!=null&&_(t,["authConfig"],t$(e,r)),t}function i$(e,n){const t={},r=j(n,["retrieval"]);r!=null&&_(t,["retrieval"],r),j(n,["googleSearch"])!=null&&_(t,["googleSearch"],J6());const o=j(n,["googleSearchRetrieval"]);o!=null&&_(t,["googleSearchRetrieval"],X6(e,o)),j(n,["enterpriseWebSearch"])!=null&&_(t,["enterpriseWebSearch"],Z6());const h=j(n,["googleMaps"]);h!=null&&_(t,["googleMaps"],n$(e,h));const d=j(n,["codeExecution"]);d!=null&&_(t,["codeExecution"],d);const u=j(n,["functionDeclarations"]);return u!=null&&_(t,["functionDeclarations"],u),t}function r$(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["allowedFunctionNames"]);return a!=null&&_(t,["allowedFunctionNames"],a),t}function a$(e,n){const t={},r=j(n,["latitude"]);r!=null&&_(t,["latitude"],r);const a=j(n,["longitude"]);return a!=null&&_(t,["longitude"],a),t}function s$(e,n){const t={},r=j(n,["latLng"]);return r!=null&&_(t,["latLng"],a$(e,r)),t}function o$(e,n){const t={},r=j(n,["functionCallingConfig"]);r!=null&&_(t,["functionCallingConfig"],r$(e,r));const a=j(n,["retrievalConfig"]);return a!=null&&_(t,["retrievalConfig"],s$(e,a)),t}function l$(e,n,t){const r={},a=j(n,["ttl"]);t!==void 0&&a!=null&&_(t,["ttl"],a);const o=j(n,["expireTime"]);t!==void 0&&o!=null&&_(t,["expireTime"],o);const l=j(n,["displayName"]);t!==void 0&&l!=null&&_(t,["displayName"],l);const h=j(n,["contents"]);if(t!==void 0&&h!=null){let g=Tu(e,h);Array.isArray(g)&&(g=g.map(b=>PS(e,b))),_(t,["contents"],g)}const d=j(n,["systemInstruction"]);t!==void 0&&d!=null&&_(t,["systemInstruction"],PS(e,Pa(e,d)));const u=j(n,["tools"]);if(t!==void 0&&u!=null){let g=u;Array.isArray(g)&&(g=g.map(b=>i$(e,b))),_(t,["tools"],g)}const f=j(n,["toolConfig"]);return t!==void 0&&f!=null&&_(t,["toolConfig"],o$(e,f)),r}function c$(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["model"],uk(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],l$(e,a,t)),t}function u$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function d$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function h$(e,n,t){const r={},a=j(n,["ttl"]);t!==void 0&&a!=null&&_(t,["ttl"],a);const o=j(n,["expireTime"]);return t!==void 0&&o!=null&&_(t,["expireTime"],o),r}function f$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],Eu(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],h$(e,a,t)),t}function p$(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);return t!==void 0&&o!=null&&_(t,["_query","pageToken"],o),r}function m$(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],p$(e,r,t)),t}function Qx(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["model"]);o!=null&&_(t,["model"],o);const l=j(n,["createTime"]);l!=null&&_(t,["createTime"],l);const h=j(n,["updateTime"]);h!=null&&_(t,["updateTime"],h);const d=j(n,["expireTime"]);d!=null&&_(t,["expireTime"],d);const u=j(n,["usageMetadata"]);return u!=null&&_(t,["usageMetadata"],u),t}function g$(){return{}}function y$(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>Qx(e,l))),_(t,["cachedContents"],o)}return t}function Jx(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["model"]);o!=null&&_(t,["model"],o);const l=j(n,["createTime"]);l!=null&&_(t,["createTime"],l);const h=j(n,["updateTime"]);h!=null&&_(t,["updateTime"],h);const d=j(n,["expireTime"]);d!=null&&_(t,["expireTime"],d);const u=j(n,["usageMetadata"]);return u!=null&&_(t,["usageMetadata"],u),t}function x$(){return{}}function b$(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["cachedContents"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>Jx(e,l))),_(t,["cachedContents"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var tp;(function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(tp||(tp={}));class Ub{constructor(n,t,r,a){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(n,r,a)}init(n,t,r){var a,o;this.nameInternal=n,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let l={config:{}};r?typeof r=="object"?l=Object.assign({},r):l=r:l={config:{}},l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(o=(a=l.config)===null||a===void 0?void 0:a.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(n){this.init(this.nameInternal,n,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(n){return this.pageInternal[n]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const n=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:n,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const n=await this.requestInternal(this.params);return this.initNextPage(n),this.page}hasNextPage(){var n;return((n=this.params.config)===null||n===void 0?void 0:n.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var IS;(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(IS||(IS={}));var MS;(function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"})(MS||(MS={}));var RS;(function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(RS||(RS={}));var OS;(function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"})(OS||(OS={}));var LS;(function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"})(LS||(LS={}));var FS;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(FS||(FS={}));var $S;(function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"})($S||($S={}));var np;(function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT"})(np||(np={}));var zS;(function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY"})(zS||(zS={}));var BS;(function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"})(BS||(BS={}));var US;(function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(US||(US={}));var qS;(function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(qS||(qS={}));var VS;(function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(VS||(VS={}));var ip;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"})(ip||(ip={}));var v1;(function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(v1||(v1={}));var w1;(function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(w1||(w1={}));var HS;(function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(HS||(HS={}));var GS;(function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"})(GS||(GS={}));var YS;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"})(YS||(YS={}));var WS;(function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"})(WS||(WS={}));var QS;(function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"})(QS||(QS={}));var JS;(function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"})(JS||(JS={}));var KS;(function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi"})(KS||(KS={}));var XS;(function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(XS||(XS={}));var ZS;(function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(ZS||(ZS={}));var ej;(function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(ej||(ej={}));var tj;(function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(tj||(tj={}));var nj;(function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"})(nj||(nj={}));var ij;(function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"})(ij||(ij={}));var rj;(function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"})(rj||(rj={}));var aj;(function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(aj||(aj={}));var sj;(function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(sj||(sj={}));var oj;(function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"})(oj||(oj={}));var lj;(function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(lj||(lj={}));class kx{get text(){var n,t,r,a,o,l,h,d;if(((a=(r=(t=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",f=!1;const g=[];for(const b of(d=(h=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)!==null&&d!==void 0?d:[]){for(const[v,S]of Object.entries(b))v!=="text"&&v!=="thought"&&(S!==null||S!==void 0)&&g.push(v);if(typeof b.text=="string"){if(typeof b.thought=="boolean"&&b.thought)continue;f=!0,u+=b.text}}return g.length>0&&console.warn(`there are non-text parts ${g} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?u:void 0}get data(){var n,t,r,a,o,l,h,d;if(((a=(r=(t=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let u="";const f=[];for(const g of(d=(h=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)!==null&&d!==void 0?d:[]){for(const[b,v]of Object.entries(g))b!=="inlineData"&&(v!==null||v!==void 0)&&f.push(b);g.inlineData&&typeof g.inlineData.data=="string"&&(u+=atob(g.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),u.length>0?btoa(u):void 0}get functionCalls(){var n,t,r,a,o,l,h,d;if(((a=(r=(t=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=(d=(h=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if((u==null?void 0:u.length)!==0)return u}get executableCode(){var n,t,r,a,o,l,h,d,u;if(((a=(r=(t=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(h=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||d===void 0?void 0:d.filter(g=>g.executableCode).map(g=>g.executableCode).filter(g=>g!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.code}get codeExecutionResult(){var n,t,r,a,o,l,h,d,u;if(((a=(r=(t=(n=this.candidates)===null||n===void 0?void 0:n[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||a===void 0?void 0:a.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(h=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||h===void 0?void 0:h.parts)===null||d===void 0?void 0:d.filter(g=>g.codeExecutionResult).map(g=>g.codeExecutionResult).filter(g=>g!==void 0);if((f==null?void 0:f.length)!==0)return(u=f==null?void 0:f[0])===null||u===void 0?void 0:u.output}}class cj{}class uj{}class v${}class w${}class dj{}class hj{}class fj{}class N${}class pj{}class mj{}class gj{}class S${}class N1{constructor(n){const t={};for(const r of n.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=n}json(){return this.responseInternal.json()}}class j${}class _${}class C${get text(){var n,t,r;let a="",o=!1;const l=[];for(const h of(r=(t=(n=this.serverContent)===null||n===void 0?void 0:n.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[d,u]of Object.entries(h))d!=="text"&&d!=="thought"&&u!==null&&l.push(d);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;o=!0,a+=h.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?a:void 0}get data(){var n,t,r;let a="";const o=[];for(const l of(r=(t=(n=this.serverContent)===null||n===void 0?void 0:n.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[h,d]of Object.entries(l))h!=="inlineData"&&d!==null&&o.push(h);l.inlineData&&typeof l.inlineData.data=="string"&&(a+=atob(l.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),a.length>0?btoa(a):void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class k$ extends Ng{constructor(n){super(),this.apiClient=n,this.list=async(t={})=>new Ub(tp.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(t),t)}async create(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=c$(this.apiClient,n);return h=en("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Jx(this.apiClient,f))}else{const u=B6(this.apiClient,n);return h=en("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Qx(this.apiClient,f))}}async get(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=u$(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Jx(this.apiClient,f))}else{const u=U6(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Qx(this.apiClient,f))}}async delete(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=d$(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=x$(),g=new mj;return Object.assign(g,f),g})}else{const u=q6(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(()=>{const f=g$(),g=new mj;return Object.assign(g,f),g})}}async update(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=f$(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Jx(this.apiClient,f))}else{const u=H6(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>Qx(this.apiClient,f))}}async listInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=m$(this.apiClient,n);return h=en("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=b$(this.apiClient,f),b=new gj;return Object.assign(b,g),b})}else{const u=Y6(this.apiClient,n);return h=en("cachedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=y$(this.apiClient,f),b=new gj;return Object.assign(b,g),b})}}}function yj(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],r=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function ea(e){return this instanceof ea?(this.v=e,this):new ea(e)}function fb(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(e,n||[]),a,o=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),h("next"),h("throw"),h("return",l),a[Symbol.asyncIterator]=function(){return this},a;function l(v){return function(S){return Promise.resolve(S).then(v,g)}}function h(v,S){r[v]&&(a[v]=function(T){return new Promise(function(E,C){o.push([v,T,E,C])>1||d(v,T)})},S&&(a[v]=S(a[v])))}function d(v,S){try{u(r[v](S))}catch(T){b(o[0][3],T)}}function u(v){v.value instanceof ea?Promise.resolve(v.value.v).then(f,g):b(o[0][2],v)}function f(v){d("next",v)}function g(v){d("throw",v)}function b(v,S){v(S),o.shift(),o.length&&d(o[0][0],o[0][1])}}function S1(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e[Symbol.asyncIterator],t;return n?n.call(e):(e=typeof yj=="function"?yj(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=e[o]&&function(l){return new Promise(function(h,d){l=e[o](l),a(h,d,l.done,l.value)})}}function a(o,l,h,d){Promise.resolve(d).then(function(u){o({value:u,done:h})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function T$(e){var n;if(e.candidates==null||e.candidates.length===0)return!1;const t=(n=e.candidates[0])===null||n===void 0?void 0:n.content;return t===void 0?!1:vk(t)}function vk(e){if(e.parts===void 0||e.parts.length===0)return!1;for(const n of e.parts)if(n===void 0||Object.keys(n).length===0||n.text!==void 0&&n.text==="")return!1;return!0}function E$(e){if(e.length!==0){if(e[0].role!=="user")throw new Error("History must start with a user turn.");for(const n of e)if(n.role!=="user"&&n.role!=="model")throw new Error(`Role must be user or model, but got ${n.role}.`)}}function A$(e){if(e===void 0||e.length===0)return[];const n=[],t=e.length;let r=0,a=e[0];for(;r<t;)if(e[r].role==="user")a=e[r],r++;else{const o=[];let l=!0;for(;r<t&&e[r].role==="model";)o.push(e[r]),l&&!vk(e[r])&&(l=!1),r++;l&&(n.push(a),n.push(...o))}return n}class D${constructor(n,t){this.modelsModule=n,this.apiClient=t}create(n){return new P$(this.apiClient,this.modelsModule,n.model,n.config,n.history)}}class P${constructor(n,t,r,a={},o=[]){this.apiClient=n,this.modelsModule=t,this.model=r,this.config=a,this.history=o,this.sendPromise=Promise.resolve(),E$(o)}async sendMessage(n){var t;await this.sendPromise;const r=Pa(this.apiClient,n.message),a=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=n.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,l;const d=(l=(o=(await a).candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content,u=d?[d]:[];this.recordHistory(r,u)})(),await this.sendPromise,a}async sendMessageStream(n){var t;await this.sendPromise;const r=Pa(this.apiClient,n.message),a=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=n.config)!==null&&t!==void 0?t:this.config});this.sendPromise=a.then(()=>{}).catch(()=>{});const o=await a;return this.processStreamResponse(o,r)}getHistory(n=!1){return n?A$(this.history):this.history}processStreamResponse(n,t){var r,a;return fb(this,arguments,function*(){var l,h,d,u;const f=[];try{for(var g=!0,b=S1(n),v;v=yield ea(b.next()),l=v.done,!l;g=!0){u=v.value,g=!1;const S=u;if(T$(S)){const T=(a=(r=S.candidates)===null||r===void 0?void 0:r[0])===null||a===void 0?void 0:a.content;T!==void 0&&f.push(T)}yield yield ea(S)}}catch(S){h={error:S}}finally{try{!g&&!l&&(d=b.return)&&(yield ea(d.call(b)))}finally{if(h)throw h.error}}this.recordHistory(t,f)})}recordHistory(n,t){let r=[];t.length>0&&t.every(a=>a.role==="model")?r=t:r.push({role:"model",parts:[]}),this.history.push(n),this.history.push(...r)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function I$(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);return t!==void 0&&o!=null&&_(t,["_query","pageToken"],o),r}function M$(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],I$(e,r,t)),t}function R$(e,n){const t={},r=j(n,["details"]);r!=null&&_(t,["details"],r);const a=j(n,["message"]);a!=null&&_(t,["message"],a);const o=j(n,["code"]);return o!=null&&_(t,["code"],o),t}function O$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["mimeType"]);o!=null&&_(t,["mimeType"],o);const l=j(n,["sizeBytes"]);l!=null&&_(t,["sizeBytes"],l);const h=j(n,["createTime"]);h!=null&&_(t,["createTime"],h);const d=j(n,["expirationTime"]);d!=null&&_(t,["expirationTime"],d);const u=j(n,["updateTime"]);u!=null&&_(t,["updateTime"],u);const f=j(n,["sha256Hash"]);f!=null&&_(t,["sha256Hash"],f);const g=j(n,["uri"]);g!=null&&_(t,["uri"],g);const b=j(n,["downloadUri"]);b!=null&&_(t,["downloadUri"],b);const v=j(n,["state"]);v!=null&&_(t,["state"],v);const S=j(n,["source"]);S!=null&&_(t,["source"],S);const T=j(n,["videoMetadata"]);T!=null&&_(t,["videoMetadata"],T);const E=j(n,["error"]);return E!=null&&_(t,["error"],R$(e,E)),t}function L$(e,n){const t={},r=j(n,["file"]);r!=null&&_(t,["file"],O$(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function F$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","file"],yk(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function $$(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","file"],yk(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function z$(e,n){const t={},r=j(n,["details"]);r!=null&&_(t,["details"],r);const a=j(n,["message"]);a!=null&&_(t,["message"],a);const o=j(n,["code"]);return o!=null&&_(t,["code"],o),t}function j1(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["mimeType"]);o!=null&&_(t,["mimeType"],o);const l=j(n,["sizeBytes"]);l!=null&&_(t,["sizeBytes"],l);const h=j(n,["createTime"]);h!=null&&_(t,["createTime"],h);const d=j(n,["expirationTime"]);d!=null&&_(t,["expirationTime"],d);const u=j(n,["updateTime"]);u!=null&&_(t,["updateTime"],u);const f=j(n,["sha256Hash"]);f!=null&&_(t,["sha256Hash"],f);const g=j(n,["uri"]);g!=null&&_(t,["uri"],g);const b=j(n,["downloadUri"]);b!=null&&_(t,["downloadUri"],b);const v=j(n,["state"]);v!=null&&_(t,["state"],v);const S=j(n,["source"]);S!=null&&_(t,["source"],S);const T=j(n,["videoMetadata"]);T!=null&&_(t,["videoMetadata"],T);const E=j(n,["error"]);return E!=null&&_(t,["error"],z$(e,E)),t}function B$(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["files"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>j1(e,l))),_(t,["files"],o)}return t}function U$(){return{}}function q$(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class V$ extends Ng{constructor(n){super(),this.apiClient=n,this.list=async(t={})=>new Ub(tp.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(t),t)}async upload(n){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(n.file,n.config).then(t=>j1(this.apiClient,t))}async download(n){await this.apiClient.downloadFile(n)}async listInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=M$(this.apiClient,n);return o=en("files",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>{const u=B$(this.apiClient,d),f=new S$;return Object.assign(f,u),f})}}async createInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=L$(this.apiClient,n);return o=en("upload/v1beta/files",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(()=>{const d=U$(),u=new j$;return Object.assign(u,d),u})}}async get(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=F$(this.apiClient,n);return o=en("files/{file}",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>j1(this.apiClient,d))}}async delete(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=$$(this.apiClient,n);return o=en("files/{file}",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(()=>{const d=q$(),u=new _$;return Object.assign(u,d),u})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function H$(e,n){const t={};if(j(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=j(n,["data"]);r!=null&&_(t,["data"],r);const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function G$(e,n){const t={},r=j(n,["displayName"]);r!=null&&_(t,["displayName"],r);const a=j(n,["data"]);a!=null&&_(t,["data"],a);const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function Y$(e,n){const t={};if(j(n,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const r=j(n,["thought"]);r!=null&&_(t,["thought"],r);const a=j(n,["inlineData"]);a!=null&&_(t,["inlineData"],H$(e,a));const o=j(n,["codeExecutionResult"]);o!=null&&_(t,["codeExecutionResult"],o);const l=j(n,["executableCode"]);l!=null&&_(t,["executableCode"],l);const h=j(n,["fileData"]);h!=null&&_(t,["fileData"],h);const d=j(n,["functionCall"]);d!=null&&_(t,["functionCall"],d);const u=j(n,["functionResponse"]);u!=null&&_(t,["functionResponse"],u);const f=j(n,["text"]);return f!=null&&_(t,["text"],f),t}function W$(e,n){const t={},r=j(n,["videoMetadata"]);r!=null&&_(t,["videoMetadata"],r);const a=j(n,["thought"]);a!=null&&_(t,["thought"],a);const o=j(n,["inlineData"]);o!=null&&_(t,["inlineData"],G$(e,o));const l=j(n,["codeExecutionResult"]);l!=null&&_(t,["codeExecutionResult"],l);const h=j(n,["executableCode"]);h!=null&&_(t,["executableCode"],h);const d=j(n,["fileData"]);d!=null&&_(t,["fileData"],d);const u=j(n,["functionCall"]);u!=null&&_(t,["functionCall"],u);const f=j(n,["functionResponse"]);f!=null&&_(t,["functionResponse"],f);const g=j(n,["text"]);return g!=null&&_(t,["text"],g),t}function Q$(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Y$(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function J$(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>W$(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function K$(){return{}}function X$(){return{}}function Z$(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function ez(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function tz(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],Z$(e,r)),t}function nz(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],ez(e,r)),t}function iz(){return{}}function rz(e,n){const t={},r=j(n,["apiKeyString"]);return r!=null&&_(t,["apiKeyString"],r),t}function az(e,n){const t={},r=j(n,["apiKeyConfig"]);r!=null&&_(t,["apiKeyConfig"],rz(e,r));const a=j(n,["authType"]);a!=null&&_(t,["authType"],a);const o=j(n,["googleServiceAccountConfig"]);o!=null&&_(t,["googleServiceAccountConfig"],o);const l=j(n,["httpBasicAuthConfig"]);l!=null&&_(t,["httpBasicAuthConfig"],l);const h=j(n,["oauthConfig"]);h!=null&&_(t,["oauthConfig"],h);const d=j(n,["oidcConfig"]);return d!=null&&_(t,["oidcConfig"],d),t}function sz(e,n){const t={},r=j(n,["authConfig"]);return r!=null&&_(t,["authConfig"],az(e,r)),t}function oz(e,n){const t={};if(j(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");j(n,["googleSearch"])!=null&&_(t,["googleSearch"],K$());const a=j(n,["googleSearchRetrieval"]);if(a!=null&&_(t,["googleSearchRetrieval"],tz(e,a)),j(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(j(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const o=j(n,["codeExecution"]);o!=null&&_(t,["codeExecution"],o);const l=j(n,["functionDeclarations"]);return l!=null&&_(t,["functionDeclarations"],l),t}function lz(e,n){const t={},r=j(n,["retrieval"]);r!=null&&_(t,["retrieval"],r),j(n,["googleSearch"])!=null&&_(t,["googleSearch"],X$());const o=j(n,["googleSearchRetrieval"]);o!=null&&_(t,["googleSearchRetrieval"],nz(e,o)),j(n,["enterpriseWebSearch"])!=null&&_(t,["enterpriseWebSearch"],iz());const h=j(n,["googleMaps"]);h!=null&&_(t,["googleMaps"],sz(e,h));const d=j(n,["codeExecution"]);d!=null&&_(t,["codeExecution"],d);const u=j(n,["functionDeclarations"]);return u!=null&&_(t,["functionDeclarations"],u),t}function cz(e,n){const t={},r=j(n,["handle"]);if(r!=null&&_(t,["handle"],r),j(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return t}function uz(e,n){const t={},r=j(n,["handle"]);r!=null&&_(t,["handle"],r);const a=j(n,["transparent"]);return a!=null&&_(t,["transparent"],a),t}function xj(){return{}}function bj(){return{}}function dz(e,n){const t={},r=j(n,["disabled"]);r!=null&&_(t,["disabled"],r);const a=j(n,["startOfSpeechSensitivity"]);a!=null&&_(t,["startOfSpeechSensitivity"],a);const o=j(n,["endOfSpeechSensitivity"]);o!=null&&_(t,["endOfSpeechSensitivity"],o);const l=j(n,["prefixPaddingMs"]);l!=null&&_(t,["prefixPaddingMs"],l);const h=j(n,["silenceDurationMs"]);return h!=null&&_(t,["silenceDurationMs"],h),t}function hz(e,n){const t={},r=j(n,["disabled"]);r!=null&&_(t,["disabled"],r);const a=j(n,["startOfSpeechSensitivity"]);a!=null&&_(t,["startOfSpeechSensitivity"],a);const o=j(n,["endOfSpeechSensitivity"]);o!=null&&_(t,["endOfSpeechSensitivity"],o);const l=j(n,["prefixPaddingMs"]);l!=null&&_(t,["prefixPaddingMs"],l);const h=j(n,["silenceDurationMs"]);return h!=null&&_(t,["silenceDurationMs"],h),t}function fz(e,n){const t={},r=j(n,["automaticActivityDetection"]);r!=null&&_(t,["automaticActivityDetection"],dz(e,r));const a=j(n,["activityHandling"]);a!=null&&_(t,["activityHandling"],a);const o=j(n,["turnCoverage"]);return o!=null&&_(t,["turnCoverage"],o),t}function pz(e,n){const t={},r=j(n,["automaticActivityDetection"]);r!=null&&_(t,["automaticActivityDetection"],hz(e,r));const a=j(n,["activityHandling"]);a!=null&&_(t,["activityHandling"],a);const o=j(n,["turnCoverage"]);return o!=null&&_(t,["turnCoverage"],o),t}function mz(e,n){const t={},r=j(n,["targetTokens"]);return r!=null&&_(t,["targetTokens"],r),t}function gz(e,n){const t={},r=j(n,["targetTokens"]);return r!=null&&_(t,["targetTokens"],r),t}function yz(e,n){const t={},r=j(n,["triggerTokens"]);r!=null&&_(t,["triggerTokens"],r);const a=j(n,["slidingWindow"]);return a!=null&&_(t,["slidingWindow"],mz(e,a)),t}function xz(e,n){const t={},r=j(n,["triggerTokens"]);r!=null&&_(t,["triggerTokens"],r);const a=j(n,["slidingWindow"]);return a!=null&&_(t,["slidingWindow"],gz(e,a)),t}function bz(e,n,t){const r={},a=j(n,["generationConfig"]);t!==void 0&&a!=null&&_(t,["setup","generationConfig"],a);const o=j(n,["responseModalities"]);t!==void 0&&o!=null&&_(t,["setup","generationConfig","responseModalities"],o);const l=j(n,["temperature"]);t!==void 0&&l!=null&&_(t,["setup","generationConfig","temperature"],l);const h=j(n,["topP"]);t!==void 0&&h!=null&&_(t,["setup","generationConfig","topP"],h);const d=j(n,["topK"]);t!==void 0&&d!=null&&_(t,["setup","generationConfig","topK"],d);const u=j(n,["maxOutputTokens"]);t!==void 0&&u!=null&&_(t,["setup","generationConfig","maxOutputTokens"],u);const f=j(n,["mediaResolution"]);t!==void 0&&f!=null&&_(t,["setup","generationConfig","mediaResolution"],f);const g=j(n,["seed"]);t!==void 0&&g!=null&&_(t,["setup","generationConfig","seed"],g);const b=j(n,["speechConfig"]);t!==void 0&&b!=null&&_(t,["setup","generationConfig","speechConfig"],b);const v=j(n,["systemInstruction"]);t!==void 0&&v!=null&&_(t,["setup","systemInstruction"],Q$(e,Pa(e,v)));const S=j(n,["tools"]);if(t!==void 0&&S!=null){let q=Bb(e,S);Array.isArray(q)&&(q=q.map(L=>oz(e,zb(e,L)))),_(t,["setup","tools"],q)}const T=j(n,["sessionResumption"]);t!==void 0&&T!=null&&_(t,["setup","sessionResumption"],cz(e,T));const E=j(n,["inputAudioTranscription"]);t!==void 0&&E!=null&&_(t,["setup","inputAudioTranscription"],xj());const C=j(n,["outputAudioTranscription"]);t!==void 0&&C!=null&&_(t,["setup","outputAudioTranscription"],xj());const P=j(n,["realtimeInputConfig"]);t!==void 0&&P!=null&&_(t,["setup","realtimeInputConfig"],fz(e,P));const I=j(n,["contextWindowCompression"]);return t!==void 0&&I!=null&&_(t,["setup","contextWindowCompression"],yz(e,I)),r}function vz(e,n,t){const r={},a=j(n,["generationConfig"]);t!==void 0&&a!=null&&_(t,["setup","generationConfig"],a);const o=j(n,["responseModalities"]);t!==void 0&&o!=null&&_(t,["setup","generationConfig","responseModalities"],o);const l=j(n,["temperature"]);t!==void 0&&l!=null&&_(t,["setup","generationConfig","temperature"],l);const h=j(n,["topP"]);t!==void 0&&h!=null&&_(t,["setup","generationConfig","topP"],h);const d=j(n,["topK"]);t!==void 0&&d!=null&&_(t,["setup","generationConfig","topK"],d);const u=j(n,["maxOutputTokens"]);t!==void 0&&u!=null&&_(t,["setup","generationConfig","maxOutputTokens"],u);const f=j(n,["mediaResolution"]);t!==void 0&&f!=null&&_(t,["setup","generationConfig","mediaResolution"],f);const g=j(n,["seed"]);t!==void 0&&g!=null&&_(t,["setup","generationConfig","seed"],g);const b=j(n,["speechConfig"]);t!==void 0&&b!=null&&_(t,["setup","generationConfig","speechConfig"],b);const v=j(n,["systemInstruction"]);t!==void 0&&v!=null&&_(t,["setup","systemInstruction"],J$(e,Pa(e,v)));const S=j(n,["tools"]);if(t!==void 0&&S!=null){let q=Bb(e,S);Array.isArray(q)&&(q=q.map(L=>lz(e,zb(e,L)))),_(t,["setup","tools"],q)}const T=j(n,["sessionResumption"]);t!==void 0&&T!=null&&_(t,["setup","sessionResumption"],uz(e,T));const E=j(n,["inputAudioTranscription"]);t!==void 0&&E!=null&&_(t,["setup","inputAudioTranscription"],bj());const C=j(n,["outputAudioTranscription"]);t!==void 0&&C!=null&&_(t,["setup","outputAudioTranscription"],bj());const P=j(n,["realtimeInputConfig"]);t!==void 0&&P!=null&&_(t,["setup","realtimeInputConfig"],pz(e,P));const I=j(n,["contextWindowCompression"]);return t!==void 0&&I!=null&&_(t,["setup","contextWindowCompression"],xz(e,I)),r}function wz(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["setup","model"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],bz(e,a,t)),t}function Nz(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["setup","model"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],vz(e,a,t)),t}function Sz(){return{}}function jz(){return{}}function _z(){return{}}function Cz(){return{}}function kz(e,n){const t={},r=j(n,["media"]);r!=null&&_(t,["mediaChunks"],dk(e,r));const a=j(n,["audio"]);a!=null&&_(t,["audio"],C6(e,a));const o=j(n,["audioStreamEnd"]);o!=null&&_(t,["audioStreamEnd"],o);const l=j(n,["video"]);l!=null&&_(t,["video"],_6(e,l));const h=j(n,["text"]);return h!=null&&_(t,["text"],h),j(n,["activityStart"])!=null&&_(t,["activityStart"],Sz()),j(n,["activityEnd"])!=null&&_(t,["activityEnd"],_z()),t}function Tz(e,n){const t={},r=j(n,["media"]);if(r!=null&&_(t,["mediaChunks"],dk(e,r)),j(n,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const a=j(n,["audioStreamEnd"]);if(a!=null&&_(t,["audioStreamEnd"],a),j(n,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(j(n,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return j(n,["activityStart"])!=null&&_(t,["activityStart"],jz()),j(n,["activityEnd"])!=null&&_(t,["activityEnd"],Cz()),t}function Ez(){return{}}function Az(){return{}}function Dz(e,n){const t={},r=j(n,["data"]);r!=null&&_(t,["data"],r);const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function Pz(e,n){const t={},r=j(n,["displayName"]);r!=null&&_(t,["displayName"],r);const a=j(n,["data"]);a!=null&&_(t,["data"],a);const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function Iz(e,n){const t={},r=j(n,["thought"]);r!=null&&_(t,["thought"],r);const a=j(n,["inlineData"]);a!=null&&_(t,["inlineData"],Dz(e,a));const o=j(n,["codeExecutionResult"]);o!=null&&_(t,["codeExecutionResult"],o);const l=j(n,["executableCode"]);l!=null&&_(t,["executableCode"],l);const h=j(n,["fileData"]);h!=null&&_(t,["fileData"],h);const d=j(n,["functionCall"]);d!=null&&_(t,["functionCall"],d);const u=j(n,["functionResponse"]);u!=null&&_(t,["functionResponse"],u);const f=j(n,["text"]);return f!=null&&_(t,["text"],f),t}function Mz(e,n){const t={},r=j(n,["videoMetadata"]);r!=null&&_(t,["videoMetadata"],r);const a=j(n,["thought"]);a!=null&&_(t,["thought"],a);const o=j(n,["inlineData"]);o!=null&&_(t,["inlineData"],Pz(e,o));const l=j(n,["codeExecutionResult"]);l!=null&&_(t,["codeExecutionResult"],l);const h=j(n,["executableCode"]);h!=null&&_(t,["executableCode"],h);const d=j(n,["fileData"]);d!=null&&_(t,["fileData"],d);const u=j(n,["functionCall"]);u!=null&&_(t,["functionCall"],u);const f=j(n,["functionResponse"]);f!=null&&_(t,["functionResponse"],f);const g=j(n,["text"]);return g!=null&&_(t,["text"],g),t}function Rz(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Iz(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function Oz(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Mz(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function vj(e,n){const t={},r=j(n,["text"]);r!=null&&_(t,["text"],r);const a=j(n,["finished"]);return a!=null&&_(t,["finished"],a),t}function wj(e,n){const t={},r=j(n,["text"]);r!=null&&_(t,["text"],r);const a=j(n,["finished"]);return a!=null&&_(t,["finished"],a),t}function Lz(e,n){const t={},r=j(n,["modelTurn"]);r!=null&&_(t,["modelTurn"],Rz(e,r));const a=j(n,["turnComplete"]);a!=null&&_(t,["turnComplete"],a);const o=j(n,["interrupted"]);o!=null&&_(t,["interrupted"],o);const l=j(n,["groundingMetadata"]);l!=null&&_(t,["groundingMetadata"],l);const h=j(n,["generationComplete"]);h!=null&&_(t,["generationComplete"],h);const d=j(n,["inputTranscription"]);d!=null&&_(t,["inputTranscription"],vj(e,d));const u=j(n,["outputTranscription"]);return u!=null&&_(t,["outputTranscription"],vj(e,u)),t}function Fz(e,n){const t={},r=j(n,["modelTurn"]);r!=null&&_(t,["modelTurn"],Oz(e,r));const a=j(n,["turnComplete"]);a!=null&&_(t,["turnComplete"],a);const o=j(n,["interrupted"]);o!=null&&_(t,["interrupted"],o);const l=j(n,["groundingMetadata"]);l!=null&&_(t,["groundingMetadata"],l);const h=j(n,["generationComplete"]);h!=null&&_(t,["generationComplete"],h);const d=j(n,["inputTranscription"]);d!=null&&_(t,["inputTranscription"],wj(e,d));const u=j(n,["outputTranscription"]);return u!=null&&_(t,["outputTranscription"],wj(e,u)),t}function $z(e,n){const t={},r=j(n,["id"]);r!=null&&_(t,["id"],r);const a=j(n,["args"]);a!=null&&_(t,["args"],a);const o=j(n,["name"]);return o!=null&&_(t,["name"],o),t}function zz(e,n){const t={},r=j(n,["args"]);r!=null&&_(t,["args"],r);const a=j(n,["name"]);return a!=null&&_(t,["name"],a),t}function Bz(e,n){const t={},r=j(n,["functionCalls"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>$z(e,o))),_(t,["functionCalls"],a)}return t}function Uz(e,n){const t={},r=j(n,["functionCalls"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>zz(e,o))),_(t,["functionCalls"],a)}return t}function qz(e,n){const t={},r=j(n,["ids"]);return r!=null&&_(t,["ids"],r),t}function Vz(e,n){const t={},r=j(n,["ids"]);return r!=null&&_(t,["ids"],r),t}function Tx(e,n){const t={},r=j(n,["modality"]);r!=null&&_(t,["modality"],r);const a=j(n,["tokenCount"]);return a!=null&&_(t,["tokenCount"],a),t}function Ex(e,n){const t={},r=j(n,["modality"]);r!=null&&_(t,["modality"],r);const a=j(n,["tokenCount"]);return a!=null&&_(t,["tokenCount"],a),t}function Hz(e,n){const t={},r=j(n,["promptTokenCount"]);r!=null&&_(t,["promptTokenCount"],r);const a=j(n,["cachedContentTokenCount"]);a!=null&&_(t,["cachedContentTokenCount"],a);const o=j(n,["responseTokenCount"]);o!=null&&_(t,["responseTokenCount"],o);const l=j(n,["toolUsePromptTokenCount"]);l!=null&&_(t,["toolUsePromptTokenCount"],l);const h=j(n,["thoughtsTokenCount"]);h!=null&&_(t,["thoughtsTokenCount"],h);const d=j(n,["totalTokenCount"]);d!=null&&_(t,["totalTokenCount"],d);const u=j(n,["promptTokensDetails"]);if(u!=null){let v=u;Array.isArray(v)&&(v=v.map(S=>Tx(e,S))),_(t,["promptTokensDetails"],v)}const f=j(n,["cacheTokensDetails"]);if(f!=null){let v=f;Array.isArray(v)&&(v=v.map(S=>Tx(e,S))),_(t,["cacheTokensDetails"],v)}const g=j(n,["responseTokensDetails"]);if(g!=null){let v=g;Array.isArray(v)&&(v=v.map(S=>Tx(e,S))),_(t,["responseTokensDetails"],v)}const b=j(n,["toolUsePromptTokensDetails"]);if(b!=null){let v=b;Array.isArray(v)&&(v=v.map(S=>Tx(e,S))),_(t,["toolUsePromptTokensDetails"],v)}return t}function Gz(e,n){const t={},r=j(n,["promptTokenCount"]);r!=null&&_(t,["promptTokenCount"],r);const a=j(n,["cachedContentTokenCount"]);a!=null&&_(t,["cachedContentTokenCount"],a);const o=j(n,["candidatesTokenCount"]);o!=null&&_(t,["responseTokenCount"],o);const l=j(n,["toolUsePromptTokenCount"]);l!=null&&_(t,["toolUsePromptTokenCount"],l);const h=j(n,["thoughtsTokenCount"]);h!=null&&_(t,["thoughtsTokenCount"],h);const d=j(n,["totalTokenCount"]);d!=null&&_(t,["totalTokenCount"],d);const u=j(n,["promptTokensDetails"]);if(u!=null){let S=u;Array.isArray(S)&&(S=S.map(T=>Ex(e,T))),_(t,["promptTokensDetails"],S)}const f=j(n,["cacheTokensDetails"]);if(f!=null){let S=f;Array.isArray(S)&&(S=S.map(T=>Ex(e,T))),_(t,["cacheTokensDetails"],S)}const g=j(n,["candidatesTokensDetails"]);if(g!=null){let S=g;Array.isArray(S)&&(S=S.map(T=>Ex(e,T))),_(t,["responseTokensDetails"],S)}const b=j(n,["toolUsePromptTokensDetails"]);if(b!=null){let S=b;Array.isArray(S)&&(S=S.map(T=>Ex(e,T))),_(t,["toolUsePromptTokensDetails"],S)}const v=j(n,["trafficType"]);return v!=null&&_(t,["trafficType"],v),t}function Yz(e,n){const t={},r=j(n,["timeLeft"]);return r!=null&&_(t,["timeLeft"],r),t}function Wz(e,n){const t={},r=j(n,["timeLeft"]);return r!=null&&_(t,["timeLeft"],r),t}function Qz(e,n){const t={},r=j(n,["newHandle"]);r!=null&&_(t,["newHandle"],r);const a=j(n,["resumable"]);a!=null&&_(t,["resumable"],a);const o=j(n,["lastConsumedClientMessageIndex"]);return o!=null&&_(t,["lastConsumedClientMessageIndex"],o),t}function Jz(e,n){const t={},r=j(n,["newHandle"]);r!=null&&_(t,["newHandle"],r);const a=j(n,["resumable"]);a!=null&&_(t,["resumable"],a);const o=j(n,["lastConsumedClientMessageIndex"]);return o!=null&&_(t,["lastConsumedClientMessageIndex"],o),t}function Kz(e,n){const t={};j(n,["setupComplete"])!=null&&_(t,["setupComplete"],Ez());const a=j(n,["serverContent"]);a!=null&&_(t,["serverContent"],Lz(e,a));const o=j(n,["toolCall"]);o!=null&&_(t,["toolCall"],Bz(e,o));const l=j(n,["toolCallCancellation"]);l!=null&&_(t,["toolCallCancellation"],qz(e,l));const h=j(n,["usageMetadata"]);h!=null&&_(t,["usageMetadata"],Hz(e,h));const d=j(n,["goAway"]);d!=null&&_(t,["goAway"],Yz(e,d));const u=j(n,["sessionResumptionUpdate"]);return u!=null&&_(t,["sessionResumptionUpdate"],Qz(e,u)),t}function Xz(e,n){const t={};j(n,["setupComplete"])!=null&&_(t,["setupComplete"],Az());const a=j(n,["serverContent"]);a!=null&&_(t,["serverContent"],Fz(e,a));const o=j(n,["toolCall"]);o!=null&&_(t,["toolCall"],Uz(e,o));const l=j(n,["toolCallCancellation"]);l!=null&&_(t,["toolCallCancellation"],Vz(e,l));const h=j(n,["usageMetadata"]);h!=null&&_(t,["usageMetadata"],Gz(e,h));const d=j(n,["goAway"]);d!=null&&_(t,["goAway"],Wz(e,d));const u=j(n,["sessionResumptionUpdate"]);return u!=null&&_(t,["sessionResumptionUpdate"],Jz(e,u)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Zz(e,n){const t={};if(j(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const r=j(n,["data"]);r!=null&&_(t,["data"],r);const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function e8(e,n){const t={};if(j(n,["videoMetadata"])!==void 0)throw new Error("videoMetadata parameter is not supported in Gemini API.");const r=j(n,["thought"]);r!=null&&_(t,["thought"],r);const a=j(n,["inlineData"]);a!=null&&_(t,["inlineData"],Zz(e,a));const o=j(n,["codeExecutionResult"]);o!=null&&_(t,["codeExecutionResult"],o);const l=j(n,["executableCode"]);l!=null&&_(t,["executableCode"],l);const h=j(n,["fileData"]);h!=null&&_(t,["fileData"],h);const d=j(n,["functionCall"]);d!=null&&_(t,["functionCall"],d);const u=j(n,["functionResponse"]);u!=null&&_(t,["functionResponse"],u);const f=j(n,["text"]);return f!=null&&_(t,["text"],f),t}function qb(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>e8(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function t8(e,n){const t={};if(j(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const r=j(n,["category"]);r!=null&&_(t,["category"],r);const a=j(n,["threshold"]);return a!=null&&_(t,["threshold"],a),t}function n8(){return{}}function i8(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function r8(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],i8(e,r)),t}function a8(e,n){const t={};if(j(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");j(n,["googleSearch"])!=null&&_(t,["googleSearch"],n8());const a=j(n,["googleSearchRetrieval"]);if(a!=null&&_(t,["googleSearchRetrieval"],r8(e,a)),j(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(j(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");const o=j(n,["codeExecution"]);o!=null&&_(t,["codeExecution"],o);const l=j(n,["functionDeclarations"]);return l!=null&&_(t,["functionDeclarations"],l),t}function s8(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["allowedFunctionNames"]);return a!=null&&_(t,["allowedFunctionNames"],a),t}function o8(e,n){const t={},r=j(n,["functionCallingConfig"]);if(r!=null&&_(t,["functionCallingConfig"],s8(e,r)),j(n,["retrievalConfig"])!==void 0)throw new Error("retrievalConfig parameter is not supported in Gemini API.");return t}function l8(e,n){const t={},r=j(n,["voiceName"]);return r!=null&&_(t,["voiceName"],r),t}function c8(e,n){const t={},r=j(n,["prebuiltVoiceConfig"]);return r!=null&&_(t,["prebuiltVoiceConfig"],l8(e,r)),t}function u8(e,n){const t={},r=j(n,["voiceConfig"]);r!=null&&_(t,["voiceConfig"],c8(e,r));const a=j(n,["languageCode"]);return a!=null&&_(t,["languageCode"],a),t}function d8(e,n){const t={},r=j(n,["includeThoughts"]);r!=null&&_(t,["includeThoughts"],r);const a=j(n,["thinkingBudget"]);return a!=null&&_(t,["thinkingBudget"],a),t}function h8(e,n,t){const r={},a=j(n,["systemInstruction"]);t!==void 0&&a!=null&&_(t,["systemInstruction"],qb(e,Pa(e,a)));const o=j(n,["temperature"]);o!=null&&_(r,["temperature"],o);const l=j(n,["topP"]);l!=null&&_(r,["topP"],l);const h=j(n,["topK"]);h!=null&&_(r,["topK"],h);const d=j(n,["candidateCount"]);d!=null&&_(r,["candidateCount"],d);const u=j(n,["maxOutputTokens"]);u!=null&&_(r,["maxOutputTokens"],u);const f=j(n,["stopSequences"]);f!=null&&_(r,["stopSequences"],f);const g=j(n,["responseLogprobs"]);g!=null&&_(r,["responseLogprobs"],g);const b=j(n,["logprobs"]);b!=null&&_(r,["logprobs"],b);const v=j(n,["presencePenalty"]);v!=null&&_(r,["presencePenalty"],v);const S=j(n,["frequencyPenalty"]);S!=null&&_(r,["frequencyPenalty"],S);const T=j(n,["seed"]);T!=null&&_(r,["seed"],T);const E=j(n,["responseMimeType"]);E!=null&&_(r,["responseMimeType"],E);const C=j(n,["responseSchema"]);if(C!=null&&_(r,["responseSchema"],pk(e,C)),j(n,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(j(n,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const P=j(n,["safetySettings"]);if(t!==void 0&&P!=null){let z=P;Array.isArray(z)&&(z=z.map(U=>t8(e,U))),_(t,["safetySettings"],z)}const I=j(n,["tools"]);if(t!==void 0&&I!=null){let z=Bb(e,I);Array.isArray(z)&&(z=z.map(U=>a8(e,zb(e,U)))),_(t,["tools"],z)}const q=j(n,["toolConfig"]);if(t!==void 0&&q!=null&&_(t,["toolConfig"],o8(e,q)),j(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const L=j(n,["cachedContent"]);t!==void 0&&L!=null&&_(t,["cachedContent"],Eu(e,L));const O=j(n,["responseModalities"]);O!=null&&_(r,["responseModalities"],O);const B=j(n,["mediaResolution"]);B!=null&&_(r,["mediaResolution"],B);const $=j(n,["speechConfig"]);if($!=null&&_(r,["speechConfig"],u8(e,mk(e,$))),j(n,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const F=j(n,["thinkingConfig"]);return F!=null&&_(r,["thinkingConfig"],d8(e,F)),r}function Nj(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);if(a!=null){let l=Tu(e,a);Array.isArray(l)&&(l=l.map(h=>qb(e,h))),_(t,["contents"],l)}const o=j(n,["config"]);return o!=null&&_(t,["generationConfig"],h8(e,o,t)),t}function f8(e,n,t){const r={},a=j(n,["taskType"]);t!==void 0&&a!=null&&_(t,["requests[]","taskType"],a);const o=j(n,["title"]);t!==void 0&&o!=null&&_(t,["requests[]","title"],o);const l=j(n,["outputDimensionality"]);if(t!==void 0&&l!=null&&_(t,["requests[]","outputDimensionality"],l),j(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(j(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return r}function p8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);a!=null&&_(t,["requests[]","content"],fk(e,a));const o=j(n,["config"]);o!=null&&_(t,["config"],f8(e,o,t));const l=j(n,["model"]);return l!==void 0&&_(t,["requests[]","model"],Ii(e,l)),t}function m8(e,n,t){const r={};if(j(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(j(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const a=j(n,["numberOfImages"]);t!==void 0&&a!=null&&_(t,["parameters","sampleCount"],a);const o=j(n,["aspectRatio"]);t!==void 0&&o!=null&&_(t,["parameters","aspectRatio"],o);const l=j(n,["guidanceScale"]);if(t!==void 0&&l!=null&&_(t,["parameters","guidanceScale"],l),j(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const h=j(n,["safetyFilterLevel"]);t!==void 0&&h!=null&&_(t,["parameters","safetySetting"],h);const d=j(n,["personGeneration"]);t!==void 0&&d!=null&&_(t,["parameters","personGeneration"],d);const u=j(n,["includeSafetyAttributes"]);t!==void 0&&u!=null&&_(t,["parameters","includeSafetyAttributes"],u);const f=j(n,["includeRaiReason"]);t!==void 0&&f!=null&&_(t,["parameters","includeRaiReason"],f);const g=j(n,["language"]);t!==void 0&&g!=null&&_(t,["parameters","language"],g);const b=j(n,["outputMimeType"]);t!==void 0&&b!=null&&_(t,["parameters","outputOptions","mimeType"],b);const v=j(n,["outputCompressionQuality"]);if(t!==void 0&&v!=null&&_(t,["parameters","outputOptions","compressionQuality"],v),j(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(j(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return r}function g8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["prompt"]);a!=null&&_(t,["instances[0]","prompt"],a);const o=j(n,["config"]);return o!=null&&_(t,["config"],m8(e,o,t)),t}function y8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","name"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function x8(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);t!==void 0&&o!=null&&_(t,["_query","pageToken"],o);const l=j(n,["filter"]);t!==void 0&&l!=null&&_(t,["_query","filter"],l);const h=j(n,["queryBase"]);return t!==void 0&&h!=null&&_(t,["_url","models_url"],xk(e,h)),r}function b8(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],x8(e,r,t)),t}function v8(e,n,t){const r={},a=j(n,["displayName"]);t!==void 0&&a!=null&&_(t,["displayName"],a);const o=j(n,["description"]);t!==void 0&&o!=null&&_(t,["description"],o);const l=j(n,["defaultCheckpointId"]);return t!==void 0&&l!=null&&_(t,["defaultCheckpointId"],l),r}function w8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","name"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],v8(e,a,t)),t}function N8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","name"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function S8(e,n){const t={};if(j(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(j(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(j(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function j8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);if(a!=null){let l=Tu(e,a);Array.isArray(l)&&(l=l.map(h=>qb(e,h))),_(t,["contents"],l)}const o=j(n,["config"]);return o!=null&&_(t,["config"],S8(e,o)),t}function _8(e,n){const t={};if(j(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const r=j(n,["imageBytes"]);r!=null&&_(t,["bytesBase64Encoded"],Au(e,r));const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function C8(e,n,t){const r={},a=j(n,["numberOfVideos"]);if(t!==void 0&&a!=null&&_(t,["parameters","sampleCount"],a),j(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(j(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=j(n,["durationSeconds"]);if(t!==void 0&&o!=null&&_(t,["parameters","durationSeconds"],o),j(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=j(n,["aspectRatio"]);if(t!==void 0&&l!=null&&_(t,["parameters","aspectRatio"],l),j(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const h=j(n,["personGeneration"]);if(t!==void 0&&h!=null&&_(t,["parameters","personGeneration"],h),j(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=j(n,["negativePrompt"]);if(t!==void 0&&d!=null&&_(t,["parameters","negativePrompt"],d),j(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return r}function k8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["prompt"]);a!=null&&_(t,["instances[0]","prompt"],a);const o=j(n,["image"]);o!=null&&_(t,["instances[0]","image"],_8(e,o));const l=j(n,["config"]);return l!=null&&_(t,["config"],C8(e,l,t)),t}function T8(e,n){const t={},r=j(n,["displayName"]);r!=null&&_(t,["displayName"],r);const a=j(n,["data"]);a!=null&&_(t,["data"],a);const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function E8(e,n){const t={},r=j(n,["videoMetadata"]);r!=null&&_(t,["videoMetadata"],r);const a=j(n,["thought"]);a!=null&&_(t,["thought"],a);const o=j(n,["inlineData"]);o!=null&&_(t,["inlineData"],T8(e,o));const l=j(n,["codeExecutionResult"]);l!=null&&_(t,["codeExecutionResult"],l);const h=j(n,["executableCode"]);h!=null&&_(t,["executableCode"],h);const d=j(n,["fileData"]);d!=null&&_(t,["fileData"],d);const u=j(n,["functionCall"]);u!=null&&_(t,["functionCall"],u);const f=j(n,["functionResponse"]);f!=null&&_(t,["functionResponse"],f);const g=j(n,["text"]);return g!=null&&_(t,["text"],g),t}function dp(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>E8(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function A8(e,n){const t={},r=j(n,["featureSelectionPreference"]);return r!=null&&_(t,["featureSelectionPreference"],r),t}function D8(e,n){const t={},r=j(n,["method"]);r!=null&&_(t,["method"],r);const a=j(n,["category"]);a!=null&&_(t,["category"],a);const o=j(n,["threshold"]);return o!=null&&_(t,["threshold"],o),t}function P8(){return{}}function I8(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["dynamicThreshold"]);return a!=null&&_(t,["dynamicThreshold"],a),t}function M8(e,n){const t={},r=j(n,["dynamicRetrievalConfig"]);return r!=null&&_(t,["dynamicRetrievalConfig"],I8(e,r)),t}function R8(){return{}}function O8(e,n){const t={},r=j(n,["apiKeyString"]);return r!=null&&_(t,["apiKeyString"],r),t}function L8(e,n){const t={},r=j(n,["apiKeyConfig"]);r!=null&&_(t,["apiKeyConfig"],O8(e,r));const a=j(n,["authType"]);a!=null&&_(t,["authType"],a);const o=j(n,["googleServiceAccountConfig"]);o!=null&&_(t,["googleServiceAccountConfig"],o);const l=j(n,["httpBasicAuthConfig"]);l!=null&&_(t,["httpBasicAuthConfig"],l);const h=j(n,["oauthConfig"]);h!=null&&_(t,["oauthConfig"],h);const d=j(n,["oidcConfig"]);return d!=null&&_(t,["oidcConfig"],d),t}function F8(e,n){const t={},r=j(n,["authConfig"]);return r!=null&&_(t,["authConfig"],L8(e,r)),t}function wk(e,n){const t={},r=j(n,["retrieval"]);r!=null&&_(t,["retrieval"],r),j(n,["googleSearch"])!=null&&_(t,["googleSearch"],P8());const o=j(n,["googleSearchRetrieval"]);o!=null&&_(t,["googleSearchRetrieval"],M8(e,o)),j(n,["enterpriseWebSearch"])!=null&&_(t,["enterpriseWebSearch"],R8());const h=j(n,["googleMaps"]);h!=null&&_(t,["googleMaps"],F8(e,h));const d=j(n,["codeExecution"]);d!=null&&_(t,["codeExecution"],d);const u=j(n,["functionDeclarations"]);return u!=null&&_(t,["functionDeclarations"],u),t}function $8(e,n){const t={},r=j(n,["mode"]);r!=null&&_(t,["mode"],r);const a=j(n,["allowedFunctionNames"]);return a!=null&&_(t,["allowedFunctionNames"],a),t}function z8(e,n){const t={},r=j(n,["latitude"]);r!=null&&_(t,["latitude"],r);const a=j(n,["longitude"]);return a!=null&&_(t,["longitude"],a),t}function B8(e,n){const t={},r=j(n,["latLng"]);return r!=null&&_(t,["latLng"],z8(e,r)),t}function U8(e,n){const t={},r=j(n,["functionCallingConfig"]);r!=null&&_(t,["functionCallingConfig"],$8(e,r));const a=j(n,["retrievalConfig"]);return a!=null&&_(t,["retrievalConfig"],B8(e,a)),t}function q8(e,n){const t={},r=j(n,["voiceName"]);return r!=null&&_(t,["voiceName"],r),t}function V8(e,n){const t={},r=j(n,["prebuiltVoiceConfig"]);return r!=null&&_(t,["prebuiltVoiceConfig"],q8(e,r)),t}function H8(e,n){const t={},r=j(n,["voiceConfig"]);r!=null&&_(t,["voiceConfig"],V8(e,r));const a=j(n,["languageCode"]);return a!=null&&_(t,["languageCode"],a),t}function G8(e,n){const t={},r=j(n,["includeThoughts"]);r!=null&&_(t,["includeThoughts"],r);const a=j(n,["thinkingBudget"]);return a!=null&&_(t,["thinkingBudget"],a),t}function Y8(e,n,t){const r={},a=j(n,["systemInstruction"]);t!==void 0&&a!=null&&_(t,["systemInstruction"],dp(e,Pa(e,a)));const o=j(n,["temperature"]);o!=null&&_(r,["temperature"],o);const l=j(n,["topP"]);l!=null&&_(r,["topP"],l);const h=j(n,["topK"]);h!=null&&_(r,["topK"],h);const d=j(n,["candidateCount"]);d!=null&&_(r,["candidateCount"],d);const u=j(n,["maxOutputTokens"]);u!=null&&_(r,["maxOutputTokens"],u);const f=j(n,["stopSequences"]);f!=null&&_(r,["stopSequences"],f);const g=j(n,["responseLogprobs"]);g!=null&&_(r,["responseLogprobs"],g);const b=j(n,["logprobs"]);b!=null&&_(r,["logprobs"],b);const v=j(n,["presencePenalty"]);v!=null&&_(r,["presencePenalty"],v);const S=j(n,["frequencyPenalty"]);S!=null&&_(r,["frequencyPenalty"],S);const T=j(n,["seed"]);T!=null&&_(r,["seed"],T);const E=j(n,["responseMimeType"]);E!=null&&_(r,["responseMimeType"],E);const C=j(n,["responseSchema"]);C!=null&&_(r,["responseSchema"],pk(e,C));const P=j(n,["routingConfig"]);P!=null&&_(r,["routingConfig"],P);const I=j(n,["modelSelectionConfig"]);I!=null&&_(r,["modelConfig"],A8(e,I));const q=j(n,["safetySettings"]);if(t!==void 0&&q!=null){let ie=q;Array.isArray(ie)&&(ie=ie.map(ae=>D8(e,ae))),_(t,["safetySettings"],ie)}const L=j(n,["tools"]);if(t!==void 0&&L!=null){let ie=Bb(e,L);Array.isArray(ie)&&(ie=ie.map(ae=>wk(e,zb(e,ae)))),_(t,["tools"],ie)}const O=j(n,["toolConfig"]);t!==void 0&&O!=null&&_(t,["toolConfig"],U8(e,O));const B=j(n,["labels"]);t!==void 0&&B!=null&&_(t,["labels"],B);const $=j(n,["cachedContent"]);t!==void 0&&$!=null&&_(t,["cachedContent"],Eu(e,$));const F=j(n,["responseModalities"]);F!=null&&_(r,["responseModalities"],F);const z=j(n,["mediaResolution"]);z!=null&&_(r,["mediaResolution"],z);const U=j(n,["speechConfig"]);U!=null&&_(r,["speechConfig"],H8(e,mk(e,U)));const V=j(n,["audioTimestamp"]);V!=null&&_(r,["audioTimestamp"],V);const ee=j(n,["thinkingConfig"]);return ee!=null&&_(r,["thinkingConfig"],G8(e,ee)),r}function Sj(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);if(a!=null){let l=Tu(e,a);Array.isArray(l)&&(l=l.map(h=>dp(e,h))),_(t,["contents"],l)}const o=j(n,["config"]);return o!=null&&_(t,["generationConfig"],Y8(e,o,t)),t}function W8(e,n,t){const r={},a=j(n,["taskType"]);t!==void 0&&a!=null&&_(t,["instances[]","task_type"],a);const o=j(n,["title"]);t!==void 0&&o!=null&&_(t,["instances[]","title"],o);const l=j(n,["outputDimensionality"]);t!==void 0&&l!=null&&_(t,["parameters","outputDimensionality"],l);const h=j(n,["mimeType"]);t!==void 0&&h!=null&&_(t,["instances[]","mimeType"],h);const d=j(n,["autoTruncate"]);return t!==void 0&&d!=null&&_(t,["parameters","autoTruncate"],d),r}function Q8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);a!=null&&_(t,["instances[]","content"],fk(e,a));const o=j(n,["config"]);return o!=null&&_(t,["config"],W8(e,o,t)),t}function J8(e,n,t){const r={},a=j(n,["outputGcsUri"]);t!==void 0&&a!=null&&_(t,["parameters","storageUri"],a);const o=j(n,["negativePrompt"]);t!==void 0&&o!=null&&_(t,["parameters","negativePrompt"],o);const l=j(n,["numberOfImages"]);t!==void 0&&l!=null&&_(t,["parameters","sampleCount"],l);const h=j(n,["aspectRatio"]);t!==void 0&&h!=null&&_(t,["parameters","aspectRatio"],h);const d=j(n,["guidanceScale"]);t!==void 0&&d!=null&&_(t,["parameters","guidanceScale"],d);const u=j(n,["seed"]);t!==void 0&&u!=null&&_(t,["parameters","seed"],u);const f=j(n,["safetyFilterLevel"]);t!==void 0&&f!=null&&_(t,["parameters","safetySetting"],f);const g=j(n,["personGeneration"]);t!==void 0&&g!=null&&_(t,["parameters","personGeneration"],g);const b=j(n,["includeSafetyAttributes"]);t!==void 0&&b!=null&&_(t,["parameters","includeSafetyAttributes"],b);const v=j(n,["includeRaiReason"]);t!==void 0&&v!=null&&_(t,["parameters","includeRaiReason"],v);const S=j(n,["language"]);t!==void 0&&S!=null&&_(t,["parameters","language"],S);const T=j(n,["outputMimeType"]);t!==void 0&&T!=null&&_(t,["parameters","outputOptions","mimeType"],T);const E=j(n,["outputCompressionQuality"]);t!==void 0&&E!=null&&_(t,["parameters","outputOptions","compressionQuality"],E);const C=j(n,["addWatermark"]);t!==void 0&&C!=null&&_(t,["parameters","addWatermark"],C);const P=j(n,["enhancePrompt"]);return t!==void 0&&P!=null&&_(t,["parameters","enhancePrompt"],P),r}function K8(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["prompt"]);a!=null&&_(t,["instances[0]","prompt"],a);const o=j(n,["config"]);return o!=null&&_(t,["config"],J8(e,o,t)),t}function Ow(e,n){const t={},r=j(n,["gcsUri"]);r!=null&&_(t,["gcsUri"],r);const a=j(n,["imageBytes"]);a!=null&&_(t,["bytesBase64Encoded"],Au(e,a));const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function X8(e,n){const t={},r=j(n,["maskMode"]);r!=null&&_(t,["maskMode"],r);const a=j(n,["segmentationClasses"]);a!=null&&_(t,["maskClasses"],a);const o=j(n,["maskDilation"]);return o!=null&&_(t,["dilation"],o),t}function Z8(e,n){const t={},r=j(n,["controlType"]);r!=null&&_(t,["controlType"],r);const a=j(n,["enableControlImageComputation"]);return a!=null&&_(t,["computeControl"],a),t}function eB(e,n){const t={},r=j(n,["styleDescription"]);return r!=null&&_(t,["styleDescription"],r),t}function tB(e,n){const t={},r=j(n,["subjectType"]);r!=null&&_(t,["subjectType"],r);const a=j(n,["subjectDescription"]);return a!=null&&_(t,["subjectDescription"],a),t}function nB(e,n){const t={},r=j(n,["referenceImage"]);r!=null&&_(t,["referenceImage"],Ow(e,r));const a=j(n,["referenceId"]);a!=null&&_(t,["referenceId"],a);const o=j(n,["referenceType"]);o!=null&&_(t,["referenceType"],o);const l=j(n,["maskImageConfig"]);l!=null&&_(t,["maskImageConfig"],X8(e,l));const h=j(n,["controlImageConfig"]);h!=null&&_(t,["controlImageConfig"],Z8(e,h));const d=j(n,["styleImageConfig"]);d!=null&&_(t,["styleImageConfig"],eB(e,d));const u=j(n,["subjectImageConfig"]);return u!=null&&_(t,["subjectImageConfig"],tB(e,u)),t}function iB(e,n,t){const r={},a=j(n,["outputGcsUri"]);t!==void 0&&a!=null&&_(t,["parameters","storageUri"],a);const o=j(n,["negativePrompt"]);t!==void 0&&o!=null&&_(t,["parameters","negativePrompt"],o);const l=j(n,["numberOfImages"]);t!==void 0&&l!=null&&_(t,["parameters","sampleCount"],l);const h=j(n,["aspectRatio"]);t!==void 0&&h!=null&&_(t,["parameters","aspectRatio"],h);const d=j(n,["guidanceScale"]);t!==void 0&&d!=null&&_(t,["parameters","guidanceScale"],d);const u=j(n,["seed"]);t!==void 0&&u!=null&&_(t,["parameters","seed"],u);const f=j(n,["safetyFilterLevel"]);t!==void 0&&f!=null&&_(t,["parameters","safetySetting"],f);const g=j(n,["personGeneration"]);t!==void 0&&g!=null&&_(t,["parameters","personGeneration"],g);const b=j(n,["includeSafetyAttributes"]);t!==void 0&&b!=null&&_(t,["parameters","includeSafetyAttributes"],b);const v=j(n,["includeRaiReason"]);t!==void 0&&v!=null&&_(t,["parameters","includeRaiReason"],v);const S=j(n,["language"]);t!==void 0&&S!=null&&_(t,["parameters","language"],S);const T=j(n,["outputMimeType"]);t!==void 0&&T!=null&&_(t,["parameters","outputOptions","mimeType"],T);const E=j(n,["outputCompressionQuality"]);t!==void 0&&E!=null&&_(t,["parameters","outputOptions","compressionQuality"],E);const C=j(n,["editMode"]);t!==void 0&&C!=null&&_(t,["parameters","editMode"],C);const P=j(n,["baseSteps"]);return t!==void 0&&P!=null&&_(t,["parameters","editConfig","baseSteps"],P),r}function rB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["prompt"]);a!=null&&_(t,["instances[0]","prompt"],a);const o=j(n,["referenceImages"]);if(o!=null){let h=o;Array.isArray(h)&&(h=h.map(d=>nB(e,d))),_(t,["instances[0]","referenceImages"],h)}const l=j(n,["config"]);return l!=null&&_(t,["config"],iB(e,l,t)),t}function aB(e,n,t){const r={},a=j(n,["includeRaiReason"]);t!==void 0&&a!=null&&_(t,["parameters","includeRaiReason"],a);const o=j(n,["outputMimeType"]);t!==void 0&&o!=null&&_(t,["parameters","outputOptions","mimeType"],o);const l=j(n,["outputCompressionQuality"]);t!==void 0&&l!=null&&_(t,["parameters","outputOptions","compressionQuality"],l);const h=j(n,["numberOfImages"]);t!==void 0&&h!=null&&_(t,["parameters","sampleCount"],h);const d=j(n,["mode"]);return t!==void 0&&d!=null&&_(t,["parameters","mode"],d),r}function sB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["image"]);a!=null&&_(t,["instances[0]","image"],Ow(e,a));const o=j(n,["upscaleFactor"]);o!=null&&_(t,["parameters","upscaleConfig","upscaleFactor"],o);const l=j(n,["config"]);return l!=null&&_(t,["config"],aB(e,l,t)),t}function oB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","name"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function lB(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);t!==void 0&&o!=null&&_(t,["_query","pageToken"],o);const l=j(n,["filter"]);t!==void 0&&l!=null&&_(t,["_query","filter"],l);const h=j(n,["queryBase"]);return t!==void 0&&h!=null&&_(t,["_url","models_url"],xk(e,h)),r}function cB(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],lB(e,r,t)),t}function uB(e,n,t){const r={},a=j(n,["displayName"]);t!==void 0&&a!=null&&_(t,["displayName"],a);const o=j(n,["description"]);t!==void 0&&o!=null&&_(t,["description"],o);const l=j(n,["defaultCheckpointId"]);return t!==void 0&&l!=null&&_(t,["defaultCheckpointId"],l),r}function dB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],uB(e,a,t)),t}function hB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","name"],Ii(e,r));const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function fB(e,n,t){const r={},a=j(n,["systemInstruction"]);t!==void 0&&a!=null&&_(t,["systemInstruction"],dp(e,Pa(e,a)));const o=j(n,["tools"]);if(t!==void 0&&o!=null){let h=o;Array.isArray(h)&&(h=h.map(d=>wk(e,d))),_(t,["tools"],h)}const l=j(n,["generationConfig"]);return t!==void 0&&l!=null&&_(t,["generationConfig"],l),r}function pB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);if(a!=null){let l=Tu(e,a);Array.isArray(l)&&(l=l.map(h=>dp(e,h))),_(t,["contents"],l)}const o=j(n,["config"]);return o!=null&&_(t,["config"],fB(e,o,t)),t}function mB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["contents"]);if(a!=null){let l=Tu(e,a);Array.isArray(l)&&(l=l.map(h=>dp(e,h))),_(t,["contents"],l)}const o=j(n,["config"]);return o!=null&&_(t,["config"],o),t}function gB(e,n,t){const r={},a=j(n,["numberOfVideos"]);t!==void 0&&a!=null&&_(t,["parameters","sampleCount"],a);const o=j(n,["outputGcsUri"]);t!==void 0&&o!=null&&_(t,["parameters","storageUri"],o);const l=j(n,["fps"]);t!==void 0&&l!=null&&_(t,["parameters","fps"],l);const h=j(n,["durationSeconds"]);t!==void 0&&h!=null&&_(t,["parameters","durationSeconds"],h);const d=j(n,["seed"]);t!==void 0&&d!=null&&_(t,["parameters","seed"],d);const u=j(n,["aspectRatio"]);t!==void 0&&u!=null&&_(t,["parameters","aspectRatio"],u);const f=j(n,["resolution"]);t!==void 0&&f!=null&&_(t,["parameters","resolution"],f);const g=j(n,["personGeneration"]);t!==void 0&&g!=null&&_(t,["parameters","personGeneration"],g);const b=j(n,["pubsubTopic"]);t!==void 0&&b!=null&&_(t,["parameters","pubsubTopic"],b);const v=j(n,["negativePrompt"]);t!==void 0&&v!=null&&_(t,["parameters","negativePrompt"],v);const S=j(n,["enhancePrompt"]);return t!==void 0&&S!=null&&_(t,["parameters","enhancePrompt"],S),r}function yB(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["_url","model"],Ii(e,r));const a=j(n,["prompt"]);a!=null&&_(t,["instances[0]","prompt"],a);const o=j(n,["image"]);o!=null&&_(t,["instances[0]","image"],Ow(e,o));const l=j(n,["config"]);return l!=null&&_(t,["config"],gB(e,l,t)),t}function xB(e,n){const t={},r=j(n,["data"]);r!=null&&_(t,["data"],r);const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function bB(e,n){const t={},r=j(n,["thought"]);r!=null&&_(t,["thought"],r);const a=j(n,["inlineData"]);a!=null&&_(t,["inlineData"],xB(e,a));const o=j(n,["codeExecutionResult"]);o!=null&&_(t,["codeExecutionResult"],o);const l=j(n,["executableCode"]);l!=null&&_(t,["executableCode"],l);const h=j(n,["fileData"]);h!=null&&_(t,["fileData"],h);const d=j(n,["functionCall"]);d!=null&&_(t,["functionCall"],d);const u=j(n,["functionResponse"]);u!=null&&_(t,["functionResponse"],u);const f=j(n,["text"]);return f!=null&&_(t,["text"],f),t}function vB(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>bB(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function wB(e,n){const t={},r=j(n,["citationSources"]);return r!=null&&_(t,["citations"],r),t}function NB(e,n){const t={},r=j(n,["content"]);r!=null&&_(t,["content"],vB(e,r));const a=j(n,["citationMetadata"]);a!=null&&_(t,["citationMetadata"],wB(e,a));const o=j(n,["tokenCount"]);o!=null&&_(t,["tokenCount"],o);const l=j(n,["finishReason"]);l!=null&&_(t,["finishReason"],l);const h=j(n,["avgLogprobs"]);h!=null&&_(t,["avgLogprobs"],h);const d=j(n,["groundingMetadata"]);d!=null&&_(t,["groundingMetadata"],d);const u=j(n,["index"]);u!=null&&_(t,["index"],u);const f=j(n,["logprobsResult"]);f!=null&&_(t,["logprobsResult"],f);const g=j(n,["safetyRatings"]);return g!=null&&_(t,["safetyRatings"],g),t}function jj(e,n){const t={},r=j(n,["candidates"]);if(r!=null){let h=r;Array.isArray(h)&&(h=h.map(d=>NB(e,d))),_(t,["candidates"],h)}const a=j(n,["modelVersion"]);a!=null&&_(t,["modelVersion"],a);const o=j(n,["promptFeedback"]);o!=null&&_(t,["promptFeedback"],o);const l=j(n,["usageMetadata"]);return l!=null&&_(t,["usageMetadata"],l),t}function SB(e,n){const t={},r=j(n,["values"]);return r!=null&&_(t,["values"],r),t}function jB(){return{}}function _B(e,n){const t={},r=j(n,["embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>SB(e,l))),_(t,["embeddings"],o)}return j(n,["metadata"])!=null&&_(t,["metadata"],jB()),t}function CB(e,n){const t={},r=j(n,["bytesBase64Encoded"]);r!=null&&_(t,["imageBytes"],Au(e,r));const a=j(n,["mimeType"]);return a!=null&&_(t,["mimeType"],a),t}function Nk(e,n){const t={},r=j(n,["safetyAttributes","categories"]);r!=null&&_(t,["categories"],r);const a=j(n,["safetyAttributes","scores"]);a!=null&&_(t,["scores"],a);const o=j(n,["contentType"]);return o!=null&&_(t,["contentType"],o),t}function kB(e,n){const t={},r=j(n,["_self"]);r!=null&&_(t,["image"],CB(e,r));const a=j(n,["raiFilteredReason"]);a!=null&&_(t,["raiFilteredReason"],a);const o=j(n,["_self"]);return o!=null&&_(t,["safetyAttributes"],Nk(e,o)),t}function TB(e,n){const t={},r=j(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>kB(e,l))),_(t,["generatedImages"],o)}const a=j(n,["positivePromptSafetyAttributes"]);return a!=null&&_(t,["positivePromptSafetyAttributes"],Nk(e,a)),t}function EB(e,n){const t={},r=j(n,["baseModel"]);r!=null&&_(t,["baseModel"],r);const a=j(n,["createTime"]);a!=null&&_(t,["createTime"],a);const o=j(n,["updateTime"]);return o!=null&&_(t,["updateTime"],o),t}function _1(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["description"]);o!=null&&_(t,["description"],o);const l=j(n,["version"]);l!=null&&_(t,["version"],l);const h=j(n,["_self"]);h!=null&&_(t,["tunedModelInfo"],EB(e,h));const d=j(n,["inputTokenLimit"]);d!=null&&_(t,["inputTokenLimit"],d);const u=j(n,["outputTokenLimit"]);u!=null&&_(t,["outputTokenLimit"],u);const f=j(n,["supportedGenerationMethods"]);return f!=null&&_(t,["supportedActions"],f),t}function AB(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["_self"]);if(a!=null){let o=bk(e,a);Array.isArray(o)&&(o=o.map(l=>_1(e,l))),_(t,["models"],o)}return t}function DB(){return{}}function PB(e,n){const t={},r=j(n,["totalTokens"]);r!=null&&_(t,["totalTokens"],r);const a=j(n,["cachedContentTokenCount"]);return a!=null&&_(t,["cachedContentTokenCount"],a),t}function IB(e,n){const t={},r=j(n,["video","uri"]);r!=null&&_(t,["uri"],r);const a=j(n,["video","encodedVideo"]);a!=null&&_(t,["videoBytes"],Au(e,a));const o=j(n,["encoding"]);return o!=null&&_(t,["mimeType"],o),t}function MB(e,n){const t={},r=j(n,["_self"]);return r!=null&&_(t,["video"],IB(e,r)),t}function RB(e,n){const t={},r=j(n,["generatedSamples"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(h=>MB(e,h))),_(t,["generatedVideos"],l)}const a=j(n,["raiMediaFilteredCount"]);a!=null&&_(t,["raiMediaFilteredCount"],a);const o=j(n,["raiMediaFilteredReasons"]);return o!=null&&_(t,["raiMediaFilteredReasons"],o),t}function OB(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["metadata"]);a!=null&&_(t,["metadata"],a);const o=j(n,["done"]);o!=null&&_(t,["done"],o);const l=j(n,["error"]);l!=null&&_(t,["error"],l);const h=j(n,["response","generateVideoResponse"]);return h!=null&&_(t,["response"],RB(e,h)),t}function LB(e,n){const t={},r=j(n,["displayName"]);r!=null&&_(t,["displayName"],r);const a=j(n,["data"]);a!=null&&_(t,["data"],a);const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function FB(e,n){const t={},r=j(n,["videoMetadata"]);r!=null&&_(t,["videoMetadata"],r);const a=j(n,["thought"]);a!=null&&_(t,["thought"],a);const o=j(n,["inlineData"]);o!=null&&_(t,["inlineData"],LB(e,o));const l=j(n,["codeExecutionResult"]);l!=null&&_(t,["codeExecutionResult"],l);const h=j(n,["executableCode"]);h!=null&&_(t,["executableCode"],h);const d=j(n,["fileData"]);d!=null&&_(t,["fileData"],d);const u=j(n,["functionCall"]);u!=null&&_(t,["functionCall"],u);const f=j(n,["functionResponse"]);f!=null&&_(t,["functionResponse"],f);const g=j(n,["text"]);return g!=null&&_(t,["text"],g),t}function $B(e,n){const t={},r=j(n,["parts"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>FB(e,l))),_(t,["parts"],o)}const a=j(n,["role"]);return a!=null&&_(t,["role"],a),t}function zB(e,n){const t={},r=j(n,["citations"]);return r!=null&&_(t,["citations"],r),t}function BB(e,n){const t={},r=j(n,["content"]);r!=null&&_(t,["content"],$B(e,r));const a=j(n,["citationMetadata"]);a!=null&&_(t,["citationMetadata"],zB(e,a));const o=j(n,["finishMessage"]);o!=null&&_(t,["finishMessage"],o);const l=j(n,["finishReason"]);l!=null&&_(t,["finishReason"],l);const h=j(n,["avgLogprobs"]);h!=null&&_(t,["avgLogprobs"],h);const d=j(n,["groundingMetadata"]);d!=null&&_(t,["groundingMetadata"],d);const u=j(n,["index"]);u!=null&&_(t,["index"],u);const f=j(n,["logprobsResult"]);f!=null&&_(t,["logprobsResult"],f);const g=j(n,["safetyRatings"]);return g!=null&&_(t,["safetyRatings"],g),t}function _j(e,n){const t={},r=j(n,["candidates"]);if(r!=null){let u=r;Array.isArray(u)&&(u=u.map(f=>BB(e,f))),_(t,["candidates"],u)}const a=j(n,["createTime"]);a!=null&&_(t,["createTime"],a);const o=j(n,["responseId"]);o!=null&&_(t,["responseId"],o);const l=j(n,["modelVersion"]);l!=null&&_(t,["modelVersion"],l);const h=j(n,["promptFeedback"]);h!=null&&_(t,["promptFeedback"],h);const d=j(n,["usageMetadata"]);return d!=null&&_(t,["usageMetadata"],d),t}function UB(e,n){const t={},r=j(n,["truncated"]);r!=null&&_(t,["truncated"],r);const a=j(n,["token_count"]);return a!=null&&_(t,["tokenCount"],a),t}function qB(e,n){const t={},r=j(n,["values"]);r!=null&&_(t,["values"],r);const a=j(n,["statistics"]);return a!=null&&_(t,["statistics"],UB(e,a)),t}function VB(e,n){const t={},r=j(n,["billableCharacterCount"]);return r!=null&&_(t,["billableCharacterCount"],r),t}function HB(e,n){const t={},r=j(n,["predictions[]","embeddings"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>qB(e,l))),_(t,["embeddings"],o)}const a=j(n,["metadata"]);return a!=null&&_(t,["metadata"],VB(e,a)),t}function GB(e,n){const t={},r=j(n,["gcsUri"]);r!=null&&_(t,["gcsUri"],r);const a=j(n,["bytesBase64Encoded"]);a!=null&&_(t,["imageBytes"],Au(e,a));const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function Sk(e,n){const t={},r=j(n,["safetyAttributes","categories"]);r!=null&&_(t,["categories"],r);const a=j(n,["safetyAttributes","scores"]);a!=null&&_(t,["scores"],a);const o=j(n,["contentType"]);return o!=null&&_(t,["contentType"],o),t}function Lw(e,n){const t={},r=j(n,["_self"]);r!=null&&_(t,["image"],GB(e,r));const a=j(n,["raiFilteredReason"]);a!=null&&_(t,["raiFilteredReason"],a);const o=j(n,["_self"]);o!=null&&_(t,["safetyAttributes"],Sk(e,o));const l=j(n,["prompt"]);return l!=null&&_(t,["enhancedPrompt"],l),t}function YB(e,n){const t={},r=j(n,["predictions"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Lw(e,l))),_(t,["generatedImages"],o)}const a=j(n,["positivePromptSafetyAttributes"]);return a!=null&&_(t,["positivePromptSafetyAttributes"],Sk(e,a)),t}function WB(e,n){const t={},r=j(n,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>Lw(e,o))),_(t,["generatedImages"],a)}return t}function QB(e,n){const t={},r=j(n,["predictions"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>Lw(e,o))),_(t,["generatedImages"],a)}return t}function JB(e,n){const t={},r=j(n,["endpoint"]);r!=null&&_(t,["name"],r);const a=j(n,["deployedModelId"]);return a!=null&&_(t,["deployedModelId"],a),t}function KB(e,n){const t={},r=j(n,["labels","google-vertex-llm-tuning-base-model-id"]);r!=null&&_(t,["baseModel"],r);const a=j(n,["createTime"]);a!=null&&_(t,["createTime"],a);const o=j(n,["updateTime"]);return o!=null&&_(t,["updateTime"],o),t}function XB(e,n){const t={},r=j(n,["checkpointId"]);r!=null&&_(t,["checkpointId"],r);const a=j(n,["epoch"]);a!=null&&_(t,["epoch"],a);const o=j(n,["step"]);return o!=null&&_(t,["step"],o),t}function C1(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["displayName"]);a!=null&&_(t,["displayName"],a);const o=j(n,["description"]);o!=null&&_(t,["description"],o);const l=j(n,["versionId"]);l!=null&&_(t,["version"],l);const h=j(n,["deployedModels"]);if(h!=null){let b=h;Array.isArray(b)&&(b=b.map(v=>JB(e,v))),_(t,["endpoints"],b)}const d=j(n,["labels"]);d!=null&&_(t,["labels"],d);const u=j(n,["_self"]);u!=null&&_(t,["tunedModelInfo"],KB(e,u));const f=j(n,["defaultCheckpointId"]);f!=null&&_(t,["defaultCheckpointId"],f);const g=j(n,["checkpoints"]);if(g!=null){let b=g;Array.isArray(b)&&(b=b.map(v=>XB(e,v))),_(t,["checkpoints"],b)}return t}function ZB(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["_self"]);if(a!=null){let o=bk(e,a);Array.isArray(o)&&(o=o.map(l=>C1(e,l))),_(t,["models"],o)}return t}function eU(){return{}}function tU(e,n){const t={},r=j(n,["totalTokens"]);return r!=null&&_(t,["totalTokens"],r),t}function nU(e,n){const t={},r=j(n,["tokensInfo"]);return r!=null&&_(t,["tokensInfo"],r),t}function iU(e,n){const t={},r=j(n,["gcsUri"]);r!=null&&_(t,["uri"],r);const a=j(n,["bytesBase64Encoded"]);a!=null&&_(t,["videoBytes"],Au(e,a));const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function rU(e,n){const t={},r=j(n,["_self"]);return r!=null&&_(t,["video"],iU(e,r)),t}function aU(e,n){const t={},r=j(n,["videos"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(h=>rU(e,h))),_(t,["generatedVideos"],l)}const a=j(n,["raiMediaFilteredCount"]);a!=null&&_(t,["raiMediaFilteredCount"],a);const o=j(n,["raiMediaFilteredReasons"]);return o!=null&&_(t,["raiMediaFilteredReasons"],o),t}function sU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["metadata"]);a!=null&&_(t,["metadata"],a);const o=j(n,["done"]);o!=null&&_(t,["done"],o);const l=j(n,["error"]);l!=null&&_(t,["error"],l);const h=j(n,["response"]);return h!=null&&_(t,["response"],aU(e,h)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const oU="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function lU(e,n,t){const r=new C$;let a;if(t.data instanceof Blob?a=JSON.parse(await t.data.text()):a=JSON.parse(t.data),e.isVertexAI()){const o=Xz(e,a);Object.assign(r,o)}else{const o=Kz(e,a);Object.assign(r,o)}n(r)}class cU{constructor(n,t,r){this.apiClient=n,this.auth=t,this.webSocketFactory=r}async connect(n){var t,r,a,o;const l=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let d;const u=fU(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())d=`${l}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(u);else{const q=this.apiClient.getApiKey();d=`${l}/ws/google.ai.generativelanguage.${h}.GenerativeService.BidiGenerateContent?key=${q}`}let f=()=>{};const g=new Promise(q=>{f=q}),b=n.callbacks,v=function(){var q;(q=b==null?void 0:b.onopen)===null||q===void 0||q.call(b),f({})},S=this.apiClient,T={onopen:v,onmessage:q=>{lU(S,b.onmessage,q)},onerror:(t=b==null?void 0:b.onerror)!==null&&t!==void 0?t:function(q){},onclose:(r=b==null?void 0:b.onclose)!==null&&r!==void 0?r:function(q){}},E=this.webSocketFactory.create(d,hU(u),T);E.connect(),await g;let C=Ii(this.apiClient,n.model);if(this.apiClient.isVertexAI()&&C.startsWith("publishers/")){const q=this.apiClient.getProject(),L=this.apiClient.getLocation();C=`projects/${q}/locations/${L}/`+C}let P={};this.apiClient.isVertexAI()&&((a=n.config)===null||a===void 0?void 0:a.responseModalities)===void 0&&(n.config===void 0?n.config={responseModalities:[ip.AUDIO]}:n.config.responseModalities=[ip.AUDIO]),!((o=n.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const I={model:C,config:n.config,callbacks:n.callbacks};return this.apiClient.isVertexAI()?P=Nz(this.apiClient,I):P=wz(this.apiClient,I),delete P.config,E.send(JSON.stringify(P)),new dU(E,this.apiClient)}}const uU={turnComplete:!0};class dU{constructor(n,t){this.conn=n,this.apiClient=t}tLiveClientContent(n,t){if(t.turns!==null&&t.turns!==void 0){let r=[];try{r=Tu(n,t.turns),n.isVertexAI()?r=r.map(a=>dp(n,a)):r=r.map(a=>qb(n,a))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(n,t){let r=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?r=t.functionResponses:r=[t.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const o of r){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!n.isVertexAI()&&!("id"in o))throw new Error(oU)}return{toolResponse:{functionResponses:r}}}sendClientContent(n){n=Object.assign(Object.assign({},uU),n);const t=this.tLiveClientContent(this.apiClient,n);this.conn.send(JSON.stringify(t))}sendRealtimeInput(n){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Tz(this.apiClient,n)}:t={realtimeInput:kz(this.apiClient,n)},this.conn.send(JSON.stringify(t))}sendToolResponse(n){if(n.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,n);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function hU(e){const n={};return e.forEach((t,r)=>{n[r]=t}),n}function fU(e){const n=new Headers;for(const[t,r]of Object.entries(e))n.append(t,r);return n}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pU extends Ng{constructor(n){super(),this.apiClient=n,this.generateContent=async t=>await this.generateContentInternal(t),this.generateContentStream=async t=>await this.generateContentStreamInternal(t),this.generateImages=async t=>await this.generateImagesInternal(t).then(r=>{var a;let o;const l=[];if(r!=null&&r.generatedImages)for(const d of r.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((a=d==null?void 0:d.safetyAttributes)===null||a===void 0?void 0:a.contentType)==="Positive Prompt"?o=d==null?void 0:d.safetyAttributes:l.push(d);let h;return o?h={generatedImages:l,positivePromptSafetyAttributes:o}:h={generatedImages:l},h}),this.list=async t=>{var r;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((r=l.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Ub(tp.PAGED_ITEM_MODELS,h=>this.listInternal(h),await this.listInternal(l),l)},this.editImage=async t=>{const r={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(r.referenceImages=t.referenceImages.map(a=>a.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async t=>{let r={numberOfImages:1,mode:"upscale"};t.config&&(r=Object.assign(Object.assign({},r),t.config));const a={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:r};return await this.upscaleImageInternal(a)}}async generateContentInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=Sj(this.apiClient,n);return h=en("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=_j(this.apiClient,f),b=new kx;return Object.assign(b,g),b})}else{const u=Nj(this.apiClient,n);return h=en("{model}:generateContent",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=jj(this.apiClient,f),b=new kx;return Object.assign(b,g),b})}}async generateContentStreamInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=Sj(this.apiClient,n);h=en("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}),l.then(function(g){return fb(this,arguments,function*(){var b,v,S,T;try{for(var E=!0,C=S1(g),P;P=yield ea(C.next()),b=P.done,!b;E=!0){T=P.value,E=!1;const q=_j(f,yield ea(T.json())),L=new kx;Object.assign(L,q),yield yield ea(L)}}catch(I){v={error:I}}finally{try{!E&&!b&&(S=C.return)&&(yield ea(S.call(C)))}finally{if(v)throw v.error}}})})}else{const u=Nj(this.apiClient,n);h=en("{model}:streamGenerateContent?alt=sse",u._url),d=u._query,delete u.config,delete u._url,delete u._query;const f=this.apiClient;return l=f.requestStream({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(g){return fb(this,arguments,function*(){var b,v,S,T;try{for(var E=!0,C=S1(g),P;P=yield ea(C.next()),b=P.done,!b;E=!0){T=P.value,E=!1;const q=jj(f,yield ea(T.json())),L=new kx;Object.assign(L,q),yield yield ea(L)}}catch(I){v={error:I}}finally{try{!E&&!b&&(S=C.return)&&(yield ea(S.call(C)))}finally{if(v)throw v.error}}})})}}async embedContent(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=Q8(this.apiClient,n);return h=en("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=HB(this.apiClient,f),b=new cj;return Object.assign(b,g),b})}else{const u=p8(this.apiClient,n);return h=en("{model}:batchEmbedContents",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=_B(this.apiClient,f),b=new cj;return Object.assign(b,g),b})}}async generateImagesInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=K8(this.apiClient,n);return h=en("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=YB(this.apiClient,f),b=new uj;return Object.assign(b,g),b})}else{const u=g8(this.apiClient,n);return h=en("{model}:predict",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=TB(this.apiClient,f),b=new uj;return Object.assign(b,g),b})}}async editImageInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI()){const h=rB(this.apiClient,n);return o=en("{model}:predict",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>{const u=WB(this.apiClient,d),f=new v$;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI()){const h=sB(this.apiClient,n);return o=en("{model}:predict",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>{const u=QB(this.apiClient,d),f=new w$;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=oB(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>C1(this.apiClient,f))}else{const u=y8(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>_1(this.apiClient,f))}}async listInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=cB(this.apiClient,n);return h=en("{models_url}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=ZB(this.apiClient,f),b=new dj;return Object.assign(b,g),b})}else{const u=b8(this.apiClient,n);return h=en("{models_url}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=AB(this.apiClient,f),b=new dj;return Object.assign(b,g),b})}}async update(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=dB(this.apiClient,n);return h=en("{model}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>C1(this.apiClient,f))}else{const u=w8(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"PATCH",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>_1(this.apiClient,f))}}async delete(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=hB(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(()=>{const f=eU(),g=new hj;return Object.assign(g,f),g})}else{const u=N8(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(()=>{const f=DB(),g=new hj;return Object.assign(g,f),g})}}async countTokens(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=pB(this.apiClient,n);return h=en("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=tU(this.apiClient,f),b=new fj;return Object.assign(b,g),b})}else{const u=j8(this.apiClient,n);return h=en("{model}:countTokens",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=PB(this.apiClient,f),b=new fj;return Object.assign(b,g),b})}}async computeTokens(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI()){const h=mB(this.apiClient,n);return o=en("{model}:computeTokens",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>{const u=nU(this.apiClient,d),f=new N$;return Object.assign(f,u),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=yB(this.apiClient,n);return h=en("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>sU(this.apiClient,f))}else{const u=k8(this.apiClient,n);return h=en("{model}:predictLongRunning",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>OB(this.apiClient,f))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mU(e,n){const t={},r=j(n,["operationName"]);r!=null&&_(t,["_url","operationName"],r);const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function gU(e,n){const t={},r=j(n,["operationName"]);r!=null&&_(t,["_url","operationName"],r);const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function yU(e,n){const t={},r=j(n,["operationName"]);r!=null&&_(t,["operationName"],r);const a=j(n,["resourceName"]);a!=null&&_(t,["_url","resourceName"],a);const o=j(n,["config"]);return o!=null&&_(t,["config"],o),t}function xU(e,n){const t={},r=j(n,["video","uri"]);r!=null&&_(t,["uri"],r);const a=j(n,["video","encodedVideo"]);a!=null&&_(t,["videoBytes"],Au(e,a));const o=j(n,["encoding"]);return o!=null&&_(t,["mimeType"],o),t}function bU(e,n){const t={},r=j(n,["_self"]);return r!=null&&_(t,["video"],xU(e,r)),t}function vU(e,n){const t={},r=j(n,["generatedSamples"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(h=>bU(e,h))),_(t,["generatedVideos"],l)}const a=j(n,["raiMediaFilteredCount"]);a!=null&&_(t,["raiMediaFilteredCount"],a);const o=j(n,["raiMediaFilteredReasons"]);return o!=null&&_(t,["raiMediaFilteredReasons"],o),t}function wU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["metadata"]);a!=null&&_(t,["metadata"],a);const o=j(n,["done"]);o!=null&&_(t,["done"],o);const l=j(n,["error"]);l!=null&&_(t,["error"],l);const h=j(n,["response","generateVideoResponse"]);return h!=null&&_(t,["response"],vU(e,h)),t}function NU(e,n){const t={},r=j(n,["gcsUri"]);r!=null&&_(t,["uri"],r);const a=j(n,["bytesBase64Encoded"]);a!=null&&_(t,["videoBytes"],Au(e,a));const o=j(n,["mimeType"]);return o!=null&&_(t,["mimeType"],o),t}function SU(e,n){const t={},r=j(n,["_self"]);return r!=null&&_(t,["video"],NU(e,r)),t}function jU(e,n){const t={},r=j(n,["videos"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(h=>SU(e,h))),_(t,["generatedVideos"],l)}const a=j(n,["raiMediaFilteredCount"]);a!=null&&_(t,["raiMediaFilteredCount"],a);const o=j(n,["raiMediaFilteredReasons"]);return o!=null&&_(t,["raiMediaFilteredReasons"],o),t}function Cj(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["metadata"]);a!=null&&_(t,["metadata"],a);const o=j(n,["done"]);o!=null&&_(t,["done"],o);const l=j(n,["error"]);l!=null&&_(t,["error"],l);const h=j(n,["response"]);return h!=null&&_(t,["response"],jU(e,h)),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _U extends Ng{constructor(n){super(),this.apiClient=n}async getVideosOperation(n){const t=n.operation,r=n.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const a=t.name.split("/operations/")[0];let o;return r&&"httpOptions"in r&&(o=r.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:a,config:{httpOptions:o}})}else return this.getVideosOperationInternal({operationName:t.name,config:r})}async getVideosOperationInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=gU(this.apiClient,n);return h=en("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>Cj(this.apiClient,f))}else{const u=mU(this.apiClient,n);return h=en("{operationName}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>wU(this.apiClient,f))}}async fetchPredictVideosOperationInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI()){const h=yU(this.apiClient,n);return o=en("{resourceName}:fetchPredictOperation",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>Cj(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const CU="Content-Type",kU="X-Server-Timeout",TU="User-Agent",EU="x-goog-api-client",AU="0.14.1",DU=`google-genai-sdk/${AU}`,PU="v1beta1",IU="v1beta",kj=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class jk extends Error{constructor(n,t){t?super(n,{cause:t}):super(n,{cause:new Error().stack}),this.message=n,this.name="ClientError"}}class k1 extends Error{constructor(n,t){t?super(n,{cause:t}):super(n,{cause:new Error().stack}),this.message=n,this.name="ServerError"}}class MU{constructor(n){var t,r;this.clientOptions=Object.assign(Object.assign({},n),{project:n.project,location:n.location,apiKey:n.apiKey,vertexai:n.vertexai});const a={};this.clientOptions.vertexai?(a.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:PU,a.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(a.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:IU,a.baseUrl="https://generativelanguage.googleapis.com/"),a.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=a,n.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(a,n.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var n;return(n=this.clientOptions.vertexai)!==null&&n!==void 0?n:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(n){if(!n||n.baseUrl===void 0||n.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[n.baseUrl.endsWith("/")?n.baseUrl.slice(0,-1):n.baseUrl];return n.apiVersion&&n.apiVersion!==""&&r.push(n.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const n=this.getBaseUrl(),t=new URL(n);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(n){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=n;else throw new Error("HTTP options are not correctly set.")}constructUrl(n,t,r){const a=[this.getRequestUrlInternal(t)];return r&&a.push(this.getBaseResourcePath()),n!==""&&a.push(n),new URL(`${a.join("/")}`)}shouldPrependVertexProjectPath(n){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||n.path.startsWith("projects/")||n.httpMethod==="GET"&&n.path.startsWith("publishers/google/models"))}async request(n){let t=this.clientOptions.httpOptions;n.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,n.httpOptions));const r=this.shouldPrependVertexProjectPath(n),a=this.constructUrl(n.path,t,r);if(n.queryParams)for(const[l,h]of Object.entries(n.queryParams))a.searchParams.append(l,String(h));let o={};if(n.httpMethod==="GET"){if(n.body&&n.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=n.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,n.abortSignal),this.unaryApiCall(a,o,n.httpMethod)}patchHttpOptions(n,t){const r=JSON.parse(JSON.stringify(n));for(const[a,o]of Object.entries(t))typeof o=="object"?r[a]=Object.assign(Object.assign({},r[a]),o):o!==void 0&&(r[a]=o);return r}async requestStream(n){let t=this.clientOptions.httpOptions;n.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,n.httpOptions));const r=this.shouldPrependVertexProjectPath(n),a=this.constructUrl(n.path,t,r);(!a.searchParams.has("alt")||a.searchParams.get("alt")!=="sse")&&a.searchParams.set("alt","sse");let o={};return o.body=n.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,n.abortSignal),this.streamApiCall(a,o,n.httpMethod)}async includeExtraHttpOptionsToRequestInit(n,t,r){if(t&&t.timeout||r){const a=new AbortController,o=a.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>a.abort(),t.timeout),r&&r.addEventListener("abort",()=>{a.abort()}),n.signal=o}return n.headers=await this.getHeadersInternal(t),n}async unaryApiCall(n,t,r){return this.apiCall(n.toString(),Object.assign(Object.assign({},t),{method:r})).then(async a=>(await Tj(a),new N1(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}async streamApiCall(n,t,r){return this.apiCall(n.toString(),Object.assign(Object.assign({},t),{method:r})).then(async a=>(await Tj(a),this.processStreamResponse(a))).catch(a=>{throw a instanceof Error?a:new Error(JSON.stringify(a))})}processStreamResponse(n){var t;return fb(this,arguments,function*(){const a=(t=n==null?void 0:n.body)===null||t===void 0?void 0:t.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let l="";for(;;){const{done:h,value:d}=yield ea(a.read());if(h){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const u=o.decode(d);try{const g=JSON.parse(u);if("error"in g){const b=JSON.parse(JSON.stringify(g.error)),v=b.status,S=b.code,T=`got status: ${v}. ${JSON.stringify(g)}`;if(S>=400&&S<500)throw new jk(T);if(S>=500&&S<600)throw new k1(T)}}catch(g){const b=g;if(b.name==="ClientError"||b.name==="ServerError")throw g}l+=u;let f=l.match(kj);for(;f;){const g=f[1];try{const b=new Response(g,{headers:n==null?void 0:n.headers,status:n==null?void 0:n.status,statusText:n==null?void 0:n.statusText});yield yield ea(new N1(b)),l=l.slice(f[0].length),f=l.match(kj)}catch(b){throw new Error(`exception parsing stream chunk ${g}. ${b}`)}}}}finally{a.releaseLock()}})}async apiCall(n,t){return fetch(n,t).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const n={},t=DU+" "+this.clientOptions.userAgentExtra;return n[TU]=t,n[EU]=t,n[CU]="application/json",n}async getHeadersInternal(n){const t=new Headers;if(n&&n.headers){for(const[r,a]of Object.entries(n.headers))t.append(r,a);n.timeout&&n.timeout>0&&t.append(kU,String(Math.ceil(n.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(n,t){var r;const a={};t!=null&&(a.mimeType=t.mimeType,a.name=t.name,a.displayName=t.displayName),a.name&&!a.name.startsWith("files/")&&(a.name=`files/${a.name}`);const o=this.clientOptions.uploader,l=await o.stat(n);a.sizeBytes=String(l.size);const h=(r=t==null?void 0:t.mimeType)!==null&&r!==void 0?r:l.type;if(h===void 0||h==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");a.mimeType=h;const d=await this.fetchUploadUrl(a,t);return o.upload(n,d,this)}async downloadFile(n){await this.clientOptions.downloader.download(n,this)}async fetchUploadUrl(n,t){var r;let a={};t!=null&&t.httpOptions?a=t.httpOptions:a={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${n.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${n.mimeType}`}};const o={file:n},l=await this.request({path:en("upload/v1beta/files",o._url),body:JSON.stringify(o),httpMethod:"POST",httpOptions:a});if(!l||!(l!=null&&l.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const h=(r=l==null?void 0:l.headers)===null||r===void 0?void 0:r["x-goog-upload-url"];if(h===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return h}}async function Tj(e){var n;if(e===void 0)throw new k1("response is undefined");if(!e.ok){const t=e.status,r=e.statusText;let a;!((n=e.headers.get("content-type"))===null||n===void 0)&&n.includes("application/json")?a=await e.json():a={error:{message:await e.text(),code:e.status,status:e.statusText}};const o=`got status: ${t} ${r}. ${JSON.stringify(a)}`;throw t>=400&&t<500?new jk(o):t>=500&&t<600?new k1(o):new Error(o)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],r);const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function OU(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);t!==void 0&&o!=null&&_(t,["_query","pageToken"],o);const l=j(n,["filter"]);return t!==void 0&&l!=null&&_(t,["_query","filter"],l),r}function LU(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],OU(e,r,t)),t}function FU(e,n){const t={},r=j(n,["textInput"]);r!=null&&_(t,["textInput"],r);const a=j(n,["output"]);return a!=null&&_(t,["output"],a),t}function $U(e,n){const t={};if(j(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const r=j(n,["examples"]);if(r!=null){let a=r;Array.isArray(a)&&(a=a.map(o=>FU(e,o))),_(t,["examples","examples"],a)}return t}function zU(e,n,t){const r={};if(j(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const a=j(n,["tunedModelDisplayName"]);if(t!==void 0&&a!=null&&_(t,["displayName"],a),j(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=j(n,["epochCount"]);t!==void 0&&o!=null&&_(t,["tuningTask","hyperparameters","epochCount"],o);const l=j(n,["learningRateMultiplier"]);if(l!=null&&_(r,["tuningTask","hyperparameters","learningRateMultiplier"],l),j(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(j(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const h=j(n,["batchSize"]);t!==void 0&&h!=null&&_(t,["tuningTask","hyperparameters","batchSize"],h);const d=j(n,["learningRate"]);return t!==void 0&&d!=null&&_(t,["tuningTask","hyperparameters","learningRate"],d),r}function BU(e,n){const t={},r=j(n,["baseModel"]);r!=null&&_(t,["baseModel"],r);const a=j(n,["trainingDataset"]);a!=null&&_(t,["tuningTask","trainingData"],$U(e,a));const o=j(n,["config"]);return o!=null&&_(t,["config"],zU(e,o,t)),t}function UU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["_url","name"],r);const a=j(n,["config"]);return a!=null&&_(t,["config"],a),t}function qU(e,n,t){const r={},a=j(n,["pageSize"]);t!==void 0&&a!=null&&_(t,["_query","pageSize"],a);const o=j(n,["pageToken"]);t!==void 0&&o!=null&&_(t,["_query","pageToken"],o);const l=j(n,["filter"]);return t!==void 0&&l!=null&&_(t,["_query","filter"],l),r}function VU(e,n){const t={},r=j(n,["config"]);return r!=null&&_(t,["config"],qU(e,r,t)),t}function HU(e,n,t){const r={},a=j(n,["gcsUri"]);if(t!==void 0&&a!=null&&_(t,["supervisedTuningSpec","trainingDatasetUri"],a),j(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return r}function GU(e,n){const t={},r=j(n,["gcsUri"]);return r!=null&&_(t,["validationDatasetUri"],r),t}function YU(e,n,t){const r={},a=j(n,["validationDataset"]);t!==void 0&&a!=null&&_(t,["supervisedTuningSpec"],GU(e,a));const o=j(n,["tunedModelDisplayName"]);t!==void 0&&o!=null&&_(t,["tunedModelDisplayName"],o);const l=j(n,["description"]);t!==void 0&&l!=null&&_(t,["description"],l);const h=j(n,["epochCount"]);t!==void 0&&h!=null&&_(t,["supervisedTuningSpec","hyperParameters","epochCount"],h);const d=j(n,["learningRateMultiplier"]);t!==void 0&&d!=null&&_(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],d);const u=j(n,["exportLastCheckpointOnly"]);t!==void 0&&u!=null&&_(t,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const f=j(n,["adapterSize"]);if(t!==void 0&&f!=null&&_(t,["supervisedTuningSpec","hyperParameters","adapterSize"],f),j(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(j(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return r}function WU(e,n){const t={},r=j(n,["baseModel"]);r!=null&&_(t,["baseModel"],r);const a=j(n,["trainingDataset"]);a!=null&&_(t,["supervisedTuningSpec","trainingDatasetUri"],HU(e,a,t));const o=j(n,["config"]);return o!=null&&_(t,["config"],YU(e,o,t)),t}function QU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["model"],r);const a=j(n,["name"]);return a!=null&&_(t,["endpoint"],a),t}function _k(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["state"]);a!=null&&_(t,["state"],gk(e,a));const o=j(n,["createTime"]);o!=null&&_(t,["createTime"],o);const l=j(n,["tuningTask","startTime"]);l!=null&&_(t,["startTime"],l);const h=j(n,["tuningTask","completeTime"]);h!=null&&_(t,["endTime"],h);const d=j(n,["updateTime"]);d!=null&&_(t,["updateTime"],d);const u=j(n,["description"]);u!=null&&_(t,["description"],u);const f=j(n,["baseModel"]);f!=null&&_(t,["baseModel"],f);const g=j(n,["_self"]);g!=null&&_(t,["tunedModel"],QU(e,g));const b=j(n,["distillationSpec"]);b!=null&&_(t,["distillationSpec"],b);const v=j(n,["experiment"]);v!=null&&_(t,["experiment"],v);const S=j(n,["labels"]);S!=null&&_(t,["labels"],S);const T=j(n,["pipelineJob"]);T!=null&&_(t,["pipelineJob"],T);const E=j(n,["tunedModelDisplayName"]);return E!=null&&_(t,["tunedModelDisplayName"],E),t}function JU(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["tunedModels"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>_k(e,l))),_(t,["tuningJobs"],o)}return t}function KU(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["metadata"]);a!=null&&_(t,["metadata"],a);const o=j(n,["done"]);o!=null&&_(t,["done"],o);const l=j(n,["error"]);return l!=null&&_(t,["error"],l),t}function XU(e,n){const t={},r=j(n,["checkpointId"]);r!=null&&_(t,["checkpointId"],r);const a=j(n,["epoch"]);a!=null&&_(t,["epoch"],a);const o=j(n,["step"]);o!=null&&_(t,["step"],o);const l=j(n,["endpoint"]);return l!=null&&_(t,["endpoint"],l),t}function ZU(e,n){const t={},r=j(n,["model"]);r!=null&&_(t,["model"],r);const a=j(n,["endpoint"]);a!=null&&_(t,["endpoint"],a);const o=j(n,["checkpoints"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(h=>XU(e,h))),_(t,["checkpoints"],l)}return t}function T1(e,n){const t={},r=j(n,["name"]);r!=null&&_(t,["name"],r);const a=j(n,["state"]);a!=null&&_(t,["state"],gk(e,a));const o=j(n,["createTime"]);o!=null&&_(t,["createTime"],o);const l=j(n,["startTime"]);l!=null&&_(t,["startTime"],l);const h=j(n,["endTime"]);h!=null&&_(t,["endTime"],h);const d=j(n,["updateTime"]);d!=null&&_(t,["updateTime"],d);const u=j(n,["error"]);u!=null&&_(t,["error"],u);const f=j(n,["description"]);f!=null&&_(t,["description"],f);const g=j(n,["baseModel"]);g!=null&&_(t,["baseModel"],g);const b=j(n,["tunedModel"]);b!=null&&_(t,["tunedModel"],ZU(e,b));const v=j(n,["supervisedTuningSpec"]);v!=null&&_(t,["supervisedTuningSpec"],v);const S=j(n,["tuningDataStats"]);S!=null&&_(t,["tuningDataStats"],S);const T=j(n,["encryptionSpec"]);T!=null&&_(t,["encryptionSpec"],T);const E=j(n,["partnerModelTuningSpec"]);E!=null&&_(t,["partnerModelTuningSpec"],E);const C=j(n,["distillationSpec"]);C!=null&&_(t,["distillationSpec"],C);const P=j(n,["experiment"]);P!=null&&_(t,["experiment"],P);const I=j(n,["labels"]);I!=null&&_(t,["labels"],I);const q=j(n,["pipelineJob"]);q!=null&&_(t,["pipelineJob"],q);const L=j(n,["tunedModelDisplayName"]);return L!=null&&_(t,["tunedModelDisplayName"],L),t}function e9(e,n){const t={},r=j(n,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const a=j(n,["tuningJobs"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(l=>T1(e,l))),_(t,["tuningJobs"],o)}return t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class t9 extends Ng{constructor(n){super(),this.apiClient=n,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Ub(tp.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const r=await this.tuneMldevInternal(t);let a="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?a=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(a=r.name.split("/operations/")[0]),{name:a,state:w1.JOB_STATE_QUEUED}}}}async getInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=UU(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>T1(this.apiClient,f))}else{const u=RU(this.apiClient,n);return h=en("{name}",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>_k(this.apiClient,f))}}async listInternal(n){var t,r,a,o;let l,h="",d={};if(this.apiClient.isVertexAI()){const u=VU(this.apiClient,n);return h=en("tuningJobs",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),l.then(f=>{const g=e9(this.apiClient,f),b=new pj;return Object.assign(b,g),b})}else{const u=LU(this.apiClient,n);return h=en("tunedModels",u._url),d=u._query,delete u.config,delete u._url,delete u._query,l=this.apiClient.request({path:h,queryParams:d,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(a=n.config)===null||a===void 0?void 0:a.httpOptions,abortSignal:(o=n.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),l.then(f=>{const g=JU(this.apiClient,f),b=new pj;return Object.assign(b,g),b})}}async tuneInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI()){const h=WU(this.apiClient,n);return o=en("tuningJobs",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>T1(this.apiClient,d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(n){var t,r;let a,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const h=BU(this.apiClient,n);return o=en("tunedModels",h._url),l=h._query,delete h.config,delete h._url,delete h._query,a=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=n.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=n.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),a.then(d=>KU(this.apiClient,d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class n9{async download(n,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const i9=1024*1024*8,r9=3,a9=1e3,s9=2,b0="x-goog-upload-status";async function o9(e,n,t){var r,a,o;let l=0,h=0,d=new N1(new Response),u="upload";for(l=e.size;h<l;){const g=Math.min(i9,l-h),b=e.slice(h,h+g);h+g>=l&&(u+=", finalize");let v=0,S=a9;for(;v<r9&&(d=await t.request({path:"",body:b,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:n,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(h),"Content-Length":String(g)}}}),!(!((r=d==null?void 0:d.headers)===null||r===void 0)&&r[b0]));)v++,await c9(S),S=S*s9;if(h+=g,((a=d==null?void 0:d.headers)===null||a===void 0?void 0:a[b0])!=="active")break;if(l<=h)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const f=await(d==null?void 0:d.json());if(((o=d==null?void 0:d.headers)===null||o===void 0?void 0:o[b0])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return f.file}async function l9(e){return{size:e.size,type:e.type}}function c9(e){return new Promise(n=>setTimeout(n,e))}class u9{async upload(n,t,r){if(typeof n=="string")throw new Error("File path is not supported in browser uploader.");return await o9(n,t,r)}async stat(n){if(typeof n=="string")throw new Error("File path is not supported in browser uploader.");return await l9(n)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class d9{create(n,t,r){return new h9(n,t,r)}}class h9{constructor(n,t,r){this.url=n,this.headers=t,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(n){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(n)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Ej="x-goog-api-key";class f9{constructor(n){this.apiKey=n}async addAuthHeaders(n){n.get(Ej)===null&&n.append(Ej,this.apiKey)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const p9="gl-node/";class Sg{constructor(n){var t;if(n.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(n.project||n.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=n.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=n.apiKey;const r=j6(n,void 0,void 0);r&&(n.httpOptions?n.httpOptions.baseUrl=r:n.httpOptions={baseUrl:r}),this.apiVersion=n.apiVersion;const a=new f9(this.apiKey);this.apiClient=new MU({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:n.httpOptions,userAgentExtra:p9+"web",uploader:new u9,downloader:new n9}),this.models=new pU(this.apiClient),this.live=new cU(this.apiClient,a,new d9),this.chats=new D$(this.models,this.apiClient),this.caches=new k$(this.apiClient),this.files=new V$(this.apiClient),this.operations=new _U(this.apiClient),this.tunings=new t9(this.apiClient)}}const m9="gemini-3-flash-preview";async function g9(){const e=nh();if(!e)throw new Error("Authentication token not found. Please log in.");try{const t=await(await ce("/api/clinics/settings",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch clinic-specific Gemini API key, trying global fallback.",n)}try{const t=await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch global Gemini API key.",n)}throw new Error("Gemini API key not found. Please contact your administrator.")}let v0=null;async function y9(){if(!v0){const e=await g9();v0=new Sg({apiKey:e})}return v0}const x9=`You are an expert Clinic Business Data Analyst. You assist the clinic owner/doctor in understanding their financial and inventory performance.

**Your Goal:**
Answer questions based *strictly* on the provided JSON data context. Do not halllucinate data. If data is missing for a specific question, state that clearly.

**Capabilities:**
1.  **Analyze Revenue:** Break down revenue by type (Consultation, Pharmacy, Lab) and payment mode (Cash, UPI, etc.).
2.  **Analyze Inventory:** Identify top-selling drugs, profitable items, or stock movements.
3.  **Control Dashboard:** You can change the date range of the dashboard if the user asks for analysis of a different period (e.g., "last month", "yesterday", "since Jan 1st").

**Tools / Actions:**
To respond, you must output a **JSON object**.
- **Text Response:** Use this for normal answers.
  \`{ "response_type": "text", "content": "Your answer using markdown..." }\`

- **Change Date Range:** Use this if you need to see data for a different time period.
  *IMPORTANT:* When you use this tool, the system will *automatically* fetch new data for that range and call you again with the fresh context. You do not need to ask the user to wait.
  \`{ "response_type": "action", "action_name": "change_date_range", "parameters": { "startDate": "YYYY-MM-DD", "endDate": "YYYY-MM-DD" } }\`

- **End Analysis:** Use this when you have completed your analysis and answered the user's question fully.
  \`{ "response_type": "action", "action_name": "end_analysis", "content": "Optional final summary..." }\`

**Response Format:**
ALWAYS return valid JSON code block.
\`\`\`json
{ ... }
\`\`\`
`;async function b9(e){const{query:n,todayDate:t,currentStartDate:r,currentEndDate:a,revenueSummary:o,detailedRevenue:l,inventoryStats:h,history:d=[],imageBase64:u,imageMimeType:f}=e;let g=`Today's Date: ${t}
`;if(g+=`Current Dashboard Date Range: ${r} to ${a}

`,g+=`--- Financial Overview ---
`,o&&(g+=`Revenue Summary: ${JSON.stringify(o,null,2)}
`),l&&(g+=`Detailed Revenue by Mode: ${JSON.stringify(l,null,2)}
`),h&&(g+=`
--- Inventory Analysis ---
`,h.totals&&(g+=`Totals: ${JSON.stringify(h.totals)}
`),h.pharmacyAnalysis&&Array.isArray(h.pharmacyAnalysis))){const T=h.pharmacyAnalysis.sort((E,C)=>C.revenue-E.revenue).slice(0,50).map(E=>({name:E.name,sold:E.quantity_out,revenue:E.revenue,profit:E.profit}));g+=`Top 50 Drugs by Revenue: ${JSON.stringify(T)}
`}const b=[];u&&f&&b.push({inlineData:{data:u,mimeType:f}});const v=`User Question: "${n}"

Context Data:
${g}

Act on this request based on the data above.`;b.push({text:v});const S=[{role:"user",parts:[{text:`SYSTEM INSTRUCTION:
${x9}`}]},{role:"model",parts:[{text:"Understood. I am your expert Clinic Business Data Analyst. I will help you analyze revenue, inventory, and trends based on the data provided."}]},...d.map(T=>({role:T.role==="model"?"model":"user",parts:[{text:T.content}]})),{role:"user",parts:b}];try{const T=await y9(),E={model:m9,contents:S,config:{responseMimeType:"application/json"}},C=await T.models.generateContentStream(E);let P="";for await(const I of C){const q=I.text;q&&(P+=q)}try{const I=P.replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(I)}catch(I){return console.warn("Failed to parse Gemini JSON response for analysis:",I),{response_type:"text",content:P}}}catch(T){throw console.error("Analysis AI Error:",T),new Error(T.message||"Failed to generate analysis.")}}const Ck=()=>{const e=new Date().toISOString().split("T")[0],[n,t]=w.useState(e),[r,a]=w.useState(e),[o,l]=w.useState([]),[h,d]=w.useState([]),[u,f]=w.useState([]),[g,b]=w.useState(0),[v,S]=w.useState(0),[T,E]=w.useState(null),[C,P]=w.useState({reception:{},pharmacy:{},lab:{}}),[I,q]=w.useState(null),[L,O]=w.useState(!1),[B,$]=w.useState(null),[F,z]=w.useState(!1),[U,V]=w.useState([]),[ee,ie]=w.useState([]),[ae,J]=w.useState(""),[K,W]=w.useState(!1),[re,A]=w.useState(null),te=w.useRef(null),xe=w.useRef(null),M=w.useRef(null),Se=w.useRef(null),$e=()=>{var ne;(ne=te.current)==null||ne.scrollIntoView({behavior:"smooth"})};w.useEffect(()=>{$e()},[U,F]);const he=ne=>{var rt;const Pe=(rt=ne.target.files)==null?void 0:rt[0];if(!Pe)return;const Ye=new FileReader;Ye.onloadend=()=>{A({file:Pe,preview:URL.createObjectURL(Pe),base64:Ye.result.split(",")[1]})},Ye.readAsDataURL(Pe)},ge=async(ne,Pe)=>{const Ye=ne||n,rt=Pe||r;if(O(!0),$(null),l([]),d([]),f([]),q(null),b(0),S(0),E(null),P({reception:{},pharmacy:{},lab:{}}),!Ye||!rt){$("Please select both start and end dates."),O(!1);return}if(new Date(Ye)>new Date(rt)){$("Start date cannot be after end date."),O(!1);return}const ut=x1();if(!ut){$("Clinic ID not found. Please log in again."),O(!1);return}try{const[je,Qe,ze,dt]=await Promise.all([ce(`/api/bills?startDate=${Ye}&endDate=${rt}`,{cache:"no-store"}),ce(`/api/payment/admission?startDate=${Ye}&endDate=${rt}`,{cache:"no-store"}),ce(`/api/subscriptions/transactions/manual?startDate=${Ye}&endDate=${rt}`,{cache:"no-store"}),ce(`/api/inventory/comprehensive-analysis?startDate=${Ye}&endDate=${rt}&clinicId=${ut}`,{cache:"no-store"})]);if(!je.ok)throw new Error("Failed to fetch bills");if(!Qe.ok)throw new Error("Failed to fetch admission payments");if(!ze.ok)throw new Error("Failed to fetch subscriptions");if(!dt.ok)throw new Error("Failed to fetch inventory analysis");const Ze=await je.json(),ct=await Qe.json(),ft=await ze.json(),fe=Ze.bills||[],Q=ct.admissionPayments||[],ue=ft||[];l(fe),d(Q),f(ue);let De=0,Ge=0;const ye={consultation:0,pharmacy:0,lab:0,other:0},Ne={reception:{},pharmacy:{},lab:{}};fe.forEach(Fe=>{if(Fe.status==="paid"||Fe.type==="pharmacy_return"){const ve=parseFloat(Fe.amount.toString()),ke=Fe.payment_mode||"Unknown";let Ee=Fe.type||"other";Ee==="pharmacy_return"&&(Ge+=ve,Ee="pharmacy"),De+=ve,ye.hasOwnProperty(Ee)?ye[Ee]=(ye[Ee]||0)+ve:ye.other=(ye.other||0)+ve,Ee==="pharmacy"?Ne.pharmacy[ke]=(Ne.pharmacy[ke]||0)+ve:Ee==="lab"?Ne.lab[ke]=(Ne.lab[ke]||0)+ve:Ne.reception[ke]=(Ne.reception[ke]||0)+ve}}),Q.forEach(Fe=>{const ve=parseFloat(Fe.amount_paid.toString()),ke=Fe.payment_mode||"Unknown";De+=ve,Ne.reception[ke]=(Ne.reception[ke]||0)+ve}),ue.forEach(Fe=>{var Ee,Ve;const ve=parseFloat(((Ve=(Ee=Fe.subscriptionPlan)==null?void 0:Ee.price)==null?void 0:Ve.toString())??"0"),ke=Fe.subscription_payment_method||"manual";De+=ve,Ne.reception[ke]=(Ne.reception[ke]||0)+ve}),E(ye),P(Ne),b(De),S(Ge);const Me=await dt.json();q(Me)}catch(je){console.error("Analysis Fetch Error:",je),$(je.message||"Failed to fetch analysis data.")}finally{O(!1)}},me=async(ne,Pe)=>{const Ye=x1();if(!Ye)throw new Error("Clinic ID not found.");const[rt,ut,je,Qe]=await Promise.all([ce(`/api/bills?startDate=${ne}&endDate=${Pe}`,{cache:"no-store"}),ce(`/api/payment/admission?startDate=${ne}&endDate=${Pe}`,{cache:"no-store"}),ce(`/api/subscriptions/transactions/manual?startDate=${ne}&endDate=${Pe}`,{cache:"no-store"}),ce(`/api/inventory/comprehensive-analysis?startDate=${ne}&endDate=${Pe}&clinicId=${Ye}`,{cache:"no-store"})]);if(!rt.ok||!ut.ok||!je.ok||!Qe.ok)throw new Error("Failed to fetch fresh data for AI analysis.");const ze=await rt.json(),dt=await ut.json(),Ze=await je.json(),ct=await Qe.json(),ft=ze.bills||[],fe=dt.admissionPayments||[],Q=Ze||[],ue={consultation:0,pharmacy:0,lab:0,other:0},De={reception:{},pharmacy:{},lab:{}};return ft.forEach(Ge=>{if(Ge.status==="paid"||Ge.type==="pharmacy_return"){const ye=parseFloat(Ge.amount.toString()),Ne=Ge.payment_mode||"Unknown";let Me=Ge.type||"other";Me==="pharmacy_return"&&(Me="pharmacy"),ue.hasOwnProperty(Me)?ue[Me]=(ue[Me]||0)+ye:ue.other=(ue.other||0)+ye,Me==="pharmacy"?De.pharmacy[Ne]=(De.pharmacy[Ne]||0)+ye:Me==="lab"?De.lab[Ne]=(De.lab[Ne]||0)+ye:De.reception[Ne]=(De.reception[Ne]||0)+ye}}),fe.forEach(Ge=>{const ye=parseFloat(Ge.amount_paid.toString()),Ne=Ge.payment_mode||"Unknown";De.reception[Ne]=(De.reception[Ne]||0)+ye}),Q.forEach(Ge=>{var Me,Fe;const ye=parseFloat(((Fe=(Me=Ge.subscriptionPlan)==null?void 0:Me.price)==null?void 0:Fe.toString())??"0"),Ne=Ge.subscription_payment_method||"manual";De.reception[Ne]=(De.reception[Ne]||0)+ye}),{revenueSummary:ue,detailedRevenue:De,inventoryStats:ct}},de=ne=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",minimumFractionDigits:0}).format(ne),Le=async(ne,Pe,Ye,rt,ut,je,Qe,ze)=>{let dt=ne,Ze=Pe,ct=Ye,ft=rt,fe=ut,Q=je,ue=0;const De=5,Ge=[...ee];!dt.trim()&&Qe&&(dt="Analyze this image and provide insights based on the current dashboard data.");try{for(;ue<De;){const ye={query:dt,todayDate:new Date().toISOString().split("T")[0],currentStartDate:Ze,currentEndDate:ct,revenueSummary:ft,detailedRevenue:fe,inventoryStats:Q,history:Ge,imageBase64:ue===0?Qe:void 0,imageMimeType:ue===0?ze:void 0},Ne=await b9(ye);if(Ne.response_type==="action"&&Ne.action_name==="change_date_range"){const{startDate:Me,endDate:Fe}=Ne.parameters;V(ke=>[...ke,{role:"ai",content:`Checking data from ${Me} to ${Fe}...`}]),t(Me),a(Fe),ge(Me,Fe);const ve=await me(Me,Fe);Ze=Me,ct=Fe,ft=ve.revenueSummary,fe=ve.detailedRevenue,Q=ve.inventoryStats,Ge.push({role:"model",content:JSON.stringify(Ne)}),Ge.push({role:"user",content:`Action ${Ne.action_name} executed successfully. Data refreshed. Continuing analysis.`}),setTimeout(()=>{var ke;(ke=Se.current)==null||ke.scrollIntoView({behavior:"smooth",block:"start"})},100),ue++}else if(Ne.response_type==="action"&&Ne.action_name==="end_analysis"){Ne.content&&(V(Me=>[...Me,{role:"ai",content:Ne.content}]),Ge.push({role:"model",content:Ne.content}));break}else{const Me=Ne.content||"Analysis complete.";V(Fe=>[...Fe,{role:"ai",content:Me}]),Ge.push({role:"model",content:Me});break}}ie(Ge)}catch(ye){console.error("AI Loop Error:",ye),V(Ne=>[...Ne,{role:"ai",content:"I encountered an error while analyzing deeply."}])}},He=async()=>{var rt;if(!ae.trim()&&!re)return;const ne=ae,Pe=re==null?void 0:re.base64,Ye=(rt=re==null?void 0:re.file)==null?void 0:rt.type;V(ut=>[...ut,{role:"user",content:ne||(re?"[Image Attached]":"")}]),ie(ut=>[...ut,{role:"user",content:ne||"Analyze image."}]),J(""),A(null),W(!0),await Le(ne,n,r,T,C,I,Pe,Ye),W(!1)},pe=()=>{V([]),ie([]),J(""),A(null)};return i.jsxs("div",{className:Ct.container,ref:M,children:[i.jsxs("header",{className:Ct.header,children:[i.jsx("h2",{className:Ct.title,children:"Comprehensive Analysis Dashboard"}),i.jsxs("div",{className:Ct.filtersContainer,children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"start-date",className:Ct.dateInputLabel,children:"Start Date"}),i.jsx("input",{type:"date",id:"start-date",value:n,onChange:ne=>t(ne.target.value),className:Ct.dateInput})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"end-date",className:Ct.dateInputLabel,children:"End Date"}),i.jsx("input",{type:"date",id:"end-date",value:r,onChange:ne=>a(ne.target.value),className:Ct.dateInput})]}),i.jsx("button",{onClick:()=>ge(),disabled:L,className:Ct.fetchButton,children:L?"Analyzing...":"Generate Report"})]})]}),i.jsxs(i.Fragment,{children:[B&&i.jsxs("div",{className:Ct.errorAlert,children:[i.jsx(mi,{size:20}),i.jsx("span",{children:B})]}),L&&i.jsxs("div",{className:Ct.loadingContainer,children:[i.jsx("div",{className:Ct.breathingBall}),i.jsx("p",{children:"Compiling Financial & Inventory Data..."})]}),!L&&!B&&(T||I)&&i.jsxs("div",{className:Ct.dashboardGrid,children:[i.jsxs("div",{className:Ct.sectionContainer,ref:Se,children:[i.jsxs("h3",{className:Ct.sectionTitle,children:[i.jsx(Hf,{size:20,className:"text-blue-500"})," Financial Overview"]}),i.jsxs("div",{className:Ct.totalRevenue,children:[i.jsxs("span",{children:["Total Revenue (",n," to ",r,")"]}),i.jsx("div",{className:Ct.totalRevenueAmount,children:de(g)})]}),T&&C&&i.jsxs("div",{className:Ct.revenueGrid,children:[i.jsxs("div",{className:Ct.revenueCard,children:[i.jsxs("div",{className:Ct.revenueCardTitle,children:[i.jsx($P,{size:16,color:"var(--Primary-60)"}),i.jsx("span",{children:"Reception & Admissions"})]}),i.jsx("div",{className:Ct.revenueCardAmount,children:de((T.consultation||0)+(T.other||0))}),i.jsx("ul",{className:Ct.revenueCardList,children:Object.entries(C.reception).map(([ne,Pe])=>i.jsxs("li",{children:[i.jsx("span",{className:Ct.capitalize,children:ne}),i.jsx("span",{children:de(Pe)})]},`rec - ${ne} `))})]}),i.jsxs("div",{className:Ct.revenueCard,children:[i.jsxs("div",{className:Ct.revenueCardTitle,children:[i.jsx(n2,{size:16,color:"#A78BFA"}),i.jsx("span",{children:"Pharmacy Sales"})]}),i.jsx("div",{className:Ct.revenueCardAmount,children:de(T.pharmacy||0)}),i.jsxs("ul",{className:Ct.revenueCardList,children:[Object.entries(C.pharmacy).map(([ne,Pe])=>i.jsxs("li",{children:[i.jsx("span",{className:Ct.capitalize,children:ne}),i.jsx("span",{children:de(Pe)})]},`phar - ${ne} `)),v<0&&i.jsxs("li",{style:{color:"var(--Danger)",borderTop:"1px dashed #eee",marginTop:"0.5rem",paddingTop:"0.5rem"},children:[i.jsx("span",{children:"Returns"}),i.jsx("span",{children:de(v)})]})]})]}),i.jsxs("div",{className:Ct.revenueCard,children:[i.jsxs("div",{className:Ct.revenueCardTitle,children:[i.jsx($M,{size:16,color:"#5EEAD4"}),i.jsx("span",{children:"Lab Revenue"})]}),i.jsx("div",{className:Ct.revenueCardAmount,children:de(T.lab||0)}),i.jsx("ul",{className:Ct.revenueCardList,children:Object.entries(C.lab).map(([ne,Pe])=>i.jsxs("li",{children:[i.jsx("span",{className:Ct.capitalize,children:ne}),i.jsx("span",{children:de(Pe)})]},`lab - ${ne} `))})]})]})]}),I&&i.jsxs("div",{className:Ct.sectionContainer,children:[i.jsxs("h3",{className:Ct.sectionTitle,children:[i.jsx(Io,{size:20,className:"text-purple-500"})," Inventory Analytics"]}),i.jsxs("div",{className:Ct.revenueGrid,children:[i.jsxs("div",{className:Ct.revenueCard,children:[i.jsx("div",{className:Ct.revenueCardTitle,children:"Pharmacy Net Profit"}),i.jsx("div",{className:`${Ct.revenueCardAmount} ${Ct.textGreen} `,children:de(I.totals.pharmacyProfit)})]}),i.jsxs("div",{className:Ct.revenueCard,children:[i.jsx("div",{className:Ct.revenueCardTitle,children:"Pharmacy Revenue"}),i.jsx("div",{className:Ct.revenueCardAmount,children:de(I.totals.pharmacyRevenue)})]}),i.jsxs("div",{className:Ct.revenueCard,children:[i.jsx("div",{className:Ct.revenueCardTitle,children:"Lab Estimated Revenue"}),i.jsx("div",{className:Ct.revenueCardAmount,children:de(I.totals.labRevenue)})]})]}),i.jsx("h4",{style:{margin:"0.75rem 0 0.5rem",fontSize:"0.9rem",fontWeight:600},children:"Pharmacy Stock Movement"}),i.jsx("div",{className:Ct.tableContainer,children:i.jsxs("table",{className:Ct.styledTable,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Drug Name"}),i.jsx("th",{className:Ct.textRight,children:"Stock In (+)"}),i.jsx("th",{className:Ct.textRight,children:"Stock Out (-)"}),i.jsx("th",{className:Ct.textRight,children:"Converted"}),i.jsx("th",{className:Ct.textRight,children:"Profit"})]})}),i.jsxs("tbody",{children:[I==null?void 0:I.pharmacyAnalysis.map(ne=>i.jsxs("tr",{children:[i.jsxs("td",{children:[ne.name," ",i.jsxs("span",{style:{fontSize:"0.8em",color:"#666"},children:["(",ne.unit,")"]})]}),i.jsx("td",{className:Ct.textRight,children:i.jsx("div",{className:Ct.reasonDistribution,children:ne.quantity_in>0?i.jsxs("span",{className:Ct.textGreen,children:["+",ne.quantity_in]}):"-"})}),i.jsx("td",{className:Ct.textRight,children:i.jsxs("div",{className:Ct.reasonDistribution,children:[ne.quantity_out>0?i.jsxs("span",{className:Ct.textRed,children:["-",ne.quantity_out]}):"-",ne.loose_quantity_out>0&&i.jsxs("div",{style:{fontSize:"0.8em"},children:["(",ne.loose_quantity_out," loose)"]})]})}),i.jsx("td",{className:`${Ct.textRight} ${Ct.textOrange} `,children:ne.quantity_converted>0?ne.quantity_converted:"-"}),i.jsx("td",{className:`${Ct.textRight} ${Ct.fontMedium} `,children:de(ne.profit)})]},ne.drug_id)),(I==null?void 0:I.pharmacyAnalysis.length)===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"text-center p-4 text-gray-400",children:"No stock movement recorded"})})]})]})})]}),i.jsxs("div",{className:Ct.sectionContainer,children:[i.jsxs("h3",{className:Ct.sectionTitle,children:[i.jsx(ds,{size:20,className:"text-gray-500"})," Transaction Detail"]}),i.jsx("div",{className:Ct.tableContainer,children:i.jsxs("table",{className:Ct.styledTable,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Date"}),i.jsx("th",{children:"ID"}),i.jsx("th",{children:"Patient"}),i.jsx("th",{children:"Type"}),i.jsx("th",{children:"Mode"}),i.jsx("th",{className:Ct.textRight,children:"Amount"})]})}),i.jsxs("tbody",{children:[o.filter(ne=>ne.status==="paid"||ne.type==="pharmacy_return").map(ne=>i.jsxs("tr",{children:[i.jsx("td",{children:new Date(ne.createdAt).toLocaleDateString()}),i.jsxs("td",{children:["#",ne.id]}),i.jsx("td",{children:ne.patient_id}),i.jsx("td",{className:Ct.capitalize,children:ne.type.replace("_"," ")}),i.jsx("td",{className:Ct.capitalize,children:ne.payment_mode}),i.jsx("td",{className:`${Ct.textRight} ${Ct.fontMedium} `,children:de(Math.abs(Number(ne.amount)))})]},`bill - ${ne.id} `)),h.map(ne=>{var Pe;return i.jsxs("tr",{children:[i.jsx("td",{children:new Date(ne.payment_date).toLocaleDateString()}),i.jsxs("td",{children:["IPD-",ne.id]}),i.jsx("td",{children:((Pe=ne.Patient)==null?void 0:Pe.name)||ne.patient_id}),i.jsx("td",{children:"Admission"}),i.jsx("td",{className:Ct.capitalize,children:ne.payment_mode}),i.jsx("td",{className:`${Ct.textRight} ${Ct.fontMedium} `,children:de(Number(ne.amount_paid))})]},`adm - ${ne.id} `)}),u.map(ne=>{var Pe;return i.jsxs("tr",{children:[i.jsx("td",{children:new Date(ne.subscription_start_date).toLocaleDateString()}),i.jsxs("td",{children:["SUB-",ne.id]}),i.jsx("td",{children:ne.name}),i.jsx("td",{children:"Subscription"}),i.jsx("td",{className:Ct.capitalize,children:"Manual"}),i.jsx("td",{className:`${Ct.textRight} ${Ct.fontMedium} `,children:de(Number(((Pe=ne.subscriptionPlan)==null?void 0:Pe.price)||0))})]},`sub - ${ne.id} `)})]})]})})]})]}),!L&&!T&&!I&&i.jsx("div",{className:Ct.noDataMessage,children:i.jsx("p",{children:'Select a date range and click "Generate Report" to view analysis.'})})]}),i.jsxs("div",{className:`${Tt.chatWidget} ${F?Tt.chatOpen:""} `,children:[!F&&i.jsxs("button",{className:Tt.chatToggleBtn,onClick:()=>z(!0),children:[i.jsx(cs,{size:24}),i.jsx("span",{className:Tt.chatToggleText,children:"Ask AI Analyst"})]}),F&&i.jsxs("div",{className:Tt.chatWindow,children:[i.jsxs("div",{className:Tt.chatHeader,children:[i.jsxs("div",{className:Tt.chatHeaderTitle,children:[i.jsx(cs,{size:22}),i.jsx("span",{children:"Clinic Analyst AI"})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i.jsx("button",{onClick:pe,title:"Refresh chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:ne=>ne.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:ne=>ne.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(Il,{size:16,color:"#ffffff",strokeWidth:2.5})}),i.jsx("button",{onClick:()=>z(!1),title:"Minimize chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:ne=>ne.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:ne=>ne.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(xw,{size:16,color:"#ffffff",strokeWidth:2.5})})]})]}),i.jsxs("div",{className:Tt.chatMessages,children:[U.length===0&&i.jsxs("div",{className:Tt.emptyChatState,children:[i.jsx("div",{className:Tt.emptyChatIcon,children:i.jsx(cs,{size:42})}),i.jsx("p",{children:"Hi! I'm your data analyst. Ask me about your revenue, inventory, or specific trends."}),i.jsxs("div",{className:Tt.suggestionChips,children:[i.jsx("button",{onClick:()=>J("What is the total revenue this month?"),children:"Revenue this month?"}),i.jsx("button",{onClick:()=>J("Which drugs are selling the most?"),children:"Top selling drugs?"}),i.jsx("button",{onClick:()=>J("Analyze the pharmacy profit."),children:"Pharmacy profit?"})]})]}),U.map((ne,Pe)=>i.jsxs("div",{className:`${Tt.messageBubble} ${ne.role==="user"?Tt.userMessage:Tt.aiMessage} `,children:[i.jsx("div",{className:Tt.messageIcon,children:ne.role==="user"?i.jsx(Mo,{size:16}):i.jsx(cs,{size:16})}),i.jsx("div",{className:Tt.messageContent,children:i.jsx(Bs,{remarkPlugins:[os],children:ne.content})})]},Pe)),K&&i.jsx("div",{className:`${Tt.messageBubble} ${Tt.aiMessage} `,children:i.jsxs("div",{className:Tt.typingIndicator,children:[i.jsx("span",{}),i.jsx("span",{}),i.jsx("span",{})]})}),i.jsx("div",{ref:te})]}),i.jsxs("div",{className:Tt.chatInputArea,children:[i.jsx("input",{type:"file",ref:xe,style:{display:"none"},accept:"image/*",onChange:he}),re?i.jsxs("div",{className:Tt.aiImagePreviewBox,children:[i.jsx("img",{src:re.preview,alt:"Preview",className:Tt.aiImagePreviewThumbnail}),i.jsx("button",{className:Tt.aiImageRemoveBadge,onClick:()=>A(null),children:i.jsx(Sn,{size:12})})]}):i.jsx("button",{className:Tt.aiAttachBtn,onClick:()=>{var ne;return(ne=xe.current)==null?void 0:ne.click()},title:"Attach Image",children:i.jsx(yw,{size:22,strokeWidth:2.5})}),i.jsx("input",{type:"text",className:Tt.chatInputAreaInput,value:ae,onChange:ne=>J(ne.target.value),onKeyDown:ne=>ne.key==="Enter"&&He(),placeholder:"Ask about your data or attach an image...",disabled:K,autoFocus:!0}),i.jsx("button",{onClick:He,disabled:!ae.trim()&&!re||K,className:Tt.sendBtn,children:i.jsx(Mb,{size:20})})]})]})]})]})};var w0,Aj;function v9(){if(Aj)return w0;Aj=1;var e="Expected a function",n=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt,d=typeof ju=="object"&&ju&&ju.Object===Object&&ju,u=typeof self=="object"&&self&&self.Object===Object&&self,f=d||u||Function("return this")(),g=Object.prototype,b=g.toString,v=Math.max,S=Math.min,T=function(){return f.Date.now()};function E(L,O,B){var $,F,z,U,V,ee,ie=0,ae=!1,J=!1,K=!0;if(typeof L!="function")throw new TypeError(e);O=q(O)||0,C(B)&&(ae=!!B.leading,J="maxWait"in B,z=J?v(q(B.maxWait)||0,O):z,K="trailing"in B?!!B.trailing:K);function W(ge){var me=$,de=F;return $=F=void 0,ie=ge,U=L.apply(de,me),U}function re(ge){return ie=ge,V=setTimeout(xe,O),ae?W(ge):U}function A(ge){var me=ge-ee,de=ge-ie,Le=O-me;return J?S(Le,z-de):Le}function te(ge){var me=ge-ee,de=ge-ie;return ee===void 0||me>=O||me<0||J&&de>=z}function xe(){var ge=T();if(te(ge))return M(ge);V=setTimeout(xe,A(ge))}function M(ge){return V=void 0,K&&$?W(ge):($=F=void 0,U)}function Se(){V!==void 0&&clearTimeout(V),ie=0,$=ee=F=V=void 0}function $e(){return V===void 0?U:M(T())}function he(){var ge=T(),me=te(ge);if($=arguments,F=this,ee=ge,me){if(V===void 0)return re(ee);if(J)return V=setTimeout(xe,O),W(ee)}return V===void 0&&(V=setTimeout(xe,O)),U}return he.cancel=Se,he.flush=$e,he}function C(L){var O=typeof L;return!!L&&(O=="object"||O=="function")}function P(L){return!!L&&typeof L=="object"}function I(L){return typeof L=="symbol"||P(L)&&b.call(L)==t}function q(L){if(typeof L=="number")return L;if(I(L))return n;if(C(L)){var O=typeof L.valueOf=="function"?L.valueOf():L;L=C(O)?O+"":O}if(typeof L!="string")return L===0?L:+L;L=L.replace(r,"");var B=o.test(L);return B||l.test(L)?h(L.slice(2),B?2:8):a.test(L)?n:+L}return w0=E,w0}var w9=v9();const Vb=ah(w9),Fw=async()=>{const e=await ce("/api/clinic-subscriptions/plans",{method:"GET"});if(!e.ok){const n=await e.json();throw new Error(n.message||"Failed to fetch clinic subscription plans")}return e.json()},N9=async e=>{const n=await ce(`/api/clinic-subscriptions/cancel/${e}`,{method:"PUT"});if(!n.ok){const t=await n.json();throw new Error(t.message||"Failed to cancel clinic subscription")}return n.json()},S9=async e=>{const n=await ce(`/api/clinics/${e}/subscription-status`,{method:"GET"});if(!n.ok){const t=await n.json();throw new Error(t.message||`Failed to fetch subscription status for clinic ${e}`)}return n.json()},j9=async e=>{const n=await ce(`/api/clinic-subscriptions/plans/${e}`,{method:"GET"});if(!n.ok){const t=await n.json();throw new Error(t.message||"Failed to fetch clinic subscription plan")}return n.json()},_9=async e=>{const n=await ce("/api/clinic-subscriptions/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const t=await n.json();throw new Error(t.message||"Failed to create clinic subscription plan")}return n.json()},C9=async(e,n)=>{const t=await ce(`/api/clinic-subscriptions/plans/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){const r=await t.json();throw new Error(r.message||"Failed to update clinic subscription plan")}return t.json()},k9=async e=>{const n=await ce(`/api/clinic-subscriptions/plans/${e}`,{method:"DELETE"});if(!n.ok){const t=await n.json();throw new Error(t.message||"Failed to deactivate clinic subscription plan")}return n.json()},T9=async e=>{const n=await ce("/api/clinic-subscriptions/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:e})});if(!n.ok){const t=await n.json();throw new Error(t.message||"Failed to initiate clinic subscription")}return n.json()},E9=async()=>{try{const e=await ce("/api/clinic-subscriptions/pending",{method:"GET"});return e.ok?e.json():null}catch(e){return console.error("Error checking for pending subscription:",e),null}},kk=async()=>{const e=await ce("/api/clinics/subscription-status",{method:"GET"});if(!e.ok){const n=await e.json();throw new Error(n.message||"Failed to fetch clinic subscription status")}return e.json()};var N0={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Dj;function A9(){return Dj||(Dj=1,function(e){(function(){var n={}.hasOwnProperty;function t(){for(var o="",l=0;l<arguments.length;l++){var h=arguments[l];h&&(o=a(o,r(h)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var l="";for(var h in o)n.call(o,h)&&o[h]&&(l=a(l,h));return l}function a(o,l){return l?o?o+" "+l:o+l:o}e.exports?(t.default=t,e.exports=t):window.classNames=t})()}(N0)),N0.exports}var D9=A9();const _u=ah(D9);function ih(e){"@babel/helpers - typeof";return ih=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ih(e)}function P9(e,n){if(ih(e)!="object"||!e)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var r=t.call(e,n);if(ih(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Tk(e){var n=P9(e,"string");return ih(n)=="symbol"?n:n+""}function Qm(e,n,t){return(n=Tk(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function Pj(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function Gt(e){for(var n=1;n<arguments.length;n++){var t=arguments[n]!=null?arguments[n]:{};n%2?Pj(Object(t),!0).forEach(function(r){Qm(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Pj(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function I9(e){if(Array.isArray(e))return e}function M9(e,n){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var r,a,o,l,h=[],d=!0,u=!1;try{if(o=(t=t.call(e)).next,n===0){if(Object(t)!==t)return;d=!1}else for(;!(d=(r=o.call(t)).done)&&(h.push(r.value),h.length!==n);d=!0);}catch(f){u=!0,a=f}finally{try{if(!d&&t.return!=null&&(l=t.return(),Object(l)!==l))return}finally{if(u)throw a}}return h}}function E1(e,n){(n==null||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function Ek(e,n){if(e){if(typeof e=="string")return E1(e,n);var t={}.toString.call(e).slice(8,-1);return t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set"?Array.from(e):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E1(e,n):void 0}}function R9(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xc(e,n){return I9(e)||M9(e,n)||Ek(e,n)||R9()}function O9(e,n){if(e==null)return{};var t={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(n.indexOf(r)!==-1)continue;t[r]=e[r]}return t}function jc(e,n){if(e==null)return{};var t,r,a=O9(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)===-1&&{}.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var L9=["defaultInputValue","defaultMenuIsOpen","defaultValue","inputValue","menuIsOpen","onChange","onInputChange","onMenuClose","onMenuOpen","value"];function F9(e){var n=e.defaultInputValue,t=n===void 0?"":n,r=e.defaultMenuIsOpen,a=r===void 0?!1:r,o=e.defaultValue,l=o===void 0?null:o,h=e.inputValue,d=e.menuIsOpen,u=e.onChange,f=e.onInputChange,g=e.onMenuClose,b=e.onMenuOpen,v=e.value,S=jc(e,L9),T=w.useState(h!==void 0?h:t),E=xc(T,2),C=E[0],P=E[1],I=w.useState(d!==void 0?d:a),q=xc(I,2),L=q[0],O=q[1],B=w.useState(v!==void 0?v:l),$=xc(B,2),F=$[0],z=$[1],U=w.useCallback(function(W,re){typeof u=="function"&&u(W,re),z(W)},[u]),V=w.useCallback(function(W,re){var A;typeof f=="function"&&(A=f(W,re)),P(A!==void 0?A:W)},[f]),ee=w.useCallback(function(){typeof b=="function"&&b(),O(!0)},[b]),ie=w.useCallback(function(){typeof g=="function"&&g(),O(!1)},[g]),ae=h!==void 0?h:C,J=d!==void 0?d:L,K=v!==void 0?v:F;return Gt(Gt({},S),{},{inputValue:ae,menuIsOpen:J,onChange:U,onInputChange:V,onMenuClose:ie,onMenuOpen:ee,value:K})}function Qt(){return Qt=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)({}).hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},Qt.apply(null,arguments)}function $9(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Ij(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tk(r.key),r)}}function z9(e,n,t){return n&&Ij(e.prototype,n),t&&Ij(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function A1(e,n){return A1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},A1(e,n)}function B9(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&A1(e,n)}function pb(e){return pb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},pb(e)}function Ak(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ak=function(){return!!e})()}function U9(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q9(e,n){if(n&&(ih(n)=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return U9(e)}function V9(e){var n=Ak();return function(){var t,r=pb(e);if(n){var a=pb(this).constructor;t=Reflect.construct(r,arguments,a)}else t=r.apply(this,arguments);return q9(this,t)}}function H9(e){if(Array.isArray(e))return E1(e)}function G9(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Y9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $w(e){return H9(e)||G9(e)||Ek(e)||Y9()}function W9(e){if(e.sheet)return e.sheet;for(var n=0;n<document.styleSheets.length;n++)if(document.styleSheets[n].ownerNode===e)return document.styleSheets[n]}function Q9(e){var n=document.createElement("style");return n.setAttribute("data-emotion",e.key),e.nonce!==void 0&&n.setAttribute("nonce",e.nonce),n.appendChild(document.createTextNode("")),n.setAttribute("data-s",""),n}var J9=function(){function e(t){var r=this;this._insertTag=function(a){var o;r.tags.length===0?r.insertionPoint?o=r.insertionPoint.nextSibling:r.prepend?o=r.container.firstChild:o=r.before:o=r.tags[r.tags.length-1].nextSibling,r.container.insertBefore(a,o),r.tags.push(a)},this.isSpeedy=t.speedy===void 0?!0:t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var n=e.prototype;return n.hydrate=function(r){r.forEach(this._insertTag)},n.insert=function(r){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(Q9(this));var a=this.tags[this.tags.length-1];if(this.isSpeedy){var o=W9(a);try{o.insertRule(r,o.cssRules.length)}catch{}}else a.appendChild(document.createTextNode(r));this.ctr++},n.flush=function(){this.tags.forEach(function(r){var a;return(a=r.parentNode)==null?void 0:a.removeChild(r)}),this.tags=[],this.ctr=0},e}(),Zr="-ms-",mb="-moz-",Jn="-webkit-",Dk="comm",zw="rule",Bw="decl",K9="@import",Pk="@keyframes",X9="@layer",Z9=Math.abs,Hb=String.fromCharCode,e7=Object.assign;function t7(e,n){return Lr(e,0)^45?(((n<<2^Lr(e,0))<<2^Lr(e,1))<<2^Lr(e,2))<<2^Lr(e,3):0}function Ik(e){return e.trim()}function n7(e,n){return(e=n.exec(e))?e[0]:e}function Kn(e,n,t){return e.replace(n,t)}function D1(e,n){return e.indexOf(n)}function Lr(e,n){return e.charCodeAt(n)|0}function ug(e,n,t){return e.slice(n,t)}function kl(e){return e.length}function Uw(e){return e.length}function Ax(e,n){return n.push(e),e}function i7(e,n){return e.map(n).join("")}var Gb=1,rp=1,Mk=0,Ma=0,ar=0,hp="";function Yb(e,n,t,r,a,o,l){return{value:e,root:n,parent:t,type:r,props:a,children:o,line:Gb,column:rp,length:l,return:""}}function Um(e,n){return e7(Yb("",null,null,"",null,null,0),e,{length:-e.length},n)}function r7(){return ar}function a7(){return ar=Ma>0?Lr(hp,--Ma):0,rp--,ar===10&&(rp=1,Gb--),ar}function fs(){return ar=Ma<Mk?Lr(hp,Ma++):0,rp++,ar===10&&(rp=1,Gb++),ar}function Dl(){return Lr(hp,Ma)}function Kx(){return Ma}function jg(e,n){return ug(hp,e,n)}function dg(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Rk(e){return Gb=rp=1,Mk=kl(hp=e),Ma=0,[]}function Ok(e){return hp="",e}function Xx(e){return Ik(jg(Ma-1,P1(e===91?e+2:e===40?e+1:e)))}function s7(e){for(;(ar=Dl())&&ar<33;)fs();return dg(e)>2||dg(ar)>3?"":" "}function o7(e,n){for(;--n&&fs()&&!(ar<48||ar>102||ar>57&&ar<65||ar>70&&ar<97););return jg(e,Kx()+(n<6&&Dl()==32&&fs()==32))}function P1(e){for(;fs();)switch(ar){case e:return Ma;case 34:case 39:e!==34&&e!==39&&P1(ar);break;case 40:e===41&&P1(e);break;case 92:fs();break}return Ma}function l7(e,n){for(;fs()&&e+ar!==57;)if(e+ar===84&&Dl()===47)break;return"/*"+jg(n,Ma-1)+"*"+Hb(e===47?e:fs())}function c7(e){for(;!dg(Dl());)fs();return jg(e,Ma)}function u7(e){return Ok(Zx("",null,null,null,[""],e=Rk(e),0,[0],e))}function Zx(e,n,t,r,a,o,l,h,d){for(var u=0,f=0,g=l,b=0,v=0,S=0,T=1,E=1,C=1,P=0,I="",q=a,L=o,O=r,B=I;E;)switch(S=P,P=fs()){case 40:if(S!=108&&Lr(B,g-1)==58){D1(B+=Kn(Xx(P),"&","&\f"),"&\f")!=-1&&(C=-1);break}case 34:case 39:case 91:B+=Xx(P);break;case 9:case 10:case 13:case 32:B+=s7(S);break;case 92:B+=o7(Kx()-1,7);continue;case 47:switch(Dl()){case 42:case 47:Ax(d7(l7(fs(),Kx()),n,t),d);break;default:B+="/"}break;case 123*T:h[u++]=kl(B)*C;case 125*T:case 59:case 0:switch(P){case 0:case 125:E=0;case 59+f:C==-1&&(B=Kn(B,/\f/g,"")),v>0&&kl(B)-g&&Ax(v>32?Rj(B+";",r,t,g-1):Rj(Kn(B," ","")+";",r,t,g-2),d);break;case 59:B+=";";default:if(Ax(O=Mj(B,n,t,u,f,a,h,I,q=[],L=[],g),o),P===123)if(f===0)Zx(B,n,O,O,q,o,g,h,L);else switch(b===99&&Lr(B,3)===110?100:b){case 100:case 108:case 109:case 115:Zx(e,O,O,r&&Ax(Mj(e,O,O,0,0,a,h,I,a,q=[],g),L),a,L,g,h,r?q:L);break;default:Zx(B,O,O,O,[""],L,0,h,L)}}u=f=v=0,T=C=1,I=B="",g=l;break;case 58:g=1+kl(B),v=S;default:if(T<1){if(P==123)--T;else if(P==125&&T++==0&&a7()==125)continue}switch(B+=Hb(P),P*T){case 38:C=f>0?1:(B+="\f",-1);break;case 44:h[u++]=(kl(B)-1)*C,C=1;break;case 64:Dl()===45&&(B+=Xx(fs())),b=Dl(),f=g=kl(I=B+=c7(Kx())),P++;break;case 45:S===45&&kl(B)==2&&(T=0)}}return o}function Mj(e,n,t,r,a,o,l,h,d,u,f){for(var g=a-1,b=a===0?o:[""],v=Uw(b),S=0,T=0,E=0;S<r;++S)for(var C=0,P=ug(e,g+1,g=Z9(T=l[S])),I=e;C<v;++C)(I=Ik(T>0?b[C]+" "+P:Kn(P,/&\f/g,b[C])))&&(d[E++]=I);return Yb(e,n,t,a===0?zw:h,d,u,f)}function d7(e,n,t){return Yb(e,n,t,Dk,Hb(r7()),ug(e,2,-2),0)}function Rj(e,n,t,r){return Yb(e,n,t,Bw,ug(e,0,r),ug(e,r+1,-1),r)}function Wf(e,n){for(var t="",r=Uw(e),a=0;a<r;a++)t+=n(e[a],a,e,n)||"";return t}function h7(e,n,t,r){switch(e.type){case X9:if(e.children.length)break;case K9:case Bw:return e.return=e.return||e.value;case Dk:return"";case Pk:return e.return=e.value+"{"+Wf(e.children,r)+"}";case zw:e.value=e.props.join(",")}return kl(t=Wf(e.children,r))?e.return=e.value+"{"+t+"}":""}function f7(e){var n=Uw(e);return function(t,r,a,o){for(var l="",h=0;h<n;h++)l+=e[h](t,r,a,o)||"";return l}}function p7(e){return function(n){n.root||(n=n.return)&&e(n)}}function m7(e){var n=Object.create(null);return function(t){return n[t]===void 0&&(n[t]=e(t)),n[t]}}var g7=function(n,t,r){for(var a=0,o=0;a=o,o=Dl(),a===38&&o===12&&(t[r]=1),!dg(o);)fs();return jg(n,Ma)},y7=function(n,t){var r=-1,a=44;do switch(dg(a)){case 0:a===38&&Dl()===12&&(t[r]=1),n[r]+=g7(Ma-1,t,r);break;case 2:n[r]+=Xx(a);break;case 4:if(a===44){n[++r]=Dl()===58?"&\f":"",t[r]=n[r].length;break}default:n[r]+=Hb(a)}while(a=fs());return n},x7=function(n,t){return Ok(y7(Rk(n),t))},Oj=new WeakMap,b7=function(n){if(!(n.type!=="rule"||!n.parent||n.length<1)){for(var t=n.value,r=n.parent,a=n.column===r.column&&n.line===r.line;r.type!=="rule";)if(r=r.parent,!r)return;if(!(n.props.length===1&&t.charCodeAt(0)!==58&&!Oj.get(r))&&!a){Oj.set(n,!0);for(var o=[],l=x7(t,o),h=r.props,d=0,u=0;d<l.length;d++)for(var f=0;f<h.length;f++,u++)n.props[u]=o[d]?l[d].replace(/&\f/g,h[f]):h[f]+" "+l[d]}}},v7=function(n){if(n.type==="decl"){var t=n.value;t.charCodeAt(0)===108&&t.charCodeAt(2)===98&&(n.return="",n.value="")}};function Lk(e,n){switch(t7(e,n)){case 5103:return Jn+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Jn+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Jn+e+mb+e+Zr+e+e;case 6828:case 4268:return Jn+e+Zr+e+e;case 6165:return Jn+e+Zr+"flex-"+e+e;case 5187:return Jn+e+Kn(e,/(\w+).+(:[^]+)/,Jn+"box-$1$2"+Zr+"flex-$1$2")+e;case 5443:return Jn+e+Zr+"flex-item-"+Kn(e,/flex-|-self/,"")+e;case 4675:return Jn+e+Zr+"flex-line-pack"+Kn(e,/align-content|flex-|-self/,"")+e;case 5548:return Jn+e+Zr+Kn(e,"shrink","negative")+e;case 5292:return Jn+e+Zr+Kn(e,"basis","preferred-size")+e;case 6060:return Jn+"box-"+Kn(e,"-grow","")+Jn+e+Zr+Kn(e,"grow","positive")+e;case 4554:return Jn+Kn(e,/([^-])(transform)/g,"$1"+Jn+"$2")+e;case 6187:return Kn(Kn(Kn(e,/(zoom-|grab)/,Jn+"$1"),/(image-set)/,Jn+"$1"),e,"")+e;case 5495:case 3959:return Kn(e,/(image-set\([^]*)/,Jn+"$1$`$1");case 4968:return Kn(Kn(e,/(.+:)(flex-)?(.*)/,Jn+"box-pack:$3"+Zr+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Jn+e+e;case 4095:case 3583:case 4068:case 2532:return Kn(e,/(.+)-inline(.+)/,Jn+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(kl(e)-1-n>6)switch(Lr(e,n+1)){case 109:if(Lr(e,n+4)!==45)break;case 102:return Kn(e,/(.+:)(.+)-([^]+)/,"$1"+Jn+"$2-$3$1"+mb+(Lr(e,n+3)==108?"$3":"$2-$3"))+e;case 115:return~D1(e,"stretch")?Lk(Kn(e,"stretch","fill-available"),n)+e:e}break;case 4949:if(Lr(e,n+1)!==115)break;case 6444:switch(Lr(e,kl(e)-3-(~D1(e,"!important")&&10))){case 107:return Kn(e,":",":"+Jn)+e;case 101:return Kn(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Jn+(Lr(e,14)===45?"inline-":"")+"box$3$1"+Jn+"$2$3$1"+Zr+"$2box$3")+e}break;case 5936:switch(Lr(e,n+11)){case 114:return Jn+e+Zr+Kn(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Jn+e+Zr+Kn(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Jn+e+Zr+Kn(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Jn+e+Zr+e+e}return e}var w7=function(n,t,r,a){if(n.length>-1&&!n.return)switch(n.type){case Bw:n.return=Lk(n.value,n.length);break;case Pk:return Wf([Um(n,{value:Kn(n.value,"@","@"+Jn)})],a);case zw:if(n.length)return i7(n.props,function(o){switch(n7(o,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Wf([Um(n,{props:[Kn(o,/:(read-\w+)/,":"+mb+"$1")]})],a);case"::placeholder":return Wf([Um(n,{props:[Kn(o,/:(plac\w+)/,":"+Jn+"input-$1")]}),Um(n,{props:[Kn(o,/:(plac\w+)/,":"+mb+"$1")]}),Um(n,{props:[Kn(o,/:(plac\w+)/,Zr+"input-$1")]})],a)}return""})}},N7=[w7],S7=function(n){var t=n.key;if(t==="css"){var r=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(r,function(T){var E=T.getAttribute("data-emotion");E.indexOf(" ")!==-1&&(document.head.appendChild(T),T.setAttribute("data-s",""))})}var a=n.stylisPlugins||N7,o={},l,h=[];l=n.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),function(T){for(var E=T.getAttribute("data-emotion").split(" "),C=1;C<E.length;C++)o[E[C]]=!0;h.push(T)});var d,u=[b7,v7];{var f,g=[h7,p7(function(T){f.insert(T)})],b=f7(u.concat(a,g)),v=function(E){return Wf(u7(E),b)};d=function(E,C,P,I){f=P,v(E?E+"{"+C.styles+"}":C.styles),I&&(S.inserted[C.name]=!0)}}var S={key:t,sheet:new J9({key:t,container:l,nonce:n.nonce,speedy:n.speedy,prepend:n.prepend,insertionPoint:n.insertionPoint}),nonce:n.nonce,inserted:o,registered:{},insert:d};return S.sheet.hydrate(h),S},S0={exports:{}},ni={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lj;function j7(){if(Lj)return ni;Lj=1;var e=typeof Symbol=="function"&&Symbol.for,n=e?Symbol.for("react.element"):60103,t=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,o=e?Symbol.for("react.profiler"):60114,l=e?Symbol.for("react.provider"):60109,h=e?Symbol.for("react.context"):60110,d=e?Symbol.for("react.async_mode"):60111,u=e?Symbol.for("react.concurrent_mode"):60111,f=e?Symbol.for("react.forward_ref"):60112,g=e?Symbol.for("react.suspense"):60113,b=e?Symbol.for("react.suspense_list"):60120,v=e?Symbol.for("react.memo"):60115,S=e?Symbol.for("react.lazy"):60116,T=e?Symbol.for("react.block"):60121,E=e?Symbol.for("react.fundamental"):60117,C=e?Symbol.for("react.responder"):60118,P=e?Symbol.for("react.scope"):60119;function I(L){if(typeof L=="object"&&L!==null){var O=L.$$typeof;switch(O){case n:switch(L=L.type,L){case d:case u:case r:case o:case a:case g:return L;default:switch(L=L&&L.$$typeof,L){case h:case f:case S:case v:case l:return L;default:return O}}case t:return O}}}function q(L){return I(L)===u}return ni.AsyncMode=d,ni.ConcurrentMode=u,ni.ContextConsumer=h,ni.ContextProvider=l,ni.Element=n,ni.ForwardRef=f,ni.Fragment=r,ni.Lazy=S,ni.Memo=v,ni.Portal=t,ni.Profiler=o,ni.StrictMode=a,ni.Suspense=g,ni.isAsyncMode=function(L){return q(L)||I(L)===d},ni.isConcurrentMode=q,ni.isContextConsumer=function(L){return I(L)===h},ni.isContextProvider=function(L){return I(L)===l},ni.isElement=function(L){return typeof L=="object"&&L!==null&&L.$$typeof===n},ni.isForwardRef=function(L){return I(L)===f},ni.isFragment=function(L){return I(L)===r},ni.isLazy=function(L){return I(L)===S},ni.isMemo=function(L){return I(L)===v},ni.isPortal=function(L){return I(L)===t},ni.isProfiler=function(L){return I(L)===o},ni.isStrictMode=function(L){return I(L)===a},ni.isSuspense=function(L){return I(L)===g},ni.isValidElementType=function(L){return typeof L=="string"||typeof L=="function"||L===r||L===u||L===o||L===a||L===g||L===b||typeof L=="object"&&L!==null&&(L.$$typeof===S||L.$$typeof===v||L.$$typeof===l||L.$$typeof===h||L.$$typeof===f||L.$$typeof===E||L.$$typeof===C||L.$$typeof===P||L.$$typeof===T)},ni.typeOf=I,ni}var Fj;function _7(){return Fj||(Fj=1,S0.exports=j7()),S0.exports}var j0,$j;function C7(){if($j)return j0;$j=1;var e=_7(),n={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},t={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},r={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},a={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},o={};o[e.ForwardRef]=r,o[e.Memo]=a;function l(S){return e.isMemo(S)?a:o[S.$$typeof]||n}var h=Object.defineProperty,d=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,g=Object.getPrototypeOf,b=Object.prototype;function v(S,T,E){if(typeof T!="string"){if(b){var C=g(T);C&&C!==b&&v(S,C,E)}var P=d(T);u&&(P=P.concat(u(T)));for(var I=l(S),q=l(T),L=0;L<P.length;++L){var O=P[L];if(!t[O]&&!(E&&E[O])&&!(q&&q[O])&&!(I&&I[O])){var B=f(T,O);try{h(S,O,B)}catch{}}}}return S}return j0=v,j0}C7();var k7=!0;function T7(e,n,t){var r="";return t.split(" ").forEach(function(a){e[a]!==void 0?n.push(e[a]+";"):a&&(r+=a+" ")}),r}var Fk=function(n,t,r){var a=n.key+"-"+t.name;(r===!1||k7===!1)&&n.registered[a]===void 0&&(n.registered[a]=t.styles)},E7=function(n,t,r){Fk(n,t,r);var a=n.key+"-"+t.name;if(n.inserted[t.name]===void 0){var o=t;do n.insert(t===o?"."+a:"",o,n.sheet,!0),o=o.next;while(o!==void 0)}};function A7(e){for(var n=0,t,r=0,a=e.length;a>=4;++r,a-=4)t=e.charCodeAt(r)&255|(e.charCodeAt(++r)&255)<<8|(e.charCodeAt(++r)&255)<<16|(e.charCodeAt(++r)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,n=(t&65535)*1540483477+((t>>>16)*59797<<16)^(n&65535)*1540483477+((n>>>16)*59797<<16);switch(a){case 3:n^=(e.charCodeAt(r+2)&255)<<16;case 2:n^=(e.charCodeAt(r+1)&255)<<8;case 1:n^=e.charCodeAt(r)&255,n=(n&65535)*1540483477+((n>>>16)*59797<<16)}return n^=n>>>13,n=(n&65535)*1540483477+((n>>>16)*59797<<16),((n^n>>>15)>>>0).toString(36)}var D7={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,scale:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},P7=/[A-Z]|^ms/g,I7=/_EMO_([^_]+?)_([^]*?)_EMO_/g,$k=function(n){return n.charCodeAt(1)===45},zj=function(n){return n!=null&&typeof n!="boolean"},_0=m7(function(e){return $k(e)?e:e.replace(P7,"-$&").toLowerCase()}),Bj=function(n,t){switch(n){case"animation":case"animationName":if(typeof t=="string")return t.replace(I7,function(r,a,o){return Tl={name:a,styles:o,next:Tl},a})}return D7[n]!==1&&!$k(n)&&typeof t=="number"&&t!==0?t+"px":t};function hg(e,n,t){if(t==null)return"";var r=t;if(r.__emotion_styles!==void 0)return r;switch(typeof t){case"boolean":return"";case"object":{var a=t;if(a.anim===1)return Tl={name:a.name,styles:a.styles,next:Tl},a.name;var o=t;if(o.styles!==void 0){var l=o.next;if(l!==void 0)for(;l!==void 0;)Tl={name:l.name,styles:l.styles,next:Tl},l=l.next;var h=o.styles+";";return h}return M7(e,n,t)}case"function":{if(e!==void 0){var d=Tl,u=t(e);return Tl=d,hg(e,n,u)}break}}var f=t;return f}function M7(e,n,t){var r="";if(Array.isArray(t))for(var a=0;a<t.length;a++)r+=hg(e,n,t[a])+";";else for(var o in t){var l=t[o];if(typeof l!="object"){var h=l;zj(h)&&(r+=_0(o)+":"+Bj(o,h)+";")}else if(Array.isArray(l)&&typeof l[0]=="string"&&n==null)for(var d=0;d<l.length;d++)zj(l[d])&&(r+=_0(o)+":"+Bj(o,l[d])+";");else{var u=hg(e,n,l);switch(o){case"animation":case"animationName":{r+=_0(o)+":"+u+";";break}default:r+=o+"{"+u+"}"}}}return r}var Uj=/label:\s*([^\s;{]+)\s*(;|$)/g,Tl;function zk(e,n,t){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var r=!0,a="";Tl=void 0;var o=e[0];if(o==null||o.raw===void 0)r=!1,a+=hg(t,n,o);else{var l=o;a+=l[0]}for(var h=1;h<e.length;h++)if(a+=hg(t,n,e[h]),r){var d=o;a+=d[h]}Uj.lastIndex=0;for(var u="",f;(f=Uj.exec(a))!==null;)u+="-"+f[1];var g=A7(a)+u;return{name:g,styles:a,next:Tl}}var R7=function(n){return n()},O7=bN.useInsertionEffect?bN.useInsertionEffect:!1,L7=O7||R7,Bk=w.createContext(typeof HTMLElement<"u"?S7({key:"css"}):null);Bk.Provider;var F7=function(n){return w.forwardRef(function(t,r){var a=w.useContext(Bk);return n(t,a,r)})},$7=w.createContext({}),qw={}.hasOwnProperty,I1="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",z7=function(n,t){var r={};for(var a in t)qw.call(t,a)&&(r[a]=t[a]);return r[I1]=n,r},B7=function(n){var t=n.cache,r=n.serialized,a=n.isStringTag;return Fk(t,r,a),L7(function(){return E7(t,r,a)}),null},U7=F7(function(e,n,t){var r=e.css;typeof r=="string"&&n.registered[r]!==void 0&&(r=n.registered[r]);var a=e[I1],o=[r],l="";typeof e.className=="string"?l=T7(n.registered,o,e.className):e.className!=null&&(l=e.className+" ");var h=zk(o,void 0,w.useContext($7));l+=n.key+"-"+h.name;var d={};for(var u in e)qw.call(e,u)&&u!=="css"&&u!==I1&&(d[u]=e[u]);return d.className=l,t&&(d.ref=t),w.createElement(w.Fragment,null,w.createElement(B7,{cache:n,serialized:h,isStringTag:typeof a=="string"}),w.createElement(a,d))}),q7=U7,Bt=function(n,t){var r=arguments;if(t==null||!qw.call(t,"css"))return w.createElement.apply(void 0,r);var a=r.length,o=new Array(a);o[0]=q7,o[1]=z7(n,t);for(var l=2;l<a;l++)o[l]=r[l];return w.createElement.apply(null,o)};(function(e){var n;n||(n=e.JSX||(e.JSX={}))})(Bt||(Bt={}));function Vw(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return zk(n)}function V7(){var e=Vw.apply(void 0,arguments),n="animation-"+e.name;return{name:n,styles:"@keyframes "+n+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}}function H7(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}const G7=Math.min,Y7=Math.max,gb=Math.round,Dx=Math.floor,yb=e=>({x:e,y:e});function W7(e){const{x:n,y:t,width:r,height:a}=e;return{width:r,height:a,top:t,left:n,right:n+r,bottom:t+a,x:n,y:t}}function Wb(){return typeof window<"u"}function Uk(e){return Vk(e)?(e.nodeName||"").toLowerCase():"#document"}function wc(e){var n;return(e==null||(n=e.ownerDocument)==null?void 0:n.defaultView)||window}function qk(e){var n;return(n=(Vk(e)?e.ownerDocument:e.document)||window.document)==null?void 0:n.documentElement}function Vk(e){return Wb()?e instanceof Node||e instanceof wc(e).Node:!1}function Q7(e){return Wb()?e instanceof Element||e instanceof wc(e).Element:!1}function Hw(e){return Wb()?e instanceof HTMLElement||e instanceof wc(e).HTMLElement:!1}function qj(e){return!Wb()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof wc(e).ShadowRoot}const J7=new Set(["inline","contents"]);function Hk(e){const{overflow:n,overflowX:t,overflowY:r,display:a}=Gw(e);return/auto|scroll|overlay|hidden|clip/.test(n+r+t)&&!J7.has(a)}function K7(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const X7=new Set(["html","body","#document"]);function Z7(e){return X7.has(Uk(e))}function Gw(e){return wc(e).getComputedStyle(e)}function eq(e){if(Uk(e)==="html")return e;const n=e.assignedSlot||e.parentNode||qj(e)&&e.host||qk(e);return qj(n)?n.host:n}function Gk(e){const n=eq(e);return Z7(n)?e.ownerDocument?e.ownerDocument.body:e.body:Hw(n)&&Hk(n)?n:Gk(n)}function xb(e,n,t){var r;n===void 0&&(n=[]),t===void 0&&(t=!0);const a=Gk(e),o=a===((r=e.ownerDocument)==null?void 0:r.body),l=wc(a);if(o){const h=M1(l);return n.concat(l,l.visualViewport||[],Hk(a)?a:[],h&&t?xb(h):[])}return n.concat(a,xb(a,[],t))}function M1(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function tq(e){const n=Gw(e);let t=parseFloat(n.width)||0,r=parseFloat(n.height)||0;const a=Hw(e),o=a?e.offsetWidth:t,l=a?e.offsetHeight:r,h=gb(t)!==o||gb(r)!==l;return h&&(t=o,r=l),{width:t,height:r,$:h}}function Yw(e){return Q7(e)?e:e.contextElement}function Vj(e){const n=Yw(e);if(!Hw(n))return yb(1);const t=n.getBoundingClientRect(),{width:r,height:a,$:o}=tq(n);let l=(o?gb(t.width):t.width)/r,h=(o?gb(t.height):t.height)/a;return(!l||!Number.isFinite(l))&&(l=1),(!h||!Number.isFinite(h))&&(h=1),{x:l,y:h}}const nq=yb(0);function iq(e){const n=wc(e);return!K7()||!n.visualViewport?nq:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function rq(e,n,t){return!1}function Hj(e,n,t,r){n===void 0&&(n=!1);const a=e.getBoundingClientRect(),o=Yw(e);let l=yb(1);n&&(l=Vj(e));const h=rq()?iq(o):yb(0);let d=(a.left+h.x)/l.x,u=(a.top+h.y)/l.y,f=a.width/l.x,g=a.height/l.y;if(o){const b=wc(o),v=r;let S=b,T=M1(S);for(;T&&r&&v!==S;){const E=Vj(T),C=T.getBoundingClientRect(),P=Gw(T),I=C.left+(T.clientLeft+parseFloat(P.paddingLeft))*E.x,q=C.top+(T.clientTop+parseFloat(P.paddingTop))*E.y;d*=E.x,u*=E.y,f*=E.x,g*=E.y,d+=I,u+=q,S=wc(T),T=M1(S)}}return W7({width:f,height:g,x:d,y:u})}function Yk(e,n){return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height}function aq(e,n){let t=null,r;const a=qk(e);function o(){var h;clearTimeout(r),(h=t)==null||h.disconnect(),t=null}function l(h,d){h===void 0&&(h=!1),d===void 0&&(d=1),o();const u=e.getBoundingClientRect(),{left:f,top:g,width:b,height:v}=u;if(h||n(),!b||!v)return;const S=Dx(g),T=Dx(a.clientWidth-(f+b)),E=Dx(a.clientHeight-(g+v)),C=Dx(f),I={rootMargin:-S+"px "+-T+"px "+-E+"px "+-C+"px",threshold:Y7(0,G7(1,d))||1};let q=!0;function L(O){const B=O[0].intersectionRatio;if(B!==d){if(!q)return l();B?l(!1,B):r=setTimeout(()=>{l(!1,1e-7)},1e3)}B===1&&!Yk(u,e.getBoundingClientRect())&&l(),q=!1}try{t=new IntersectionObserver(L,{...I,root:a.ownerDocument})}catch{t=new IntersectionObserver(L,I)}t.observe(e)}return l(!0),o}function sq(e,n,t,r){r===void 0&&(r={});const{ancestorScroll:a=!0,ancestorResize:o=!0,elementResize:l=typeof ResizeObserver=="function",layoutShift:h=typeof IntersectionObserver=="function",animationFrame:d=!1}=r,u=Yw(e),f=a||o?[...u?xb(u):[],...xb(n)]:[];f.forEach(C=>{a&&C.addEventListener("scroll",t,{passive:!0}),o&&C.addEventListener("resize",t)});const g=u&&h?aq(u,t):null;let b=-1,v=null;l&&(v=new ResizeObserver(C=>{let[P]=C;P&&P.target===u&&v&&(v.unobserve(n),cancelAnimationFrame(b),b=requestAnimationFrame(()=>{var I;(I=v)==null||I.observe(n)})),t()}),u&&!d&&v.observe(u),v.observe(n));let S,T=d?Hj(e):null;d&&E();function E(){const C=Hj(e);T&&!Yk(T,C)&&t(),T=C,S=requestAnimationFrame(E)}return t(),()=>{var C;f.forEach(P=>{a&&P.removeEventListener("scroll",t),o&&P.removeEventListener("resize",t)}),g==null||g(),(C=v)==null||C.disconnect(),v=null,d&&cancelAnimationFrame(S)}}var R1=w.useLayoutEffect,oq=["className","clearValue","cx","getStyles","getClassNames","getValue","hasValue","isMulti","isRtl","options","selectOption","selectProps","setValue","theme"],bb=function(){};function lq(e,n){return n?n[0]==="-"?e+n:e+"__"+n:e}function cq(e,n){for(var t=arguments.length,r=new Array(t>2?t-2:0),a=2;a<t;a++)r[a-2]=arguments[a];var o=[].concat(r);if(n&&e)for(var l in n)n.hasOwnProperty(l)&&n[l]&&o.push("".concat(lq(e,l)));return o.filter(function(h){return h}).map(function(h){return String(h).trim()}).join(" ")}var Gj=function(n){return xq(n)?n.filter(Boolean):ih(n)==="object"&&n!==null?[n]:[]},Wk=function(n){n.className,n.clearValue,n.cx,n.getStyles,n.getClassNames,n.getValue,n.hasValue,n.isMulti,n.isRtl,n.options,n.selectOption,n.selectProps,n.setValue,n.theme;var t=jc(n,oq);return Gt({},t)},zi=function(n,t,r){var a=n.cx,o=n.getStyles,l=n.getClassNames,h=n.className;return{css:o(t,n),className:a(r??{},l(t,n),h)}};function Qb(e){return[document.documentElement,document.body,window].indexOf(e)>-1}function uq(e){return Qb(e)?window.innerHeight:e.clientHeight}function Qk(e){return Qb(e)?window.pageYOffset:e.scrollTop}function vb(e,n){if(Qb(e)){window.scrollTo(0,n);return}e.scrollTop=n}function dq(e){var n=getComputedStyle(e),t=n.position==="absolute",r=/(auto|scroll)/;if(n.position==="fixed")return document.documentElement;for(var a=e;a=a.parentElement;)if(n=getComputedStyle(a),!(t&&n.position==="static")&&r.test(n.overflow+n.overflowY+n.overflowX))return a;return document.documentElement}function hq(e,n,t,r){return t*((e=e/r-1)*e*e+1)+n}function Px(e,n){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:200,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:bb,a=Qk(e),o=n-a,l=10,h=0;function d(){h+=l;var u=hq(h,a,o,t);vb(e,u),h<t?window.requestAnimationFrame(d):r(e)}d()}function Yj(e,n){var t=e.getBoundingClientRect(),r=n.getBoundingClientRect(),a=n.offsetHeight/3;r.bottom+a>t.bottom?vb(e,Math.min(n.offsetTop+n.clientHeight-e.offsetHeight+a,e.scrollHeight)):r.top-a<t.top&&vb(e,Math.max(n.offsetTop-a,0))}function fq(e){var n=e.getBoundingClientRect();return{bottom:n.bottom,height:n.height,left:n.left,right:n.right,top:n.top,width:n.width}}function Wj(){try{return document.createEvent("TouchEvent"),!0}catch{return!1}}function pq(){try{return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}catch{return!1}}var Jk=!1,mq={get passive(){return Jk=!0}},Ix=typeof window<"u"?window:{};Ix.addEventListener&&Ix.removeEventListener&&(Ix.addEventListener("p",bb,mq),Ix.removeEventListener("p",bb,!1));var gq=Jk;function yq(e){return e!=null}function xq(e){return Array.isArray(e)}function Mx(e,n,t){return e?n:t}var bq=function(n){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];var o=Object.entries(n).filter(function(l){var h=xc(l,1),d=h[0];return!r.includes(d)});return o.reduce(function(l,h){var d=xc(h,2),u=d[0],f=d[1];return l[u]=f,l},{})},vq=["children","innerProps"],wq=["children","innerProps"];function Nq(e){var n=e.maxHeight,t=e.menuEl,r=e.minHeight,a=e.placement,o=e.shouldScroll,l=e.isFixedPosition,h=e.controlHeight,d=dq(t),u={placement:"bottom",maxHeight:n};if(!t||!t.offsetParent)return u;var f=d.getBoundingClientRect(),g=f.height,b=t.getBoundingClientRect(),v=b.bottom,S=b.height,T=b.top,E=t.offsetParent.getBoundingClientRect(),C=E.top,P=l?window.innerHeight:uq(d),I=Qk(d),q=parseInt(getComputedStyle(t).marginBottom,10),L=parseInt(getComputedStyle(t).marginTop,10),O=C-L,B=P-T,$=O+I,F=g-I-T,z=v-P+I+q,U=I+T-L,V=160;switch(a){case"auto":case"bottom":if(B>=S)return{placement:"bottom",maxHeight:n};if(F>=S&&!l)return o&&Px(d,z,V),{placement:"bottom",maxHeight:n};if(!l&&F>=r||l&&B>=r){o&&Px(d,z,V);var ee=l?B-q:F-q;return{placement:"bottom",maxHeight:ee}}if(a==="auto"||l){var ie=n,ae=l?O:$;return ae>=r&&(ie=Math.min(ae-q-h,n)),{placement:"top",maxHeight:ie}}if(a==="bottom")return o&&vb(d,z),{placement:"bottom",maxHeight:n};break;case"top":if(O>=S)return{placement:"top",maxHeight:n};if($>=S&&!l)return o&&Px(d,U,V),{placement:"top",maxHeight:n};if(!l&&$>=r||l&&O>=r){var J=n;return(!l&&$>=r||l&&O>=r)&&(J=l?O-L:$-L),o&&Px(d,U,V),{placement:"top",maxHeight:J}}return{placement:"bottom",maxHeight:n};default:throw new Error('Invalid placement provided "'.concat(a,'".'))}return u}function Sq(e){var n={bottom:"top",top:"bottom"};return e?n[e]:"bottom"}var Kk=function(n){return n==="auto"?"bottom":n},jq=function(n,t){var r,a=n.placement,o=n.theme,l=o.borderRadius,h=o.spacing,d=o.colors;return Gt((r={label:"menu"},Qm(r,Sq(a),"100%"),Qm(r,"position","absolute"),Qm(r,"width","100%"),Qm(r,"zIndex",1),r),t?{}:{backgroundColor:d.neutral0,borderRadius:l,boxShadow:"0 0 0 1px hsla(0, 0%, 0%, 0.1), 0 4px 11px hsla(0, 0%, 0%, 0.1)",marginBottom:h.menuGutter,marginTop:h.menuGutter})},Xk=w.createContext(null),_q=function(n){var t=n.children,r=n.minMenuHeight,a=n.maxMenuHeight,o=n.menuPlacement,l=n.menuPosition,h=n.menuShouldScrollIntoView,d=n.theme,u=w.useContext(Xk)||{},f=u.setPortalPlacement,g=w.useRef(null),b=w.useState(a),v=xc(b,2),S=v[0],T=v[1],E=w.useState(null),C=xc(E,2),P=C[0],I=C[1],q=d.spacing.controlHeight;return R1(function(){var L=g.current;if(L){var O=l==="fixed",B=h&&!O,$=Nq({maxHeight:a,menuEl:L,minHeight:r,placement:o,shouldScroll:B,isFixedPosition:O,controlHeight:q});T($.maxHeight),I($.placement),f==null||f($.placement)}},[a,o,l,h,r,f,q]),t({ref:g,placerProps:Gt(Gt({},n),{},{placement:P||Kk(o),maxHeight:S})})},Cq=function(n){var t=n.children,r=n.innerRef,a=n.innerProps;return Bt("div",Qt({},zi(n,"menu",{menu:!0}),{ref:r},a),t)},kq=Cq,Tq=function(n,t){var r=n.maxHeight,a=n.theme.spacing.baseUnit;return Gt({maxHeight:r,overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},t?{}:{paddingBottom:a,paddingTop:a})},Eq=function(n){var t=n.children,r=n.innerProps,a=n.innerRef,o=n.isMulti;return Bt("div",Qt({},zi(n,"menuList",{"menu-list":!0,"menu-list--is-multi":o}),{ref:a},r),t)},Zk=function(n,t){var r=n.theme,a=r.spacing.baseUnit,o=r.colors;return Gt({textAlign:"center"},t?{}:{color:o.neutral40,padding:"".concat(a*2,"px ").concat(a*3,"px")})},Aq=Zk,Dq=Zk,Pq=function(n){var t=n.children,r=t===void 0?"No options":t,a=n.innerProps,o=jc(n,vq);return Bt("div",Qt({},zi(Gt(Gt({},o),{},{children:r,innerProps:a}),"noOptionsMessage",{"menu-notice":!0,"menu-notice--no-options":!0}),a),r)},Iq=function(n){var t=n.children,r=t===void 0?"Loading...":t,a=n.innerProps,o=jc(n,wq);return Bt("div",Qt({},zi(Gt(Gt({},o),{},{children:r,innerProps:a}),"loadingMessage",{"menu-notice":!0,"menu-notice--loading":!0}),a),r)},Mq=function(n){var t=n.rect,r=n.offset,a=n.position;return{left:t.left,position:a,top:r,width:t.width,zIndex:1}},Rq=function(n){var t=n.appendTo,r=n.children,a=n.controlElement,o=n.innerProps,l=n.menuPlacement,h=n.menuPosition,d=w.useRef(null),u=w.useRef(null),f=w.useState(Kk(l)),g=xc(f,2),b=g[0],v=g[1],S=w.useMemo(function(){return{setPortalPlacement:v}},[]),T=w.useState(null),E=xc(T,2),C=E[0],P=E[1],I=w.useCallback(function(){if(a){var B=fq(a),$=h==="fixed"?0:window.pageYOffset,F=B[b]+$;(F!==(C==null?void 0:C.offset)||B.left!==(C==null?void 0:C.rect.left)||B.width!==(C==null?void 0:C.rect.width))&&P({offset:F,rect:B})}},[a,h,b,C==null?void 0:C.offset,C==null?void 0:C.rect.left,C==null?void 0:C.rect.width]);R1(function(){I()},[I]);var q=w.useCallback(function(){typeof u.current=="function"&&(u.current(),u.current=null),a&&d.current&&(u.current=sq(a,d.current,I,{elementResize:"ResizeObserver"in window}))},[a,I]);R1(function(){q()},[q]);var L=w.useCallback(function(B){d.current=B,q()},[q]);if(!t&&h!=="fixed"||!C)return null;var O=Bt("div",Qt({ref:L},zi(Gt(Gt({},n),{},{offset:C.offset,position:h,rect:C.rect}),"menuPortal",{"menu-portal":!0}),o),r);return Bt(Xk.Provider,{value:S},t?yP.createPortal(O,t):O)},Oq=function(n){var t=n.isDisabled,r=n.isRtl;return{label:"container",direction:r?"rtl":void 0,pointerEvents:t?"none":void 0,position:"relative"}},Lq=function(n){var t=n.children,r=n.innerProps,a=n.isDisabled,o=n.isRtl;return Bt("div",Qt({},zi(n,"container",{"--is-disabled":a,"--is-rtl":o}),r),t)},Fq=function(n,t){var r=n.theme.spacing,a=n.isMulti,o=n.hasValue,l=n.selectProps.controlShouldRenderValue;return Gt({alignItems:"center",display:a&&o&&l?"flex":"grid",flex:1,flexWrap:"wrap",WebkitOverflowScrolling:"touch",position:"relative",overflow:"hidden"},t?{}:{padding:"".concat(r.baseUnit/2,"px ").concat(r.baseUnit*2,"px")})},$q=function(n){var t=n.children,r=n.innerProps,a=n.isMulti,o=n.hasValue;return Bt("div",Qt({},zi(n,"valueContainer",{"value-container":!0,"value-container--is-multi":a,"value-container--has-value":o}),r),t)},zq=function(){return{alignItems:"center",alignSelf:"stretch",display:"flex",flexShrink:0}},Bq=function(n){var t=n.children,r=n.innerProps;return Bt("div",Qt({},zi(n,"indicatorsContainer",{indicators:!0}),r),t)},Qj,Uq=["size"],qq=["innerProps","isRtl","size"],Vq={name:"8mmkcg",styles:"display:inline-block;fill:currentColor;line-height:1;stroke:currentColor;stroke-width:0"},eT=function(n){var t=n.size,r=jc(n,Uq);return Bt("svg",Qt({height:t,width:t,viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",css:Vq},r))},Ww=function(n){return Bt(eT,Qt({size:20},n),Bt("path",{d:"M14.348 14.849c-0.469 0.469-1.229 0.469-1.697 0l-2.651-3.030-2.651 3.029c-0.469 0.469-1.229 0.469-1.697 0-0.469-0.469-0.469-1.229 0-1.697l2.758-3.15-2.759-3.152c-0.469-0.469-0.469-1.228 0-1.697s1.228-0.469 1.697 0l2.652 3.031 2.651-3.031c0.469-0.469 1.228-0.469 1.697 0s0.469 1.229 0 1.697l-2.758 3.152 2.758 3.15c0.469 0.469 0.469 1.229 0 1.698z"}))},tT=function(n){return Bt(eT,Qt({size:20},n),Bt("path",{d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"}))},nT=function(n,t){var r=n.isFocused,a=n.theme,o=a.spacing.baseUnit,l=a.colors;return Gt({label:"indicatorContainer",display:"flex",transition:"color 150ms"},t?{}:{color:r?l.neutral60:l.neutral20,padding:o*2,":hover":{color:r?l.neutral80:l.neutral40}})},Hq=nT,Gq=function(n){var t=n.children,r=n.innerProps;return Bt("div",Qt({},zi(n,"dropdownIndicator",{indicator:!0,"dropdown-indicator":!0}),r),t||Bt(tT,null))},Yq=nT,Wq=function(n){var t=n.children,r=n.innerProps;return Bt("div",Qt({},zi(n,"clearIndicator",{indicator:!0,"clear-indicator":!0}),r),t||Bt(Ww,null))},Qq=function(n,t){var r=n.isDisabled,a=n.theme,o=a.spacing.baseUnit,l=a.colors;return Gt({label:"indicatorSeparator",alignSelf:"stretch",width:1},t?{}:{backgroundColor:r?l.neutral10:l.neutral20,marginBottom:o*2,marginTop:o*2})},Jq=function(n){var t=n.innerProps;return Bt("span",Qt({},t,zi(n,"indicatorSeparator",{"indicator-separator":!0})))},Kq=V7(Qj||(Qj=H7([`
  0%, 80%, 100% { opacity: 0; }
  40% { opacity: 1; }
`]))),Xq=function(n,t){var r=n.isFocused,a=n.size,o=n.theme,l=o.colors,h=o.spacing.baseUnit;return Gt({label:"loadingIndicator",display:"flex",transition:"color 150ms",alignSelf:"center",fontSize:a,lineHeight:1,marginRight:a,textAlign:"center",verticalAlign:"middle"},t?{}:{color:r?l.neutral60:l.neutral20,padding:h*2})},C0=function(n){var t=n.delay,r=n.offset;return Bt("span",{css:Vw({animation:"".concat(Kq," 1s ease-in-out ").concat(t,"ms infinite;"),backgroundColor:"currentColor",borderRadius:"1em",display:"inline-block",marginLeft:r?"1em":void 0,height:"1em",verticalAlign:"top",width:"1em"},"","")})},Zq=function(n){var t=n.innerProps,r=n.isRtl,a=n.size,o=a===void 0?4:a,l=jc(n,qq);return Bt("div",Qt({},zi(Gt(Gt({},l),{},{innerProps:t,isRtl:r,size:o}),"loadingIndicator",{indicator:!0,"loading-indicator":!0}),t),Bt(C0,{delay:0,offset:r}),Bt(C0,{delay:160,offset:!0}),Bt(C0,{delay:320,offset:!r}))},eV=function(n,t){var r=n.isDisabled,a=n.isFocused,o=n.theme,l=o.colors,h=o.borderRadius,d=o.spacing;return Gt({label:"control",alignItems:"center",cursor:"default",display:"flex",flexWrap:"wrap",justifyContent:"space-between",minHeight:d.controlHeight,outline:"0 !important",position:"relative",transition:"all 100ms"},t?{}:{backgroundColor:r?l.neutral5:l.neutral0,borderColor:r?l.neutral10:a?l.primary:l.neutral20,borderRadius:h,borderStyle:"solid",borderWidth:1,boxShadow:a?"0 0 0 1px ".concat(l.primary):void 0,"&:hover":{borderColor:a?l.primary:l.neutral30}})},tV=function(n){var t=n.children,r=n.isDisabled,a=n.isFocused,o=n.innerRef,l=n.innerProps,h=n.menuIsOpen;return Bt("div",Qt({ref:o},zi(n,"control",{control:!0,"control--is-disabled":r,"control--is-focused":a,"control--menu-is-open":h}),l,{"aria-disabled":r||void 0}),t)},nV=tV,iV=["data"],rV=function(n,t){var r=n.theme.spacing;return t?{}:{paddingBottom:r.baseUnit*2,paddingTop:r.baseUnit*2}},aV=function(n){var t=n.children,r=n.cx,a=n.getStyles,o=n.getClassNames,l=n.Heading,h=n.headingProps,d=n.innerProps,u=n.label,f=n.theme,g=n.selectProps;return Bt("div",Qt({},zi(n,"group",{group:!0}),d),Bt(l,Qt({},h,{selectProps:g,theme:f,getStyles:a,getClassNames:o,cx:r}),u),Bt("div",null,t))},sV=function(n,t){var r=n.theme,a=r.colors,o=r.spacing;return Gt({label:"group",cursor:"default",display:"block"},t?{}:{color:a.neutral40,fontSize:"75%",fontWeight:500,marginBottom:"0.25em",paddingLeft:o.baseUnit*3,paddingRight:o.baseUnit*3,textTransform:"uppercase"})},oV=function(n){var t=Wk(n);t.data;var r=jc(t,iV);return Bt("div",Qt({},zi(n,"groupHeading",{"group-heading":!0}),r))},lV=aV,cV=["innerRef","isDisabled","isHidden","inputClassName"],uV=function(n,t){var r=n.isDisabled,a=n.value,o=n.theme,l=o.spacing,h=o.colors;return Gt(Gt({visibility:r?"hidden":"visible",transform:a?"translateZ(0)":""},dV),t?{}:{margin:l.baseUnit/2,paddingBottom:l.baseUnit/2,paddingTop:l.baseUnit/2,color:h.neutral80})},iT={gridArea:"1 / 2",font:"inherit",minWidth:"2px",border:0,margin:0,outline:0,padding:0},dV={flex:"1 1 auto",display:"inline-grid",gridArea:"1 / 1 / 2 / 3",gridTemplateColumns:"0 min-content","&:after":Gt({content:'attr(data-value) " "',visibility:"hidden",whiteSpace:"pre"},iT)},hV=function(n){return Gt({label:"input",color:"inherit",background:0,opacity:n?0:1,width:"100%"},iT)},fV=function(n){var t=n.cx,r=n.value,a=Wk(n),o=a.innerRef,l=a.isDisabled,h=a.isHidden,d=a.inputClassName,u=jc(a,cV);return Bt("div",Qt({},zi(n,"input",{"input-container":!0}),{"data-value":r||""}),Bt("input",Qt({className:t({input:!0},d),ref:o,style:hV(h),disabled:l},u)))},pV=fV,mV=function(n,t){var r=n.theme,a=r.spacing,o=r.borderRadius,l=r.colors;return Gt({label:"multiValue",display:"flex",minWidth:0},t?{}:{backgroundColor:l.neutral10,borderRadius:o/2,margin:a.baseUnit/2})},gV=function(n,t){var r=n.theme,a=r.borderRadius,o=r.colors,l=n.cropWithEllipsis;return Gt({overflow:"hidden",textOverflow:l||l===void 0?"ellipsis":void 0,whiteSpace:"nowrap"},t?{}:{borderRadius:a/2,color:o.neutral80,fontSize:"85%",padding:3,paddingLeft:6})},yV=function(n,t){var r=n.theme,a=r.spacing,o=r.borderRadius,l=r.colors,h=n.isFocused;return Gt({alignItems:"center",display:"flex"},t?{}:{borderRadius:o/2,backgroundColor:h?l.dangerLight:void 0,paddingLeft:a.baseUnit,paddingRight:a.baseUnit,":hover":{backgroundColor:l.dangerLight,color:l.danger}})},rT=function(n){var t=n.children,r=n.innerProps;return Bt("div",r,t)},xV=rT,bV=rT;function vV(e){var n=e.children,t=e.innerProps;return Bt("div",Qt({role:"button"},t),n||Bt(Ww,{size:14}))}var wV=function(n){var t=n.children,r=n.components,a=n.data,o=n.innerProps,l=n.isDisabled,h=n.removeProps,d=n.selectProps,u=r.Container,f=r.Label,g=r.Remove;return Bt(u,{data:a,innerProps:Gt(Gt({},zi(n,"multiValue",{"multi-value":!0,"multi-value--is-disabled":l})),o),selectProps:d},Bt(f,{data:a,innerProps:Gt({},zi(n,"multiValueLabel",{"multi-value__label":!0})),selectProps:d},t),Bt(g,{data:a,innerProps:Gt(Gt({},zi(n,"multiValueRemove",{"multi-value__remove":!0})),{},{"aria-label":"Remove ".concat(t||"option")},h),selectProps:d}))},NV=wV,SV=function(n,t){var r=n.isDisabled,a=n.isFocused,o=n.isSelected,l=n.theme,h=l.spacing,d=l.colors;return Gt({label:"option",cursor:"default",display:"block",fontSize:"inherit",width:"100%",userSelect:"none",WebkitTapHighlightColor:"rgba(0, 0, 0, 0)"},t?{}:{backgroundColor:o?d.primary:a?d.primary25:"transparent",color:r?d.neutral20:o?d.neutral0:"inherit",padding:"".concat(h.baseUnit*2,"px ").concat(h.baseUnit*3,"px"),":active":{backgroundColor:r?void 0:o?d.primary:d.primary50}})},jV=function(n){var t=n.children,r=n.isDisabled,a=n.isFocused,o=n.isSelected,l=n.innerRef,h=n.innerProps;return Bt("div",Qt({},zi(n,"option",{option:!0,"option--is-disabled":r,"option--is-focused":a,"option--is-selected":o}),{ref:l,"aria-disabled":r},h),t)},_V=jV,CV=function(n,t){var r=n.theme,a=r.spacing,o=r.colors;return Gt({label:"placeholder",gridArea:"1 / 1 / 2 / 3"},t?{}:{color:o.neutral50,marginLeft:a.baseUnit/2,marginRight:a.baseUnit/2})},kV=function(n){var t=n.children,r=n.innerProps;return Bt("div",Qt({},zi(n,"placeholder",{placeholder:!0}),r),t)},TV=kV,EV=function(n,t){var r=n.isDisabled,a=n.theme,o=a.spacing,l=a.colors;return Gt({label:"singleValue",gridArea:"1 / 1 / 2 / 3",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},t?{}:{color:r?l.neutral40:l.neutral80,marginLeft:o.baseUnit/2,marginRight:o.baseUnit/2})},AV=function(n){var t=n.children,r=n.isDisabled,a=n.innerProps;return Bt("div",Qt({},zi(n,"singleValue",{"single-value":!0,"single-value--is-disabled":r}),a),t)},DV=AV,PV={ClearIndicator:Wq,Control:nV,DropdownIndicator:Gq,DownChevron:tT,CrossIcon:Ww,Group:lV,GroupHeading:oV,IndicatorsContainer:Bq,IndicatorSeparator:Jq,Input:pV,LoadingIndicator:Zq,Menu:kq,MenuList:Eq,MenuPortal:Rq,LoadingMessage:Iq,NoOptionsMessage:Pq,MultiValue:NV,MultiValueContainer:xV,MultiValueLabel:bV,MultiValueRemove:vV,Option:_V,Placeholder:TV,SelectContainer:Lq,SingleValue:DV,ValueContainer:$q},IV=function(n){return Gt(Gt({},PV),n.components)},Jj=Number.isNaN||function(n){return typeof n=="number"&&n!==n};function MV(e,n){return!!(e===n||Jj(e)&&Jj(n))}function RV(e,n){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(!MV(e[t],n[t]))return!1;return!0}function OV(e,n){n===void 0&&(n=RV);var t=null;function r(){for(var a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];if(t&&t.lastThis===this&&n(a,t.lastArgs))return t.lastResult;var l=e.apply(this,a);return t={lastResult:l,lastArgs:a,lastThis:this},l}return r.clear=function(){t=null},r}var LV={name:"7pg0cj-a11yText",styles:"label:a11yText;z-index:9999;border:0;clip:rect(1px, 1px, 1px, 1px);height:1px;width:1px;position:absolute;overflow:hidden;padding:0;white-space:nowrap"},FV=function(n){return Bt("span",Qt({css:LV},n))},Kj=FV,$V={guidance:function(n){var t=n.isSearchable,r=n.isMulti,a=n.tabSelectsValue,o=n.context,l=n.isInitialFocus;switch(o){case"menu":return"Use Up and Down to choose options, press Enter to select the currently focused option, press Escape to exit the menu".concat(a?", press Tab to select the option and exit the menu":"",".");case"input":return l?"".concat(n["aria-label"]||"Select"," is focused ").concat(t?",type to refine list":"",", press Down to open the menu, ").concat(r?" press left to focus selected values":""):"";case"value":return"Use left and right to toggle between focused values, press Backspace to remove the currently focused value";default:return""}},onChange:function(n){var t=n.action,r=n.label,a=r===void 0?"":r,o=n.labels,l=n.isDisabled;switch(t){case"deselect-option":case"pop-value":case"remove-value":return"option ".concat(a,", deselected.");case"clear":return"All selected options have been cleared.";case"initial-input-focus":return"option".concat(o.length>1?"s":""," ").concat(o.join(","),", selected.");case"select-option":return l?"option ".concat(a," is disabled. Select another option."):"option ".concat(a,", selected.");default:return""}},onFocus:function(n){var t=n.context,r=n.focused,a=n.options,o=n.label,l=o===void 0?"":o,h=n.selectValue,d=n.isDisabled,u=n.isSelected,f=n.isAppleDevice,g=function(T,E){return T&&T.length?"".concat(T.indexOf(E)+1," of ").concat(T.length):""};if(t==="value"&&h)return"value ".concat(l," focused, ").concat(g(h,r),".");if(t==="menu"&&f){var b=d?" disabled":"",v="".concat(u?" selected":"").concat(b);return"".concat(l).concat(v,", ").concat(g(a,r),".")}return""},onFilter:function(n){var t=n.inputValue,r=n.resultsMessage;return"".concat(r).concat(t?" for search term "+t:"",".")}},zV=function(n){var t=n.ariaSelection,r=n.focusedOption,a=n.focusedValue,o=n.focusableOptions,l=n.isFocused,h=n.selectValue,d=n.selectProps,u=n.id,f=n.isAppleDevice,g=d.ariaLiveMessages,b=d.getOptionLabel,v=d.inputValue,S=d.isMulti,T=d.isOptionDisabled,E=d.isSearchable,C=d.menuIsOpen,P=d.options,I=d.screenReaderStatus,q=d.tabSelectsValue,L=d.isLoading,O=d["aria-label"],B=d["aria-live"],$=w.useMemo(function(){return Gt(Gt({},$V),g||{})},[g]),F=w.useMemo(function(){var ae="";if(t&&$.onChange){var J=t.option,K=t.options,W=t.removedValue,re=t.removedValues,A=t.value,te=function(me){return Array.isArray(me)?null:me},xe=W||J||te(A),M=xe?b(xe):"",Se=K||re||void 0,$e=Se?Se.map(b):[],he=Gt({isDisabled:xe&&T(xe,h),label:M,labels:$e},t);ae=$.onChange(he)}return ae},[t,$,T,h,b]),z=w.useMemo(function(){var ae="",J=r||a,K=!!(r&&h&&h.includes(r));if(J&&$.onFocus){var W={focused:J,label:b(J),isDisabled:T(J,h),isSelected:K,options:o,context:J===r?"menu":"value",selectValue:h,isAppleDevice:f};ae=$.onFocus(W)}return ae},[r,a,b,T,$,o,h,f]),U=w.useMemo(function(){var ae="";if(C&&P.length&&!L&&$.onFilter){var J=I({count:o.length});ae=$.onFilter({inputValue:v,resultsMessage:J})}return ae},[o,v,C,$,P,I,L]),V=(t==null?void 0:t.action)==="initial-input-focus",ee=w.useMemo(function(){var ae="";if($.guidance){var J=a?"value":C?"menu":"input";ae=$.guidance({"aria-label":O,context:J,isDisabled:r&&T(r,h),isMulti:S,isSearchable:E,tabSelectsValue:q,isInitialFocus:V})}return ae},[O,r,a,S,T,E,C,$,h,q,V]),ie=Bt(w.Fragment,null,Bt("span",{id:"aria-selection"},F),Bt("span",{id:"aria-focused"},z),Bt("span",{id:"aria-results"},U),Bt("span",{id:"aria-guidance"},ee));return Bt(w.Fragment,null,Bt(Kj,{id:u},V&&ie),Bt(Kj,{"aria-live":B,"aria-atomic":"false","aria-relevant":"additions text",role:"log"},l&&!V&&ie))},BV=zV,O1=[{base:"A",letters:"A"},{base:"AA",letters:""},{base:"AE",letters:""},{base:"AO",letters:""},{base:"AU",letters:""},{base:"AV",letters:""},{base:"AY",letters:""},{base:"B",letters:"B"},{base:"C",letters:"C"},{base:"D",letters:"D"},{base:"DZ",letters:""},{base:"Dz",letters:""},{base:"E",letters:"E"},{base:"F",letters:"F"},{base:"G",letters:"G"},{base:"H",letters:"H"},{base:"I",letters:"I"},{base:"J",letters:"J"},{base:"K",letters:"K"},{base:"L",letters:"L"},{base:"LJ",letters:""},{base:"Lj",letters:""},{base:"M",letters:"M"},{base:"N",letters:"N"},{base:"NJ",letters:""},{base:"Nj",letters:""},{base:"O",letters:"O"},{base:"OI",letters:""},{base:"OO",letters:""},{base:"OU",letters:""},{base:"P",letters:"P"},{base:"Q",letters:"Q"},{base:"R",letters:"R"},{base:"S",letters:"S"},{base:"T",letters:"T"},{base:"TZ",letters:""},{base:"U",letters:"U"},{base:"V",letters:"V"},{base:"VY",letters:""},{base:"W",letters:"W"},{base:"X",letters:"X"},{base:"Y",letters:"Y"},{base:"Z",letters:"Z"},{base:"a",letters:"a"},{base:"aa",letters:""},{base:"ae",letters:""},{base:"ao",letters:""},{base:"au",letters:""},{base:"av",letters:""},{base:"ay",letters:""},{base:"b",letters:"b"},{base:"c",letters:"c"},{base:"d",letters:"d"},{base:"dz",letters:""},{base:"e",letters:"e"},{base:"f",letters:"f"},{base:"g",letters:"g"},{base:"h",letters:"h"},{base:"hv",letters:""},{base:"i",letters:"i"},{base:"j",letters:"j"},{base:"k",letters:"k"},{base:"l",letters:"l"},{base:"lj",letters:""},{base:"m",letters:"m"},{base:"n",letters:"n"},{base:"nj",letters:""},{base:"o",letters:"o"},{base:"oi",letters:""},{base:"ou",letters:""},{base:"oo",letters:""},{base:"p",letters:"p"},{base:"q",letters:"q"},{base:"r",letters:"r"},{base:"s",letters:"s"},{base:"t",letters:"t"},{base:"tz",letters:""},{base:"u",letters:"u"},{base:"v",letters:"v"},{base:"vy",letters:""},{base:"w",letters:"w"},{base:"x",letters:"x"},{base:"y",letters:"y"},{base:"z",letters:"z"}],UV=new RegExp("["+O1.map(function(e){return e.letters}).join("")+"]","g"),aT={};for(var k0=0;k0<O1.length;k0++)for(var T0=O1[k0],E0=0;E0<T0.letters.length;E0++)aT[T0.letters[E0]]=T0.base;var sT=function(n){return n.replace(UV,function(t){return aT[t]})},qV=OV(sT),Xj=function(n){return n.replace(/^\s+|\s+$/g,"")},VV=function(n){return"".concat(n.label," ").concat(n.value)},HV=function(n){return function(t,r){if(t.data.__isNew__)return!0;var a=Gt({ignoreCase:!0,ignoreAccents:!0,stringify:VV,trim:!0,matchFrom:"any"},n),o=a.ignoreCase,l=a.ignoreAccents,h=a.stringify,d=a.trim,u=a.matchFrom,f=d?Xj(r):r,g=d?Xj(h(t)):h(t);return o&&(f=f.toLowerCase(),g=g.toLowerCase()),l&&(f=qV(f),g=sT(g)),u==="start"?g.substr(0,f.length)===f:g.indexOf(f)>-1}},GV=["innerRef"];function YV(e){var n=e.innerRef,t=jc(e,GV),r=bq(t,"onExited","in","enter","exit","appear");return Bt("input",Qt({ref:n},r,{css:Vw({label:"dummyInput",background:0,border:0,caretColor:"transparent",fontSize:"inherit",gridArea:"1 / 1 / 2 / 3",outline:0,padding:0,width:1,color:"transparent",left:-100,opacity:0,position:"relative",transform:"scale(.01)"},"","")}))}var WV=function(n){n.cancelable&&n.preventDefault(),n.stopPropagation()};function QV(e){var n=e.isEnabled,t=e.onBottomArrive,r=e.onBottomLeave,a=e.onTopArrive,o=e.onTopLeave,l=w.useRef(!1),h=w.useRef(!1),d=w.useRef(0),u=w.useRef(null),f=w.useCallback(function(E,C){if(u.current!==null){var P=u.current,I=P.scrollTop,q=P.scrollHeight,L=P.clientHeight,O=u.current,B=C>0,$=q-L-I,F=!1;$>C&&l.current&&(r&&r(E),l.current=!1),B&&h.current&&(o&&o(E),h.current=!1),B&&C>$?(t&&!l.current&&t(E),O.scrollTop=q,F=!0,l.current=!0):!B&&-C>I&&(a&&!h.current&&a(E),O.scrollTop=0,F=!0,h.current=!0),F&&WV(E)}},[t,r,a,o]),g=w.useCallback(function(E){f(E,E.deltaY)},[f]),b=w.useCallback(function(E){d.current=E.changedTouches[0].clientY},[]),v=w.useCallback(function(E){var C=d.current-E.changedTouches[0].clientY;f(E,C)},[f]),S=w.useCallback(function(E){if(E){var C=gq?{passive:!1}:!1;E.addEventListener("wheel",g,C),E.addEventListener("touchstart",b,C),E.addEventListener("touchmove",v,C)}},[v,b,g]),T=w.useCallback(function(E){E&&(E.removeEventListener("wheel",g,!1),E.removeEventListener("touchstart",b,!1),E.removeEventListener("touchmove",v,!1))},[v,b,g]);return w.useEffect(function(){if(n){var E=u.current;return S(E),function(){T(E)}}},[n,S,T]),function(E){u.current=E}}var Zj=["boxSizing","height","overflow","paddingRight","position"],e_={boxSizing:"border-box",overflow:"hidden",position:"relative",height:"100%"};function t_(e){e.cancelable&&e.preventDefault()}function n_(e){e.stopPropagation()}function i_(){var e=this.scrollTop,n=this.scrollHeight,t=e+this.offsetHeight;e===0?this.scrollTop=1:t===n&&(this.scrollTop=e-1)}function r_(){return"ontouchstart"in window||navigator.maxTouchPoints}var a_=!!(typeof window<"u"&&window.document&&window.document.createElement),qm=0,Pf={capture:!1,passive:!1};function JV(e){var n=e.isEnabled,t=e.accountForScrollbars,r=t===void 0?!0:t,a=w.useRef({}),o=w.useRef(null),l=w.useCallback(function(d){if(a_){var u=document.body,f=u&&u.style;if(r&&Zj.forEach(function(S){var T=f&&f[S];a.current[S]=T}),r&&qm<1){var g=parseInt(a.current.paddingRight,10)||0,b=document.body?document.body.clientWidth:0,v=window.innerWidth-b+g||0;Object.keys(e_).forEach(function(S){var T=e_[S];f&&(f[S]=T)}),f&&(f.paddingRight="".concat(v,"px"))}u&&r_()&&(u.addEventListener("touchmove",t_,Pf),d&&(d.addEventListener("touchstart",i_,Pf),d.addEventListener("touchmove",n_,Pf))),qm+=1}},[r]),h=w.useCallback(function(d){if(a_){var u=document.body,f=u&&u.style;qm=Math.max(qm-1,0),r&&qm<1&&Zj.forEach(function(g){var b=a.current[g];f&&(f[g]=b)}),u&&r_()&&(u.removeEventListener("touchmove",t_,Pf),d&&(d.removeEventListener("touchstart",i_,Pf),d.removeEventListener("touchmove",n_,Pf)))}},[r]);return w.useEffect(function(){if(n){var d=o.current;return l(d),function(){h(d)}}},[n,l,h]),function(d){o.current=d}}var KV=function(n){var t=n.target;return t.ownerDocument.activeElement&&t.ownerDocument.activeElement.blur()},XV={name:"1kfdb0e",styles:"position:fixed;left:0;bottom:0;right:0;top:0"};function ZV(e){var n=e.children,t=e.lockEnabled,r=e.captureEnabled,a=r===void 0?!0:r,o=e.onBottomArrive,l=e.onBottomLeave,h=e.onTopArrive,d=e.onTopLeave,u=QV({isEnabled:a,onBottomArrive:o,onBottomLeave:l,onTopArrive:h,onTopLeave:d}),f=JV({isEnabled:t}),g=function(v){u(v),f(v)};return Bt(w.Fragment,null,t&&Bt("div",{onClick:KV,css:XV}),n(g))}var eH={name:"1a0ro4n-requiredInput",styles:"label:requiredInput;opacity:0;pointer-events:none;position:absolute;bottom:0;left:0;right:0;width:100%"},tH=function(n){var t=n.name,r=n.onFocus;return Bt("input",{required:!0,name:t,tabIndex:-1,"aria-hidden":"true",onFocus:r,css:eH,value:"",onChange:function(){}})},nH=tH;function Qw(e){var n;return typeof window<"u"&&window.navigator!=null?e.test(((n=window.navigator.userAgentData)===null||n===void 0?void 0:n.platform)||window.navigator.platform):!1}function iH(){return Qw(/^iPhone/i)}function oT(){return Qw(/^Mac/i)}function rH(){return Qw(/^iPad/i)||oT()&&navigator.maxTouchPoints>1}function aH(){return iH()||rH()}function sH(){return oT()||aH()}var oH=function(n){return n.label},lH=function(n){return n.label},cH=function(n){return n.value},uH=function(n){return!!n.isDisabled},dH={clearIndicator:Yq,container:Oq,control:eV,dropdownIndicator:Hq,group:rV,groupHeading:sV,indicatorsContainer:zq,indicatorSeparator:Qq,input:uV,loadingIndicator:Xq,loadingMessage:Dq,menu:jq,menuList:Tq,menuPortal:Mq,multiValue:mV,multiValueLabel:gV,multiValueRemove:yV,noOptionsMessage:Aq,option:SV,placeholder:CV,singleValue:EV,valueContainer:Fq},hH={primary:"#2684FF",primary75:"#4C9AFF",primary50:"#B2D4FF",primary25:"#DEEBFF",danger:"#DE350B",dangerLight:"#FFBDAD",neutral0:"hsl(0, 0%, 100%)",neutral5:"hsl(0, 0%, 95%)",neutral10:"hsl(0, 0%, 90%)",neutral20:"hsl(0, 0%, 80%)",neutral30:"hsl(0, 0%, 70%)",neutral40:"hsl(0, 0%, 60%)",neutral50:"hsl(0, 0%, 50%)",neutral60:"hsl(0, 0%, 40%)",neutral70:"hsl(0, 0%, 30%)",neutral80:"hsl(0, 0%, 20%)",neutral90:"hsl(0, 0%, 10%)"},fH=4,lT=4,pH=38,mH=lT*2,gH={baseUnit:lT,controlHeight:pH,menuGutter:mH},A0={borderRadius:fH,colors:hH,spacing:gH},yH={"aria-live":"polite",backspaceRemovesValue:!0,blurInputOnSelect:Wj(),captureMenuScroll:!Wj(),classNames:{},closeMenuOnSelect:!0,closeMenuOnScroll:!1,components:{},controlShouldRenderValue:!0,escapeClearsValue:!1,filterOption:HV(),formatGroupLabel:oH,getOptionLabel:lH,getOptionValue:cH,isDisabled:!1,isLoading:!1,isMulti:!1,isRtl:!1,isSearchable:!0,isOptionDisabled:uH,loadingMessage:function(){return"Loading..."},maxMenuHeight:300,minMenuHeight:140,menuIsOpen:!1,menuPlacement:"bottom",menuPosition:"absolute",menuShouldBlockScroll:!1,menuShouldScrollIntoView:!pq(),noOptionsMessage:function(){return"No options"},openMenuOnFocus:!1,openMenuOnClick:!0,options:[],pageSize:5,placeholder:"Select...",screenReaderStatus:function(n){var t=n.count;return"".concat(t," result").concat(t!==1?"s":""," available")},styles:{},tabIndex:0,tabSelectsValue:!0,unstyled:!1};function s_(e,n,t,r){var a=dT(e,n,t),o=hT(e,n,t),l=uT(e,n),h=wb(e,n);return{type:"option",data:n,isDisabled:a,isSelected:o,label:l,value:h,index:r}}function eb(e,n){return e.options.map(function(t,r){if("options"in t){var a=t.options.map(function(l,h){return s_(e,l,n,h)}).filter(function(l){return l_(e,l)});return a.length>0?{type:"group",data:t,options:a,index:r}:void 0}var o=s_(e,t,n,r);return l_(e,o)?o:void 0}).filter(yq)}function cT(e){return e.reduce(function(n,t){return t.type==="group"?n.push.apply(n,$w(t.options.map(function(r){return r.data}))):n.push(t.data),n},[])}function o_(e,n){return e.reduce(function(t,r){return r.type==="group"?t.push.apply(t,$w(r.options.map(function(a){return{data:a.data,id:"".concat(n,"-").concat(r.index,"-").concat(a.index)}}))):t.push({data:r.data,id:"".concat(n,"-").concat(r.index)}),t},[])}function xH(e,n){return cT(eb(e,n))}function l_(e,n){var t=e.inputValue,r=t===void 0?"":t,a=n.data,o=n.isSelected,l=n.label,h=n.value;return(!pT(e)||!o)&&fT(e,{label:l,value:h,data:a},r)}function bH(e,n){var t=e.focusedValue,r=e.selectValue,a=r.indexOf(t);if(a>-1){var o=n.indexOf(t);if(o>-1)return t;if(a<n.length)return n[a]}return null}function vH(e,n){var t=e.focusedOption;return t&&n.indexOf(t)>-1?t:n[0]}var D0=function(n,t){var r,a=(r=n.find(function(o){return o.data===t}))===null||r===void 0?void 0:r.id;return a||null},uT=function(n,t){return n.getOptionLabel(t)},wb=function(n,t){return n.getOptionValue(t)};function dT(e,n,t){return typeof e.isOptionDisabled=="function"?e.isOptionDisabled(n,t):!1}function hT(e,n,t){if(t.indexOf(n)>-1)return!0;if(typeof e.isOptionSelected=="function")return e.isOptionSelected(n,t);var r=wb(e,n);return t.some(function(a){return wb(e,a)===r})}function fT(e,n,t){return e.filterOption?e.filterOption(n,t):!0}var pT=function(n){var t=n.hideSelectedOptions,r=n.isMulti;return t===void 0?r:t},wH=1,mT=function(e){B9(t,e);var n=V9(t);function t(r){var a;if($9(this,t),a=n.call(this,r),a.state={ariaSelection:null,focusedOption:null,focusedOptionId:null,focusableOptionsWithIds:[],focusedValue:null,inputIsHidden:!1,isFocused:!1,selectValue:[],clearFocusValueOnUpdate:!1,prevWasFocused:!1,inputIsHiddenAfterUpdate:void 0,prevProps:void 0,instancePrefix:"",isAppleDevice:!1},a.blockOptionHover=!1,a.isComposing=!1,a.commonProps=void 0,a.initialTouchX=0,a.initialTouchY=0,a.openAfterFocus=!1,a.scrollToFocusedOptionOnUpdate=!1,a.userIsDragging=void 0,a.controlRef=null,a.getControlRef=function(d){a.controlRef=d},a.focusedOptionRef=null,a.getFocusedOptionRef=function(d){a.focusedOptionRef=d},a.menuListRef=null,a.getMenuListRef=function(d){a.menuListRef=d},a.inputRef=null,a.getInputRef=function(d){a.inputRef=d},a.focus=a.focusInput,a.blur=a.blurInput,a.onChange=function(d,u){var f=a.props,g=f.onChange,b=f.name;u.name=b,a.ariaOnChange(d,u),g(d,u)},a.setValue=function(d,u,f){var g=a.props,b=g.closeMenuOnSelect,v=g.isMulti,S=g.inputValue;a.onInputChange("",{action:"set-value",prevInputValue:S}),b&&(a.setState({inputIsHiddenAfterUpdate:!v}),a.onMenuClose()),a.setState({clearFocusValueOnUpdate:!0}),a.onChange(d,{action:u,option:f})},a.selectOption=function(d){var u=a.props,f=u.blurInputOnSelect,g=u.isMulti,b=u.name,v=a.state.selectValue,S=g&&a.isOptionSelected(d,v),T=a.isOptionDisabled(d,v);if(S){var E=a.getOptionValue(d);a.setValue(v.filter(function(C){return a.getOptionValue(C)!==E}),"deselect-option",d)}else if(!T)g?a.setValue([].concat($w(v),[d]),"select-option",d):a.setValue(d,"select-option");else{a.ariaOnChange(d,{action:"select-option",option:d,name:b});return}f&&a.blurInput()},a.removeValue=function(d){var u=a.props.isMulti,f=a.state.selectValue,g=a.getOptionValue(d),b=f.filter(function(S){return a.getOptionValue(S)!==g}),v=Mx(u,b,b[0]||null);a.onChange(v,{action:"remove-value",removedValue:d}),a.focusInput()},a.clearValue=function(){var d=a.state.selectValue;a.onChange(Mx(a.props.isMulti,[],null),{action:"clear",removedValues:d})},a.popValue=function(){var d=a.props.isMulti,u=a.state.selectValue,f=u[u.length-1],g=u.slice(0,u.length-1),b=Mx(d,g,g[0]||null);f&&a.onChange(b,{action:"pop-value",removedValue:f})},a.getFocusedOptionId=function(d){return D0(a.state.focusableOptionsWithIds,d)},a.getFocusableOptionsWithIds=function(){return o_(eb(a.props,a.state.selectValue),a.getElementId("option"))},a.getValue=function(){return a.state.selectValue},a.cx=function(){for(var d=arguments.length,u=new Array(d),f=0;f<d;f++)u[f]=arguments[f];return cq.apply(void 0,[a.props.classNamePrefix].concat(u))},a.getOptionLabel=function(d){return uT(a.props,d)},a.getOptionValue=function(d){return wb(a.props,d)},a.getStyles=function(d,u){var f=a.props.unstyled,g=dH[d](u,f);g.boxSizing="border-box";var b=a.props.styles[d];return b?b(g,u):g},a.getClassNames=function(d,u){var f,g;return(f=(g=a.props.classNames)[d])===null||f===void 0?void 0:f.call(g,u)},a.getElementId=function(d){return"".concat(a.state.instancePrefix,"-").concat(d)},a.getComponents=function(){return IV(a.props)},a.buildCategorizedOptions=function(){return eb(a.props,a.state.selectValue)},a.getCategorizedOptions=function(){return a.props.menuIsOpen?a.buildCategorizedOptions():[]},a.buildFocusableOptions=function(){return cT(a.buildCategorizedOptions())},a.getFocusableOptions=function(){return a.props.menuIsOpen?a.buildFocusableOptions():[]},a.ariaOnChange=function(d,u){a.setState({ariaSelection:Gt({value:d},u)})},a.onMenuMouseDown=function(d){d.button===0&&(d.stopPropagation(),d.preventDefault(),a.focusInput())},a.onMenuMouseMove=function(d){a.blockOptionHover=!1},a.onControlMouseDown=function(d){if(!d.defaultPrevented){var u=a.props.openMenuOnClick;a.state.isFocused?a.props.menuIsOpen?d.target.tagName!=="INPUT"&&d.target.tagName!=="TEXTAREA"&&a.onMenuClose():u&&a.openMenu("first"):(u&&(a.openAfterFocus=!0),a.focusInput()),d.target.tagName!=="INPUT"&&d.target.tagName!=="TEXTAREA"&&d.preventDefault()}},a.onDropdownIndicatorMouseDown=function(d){if(!(d&&d.type==="mousedown"&&d.button!==0)&&!a.props.isDisabled){var u=a.props,f=u.isMulti,g=u.menuIsOpen;a.focusInput(),g?(a.setState({inputIsHiddenAfterUpdate:!f}),a.onMenuClose()):a.openMenu("first"),d.preventDefault()}},a.onClearIndicatorMouseDown=function(d){d&&d.type==="mousedown"&&d.button!==0||(a.clearValue(),d.preventDefault(),a.openAfterFocus=!1,d.type==="touchend"?a.focusInput():setTimeout(function(){return a.focusInput()}))},a.onScroll=function(d){typeof a.props.closeMenuOnScroll=="boolean"?d.target instanceof HTMLElement&&Qb(d.target)&&a.props.onMenuClose():typeof a.props.closeMenuOnScroll=="function"&&a.props.closeMenuOnScroll(d)&&a.props.onMenuClose()},a.onCompositionStart=function(){a.isComposing=!0},a.onCompositionEnd=function(){a.isComposing=!1},a.onTouchStart=function(d){var u=d.touches,f=u&&u.item(0);f&&(a.initialTouchX=f.clientX,a.initialTouchY=f.clientY,a.userIsDragging=!1)},a.onTouchMove=function(d){var u=d.touches,f=u&&u.item(0);if(f){var g=Math.abs(f.clientX-a.initialTouchX),b=Math.abs(f.clientY-a.initialTouchY),v=5;a.userIsDragging=g>v||b>v}},a.onTouchEnd=function(d){a.userIsDragging||(a.controlRef&&!a.controlRef.contains(d.target)&&a.menuListRef&&!a.menuListRef.contains(d.target)&&a.blurInput(),a.initialTouchX=0,a.initialTouchY=0)},a.onControlTouchEnd=function(d){a.userIsDragging||a.onControlMouseDown(d)},a.onClearIndicatorTouchEnd=function(d){a.userIsDragging||a.onClearIndicatorMouseDown(d)},a.onDropdownIndicatorTouchEnd=function(d){a.userIsDragging||a.onDropdownIndicatorMouseDown(d)},a.handleInputChange=function(d){var u=a.props.inputValue,f=d.currentTarget.value;a.setState({inputIsHiddenAfterUpdate:!1}),a.onInputChange(f,{action:"input-change",prevInputValue:u}),a.props.menuIsOpen||a.onMenuOpen()},a.onInputFocus=function(d){a.props.onFocus&&a.props.onFocus(d),a.setState({inputIsHiddenAfterUpdate:!1,isFocused:!0}),(a.openAfterFocus||a.props.openMenuOnFocus)&&a.openMenu("first"),a.openAfterFocus=!1},a.onInputBlur=function(d){var u=a.props.inputValue;if(a.menuListRef&&a.menuListRef.contains(document.activeElement)){a.inputRef.focus();return}a.props.onBlur&&a.props.onBlur(d),a.onInputChange("",{action:"input-blur",prevInputValue:u}),a.onMenuClose(),a.setState({focusedValue:null,isFocused:!1})},a.onOptionHover=function(d){if(!(a.blockOptionHover||a.state.focusedOption===d)){var u=a.getFocusableOptions(),f=u.indexOf(d);a.setState({focusedOption:d,focusedOptionId:f>-1?a.getFocusedOptionId(d):null})}},a.shouldHideSelectedOptions=function(){return pT(a.props)},a.onValueInputFocus=function(d){d.preventDefault(),d.stopPropagation(),a.focus()},a.onKeyDown=function(d){var u=a.props,f=u.isMulti,g=u.backspaceRemovesValue,b=u.escapeClearsValue,v=u.inputValue,S=u.isClearable,T=u.isDisabled,E=u.menuIsOpen,C=u.onKeyDown,P=u.tabSelectsValue,I=u.openMenuOnFocus,q=a.state,L=q.focusedOption,O=q.focusedValue,B=q.selectValue;if(!T&&!(typeof C=="function"&&(C(d),d.defaultPrevented))){switch(a.blockOptionHover=!0,d.key){case"ArrowLeft":if(!f||v)return;a.focusValue("previous");break;case"ArrowRight":if(!f||v)return;a.focusValue("next");break;case"Delete":case"Backspace":if(v)return;if(O)a.removeValue(O);else{if(!g)return;f?a.popValue():S&&a.clearValue()}break;case"Tab":if(a.isComposing||d.shiftKey||!E||!P||!L||I&&a.isOptionSelected(L,B))return;a.selectOption(L);break;case"Enter":if(d.keyCode===229)break;if(E){if(!L||a.isComposing)return;a.selectOption(L);break}return;case"Escape":E?(a.setState({inputIsHiddenAfterUpdate:!1}),a.onInputChange("",{action:"menu-close",prevInputValue:v}),a.onMenuClose()):S&&b&&a.clearValue();break;case" ":if(v)return;if(!E){a.openMenu("first");break}if(!L)return;a.selectOption(L);break;case"ArrowUp":E?a.focusOption("up"):a.openMenu("last");break;case"ArrowDown":E?a.focusOption("down"):a.openMenu("first");break;case"PageUp":if(!E)return;a.focusOption("pageup");break;case"PageDown":if(!E)return;a.focusOption("pagedown");break;case"Home":if(!E)return;a.focusOption("first");break;case"End":if(!E)return;a.focusOption("last");break;default:return}d.preventDefault()}},a.state.instancePrefix="react-select-"+(a.props.instanceId||++wH),a.state.selectValue=Gj(r.value),r.menuIsOpen&&a.state.selectValue.length){var o=a.getFocusableOptionsWithIds(),l=a.buildFocusableOptions(),h=l.indexOf(a.state.selectValue[0]);a.state.focusableOptionsWithIds=o,a.state.focusedOption=l[h],a.state.focusedOptionId=D0(o,l[h])}return a}return z9(t,[{key:"componentDidMount",value:function(){this.startListeningComposition(),this.startListeningToTouch(),this.props.closeMenuOnScroll&&document&&document.addEventListener&&document.addEventListener("scroll",this.onScroll,!0),this.props.autoFocus&&this.focusInput(),this.props.menuIsOpen&&this.state.focusedOption&&this.menuListRef&&this.focusedOptionRef&&Yj(this.menuListRef,this.focusedOptionRef),sH()&&this.setState({isAppleDevice:!0})}},{key:"componentDidUpdate",value:function(a){var o=this.props,l=o.isDisabled,h=o.menuIsOpen,d=this.state.isFocused;(d&&!l&&a.isDisabled||d&&h&&!a.menuIsOpen)&&this.focusInput(),d&&l&&!a.isDisabled?this.setState({isFocused:!1},this.onMenuClose):!d&&!l&&a.isDisabled&&this.inputRef===document.activeElement&&this.setState({isFocused:!0}),this.menuListRef&&this.focusedOptionRef&&this.scrollToFocusedOptionOnUpdate&&(Yj(this.menuListRef,this.focusedOptionRef),this.scrollToFocusedOptionOnUpdate=!1)}},{key:"componentWillUnmount",value:function(){this.stopListeningComposition(),this.stopListeningToTouch(),document.removeEventListener("scroll",this.onScroll,!0)}},{key:"onMenuOpen",value:function(){this.props.onMenuOpen()}},{key:"onMenuClose",value:function(){this.onInputChange("",{action:"menu-close",prevInputValue:this.props.inputValue}),this.props.onMenuClose()}},{key:"onInputChange",value:function(a,o){this.props.onInputChange(a,o)}},{key:"focusInput",value:function(){this.inputRef&&this.inputRef.focus()}},{key:"blurInput",value:function(){this.inputRef&&this.inputRef.blur()}},{key:"openMenu",value:function(a){var o=this,l=this.state,h=l.selectValue,d=l.isFocused,u=this.buildFocusableOptions(),f=a==="first"?0:u.length-1;if(!this.props.isMulti){var g=u.indexOf(h[0]);g>-1&&(f=g)}this.scrollToFocusedOptionOnUpdate=!(d&&this.menuListRef),this.setState({inputIsHiddenAfterUpdate:!1,focusedValue:null,focusedOption:u[f],focusedOptionId:this.getFocusedOptionId(u[f])},function(){return o.onMenuOpen()})}},{key:"focusValue",value:function(a){var o=this.state,l=o.selectValue,h=o.focusedValue;if(this.props.isMulti){this.setState({focusedOption:null});var d=l.indexOf(h);h||(d=-1);var u=l.length-1,f=-1;if(l.length){switch(a){case"previous":d===0?f=0:d===-1?f=u:f=d-1;break;case"next":d>-1&&d<u&&(f=d+1);break}this.setState({inputIsHidden:f!==-1,focusedValue:l[f]})}}}},{key:"focusOption",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"first",o=this.props.pageSize,l=this.state.focusedOption,h=this.getFocusableOptions();if(h.length){var d=0,u=h.indexOf(l);l||(u=-1),a==="up"?d=u>0?u-1:h.length-1:a==="down"?d=(u+1)%h.length:a==="pageup"?(d=u-o,d<0&&(d=0)):a==="pagedown"?(d=u+o,d>h.length-1&&(d=h.length-1)):a==="last"&&(d=h.length-1),this.scrollToFocusedOptionOnUpdate=!0,this.setState({focusedOption:h[d],focusedValue:null,focusedOptionId:this.getFocusedOptionId(h[d])})}}},{key:"getTheme",value:function(){return this.props.theme?typeof this.props.theme=="function"?this.props.theme(A0):Gt(Gt({},A0),this.props.theme):A0}},{key:"getCommonProps",value:function(){var a=this.clearValue,o=this.cx,l=this.getStyles,h=this.getClassNames,d=this.getValue,u=this.selectOption,f=this.setValue,g=this.props,b=g.isMulti,v=g.isRtl,S=g.options,T=this.hasValue();return{clearValue:a,cx:o,getStyles:l,getClassNames:h,getValue:d,hasValue:T,isMulti:b,isRtl:v,options:S,selectOption:u,selectProps:g,setValue:f,theme:this.getTheme()}}},{key:"hasValue",value:function(){var a=this.state.selectValue;return a.length>0}},{key:"hasOptions",value:function(){return!!this.getFocusableOptions().length}},{key:"isClearable",value:function(){var a=this.props,o=a.isClearable,l=a.isMulti;return o===void 0?l:o}},{key:"isOptionDisabled",value:function(a,o){return dT(this.props,a,o)}},{key:"isOptionSelected",value:function(a,o){return hT(this.props,a,o)}},{key:"filterOption",value:function(a,o){return fT(this.props,a,o)}},{key:"formatOptionLabel",value:function(a,o){if(typeof this.props.formatOptionLabel=="function"){var l=this.props.inputValue,h=this.state.selectValue;return this.props.formatOptionLabel(a,{context:o,inputValue:l,selectValue:h})}else return this.getOptionLabel(a)}},{key:"formatGroupLabel",value:function(a){return this.props.formatGroupLabel(a)}},{key:"startListeningComposition",value:function(){document&&document.addEventListener&&(document.addEventListener("compositionstart",this.onCompositionStart,!1),document.addEventListener("compositionend",this.onCompositionEnd,!1))}},{key:"stopListeningComposition",value:function(){document&&document.removeEventListener&&(document.removeEventListener("compositionstart",this.onCompositionStart),document.removeEventListener("compositionend",this.onCompositionEnd))}},{key:"startListeningToTouch",value:function(){document&&document.addEventListener&&(document.addEventListener("touchstart",this.onTouchStart,!1),document.addEventListener("touchmove",this.onTouchMove,!1),document.addEventListener("touchend",this.onTouchEnd,!1))}},{key:"stopListeningToTouch",value:function(){document&&document.removeEventListener&&(document.removeEventListener("touchstart",this.onTouchStart),document.removeEventListener("touchmove",this.onTouchMove),document.removeEventListener("touchend",this.onTouchEnd))}},{key:"renderInput",value:function(){var a=this.props,o=a.isDisabled,l=a.isSearchable,h=a.inputId,d=a.inputValue,u=a.tabIndex,f=a.form,g=a.menuIsOpen,b=a.required,v=this.getComponents(),S=v.Input,T=this.state,E=T.inputIsHidden,C=T.ariaSelection,P=this.commonProps,I=h||this.getElementId("input"),q=Gt(Gt(Gt({"aria-autocomplete":"list","aria-expanded":g,"aria-haspopup":!0,"aria-errormessage":this.props["aria-errormessage"],"aria-invalid":this.props["aria-invalid"],"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-required":b,role:"combobox","aria-activedescendant":this.state.isAppleDevice?void 0:this.state.focusedOptionId||""},g&&{"aria-controls":this.getElementId("listbox")}),!l&&{"aria-readonly":!0}),this.hasValue()?(C==null?void 0:C.action)==="initial-input-focus"&&{"aria-describedby":this.getElementId("live-region")}:{"aria-describedby":this.getElementId("placeholder")});return l?w.createElement(S,Qt({},P,{autoCapitalize:"none",autoComplete:"off",autoCorrect:"off",id:I,innerRef:this.getInputRef,isDisabled:o,isHidden:E,onBlur:this.onInputBlur,onChange:this.handleInputChange,onFocus:this.onInputFocus,spellCheck:"false",tabIndex:u,form:f,type:"text",value:d},q)):w.createElement(YV,Qt({id:I,innerRef:this.getInputRef,onBlur:this.onInputBlur,onChange:bb,onFocus:this.onInputFocus,disabled:o,tabIndex:u,inputMode:"none",form:f,value:""},q))}},{key:"renderPlaceholderOrValue",value:function(){var a=this,o=this.getComponents(),l=o.MultiValue,h=o.MultiValueContainer,d=o.MultiValueLabel,u=o.MultiValueRemove,f=o.SingleValue,g=o.Placeholder,b=this.commonProps,v=this.props,S=v.controlShouldRenderValue,T=v.isDisabled,E=v.isMulti,C=v.inputValue,P=v.placeholder,I=this.state,q=I.selectValue,L=I.focusedValue,O=I.isFocused;if(!this.hasValue()||!S)return C?null:w.createElement(g,Qt({},b,{key:"placeholder",isDisabled:T,isFocused:O,innerProps:{id:this.getElementId("placeholder")}}),P);if(E)return q.map(function($,F){var z=$===L,U="".concat(a.getOptionLabel($),"-").concat(a.getOptionValue($));return w.createElement(l,Qt({},b,{components:{Container:h,Label:d,Remove:u},isFocused:z,isDisabled:T,key:U,index:F,removeProps:{onClick:function(){return a.removeValue($)},onTouchEnd:function(){return a.removeValue($)},onMouseDown:function(ee){ee.preventDefault()}},data:$}),a.formatOptionLabel($,"value"))});if(C)return null;var B=q[0];return w.createElement(f,Qt({},b,{data:B,isDisabled:T}),this.formatOptionLabel(B,"value"))}},{key:"renderClearIndicator",value:function(){var a=this.getComponents(),o=a.ClearIndicator,l=this.commonProps,h=this.props,d=h.isDisabled,u=h.isLoading,f=this.state.isFocused;if(!this.isClearable()||!o||d||!this.hasValue()||u)return null;var g={onMouseDown:this.onClearIndicatorMouseDown,onTouchEnd:this.onClearIndicatorTouchEnd,"aria-hidden":"true"};return w.createElement(o,Qt({},l,{innerProps:g,isFocused:f}))}},{key:"renderLoadingIndicator",value:function(){var a=this.getComponents(),o=a.LoadingIndicator,l=this.commonProps,h=this.props,d=h.isDisabled,u=h.isLoading,f=this.state.isFocused;if(!o||!u)return null;var g={"aria-hidden":"true"};return w.createElement(o,Qt({},l,{innerProps:g,isDisabled:d,isFocused:f}))}},{key:"renderIndicatorSeparator",value:function(){var a=this.getComponents(),o=a.DropdownIndicator,l=a.IndicatorSeparator;if(!o||!l)return null;var h=this.commonProps,d=this.props.isDisabled,u=this.state.isFocused;return w.createElement(l,Qt({},h,{isDisabled:d,isFocused:u}))}},{key:"renderDropdownIndicator",value:function(){var a=this.getComponents(),o=a.DropdownIndicator;if(!o)return null;var l=this.commonProps,h=this.props.isDisabled,d=this.state.isFocused,u={onMouseDown:this.onDropdownIndicatorMouseDown,onTouchEnd:this.onDropdownIndicatorTouchEnd,"aria-hidden":"true"};return w.createElement(o,Qt({},l,{innerProps:u,isDisabled:h,isFocused:d}))}},{key:"renderMenu",value:function(){var a=this,o=this.getComponents(),l=o.Group,h=o.GroupHeading,d=o.Menu,u=o.MenuList,f=o.MenuPortal,g=o.LoadingMessage,b=o.NoOptionsMessage,v=o.Option,S=this.commonProps,T=this.state.focusedOption,E=this.props,C=E.captureMenuScroll,P=E.inputValue,I=E.isLoading,q=E.loadingMessage,L=E.minMenuHeight,O=E.maxMenuHeight,B=E.menuIsOpen,$=E.menuPlacement,F=E.menuPosition,z=E.menuPortalTarget,U=E.menuShouldBlockScroll,V=E.menuShouldScrollIntoView,ee=E.noOptionsMessage,ie=E.onMenuScrollToTop,ae=E.onMenuScrollToBottom;if(!B)return null;var J=function(M,Se){var $e=M.type,he=M.data,ge=M.isDisabled,me=M.isSelected,de=M.label,Le=M.value,He=T===he,pe=ge?void 0:function(){return a.onOptionHover(he)},ne=ge?void 0:function(){return a.selectOption(he)},Pe="".concat(a.getElementId("option"),"-").concat(Se),Ye={id:Pe,onClick:ne,onMouseMove:pe,onMouseOver:pe,tabIndex:-1,role:"option","aria-selected":a.state.isAppleDevice?void 0:me};return w.createElement(v,Qt({},S,{innerProps:Ye,data:he,isDisabled:ge,isSelected:me,key:Pe,label:de,type:$e,value:Le,isFocused:He,innerRef:He?a.getFocusedOptionRef:void 0}),a.formatOptionLabel(M.data,"menu"))},K;if(this.hasOptions())K=this.getCategorizedOptions().map(function(xe){if(xe.type==="group"){var M=xe.data,Se=xe.options,$e=xe.index,he="".concat(a.getElementId("group"),"-").concat($e),ge="".concat(he,"-heading");return w.createElement(l,Qt({},S,{key:he,data:M,options:Se,Heading:h,headingProps:{id:ge,data:xe.data},label:a.formatGroupLabel(xe.data)}),xe.options.map(function(me){return J(me,"".concat($e,"-").concat(me.index))}))}else if(xe.type==="option")return J(xe,"".concat(xe.index))});else if(I){var W=q({inputValue:P});if(W===null)return null;K=w.createElement(g,S,W)}else{var re=ee({inputValue:P});if(re===null)return null;K=w.createElement(b,S,re)}var A={minMenuHeight:L,maxMenuHeight:O,menuPlacement:$,menuPosition:F,menuShouldScrollIntoView:V},te=w.createElement(_q,Qt({},S,A),function(xe){var M=xe.ref,Se=xe.placerProps,$e=Se.placement,he=Se.maxHeight;return w.createElement(d,Qt({},S,A,{innerRef:M,innerProps:{onMouseDown:a.onMenuMouseDown,onMouseMove:a.onMenuMouseMove},isLoading:I,placement:$e}),w.createElement(ZV,{captureEnabled:C,onTopArrive:ie,onBottomArrive:ae,lockEnabled:U},function(ge){return w.createElement(u,Qt({},S,{innerRef:function(de){a.getMenuListRef(de),ge(de)},innerProps:{role:"listbox","aria-multiselectable":S.isMulti,id:a.getElementId("listbox")},isLoading:I,maxHeight:he,focusedOption:T}),K)}))});return z||F==="fixed"?w.createElement(f,Qt({},S,{appendTo:z,controlElement:this.controlRef,menuPlacement:$,menuPosition:F}),te):te}},{key:"renderFormField",value:function(){var a=this,o=this.props,l=o.delimiter,h=o.isDisabled,d=o.isMulti,u=o.name,f=o.required,g=this.state.selectValue;if(f&&!this.hasValue()&&!h)return w.createElement(nH,{name:u,onFocus:this.onValueInputFocus});if(!(!u||h))if(d)if(l){var b=g.map(function(T){return a.getOptionValue(T)}).join(l);return w.createElement("input",{name:u,type:"hidden",value:b})}else{var v=g.length>0?g.map(function(T,E){return w.createElement("input",{key:"i-".concat(E),name:u,type:"hidden",value:a.getOptionValue(T)})}):w.createElement("input",{name:u,type:"hidden",value:""});return w.createElement("div",null,v)}else{var S=g[0]?this.getOptionValue(g[0]):"";return w.createElement("input",{name:u,type:"hidden",value:S})}}},{key:"renderLiveRegion",value:function(){var a=this.commonProps,o=this.state,l=o.ariaSelection,h=o.focusedOption,d=o.focusedValue,u=o.isFocused,f=o.selectValue,g=this.getFocusableOptions();return w.createElement(BV,Qt({},a,{id:this.getElementId("live-region"),ariaSelection:l,focusedOption:h,focusedValue:d,isFocused:u,selectValue:f,focusableOptions:g,isAppleDevice:this.state.isAppleDevice}))}},{key:"render",value:function(){var a=this.getComponents(),o=a.Control,l=a.IndicatorsContainer,h=a.SelectContainer,d=a.ValueContainer,u=this.props,f=u.className,g=u.id,b=u.isDisabled,v=u.menuIsOpen,S=this.state.isFocused,T=this.commonProps=this.getCommonProps();return w.createElement(h,Qt({},T,{className:f,innerProps:{id:g,onKeyDown:this.onKeyDown},isDisabled:b,isFocused:S}),this.renderLiveRegion(),w.createElement(o,Qt({},T,{innerRef:this.getControlRef,innerProps:{onMouseDown:this.onControlMouseDown,onTouchEnd:this.onControlTouchEnd},isDisabled:b,isFocused:S,menuIsOpen:v}),w.createElement(d,Qt({},T,{isDisabled:b}),this.renderPlaceholderOrValue(),this.renderInput()),w.createElement(l,Qt({},T,{isDisabled:b}),this.renderClearIndicator(),this.renderLoadingIndicator(),this.renderIndicatorSeparator(),this.renderDropdownIndicator())),this.renderMenu(),this.renderFormField())}}],[{key:"getDerivedStateFromProps",value:function(a,o){var l=o.prevProps,h=o.clearFocusValueOnUpdate,d=o.inputIsHiddenAfterUpdate,u=o.ariaSelection,f=o.isFocused,g=o.prevWasFocused,b=o.instancePrefix,v=a.options,S=a.value,T=a.menuIsOpen,E=a.inputValue,C=a.isMulti,P=Gj(S),I={};if(l&&(S!==l.value||v!==l.options||T!==l.menuIsOpen||E!==l.inputValue)){var q=T?xH(a,P):[],L=T?o_(eb(a,P),"".concat(b,"-option")):[],O=h?bH(o,P):null,B=vH(o,q),$=D0(L,B);I={selectValue:P,focusedOption:B,focusedOptionId:$,focusableOptionsWithIds:L,focusedValue:O,clearFocusValueOnUpdate:!1}}var F=d!=null&&a!==l?{inputIsHidden:d,inputIsHiddenAfterUpdate:void 0}:{},z=u,U=f&&g;return f&&!U&&(z={value:Mx(C,P,P[0]||null),options:P,action:"initial-input-focus"},U=!g),(u==null?void 0:u.action)==="initial-input-focus"&&(z=null),Gt(Gt(Gt({},I),F),{},{prevProps:a,ariaSelection:z,prevWasFocused:U})}}]),t}(w.Component);mT.defaultProps=yH;var NH=w.forwardRef(function(e,n){var t=F9(e);return w.createElement(mT,Qt({ref:n},t))}),SH=NH;const If=new Map,gT=(()=>{const e=new Promise(n=>{window.addEventListener("pointerdown",n,{once:!0}),window.addEventListener("keydown",n,{once:!0})});return async n=>{try{const t=new Audio;if(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",await t.play(),n!=null&&n.id&&If.has(n.id)){const a=If.get(n.id);if(a)return a}const r=new AudioContext(n);return n!=null&&n.id&&If.set(n.id,r),r}catch{if(await e,n!=null&&n.id&&If.has(n.id)){const a=If.get(n.id);if(a)return a}const r=new AudioContext(n);return n!=null&&n.id&&If.set(n.id,r),r}}})();function jH(e){var n=atob(e),t=new Uint8Array(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t.buffer}const _H=`
class AudioProcessingWorklet extends AudioWorkletProcessor {

  // send and clear buffer every 2048 samples, 
  // which at 16khz is about 8 times a second
  buffer = new Int16Array(2048);

  // current write index
  bufferWriteIndex = 0;

  constructor() {
    super();
    this.hasAudio = false;
  }

  /**
   * @param inputs Float32Array[][] [input#][channel#][sample#] so to access first inputs 1st channel inputs[0][0]
   * @param outputs Float32Array[][]
   */
  process(inputs) {
    if (inputs[0].length) {
      const channel0 = inputs[0][0];
      this.processChunk(channel0);
    }
    return true;
  }

  sendAndClearBuffer(){
    this.port.postMessage({
      event: "chunk",
      data: {
        int16arrayBuffer: this.buffer.slice(0, this.bufferWriteIndex).buffer,
      },
    });
    this.bufferWriteIndex = 0;
  }

  processChunk(float32Array) {
    const l = float32Array.length;
    
    for (let i = 0; i < l; i++) {
      // convert float32 -1 to 1 to int16 -32768 to 32767
      const int16Value = float32Array[i] * 32768;
      this.buffer[this.bufferWriteIndex++] = int16Value;
      if(this.bufferWriteIndex >= this.buffer.length) {
        this.sendAndClearBuffer();
      }
    }

    if(this.bufferWriteIndex >= this.buffer.length) {
      this.sendAndClearBuffer();
    }
  }
}
`,yT=`
  class VolMeter extends AudioWorkletProcessor {
    volume
    updateIntervalInMS
    nextUpdateFrame

    constructor() {
      super()
      this.volume = 0
      this.updateIntervalInMS = 25
      this.nextUpdateFrame = this.updateIntervalInMS
      this.port.onmessage = event => {
        if (event.data.updateIntervalInMS) {
          this.updateIntervalInMS = event.data.updateIntervalInMS
        }
      }
    }

    get intervalInFrames() {
      return (this.updateIntervalInMS / 1000) * sampleRate
    }

    process(inputs) {
      const input = inputs[0]

      if (input.length > 0) {
        const samples = input[0]
        let sum = 0
        let rms = 0

        for (let i = 0; i < samples.length; ++i) {
          sum += samples[i] * samples[i]
        }

        rms = Math.sqrt(sum / samples.length)
        this.volume = Math.max(rms, this.volume * 0.7)

        this.nextUpdateFrame -= samples.length
        if (this.nextUpdateFrame < 0) {
          this.nextUpdateFrame += this.intervalInFrames
          this.port.postMessage({volume: this.volume})
        }
      }

      return true
    }
  }`,Rx=new Map,L1=(e,n)=>{const t=new Blob([`registerProcessor("${e}", ${n})`],{type:"application/javascript"});return URL.createObjectURL(t)};var P0={exports:{}},c_;function CH(){return c_||(c_=1,function(e){var n=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function a(d,u,f){this.fn=d,this.context=u,this.once=f||!1}function o(d,u,f,g,b){if(typeof f!="function")throw new TypeError("The listener must be a function");var v=new a(f,g||d,b),S=t?t+u:u;return d._events[S]?d._events[S].fn?d._events[S]=[d._events[S],v]:d._events[S].push(v):(d._events[S]=v,d._eventsCount++),d}function l(d,u){--d._eventsCount===0?d._events=new r:delete d._events[u]}function h(){this._events=new r,this._eventsCount=0}h.prototype.eventNames=function(){var u=[],f,g;if(this._eventsCount===0)return u;for(g in f=this._events)n.call(f,g)&&u.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(f)):u},h.prototype.listeners=function(u){var f=t?t+u:u,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var b=0,v=g.length,S=new Array(v);b<v;b++)S[b]=g[b].fn;return S},h.prototype.listenerCount=function(u){var f=t?t+u:u,g=this._events[f];return g?g.fn?1:g.length:0},h.prototype.emit=function(u,f,g,b,v,S){var T=t?t+u:u;if(!this._events[T])return!1;var E=this._events[T],C=arguments.length,P,I;if(E.fn){switch(E.once&&this.removeListener(u,E.fn,void 0,!0),C){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,f),!0;case 3:return E.fn.call(E.context,f,g),!0;case 4:return E.fn.call(E.context,f,g,b),!0;case 5:return E.fn.call(E.context,f,g,b,v),!0;case 6:return E.fn.call(E.context,f,g,b,v,S),!0}for(I=1,P=new Array(C-1);I<C;I++)P[I-1]=arguments[I];E.fn.apply(E.context,P)}else{var q=E.length,L;for(I=0;I<q;I++)switch(E[I].once&&this.removeListener(u,E[I].fn,void 0,!0),C){case 1:E[I].fn.call(E[I].context);break;case 2:E[I].fn.call(E[I].context,f);break;case 3:E[I].fn.call(E[I].context,f,g);break;case 4:E[I].fn.call(E[I].context,f,g,b);break;default:if(!P)for(L=1,P=new Array(C-1);L<C;L++)P[L-1]=arguments[L];E[I].fn.apply(E[I].context,P)}}return!0},h.prototype.on=function(u,f,g){return o(this,u,f,g,!1)},h.prototype.once=function(u,f,g){return o(this,u,f,g,!0)},h.prototype.removeListener=function(u,f,g,b){var v=t?t+u:u;if(!this._events[v])return this;if(!f)return l(this,v),this;var S=this._events[v];if(S.fn)S.fn===f&&(!b||S.once)&&(!g||S.context===g)&&l(this,v);else{for(var T=0,E=[],C=S.length;T<C;T++)(S[T].fn!==f||b&&!S[T].once||g&&S[T].context!==g)&&E.push(S[T]);E.length?this._events[v]=E.length===1?E[0]:E:l(this,v)}return this},h.prototype.removeAllListeners=function(u){var f;return u?(f=t?t+u:u,this._events[f]&&l(this,f)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=t,h.EventEmitter=h,e.exports=h}(P0)),P0.exports}var kH=CH();const xT=ah(kH);function TH(e){for(var n="",t=new Uint8Array(e),r=t.byteLength,a=0;a<r;a++)n+=String.fromCharCode(t[a]);return window.btoa(n)}class bT extends xT{constructor(t=16e3){super();ui(this,"stream");ui(this,"audioContext");ui(this,"source");ui(this,"recording",!1);ui(this,"recordingWorklet");ui(this,"vuWorklet");ui(this,"starting",null);this.sampleRate=t}async start(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Could not request user media");this.starting=new Promise(async t=>{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=await gT({sampleRate:this.sampleRate}),this.source=this.audioContext.createMediaStreamSource(this.stream);const r="audio-recorder-worklet",a=L1(r,_H);await this.audioContext.audioWorklet.addModule(a),this.recordingWorklet=new AudioWorkletNode(this.audioContext,r),this.recordingWorklet.port.onmessage=async l=>{const h=l.data.data.int16arrayBuffer;if(h){const d=TH(h);this.emit("data",d)}},this.source.connect(this.recordingWorklet);const o="vu-meter";await this.audioContext.audioWorklet.addModule(L1(o,yT)),this.vuWorklet=new AudioWorkletNode(this.audioContext,o),this.vuWorklet.port.onmessage=l=>{this.emit("volume",l.data.volume)},this.source.connect(this.vuWorklet),this.recording=!0,t(),this.starting=null})}stop(){const t=()=>{var r,a;(r=this.source)==null||r.disconnect(),(a=this.stream)==null||a.getTracks().forEach(o=>o.stop()),this.stream=void 0,this.recordingWorklet=void 0,this.vuWorklet=void 0,this.audioContext&&(this.audioContext.close(),this.audioContext=void 0)};if(this.starting){this.starting.then(t);return}t()}}const EH=3,AH=({active:e,volume:n,hover:t})=>{const r=w.useRef([]);return w.useEffect(()=>{let a=null;const o=()=>{r.current.forEach((l,h)=>{l&&(l.style.height=`${Math.min(24,4+n*(h===1?400:60))}px`)}),a=window.setTimeout(o,100)};return o(),()=>clearTimeout(a)},[n]),i.jsx("div",{className:_u("audioPulse",{active:e,hover:t}),children:Array(EH).fill(null).map((a,o)=>i.jsx("div",{ref:l=>{r.current[o]=l},style:{animationDelay:`${o*133}ms`}},o))})};var Jm={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */var DH=Jm.exports,u_;function PH(){return u_||(u_=1,function(e,n){(function(){var t,r="4.17.21",a=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",h="Invalid `variable` option passed into `_.template`",d="__lodash_hash_undefined__",u=500,f="__lodash_placeholder__",g=1,b=2,v=4,S=1,T=2,E=1,C=2,P=4,I=8,q=16,L=32,O=64,B=128,$=256,F=512,z=30,U="...",V=800,ee=16,ie=1,ae=2,J=3,K=1/0,W=9007199254740991,re=17976931348623157e292,A=NaN,te=4294967295,xe=te-1,M=te>>>1,Se=[["ary",B],["bind",E],["bindKey",C],["curry",I],["curryRight",q],["flip",F],["partial",L],["partialRight",O],["rearg",$]],$e="[object Arguments]",he="[object Array]",ge="[object AsyncFunction]",me="[object Boolean]",de="[object Date]",Le="[object DOMException]",He="[object Error]",pe="[object Function]",ne="[object GeneratorFunction]",Pe="[object Map]",Ye="[object Number]",rt="[object Null]",ut="[object Object]",je="[object Promise]",Qe="[object Proxy]",ze="[object RegExp]",dt="[object Set]",Ze="[object String]",ct="[object Symbol]",ft="[object Undefined]",fe="[object WeakMap]",Q="[object WeakSet]",ue="[object ArrayBuffer]",De="[object DataView]",Ge="[object Float32Array]",ye="[object Float64Array]",Ne="[object Int8Array]",Me="[object Int16Array]",Fe="[object Int32Array]",ve="[object Uint8Array]",ke="[object Uint8ClampedArray]",Ee="[object Uint16Array]",Ve="[object Uint32Array]",Ke=/\b__p \+= '';/g,vt=/\b(__p \+=) '' \+/g,wt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,nt=/&(?:amp|lt|gt|quot|#39);/g,bt=/[&<>"']/g,Mt=RegExp(nt.source),tt=RegExp(bt.source),Nt=/<%-([\s\S]+?)%>/g,Lt=/<%([\s\S]+?)%>/g,pn=/<%=([\s\S]+?)%>/g,Kt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ln=/^\w*$/,Dt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mn=/[\\^$.*+?()[\]{}|]/g,Dn=RegExp(mn.source),ii=/^\s+/,Ie=/\s/,pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,mt=/\{\n\/\* \[wrapped with (.+)\] \*/,rn=/,? & /,Xt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Zn=/[()=,{}\[\]\/\s]/,Bi=/\\(\\)?/g,Qi=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Mi=/\w*$/,hr=/^[-+]0x[0-9a-f]+$/i,Mn=/^0b[01]+$/i,Li=/^\[object .+?Constructor\]$/,fr=/^0o[0-7]+$/i,aa=/^(?:0|[1-9]\d*)$/,fi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pn=/($^)/,pr=/['\n\r\u2028\u2029\\]/g,sr="\\ud800-\\udfff",Ol="\\u0300-\\u036f",or="\\ufe20-\\ufe2f",Fa="\\u20d0-\\u20ff",Sr=Ol+or+Fa,Gs="\\u2700-\\u27bf",Ys="a-z\\xdf-\\xf6\\xf8-\\xff",$a="\\xac\\xb1\\xd7\\xf7",Ws="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Iu="\\u2000-\\u206f",ch=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_c="A-Z\\xc0-\\xd6\\xd8-\\xde",jr="\\ufe0e\\ufe0f",Qs=$a+Ws+Iu+ch,Cc="[']",Js="["+sr+"]",kc="["+Qs+"]",ya="["+Sr+"]",Mu="\\d+",lr="["+Gs+"]",Ll="["+Ys+"]",Fo="[^"+sr+Qs+Mu+Gs+Ys+_c+"]",$o="\\ud83c[\\udffb-\\udfff]",za="(?:"+ya+"|"+$o+")",zo="[^"+sr+"]",Ks="(?:\\ud83c[\\udde6-\\uddff]){2}",ms="[\\ud800-\\udbff][\\udc00-\\udfff]",Ba="["+_c+"]",Fl="\\u200d",$l="(?:"+Ll+"|"+Fo+")",gs="(?:"+Ba+"|"+Fo+")",zl="(?:"+Cc+"(?:d|ll|m|re|s|t|ve))?",Tc="(?:"+Cc+"(?:D|LL|M|RE|S|T|VE))?",Xs=za+"?",Bo="["+jr+"]?",Bl="(?:"+Fl+"(?:"+[zo,Ks,ms].join("|")+")"+Bo+Xs+")*",mr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",ys="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ec=Bo+Xs+Bl,Ua="(?:"+[lr,Ks,ms].join("|")+")"+Ec,Ru="(?:"+[zo+ya+"?",ya,Ks,ms,Js].join("|")+")",Zs=RegExp(Cc,"g"),xa=RegExp(ya,"g"),Uo=RegExp($o+"(?="+$o+")|"+Ru+Ec,"g"),qo=RegExp([Ba+"?"+Ll+"+"+zl+"(?="+[kc,Ba,"$"].join("|")+")",gs+"+"+Tc+"(?="+[kc,Ba+$l,"$"].join("|")+")",Ba+"?"+$l+"+"+zl,Ba+"+"+Tc,ys,mr,Mu,Ua].join("|"),"g"),qa=RegExp("["+Fl+sr+Sr+jr+"]"),Ac=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ul=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ou=-1,Bn={};Bn[Ge]=Bn[ye]=Bn[Ne]=Bn[Me]=Bn[Fe]=Bn[ve]=Bn[ke]=Bn[Ee]=Bn[Ve]=!0,Bn[$e]=Bn[he]=Bn[ue]=Bn[me]=Bn[De]=Bn[de]=Bn[He]=Bn[pe]=Bn[Pe]=Bn[Ye]=Bn[ut]=Bn[ze]=Bn[dt]=Bn[Ze]=Bn[fe]=!1;var $n={};$n[$e]=$n[he]=$n[ue]=$n[De]=$n[me]=$n[de]=$n[Ge]=$n[ye]=$n[Ne]=$n[Me]=$n[Fe]=$n[Pe]=$n[Ye]=$n[ut]=$n[ze]=$n[dt]=$n[Ze]=$n[ct]=$n[ve]=$n[ke]=$n[Ee]=$n[Ve]=!0,$n[He]=$n[pe]=$n[fe]=!1;var Lu={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},cr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},xs={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ql={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Vo=parseFloat,uh=parseInt,eo=typeof ju=="object"&&ju&&ju.Object===Object&&ju,to=typeof self=="object"&&self&&self.Object===Object&&self,Ni=eo||to||Function("return this")(),Va=n&&!n.nodeType&&n,Ha=Va&&!0&&e&&!e.nodeType&&e,Dc=Ha&&Ha.exports===Va,Vl=Dc&&eo.process,_r=function(){try{var Ae=Ha&&Ha.require&&Ha.require("util").types;return Ae||Vl&&Vl.binding&&Vl.binding("util")}catch{}}(),no=_r&&_r.isArrayBuffer,dh=_r&&_r.isDate,Pc=_r&&_r.isMap,Ic=_r&&_r.isRegExp,Fu=_r&&_r.isSet,Un=_r&&_r.isTypedArray;function Ji(Ae,Xe,Je){switch(Je.length){case 0:return Ae.call(Xe);case 1:return Ae.call(Xe,Je[0]);case 2:return Ae.call(Xe,Je[0],Je[1]);case 3:return Ae.call(Xe,Je[0],Je[1],Je[2])}return Ae.apply(Xe,Je)}function Mc(Ae,Xe,Je,_t){for(var zt=-1,wn=Ae==null?0:Ae.length;++zt<wn;){var Si=Ae[zt];Xe(_t,Si,Je(Si),Ae)}return _t}function gr(Ae,Xe){for(var Je=-1,_t=Ae==null?0:Ae.length;++Je<_t&&Xe(Ae[Je],Je,Ae)!==!1;);return Ae}function Hl(Ae,Xe){for(var Je=Ae==null?0:Ae.length;Je--&&Xe(Ae[Je],Je,Ae)!==!1;);return Ae}function Ho(Ae,Xe){for(var Je=-1,_t=Ae==null?0:Ae.length;++Je<_t;)if(!Xe(Ae[Je],Je,Ae))return!1;return!0}function ba(Ae,Xe){for(var Je=-1,_t=Ae==null?0:Ae.length,zt=0,wn=[];++Je<_t;){var Si=Ae[Je];Xe(Si,Je,Ae)&&(wn[zt++]=Si)}return wn}function Gl(Ae,Xe){var Je=Ae==null?0:Ae.length;return!!Je&&io(Ae,Xe,0)>-1}function bs(Ae,Xe,Je){for(var _t=-1,zt=Ae==null?0:Ae.length;++_t<zt;)if(Je(Xe,Ae[_t]))return!0;return!1}function ri(Ae,Xe){for(var Je=-1,_t=Ae==null?0:Ae.length,zt=Array(_t);++Je<_t;)zt[Je]=Xe(Ae[Je],Je,Ae);return zt}function sa(Ae,Xe){for(var Je=-1,_t=Xe.length,zt=Ae.length;++Je<_t;)Ae[zt+Je]=Xe[Je];return Ae}function Go(Ae,Xe,Je,_t){var zt=-1,wn=Ae==null?0:Ae.length;for(_t&&wn&&(Je=Ae[++zt]);++zt<wn;)Je=Xe(Je,Ae[zt],zt,Ae);return Je}function Yo(Ae,Xe,Je,_t){var zt=Ae==null?0:Ae.length;for(_t&&zt&&(Je=Ae[--zt]);zt--;)Je=Xe(Je,Ae[zt],zt,Ae);return Je}function Rc(Ae,Xe){for(var Je=-1,_t=Ae==null?0:Ae.length;++Je<_t;)if(Xe(Ae[Je],Je,Ae))return!0;return!1}var vs=Wo("length");function Oc(Ae){return Ae.split("")}function gp(Ae){return Ae.match(Xt)||[]}function hh(Ae,Xe,Je){var _t;return Je(Ae,function(zt,wn,Si){if(Xe(zt,wn,Si))return _t=wn,!1}),_t}function ws(Ae,Xe,Je,_t){for(var zt=Ae.length,wn=Je+(_t?1:-1);_t?wn--:++wn<zt;)if(Xe(Ae[wn],wn,Ae))return wn;return-1}function io(Ae,Xe,Je){return Xe===Xe?vh(Ae,Xe,Je):ws(Ae,Ga,Je)}function Ns(Ae,Xe,Je,_t){for(var zt=Je-1,wn=Ae.length;++zt<wn;)if(_t(Ae[zt],Xe))return zt;return-1}function Ga(Ae){return Ae!==Ae}function Lc(Ae,Xe){var Je=Ae==null?0:Ae.length;return Je?va(Ae,Xe)/Je:A}function Wo(Ae){return function(Xe){return Xe==null?t:Xe[Ae]}}function ro(Ae){return function(Xe){return Ae==null?t:Ae[Xe]}}function Qo(Ae,Xe,Je,_t,zt){return zt(Ae,function(wn,Si,jn){Je=_t?(_t=!1,wn):Xe(Je,wn,Si,jn)}),Je}function $u(Ae,Xe){var Je=Ae.length;for(Ae.sort(Xe);Je--;)Ae[Je]=Ae[Je].value;return Ae}function va(Ae,Xe){for(var Je,_t=-1,zt=Ae.length;++_t<zt;){var wn=Xe(Ae[_t]);wn!==t&&(Je=Je===t?wn:Je+wn)}return Je}function Ss(Ae,Xe){for(var Je=-1,_t=Array(Ae);++Je<Ae;)_t[Je]=Xe(Je);return _t}function fh(Ae,Xe){return ri(Xe,function(Je){return[Je,Ae[Je]]})}function ao(Ae){return Ae&&Ae.slice(0,Uu(Ae)+1).replace(ii,"")}function Ri(Ae){return function(Xe){return Ae(Xe)}}function js(Ae,Xe){return ri(Xe,function(Je){return Ae[Je]})}function _s(Ae,Xe){return Ae.has(Xe)}function so(Ae,Xe){for(var Je=-1,_t=Ae.length;++Je<_t&&io(Xe,Ae[Je],0)>-1;);return Je}function Ya(Ae,Xe){for(var Je=Ae.length;Je--&&io(Xe,Ae[Je],0)>-1;);return Je}function ph(Ae,Xe){for(var Je=Ae.length,_t=0;Je--;)Ae[Je]===Xe&&++_t;return _t}var Fc=ro(Lu),mh=ro(cr);function gh(Ae){return"\\"+ql[Ae]}function zu(Ae,Xe){return Ae==null?t:Ae[Xe]}function Cs(Ae){return qa.test(Ae)}function yh(Ae){return Ac.test(Ae)}function xh(Ae){for(var Xe,Je=[];!(Xe=Ae.next()).done;)Je.push(Xe.value);return Je}function $c(Ae){var Xe=-1,Je=Array(Ae.size);return Ae.forEach(function(_t,zt){Je[++Xe]=[zt,_t]}),Je}function bh(Ae,Xe){return function(Je){return Ae(Xe(Je))}}function ks(Ae,Xe){for(var Je=-1,_t=Ae.length,zt=0,wn=[];++Je<_t;){var Si=Ae[Je];(Si===Xe||Si===f)&&(Ae[Je]=f,wn[zt++]=Je)}return wn}function Jo(Ae){var Xe=-1,Je=Array(Ae.size);return Ae.forEach(function(_t){Je[++Xe]=_t}),Je}function Bu(Ae){var Xe=-1,Je=Array(Ae.size);return Ae.forEach(function(_t){Je[++Xe]=[_t,_t]}),Je}function vh(Ae,Xe,Je){for(var _t=Je-1,zt=Ae.length;++_t<zt;)if(Ae[_t]===Xe)return _t;return-1}function Cr(Ae,Xe,Je){for(var _t=Je+1;_t--;)if(Ae[_t]===Xe)return _t;return _t}function kr(Ae){return Cs(Ae)?Nh(Ae):vs(Ae)}function zr(Ae){return Cs(Ae)?qu(Ae):Oc(Ae)}function Uu(Ae){for(var Xe=Ae.length;Xe--&&Ie.test(Ae.charAt(Xe)););return Xe}var wh=ro(xs);function Nh(Ae){for(var Xe=Uo.lastIndex=0;Uo.test(Ae);)++Xe;return Xe}function qu(Ae){return Ae.match(Uo)||[]}function Ts(Ae){return Ae.match(qo)||[]}var Tr=function Ae(Xe){Xe=Xe==null?Ni:Ki.defaults(Ni.Object(),Xe,Ki.pick(Ni,Ul));var Je=Xe.Array,_t=Xe.Date,zt=Xe.Error,wn=Xe.Function,Si=Xe.Math,jn=Xe.Object,zc=Xe.RegExp,Vu=Xe.String,Er=Xe.TypeError,Bc=Je.prototype,yp=wn.prototype,Ko=jn.prototype,Yl=Xe["__core-js_shared__"],Wl=yp.toString,Rn=Ko.hasOwnProperty,oa=0,Hu=function(){var m=/[^.]+$/.exec(Yl&&Yl.keys&&Yl.keys.IE_PROTO||"");return m?"Symbol(src)_1."+m:""}(),_i=Ko.toString,Br=Wl.call(jn),Xo=Ni._,Gu=zc("^"+Wl.call(Rn).replace(mn,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oo=Dc?Xe.Buffer:t,Ar=Xe.Symbol,Zo=Xe.Uint8Array,lo=oo?oo.allocUnsafe:t,Ql=bh(jn.getPrototypeOf,jn),Dr=jn.create,co=Ko.propertyIsEnumerable,Jl=Bc.splice,yr=Ar?Ar.isConcatSpreadable:t,Es=Ar?Ar.iterator:t,Xi=Ar?Ar.toStringTag:t,el=function(){try{var m=ul(jn,"defineProperty");return m({},"",{}),m}catch{}}(),Uc=Xe.clearTimeout!==Ni.clearTimeout&&Xe.clearTimeout,uo=_t&&_t.now!==Ni.Date.now&&_t.now,Yu=Xe.setTimeout!==Ni.setTimeout&&Xe.setTimeout,tl=Si.ceil,Wa=Si.floor,Qa=jn.getOwnPropertySymbols,Kl=oo?oo.isBuffer:t,nl=Xe.isFinite,Pr=Bc.join,G=bh(jn.keys,jn),le=Si.max,se=Si.min,_e=_t.now,it=Xe.parseInt,St=Si.random,Pt=Bc.reverse,Et=ul(Xe,"DataView"),_n=ul(Xe,"Map"),Gn=ul(Xe,"Promise"),an=ul(Xe,"Set"),Ur=ul(Xe,"WeakMap"),Oi=ul(jn,"create"),qc=Ur&&new Ur,wa={},Tg=vo(Et),Eg=vo(_n),Wu=vo(Gn),Qu=vo(an),Ag=vo(Ur),il=Ar?Ar.prototype:t,Xl=il?il.valueOf:t,rl=il?il.toString:t;function X(m){if(ji(m)&&!Jt(m)&&!(m instanceof gn)){if(m instanceof qr)return m;if(Rn.call(m,"__wrapped__"))return qi(m)}return new qr(m)}var la=function(){function m(){}return function(y){if(!xi(y))return{};if(Dr)return Dr(y);m.prototype=y;var k=new m;return m.prototype=t,k}}();function Na(){}function qr(m,y){this.__wrapped__=m,this.__actions__=[],this.__chain__=!!y,this.__index__=0,this.__values__=t}X.templateSettings={escape:Nt,evaluate:Lt,interpolate:pn,variable:"",imports:{_:X}},X.prototype=Na.prototype,X.prototype.constructor=X,qr.prototype=la(Na.prototype),qr.prototype.constructor=qr;function gn(m){this.__wrapped__=m,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=te,this.__views__=[]}function Ju(){var m=new gn(this.__wrapped__);return m.__actions__=Ui(this.__actions__),m.__dir__=this.__dir__,m.__filtered__=this.__filtered__,m.__iteratees__=Ui(this.__iteratees__),m.__takeCount__=this.__takeCount__,m.__views__=Ui(this.__views__),m}function Sh(){if(this.__filtered__){var m=new gn(this);m.__dir__=-1,m.__filtered__=!0}else m=this.clone(),m.__dir__*=-1;return m}function Zl(){var m=this.__wrapped__.value(),y=this.__dir__,k=Jt(m),R=y<0,Y=k?m.length:0,oe=cy(0,Y,this.__views__),be=oe.start,Ce=oe.end,Oe=Ce-be,st=R?Ce:be-1,lt=this.__iteratees__,ht=lt.length,kt=0,Rt=se(Oe,this.__takeCount__);if(!k||!R&&Y==Oe&&Rt==Oe)return Qg(m,this.__actions__);var Yt=[];e:for(;Oe--&&kt<Rt;){st+=y;for(var xn=-1,Wt=m[st];++xn<ht;){var kn=lt[xn],Ln=kn.iteratee,ns=kn.type,ma=Ln(Wt);if(ns==ae)Wt=ma;else if(!ma){if(ns==ie)continue e;break e}}Yt[kt++]=Wt}return Yt}gn.prototype=la(Na.prototype),gn.prototype.constructor=gn;function Ci(m){var y=-1,k=m==null?0:m.length;for(this.clear();++y<k;){var R=m[y];this.set(R[0],R[1])}}function jh(){this.__data__=Oi?Oi(null):{},this.size=0}function Dg(m){var y=this.has(m)&&delete this.__data__[m];return this.size-=y?1:0,y}function tv(m){var y=this.__data__;if(Oi){var k=y[m];return k===d?t:k}return Rn.call(y,m)?y[m]:t}function nv(m){var y=this.__data__;return Oi?y[m]!==t:Rn.call(y,m)}function iv(m,y){var k=this.__data__;return this.size+=this.has(m)?0:1,k[m]=Oi&&y===t?d:y,this}Ci.prototype.clear=jh,Ci.prototype.delete=Dg,Ci.prototype.get=tv,Ci.prototype.has=nv,Ci.prototype.set=iv;function ai(m){var y=-1,k=m==null?0:m.length;for(this.clear();++y<k;){var R=m[y];this.set(R[0],R[1])}}function xp(){this.__data__=[],this.size=0}function Ku(m){var y=this.__data__,k=Gc(y,m);if(k<0)return!1;var R=y.length-1;return k==R?y.pop():Jl.call(y,k,1),--this.size,!0}function Xu(m){var y=this.__data__,k=Gc(y,m);return k<0?t:y[k][1]}function bp(m){return Gc(this.__data__,m)>-1}function Vc(m,y){var k=this.__data__,R=Gc(k,m);return R<0?(++this.size,k.push([m,y])):k[R][1]=y,this}ai.prototype.clear=xp,ai.prototype.delete=Ku,ai.prototype.get=Xu,ai.prototype.has=bp,ai.prototype.set=Vc;function Vr(m){var y=-1,k=m==null?0:m.length;for(this.clear();++y<k;){var R=m[y];this.set(R[0],R[1])}}function rv(){this.size=0,this.__data__={hash:new Ci,map:new(_n||ai),string:new Ci}}function Pg(m){var y=Xc(this,m).delete(m);return this.size-=y?1:0,y}function av(m){return Xc(this,m).get(m)}function Ig(m){return Xc(this,m).has(m)}function ec(m,y){var k=Xc(this,m),R=k.size;return k.set(m,y),this.size+=k.size==R?0:1,this}Vr.prototype.clear=rv,Vr.prototype.delete=Pg,Vr.prototype.get=av,Vr.prototype.has=Ig,Vr.prototype.set=ec;function ho(m){var y=-1,k=m==null?0:m.length;for(this.__data__=new Vr;++y<k;)this.add(m[y])}function _h(m){return this.__data__.set(m,d),this}function Mg(m){return this.__data__.has(m)}ho.prototype.add=ho.prototype.push=_h,ho.prototype.has=Mg;function Ir(m){var y=this.__data__=new ai(m);this.size=y.size}function Rg(){this.__data__=new ai,this.size=0}function Ch(m){var y=this.__data__,k=y.delete(m);return this.size=y.size,k}function vp(m){return this.__data__.get(m)}function Og(m){return this.__data__.has(m)}function kh(m,y){var k=this.__data__;if(k instanceof ai){var R=k.__data__;if(!_n||R.length<a-1)return R.push([m,y]),this.size=++k.size,this;k=this.__data__=new Vr(R)}return k.set(m,y),this.size=k.size,this}Ir.prototype.clear=Rg,Ir.prototype.delete=Ch,Ir.prototype.get=vp,Ir.prototype.has=Og,Ir.prototype.set=kh;function wp(m,y){var k=Jt(m),R=!k&&jo(m),Y=!k&&!R&&vl(m),oe=!k&&!R&&!Y&&hu(m),be=k||R||Y||oe,Ce=be?Ss(m.length,Vu):[],Oe=Ce.length;for(var st in m)(y||Rn.call(m,st))&&!(be&&(st=="length"||Y&&(st=="offset"||st=="parent")||oe&&(st=="buffer"||st=="byteLength"||st=="byteOffset")||Za(st,Oe)))&&Ce.push(st);return Ce}function Hc(m){var y=m.length;return y?m[Lh(0,y-1)]:t}function Lg(m,y){return _d(Ui(m),Ka(y,0,m.length))}function Fg(m){return _d(Ui(m))}function As(m,y,k){(k!==t&&!Kr(m[y],k)||k===t&&!(y in m))&&Ja(m,y,k)}function tc(m,y,k){var R=m[y];(!(Rn.call(m,y)&&Kr(R,k))||k===t&&!(y in m))&&Ja(m,y,k)}function Gc(m,y){for(var k=m.length;k--;)if(Kr(m[k][0],y))return k;return-1}function al(m,y,k,R){return po(m,function(Y,oe,be){y(R,Y,k(Y),be)}),R}function fo(m,y){return m&&Yr(y,Gi(y),m)}function Zu(m,y){return m&&Yr(y,tr(y),m)}function Ja(m,y,k){y=="__proto__"&&el?el(m,y,{configurable:!0,enumerable:!0,value:k,writable:!0}):m[y]=k}function ed(m,y){for(var k=-1,R=y.length,Y=Je(R),oe=m==null;++k<R;)Y[k]=oe?t:$d(m,y[k]);return Y}function Ka(m,y,k){return m===m&&(k!==t&&(m=m<=k?m:k),y!==t&&(m=m>=y?m:y)),m}function xr(m,y,k,R,Y,oe){var be,Ce=y&g,Oe=y&b,st=y&v;if(k&&(be=Y?k(m,R,Y,oe):k(m)),be!==t)return be;if(!xi(m))return m;var lt=Jt(m);if(lt){if(be=Yp(m),!Ce)return Ui(m,be)}else{var ht=er(m),kt=ht==pe||ht==ne;if(vl(m))return $p(m,Ce);if(ht==ut||ht==$e||kt&&!Y){if(be=Oe||kt?{}:Wp(m),!Ce)return Oe?fd(m,Zu(be,m)):qh(m,fo(be,m))}else{if(!$n[ht])return Y?m:{};be=Qp(m,ht,Ce)}}oe||(oe=new Ir);var Rt=oe.get(m);if(Rt)return Rt;oe.set(m,be),tx(m)?m.forEach(function(Wt){be.add(xr(Wt,y,k,Wt,m,oe))}):mf(m)&&m.forEach(function(Wt,kn){be.set(kn,xr(Wt,y,k,kn,m,oe))});var Yt=st?Oe?Yh:Gh:Oe?tr:Gi,xn=lt?t:Yt(m);return gr(xn||m,function(Wt,kn){xn&&(kn=Wt,Wt=m[kn]),tc(be,kn,xr(Wt,y,k,kn,m,oe))}),be}function $g(m){var y=Gi(m);return function(k){return Np(k,m,y)}}function Np(m,y,k){var R=k.length;if(m==null)return!R;for(m=jn(m);R--;){var Y=k[R],oe=y[Y],be=m[Y];if(be===t&&!(Y in m)||!oe(be))return!1}return!0}function nc(m,y,k){if(typeof m!="function")throw new Er(l);return eu(function(){m.apply(t,k)},y)}function sl(m,y,k,R){var Y=-1,oe=Gl,be=!0,Ce=m.length,Oe=[],st=y.length;if(!Ce)return Oe;k&&(y=ri(y,Ri(k))),R?(oe=bs,be=!1):y.length>=a&&(oe=_s,be=!1,y=new ho(y));e:for(;++Y<Ce;){var lt=m[Y],ht=k==null?lt:k(lt);if(lt=R||lt!==0?lt:0,be&&ht===ht){for(var kt=st;kt--;)if(y[kt]===ht)continue e;Oe.push(lt)}else oe(y,ht,R)||Oe.push(lt)}return Oe}var po=qp(br),Th=qp(Wc,!0);function Sp(m,y){var k=!0;return po(m,function(R,Y,oe){return k=!!y(R,Y,oe),k}),k}function Xa(m,y,k){for(var R=-1,Y=m.length;++R<Y;){var oe=m[R],be=y(oe);if(be!=null&&(Ce===t?be===be&&!Or(be):k(be,Ce)))var Ce=be,Oe=oe}return Oe}function cn(m,y,k,R){var Y=m.length;for(k=nn(k),k<0&&(k=-k>Y?0:Y+k),R=R===t||R>Y?Y:nn(R),R<0&&(R+=Y),R=k>R?0:$s(R);k<R;)m[k++]=y;return m}function Yn(m,y){var k=[];return po(m,function(R,Y,oe){y(R,Y,oe)&&k.push(R)}),k}function Nn(m,y,k,R,Y){var oe=-1,be=m.length;for(k||(k=xo),Y||(Y=[]);++oe<be;){var Ce=m[oe];y>0&&k(Ce)?y>1?Nn(Ce,y-1,k,R,Y):sa(Y,Ce):R||(Y[Y.length]=Ce)}return Y}var Yc=cc(),ic=cc(!0);function br(m,y){return m&&Yc(m,y,Gi)}function Wc(m,y){return m&&ic(m,y,Gi)}function ol(m,y){return ba(y,function(k){return es(m[k])})}function Sa(m,y){y=go(y,m);for(var k=0,R=y.length;m!=null&&k<R;)m=m[Vn(y[k++])];return k&&k==R?m:t}function zg(m,y,k){var R=y(m);return Jt(m)?R:sa(R,k(m))}function Cn(m){return m==null?m===t?ft:rt:Xi&&Xi in jn(m)?ly(m):py(m)}function td(m,y){return m>y}function jp(m,y){return m!=null&&Rn.call(m,y)}function Bg(m,y){return m!=null&&y in jn(m)}function Ug(m,y,k){return m>=se(y,k)&&m<le(y,k)}function _p(m,y,k){for(var R=k?bs:Gl,Y=m[0].length,oe=m.length,be=oe,Ce=Je(oe),Oe=1/0,st=[];be--;){var lt=m[be];be&&y&&(lt=ri(lt,Ri(y))),Oe=se(lt.length,Oe),Ce[be]=!k&&(y||Y>=120&&lt.length>=120)?new ho(be&&lt):t}lt=m[0];var ht=-1,kt=Ce[0];e:for(;++ht<Y&&st.length<Oe;){var Rt=lt[ht],Yt=y?y(Rt):Rt;if(Rt=k||Rt!==0?Rt:0,!(kt?_s(kt,Yt):R(st,Yt,k))){for(be=oe;--be;){var xn=Ce[be];if(!(xn?_s(xn,Yt):R(m[be],Yt,k)))continue e}kt&&kt.push(Yt),st.push(Rt)}}return st}function Cp(m,y,k,R){return br(m,function(Y,oe,be){y(R,k(Y),oe,be)}),R}function rc(m,y,k){y=go(y,m),m=Zc(m,y);var R=m==null?m:m[Vn(vr(y))];return R==null?t:Ji(R,m,k)}function Eh(m){return ji(m)&&Cn(m)==$e}function Hr(m){return ji(m)&&Cn(m)==ue}function Fi(m){return ji(m)&&Cn(m)==de}function ac(m,y,k,R,Y){return m===y?!0:m==null||y==null||!ji(m)&&!ji(y)?m!==m&&y!==y:nd(m,y,k,R,ac,Y)}function nd(m,y,k,R,Y,oe){var be=Jt(m),Ce=Jt(y),Oe=be?he:er(m),st=Ce?he:er(y);Oe=Oe==$e?ut:Oe,st=st==$e?ut:st;var lt=Oe==ut,ht=st==ut,kt=Oe==st;if(kt&&vl(m)){if(!vl(y))return!1;be=!0,lt=!1}if(kt&&!lt)return oe||(oe=new Ir),be||hu(m)?sy(m,y,k,R,Y,oe):oy(m,y,Oe,k,R,Y,oe);if(!(k&S)){var Rt=lt&&Rn.call(m,"__wrapped__"),Yt=ht&&Rn.call(y,"__wrapped__");if(Rt||Yt){var xn=Rt?m.value():m,Wt=Yt?y.value():y;return oe||(oe=new Ir),Y(xn,Wt,k,R,oe)}}return kt?(oe||(oe=new Ir),Zi(m,y,k,R,Y,oe)):!1}function Ah(m){return ji(m)&&er(m)==Pe}function id(m,y,k,R){var Y=k.length,oe=Y,be=!R;if(m==null)return!oe;for(m=jn(m);Y--;){var Ce=k[Y];if(be&&Ce[2]?Ce[1]!==m[Ce[0]]:!(Ce[0]in m))return!1}for(;++Y<oe;){Ce=k[Y];var Oe=Ce[0],st=m[Oe],lt=Ce[1];if(be&&Ce[2]){if(st===t&&!(Oe in m))return!1}else{var ht=new Ir;if(R)var kt=R(st,lt,Oe,m,y,ht);if(!(kt===t?ac(lt,st,S|T,R,ht):kt))return!1}}return!0}function Ds(m){if(!xi(m)||Zh(m))return!1;var y=es(m)?Gu:Li;return y.test(vo(m))}function Dh(m){return ji(m)&&Cn(m)==ze}function kp(m){return ji(m)&&er(m)==dt}function Tp(m){return ji(m)&&pc(m.length)&&!!Bn[Cn(m)]}function Ep(m){return typeof m=="function"?m:m==null?qe:typeof m=="object"?Jt(m)?Mh(m[0],m[1]):Dp(m):On(m)}function Ph(m){if(!si(m))return G(m);var y=[];for(var k in jn(m))Rn.call(m,k)&&k!="constructor"&&y.push(k);return y}function qg(m){if(!xi(m))return dl(m);var y=si(m),k=[];for(var R in m)R=="constructor"&&(y||!Rn.call(m,R))||k.push(R);return k}function Ih(m,y){return m<y}function Ap(m,y){var k=-1,R=Vi(m)?Je(m.length):[];return po(m,function(Y,oe,be){R[++k]=y(Y,oe,be)}),R}function Dp(m){var y=Qh(m);return y.length==1&&y[0][2]?hy(y[0][0],y[0][1]):function(k){return k===m||id(k,m,y)}}function Mh(m,y){return Kh(m)&&dy(y)?hy(Vn(m),y):function(k){var R=$d(k,m);return R===t&&R===y?gu(k,m):ac(y,R,S|T)}}function rd(m,y,k,R,Y){m!==y&&Yc(y,function(oe,be){if(Y||(Y=new Ir),xi(oe))sv(m,y,be,k,rd,R,Y);else{var Ce=R?R(ef(m,be),oe,be+"",m,y,Y):t;Ce===t&&(Ce=oe),As(m,be,Ce)}},tr)}function sv(m,y,k,R,Y,oe,be){var Ce=ef(m,k),Oe=ef(y,k),st=be.get(Oe);if(st){As(m,k,st);return}var lt=oe?oe(Ce,Oe,k+"",m,y,be):t,ht=lt===t;if(ht){var kt=Jt(Oe),Rt=!kt&&vl(Oe),Yt=!kt&&!Rt&&hu(Oe);lt=Oe,kt||Rt||Yt?Jt(Ce)?lt=Ce:Ei(Ce)?lt=Ui(Ce):Rt?(ht=!1,lt=$p(Oe,!0)):Yt?(ht=!1,lt=Bp(Oe,!0)):lt=[]:ka(Oe)||jo(Oe)?(lt=Ce,jo(Ce)?lt=rx(Ce):(!xi(Ce)||es(Ce))&&(lt=Wp(Oe))):ht=!1}ht&&(be.set(Oe,lt),Y(lt,Oe,R,oe,be),be.delete(Oe)),As(m,k,lt)}function Pp(m,y){var k=m.length;if(k)return y+=y<0?k:0,Za(y,k)?m[y]:t}function Ip(m,y,k){y.length?y=ri(y,function(oe){return Jt(oe)?function(be){return Sa(be,oe.length===1?oe[0]:oe)}:oe}):y=[qe];var R=-1;y=ri(y,Ri($t()));var Y=Ap(m,function(oe,be,Ce){var Oe=ri(y,function(st){return st(oe)});return{criteria:Oe,index:++R,value:oe}});return $u(Y,function(oe,be){return Zg(oe,be,k)})}function Vg(m,y){return Rh(m,y,function(k,R){return gu(m,R)})}function Rh(m,y,k){for(var R=-1,Y=y.length,oe={};++R<Y;){var be=y[R],Ce=Sa(m,be);k(Ce,be)&&Jc(oe,go(be,m),Ce)}return oe}function Hg(m){return function(y){return Sa(y,m)}}function Oh(m,y,k,R){var Y=R?Ns:io,oe=-1,be=y.length,Ce=m;for(m===y&&(y=Ui(y)),k&&(Ce=ri(m,Ri(k)));++oe<be;)for(var Oe=0,st=y[oe],lt=k?k(st):st;(Oe=Y(Ce,lt,Oe,R))>-1;)Ce!==m&&Jl.call(Ce,Oe,1),Jl.call(m,Oe,1);return m}function Mp(m,y){for(var k=m?y.length:0,R=k-1;k--;){var Y=y[k];if(k==R||Y!==oe){var oe=Y;Za(Y)?Jl.call(m,Y,1):ld(m,Y)}}return m}function Lh(m,y){return m+Wa(St()*(y-m+1))}function Gg(m,y,k,R){for(var Y=-1,oe=le(tl((y-m)/(k||1)),0),be=Je(oe);oe--;)be[R?oe:++Y]=m,m+=k;return be}function Rp(m,y){var k="";if(!m||y<1||y>W)return k;do y%2&&(k+=m),y=Wa(y/2),y&&(m+=m);while(y);return k}function sn(m,y){return Sd(Jp(m,y,qe),m+"")}function Qc(m){return Hc(xu(m))}function Fh(m,y){var k=xu(m);return _d(k,Ka(y,0,k.length))}function Jc(m,y,k,R){if(!xi(m))return m;y=go(y,m);for(var Y=-1,oe=y.length,be=oe-1,Ce=m;Ce!=null&&++Y<oe;){var Oe=Vn(y[Y]),st=k;if(Oe==="__proto__"||Oe==="constructor"||Oe==="prototype")return m;if(Y!=be){var lt=Ce[Oe];st=R?R(lt,Oe,Ce):t,st===t&&(st=xi(lt)?lt:Za(y[Y+1])?[]:{})}tc(Ce,Oe,st),Ce=Ce[Oe]}return m}var ad=qc?function(m,y){return qc.set(m,y),m}:qe,sd=el?function(m,y){return el(m,"toString",{configurable:!0,enumerable:!1,value:Ue(y),writable:!0})}:qe;function Yg(m){return _d(xu(m))}function ca(m,y,k){var R=-1,Y=m.length;y<0&&(y=-y>Y?0:Y+y),k=k>Y?Y:k,k<0&&(k+=Y),Y=y>k?0:k-y>>>0,y>>>=0;for(var oe=Je(Y);++R<Y;)oe[R]=m[R+y];return oe}function Wg(m,y){var k;return po(m,function(R,Y,oe){return k=y(R,Y,oe),!k}),!!k}function od(m,y,k){var R=0,Y=m==null?R:m.length;if(typeof y=="number"&&y===y&&Y<=M){for(;R<Y;){var oe=R+Y>>>1,be=m[oe];be!==null&&!Or(be)&&(k?be<=y:be<y)?R=oe+1:Y=oe}return Y}return $h(m,y,qe,k)}function $h(m,y,k,R){var Y=0,oe=m==null?0:m.length;if(oe===0)return 0;y=k(y);for(var be=y!==y,Ce=y===null,Oe=Or(y),st=y===t;Y<oe;){var lt=Wa((Y+oe)/2),ht=k(m[lt]),kt=ht!==t,Rt=ht===null,Yt=ht===ht,xn=Or(ht);if(be)var Wt=R||Yt;else st?Wt=Yt&&(R||kt):Ce?Wt=Yt&&kt&&(R||!Rt):Oe?Wt=Yt&&kt&&!Rt&&(R||!xn):Rt||xn?Wt=!1:Wt=R?ht<=y:ht<y;Wt?Y=lt+1:oe=lt}return se(oe,xe)}function Op(m,y){for(var k=-1,R=m.length,Y=0,oe=[];++k<R;){var be=m[k],Ce=y?y(be):be;if(!k||!Kr(Ce,Oe)){var Oe=Ce;oe[Y++]=be===0?0:be}}return oe}function zh(m){return typeof m=="number"?m:Or(m)?A:+m}function Gr(m){if(typeof m=="string")return m;if(Jt(m))return ri(m,Gr)+"";if(Or(m))return rl?rl.call(m):"";var y=m+"";return y=="0"&&1/m==-1/0?"-0":y}function mo(m,y,k){var R=-1,Y=Gl,oe=m.length,be=!0,Ce=[],Oe=Ce;if(k)be=!1,Y=bs;else if(oe>=a){var st=y?null:ry(m);if(st)return Jo(st);be=!1,Y=_s,Oe=new ho}else Oe=y?[]:Ce;e:for(;++R<oe;){var lt=m[R],ht=y?y(lt):lt;if(lt=k||lt!==0?lt:0,be&&ht===ht){for(var kt=Oe.length;kt--;)if(Oe[kt]===ht)continue e;y&&Oe.push(ht),Ce.push(lt)}else Y(Oe,ht,k)||(Oe!==Ce&&Oe.push(ht),Ce.push(lt))}return Ce}function ld(m,y){return y=go(y,m),m=Zc(m,y),m==null||delete m[Vn(vr(y))]}function Lp(m,y,k,R){return Jc(m,y,k(Sa(m,y)),R)}function cd(m,y,k,R){for(var Y=m.length,oe=R?Y:-1;(R?oe--:++oe<Y)&&y(m[oe],oe,m););return k?ca(m,R?0:oe,R?oe+1:Y):ca(m,R?oe+1:0,R?Y:oe)}function Qg(m,y){var k=m;return k instanceof gn&&(k=k.value()),Go(y,function(R,Y){return Y.func.apply(Y.thisArg,sa([R],Y.args))},k)}function ud(m,y,k){var R=m.length;if(R<2)return R?mo(m[0]):[];for(var Y=-1,oe=Je(R);++Y<R;)for(var be=m[Y],Ce=-1;++Ce<R;)Ce!=Y&&(oe[Y]=sl(oe[Y]||be,m[Ce],y,k));return mo(Nn(oe,1),y,k)}function Fp(m,y,k){for(var R=-1,Y=m.length,oe=y.length,be={};++R<Y;){var Ce=R<oe?y[R]:t;k(be,m[R],Ce)}return be}function Bh(m){return Ei(m)?m:[]}function dd(m){return typeof m=="function"?m:qe}function go(m,y){return Jt(m)?m:Kh(m,y)?[m]:Rs(qn(m))}var Jg=sn;function ll(m,y,k){var R=m.length;return k=k===t?R:k,!y&&k>=R?m:ca(m,y,k)}var Kg=Uc||function(m){return Ni.clearTimeout(m)};function $p(m,y){if(y)return m.slice();var k=m.length,R=lo?lo(k):new m.constructor(k);return m.copy(R),R}function sc(m){var y=new m.constructor(m.byteLength);return new Zo(y).set(new Zo(m)),y}function zp(m,y){var k=y?sc(m.buffer):m.buffer;return new m.constructor(k,m.byteOffset,m.byteLength)}function Uh(m){var y=new m.constructor(m.source,Mi.exec(m));return y.lastIndex=m.lastIndex,y}function Xg(m){return Xl?jn(Xl.call(m)):{}}function Bp(m,y){var k=y?sc(m.buffer):m.buffer;return new m.constructor(k,m.byteOffset,m.length)}function hd(m,y){if(m!==y){var k=m!==t,R=m===null,Y=m===m,oe=Or(m),be=y!==t,Ce=y===null,Oe=y===y,st=Or(y);if(!Ce&&!st&&!oe&&m>y||oe&&be&&Oe&&!Ce&&!st||R&&be&&Oe||!k&&Oe||!Y)return 1;if(!R&&!oe&&!st&&m<y||st&&k&&Y&&!R&&!oe||Ce&&k&&Y||!be&&Y||!Oe)return-1}return 0}function Zg(m,y,k){for(var R=-1,Y=m.criteria,oe=y.criteria,be=Y.length,Ce=k.length;++R<be;){var Oe=hd(Y[R],oe[R]);if(Oe){if(R>=Ce)return Oe;var st=k[R];return Oe*(st=="desc"?-1:1)}}return m.index-y.index}function Up(m,y,k,R){for(var Y=-1,oe=m.length,be=k.length,Ce=-1,Oe=y.length,st=le(oe-be,0),lt=Je(Oe+st),ht=!R;++Ce<Oe;)lt[Ce]=y[Ce];for(;++Y<be;)(ht||Y<oe)&&(lt[k[Y]]=m[Y]);for(;st--;)lt[Ce++]=m[Y++];return lt}function ey(m,y,k,R){for(var Y=-1,oe=m.length,be=-1,Ce=k.length,Oe=-1,st=y.length,lt=le(oe-Ce,0),ht=Je(lt+st),kt=!R;++Y<lt;)ht[Y]=m[Y];for(var Rt=Y;++Oe<st;)ht[Rt+Oe]=y[Oe];for(;++be<Ce;)(kt||Y<oe)&&(ht[Rt+k[be]]=m[Y++]);return ht}function Ui(m,y){var k=-1,R=m.length;for(y||(y=Je(R));++k<R;)y[k]=m[k];return y}function Yr(m,y,k,R){var Y=!k;k||(k={});for(var oe=-1,be=y.length;++oe<be;){var Ce=y[oe],Oe=R?R(k[Ce],m[Ce],Ce,k,m):t;Oe===t&&(Oe=m[Ce]),Y?Ja(k,Ce,Oe):tc(k,Ce,Oe)}return k}function qh(m,y){return Yr(m,bd(m),y)}function fd(m,y){return Yr(m,Jh(m),y)}function oc(m,y){return function(k,R){var Y=Jt(k)?Mc:al,oe=y?y():{};return Y(k,m,$t(R,2),oe)}}function lc(m){return sn(function(y,k){var R=-1,Y=k.length,oe=Y>1?k[Y-1]:t,be=Y>2?k[2]:t;for(oe=m.length>3&&typeof oe=="function"?(Y--,oe):t,be&&Rr(k[0],k[1],be)&&(oe=Y<3?t:oe,Y=1),y=jn(y);++R<Y;){var Ce=k[R];Ce&&m(y,Ce,R,oe)}return y})}function qp(m,y){return function(k,R){if(k==null)return k;if(!Vi(k))return m(k,R);for(var Y=k.length,oe=y?Y:-1,be=jn(k);(y?oe--:++oe<Y)&&R(be[oe],oe,be)!==!1;);return k}}function cc(m){return function(y,k,R){for(var Y=-1,oe=jn(y),be=R(y),Ce=be.length;Ce--;){var Oe=be[m?Ce:++Y];if(k(oe[Oe],Oe,oe)===!1)break}return y}}function ty(m,y,k){var R=y&E,Y=ja(m);function oe(){var be=this&&this!==Ni&&this instanceof oe?Y:m;return be.apply(R?k:this,arguments)}return oe}function ua(m){return function(y){y=qn(y);var k=Cs(y)?zr(y):t,R=k?k[0]:y.charAt(0),Y=k?ll(k,1).join(""):y.slice(1);return R[m]()+Y}}function Mr(m){return function(y){return Go(N(_o(y).replace(Zs,"")),m,"")}}function ja(m){return function(){var y=arguments;switch(y.length){case 0:return new m;case 1:return new m(y[0]);case 2:return new m(y[0],y[1]);case 3:return new m(y[0],y[1],y[2]);case 4:return new m(y[0],y[1],y[2],y[3]);case 5:return new m(y[0],y[1],y[2],y[3],y[4]);case 6:return new m(y[0],y[1],y[2],y[3],y[4],y[5]);case 7:return new m(y[0],y[1],y[2],y[3],y[4],y[5],y[6])}var k=la(m.prototype),R=m.apply(k,y);return xi(R)?R:k}}function ny(m,y,k){var R=ja(m);function Y(){for(var oe=arguments.length,be=Je(oe),Ce=oe,Oe=dc(Y);Ce--;)be[Ce]=arguments[Ce];var st=oe<3&&be[0]!==Oe&&be[oe-1]!==Oe?[]:ks(be,Oe);if(oe-=st.length,oe<k)return Vp(m,y,ki,Y.placeholder,t,be,st,t,t,k-oe);var lt=this&&this!==Ni&&this instanceof Y?R:m;return Ji(lt,this,be)}return Y}function yo(m){return function(y,k,R){var Y=jn(y);if(!Vi(y)){var oe=$t(k,3);y=Gi(y),k=function(Ce){return oe(Y[Ce],Ce,Y)}}var be=m(y,k,R);return be>-1?Y[oe?y[be]:be]:t}}function Ps(m){return pi(function(y){var k=y.length,R=k,Y=qr.prototype.thru;for(m&&y.reverse();R--;){var oe=y[R];if(typeof oe!="function")throw new Er(l);if(Y&&!be&&xd(oe)=="wrapper")var be=new qr([],!0)}for(R=be?R:k;++R<k;){oe=y[R];var Ce=xd(oe),Oe=Ce=="wrapper"?Wh(oe):t;Oe&&Xh(Oe[0])&&Oe[1]==(B|I|L|$)&&!Oe[4].length&&Oe[9]==1?be=be[xd(Oe[0])].apply(be,Oe[3]):be=oe.length==1&&Xh(oe)?be[Ce]():be.thru(oe)}return function(){var st=arguments,lt=st[0];if(be&&st.length==1&&Jt(lt))return be.plant(lt).value();for(var ht=0,kt=k?y[ht].apply(this,st):lt;++ht<k;)kt=y[ht].call(this,kt);return kt}})}function ki(m,y,k,R,Y,oe,be,Ce,Oe,st){var lt=y&B,ht=y&E,kt=y&C,Rt=y&(I|q),Yt=y&F,xn=kt?t:ja(m);function Wt(){for(var kn=arguments.length,Ln=Je(kn),ns=kn;ns--;)Ln[ns]=arguments[ns];if(Rt)var ma=dc(Wt),is=ph(Ln,ma);if(R&&(Ln=Up(Ln,R,Y,Rt)),oe&&(Ln=ey(Ln,oe,be,Rt)),kn-=is,Rt&&kn<st){var Yi=ks(Ln,ma);return Vp(m,y,ki,Wt.placeholder,k,Ln,Yi,Ce,Oe,st-kn)}var Co=ht?k:this,mc=kt?Co[m]:m;return kn=Ln.length,Ce?Ln=Ms(Ln,Ce):Yt&&kn>1&&Ln.reverse(),lt&&Oe<kn&&(Ln.length=Oe),this&&this!==Ni&&this instanceof Wt&&(mc=xn||ja(mc)),mc.apply(Co,Ln)}return Wt}function pd(m,y){return function(k,R){return Cp(k,m,y(R),{})}}function Kc(m,y){return function(k,R){var Y;if(k===t&&R===t)return y;if(k!==t&&(Y=k),R!==t){if(Y===t)return R;typeof k=="string"||typeof R=="string"?(k=Gr(k),R=Gr(R)):(k=zh(k),R=zh(R)),Y=m(k,R)}return Y}}function md(m){return pi(function(y){return y=ri(y,Ri($t())),sn(function(k){var R=this;return m(y,function(Y){return Ji(Y,R,k)})})})}function gd(m,y){y=y===t?" ":Gr(y);var k=y.length;if(k<2)return k?Rp(y,m):y;var R=Rp(y,tl(m/kr(y)));return Cs(y)?ll(zr(R),0,m).join(""):R.slice(0,m)}function iy(m,y,k,R){var Y=y&E,oe=ja(m);function be(){for(var Ce=-1,Oe=arguments.length,st=-1,lt=R.length,ht=Je(lt+Oe),kt=this&&this!==Ni&&this instanceof be?oe:m;++st<lt;)ht[st]=R[st];for(;Oe--;)ht[st++]=arguments[++Ce];return Ji(kt,Y?k:this,ht)}return be}function cl(m){return function(y,k,R){return R&&typeof R!="number"&&Rr(y,k,R)&&(k=R=t),y=Fs(y),k===t?(k=y,y=0):k=Fs(k),R=R===t?y<k?1:-1:Fs(R),Gg(y,k,R,m)}}function uc(m){return function(y,k){return typeof y=="string"&&typeof k=="string"||(y=Ta(y),k=Ta(k)),m(y,k)}}function Vp(m,y,k,R,Y,oe,be,Ce,Oe,st){var lt=y&I,ht=lt?be:t,kt=lt?t:be,Rt=lt?oe:t,Yt=lt?t:oe;y|=lt?L:O,y&=~(lt?O:L),y&P||(y&=-4);var xn=[m,y,Y,Rt,ht,Yt,kt,Ce,Oe,st],Wt=k.apply(t,xn);return Xh(m)&&tf(Wt,xn),Wt.placeholder=R,nf(Wt,m,y)}function Vh(m){var y=Si[m];return function(k,R){if(k=Ta(k),R=R==null?0:se(nn(R),292),R&&nl(k)){var Y=(qn(k)+"e").split("e"),oe=y(Y[0]+"e"+(+Y[1]+R));return Y=(qn(oe)+"e").split("e"),+(Y[0]+"e"+(+Y[1]-R))}return y(k)}}var ry=an&&1/Jo(new an([,-0]))[1]==K?function(m){return new an(m)}:It;function yd(m){return function(y){var k=er(y);return k==Pe?$c(y):k==dt?Bu(y):fh(y,m(y))}}function Is(m,y,k,R,Y,oe,be,Ce){var Oe=y&C;if(!Oe&&typeof m!="function")throw new Er(l);var st=R?R.length:0;if(st||(y&=-97,R=Y=t),be=be===t?be:le(nn(be),0),Ce=Ce===t?Ce:nn(Ce),st-=Y?Y.length:0,y&O){var lt=R,ht=Y;R=Y=t}var kt=Oe?t:Wh(m),Rt=[m,y,k,R,Y,lt,ht,oe,be,Ce];if(kt&&Nd(Rt,kt),m=Rt[0],y=Rt[1],k=Rt[2],R=Rt[3],Y=Rt[4],Ce=Rt[9]=Rt[9]===t?Oe?0:m.length:le(Rt[9]-st,0),!Ce&&y&(I|q)&&(y&=-25),!y||y==E)var Yt=ty(m,y,k);else y==I||y==q?Yt=ny(m,y,Ce):(y==L||y==(E|L))&&!Y.length?Yt=iy(m,y,k,R):Yt=ki.apply(t,Rt);var xn=kt?ad:tf;return nf(xn(Yt,Rt),m,y)}function Hh(m,y,k,R){return m===t||Kr(m,Ko[k])&&!Rn.call(R,k)?y:m}function Hp(m,y,k,R,Y,oe){return xi(m)&&xi(y)&&(oe.set(y,m),rd(m,y,t,Hp,oe),oe.delete(y)),m}function ay(m){return ka(m)?t:m}function sy(m,y,k,R,Y,oe){var be=k&S,Ce=m.length,Oe=y.length;if(Ce!=Oe&&!(be&&Oe>Ce))return!1;var st=oe.get(m),lt=oe.get(y);if(st&&lt)return st==y&&lt==m;var ht=-1,kt=!0,Rt=k&T?new ho:t;for(oe.set(m,y),oe.set(y,m);++ht<Ce;){var Yt=m[ht],xn=y[ht];if(R)var Wt=be?R(xn,Yt,ht,y,m,oe):R(Yt,xn,ht,m,y,oe);if(Wt!==t){if(Wt)continue;kt=!1;break}if(Rt){if(!Rc(y,function(kn,Ln){if(!_s(Rt,Ln)&&(Yt===kn||Y(Yt,kn,k,R,oe)))return Rt.push(Ln)})){kt=!1;break}}else if(!(Yt===xn||Y(Yt,xn,k,R,oe))){kt=!1;break}}return oe.delete(m),oe.delete(y),kt}function oy(m,y,k,R,Y,oe,be){switch(k){case De:if(m.byteLength!=y.byteLength||m.byteOffset!=y.byteOffset)return!1;m=m.buffer,y=y.buffer;case ue:return!(m.byteLength!=y.byteLength||!oe(new Zo(m),new Zo(y)));case me:case de:case Ye:return Kr(+m,+y);case He:return m.name==y.name&&m.message==y.message;case ze:case Ze:return m==y+"";case Pe:var Ce=$c;case dt:var Oe=R&S;if(Ce||(Ce=Jo),m.size!=y.size&&!Oe)return!1;var st=be.get(m);if(st)return st==y;R|=T,be.set(m,y);var lt=sy(Ce(m),Ce(y),R,Y,oe,be);return be.delete(m),lt;case ct:if(Xl)return Xl.call(m)==Xl.call(y)}return!1}function Zi(m,y,k,R,Y,oe){var be=k&S,Ce=Gh(m),Oe=Ce.length,st=Gh(y),lt=st.length;if(Oe!=lt&&!be)return!1;for(var ht=Oe;ht--;){var kt=Ce[ht];if(!(be?kt in y:Rn.call(y,kt)))return!1}var Rt=oe.get(m),Yt=oe.get(y);if(Rt&&Yt)return Rt==y&&Yt==m;var xn=!0;oe.set(m,y),oe.set(y,m);for(var Wt=be;++ht<Oe;){kt=Ce[ht];var kn=m[kt],Ln=y[kt];if(R)var ns=be?R(Ln,kn,kt,y,m,oe):R(kn,Ln,kt,m,y,oe);if(!(ns===t?kn===Ln||Y(kn,Ln,k,R,oe):ns)){xn=!1;break}Wt||(Wt=kt=="constructor")}if(xn&&!Wt){var ma=m.constructor,is=y.constructor;ma!=is&&"constructor"in m&&"constructor"in y&&!(typeof ma=="function"&&ma instanceof ma&&typeof is=="function"&&is instanceof is)&&(xn=!1)}return oe.delete(m),oe.delete(y),xn}function pi(m){return Sd(Jp(m,t,Qr),m+"")}function Gh(m){return zg(m,Gi,bd)}function Yh(m){return zg(m,tr,Jh)}var Wh=qc?function(m){return qc.get(m)}:It;function xd(m){for(var y=m.name+"",k=wa[y],R=Rn.call(wa,y)?k.length:0;R--;){var Y=k[R],oe=Y.func;if(oe==null||oe==m)return Y.name}return y}function dc(m){var y=Rn.call(X,"placeholder")?X:m;return y.placeholder}function $t(){var m=X.iteratee||qt;return m=m===qt?Ep:m,arguments.length?m(arguments[0],arguments[1]):m}function Xc(m,y){var k=m.__data__;return bo(y)?k[typeof y=="string"?"string":"hash"]:k.map}function Qh(m){for(var y=Gi(m),k=y.length;k--;){var R=y[k],Y=m[R];y[k]=[R,Y,dy(Y)]}return y}function ul(m,y){var k=zu(m,y);return Ds(k)?k:t}function ly(m){var y=Rn.call(m,Xi),k=m[Xi];try{m[Xi]=t;var R=!0}catch{}var Y=_i.call(m);return R&&(y?m[Xi]=k:delete m[Xi]),Y}var bd=Qa?function(m){return m==null?[]:(m=jn(m),ba(Qa(m),function(y){return co.call(m,y)}))}:qv,Jh=Qa?function(m){for(var y=[];m;)sa(y,bd(m)),m=Ql(m);return y}:qv,er=Cn;(Et&&er(new Et(new ArrayBuffer(1)))!=De||_n&&er(new _n)!=Pe||Gn&&er(Gn.resolve())!=je||an&&er(new an)!=dt||Ur&&er(new Ur)!=fe)&&(er=function(m){var y=Cn(m),k=y==ut?m.constructor:t,R=k?vo(k):"";if(R)switch(R){case Tg:return De;case Eg:return Pe;case Wu:return je;case Qu:return dt;case Ag:return fe}return y});function cy(m,y,k){for(var R=-1,Y=k.length;++R<Y;){var oe=k[R],be=oe.size;switch(oe.type){case"drop":m+=be;break;case"dropRight":y-=be;break;case"take":y=se(y,m+be);break;case"takeRight":m=le(m,y-be);break}}return{start:m,end:y}}function Gp(m){var y=m.match(mt);return y?y[1].split(rn):[]}function vd(m,y,k){y=go(y,m);for(var R=-1,Y=y.length,oe=!1;++R<Y;){var be=Vn(y[R]);if(!(oe=m!=null&&k(m,be)))break;m=m[be]}return oe||++R!=Y?oe:(Y=m==null?0:m.length,!!Y&&pc(Y)&&Za(be,Y)&&(Jt(m)||jo(m)))}function Yp(m){var y=m.length,k=new m.constructor(y);return y&&typeof m[0]=="string"&&Rn.call(m,"index")&&(k.index=m.index,k.input=m.input),k}function Wp(m){return typeof m.constructor=="function"&&!si(m)?la(Ql(m)):{}}function Qp(m,y,k){var R=m.constructor;switch(y){case ue:return sc(m);case me:case de:return new R(+m);case De:return zp(m,k);case Ge:case ye:case Ne:case Me:case Fe:case ve:case ke:case Ee:case Ve:return Bp(m,k);case Pe:return new R;case Ye:case Ze:return new R(m);case ze:return Uh(m);case dt:return new R;case ct:return Xg(m)}}function uy(m,y){var k=y.length;if(!k)return m;var R=k-1;return y[R]=(k>1?"& ":"")+y[R],y=y.join(k>2?", ":" "),m.replace(pt,`{
/* [wrapped with `+y+`] */
`)}function xo(m){return Jt(m)||jo(m)||!!(yr&&m&&m[yr])}function Za(m,y){var k=typeof m;return y=y??W,!!y&&(k=="number"||k!="symbol"&&aa.test(m))&&m>-1&&m%1==0&&m<y}function Rr(m,y,k){if(!xi(k))return!1;var R=typeof y;return(R=="number"?Vi(k)&&Za(y,k.length):R=="string"&&y in k)?Kr(k[y],m):!1}function Kh(m,y){if(Jt(m))return!1;var k=typeof m;return k=="number"||k=="symbol"||k=="boolean"||m==null||Or(m)?!0:ln.test(m)||!Kt.test(m)||y!=null&&m in jn(y)}function bo(m){var y=typeof m;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?m!=="__proto__":m===null}function Xh(m){var y=xd(m),k=X[y];if(typeof k!="function"||!(y in gn.prototype))return!1;if(m===k)return!0;var R=Wh(k);return!!R&&m===R[0]}function Zh(m){return!!Hu&&Hu in m}var wd=Yl?es:Vv;function si(m){var y=m&&m.constructor,k=typeof y=="function"&&y.prototype||Ko;return m===k}function dy(m){return m===m&&!xi(m)}function hy(m,y){return function(k){return k==null?!1:k[m]===y&&(y!==t||m in jn(k))}}function fy(m){var y=Id(m,function(R){return k.size===u&&k.clear(),R}),k=y.cache;return y}function Nd(m,y){var k=m[1],R=y[1],Y=k|R,oe=Y<(E|C|B),be=R==B&&k==I||R==B&&k==$&&m[7].length<=y[8]||R==(B|$)&&y[7].length<=y[8]&&k==I;if(!(oe||be))return m;R&E&&(m[2]=y[2],Y|=k&E?0:P);var Ce=y[3];if(Ce){var Oe=m[3];m[3]=Oe?Up(Oe,Ce,y[4]):Ce,m[4]=Oe?ks(m[3],f):y[4]}return Ce=y[5],Ce&&(Oe=m[5],m[5]=Oe?ey(Oe,Ce,y[6]):Ce,m[6]=Oe?ks(m[5],f):y[6]),Ce=y[7],Ce&&(m[7]=Ce),R&B&&(m[8]=m[8]==null?y[8]:se(m[8],y[8])),m[9]==null&&(m[9]=y[9]),m[0]=y[0],m[1]=Y,m}function dl(m){var y=[];if(m!=null)for(var k in jn(m))y.push(k);return y}function py(m){return _i.call(m)}function Jp(m,y,k){return y=le(y===t?m.length-1:y,0),function(){for(var R=arguments,Y=-1,oe=le(R.length-y,0),be=Je(oe);++Y<oe;)be[Y]=R[y+Y];Y=-1;for(var Ce=Je(y+1);++Y<y;)Ce[Y]=R[Y];return Ce[y]=k(be),Ji(m,this,Ce)}}function Zc(m,y){return y.length<2?m:Sa(m,ca(y,0,-1))}function Ms(m,y){for(var k=m.length,R=se(y.length,k),Y=Ui(m);R--;){var oe=y[R];m[R]=Za(oe,k)?Y[oe]:t}return m}function ef(m,y){if(!(y==="constructor"&&typeof m[y]=="function")&&y!="__proto__")return m[y]}var tf=jd(ad),eu=Yu||function(m,y){return Ni.setTimeout(m,y)},Sd=jd(sd);function nf(m,y,k){var R=y+"";return Sd(m,uy(R,my(Gp(R),k)))}function jd(m){var y=0,k=0;return function(){var R=_e(),Y=ee-(R-k);if(k=R,Y>0){if(++y>=V)return arguments[0]}else y=0;return m.apply(t,arguments)}}function _d(m,y){var k=-1,R=m.length,Y=R-1;for(y=y===t?R:y;++k<y;){var oe=Lh(k,Y),be=m[oe];m[oe]=m[k],m[k]=be}return m.length=y,m}var Rs=fy(function(m){var y=[];return m.charCodeAt(0)===46&&y.push(""),m.replace(Dt,function(k,R,Y,oe){y.push(Y?oe.replace(Bi,"$1"):R||k)}),y});function Vn(m){if(typeof m=="string"||Or(m))return m;var y=m+"";return y=="0"&&1/m==-1/0?"-0":y}function vo(m){if(m!=null){try{return Wl.call(m)}catch{}try{return m+""}catch{}}return""}function my(m,y){return gr(Se,function(k){var R="_."+k[0];y&k[1]&&!Gl(m,R)&&m.push(R)}),m.sort()}function qi(m){if(m instanceof gn)return m.clone();var y=new qr(m.__wrapped__,m.__chain__);return y.__actions__=Ui(m.__actions__),y.__index__=m.__index__,y.__values__=m.__values__,y}function ov(m,y,k){(k?Rr(m,y,k):y===t)?y=1:y=le(nn(y),0);var R=m==null?0:m.length;if(!R||y<1)return[];for(var Y=0,oe=0,be=Je(tl(R/y));Y<R;)be[oe++]=ca(m,Y,Y+=y);return be}function gy(m){for(var y=-1,k=m==null?0:m.length,R=0,Y=[];++y<k;){var oe=m[y];oe&&(Y[R++]=oe)}return Y}function yy(){var m=arguments.length;if(!m)return[];for(var y=Je(m-1),k=arguments[0],R=m;R--;)y[R-1]=arguments[R];return sa(Jt(k)?Ui(k):[k],Nn(y,1))}var yi=sn(function(m,y){return Ei(m)?sl(m,Nn(y,1,Ei,!0)):[]}),Wr=sn(function(m,y){var k=vr(y);return Ei(k)&&(k=t),Ei(m)?sl(m,Nn(y,1,Ei,!0),$t(k,2)):[]}),wo=sn(function(m,y){var k=vr(y);return Ei(k)&&(k=t),Ei(m)?sl(m,Nn(y,1,Ei,!0),t,k):[]});function xy(m,y,k){var R=m==null?0:m.length;return R?(y=k||y===t?1:nn(y),ca(m,y<0?0:y,R)):[]}function by(m,y,k){var R=m==null?0:m.length;return R?(y=k||y===t?1:nn(y),y=R-y,ca(m,0,y<0?0:y)):[]}function lv(m,y){return m&&m.length?cd(m,$t(y,3),!0,!0):[]}function Kp(m,y){return m&&m.length?cd(m,$t(y,3),!0):[]}function da(m,y,k,R){var Y=m==null?0:m.length;return Y?(k&&typeof k!="number"&&Rr(m,y,k)&&(k=0,R=Y),cn(m,y,k,R)):[]}function _a(m,y,k){var R=m==null?0:m.length;if(!R)return-1;var Y=k==null?0:nn(k);return Y<0&&(Y=le(R+Y,0)),ws(m,$t(y,3),Y)}function Xp(m,y,k){var R=m==null?0:m.length;if(!R)return-1;var Y=R-1;return k!==t&&(Y=nn(k),Y=k<0?le(R+Y,0):se(Y,R-1)),ws(m,$t(y,3),Y,!0)}function Qr(m){var y=m==null?0:m.length;return y?Nn(m,1):[]}function vy(m){var y=m==null?0:m.length;return y?Nn(m,K):[]}function hl(m,y){var k=m==null?0:m.length;return k?(y=y===t?1:nn(y),Nn(m,y)):[]}function hc(m){for(var y=-1,k=m==null?0:m.length,R={};++y<k;){var Y=m[y];R[Y[0]]=Y[1]}return R}function No(m){return m&&m.length?m[0]:t}function Zp(m,y,k){var R=m==null?0:m.length;if(!R)return-1;var Y=k==null?0:nn(k);return Y<0&&(Y=le(R+Y,0)),io(m,y,Y)}function em(m){var y=m==null?0:m.length;return y?ca(m,0,-1):[]}var Os=sn(function(m){var y=ri(m,Bh);return y.length&&y[0]===m[0]?_p(y):[]}),wy=sn(function(m){var y=vr(m),k=ri(m,Bh);return y===vr(k)?y=t:k.pop(),k.length&&k[0]===m[0]?_p(k,$t(y,2)):[]}),tu=sn(function(m){var y=vr(m),k=ri(m,Bh);return y=typeof y=="function"?y:t,y&&k.pop(),k.length&&k[0]===m[0]?_p(k,t,y):[]});function Cd(m,y){return m==null?"":Pr.call(m,y)}function vr(m){var y=m==null?0:m.length;return y?m[y-1]:t}function nu(m,y,k){var R=m==null?0:m.length;if(!R)return-1;var Y=R;return k!==t&&(Y=nn(k),Y=Y<0?le(R+Y,0):se(Y,R-1)),y===y?Cr(m,y,Y):ws(m,Ga,Y,!0)}function Ny(m,y){return m&&m.length?Pp(m,nn(y)):t}var Sy=sn(iu);function iu(m,y){return m&&m.length&&y&&y.length?Oh(m,y):m}function jy(m,y,k){return m&&m.length&&y&&y.length?Oh(m,y,$t(k,2)):m}function rf(m,y,k){return m&&m.length&&y&&y.length?Oh(m,y,t,k):m}var _y=pi(function(m,y){var k=m==null?0:m.length,R=ed(m,y);return Mp(m,ri(y,function(Y){return Za(Y,k)?+Y:Y}).sort(hd)),R});function cv(m,y){var k=[];if(!(m&&m.length))return k;var R=-1,Y=[],oe=m.length;for(y=$t(y,3);++R<oe;){var be=m[R];y(be,R,m)&&(k.push(be),Y.push(R))}return Mp(m,Y),k}function tm(m){return m==null?m:Pt.call(m)}function Wn(m,y,k){var R=m==null?0:m.length;return R?(k&&typeof k!="number"&&Rr(m,y,k)?(y=0,k=R):(y=y==null?0:nn(y),k=k===t?R:nn(k)),ca(m,y,k)):[]}function ci(m,y){return od(m,y)}function bn(m,y,k){return $h(m,y,$t(k,2))}function In(m,y){var k=m==null?0:m.length;if(k){var R=od(m,y);if(R<k&&Kr(m[R],y))return R}return-1}function Qn(m,y){return od(m,y,!0)}function ha(m,y,k){return $h(m,y,$t(k,2),!0)}function fl(m,y){var k=m==null?0:m.length;if(k){var R=od(m,y,!0)-1;if(Kr(m[R],y))return R}return-1}function ru(m){return m&&m.length?Op(m):[]}function nm(m,y){return m&&m.length?Op(m,$t(y,2)):[]}function So(m){var y=m==null?0:m.length;return y?ca(m,1,y):[]}function Ti(m,y,k){return m&&m.length?(y=k||y===t?1:nn(y),ca(m,0,y<0?0:y)):[]}function pl(m,y,k){var R=m==null?0:m.length;return R?(y=k||y===t?1:nn(y),y=R-y,ca(m,y<0?0:y,R)):[]}function fc(m,y){return m&&m.length?cd(m,$t(y,3),!1,!0):[]}function im(m,y){return m&&m.length?cd(m,$t(y,3)):[]}var Ca=sn(function(m){return mo(Nn(m,1,Ei,!0))}),au=sn(function(m){var y=vr(m);return Ei(y)&&(y=t),mo(Nn(m,1,Ei,!0),$t(y,2))}),kd=sn(function(m){var y=vr(m);return y=typeof y=="function"?y:t,mo(Nn(m,1,Ei,!0),t,y)});function Jr(m){return m&&m.length?mo(m):[]}function rm(m,y){return m&&m.length?mo(m,$t(y,2)):[]}function am(m,y){return y=typeof y=="function"?y:t,m&&m.length?mo(m,t,y):[]}function su(m){if(!(m&&m.length))return[];var y=0;return m=ba(m,function(k){if(Ei(k))return y=le(k.length,y),!0}),Ss(y,function(k){return ri(m,Wo(k))})}function Td(m,y){if(!(m&&m.length))return[];var k=su(m);return y==null?k:ri(k,function(R){return Ji(y,t,R)})}var ml=sn(function(m,y){return Ei(m)?sl(m,y):[]}),ur=sn(function(m){return ud(ba(m,Ei))}),gl=sn(function(m){var y=vr(m);return Ei(y)&&(y=t),ud(ba(m,Ei),$t(y,2))}),ou=sn(function(m){var y=vr(m);return y=typeof y=="function"?y:t,ud(ba(m,Ei),t,y)}),lu=sn(su);function sm(m,y){return Fp(m||[],y||[],tc)}function om(m,y){return Fp(m||[],y||[],Jc)}var Cy=sn(function(m){var y=m.length,k=y>1?m[y-1]:t;return k=typeof k=="function"?(m.pop(),k):t,Td(m,k)});function cu(m){var y=X(m);return y.__chain__=!0,y}function lm(m,y){return y(m),m}function wr(m,y){return y(m)}var ky=pi(function(m){var y=m.length,k=y?m[0]:0,R=this.__wrapped__,Y=function(oe){return ed(oe,m)};return y>1||this.__actions__.length||!(R instanceof gn)||!Za(k)?this.thru(Y):(R=R.slice(k,+k+(y?1:0)),R.__actions__.push({func:wr,args:[Y],thisArg:t}),new qr(R,this.__chain__).thru(function(oe){return y&&!oe.length&&oe.push(t),oe}))});function fa(){return cu(this)}function Ty(){return new qr(this.value(),this.__chain__)}function Ey(){this.__values__===t&&(this.__values__=pa(this.value()));var m=this.__index__>=this.__values__.length,y=m?t:this.__values__[this.__index__++];return{done:m,value:y}}function uv(){return this}function yl(m){for(var y,k=this;k instanceof Na;){var R=qi(k);R.__index__=0,R.__values__=t,y?Y.__wrapped__=R:y=R;var Y=R;k=k.__wrapped__}return Y.__wrapped__=m,y}function af(){var m=this.__wrapped__;if(m instanceof gn){var y=m;return this.__actions__.length&&(y=new gn(this)),y=y.reverse(),y.__actions__.push({func:wr,args:[tm],thisArg:t}),new qr(y,this.__chain__)}return this.thru(tm)}function cm(){return Qg(this.__wrapped__,this.__actions__)}var uu=oc(function(m,y,k){Rn.call(m,k)?++m[k]:Ja(m,k,1)});function Ay(m,y,k){var R=Jt(m)?Ho:Sp;return k&&Rr(m,y,k)&&(y=t),R(m,$t(y,3))}function Dy(m,y){var k=Jt(m)?ba:Yn;return k(m,$t(y,3))}var Py=yo(_a),um=yo(Xp);function dm(m,y){return Nn(Ed(m,y),1)}function dv(m,y){return Nn(Ed(m,y),K)}function hv(m,y,k){return k=k===t?1:nn(k),Nn(Ed(m,y),k)}function Iy(m,y){var k=Jt(m)?gr:po;return k(m,$t(y,3))}function hm(m,y){var k=Jt(m)?Hl:Th;return k(m,$t(y,3))}var My=oc(function(m,y,k){Rn.call(m,k)?m[k].push(y):Ja(m,k,[y])});function du(m,y,k,R){m=Vi(m)?m:xu(m),k=k&&!R?nn(k):0;var Y=m.length;return k<0&&(k=le(Y+k,0)),yf(m)?k<=Y&&m.indexOf(y,k)>-1:!!Y&&io(m,y,k)>-1}var sf=sn(function(m,y,k){var R=-1,Y=typeof y=="function",oe=Vi(m)?Je(m.length):[];return po(m,function(be){oe[++R]=Y?Ji(y,be,k):rc(be,y,k)}),oe}),Ry=oc(function(m,y,k){Ja(m,k,y)});function Ed(m,y){var k=Jt(m)?ri:Ap;return k(m,$t(y,3))}function Oy(m,y,k,R){return m==null?[]:(Jt(y)||(y=y==null?[]:[y]),k=R?t:k,Jt(k)||(k=k==null?[]:[k]),Ip(m,y,k))}var Ly=oc(function(m,y,k){m[k?0:1].push(y)},function(){return[[],[]]});function Fy(m,y,k){var R=Jt(m)?Go:Qo,Y=arguments.length<3;return R(m,$t(y,4),k,Y,po)}function $y(m,y,k){var R=Jt(m)?Yo:Qo,Y=arguments.length<3;return R(m,$t(y,4),k,Y,Th)}function of(m,y){var k=Jt(m)?ba:Yn;return k(m,Md($t(y,3)))}function zy(m){var y=Jt(m)?Hc:Qc;return y(m)}function By(m,y,k){(k?Rr(m,y,k):y===t)?y=1:y=nn(y);var R=Jt(m)?Lg:Fh;return R(m,y)}function oi(m){var y=Jt(m)?Fg:Yg;return y(m)}function fm(m){if(m==null)return 0;if(Vi(m))return yf(m)?kr(m):m.length;var y=er(m);return y==Pe||y==dt?m.size:Ph(m).length}function fv(m,y,k){var R=Jt(m)?Rc:Wg;return k&&Rr(m,y,k)&&(y=t),R(m,$t(y,3))}var Uy=sn(function(m,y){if(m==null)return[];var k=y.length;return k>1&&Rr(m,y[0],y[1])?y=[]:k>2&&Rr(y[0],y[1],y[2])&&(y=[y[0]]),Ip(m,Nn(y,1),[])}),lf=uo||function(){return Ni.Date.now()};function pv(m,y){if(typeof y!="function")throw new Er(l);return m=nn(m),function(){if(--m<1)return y.apply(this,arguments)}}function qy(m,y,k){return y=k?t:y,y=m&&y==null?m.length:y,Is(m,B,t,t,t,t,y)}function Ad(m,y){var k;if(typeof y!="function")throw new Er(l);return m=nn(m),function(){return--m>0&&(k=y.apply(this,arguments)),m<=1&&(y=t),k}}var xl=sn(function(m,y,k){var R=E;if(k.length){var Y=ks(k,dc(xl));R|=L}return Is(m,R,y,k,Y)}),cf=sn(function(m,y,k){var R=E|C;if(k.length){var Y=ks(k,dc(cf));R|=L}return Is(y,R,m,k,Y)});function Dd(m,y,k){y=k?t:y;var R=Is(m,I,t,t,t,t,t,y);return R.placeholder=Dd.placeholder,R}function uf(m,y,k){y=k?t:y;var R=Is(m,q,t,t,t,t,t,y);return R.placeholder=uf.placeholder,R}function bl(m,y,k){var R,Y,oe,be,Ce,Oe,st=0,lt=!1,ht=!1,kt=!0;if(typeof m!="function")throw new Er(l);y=Ta(y)||0,xi(k)&&(lt=!!k.leading,ht="maxWait"in k,oe=ht?le(Ta(k.maxWait)||0,y):oe,kt="trailing"in k?!!k.trailing:kt);function Rt(Yi){var Co=R,mc=Y;return R=Y=t,st=Yi,be=m.apply(mc,Co),be}function Yt(Yi){return st=Yi,Ce=eu(kn,y),lt?Rt(Yi):be}function xn(Yi){var Co=Yi-Oe,mc=Yi-st,pN=y-Co;return ht?se(pN,oe-mc):pN}function Wt(Yi){var Co=Yi-Oe,mc=Yi-st;return Oe===t||Co>=y||Co<0||ht&&mc>=oe}function kn(){var Yi=lf();if(Wt(Yi))return Ln(Yi);Ce=eu(kn,xn(Yi))}function Ln(Yi){return Ce=t,kt&&R?Rt(Yi):(R=Y=t,be)}function ns(){Ce!==t&&Kg(Ce),st=0,R=Oe=Y=Ce=t}function ma(){return Ce===t?be:Ln(lf())}function is(){var Yi=lf(),Co=Wt(Yi);if(R=arguments,Y=this,Oe=Yi,Co){if(Ce===t)return Yt(Oe);if(ht)return Kg(Ce),Ce=eu(kn,y),Rt(Oe)}return Ce===t&&(Ce=eu(kn,y)),be}return is.cancel=ns,is.flush=ma,is}var Ls=sn(function(m,y){return nc(m,1,y)}),Pd=sn(function(m,y,k){return nc(m,Ta(y)||0,k)});function mv(m){return Is(m,F)}function Id(m,y){if(typeof m!="function"||y!=null&&typeof y!="function")throw new Er(l);var k=function(){var R=arguments,Y=y?y.apply(this,R):R[0],oe=k.cache;if(oe.has(Y))return oe.get(Y);var be=m.apply(this,R);return k.cache=oe.set(Y,be)||oe,be};return k.cache=new(Id.Cache||Vr),k}Id.Cache=Vr;function Md(m){if(typeof m!="function")throw new Er(l);return function(){var y=arguments;switch(y.length){case 0:return!m.call(this);case 1:return!m.call(this,y[0]);case 2:return!m.call(this,y[0],y[1]);case 3:return!m.call(this,y[0],y[1],y[2])}return!m.apply(this,y)}}function Vy(m){return Ad(2,m)}var Hy=Jg(function(m,y){y=y.length==1&&Jt(y[0])?ri(y[0],Ri($t())):ri(Nn(y,1),Ri($t()));var k=y.length;return sn(function(R){for(var Y=-1,oe=se(R.length,k);++Y<oe;)R[Y]=y[Y].call(this,R[Y]);return Ji(m,this,R)})}),pm=sn(function(m,y){var k=ks(y,dc(pm));return Is(m,L,t,y,k)}),df=sn(function(m,y){var k=ks(y,dc(df));return Is(m,O,t,y,k)}),Gy=pi(function(m,y){return Is(m,$,t,t,t,y)});function Yy(m,y){if(typeof m!="function")throw new Er(l);return y=y===t?y:nn(y),sn(m,y)}function gv(m,y){if(typeof m!="function")throw new Er(l);return y=y==null?0:le(nn(y),0),sn(function(k){var R=k[y],Y=ll(k,0,y);return R&&sa(Y,R),Ji(m,this,Y)})}function mm(m,y,k){var R=!0,Y=!0;if(typeof m!="function")throw new Er(l);return xi(k)&&(R="leading"in k?!!k.leading:R,Y="trailing"in k?!!k.trailing:Y),bl(m,y,{leading:R,maxWait:y,trailing:Y})}function gm(m){return qy(m,1)}function yv(m,y){return pm(dd(y),m)}function xv(){if(!arguments.length)return[];var m=arguments[0];return Jt(m)?m:[m]}function Rd(m){return xr(m,v)}function bv(m,y){return y=typeof y=="function"?y:t,xr(m,v,y)}function Wy(m){return xr(m,g|v)}function vn(m,y){return y=typeof y=="function"?y:t,xr(m,g|v,y)}function ym(m,y){return y==null||Np(m,y,Gi(y))}function Kr(m,y){return m===y||m!==m&&y!==y}var xm=uc(td),Qy=uc(function(m,y){return m>=y}),jo=Eh(function(){return arguments}())?Eh:function(m){return ji(m)&&Rn.call(m,"callee")&&!co.call(m,"callee")},Jt=Je.isArray,hf=no?Ri(no):Hr;function Vi(m){return m!=null&&pc(m.length)&&!es(m)}function Ei(m){return ji(m)&&Vi(m)}function vv(m){return m===!0||m===!1||ji(m)&&Cn(m)==me}var vl=Kl||Vv,Jy=dh?Ri(dh):Fi;function Ky(m){return ji(m)&&m.nodeType===1&&!ka(m)}function ff(m){if(m==null)return!0;if(Vi(m)&&(Jt(m)||typeof m=="string"||typeof m.splice=="function"||vl(m)||hu(m)||jo(m)))return!m.length;var y=er(m);if(y==Pe||y==dt)return!m.size;if(si(m))return!Ph(m).length;for(var k in m)if(Rn.call(m,k))return!1;return!0}function ei(m,y){return ac(m,y)}function bm(m,y,k){k=typeof k=="function"?k:t;var R=k?k(m,y):t;return R===t?ac(m,y,t,k):!!R}function Hi(m){if(!ji(m))return!1;var y=Cn(m);return y==He||y==Le||typeof m.message=="string"&&typeof m.name=="string"&&!ka(m)}function wv(m){return typeof m=="number"&&nl(m)}function es(m){if(!xi(m))return!1;var y=Cn(m);return y==pe||y==ne||y==ge||y==Qe}function pf(m){return typeof m=="number"&&m==nn(m)}function pc(m){return typeof m=="number"&&m>-1&&m%1==0&&m<=W}function xi(m){var y=typeof m;return m!=null&&(y=="object"||y=="function")}function ji(m){return m!=null&&typeof m=="object"}var mf=Pc?Ri(Pc):Ah;function vm(m,y){return m===y||id(m,y,Qh(y))}function Nv(m,y,k){return k=typeof k=="function"?k:t,id(m,y,Qh(y),k)}function Xy(m){return ex(m)&&m!=+m}function Sv(m){if(wd(m))throw new zt(o);return Ds(m)}function Zy(m){return m===null}function jv(m){return m==null}function ex(m){return typeof m=="number"||ji(m)&&Cn(m)==Ye}function ka(m){if(!ji(m)||Cn(m)!=ut)return!1;var y=Ql(m);if(y===null)return!0;var k=Rn.call(y,"constructor")&&y.constructor;return typeof k=="function"&&k instanceof k&&Wl.call(k)==Br}var gf=Ic?Ri(Ic):Dh;function wm(m){return pf(m)&&m>=-9007199254740991&&m<=W}var tx=Fu?Ri(Fu):kp;function yf(m){return typeof m=="string"||!Jt(m)&&ji(m)&&Cn(m)==Ze}function Or(m){return typeof m=="symbol"||ji(m)&&Cn(m)==ct}var hu=Un?Ri(Un):Tp;function ts(m){return m===t}function Nm(m){return ji(m)&&er(m)==fe}function nx(m){return ji(m)&&Cn(m)==Q}var ix=uc(Ih),Od=uc(function(m,y){return m<=y});function pa(m){if(!m)return[];if(Vi(m))return yf(m)?zr(m):Ui(m);if(Es&&m[Es])return xh(m[Es]());var y=er(m),k=y==Pe?$c:y==dt?Jo:xu;return k(m)}function Fs(m){if(!m)return m===0?m:0;if(m=Ta(m),m===K||m===-1/0){var y=m<0?-1:1;return y*re}return m===m?m:0}function nn(m){var y=Fs(m),k=y%1;return y===y?k?y-k:y:0}function $s(m){return m?Ka(nn(m),0,te):0}function Ta(m){if(typeof m=="number")return m;if(Or(m))return A;if(xi(m)){var y=typeof m.valueOf=="function"?m.valueOf():m;m=xi(y)?y+"":y}if(typeof m!="string")return m===0?m:+m;m=ao(m);var k=Mn.test(m);return k||fr.test(m)?uh(m.slice(2),k?2:8):hr.test(m)?A:+m}function rx(m){return Yr(m,tr(m))}function fu(m){return m?Ka(nn(m),-9007199254740991,W):m===0?m:0}function qn(m){return m==null?"":Gr(m)}var _v=lc(function(m,y){if(si(y)||Vi(y)){Yr(y,Gi(y),m);return}for(var k in y)Rn.call(y,k)&&tc(m,k,y[k])}),ax=lc(function(m,y){Yr(y,tr(y),m)}),xf=lc(function(m,y,k,R){Yr(y,tr(y),m,R)}),Cv=lc(function(m,y,k,R){Yr(y,Gi(y),m,R)}),kv=pi(ed);function Tv(m,y){var k=la(m);return y==null?k:fo(k,y)}var Ev=sn(function(m,y){m=jn(m);var k=-1,R=y.length,Y=R>2?y[2]:t;for(Y&&Rr(y[0],y[1],Y)&&(R=1);++k<R;)for(var oe=y[k],be=tr(oe),Ce=-1,Oe=be.length;++Ce<Oe;){var st=be[Ce],lt=m[st];(lt===t||Kr(lt,Ko[st])&&!Rn.call(m,st))&&(m[st]=oe[st])}return m}),sx=sn(function(m){return m.push(t,Hp),Ji(zd,t,m)});function pu(m,y){return hh(m,$t(y,3),br)}function Ld(m,y){return hh(m,$t(y,3),Wc)}function ox(m,y){return m==null?m:Yc(m,$t(y,3),tr)}function Av(m,y){return m==null?m:ic(m,$t(y,3),tr)}function mu(m,y){return m&&br(m,$t(y,3))}function Fd(m,y){return m&&Wc(m,$t(y,3))}function lx(m){return m==null?[]:ol(m,Gi(m))}function bf(m){return m==null?[]:ol(m,tr(m))}function $d(m,y,k){var R=m==null?t:Sa(m,y);return R===t?k:R}function Sm(m,y){return m!=null&&vd(m,y,jp)}function gu(m,y){return m!=null&&vd(m,y,Bg)}var cx=pd(function(m,y,k){y!=null&&typeof y.toString!="function"&&(y=_i.call(y)),m[y]=k},Ue(qe)),ux=pd(function(m,y,k){y!=null&&typeof y.toString!="function"&&(y=_i.call(y)),Rn.call(m,y)?m[y].push(k):m[y]=[k]},$t),Dv=sn(rc);function Gi(m){return Vi(m)?wp(m):Ph(m)}function tr(m){return Vi(m)?wp(m,!0):qg(m)}function Pv(m,y){var k={};return y=$t(y,3),br(m,function(R,Y,oe){Ja(k,y(R,Y,oe),R)}),k}function Iv(m,y){var k={};return y=$t(y,3),br(m,function(R,Y,oe){Ja(k,Y,y(R,Y,oe))}),k}var Mv=lc(function(m,y,k){rd(m,y,k)}),zd=lc(function(m,y,k,R){rd(m,y,k,R)}),vf=pi(function(m,y){var k={};if(m==null)return k;var R=!1;y=ri(y,function(oe){return oe=go(oe,m),R||(R=oe.length>1),oe}),Yr(m,Yh(m),k),R&&(k=xr(k,g|b|v,ay));for(var Y=y.length;Y--;)ld(k,y[Y]);return k});function jm(m,y){return yu(m,Md($t(y)))}var Rv=pi(function(m,y){return m==null?{}:Vg(m,y)});function yu(m,y){if(m==null)return{};var k=ri(Yh(m),function(R){return[R]});return y=$t(y),Rh(m,k,function(R,Y){return y(R,Y[0])})}function Ov(m,y,k){y=go(y,m);var R=-1,Y=y.length;for(Y||(Y=1,m=t);++R<Y;){var oe=m==null?t:m[Vn(y[R])];oe===t&&(R=Y,oe=k),m=es(oe)?oe.call(m):oe}return m}function dx(m,y,k){return m==null?m:Jc(m,y,k)}function hx(m,y,k,R){return R=typeof R=="function"?R:t,m==null?m:Jc(m,y,k,R)}var _m=yd(Gi),Cm=yd(tr);function km(m,y,k){var R=Jt(m),Y=R||vl(m)||hu(m);if(y=$t(y,4),k==null){var oe=m&&m.constructor;Y?k=R?new oe:[]:xi(m)?k=es(oe)?la(Ql(m)):{}:k={}}return(Y?gr:br)(m,function(be,Ce,Oe){return y(k,be,Ce,Oe)}),k}function fx(m,y){return m==null?!0:ld(m,y)}function wf(m,y,k){return m==null?m:Lp(m,y,dd(k))}function Lv(m,y,k,R){return R=typeof R=="function"?R:t,m==null?m:Lp(m,y,dd(k),R)}function xu(m){return m==null?[]:js(m,Gi(m))}function Tm(m){return m==null?[]:js(m,tr(m))}function Em(m,y,k){return k===t&&(k=y,y=t),k!==t&&(k=Ta(k),k=k===k?k:0),y!==t&&(y=Ta(y),y=y===y?y:0),Ka(Ta(m),y,k)}function Nf(m,y,k){return y=Fs(y),k===t?(k=y,y=0):k=Fs(k),m=Ta(m),Ug(m,y,k)}function Am(m,y,k){if(k&&typeof k!="boolean"&&Rr(m,y,k)&&(y=k=t),k===t&&(typeof y=="boolean"?(k=y,y=t):typeof m=="boolean"&&(k=m,m=t)),m===t&&y===t?(m=0,y=1):(m=Fs(m),y===t?(y=m,m=0):y=Fs(y)),m>y){var R=m;m=y,y=R}if(k||m%1||y%1){var Y=St();return se(m+Y*(y-m+Vo("1e-"+((Y+"").length-1))),y)}return Lh(m,y)}var px=Mr(function(m,y,k){return y=y.toLowerCase(),m+(k?Sf(y):y)});function Sf(m){return x(qn(m).toLowerCase())}function _o(m){return m=qn(m),m&&m.replace(fi,Fc).replace(xa,"")}function wl(m,y,k){m=qn(m),y=Gr(y);var R=m.length;k=k===t?R:Ka(nn(k),0,R);var Y=k;return k-=y.length,k>=0&&m.slice(k,Y)==y}function Nl(m){return m=qn(m),m&&tt.test(m)?m.replace(bt,mh):m}function Bd(m){return m=qn(m),m&&Dn.test(m)?m.replace(mn,"\\$&"):m}var Ud=Mr(function(m,y,k){return m+(k?"-":"")+y.toLowerCase()}),Sl=Mr(function(m,y,k){return m+(k?" ":"")+y.toLowerCase()}),Fv=ua("toLowerCase");function mx(m,y,k){m=qn(m),y=nn(y);var R=y?kr(m):0;if(!y||R>=y)return m;var Y=(y-R)/2;return gd(Wa(Y),k)+m+gd(tl(Y),k)}function qd(m,y,k){m=qn(m),y=nn(y);var R=y?kr(m):0;return y&&R<y?m+gd(y-R,k):m}function $v(m,y,k){m=qn(m),y=nn(y);var R=y?kr(m):0;return y&&R<y?gd(y-R,k)+m:m}function gx(m,y,k){return k||y==null?y=0:y&&(y=+y),it(qn(m).replace(ii,""),y||0)}function jf(m,y,k){return(k?Rr(m,y,k):y===t)?y=1:y=nn(y),Rp(qn(m),y)}function yx(){var m=arguments,y=qn(m[0]);return m.length<3?y:y.replace(m[1],m[2])}var zv=Mr(function(m,y,k){return m+(k?"_":"")+y.toLowerCase()});function _f(m,y,k){return k&&typeof k!="number"&&Rr(m,y,k)&&(y=k=t),k=k===t?te:k>>>0,k?(m=qn(m),m&&(typeof y=="string"||y!=null&&!gf(y))&&(y=Gr(y),!y&&Cs(m))?ll(zr(m),0,k):m.split(y,k)):[]}var Cf=Mr(function(m,y,k){return m+(k?" ":"")+x(y)});function xx(m,y,k){return m=qn(m),k=k==null?0:Ka(nn(k),0,m.length),y=Gr(y),m.slice(k,k+y.length)==y}function Vd(m,y,k){var R=X.templateSettings;k&&Rr(m,y,k)&&(y=t),m=qn(m),y=xf({},y,R,Hh);var Y=xf({},y.imports,R.imports,Hh),oe=Gi(Y),be=js(Y,oe),Ce,Oe,st=0,lt=y.interpolate||Pn,ht="__p += '",kt=zc((y.escape||Pn).source+"|"+lt.source+"|"+(lt===pn?Qi:Pn).source+"|"+(y.evaluate||Pn).source+"|$","g"),Rt="//# sourceURL="+(Rn.call(y,"sourceURL")?(y.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ou+"]")+`
`;m.replace(kt,function(Wt,kn,Ln,ns,ma,is){return Ln||(Ln=ns),ht+=m.slice(st,is).replace(pr,gh),kn&&(Ce=!0,ht+=`' +
__e(`+kn+`) +
'`),ma&&(Oe=!0,ht+=`';
`+ma+`;
__p += '`),Ln&&(ht+=`' +
((__t = (`+Ln+`)) == null ? '' : __t) +
'`),st=is+Wt.length,Wt}),ht+=`';
`;var Yt=Rn.call(y,"variable")&&y.variable;if(!Yt)ht=`with (obj) {
`+ht+`
}
`;else if(Zn.test(Yt))throw new zt(h);ht=(Oe?ht.replace(Ke,""):ht).replace(vt,"$1").replace(wt,"$1;"),ht="function("+(Yt||"obj")+`) {
`+(Yt?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Ce?", __e = _.escape":"")+(Oe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ht+`return __p
}`;var xn=D(function(){return wn(oe,Rt+"return "+ht).apply(t,be)});if(xn.source=ht,Hi(xn))throw xn;return xn}function Dm(m){return qn(m).toLowerCase()}function kf(m){return qn(m).toUpperCase()}function bx(m,y,k){if(m=qn(m),m&&(k||y===t))return ao(m);if(!m||!(y=Gr(y)))return m;var R=zr(m),Y=zr(y),oe=so(R,Y),be=Ya(R,Y)+1;return ll(R,oe,be).join("")}function Bv(m,y,k){if(m=qn(m),m&&(k||y===t))return m.slice(0,Uu(m)+1);if(!m||!(y=Gr(y)))return m;var R=zr(m),Y=Ya(R,zr(y))+1;return ll(R,0,Y).join("")}function Tf(m,y,k){if(m=qn(m),m&&(k||y===t))return m.replace(ii,"");if(!m||!(y=Gr(y)))return m;var R=zr(m),Y=so(R,zr(y));return ll(R,Y).join("")}function s(m,y){var k=z,R=U;if(xi(y)){var Y="separator"in y?y.separator:Y;k="length"in y?nn(y.length):k,R="omission"in y?Gr(y.omission):R}m=qn(m);var oe=m.length;if(Cs(m)){var be=zr(m);oe=be.length}if(k>=oe)return m;var Ce=k-kr(R);if(Ce<1)return R;var Oe=be?ll(be,0,Ce).join(""):m.slice(0,Ce);if(Y===t)return Oe+R;if(be&&(Ce+=Oe.length-Ce),gf(Y)){if(m.slice(Ce).search(Y)){var st,lt=Oe;for(Y.global||(Y=zc(Y.source,qn(Mi.exec(Y))+"g")),Y.lastIndex=0;st=Y.exec(lt);)var ht=st.index;Oe=Oe.slice(0,ht===t?Ce:ht)}}else if(m.indexOf(Gr(Y),Ce)!=Ce){var kt=Oe.lastIndexOf(Y);kt>-1&&(Oe=Oe.slice(0,kt))}return Oe+R}function c(m){return m=qn(m),m&&Mt.test(m)?m.replace(nt,wh):m}var p=Mr(function(m,y,k){return m+(k?" ":"")+y.toUpperCase()}),x=ua("toUpperCase");function N(m,y,k){return m=qn(m),y=k?t:y,y===t?yh(m)?Ts(m):gp(m):m.match(y)||[]}var D=sn(function(m,y){try{return Ji(m,t,y)}catch(k){return Hi(k)?k:new zt(k)}}),H=pi(function(m,y){return gr(y,function(k){k=Vn(k),Ja(m,k,xl(m[k],m))}),m});function Z(m){var y=m==null?0:m.length,k=$t();return m=y?ri(m,function(R){if(typeof R[1]!="function")throw new Er(l);return[k(R[0]),R[1]]}):[],sn(function(R){for(var Y=-1;++Y<y;){var oe=m[Y];if(Ji(oe[0],this,R))return Ji(oe[1],this,R)}})}function we(m){return $g(xr(m,g))}function Ue(m){return function(){return m}}function et(m,y){return m==null||m!==m?y:m}var ot=Ps(),We=Ps(!0);function qe(m){return m}function qt(m){return Ep(typeof m=="function"?m:xr(m,g))}function Ut(m){return Dp(xr(m,g))}function ti(m,y){return Mh(m,xr(y,g))}var Re=sn(function(m,y){return function(k){return rc(k,m,y)}}),Te=sn(function(m,y){return function(k){return rc(m,k,y)}});function Be(m,y,k){var R=Gi(y),Y=ol(y,R);k==null&&!(xi(y)&&(Y.length||!R.length))&&(k=y,y=m,m=this,Y=ol(y,Gi(y)));var oe=!(xi(k)&&"chain"in k)||!!k.chain,be=es(m);return gr(Y,function(Ce){var Oe=y[Ce];m[Ce]=Oe,be&&(m.prototype[Ce]=function(){var st=this.__chain__;if(oe||st){var lt=m(this.__wrapped__),ht=lt.__actions__=Ui(this.__actions__);return ht.push({func:Oe,args:arguments,thisArg:m}),lt.__chain__=st,lt}return Oe.apply(m,sa([this.value()],arguments))})}),m}function at(){return Ni._===this&&(Ni._=Xo),this}function It(){}function yn(m){return m=nn(m),sn(function(y){return Pp(y,m)})}var Ot=md(ri),Vt=md(Ho),nr=md(Rc);function On(m){return Kh(m)?Wo(Vn(m)):Hg(m)}function jl(m){return function(y){return m==null?t:Sa(m,y)}}var Uv=cl(),lA=cl(!0);function qv(){return[]}function Vv(){return!1}function cA(){return{}}function uA(){return""}function dA(){return!0}function hA(m,y){if(m=nn(m),m<1||m>W)return[];var k=te,R=se(m,te);y=$t(y),m-=te;for(var Y=Ss(R,y);++k<m;)y(k);return Y}function fA(m){return Jt(m)?ri(m,Vn):Or(m)?[m]:Ui(Rs(qn(m)))}function pA(m){var y=++oa;return qn(m)+y}var mA=Kc(function(m,y){return m+y},0),gA=Vh("ceil"),yA=Kc(function(m,y){return m/y},1),xA=Vh("floor");function bA(m){return m&&m.length?Xa(m,qe,td):t}function vA(m,y){return m&&m.length?Xa(m,$t(y,2),td):t}function wA(m){return Lc(m,qe)}function NA(m,y){return Lc(m,$t(y,2))}function SA(m){return m&&m.length?Xa(m,qe,Ih):t}function jA(m,y){return m&&m.length?Xa(m,$t(y,2),Ih):t}var _A=Kc(function(m,y){return m*y},1),CA=Vh("round"),kA=Kc(function(m,y){return m-y},0);function TA(m){return m&&m.length?va(m,qe):0}function EA(m,y){return m&&m.length?va(m,$t(y,2)):0}return X.after=pv,X.ary=qy,X.assign=_v,X.assignIn=ax,X.assignInWith=xf,X.assignWith=Cv,X.at=kv,X.before=Ad,X.bind=xl,X.bindAll=H,X.bindKey=cf,X.castArray=xv,X.chain=cu,X.chunk=ov,X.compact=gy,X.concat=yy,X.cond=Z,X.conforms=we,X.constant=Ue,X.countBy=uu,X.create=Tv,X.curry=Dd,X.curryRight=uf,X.debounce=bl,X.defaults=Ev,X.defaultsDeep=sx,X.defer=Ls,X.delay=Pd,X.difference=yi,X.differenceBy=Wr,X.differenceWith=wo,X.drop=xy,X.dropRight=by,X.dropRightWhile=lv,X.dropWhile=Kp,X.fill=da,X.filter=Dy,X.flatMap=dm,X.flatMapDeep=dv,X.flatMapDepth=hv,X.flatten=Qr,X.flattenDeep=vy,X.flattenDepth=hl,X.flip=mv,X.flow=ot,X.flowRight=We,X.fromPairs=hc,X.functions=lx,X.functionsIn=bf,X.groupBy=My,X.initial=em,X.intersection=Os,X.intersectionBy=wy,X.intersectionWith=tu,X.invert=cx,X.invertBy=ux,X.invokeMap=sf,X.iteratee=qt,X.keyBy=Ry,X.keys=Gi,X.keysIn=tr,X.map=Ed,X.mapKeys=Pv,X.mapValues=Iv,X.matches=Ut,X.matchesProperty=ti,X.memoize=Id,X.merge=Mv,X.mergeWith=zd,X.method=Re,X.methodOf=Te,X.mixin=Be,X.negate=Md,X.nthArg=yn,X.omit=vf,X.omitBy=jm,X.once=Vy,X.orderBy=Oy,X.over=Ot,X.overArgs=Hy,X.overEvery=Vt,X.overSome=nr,X.partial=pm,X.partialRight=df,X.partition=Ly,X.pick=Rv,X.pickBy=yu,X.property=On,X.propertyOf=jl,X.pull=Sy,X.pullAll=iu,X.pullAllBy=jy,X.pullAllWith=rf,X.pullAt=_y,X.range=Uv,X.rangeRight=lA,X.rearg=Gy,X.reject=of,X.remove=cv,X.rest=Yy,X.reverse=tm,X.sampleSize=By,X.set=dx,X.setWith=hx,X.shuffle=oi,X.slice=Wn,X.sortBy=Uy,X.sortedUniq=ru,X.sortedUniqBy=nm,X.split=_f,X.spread=gv,X.tail=So,X.take=Ti,X.takeRight=pl,X.takeRightWhile=fc,X.takeWhile=im,X.tap=lm,X.throttle=mm,X.thru=wr,X.toArray=pa,X.toPairs=_m,X.toPairsIn=Cm,X.toPath=fA,X.toPlainObject=rx,X.transform=km,X.unary=gm,X.union=Ca,X.unionBy=au,X.unionWith=kd,X.uniq=Jr,X.uniqBy=rm,X.uniqWith=am,X.unset=fx,X.unzip=su,X.unzipWith=Td,X.update=wf,X.updateWith=Lv,X.values=xu,X.valuesIn=Tm,X.without=ml,X.words=N,X.wrap=yv,X.xor=ur,X.xorBy=gl,X.xorWith=ou,X.zip=lu,X.zipObject=sm,X.zipObjectDeep=om,X.zipWith=Cy,X.entries=_m,X.entriesIn=Cm,X.extend=ax,X.extendWith=xf,Be(X,X),X.add=mA,X.attempt=D,X.camelCase=px,X.capitalize=Sf,X.ceil=gA,X.clamp=Em,X.clone=Rd,X.cloneDeep=Wy,X.cloneDeepWith=vn,X.cloneWith=bv,X.conformsTo=ym,X.deburr=_o,X.defaultTo=et,X.divide=yA,X.endsWith=wl,X.eq=Kr,X.escape=Nl,X.escapeRegExp=Bd,X.every=Ay,X.find=Py,X.findIndex=_a,X.findKey=pu,X.findLast=um,X.findLastIndex=Xp,X.findLastKey=Ld,X.floor=xA,X.forEach=Iy,X.forEachRight=hm,X.forIn=ox,X.forInRight=Av,X.forOwn=mu,X.forOwnRight=Fd,X.get=$d,X.gt=xm,X.gte=Qy,X.has=Sm,X.hasIn=gu,X.head=No,X.identity=qe,X.includes=du,X.indexOf=Zp,X.inRange=Nf,X.invoke=Dv,X.isArguments=jo,X.isArray=Jt,X.isArrayBuffer=hf,X.isArrayLike=Vi,X.isArrayLikeObject=Ei,X.isBoolean=vv,X.isBuffer=vl,X.isDate=Jy,X.isElement=Ky,X.isEmpty=ff,X.isEqual=ei,X.isEqualWith=bm,X.isError=Hi,X.isFinite=wv,X.isFunction=es,X.isInteger=pf,X.isLength=pc,X.isMap=mf,X.isMatch=vm,X.isMatchWith=Nv,X.isNaN=Xy,X.isNative=Sv,X.isNil=jv,X.isNull=Zy,X.isNumber=ex,X.isObject=xi,X.isObjectLike=ji,X.isPlainObject=ka,X.isRegExp=gf,X.isSafeInteger=wm,X.isSet=tx,X.isString=yf,X.isSymbol=Or,X.isTypedArray=hu,X.isUndefined=ts,X.isWeakMap=Nm,X.isWeakSet=nx,X.join=Cd,X.kebabCase=Ud,X.last=vr,X.lastIndexOf=nu,X.lowerCase=Sl,X.lowerFirst=Fv,X.lt=ix,X.lte=Od,X.max=bA,X.maxBy=vA,X.mean=wA,X.meanBy=NA,X.min=SA,X.minBy=jA,X.stubArray=qv,X.stubFalse=Vv,X.stubObject=cA,X.stubString=uA,X.stubTrue=dA,X.multiply=_A,X.nth=Ny,X.noConflict=at,X.noop=It,X.now=lf,X.pad=mx,X.padEnd=qd,X.padStart=$v,X.parseInt=gx,X.random=Am,X.reduce=Fy,X.reduceRight=$y,X.repeat=jf,X.replace=yx,X.result=Ov,X.round=CA,X.runInContext=Ae,X.sample=zy,X.size=fm,X.snakeCase=zv,X.some=fv,X.sortedIndex=ci,X.sortedIndexBy=bn,X.sortedIndexOf=In,X.sortedLastIndex=Qn,X.sortedLastIndexBy=ha,X.sortedLastIndexOf=fl,X.startCase=Cf,X.startsWith=xx,X.subtract=kA,X.sum=TA,X.sumBy=EA,X.template=Vd,X.times=hA,X.toFinite=Fs,X.toInteger=nn,X.toLength=$s,X.toLower=Dm,X.toNumber=Ta,X.toSafeInteger=fu,X.toString=qn,X.toUpper=kf,X.trim=bx,X.trimEnd=Bv,X.trimStart=Tf,X.truncate=s,X.unescape=c,X.uniqueId=pA,X.upperCase=p,X.upperFirst=x,X.each=Iy,X.eachRight=hm,X.first=No,Be(X,function(){var m={};return br(X,function(y,k){Rn.call(X.prototype,k)||(m[k]=y)}),m}(),{chain:!1}),X.VERSION=r,gr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(m){X[m].placeholder=X}),gr(["drop","take"],function(m,y){gn.prototype[m]=function(k){k=k===t?1:le(nn(k),0);var R=this.__filtered__&&!y?new gn(this):this.clone();return R.__filtered__?R.__takeCount__=se(k,R.__takeCount__):R.__views__.push({size:se(k,te),type:m+(R.__dir__<0?"Right":"")}),R},gn.prototype[m+"Right"]=function(k){return this.reverse()[m](k).reverse()}}),gr(["filter","map","takeWhile"],function(m,y){var k=y+1,R=k==ie||k==J;gn.prototype[m]=function(Y){var oe=this.clone();return oe.__iteratees__.push({iteratee:$t(Y,3),type:k}),oe.__filtered__=oe.__filtered__||R,oe}}),gr(["head","last"],function(m,y){var k="take"+(y?"Right":"");gn.prototype[m]=function(){return this[k](1).value()[0]}}),gr(["initial","tail"],function(m,y){var k="drop"+(y?"":"Right");gn.prototype[m]=function(){return this.__filtered__?new gn(this):this[k](1)}}),gn.prototype.compact=function(){return this.filter(qe)},gn.prototype.find=function(m){return this.filter(m).head()},gn.prototype.findLast=function(m){return this.reverse().find(m)},gn.prototype.invokeMap=sn(function(m,y){return typeof m=="function"?new gn(this):this.map(function(k){return rc(k,m,y)})}),gn.prototype.reject=function(m){return this.filter(Md($t(m)))},gn.prototype.slice=function(m,y){m=nn(m);var k=this;return k.__filtered__&&(m>0||y<0)?new gn(k):(m<0?k=k.takeRight(-m):m&&(k=k.drop(m)),y!==t&&(y=nn(y),k=y<0?k.dropRight(-y):k.take(y-m)),k)},gn.prototype.takeRightWhile=function(m){return this.reverse().takeWhile(m).reverse()},gn.prototype.toArray=function(){return this.take(te)},br(gn.prototype,function(m,y){var k=/^(?:filter|find|map|reject)|While$/.test(y),R=/^(?:head|last)$/.test(y),Y=X[R?"take"+(y=="last"?"Right":""):y],oe=R||/^find/.test(y);Y&&(X.prototype[y]=function(){var be=this.__wrapped__,Ce=R?[1]:arguments,Oe=be instanceof gn,st=Ce[0],lt=Oe||Jt(be),ht=function(kn){var Ln=Y.apply(X,sa([kn],Ce));return R&&kt?Ln[0]:Ln};lt&&k&&typeof st=="function"&&st.length!=1&&(Oe=lt=!1);var kt=this.__chain__,Rt=!!this.__actions__.length,Yt=oe&&!kt,xn=Oe&&!Rt;if(!oe&&lt){be=xn?be:new gn(this);var Wt=m.apply(be,Ce);return Wt.__actions__.push({func:wr,args:[ht],thisArg:t}),new qr(Wt,kt)}return Yt&&xn?m.apply(this,Ce):(Wt=this.thru(ht),Yt?R?Wt.value()[0]:Wt.value():Wt)})}),gr(["pop","push","shift","sort","splice","unshift"],function(m){var y=Bc[m],k=/^(?:push|sort|unshift)$/.test(m)?"tap":"thru",R=/^(?:pop|shift)$/.test(m);X.prototype[m]=function(){var Y=arguments;if(R&&!this.__chain__){var oe=this.value();return y.apply(Jt(oe)?oe:[],Y)}return this[k](function(be){return y.apply(Jt(be)?be:[],Y)})}}),br(gn.prototype,function(m,y){var k=X[y];if(k){var R=k.name+"";Rn.call(wa,R)||(wa[R]=[]),wa[R].push({name:y,func:k})}}),wa[ki(t,C).name]=[{name:"wrapper",func:t}],gn.prototype.clone=Ju,gn.prototype.reverse=Sh,gn.prototype.value=Zl,X.prototype.at=ky,X.prototype.chain=fa,X.prototype.commit=Ty,X.prototype.next=Ey,X.prototype.plant=yl,X.prototype.reverse=af,X.prototype.toJSON=X.prototype.valueOf=X.prototype.value=cm,X.prototype.first=X.prototype.head,Es&&(X.prototype[Es]=uv),X},Ki=Tr();Ha?((Ha.exports=Ki)._=Ki,Va._=Ki):Ni._=Ki}).call(DH)}(Jm,Jm.exports)),Jm.exports}var vT=PH();class IH{constructor(n){ui(this,"sampleRate",24e3);ui(this,"bufferSize",7680);ui(this,"audioQueue",[]);ui(this,"isPlaying",!1);ui(this,"isStreamComplete",!1);ui(this,"checkInterval",null);ui(this,"scheduledTime",0);ui(this,"initialBufferTime",.1);ui(this,"gainNode");ui(this,"source");ui(this,"endOfQueueAudioSource",null);ui(this,"onComplete",()=>{});this.context=n,this.gainNode=this.context.createGain(),this.source=this.context.createBufferSource(),this.gainNode.connect(this.context.destination),this.addPCM16=this.addPCM16.bind(this)}async addWorklet(n,t,r){let a=Rx.get(this.context);if(a&&a[n])return a[n].handlers.push(r),Promise.resolve(this);a||(Rx.set(this.context,{}),a=Rx.get(this.context)),a[n]={handlers:[r]};const o=L1(n,t);await this.context.audioWorklet.addModule(o);const l=new AudioWorkletNode(this.context,n);return a[n].node=l,this}_processPCM16Chunk(n){const t=new Float32Array(n.length/2),r=new DataView(n.buffer);for(let a=0;a<n.length/2;a++)try{const o=r.getInt16(a*2,!0);t[a]=o/32768}catch(o){console.error(o)}return t}addPCM16(n){this.isStreamComplete=!1;let t=this._processPCM16Chunk(n);for(;t.length>=this.bufferSize;){const r=t.slice(0,this.bufferSize);this.audioQueue.push(r),t=t.slice(this.bufferSize)}t.length>0&&this.audioQueue.push(t),this.isPlaying||(this.isPlaying=!0,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.scheduleNextBuffer())}createAudioBuffer(n){const t=this.context.createBuffer(1,n.length,this.sampleRate);return t.getChannelData(0).set(n),t}scheduleNextBuffer(){for(;this.audioQueue.length>0&&this.scheduledTime<this.context.currentTime+.2;){const t=this.audioQueue.shift(),r=this.createAudioBuffer(t),a=this.context.createBufferSource();this.audioQueue.length===0&&(this.endOfQueueAudioSource&&(this.endOfQueueAudioSource.onended=null),this.endOfQueueAudioSource=a,a.onended=()=>{!this.audioQueue.length&&this.endOfQueueAudioSource===a&&(this.endOfQueueAudioSource=null,this.onComplete())}),a.buffer=r,a.connect(this.gainNode);const o=Rx.get(this.context);o&&Object.entries(o).forEach(([,h])=>{const{node:d,handlers:u}=h;d&&(a.connect(d),d.port.onmessage=function(f){u.forEach(g=>{g.call(d.port,f)})},d.connect(this.context.destination))});const l=Math.max(this.scheduledTime,this.context.currentTime);a.start(l),this.scheduledTime=l+r.duration}if(this.audioQueue.length===0)this.isStreamComplete?(this.isPlaying=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)):this.checkInterval||(this.checkInterval=window.setInterval(()=>{this.audioQueue.length>0&&this.scheduleNextBuffer()},100));else{const t=(this.scheduledTime-this.context.currentTime)*1e3;setTimeout(()=>this.scheduleNextBuffer(),Math.max(0,t-50))}}stop(){this.isPlaying=!1,this.isStreamComplete=!0,this.audioQueue=[],this.scheduledTime=this.context.currentTime,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.1),setTimeout(()=>{this.gainNode.disconnect(),this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)},200)}async resume(){this.context.state==="suspended"&&await this.context.resume(),this.isStreamComplete=!1,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.gainNode.gain.setValueAtTime(1,this.context.currentTime)}complete(){this.isStreamComplete=!0,this.onComplete()}}function MH(){const[e,n]=w.useState(null),[t,r]=w.useState(!1);return w.useEffect(()=>{const h=()=>{r(!1),n(null)};if(e)return e.getTracks().forEach(d=>d.addEventListener("ended",h)),()=>{e.getTracks().forEach(d=>d.removeEventListener("ended",h))}},[e]),{type:"screen",start:async()=>{const h=await navigator.mediaDevices.getDisplayMedia({video:!0});return n(h),r(!0),h},stop:()=>{e&&(e.getTracks().forEach(h=>h.stop()),n(null),r(!1))},isStreaming:t,stream:e}}function RH(){const[e,n]=w.useState(null),[t,r]=w.useState(!1);return w.useEffect(()=>{const h=()=>{r(!1),n(null)};if(e)return e.getTracks().forEach(d=>d.addEventListener("ended",h)),()=>{e.getTracks().forEach(d=>d.removeEventListener("ended",h))}},[e]),{type:"webcam",start:async()=>{const h=await navigator.mediaDevices.getUserMedia({video:!0});return n(h),r(!0),h},stop:()=>{e&&(e.getTracks().forEach(h=>h.stop()),n(null),r(!1))},isStreaming:t,stream:e}}class OH extends xT{constructor(t){super();ui(this,"client");ui(this,"_status","disconnected");ui(this,"_session",null);ui(this,"_model",null);ui(this,"config",null);this.client=new Sg(t),this.send=this.send.bind(this),this.onopen=this.onopen.bind(this),this.onerror=this.onerror.bind(this),this.onclose=this.onclose.bind(this),this.onmessage=this.onmessage.bind(this)}get status(){return this._status}get session(){return this._session}get model(){return this._model}getConfig(){return{...this.config}}log(t,r){const a={date:new Date,type:t,message:r};this.emit("log",a)}async connect(t,r){if(this._status==="connected"||this._status==="connecting")return!1;this._status="connecting",this.config=r,this._model=t;const a={onopen:this.onopen,onmessage:this.onmessage,onerror:this.onerror,onclose:this.onclose};try{this._session=await this.client.live.connect({model:t,config:r,callbacks:a})}catch(o){return console.error("Error connecting to GenAI Live:",o),this._status="disconnected",!1}return this._status="connected",!0}disconnect(){var t;return this.session?((t=this.session)==null||t.close(),this._session=null,this._status="disconnected",this.log("client.close","Disconnected"),!0):!1}onopen(){this.log("client.open","Connected"),this.emit("open")}onerror(t){this.log("server.error",t.message),this.emit("error",t)}onclose(t){this.log("server.close",`disconnected ${t.reason?`with reason: ${t.reason}`:""}`),this.emit("close",t)}async onmessage(t){var r;if(t.setupComplete){this.log("server.send","setupComplete"),this.emit("setupcomplete");return}if(t.toolCall){this.log("server.toolCall",t),this.emit("toolcall",t.toolCall);return}if(t.toolCallCancellation){this.log("server.toolCallCancellation",t),this.emit("toolcallcancellation",t.toolCallCancellation);return}if(t.serverContent){const{serverContent:a}=t;if("interrupted"in a){this.log("server.content","interrupted"),this.emit("interrupted");return}if("turnComplete"in a&&(this.log("server.content","turnComplete"),this.emit("turncomplete")),"modelTurn"in a){let o=((r=a.modelTurn)==null?void 0:r.parts)||[];const l=o.filter(f=>{var g;return f.inlineData&&((g=f.inlineData.mimeType)==null?void 0:g.startsWith("audio/pcm"))}),h=l.map(f=>{var g;return(g=f.inlineData)==null?void 0:g.data}),d=vT.difference(o,l);if(h.forEach(f=>{if(f){const g=jH(f);this.emit("audio",g),this.log("server.audio",`buffer (${g.byteLength})`)}}),!d.length)return;o=d;const u={modelTurn:{parts:o}};this.emit("content",u),this.log("server.content",t)}}else console.log("received unmatched message",t)}sendRealtimeInput(t){var l;let r=!1,a=!1;for(const h of t)if((l=this.session)==null||l.sendRealtimeInput({media:h}),h.mimeType.includes("audio")&&(r=!0),h.mimeType.includes("image")&&(a=!0),r&&a)break;const o=r&&a?"audio + video":r?"audio":a?"video":"unknown";this.log("client.realtimeInput",o)}sendToolResponse(t){var r;t.functionResponses&&t.functionResponses.length&&((r=this.session)==null||r.sendToolResponse({functionResponses:t.functionResponses}),this.log("client.toolResponse",t))}send(t,r=!0){var a;(a=this.session)==null||a.sendClientContent({turns:t,turnComplete:r}),this.log("client.send",{turns:Array.isArray(t)?t:[t],turnComplete:r})}}function LH(e){const n=w.useMemo(()=>new OH(e),[e]),t=w.useRef(null),[r,a]=w.useState("models/gemini-2.5-flash-live-preview"),[o,l]=w.useState({}),[h,d]=w.useState(!1),[u,f]=w.useState(0),[g,b]=w.useState(null);w.useEffect(()=>{t.current||gT({id:"audio-out"}).then(T=>{t.current=new IH(T),t.current.addWorklet("vumeter-out",yT,E=>{f(E.data.volume)}).then(()=>{})})},[t]),w.useEffect(()=>{const T=()=>{d(!0)},E=()=>{d(!1)},C=L=>{console.error("error",L)},P=()=>{var L;return(L=t.current)==null?void 0:L.stop()},I=L=>{var O;return(O=t.current)==null?void 0:O.addPCM16(new Uint8Array(L))},q=L=>{if(console.log("Received content event:",L),L.modelTurn&&L.modelTurn.parts){const O=L.modelTurn.parts.filter(B=>"text"in B&&B.text&&!B.thought);if(O.length>0){const B=O.map($=>$.text).join(" ");b(B),console.log("AI Summary received:",B)}}};return n.on("error",C).on("open",T).on("close",E).on("interrupted",P).on("audio",I).on("content",q),()=>{n.off("error",C).off("open",T).off("close",E).off("interrupted",P).off("audio",I).off("content",q).disconnect()}},[n]);const v=w.useCallback(async()=>{if(!o)throw new Error("config has not been set");n.disconnect(),await n.connect(r,o)},[n,o,r]),S=w.useCallback(async()=>{n.disconnect(),d(!1)},[d,n]);return{client:n,config:o,setConfig:l,model:r,setModel:a,connected:h,connect:v,disconnect:S,volume:u,aiSummary:g}}const wT=w.createContext(void 0),Jw=({options:e,children:n})=>{const t=LH(e);return i.jsx(wT.Provider,{value:t,children:n})},oh=()=>{const e=w.useContext(wT);if(!e)throw new Error("useLiveAPIContext must be used wihin a LiveAPIProvider");return e},d_=[{value:"Puck",label:"Puck"},{value:"Charon",label:"Charon"},{value:"Kore",label:"Kore"},{value:"Fenrir",label:"Fenrir"},{value:"Aoede",label:"Aoede"}];function FH(){const{config:e,setConfig:n}=oh();w.useEffect(()=>{var h,d,u;const o=((u=(d=(h=e.speechConfig)==null?void 0:h.voiceConfig)==null?void 0:d.prebuiltVoiceConfig)==null?void 0:u.voiceName)||"Atari02";r({value:o,label:o})},[e]);const[t,r]=w.useState(d_[5]),a=w.useCallback(o=>{n({...e,speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:o}}}})},[e,n]);return i.jsxs("div",{className:"select-group",children:[i.jsx("label",{htmlFor:"voice-selector",children:"Voice"}),i.jsx(SH,{id:"voice-selector",className:"react-select",classNamePrefix:"react-select",styles:{},value:t,defaultValue:t,options:d_,onChange:o=>{r(o),o&&a(o.value)}})]})}function $H(){const[e,n]=w.useState(!1),{config:t,setConfig:r,connected:a}=oh(),o=w.useMemo(()=>Array.isArray(t.tools)?t.tools.filter(u=>Array.isArray(u.functionDeclarations)).map(u=>u.functionDeclarations).filter(u=>!!u).flat():[],[t]),l=w.useMemo(()=>{var u;return t.systemInstruction?typeof t.systemInstruction=="string"?t.systemInstruction:Array.isArray(t.systemInstruction)?t.systemInstruction.map(f=>typeof f=="string"?f:f.text).join(`
`):typeof t.systemInstruction=="object"&&"parts"in t.systemInstruction&&((u=t.systemInstruction.parts)==null?void 0:u.map(f=>f.text).join(`
`))||"":""},[t]),h=w.useCallback(u=>{const f={...t,systemInstruction:u.target.value};r(f)},[t,r]),d=w.useCallback((u,f)=>{var b;const g={...t,tools:((b=t.tools)==null?void 0:b.map(v=>{const S=v;return Array.isArray(S.functionDeclarations)?{...v,functionDeclarations:S.functionDeclarations.map(T=>T.name===u?{...T,description:f}:T)}:v}))||[]};r(g)},[t,r]);return i.jsxs("div",{className:"settings-dialog",children:[i.jsx("button",{className:"action-button material-symbols-outlined",onClick:()=>n(!e),children:"settings"}),i.jsx("dialog",{className:"dialog",style:{display:e?"block":"none"},children:i.jsxs("div",{className:`dialog-container ${a?"disabled":""}`,children:[a&&i.jsx("div",{className:"connected-indicator",children:i.jsx("p",{children:"These settings can only be applied before connecting and will override other settings."})}),i.jsx("div",{className:"mode-selectors",children:i.jsx(FH,{})}),i.jsx("h3",{children:"System Instructions"}),i.jsx("textarea",{className:"system",onChange:h,value:l}),i.jsx("h4",{children:"Function declarations"}),i.jsx("div",{className:"function-declarations",children:i.jsx("div",{className:"fd-rows",children:o.map((u,f)=>{var g;return i.jsxs("div",{className:"fd-row",children:[i.jsx("span",{className:"fd-row-name",children:u.name}),i.jsx("span",{className:"fd-row-args",children:Object.keys(((g=u.parameters)==null?void 0:g.properties)||{}).map((b,v)=>i.jsx("span",{children:b},v))}),i.jsx("input",{className:"fd-row-description",type:"text",defaultValue:u.description,onBlur:b=>d(u.name,b.target.value)},`fd-${u.description}`)]},`function-${f}`)})})})]})})]})}const h_=w.memo(({isStreaming:e,onIcon:n,offIcon:t,start:r,stop:a})=>e?i.jsx("button",{className:"action-button",onClick:a,children:i.jsx("span",{className:"material-symbols-outlined",children:n})}):i.jsx("button",{className:"action-button",onClick:r,children:i.jsx("span",{className:"material-symbols-outlined",children:t})}));function zH({videoRef:e,children:n,onVideoStreamChange:t=()=>{},supportsVideo:r,enableEditingSettings:a}){const o=[RH(),MH()],[l,h]=w.useState(null),[d,u]=o,[f,g]=w.useState(0),[b]=w.useState(()=>new bT),[v,S]=w.useState(!1),T=w.useRef(null),E=w.useRef(null),{client:C,connected:P,connect:I,disconnect:q,volume:L}=oh();w.useEffect(()=>{!P&&E.current&&E.current.focus()},[P]),w.useEffect(()=>{document.documentElement.style.setProperty("--volume",`${Math.max(5,Math.min(f*200,8))}px`)},[f]),w.useEffect(()=>{const B=$=>{C.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:$}])};return P&&!v&&b?b.on("data",B).on("volume",g).start():b.stop(),()=>{b.off("data",B).off("volume",g)}},[P,C,v,b]),w.useEffect(()=>{e.current&&(e.current.srcObject=l);let B=-1;function $(){const F=e.current,z=T.current;if(!F||!z)return;const U=z.getContext("2d");if(z.width=F.videoWidth*.25,z.height=F.videoHeight*.25,z.width+z.height>0){U.drawImage(F,0,0,z.width,z.height);const V=z.toDataURL("image/jpeg",1),ee=V.slice(V.indexOf(",")+1,1/0);C.sendRealtimeInput([{mimeType:"image/jpeg",data:ee}])}P&&(B=window.setTimeout($,1e3/.5))}return P&&l!==null&&requestAnimationFrame($),()=>{clearTimeout(B)}},[P,l,C,e]);const O=B=>async()=>{if(B){const $=await B.start();h($),t($)}else h(null),t(null);o.filter($=>$!==B).forEach($=>$.stop())};return i.jsxs("section",{className:"control-tray",children:[i.jsx("canvas",{style:{display:"none"},ref:T}),i.jsxs("nav",{className:_u("actions-nav",{disabled:!P}),children:[i.jsx("button",{className:_u("action-button mic-button",{recording:!v&&P}),onClick:()=>S(!v),children:v?i.jsx("span",{className:"material-symbols-outlined filled",children:"mic_off"}):i.jsx("span",{className:"material-symbols-outlined filled",children:"mic"})}),i.jsx("div",{className:"action-button no-action outlined",children:i.jsx(AH,{volume:L,active:P,hover:!1})}),r&&i.jsxs(i.Fragment,{children:[i.jsx(h_,{isStreaming:u.isStreaming,start:O(u),stop:O(),onIcon:"cancel_presentation",offIcon:"present_to_all"}),i.jsx(h_,{isStreaming:d.isStreaming,start:O(d),stop:O(),onIcon:"videocam_off",offIcon:"videocam"})]}),n]}),i.jsxs("div",{className:_u("connection-container",{connected:P}),children:[i.jsx("div",{className:"connection-button-container",children:i.jsx("button",{ref:E,className:_u("action-button connect-toggle",{connected:P}),onClick:P?q:I,children:i.jsx("span",{className:"material-symbols-outlined filled",children:P?"pause":"play_arrow"})})}),i.jsx("span",{className:"text-indicator",children:"Streaming"})]}),a?i.jsx($H,{}):""]})}const f_={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:np.OBJECT,properties:{summary:{type:np.STRING,description:"The summary of the patient's case."}},required:["summary"]}},BH=({patientData:e,tokenNumber:n})=>{const[t,r]=w.useState(""),{client:a,setConfig:o,setModel:l}=oh();return w.useEffect(()=>{l("models/gemini-2.5-flash-live-preview"),o({responseModalities:[ip.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},systemInstruction:{parts:[{text:`Your job is to:

If patient details like name, age, sex, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details (e.g., phone number) are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's name, age, sex, and phone number.

When pronouncing a phone number, always state each digit individually (e.g., "six three" instead of "sixty-three" or "six billion three").

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception. You should always speak in Telugu.dont write the telugu words in english`}]},tools:[{functionDeclarations:[f_]}]})},[o,l]),w.useEffect(()=>{const h=d=>{if(!d.functionCalls)return;const u=d.functionCalls.find(f=>f.name===f_.name);if(u){const f=u.args.summary;r(f)}d.functionCalls.length&&setTimeout(()=>{var f;return a.sendToolResponse({functionResponses:(f=d.functionCalls)==null?void 0:f.map(g=>({response:{output:{success:!0}},id:g.id,name:g.name}))})},200)};return a.on("toolcall",h),()=>{a.off("toolcall",h)}},[a]),w.useEffect(()=>{if(t){const h=encodeURIComponent(t);n?window.location.href=`https://hms.newtons.in/handle-complaint-url?token=${n}&caseDetails=${h}`:window.location.href=`https://hms.newtons.in/dashboard/search-patient?caseDetails=${h}`}},[t,n]),i.jsxs("div",{className:"hospital-reception",children:[i.jsx("h1",{children:"Newtons Ai"}),i.jsx("p",{children:"Newtons Ai"}),n&&i.jsxs("h2",{children:["Token Number: ",n]}),e&&i.jsxs("div",{children:[i.jsx("h2",{children:"Patient Details"}),i.jsx("pre",{children:JSON.stringify(e,null,2)})]}),t&&i.jsxs("div",{children:[i.jsx("h2",{children:"Case Summary (from Tool Call)"}),i.jsx("p",{children:t})]})]})};async function UH(){const e=nh();if(!e)throw new Error("Authentication token not found. Please log in.");try{const r=(await(await ce("/api/clinics/settings",{headers:{Authorization:`Bearer ${e}`}})).json()).gemini_api_key;if(r)return console.log("Using clinic-specific Live API key."),r}catch(n){console.warn("Failed to fetch clinic-specific Live API key, trying global fallback.",n)}try{const r=(await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${e}`}})).json()).gemini_api_key;if(r)return console.log("Using global Live API key."),r}catch(n){console.warn("Failed to fetch global Live API key.",n)}throw new Error("Live API key not found. Please contact your administrator.")}function qH(){const e=w.useRef(null),[n,t]=w.useState(null),[r,a]=w.useState(null);return w.useEffect(()=>{(async()=>{try{const l=await UH();a({apiKey:l})}catch(l){console.error("Error setting Live API options:",l)}})()},[]),r?i.jsx("div",{className:"App",children:i.jsx(Jw,{options:r,children:i.jsx(VH,{videoRef:e,setVideoStream:t,videoStream:n})})}):i.jsx("div",{children:"Loading Live API settings..."})}const VH=({videoRef:e,setVideoStream:n,videoStream:t})=>{const[r,a]=w.useState(null),[o,l]=w.useState(null),{connected:h,client:d,connect:u,config:f,model:g}=oh(),[b,v]=w.useState(""),S=w.useRef(null),[T,E]=w.useState(!1);w.useEffect(()=>{const P=window.matchMedia("(prefers-color-scheme: dark)"),I=q=>{document.documentElement.setAttribute("data-theme",q.matches?"dark":"light")};return I(P),P.addEventListener("change",I),()=>P.removeEventListener("change",I)},[]),w.useEffect(()=>{const P=new URLSearchParams(window.location.search),I={};for(const[q,L]of P.entries())q==="token_number"?l(L):I[q]=L;a(I)},[]),w.useEffect(()=>{Object.keys(f).length>0&&g&&u()},[u,f,g]),w.useEffect(()=>{if(h&&r&&!T){const P=JSON.stringify(r,null,2);d.send([{text:P}]),v(""),E(!0)}},[h,r,d,T]),w.useEffect(()=>{r&&v(JSON.stringify(r,null,2))},[r]);const C=()=>{d.send([{text:b}]),v(""),S.current&&(S.current.innerText="")};return i.jsx("div",{className:"streaming-console",children:i.jsxs("main",{children:[i.jsxs("div",{className:"main-app-area",children:[i.jsx(BH,{patientData:r,tokenNumber:o}),i.jsx("video",{className:_u("stream",{hidden:!e.current||!t}),ref:e,autoPlay:!0,playsInline:!0})]}),i.jsx("div",{className:_u("input-container",{disabled:!h}),children:i.jsxs("div",{className:"input-content",children:[i.jsx("textarea",{className:"input-area",ref:S,onKeyDown:P=>{P.key==="Enter"&&!P.shiftKey&&(P.preventDefault(),P.stopPropagation(),C())},onChange:P=>v(P.target.value),value:b}),i.jsx("span",{className:_u("input-content-placeholder",{hidden:b.length}),children:"Typesomething..."}),i.jsx("button",{className:"send-button material-symbols-outlined filled",onClick:C,children:"send"})]})}),i.jsx(zH,{videoRef:e,supportsVideo:!0,onVideoStreamChange:n,enableEditingSettings:!0})]})})},p_="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",HH=({volume:e,active:n})=>{const t=Array.from({length:5},(r,a)=>i.jsx("div",{className:`audio-bar ${n?"active":""}`,style:{height:n?`${Math.min(24,20+e*40*(1+Math.sin(a)*.3))}px`:"8px",animationDelay:`${a*.1}s`}},a));return i.jsx("div",{className:"audio-pulse",children:t})},GH=w.forwardRef(({videoRef:e,supportsVideo:n,onVideoStreamChange:t,textInput:r,onSubmitTextInput:a},o)=>{var O;const{connected:l,connect:h,disconnect:d,client:u,volume:f}=oh(),[g,b]=w.useState(!1),[v,S]=w.useState(!1),[T,E]=w.useState(!1),[C]=w.useState(()=>new bT),P=async()=>{l?await d():(await h(),r.trim()&&a())};w.useEffect(()=>{const B=$=>{u.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:$}])};return l&&!g?C.on("data",B).start():C.stop(),()=>{C.off("data",B),C.stop()}},[l,u,g,C]);const I=w.useCallback(async()=>{if(v)L==null||L.getTracks().forEach(B=>B.stop()),t(null),S(!1);else try{const B=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});e.current&&(e.current.srcObject=B),t(B),S(!0)}catch(B){console.error("Error accessing webcam:",B),S(!1)}},[v,t,e]),q=w.useCallback(async()=>{if(T)L==null||L.getTracks().forEach(B=>B.stop()),t(null),E(!1);else try{const B=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});e.current&&(e.current.srcObject=B),t(B),E(!0)}catch(B){console.error("Error accessing screen share:",B),E(!1)}},[T,t,e]),L=(O=e.current)==null?void 0:O.srcObject;return w.useEffect(()=>()=>{L&&L.getTracks().forEach(B=>B.stop())},[L]),w.useImperativeHandle(o,()=>({handleConnect:P})),i.jsx("div",{className:"live-api-control-tray",children:i.jsxs("div",{className:"live-api-control-tray-inner",children:[i.jsxs("div",{className:"live-api-control-group",children:[i.jsx("button",{onClick:()=>b(!g),disabled:!l,className:`live-api-control-button ${l&&!g?"mic-active":"mic-inactive"}`,"aria-label":g?"Unmute microphone":"Mute microphone",children:g?i.jsx(XI,{className:"w-5 h-5"}):i.jsx(e2,{className:"w-5 h-5"})}),i.jsx("div",{className:"live-api-audio-pulse-container",children:i.jsx(HH,{volume:f,active:l})}),n&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:q,disabled:!l,className:`live-api-control-button ${T?"video-active":"video-inactive"}`,"aria-label":T?"Stop screen share":"Start screen share",children:i.jsx(nM,{className:"w-5 h-5"})}),i.jsx("button",{onClick:I,disabled:!l,className:`live-api-control-button ${v?"video-active":"video-inactive"}`,"aria-label":v?"Turn off webcam":"Turn on webcam",children:i.jsx(KM,{className:"w-5 h-5"})})]})]}),i.jsxs("div",{className:"live-api-control-group",children:[i.jsxs("div",{className:"live-api-status-indicator",children:[i.jsx("div",{className:`live-api-status-dot ${l?"connected":"disconnected"}`}),i.jsx("span",{className:"live-api-status-text",children:l?"Streaming":"Disconnected"})]}),i.jsx("button",{onClick:P,className:`live-api-connect-button ${l?"connected":"disconnected"}`,children:l?i.jsxs(i.Fragment,{children:[i.jsx(cM,{className:"w-5 h-5"}),i.jsx("span",{children:"Pause"})]}):i.jsxs(i.Fragment,{children:[i.jsx(pM,{className:"w-5 h-5"}),i.jsx("span",{children:"Start"})]})})]})]})})}),YH=({patientData:e,tokenNumber:n,aiSummary:t,clinicName:r})=>i.jsxs("div",{className:"hospital-reception-container",children:[i.jsxs("div",{className:"hospital-reception-logo-section",children:[i.jsx("div",{className:"hospital-reception-logo",children:i.jsx("span",{children:r.charAt(0)})}),i.jsxs("h1",{className:"hospital-reception-title",children:[r," AI"]}),i.jsxs("p",{className:"hospital-reception-subtitle",children:["Intelligent ",r," Reception Assistant"]})]}),n&&i.jsxs("div",{className:"hospital-reception-token-card",children:[i.jsx("h2",{className:"hospital-reception-token-title",children:"Token Number"}),i.jsx("p",{className:"hospital-reception-token-number",children:n})]}),!1,t&&i.jsxs("div",{className:"hospital-reception-summary-card",children:[i.jsx("h3",{className:"hospital-reception-summary-title",children:"Case Summary"}),i.jsx("p",{className:"hospital-reception-summary-text",children:t})]})]}),m_={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:np.OBJECT,properties:{summary:{type:np.STRING,description:"The summary of the patient's case."}},required:["summary"]}},WH=({onClose:e,patientData:n,tokenNumber:t,onAiSummaryChange:r,clinicName:a,aiLanguage:o})=>{const l=w.useRef(null),h=w.useRef(null),[d,u]=w.useState(null),[f,g]=w.useState("hi"),{client:b,connected:v,aiSummary:S,setConfig:T,setModel:E,disconnect:C}=oh(),[P,I]=w.useState(null),q=w.useMemo(()=>{let B=`Your job is to:

If patient details like name, age, sex, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's name, age, and sex(dont ask for sex ,detect automatically through voice recognition).

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception. You should always speak in ${o||"English"}.dont write the ${o||"English"} words in english.donot use function calls in the middle of the conversation`;return n&&(B+=`

Patient Data: ${JSON.stringify(n,null,2)}`),{responseModalities:[ip.AUDIO],mediaResolution:v1.MEDIA_RESOLUTION_MEDIUM,speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},contextWindowCompression:{triggerTokens:"25600",slidingWindow:{targetTokens:"12800"}},systemInstruction:{parts:[{text:B+`

IMPORTANT: Do not verbalize your internal thought process. Only speak the final response to the user. Do not include any 'Thinking' or internal narration in the audio response.`}]},tools:[{functionDeclarations:[m_]}]}},[n,o]);w.useEffect(()=>{E("models/gemini-2.5-flash-native-audio-preview-12-2025"),T(q);const B=setTimeout(()=>{h.current&&!v&&h.current.handleConnect()},2e3);return()=>clearTimeout(B)},[T,E,q,v]),w.useEffect(()=>()=>{v&&C()},[v,C]),w.useEffect(()=>{const B=$=>{if($.modelTurn&&$.modelTurn.parts){for(const F of $.modelTurn.parts)if(F.executableCode){const z=F.executableCode.code,U=/summary=["'](.*?)["']/.exec(z);if(U&&U[1]){const V=U[1];I(V),r(V)}}}};return b.on("content",B),()=>{b.off("content",B)}},[b,r]),w.useEffect(()=>{const B=$=>{if(!$.functionCalls)return;const F=$.functionCalls.find(z=>z.name===m_.name);if(F){const z=F.args.summary;I(z),r(z)}$.functionCalls.length&&setTimeout(()=>{var z;return b.sendToolResponse({functionResponses:(z=$.functionCalls)==null?void 0:z.map(U=>({response:{output:{success:!0}},id:U.id,name:U.name}))})},200)};return b.on("toolcall",B),()=>{b.off("toolcall",B)}},[b,r]);const L=()=>{f.trim()&&(b.send([{text:f}]),g(""))},O=B=>{B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),L())};return i.jsx("div",{className:"live-api-modal-overlay",children:i.jsxs("div",{className:"live-api-modal-content",children:[i.jsxs("div",{className:"live-api-modal-header",children:[i.jsxs("div",{className:"live-api-modal-header-left",children:[i.jsx("div",{className:"live-api-modal-logo",children:i.jsx("span",{children:a.charAt(0)})}),i.jsxs("div",{children:[i.jsx("h1",{className:"live-api-modal-title",children:a}),i.jsxs("p",{className:"live-api-modal-subtitle",children:[a," Hospital Assistant"]})]})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx("button",{onClick:e,className:"live-api-modal-close-button","aria-label":"Close modal",children:i.jsx(Sn,{className:"w-6 h-6"})})})]}),i.jsx("div",{className:"live-api-modal-main-content",children:i.jsxs("div",{className:"flex-1 flex flex-col",children:[i.jsxs("div",{className:"live-api-reception-area",children:[i.jsx(YH,{patientData:n,tokenNumber:t,aiSummary:P??S,clinicName:a}),d&&i.jsx("video",{ref:l,autoPlay:!0,playsInline:!0,className:"live-api-video-stream"})]}),i.jsx("div",{className:"live-api-input-area",children:i.jsxs("div",{className:"live-api-input-container",children:[i.jsx("textarea",{value:f,onChange:B=>g(B.target.value),onKeyDown:O,placeholder:"Type your message here...",disabled:!v,rows:1,className:"live-api-textarea"}),i.jsx("button",{onClick:L,disabled:!v||!f.trim(),className:"live-api-send-button","aria-label":"Send message",children:i.jsx(Mb,{className:"w-5 h-5"})})]})}),i.jsx(GH,{ref:h,videoRef:l,supportsVideo:!0,onVideoStreamChange:u,textInput:f,onSubmitTextInput:L})]})})]})})},NT=({onClose:e,patientData:n,tokenNumber:t,onAiSummaryChange:r})=>{const[a,o]=w.useState(null),[l,h]=w.useState("Newtons Ai"),[d,u]=w.useState(""),[f,g]=w.useState(!0);if(w.useEffect(()=>{(async()=>{try{const T=await(await ce("/api/clinics/settings")).json();T.gemini_api_key?o(T.gemini_api_key):o(p_),T.name&&T.name!==""?h(T.name):h("Newtons Ai"),u(T.aiLanguage||"")}catch(S){console.error("Failed to fetch clinic settings, using default API key and unknown clinic name:",S),o(p_),h("Newtons Ai"),u("")}finally{g(!1)}})()},[]),f)return i.jsx("div",{className:"live-api-modal-overlay",children:i.jsxs("div",{className:"live-api-modal-content live-api-loading-container",children:[i.jsxs("div",{className:"live-api-loading-spinner",children:[i.jsx("div",{className:"live-api-spinner-ring"}),i.jsx("div",{className:"live-api-spinner-ring"}),i.jsx("div",{className:"live-api-spinner-ring"})]}),i.jsx("div",{className:"live-api-loading-text",children:"Initializing Live API"})]})});if(!a)return i.jsx("div",{className:"live-api-modal-overlay",children:i.jsx("div",{className:"live-api-modal-content",children:i.jsx("div",{children:"Error: API Key not available."})})});const b={apiKey:a};return i.jsx(Jw,{options:b,children:i.jsx(WH,{onClose:e,patientData:n,tokenNumber:t,onAiSummaryChange:r,clinicName:l,aiLanguage:d})})},QH=({onClose:e})=>{const n=Ft(),t=()=>{e(),n("/start-clinic-subscription")};return i.jsx("div",{className:"go-pro-modal-overlay",onClick:e,children:i.jsxs("div",{className:"go-pro-modal-content",onClick:r=>r.stopPropagation(),children:[i.jsx("button",{onClick:e,className:"go-pro-modal-close-button",children:i.jsx(Sn,{size:24})}),i.jsx("div",{className:"flex justify-center mb-6",children:i.jsx("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/30 rounded-2xl",children:i.jsx(s1,{size:40,className:"text-indigo-600 dark:text-indigo-400 animate-pulse"})})}),i.jsx("h2",{className:"go-pro-modal-title",children:"Go Pro for Voice AI"}),i.jsx("p",{className:"go-pro-modal-message",children:"Experience the future of healthcare with our Voice AI Agent. Upgrade to Pro for seamless patient interactions and advanced features."}),i.jsx("button",{onClick:t,className:"go-pro-button",children:"Explore Pro Plans"})]})})},JH="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",KH={apiKey:JH},XH=[{title:"Example: Fever & Cold",emoji:"",description:"Rajesh Kumar, 35 year old male, fever since 2 days, cold, body pain, no cough"},{title:"Example: Stomach Ache",emoji:"",description:"Priya Sharma, 28 year old female, stomach pain after eating, acidity, bloating since 3 days"}],qf=()=>{const[e,n]=w.useState(""),[t,r]=w.useState([]),[a,o]=w.useState([]),[l,h]=w.useState(!1),[d,u]=w.useState(null),[f,g]=w.useState(!1),[b,v]=w.useState(null),[S,T]=w.useState(!1),[E,C]=w.useState(null),P=w.useRef(null),[I,q]=w.useState(!1),[L,O]=w.useState(!1),[B,$]=w.useState(null),[F,z]=w.useState(null),[U,V]=w.useState(null),[ee,ie]=w.useState(!1),[ae,J]=w.useState(!0),K=Ft(),W=$r();w.useEffect(()=>{(async()=>{try{const me=await kk();V(me.hasProPlan)}catch(me){console.error("Error fetching pro status:",me),V(!1)}})(),re()},[]);const re=async()=>{try{const ge=new URLSearchParams({page:"1",limit:"4",sortBy:"created_at",sortOrder:"desc"}),me=await ce(`/api/patients?${ge.toString()}`);if(me.ok){const de=await me.json();o(de.patients)}}catch(ge){console.error("Error fetching recent patients:",ge)}},A=w.useCallback(async ge=>{const me=ge||e;if(!me.trim()){C("Please enter complaint details.");return}T(!0),C(null);try{const de=await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"New Patient - Direct Entry",age:null,gender:null,phone:null,address:null})});if(!de.ok){const ne=await de.json().catch(()=>({message:"Failed to create patient"}));if(de.status===403&&ne.message.includes("Patient limit")){K("/start-clinic-subscription",{state:{errorMessage:ne.message}});return}throw new Error(ne.message||`Failed to create patient: ${de.statusText}`)}const Le=await de.json();if(!Le||!Le.id)throw new Error("Failed to create new patient or retrieve patient ID.");const He=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:Le.id})});if(!He.ok){const ne=await He.text();throw new Error(`Failed to create queue entry: ${ne||He.statusText}`)}const pe=await He.json();if(!pe||!pe.id)throw new Error("Failed to create new complaint record or retrieve record ID.");K(`/dashboard/edit-complaint/${pe.id}`,{state:{initialMessage:me,patientId:Le.id}})}catch(de){console.error("Error starting new complaint:",de),de.message.includes("Patient limit")?(C(`Error: ${de.message}. Please upgrade your plan.`),K("/start-clinic-subscription")):C(`Error: ${de.message||"Failed to start new complaint process."}`)}finally{T(!1)}},[e,K]);w.useEffect(()=>{const ge=P.current;ge&&(ge.style.height="auto",ge.style.height=`${ge.scrollHeight}px`);const de=new URLSearchParams(W.search).get("caseDetails");if(de){const Le=decodeURIComponent(de);Le!==e&&(n(Le),q(!0))}},[W.search,e]),w.useEffect(()=>{I&&e.trim()&&(K(W.pathname,{replace:!0}),A(e),q(!1))},[I,e,A,K,W.pathname]),w.useEffect(()=>{const ge=P.current;ge&&(ge.style.height="auto",ge.style.height=`${ge.scrollHeight}px`)},[e]),w.useEffect(()=>{B&&(n(B),O(!1),A(B),$(null))},[B,A]),w.useEffect(()=>{const ge=P.current;ge&&ge.focus({preventScroll:!0})},[]);const te=()=>{J(!1)},xe=()=>{if(U===!1){ie(!0);return}z({id:null,token:null,name:"New Case",age:null,gender:null}),O(!0)},M=w.useMemo(()=>Vb(async ge=>{const me=ge.trim(),de=/^\d+$/.test(me),Le=me.split(/\s+/).length;if(me.length<2||de&&me.length>10||!de&&Le>2){r([]),h(!1),u(null);return}h(!0),u(null);try{const He=new URLSearchParams({search:encodeURIComponent(ge),page:"1",limit:"20",sortBy:"name",sortOrder:"asc"}),pe=await ce(`/api/patients?${He.toString()}`);if(!pe.ok){const Pe=await pe.text();throw new Error(`API Error (${pe.status}): ${Pe||pe.statusText}`)}const ne=await pe.json();r(ne.patients)}catch(He){console.error("Error searching patients:",He),u(He.message||"Failed to search patients."),r([])}finally{h(!1)}},300),[]),Se=ge=>{const me=ge.target.value;n(me);const de=me.trim(),Le=/^\d+$/.test(de),He=de.split(/\s+/).length;de.length>=2&&!(Le&&de.length>10||!Le&&He>2)?h(!0):(h(!1),r([])),J(!0),M(me)},$e=ge=>{ge.key==="Enter"&&!ge.shiftKey&&(ge.preventDefault(),t.length>0&&!l?he(t[0]):e.trim()&&!l&&A(e))},he=async ge=>{r([]),n(""),g(!0),v(null);try{const me=await ce(`/api/queue/patient/${ge.id}/latest`);if(me.ok){const He=await me.json();if(He!=null&&He._id){if(He!=null&&He._id){K(`/dashboard/edit-complaint/${He._id}`,{state:{patientId:ge.id,initialMessage:e.trim()||void 0}}),g(!1);return}g(!1);return}}else if(me.status!==404){const He=await me.text();throw new Error(`Failed to fetch queue entry: ${He||me.statusText} (${me.status})`)}const de=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:ge.id})});if(!de.ok){const He=await de.text();throw new Error(`Failed to create queue entry: ${He||de.statusText} (${de.status})`)}const Le=await de.json();if(Le!=null&&Le.id)K(`/dashboard/edit-complaint/${Le.id}`,{state:{patientId:ge.id,initialMessage:e.trim()||void 0}});else throw new Error("Failed to get ID from new queue entry.")}catch(me){console.error("Error processing patient selection:",me),v(me.message||"An error occurred while processing the selection.")}finally{g(!1)}};return i.jsxs("div",{className:"patient-search-page-container",onClick:te,children:[i.jsxs("div",{className:"patient-search-header",children:[i.jsx("button",{onClick:()=>K("/dashboard/queue"),className:"patient-search-button patient-search-button-primary",children:"OPD Queue"}),i.jsx("button",{onClick:()=>K(-1),className:"back-button",children:i.jsx(fn,{size:16})})]}),i.jsxs("div",{className:"patient-search-content-box",children:[d&&i.jsx("p",{className:"patient-search-error",children:d}),b&&i.jsx("p",{className:"patient-search-error",children:b}),E&&i.jsx("p",{className:"patient-search-error",children:E})]}),!e&&a.length>0&&i.jsxs("div",{className:"recent-patients-section",children:[i.jsx("div",{className:"recent-patients-grid",children:a.map((ge,me)=>i.jsxs("div",{onClick:()=>he(ge),className:"recent-patient-card",style:{"--i":me},children:[i.jsxs("div",{className:"recent-patient-info",children:[i.jsx("span",{className:"recent-patient-name",children:ge.name}),i.jsxs("span",{className:"recent-patient-details",children:[ge.age?`${ge.age} yrs`:"",ge.age&&ge.gender?" / ":"",ge.gender||""]})]}),i.jsxs("div",{className:"recent-patient-token",children:["#",ge.token]})]},ge.id))}),i.jsx("h2",{className:"recent-patients-title",children:"Newly Registered"})]}),!e&&i.jsxs("div",{className:"ai-examples-section",children:[i.jsxs("h2",{className:"ai-examples-title",children:[i.jsx("span",{className:"ai-examples-icon",children:""}),"Try AI with Example Cases"]}),i.jsx("div",{className:"ai-examples-grid",children:XH.map((ge,me)=>i.jsxs("button",{onClick:()=>A(ge.description),className:"ai-example-card",style:{"--i":me},disabled:S,children:[i.jsx("span",{className:"ai-example-emoji",children:ge.emoji}),i.jsxs("div",{className:"ai-example-content",children:[i.jsx("span",{className:"ai-example-title",children:ge.title}),i.jsx("span",{className:"ai-example-description",children:ge.description})]})]},me))})]}),i.jsxs("div",{className:"sticky-chat-input-box",children:[t.length>0&&ae&&i.jsx("div",{className:"search-results-backdrop",onClick:te}),t.length>0&&ae&&!f&&!S&&i.jsx("ul",{className:"patient-search-results-list",children:t.map((ge,me)=>i.jsxs("li",{onClick:()=>he(ge),className:"patient-search-result-item",style:{"--i":me},children:[i.jsx("div",{className:"patient-search-result-item-name-container",children:i.jsxs("div",{className:"patient-search-result-item-primary-info",children:[i.jsxs("span",{className:"patient-search-result-item-token",children:["#",ge.token]}),i.jsx("span",{className:"patient-search-result-item-name",children:ge.name}),i.jsxs("span",{className:"patient-search-result-item-meta",children:[ge.age?`${ge.age}y`:"",ge.age&&ge.gender?"  ":"",ge.gender||""]})]})}),i.jsx("div",{className:"patient-search-result-item-chevron",children:i.jsx("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:i.jsx("polyline",{points:"9 18 15 12 9 6"})})})]},ge.id))}),e.length>=2&&!l&&t.length===0&&!d&&!f&&i.jsxs("p",{className:"patient-search-no-results",children:['No patients found matching, taking new case: "',e,'".']}),i.jsxs("div",{className:"chat-input-controls",onClick:ge=>ge.stopPropagation(),children:[i.jsx("textarea",{ref:P,placeholder:"Search or Enter New Case: Name, Age, Sex, Complaint...",value:e,onChange:Se,onKeyDown:$e,onFocus:()=>J(!0),onClick:ge=>{ge.stopPropagation(),J(!0)},className:"chat-input",disabled:f||S,rows:1}),i.jsx("button",{onClick:e.trim()?()=>A(e):xe,className:`chat-submit-button ${S||l?"opacity-50":""}`,disabled:S||l||!!e.trim()&&!e.trim(),"aria-label":e.trim()?"Enter New Case":"Use Microphone",children:S||l?i.jsxs("div",{className:"spinner-dots",children:[i.jsx("div",{}),i.jsx("div",{}),i.jsx("div",{})]}):e.trim()?i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24",children:i.jsx("path",{d:"M12 4l1.41 1.41L7.83 11H20v2H7.83l5.58 5.59L12 20l-8-8 8-8z",transform:"rotate(90 12 12)"})}):i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",width:"24",height:"24",children:i.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2V9c0 .66-.54 1.2-1.2 1.2s-1.2-.54-1.2-1.2V4.9zM17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})})})]})]}),L&&i.jsx(Jw,{options:KH,children:i.jsx(NT,{onClose:()=>O(!1),patientData:F,tokenNumber:null,onAiSummaryChange:$})}),ee&&i.jsx(QH,{onClose:()=>ie(!1)})]})},ST=({fetchWithAuth:e})=>{const n=Ft(),[t,r]=w.useState([]),[a,o]=w.useState(""),[l,h]=w.useState(!0),[d,u]=w.useState({admissionCharge:"0",perDayCharge:"0",otherCharges:"0",aiMemory:"",clinicWideSystemPrompt:"",gemini_api_key:"",low_stock_threshold:"10",aiLanguage:"English",name:"",logoUrl:"",upi_id:"",address:"",notes:""}),[f,g]=w.useState(!1),[b,v]=w.useState(null),S=w.useCallback(async()=>{h(!0);try{const[q,L]=await Promise.all([e("/staff"),e("/api/clinics/settings")]);if(q.ok){const O=await q.json();r(O.map(B=>({...B,id:B._id||B.id})))}if(L.ok){const O=await L.json();u({admissionCharge:parseFloat(O.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(O.perDayCharge||0).toFixed(2),otherCharges:parseFloat(O.otherCharges||0).toFixed(2),aiMemory:O.aiMemory||"",clinicWideSystemPrompt:O.clinicWideSystemPrompt||"",gemini_api_key:O.gemini_api_key||"",low_stock_threshold:String(O.low_stock_threshold||"10"),aiLanguage:O.aiLanguage||"English",name:O.name||"",logoUrl:O.logoUrl||"",upi_id:O.upi_id||"",address:O.address||"",notes:O.notes||""})}}catch(q){console.error("Failed to load management data",q),v({text:"Failed to load clinic data. Please refresh.",type:"error"})}finally{h(!1)}},[e]);w.useEffect(()=>{S()},[S]);const T=q=>{u(L=>({...L,[q.target.name]:q.target.value}))},E=async()=>{g(!0),v(null);try{const q={...d,admissionCharge:parseFloat(d.admissionCharge),perDayCharge:parseFloat(d.perDayCharge),otherCharges:parseFloat(d.otherCharges),low_stock_threshold:parseInt(d.low_stock_threshold)};if(!(await e("/api/clinics/settings",{method:"PUT",body:JSON.stringify(q)})).ok)throw new Error("Failed to save");v({text:"Settings saved successfully",type:"success"}),setTimeout(()=>v(null),3e3)}catch{v({text:"Error saving settings. Check your inputs.",type:"error"})}finally{g(!1)}},C=t.filter(q=>q.name.toLowerCase().includes(a.toLowerCase())||q.role.toLowerCase().includes(a.toLowerCase())),P=q=>{switch(q){case"doctor":return i.jsx(MM,{size:12});case"pharmacy":return i.jsx(Io,{size:12});case"lab":return i.jsx(a1,{size:12});default:return i.jsx(Zf,{size:12})}},I=q=>q.split(" ").map(L=>L[0]).join("").substring(0,2).toUpperCase();return i.jsxs("div",{className:"cm-container",children:[i.jsxs("div",{className:"cm-header",children:[i.jsxs("div",{className:"cm-title",children:[i.jsx("h1",{children:"Clinic Hub"}),i.jsx("p",{children:"Manage your ecosystem"})]}),i.jsxs("div",{className:"cm-actions",children:[i.jsxs("button",{onClick:()=>n("/dashboard/staff/add"),className:"cm-btn cm-btn-secondary",children:[i.jsx(Pl,{size:16})," ",i.jsx("span",{children:"Add Staff"})]}),i.jsxs("button",{onClick:E,disabled:f,className:"cm-btn cm-btn-primary",children:[i.jsx(vc,{size:16})," ",i.jsx("span",{children:f?"Saving...":"Save Changes"})]})]})]}),i.jsxs("div",{className:"cm-grid-layout",children:[i.jsxs("div",{className:"cm-card",children:[i.jsx("div",{className:"cm-card-header",children:i.jsxs("div",{className:"cm-card-title",children:[i.jsx(Zf,{size:18,className:"text-teal-600"}),i.jsxs("span",{children:["Team Directory ",i.jsxs("span",{className:"text-slate-400 text-xs font-normal",children:["(",t.length,")"]})]})]})}),i.jsx("div",{className:"p-3 border-b border-slate-200 dark:border-slate-800 bg-slate-50 dark:bg-slate-900/50",children:i.jsxs("div",{className:"cm-input-wrapper",children:[i.jsx(Pi,{size:14,className:"cm-input-icon"}),i.jsx("input",{className:"cm-input cm-input-pl",placeholder:"Find member...",value:a,onChange:q=>o(q.target.value)})]})}),i.jsx("div",{className:"cm-card-content",children:l?i.jsx("div",{className:"p-8 text-center text-slate-400 text-sm",children:"Loading team..."}):C.length===0?i.jsx("div",{className:"p-8 text-center text-slate-400 text-sm",children:"No members found."}):i.jsx("ul",{className:"cm-staff-list",children:C.map(q=>i.jsxs("li",{className:"cm-staff-item group",children:[i.jsxs("div",{className:"flex items-center flex-1 min-w-0",children:[i.jsx("div",{className:"cm-avatar",children:I(q.name)}),i.jsxs("div",{className:"cm-staff-info",children:[i.jsx("div",{className:"cm-staff-name",children:q.name}),i.jsxs("div",{className:"cm-staff-role",children:[P(q.role)," ",q.role]})]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("span",{className:`cm-badge ${q.status==="active"?"cm-badge-active":""}`,children:q.status||"Active"}),i.jsx("button",{onClick:()=>n(`/dashboard/staff/edit/${q.id}`),className:"text-slate-400 hover:text-teal-600 transition-colors p-1",children:i.jsx(og,{size:16})})]})]},q.id))})})]}),i.jsxs("div",{className:"cm-card",children:[i.jsx("div",{className:"cm-card-header",children:i.jsxs("div",{className:"cm-card-title",children:[i.jsx(qI,{size:18,className:"text-teal-600"}),i.jsx("span",{children:"Configuration Console"})]})}),i.jsxs("div",{className:"cm-card-content",children:[b&&i.jsx("div",{className:`cm-alert ${b.type==="error"?"cm-alert-error":"cm-alert-success"}`,children:b.text}),i.jsxs("div",{className:"cm-settings-grid",children:[i.jsxs("div",{className:"cm-section-title",children:[i.jsx(WC,{size:16})," Clinic Identity & Location"]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Clinic Name"}),i.jsx("input",{name:"name",className:"cm-input",value:d.name,onChange:T,placeholder:"e.g. City Care"})]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Logo URL"}),i.jsx("input",{name:"logoUrl",className:"cm-input",value:d.logoUrl,onChange:T,placeholder:"https://..."})]}),i.jsxs("div",{className:"cm-form-group full-width",children:[i.jsx("label",{className:"cm-label",children:"Address"}),i.jsx("textarea",{name:"address",className:"cm-input cm-textarea",value:d.address,onChange:T,placeholder:"Full physical address"})]}),i.jsxs("div",{className:"cm-section-title",children:[i.jsx(Xd,{size:16})," Financial Operations"]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Admission Fee ()"}),i.jsx("input",{name:"admissionCharge",type:"number",className:"cm-input",value:d.admissionCharge,onChange:T})]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Daily Charge ()"}),i.jsx("input",{name:"perDayCharge",type:"number",className:"cm-input",value:d.perDayCharge,onChange:T})]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"UPI ID"}),i.jsx("input",{name:"upi_id",className:"cm-input",value:d.upi_id,onChange:T,placeholder:"user@upi"})]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Misc. Charges ()"}),i.jsx("input",{name:"otherCharges",type:"number",className:"cm-input",value:d.otherCharges,onChange:T})]}),i.jsxs("div",{className:"cm-section-title",children:[i.jsx(YC,{size:16})," AI Intelligence & System"]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Gemini API Key"}),i.jsx("input",{name:"gemini_api_key",type:"password",className:"cm-input",value:d.gemini_api_key,onChange:T,placeholder:"sk-..."})]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"AI Language"}),i.jsxs("select",{name:"aiLanguage",className:"cm-input",value:d.aiLanguage,onChange:T,children:[i.jsx("option",{children:"English"}),i.jsx("option",{children:"Hindi"}),i.jsx("option",{children:"Spanish"})]})]}),i.jsxs("div",{className:"cm-form-group full-width",children:[i.jsx("label",{className:"cm-label",children:"Clinic System Prompt (Base Instructions)"}),i.jsx("textarea",{name:"clinicWideSystemPrompt",className:"cm-input cm-textarea",rows:3,value:d.clinicWideSystemPrompt,onChange:T,placeholder:"You are a helpful assistant for..."})]}),i.jsxs("div",{className:"cm-form-group full-width",children:[i.jsx("label",{className:"cm-label",children:"Memory & Context"}),i.jsx("textarea",{name:"aiMemory",className:"cm-input cm-textarea",rows:3,value:d.aiMemory,onChange:T,placeholder:"Permanent context about the clinic..."})]}),i.jsxs("div",{className:"cm-section-title",children:[i.jsx(JP,{size:16})," Inventory Alerts"]}),i.jsxs("div",{className:"cm-form-group",children:[i.jsx("label",{className:"cm-label",children:"Low Stock Threshold"}),i.jsx("input",{name:"low_stock_threshold",type:"number",className:"cm-input",value:d.low_stock_threshold,onChange:T})]}),i.jsxs("div",{className:"cm-form-group full-width",children:[i.jsx("label",{className:"cm-label",children:"Internal Notes"}),i.jsx("textarea",{name:"notes",className:"cm-input cm-textarea",value:d.notes,onChange:T,placeholder:"Private notes for admins..."})]})]})]})]})]})]})},ZH=({fetchWithAuth:e})=>{const n=Ft(),[t,r]=w.useState("patientSearch"),[a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null);return w.useEffect(()=>{if(h){const u=setTimeout(()=>d(null),5e3);return()=>clearTimeout(u)}},[h]),a?i.jsxs("div",{className:"loading-animation-container",children:[i.jsx("div",{className:"breathing-ball"}),i.jsx("div",{className:"mt-4 text-teal-600 text-xl font-medium",children:"Loading Admin Panel..."})]}):i.jsxs("div",{className:"admin-panel-container",children:[h&&i.jsxs("div",{className:`alert-box ${h.type==="success"?"alert-box-success":"alert-box-error"} fixed top-4 right-4 z-[100]`,role:"alert",children:[i.jsx("div",{className:"alert-box-icon",children:h.type==="success"?i.jsx(Nr,{size:18}):i.jsx(mi,{size:18})}),i.jsx("div",{className:"alert-box-content",children:i.jsx("span",{children:h.message})}),i.jsx("button",{onClick:()=>d(null),className:"alert-box-close",children:i.jsx(Sn,{size:16})})]}),o&&i.jsxs("div",{className:"alert-box alert-box-error mb-4",role:"alert",children:[i.jsx("div",{className:"alert-box-icon",children:i.jsx(mi,{size:18})}),i.jsx("div",{className:"alert-box-content",children:i.jsx("span",{className:"block sm:inline flex-1",children:o})}),i.jsx("button",{onClick:()=>l(null),className:"alert-box-close",children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{className:"admin-nav-bar",children:[i.jsx("button",{onClick:()=>window.location.reload(),className:"admin-nav-button",title:"Refresh Page",children:i.jsx(ZC,{})}),i.jsxs("button",{onClick:()=>r("management"),className:`admin-nav-button ${t==="management"?"active":""}`,children:[i.jsx(Km,{})," Management"]}),i.jsxs("button",{onClick:()=>r("analysis"),className:`admin-nav-button ${t==="analysis"?"active":""}`,children:[i.jsx(QC,{})," Analysis"]}),i.jsxs("button",{onClick:()=>n("/dashboard/inventory"),className:"admin-nav-button",children:[i.jsx(Eo,{})," Inventory"]}),i.jsxs("button",{onClick:()=>n("/dashboard/subscriptions"),className:"admin-nav-button hidden-button",children:[i.jsx(Hf,{})," Patient Subscriptions"]}),i.jsxs("button",{onClick:()=>n("/dashboard/add-pharmacy-order"),className:"admin-nav-button",children:[i.jsx(Io,{})," Order Meds"]}),i.jsx("button",{onClick:()=>n("/dashboard/recurring-medications"),className:"admin-nav-button",children:"Daily Meds"}),i.jsxs("button",{onClick:()=>n("/create-lab-order"),className:"admin-nav-button",children:[i.jsx(JC,{})," Order Tests"]}),i.jsxs("button",{onClick:()=>n("/dashboard/patients"),className:"admin-nav-button",children:[i.jsx(Zf,{})," All Patients"]})]}),i.jsxs("div",{className:"space-y-6",children:[t==="patientSearch"&&i.jsx("div",{className:"admin-content-section",children:i.jsx(qf,{})}),t==="analysis"&&i.jsx("div",{className:"admin-content-section",children:i.jsx(Ck,{})}),t==="management"&&i.jsx("div",{className:"admin-content-section",children:i.jsx(ST,{fetchWithAuth:e})})]})]})},Mf=e=>{if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},eG=e=>{if(!e)return"Unknown Date";try{return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},Rf=({title:e,icon:n,items:t,renderItemContent:r,isLoading:a})=>{const o=w.useMemo(()=>{const l={};t.forEach(d=>{if(isNaN(d.date.getTime())){l["Unknown Date"]||(l["Unknown Date"]=[]),l["Unknown Date"].push(d);return}const u=eG(d.originalDateString);l[u]||(l[u]=[]),l[u].push(d)});const h=Object.keys(l);return h.sort((d,u)=>{if(d==="Unknown Date")return 1;if(u==="Unknown Date")return-1;try{const f=v=>{const S=v.split(" ");if(S.length===3){const E=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(S[1]);if(E!==-1)return new Date(parseInt(S[2]),E,parseInt(S[0]))}return new Date(v)},g=f(d),b=f(u);if(!isNaN(g.getTime())&&!isNaN(b.getTime()))return b.getTime()-g.getTime()}catch(f){console.error("Error parsing date for sorting:",f)}return u.localeCompare(d)}),h.map(d=>({date:d,items:l[d]}))},[t]);return i.jsxs("div",{className:"mb-3",children:[i.jsxs("h4",{className:"history-section-title",children:[n&&i.jsx(n,{size:18,className:"text-teal-600"}),e]}),a&&i.jsx("p",{className:"text-gray-500 italic text-[10px] px-1",children:"Loading..."}),!a&&t.length===0&&i.jsx("p",{className:"text-gray-500 italic text-[10px] px-1",children:"None found"}),!a&&t.length>0&&i.jsx("div",{className:"space-y-2",children:o.map(({date:l,items:h})=>i.jsxs("div",{children:[i.jsx("h5",{className:"text-[9px] font-bold text-teal-700 mb-1 uppercase tracking-widest opacity-60",children:l}),i.jsx("div",{className:"space-y-1 border-l-2 border-teal-100 dark:border-teal-900/30 ml-1 pl-2",children:h.map((d,u)=>i.jsx("div",{className:"text-xs",children:i.jsx("div",{className:"flex-grow",children:r(d)})},`${d.type}-${d.originalDateString}-${u}`))})]},l))})]})},I0=()=>{var ae,J;const[e,n]=w.useState({currentPatient:null,nextPatient:null,waitingCount:0}),[t,r]=w.useState(!0),[a,o]=w.useState(null),[l,h]=w.useState(null),[d,u]=w.useState(null),[f,g]=w.useState(null),[b,v]=w.useState({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),[S,T]=w.useState(!1),[E,C]=w.useState(null),{patientId:P}=ia(),I=Ft(),q=w.useCallback(async K=>{g(null),h(null),u(null),T(!0),C(null),v({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]});try{const W=await ce(`/api/patients/${K}`);if(!W.ok)throw new Error(`Patient details fetch failed (${W.status})`);const re=await W.json();h(re);const A=await ce(`/api/queue/patient/${K}/latest`);if(!A.ok&&A.status!==404)throw new Error(`Queue entry fetch failed (${A.status})`);if(A.ok){const te=await A.json();u(te)}await L(K)}catch(W){console.error("Error fetching specific patient data:",W),g(W.message||"Failed to load patient data."),C(W.message||"Failed to load patient history.")}finally{T(!1)}},[]),L=w.useCallback(async K=>{T(!0),C(null);try{const[W,re,A,te]=await Promise.all([ce(`/api/queue/patient/${K}/complaints`),ce(`/api/lab/patient/${K}`),ce(`/api/lab/orders/patient/${K}?status=pending`),ce(`/api/pharmacy-orders/patient/${K}`)]),xe=W.ok?await W.json():[],M=re.ok?await re.json():[],Se=A.ok?await A.json():[],$e=te.ok?await te.json():[];v({pastComplaints:xe||[],labReports:M||[],pendingLabOrders:Se||[],pharmacyOrders:$e||[]})}catch(W){console.error("Error fetching patient history:",W),C(W.message||"Failed to load patient history."),v({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]})}finally{T(!1)}},[]),O=w.useCallback(async()=>{r(!0),o(null);try{const K=await ce("/api/queue/doctor");if(!K.ok){const re=await K.text();throw new Error(`API Error (${K.status}): ${re||K.statusText}`)}const W=await K.json();if(W===null||typeof W!="object"||typeof W.waitingCount!="number")throw console.error("Invalid queue data format:",W),new Error("Invalid queue data format received");n({currentPatient:W.currentPatient||null,nextPatient:W.nextPatient||null,waitingCount:W.waitingCount})}catch(K){console.error("Error fetching queue data:",K),o(K.message||"Failed to fetch queue data.")}finally{r(!1)}},[]);w.useEffect(()=>{let K=null;return P?(q(P),n({currentPatient:null,nextPatient:null,waitingCount:0})):(O(),K=setInterval(O,1e4),h(null),u(null)),()=>{K&&clearInterval(K)}},[P,q,O]),w.useEffect(()=>{var K;!P&&((K=e.currentPatient)!=null&&K.patientId)?L(e.currentPatient.patientId):!P&&!e.currentPatient&&(v({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),T(!1),C(null))},[P,(ae=e.currentPatient)==null?void 0:ae.patientId,L]);const B=((J=e.currentPatient)==null?void 0:J.patientId)||(P?parseInt(P,10):null),$=w.useMemo(()=>{if(!B||!b.pastComplaints)return[];const K=b.pastComplaints.map(W=>({date:new Date(W.createdAt),type:"Complaint",data:W,originalDateString:W.createdAt})).filter(W=>!isNaN(W.date.getTime()));return K.sort((W,re)=>re.date.getTime()-W.date.getTime()),K},[B,b.pastComplaints]),F=w.useMemo(()=>{if(!B)return[];const K=[];return(b.pendingLabOrders??[]).forEach(W=>{const re=new Date(W.createdAt);isNaN(re.getTime())||K.push({date:re,type:"Lab Order (Pending)",data:W,originalDateString:W.createdAt})}),(b.labReports??[]).forEach(W=>{const re=W.reportCreatedAt?new Date(W.reportCreatedAt):null;re&&!isNaN(re.getTime())&&K.push({date:re,type:"Lab Report",data:W,originalDateString:W.reportCreatedAt})}),K.sort((W,re)=>re.date.getTime()-W.date.getTime()),K},[B,b.pendingLabOrders,b.labReports]),z=w.useMemo(()=>{if(!B||!b.pharmacyOrders)return[];const K=b.pharmacyOrders.map(W=>({date:new Date(W.date),type:"Pharmacy Order",data:W,originalDateString:W.date})).filter(W=>!isNaN(W.date.getTime()));return K.sort((W,re)=>re.date.getTime()-W.date.getTime()),K},[B,b.pharmacyOrders]),U=async()=>{r(!0),o(null);try{await ce("/api/queue/doctor/next",{method:"POST"}),await O()}catch(K){console.error("Error calling next patient:",K),o(K.message||"Failed to call next patient.")}finally{r(!1)}},V=async()=>{if(!(!e.currentPatient||P)){r(!0),o(null);try{await ce(`/api/queue/doctor/complete/${e.currentPatient._id}`,{method:"POST"}),await O(),v({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),T(!1),C(null)}catch(K){console.error("Error completing consultation:",K),o(K.message||"Failed to complete consultation.")}finally{r(!1)}}},ee=K=>{switch(K){case"waiting":return"Waiting";case"consulting":return"Consulting";case"seen":return"Seen";case"cancelled":return"Cancelled";default:return K}};let ie=null;return e.currentPatient&&(ie=i.jsxs("div",{className:"doctor-panel now-seeing-card",children:[i.jsxs("div",{className:"patient-main-info flex flex-col justify-between",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[i.jsxs("div",{className:"token-badge",children:["#",e.currentPatient.token]}),i.jsx("span",{className:`status-badge status-${e.currentPatient.status}`,children:ee(e.currentPatient.status)})]}),i.jsx("div",{className:"patient-name-large",children:e.currentPatient.name}),i.jsxs("div",{className:"patient-meta-large mb-4",children:[i.jsxs("span",{className:"bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-lg",children:[i.jsx("span",{className:"font-bold",children:e.currentPatient.age})," Yrs"]}),i.jsx("span",{className:"bg-slate-100 dark:bg-slate-800 px-3 py-1 rounded-lg",children:e.currentPatient.gender})]})]}),i.jsxs("div",{className:"flex gap-3 mt-4",children:[i.jsxs("button",{onClick:()=>{var W;const K=(W=e.currentPatient)==null?void 0:W._id;K&&I(`/dashboard/edit-complaint/${K}`)},disabled:t||!e.currentPatient||e.currentPatient.status!=="consulting",className:"doctor-btn doctor-btn-primary flex-1",children:[i.jsx(ds,{size:18})," CONSULT & AI"]}),i.jsxs("button",{onClick:V,disabled:t||!e.currentPatient||e.currentPatient.status!=="consulting",className:"doctor-btn doctor-btn-secondary flex-1",children:[i.jsx(PI,{size:18})," COMPLETE"]})]})]}),i.jsxs("div",{className:"patient-history-preview pl-4 border-l border-slate-200 dark:border-slate-700",children:[i.jsxs("h3",{className:"history-section-title",children:[i.jsx(FN,{size:20,className:"text-teal-500"}),"Clinical Context"]}),E&&i.jsx("p",{className:"text-red-500 text-xs mb-2",children:E}),i.jsxs("div",{className:"space-y-1",children:[i.jsx(Rf,{title:"Previous Complaints",icon:ds,items:$,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-complaint bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50",children:[i.jsx("span",{className:"font-medium",children:K.data.complaint}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})}),i.jsx(Rf,{title:"Lab Observations",icon:a1,items:F,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-lab bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50 text-[11px]",children:[K.type==="Lab Order (Pending)"?i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400",children:"ORDER:"})," ",K.data.tests.map(W=>W.name).join(", ")]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:"REPORT:"})," ",K.data.testName," - ",K.data.reportFindings.substring(0,40),"..."]}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})}),i.jsx(Rf,{title:"Pharmacy History",icon:Eo,items:z,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-pharmacy bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50 text-[11px]",children:[i.jsx("span",{className:"font-medium",children:K.data.medications.map(W=>W.name).join(", ")}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})})]})]})]})),i.jsx(i.Fragment,{children:i.jsxs("div",{className:"doctor-screen-container",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("button",{onClick:()=>I(-1),className:"back-button !mr-4 hover:scale-110 transition-transform",children:i.jsx(fn,{size:24})}),i.jsx("h1",{className:"doctor-screen-header uppercase font-black",children:"Doctor Panel"})]}),i.jsxs("div",{className:"flex gap-4",children:[i.jsxs("button",{onClick:()=>I("/dashboard/add-patient"),className:"doctor-btn doctor-btn-outline",children:[i.jsx(o1,{size:18})," Add Patient"]}),i.jsx("button",{onClick:()=>I("/search-patient"),className:"doctor-btn doctor-btn-outline",children:"Search Record"})]})]}),P?i.jsxs(i.Fragment,{children:[f&&i.jsx("p",{className:"text-red-500 p-4 bg-red-50 rounded",children:f}),l&&i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-4 md:p-6 border-l-8 border-purple-500",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsx("h2",{className:"text-xl text-purple-700 font-semibold",children:"Patient Record:"}),i.jsx("button",{onClick:()=>I("/dashboard/doctor"),className:"text-sm text-blue-600 hover:underline",children:"Back to Queue"})]}),i.jsx("div",{className:"text-2xl md:text-3xl font-bold mb-1 md:mb-2",children:l.name}),i.jsxs("div",{className:"text-lg md:text-xl text-gray-600 mb-3 md:mb-4",children:["Age: ",l.age??"N/A"," | ",l.gender??"N/A"]}),i.jsxs("div",{className:"mt-3 md:mt-4 p-3 bg-gray-50 rounded border border-gray-200",children:[i.jsx("label",{className:"font-medium block mb-1 text-sm text-gray-600",children:"Latest Queue Entry:"}),d?i.jsxs("div",{className:"space-y-2",children:[" ",i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("span",{className:"text-sm flex-1 break-words",children:[i.jsxs("span",{className:"font-medium text-gray-700",children:["(",d.age," / ",d.gender,")"]}),": ",d.complaint||i.jsx("span",{className:"text-gray-400 italic",children:"No complaint"}),i.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs font-medium ${d.status==="consulting"?"bg-teal-100 text-teal-800":d.status==="seen"?"bg-green-100 text-green-800":d.status==="waiting"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:ee(d.status)})]}),d.status==="consulting"&&d._id&&i.jsx("button",{onClick:()=>I(`/dashboard/edit-complaint/${d._id}`),className:"ml-4 px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded flex-shrink-0",children:"Edit"})]}),d.case_summary&&i.jsxs("p",{className:"text-xs text-gray-700 bg-yellow-50 p-2 rounded border border-yellow-200",children:[i.jsx("span",{className:"font-semibold text-gray-800",children:"AI Summary:"})," ",d.case_summary]})]}):i.jsx("p",{className:"text-gray-500 italic text-sm",children:"No queue entry found for this patient today."})]}),i.jsxs("div",{className:"mt-4 border-t pt-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Patient History:"}),E&&i.jsx("p",{className:"text-red-500 text-xs mb-2",children:E}),i.jsx(Rf,{title:"Complaints History",icon:ds,items:$,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-complaint bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50",children:[i.jsx("span",{className:"font-medium",children:K.data.complaint}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})}),i.jsx(Rf,{title:"Lab History (Orders & Reports)",icon:a1,items:F,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-lab bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50 text-[11px]",children:[K.type==="Lab Order (Pending)"?i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400",children:"ORDER:"})," ",K.data.tests.map(W=>W.name).join(", ")]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:"REPORT:"})," ",K.data.testName," - ",K.data.reportFindings.substring(0,40),"..."]}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})}),i.jsx(Rf,{title:"Pharmacy Order History",icon:Eo,items:z,isLoading:S,renderItemContent:K=>i.jsxs("div",{className:"history-item-compact history-item-pharmacy bg-white dark:bg-slate-800/50 shadow-sm border border-slate-100 dark:border-slate-700/50 text-[11px]",children:[i.jsx("span",{className:"font-medium",children:K.data.medications.map(W=>W.name).join(", ")}),i.jsx("span",{className:"text-slate-400 block text-[10px] mt-0.5",children:Mf(K.originalDateString)})]})}),$.length===0&&F.length===0&&z.length===0&&!S&&i.jsx("p",{className:"text-slate-500 italic text-sm mt-4",children:"No clinical history found for this patient."})]})]})]}):i.jsxs(i.Fragment,{children:[a&&i.jsx("p",{className:"text-red-500 p-4 bg-red-50 rounded mb-6 font-medium shadow-sm border border-red-100",children:a}),t&&!e.currentPatient&&i.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-slate-400",children:[i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-500 mb-4"}),i.jsx("p",{className:"font-medium",children:"Fetching doctor queue..."})]}),i.jsx("div",{className:"mb-4",children:ie||i.jsxs("div",{className:"doctor-panel text-center py-8 flex flex-col items-center justify-center",children:[i.jsx("div",{className:"text-slate-200 mb-4",children:i.jsx(o1,{size:64,strokeWidth:1})}),i.jsx("div",{className:"text-xl font-bold text-slate-500",children:"No Patient Session Active"}),i.jsxs("p",{className:"text-slate-400 mt-2 max-w-sm text-sm",children:["The consultation area is ready. Press ",i.jsx("b",{children:"Call Patient"})," below or from the upcoming list to start a session."]})]})}),i.jsxs("div",{className:"current-queue-section mb-10",children:[i.jsxs("h2",{className:"history-section-title !text-lg !mb-6",children:[i.jsx(fn,{size:22,className:"rotate-180 p-1 bg-teal-100 dark:bg-teal-900/40 text-teal-600 rounded-lg"}),"UPCOMING IN QUEUE"]}),e.nextPatient?i.jsxs("div",{className:"doctor-panel next-patient-card !p-0 overflow-hidden",children:[i.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-stretch",children:[i.jsxs("div",{className:"flex items-center gap-6 p-4",children:[i.jsxs("div",{className:"token-badge !text-2xl !p-3 !mb-0 min-w-[4rem] !rounded-xl",children:["#",e.nextPatient.token]}),i.jsxs("div",{children:[i.jsxs("div",{className:"text-2xl font-black mb-1 flex items-center gap-3",children:[e.nextPatient.name,i.jsx("span",{className:`status-badge status-${e.nextPatient.status} !text-[10px]`,children:ee(e.nextPatient.status)})]}),i.jsxs("div",{className:"flex gap-2 items-center text-slate-500",children:[i.jsxs("span",{className:"font-bold text-slate-700 dark:text-slate-300",children:[e.nextPatient.age," Yrs"]}),i.jsx("span",{className:"opacity-30",children:"|"}),i.jsx("span",{children:e.nextPatient.gender})]})]})]}),i.jsx("div",{className:"flex px-6 py-4 md:py-0 bg-slate-50 dark:bg-slate-800/30 items-center justify-end",children:i.jsx("button",{onClick:U,disabled:t||!!e.currentPatient,className:"doctor-btn doctor-btn-primary !px-10 !py-4 !text-lg !rounded-xl w-full md:w-auto shadow-lg disabled:opacity-30",children:"CALL PATIENT"})})]}),(e.nextPatient.complaint||e.nextPatient.case_summary)&&i.jsxs("div",{className:"bg-slate-50/50 dark:bg-slate-900/20 px-8 py-3 border-t border-slate-100 dark:border-slate-800 flex flex-col gap-2",children:[e.nextPatient.complaint&&i.jsxs("div",{className:"text-sm",children:[i.jsx("span",{className:"font-bold text-slate-400 mr-2",children:"CHIEF COMPLAINT:"}),i.jsxs("span",{className:"text-slate-600 dark:text-slate-400 italic",children:['"',e.nextPatient.complaint,'"']})]}),e.nextPatient.case_summary&&i.jsxs("div",{className:"text-xs bg-teal-50 dark:bg-teal-900/20 text-teal-700 dark:text-teal-400 p-2 rounded-lg border border-teal-100/50 dark:border-teal-800/50",children:[i.jsx("span",{className:"font-bold mr-2 uppercase tracking-tight",children:"AI Insights:"}),e.nextPatient.case_summary]})]})]}):i.jsxs("div",{className:"doctor-panel text-center py-10 text-slate-400 border-dashed border-2",children:[i.jsx(Eo,{size:32,className:"mx-auto mb-3 opacity-20"}),i.jsx("p",{className:"font-medium",children:"The waiting queue is currently empty."})]})]}),i.jsxs("div",{className:"mt-auto pt-4 border-t border-slate-200 dark:border-slate-800 flex justify-between items-center",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"w-8 h-8 rounded-full bg-teal-100 dark:bg-teal-900/40 flex items-center justify-center text-teal-600",children:i.jsx(FN,{size:16})}),i.jsxs("div",{children:[i.jsx("div",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Queue Status"}),i.jsxs("div",{className:"text-base font-black",children:[e.waitingCount," Patients waiting"]})]})]}),i.jsx("div",{className:"flex gap-2"})]})]})]})})},jT=()=>{const[e,n]=w.useState(""),[t,r]=w.useState([]),[a,o]=w.useState(null),[l,h]=w.useState(null),[d,u]=w.useState(null),[f,g]=w.useState(null),[b,v]=w.useState(!1),[S,T]=w.useState(!1),[E,C]=w.useState(null),P=Ft(),I=w.useCallback(vT.debounce(async z=>{if(z.trim().length<2){r([]),T(!1);return}T(!0),C(null);try{const U=new URLSearchParams({search:encodeURIComponent(z),page:"1",limit:"20",sortBy:"name",sortOrder:"asc"}),V=await ce(`/api/patients?${U.toString()}`);if(!V.ok){const ie=await V.text();throw new Error(`API Error (${V.status}): ${ie||V.statusText||"Failed to fetch patients"}`)}const ee=await V.json();r(ee.patients)}catch(U){C(U instanceof Error?U.message:"An unknown error occurred while searching patients"),r([])}finally{T(!1)}},500),[]);w.useEffect(()=>(e?(T(!0),I(e)):(r([]),I.cancel()),()=>{I.cancel()}),[e,I]);const q=z=>{o(z),n(""),r([]),C(null),h(null),u(null),g(null),v(!1)},L=async()=>{if(!a){C("No patient selected.");return}C(null),T(!0);try{const z=await ce(`/api/patients/${a.id}/admit`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!z.ok){const V=await z.json().catch(()=>({message:"Failed to admit patient"}));throw new Error(V.message||"Failed to admit patient")}const U=await z.json();alert(U.message||"Patient admitted successfully!"),U.bill&&U.bill.id?P(`/patient/${a.id}/admission-bill/${U.bill.id}`):(console.error("Admission successful, but bill ID missing in response."),C("Admission successful, but couldn't navigate to billing."),o(U.patient))}catch(z){C(z instanceof Error?z.message:"Failed to admit patient")}finally{T(!1)}};w.useEffect(()=>{(async()=>{if(!a||!a.admission_date||a.discharge_date){h(null),g(null);return}v(!0),u(null),h(null),g(null);try{const U=await ce(`/api/patients/${a.id}/active-bill?type=admission`);if(!U.ok)throw U.status===404?new Error("No active admission bill found."):new Error("Failed to fetch active bill ID.");const V=await U.json(),ee=V==null?void 0:V.id;if(!ee)throw new Error("Active admission bill ID not found in response.");h(ee);const ie=await ce(`/api/bills/${ee}`);if(!ie.ok)throw new Error(`Failed to fetch bill details (ID: ${ee}). Status: ${ie.status}`);const ae=await ie.json();if(ae&&ae.calculated)g(ae.calculated);else throw console.error("Fetched bill details missing 'calculated' object:",ae),new Error("Fetched bill details are incomplete (missing calculated data).")}catch(U){u(U instanceof Error?U.message:"An unknown error occurred while fetching bill details."),h(null),g(null)}finally{v(!1)}})()},[a]);const O=async()=>{if(!a){C("No patient selected.");return}if(!a.admission_date||a.discharge_date){C("Patient is not currently admitted.");return}C(null),T(!0);try{const z=await ce(`/api/patients/${a.id}/discharge`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!z.ok){const V=await z.json().catch(()=>({message:"Failed to discharge patient"}));throw new Error(V.message||"Failed to discharge patient")}const U=await z.json();alert(U.message||"Patient discharged successfully!"),U.patient?o(U.patient):(console.error("Discharge successful, but updated patient info missing in response."),o(null),C("Discharge successful, but couldn't update patient details locally."))}catch(z){C(z instanceof Error?z.message:"Failed to discharge patient")}finally{T(!1)}},B=()=>{if(!a||!l){C("Cannot navigate to billing: Patient or Bill ID missing.");return}P(`/patient/${a.id}/admission-bill/${l}`)};let $="",F=null;if(a){const z=a.admission_date?new Date(a.admission_date).toLocaleDateString():null,U=a.discharge_date?new Date(a.discharge_date).toLocaleDateString():null;a.admission_date?a.admission_date&&!a.discharge_date?($=`Patient admitted on: ${z}`,F=i.jsxs("div",{className:"space-y-4",children:[" ",b&&i.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Loading billing details..."})," ",d&&i.jsx("p",{className:"text-sm text-red-500 text-center",children:d})," ",!b&&f&&i.jsxs("div",{className:"admission-card",children:[i.jsx("h3",{className:"admission-card-title",children:"Billing Summary"}),i.jsxs("div",{className:"admission-card-content",children:[i.jsxs("p",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Total Due:"}),i.jsxs("span",{children:["",(Number(f.totalDue)||0).toFixed(2)]})]}),i.jsxs("p",{className:"flex justify-between text-sm text-green-700",children:[" ",i.jsx("span",{children:"Total Paid:"}),i.jsxs("span",{children:["",(Number(f.totalPaid)||0).toFixed(2)]})]}),i.jsxs("p",{className:"flex justify-between text-sm font-bold mt-1 text-red-600",children:[" ",i.jsx("span",{children:"Balance Due:"}),i.jsxs("span",{children:["",(Number(f.balance)||0).toFixed(2)]})]})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx("button",{onClick:B,disabled:S||b||!l,className:`admission-button admission-button-secondary ${S||b||!l?"opacity-50 cursor-not-allowed":""}`,children:b?"Loading Bill...":!l&&!d?"Finding Bill...":"Pay Bill / View Details"}),i.jsx("button",{onClick:O,disabled:S||b,className:`admission-button admission-button-danger ${S||b?"opacity-50 cursor-not-allowed":""}`,children:S?"Processing...":"Discharge Patient"})]})]})):($=`Patient admitted on ${z} and discharged on ${U}.`,F=i.jsx("p",{className:"text-center text-gray-600 italic",children:"Patient has been discharged."})):($="Patient is not admitted.",F=i.jsx("button",{onClick:L,disabled:S,className:`admission-button ${S?"opacity-50 cursor-not-allowed":""}`,children:S?"Processing...":"Admit Patient"}))}return i.jsxs("div",{className:"admission-page-container",children:[i.jsxs("div",{className:"admission-header-container",children:[i.jsxs("button",{onClick:()=>P(-1),className:"back-button",children:[i.jsx(fn,{size:16}),"Back"]}),i.jsx("h1",{className:"admission-header",children:"Manage Admission/Discharge"})]}),i.jsxs("div",{className:"admission-section mb-6 relative",children:[i.jsx("label",{htmlFor:"patientSearch",className:"admission-label",children:"Search Patient (Name, Phone, or Token)"}),i.jsx("input",{type:"text",id:"patientSearch",value:e,onChange:z=>n(z.target.value),placeholder:"Start typing to search...",className:"admission-input"}),S&&!a&&i.jsx("div",{className:"absolute right-3 top-9 text-sm text-gray-500",children:"Loading..."})," ",t.length>0&&!a&&i.jsxs("ul",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[" ",t.map(z=>i.jsxs("li",{onClick:()=>q(z),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[" ",z.name," (Token: ",z.token,")",i.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[z.admission_date?`Admitted: ${new Date(z.admission_date).toLocaleDateString()}`:"Not Admitted",z.discharge_date?`, Discharged: ${new Date(z.discharge_date).toLocaleDateString()}`:""]})]},z.id))]}),t.length===0&&e&&!S&&!a&&i.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg p-4 text-gray-500",children:['No patients found matching "',e,'".']})]}),a&&i.jsxs("div",{className:"admission-section",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsx("h2",{className:"admission-section-title",children:"Selected Patient"}),i.jsx("button",{onClick:()=>o(null),className:"admission-link",children:"Clear Selection"})]}),i.jsxs("div",{className:"admission-card-content mb-4 grid grid-cols-2 gap-2 text-sm",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Name:"})," ",a.name]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Token:"})," ",a.token]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Age:"})," ",a.age??"N/A"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Gender:"})," ",a.gender??"N/A"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Phone:"})," ",a.phone??"N/A"]}),i.jsxs("p",{className:"col-span-2",children:[i.jsx("strong",{children:"Address:"})," ",a.address??"N/A"]})]}),i.jsx("hr",{className:"my-4"}),i.jsx("p",{className:"text-sm text-gray-600 mb-3",children:$})," ",E&&i.jsx("p",{className:"text-red-500 text-sm mb-3",children:E})," ",F]})]})},tG=15,F1=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(!0),[o,l]=w.useState(null),[h,d]=w.useState(""),[u,f]=w.useState(1),[g,b]=w.useState(1),[v,S]=w.useState("created_at"),[T,E]=w.useState("desc"),[C,P]=w.useState(""),[I,q]=w.useState(!1),[L,O]=w.useState(null),[B,$]=w.useState([]),[F,z]=w.useState(""),[U,V]=w.useState(!1),[ee,ie]=w.useState(null),[ae,J]=w.useState(null),[K,W]=w.useState(!0),[re,A]=w.useState(null),[te,xe]=w.useState(h);w.useEffect(()=>{const pe=setTimeout(()=>{xe(h),f(1)},500);return()=>{clearTimeout(pe)}},[h]);const M=w.useCallback(async()=>{W(!0),A(null);try{const pe=await ce("/api/subscriptions");if(!pe.ok){let Pe=`Failed to fetch subscription plans (${pe.status})`;try{Pe=(await pe.json()).message||Pe}catch{}throw new Error(Pe)}const ne=await pe.json();$(ne)}catch(pe){console.error("Error fetching subscription plans:",pe),A(pe.message||"An unknown error occurred while fetching plans."),$([])}finally{W(!1)}},[]),Se=w.useCallback(async(pe,ne,Pe,Ye,rt)=>{a(!0),l(null);try{const ut=new URLSearchParams({page:pe.toString(),limit:tG.toString(),sortBy:Pe,sortOrder:Ye});ne&&ut.append("search",ne),rt&&ut.append("gender",rt);const je=await ce(`/api/patients?${ut.toString()}`);if(!je.ok){const ze=await je.json();throw new Error(ze.message||"Failed to fetch patients")}const Qe=await je.json();t(Qe.patients),f(Qe.currentPage),b(Qe.totalPages)}catch(ut){console.error("Error fetching patients:",ut),l(`Failed to load patients: ${ut.message}`),t([]),f(1),b(1)}finally{a(!1)}},[]);w.useEffect(()=>{Se(u,te,v,T,C),M()},[u,te,v,T,C,Se,M]);const $e=pe=>{const ne=v===pe&&T==="asc"?"desc":"asc";S(pe),E(ne),f(1)},he=pe=>{try{return new Date(pe).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},ge=()=>{q(!1),O(null),z(""),ie(null),V(!1)},me=async(pe,ne)=>{t(Pe=>Pe.map(Ye=>Ye.id===pe?{...Ye,insurance_type:ne}:Ye));try{const Pe=await ce(`/api/patients/${pe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:ne})});if(!Pe.ok){const Ye=await Pe.json();throw new Error(Ye.message||"Failed to update insurance type")}}catch(Pe){console.error("Error updating insurance type:",Pe),Se(u,te,v,T,C)}},de=(pe,ne)=>{const Pe=new Date(pe),Ye=ne.interval||1;switch(ne.period){case"daily":Pe.setDate(pe.getDate()+Ye);break;case"weekly":Pe.setDate(pe.getDate()+Ye*7);break;case"monthly":Pe.setMonth(pe.getMonth()+Ye);break;case"yearly":Pe.setFullYear(pe.getFullYear()+Ye);break;default:console.warn(`Unknown subscription period: ${ne.period}. Defaulting to 1 month.`),Pe.setMonth(pe.getMonth()+1)}return Pe},Le=async()=>{if(!L||!F){ie("Please select a subscription plan.");return}const pe=B.find(ne=>ne.id===F);if(!pe){ie("Selected plan details not found.");return}V(!0),ie(null);try{const ne=new Date,Pe=de(ne,pe),Ye={subscription_plan_id:F,subscription_status:"active",subscription_start_date:ne.toISOString(),subscription_end_date:Pe.toISOString(),subscription_payment_method:"manual"},rt=await ce(`/api/patients/${L.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ye)});if(!rt.ok){const ut=await rt.json();throw new Error(ut.message||"Failed to update patient subscription")}ge(),Se(u,te,v,T,C)}catch(ne){console.error("Error starting subscription:",ne),ie(`Failed to start subscription: ${ne.message}`)}finally{V(!1)}},He=async pe=>{if(!ae){J(pe.id);try{const ne=await ce(`/api/queue/patient/${pe.id}/latest`);if(ne.ok){const rt=await ne.json();if(rt!=null&&rt._id){e(`/dashboard/edit-complaint/${rt._id}`,{state:{patientId:pe.id}});return}}else if(ne.status!==404){const rt=await ne.text();throw new Error(`Failed to fetch queue entry: ${rt||ne.statusText}`)}const Pe=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:pe.id})});if(!Pe.ok){const rt=await Pe.text();throw new Error(`Failed to create queue entry: ${rt||Pe.statusText}`)}const Ye=await Pe.json();if(Ye!=null&&Ye.id)e(`/dashboard/edit-complaint/${Ye.id}`,{state:{patientId:pe.id}});else throw new Error("Failed to get ID from new queue entry.")}catch(ne){console.error("Error processing patient selection:",ne),alert(ne.message||"An error occurred while processing the selection.")}finally{J(null)}}};return i.jsxs("div",{className:"all-patients-container",children:[i.jsx("div",{className:"compact-header-container",children:i.jsxs("div",{className:"header-top-row",children:[i.jsxs("div",{className:"header-left",children:[i.jsx("button",{onClick:()=>e(-1),className:"icon-back-button",title:"Go Back",children:i.jsx(fn,{size:20})}),i.jsx("h1",{className:"compact-page-title",children:"All Patients"})]}),i.jsxs("div",{className:"header-right-controls",children:[i.jsxs("div",{className:"compact-search-wrapper",children:[i.jsx(Pi,{className:"search-icon-small",size:16}),i.jsx("input",{type:"text",placeholder:"Search...",className:"compact-search-input",value:h,onChange:pe=>d(pe.target.value)}),h&&i.jsx("button",{onClick:()=>d(""),className:"clear-search-button",children:i.jsx(Sn,{size:14})})]}),i.jsxs("div",{className:"compact-filter-wrapper",children:[i.jsx(XC,{size:14,className:"filter-icon-small"}),i.jsxs("select",{value:C,onChange:pe=>P(pe.target.value),className:"compact-filter-select",children:[i.jsx("option",{value:"",children:"All Genders"}),i.jsx("option",{value:"M",children:"Male"}),i.jsx("option",{value:"F",children:"Female"}),i.jsx("option",{value:"O",children:"Other"})]})]}),i.jsx("div",{className:"plans-indicator",children:K?i.jsx("span",{className:"text-xs text-gray-400",children:"..."}):i.jsxs("span",{className:"text-xs font-medium text-indigo-600 bg-indigo-50 px-2 py-1 rounded-full",children:[B.length," Plans"]})})]})]})}),o&&i.jsx("div",{className:"compact-error-alert",role:"alert",children:i.jsx("span",{children:o})}),!K&&B.length>0&&i.jsx("div",{className:"compact-plans-strip",children:i.jsxs("div",{className:"plans-ticker-content",children:[i.jsx("span",{className:"plans-label",children:"Available Plans:"}),B.map(pe=>i.jsxs("span",{className:"plan-pill",children:[pe.name," ",i.jsxs("span",{className:"plan-price",children:["",pe.price]})]},pe.id))]})}),r?i.jsx("div",{className:"compact-loading-state",children:"Loading..."}):n.length===0?i.jsx("div",{className:"compact-empty-state",children:te?"No matching patients.":"No patients registered."}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"compact-table-container",children:i.jsxs("table",{className:"compact-patients-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"w-16",children:"Token"}),i.jsx("th",{onClick:()=>$e("name"),className:"cursor-pointer hover:bg-gray-50 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-1",children:["Name",v==="name"&&(T==="asc"?i.jsx(To,{size:12}):i.jsx(Nu,{size:12}))]})}),i.jsx("th",{className:"w-16",children:"Age"}),i.jsx("th",{className:"w-16",children:"Sex"}),i.jsx("th",{children:"Phone"}),i.jsx("th",{children:"City/Address"}),i.jsx("th",{onClick:()=>$e("created_at"),className:"cursor-pointer hover:bg-gray-50 transition-colors",children:i.jsxs("div",{className:"flex items-center gap-1",children:["Reg. Date",v==="created_at"&&(T==="asc"?i.jsx(To,{size:12}):i.jsx(Nu,{size:12}))]})}),i.jsx("th",{children:"Sub. Status"}),i.jsx("th",{children:"Payment"}),i.jsx("th",{className:"w-24 text-center",children:"Action"})]})}),i.jsx("tbody",{children:n.map(pe=>i.jsxs("tr",{onClick:()=>He(pe),className:`compact-row ${ae===pe.id?"navigating":""}`,children:[i.jsxs("td",{className:"font-mono text-gray-500",children:["#",pe.token??"-"]}),i.jsx("td",{className:"font-medium text-gray-900",children:pe.name}),i.jsx("td",{children:pe.age??"-"}),i.jsx("td",{children:pe.gender??"-"}),i.jsx("td",{children:pe.phone??"-"}),i.jsx("td",{className:"truncate max-w-[150px]",title:pe.address||"",children:pe.address??"-"}),i.jsx("td",{className:"text-xs text-gray-500",children:he(pe.created_at)}),i.jsxs("td",{children:[i.jsx("span",{className:`compact-status-dot ${pe.subscription_status==="active"?"bg-green-500":["cancelled","expired"].includes(pe.subscription_status||"")?"bg-red-400":"bg-gray-300"}`}),i.jsx("span",{className:"text-xs ml-2 capitalize",children:pe.subscription_status??"None"})]}),i.jsx("td",{children:i.jsxs("select",{value:pe.insurance_type,onChange:ne=>me(pe.id,ne.target.value),onClick:ne=>ne.stopPropagation(),className:"compact-select-input",children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"insurance",children:"Insurance"}),i.jsx("option",{value:"no_cash_insurance",children:"N/C Ins"})]})}),i.jsx("td",{className:"text-center",children:i.jsx("button",{onClick:ne=>{ne.stopPropagation(),e(`/start-subscription/${pe.id}`)},className:"compact-action-btn",title:"Start Subscription",children:"Sub"})})]},pe.id))})]})}),g>1&&i.jsxs("div",{className:"compact-pagination",children:[i.jsx("button",{onClick:()=>f(pe=>Math.max(pe-1,1)),disabled:u===1||r,className:"compact-page-btn",children:i.jsx(Ib,{size:16})}),i.jsxs("span",{className:"text-xs text-gray-600 font-medium",children:[u," / ",g]}),i.jsx("button",{onClick:()=>f(pe=>Math.min(pe+1,g)),disabled:u===g||r,className:"compact-page-btn",children:i.jsx(xg,{size:16})})]})]}),I&&L&&i.jsx("div",{className:"subscription-modal-overlay",children:i.jsxs("div",{className:"subscription-modal-content",children:[i.jsxs("div",{className:"subscription-modal-header",children:[i.jsxs("h2",{className:"subscription-modal-title",children:["Start Subscription for ",L.name]}),i.jsx("button",{onClick:ge,className:"subscription-modal-close-button",children:i.jsx(Sn,{size:24})})]}),ee&&i.jsx("div",{className:"error-alert",role:"alert",children:i.jsx("span",{children:ee})}),i.jsxs("div",{className:"subscription-modal-body",children:[i.jsx("label",{htmlFor:"subscriptionPlan",className:"form-label",children:"Select Plan:"}),i.jsxs("select",{id:"subscriptionPlan",value:F,onChange:pe=>z(pe.target.value),className:"form-select",disabled:U||K||re!==null||B.length===0,children:[i.jsx("option",{value:"",disabled:!0,children:"-- Select a Plan --"}),K?i.jsx("option",{value:"",disabled:!0,children:"Loading plans..."}):re?i.jsx("option",{value:"",disabled:!0,children:"Error loading plans"}):B.length>0?B.map(pe=>i.jsxs("option",{value:pe.id,children:[pe.name," - ",pe.price," (",pe.interval," ",pe.period,pe.interval>1?"s":"",")"]},pe.id)):i.jsx("option",{value:"",disabled:!0,children:"No active plans found"})]}),re&&i.jsx("p",{className:"error-message",children:re}),B.length===0&&!K&&!re&&i.jsx("p",{className:"empty-state",children:"No active subscription plans available."})]}),i.jsxs("div",{className:"subscription-modal-footer",children:[i.jsx("button",{onClick:ge,disabled:U,className:"subscription-modal-button cancel",children:"Cancel"}),i.jsx("button",{onClick:Le,disabled:!F||U,className:"subscription-modal-button submit",children:U?"Starting...":"Start Subscription"})]})]})})]})},_T=()=>{const e=Ft(),[n]=w.useState(!0),[t,r]=w.useState(""),[a,o]=w.useState([]),[l,h]=w.useState(!1),[d,u]=w.useState(null),[f,g]=w.useState(!1),b=/^\+?[0-9\s\-().]{7,20}$/,v=w.useMemo(()=>Vb(async C=>{if(C.trim().length<2){o([]),h(!1),u(null);return}h(!0),u(null);try{const P=new URLSearchParams({search:encodeURIComponent(C),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),I=await ce(`/api/patients?${P.toString()}`);if(!I.ok){const L=await I.text();throw new Error(`API Error (${I.status}): ${L||I.statusText}`)}const q=await I.json();o(q.patients)}catch(P){console.error("Error searching patients:",P),u(P.message||"Failed to search patients."),o([])}finally{h(!1)}},300),[]),S=C=>{const P=C.target.value;r(P),g(b.test(P)),h(!0),v(P)},T=w.useCallback(C=>{e("/billing",{state:{patientId:C.id,patientName:C.name}})},[e]),E=w.useCallback(async()=>{if(!t||!f){u("Invalid phone number to create a new patient.");return}h(!0),u(null);try{const P=await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"direct pharmacy",phone:t,age:null,gender:null,token:null})});if(!P.ok){const q=await P.json();throw new Error(q.message||`Failed to create patient: ${P.statusText}`)}const I=await P.json();alert(`New patient "direct pharmacy" created with phone ${I.phone}.`),T(I)}catch(C){console.error("Error creating new patient:",C),u(C.message||"Failed to create new patient.")}finally{h(!1)}},[t,f,T]);return i.jsxs("div",{className:"create-custom-bill-page p-4 md:p-6 max-w-5xl mx-auto",children:[i.jsx("div",{className:"page-header flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 pb-4",children:i.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[i.jsx("button",{onClick:()=>e(-1),className:"back-button p-2 rounded-full mr-3",title:"Go Back",children:i.jsx(fn,{size:20})}),i.jsx("h2",{className:"text-2xl",children:"Create Custom Bill"})]})}),n&&i.jsxs("div",{className:"content-section",children:[i.jsx("h3",{className:"section-title",children:"Select Patient"}),i.jsxs("div",{className:"mb-3 relative",children:[i.jsx("label",{htmlFor:"patient-search",className:"form-label",children:"Search Patient (Name, Token, or Phone)"}),i.jsx("input",{type:"text",id:"patient-search",placeholder:"Search by Name, Token No, or Phone No (min 2 chars)...",value:t,onChange:S,className:"custom-text-input mt-1",autoFocus:!0}),l&&i.jsx("span",{className:"absolute right-3 top-9 text-xs text-gray-400",children:"Searching..."})]}),d&&i.jsx("div",{className:"ai-function-status error mb-3 p-3",children:d}),a.length>0&&i.jsx("div",{className:"patient-search-results max-h-64 overflow-y-auto rounded-md shadow-sm mt-1 z-10",children:i.jsx("ul",{children:a.map(C=>i.jsxs("li",{onClick:()=>T({id:C.id,name:C.name,token:C.token,age:C.age,gender:C.gender,phone:C.phone}),children:[i.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[i.jsxs("div",{className:"font-medium",children:[i.jsxs("span",{className:"patient-token mr-2",children:["#",C.token]}),C.name]}),i.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:mt-0",children:[C.age?`${C.age} yrs`:"Age N/A",C.gender?` / ${C.gender}`:" / Gender N/A",C.phone&&i.jsxs("span",{className:"hidden sm:inline",children:[" / ",C.phone]})]})]}),C.phone&&i.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:hidden",children:["Phone: ",C.phone]})]},C.id))})}),t.length>=2&&!l&&a.length===0&&!d&&i.jsxs(i.Fragment,{children:[i.jsxs("p",{className:"text-gray-400 mt-2 text-sm",children:['No patients found matching "',t,'".']}),f&&i.jsx("button",{type:"button",onClick:E,className:"create-patient-button mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",disabled:l,children:'Create "direct pharmacy" Patient with this Phone'})]}),t.length<2&&!l&&i.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"Enter at least 2 characters to search."})]})]})},CT=({currentUser:e})=>{const n=Ft(),[t,r]=w.useState("select_patient"),[a,o]=w.useState({name:"",age:void 0,gender:null,phone:"",address:""}),[l,h]=w.useState(null),[d,u]=w.useState([]),[f,g]=w.useState([]),[b,v]=w.useState(""),[S,T]=w.useState([]),[E,C]=w.useState(""),[P,I]=w.useState([]),[q,L]=w.useState(!1),[O,B]=w.useState(null),[$,F]=w.useState(null),[z,U]=w.useState(null),[V,ee]=w.useState(!1),[ie,ae]=w.useState(!1),[J,K]=w.useState(!1),W=/^\+?[0-9\s\-().]{7,20}$/,re=/^[a-zA-Z\s'-]{2,}$/,A=w.useCallback(async()=>{if(!(d.length>0)){ee(!0),U(null);try{const ne=await ce("/api/lab-tests");if(!ne.ok)throw new Error("Failed to fetch lab tests");const Pe=await ne.json();u(Pe)}catch(ne){console.error("Failed to fetch available lab tests:",ne),U("Could not load lab test list: "+ne.message),u([])}finally{ee(!1)}}},[d.length]);w.useEffect(()=>{if(!b){T([]);return}const ne=b.toLowerCase();T(d.filter(Pe=>Pe.name.toLowerCase().includes(ne)||Pe.description&&Pe.description.toLowerCase().includes(ne)).slice(0,10))},[b,d]);const te=w.useCallback(ne=>{const Pe={id:ne.id,name:ne.name,token:ne.token,age:ne.age,gender:ne.gender,phone:ne.phone};h(Pe),r("create_order"),g([]),v(""),T([]),U(null),A()},[A]),xe=w.useMemo(()=>Vb(async ne=>{if(ne.trim().length<2){I([]),L(!1),B(null);return}L(!0),B(null);try{const Pe=new URLSearchParams({search:encodeURIComponent(ne),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),Ye=await ce(`/api/patients?${Pe.toString()}`);if(!Ye.ok){const ut=await Ye.text();throw new Error(`API Error (${Ye.status}): ${ut||Ye.statusText}`)}const rt=await Ye.json();I(rt.patients)}catch(Pe){console.error("Error searching lab patients:",Pe),B(Pe.message||"Failed to search lab patients."),I([])}finally{L(!1)}},300),[W,re]),M=ne=>{const Pe=ne.target.value;C(Pe),ae(W.test(Pe)),K(re.test(Pe)&&!W.test(Pe)),L(!0),xe(Pe)},Se=w.useCallback(async ne=>{if(!E||ne==="phone"&&!ie||ne==="name"&&!J){B(`Invalid ${ne} to create a new patient.`);return}L(!0),B(null);try{const rt=await(await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ne==="name"?E:"direct lab",phone:ne==="phone"?E:null,age:null,gender:null,token:null})})).json();alert(`New patient "${rt.name}" created with ${ne==="phone"?`phone ${rt.phone}`:`name ${rt.name}`}.`),te({id:rt.id,name:rt.name,token:rt.token??null,age:rt.age??null,gender:rt.gender??null,phone:rt.phone})}catch(Pe){console.error("Error creating new patient:",Pe);const Ye=Pe.message||"";if(Ye.toLowerCase().includes("patient limit")){n("/start-clinic-subscription",{state:{errorMessage:Ye}});return}B(Ye||"Failed to create new patient.")}finally{L(!1)}},[E,ie,J,te]),$e=()=>{o({name:"",age:void 0,gender:null,phone:"",address:""}),F(null),r("create_patient"),h(null)},he=()=>{r("select_patient"),h(null),C(""),I([]),B(null)},ge=ne=>{const{name:Pe,value:Ye}=ne.target;o(rt=>({...rt,[Pe]:Pe==="age"?Ye?parseInt(Ye,10):void 0:Ye}))},me=async ne=>{if(ne.preventDefault(),F(null),!a.name){F("Patient Name is required.");return}const Pe={name:a.name,age:a.age,gender:a.gender,phone:a.phone,address:a.address};try{const rt=await(await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Pe)})).json();te({id:rt.id,name:rt.name,token:rt.token??null,age:rt.age??null,gender:rt.gender??null,phone:rt.phone})}catch(Ye){console.error("Failed to create patient:",Ye);const rt=Ye.message||"";if(rt.toLowerCase().includes("patient limit")){n("/start-clinic-subscription",{state:{errorMessage:rt}});return}F(rt||"Failed to create patient. Please try again.")}},de=ne=>{if(f.some(Pe=>Pe.id===ne.id)){U(`${ne.name} is already in the order.`),setTimeout(()=>U(null),3e3),v(""),T([]);return}g(Pe=>[...Pe,{...ne}]),v(""),T([])},Le=ne=>{g(Pe=>Pe.filter(Ye=>Ye.id!==ne))},He=async ne=>{if(ne.preventDefault(),U(null),!l){U("No patient selected.");return}if(f.length===0){U("No lab tests selected.");return}const Pe={patient_id:l.id,tests:f.map(Ye=>({id:Ye.id,name:Ye.name,price:Ye.price}))};try{const Ye=await ce("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Pe)});if(!Ye.ok){const ut=await Ye.json();throw new Error(ut.message||`Failed to create lab order: ${Ye.statusText}`)}await Ye.json();let rt=l.queueId;if(!rt){const ut=await ce(`/api/queue/patient/${l.id}/latest`);if(ut.ok){const je=await ut.json();je!=null&&je._id&&(rt=je._id)}}if(!rt){const ut=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:l.id})});if(!ut.ok){const Qe=await ut.text();throw new Error(`Failed to create queue entry for redirection: ${Qe||ut.statusText}`)}const je=await ut.json();je!=null&&je.id&&(rt=je.id)}alert(`Lab order created successfully for ${l.name}!`),(e==null?void 0:e.role)==="lab"?n("/dashboard"):n(`/dashboard/edit-complaint/${rt}`,{state:{patientId:l.id}})}catch(Ye){console.error("Failed to create lab order:",Ye),U(Ye.message||"Failed to create lab order.")}};w.useEffect(()=>{A()},[A]);const pe=()=>f.reduce((ne,Pe)=>ne+parseFloat(Pe.price),0).toFixed(2);return i.jsxs("div",{className:"create-lab-order-page",children:[i.jsxs("div",{className:"page-header",children:[i.jsx("button",{onClick:()=>n(-1),className:"back-button","aria-label":"Go back",children:i.jsx(fn,{size:20})}),i.jsx("h1",{children:"Create New Lab Order"}),i.jsx("div",{className:"w-10"})," "]}),(t==="select_patient"||t==="create_patient")&&i.jsxs("div",{className:"patient-selection-container",children:[t==="select_patient"&&i.jsxs("div",{className:"content-panel",children:[i.jsx("h2",{className:"section-title",style:{justifyContent:"center"},children:"Select Patient"}),i.jsxs("div",{className:"search-input-wrapper",children:[i.jsx(Pi,{className:"search-icon",size:20}),i.jsx("input",{type:"text",placeholder:"Search by Name, Token, or Phone...",value:E,onChange:M,className:"custom-text-input",autoFocus:!0})]}),q&&i.jsx("div",{className:"loading-text",style:{marginTop:"1rem"},children:"detail..."}),O&&i.jsx("div",{className:"error-text",children:O}),P.length>0&&i.jsx("div",{className:"search-results-dropdown",style:{position:"relative",boxShadow:"none",borderTop:"none",maxHeight:"40vh"},children:P.map(ne=>i.jsxs("div",{onClick:()=>te(ne),className:"search-result-item",children:[i.jsxs("div",{children:[ne.token&&i.jsxs("span",{className:"token-badge",children:["#",ne.token]}),i.jsx("span",{style:{fontWeight:500},children:ne.name})]}),i.jsxs("div",{style:{fontSize:"0.9em",color:"var(--text-secondary)"},children:[ne.age?`${ne.age}y`:"",ne.gender?` / ${ne.gender}`:"",ne.phone?` / ${ne.phone}`:""]})]},ne.id))}),E.length>=2&&!q&&P.length===0&&!O&&i.jsxs("div",{style:{marginTop:"1.5rem"},children:[i.jsxs("p",{className:"no-data",children:['No patients found matching "',E,'".']}),i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px",marginTop:"10px"},children:[ie&&i.jsxs("button",{type:"button",onClick:()=>Se("phone"),className:"btn-primary",children:["Create Patient with Phone ",E]}),J&&i.jsxs("button",{type:"button",onClick:()=>Se("name"),className:"btn-primary",children:['Create Patient with Name "',E,'"']})]})]}),i.jsx("div",{className:"or-divider",children:"OR"}),i.jsxs("button",{onClick:$e,className:"btn-secondary",style:{width:"100%"},children:[i.jsx(Pl,{size:18,style:{marginRight:"8px",verticalAlign:"text-bottom"}}),"Register New Patient manually"]})]}),t==="create_patient"&&i.jsxs("div",{className:"content-panel",children:[i.jsxs("div",{className:"section-title",style:{justifyContent:"space-between"},children:[i.jsx("span",{children:"Register New Patient"}),i.jsx("button",{onClick:he,className:"action-link-btn",children:"Back to Search"})]}),$&&i.jsx("div",{className:"error-text",children:$}),i.jsxs("form",{onSubmit:me,children:[i.jsxs("div",{className:"form-grid",children:[i.jsxs("div",{className:"form-group",style:{gridColumn:"1 / -1"},children:[i.jsx("label",{htmlFor:"lab-patient-name",children:"Name *"}),i.jsx("input",{type:"text",name:"name",id:"lab-patient-name",required:!0,value:a.name,onChange:ge,className:"form-input",placeholder:"Patient Full Name"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"lab-patient-age",children:"Age"}),i.jsx("input",{type:"number",name:"age",id:"lab-patient-age",value:a.age??"",onChange:ge,className:"form-input",placeholder:"Age"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"lab-patient-gender",children:"Gender"}),i.jsxs("select",{name:"gender",id:"lab-patient-gender",value:a.gender??"",onChange:ge,className:"form-select",children:[i.jsx("option",{value:"",children:"Select..."})," ",i.jsx("option",{value:"M",children:"Male"})," ",i.jsx("option",{value:"F",children:"Female"})," ",i.jsx("option",{value:"O",children:"Other"})]})]}),i.jsxs("div",{className:"form-group",style:{gridColumn:"1 / -1"},children:[i.jsx("label",{htmlFor:"lab-patient-phone",children:"Phone"}),i.jsx("input",{type:"tel",name:"phone",id:"lab-patient-phone",value:a.phone||"",onChange:ge,className:"form-input",placeholder:"Phone Number"})]}),i.jsxs("div",{className:"form-group",style:{gridColumn:"1 / -1"},children:[i.jsx("label",{htmlFor:"lab-patient-address",children:"Address"}),i.jsx("textarea",{name:"address",id:"lab-patient-address",rows:2,value:a.address||"",onChange:ge,className:"form-textarea",placeholder:"Address (Optional)"})]})]}),i.jsxs("div",{style:{marginTop:"2rem",display:"flex",justifyContent:"flex-end",gap:"1rem"},children:[i.jsx("button",{type:"button",onClick:he,className:"btn-secondary",children:" Cancel "}),i.jsx("button",{type:"submit",className:"btn-primary",children:" Create & Proceed "})]})]})]})]}),t==="create_order"&&l&&i.jsxs("div",{className:"lab-order-grid",children:[i.jsx("div",{className:"left-column",children:i.jsxs("div",{className:"content-panel",children:[i.jsx("h2",{className:"section-title",children:"Add Lab Tests"}),i.jsxs("div",{className:"search-input-wrapper",style:{marginBottom:"1.5rem"},children:[i.jsx(Pi,{className:"search-icon",size:20}),i.jsx("input",{type:"text",placeholder:"Search available lab tests...",value:b,onChange:ne=>v(ne.target.value),className:"custom-text-input",disabled:V,autoFocus:!0}),V&&i.jsx("span",{style:{position:"absolute",right:"15px",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Loading..."}),b&&S.length>0&&i.jsx("div",{className:"search-results-dropdown",children:S.map(ne=>i.jsxs("div",{onClick:()=>de(ne),className:"search-result-item",children:[i.jsx("span",{children:ne.name}),i.jsxs("span",{style:{fontWeight:600,color:"var(--primary-color)"},children:["",parseFloat(ne.price).toFixed(2)]})]},ne.id))}),b&&S.length===0&&!V&&i.jsx("div",{className:"search-results-dropdown",style:{padding:"1rem",color:"var(--text-secondary)",textAlign:"center"},children:"No tests found."})]}),z&&i.jsxs("div",{className:"error-text",style:{display:"flex",alignItems:"center",gap:"10px"},children:[i.jsx(mi,{size:18})," ",z]}),i.jsx("div",{className:"order-table-container",children:i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Test Name"}),i.jsx("th",{style:{width:"100px",textAlign:"right"},children:"Price"}),i.jsx("th",{style:{width:"60px",textAlign:"center"},children:"Action"})]})}),i.jsx("tbody",{children:f.length===0?i.jsx("tr",{children:i.jsx("td",{colSpan:3,className:"no-data",children:"No tests added yet. Search above to add."})}):f.map(ne=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsx("span",{style:{fontWeight:500},children:ne.name})}),i.jsxs("td",{style:{textAlign:"right",fontWeight:600},children:["",parseFloat(ne.price).toFixed(2)]}),i.jsx("td",{style:{textAlign:"center"},children:i.jsx("button",{type:"button",onClick:()=>Le(ne.id),className:"delete-btn",title:"Remove",children:i.jsx(Wi,{size:16})})})]},ne.id))})]})})]})}),i.jsxs("div",{className:"right-column",children:[i.jsxs("div",{className:"patient-card",children:[i.jsx("div",{className:"patient-avatar",children:i.jsx(Mo,{size:32})}),i.jsx("h3",{className:"patient-name",children:l.name}),i.jsxs("div",{className:"patient-info-text",children:[l.age?`${l.age} yrs`:"",l.gender?`  ${l.gender}`:""]}),l.phone&&i.jsx("div",{className:"patient-info-text",style:{marginTop:"4px"},children:l.phone}),i.jsx("button",{onClick:he,className:"change-patient-btn",children:"Change Patient"})]}),i.jsxs("div",{className:"order-summary-container",children:[i.jsx("h3",{className:"section-title",style:{marginBottom:"1rem"},children:"Order Summary"}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Total Tests"}),i.jsx("span",{children:f.length})]}),i.jsxs("div",{className:"summary-total",children:[i.jsx("span",{className:"total-label",children:"Total Amount"}),i.jsxs("span",{className:"total-value",children:["",pe()]})]}),i.jsx("button",{onClick:He,disabled:f.length===0,className:"create-order-btn",children:"Confirm Order"}),i.jsx("button",{type:"button",onClick:()=>n(-1),className:"btn-secondary",style:{width:"100%",marginTop:"1rem",border:"none",color:"var(--text-secondary)"},children:"Cancel"})]})]})]})]})},nG=({currentUser:e})=>{const[n,t]=w.useState("newtons-ai"),[r,a]=w.useState(""),[o,l]=w.useState([]),[h,d]=w.useState(!0),[u,f]=w.useState([]),[g,b]=w.useState(!1),[v,S]=w.useState(null),[T,E]=w.useState(null),C=Ft(),P=async()=>{d(!0),E(null);let F=[];try{const z=await ce("/api/queue");if(!z.ok){const ee=await z.json();throw new Error(ee.message||"Failed to fetch queue")}F=await z.json(),console.log("Fetched Initial Queue Data:",JSON.stringify(F,null,2));const U=F.map(async ee=>{if(!ee.patient_id)return console.warn(`Queue entry ${ee.id} has no patient_id.`),ee;try{const ie=await ce(`/api/patients/${ee.patient_id}`);if(!ie.ok)return console.error(`Failed to fetch patient details for ${ee.patient_id}: ${ie.status}`),ee;const ae=await ie.json();return{...ee,Patient:{...ee.Patient??{},...ae}}}catch(ie){return console.error(`Error fetching patient details for ${ee.patient_id}:`,ie),ee}}),V=await Promise.all(U);console.log("Enriched Queue Data (Before Sort):",JSON.stringify(V,null,2)),V.sort((ee,ie)=>{var re,A;const ae=((re=ee.Patient)==null?void 0:re.subscription_status)==="active",J=((A=ie.Patient)==null?void 0:A.subscription_status)==="active";if(ae&&!J)return-1;if(!ae&&J)return 1;const K=ee.created_at?new Date(ee.created_at).getTime():0,W=ie.created_at?new Date(ie.created_at).getTime():0;return K-W}),console.log("Sorted Queue Data:",JSON.stringify(V,null,2)),l(V)}catch(z){console.error("Error in fetchQueue process:",z),E(`Failed to load queue: ${z.message}`),l(F)}finally{d(!1)}},I=async()=>{b(!0),E(null);try{const F=await ce("/api/staff?role=doctor");if(!F.ok){const U=await F.json();throw new Error(U.message||"Failed to fetch doctors")}const z=await F.json();f(z.filter(U=>U.active))}catch(F){console.error("Error fetching doctors:",F),E(`Failed to fetch doctors: ${F.message}`)}finally{b(!1)}};w.useEffect(()=>{n==="queue"&&(P(),I()),S(null)},[n]);const q=w.useCallback(async(F,z)=>{if(console.log(`Attempting to assign doctor ${z} to queue ${F}`),E(null),S(null),!z){console.log("No doctor ID provided, skipping assignment.");return}const U=o.find(ie=>ie.id===F);if(!U){console.error(`Queue entry ${F} not found in local state.`),E("Queue entry not found.");return}if(U.doctor_id===z){console.log(`Queue ${F} already assigned to doctor ${z}. Skipping.`);return}const V=async ie=>{if(!ie||!ie.id||!ie.name){E("Cannot proceed: Patient ID or Name is missing."),console.error("assignAndNavigate called with invalid patientInfo",ie);return}const ae=async()=>{try{const J={status:"waiting",doctorId:z},K=await ce(`/api/queue/${F}/status`,{method:"PATCH",body:JSON.stringify(J)}),W=await K.json();if(!K.ok)throw new Error(W.message||`HTTP error! status: ${K.status}`);const re=u.find(A=>A.id===z);return console.log(`Successfully assigned doctor ${re==null?void 0:re.name} to queue ${F}.`),l(A=>A.map(te=>te.id===F?{...te,doctor_id:z,status:W.status||te.status,User:re?{name:re.name}:null,Patient:ie}:te)),!0}catch(J){return console.error(`Error assigning doctor for queue ${F}:`,J),E(`Failed to assign doctor: ${J.message}`),!1}};ie.subscription_status==="active"?(console.log(`Patient ${ie.name} (ID: ${ie.id}) has active subscription. Assigning doctor directly.`),await ae()):(console.log(`Patient ${ie.name} (ID: ${ie.id}) does not have active subscription (Status: ${ie.subscription_status}). Navigating to billing first.`),console.log(`Navigating to billing for patient ${ie.name} (ID: ${ie.id}), queue ID: ${F}, doctor ID: ${z}`),C("/billing",{state:{patientId:ie.id,queueId:F,patientName:ie.name,doctorId:z,billType:"consultation",finalizeQueueAssignment:!0}}))},ee=U.Patient;if(ee&&ee.id&&ee.name)console.log("Patient details found in state. Proceeding with assignment."),await V(ee);else{console.warn(`Patient details missing for queue entry ${F}. Fetching patient ${U.patient_id}...`);try{const ie=await ce(`/api/patients/${U.patient_id}`);if(!ie.ok){const J=await ie.json().catch(()=>({}));throw new Error(J.message||`Failed to fetch patient details (status ${ie.status})`)}const ae=await ie.json();console.log("Successfully fetched patient details:",ae),await V(ae)}catch(ie){console.error(`Failed to fetch patient details for patient ID ${U.patient_id}:`,ie),E(`Failed to fetch required patient details: ${ie.message}`)}}},[u,o,C]),L=async(F,z)=>{E(null);const U=z==="consulting"?"start consultation":"complete visit";try{const V=o.find(J=>J.id===F);if(!V&&z==="consulting")throw new Error("Queue entry not found to start consultation.");let ee={status:z};if(z==="consulting"){if(!(V!=null&&V.doctor_id))throw new Error("Cannot start consultation without an assigned doctor.");ee.doctorId=V.doctor_id}const ie=await ce(`/api/queue/${F}/status`,{method:"PATCH",body:JSON.stringify(ee)}),ae=await ie.json();if(!ie.ok)throw new Error(ae.message||`HTTP error! status: ${ie.status}`);l(J=>J.map(K=>K.id===F?{...K,status:z}:K))}catch(V){console.error(`Error trying to ${U}:`,V),E(`Failed to ${U}: ${V.message}`)}},O=[{id:"queue",label:"Queue",icon:i.jsx(Zf,{size:20})},{id:"newtons-ai",label:"Newtons AI",icon:i.jsx(Pi,{size:20})},{id:"manage-admission",label:"Manage Admission",icon:i.jsx(WP,{size:20})},{id:"all-patients",label:"All Patients",icon:i.jsx(YI,{size:20})},{id:"lab",label:"Lab Tests",icon:i.jsx(JC,{size:20})},{id:"custom-bill",label:"Custom Bill",icon:i.jsx(gc,{size:20})}],B=F=>{try{return new Date(F).toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},$=o.filter(F=>{var z,U;return(U=(z=F.Patient)==null?void 0:z.name)==null?void 0:U.toLowerCase().includes(r.toLowerCase())});return i.jsx("div",{className:"reception-dashboard-container",children:i.jsxs("main",{className:"flex-1 overflow-y-auto",children:[T&&i.jsxs("div",{className:"error-message-reception",role:"alert",children:[" ",i.jsx("strong",{children:"Error: "}),i.jsx("span",{children:T})]}),i.jsxs("div",{className:"reception-tab-nav",children:[" ",O.map(F=>i.jsxs("button",{className:`reception-tab-button ${n===F.id?"active":""}`,onClick:()=>t(F.id),children:[i.jsx("span",{children:F.icon}),F.label]},F.id))]}),n==="queue"&&i.jsxs("div",{className:"space-y-6",children:[" ",i.jsxs("div",{className:"queue-header",children:[" ",i.jsxs("div",{className:"queue-actions",children:[" ",i.jsxs("div",{className:"search-bar-container",children:[" ",i.jsx("input",{type:"text",placeholder:"Search patients in queue...",className:"search-input",value:r,onChange:F=>a(F.target.value)}),i.jsx(Pi,{className:"search-icon",size:18})]})]}),i.jsxs("div",{className:"summary-cards-grid",children:[" ",i.jsxs("div",{className:"summary-card card-waiting",children:[" ",i.jsx("div",{className:"summary-card-title",children:"Waiting"})," ",i.jsx("div",{className:"summary-card-value",children:o.filter(F=>F.status==="waiting").length})," "]}),i.jsxs("div",{className:"summary-card card-consulting",children:[" ",i.jsx("div",{className:"summary-card-title",children:"Consulting"})," ",i.jsx("div",{className:"summary-card-value",children:o.filter(F=>F.status==="consulting").length})," "]}),i.jsxs("div",{className:"summary-card card-completed",children:[" ",i.jsx("div",{className:"summary-card-title",children:"Completed"})," ",i.jsx("div",{className:"summary-card-value",children:o.filter(F=>F.status==="seen").length})," "]})]})]}),h?i.jsxs("div",{className:"loading-container",children:[" ",i.jsx("div",{className:"breathing-ball"})," ",i.jsx("span",{children:"Loading queue..."})]}):$.length===0?i.jsx("div",{className:"empty-queue-message",children:r?"No patients found matching your search.":"Queue is empty."}):i.jsxs("div",{className:"queue-table-wrapper",children:[" ",i.jsxs("table",{className:"queue-table",children:[" ",i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Queue"}),i.jsx("th",{children:"Patient"}),i.jsx("th",{children:"Phone Number"}),i.jsx("th",{children:"Complaint"}),i.jsx("th",{children:"Subscription Status"}),i.jsx("th",{className:"hidden md:table-cell",children:"Time Added"})," ",i.jsx("th",{className:"text-center",children:"Action / Doctor"})," "]})}),i.jsx("tbody",{children:$.map(F=>{var z,U,V,ee,ie,ae,J,K,W,re,A;return i.jsxs("tr",{onClick:()=>C(`/dashboard/edit-complaint/${F.id}`),className:"queue-row-clickable",children:[i.jsxs("td",{children:[" ",i.jsxs("span",{className:"queue-token",children:["#",F.token_no]})," "]}),i.jsxs("td",{children:[" ",i.jsx("div",{className:"patient-name",children:((z=F.Patient)==null?void 0:z.name)||"N/A"})," ",i.jsxs("div",{className:"patient-details",children:[(U=F.Patient)!=null&&U.age?`${F.Patient.age} yrs, `:"",((V=F.Patient)==null?void 0:V.gender)||""]})," "]}),i.jsxs("td",{children:[" ",i.jsx("div",{className:"patient-phone",children:((ee=F.Patient)==null?void 0:ee.phone)||"N/A"})," "]}),i.jsx("td",{className:"complaint-text",children:F.complaint||"-"}),i.jsxs("td",{children:[i.jsx("span",{className:`subscription-status-badge ${((ie=F.Patient)==null?void 0:ie.subscription_status)==="active"?"status-active":((ae=F.Patient)==null?void 0:ae.subscription_status)==="cancelled"||((J=F.Patient)==null?void 0:J.subscription_status)==="expired"?"status-inactive":"status-none"}`,children:((K=F.Patient)==null?void 0:K.subscription_status)??"None"}),F.Patient&&F.Patient.id&&F.Patient.subscription_status!=="active"&&i.jsx("button",{onClick:te=>{te.stopPropagation(),F.Patient&&C(`/start-subscription/${F.Patient.id}`)},className:"action-button btn-start-sub-queue mt-2",children:"Start Sub"})]}),i.jsx("td",{className:"hidden md:table-cell time-added",children:B(F.created_at)}),i.jsx("td",{className:"action-doctor-cell",children:v===F.id?i.jsx("div",{className:"relative inline-block text-left w-full",onClick:te=>te.stopPropagation(),children:i.jsxs("select",{value:"",onChange:te=>q(F.id,te.target.value),onBlur:()=>S(null),className:"doctor-select-dropdown",autoFocus:!0,children:[i.jsx("option",{value:"",disabled:!0,children:"Select Doctor..."}),g?i.jsx("option",{disabled:!0,children:"Loading..."}):u.length>0?u.map(te=>i.jsx("option",{value:te.id,children:te.name},te.id)):i.jsx("option",{disabled:!0,children:"No doctors available"})]})}):i.jsxs("div",{className:"action-doctor-content",onClick:te=>te.stopPropagation(),children:[" ",F.status==="waiting"&&i.jsx(i.Fragment,{children:(W=F.User)!=null&&W.name?i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"doctor-name-display",children:F.User.name}),i.jsx("button",{onClick:()=>L(F.id,"consulting"),className:"action-button btn-start",children:"Start"})]}):g?i.jsx("span",{className:"status-text-italic",children:"Loading..."}):u.length===0?i.jsx("span",{className:"status-text-red",children:"No doctors"}):u.length===1?i.jsxs("button",{onClick:()=>q(F.id,u[0].id),className:"action-button btn-assign",children:["Assign ",u[0].name]}):i.jsx("button",{onClick:()=>S(F.id),className:"action-button btn-assign",children:"Assign"})}),F.status==="consulting"&&i.jsxs(i.Fragment,{children:[((re=F.User)==null?void 0:re.name)&&i.jsx("span",{className:"doctor-name-display",children:F.User.name}),i.jsx("button",{onClick:()=>L(F.id,"seen"),className:"action-button btn-complete",children:"Complete"})]}),F.status==="seen"&&i.jsxs(i.Fragment,{children:[((A=F.User)==null?void 0:A.name)&&i.jsx("span",{className:"doctor-name-display",children:F.User.name}),i.jsx("span",{className:"status-text-italic",children:"Completed"})]}),F.status==="cancelled"&&i.jsx("span",{className:"status-text-red",children:"Cancelled"})]})})]},F.id)})})]})]})]}),n==="lab"&&i.jsxs("div",{className:"lab-tab-content",children:[" ",i.jsx(CT,{currentUser:e}),i.jsxs("button",{onClick:()=>C("/lab/search-report"),className:"lab-action-button btn-search-lab-reports",children:[i.jsx(Pi,{size:16}),"Search Lab Reports"]})]}),n==="newtons-ai"&&i.jsx("div",{className:"newtons-ai-tab-content",children:i.jsx(qf,{})}),n==="manage-admission"&&i.jsx("div",{className:"manage-admission-tab-content",children:i.jsx(jT,{})}),n==="all-patients"&&i.jsx("div",{className:"all-patients-tab-content",children:i.jsx(F1,{})}),n==="custom-bill"&&i.jsx("div",{className:"custom-bill-tab-content",children:i.jsx(_T,{})})]})})},kT=6048e5,iG=864e5,TT=6e4,ET=36e5,g_=Symbol.for("constructDateFrom");function Ro(e,n){return typeof e=="function"?e(n):e&&typeof e=="object"&&g_ in e?e[g_](n):e instanceof Date?new e.constructor(n):new Date(n)}function na(e,n){return Ro(n||e,e)}function $1(e,n,t){const r=na(e,t==null?void 0:t.in);if(isNaN(n))return Ro(e,NaN);if(!n)return r;const a=r.getDate(),o=Ro(e,r.getTime());o.setMonth(r.getMonth()+n+1,0);const l=o.getDate();return a>=l?o:(r.setFullYear(o.getFullYear(),o.getMonth(),a),r)}let rG={};function Jb(){return rG}function fg(e,n){var h,d,u,f;const t=Jb(),r=(n==null?void 0:n.weekStartsOn)??((d=(h=n==null?void 0:n.locale)==null?void 0:h.options)==null?void 0:d.weekStartsOn)??t.weekStartsOn??((f=(u=t.locale)==null?void 0:u.options)==null?void 0:f.weekStartsOn)??0,a=na(e,n==null?void 0:n.in),o=a.getDay(),l=(o<r?7:0)+o-r;return a.setDate(a.getDate()-l),a.setHours(0,0,0,0),a}function Nb(e,n){return fg(e,{...n,weekStartsOn:1})}function AT(e,n){const t=na(e,n==null?void 0:n.in),r=t.getFullYear(),a=Ro(t,0);a.setFullYear(r+1,0,4),a.setHours(0,0,0,0);const o=Nb(a),l=Ro(t,0);l.setFullYear(r,0,4),l.setHours(0,0,0,0);const h=Nb(l);return t.getTime()>=o.getTime()?r+1:t.getTime()>=h.getTime()?r:r-1}function y_(e){const n=na(e),t=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()));return t.setUTCFullYear(n.getFullYear()),+e-+t}function aG(e,...n){const t=Ro.bind(null,n.find(r=>typeof r=="object"));return n.map(t)}function x_(e,n){const t=na(e,n==null?void 0:n.in);return t.setHours(0,0,0,0),t}function sG(e,n,t){const[r,a]=aG(t==null?void 0:t.in,e,n),o=x_(r),l=x_(a),h=+o-y_(o),d=+l-y_(l);return Math.round((h-d)/iG)}function oG(e,n){const t=AT(e,n),r=Ro(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),Nb(r)}function lG(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function pg(e){return!(!lG(e)&&typeof e!="number"||isNaN(+na(e)))}function cG(e,n){const t=na(e,n==null?void 0:n.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const uG={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},dG=(e,n,t)=>{let r;const a=uG[e];return typeof a=="string"?r=a:n===1?r=a.one:r=a.other.replace("{{count}}",n.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r};function M0(e){return(n={})=>{const t=n.width?String(n.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const hG={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},fG={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},pG={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},mG={date:M0({formats:hG,defaultWidth:"full"}),time:M0({formats:fG,defaultWidth:"full"}),dateTime:M0({formats:pG,defaultWidth:"full"})},gG={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},yG=(e,n,t,r)=>gG[e];function Vm(e){return(n,t)=>{const r=t!=null&&t.context?String(t.context):"standalone";let a;if(r==="formatting"&&e.formattingValues){const l=e.defaultFormattingWidth||e.defaultWidth,h=t!=null&&t.width?String(t.width):l;a=e.formattingValues[h]||e.formattingValues[l]}else{const l=e.defaultWidth,h=t!=null&&t.width?String(t.width):e.defaultWidth;a=e.values[h]||e.values[l]}const o=e.argumentCallback?e.argumentCallback(n):n;return a[o]}}const xG={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},bG={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},vG={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},wG={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},NG={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},SG={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},jG=(e,n)=>{const t=Number(e),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},_G={ordinalNumber:jG,era:Vm({values:xG,defaultWidth:"wide"}),quarter:Vm({values:bG,defaultWidth:"wide",argumentCallback:e=>e-1}),month:Vm({values:vG,defaultWidth:"wide"}),day:Vm({values:wG,defaultWidth:"wide"}),dayPeriod:Vm({values:NG,defaultWidth:"wide",formattingValues:SG,defaultFormattingWidth:"wide"})};function Hm(e){return(n,t={})=>{const r=t.width,a=r&&e.matchPatterns[r]||e.matchPatterns[e.defaultMatchWidth],o=n.match(a);if(!o)return null;const l=o[0],h=r&&e.parsePatterns[r]||e.parsePatterns[e.defaultParseWidth],d=Array.isArray(h)?kG(h,g=>g.test(l)):CG(h,g=>g.test(l));let u;u=e.valueCallback?e.valueCallback(d):d,u=t.valueCallback?t.valueCallback(u):u;const f=n.slice(l.length);return{value:u,rest:f}}}function CG(e,n){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&n(e[t]))return t}function kG(e,n){for(let t=0;t<e.length;t++)if(n(e[t]))return t}function TG(e){return(n,t={})=>{const r=n.match(e.matchPattern);if(!r)return null;const a=r[0],o=n.match(e.parsePattern);if(!o)return null;let l=e.valueCallback?e.valueCallback(o[0]):o[0];l=t.valueCallback?t.valueCallback(l):l;const h=n.slice(a.length);return{value:l,rest:h}}}const EG=/^(\d+)(th|st|nd|rd)?/i,AG=/\d+/i,DG={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},PG={any:[/^b/i,/^(a|c)/i]},IG={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},MG={any:[/1/i,/2/i,/3/i,/4/i]},RG={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},OG={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},LG={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},FG={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},$G={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},zG={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},BG={ordinalNumber:TG({matchPattern:EG,parsePattern:AG,valueCallback:e=>parseInt(e,10)}),era:Hm({matchPatterns:DG,defaultMatchWidth:"wide",parsePatterns:PG,defaultParseWidth:"any"}),quarter:Hm({matchPatterns:IG,defaultMatchWidth:"wide",parsePatterns:MG,defaultParseWidth:"any",valueCallback:e=>e+1}),month:Hm({matchPatterns:RG,defaultMatchWidth:"wide",parsePatterns:OG,defaultParseWidth:"any"}),day:Hm({matchPatterns:LG,defaultMatchWidth:"wide",parsePatterns:FG,defaultParseWidth:"any"}),dayPeriod:Hm({matchPatterns:$G,defaultMatchWidth:"any",parsePatterns:zG,defaultParseWidth:"any"})},UG={code:"en-US",formatDistance:dG,formatLong:mG,formatRelative:yG,localize:_G,match:BG,options:{weekStartsOn:0,firstWeekContainsDate:1}};function qG(e,n){const t=na(e,n==null?void 0:n.in);return sG(t,cG(t))+1}function VG(e,n){const t=na(e,n==null?void 0:n.in),r=+Nb(t)-+oG(t);return Math.round(r/kT)+1}function DT(e,n){var f,g,b,v;const t=na(e,n==null?void 0:n.in),r=t.getFullYear(),a=Jb(),o=(n==null?void 0:n.firstWeekContainsDate)??((g=(f=n==null?void 0:n.locale)==null?void 0:f.options)==null?void 0:g.firstWeekContainsDate)??a.firstWeekContainsDate??((v=(b=a.locale)==null?void 0:b.options)==null?void 0:v.firstWeekContainsDate)??1,l=Ro((n==null?void 0:n.in)||e,0);l.setFullYear(r+1,0,o),l.setHours(0,0,0,0);const h=fg(l,n),d=Ro((n==null?void 0:n.in)||e,0);d.setFullYear(r,0,o),d.setHours(0,0,0,0);const u=fg(d,n);return+t>=+h?r+1:+t>=+u?r:r-1}function HG(e,n){var h,d,u,f;const t=Jb(),r=(n==null?void 0:n.firstWeekContainsDate)??((d=(h=n==null?void 0:n.locale)==null?void 0:h.options)==null?void 0:d.firstWeekContainsDate)??t.firstWeekContainsDate??((f=(u=t.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)??1,a=DT(e,n),o=Ro((n==null?void 0:n.in)||e,0);return o.setFullYear(a,0,r),o.setHours(0,0,0,0),fg(o,n)}function GG(e,n){const t=na(e,n==null?void 0:n.in),r=+fg(t,n)-+HG(t,n);return Math.round(r/kT)+1}function li(e,n){const t=e<0?"-":"",r=Math.abs(e).toString().padStart(n,"0");return t+r}const vu={y(e,n){const t=e.getFullYear(),r=t>0?t:1-t;return li(n==="yy"?r%100:r,n.length)},M(e,n){const t=e.getMonth();return n==="M"?String(t+1):li(t+1,2)},d(e,n){return li(e.getDate(),n.length)},a(e,n){const t=e.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(e,n){return li(e.getHours()%12||12,n.length)},H(e,n){return li(e.getHours(),n.length)},m(e,n){return li(e.getMinutes(),n.length)},s(e,n){return li(e.getSeconds(),n.length)},S(e,n){const t=n.length,r=e.getMilliseconds(),a=Math.trunc(r*Math.pow(10,t-3));return li(a,n.length)}},Of={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},b_={G:function(e,n,t){const r=e.getFullYear()>0?1:0;switch(n){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(e,n,t){if(n==="yo"){const r=e.getFullYear(),a=r>0?r:1-r;return t.ordinalNumber(a,{unit:"year"})}return vu.y(e,n)},Y:function(e,n,t,r){const a=DT(e,r),o=a>0?a:1-a;if(n==="YY"){const l=o%100;return li(l,2)}return n==="Yo"?t.ordinalNumber(o,{unit:"year"}):li(o,n.length)},R:function(e,n){const t=AT(e);return li(t,n.length)},u:function(e,n){const t=e.getFullYear();return li(t,n.length)},Q:function(e,n,t){const r=Math.ceil((e.getMonth()+1)/3);switch(n){case"Q":return String(r);case"QQ":return li(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,n,t){const r=Math.ceil((e.getMonth()+1)/3);switch(n){case"q":return String(r);case"qq":return li(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,n,t){const r=e.getMonth();switch(n){case"M":case"MM":return vu.M(e,n);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(e,n,t){const r=e.getMonth();switch(n){case"L":return String(r+1);case"LL":return li(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(e,n,t,r){const a=GG(e,r);return n==="wo"?t.ordinalNumber(a,{unit:"week"}):li(a,n.length)},I:function(e,n,t){const r=VG(e);return n==="Io"?t.ordinalNumber(r,{unit:"week"}):li(r,n.length)},d:function(e,n,t){return n==="do"?t.ordinalNumber(e.getDate(),{unit:"date"}):vu.d(e,n)},D:function(e,n,t){const r=qG(e);return n==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):li(r,n.length)},E:function(e,n,t){const r=e.getDay();switch(n){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(e,n,t,r){const a=e.getDay(),o=(a-r.weekStartsOn+8)%7||7;switch(n){case"e":return String(o);case"ee":return li(o,2);case"eo":return t.ordinalNumber(o,{unit:"day"});case"eee":return t.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(a,{width:"short",context:"formatting"});case"eeee":default:return t.day(a,{width:"wide",context:"formatting"})}},c:function(e,n,t,r){const a=e.getDay(),o=(a-r.weekStartsOn+8)%7||7;switch(n){case"c":return String(o);case"cc":return li(o,n.length);case"co":return t.ordinalNumber(o,{unit:"day"});case"ccc":return t.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(a,{width:"narrow",context:"standalone"});case"cccccc":return t.day(a,{width:"short",context:"standalone"});case"cccc":default:return t.day(a,{width:"wide",context:"standalone"})}},i:function(e,n,t){const r=e.getDay(),a=r===0?7:r;switch(n){case"i":return String(a);case"ii":return li(a,n.length);case"io":return t.ordinalNumber(a,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(e,n,t){const a=e.getHours()/12>=1?"pm":"am";switch(n){case"a":case"aa":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,n,t){const r=e.getHours();let a;switch(r===12?a=Of.noon:r===0?a=Of.midnight:a=r/12>=1?"pm":"am",n){case"b":case"bb":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,n,t){const r=e.getHours();let a;switch(r>=17?a=Of.evening:r>=12?a=Of.afternoon:r>=4?a=Of.morning:a=Of.night,n){case"B":case"BB":case"BBB":return t.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,n,t){if(n==="ho"){let r=e.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return vu.h(e,n)},H:function(e,n,t){return n==="Ho"?t.ordinalNumber(e.getHours(),{unit:"hour"}):vu.H(e,n)},K:function(e,n,t){const r=e.getHours()%12;return n==="Ko"?t.ordinalNumber(r,{unit:"hour"}):li(r,n.length)},k:function(e,n,t){let r=e.getHours();return r===0&&(r=24),n==="ko"?t.ordinalNumber(r,{unit:"hour"}):li(r,n.length)},m:function(e,n,t){return n==="mo"?t.ordinalNumber(e.getMinutes(),{unit:"minute"}):vu.m(e,n)},s:function(e,n,t){return n==="so"?t.ordinalNumber(e.getSeconds(),{unit:"second"}):vu.s(e,n)},S:function(e,n){return vu.S(e,n)},X:function(e,n,t){const r=e.getTimezoneOffset();if(r===0)return"Z";switch(n){case"X":return w_(r);case"XXXX":case"XX":return Qd(r);case"XXXXX":case"XXX":default:return Qd(r,":")}},x:function(e,n,t){const r=e.getTimezoneOffset();switch(n){case"x":return w_(r);case"xxxx":case"xx":return Qd(r);case"xxxxx":case"xxx":default:return Qd(r,":")}},O:function(e,n,t){const r=e.getTimezoneOffset();switch(n){case"O":case"OO":case"OOO":return"GMT"+v_(r,":");case"OOOO":default:return"GMT"+Qd(r,":")}},z:function(e,n,t){const r=e.getTimezoneOffset();switch(n){case"z":case"zz":case"zzz":return"GMT"+v_(r,":");case"zzzz":default:return"GMT"+Qd(r,":")}},t:function(e,n,t){const r=Math.trunc(+e/1e3);return li(r,n.length)},T:function(e,n,t){return li(+e,n.length)}};function v_(e,n=""){const t=e>0?"-":"+",r=Math.abs(e),a=Math.trunc(r/60),o=r%60;return o===0?t+String(a):t+String(a)+n+li(o,2)}function w_(e,n){return e%60===0?(e>0?"-":"+")+li(Math.abs(e)/60,2):Qd(e,n)}function Qd(e,n=""){const t=e>0?"-":"+",r=Math.abs(e),a=li(Math.trunc(r/60),2),o=li(r%60,2);return t+a+n+o}const N_=(e,n)=>{switch(e){case"P":return n.date({width:"short"});case"PP":return n.date({width:"medium"});case"PPP":return n.date({width:"long"});case"PPPP":default:return n.date({width:"full"})}},PT=(e,n)=>{switch(e){case"p":return n.time({width:"short"});case"pp":return n.time({width:"medium"});case"ppp":return n.time({width:"long"});case"pppp":default:return n.time({width:"full"})}},YG=(e,n)=>{const t=e.match(/(P+)(p+)?/)||[],r=t[1],a=t[2];if(!a)return N_(e,n);let o;switch(r){case"P":o=n.dateTime({width:"short"});break;case"PP":o=n.dateTime({width:"medium"});break;case"PPP":o=n.dateTime({width:"long"});break;case"PPPP":default:o=n.dateTime({width:"full"});break}return o.replace("{{date}}",N_(r,n)).replace("{{time}}",PT(a,n))},WG={p:PT,P:YG},QG=/^D+$/,JG=/^Y+$/,KG=["D","DD","YY","YYYY"];function XG(e){return QG.test(e)}function ZG(e){return JG.test(e)}function eY(e,n,t){const r=tY(e,n,t);if(console.warn(r),KG.includes(e))throw new RangeError(r)}function tY(e,n,t){const r=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${n}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const nY=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,iY=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,rY=/^'([^]*?)'?$/,aY=/''/g,sY=/[a-zA-Z]/;function Fr(e,n,t){var f,g,b,v;const r=Jb(),a=r.locale??UG,o=r.firstWeekContainsDate??((g=(f=r.locale)==null?void 0:f.options)==null?void 0:g.firstWeekContainsDate)??1,l=r.weekStartsOn??((v=(b=r.locale)==null?void 0:b.options)==null?void 0:v.weekStartsOn)??0,h=na(e,t==null?void 0:t.in);if(!pg(h))throw new RangeError("Invalid time value");let d=n.match(iY).map(S=>{const T=S[0];if(T==="p"||T==="P"){const E=WG[T];return E(S,a.formatLong)}return S}).join("").match(nY).map(S=>{if(S==="''")return{isToken:!1,value:"'"};const T=S[0];if(T==="'")return{isToken:!1,value:oY(S)};if(b_[T])return{isToken:!0,value:S};if(T.match(sY))throw new RangeError("Format string contains an unescaped latin alphabet character `"+T+"`");return{isToken:!1,value:S}});a.localize.preprocessor&&(d=a.localize.preprocessor(h,d));const u={firstWeekContainsDate:o,weekStartsOn:l,locale:a};return d.map(S=>{if(!S.isToken)return S.value;const T=S.value;(ZG(T)||XG(T))&&eY(T,n,String(e));const E=b_[T[0]];return E(h,T,a.localize,u)}).join("")}function oY(e){const n=e.match(rY);return n?n[1].replace(aY,"'"):e}function Zd(e,n){return+na(e)<+na(n)}function Sb(e,n){const t=()=>Ro(n==null?void 0:n.in,NaN),a=dY(e);let o;if(a.date){const u=hY(a.date,2);o=fY(u.restDateString,u.year)}if(!o||isNaN(+o))return t();const l=+o;let h=0,d;if(a.time&&(h=pY(a.time),isNaN(h)))return t();if(a.timezone){if(d=mY(a.timezone),isNaN(d))return t()}else{const u=new Date(l+h),f=na(0,n==null?void 0:n.in);return f.setFullYear(u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()),f.setHours(u.getUTCHours(),u.getUTCMinutes(),u.getUTCSeconds(),u.getUTCMilliseconds()),f}return na(l+h+d,n==null?void 0:n.in)}const Ox={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},lY=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,cY=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,uY=/^([+-])(\d{2})(?::?(\d{2}))?$/;function dY(e){const n={},t=e.split(Ox.dateTimeDelimiter);let r;if(t.length>2)return n;if(/:/.test(t[0])?r=t[0]:(n.date=t[0],r=t[1],Ox.timeZoneDelimiter.test(n.date)&&(n.date=e.split(Ox.timeZoneDelimiter)[0],r=e.substr(n.date.length,e.length))),r){const a=Ox.timezone.exec(r);a?(n.time=r.replace(a[1],""),n.timezone=a[1]):n.time=r}return n}function hY(e,n){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+n)+"})|(\\d{2}|[+-]\\d{"+(2+n)+"})$)"),r=e.match(t);if(!r)return{year:NaN,restDateString:""};const a=r[1]?parseInt(r[1]):null,o=r[2]?parseInt(r[2]):null;return{year:o===null?a:o*100,restDateString:e.slice((r[1]||r[2]).length)}}function fY(e,n){if(n===null)return new Date(NaN);const t=e.match(lY);if(!t)return new Date(NaN);const r=!!t[4],a=Gm(t[1]),o=Gm(t[2])-1,l=Gm(t[3]),h=Gm(t[4]),d=Gm(t[5])-1;if(r)return vY(n,h,d)?gY(n,h,d):new Date(NaN);{const u=new Date(0);return!xY(n,o,l)||!bY(n,a)?new Date(NaN):(u.setUTCFullYear(n,o,Math.max(a,l)),u)}}function Gm(e){return e?parseInt(e):1}function pY(e){const n=e.match(cY);if(!n)return NaN;const t=R0(n[1]),r=R0(n[2]),a=R0(n[3]);return wY(t,r,a)?t*ET+r*TT+a*1e3:NaN}function R0(e){return e&&parseFloat(e.replace(",","."))||0}function mY(e){if(e==="Z")return 0;const n=e.match(uY);if(!n)return 0;const t=n[1]==="+"?-1:1,r=parseInt(n[2]),a=n[3]&&parseInt(n[3])||0;return NY(r,a)?t*(r*ET+a*TT):NaN}function gY(e,n,t){const r=new Date(0);r.setUTCFullYear(e,0,4);const a=r.getUTCDay()||7,o=(n-1)*7+t+1-a;return r.setUTCDate(r.getUTCDate()+o),r}const yY=[31,null,31,30,31,30,31,31,30,31,30,31];function IT(e){return e%400===0||e%4===0&&e%100!==0}function xY(e,n,t){return n>=0&&n<=11&&t>=1&&t<=(yY[n]||(IT(e)?29:28))}function bY(e,n){return n>=1&&n<=(IT(e)?366:365)}function vY(e,n,t){return n>=1&&n<=53&&t>=0&&t<=6}function wY(e,n,t){return e===24?n===0&&t===0:t>=0&&t<60&&n>=0&&n<60&&e>=0&&e<25}function NY(e,n){return n>=0&&n<=59}const Kb=({showHeader:e=!0})=>{const[n,t]=w.useState([]),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(!1),[u,f]=w.useState(null),g=w.useRef(null),[b,v]=w.useState(!1),[S,T]=w.useState(null),[E,C]=w.useState(!1),[P,I]=w.useState(!1),[q,L]=w.useState(null),[O,B]=w.useState({name:"",description:"",price:"",default_parameters:[]}),[$,F]=w.useState(1),[z]=w.useState(15),U=w.useCallback(async()=>{a(!0),l(null),f(null),T(null);try{const he=await ce("/api/lab-tests");if(!he.ok)throw new Error(`HTTP error! status: ${he.status}`);const ge=await he.json();t(ge),F(1)}catch(he){console.error("Error fetching lab tests:",he),l(he.message||"Failed to fetch lab tests.")}finally{a(!1)}},[]);w.useEffect(()=>{U()},[U]);const V=he=>{const{name:ge,value:me}=he.target;B(de=>({...de,[ge]:me}))},ee=(he,ge,me)=>{const de=[...O.default_parameters],Le=de[he];if(ge==="type")switch(Le.type=me,me){case"number":Le.defaultValue=0,Le.lower_limit=null,Le.upper_limit=null,Le.unit="";break;case"boolean":Le.defaultValue=!1,Le.lower_limit=void 0,Le.upper_limit=void 0,Le.unit=void 0;break;case"string":default:Le.defaultValue="",Le.lower_limit=void 0,Le.upper_limit=void 0,Le.unit=void 0;break}else ge==="defaultValue"?Le.type==="number"?Le.defaultValue=parseFloat(me)||0:(Le.type,Le.defaultValue=me):ge==="lower_limit"||ge==="upper_limit"?Le[ge]=me===""?null:parseFloat(me):Le[ge]=me;B(He=>({...He,default_parameters:de}))},ie=()=>{B(he=>({...he,default_parameters:[...he.default_parameters,{name:"",type:"string",defaultValue:"",unit:"",lower_limit:null,upper_limit:null}]}))},ae=he=>{B(ge=>({...ge,default_parameters:ge.default_parameters.filter((me,de)=>de!==he)}))},J=async he=>{he.preventDefault(),a(!0),l(null);const ge=q!==null,me=ge?`/api/lab-tests/${q}`:"/api/lab-tests",de=ge?"PUT":"POST";try{const Le=await ce(me,{method:de,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:O.name,description:O.description,price:parseFloat(O.price),default_parameters:O.default_parameters})});if(!Le.ok){const He=await Le.json();throw new Error(He.message||`HTTP error! status: ${Le.status}`)}I(!1),L(null),B({name:"",description:"",price:"",default_parameters:[]}),U()}catch(Le){console.error(`Error ${ge?"updating":"adding"} lab test:`,Le),l(Le.message||`Failed to ${ge?"update":"add"} lab test.`)}finally{a(!1)}},K=()=>{L(null),B({name:"",description:"",price:"",default_parameters:[]}),I(!0)},W=he=>{if(q===he.id)L(null);else{L(he.id);const ge=(he.default_parameters||[]).map(me=>({...me,unit:me.unit||"",lower_limit:me.lower_limit===void 0?null:me.lower_limit,upper_limit:me.upper_limit===void 0?null:me.upper_limit}));B({name:he.name,description:he.description||"",price:he.price,default_parameters:ge}),I(!1)}},re=async he=>{if(window.confirm("Are you sure you want to delete this lab test?")){a(!0),l(null);try{const ge=await ce(`/api/lab-tests/${he}`,{method:"DELETE"});if(!ge.ok){const me=await ge.json();throw new Error(me.message||`HTTP error! status: ${ge.status}`)}U()}catch(ge){console.error("Error deleting lab test:",ge),l(ge.message||"Failed to delete lab test.")}finally{a(!1)}}},A=()=>{I(!1),L(null),l(null),B({name:"",description:"",price:"",default_parameters:[]})},te=async he=>{if(!he){f("No file selected.");return}d(!0),f(null),l(null);const ge=new FormData;ge.append("file",he);try{const me=await ce("/api/lab-tests/import",{method:"POST",body:ge});if(!me.ok){const de=await me.json();throw new Error(de.message||`Import failed: ${me.statusText}`)}U()}catch(me){console.error("Error importing lab tests from Excel:",me),f(me.message||"Failed to import lab tests from Excel.")}finally{d(!1)}},xe=async he=>{if(he.target.files&&he.target.files[0]){const ge=he.target.files[0];await te(ge),he.target&&(he.target.value="")}},M=async()=>{if(window.confirm("Are you sure you want to import default biochemistry and pathology tests? This will add new tests and may duplicate existing ones if names match.")){v(!0),T(null),l(null);try{const he=await ce("/api/lab-tests/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"}});if(!he.ok){const ge=await he.json();throw new Error(ge.message||`Default import failed: ${he.statusText}`)}U()}catch(he){console.error("Error importing default lab tests:",he),T(he.message||"Failed to import default lab tests.")}finally{v(!1)}}},Se=async()=>{if(window.confirm("Are you sure you want to delete ALL lab tests? This action cannot be undone.")){C(!0),l(null),f(null),T(null);try{const he=await ce("/api/lab-tests/all",{method:"DELETE"});if(!he.ok){const ge=await he.json();throw new Error(ge.message||`Delete all failed: ${he.statusText}`)}U()}catch(he){console.error("Error deleting all lab tests:",he),l(he.message||"Failed to delete all lab tests.")}finally{C(!1)}}},$e=r||h||b||E;return i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("div",{style:{padding:"12px 16px"},children:[e&&i.jsx("h2",{className:"lab-inventory-header",children:"Available Lab Tests"}),i.jsxs("div",{className:"mb-4",style:{display:"flex",gap:"10px"},children:[i.jsx("button",{onClick:K,className:"lab-inventory-button",disabled:$e,children:"Add New Test"}),i.jsx("button",{onClick:()=>{var he;return(he=g.current)==null?void 0:he.click()},className:"lab-inventory-button lab-inventory-button-secondary",disabled:$e,children:h?"Importing...":"Import from Excel"}),i.jsx("input",{type:"file",ref:g,onChange:xe,accept:".xlsx, .xls",style:{display:"none"},disabled:h}),i.jsx("button",{onClick:M,className:"lab-inventory-button lab-inventory-button-secondary",disabled:$e,children:b?"Importing Defaults...":"Import Default Tests"}),i.jsx("button",{onClick:Se,className:"lab-inventory-button lab-inventory-button-danger",disabled:$e,style:{backgroundColor:"#dc3545",borderColor:"#dc3545",color:"white"},children:E?"Deleting All...":"Delete All Tests"})]})]}),o&&i.jsx("div",{className:"error-text mb-4",children:o}),u&&i.jsxs("div",{className:"error-text mb-4",children:["Import Excel Error: ",u]}),S&&i.jsxs("div",{className:"error-text mb-4",children:["Import Default Error: ",S]}),P&&i.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"20px",marginBottom:"20px"},children:[" ",i.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.5em",borderBottom:"1px solid #eee",marginBottom:"15px"},children:"Add New Lab Test"}),i.jsxs("form",{onSubmit:J,children:[i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Test Name ",i.jsx("span",{style:{color:"red"},children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:O.name,onChange:V,className:"lab-inventory-input",required:!0,disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",value:O.description,onChange:V,rows:3,className:"lab-inventory-input",disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price ",i.jsx("span",{style:{color:"red"},children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",value:O.price,onChange:V,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginTop:"20px",marginBottom:"10px"},children:"Default Parameters"}),O.default_parameters.map((he,ge)=>{var me,de;return i.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[i.jsx("input",{type:"text",placeholder:"Parameter Name",value:he.name,onChange:Le=>ee(ge,"name",Le.target.value),className:"lab-inventory-input"}),i.jsxs("select",{value:he.type,onChange:Le=>ee(ge,"type",Le.target.value),className:"lab-inventory-input",children:[i.jsx("option",{value:"string",children:"Text"}),i.jsx("option",{value:"number",children:"Number"}),i.jsx("option",{value:"boolean",children:"Yes/No"})]}),he.type==="boolean"?i.jsxs("select",{value:he.defaultValue.toString(),onChange:Le=>ee(ge,"defaultValue",Le.target.value==="true"),className:"lab-inventory-input",children:[i.jsx("option",{value:"true",children:"Reactive"}),i.jsx("option",{value:"false",children:"Non-reactive"})]}):i.jsx("input",{type:he.type==="number"?"number":"text",placeholder:"Default Value",value:he.defaultValue.toString(),onChange:Le=>ee(ge,"defaultValue",Le.target.value),className:"lab-inventory-input"}),he.type==="number"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"number",placeholder:"Lower Limit",value:he.lower_limit===null?"":((me=he.lower_limit)==null?void 0:me.toString())??"",onChange:Le=>ee(ge,"lower_limit",Le.target.value),className:"lab-inventory-input"}),i.jsx("input",{type:"number",placeholder:"Upper Limit",value:he.upper_limit===null?"":((de=he.upper_limit)==null?void 0:de.toString())??"",onChange:Le=>ee(ge,"upper_limit",Le.target.value),className:"lab-inventory-input"}),i.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:he.unit||"",onChange:Le=>ee(ge,"unit",Le.target.value),className:"lab-inventory-input"})]}),i.jsx("button",{type:"button",onClick:()=>ae(ge),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},ge)}),i.jsx("button",{type:"button",onClick:ie,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{type:"button",onClick:A,className:"lab-inventory-button lab-inventory-button-secondary",disabled:$e,children:"Cancel"}),i.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:$e,children:r?"Saving...":"Add Test"})]})]})]}),$e&&!P&&i.jsxs("p",{className:"loading-text",children:[" ",h?"Importing Excel data...":b?"Importing default data...":"Loading tests..."]}),!$e&&n.length===0&&!o&&!u&&!S&&i.jsx("p",{className:"no-data-message",children:"No lab tests found. Add one or import from Excel to get started."}),!$e&&n.length>0&&i.jsxs("div",{className:"overflow-x-auto",children:[" ",i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{className:"hidden md:table-cell",children:"Description"})," ",i.jsx("th",{children:"Price"}),i.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),i.jsx("tbody",{children:(()=>{const he=$*z,ge=he-z;return n.slice(ge,he).map(de=>{const Le=q===de.id,He=de.price&&typeof de.price=="string"?parseFloat(de.price):NaN,pe=isNaN(He)?"0.00":He.toFixed(2);return i.jsxs(Fn.Fragment,{children:[i.jsxs("tr",{onClick:()=>W(de),style:{cursor:"pointer"},children:[i.jsx("td",{children:de.name}),i.jsx("td",{className:"hidden md:table-cell",style:{whiteSpace:"pre-wrap"},children:de.description||"-"}),i.jsxs("td",{children:["",pe]}),i.jsx("td",{style:{textAlign:"right"},children:i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[i.jsx("button",{onClick:ne=>{ne.stopPropagation(),W(de)},className:"lab-inventory-link",disabled:$e,style:{background:"none",border:"none",padding:"0",cursor:"pointer"},children:"Edit"}),i.jsx("button",{onClick:ne=>{ne.stopPropagation(),re(de.id)},className:"lab-inventory-link",disabled:$e,style:{background:"none",border:"none",padding:"0",cursor:"pointer",color:"#dc3545"},children:"Delete"})]})})]}),Le&&i.jsx("tr",{children:i.jsx("td",{colSpan:4,children:i.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"10px",marginBottom:"10px",border:"1px solid #ddd",padding:"15px"},children:[i.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em"},children:"Edit Lab Test"}),i.jsxs("form",{onSubmit:J,children:[i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Test Name ",i.jsx("span",{style:{color:"red"},children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:O.name,onChange:V,className:"lab-inventory-input",required:!0,disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",value:O.description,onChange:V,rows:3,className:"lab-inventory-input",disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price ",i.jsx("span",{style:{color:"red"},children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",value:O.price,onChange:V,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:$e})]}),i.jsxs("div",{className:"lab-inventory-form-group",children:[i.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em",marginTop:"15px"},children:"Default Parameters"}),O.default_parameters.map((ne,Pe)=>{var Ye,rt;return i.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[i.jsx("input",{type:"text",placeholder:"Parameter Name",value:ne.name,onChange:ut=>ee(Pe,"name",ut.target.value),className:"lab-inventory-input"}),i.jsxs("select",{value:ne.type,onChange:ut=>ee(Pe,"type",ut.target.value),className:"lab-inventory-input",children:[i.jsx("option",{value:"string",children:"Text"}),i.jsx("option",{value:"number",children:"Number"}),i.jsx("option",{value:"boolean",children:"Yes/No"})]}),ne.type==="boolean"?i.jsxs("select",{value:ne.defaultValue.toString(),onChange:ut=>ee(Pe,"defaultValue",ut.target.value==="true"),className:"lab-inventory-input",children:[i.jsx("option",{value:"true",children:"Reactive"}),i.jsx("option",{value:"false",children:"Non-reactive"})]}):i.jsx("input",{type:ne.type==="number"?"number":"text",placeholder:"Default Value",value:ne.defaultValue.toString(),onChange:ut=>ee(Pe,"defaultValue",ut.target.value),className:"lab-inventory-input"}),ne.type==="number"&&i.jsxs(i.Fragment,{children:[i.jsx("input",{type:"number",placeholder:"Lower Limit",value:ne.lower_limit===null?"":((Ye=ne.lower_limit)==null?void 0:Ye.toString())??"",onChange:ut=>ee(Pe,"lower_limit",ut.target.value),className:"lab-inventory-input"}),i.jsx("input",{type:"number",placeholder:"Upper Limit",value:ne.upper_limit===null?"":((rt=ne.upper_limit)==null?void 0:rt.toString())??"",onChange:ut=>ee(Pe,"upper_limit",ut.target.value),className:"lab-inventory-input"}),i.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:ne.unit||"",onChange:ut=>ee(Pe,"unit",ut.target.value),className:"lab-inventory-input"})]}),i.jsx("button",{type:"button",onClick:()=>ae(Pe),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},Pe)}),i.jsx("button",{type:"button",onClick:ie,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),i.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[i.jsx("button",{type:"button",onClick:A,className:"lab-inventory-button lab-inventory-button-secondary",disabled:$e,children:"Cancel"}),i.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:$e,children:r?"Saving...":"Update Test"})]})]})]})})})]},de.id)})})()})]})]}),n.length>z&&!$e&&i.jsxs("div",{className:"pagination-controls",style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px",gap:"15px"},children:[i.jsx("button",{onClick:()=>F(he=>Math.max(he-1,1)),disabled:$===1,className:"pagination-button",style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ddd",background:$===1?"#f5f5f5":"white",cursor:$===1?"not-allowed":"pointer"},children:"Previous"}),i.jsxs("span",{className:"pagination-info",style:{fontWeight:500},children:["Page ",$," of ",Math.ceil(n.length/z)]}),i.jsx("button",{onClick:()=>F(he=>Math.min(he+1,Math.ceil(n.length/z))),disabled:$===Math.ceil(n.length/z),className:"pagination-button",style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ddd",background:$===Math.ceil(n.length/z)?"#f5f5f5":"white",cursor:$===Math.ceil(n.length/z)?"not-allowed":"pointer"},children:"Next"})]})]})},SY=e=>{let n="";if(!e.report_content)return"No report content available.";n+=`*Report Date:* ${e.report_date?new Date(e.report_date).toLocaleDateString():"N/A"}

`;try{const t=JSON.parse(e.report_content);typeof t=="object"&&t!==null&&e.tests?e.tests.forEach((r,a)=>{n+=`*Test: ${r.name}*
`,t[r.id]?Object.entries(t[r.id]).forEach(([o,l])=>{var f;const h=(f=r.default_parameters)==null?void 0:f.find(g=>g.name===o);let d=String(l),u="";if(h){const g=h.unit?` _${h.unit}_`:"";if(h.type==="boolean"){const b=l===!0||l==="true";d=b?"*Reactive*":"Non-Reactive",b||(u="`Normal: Non-Reactive`")}else if(h.type==="number"){const b=typeof l=="string"?parseFloat(l):typeof l=="number"?l:NaN;if(h.lower_limit!=null||h.upper_limit!=null){let v=[];h.lower_limit!=null&&v.push(`${h.lower_limit}`),h.upper_limit!=null&&v.push(`${h.upper_limit}`),u=`\`Normal: ${v.join(" - ")}\`${g}`,!isNaN(b)&&(h.lower_limit!=null&&b<h.lower_limit||h.upper_limit!=null&&b>h.upper_limit)&&(d=`*${d}*`)}}h.unit&&(d+=g)}n+=`${o}: ${d}
`,u&&((h==null?void 0:h.type)==="boolean"&&(l===!0||l==="true")||(n+=`${u}
`))}):n+=`_No parameters reported for this test._
`,a<e.tests.length-1&&(n+=`
`)}):n+=e.report_content}catch{n+=e.report_content}return n},Kw=e=>{var l;if(!((l=e==null?void 0:e.Patient)!=null&&l.phone)){alert("Cannot share report via WhatsApp: Patient phone number is not available.");return}if(!(e!=null&&e.report_content)){alert("Cannot share report: No report content is available to share.");return}const n=e.Patient.name||"Patient",t=SY(e),r=`Hello ${n},

Your lab report is ready.

${t}`,o=`https://wa.me/${jY(e.Patient.phone)}?text=${encodeURIComponent(r)}`;window.open(o,"_blank")},jY=e=>{let n=e.replace(/\D/g,"");const t=/^(?:\\+?91)?[\\s-]*?(\\d{10})$/,r=n.match(t);return r?n="91"+r[1]:n.startsWith("91")||(n="91"+n),n},_Y=()=>{const[e,n]=w.useState([]),[t,r]=w.useState(""),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState("orders"),[f,g]=w.useState(1),[b]=w.useState(20),[v,S]=w.useState(0),T=w.useMemo(()=>Math.ceil(v/b),[v,b]),E=w.useCallback(async($=1,F="")=>{o(!0),h(null);try{const z=new URLSearchParams({page:String($),limit:String(b)});F&&z.append("search",F);const U=await ce(`/api/lab?${z.toString()}`);if(!U.ok)throw new Error(`HTTP error! status: ${U.status}`);const V=await U.json(),ee=V.orders.map(ie=>{var ae,J;return{id:ie.id,labTokenNumber:String(ie.lab_token_number??"N/A"),patientName:((ae=ie.Patient)==null?void 0:ae.name)||"N/A",patientId:ie.patient_id,patientTokenNumber:String(((J=ie.Patient)==null?void 0:J.patient_token_number)??"N/A"),tests:(ie.tests||[]).map(K=>K.name||"Unknown Test"),date:Fr(new Date(ie.createdAt),"yyyy-MM-dd"),status:ie.status,reportId:ie.reportId,billId:ie.billId}});n(ee),S(V.totalCount),g($)}catch(z){console.error("Failed to fetch lab orders:",z),h(z instanceof Error?z.message:"An unknown error occurred"),n([]),S(0)}finally{o(!1)}},[b]);w.useEffect(()=>{console.log(`Fetch effect triggered. Current page: ${f}, Search term: "${t}"`),t.length===0||t.length>=2?(console.log(`Condition met (length ${t.length}). Fetching orders...`),E(f,t)):console.log(`Condition not met (length ${t.length}). Not fetching.`)},[E,f,t]),w.useEffect(()=>{const $=setTimeout(()=>{t.length>=2?f!==1&&g(1):t.length<2&&f!==1&&g(1)},1e3);return()=>{clearTimeout($)}},[t]);const C=async($,F)=>{console.log(`Updating order ${$} to status ${F}`);try{const z=await ce(`/api/lab/${$}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:F})});if(!z.ok){const U=await z.json();throw new Error(U.message||`Failed to update status: ${z.status}`)}if(F==="completed"){const U=await ce(`/api/lab/orders/${$}/report`);if(U.ok){const V=await U.json();Kw(V)}}await E(f,t),console.log(`Order ${$} status updated to ${F}, refetching page ${f}`)}catch(z){console.error("Error updating status:",z),alert(`Failed to update status: ${z instanceof Error?z.message:"Unknown error"}`)}},P=Ft(),I=$=>{if(!$){console.error("Cannot navigate to billing: Order data is missing."),alert("Could not open billing page: Order information is missing.");return}$.billId?(console.log(`Navigating to existing bill for Bill ID: ${$.billId}, Patient: ${$.patientName}`),P("/billing",{state:{billId:$.billId,patientId:$.patientId,patientName:$.patientName,billType:"lab"}})):(console.log(`Navigating to create new bill for Lab Order ID: ${$.id}, Patient: ${$.patientName}`),P("/lab-billing",{state:{labOrderId:$.id}}))},q=$=>{$&&$.id?P(`/lab/report/${$.id}`):(console.error("Cannot navigate: Order or Order ID is missing."),alert("Could not open the report entry page: Order information is missing."))},L=$=>{switch($){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:$,className:"status-badge"}}};if(a)return i.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:i.jsx("div",{className:"text-teal-600 text-xl animate-pulse",children:"Loading Lab Panel..."})});if(l)return i.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-red-50 text-red-700",children:[i.jsx(mi,{size:48,className:"mb-4"}),i.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Error Loading Lab Data"}),i.jsx("p",{className:"mb-4",children:l}),i.jsx("button",{onClick:()=>E(1,""),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry Fetch"})]});const O=()=>{f>1&&g($=>$-1)},B=()=>{f<T&&g($=>$+1)};return i.jsxs("div",{className:"lab-inventory-container",children:[i.jsxs("div",{className:"lab-panel-header-wrapper",children:[i.jsx("button",{onClick:()=>P(-1),className:"back-button",children:i.jsx(fn,{size:20})}),i.jsx("h2",{className:"lab-panel-title",children:"Lab Panel"})]}),i.jsxs("main",{className:"flex-1 overflow-y-auto",children:[i.jsxs("div",{className:"lab-panel-nav-tabs",children:[i.jsxs("button",{onClick:()=>u("orders"),className:`lab-inventory-button ${d==="orders"?"":"lab-inventory-button-secondary"}`,children:[i.jsx(ZC,{size:14}),i.jsx("span",{children:"Orders"})]}),i.jsxs("button",{onClick:()=>P("/create-lab-order"),className:"lab-inventory-button",children:[i.jsx("span",{className:"hidden sm:inline",children:"Create "}),"New Order"]}),i.jsxs("button",{onClick:()=>u("inventory"),className:`lab-inventory-button ${d==="inventory"?"":"lab-inventory-button-secondary"}`,children:[i.jsx(Pb,{size:14}),i.jsx("span",{children:"Inventory"})]})]}),d==="orders"&&i.jsxs("div",{className:"lab-orders-view",children:[" ",i.jsxs("div",{className:"lab-orders-header-controls",children:[i.jsx("h3",{className:"lab-orders-title",children:"Current Lab Orders"}),i.jsxs("div",{className:"lab-orders-search-container",children:[i.jsx("input",{type:"text",placeholder:"Search name, token, tests...",value:t,onChange:$=>r($.target.value),className:"lab-inventory-input lab-orders-search-input"}),i.jsx(Pi,{size:18,className:"lab-orders-search-icon"})]})]}),i.jsx("div",{className:"lab-orders-table-container",children:i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Patient (Token)"}),i.jsx("th",{children:"Tests"}),i.jsx("th",{className:"hidden md:table-cell",children:"Date"}),i.jsx("th",{children:"Status"}),i.jsx("th",{className:"lab-table-actions-header",children:"Actions"})]})}),i.jsxs("tbody",{children:[a&&!l&&e.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"text-center py-10",children:"Loading orders..."})}),!a&&!l&&e.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,className:"text-center py-10",children:t?`No lab orders found matching "${t}".`:"No lab orders available."})}),!a&&!l&&e.map($=>{const F=L($.status);return i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("div",{children:$.patientName}),i.jsxs("div",{className:"lab-table-patient-token",children:["Token: ",$.patientTokenNumber]})]}),i.jsx("td",{children:$.tests.map((z,U)=>i.jsx("div",{children:z},U))}),i.jsx("td",{className:"hidden md:table-cell",children:$.date}),i.jsx("td",{children:i.jsx("span",{className:F.className,children:F.text})}),i.jsx("td",{children:i.jsxs("div",{className:"lab-table-actions",children:[$.status==="pending"&&i.jsx("button",{onClick:()=>I($),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),$.status==="billed"&&i.jsx("button",{onClick:()=>C($.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),$.status==="collected"&&i.jsx("button",{onClick:()=>C($.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),($.status==="processing"||$.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>q($),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),($.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>C($.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),($.status==="completed"||$.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>{$.id?P(`/lab/view-report/${$.id}`):(console.error("Attempted to view report for an order with no ID:",$),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})})]},$.id)})]})]})}),i.jsxs("div",{className:"lab-orders-card-container",children:[a&&!l&&e.length===0&&i.jsx("div",{className:"text-center py-10",children:"Loading orders..."}),!a&&!l&&e.length===0&&i.jsx("div",{className:"text-center py-10",children:t?`No lab orders found matching "${t}".`:"No lab orders available."}),!a&&!l&&e.map($=>{const F=L($.status);return i.jsxs("div",{className:"lab-order-card",children:[i.jsxs("div",{className:"lab-card-header",children:[i.jsxs("div",{children:[i.jsx("div",{className:"lab-card-patient-name",children:$.patientName}),i.jsxs("div",{className:"lab-card-patient-token",children:["Token: ",$.patientTokenNumber]}),i.jsx("div",{className:"lab-card-date",children:$.date})]}),i.jsx("span",{className:`${F.className} lab-card-status-pill`,children:F.text})]}),i.jsxs("div",{className:"lab-card-section",children:[i.jsx("p",{className:"lab-card-section-title",children:"Tests:"}),$.tests.map((z,U)=>i.jsx("div",{className:"lab-card-test-item",children:z},U)),$.tests.length===0&&i.jsx("div",{className:"lab-card-no-tests",children:"No tests listed."})]}),i.jsxs("div",{className:"lab-card-actions",children:[$.status==="pending"&&i.jsx("button",{onClick:()=>I($),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),$.status==="billed"&&i.jsx("button",{onClick:()=>C($.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),$.status==="collected"&&i.jsx("button",{onClick:()=>C($.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),($.status==="processing"||$.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>q($),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),($.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>C($.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),($.status==="completed"||$.status==="report_ready"||$.status==="reported")&&i.jsx("button",{onClick:()=>{$.id?P(`/lab/view-report/${$.id}`):(console.error("Attempted to view report for an order with no ID:",$),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})]},$.id)})]}),!a&&v>0&&i.jsxs("div",{className:"lab-pagination-controls",children:[i.jsxs("div",{className:"lab-pagination-info",children:["Showing"," ",i.jsx("strong",{children:(f-1)*b+1})," ","to"," ",i.jsx("strong",{children:Math.min(f*b,v)})," ","of"," ",i.jsx("strong",{children:v})," ","results"]}),i.jsxs("div",{className:"lab-pagination-buttons",children:[i.jsx("button",{onClick:O,disabled:f===1,className:"lab-pagination-button","aria-label":"Previous page",children:i.jsx(Ib,{size:18})}),i.jsxs("span",{children:["Page ",f," of ",T]}),i.jsx("button",{onClick:B,disabled:f===T,className:"lab-pagination-button","aria-label":"Next page",children:i.jsx(xg,{size:18})})]})]})]}),d==="inventory"&&i.jsxs("div",{className:"lab-inventory-content-wrapper",children:[" ",i.jsx(Kb,{})]})]})]})},CY=()=>{const[e,n]=w.useState([]),[t,r]=w.useState(""),[a,o]=w.useState(!0),[l,h]=w.useState(null),d=Ft(),u=w.useRef(null),[f,g]=w.useState(1),[b,v]=w.useState(1),[S,T]=w.useState(0),E=10,C=w.useCallback(async(B,$,F)=>{o(!0),h(null);try{let z=`/api/pharmacy-orders?page=${B}&limit=${$}`;F&&F.trim()!==""&&(z+=`&search=${encodeURIComponent(F.trim())}`);const U=await ce(z);if(!U.ok)throw new Error(`Failed to fetch orders: ${U.statusText} (${U.status})`);const V=await U.json();if(V&&Array.isArray(V.orders)&&typeof V.totalOrders=="number"&&typeof V.totalPages=="number")console.log("Fetched pharmacy orders data:",V.orders),n(V.orders),T(V.totalOrders),v(V.totalPages),g(V.currentPage||B);else throw console.error("Received data does not match expected paginated structure:",V),new Error("Invalid data format received from API")}catch(z){console.error("Failed to fetch pharmacy orders:",z),h(z.message||"Failed to fetch orders. Please try again."),n([]),v(1),T(0)}finally{o(!1)}},[]);w.useEffect(()=>(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{C(f,E,t)},500),()=>{u.current&&clearTimeout(u.current)}),[t,f,C,E]);const P=B=>{d(`/dashboard/edit-pharmacy-order/${B}`)},I=B=>{h(null),console.log(`Preparing billing navigation for order: ${B}`);const $=e.find(F=>F.id===B);if($){const F=$.medications.map(z=>{const U=z.price??0;return(z.price===void 0||z.price===null)&&console.warn(`Medication "${z.name}" in order ${B} is missing a price. Defaulting to 0.`),{name:z.name,pack_quantity:z.pack_quantity,loose_quantity:z.loose_quantity,price:U,pack_price:z.pack_price,loose_price:z.loose_price,total_price:z.total_price,isLoose:z.isLoose,unit:z.unit,drug_id:z.drug_id?String(z.drug_id):null,tabletsPerDay:z.tabletsPerDay,numberOfDays:z.numberOfDays,directions_to_use:z.directions_to_use,discount_percentage:0,batch:z.batch,expiry_date:z.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:F}),d(`/dashboard/pharmacy-billing/${B}`,{state:{initialItems:F}})}else console.error(`Order with ID ${B} not found.`),h(`Order with ID ${B} not found.`),alert(`Error: Could not find order ${B} to bill.`)},q=async(B,$)=>{h(null);const F=e.find(U=>U.id===B);if(!F){h(`Order with ID ${B} not found.`);return}const z={status:$,medications:F.medications};try{const U=await ce(`/api/pharmacy-orders/${B}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(!U.ok){const ee=await U.text();throw new Error(`Failed to update status: ${U.statusText} (${U.status}) - ${ee}`)}const V=await U.json();n(ee=>ee.map(ie=>ie.id===V.id?{...ie,status:V.status}:ie))}catch(U){console.error("Failed to update order status:",U),h(U.message||`Failed to update status for order ${B}.`),alert(`Error updating status for order ${B}: ${U.message||"Please try again."}`)}},L=B=>{switch(B){case"pending":return"status-pill status-pill-pending";case"billed":return"status-pill status-pill-billed";case"dispensed":return"status-pill status-pill-dispensed";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill status-pill-default"}},O=B=>{d(`/dashboard/orders/${B.id}`)};return a&&e.length===0&&!l?i.jsx("div",{className:"loading-pulse",children:"Loading Orders..."}):l&&e.length===0?i.jsxs("div",{className:"error-message-box",children:["Error loading orders: ",l]}):i.jsxs("div",{className:"pharmacy-queue-container",children:[i.jsxs("div",{className:"pharmacy-queue-header",children:[i.jsx("h3",{className:"pharmacy-queue-title",children:"Pharmacy Queue"}),i.jsxs("div",{className:"pharmacy-actions-container",children:[i.jsxs("div",{className:"pharmacy-buttons-group",children:[i.jsxs("button",{onClick:()=>d("/dashboard/add-order"),className:"pharmacy-action-button btn-add-order",title:"Add New Order",children:[i.jsx(gc,{size:14}),"Add Order"]}),i.jsxs("button",{onClick:()=>d("/dashboard/inventory"),className:"pharmacy-action-button btn-inventory",title:"View Inventory",children:[i.jsx(Eo,{size:14}),"Inventory"]}),i.jsxs("button",{onClick:()=>d("/dashboard/distributors"),className:"pharmacy-action-button btn-distributors",title:"Distributors",children:[i.jsx(Eo,{size:14}),"Distributors"]}),i.jsxs("button",{onClick:()=>d("/dashboard/recurring-medications"),className:"pharmacy-action-button btn-refill-reminders",title:"Recurring Meds",children:[i.jsx(XP,{size:14}),"Refills"]}),i.jsxs("button",{onClick:()=>d("/dashboard/search-patient-records"),className:"pharmacy-action-button btn-ai-search",title:"Newton's AI Search",children:[i.jsx(YC,{size:14}),"AI Search"]})]}),i.jsxs("div",{className:"pharmacy-search-input-container",children:[i.jsx("input",{type:"text",placeholder:"Search orders by patient name, token, or medication...",value:t,onChange:B=>{r(B.target.value),g(1)},className:"pharmacy-search-input"}),i.jsx(Pi,{size:16,className:"pharmacy-search-icon"})]})]})]}),i.jsxs("div",{className:"pharmacy-orders-scroll-container",children:[l&&e.length>0&&i.jsxs("div",{className:"error-message-box",children:["Error: ",l]}),a&&e.length>0&&i.jsx("div",{className:"loading-pulse",children:"Updating Orders..."}),!a&&e.length===0&&!l&&i.jsx("div",{className:"empty-state-message",children:t?`No pharmacy orders found matching "${t}".`:"There are currently no pharmacy orders."}),e.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"pharmacy-table-container",children:i.jsxs("table",{className:"pharmacy-queue-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Patient"}),i.jsx("th",{children:"Medications"}),i.jsx("th",{className:"hidden md:table-cell",children:"Date"}),i.jsx("th",{children:"Order Total"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:e.map(B=>i.jsxs("tr",{onClick:()=>O(B),style:{cursor:"pointer"},children:[i.jsxs("td",{children:[i.jsx("div",{className:"patient-name",children:B.patientName}),i.jsx("div",{className:"patient-token",title:`Patient Token: ${B.patientTokenNumber}`,children:B.patientTokenNumber})]}),i.jsxs("td",{className:"medication-info",children:[B.medications.map(($,F)=>i.jsxs("div",{className:"medication-item",children:[i.jsxs("span",{children:[$.name," (Packs: ",$.pack_quantity,", Loose: ",$.loose_quantity,", ",$.tabletsPerDay??"N/A","x",$.numberOfDays??"N/A","d)",$.box_number&&i.jsxs("span",{className:"medication-box-number",children:[" (Box: ",$.box_number,")"]})]}),$.directions_to_use&&i.jsxs("span",{className:"medication-directions",children:["Directions: ",$.directions_to_use]}),i.jsxs("div",{className:"medication-prices text-xs text-gray-500",children:[$.pack_price!==void 0&&`Pack Price: ${Number($.pack_price).toFixed(2)}`,$.loose_price!==void 0&&` | Loose Price: ${Number($.loose_price).toFixed(2)}`,$.total_price!==void 0&&` | Item Total: ${Number($.total_price).toFixed(2)}`]})]},F)),B.prescriptionForUnavailableDrugs&&i.jsxs("div",{className:"unavailable-drugs-note",children:[i.jsx("strong",{children:"Unavailable Drugs Note:"})," ",B.prescriptionForUnavailableDrugs]})]}),i.jsx("td",{className:"hidden md:table-cell date-info",children:new Date(B.date).toLocaleDateString()}),i.jsxs("td",{className:"order-total-cell font-semibold",children:["",Number(B.order_total??0).toFixed(2)]}),i.jsx("td",{children:i.jsx("span",{className:L(B.status),children:B.status})}),i.jsx("td",{children:i.jsxs("div",{className:"pharmacy-table-actions",children:[B.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:$=>{$.stopPropagation(),P(B.id)},className:"pharmacy-table-action-button btn-edit-order",children:[i.jsx(eh,{size:14})," Edit"]}),i.jsxs("button",{onClick:$=>{$.stopPropagation(),I(B.id)},className:"pharmacy-table-action-button btn-bill-order",children:[i.jsx(ag,{size:14})," Bill"]})]}),B.status==="billed"&&i.jsxs("button",{onClick:$=>{$.stopPropagation(),q(B.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[i.jsx(Nr,{size:14})," Dispense"]}),(B.status==="pending"||B.status==="billed")&&i.jsx("button",{onClick:$=>{$.stopPropagation(),q(B.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),i.jsx("button",{onClick:$=>{$.stopPropagation(),O(B)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})})]},B.id))})]})}),i.jsx("div",{className:"pharmacy-card-view-container",children:e.map(B=>{const $=L(B.status);return i.jsxs("div",{className:"pharmacy-order-card",onClick:()=>O(B),children:[i.jsxs("div",{className:"pharmacy-card-header",children:[i.jsxs("div",{children:[i.jsx("div",{className:"pharmacy-card-patient-name",children:B.patientName||"N/A"}),i.jsxs("div",{className:"pharmacy-card-patient-token",title:`Patient Token: ${B.patientTokenNumber}`,children:["Token: ",B.patientTokenNumber||"N/A"]}),i.jsx("div",{className:"pharmacy-card-date",children:new Date(B.date).toLocaleDateString()})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:$,children:B.status}),B.order_total!==void 0&&i.jsxs("span",{className:"pharmacy-card-order-total font-semibold",children:["",Number(B.order_total).toFixed(2)]})]})]}),i.jsxs("div",{className:"pharmacy-card-medications",children:[i.jsx("p",{className:"pharmacy-card-medications-title",children:"Medications:"}),i.jsxs("div",{className:"space-y-0_5",children:[B.medications.slice(0,2).map((F,z)=>i.jsxs("div",{className:"pharmacy-card-medication-item",children:[i.jsxs("span",{title:`${F.name} (Packs: ${F.pack_quantity}, Loose: ${F.loose_quantity}, ${F.tabletsPerDay??"N/A"}x${F.numberOfDays??"N/A"}d)`,children:[F.name," (Packs: ",F.pack_quantity,", Loose: ",F.loose_quantity,", ",F.tabletsPerDay??"N/A","x",F.numberOfDays??"N/A","d)",F.box_number&&i.jsxs("span",{className:"medication-box-number",children:[" (Box: ",F.box_number,")"]})]}),F.directions_to_use&&i.jsxs("span",{className:"medication-directions",title:`Directions: ${F.directions_to_use}`,children:["Directions: ",F.directions_to_use]}),i.jsxs("div",{className:"medication-prices text-xs text-gray-500",children:[F.pack_price!==void 0&&`Pack Price: ${Number(F.pack_price).toFixed(2)}`,F.loose_price!==void 0&&` | Loose Price: ${Number(F.loose_price).toFixed(2)}`,F.total_price!==void 0&&` | Item Total: ${Number(F.total_price).toFixed(2)}`]})]},z)),B.medications.length>2&&i.jsxs("div",{className:"pharmacy-card-medications-more",children:["...and ",B.medications.length-2," more"]}),B.medications.length===0&&i.jsx("div",{className:"pharmacy-card-no-medications",children:"No medications listed."})]}),B.prescriptionForUnavailableDrugs&&i.jsxs("div",{className:"unavailable-drugs-note",children:[i.jsx("strong",{children:"Unavailable Drugs Note:"})," ",B.prescriptionForUnavailableDrugs]})]}),i.jsxs("div",{className:"pharmacy-card-actions",children:[B.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:F=>{F.stopPropagation(),P(B.id)},className:"pharmacy-table-action-button btn-edit-order",children:[i.jsx(eh,{size:14})," Edit"]}),i.jsxs("button",{onClick:F=>{F.stopPropagation(),I(B.id)},className:"pharmacy-table-action-button btn-bill-order",children:[i.jsx(ag,{size:14})," Bill"]})]}),B.status==="billed"&&i.jsxs("button",{onClick:F=>{F.stopPropagation(),q(B.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[i.jsx(Nr,{size:14})," Dispense"]}),(B.status==="pending"||B.status==="billed")&&i.jsx("button",{onClick:F=>{F.stopPropagation(),q(B.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),i.jsx("button",{onClick:F=>{F.stopPropagation(),O(B)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})]},B.id)})})]}),!a&&b>1&&i.jsxs("div",{className:"pharmacy-pagination-container",children:[i.jsxs("div",{className:"pagination-mobile-controls",children:[i.jsx("button",{onClick:()=>g(B=>Math.max(B-1,1)),disabled:f===1,className:"pagination-button prev",children:"Previous"}),i.jsx("button",{onClick:()=>g(B=>Math.min(B+1,b)),disabled:f===b,className:"pagination-button next",children:"Next"})]}),i.jsxs("div",{className:"pagination-desktop-controls",children:[i.jsx("div",{className:"pagination-info",children:i.jsxs("p",{children:["Showing ",i.jsx("span",{className:"font-medium",children:(f-1)*E+1})," ","to ",i.jsx("span",{className:"font-medium",children:Math.min(f*E,S)})," ","of ",i.jsx("span",{className:"font-medium",children:S})," results"]})}),i.jsx("div",{children:i.jsxs("nav",{className:"pagination-nav","aria-label":"Pagination",children:[i.jsxs("button",{onClick:()=>g(B=>Math.max(B-1,1)),disabled:f===1,className:"pagination-nav-button prev",children:[i.jsx("span",{className:"sr-only",children:"Previous"}),i.jsx(Ib,{"aria-hidden":"true"})]}),i.jsxs("span",{"aria-current":"page",className:"pagination-current-page",children:["Page ",f," of ",b]}),i.jsxs("button",{onClick:()=>g(B=>Math.min(B+1,b)),disabled:f===b,className:"pagination-nav-button next",children:[i.jsx("span",{className:"sr-only",children:"Next"}),i.jsx(xg,{"aria-hidden":"true"})]})]})})]})]})]})," "]})},kY=()=>{const e=Ft();return i.jsxs("div",{className:"bg-white p-3 md:p-6 rounded-lg shadow",children:[i.jsx("button",{onClick:()=>e(-1),className:"mb-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Back"}),i.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Settings"}),i.jsx("p",{className:"mt-4 text-gray-600",children:"Pharmacy settings will be configured here."})]})},TY=()=>{const{id:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(!1),[f,g]=w.useState(!1),b=w.useRef(null),v=w.useRef(null),S=w.useRef(null),T=w.useCallback(async()=>{if(!e){h("Drug ID is missing."),o(!1);return}o(!0),h(null);try{const I=await ce(`/api/drugs/${e}`);if(!I.ok){const L=await I.json();throw new Error(L.message||`Failed to fetch drug: ${I.statusText}`)}let q=await I.json();q={...q,name:q.name||"",brand_name:q.brand_name||"",price:parseFloat(String(q.price))||0,buying_price:q.buying_price!==null&&q.buying_price!==void 0?parseFloat(String(q.buying_price)):null,quantity_in_stock:parseInt(String(q.quantity_in_stock),10)||0,gst:q.gst!==null&&q.gst!==void 0?parseFloat(String(q.gst)):null,margin:q.margin!==null&&q.margin!==void 0?parseFloat(String(q.margin)):null,discount:q.discount!==null&&q.discount!==void 0?parseFloat(String(q.discount)):null,batch:q.batch||"",hsn_code:q.hsn_code||"",mfg:q.mfg||"",loose:q.loose!==null&&q.loose!==void 0?parseInt(String(q.loose),10):null},r(q)}catch(I){console.error("Failed to fetch drug:",I),h(I.message||"Failed to load drug data. Please try again.")}finally{o(!1)}},[e]);w.useEffect(()=>{T()},[T]),w.useEffect(()=>{const I=L=>{L.key==="Tab"&&v.current===document.activeElement&&(f||(g(!0),setTimeout(()=>{var O;(O=S.current)==null||O.focus()},0),L.preventDefault()))},q=L=>{b.current&&!b.current.contains(L.target)&&g(!1)};return document.addEventListener("keydown",I),document.addEventListener("mousedown",q),()=>{document.removeEventListener("keydown",I),document.removeEventListener("mousedown",q)}},[f]);const E=I=>{const{name:q,value:L,type:O}=I.target;r(B=>B?{...B,[q]:O==="number"?parseFloat(L)||null:L}:null)},C=()=>{n(-1)},P=async I=>{if(I.preventDefault(),h(null),u(!0),!t||!t.id){h("Cannot edit drug: No drug data available."),u(!1);return}if(t.price===void 0||t.quantity_in_stock===void 0){h("Price and Stock Quantity are required."),u(!1);return}const q={...t,name:t.name===""?null:t.name,brand_name:t.brand_name===""?null:t.brand_name,buying_price:t.buying_price===0?null:t.buying_price,expiry_date:t.expiry_date===""?null:t.expiry_date,gst:t.gst===0?null:t.gst,margin:t.margin===0?null:t.margin,discount:t.discount===0?null:t.discount,batch:t.batch===""?null:t.batch,hsn_code:t.hsn_code===""?null:t.hsn_code,mfg:t.mfg===""?null:t.mfg,loose:t.loose===0?null:t.loose};try{const L=await ce(`/api/drugs/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!L.ok){const B=await L.json();throw new Error(B.message||`Failed to update drug: ${L.statusText}`)}const O=await L.json();alert(`Drug "${O.name}" updated successfully!`),n(-1)}catch(L){console.error("Failed to update drug:",L),h(L.message||"Failed to update drug. Please try again.")}finally{u(!1)}};return a?i.jsx("div",{className:"edit-drug-form-page",children:i.jsx("div",{className:"loading-message",children:"Loading drug data..."})}):l&&!t?i.jsx("div",{className:"edit-drug-form-page",children:i.jsxs("div",{className:"error-message-load",children:["Error: ",l]})}):t?i.jsx("div",{className:"edit-drug-form-page",children:i.jsxs("div",{className:"edit-drug-form-container",children:[i.jsxs("div",{className:"edit-drug-form-header",children:[i.jsxs("h2",{children:["Edit Drug: ",t.name]}),i.jsx("button",{onClick:C,className:"cancel-button",title:"Go Back",children:i.jsx(Sn,{size:24})})]}),l&&i.jsx("div",{className:"error-message-submit",children:l}),i.jsxs("form",{onSubmit:P,className:"edit-drug-form",children:[i.jsxs("div",{className:"form-grid",children:[i.jsxs("div",{className:"sm-col-span-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"edit-name",className:"form-label",children:"Composition Name"})," ",i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),i.jsx("input",{type:"text",name:"name",id:"edit-name",value:t.name||"",onChange:E,className:"custom-text-input",placeholder:"e.g., Paracetamol",tabIndex:1})," "]}),i.jsxs("div",{className:"sm-col-span-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"edit-brand_name",className:"form-label",children:"Brand Name"})," ",i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),i.jsx("input",{type:"text",name:"brand_name",id:"edit-brand_name",value:t.brand_name||"",onChange:E,className:"custom-text-input",placeholder:"e.g., Calpol",tabIndex:2})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"edit-price",className:"form-label",children:"MRP () *"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),i.jsx("input",{type:"number",name:"price",id:"edit-price",required:!0,step:"0.01",min:"0",value:t.price,onChange:E,className:"custom-text-input",placeholder:"e.g., 500",tabIndex:3})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"edit-quantity_in_stock",className:"form-label",children:"Stock Quantity *"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),i.jsx("input",{type:"number",name:"quantity_in_stock",id:"edit-quantity_in_stock",required:!0,step:"1",min:"0",value:t.quantity_in_stock,onChange:E,className:"custom-text-input",placeholder:"e.g., 5",tabIndex:4})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-unit",className:"form-label",children:"Pack (e.g., strip, bottle)"}),i.jsx("input",{type:"text",name:"unit",id:"edit-unit",value:t.unit||"",onChange:E,className:"custom-text-input",placeholder:"e.g., strip, bottle",tabIndex:5})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-expiry_date",className:"form-label",children:"Expiry Date"}),i.jsx("input",{type:"date",name:"expiry_date",id:"edit-expiry_date",value:t.expiry_date||"",onChange:E,className:"custom-text-input",tabIndex:6})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-box_number",className:"form-label",children:"Box Number"}),i.jsx("input",{type:"text",name:"box_number",id:"edit-box_number",value:t.box_number||"",onChange:E,className:"custom-text-input",tabIndex:7})]}),i.jsxs("div",{className:"relative sm-col-span-2",ref:b,children:[i.jsx("button",{type:"button",onClick:()=>g(!f),className:"form-button w-full text-left",tabIndex:8,ref:v,children:"Others"}),f&&i.jsxs("div",{className:"others-fields-grid",children:[" ",i.jsxs("div",{className:"sm-col-span-2",children:[i.jsx("label",{htmlFor:"edit-description",className:"form-label",children:"Description"}),i.jsx("textarea",{name:"description",id:"edit-description",rows:3,value:t.description||"",onChange:E,className:"custom-text-input",tabIndex:9})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-supplier",className:"form-label",children:"Supplier"}),i.jsx("input",{type:"text",name:"supplier",id:"edit-supplier",value:t.supplier||"",onChange:E,className:"custom-text-input",placeholder:"Optional",tabIndex:10})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-buying_price",className:"form-label",children:"Rate ()"}),i.jsx("input",{type:"number",name:"buying_price",id:"edit-buying_price",step:"0.01",min:"0",value:t.buying_price??"",onChange:E,placeholder:"Optional",className:"custom-text-input",tabIndex:11,ref:S})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-gst",className:"form-label",children:"GST (%)"}),i.jsx("input",{type:"number",name:"gst",id:"edit-gst",step:"0.01",min:"0",max:"100",value:t.gst??"",onChange:E,placeholder:"Optional",className:"custom-text-input",tabIndex:12})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-margin",className:"form-label",children:"Margin (%)"}),i.jsx("input",{type:"number",name:"margin",id:"edit-margin",step:"0.01",min:"0",max:"100",value:t.margin??"",onChange:E,placeholder:"Optional",className:"custom-text-input",tabIndex:13})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-discount",className:"form-label",children:"Discount (%)"}),i.jsx("input",{type:"number",name:"discount",id:"edit-discount",step:"0.01",min:"0",max:"100",value:t.discount??"",onChange:E,placeholder:"Optional",className:"custom-text-input",tabIndex:14})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-batch",className:"form-label",children:"Batch"}),i.jsx("input",{type:"text",name:"batch",id:"edit-batch",value:t.batch||"",onChange:E,className:"custom-text-input",placeholder:"Optional",tabIndex:15})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-hsn_code",className:"form-label",children:"HSN Code"}),i.jsx("input",{type:"text",name:"hsn_code",id:"edit-hsn_code",value:t.hsn_code||"",onChange:E,className:"custom-text-input",placeholder:"Optional",tabIndex:16})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-mfg",className:"form-label",children:"MFG"}),i.jsx("input",{type:"text",name:"mfg",id:"edit-mfg",value:t.mfg||"",onChange:E,className:"custom-text-input",placeholder:"Optional",tabIndex:17})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"edit-loose",className:"form-label",children:"Loose"}),i.jsx("input",{type:"number",name:"loose",id:"edit-loose",step:"1",min:"0",value:t.loose??"",onChange:E,placeholder:"Optional",className:"custom-text-input",tabIndex:18})]})]})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{type:"button",onClick:C,disabled:d,className:"form-button cancel-form-button",tabIndex:19,children:"Back"}),i.jsx("button",{type:"submit",disabled:d,className:"form-button submit-form-button",tabIndex:20,children:d?"Saving...":"Save Changes"})]})]})]})}):i.jsx("div",{className:"edit-drug-form-page",children:i.jsx("div",{className:"not-found-message",children:"Drug not found."})})},z1=()=>{const e=Ft(),[n,t]=w.useState({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null),[u,f]=w.useState([]),[g,b]=w.useState(!0);w.useEffect(()=>{(async()=>{b(!0);try{const E=await ce("/api/staff?role=doctor");if(!E.ok)throw new Error("Failed to fetch doctors");const C=await E.json();f(C),C.length>0&&t(P=>({...P,doctorId:""}))}catch(E){console.error("Error fetching doctors:",E),l(`Failed to load doctors: ${E.message}`)}finally{b(!1)}})()},[]);const v=T=>{const{name:E,value:C}=T.target;t(P=>({...P,[E]:C}))},S=async T=>{var E;T.preventDefault(),l(null),d(null),a(!0);try{let C,P;console.log("Registering new patient...");const I=await ce("/api/patients",{method:"POST",body:JSON.stringify({name:n.name,age:n.age?parseInt(n.age,10):null,gender:n.gender||null,phone:n.phone||null})});if(!I.ok){const $=await I.json();if(I.status===403&&$.message.includes("Patient limit")){e("/start-clinic-subscription",{state:{errorMessage:$.message}});return}throw new Error($.message||"Failed to register patient")}const q=await I.json();C=q.id,P=q.name,console.log(`New patient ${C} registered.`);const L=n.doctorId||null;console.log(`Adding patient ${C} to general queue first (Assignment pending payment)`);const O=await ce("/api/queue",{method:"POST",body:JSON.stringify({patientId:C,complaint:n.complaint||null,doctorId:null})});if(!O.ok){const $=await O.json();throw new Error($.message||"Failed to add patient to queue")}const B=await O.json();if(console.log(`Patient added to queue, entry ID: ${B.id}`),t({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),L){const $=((E=u.find(z=>z.id===L))==null?void 0:E.name)||"Selected Doctor",F=`Patient "${P}" registered and added to queue. Redirecting to billing for Dr. ${$}...`;d(F),e("/billing",{state:{patientId:C,queueId:B.id,patientName:P,doctorId:L,billType:"consultation",finalizeQueueAssignment:!0}})}else{const $=`Patient "${P}" registered and added to the general queue.`;d($)}}catch(C){console.error("Error in add/queue process:",C),C.message.includes("Patient limit")?(l(`Operation failed: ${C.message}. Please upgrade your plan.`),e("/start-clinic-subscription")):l(`Operation failed: ${C.message}`)}finally{a(!1)}};return i.jsxs("div",{className:"add-patient-page-container",children:[i.jsx("div",{className:"w-full max-w-3xl flex justify-start",children:i.jsx("button",{onClick:()=>e(-1),className:"back-button",title:"Back to Previous Page",children:i.jsx(fn,{size:20})})}),i.jsxs("div",{className:"add-patient-card",children:[i.jsxs("h1",{className:"add-patient-title",children:[i.jsx(o1,{size:32}),"Register New Patient"]}),o&&i.jsxs("div",{className:"alert alert-danger",role:"alert",children:[i.jsx("strong",{children:"Error: "}),i.jsx("span",{children:o})]}),h&&i.jsxs("div",{className:"alert alert-success",role:"alert",children:[i.jsx("strong",{children:"Success: "}),i.jsx("span",{children:h})]}),i.jsxs("form",{onSubmit:S,className:"space-y-6",children:[i.jsxs("fieldset",{className:"form-fieldset",children:[i.jsx("legend",{children:"Basic Information"}),i.jsxs("div",{className:"form-grid form-grid-cols-2",children:[i.jsxs("div",{className:"form-grid-col-span-2",children:[i.jsx("label",{className:"form-label",children:"Full Name *"}),i.jsx("input",{type:"text",name:"name",placeholder:"Enter patient's full name",value:n.name,onChange:v,className:"form-input",required:!0,disabled:r})]}),i.jsxs("div",{children:[i.jsx("label",{className:"form-label",children:"Age"}),i.jsx("input",{type:"number",name:"age",placeholder:"Years",value:n.age,onChange:v,onBlur:T=>{T.target.value===""&&t(E=>({...E,age:"0"}))},className:"form-input",min:"0",disabled:r})]}),i.jsxs("div",{children:[i.jsx("label",{className:"form-label",children:"Gender"}),i.jsxs("select",{name:"gender",value:n.gender,onChange:v,className:"form-select",disabled:r,children:[i.jsx("option",{value:"",children:"Select Gender"}),i.jsx("option",{value:"M",children:"Male"}),i.jsx("option",{value:"F",children:"Female"}),i.jsx("option",{value:"O",children:"Other"})]})]}),i.jsxs("div",{className:"form-grid-col-span-2",children:[i.jsx("label",{className:"form-label",children:"Phone Number"}),i.jsx("input",{type:"tel",name:"phone",placeholder:"e.g. +91 9876543210",value:n.phone,onChange:v,className:"form-input",disabled:r})]})]})]}),i.jsxs("fieldset",{className:"form-fieldset",children:[i.jsx("legend",{children:"Visit & Consultation"}),i.jsxs("div",{className:"form-grid",children:[i.jsxs("div",{children:[i.jsx("label",{className:"form-label",children:"Consulting Doctor (Optional)"}),i.jsxs("select",{name:"doctorId",value:n.doctorId,onChange:v,className:`form-select ${g?"opacity-50":""}`,disabled:r||g,children:[i.jsx("option",{value:"",children:g?"Loading doctors...":u.length===0?"No doctors available":"-- No Doctor (Add to General Queue) --"}),u.map(T=>i.jsx("option",{value:T.id,children:T.name},T.id))]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"form-label",children:"Reason for Visit / Complaint"}),i.jsx("textarea",{name:"complaint",placeholder:"Briefly describe the reason for visit...",value:n.complaint,onChange:v,rows:3,className:"form-textarea",disabled:r})]})]})]}),i.jsx("button",{type:"submit",className:"btn-primary",disabled:r||g,style:{width:"100%"},children:r?i.jsx("span",{children:"Processing..."}):i.jsxs(i.Fragment,{children:[i.jsx(GM,{size:20}),"Register & Add to Queue"]})})]})]})]})},EY=({clinicId:e})=>{const n=Ft(),[t,r]=w.useState({name:"",email:"",role:"receptionist",password:"",opd_fee:""}),[a,o]=w.useState(null),[l,h]=w.useState(!1);w.useEffect(()=>{o(e?null:"Clinic information is missing. Please ensure you are logged in correctly.")},[e]);const d=f=>{const{name:g,value:b}=f.target;r(v=>{const S={...v,[g]:b};return g==="role"&&b!=="doctor"&&(S.opd_fee=""),S})},u=async f=>{if(f.preventDefault(),o(null),!t.name||!t.email||!t.role||!t.password){o("Please fill in all required fields (Name, Email, Role, and Password).");return}if(!e){o("Clinic session not found. Please refresh and try again.");return}const g={...t,clinic_id:e,opd_fee:t.role==="doctor"&&t.opd_fee?parseFloat(String(t.opd_fee)):null};if(g.role==="doctor"&&t.opd_fee&&isNaN(g.opd_fee)){o("Please enter a valid amount for the OPD Fee.");return}h(!0);try{const b=await ce("/api/staff",{method:"POST",body:JSON.stringify(g)});if(!b.ok){const v=await b.json();throw new Error(v.message||"The server encountered an error while adding staff.")}n(-1)}catch(b){o(b.message)}finally{h(!1)}};return i.jsxs("div",{className:"staff-page-container",children:[i.jsx("header",{className:"staff-header",children:i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[i.jsx("button",{onClick:()=>n(-1),className:"p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:i.jsx(fn,{size:20})}),i.jsx("h1",{children:"Add Staff Member"})]}),i.jsx("p",{className:"subtitle",children:"Register a new professional to your clinic's team."})]})}),a&&i.jsxs("div",{className:"mb-8 p-4 rounded-xl bg-rose-50 text-rose-700 border border-rose-100 flex items-center animate-in fade-in slide-in-from-top-2",children:[i.jsx(mi,{size:20,className:"mr-3 shrink-0"}),i.jsx("span",{className:"font-medium text-sm",children:a}),i.jsx("button",{onClick:()=>o(null),className:"ml-auto text-rose-400 hover:text-rose-600",children:""})]}),i.jsxs("form",{onSubmit:u,className:`staff-form ${e?"":"opacity-40 pointer-events-none"}`,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"name",children:"Full Name"}),i.jsx("input",{id:"name",type:"text",name:"name",value:t.name||"",onChange:d,required:!0,disabled:l||!e,placeholder:"Dr. John Doe / Receptionist Jane"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"email",children:"Email Address"}),i.jsx("input",{id:"email",type:"email",name:"email",value:t.email||"",onChange:d,required:!0,disabled:l||!e,placeholder:"staff@example.com"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"role",children:"Assign Role"}),i.jsxs("select",{id:"role",name:"role",value:t.role||"receptionist",onChange:d,required:!0,disabled:l||!e,children:[i.jsx("option",{value:"receptionist",children:"Receptionist"}),i.jsx("option",{value:"doctor",children:"Doctor"}),i.jsx("option",{value:"pharmacy",children:"Pharmacist"}),i.jsx("option",{value:"lab",children:"Lab Technician"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"password",children:"Initial Password"}),i.jsx("input",{id:"password",type:"password",name:"password",value:t.password||"",onChange:d,required:!0,disabled:l||!e,placeholder:"Create a secure password"})]}),t.role==="doctor"&&i.jsxs("div",{className:"form-group animate-in fade-in zoom-in-95",children:[i.jsx("label",{htmlFor:"opd_fee",children:"Consultation Fee ()"}),i.jsx("input",{id:"opd_fee",type:"number",name:"opd_fee",value:t.opd_fee||"",onChange:d,step:"0.01",min:"0",placeholder:"e.g. 500",disabled:l||!e})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-6 border-t border-slate-100 dark:border-slate-800 full-width",children:[i.jsxs("button",{type:"submit",className:"staff-btn staff-btn-primary px-8",disabled:l||!e,children:[l?i.jsx(Gf,{size:18,className:"animate-spin"}):i.jsx(Pl,{size:18}),i.jsx("span",{children:l?"Registering...":"Register Staff"})]}),i.jsx("button",{type:"button",onClick:()=>n(-1),className:"staff-btn staff-btn-secondary",disabled:l,children:"Cancel"})]})]})]})},AY=()=>{const{id:e}=ia(),n=Ft(),[t,r]=w.useState({name:"",email:"",role:"receptionist",opd_fee:"",active:!0}),[a,o]=w.useState(""),[l,h]=w.useState(!0),[d,u]=w.useState(!1),[f,g]=w.useState(null),[b,v]=w.useState(null),S=w.useCallback(async()=>{if(!e){g("Staff ID is missing."),h(!1);return}h(!0),g(null),v(null);try{const P=await ce(`/staff/${e}`);if(!P.ok){const q=await P.json();throw new Error(q.message||`HTTP error! status: ${P.status}`)}const I=await P.json();r({name:I.name,email:I.email,role:I.role,opd_fee:I.opd_fee??"",active:I.active})}catch(P){g(`Failed to load staff details: ${P.message}`)}finally{h(!1)}},[e]);w.useEffect(()=>{S()},[S]);const T=P=>{const{name:I,value:q,type:L}=P.target;if(L==="checkbox"){const{checked:O}=P.target;r(B=>({...B,[I]:O}))}else r(O=>({...O,[I]:q}))},E=P=>{o(P.target.value)},C=async P=>{if(P.preventDefault(),!e){g("Staff identifier is missing.");return}u(!0),g(null),v(null);const I={name:t.name,email:t.email,role:t.role,active:t.active};if(t.role==="doctor"){const q=t.opd_fee?parseFloat(String(t.opd_fee)):null;if(q!==null&&isNaN(q)){g("Consultation fee must be a valid number."),u(!1);return}I.opd_fee=q}else I.opd_fee=null;a.trim()!==""&&(I.password=a.trim());try{const q=await ce(`/staff/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(!q.ok){const L=await q.json();throw new Error(L.message||`Error status: ${q.status}`)}v("Profile updated successfully!"),o(""),setTimeout(()=>n(-1),1500)}catch(q){g(`Failed to update profile: ${q.message}`)}finally{u(!1)}};return l?i.jsx("div",{className:"flex justify-center items-center h-screen bg-transparent",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"loading-animation-container",children:i.jsx("div",{className:"breathing-ball",style:{background:"var(--staff-primary)"}})}),i.jsx("span",{className:"mt-4 text-xl text-teal-600 font-medium tracking-tight",children:"Accessing staff records..."})]})}):i.jsxs("div",{className:"staff-page-container",children:[i.jsx("header",{className:"staff-header",children:i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[i.jsx("button",{onClick:()=>n(-1),className:"p-2 -ml-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:i.jsx(fn,{size:20})}),i.jsx("h1",{children:"Edit Staff Profile"})]}),i.jsxs("p",{className:"subtitle",children:["Update credentials and preferences for ",t.name,"."]})]})}),f&&i.jsxs("div",{className:"mb-6 p-4 rounded-xl bg-rose-50 text-rose-700 border border-rose-100 flex items-center animate-in fade-in slide-in-from-top-2",children:[i.jsx(mi,{size:20,className:"mr-3"}),i.jsx("span",{className:"font-semibold text-sm",children:f})]}),b&&i.jsxs("div",{className:"mb-6 p-4 rounded-xl bg-emerald-50 text-emerald-700 border border-emerald-100 flex items-center animate-in fade-in slide-in-from-top-2",children:[i.jsx(Nr,{size:20,className:"mr-3"}),i.jsx("span",{className:"font-semibold text-sm",children:b})]}),i.jsxs("form",{onSubmit:C,className:"staff-form",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"name",children:"Full Name"}),i.jsx("input",{type:"text",id:"name",name:"name",value:t.name||"",onChange:T,required:!0,placeholder:"John Doe"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"email",children:"Email Address"}),i.jsx("input",{type:"email",id:"email",name:"email",value:t.email||"",onChange:T,required:!0,placeholder:"johndoe@clinic.com"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"role",children:"Role"}),i.jsxs("select",{id:"role",name:"role",value:t.role||"receptionist",onChange:T,required:!0,children:[i.jsx("option",{value:"doctor",children:"Doctor"}),i.jsx("option",{value:"receptionist",children:"Receptionist"}),i.jsx("option",{value:"lab",children:"Lab Technician"}),i.jsx("option",{value:"pharmacy",children:"Pharmacist"})]})]}),t.role==="doctor"&&i.jsxs("div",{className:"form-group animate-in fade-in zoom-in-95",children:[i.jsx("label",{htmlFor:"opd_fee",children:"Consultation Fee ()"}),i.jsx("input",{type:"number",id:"opd_fee",name:"opd_fee",value:t.opd_fee||"",onChange:T,min:"0",step:"0.01",placeholder:"e.g. 500"})]}),i.jsxs("div",{className:"form-group full-width",children:[i.jsx("label",{htmlFor:"password",children:"Update Password"}),i.jsx("input",{type:"password",id:"password",name:"password",value:a,onChange:E,placeholder:"Leave blank to keep existing password",autoComplete:"new-password"}),i.jsx("p",{className:"text-xs text-slate-500 mt-2",children:"Only fill this if you want to reset the staff member's password."})]}),i.jsxs("div",{className:"checkbox-group full-width",children:[i.jsx("input",{id:"active",name:"active",type:"checkbox",checked:t.active??!0,onChange:T}),i.jsxs("label",{htmlFor:"active",className:"mb-0 cursor-pointer select-none",children:[i.jsx("span",{className:"font-bold",children:"Account Active"}),i.jsx("p",{className:"text-xs text-slate-500 font-normal mt-1",children:"Deactivated staff cannot log into the system."})]})]}),i.jsxs("div",{className:"flex items-center gap-4 mt-4 pt-6 border-t border-slate-100 dark:border-slate-800 full-width",children:[i.jsxs("button",{type:"submit",className:"staff-btn staff-btn-primary px-8",disabled:d,children:[d?i.jsx(Gf,{className:"animate-spin",size:18}):i.jsx(vc,{size:18}),i.jsx("span",{children:d?"Saving...":"Save Changes"})]}),i.jsx("button",{type:"button",onClick:()=>n(-1),className:"staff-btn staff-btn-secondary",disabled:d,children:"Discard"})]})]})]})},DY=e=>{if(!e)return"Unknown Date";try{return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},PY=e=>{switch(e){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:e,className:"status-badge"}}},IY=e=>{switch(e){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Billed / Ready",className:"status-badge status-billed"};case"dispensed":return{text:"Dispensed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:e,className:"status-badge"}}},O0=({title:e,items:n,renderItemContent:t,headerAction:r,isLoading:a,noDataText:o,onDeleteItem:l,onEditLabOrder:h,onSaveLabOrder:d,onCancelEditLabOrder:u,onLabOrderTestChange:f,onLabOrderStatusChange:g,onEditPharmacyOrder:b,onPrintUnavailablePrescription:v,onMarkAsRecurring:S,onEditComplaint:T,onSaveComplaint:E,onCancelEditComplaint:C,labInventory:P=[],isSavingLabOrder:I=!1,expandedLabReports:q={},toggleLabReport:L=()=>{},className:O="",sectionRef:B})=>{const $=w.useMemo(()=>{const z={};n.forEach(V=>{if(isNaN(V.date.getTime())){z["Unknown Date"]||(z["Unknown Date"]=[]),z["Unknown Date"].push(V);return}const ee=DY(V.originalDateString);z[ee]||(z[ee]=[]),z[ee].push(V)});const U=Object.keys(z);return U.sort((V,ee)=>{if(V==="Unknown Date")return 1;if(ee==="Unknown Date")return-1;try{const ie=new Date(V.split(" ").reverse().join(" ")),ae=new Date(ee.split(" ").reverse().join(" "));if(!isNaN(ie.getTime())&&!isNaN(ae.getTime()))return ae.getTime()-ie.getTime()}catch{}return ee.localeCompare(V)}),U.map(V=>({date:V,items:z[V]}))},[n]),F=["pending","billed","collected","processing","report_ready","completed","cancelled","reported"];return i.jsxs("div",{ref:B,className:`ai-context-section ${O}`,children:[i.jsxs("div",{className:"flex justify-between items-center px-4",children:[i.jsx("h4",{className:"ai-context-section-title mb-2 pb-1",children:e}),r]}),!a&&n.length===0&&i.jsx("p",{className:"ai-context-text italic px-4",children:o}),a&&i.jsx("div",{className:"space-y-3 px-4",children:[1,2,3].map(z=>i.jsx("div",{className:"skeleton-block",style:{height:"80px"}},z))}),!a&&n.length>0&&i.jsx("div",{className:"space-y-3",children:$.map(({date:z,items:U})=>i.jsxs("div",{children:[i.jsx("h5",{className:"grouped-history-date px-4",children:z}),i.jsx("div",{className:"space-y-1 grouped-history-item-container",children:U.map((V,ee)=>i.jsxs("div",{className:"grouped-history-item ai-context-item flex flex-col px-4 py-2 border-b border-gray-50 last:border-0",style:{"--i":ee},children:[i.jsxs("div",{className:"flex justify-between items-center w-full",children:[i.jsx("div",{className:"flex-grow mr-2 ai-context-text",children:t(V,ee,q,L)}),i.jsxs("div",{className:"flex items-center space-x-1",children:[V.type==="Lab Order"&&!V.data.isEditing&&h&&i.jsx("button",{onClick:()=>h(V.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this lab order",disabled:I,children:i.jsx(ss,{size:14})}),V.type==="Lab Order"&&V.data.isEditing&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>d&&d(V.data.id,V.data.editedTests,V.data.editedStatus),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400",title:"Save lab order changes",disabled:I,children:i.jsx(vc,{size:14})}),i.jsx("button",{onClick:()=>u&&u(V.data.id),className:"text-gray-600 hover:text-gray-800 p-1 rounded hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-gray-400",title:"Cancel editing",disabled:I,children:i.jsx(Sn,{size:14})})]}),V.type==="Pharmacy Order"&&V.data.status==="pending"&&b&&i.jsx("button",{onClick:()=>b(V.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this pharmacy order",disabled:I,children:i.jsx(ss,{size:14})}),V.type==="Pharmacy Order"&&V.data.prescriptionForUnavailableDrugs&&v&&i.jsx("button",{onClick:()=>v(V.data.prescriptionForUnavailableDrugs,`Prescription for Order ${V.data.id}`),className:"text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-100 focus:outline-none focus:ring-1 focus:ring-purple-400",title:"Print Prescription for Unavailable Drugs",disabled:I,children:i.jsx(Ao,{size:14})}),V.type==="Pharmacy Order"&&S&&i.jsx("button",{onClick:()=>S(V.data.id),className:"text-teal-600 hover:text-teal-800 p-1 rounded hover:bg-teal-100 focus:outline-none focus:ring-1 focus:ring-teal-400",title:"Mark as Recurring Medication",disabled:I,children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-repeat",children:[i.jsx("path",{d:"m17 2 4 4-4 4"}),i.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),i.jsx("path",{d:"m7 22-4-4 4-4"}),i.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]})}),V.type==="Pharmacy Order"&&V.data.status==="pending"&&l&&i.jsx("button",{onClick:()=>l({type:V.type,data:V.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:"Delete this pending pharmacy order",disabled:I,children:i.jsx(Wi,{size:14})}),V.type==="Complaint"&&!V.data.isEditing&&T&&i.jsx("button",{onClick:()=>T(V.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this complaint",disabled:I,children:i.jsx(ss,{size:14})}),V.type==="Complaint"&&V.data.isEditing&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>E&&E(V.data.id,V.data.editedComplaint),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400",title:"Save complaint changes",disabled:I,children:i.jsx(vc,{size:14})}),i.jsx("button",{onClick:()=>C&&C(V.data.id),className:"text-gray-600 hover:text-gray-800 p-1 rounded hover:bg-gray-100 focus:outline-none focus:ring-1 focus:ring-gray-400",title:"Cancel editing",disabled:I,children:i.jsx(Sn,{size:14})})]}),l&&["Complaint","Lab Order","Lab Report"].includes(V.type)&&i.jsx("button",{onClick:()=>l({type:V.type,data:V.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:`Delete this ${V.type.toLowerCase()}`,disabled:I,children:i.jsx(Wi,{size:14})})]})]}),V.type==="Lab Order"&&V.data.isEditing&&i.jsxs("div",{className:"lab-order-edit-form mt-2 w-full",children:[i.jsxs("div",{className:"mb-2",children:[i.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Status:"}),i.jsx("select",{value:V.data.editedStatus||V.data.status,onChange:ie=>g&&g(V.data.id,ie.target.value),className:"form-select block w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:I,children:F.map(ie=>i.jsx("option",{value:ie,children:ie.replace(/_/g," ")},ie))})]}),i.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tests:"}),V.data.editedTests.map((ie,ae)=>i.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[i.jsxs("select",{value:ie.id,onChange:J=>{const K=P.find(W=>String(W.id)===J.target.value);K&&(f&&f(V.data.id,ae,"id",K.id),f&&f(V.data.id,ae,"name",K.name),f&&f(V.data.id,ae,"price",K.price))},className:"form-select block w-full text-sm rounded-md border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:I,children:[i.jsx("option",{value:"",children:"Select Test"}),P.map(J=>i.jsxs("option",{value:J.id,children:[J.name," (",J.price,")"]},J.id))]}),i.jsx("button",{onClick:()=>{const J=V.data.editedTests.filter((K,W)=>W!==ae);f&&f(V.data.id,-1,"remove",J)},className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:"Remove test",disabled:I,children:i.jsx(Wi,{size:14})})]},ae)),i.jsx("button",{onClick:()=>{f&&f(V.data.id,-1,"add",{id:"",name:"",price:0})},className:"button-secondary mt-2 text-xs",disabled:I,children:"Add Test"})]})]},`${V.type}-${V.originalDateString}-${ee}`))})]},z))})]})},MY="_modalOverlay_1yna4_3",RY="_modalContent_1yna4_29",OY="_modalHeader_1yna4_57",LY="_modalTitle_1yna4_75",FY="_modalCloseButton_1yna4_87",$Y="_modalBody_1yna4_115",zY="_errorText_1yna4_129",BY="_formGroup_1yna4_147",UY="_inputField_1yna4_171",qY="_searchResultsCard_1yna4_213",VY="_searchResultsList_1yna4_241",HY="_searchResultItem_1yna4_253",GY="_searchResultPrice_1yna4_289",YY="_selectedTestsCard_1yna4_299",WY="_selectedTestsHeader_1yna4_319",QY="_noTestsMessage_1yna4_335",JY="_selectedTestsList_1yna4_351",KY="_selectedTestItem_1yna4_363",XY="_selectedTestName_1yna4_387",ZY="_selectedTestPrice_1yna4_399",eW="_removeTestButton_1yna4_411",tW="_totalAmount_1yna4_437",nW="_modalFooter_1yna4_455",iW="_button_1yna4_473",rW="_buttonPrimary_1yna4_491",aW="_buttonSecondary_1yna4_513",di={modalOverlay:MY,modalContent:RY,modalHeader:OY,modalTitle:LY,modalCloseButton:FY,modalBody:$Y,errorText:zY,formGroup:BY,inputField:UY,searchResultsCard:qY,searchResultsList:VY,searchResultItem:HY,searchResultPrice:GY,selectedTestsCard:YY,selectedTestsHeader:WY,noTestsMessage:QY,selectedTestsList:JY,selectedTestItem:KY,selectedTestName:XY,selectedTestPrice:ZY,removeTestButton:eW,totalAmount:tW,modalFooter:nW,button:iW,buttonPrimary:rW,buttonSecondary:aW},sW=({isOpen:e,onClose:n,patientId:t,labInventory:r,fetchPendingLabOrdersData:a})=>{const[o,l]=w.useState([]),[h,d]=w.useState(""),[u,f]=w.useState([]),[g,b]=w.useState(null),[v,S]=w.useState(!1);w.useEffect(()=>{if(!h){f([]);return}const P=h.toLowerCase();f(r.filter(I=>I.name.toLowerCase().includes(P)||I.description&&I.description.toLowerCase().includes(P)).slice(0,10))},[h,r]);const T=async()=>{if(!t){b("Patient ID is missing.");return}if(o.length===0){b("Please select at least one lab test.");return}S(!0),b(null);try{const P={patient_id:t,tests:o.map(q=>({id:q.id,name:q.name,price:q.price}))},I=await ce("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(!I.ok){const q=await I.json().catch(()=>({}));throw new Error(q.message||`Failed to create lab order: ${I.statusText}`)}await I.json(),a(t),n(),l([]),d("")}catch(P){b(`Lab Order Creation Error: ${P.message}`)}finally{S(!1)}},E=P=>{if(o.some(I=>I.id===P.id)){b(`${P.name} is already in the order.`),setTimeout(()=>b(null),3e3),d(""),f([]);return}l(I=>[...I,{...P}]),d(""),f([])},C=P=>{l(I=>I.filter(q=>q.id!==P))};return e?i.jsx("div",{className:di.modalOverlay,children:i.jsxs("div",{className:di.modalContent,children:[i.jsxs("div",{className:di.modalHeader,children:[i.jsx("h3",{className:di.modalTitle,children:"Create New Lab Order"}),i.jsx("button",{onClick:n,className:di.modalCloseButton,children:i.jsx(Sn,{size:20})})]}),i.jsxs("div",{className:di.modalBody,children:[g&&i.jsx("div",{className:di.errorText,children:g}),i.jsxs("div",{className:di.formGroup,style:{position:"relative"},children:[i.jsx("label",{htmlFor:"lab-test-search",children:"Add Lab Test"}),i.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search available lab tests...",value:h,onChange:P=>d(P.target.value),className:di.inputField}),h&&u.length>0&&i.jsx("div",{className:di.searchResultsCard,children:i.jsx("ul",{className:di.searchResultsList,children:u.map(P=>i.jsxs("li",{onClick:()=>E(P),className:di.searchResultItem,children:[i.jsx("span",{children:P.name}),i.jsxs("span",{className:di.searchResultPrice,children:["(",parseFloat(String(P.price)).toFixed(2),")"]})]},P.id))})})]}),i.jsxs("div",{className:di.selectedTestsCard,children:[i.jsx("h4",{className:di.selectedTestsHeader,children:"Selected Tests"}),o.length===0?i.jsx("p",{className:di.noTestsMessage,children:"No tests added yet."}):i.jsx("ul",{className:di.selectedTestsList,children:o.map(P=>i.jsxs("li",{className:di.selectedTestItem,children:[i.jsx("span",{className:di.selectedTestName,children:P.name}),i.jsxs("span",{className:di.selectedTestPrice,children:["",parseFloat(String(P.price)).toFixed(2)]}),i.jsx("button",{type:"button",onClick:()=>C(String(P.id)),className:di.removeTestButton,title:"Remove Test",children:i.jsx(Wi,{size:16})})]},P.id))})]}),o.length>0&&i.jsxs("div",{className:di.totalAmount,children:["Total: ",o.reduce((P,I)=>P+parseFloat(String(I.price)),0).toFixed(2)]})]}),i.jsxs("div",{className:di.modalFooter,children:[i.jsx("button",{type:"button",onClick:n,className:`${di.button} ${di.buttonSecondary}`,children:" Cancel "}),i.jsxs("button",{type:"button",onClick:T,disabled:o.length===0||v,className:`${di.button} ${di.buttonPrimary} ${o.length===0||v?di.buttonDisabled:""}`,children:[" ",v?"Saving...":"Create Lab Order"," "]})]})]})}):null},oW="_modalOverlay_7kwn4_3",lW="_modalContent_7kwn4_29",cW="_modalHeader_7kwn4_61",uW="_modalTitle_7kwn4_79",dW="_modalCloseButton_7kwn4_93",hW="_modalBody_7kwn4_129",fW="_errorText_7kwn4_141",pW="_formGroup_7kwn4_161",mW="_stickySearchHeader_7kwn4_173",gW="_inputField_7kwn4_211",yW="_searchResultsCard_7kwn4_253",xW="_searchResultsList_7kwn4_281",bW="_searchResultItem_7kwn4_293",vW="_searchResultPrice_7kwn4_323",wW="_selectedTestsCard_7kwn4_335",NW="_selectedTestsHeader_7kwn4_351",SW="_noTestsMessage_7kwn4_375",jW="_selectedTestsList_7kwn4_395",_W="_selectedTestItem_7kwn4_413",CW="_selectedTestHeader_7kwn4_441",kW="_selectedTestName_7kwn4_457",TW="_selectedTestInputs_7kwn4_469",EW="_inputGroup_7kwn4_481",AW="_quantityInput_7kwn4_503",DW="_removeTestButton_7kwn4_523",PW="_textareaField_7kwn4_559",IW="_modalFooter_7kwn4_573",MW="_button_7kwn4_591",RW="_buttonPrimary_7kwn4_615",OW="_buttonSecondary_7kwn4_637",LW="_buttonDisabled_7kwn4_659",Tn={modalOverlay:oW,modalContent:lW,modalHeader:cW,modalTitle:uW,modalCloseButton:dW,modalBody:hW,errorText:fW,formGroup:pW,stickySearchHeader:mW,inputField:gW,searchResultsCard:yW,searchResultsList:xW,searchResultItem:bW,searchResultPrice:vW,selectedTestsCard:wW,selectedTestsHeader:NW,noTestsMessage:SW,selectedTestsList:jW,selectedTestItem:_W,selectedTestHeader:CW,selectedTestName:kW,selectedTestInputs:TW,inputGroup:EW,quantityInput:AW,removeTestButton:DW,textareaField:PW,modalFooter:IW,button:MW,buttonPrimary:RW,buttonSecondary:OW,buttonDisabled:LW},FW=({isOpen:e,onClose:n,patientId:t,pharmacyInventory:r,fetchPharmacyOrdersData:a})=>{const[o,l]=w.useState([]),[h,d]=w.useState(""),[u,f]=w.useState([]),[g,b]=w.useState(null),[v,S]=w.useState(!1),[T,E]=w.useState(""),C=w.useRef(null);w.useEffect(()=>{if(!h){f([]);return}const $=h.toLowerCase();f(r.filter(F=>F.name.toLowerCase().includes($)).slice(0,10))},[h,r]),w.useEffect(()=>{C.current&&(C.current.style.height="auto",C.current.style.height=`${C.current.scrollHeight}px`)},[T]);const P=$=>{if(!$)return null;const F=$.match(/(?:\d+x)?(\d+)/);return F?parseInt(F[1],10):null},I=Fn.useMemo(()=>o.reduce(($,F)=>{const z=F.pack_price||0,U=F.loose_price||0,V=(F.pack_quantity||0)*z,ee=(F.loose_quantity||0)*U;return $+V+ee},0),[o]),q=async()=>{if(!t){b("Patient ID is missing.");return}if(o.length===0&&!T.trim()){b("Please select at least one medication or provide a prescription.");return}S(!0),b(null);try{const $={patient_id:t,items:o.map(z=>({drug_id:z.drug_id,name:z.name,pack_quantity:z.pack_quantity||0,loose_quantity:z.loose_quantity||0,price:z.price,pack_price:z.pack_price||0,loose_price:z.loose_price||0,total_price:(z.pack_quantity||0)*(z.pack_price||0)+(z.loose_quantity||0)*(z.loose_price||0),unit:z.unit})),prescription_for_unavailable_drugs:T,status:"pending",date:new Date().toISOString(),order_total:I},F=await ce("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!F.ok){const z=await F.json().catch(()=>({}));throw new Error(z.message||`Failed to create pharmacy order: ${F.statusText}`)}await F.json(),a(t),n(),l([]),d(""),E("")}catch($){b(`Pharmacy Order Creation Error: ${$.message}`)}finally{S(!1)}},L=$=>{if(o.some(V=>V.drug_id===$.id)){b(`${$.name} is already in the order.`),setTimeout(()=>b(null),3e3),d(""),f([]);return}const F=P($.unit),z=Number($.price)||0,U=z/(F||1);l(V=>[...V,{drug_id:$.id,name:$.name,price:$.price,pack_price:z,loose_price:U,pack_quantity:1,loose_quantity:0,unit:$.unit}]),d(""),f([])},O=$=>{l(F=>F.filter(z=>z.drug_id!==$))},B=($,F,z)=>{l(U=>U.map(V=>V.drug_id===$?{...V,[F]:z}:V))};return e?i.jsx("div",{className:Tn.modalOverlay,children:i.jsxs("div",{className:Tn.modalContent,children:[i.jsxs("div",{className:Tn.modalHeader,children:[i.jsx("h3",{className:Tn.modalTitle,children:"Create New Pharmacy Order"}),i.jsx("button",{onClick:n,className:Tn.modalCloseButton,children:i.jsx(Sn,{size:20})})]}),i.jsxs("div",{className:Tn.modalBody,children:[i.jsxs("div",{className:`${Tn.formGroup} ${Tn.stickySearchHeader}`,children:[i.jsx("label",{htmlFor:"drug-search",children:"Add Medication"}),i.jsx("input",{type:"text",id:"drug-search",placeholder:"Search available drugs...",value:h,onChange:$=>d($.target.value),className:Tn.inputField}),h&&u.length>0&&i.jsx("div",{className:Tn.searchResultsCard,children:i.jsx("ul",{className:Tn.searchResultsList,children:u.map($=>i.jsxs("li",{onClick:()=>L($),className:Tn.searchResultItem,children:[i.jsx("span",{children:$.name}),i.jsxs("span",{className:Tn.searchResultPrice,children:["(",parseFloat(String($.price)).toFixed(2),")"]})]},$.id))})})]}),g&&i.jsx("div",{className:Tn.errorText,children:g}),i.jsxs("div",{className:Tn.selectedTestsCard,children:[i.jsx("h4",{className:Tn.selectedTestsHeader,children:"Selected Medications"}),o.length===0?i.jsx("p",{className:Tn.noTestsMessage,children:"No medications added yet."}):i.jsx("ul",{className:Tn.selectedTestsList,children:o.map($=>i.jsxs("li",{className:Tn.selectedTestItem,children:[i.jsxs("div",{className:Tn.selectedTestHeader,children:[i.jsx("span",{className:Tn.selectedTestName,children:$.name}),i.jsx("button",{type:"button",onClick:()=>O($.drug_id),className:Tn.removeTestButton,title:"Remove Medication",children:i.jsx(Wi,{size:16})})]}),i.jsxs("div",{className:Tn.selectedTestInputs,children:[i.jsxs("div",{className:Tn.inputGroup,children:[i.jsx("label",{children:"Packs"}),i.jsx("input",{type:"number",min:"0",value:$.pack_quantity,onChange:F=>B($.drug_id,"pack_quantity",parseInt(F.target.value)||0),className:Tn.quantityInput})]}),i.jsxs("div",{className:Tn.inputGroup,children:[i.jsx("label",{children:"Loose"}),i.jsx("input",{type:"number",min:"0",value:$.loose_quantity,onChange:F=>B($.drug_id,"loose_quantity",parseInt(F.target.value)||0),className:Tn.quantityInput})]})]})]},$.drug_id))})]}),o.length>0&&i.jsxs("div",{className:Tn.totalAmount,children:["Total: ",I.toFixed(2)]}),i.jsxs("div",{className:Tn.formGroup,style:{marginTop:"20px"},children:[i.jsx("label",{htmlFor:"prescription-notes",children:"Prescription for Unavailable Drugs (Optional)"}),i.jsx("textarea",{id:"prescription-notes",ref:C,rows:1,value:T,onChange:$=>E($.target.value),placeholder:"Enter any additional notes or prescription details...",className:`${Tn.inputField} ${Tn.textareaField}`})]})]}),i.jsxs("div",{className:Tn.modalFooter,children:[i.jsx("button",{type:"button",onClick:n,className:`${Tn.button} ${Tn.buttonSecondary}`,children:" Cancel "}),i.jsx("button",{type:"button",onClick:q,disabled:o.length===0&&!T.trim()||v,className:`${Tn.button} ${Tn.buttonPrimary} ${o.length===0&&!T.trim()||v?Tn.buttonDisabled:""}`,children:v?"Saving...":"Create Order"})]})]})}):null},$W="_modalOverlay_13u8a_1",zW="_modalContent_13u8a_45",BW="_modalHeader_13u8a_99",UW="_modalTitle_13u8a_117",qW="_modalCloseButton_13u8a_139",VW="_modalBody_13u8a_177",HW="_section_13u8a_197",GW="_sectionTitle_13u8a_209",YW="_settingsGrid_13u8a_233",WW="_inputWrapper_13u8a_253",QW="_label_13u8a_265",JW="_inputGroup_13u8a_277",KW="_inputIcon_13u8a_289",XW="_inputField_13u8a_303",ZW="_inputFieldWithAction_13u8a_327",eQ="_selectField_13u8a_345",tQ="_searchArea_13u8a_363",nQ="_searchResults_13u8a_371",iQ="_searchItem_13u8a_425",rQ="_drugName_13u8a_461",aQ="_drugInfo_13u8a_471",sQ="_medList_13u8a_483",oQ="_medCard_13u8a_495",lQ="_medCardHeader_13u8a_529",cQ="_medName_13u8a_541",uQ="_medCardGrid_13u8a_553",dQ="_removeMedBtn_13u8a_565",hQ="_errorBanner_13u8a_595",fQ="_modalFooter_13u8a_621",pQ="_btn_13u8a_639",mQ="_btnSecondary_13u8a_663",gQ="_btnPrimary_13u8a_683",yQ="_spinner_13u8a_717",xQ="_noMeds_13u8a_747",At={modalOverlay:$W,modalContent:zW,modalHeader:BW,modalTitle:UW,modalCloseButton:qW,modalBody:VW,section:HW,sectionTitle:GW,settingsGrid:YW,inputWrapper:WW,label:QW,inputGroup:JW,inputIcon:KW,inputField:XW,inputFieldWithAction:ZW,selectField:eQ,searchArea:tQ,searchResults:nQ,searchItem:iQ,drugName:rQ,drugInfo:aQ,medList:sQ,medCard:oQ,medCardHeader:lQ,medName:cQ,medCardGrid:uQ,removeMedBtn:dQ,errorBanner:hQ,modalFooter:fQ,btn:pQ,btnSecondary:mQ,btnPrimary:gQ,spinner:yQ,noMeds:xQ},MT=({isOpen:e,onClose:n,recurringMedication:t,onUpdate:r,inventory:a})=>{const[o,l]=w.useState([]),[h,d]=w.useState(30),[u,f]=w.useState("active"),[g,b]=w.useState(""),[v,S]=w.useState(""),[T,E]=w.useState([]),[C,P]=w.useState(!1),[I,q]=w.useState(null);w.useEffect(()=>{e&&t&&(l([...t.medications]),d(t.frequency_days||30),f(t.status),b(new Date(t.next_delivery_date).toISOString().split("T")[0]),q(null))},[e,t]),w.useEffect(()=>{if(v.trim().length>1){const F=v.toLowerCase(),z=a.filter(U=>U.name&&U.name.toLowerCase().includes(F)).slice(0,5);E(z)}else E([])},[v,a]);const L=F=>{if(o.some(V=>V.drug_id===F.id)){q(`${F.name} is already in the list.`);return}const U={drug_id:F.id,name:F.name,pack_quantity:1,loose_quantity:0,pack_price:F.price,unit:F.unit,total_price:F.price};l([...o,U]),S(""),E([]),q(null)},O=F=>{const z=[...o];z.splice(F,1),l(z)},B=(F,z,U)=>{const V=[...o];z==="pack_quantity"||z==="loose_quantity"||z==="tabletsPerDay"||z==="numberOfDays"?V[F]={...V[F],[z]:Math.max(0,Number(U))}:V[F]={...V[F],[z]:U},l(V)},$=async()=>{if(o.length===0){q("Please add at least one medication.");return}P(!0),q(null);try{const F=await ce(`/api/recurring-medications/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medications:o,frequency_days:h,status:u,next_delivery_date:g})});if(!F.ok){const U=await F.json();throw new Error(U.message||"Failed to update recurring medication")}const z=await F.json();r(z),n()}catch(F){q(F.message)}finally{P(!1)}};return e?i.jsx("div",{className:At.modalOverlay,children:i.jsxs("div",{className:At.modalContent,children:[i.jsxs("div",{className:At.modalHeader,children:[i.jsx("h2",{className:At.modalTitle,children:"Edit Recurring Medication"}),i.jsx("button",{onClick:n,className:At.modalCloseButton,title:"Close",children:i.jsx(Sn,{size:24})})]}),i.jsxs("div",{className:At.modalBody,children:[I&&i.jsxs("div",{className:At.errorBanner,children:[i.jsx(mi,{size:18}),i.jsx("span",{children:I})]}),i.jsxs("div",{className:At.section,children:[i.jsxs("div",{className:At.sectionTitle,children:[i.jsx(Il,{size:14}),i.jsx("span",{children:"Subscription Settings"})]}),i.jsxs("div",{className:At.settingsGrid,children:[i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Frequency (Days)"}),i.jsxs("div",{className:At.inputGroup,children:[i.jsx(Il,{size:16,className:At.inputIcon}),i.jsx("input",{type:"number",value:h,onChange:F=>d(parseInt(F.target.value,10)||1),className:At.inputField,min:"1"})]})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Subscription Status"}),i.jsx("div",{className:At.inputGroup,children:i.jsxs("select",{value:u,onChange:F=>f(F.target.value),className:`${At.inputField} ${At.inputFieldWithAction} ${At.selectField}`,children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"paused",children:"Paused"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]})})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Next Delivery Date"}),i.jsxs("div",{className:At.inputGroup,children:[i.jsx(Xf,{size:16,className:At.inputIcon}),i.jsx("input",{type:"date",value:g,onChange:F=>b(F.target.value),className:At.inputField})]})]})]})]}),i.jsxs("div",{className:At.section,children:[i.jsxs("div",{className:At.sectionTitle,children:[i.jsx(Pi,{size:14}),i.jsx("span",{children:"Add & Manage Medications"})]}),i.jsxs("div",{className:At.searchArea,children:[i.jsxs("div",{className:At.inputGroup,children:[i.jsx(Pi,{size:18,className:At.inputIcon}),i.jsx("input",{type:"text",value:v,onChange:F=>S(F.target.value),placeholder:"Search pharmacy inventory...",className:At.inputField})]}),T.length>0&&i.jsx("div",{className:At.searchResults,children:T.map(F=>i.jsxs("div",{onClick:()=>L(F),className:At.searchItem,children:[i.jsxs("div",{children:[i.jsx("div",{className:At.drugName,children:F.name}),i.jsxs("div",{className:At.drugInfo,children:["Stock: ",F.quantity_in_stock," | Unit: ",F.unit]})]}),i.jsxs("div",{className:At.drugName,children:["",F.price]})]},F.id))})]}),i.jsxs("div",{className:At.medList,children:[o.map((F,z)=>i.jsxs("div",{className:At.medCard,children:[i.jsxs("div",{className:At.medCardHeader,children:[i.jsx("span",{className:At.medName,children:F.name}),i.jsx("button",{onClick:()=>O(z),className:At.removeMedBtn,title:"Remove",children:i.jsx(Wi,{size:18})})]}),i.jsxs("div",{className:At.medCardGrid,children:[i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Packs"}),i.jsx("input",{type:"number",value:F.pack_quantity||0,onChange:U=>B(z,"pack_quantity",U.target.value),className:`${At.inputField} ${At.inputFieldWithAction}`,placeholder:"0"})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Loose Qty"}),i.jsx("input",{type:"number",value:F.loose_quantity||0,onChange:U=>B(z,"loose_quantity",U.target.value),className:`${At.inputField} ${At.inputFieldWithAction}`,placeholder:"0"})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Days"}),i.jsx("input",{type:"number",value:F.numberOfDays||0,onChange:U=>B(z,"numberOfDays",U.target.value),className:`${At.inputField} ${At.inputFieldWithAction}`,placeholder:"0"})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Dosage (e.g. 1 tab/day for 10 days)"}),i.jsx("input",{type:"text",value:F.tabletsPerDay||"",onChange:U=>B(z,"tabletsPerDay",U.target.value),className:`${At.inputField} ${At.inputFieldWithAction}`,placeholder:"e.g. 1 tab/day..."})]}),i.jsxs("div",{className:At.inputWrapper,children:[i.jsx("label",{className:At.label,children:"Directions"}),i.jsx("input",{type:"text",value:F.directions_to_use||"",onChange:U=>B(z,"directions_to_use",U.target.value),className:`${At.inputField} ${At.inputFieldWithAction}`,placeholder:"Directions to use..."})]})]})]},z)),o.length===0&&i.jsxs("div",{className:At.noMeds,children:[i.jsx(Pl,{size:32,style:{marginBottom:"12px",opacity:.5}}),i.jsx("p",{children:"No medications added to this recurring subscription yet."})]})]})]})]}),i.jsxs("div",{className:At.modalFooter,children:[i.jsx("button",{onClick:n,className:`${At.btn} ${At.btnSecondary}`,children:"Cancel"}),i.jsxs("button",{onClick:$,disabled:C,className:`${At.btn} ${At.btnPrimary}`,children:[C?i.jsx("div",{className:At.spinner}):i.jsx(vc,{size:18}),C?"Saving Changes...":"Save Subscription"]})]})]})}):null},Lx=e=>{if(!e)return"";let n=e.toLowerCase();return n=n.replace(/\b(mg|g|ml|iu|unit|tabs|tablet|tablets|capsule|capsules|injection|injections|syrup|solution|cream|ointment|lotion|spray|drops|patch|suppository|vial|ampoule|bottle|pack|kit)\b/g,""),n=n.replace(/\b(test|panel|profile|assay|screen|analysis|level|count|culture)\b/g,""),n=n.replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim(),n},Jd=(e,n)=>{if(!e||!n||n.length===0)return;const t=Lx(e);let r=n.find(l=>Lx(l.name)===t);if(r)return r;let a=n.find(l=>Lx(l.name).includes(t));if(a)return a;let o=n.find(l=>t.includes(Lx(l.name)));if(o)return o},bQ=`You are an expert OPD (Outpatient Department) medical assistant for a Doctor in a clinic in India. You will receive all the medical data of the patient including complaints (history), labs, pharmacy orders, etc., along with their date and time. Your primary goal is to assist the doctor and analyze patient chief complaints (Co), provide a structured clinical assessment including lab test suggestions (Lx), differential diagnoses (Dx), and a treatment plan (Tx). You have access to tools (actions) to order lab tests and pharmacy items, and update patient details.



**1. Definitions:**
   - Co: Chief complaints
   - Pt: Patient (assume living in India)
   - Lx: Laboratory tests
   - Dx: Differential Diagnosis
   - Tx: Treatment Plan

**2. Workflow:**
   - Analyze Co, generate Lx, Dx, and Tx sections as described below.
   - **Prioritization for Orders:** Always prioritize using \`edit_pharmacy_order\` or \`edit_lab_order\` if there are existing pending orders for the patient, before considering \`create_pharmacy_order\` or \`create_lab_order\`.
   - using edit_lab_order edits the lab order with the given serial numnber use to add new tests to the existing order or remove the tests from existing order, marking the status affects all tests in the order not only the test,always use this tool if there are pending lab orders instead of creating new orders.
   - using edit_pharmacy_order edits the pharmacy order with the given serial numnber to add new items to the existing order, update existing items, or remove items (either by \`items_to_remove\` or by setting \`quantity\` to 0). Always use this tool if there are pending pharmacy orders instead of creating new orders.
   - If your Lx section suggests tests from the inventory, use the \`create_lab_order\` action, but only for tests that are both clinically required and have not already been ordered or are still pending. Skip tests that are already ordered and in pending.
   - **Pharmacy Order Status Meanings:**
     - \`pending\` or \`billing_pending\`: The order has been created but the medication has NOT been given to the patient yet. The patient is waiting for billing/dispensing. **These orders CAN be edited** - you can add new medications, remove existing medications, or update quantities/dosages using \`edit_pharmacy_order\`.
     - \`billed\`: The order has been billed. **These orders CANNOT be edited** - do not attempt to use \`edit_pharmacy_order\` on billed orders.
     - \`dispensed\`: The medication has been given/dispensed to the patient. **These orders CANNOT be edited** - do not attempt to use \`edit_pharmacy_order\` on dispensed orders.
     - \`cancelled\`: The order was cancelled and medication was not given.
   - **CRITICAL - Preventing Duplicate Pending Orders:** Before creating a new pharmacy order with \`create_pharmacy_order\`, you MUST check the existing pharmacy orders. If there is already a \`pending\` or \`billing_pending\` order containing the same medication, DO NOT create a new order for that medication. Instead, use \`edit_pharmacy_order\` to modify the existing pending order if needed (e.g., to adjust quantity or add new medications to it). Only create a new order if the medication is not already in any pending order.
   - **Tx Section - Prescribing Medications:** If your Tx section prescribes medications, first check if there are any existing \`pending\` or \`billing_pending\` pharmacy orders. If pending orders exist, use \`edit_pharmacy_order\` to add new medications to an existing pending order rather than creating a new order. Do not use \`create_pharmacy_order\` if there are anypending orders at all. For medications that were previously \`dispensed\` or \`billed\` and need to be re-prescribed (e.g., for a new course of treatment after the previous one was completed), you may create a new order.
   - If your Tx section prescribes medications that are *not* available in the inventory, use the \`prescription_for_unavailable_drugs\` parameter within the \`create_pharmacy_order\` action to specify the prescription details for these unavailable drugs.
   - When ordering pharmacy items, specify both \`pack_quantity\` (number of full packs) and \`loose_quantity\` (number of individual units). The system will handle the conversion based on the drug's unit/pack size.
   - **Patient Details Management:** Always store or update patient name, age, sex, and phone number using the \`update_patient_details\` action. If patient name, age, or sex is received as 'New Patient - Direct Entry', 'N/A', or blank, treat it as missing data; if the user input provides anything resembling a name, age, or sex (e.g., shiva 25m, robin 50m, priya 19f), update them using the \`update_patient_details\` action. If details are missing, you can ask the user for the missing details using the \`ask_followup_question\` action.
   - Always update new complaints of the patient using the \`add_complaint_history\` action.
   - Use the \`edit_complaint\` action to modify existing complaints if the user corrects them or wants to delete them. You can update the text using \`new_complaint\` or remove the complaint entirely by setting \`delete: true\`. Use the \`serialNumber\` displayed in the history to identify the complaint.
   - **Patient Status & Queue Management:**
       - Use \`update_patient_status\` to manage patient admissions, discharge, and queue status.
       - \`status: "admit"\`: Use when a patient needs to be admitted to the clinic.
       - \`status: "discharge"\`: Use when an admitted patient is ready to leave.
       - \`status: "add_to_doctor_queue"\`: Use to add a patient to the doctor's queue.
       - \`status: "complete_consultation"\`: Use to mark the current doctor consultation as finished (sets status to 'seen').
       - Check the patient's current status and queue information provided in the prompt before suggesting these actions.
   - If you generate a concise summary of the patient's current situation based on the interaction and history, use the \`update_case_summary\` action to save it.
   - Remember, when you use \`update_case_summary\`, the previous case summary will be replaced by the new one, so you can use it like a short-term memory to store other stuff that **keeps changing**, like the current treatment plan, plan of action, active problems, or current vitals, etc.
   - When you use \`add_complaint_history\`, it will add the complaint to the previous ones. You will be given all the previous complaints back in every query, so you can use it to store other long-term facts that do **not change**, like the history of a chronic illness, surgical history, allergies, or social history, etc.
   - while placing or editing a pharmacy order make sure to set the \`pack_quantity\` and \`loose_quantity\` right.
   - Use the \`update_clinic_ai_memory\` action to store or update **various types of clinic-wide persistent information in a concise way**. This can include 'summaries of common patient encounters'+'summeries of previous **Clinic-wide AI Memory**'(e.g., 'Patient X, 50m, chronic gastritis, last visit YYYY-MM-DD, prescribed Z, follow-up in N days'+'**Clinic-wide AI Memory** summary'), notes on local health trends, common diagnostic patterns observed in the clinic, specific operational protocols. This memory is shared across all interactions for the clinic and helps tailor responses to its specific context over time.
    - **Recurring Medications Management:**
        - Use \`create_recurring_medication\` only when specifically asked to make a treatment or order recurring. It takes the same items structure as pharmacy orders but also requires \`frequency_days\` and \`next_delivery_date\`.
         - Use \`edit_recurring_medication\` to update an existing recurring medication entry. You must use \`serialNumber\` from the provided list.
        - Use \`delete_recurring_medication\` to stop/remove a recurring medication using its \`serialNumber\`.
    - **Deleting Orders:**
         - Use \`delete_pharmacy_order\` to permanently delete a pharmacy order using its \`serialNumber\`. Only use this when the user explicitly asks to delete/remove a pharmacy order.
         - Use \`delete_lab_order\` to permanently delete a lab order using its \`serialNumber\`. Only use this when the user explicitly asks to delete/remove a lab order.
    - **Vitals & Follow-ups:**
         - Use \`record_vitals\` to store structured patient vitals like BP, Pulse, Temperature, Weight, etc.
         - Use \`schedule_follow_up\` to set a specific date for the patient's next visit.
    - **Lab Reports & Results Entry:**
        - Always check \`labHistory\` for existing orders.
        - If an order exists for a test (e.g., serial number 3), use \`edit_lab_report\` with \`serialNumber: 3\` to enter results.
        - If no order exists, use \`create_lab_report\` to automatically create the order and submit the report in one step.
        - Provide results in the \`results\` array, specifying the \`testName\` and a dictionary of \`parameters\` (key-value pairs of parameter name and value).
        - You can see the required parameters and their normal ranges in the \`Available Lab Tests\` inventory list.
    - **Action Wrappers:** Your JSON array **MUST** start with \`{ "action": "first_action" }\` and end with \`{ "action": "last_action" }\`. Any response not following this structure will be **IGNORED** by the system.
    - **No Action Required / Loop Prevention:** If the user's input does not require any of the specific actions listed above (e.g., simple conversation, acknowledgement, or if you have already performed the necessary actions and are just responding), you **MUST** use the \`blank_action\`. This is CRITICAL to prevent the system from getting stuck in a loop waiting for an action. Never return an empty JSON array; if nothing else applies, return \`[{ "action": "first_action" }, { "action": "blank_action" }, { "action": "last_action" }]\`.
**3.**Multiple Actions:** You can perform multiple actions (like ordering labs AND meds, adding complaints, updating patient information, and asking a follow-up question) in a single response by including multiple action objects within the main JSON array.


**4. Chief Complaints (Co):**
   - Analyze the provided chief complaints.
   - Present them in a table with two columns: 'Relevant Complaint (Score 8-10)' and 'Irrelevant Complaint (Score 0-7)', based on clinical relevance.

**5. Lab Tests (Lx):**
   - Suggest the most probable basic lab tests based on the clinical picture, ordered by likelihood.
   - If a basic test is positive/abnormal, suggest relevant advanced tests.
   - **Inventory Check:** Compare suggested tests against the provided inventory list.
   - **Table 1: Available Lab Tests:** Present tests *available* in the inventory in a table with columns: '**Clinical Importance (High/Medium/Low)**', 'Lab Test'. If suggesting tests from this table, prepare to use the \`create_lab_order\` tool in your response.
   - **Table 2: Unavailable Lab Tests:** Present tests *not available* in the inventory in a separate table with columns: '**Clinical Importance (High/Medium/Low)**', 'Unavailable Basic Test'. Clearly state these are not orderable via the tool (generate Table 2 only when required tests are unavailable).

**6. Differential Diagnosis (Dx):**
   - List potential differential diagnoses.
   - Provide a confidence score (0-10) for each.
   - Present in a table with columns: 'Differential Diagnosis' and 'Confidence Score (0-10)'.

**7. Treatment Plan (Tx):**
   - Create a structured treatment plan including ideal medications based on the diagnosis.
   - **Inventory Check:** Compare prescribed medications against the provided inventory list.
   - **Table 1: Available Medications:** Present medications *available* in the inventory in a table with columns: 'Time Frame' (from and to dates), 'Treatment Goal', 'Intervention', 'Medication Type', 'Drug Form', 'Drug Name', 'Regimen (Dose, Freq)', 'Duration'. Before using the \`create_pharmacy_order\` tool, check if an order for the same drug already exists with status \`pending\` or \`billing_pending\`. If a pending order already exists for that drug, do *not* create a duplicate orderuse \`edit_pharmacy_order\` to modify the existing pending order if changes are needed. Only create a new order if the medication is NOT already in any pending order.
   - **Table 2: Unavailable Medications:** Present medications *not available* in the inventory in a separate table with columns: 'Unavailable Drug Name', 'Ideal Regimen', 'Reasoning/Indication', '**Clinical Importance (High/Medium/Low)**', 'Suggested Available Substitute (from inventory, if possible)'. Clearly state these are not orderable via the tool (generate Table 2 only when required medications are unavailable in the inventory).

**8. Tools / Actions:**
   When you need to perform actions like ordering tests/meds, updating patient info, or adding history, use the following JSON array format. The response should ONLY contain this JSON array, nothing else.

   ****STRICT JSON****>>>>>>\`\`\`json
[
  { "action": "first_action" },
  { "action": "create_pharmacy_order", "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "prescription_for_unavailable_drugs": "string | null" },
  { "action": "edit_pharmacy_order", "serialNumber": number, "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "items_to_remove": [ { "drug_id": number | null, "name": "Drug Name" } ], "status": "pending" | "billed" | "dispensed" | "cancelled", "prescription_for_unavailable_drugs": "string | null" },
  { "action": "create_lab_order", "tests": [ { "name": "Test Name" } ] },
  { "action": "edit_lab_order", "serialNumber": number, "tests": [ { "name": "Test Name" } ], "items_to_remove": [ { "id": number | string | null, "name": "Test Name" } ], "status": "pending" | "billed" | "collected" | "processing" | "report_ready" | "completed" | "cancelled" | "reported" },
  { "action": "create_lab_report", "tests": [ { "name": "Test Name" } ], "results": [ { "testName": "Test Name", "parameters": { "ParamName": value } } ] },
  { "action": "edit_lab_report", "serialNumber": number, "results": [ { "testName": "Test Name", "parameters": { "ParamName": value } } ] },
  { "action": "add_complaint_history", "complaint": "Specific past complaint text..." },
  { "action": "edit_complaint", "serialNumber": number, "new_complaint": "Updated text...", "delete": boolean (optional) },
  { "action": "update_patient_details", "name": "New Name (optional)", "age": number (optional), "gender": "M" | "F" | "O" | null (optional), "phone_number": "string (optional)" },
   { "action": "update_case_summary", "summary": "Concise summary text..." },
  { "action": "update_clinic_ai_memory", "memory_content": "New clinic-wide AI memory content..." },
  { "action": "update_patient_status", "status": "admit" | "discharge" | "add_to_doctor_queue" | "complete_consultation" },
  { "action": "create_recurring_medication", "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "frequency_days": number, "next_delivery_date": "YYYY-MM-DD" },
  { "action": "edit_recurring_medication", "serialNumber": number, "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "items_to_remove": [ { "drug_id": number | null, "name": "Drug Name" } ], "status": "active" | "paused" | "cancelled", "frequency_days": number, "next_delivery_date": "YYYY-MM-DD" },
   { "action": "delete_recurring_medication", "serialNumber": number },
   { "action": "delete_pharmacy_order", "serialNumber": number },
   { "action": "delete_lab_order", "serialNumber": number },
   { "action": "record_vitals", "BP": "string (e.g., 120/80)", "Pulse": number, "Temp": "string (e.g., 98.6F)", "Weight": "string (e.g., 70kg)", "Other": "string (additional vitals)" },
   { "action": "schedule_follow_up", "date": "YYYY-MM-DD" },
  { "action": "end_loop" }, /* NEVER send this in the same array as other actions. Wait for the system feedback saying "Action successful" in the NEXT turn, then send ONLY [first_action, end_loop, last_action]. */
  { "action": "blank_action" },
  { "action": "last_action" }
]
\`\`\`

   - **Autolooping & End Loop:** This system supports "Autolooping". You can perform actions, get results, and then decide to perform MORE actions based on those results.
     - When you are finished with the entire user request and no further actions are needed, you **MUST** use the \`end_loop\` action.
     - If you just want to talk (no actions), you can use \`blank_action\` or just \`end_loop\` immediately if no further processing is needed. But prefers \`end_loop\` to signal explicit completion.
     - **Do not stop** until the task is fully complete.
   - **Multiple Actions in One Response:** You can include multiple action objects within this single JSON array if several actions are required based on your analysis (e.g., adding history AND ordering labs).
   - **Prioritization Within the Array:** If including multiple actions, order them within the array according to this priority:
     1. \`add_complaint_history\`
     2. \`update_patient_details\`
     3. \`update_case_summary\`
      4. \`update_clinic_ai_memory\`
      5. \`update_patient_status\`
      6. \`create_lab_order\`
      7. \`edit_lab_order\`
       8. \`create_pharmacy_order\`
       9. \`edit_pharmacy_order\`
       10. \`record_vitals\`
       11. \`schedule_follow_up\`
   - **Example (Multiple Actions):**
     \`\`\`json
     [
       { "action": "add_complaint_history", "complaint": "Patient also reports mild fever since yesterday." },
       { "action": "create_lab_order", "tests": [ { "name": "CBC" } ] }
     ]
     \`\`\`

   - **\`ask_followup_question\`**: Use this tool format inside the standard JSON array with wrappers.
     \`\`\`json
[
  { "action": "first_action" },
  {
    "action": "ask_followup_question",
    "question": "Your clear, specific question here.",
    "options": ["Optional Answer 1", "Optional Answer 2"] // Optional
  },
  { "action": "last_action" }
]
     \`\`\`
     *Description:* Ask the user a question to gather additional information needed to complete the task. This tool should be used when you encounter ambiguities, need clarification, or require more details to proceed effectively. It allows for interactive problem-solving by enabling direct communication with the user. Use this tool judiciously to maintain a balance between gathering necessary information and avoiding excessive back-and-forth.
     *Parameters:*
       - question: (required) The question to ask the user. This should be a clear, specific question that addresses the information you need.
       - options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible answer. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually.


**Important:**
- Ensure all tables are clearly formatted using Markdown.
- Strictly adhere to the inventory constraints for labs and medications when deciding whether to use \`create_lab_order\` or \`create_pharmacy_order\`.
- When using actions, provide ONLY the JSON array (or the single JSON object for \`ask_followup_question\`) as the *very last* part of your response, after all other content including tables. Do not include any other text after the JSON.

**Plan Mode:**
When the user asks a question about a patient's condition or general medical topics (not entering new medical data), respond in PLAN MODE. In this mode, focus on answering the user's inquiry, clarifying their request, brainstorming ideas, or architecting a solution (like exploring treatment options). Ask clarifying questions if needed. Present detailed plans or explanations **using clear table formats and markdown (like bolding) for easy readability**. Engage in back-and-back discussion to finalize details. Do not use action tools (\`create_lab_order\`, \`create_pharmacy_order\`, \`add_complaint_history\`, \`update_patient_details\`) while in PLAN MODE).`,vQ="gemini-3-flash-preview";async function wQ(){const e=nh();if(!e)throw new Error("Authentication token not found. Please log in.");try{const r=(await(await ce("/api/clinics/settings",{headers:{Authorization:`Bearer ${e}`}})).json()).gemini_api_key;if(r)return console.log("Using clinic-specific Gemini API key."),r}catch(n){console.warn("Failed to fetch clinic-specific Gemini API key, trying global fallback.",n)}try{const r=(await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${e}`}})).json()).gemini_api_key;if(r)return console.log("Using global Gemini API key."),r}catch(n){console.warn("Failed to fetch global Gemini API key.",n)}throw new Error("Gemini API key not found. Please contact your administrator.")}let L0=null;async function NQ(){if(!L0){const e=await wQ();L0=new Sg({apiKey:e})}return L0}async function SQ(e,n){const{query:t,currentDateTime:r,patientName:a,patientAge:o,patientGender:l,case_summary:h,case_summary_last_updated:d,clinic_ai_memory:u,clinic_ai_memory_last_updated:f,clinic_wide_system_prompt:g,labHistory:b,pharmacyOrders:v,pastComplaints:S,recurringMedications:T,pharmacyInventory:E,labInventory:C,patientStatus:P,isAdmitted:I,isInQueueToday:q,admissionDate:L,dischargeDate:O,vitals:B,nextFollowUp:$}=e;let F=`Patient Complaint: ${t}`;if(h&&(F+=`

--- Case Summary (Provided by Doctor) ---
${h}`,d))try{const re=new Date(d).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});F+=`
(Last Updated: ${re})`}catch{console.warn(`Could not format case_summary_last_updated: ${d}`),F+=`
(Last Updated: ${d})`}if(a&&(F+=`

Patient Name: ${a}`),o!=null&&(F+=`
Patient Age: ${o}`),l&&(F+=`
Patient Gender: ${l}`),P&&(F+=`
Patient Current Status: ${P}`),F+=`
Patient Admitted: ${I?"Yes":"No"}`,L&&(F+=`
Admission Date: ${L}`),O&&(F+=`
Discharge Date: ${O}`),F+=`
In Doctor Queue Today: ${q?"Yes":"No"}`,B&&typeof B=="object"&&(F+=`

--- Current Vitals ---
`,Object.entries(B).forEach(([re,A])=>{F+=`${re}: ${A}
`})),$)try{const re=new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});F+=`
Next Follow-up Scheduled: ${re}`}catch{F+=`
Next Follow-up Scheduled: ${$}`}if(r)try{const re=new Date(r).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});F+=`

Current Interaction Time: ${re}`}catch{console.warn(`Could not format currentDateTime: ${r}`),F+=`

Current Interaction Time: ${r}`}if(u&&(F+=`

--- Clinic-wide AI Memory/Context ---
${u}`,f))try{const re=new Date(f).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});F+=`
(Last Updated: ${re})`}catch{console.warn(`Could not format clinic_ai_memory_last_updated: ${f}`),F+=`
(Last Updated: ${f})`}let z="";b&&Array.isArray(b)&&b.length>0&&(z=`

--- Lab History (Orders & Reports) ---
`,b.forEach(re=>{let A="Unknown Date";try{A=new Date(re.orderDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab order: ${re.orderDate}`)}if(z+=`
Order #${re.serialNumber} Date: ${A} (Status: ${re.status})
`,z+=`Tests: ${re.tests.map(te=>te.name).join(", ")}
`,re.report){let te="Unknown Date";try{te=new Date(re.report.reportDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab report: ${re.report.reportDate}`)}z+=`  -> Report Date: ${te}
`,re.report.tests&&Array.isArray(re.report.tests)?(z+=`     Findings:
`,re.report.tests.forEach(xe=>{z+=`       - Test: ${xe.testName}
`,xe.parameters&&Array.isArray(xe.parameters)&&xe.parameters.forEach(M=>{z+=`         - ${M.name}: ${M.value} (Normal: ${M.normal_range})
`})})):(z+=`     Findings: ${re.report.reportContent||"N/A"}
`,re.report.error&&(z+=`     Note: ${re.report.error}
`))}z+=`---
`}),F+=z);let U="";v&&Array.isArray(v)&&v.length>0&&(U=`

--- Recent Pharmacy Orders ---
`,U+=`(Note: 'pending'/'billing_pending' = medication NOT yet given to patient; 'billed'/'dispensed' = medication given to patient)
`,v.forEach(re=>{let A="Unknown Date/Time";try{A=new Date(re.date).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for pharmacy order: ${re.date}`)}const te=(re.status||"").toLowerCase(),M=te==="pending"||te==="billing_pending"?" [MEDICATION NOT YET GIVEN TO PATIENT - DO NOT CREATE DUPLICATE ORDER FOR THESE MEDS]":" [Medication already dispensed]";U+=`
Order #${re.serialNumber} Date/Time: ${A} (Status: ${re.status})${M}
`,U+=`Prescribed By: ${re.prescribedBy||"N/A"}
`,re.dispensedBy&&(U+=`Dispensed By: ${re.dispensedBy}
`),U+=`Medications:
`,re.medications.forEach(Se=>{U+=`  - ${Se.name} (Qty: ${Se.quantity}`,Se.tabletsPerDay&&(U+=`, ${Se.tabletsPerDay}/day`),Se.numberOfDays&&(U+=` for ${Se.numberOfDays} days`),U+=`)
`}),re.prescriptionForUnavailableDrugs&&(U+=`  Prescription for Unavailable Drugs: ${re.prescriptionForUnavailableDrugs}
`),U+=`---
`}),F+=U);let V="";S&&Array.isArray(S)&&S.length>0&&(V=`

--- Past Complaints History ---
`,S.forEach(re=>{let A="Unknown Date/Time";try{A=new Date(re.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for past complaint: ${re.createdAt}`)}V+=`
Id: ${re.serialNumber}
Date/Time: ${A}
Complaint: ${re.complaint||"N/A"}
---
`}),F+=V);let ee="";T&&Array.isArray(T)&&T.length>0&&(ee=`

--- Recurring Medications ---
`,[...T].sort((A,te)=>new Date(A.next_delivery_date).getTime()-new Date(te.next_delivery_date).getTime()).forEach((A,te)=>{var xe;ee+=`
#${te+1} Status: ${A.status}, Freq: ${A.frequency_days} days, Next: ${A.next_delivery_date}
`,(xe=A.medications)==null||xe.forEach(M=>{ee+=`  - ${M.name} (Qty: ${M.pack_quantity||0}P / ${M.loose_quantity||0}L, ${M.tabletsPerDay}/day for ${M.numberOfDays} days)
`}),ee+=`---
`}),F+=ee);let ie="";E&&Array.isArray(E)&&E.length>0&&(ie=`

--- Current Pharmacy Inventory (Stock Levels) ---
`,E.forEach(re=>{ie+=`- ${re.name} (Pack: ${re.unit??"N/A"}): ${re.quantity_in_stock??"N/A"}
`}),F+=ie);let ae="";C&&Array.isArray(C)&&C.length>0&&(ae=`

--- Available Lab Tests & Parameters (Use these for reports) ---
`,C.forEach(re=>{ae+=`- ${re.name} (Price: ${re.price??"N/A"})
`,re.default_parameters&&Array.isArray(re.default_parameters)&&re.default_parameters.forEach(A=>{let te="N/A";A.lower_limit!=null||A.upper_limit!=null?(te="",A.lower_limit!=null&&(te+=`> ${A.lower_limit}`),A.lower_limit!=null&&A.upper_limit!=null&&(te+=" - "),A.upper_limit!=null&&(te+=`< ${A.upper_limit}`),te=te.trim()):A.normal_range&&(te=A.normal_range),ae+=`  * ${A.name} (${A.unit||"unitless"}): [Normal Range: ${te}]
`})}),F+=ae);const J=[{text:bQ}];g&&g.trim()!==""&&J.push({text:`--- Additional Clinic-Specific Instructions ---
${g}`});const K=[{text:F}];if(n){const re=new FileReader,A=await new Promise((te,xe)=>{re.onloadend=()=>{typeof re.result=="string"?te(re.result.split(",")[1]):xe(new Error("Failed to read image file as base64."))},re.onerror=xe,re.readAsDataURL(n)});K.push({inlineData:{mimeType:n.type,data:A}})}const W=[];J.length>0&&W.push({role:"user",parts:J}),W.push({role:"user",parts:K});try{const re={model:vQ,contents:W,generationConfig:{temperature:.7,maxOutputTokens:1024,responseMimeType:"text/plain"}},te=await(await NQ()).models.generateContentStream(re);let xe="";for await(const M of te)if(M&&typeof M.text=="function"){const Se=M.text;Se&&(xe+=Se)}else M&&M.candidates&&M.candidates[0]&&M.candidates[0].content&&M.candidates[0].content.parts&&M.candidates[0].content.parts[0]&&M.candidates[0].content.parts[0].text&&(xe+=M.candidates[0].content.parts[0].text);if(xe&&xe.trim()!=="")return xe.trim();throw console.error("Empty or invalid response received from Gemini API stream."),new Error("Failed to get suggestion from AI (Gemini). Empty or invalid stream response.")}catch(re){console.error("Error calling Gemini API:",re);let A="Failed to get suggestion from Gemini.";throw re.message&&(A=`Error processing Gemini request: ${re.message}`),new Error(A)}}const S_=3,F0=e=>{if(!e)return 1;const n=e.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return n?parseInt(n[1],10):1},jQ=(e,n,t,r="non-black")=>{if(isNaN(e)||isNaN(n)||e<=0||n<=0)return null;let a;return t==="female"?e<=.7?a=141*Math.pow(e/.7,-.329)*Math.pow(.993,n):a=141*Math.pow(e/.7,-1.209)*Math.pow(.993,n):e<=.9?a=141*Math.pow(e/.9,-.411)*Math.pow(.993,n):a=141*Math.pow(e/.9,-1.209)*Math.pow(.993,n),r==="black"&&(a*=1.018),parseFloat(a.toFixed(2))},_Q=(e,n,t)=>isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0||t>=400?null:parseFloat((e-n-t/5).toFixed(2)),CQ=(e,n)=>isNaN(e)||isNaN(n)||e<0||n<0?null:parseFloat((e-n).toFixed(2)),kQ=(e,n)=>isNaN(e)||isNaN(n)||e<0||n<0?null:parseFloat((e-n).toFixed(2)),TQ=(e,n,t)=>isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0?null:parseFloat((e-(n+t)).toFixed(2)),EQ=(e,n,t)=>isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0?null:parseFloat((2*e+n/18+t/2.8).toFixed(2)),j_=(e,n,t)=>{const r={...e},a=parseFloat(r.Creatinine);if(!isNaN(a)&&n!==null&&t!==null){const C=jQ(a,n,t);C!==null&&(r.eGFR=C)}const o=parseFloat(r["Total Cholesterol"]),l=parseFloat(r["HDL Cholesterol"]),h=parseFloat(r.Triglycerides);if(!isNaN(o)&&!isNaN(l)&&!isNaN(h)){const C=_Q(o,l,h);C!==null&&(r["LDL Cholesterol"]=C)}const d=parseFloat(r["Total Bilirubin"]),u=parseFloat(r["Direct Bilirubin"]);if(!isNaN(d)&&!isNaN(u)){const C=CQ(d,u);C!==null&&(r["Indirect Bilirubin"]=C)}const f=parseFloat(r["Total Protein"]),g=parseFloat(r.Albumin);if(!isNaN(f)&&!isNaN(g)){const C=kQ(f,g);C!==null&&(r.Globulin=C)}const b=parseFloat(r.Sodium),v=parseFloat(r.Chloride),S=parseFloat(r.Bicarbonate);if(!isNaN(b)&&!isNaN(v)&&!isNaN(S)){const C=TQ(b,v,S);C!==null&&(r["Anion Gap"]=C)}const T=parseFloat(r.Glucose),E=parseFloat(r.BUN);if(!isNaN(b)&&!isNaN(T)&&!isNaN(E)){const C=EQ(b,T,E);C!==null&&(r.Osmolality=C)}return r},AQ=w.forwardRef((e,n)=>{const{recordId:t,patientId:r,patientDetails:a,caseSummary:o,clinicSettings:l,selectedImageFile:h,pendingLabOrders:d,labReports:u,pharmacyOrders:f,recurringMedications:g,pharmacyInventory:b,labInventory:v,setAiResponse:S,setAiResponseText:T,setAiResponseJsonString:E,setShowAiJsonDetails:C,setIsLoadingAi:P,setCaseSummary:I,setCaseSummaryUpdatedAt:q,setFollowUpQuestion:L,setFollowUpOptions:O,setError:B,setIsSavingAiResponse:$,setSaveAiResponseError:F,fetchPharmacyOrdersData:z,fetchPendingLabOrdersData:U,fetchLabReportsData:V,fetchPastComplaintsData:ee,fetchRecurringMedicationsData:ie,fetchPatientDetails:ae,setClinicSettings:J,setEditedAiMemory:K,handleDeleteItem:W,handleAdmitDischargePatient:re,handleCompleteConsultation:A,handleAddToQueue:te,setCanUndoAi:xe,addMessageToHistory:M,clearConversationHistory:Se,pastComplaints:$e,triggerGlow:he}=e,[ge,me]=Fn.useState([]),de=Fn.useRef(e);Fn.useEffect(()=>{de.current=e});let Le;const He=async(je,Qe,ze,dt=0,Ze=0)=>{let ct;const fe=["AI response did not contain a recognized function call","AI response did not result in a recognized or performed function call"].some(Q=>{var ue;return(ue=Qe.message)==null?void 0:ue.includes(Q)});ze&&fe?ct=`AI Error: ${Qe.message}

${ze}`:(ct=`I encountered a frontend error while trying to execute the '${je}' function. The error message is: "${Qe.message}". Based on this error, please analyze what went wrong and either correct the function call and try again, or explain the problem.`,(je==="create_pharmacy_order"||je==="edit_pharmacy_order")&&(ct+=`

IMPORTANT: When ordering medication, please first check if the medication ordered matches the exact name given in the inventory. If the name itself is not given in the inventory, you can also use 'prescription_for_unavailable_drugs' to write a prescription for unavailable drugs.`),ze&&(ct+=`

The original AI response that caused the error was:
\`\`\`
${ze}
\`\`\``)),await Le(ct,dt+1,Ze)},pe=async(je,Qe,ze,dt)=>{var Ge;let Ze=!1,ct=!0;const ft=[];let fe=null;if(je.some(ye=>ye.action==="end_loop")&&(ct=!1,Se&&Se(),je=je.filter(ye=>ye.action!=="end_loop"),je.length===0))return{success:!0,shouldContinueLoop:!1};for(const ye of je){if(ye.action==="first_action"||ye.action==="last_action"){Ze=!0,ft.push(Promise.resolve({action:ye.action,success:!0}));continue}if(ye.action==="ask_followup_question"){fe=ye,Ze=!0,ct=!1,ft.push(Promise.resolve({action:"ask_followup_question",success:!0,resultSummary:`Asked follow-up question: "${ye.question}"`}));continue}ye.action==="update_clinic_ai_memory"&&typeof ye.memory_content=="string"?(Ze=!0,ft.push((async()=>{try{if(!l)throw new Error("Clinic settings not loaded, cannot update AI memory.");const Ne={...l,aiMemory:ye.memory_content.trim(),admissionCharge:l.admissionCharge,perDayCharge:l.perDayCharge,otherCharges:l.otherCharges,clinicWideSystemPrompt:l.clinicWideSystemPrompt},Me=await ce("/api/clinics/settings",{method:"PUT",body:JSON.stringify(Ne)});if(!Me.ok){const ve=await Me.json().catch(()=>({}));throw new Error(ve.message||`AI-triggered clinic memory update failed: ${Me.statusText}`)}const Fe=await Me.json();return J({admissionCharge:parseFloat(Fe.settings.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(Fe.settings.perDayCharge||0).toFixed(2),otherCharges:parseFloat(Fe.settings.otherCharges||0).toFixed(2),aiMemory:Fe.settings.aiMemory||"",aiMemoryUpdatedAt:Fe.settings.aiMemoryUpdatedAt||null,clinicWideSystemPrompt:Fe.settings.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:Fe.settings.clinicWideSystemPromptUpdatedAt||null}),K(Fe.settings.aiMemory||""),{action:"update_clinic_ai_memory",success:!0,resultSummary:"Clinic AI memory updated."}}finally{}})())):ye.action==="create_pharmacy_order"&&(Array.isArray(ye.items)||ye.prescription_for_unavailable_drugs&&ye.prescription_for_unavailable_drugs.trim()!=="")?(Ze=!0,ft.push((async()=>{var Ne;try{if(!r)throw new Error("Missing patient ID for pharmacy order.");const Me=[];let Fe=null;if(Array.isArray(ye.items))for(const Ke of ye.items){const{pack_price:vt,loose_price:wt,total_price:nt,price:bt,...Mt}=Ke;let tt;if(Mt.drug_id?tt=b.find(mt=>mt.id===Mt.drug_id):Mt.name&&(tt=Jd(Mt.name,b)),!tt){Fe=`Drug "${Mt.name||Mt.drug_id||"Unknown"}" not found or no close match.`;break}let Nt;const Lt=Mt.tabletsPerDay;if(Lt&&Number(Lt)>0){const mt=Number(Lt);Number.isInteger(mt)?Nt=mt:Nt=null}else Nt=1;const pn=Number(Mt.numberOfDays)||1,Kt=Number(Mt.pack_quantity)||0,ln=Number(Mt.loose_quantity)||0;if(Kt<=0&&ln<=0){Fe=`Invalid quantity for ${tt.name}. Pack quantity or loose quantity must be greater than 0.`;break}const Dt=tt.unit,mn=F0(Dt),Dn=Number(tt.price),ii=Dn,Ie=mn>0?Dn/mn:0,pt=Kt*ii+ln*Ie;Me.push({drug_id:tt.id?String(tt.id):null,name:tt.name,pack_quantity:Kt,loose_quantity:ln,tabletsPerDay:Nt,numberOfDays:pn,price:Dn,directions_to_use:Mt.directions_to_use||void 0,box_number:Mt.box_number||void 0,isLoose:Mt.isLoose||void 0,unit:Dt||void 0,pack_price:parseFloat(ii.toFixed(2)),loose_price:parseFloat(Ie.toFixed(2)),total_price:parseFloat(pt.toFixed(2))})}if(Fe)throw new Error(Fe);const ve=Me.reduce((Ke,vt)=>Ke+vt.total_price,0),ke={patient_id:r,items:Me.map(({drug_id:Ke,name:vt,pack_quantity:wt,loose_quantity:nt,tabletsPerDay:bt,numberOfDays:Mt,directions_to_use:tt,box_number:Nt,isLoose:Lt,unit:pn,pack_price:Kt,loose_price:ln,total_price:Dt})=>({drug_id:Ke,name:vt,pack_quantity:wt,loose_quantity:nt,tabletsPerDay:bt,numberOfDays:Mt,directions_to_use:tt,box_number:Nt,isLoose:Lt,unit:pn,pack_price:Kt,loose_price:ln,total_price:Dt})),prescription_for_unavailable_drugs:ye.prescription_for_unavailable_drugs||null,order_total:parseFloat(ve.toFixed(2))},Ee=await ce("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ke)});if(!Ee.ok){const Ke=await Ee.json().catch(()=>({}));throw new Error(Ke.message||`AI order creation failed: ${Ee.statusText}`)}const Ve=await Ee.json();return r&&await z(r),he==null||he("pharmacy"),{action:"create_pharmacy_order",success:!0,resultSummary:`Created Pharmacy Order: ${(Ne=Ve.medications)==null?void 0:Ne.map(Ke=>`${Ke.name} (${Ke.pack_quantity||0}p, ${Ke.loose_quantity||0}l)`).join(", ")}.`,undo:async()=>{console.log(`Rolling back pharmacy order ${Ve.id}`),await ce(`/api/pharmacy-orders/${Ve.id}`,{method:"DELETE"}),r&&await z(r)}}}finally{}})())):ye.action==="update_patient_details"?(Ze=!0,ft.push((async()=>{P(!0),B(null);try{if(!r)throw new Error("Missing patient ID for updating details.");const Ne={...a},Me={};let Fe=!1;if(ye.name!==void 0&&typeof ye.name=="string"&&(Me.name=ye.name,Fe=!0),ye.age!==void 0&&typeof ye.age=="number"&&(Me.age=ye.age,Fe=!0),ye.gender!==void 0&&typeof ye.gender=="string"){if(!["M","F","O",null,""].includes(ye.gender))throw new Error(`Invalid gender specified: "${ye.gender}". Use M, F, or O.`);Me.gender=ye.gender===""?null:ye.gender,Fe=!0}if(ye.phone_number!==void 0&&(typeof ye.phone_number=="string"||ye.phone_number===null)&&(Me.phone_number=ye.phone_number,Fe=!0),!Fe)throw new Error("No valid patient details provided for update.");const ve=await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)});if(!ve.ok){const ke=await ve.json().catch(()=>({}));throw new Error(ke.message||`AI patient update failed: ${ve.statusText}`)}return ae(r),he==null||he("header"),{action:"update_patient_details",success:!0,resultSummary:`Updated patient details: ${Object.keys(Me).join(", ")}.`,undo:async()=>{console.log(`Reverting patient details for ${r}`);const ke={};Me.name!==void 0&&(ke.name=Ne.name),Me.age!==void 0&&(ke.age=Ne.age),Me.gender!==void 0&&(ke.gender=Ne.gender),Me.phone_number!==void 0&&(ke.phone_number=Ne.phone||null),await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ke)}),ae(r)}}}catch(Ne){return{action:"update_patient_details",success:!1,error:Ne}}finally{P(!1)}})())):ye.action==="create_lab_order"&&Array.isArray(ye.tests)&&ye.tests.length>0?(Ze=!0,ft.push((async()=>{try{if(!r)throw new Error("Missing patient ID for lab order.");const Ne=[];let Me=null;for(const Ve of ye.tests){let Ke;if(Ve.id?Ke=v.find(wt=>String(wt.id)===String(Ve.id)):Ve.name&&(Ke=Jd(Ve.name,v)),!Ke){Me=`Lab test "${Ve.name||Ve.id||"Unknown"}" not found or no close match.`;break}const vt=typeof Ke.price=="string"?parseFloat(Ke.price):Ke.price;Ne.push({id:Ke.id,name:Ke.name,price:vt,description:Ke.description,default_parameters:Ke.default_parameters})}if(Me)throw new Error(Me);const Fe={patient_id:r,tests:Ne.map(Ve=>({id:Ve.id,name:Ve.name,price:Ve.price}))},ve=await ce("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)});if(!ve.ok){const Ve=await ve.json().catch(()=>({}));throw new Error(Ve.message||`AI lab order creation failed: ${ve.statusText}`)}const ke=await ve.json(),Ee=ke.labOrder?ke.labOrder.id:ke.id;return r&&await U(r),he==null||he("lab"),{action:"create_lab_order",success:!0,resultSummary:`Created Lab Order: ${Ne.map(Ve=>Ve.name).join(", ")}.`,undo:async()=>{console.log(`Rolling back lab order ${Ee}`),Ee?(await ce(`/api/lab/orders/${Ee}`,{method:"DELETE"}),r&&await U(r)):console.error("Cannot rollback lab order: ID is missing.")}}}finally{}})())):ye.action==="edit_pharmacy_order"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber;let Me;if(Ne?Me=[...f].sort((wt,nt)=>{const bt=new Date(wt.date).getTime(),Mt=new Date(nt.date).getTime();return bt-Mt})[Ne-1]:Me=f.sort((vt,wt)=>new Date(vt.date).getTime()-new Date(wt.date).getTime()).find(vt=>vt.status==="pending"),!Me)throw Ne?new Error(`Pharmacy order with serial number ${Ne} not found.`):new Error("No pending pharmacy orders found to edit.");const Fe=JSON.parse(JSON.stringify(Me)),ve=Me.id,ke=ye.items,Ee=ye.items_to_remove,Ve=ye.status,Ke=ye.prescription_for_unavailable_drugs;if((!ke||Array.isArray(ke)&&ke.length===0)&&!Ee&&!Ve&&(!Ke||Ke.trim()===""))throw new Error("No items, items to remove, status, or unavailable drugs prescription provided for pharmacy order edit.");if(Ve==="cancelled")return await W({type:"Pharmacy Order",data:Me}),{action:"edit_pharmacy_order",success:!0,undo:async()=>{console.warn("Cannot fully undo pharmacy order deletion yet. It requires re-creation.")}};{let vt=[...Me.medications];if(Array.isArray(Ee)&&Ee.length>0&&(vt=vt.filter(tt=>{const Nt=tt.name.toLowerCase().replace(/\s+/g," ").trim();return!Ee.some(Lt=>{if(Lt.drug_id&&String(tt.drug_id)===String(Lt.drug_id))return!0;if(Lt.name){const pn=Lt.name.toLowerCase().replace(/\s+/g," ").trim();return Nt===pn}return!1})})),Array.isArray(ke)&&ke.length>0)for(const tt of ke){const{pack_price:Nt,loose_price:Lt,total_price:pn,price:Kt,...ln}=tt;let Dt;if(ln.drug_id?Dt=b.find(Xt=>Xt.id===String(ln.drug_id)):ln.name&&(Dt=Jd(ln.name,b)),!Dt)throw new Error(`Drug "${ln.name||ln.drug_id||"Unknown"}" not found or no close match for update.`);let mn;const Dn=ln.tabletsPerDay;if(Dn&&Number(Dn)>0){const Xt=Number(Dn);Number.isInteger(Xt)?mn=Xt:mn=null}else mn=1;const ii=Number(ln.numberOfDays)||1,Ie=Number(ln.pack_quantity)||0,pt=Number(ln.loose_quantity)||0,mt=vt.findIndex(Xt=>Xt.drug_id&&Xt.drug_id===(Dt==null?void 0:Dt.id)||Xt.name.toLowerCase()===(Dt==null?void 0:Dt.name.toLowerCase()));if(Ie<=0&&pt<=0){mt!==-1&&vt.splice(mt,1);continue}const rn={drug_id:Dt.id?String(Dt.id):null,name:Dt.name,pack_quantity:Ie,loose_quantity:pt,tabletsPerDay:mn,numberOfDays:ii,price:Dt.price,directions_to_use:ln.directions_to_use||void 0,box_number:ln.box_number||void 0,isLoose:ln.isLoose||void 0,unit:Dt.unit||void 0};mt!==-1?vt[mt]={...vt[mt],...rn}:vt.push(rn)}const wt=vt.map(tt=>{const Nt=b.find(mn=>mn.id===tt.drug_id),Lt=Nt?F0(Nt.unit):1,pn=Number(Nt==null?void 0:Nt.price)||0,Kt=pn,ln=Lt>0?pn/Lt:0,Dt=(tt.pack_quantity||0)*Kt+(tt.loose_quantity||0)*ln;return{...tt,pack_price:parseFloat(Kt.toFixed(2)),loose_price:parseFloat(ln.toFixed(2)),total_price:parseFloat(Dt.toFixed(2))}}),nt=wt.reduce((tt,Nt)=>tt+Nt.total_price,0),bt={};if(wt.length>0?bt.items=wt.map(({drug_id:tt,name:Nt,pack_quantity:Lt,loose_quantity:pn,tabletsPerDay:Kt,numberOfDays:ln,directions_to_use:Dt,box_number:mn,isLoose:Dn,unit:ii,pack_price:Ie,loose_price:pt,total_price:mt})=>({drug_id:tt,name:Nt,pack_quantity:Lt,loose_quantity:pn,tabletsPerDay:Kt===null?null:Kt,numberOfDays:ln,directions_to_use:Dt,box_number:mn,isLoose:Dn,unit:ii,pack_price:Ie,loose_price:pt,total_price:mt})):ke&&ke.length>0&&(bt.items=[]),Ke!==void 0&&(bt.prescription_for_unavailable_drugs=Ke),bt.order_total=parseFloat(nt.toFixed(2)),Ve){if(!["pending","billed","dispensed","cancelled"].includes(Ve))throw new Error(`Invalid status for pharmacy order: ${Ve}.`);bt.status=Ve}const Mt=await ce(`/api/pharmacy-orders/${ve}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(bt)});if(!Mt.ok){const tt=await Mt.json().catch(()=>({}));throw new Error(tt.message||`AI pharmacy order edit failed: ${Mt.statusText}`)}return r&&z(r),he==null||he("pharmacy"),{action:"edit_pharmacy_order",success:!0,resultSummary:`Updated Pharmacy Order: ${Ve?`Status -> ${Ve}`:""} ${ke!=null&&ke.length?`Added/Updated: ${ke.map(tt=>tt.name).join(", ")}`:""} ${Ee!=null&&Ee.length?`Removed: ${Ee.map(tt=>tt.name||tt.drug_id).join(", ")}`:""}`.trim(),undo:async()=>{console.log(`Reverting pharmacy order ${ve}`);const tt={items:Fe.medications.map(Nt=>({drug_id:Nt.drug_id,name:Nt.name,pack_quantity:Nt.pack_quantity,loose_quantity:Nt.loose_quantity,tabletsPerDay:Nt.tabletsPerDay,numberOfDays:Nt.numberOfDays,directions_to_use:Nt.directions_to_use,box_number:Nt.box_number,isLoose:Nt.isLoose,unit:Nt.unit,pack_price:Nt.pack_price,loose_price:Nt.loose_price,total_price:Nt.total_price})),status:Fe.status,prescription_for_unavailable_drugs:Fe.prescription_for_unavailable_drugs,order_total:Fe.order_total};await ce(`/api/pharmacy-orders/${ve}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(tt)}),r&&await z(r)}}}}finally{}})())):ye.action==="edit_lab_order"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber;let Me;if(Ne){const Ke=new Map;(d??[]).forEach(bt=>{Ke.set(bt.id,{...bt})}),(u??[]).forEach(bt=>{Ke.has(bt.id)||Ke.set(bt.id,{id:bt.id,patient_id:bt.patient_id,tests:bt.tests,status:bt.status,createdAt:bt.createdAt,report:bt})});const vt=Array.from(Ke.values());vt.sort((bt,Mt)=>new Date(Mt.createdAt).getTime()-new Date(bt.createdAt).getTime());const wt=vt.length-Ne,nt=vt[wt];nt&&(Me=d.find(bt=>bt.id===nt.id))}if(Me||(Me=d.sort((Ke,vt)=>new Date(vt.createdAt).getTime()-new Date(Ke.createdAt).getTime()).find(Ke=>Ke.status==="pending")),!Me)throw new Error(`Lab order with serial number ${Ne} not found, or no pending order to edit.`);const Fe=JSON.parse(JSON.stringify(Me)),ve=Me.id,ke=ye.tests,Ee=ye.items_to_remove,Ve=ye.status;if(!ke&&!Ee&&!Ve)throw new Error("No tests, items to remove, or status provided for lab order edit.");if(Ve==="cancelled"){if(Me.report||u&&u.some(Ke=>Ke.id===Me.id))throw new Error("Cannot delete lab order with an associated report. Please delete the report first.");return await W({type:"Lab Order",data:Me}),{action:"edit_lab_order",success:!0,resultSummary:`Deleted Lab Order #${Ne||"?"}.`,undo:async()=>{console.warn("Cannot fully undo lab order deletion yet. It requires re-creation.")}}}else{let Ke=[...Me.tests];if(Array.isArray(Ee)&&Ee.length>0&&(Ke=Ke.filter(wt=>!Ee.some(nt=>!!(nt.id&&String(wt.id)===String(nt.id)||nt.name&&wt.name.toLowerCase()===nt.name.toLowerCase())))),Array.isArray(ke)&&ke.length>0)for(const wt of ke){let nt;if(wt.id?nt=v.find(Nt=>String(Nt.id)===String(wt.id)):wt.name&&(nt=Jd(wt.name,v)),!nt)throw new Error(`Lab test "${wt.name||wt.id||"Unknown"}" not found or no close match for update.`);const bt=typeof nt.price=="string"?parseFloat(nt.price):nt.price,Mt=Ke.findIndex(Nt=>Nt.id&&String(Nt.id)===String(nt==null?void 0:nt.id)||Nt.name.toLowerCase()===(nt==null?void 0:nt.name.toLowerCase())),tt={id:nt.id,name:nt.name,price:bt};Mt!==-1?Ke[Mt]={...Ke[Mt],...tt}:Ke.push(tt)}const vt=await ce(`/api/lab/orders/${ve}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tests:Ke,status:Ve||Me.status})});if(!vt.ok){const wt=await vt.json().catch(()=>({}));throw new Error(wt.message||`AI lab order edit failed: ${vt.statusText}`)}return r&&(U(r),V(r)),{action:"edit_lab_order",success:!0,resultSummary:`Updated Lab Order: ${Ve?`Status -> ${Ve}`:""} ${ke!=null&&ke.length?`Added: ${ke.map(wt=>wt.name||wt.id).join(", ")}`:""} ${Ee!=null&&Ee.length?`Removed: ${Ee.map(wt=>wt.name||wt.id).join(", ")}`:""}`.trim(),undo:async()=>{console.log(`Reverting lab order ${ve}`),await ce(`/api/lab/orders/${ve}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tests:Fe.tests,status:Fe.status})}),r&&(U(r),V(r))}}}}catch(Ne){return{action:"edit_lab_order",success:!1,error:Ne}}finally{}})())):ye.action==="edit_lab_report"?(Ze=!0,ft.push((async()=>{var Ne,Me;try{const Fe=ye.serialNumber;let ve;if(Fe){const Mt=[...d??[],...u??[]].sort((Lt,pn)=>new Date(pn.createdAt).getTime()-new Date(Lt.createdAt).getTime()),tt=Array.from(new Map(Mt.map(Lt=>[Lt.id,Lt])).values()),Nt=tt.length-Fe;ve=tt[Nt]}if(!ve)throw new Error(`Lab order/report with serial number ${Fe} not found.`);const ke=ve.id,Ee=ve.report_content||((Ne=ve.report)==null?void 0:Ne.report_content)||"{}",Ve=ye.results||[];let Ke={};try{Ke=JSON.parse(Ee)}catch{Ke={}}const vt=(a==null?void 0:a.gender)==="F"?"female":(a==null?void 0:a.gender)==="M"?"male":null,wt=(a==null?void 0:a.age)||null;for(const bt of Ve){let Mt=bt.testId;if(!Mt&&bt.testName){const Nt=(Me=ve.tests)==null?void 0:Me.find(Lt=>Lt.name.toLowerCase()===bt.testName.toLowerCase());Nt&&(Mt=Nt.id)}if(!Mt)throw new Error(`Could not identify testId for "${bt.testName||"Unknown test"}".`);Ke[Mt]||(Ke[Mt]={});let tt={...Ke[Mt],...bt.parameters||{}};tt=j_(tt,wt,vt),Ke[Mt]=tt}const nt=await ce(`/api/lab/${ke}/report`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(Ke)})});if(!nt.ok){const bt=await nt.json().catch(()=>({}));throw new Error(bt.message||`AI lab report edit failed: ${nt.statusText}`)}return r&&(U(r),V(r)),{action:"edit_lab_report",success:!0,resultSummary:`Updated Lab Report for ${Ve.map(bt=>bt.testName).join(", ")}.`,undo:async()=>{console.log(`Reverting lab report for order ${ke}`),await ce(`/api/lab/${ke}/report`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:Ee})}),r&&(U(r),V(r))}}}finally{}})())):ye.action==="create_lab_report"?(Ze=!0,ft.push((async()=>{let Ne=null;try{if(!r)throw new Error("Missing patient ID.");const Me=[];for(const wt of ye.tests||[]){let nt=wt.id?v.find(bt=>String(bt.id)===String(wt.id)):Jd(wt.name,v);if(!nt)throw new Error(`Lab test "${wt.name}" not found.`);Me.push({id:nt.id,name:nt.name,price:nt.price})}const Fe=await ce("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:r,tests:Me})});if(!Fe.ok)throw new Error("Failed to create lab order.");const ve=await Fe.json();Ne=ve.labOrder?ve.labOrder.id:ve.id;const ke=ye.results||[],Ee={},Ve=(a==null?void 0:a.gender)==="F"?"female":(a==null?void 0:a.gender)==="M"?"male":null,Ke=(a==null?void 0:a.age)||null;for(const wt of ke){let nt=wt.testId;if(!nt&&wt.testName){const bt=Me.find(Mt=>Mt.name.toLowerCase()===wt.testName.toLowerCase());bt&&(nt=bt.id)}if(nt){let bt=wt.parameters||{};bt=j_(bt,Ke,Ve),Ee[nt]=bt}}if(!(await ce(`/api/lab/${Ne}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(Ee)})})).ok)throw new Error("Failed to submit report content.");return r&&(U(r),V(r)),{action:"create_lab_report",success:!0,resultSummary:`Created Lab Order & Report: ${Me.map(wt=>wt.name).join(", ")}.`,undo:async()=>{Ne&&(await ce(`/api/lab/orders/${Ne}`,{method:"DELETE"}),r&&(U(r),V(r)))}}}finally{}})())):ye.action==="create_recurring_medication"&&(Array.isArray(ye.items)||ye.prescription_for_unavailable_drugs&&ye.prescription_for_unavailable_drugs.trim()!=="")?(Ze=!0,ft.push((async()=>{try{if(!r)throw new Error("Missing patient ID for recurring medication.");const Ne=[];let Me=null;if(Array.isArray(ye.items))for(const Ee of ye.items){let Ve=Ye(Ee,b);if(!Ve){Me=`Drug "${Ee.name||Ee.drug_id}" not found.`;break}const{pack_quantity:Ke,loose_quantity:vt,tabletsPerDay:wt,numberOfDays:nt,pack_price:bt,loose_price:Mt,total_price:tt}=rt(Ee,Ve);Ne.push({drug_id:Ve.id,name:Ve.name,pack_quantity:Ke,loose_quantity:vt,tabletsPerDay:wt,numberOfDays:nt,price:Ve.price,directions_to_use:Ee.directions_to_use,unit:Ve.unit,pack_price:bt,loose_price:Mt,total_price:tt})}if(Me)throw new Error(Me);const Fe={patient_id:r,medications:Ne,frequency_days:ye.frequency_days||30,next_delivery_date:ye.next_delivery_date||new Date(Date.now()+30*24*60*60*1e3).toISOString().split("T")[0],status:"active"},ve=await ce("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)});if(!ve.ok){const Ee=await ve.json().catch(()=>({}));throw new Error(Ee.message||`AI recurring medication creation failed: ${ve.statusText}`)}const ke=await ve.json();return r&&await ie(r),{action:"create_recurring_medication",success:!0,resultSummary:`Created Recurring Medication: ${Ne.map(Ee=>Ee.name).join(", ")}.`,undo:async()=>{console.log(`Rolling back recurring medication ${ke.id}`),await ce(`/api/recurring-medications/${ke.id}`,{method:"DELETE"}),r&&await ie(r)}}}finally{}})())):ye.action==="edit_recurring_medication"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber,Me=ye.id;let Fe;if(Me?Fe=g.find(wt=>wt.id===Me):Ne&&(Fe=[...g].sort((nt,bt)=>new Date(nt.next_delivery_date).getTime()-new Date(bt.next_delivery_date).getTime())[Ne-1]),!Fe)throw new Error(`Recurring medication with serial number ${Ne} not found.`);const ve=JSON.parse(JSON.stringify(Fe)),ke=ye.items_to_remove,Ee=ye.items;(ye.status==="stopped"||ye.status==="active")&&(Fe.status=ye.status);let Ve=[...Fe.medications];if(Array.isArray(ke)&&ke.length>0&&(Ve=Ve.filter(wt=>{const nt=wt.name.toLowerCase().trim();return!ke.some(bt=>!!(bt.drug_id&&String(wt.drug_id)===String(bt.drug_id)||bt.name&&bt.name.toLowerCase().trim()===nt))})),Array.isArray(Ee)&&Ee.length>0)for(const wt of Ee){let nt=Ye(wt,b);if(!nt)throw new Error(`Drug "${wt.name}" not found.`);const bt=rt(wt,nt),Mt={drug_id:nt.id,name:nt.name,...bt,directions_to_use:wt.directions_to_use,unit:nt.unit},tt=Ve.findIndex(Nt=>Nt.drug_id===(nt==null?void 0:nt.id));tt!==-1?Ve[tt]={...Ve[tt],...Mt}:Ve.push(Mt)}const Ke={medications:Ve,status:Fe.status,frequency_days:ye.frequency_days||Fe.frequency_days,next_delivery_date:ye.next_delivery_date||Fe.next_delivery_date},vt=await ce(`/api/recurring-medications/${Fe.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ke)});if(!vt.ok){const wt=await vt.json().catch(()=>({}));throw new Error(wt.message||`AI recurring med edit failed: ${vt.statusText}`)}return r&&await ie(r),{action:"edit_recurring_medication",success:!0,resultSummary:`Updated Recurring Medication: ${Ee!=null&&Ee.length?`Added/Updated: ${Ee.map(wt=>wt.name).join(", ")}`:""} ${ke!=null&&ke.length?`Removed: ${ke.map(wt=>wt.name||wt.drug_id).join(", ")}`:""}`.trim(),undo:async()=>{console.log(`Reverting recurring medication ${Fe.id}`),await ce(`/api/recurring-medications/${Fe.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({medications:ve.medications,status:ve.status,frequency_days:ve.frequency_days,next_delivery_date:ve.next_delivery_date})}),r&&await ie(r)}}}catch(Ne){return{action:"edit_recurring_medication",success:!1,error:Ne}}finally{}})())):ye.action==="delete_recurring_medication"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber,Me=ye.id;let Fe;if(Me?Fe=g.find(ke=>ke.id===Me):Ne&&(Fe=[...g].sort((Ee,Ve)=>new Date(Ee.next_delivery_date).getTime()-new Date(Ve.next_delivery_date).getTime())[Ne-1]),!Fe)throw new Error(`Recurring medication with serial number ${Ne} not found.`);const ve=await ce(`/api/recurring-medications/${Fe.id}`,{method:"DELETE"});if(!ve.ok){const ke=await ve.json().catch(()=>({}));throw new Error(ke.message||`AI recurring deletion failed: ${ve.statusText}`)}return r&&await ie(r),{action:"delete_recurring_medication",success:!0,resultSummary:`Deleted Recurring Medication (ID: ${Fe.id}).`}}finally{}})())):ye.action==="delete_pharmacy_order"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber;if(!Ne)throw new Error("Missing serialNumber for delete_pharmacy_order action.");const Fe=[...f].sort((ke,Ee)=>new Date(ke.date).getTime()-new Date(Ee.date).getTime())[Ne-1];if(!Fe)throw new Error(`Pharmacy order with serial number ${Ne} not found.`);const ve=await ce(`/api/pharmacy-orders/${Fe.id}`,{method:"DELETE"});if(!ve.ok){const ke=await ve.json().catch(()=>({}));throw new Error(ke.message||`AI pharmacy order deletion failed: ${ve.statusText}`)}return r&&await z(r),{action:"delete_pharmacy_order",success:!0,resultSummary:`Deleted Pharmacy Order #${Ne}.`}}finally{}})())):ye.action==="delete_lab_order"?(Ze=!0,ft.push((async()=>{try{const Ne=ye.serialNumber;if(!Ne)throw new Error("Missing serialNumber for delete_lab_order action.");const Fe=[...d??[],...u??[]].sort((Ke,vt)=>new Date(vt.createdAt).getTime()-new Date(Ke.createdAt).getTime()),ve=Array.from(new Map(Fe.map(Ke=>[Ke.id,Ke])).values()),ke=ve.length-Ne,Ee=ve[ke];if(!Ee)throw new Error(`Lab order with serial number ${Ne} not found.`);const Ve=await ce(`/api/lab/orders/${Ee.id}`,{method:"DELETE"});if(!Ve.ok){const Ke=await Ve.json().catch(()=>({}));throw new Error(Ke.message||`AI lab order deletion failed: ${Ve.statusText}`)}return r&&(await U(r),await V(r)),{action:"delete_lab_order",success:!0,resultSummary:`Deleted Lab Order #${Ne}.`}}finally{}})())):ye.action==="add_complaint_history"&&ye.complaint?(Ze=!0,ft.push((async()=>{try{if(!t)throw new Error("Missing Record ID for complaint history.");if(!ye.complaint||typeof ye.complaint!="string")throw new Error("Invalid AI complaint text.");const Ne={complaint:ye.complaint.trim()},Me=await ce(`/api/queue/doctor/complaint/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ne)});if(!Me.ok){const ve=await Me.json().catch(()=>({}));throw new Error(ve.message||`AI complaint add failed: ${Me.statusText}`)}const Fe=await Me.json();return r&&await ee(r),{action:"add_complaint_history",success:!0,resultSummary:`Added complaint history: "${Ne.complaint}".`,undo:async()=>{console.log(`Reverting complaint history for ${t}`),Fe.newHistoryId&&(console.log(`Deleting history entry ${Fe.newHistoryId}`),await ce(`/api/queue/doctor/complaint-history/${Fe.newHistoryId}`,{method:"DELETE"})),r&&await ee(r)}}}finally{}})())):ye.action==="edit_complaint"?(Ze=!0,ft.push((async()=>{try{const{serialNumber:Ne,new_complaint:Me,delete:Fe}=ye;if(!Ne)throw new Error("Missing serialNumber for edit_complaint action.");if(!Fe&&!Me)throw new Error("Missing new_complaint for edit_complaint action (unless deleting).");const ve=[...$e||[]].sort((vt,wt)=>new Date(wt.createdAt).getTime()-new Date(vt.createdAt).getTime()),ke=ve.length-Ne,Ee=ve[ke];if(!Ee)throw new Error(`Complaint with serial number ${Ne} not found.`);if(Fe)return await W({type:"Complaint",data:Ee}),r&&await ee(r),{action:"edit_complaint",success:!0,resultSummary:`Deleted complaint #${Ne} ("${Ee.complaint}").`,undo:async()=>{console.warn("Cannot easily undo complaint deletion (requires creation with specific ID/timestamp).")}};const Ve=Ee.complaint,Ke=await ce(`/api/patients/complaints/${Ee.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:Me})});if(!Ke.ok){const vt=await Ke.json().catch(()=>({}));throw new Error(vt.message||`Failed to update complaint: ${Ke.statusText}`)}return r&&await ee(r),{action:"edit_complaint",success:!0,resultSummary:`Edited complaint #${Ne} to "${Me}".`,undo:async()=>{console.log(`Reverting complaint #${Ne}`),await ce(`/api/patients/complaints/${Ee.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:Ve})}),r&&await ee(r)}}}catch(Ne){return{action:"edit_complaint",success:!1,error:Ne}}})())):ye.action==="update_case_summary"&&ye.summary?(Ze=!0,ft.push((async()=>{try{if(!t)throw new Error("Missing Record ID for case summary update.");if(typeof ye.summary!="string")throw new Error("Invalid AI case summary text.");const Ne=o,Me={case_summary:ye.summary.trim()},Fe=await ce(`/api/queue/doctor/complaint/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)});if(!Fe.ok){const ke=await Fe.json().catch(()=>({}));throw new Error(ke.message||`AI case summary update failed: ${Fe.statusText}`)}const ve=await Fe.json();return I(ve.case_summary),q(ve.updatedAt),{action:"update_case_summary",success:!0,resultSummary:"Updated case summary.",undo:async()=>{console.log(`Reverting case summary for ${t}`),await ce(`/api/queue/doctor/complaint/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:Ne||""})}),I(Ne||"")}}}finally{}})())):ye.action==="record_vitals"?(Ze=!0,ft.push((async()=>{try{if(!r)throw new Error("Missing patient ID for recording vitals.");const{action:Ne,...Me}=ye,Fe=await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vitals:Me})});if(!Fe.ok){const ve=await Fe.json().catch(()=>({}));throw new Error(ve.message||`AI vitals record failed: ${Fe.statusText}`)}return ae(r),{action:"record_vitals",success:!0,resultSummary:`Recorded vitals: ${Object.entries(Me).map(([ve,ke])=>`${ve}: ${ke}`).join(", ")}.`,undo:async()=>{console.log(`Reverting vitals for ${r}`),await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vitals:(a==null?void 0:a.vitals)||null})}),ae(r)}}}catch(Ne){return{action:"record_vitals",success:!1,error:Ne}}})())):ye.action==="schedule_follow_up"?(Ze=!0,ft.push((async()=>{try{if(!r)throw new Error("Missing patient ID for scheduling follow-up.");const Ne=ye.date;if(!Ne)throw new Error("Missing date for follow-up.");const Me=await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({next_follow_up:Ne})});if(!Me.ok){const Fe=await Me.json().catch(()=>({}));throw new Error(Fe.message||`AI follow-up schedule failed: ${Me.statusText}`)}return ae(r),{action:"schedule_follow_up",success:!0,resultSummary:`Scheduled follow-up for ${Ne}.`,undo:async()=>{console.log(`Reverting follow-up date for ${r}`),await ce(`/api/patients/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({next_follow_up:(a==null?void 0:a.next_follow_up)||null})}),ae(r)}}}catch(Ne){return{action:"schedule_follow_up",success:!1,error:Ne}}})())):ye.action==="update_patient_status"&&(Ze=!0,ft.push((async()=>{try{const Ne=ye.status;if(Ne==="admit")a!=null&&a.discharge_date&&!(a!=null&&a.admission_date)?await re():a!=null&&a.admission_date||await re();else if(Ne==="discharge")a!=null&&a.admission_date&&!(a!=null&&a.discharge_date)&&await re();else if(Ne==="complete_consultation")await A();else if(Ne==="add_to_doctor_queue")await te("doctor");else throw new Error(`Invalid status: ${Ne}`);return{action:"update_patient_status",success:!0,resultSummary:`Updated status to ${Ne}.`}}catch(Ne){return{action:"update_patient_status",success:!1,error:Ne}}})()))}!Ze&&ct&&je.length>0&&console.warn("No function call performed for actions:",je);const Q=await Promise.all(ft),ue=Q.filter(ye=>ye.success),De=Q.filter(ye=>!ye.success);if(De.length>0){const ye=De.map(Fe=>{var ve;return((ve=Fe.error)==null?void 0:ve.message)||"Unknown error"});for(const Fe of ue)Fe.undo&&await Fe.undo();const Ne=new Error(`Batch execution failed. Rolled back successful actions. Errors: ${ye.join("; ")}`),Me=((Ge=De[0].value)==null?void 0:Ge.action)||De[0].action||"batch_execution";return M&&M("system",` Error: ${ye.join("; ")}`),await He(Me,Ne,Qe,ze,dt),{success:!1,shouldContinueLoop:!0}}else{const ye=[];ue.reverse().forEach(Ne=>{Ne.undo&&ye.push(Ne.undo)}),ye.length>0&&(me(Ne=>[...Ne,ye]),xe&&xe(!0)),M&&ue.forEach(Ne=>{Ne.resultSummary&&M("system",Ne.resultSummary)})}return fe&&typeof fe.question=="string"&&(L(fe.question),O(Array.isArray(fe.options)?fe.options:[])),{success:!0,shouldContinueLoop:ct,systemFeedback:ue.map(ye=>ye.resultSummary).filter(Boolean).join(`
`)}},ne=async(je,Qe,ze,dt,Ze=[])=>{L(null),O([]),B(null);const ct=/```json\s*([\s\S]*?)\s*```/g;let ft;const fe=[];for(;(ft=ct.exec(je))!==null;)ft[1]&&fe.push(ft[1]);if(fe.length===0){const Q=je.trim();if(Q.startsWith("{")&&Q.endsWith("}")||Q.startsWith("[")&&Q.endsWith("]"))fe.push(Q);else throw new Error("AI response did not contain a recognized function call.")}for(const Q of fe){let ue;try{ue=JSON.parse(Q)}catch(Ne){await He("parse_json_block",Ne,je,Qe,ze);return}const De=Array.isArray(ue)?ue:[ue];if(Array.isArray(ue)){const Ne=De[0],Me=De[De.length-1];if(!Ne||Ne.action!=="first_action"||!Me||Me.action!=="last_action"){const Fe=new Error("Invalid AI response: Each function call block must start with 'first_action' and end with 'last_action'.");await He("wrapper_validation",Fe,je,Qe,ze);return}}const{shouldContinueLoop:Ge,systemFeedback:ye}=await pe(De,je,Qe,ze);if(Ge&&ze<S_){const Ne=`System Feedback (Step ${ze+1}):
${ye||"Actions completed successfully."}`;let Me=[...Ze,Ne];ze===0&&(Me=[`Request being processed: "${dt}"`,...Me]),await Le("",Qe,ze+1,Me)}}};Le=async(je,Qe=0,ze=0,dt=[])=>{var ue,De,Ge;if(Qe>1){M&&M("system"," AI call failed after multiple retries. Please try a different prompt."),P(!1);return}if(ze>=S_){M&&M("system"," AI loop limit reached (Safety Halt)."),P(!1);return}P(!0);let Ze=de.current,ct=null;if(Ze.patientId&&Ze.fetchPatientContext)try{ct=await Ze.fetchPatientContext(Ze.patientId),Ze=de.current}catch(ye){console.warn("Failed to sync context before AI call, proceeding with existing state:",ye)}let ft;const fe=[...Ze.userMessages||[]];je&&je.trim()&&((fe[fe.length-1]||"").includes(je)||fe.push(`System: ${je}`)),dt.length>0&&dt.forEach(ye=>{fe.some(Ne=>Ne.includes(ye))||fe.push(`System Feedback: ${ye}`)});const Q=fe.join(`

`);try{const ye=new Map,Ne=(ct==null?void 0:ct.labOrders)||Ze.pendingLabOrders||[],Me=(ct==null?void 0:ct.labReports)||Ze.labReports||[];(Ne??[]).forEach(tt=>{ye.set(tt.id,{...tt})}),(Me??[]).forEach(tt=>{if(!ye.has(tt.id))ye.set(tt.id,{id:tt.id,patient_id:tt.patient_id,tests:tt.tests,status:tt.status,createdAt:tt.createdAt,report:tt});else{const Nt=ye.get(tt.id);Nt&&(Nt.report=tt,Nt.status=tt.status)}});const Fe=Array.from(ye.values());Fe.sort((tt,Nt)=>new Date(Nt.createdAt).getTime()-new Date(tt.createdAt).getTime());const ve=Fe.map((tt,Nt)=>{let Lt=null;if(tt.report)try{const pn=typeof tt.report.report_content=="string"?tt.report.report_content:JSON.stringify(tt.report.report_content||{}),Kt=JSON.parse(pn||"{}"),ln=(tt.report.tests||[]).map(Dt=>{const mn=Kt[Dt.id]||{},Dn=ii=>({name:ii.name,value:mn[ii.name]!==void 0?String(mn[ii.name]):String(ii.defaultValue),normal_range:ii.normal_range||"N/A"});return{testId:Dt.id,testName:Dt.name,parameters:(Dt.default_parameters||[]).map(Dn)}});Lt={reportId:tt.report.reportId,reportDate:tt.report.report_date,tests:ln}}catch{Lt={reportId:tt.report.reportId,reportDate:tt.report.report_date,reportContent:typeof tt.report.report_content=="string"?tt.report.report_content:JSON.stringify(tt.report.report_content),error:"Failed to parse report content JSON."}}return{serialNumber:Fe.length-Nt,orderId:tt.id,orderDate:isNaN(new Date(tt.createdAt).getTime())?tt.createdAt:new Date(tt.createdAt).toISOString(),tests:tt.tests.map(pn=>({id:pn.id,name:pn.name,price:pn.price})),status:tt.status,report:Lt}}),Ee=[...(ct==null?void 0:ct.pastComplaints)||Ze.pastComplaints||[]].sort((tt,Nt)=>new Date(Nt.createdAt).getTime()-new Date(tt.createdAt).getTime()),Ve=Ee.map((tt,Nt)=>{try{return{serialNumber:Ee.length-Nt,...tt,createdAt:isNaN(new Date(tt.createdAt).getTime())?tt.createdAt:new Date(tt.createdAt).toISOString()}}catch{return{serialNumber:Ee.length-Nt,...tt}}}),wt=[...(ct==null?void 0:ct.pharmacyOrders)||Ze.pharmacyOrders||[]].sort((tt,Nt)=>{const Lt=new Date(tt.date).getTime(),pn=new Date(Nt.date).getTime();return Lt-pn}).map((tt,Nt)=>{try{return{serialNumber:Nt+1,...tt,date:tt.date&&!isNaN(new Date(tt.date).getTime())?new Date(tt.date).toISOString():tt.date}}catch{return{serialNumber:Nt+1,...tt}}}),nt=(ct==null?void 0:ct.patient)||Ze.patientDetails,bt=(ct==null?void 0:ct.recurringMedications)||Ze.recurringMedications,Mt={query:Q,currentDateTime:new Date().toISOString(),patientName:(nt==null?void 0:nt.name)||"",patientAge:(nt==null?void 0:nt.age)||void 0,patientGender:(nt==null?void 0:nt.gender)||void 0,case_summary:Ze.caseSummary||"",case_summary_last_updated:Ze.caseSummaryUpdatedAt?new Date(Ze.caseSummaryUpdatedAt).toISOString():void 0,clinic_ai_memory:((ue=Ze.clinicSettings)==null?void 0:ue.aiMemory)||"",clinic_ai_memory_last_updated:(De=Ze.clinicSettings)!=null&&De.aiMemoryUpdatedAt?new Date(Ze.clinicSettings.aiMemoryUpdatedAt).toISOString():void 0,clinic_wide_system_prompt:((Ge=Ze.clinicSettings)==null?void 0:Ge.clinicWideSystemPrompt)||"",labHistory:ve,pharmacyOrders:wt,pastComplaints:Ve,recurringMedications:bt,pharmacyInventory:Ze.pharmacyInventory,labInventory:Ze.labInventory,patientStatus:nt==null?void 0:nt.current_status,isAdmitted:!!(nt!=null&&nt.admission_date)&&!(nt!=null&&nt.discharge_date),isInQueueToday:nt==null?void 0:nt.isInDoctorQueueToday,admissionDate:(nt==null?void 0:nt.admission_date)||null,dischargeDate:(nt==null?void 0:nt.discharge_date)||null,vitals:nt==null?void 0:nt.vitals,nextFollowUp:nt==null?void 0:nt.next_follow_up};if(console.log("DEBUG: Payload before sending to Gemini API:",JSON.stringify(Mt,null,2)),ft=await SQ(Mt,h),ft){S(ft);const tt=/```json\s*([\s\S]*?)\s*```/,Nt=ft.match(tt);if(Nt&&Nt[1])T(ft.replace(tt,"").trim()),E(Nt[1].trim());else{const Lt=ft.trim();if(Lt.startsWith("{")&&Lt.endsWith("}"))try{JSON.parse(Lt),T(""),E(Lt)}catch{T(Lt),E(null)}else if(Lt.startsWith("[")&&Lt.endsWith("]"))try{JSON.parse(Lt),T(""),E(Lt)}catch{T(Lt),E(null)}else T(Lt),E(null)}C(!1),M&&ft&&M("ai",ft),Ze.patientId&&ft&&await Pe(Ze.patientId,ft),await ne(ft,Qe,ze,je,dt)}else throw new Error("Invalid AI response format.")}catch(ye){await He("call_generative_api",ye,ft,Qe,ze)}finally{ze===0&&P(!1)}};const Pe=async(je,Qe)=>{$(!0),F(null);try{const ze={ai_response:Qe},dt=await ce(`/api/patients/${je}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ze)});if(!dt.ok){const Ze=await dt.json().catch(()=>({}));throw new Error(Ze.message||`Failed to save AI response to patient: ${dt.statusText}`)}}catch(ze){F(`AI Response Save Error: ${ze.message}`)}finally{$(!1)}},Ye=(je,Qe)=>{if(je.drug_id)return Qe.find(ze=>ze.id===String(je.drug_id));if(je.name)return Jd(je.name,Qe)},rt=(je,Qe)=>{const ze=Number.isInteger(Number(je.tabletsPerDay))?Number(je.tabletsPerDay):1,dt=Number(je.numberOfDays)||1,Ze=Number(je.pack_quantity)||0,ct=Number(je.loose_quantity)||0,ft=F0(Qe.unit),fe=Number(Qe.price),Q=fe,ue=ft>0?fe/ft:0,De=Ze*Q+ct*ue;return{pack_quantity:Ze,loose_quantity:ct,tabletsPerDay:ze,numberOfDays:dt,pack_price:parseFloat(Q.toFixed(2)),loose_price:parseFloat(ue.toFixed(2)),total_price:parseFloat(De.toFixed(2))}},ut=async()=>{if(ge.length===0)return;const je=ge[ge.length-1],Qe=ge.slice(0,-1);me(Qe),Qe.length===0&&xe&&xe(!1),P(!0);try{console.log("Manual Undo: Executing undo functions...",je);for(const ze of je)try{await ze()}catch(dt){console.error("Error during manual undo:",dt)}console.log("Manual Undo Completed.")}finally{P(!1)}};return w.useImperativeHandle(n,()=>({callGenerativeApi:Le,undoLastBatch:ut})),null}),DQ={};function Xw(e,n){const t=DQ,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,a=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return RT(e,r,a)}function RT(e,n,t){if(PQ(e)){if("value"in e)return e.type==="html"&&!t?"":e.value;if(n&&"alt"in e&&e.alt)return e.alt;if("children"in e)return __(e.children,n,t)}return Array.isArray(e)?__(e,n,t):""}function __(e,n,t){const r=[];let a=-1;for(;++a<e.length;)r[a]=RT(e[a],n,t);return r.join("")}function PQ(e){return!!(e&&typeof e=="object")}const C_=document.createElement("i");function Zw(e){const n="&"+e+";";C_.innerHTML=n;const t=C_.textContent;return t.charCodeAt(t.length-1)===59&&e!=="semi"||t===n?!1:t}function Ml(e,n,t,r){const a=e.length;let o=0,l;if(n<0?n=-n>a?0:a+n:n=n>a?a:n,t=t>0?t:0,r.length<1e4)l=Array.from(r),l.unshift(n,t),e.splice(...l);else for(t&&e.splice(n,t);o<r.length;)l=r.slice(o,o+1e4),l.unshift(n,0),e.splice(...l),o+=1e4,n+=1e4}function Us(e,n){return e.length>0?(Ml(e,e.length,0,n),e):n}const k_={}.hasOwnProperty;function IQ(e){const n={};let t=-1;for(;++t<e.length;)MQ(n,e[t]);return n}function MQ(e,n){let t;for(t in n){const a=(k_.call(e,t)?e[t]:void 0)||(e[t]={}),o=n[t];let l;if(o)for(l in o){k_.call(a,l)||(a[l]=[]);const h=o[l];RQ(a[l],Array.isArray(h)?h:h?[h]:[])}}}function RQ(e,n){let t=-1;const r=[];for(;++t<n.length;)(n[t].add==="after"?e:r).push(n[t]);Ml(e,0,0,r)}function OT(e,n){const t=Number.parseInt(e,n);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"":String.fromCodePoint(t)}function Qf(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const El=Du(/[A-Za-z]/),us=Du(/[\dA-Za-z]/),OQ=Du(/[#-'*+\--9=?A-Z^-~]/);function B1(e){return e!==null&&(e<32||e===127)}const U1=Du(/\d/),LQ=Du(/[\dA-Fa-f]/),FQ=Du(/[!-/:-@[-`{-~]/);function tn(e){return e!==null&&e<-2}function Ia(e){return e!==null&&(e<0||e===32)}function Xn(e){return e===-2||e===-1||e===32}const $Q=Du(new RegExp("\\p{P}|\\p{S}","u")),zQ=Du(/\s/);function Du(e){return n;function n(t){return t!==null&&t>-1&&e.test(String.fromCharCode(t))}}function fp(e){const n=[];let t=-1,r=0,a=0;for(;++t<e.length;){const o=e.charCodeAt(t);let l="";if(o===37&&us(e.charCodeAt(t+1))&&us(e.charCodeAt(t+2)))a=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(l=String.fromCharCode(o));else if(o>55295&&o<57344){const h=e.charCodeAt(t+1);o<56320&&h>56319&&h<57344?(l=String.fromCharCode(o,h),a=1):l=""}else l=String.fromCharCode(o);l&&(n.push(e.slice(r,t),encodeURIComponent(l)),r=t+a+1,l=""),a&&(t+=a,a=0)}return n.join("")+e.slice(r)}function wi(e,n,t,r){const a=r?r-1:Number.POSITIVE_INFINITY;let o=0;return l;function l(d){return Xn(d)?(e.enter(t),h(d)):n(d)}function h(d){return Xn(d)&&o++<a?(e.consume(d),h):(e.exit(t),n(d))}}const BQ={tokenize:UQ};function UQ(e){const n=e.attempt(this.parser.constructs.contentInitial,r,a);let t;return n;function r(h){if(h===null){e.consume(h);return}return e.enter("lineEnding"),e.consume(h),e.exit("lineEnding"),wi(e,n,"linePrefix")}function a(h){return e.enter("paragraph"),o(h)}function o(h){const d=e.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=d),t=d,l(h)}function l(h){if(h===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(h);return}return tn(h)?(e.consume(h),e.exit("chunkText"),o):(e.consume(h),l)}}const qQ={tokenize:VQ},T_={tokenize:HQ};function VQ(e){const n=this,t=[];let r=0,a,o,l;return h;function h(I){if(r<t.length){const q=t[r];return n.containerState=q[1],e.attempt(q[0].continuation,d,u)(I)}return u(I)}function d(I){if(r++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,a&&P();const q=n.events.length;let L=q,O;for(;L--;)if(n.events[L][0]==="exit"&&n.events[L][1].type==="chunkFlow"){O=n.events[L][1].end;break}C(r);let B=q;for(;B<n.events.length;)n.events[B][1].end={...O},B++;return Ml(n.events,L+1,0,n.events.slice(q)),n.events.length=B,u(I)}return h(I)}function u(I){if(r===t.length){if(!a)return b(I);if(a.currentConstruct&&a.currentConstruct.concrete)return S(I);n.interrupt=!!(a.currentConstruct&&!a._gfmTableDynamicInterruptHack)}return n.containerState={},e.check(T_,f,g)(I)}function f(I){return a&&P(),C(r),b(I)}function g(I){return n.parser.lazy[n.now().line]=r!==t.length,l=n.now().offset,S(I)}function b(I){return n.containerState={},e.attempt(T_,v,S)(I)}function v(I){return r++,t.push([n.currentConstruct,n.containerState]),b(I)}function S(I){if(I===null){a&&P(),C(0),e.consume(I);return}return a=a||n.parser.flow(n.now()),e.enter("chunkFlow",{_tokenizer:a,contentType:"flow",previous:o}),T(I)}function T(I){if(I===null){E(e.exit("chunkFlow"),!0),C(0),e.consume(I);return}return tn(I)?(e.consume(I),E(e.exit("chunkFlow")),r=0,n.interrupt=void 0,h):(e.consume(I),T)}function E(I,q){const L=n.sliceStream(I);if(q&&L.push(null),I.previous=o,o&&(o.next=I),o=I,a.defineSkip(I.start),a.write(L),n.parser.lazy[I.start.line]){let O=a.events.length;for(;O--;)if(a.events[O][1].start.offset<l&&(!a.events[O][1].end||a.events[O][1].end.offset>l))return;const B=n.events.length;let $=B,F,z;for(;$--;)if(n.events[$][0]==="exit"&&n.events[$][1].type==="chunkFlow"){if(F){z=n.events[$][1].end;break}F=!0}for(C(r),O=B;O<n.events.length;)n.events[O][1].end={...z},O++;Ml(n.events,$+1,0,n.events.slice(B)),n.events.length=O}}function C(I){let q=t.length;for(;q-- >I;){const L=t[q];n.containerState=L[1],L[0].exit.call(n,e)}t.length=I}function P(){a.write([null]),o=void 0,a=void 0,n.containerState._closeFlow=void 0}}function HQ(e,n,t){return wi(e,e.attempt(this.parser.constructs.document,n,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function jb(e){if(e===null||Ia(e)||zQ(e))return 1;if($Q(e))return 2}function eN(e,n,t){const r=[];let a=-1;for(;++a<e.length;){const o=e[a].resolveAll;o&&!r.includes(o)&&(n=o(n,t),r.push(o))}return n}const q1={name:"attention",resolveAll:GQ,tokenize:YQ};function GQ(e,n){let t=-1,r,a,o,l,h,d,u,f;for(;++t<e.length;)if(e[t][0]==="enter"&&e[t][1].type==="attentionSequence"&&e[t][1]._close){for(r=t;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&n.sliceSerialize(e[r][1]).charCodeAt(0)===n.sliceSerialize(e[t][1]).charCodeAt(0)){if((e[r][1]._close||e[t][1]._open)&&(e[t][1].end.offset-e[t][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[t][1].end.offset-e[t][1].start.offset)%3))continue;d=e[r][1].end.offset-e[r][1].start.offset>1&&e[t][1].end.offset-e[t][1].start.offset>1?2:1;const g={...e[r][1].end},b={...e[t][1].start};E_(g,-d),E_(b,d),l={type:d>1?"strongSequence":"emphasisSequence",start:g,end:{...e[r][1].end}},h={type:d>1?"strongSequence":"emphasisSequence",start:{...e[t][1].start},end:b},o={type:d>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[t][1].start}},a={type:d>1?"strong":"emphasis",start:{...l.start},end:{...h.end}},e[r][1].end={...l.start},e[t][1].start={...h.end},u=[],e[r][1].end.offset-e[r][1].start.offset&&(u=Us(u,[["enter",e[r][1],n],["exit",e[r][1],n]])),u=Us(u,[["enter",a,n],["enter",l,n],["exit",l,n],["enter",o,n]]),u=Us(u,eN(n.parser.constructs.insideSpan.null,e.slice(r+1,t),n)),u=Us(u,[["exit",o,n],["enter",h,n],["exit",h,n],["exit",a,n]]),e[t][1].end.offset-e[t][1].start.offset?(f=2,u=Us(u,[["enter",e[t][1],n],["exit",e[t][1],n]])):f=0,Ml(e,r-1,t-r+3,u),t=r+u.length-f-2;break}}for(t=-1;++t<e.length;)e[t][1].type==="attentionSequence"&&(e[t][1].type="data");return e}function YQ(e,n){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,a=jb(r);let o;return l;function l(d){return o=d,e.enter("attentionSequence"),h(d)}function h(d){if(d===o)return e.consume(d),h;const u=e.exit("attentionSequence"),f=jb(d),g=!f||f===2&&a||t.includes(d),b=!a||a===2&&f||t.includes(r);return u._open=!!(o===42?g:g&&(a||!b)),u._close=!!(o===42?b:b&&(f||!g)),n(d)}}function E_(e,n){e.column+=n,e.offset+=n,e._bufferIndex+=n}const WQ={name:"autolink",tokenize:QQ};function QQ(e,n,t){let r=0;return a;function a(v){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),o}function o(v){return El(v)?(e.consume(v),l):v===64?t(v):u(v)}function l(v){return v===43||v===45||v===46||us(v)?(r=1,h(v)):u(v)}function h(v){return v===58?(e.consume(v),r=0,d):(v===43||v===45||v===46||us(v))&&r++<32?(e.consume(v),h):(r=0,u(v))}function d(v){return v===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),n):v===null||v===32||v===60||B1(v)?t(v):(e.consume(v),d)}function u(v){return v===64?(e.consume(v),f):OQ(v)?(e.consume(v),u):t(v)}function f(v){return us(v)?g(v):t(v)}function g(v){return v===46?(e.consume(v),r=0,f):v===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(v),e.exit("autolinkMarker"),e.exit("autolink"),n):b(v)}function b(v){if((v===45||us(v))&&r++<63){const S=v===45?b:g;return e.consume(v),S}return t(v)}}const Xb={partial:!0,tokenize:JQ};function JQ(e,n,t){return r;function r(o){return Xn(o)?wi(e,a,"linePrefix")(o):a(o)}function a(o){return o===null||tn(o)?n(o):t(o)}}const LT={continuation:{tokenize:XQ},exit:ZQ,name:"blockQuote",tokenize:KQ};function KQ(e,n,t){const r=this;return a;function a(l){if(l===62){const h=r.containerState;return h.open||(e.enter("blockQuote",{_container:!0}),h.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(l),e.exit("blockQuoteMarker"),o}return t(l)}function o(l){return Xn(l)?(e.enter("blockQuotePrefixWhitespace"),e.consume(l),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),n):(e.exit("blockQuotePrefix"),n(l))}}function XQ(e,n,t){const r=this;return a;function a(l){return Xn(l)?wi(e,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):o(l)}function o(l){return e.attempt(LT,n,t)(l)}}function ZQ(e){e.exit("blockQuote")}const FT={name:"characterEscape",tokenize:eJ};function eJ(e,n,t){return r;function r(o){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(o),e.exit("escapeMarker"),a}function a(o){return FQ(o)?(e.enter("characterEscapeValue"),e.consume(o),e.exit("characterEscapeValue"),e.exit("characterEscape"),n):t(o)}}const $T={name:"characterReference",tokenize:tJ};function tJ(e,n,t){const r=this;let a=0,o,l;return h;function h(g){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(g),e.exit("characterReferenceMarker"),d}function d(g){return g===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(g),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),o=31,l=us,f(g))}function u(g){return g===88||g===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(g),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),o=6,l=LQ,f):(e.enter("characterReferenceValue"),o=7,l=U1,f(g))}function f(g){if(g===59&&a){const b=e.exit("characterReferenceValue");return l===us&&!Zw(r.sliceSerialize(b))?t(g):(e.enter("characterReferenceMarker"),e.consume(g),e.exit("characterReferenceMarker"),e.exit("characterReference"),n)}return l(g)&&a++<o?(e.consume(g),f):t(g)}}const A_={partial:!0,tokenize:iJ},D_={concrete:!0,name:"codeFenced",tokenize:nJ};function nJ(e,n,t){const r=this,a={partial:!0,tokenize:L};let o=0,l=0,h;return d;function d(O){return u(O)}function u(O){const B=r.events[r.events.length-1];return o=B&&B[1].type==="linePrefix"?B[2].sliceSerialize(B[1],!0).length:0,h=O,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),f(O)}function f(O){return O===h?(l++,e.consume(O),f):l<3?t(O):(e.exit("codeFencedFenceSequence"),Xn(O)?wi(e,g,"whitespace")(O):g(O))}function g(O){return O===null||tn(O)?(e.exit("codeFencedFence"),r.interrupt?n(O):e.check(A_,T,q)(O)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),b(O))}function b(O){return O===null||tn(O)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),g(O)):Xn(O)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),wi(e,v,"whitespace")(O)):O===96&&O===h?t(O):(e.consume(O),b)}function v(O){return O===null||tn(O)?g(O):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),S(O))}function S(O){return O===null||tn(O)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),g(O)):O===96&&O===h?t(O):(e.consume(O),S)}function T(O){return e.attempt(a,q,E)(O)}function E(O){return e.enter("lineEnding"),e.consume(O),e.exit("lineEnding"),C}function C(O){return o>0&&Xn(O)?wi(e,P,"linePrefix",o+1)(O):P(O)}function P(O){return O===null||tn(O)?e.check(A_,T,q)(O):(e.enter("codeFlowValue"),I(O))}function I(O){return O===null||tn(O)?(e.exit("codeFlowValue"),P(O)):(e.consume(O),I)}function q(O){return e.exit("codeFenced"),n(O)}function L(O,B,$){let F=0;return z;function z(ae){return O.enter("lineEnding"),O.consume(ae),O.exit("lineEnding"),U}function U(ae){return O.enter("codeFencedFence"),Xn(ae)?wi(O,V,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(ae):V(ae)}function V(ae){return ae===h?(O.enter("codeFencedFenceSequence"),ee(ae)):$(ae)}function ee(ae){return ae===h?(F++,O.consume(ae),ee):F>=l?(O.exit("codeFencedFenceSequence"),Xn(ae)?wi(O,ie,"whitespace")(ae):ie(ae)):$(ae)}function ie(ae){return ae===null||tn(ae)?(O.exit("codeFencedFence"),B(ae)):$(ae)}}}function iJ(e,n,t){const r=this;return a;function a(l){return l===null?t(l):(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),o)}function o(l){return r.parser.lazy[r.now().line]?t(l):n(l)}}const $0={name:"codeIndented",tokenize:aJ},rJ={partial:!0,tokenize:sJ};function aJ(e,n,t){const r=this;return a;function a(u){return e.enter("codeIndented"),wi(e,o,"linePrefix",5)(u)}function o(u){const f=r.events[r.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?l(u):t(u)}function l(u){return u===null?d(u):tn(u)?e.attempt(rJ,l,d)(u):(e.enter("codeFlowValue"),h(u))}function h(u){return u===null||tn(u)?(e.exit("codeFlowValue"),l(u)):(e.consume(u),h)}function d(u){return e.exit("codeIndented"),n(u)}}function sJ(e,n,t){const r=this;return a;function a(l){return r.parser.lazy[r.now().line]?t(l):tn(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),a):wi(e,o,"linePrefix",5)(l)}function o(l){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?n(l):tn(l)?a(l):t(l)}}const oJ={name:"codeText",previous:cJ,resolve:lJ,tokenize:uJ};function lJ(e){let n=e.length-4,t=3,r,a;if((e[t][1].type==="lineEnding"||e[t][1].type==="space")&&(e[n][1].type==="lineEnding"||e[n][1].type==="space")){for(r=t;++r<n;)if(e[r][1].type==="codeTextData"){e[t][1].type="codeTextPadding",e[n][1].type="codeTextPadding",t+=2,n-=2;break}}for(r=t-1,n++;++r<=n;)a===void 0?r!==n&&e[r][1].type!=="lineEnding"&&(a=r):(r===n||e[r][1].type==="lineEnding")&&(e[a][1].type="codeTextData",r!==a+2&&(e[a][1].end=e[r-1][1].end,e.splice(a+2,r-a-2),n-=r-a-2,r=a+2),a=void 0);return e}function cJ(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function uJ(e,n,t){let r=0,a,o;return l;function l(g){return e.enter("codeText"),e.enter("codeTextSequence"),h(g)}function h(g){return g===96?(e.consume(g),r++,h):(e.exit("codeTextSequence"),d(g))}function d(g){return g===null?t(g):g===32?(e.enter("space"),e.consume(g),e.exit("space"),d):g===96?(o=e.enter("codeTextSequence"),a=0,f(g)):tn(g)?(e.enter("lineEnding"),e.consume(g),e.exit("lineEnding"),d):(e.enter("codeTextData"),u(g))}function u(g){return g===null||g===32||g===96||tn(g)?(e.exit("codeTextData"),d(g)):(e.consume(g),u)}function f(g){return g===96?(e.consume(g),a++,f):a===r?(e.exit("codeTextSequence"),e.exit("codeText"),n(g)):(o.type="codeTextData",u(g))}}class dJ{constructor(n){this.left=n?[...n]:[],this.right=[]}get(n){if(n<0||n>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+n+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return n<this.left.length?this.left[n]:this.right[this.right.length-n+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(n,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(n,r):n>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-n+this.left.length).reverse():this.left.slice(n).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(n,t,r){const a=t||0;this.setCursor(Math.trunc(n));const o=this.right.splice(this.right.length-a,Number.POSITIVE_INFINITY);return r&&Ym(this.left,r),o.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(n){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(n)}pushMany(n){this.setCursor(Number.POSITIVE_INFINITY),Ym(this.left,n)}unshift(n){this.setCursor(0),this.right.push(n)}unshiftMany(n){this.setCursor(0),Ym(this.right,n.reverse())}setCursor(n){if(!(n===this.left.length||n>this.left.length&&this.right.length===0||n<0&&this.left.length===0))if(n<this.left.length){const t=this.left.splice(n,Number.POSITIVE_INFINITY);Ym(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-n,Number.POSITIVE_INFINITY);Ym(this.left,t.reverse())}}}function Ym(e,n){let t=0;if(n.length<1e4)e.push(...n);else for(;t<n.length;)e.push(...n.slice(t,t+1e4)),t+=1e4}function zT(e){const n={};let t=-1,r,a,o,l,h,d,u;const f=new dJ(e);for(;++t<f.length;){for(;t in n;)t=n[t];if(r=f.get(t),t&&r[1].type==="chunkFlow"&&f.get(t-1)[1].type==="listItemPrefix"&&(d=r[1]._tokenizer.events,o=0,o<d.length&&d[o][1].type==="lineEndingBlank"&&(o+=2),o<d.length&&d[o][1].type==="content"))for(;++o<d.length&&d[o][1].type!=="content";)d[o][1].type==="chunkText"&&(d[o][1]._isInFirstContentOfListItem=!0,o++);if(r[0]==="enter")r[1].contentType&&(Object.assign(n,hJ(f,t)),t=n[t],u=!0);else if(r[1]._container){for(o=t,a=void 0;o--;)if(l=f.get(o),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(a&&(f.get(a)[1].type="lineEndingBlank"),l[1].type="lineEnding",a=o);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;a&&(r[1].end={...f.get(a)[1].start},h=f.slice(a,t),h.unshift(r),f.splice(a,t-a+1,h))}}return Ml(e,0,Number.POSITIVE_INFINITY,f.slice(0)),!u}function hJ(e,n){const t=e.get(n)[1],r=e.get(n)[2];let a=n-1;const o=[];let l=t._tokenizer;l||(l=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const h=l.events,d=[],u={};let f,g,b=-1,v=t,S=0,T=0;const E=[T];for(;v;){for(;e.get(++a)[1]!==v;);o.push(a),v._tokenizer||(f=r.sliceStream(v),v.next||f.push(null),g&&l.defineSkip(v.start),v._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(f),v._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),g=v,v=v.next}for(v=t;++b<h.length;)h[b][0]==="exit"&&h[b-1][0]==="enter"&&h[b][1].type===h[b-1][1].type&&h[b][1].start.line!==h[b][1].end.line&&(T=b+1,E.push(T),v._tokenizer=void 0,v.previous=void 0,v=v.next);for(l.events=[],v?(v._tokenizer=void 0,v.previous=void 0):E.pop(),b=E.length;b--;){const C=h.slice(E[b],E[b+1]),P=o.pop();d.push([P,P+C.length-1]),e.splice(P,2,C)}for(d.reverse(),b=-1;++b<d.length;)u[S+d[b][0]]=S+d[b][1],S+=d[b][1]-d[b][0]-1;return u}const fJ={resolve:mJ,tokenize:gJ},pJ={partial:!0,tokenize:yJ};function mJ(e){return zT(e),e}function gJ(e,n){let t;return r;function r(h){return e.enter("content"),t=e.enter("chunkContent",{contentType:"content"}),a(h)}function a(h){return h===null?o(h):tn(h)?e.check(pJ,l,o)(h):(e.consume(h),a)}function o(h){return e.exit("chunkContent"),e.exit("content"),n(h)}function l(h){return e.consume(h),e.exit("chunkContent"),t.next=e.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,a}}function yJ(e,n,t){const r=this;return a;function a(l){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),wi(e,o,"linePrefix")}function o(l){if(l===null||tn(l))return t(l);const h=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?n(l):e.interrupt(r.parser.constructs.flow,t,n)(l)}}function BT(e,n,t,r,a,o,l,h,d){const u=d||Number.POSITIVE_INFINITY;let f=0;return g;function g(C){return C===60?(e.enter(r),e.enter(a),e.enter(o),e.consume(C),e.exit(o),b):C===null||C===32||C===41||B1(C)?t(C):(e.enter(r),e.enter(l),e.enter(h),e.enter("chunkString",{contentType:"string"}),T(C))}function b(C){return C===62?(e.enter(o),e.consume(C),e.exit(o),e.exit(a),e.exit(r),n):(e.enter(h),e.enter("chunkString",{contentType:"string"}),v(C))}function v(C){return C===62?(e.exit("chunkString"),e.exit(h),b(C)):C===null||C===60||tn(C)?t(C):(e.consume(C),C===92?S:v)}function S(C){return C===60||C===62||C===92?(e.consume(C),v):v(C)}function T(C){return!f&&(C===null||C===41||Ia(C))?(e.exit("chunkString"),e.exit(h),e.exit(l),e.exit(r),n(C)):f<u&&C===40?(e.consume(C),f++,T):C===41?(e.consume(C),f--,T):C===null||C===32||C===40||B1(C)?t(C):(e.consume(C),C===92?E:T)}function E(C){return C===40||C===41||C===92?(e.consume(C),T):T(C)}}function UT(e,n,t,r,a,o){const l=this;let h=0,d;return u;function u(v){return e.enter(r),e.enter(a),e.consume(v),e.exit(a),e.enter(o),f}function f(v){return h>999||v===null||v===91||v===93&&!d||v===94&&!h&&"_hiddenFootnoteSupport"in l.parser.constructs?t(v):v===93?(e.exit(o),e.enter(a),e.consume(v),e.exit(a),e.exit(r),n):tn(v)?(e.enter("lineEnding"),e.consume(v),e.exit("lineEnding"),f):(e.enter("chunkString",{contentType:"string"}),g(v))}function g(v){return v===null||v===91||v===93||tn(v)||h++>999?(e.exit("chunkString"),f(v)):(e.consume(v),d||(d=!Xn(v)),v===92?b:g)}function b(v){return v===91||v===92||v===93?(e.consume(v),h++,g):g(v)}}function qT(e,n,t,r,a,o){let l;return h;function h(b){return b===34||b===39||b===40?(e.enter(r),e.enter(a),e.consume(b),e.exit(a),l=b===40?41:b,d):t(b)}function d(b){return b===l?(e.enter(a),e.consume(b),e.exit(a),e.exit(r),n):(e.enter(o),u(b))}function u(b){return b===l?(e.exit(o),d(l)):b===null?t(b):tn(b)?(e.enter("lineEnding"),e.consume(b),e.exit("lineEnding"),wi(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),f(b))}function f(b){return b===l||b===null||tn(b)?(e.exit("chunkString"),u(b)):(e.consume(b),b===92?g:f)}function g(b){return b===l||b===92?(e.consume(b),f):f(b)}}function tg(e,n){let t;return r;function r(a){return tn(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),t=!0,r):Xn(a)?wi(e,r,t?"linePrefix":"lineSuffix")(a):n(a)}}const xJ={name:"definition",tokenize:vJ},bJ={partial:!0,tokenize:wJ};function vJ(e,n,t){const r=this;let a;return o;function o(v){return e.enter("definition"),l(v)}function l(v){return UT.call(r,e,h,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(v)}function h(v){return a=Qf(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),v===58?(e.enter("definitionMarker"),e.consume(v),e.exit("definitionMarker"),d):t(v)}function d(v){return Ia(v)?tg(e,u)(v):u(v)}function u(v){return BT(e,f,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(v)}function f(v){return e.attempt(bJ,g,g)(v)}function g(v){return Xn(v)?wi(e,b,"whitespace")(v):b(v)}function b(v){return v===null||tn(v)?(e.exit("definition"),r.parser.defined.push(a),n(v)):t(v)}}function wJ(e,n,t){return r;function r(h){return Ia(h)?tg(e,a)(h):t(h)}function a(h){return qT(e,o,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(h)}function o(h){return Xn(h)?wi(e,l,"whitespace")(h):l(h)}function l(h){return h===null||tn(h)?n(h):t(h)}}const NJ={name:"hardBreakEscape",tokenize:SJ};function SJ(e,n,t){return r;function r(o){return e.enter("hardBreakEscape"),e.consume(o),a}function a(o){return tn(o)?(e.exit("hardBreakEscape"),n(o)):t(o)}}const jJ={name:"headingAtx",resolve:_J,tokenize:CJ};function _J(e,n){let t=e.length-2,r=3,a,o;return e[r][1].type==="whitespace"&&(r+=2),t-2>r&&e[t][1].type==="whitespace"&&(t-=2),e[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&e[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(a={type:"atxHeadingText",start:e[r][1].start,end:e[t][1].end},o={type:"chunkText",start:e[r][1].start,end:e[t][1].end,contentType:"text"},Ml(e,r,t-r+1,[["enter",a,n],["enter",o,n],["exit",o,n],["exit",a,n]])),e}function CJ(e,n,t){let r=0;return a;function a(f){return e.enter("atxHeading"),o(f)}function o(f){return e.enter("atxHeadingSequence"),l(f)}function l(f){return f===35&&r++<6?(e.consume(f),l):f===null||Ia(f)?(e.exit("atxHeadingSequence"),h(f)):t(f)}function h(f){return f===35?(e.enter("atxHeadingSequence"),d(f)):f===null||tn(f)?(e.exit("atxHeading"),n(f)):Xn(f)?wi(e,h,"whitespace")(f):(e.enter("atxHeadingText"),u(f))}function d(f){return f===35?(e.consume(f),d):(e.exit("atxHeadingSequence"),h(f))}function u(f){return f===null||f===35||Ia(f)?(e.exit("atxHeadingText"),h(f)):(e.consume(f),u)}}const kJ=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],P_=["pre","script","style","textarea"],TJ={concrete:!0,name:"htmlFlow",resolveTo:DJ,tokenize:PJ},EJ={partial:!0,tokenize:MJ},AJ={partial:!0,tokenize:IJ};function DJ(e){let n=e.length;for(;n--&&!(e[n][0]==="enter"&&e[n][1].type==="htmlFlow"););return n>1&&e[n-2][1].type==="linePrefix"&&(e[n][1].start=e[n-2][1].start,e[n+1][1].start=e[n-2][1].start,e.splice(n-2,2)),e}function PJ(e,n,t){const r=this;let a,o,l,h,d;return u;function u(M){return f(M)}function f(M){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(M),g}function g(M){return M===33?(e.consume(M),b):M===47?(e.consume(M),o=!0,T):M===63?(e.consume(M),a=3,r.interrupt?n:A):El(M)?(e.consume(M),l=String.fromCharCode(M),E):t(M)}function b(M){return M===45?(e.consume(M),a=2,v):M===91?(e.consume(M),a=5,h=0,S):El(M)?(e.consume(M),a=4,r.interrupt?n:A):t(M)}function v(M){return M===45?(e.consume(M),r.interrupt?n:A):t(M)}function S(M){const Se="CDATA[";return M===Se.charCodeAt(h++)?(e.consume(M),h===Se.length?r.interrupt?n:V:S):t(M)}function T(M){return El(M)?(e.consume(M),l=String.fromCharCode(M),E):t(M)}function E(M){if(M===null||M===47||M===62||Ia(M)){const Se=M===47,$e=l.toLowerCase();return!Se&&!o&&P_.includes($e)?(a=1,r.interrupt?n(M):V(M)):kJ.includes(l.toLowerCase())?(a=6,Se?(e.consume(M),C):r.interrupt?n(M):V(M)):(a=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(M):o?P(M):I(M))}return M===45||us(M)?(e.consume(M),l+=String.fromCharCode(M),E):t(M)}function C(M){return M===62?(e.consume(M),r.interrupt?n:V):t(M)}function P(M){return Xn(M)?(e.consume(M),P):z(M)}function I(M){return M===47?(e.consume(M),z):M===58||M===95||El(M)?(e.consume(M),q):Xn(M)?(e.consume(M),I):z(M)}function q(M){return M===45||M===46||M===58||M===95||us(M)?(e.consume(M),q):L(M)}function L(M){return M===61?(e.consume(M),O):Xn(M)?(e.consume(M),L):I(M)}function O(M){return M===null||M===60||M===61||M===62||M===96?t(M):M===34||M===39?(e.consume(M),d=M,B):Xn(M)?(e.consume(M),O):$(M)}function B(M){return M===d?(e.consume(M),d=null,F):M===null||tn(M)?t(M):(e.consume(M),B)}function $(M){return M===null||M===34||M===39||M===47||M===60||M===61||M===62||M===96||Ia(M)?L(M):(e.consume(M),$)}function F(M){return M===47||M===62||Xn(M)?I(M):t(M)}function z(M){return M===62?(e.consume(M),U):t(M)}function U(M){return M===null||tn(M)?V(M):Xn(M)?(e.consume(M),U):t(M)}function V(M){return M===45&&a===2?(e.consume(M),J):M===60&&a===1?(e.consume(M),K):M===62&&a===4?(e.consume(M),te):M===63&&a===3?(e.consume(M),A):M===93&&a===5?(e.consume(M),re):tn(M)&&(a===6||a===7)?(e.exit("htmlFlowData"),e.check(EJ,xe,ee)(M)):M===null||tn(M)?(e.exit("htmlFlowData"),ee(M)):(e.consume(M),V)}function ee(M){return e.check(AJ,ie,xe)(M)}function ie(M){return e.enter("lineEnding"),e.consume(M),e.exit("lineEnding"),ae}function ae(M){return M===null||tn(M)?ee(M):(e.enter("htmlFlowData"),V(M))}function J(M){return M===45?(e.consume(M),A):V(M)}function K(M){return M===47?(e.consume(M),l="",W):V(M)}function W(M){if(M===62){const Se=l.toLowerCase();return P_.includes(Se)?(e.consume(M),te):V(M)}return El(M)&&l.length<8?(e.consume(M),l+=String.fromCharCode(M),W):V(M)}function re(M){return M===93?(e.consume(M),A):V(M)}function A(M){return M===62?(e.consume(M),te):M===45&&a===2?(e.consume(M),A):V(M)}function te(M){return M===null||tn(M)?(e.exit("htmlFlowData"),xe(M)):(e.consume(M),te)}function xe(M){return e.exit("htmlFlow"),n(M)}}function IJ(e,n,t){const r=this;return a;function a(l){return tn(l)?(e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),o):t(l)}function o(l){return r.parser.lazy[r.now().line]?t(l):n(l)}}function MJ(e,n,t){return r;function r(a){return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),e.attempt(Xb,n,t)}}const RJ={name:"htmlText",tokenize:OJ};function OJ(e,n,t){const r=this;let a,o,l;return h;function h(A){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(A),d}function d(A){return A===33?(e.consume(A),u):A===47?(e.consume(A),L):A===63?(e.consume(A),I):El(A)?(e.consume(A),$):t(A)}function u(A){return A===45?(e.consume(A),f):A===91?(e.consume(A),o=0,S):El(A)?(e.consume(A),P):t(A)}function f(A){return A===45?(e.consume(A),v):t(A)}function g(A){return A===null?t(A):A===45?(e.consume(A),b):tn(A)?(l=g,K(A)):(e.consume(A),g)}function b(A){return A===45?(e.consume(A),v):g(A)}function v(A){return A===62?J(A):A===45?b(A):g(A)}function S(A){const te="CDATA[";return A===te.charCodeAt(o++)?(e.consume(A),o===te.length?T:S):t(A)}function T(A){return A===null?t(A):A===93?(e.consume(A),E):tn(A)?(l=T,K(A)):(e.consume(A),T)}function E(A){return A===93?(e.consume(A),C):T(A)}function C(A){return A===62?J(A):A===93?(e.consume(A),C):T(A)}function P(A){return A===null||A===62?J(A):tn(A)?(l=P,K(A)):(e.consume(A),P)}function I(A){return A===null?t(A):A===63?(e.consume(A),q):tn(A)?(l=I,K(A)):(e.consume(A),I)}function q(A){return A===62?J(A):I(A)}function L(A){return El(A)?(e.consume(A),O):t(A)}function O(A){return A===45||us(A)?(e.consume(A),O):B(A)}function B(A){return tn(A)?(l=B,K(A)):Xn(A)?(e.consume(A),B):J(A)}function $(A){return A===45||us(A)?(e.consume(A),$):A===47||A===62||Ia(A)?F(A):t(A)}function F(A){return A===47?(e.consume(A),J):A===58||A===95||El(A)?(e.consume(A),z):tn(A)?(l=F,K(A)):Xn(A)?(e.consume(A),F):J(A)}function z(A){return A===45||A===46||A===58||A===95||us(A)?(e.consume(A),z):U(A)}function U(A){return A===61?(e.consume(A),V):tn(A)?(l=U,K(A)):Xn(A)?(e.consume(A),U):F(A)}function V(A){return A===null||A===60||A===61||A===62||A===96?t(A):A===34||A===39?(e.consume(A),a=A,ee):tn(A)?(l=V,K(A)):Xn(A)?(e.consume(A),V):(e.consume(A),ie)}function ee(A){return A===a?(e.consume(A),a=void 0,ae):A===null?t(A):tn(A)?(l=ee,K(A)):(e.consume(A),ee)}function ie(A){return A===null||A===34||A===39||A===60||A===61||A===96?t(A):A===47||A===62||Ia(A)?F(A):(e.consume(A),ie)}function ae(A){return A===47||A===62||Ia(A)?F(A):t(A)}function J(A){return A===62?(e.consume(A),e.exit("htmlTextData"),e.exit("htmlText"),n):t(A)}function K(A){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(A),e.exit("lineEnding"),W}function W(A){return Xn(A)?wi(e,re,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(A):re(A)}function re(A){return e.enter("htmlTextData"),l(A)}}const tN={name:"labelEnd",resolveAll:zJ,resolveTo:BJ,tokenize:UJ},LJ={tokenize:qJ},FJ={tokenize:VJ},$J={tokenize:HJ};function zJ(e){let n=-1;const t=[];for(;++n<e.length;){const r=e[n][1];if(t.push(e[n]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const a=r.type==="labelImage"?4:2;r.type="data",n+=a}}return e.length!==t.length&&Ml(e,0,e.length,t),e}function BJ(e,n){let t=e.length,r=0,a,o,l,h;for(;t--;)if(a=e[t][1],o){if(a.type==="link"||a.type==="labelLink"&&a._inactive)break;e[t][0]==="enter"&&a.type==="labelLink"&&(a._inactive=!0)}else if(l){if(e[t][0]==="enter"&&(a.type==="labelImage"||a.type==="labelLink")&&!a._balanced&&(o=t,a.type!=="labelLink")){r=2;break}}else a.type==="labelEnd"&&(l=t);const d={type:e[o][1].type==="labelLink"?"link":"image",start:{...e[o][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[o][1].start},end:{...e[l][1].end}},f={type:"labelText",start:{...e[o+r+2][1].end},end:{...e[l-2][1].start}};return h=[["enter",d,n],["enter",u,n]],h=Us(h,e.slice(o+1,o+r+3)),h=Us(h,[["enter",f,n]]),h=Us(h,eN(n.parser.constructs.insideSpan.null,e.slice(o+r+4,l-3),n)),h=Us(h,[["exit",f,n],e[l-2],e[l-1],["exit",u,n]]),h=Us(h,e.slice(l+1)),h=Us(h,[["exit",d,n]]),Ml(e,o,e.length,h),e}function UJ(e,n,t){const r=this;let a=r.events.length,o,l;for(;a--;)if((r.events[a][1].type==="labelImage"||r.events[a][1].type==="labelLink")&&!r.events[a][1]._balanced){o=r.events[a][1];break}return h;function h(b){return o?o._inactive?g(b):(l=r.parser.defined.includes(Qf(r.sliceSerialize({start:o.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(b),e.exit("labelMarker"),e.exit("labelEnd"),d):t(b)}function d(b){return b===40?e.attempt(LJ,f,l?f:g)(b):b===91?e.attempt(FJ,f,l?u:g)(b):l?f(b):g(b)}function u(b){return e.attempt($J,f,g)(b)}function f(b){return n(b)}function g(b){return o._balanced=!0,t(b)}}function qJ(e,n,t){return r;function r(g){return e.enter("resource"),e.enter("resourceMarker"),e.consume(g),e.exit("resourceMarker"),a}function a(g){return Ia(g)?tg(e,o)(g):o(g)}function o(g){return g===41?f(g):BT(e,l,h,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function l(g){return Ia(g)?tg(e,d)(g):f(g)}function h(g){return t(g)}function d(g){return g===34||g===39||g===40?qT(e,u,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function u(g){return Ia(g)?tg(e,f)(g):f(g)}function f(g){return g===41?(e.enter("resourceMarker"),e.consume(g),e.exit("resourceMarker"),e.exit("resource"),n):t(g)}}function VJ(e,n,t){const r=this;return a;function a(h){return UT.call(r,e,o,l,"reference","referenceMarker","referenceString")(h)}function o(h){return r.parser.defined.includes(Qf(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?n(h):t(h)}function l(h){return t(h)}}function HJ(e,n,t){return r;function r(o){return e.enter("reference"),e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),a}function a(o){return o===93?(e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),e.exit("reference"),n):t(o)}}const GJ={name:"labelStartImage",resolveAll:tN.resolveAll,tokenize:YJ};function YJ(e,n,t){const r=this;return a;function a(h){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(h),e.exit("labelImageMarker"),o}function o(h){return h===91?(e.enter("labelMarker"),e.consume(h),e.exit("labelMarker"),e.exit("labelImage"),l):t(h)}function l(h){return h===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(h):n(h)}}const WJ={name:"labelStartLink",resolveAll:tN.resolveAll,tokenize:QJ};function QJ(e,n,t){const r=this;return a;function a(l){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelLink"),o}function o(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):n(l)}}const z0={name:"lineEnding",tokenize:JJ};function JJ(e,n){return t;function t(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),wi(e,n,"linePrefix")}}const tb={name:"thematicBreak",tokenize:KJ};function KJ(e,n,t){let r=0,a;return o;function o(u){return e.enter("thematicBreak"),l(u)}function l(u){return a=u,h(u)}function h(u){return u===a?(e.enter("thematicBreakSequence"),d(u)):r>=3&&(u===null||tn(u))?(e.exit("thematicBreak"),n(u)):t(u)}function d(u){return u===a?(e.consume(u),r++,d):(e.exit("thematicBreakSequence"),Xn(u)?wi(e,h,"whitespace")(u):h(u))}}const Da={continuation:{tokenize:tK},exit:iK,name:"list",tokenize:eK},XJ={partial:!0,tokenize:rK},ZJ={partial:!0,tokenize:nK};function eK(e,n,t){const r=this,a=r.events[r.events.length-1];let o=a&&a[1].type==="linePrefix"?a[2].sliceSerialize(a[1],!0).length:0,l=0;return h;function h(v){const S=r.containerState.type||(v===42||v===43||v===45?"listUnordered":"listOrdered");if(S==="listUnordered"?!r.containerState.marker||v===r.containerState.marker:U1(v)){if(r.containerState.type||(r.containerState.type=S,e.enter(S,{_container:!0})),S==="listUnordered")return e.enter("listItemPrefix"),v===42||v===45?e.check(tb,t,u)(v):u(v);if(!r.interrupt||v===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),d(v)}return t(v)}function d(v){return U1(v)&&++l<10?(e.consume(v),d):(!r.interrupt||l<2)&&(r.containerState.marker?v===r.containerState.marker:v===41||v===46)?(e.exit("listItemValue"),u(v)):t(v)}function u(v){return e.enter("listItemMarker"),e.consume(v),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||v,e.check(Xb,r.interrupt?t:f,e.attempt(XJ,b,g))}function f(v){return r.containerState.initialBlankLine=!0,o++,b(v)}function g(v){return Xn(v)?(e.enter("listItemPrefixWhitespace"),e.consume(v),e.exit("listItemPrefixWhitespace"),b):t(v)}function b(v){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,n(v)}}function tK(e,n,t){const r=this;return r.containerState._closeFlow=void 0,e.check(Xb,a,o);function a(h){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,wi(e,n,"listItemIndent",r.containerState.size+1)(h)}function o(h){return r.containerState.furtherBlankLines||!Xn(h)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,l(h)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(ZJ,n,l)(h))}function l(h){return r.containerState._closeFlow=!0,r.interrupt=void 0,wi(e,e.attempt(Da,n,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(h)}}function nK(e,n,t){const r=this;return wi(e,a,"listItemIndent",r.containerState.size+1);function a(o){const l=r.events[r.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===r.containerState.size?n(o):t(o)}}function iK(e){e.exit(this.containerState.type)}function rK(e,n,t){const r=this;return wi(e,a,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function a(o){const l=r.events[r.events.length-1];return!Xn(o)&&l&&l[1].type==="listItemPrefixWhitespace"?n(o):t(o)}}const I_={name:"setextUnderline",resolveTo:aK,tokenize:sK};function aK(e,n){let t=e.length,r,a,o;for(;t--;)if(e[t][0]==="enter"){if(e[t][1].type==="content"){r=t;break}e[t][1].type==="paragraph"&&(a=t)}else e[t][1].type==="content"&&e.splice(t,1),!o&&e[t][1].type==="definition"&&(o=t);const l={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[a][1].type="setextHeadingText",o?(e.splice(a,0,["enter",l,n]),e.splice(o+1,0,["exit",e[r][1],n]),e[r][1].end={...e[o][1].end}):e[r][1]=l,e.push(["exit",l,n]),e}function sK(e,n,t){const r=this;let a;return o;function o(u){let f=r.events.length,g;for(;f--;)if(r.events[f][1].type!=="lineEnding"&&r.events[f][1].type!=="linePrefix"&&r.events[f][1].type!=="content"){g=r.events[f][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||g)?(e.enter("setextHeadingLine"),a=u,l(u)):t(u)}function l(u){return e.enter("setextHeadingLineSequence"),h(u)}function h(u){return u===a?(e.consume(u),h):(e.exit("setextHeadingLineSequence"),Xn(u)?wi(e,d,"lineSuffix")(u):d(u))}function d(u){return u===null||tn(u)?(e.exit("setextHeadingLine"),n(u)):t(u)}}const oK={tokenize:lK};function lK(e){const n=this,t=e.attempt(Xb,r,e.attempt(this.parser.constructs.flowInitial,a,wi(e,e.attempt(this.parser.constructs.flow,a,e.attempt(fJ,a)),"linePrefix")));return t;function r(o){if(o===null){e.consume(o);return}return e.enter("lineEndingBlank"),e.consume(o),e.exit("lineEndingBlank"),n.currentConstruct=void 0,t}function a(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),n.currentConstruct=void 0,t}}const cK={resolveAll:HT()},uK=VT("string"),dK=VT("text");function VT(e){return{resolveAll:HT(e==="text"?hK:void 0),tokenize:n};function n(t){const r=this,a=this.parser.constructs[e],o=t.attempt(a,l,h);return l;function l(f){return u(f)?o(f):h(f)}function h(f){if(f===null){t.consume(f);return}return t.enter("data"),t.consume(f),d}function d(f){return u(f)?(t.exit("data"),o(f)):(t.consume(f),d)}function u(f){if(f===null)return!0;const g=a[f];let b=-1;if(g)for(;++b<g.length;){const v=g[b];if(!v.previous||v.previous.call(r,r.previous))return!0}return!1}}}function HT(e){return n;function n(t,r){let a=-1,o;for(;++a<=t.length;)o===void 0?t[a]&&t[a][1].type==="data"&&(o=a,a++):(!t[a]||t[a][1].type!=="data")&&(a!==o+2&&(t[o][1].end=t[a-1][1].end,t.splice(o+2,a-o-2),a=o+2),o=void 0);return e?e(t,r):t}}function hK(e,n){let t=0;for(;++t<=e.length;)if((t===e.length||e[t][1].type==="lineEnding")&&e[t-1][1].type==="data"){const r=e[t-1][1],a=n.sliceStream(r);let o=a.length,l=-1,h=0,d;for(;o--;){const u=a[o];if(typeof u=="string"){for(l=u.length;u.charCodeAt(l-1)===32;)h++,l--;if(l)break;l=-1}else if(u===-2)d=!0,h++;else if(u!==-1){o++;break}}if(n._contentTypeTextTrailing&&t===e.length&&(h=0),h){const u={type:t===e.length||d||h<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:o?l:r.start._bufferIndex+l,_index:r.start._index+o,line:r.end.line,column:r.end.column-h,offset:r.end.offset-h},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(e.splice(t,0,["enter",u,n],["exit",u,n]),t+=2)}t++}return e}const fK={42:Da,43:Da,45:Da,48:Da,49:Da,50:Da,51:Da,52:Da,53:Da,54:Da,55:Da,56:Da,57:Da,62:LT},pK={91:xJ},mK={[-2]:$0,[-1]:$0,32:$0},gK={35:jJ,42:tb,45:[I_,tb],60:TJ,61:I_,95:tb,96:D_,126:D_},yK={38:$T,92:FT},xK={[-5]:z0,[-4]:z0,[-3]:z0,33:GJ,38:$T,42:q1,60:[WQ,RJ],91:WJ,92:[NJ,FT],93:tN,95:q1,96:oJ},bK={null:[q1,cK]},vK={null:[42,95]},wK={null:[]},NK=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:vK,contentInitial:pK,disable:wK,document:fK,flow:gK,flowInitial:mK,insideSpan:bK,string:yK,text:xK},Symbol.toStringTag,{value:"Module"}));function SK(e,n,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const a={},o=[];let l=[],h=[];const d={attempt:B(L),check:B(O),consume:P,enter:I,exit:q,interrupt:B(O,{interrupt:!0})},u={code:null,containerState:{},defineSkip:T,events:[],now:S,parser:e,previous:null,sliceSerialize:b,sliceStream:v,write:g};let f=n.tokenize.call(u,d);return n.resolveAll&&o.push(n),u;function g(U){return l=Us(l,U),E(),l[l.length-1]!==null?[]:($(n,0),u.events=eN(o,u.events,u),u.events)}function b(U,V){return _K(v(U),V)}function v(U){return jK(l,U)}function S(){const{_bufferIndex:U,_index:V,line:ee,column:ie,offset:ae}=r;return{_bufferIndex:U,_index:V,line:ee,column:ie,offset:ae}}function T(U){a[U.line]=U.column,z()}function E(){let U;for(;r._index<l.length;){const V=l[r._index];if(typeof V=="string")for(U=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===U&&r._bufferIndex<V.length;)C(V.charCodeAt(r._bufferIndex));else C(V)}}function C(U){f=f(U)}function P(U){tn(U)?(r.line++,r.column=1,r.offset+=U===-3?2:1,z()):U!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===l[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=U}function I(U,V){const ee=V||{};return ee.type=U,ee.start=S(),u.events.push(["enter",ee,u]),h.push(ee),ee}function q(U){const V=h.pop();return V.end=S(),u.events.push(["exit",V,u]),V}function L(U,V){$(U,V.from)}function O(U,V){V.restore()}function B(U,V){return ee;function ee(ie,ae,J){let K,W,re,A;return Array.isArray(ie)?xe(ie):"tokenize"in ie?xe([ie]):te(ie);function te(he){return ge;function ge(me){const de=me!==null&&he[me],Le=me!==null&&he.null,He=[...Array.isArray(de)?de:de?[de]:[],...Array.isArray(Le)?Le:Le?[Le]:[]];return xe(He)(me)}}function xe(he){return K=he,W=0,he.length===0?J:M(he[W])}function M(he){return ge;function ge(me){return A=F(),re=he,he.partial||(u.currentConstruct=he),he.name&&u.parser.constructs.disable.null.includes(he.name)?$e():he.tokenize.call(V?Object.assign(Object.create(u),V):u,d,Se,$e)(me)}}function Se(he){return U(re,A),ae}function $e(he){return A.restore(),++W<K.length?M(K[W]):J}}}function $(U,V){U.resolveAll&&!o.includes(U)&&o.push(U),U.resolve&&Ml(u.events,V,u.events.length-V,U.resolve(u.events.slice(V),u)),U.resolveTo&&(u.events=U.resolveTo(u.events,u))}function F(){const U=S(),V=u.previous,ee=u.currentConstruct,ie=u.events.length,ae=Array.from(h);return{from:ie,restore:J};function J(){r=U,u.previous=V,u.currentConstruct=ee,u.events.length=ie,h=ae,z()}}function z(){r.line in a&&r.column<2&&(r.column=a[r.line],r.offset+=a[r.line]-1)}}function jK(e,n){const t=n.start._index,r=n.start._bufferIndex,a=n.end._index,o=n.end._bufferIndex;let l;if(t===a)l=[e[t].slice(r,o)];else{if(l=e.slice(t,a),r>-1){const h=l[0];typeof h=="string"?l[0]=h.slice(r):l.shift()}o>0&&l.push(e[a].slice(0,o))}return l}function _K(e,n){let t=-1;const r=[];let a;for(;++t<e.length;){const o=e[t];let l;if(typeof o=="string")l=o;else switch(o){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=n?" ":"	";break}case-1:{if(!n&&a)continue;l=" ";break}default:l=String.fromCharCode(o)}a=o===-2,r.push(l)}return r.join("")}function CK(e){const r={constructs:IQ([NK,...(e||{}).extensions||[]]),content:a(BQ),defined:[],document:a(qQ),flow:a(oK),lazy:{},string:a(uK),text:a(dK)};return r;function a(o){return l;function l(h){return SK(r,o,h)}}}function kK(e){for(;!zT(e););return e}const M_=/[\0\t\n\r]/g;function TK(){let e=1,n="",t=!0,r;return a;function a(o,l,h){const d=[];let u,f,g,b,v;for(o=n+(typeof o=="string"?o.toString():new TextDecoder(l||void 0).decode(o)),g=0,n="",t&&(o.charCodeAt(0)===65279&&g++,t=void 0);g<o.length;){if(M_.lastIndex=g,u=M_.exec(o),b=u&&u.index!==void 0?u.index:o.length,v=o.charCodeAt(b),!u){n=o.slice(g);break}if(v===10&&g===b&&r)d.push(-3),r=void 0;else switch(r&&(d.push(-5),r=void 0),g<b&&(d.push(o.slice(g,b)),e+=b-g),v){case 0:{d.push(65533),e++;break}case 9:{for(f=Math.ceil(e/4)*4,d.push(-2);e++<f;)d.push(-1);break}case 10:{d.push(-4),e=1;break}default:r=!0,e=1}g=b+1}return h&&(r&&d.push(-5),n&&d.push(n),d.push(null)),d}}const EK=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function GT(e){return e.replace(EK,AK)}function AK(e,n,t){if(n)return n;if(t.charCodeAt(0)===35){const a=t.charCodeAt(1),o=a===120||a===88;return OT(t.slice(o?2:1),o?16:10)}return Zw(t)||e}function ng(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?R_(e.position):"start"in e||"end"in e?R_(e):"line"in e||"column"in e?V1(e):""}function V1(e){return O_(e&&e.line)+":"+O_(e&&e.column)}function R_(e){return V1(e&&e.start)+"-"+V1(e&&e.end)}function O_(e){return e&&typeof e=="number"?e:1}const YT={}.hasOwnProperty;function DK(e,n,t){return typeof n!="string"&&(t=n,n=void 0),PK(t)(kK(CK(t).document().write(TK()(e,n,!0))))}function PK(e){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(Qe),autolinkProtocol:F,autolinkEmail:F,atxHeading:o(Ye),blockQuote:o(Le),characterEscape:F,characterReference:F,codeFenced:o(He),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:o(He,l),codeText:o(pe,l),codeTextData:F,data:F,codeFlowValue:F,definition:o(ne),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:o(Pe),hardBreakEscape:o(rt),hardBreakTrailing:o(rt),htmlFlow:o(ut,l),htmlFlowData:F,htmlText:o(ut,l),htmlTextData:F,image:o(je),label:l,link:o(Qe),listItem:o(dt),listItemValue:b,listOrdered:o(ze,g),listUnordered:o(ze),paragraph:o(Ze),reference:M,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:o(Ye),strong:o(ct),thematicBreak:o(fe)},exit:{atxHeading:d(),atxHeadingSequence:L,autolink:d(),autolinkEmail:de,autolinkProtocol:me,blockQuote:d(),characterEscapeValue:z,characterReferenceMarkerHexadecimal:$e,characterReferenceMarkerNumeric:$e,characterReferenceValue:he,characterReference:ge,codeFenced:d(E),codeFencedFence:T,codeFencedFenceInfo:v,codeFencedFenceMeta:S,codeFlowValue:z,codeIndented:d(C),codeText:d(ae),codeTextData:z,data:z,definition:d(),definitionDestinationString:q,definitionLabelString:P,definitionTitleString:I,emphasis:d(),hardBreakEscape:d(V),hardBreakTrailing:d(V),htmlFlow:d(ee),htmlFlowData:z,htmlText:d(ie),htmlTextData:z,image:d(K),label:re,labelText:W,lineEnding:U,link:d(J),listItem:d(),listOrdered:d(),listUnordered:d(),paragraph:d(),referenceString:Se,resourceDestinationString:A,resourceTitleString:te,resource:xe,setextHeading:d($),setextHeadingLineSequence:B,setextHeadingText:O,strong:d(),thematicBreak:d()}};WT(n,(e||{}).mdastExtensions||[]);const t={};return r;function r(Q){let ue={type:"root",children:[]};const De={stack:[ue],tokenStack:[],config:n,enter:h,exit:u,buffer:l,resume:f,data:t},Ge=[];let ye=-1;for(;++ye<Q.length;)if(Q[ye][1].type==="listOrdered"||Q[ye][1].type==="listUnordered")if(Q[ye][0]==="enter")Ge.push(ye);else{const Ne=Ge.pop();ye=a(Q,Ne,ye)}for(ye=-1;++ye<Q.length;){const Ne=n[Q[ye][0]];YT.call(Ne,Q[ye][1].type)&&Ne[Q[ye][1].type].call(Object.assign({sliceSerialize:Q[ye][2].sliceSerialize},De),Q[ye][1])}if(De.tokenStack.length>0){const Ne=De.tokenStack[De.tokenStack.length-1];(Ne[1]||L_).call(De,void 0,Ne[0])}for(ue.position={start:wu(Q.length>0?Q[0][1].start:{line:1,column:1,offset:0}),end:wu(Q.length>0?Q[Q.length-2][1].end:{line:1,column:1,offset:0})},ye=-1;++ye<n.transforms.length;)ue=n.transforms[ye](ue)||ue;return ue}function a(Q,ue,De){let Ge=ue-1,ye=-1,Ne=!1,Me,Fe,ve,ke;for(;++Ge<=De;){const Ee=Q[Ge];switch(Ee[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Ee[0]==="enter"?ye++:ye--,ke=void 0;break}case"lineEndingBlank":{Ee[0]==="enter"&&(Me&&!ke&&!ye&&!ve&&(ve=Ge),ke=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:ke=void 0}if(!ye&&Ee[0]==="enter"&&Ee[1].type==="listItemPrefix"||ye===-1&&Ee[0]==="exit"&&(Ee[1].type==="listUnordered"||Ee[1].type==="listOrdered")){if(Me){let Ve=Ge;for(Fe=void 0;Ve--;){const Ke=Q[Ve];if(Ke[1].type==="lineEnding"||Ke[1].type==="lineEndingBlank"){if(Ke[0]==="exit")continue;Fe&&(Q[Fe][1].type="lineEndingBlank",Ne=!0),Ke[1].type="lineEnding",Fe=Ve}else if(!(Ke[1].type==="linePrefix"||Ke[1].type==="blockQuotePrefix"||Ke[1].type==="blockQuotePrefixWhitespace"||Ke[1].type==="blockQuoteMarker"||Ke[1].type==="listItemIndent"))break}ve&&(!Fe||ve<Fe)&&(Me._spread=!0),Me.end=Object.assign({},Fe?Q[Fe][1].start:Ee[1].end),Q.splice(Fe||Ge,0,["exit",Me,Ee[2]]),Ge++,De++}if(Ee[1].type==="listItemPrefix"){const Ve={type:"listItem",_spread:!1,start:Object.assign({},Ee[1].start),end:void 0};Me=Ve,Q.splice(Ge,0,["enter",Ve,Ee[2]]),Ge++,De++,ve=void 0,ke=!0}}}return Q[ue][1]._spread=Ne,De}function o(Q,ue){return De;function De(Ge){h.call(this,Q(Ge),Ge),ue&&ue.call(this,Ge)}}function l(){this.stack.push({type:"fragment",children:[]})}function h(Q,ue,De){this.stack[this.stack.length-1].children.push(Q),this.stack.push(Q),this.tokenStack.push([ue,De||void 0]),Q.position={start:wu(ue.start),end:void 0}}function d(Q){return ue;function ue(De){Q&&Q.call(this,De),u.call(this,De)}}function u(Q,ue){const De=this.stack.pop(),Ge=this.tokenStack.pop();if(Ge)Ge[0].type!==Q.type&&(ue?ue.call(this,Q,Ge[0]):(Ge[1]||L_).call(this,Q,Ge[0]));else throw new Error("Cannot close `"+Q.type+"` ("+ng({start:Q.start,end:Q.end})+"): its not open");De.position.end=wu(Q.end)}function f(){return Xw(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function b(Q){if(this.data.expectingFirstListItemValue){const ue=this.stack[this.stack.length-2];ue.start=Number.parseInt(this.sliceSerialize(Q),10),this.data.expectingFirstListItemValue=void 0}}function v(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.lang=Q}function S(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.meta=Q}function T(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function E(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function C(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q.replace(/(\r?\n|\r)$/g,"")}function P(Q){const ue=this.resume(),De=this.stack[this.stack.length-1];De.label=ue,De.identifier=Qf(this.sliceSerialize(Q)).toLowerCase()}function I(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.title=Q}function q(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.url=Q}function L(Q){const ue=this.stack[this.stack.length-1];if(!ue.depth){const De=this.sliceSerialize(Q).length;ue.depth=De}}function O(){this.data.setextHeadingSlurpLineEnding=!0}function B(Q){const ue=this.stack[this.stack.length-1];ue.depth=this.sliceSerialize(Q).codePointAt(0)===61?1:2}function $(){this.data.setextHeadingSlurpLineEnding=void 0}function F(Q){const De=this.stack[this.stack.length-1].children;let Ge=De[De.length-1];(!Ge||Ge.type!=="text")&&(Ge=ft(),Ge.position={start:wu(Q.start),end:void 0},De.push(Ge)),this.stack.push(Ge)}function z(Q){const ue=this.stack.pop();ue.value+=this.sliceSerialize(Q),ue.position.end=wu(Q.end)}function U(Q){const ue=this.stack[this.stack.length-1];if(this.data.atHardBreak){const De=ue.children[ue.children.length-1];De.position.end=wu(Q.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&n.canContainEols.includes(ue.type)&&(F.call(this,Q),z.call(this,Q))}function V(){this.data.atHardBreak=!0}function ee(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function ie(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function ae(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.value=Q}function J(){const Q=this.stack[this.stack.length-1];if(this.data.inReference){const ue=this.data.referenceType||"shortcut";Q.type+="Reference",Q.referenceType=ue,delete Q.url,delete Q.title}else delete Q.identifier,delete Q.label;this.data.referenceType=void 0}function K(){const Q=this.stack[this.stack.length-1];if(this.data.inReference){const ue=this.data.referenceType||"shortcut";Q.type+="Reference",Q.referenceType=ue,delete Q.url,delete Q.title}else delete Q.identifier,delete Q.label;this.data.referenceType=void 0}function W(Q){const ue=this.sliceSerialize(Q),De=this.stack[this.stack.length-2];De.label=GT(ue),De.identifier=Qf(ue).toLowerCase()}function re(){const Q=this.stack[this.stack.length-1],ue=this.resume(),De=this.stack[this.stack.length-1];if(this.data.inReference=!0,De.type==="link"){const Ge=Q.children;De.children=Ge}else De.alt=ue}function A(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.url=Q}function te(){const Q=this.resume(),ue=this.stack[this.stack.length-1];ue.title=Q}function xe(){this.data.inReference=void 0}function M(){this.data.referenceType="collapsed"}function Se(Q){const ue=this.resume(),De=this.stack[this.stack.length-1];De.label=ue,De.identifier=Qf(this.sliceSerialize(Q)).toLowerCase(),this.data.referenceType="full"}function $e(Q){this.data.characterReferenceType=Q.type}function he(Q){const ue=this.sliceSerialize(Q),De=this.data.characterReferenceType;let Ge;De?(Ge=OT(ue,De==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):Ge=Zw(ue);const ye=this.stack[this.stack.length-1];ye.value+=Ge}function ge(Q){const ue=this.stack.pop();ue.position.end=wu(Q.end)}function me(Q){z.call(this,Q);const ue=this.stack[this.stack.length-1];ue.url=this.sliceSerialize(Q)}function de(Q){z.call(this,Q);const ue=this.stack[this.stack.length-1];ue.url="mailto:"+this.sliceSerialize(Q)}function Le(){return{type:"blockquote",children:[]}}function He(){return{type:"code",lang:null,meta:null,value:""}}function pe(){return{type:"inlineCode",value:""}}function ne(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Pe(){return{type:"emphasis",children:[]}}function Ye(){return{type:"heading",depth:0,children:[]}}function rt(){return{type:"break"}}function ut(){return{type:"html",value:""}}function je(){return{type:"image",title:null,url:"",alt:null}}function Qe(){return{type:"link",title:null,url:"",children:[]}}function ze(Q){return{type:"list",ordered:Q.type==="listOrdered",start:null,spread:Q._spread,children:[]}}function dt(Q){return{type:"listItem",spread:Q._spread,checked:null,children:[]}}function Ze(){return{type:"paragraph",children:[]}}function ct(){return{type:"strong",children:[]}}function ft(){return{type:"text",value:""}}function fe(){return{type:"thematicBreak"}}}function wu(e){return{line:e.line,column:e.column,offset:e.offset}}function WT(e,n){let t=-1;for(;++t<n.length;){const r=n[t];Array.isArray(r)?WT(e,r):IK(e,r)}}function IK(e,n){let t;for(t in n)if(YT.call(n,t))switch(t){case"canContainEols":{const r=n[t];r&&e[t].push(...r);break}case"transforms":{const r=n[t];r&&e[t].push(...r);break}case"enter":case"exit":{const r=n[t];r&&Object.assign(e[t],r);break}}}function L_(e,n){throw e?new Error("Cannot close `"+e.type+"` ("+ng({start:e.start,end:e.end})+"): a different token (`"+n.type+"`, "+ng({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+ng({start:n.start,end:n.end})+") is still open")}function MK(e){const n=this;n.parser=t;function t(r){return DK(r,{...n.data("settings"),...e,extensions:n.data("micromarkExtensions")||[],mdastExtensions:n.data("fromMarkdownExtensions")||[]})}}const F_={}.hasOwnProperty;function QT(e,n){const t=n||{};function r(a,...o){let l=r.invalid;const h=r.handlers;if(a&&F_.call(a,e)){const d=String(a[e]);l=F_.call(h,d)?h[d]:r.unknown}if(l)return l.call(this,a,...o)}return r.handlers=t.handlers||{},r.invalid=t.invalid,r.unknown=t.unknown,r}const RK={}.hasOwnProperty;function JT(e,n){let t=-1,r;if(n.extensions)for(;++t<n.extensions.length;)JT(e,n.extensions[t]);for(r in n)if(RK.call(n,r))switch(r){case"extensions":break;case"unsafe":{$_(e[r],n[r]);break}case"join":{$_(e[r],n[r]);break}case"handlers":{OK(e[r],n[r]);break}default:e.options[r]=n[r]}return e}function $_(e,n){n&&e.push(...n)}function OK(e,n){n&&Object.assign(e,n)}function LK(e,n,t,r){const a=t.enter("blockquote"),o=t.createTracker(r);o.move("> "),o.shift(2);const l=t.indentLines(t.containerFlow(e,o.current()),FK);return a(),l}function FK(e,n,t){return">"+(t?"":" ")+e}function KT(e,n){return z_(e,n.inConstruct,!0)&&!z_(e,n.notInConstruct,!1)}function z_(e,n,t){if(typeof n=="string"&&(n=[n]),!n||n.length===0)return t;let r=-1;for(;++r<n.length;)if(e.includes(n[r]))return!0;return!1}function B_(e,n,t,r){let a=-1;for(;++a<t.unsafe.length;)if(t.unsafe[a].character===`
`&&KT(t.stack,t.unsafe[a]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function $K(e,n){const t=String(e);let r=t.indexOf(n),a=r,o=0,l=0;if(typeof n!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===a?++o>l&&(l=o):o=1,a=r+n.length,r=t.indexOf(n,a);return l}function H1(e,n){return!!(n.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function zK(e){const n=e.options.fence||"`";if(n!=="`"&&n!=="~")throw new Error("Cannot serialize code with `"+n+"` for `options.fence`, expected `` ` `` or `~`");return n}function BK(e,n,t,r){const a=zK(t),o=e.value||"",l=a==="`"?"GraveAccent":"Tilde";if(H1(e,t)){const g=t.enter("codeIndented"),b=t.indentLines(o,UK);return g(),b}const h=t.createTracker(r),d=a.repeat(Math.max($K(o,a)+1,3)),u=t.enter("codeFenced");let f=h.move(d);if(e.lang){const g=t.enter(`codeFencedLang${l}`);f+=h.move(t.safe(e.lang,{before:f,after:" ",encode:["`"],...h.current()})),g()}if(e.lang&&e.meta){const g=t.enter(`codeFencedMeta${l}`);f+=h.move(" "),f+=h.move(t.safe(e.meta,{before:f,after:`
`,encode:["`"],...h.current()})),g()}return f+=h.move(`
`),o&&(f+=h.move(o+`
`)),f+=h.move(d),u(),f}function UK(e,n,t){return(t?"":"    ")+e}function nN(e){const n=e.options.quote||'"';if(n!=='"'&&n!=="'")throw new Error("Cannot serialize title with `"+n+"` for `options.quote`, expected `\"`, or `'`");return n}function qK(e,n,t,r){const a=nN(t),o=a==='"'?"Quote":"Apostrophe",l=t.enter("definition");let h=t.enter("label");const d=t.createTracker(r);let u=d.move("[");return u+=d.move(t.safe(t.associationId(e),{before:u,after:"]",...d.current()})),u+=d.move("]: "),h(),!e.url||/[\0- \u007F]/.test(e.url)?(h=t.enter("destinationLiteral"),u+=d.move("<"),u+=d.move(t.safe(e.url,{before:u,after:">",...d.current()})),u+=d.move(">")):(h=t.enter("destinationRaw"),u+=d.move(t.safe(e.url,{before:u,after:e.title?" ":`
`,...d.current()}))),h(),e.title&&(h=t.enter(`title${o}`),u+=d.move(" "+a),u+=d.move(t.safe(e.title,{before:u,after:a,...d.current()})),u+=d.move(a),h()),l(),u}function VK(e){const n=e.options.emphasis||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize emphasis with `"+n+"` for `options.emphasis`, expected `*`, or `_`");return n}function Cu(e){return"&#x"+e.toString(16).toUpperCase()+";"}function _b(e,n,t){const r=jb(e),a=jb(n);return r===void 0?a===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:a===void 0?{inside:!1,outside:!1}:a===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}XT.peek=HK;function XT(e,n,t,r){const a=VK(t),o=t.enter("emphasis"),l=t.createTracker(r),h=l.move(a);let d=l.move(t.containerPhrasing(e,{after:a,before:h,...l.current()}));const u=d.charCodeAt(0),f=_b(r.before.charCodeAt(r.before.length-1),u,a);f.inside&&(d=Cu(u)+d.slice(1));const g=d.charCodeAt(d.length-1),b=_b(r.after.charCodeAt(0),g,a);b.inside&&(d=d.slice(0,-1)+Cu(g));const v=l.move(a);return o(),t.attentionEncodeSurroundingInfo={after:b.outside,before:f.outside},h+d+v}function HK(e,n,t){return t.options.emphasis||"*"}const iN=function(e){if(e==null)return QK;if(typeof e=="function")return Zb(e);if(typeof e=="object")return Array.isArray(e)?GK(e):YK(e);if(typeof e=="string")return WK(e);throw new Error("Expected function, string, or object as test")};function GK(e){const n=[];let t=-1;for(;++t<e.length;)n[t]=iN(e[t]);return Zb(r);function r(...a){let o=-1;for(;++o<n.length;)if(n[o].apply(this,a))return!0;return!1}}function YK(e){const n=e;return Zb(t);function t(r){const a=r;let o;for(o in e)if(a[o]!==n[o])return!1;return!0}}function WK(e){return Zb(n);function n(t){return t&&t.type===e}}function Zb(e){return n;function n(t,r,a){return!!(JK(t)&&e.call(this,t,typeof r=="number"?r:void 0,a||void 0))}}function QK(){return!0}function JK(e){return e!==null&&typeof e=="object"&&"type"in e}const ZT=[],KK=!0,G1=!1,XK="skip";function ZK(e,n,t,r){let a;typeof n=="function"&&typeof t!="function"?(r=t,t=n):a=n;const o=iN(a),l=r?-1:1;h(e,void 0,[])();function h(d,u,f){const g=d&&typeof d=="object"?d:{};if(typeof g.type=="string"){const v=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(b,"name",{value:"node ("+(d.type+(v?"<"+v+">":""))+")"})}return b;function b(){let v=ZT,S,T,E;if((!n||o(d,u,f[f.length-1]||void 0))&&(v=eX(t(d,f)),v[0]===G1))return v;if("children"in d&&d.children){const C=d;if(C.children&&v[0]!==XK)for(T=(r?C.children.length:-1)+l,E=f.concat(C);T>-1&&T<C.children.length;){const P=C.children[T];if(S=h(P,T,E)(),S[0]===G1)return S;T=typeof S[1]=="number"?S[1]:T+l}}return v}}}function eX(e){return Array.isArray(e)?e:typeof e=="number"?[KK,e]:e==null?ZT:[e]}function eE(e,n,t,r){let a,o,l;typeof n=="function"?(o=void 0,l=n,a=t):(o=n,l=t,a=r),ZK(e,o,h,a);function h(d,u){const f=u[u.length-1],g=f?f.children.indexOf(d):void 0;return l(d,g,f)}}function tE(e,n){let t=!1;return eE(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,G1}),!!((!e.depth||e.depth<3)&&Xw(e)&&(n.options.setext||t))}function tX(e,n,t,r){const a=Math.max(Math.min(6,e.depth||1),1),o=t.createTracker(r);if(tE(e,t)){const f=t.enter("headingSetext"),g=t.enter("phrasing"),b=t.containerPhrasing(e,{...o.current(),before:`
`,after:`
`});return g(),f(),b+`
`+(a===1?"=":"-").repeat(b.length-(Math.max(b.lastIndexOf("\r"),b.lastIndexOf(`
`))+1))}const l="#".repeat(a),h=t.enter("headingAtx"),d=t.enter("phrasing");o.move(l+" ");let u=t.containerPhrasing(e,{before:"# ",after:`
`,...o.current()});return/^[\t ]/.test(u)&&(u=Cu(u.charCodeAt(0))+u.slice(1)),u=u?l+" "+u:l,t.options.closeAtx&&(u+=" "+l),d(),h(),u}nE.peek=nX;function nE(e){return e.value||""}function nX(){return"<"}iE.peek=iX;function iE(e,n,t,r){const a=nN(t),o=a==='"'?"Quote":"Apostrophe",l=t.enter("image");let h=t.enter("label");const d=t.createTracker(r);let u=d.move("![");return u+=d.move(t.safe(e.alt,{before:u,after:"]",...d.current()})),u+=d.move("]("),h(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(h=t.enter("destinationLiteral"),u+=d.move("<"),u+=d.move(t.safe(e.url,{before:u,after:">",...d.current()})),u+=d.move(">")):(h=t.enter("destinationRaw"),u+=d.move(t.safe(e.url,{before:u,after:e.title?" ":")",...d.current()}))),h(),e.title&&(h=t.enter(`title${o}`),u+=d.move(" "+a),u+=d.move(t.safe(e.title,{before:u,after:a,...d.current()})),u+=d.move(a),h()),u+=d.move(")"),l(),u}function iX(){return"!"}rE.peek=rX;function rE(e,n,t,r){const a=e.referenceType,o=t.enter("imageReference");let l=t.enter("label");const h=t.createTracker(r);let d=h.move("![");const u=t.safe(e.alt,{before:d,after:"]",...h.current()});d+=h.move(u+"]["),l();const f=t.stack;t.stack=[],l=t.enter("reference");const g=t.safe(t.associationId(e),{before:d,after:"]",...h.current()});return l(),t.stack=f,o(),a==="full"||!u||u!==g?d+=h.move(g+"]"):a==="shortcut"?d=d.slice(0,-1):d+=h.move("]"),d}function rX(){return"!"}aE.peek=aX;function aE(e,n,t){let r=e.value||"",a="`",o=-1;for(;new RegExp("(^|[^`])"+a+"([^`]|$)").test(r);)a+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++o<t.unsafe.length;){const l=t.unsafe[o],h=t.compilePattern(l);let d;if(l.atBreak)for(;d=h.exec(r);){let u=d.index;r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(d.index+1)}}return a+r+a}function aX(){return"`"}function sE(e,n){const t=Xw(e);return!!(!n.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(t===e.url||"mailto:"+t===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}oE.peek=sX;function oE(e,n,t,r){const a=nN(t),o=a==='"'?"Quote":"Apostrophe",l=t.createTracker(r);let h,d;if(sE(e,t)){const f=t.stack;t.stack=[],h=t.enter("autolink");let g=l.move("<");return g+=l.move(t.containerPhrasing(e,{before:g,after:">",...l.current()})),g+=l.move(">"),h(),t.stack=f,g}h=t.enter("link"),d=t.enter("label");let u=l.move("[");return u+=l.move(t.containerPhrasing(e,{before:u,after:"](",...l.current()})),u+=l.move("]("),d(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(d=t.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(t.safe(e.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(d=t.enter("destinationRaw"),u+=l.move(t.safe(e.url,{before:u,after:e.title?" ":")",...l.current()}))),d(),e.title&&(d=t.enter(`title${o}`),u+=l.move(" "+a),u+=l.move(t.safe(e.title,{before:u,after:a,...l.current()})),u+=l.move(a),d()),u+=l.move(")"),h(),u}function sX(e,n,t){return sE(e,t)?"<":"["}lE.peek=oX;function lE(e,n,t,r){const a=e.referenceType,o=t.enter("linkReference");let l=t.enter("label");const h=t.createTracker(r);let d=h.move("[");const u=t.containerPhrasing(e,{before:d,after:"]",...h.current()});d+=h.move(u+"]["),l();const f=t.stack;t.stack=[],l=t.enter("reference");const g=t.safe(t.associationId(e),{before:d,after:"]",...h.current()});return l(),t.stack=f,o(),a==="full"||!u||u!==g?d+=h.move(g+"]"):a==="shortcut"?d=d.slice(0,-1):d+=h.move("]"),d}function oX(){return"["}function rN(e){const n=e.options.bullet||"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bullet`, expected `*`, `+`, or `-`");return n}function lX(e){const n=rN(e),t=e.options.bulletOther;if(!t)return n==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===n)throw new Error("Expected `bullet` (`"+n+"`) and `bulletOther` (`"+t+"`) to be different");return t}function cX(e){const n=e.options.bulletOrdered||".";if(n!=="."&&n!==")")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOrdered`, expected `.` or `)`");return n}function cE(e){const n=e.options.rule||"*";if(n!=="*"&&n!=="-"&&n!=="_")throw new Error("Cannot serialize rules with `"+n+"` for `options.rule`, expected `*`, `-`, or `_`");return n}function uX(e,n,t,r){const a=t.enter("list"),o=t.bulletCurrent;let l=e.ordered?cX(t):rN(t);const h=e.ordered?l==="."?")":".":lX(t);let d=n&&t.bulletLastUsed?l===t.bulletLastUsed:!1;if(!e.ordered){const f=e.children?e.children[0]:void 0;if((l==="*"||l==="-")&&f&&(!f.children||!f.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(d=!0),cE(t)===l&&f){let g=-1;for(;++g<e.children.length;){const b=e.children[g];if(b&&b.type==="listItem"&&b.children&&b.children[0]&&b.children[0].type==="thematicBreak"){d=!0;break}}}}d&&(l=h),t.bulletCurrent=l;const u=t.containerFlow(e,r);return t.bulletLastUsed=l,t.bulletCurrent=o,a(),u}function dX(e){const n=e.options.listItemIndent||"one";if(n!=="tab"&&n!=="one"&&n!=="mixed")throw new Error("Cannot serialize items with `"+n+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return n}function hX(e,n,t,r){const a=dX(t);let o=t.bulletCurrent||rN(t);n&&n.type==="list"&&n.ordered&&(o=(typeof n.start=="number"&&n.start>-1?n.start:1)+(t.options.incrementListMarker===!1?0:n.children.indexOf(e))+o);let l=o.length+1;(a==="tab"||a==="mixed"&&(n&&n.type==="list"&&n.spread||e.spread))&&(l=Math.ceil(l/4)*4);const h=t.createTracker(r);h.move(o+" ".repeat(l-o.length)),h.shift(l);const d=t.enter("listItem"),u=t.indentLines(t.containerFlow(e,h.current()),f);return d(),u;function f(g,b,v){return b?(v?"":" ".repeat(l))+g:(v?o:o+" ".repeat(l-o.length))+g}}function fX(e,n,t,r){const a=t.enter("paragraph"),o=t.enter("phrasing"),l=t.containerPhrasing(e,r);return o(),a(),l}const pX=iN(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function mX(e,n,t,r){return(e.children.some(function(l){return pX(l)})?t.containerPhrasing:t.containerFlow).call(t,e,r)}function gX(e){const n=e.options.strong||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize strong with `"+n+"` for `options.strong`, expected `*`, or `_`");return n}uE.peek=yX;function uE(e,n,t,r){const a=gX(t),o=t.enter("strong"),l=t.createTracker(r),h=l.move(a+a);let d=l.move(t.containerPhrasing(e,{after:a,before:h,...l.current()}));const u=d.charCodeAt(0),f=_b(r.before.charCodeAt(r.before.length-1),u,a);f.inside&&(d=Cu(u)+d.slice(1));const g=d.charCodeAt(d.length-1),b=_b(r.after.charCodeAt(0),g,a);b.inside&&(d=d.slice(0,-1)+Cu(g));const v=l.move(a+a);return o(),t.attentionEncodeSurroundingInfo={after:b.outside,before:f.outside},h+d+v}function yX(e,n,t){return t.options.strong||"*"}function xX(e,n,t,r){return t.safe(e.value,r)}function bX(e){const n=e.options.ruleRepetition||3;if(n<3)throw new Error("Cannot serialize rules with repetition `"+n+"` for `options.ruleRepetition`, expected `3` or more");return n}function vX(e,n,t){const r=(cE(t)+(t.options.ruleSpaces?" ":"")).repeat(bX(t));return t.options.ruleSpaces?r.slice(0,-1):r}const wX={blockquote:LK,break:B_,code:BK,definition:qK,emphasis:XT,hardBreak:B_,heading:tX,html:nE,image:iE,imageReference:rE,inlineCode:aE,link:oE,linkReference:lE,list:uX,listItem:hX,paragraph:fX,root:mX,strong:uE,text:xX,thematicBreak:vX},NX=[SX];function SX(e,n,t,r){if(n.type==="code"&&H1(n,r)&&(e.type==="list"||e.type===n.type&&H1(e,r)))return!1;if("spread"in t&&typeof t.spread=="boolean")return e.type==="paragraph"&&(e.type===n.type||n.type==="definition"||n.type==="heading"&&tE(n,r))?void 0:t.spread?1:0}const Gd=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],jX=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Gd},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Gd},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Gd},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Gd},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Gd},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Gd},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Gd},{atBreak:!0,character:"~"}];function _X(e){return e.label||!e.identifier?e.label||"":GT(e.identifier)}function CX(e){if(!e._compiled){const n=(e.atBreak?"[\\r\\n][\\t ]*":"")+(e.before?"(?:"+e.before+")":"");e._compiled=new RegExp((n?"("+n+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(e.character)?"\\":"")+e.character+(e.after?"(?:"+e.after+")":""),"g")}return e._compiled}function kX(e,n,t){const r=n.indexStack,a=e.children||[],o=[];let l=-1,h=t.before,d;r.push(-1);let u=n.createTracker(t);for(;++l<a.length;){const f=a[l];let g;if(r[r.length-1]=l,l+1<a.length){let S=n.handle.handlers[a[l+1].type];S&&S.peek&&(S=S.peek),g=S?S(a[l+1],e,n,{before:"",after:"",...u.current()}).charAt(0):""}else g=t.after;o.length>0&&(h==="\r"||h===`
`)&&f.type==="html"&&(o[o.length-1]=o[o.length-1].replace(/(\r?\n|\r)$/," "),h=" ",u=n.createTracker(t),u.move(o.join("")));let b=n.handle(f,e,n,{...u.current(),after:g,before:h});d&&d===b.slice(0,1)&&(b=Cu(d.charCodeAt(0))+b.slice(1));const v=n.attentionEncodeSurroundingInfo;n.attentionEncodeSurroundingInfo=void 0,d=void 0,v&&(o.length>0&&v.before&&h===o[o.length-1].slice(-1)&&(o[o.length-1]=o[o.length-1].slice(0,-1)+Cu(h.charCodeAt(0))),v.after&&(d=g)),u.move(b),o.push(b),h=b.slice(-1)}return r.pop(),o.join("")}function TX(e,n,t){const r=n.indexStack,a=e.children||[],o=n.createTracker(t),l=[];let h=-1;for(r.push(-1);++h<a.length;){const d=a[h];r[r.length-1]=h,l.push(o.move(n.handle(d,e,n,{before:`
`,after:`
`,...o.current()}))),d.type!=="list"&&(n.bulletLastUsed=void 0),h<a.length-1&&l.push(o.move(EX(d,a[h+1],e,n)))}return r.pop(),l.join("")}function EX(e,n,t,r){let a=r.join.length;for(;a--;){const o=r.join[a](e,n,t,r);if(o===!0||o===1)break;if(typeof o=="number")return`
`.repeat(1+o);if(o===!1)return`

<!---->

`}return`

`}const AX=/\r?\n|\r/g;function DX(e,n){const t=[];let r=0,a=0,o;for(;o=AX.exec(e);)l(e.slice(r,o.index)),t.push(o[0]),r=o.index+o[0].length,a++;return l(e.slice(r)),t.join("");function l(h){t.push(n(h,a,!h))}}function PX(e,n,t){const r=(t.before||"")+(n||"")+(t.after||""),a=[],o=[],l={};let h=-1;for(;++h<e.unsafe.length;){const f=e.unsafe[h];if(!KT(e.stack,f))continue;const g=e.compilePattern(f);let b;for(;b=g.exec(r);){const v="before"in f||!!f.atBreak,S="after"in f,T=b.index+(v?b[1].length:0);a.includes(T)?(l[T].before&&!v&&(l[T].before=!1),l[T].after&&!S&&(l[T].after=!1)):(a.push(T),l[T]={before:v,after:S})}}a.sort(IX);let d=t.before?t.before.length:0;const u=r.length-(t.after?t.after.length:0);for(h=-1;++h<a.length;){const f=a[h];f<d||f>=u||f+1<u&&a[h+1]===f+1&&l[f].after&&!l[f+1].before&&!l[f+1].after||a[h-1]===f-1&&l[f].before&&!l[f-1].before&&!l[f-1].after||(d!==f&&o.push(U_(r.slice(d,f),"\\")),d=f,/[!-/:-@[-`{-~]/.test(r.charAt(f))&&(!t.encode||!t.encode.includes(r.charAt(f)))?o.push("\\"):(o.push(Cu(r.charCodeAt(f))),d++))}return o.push(U_(r.slice(d,u),t.after)),o.join("")}function IX(e,n){return e-n}function U_(e,n){const t=/\\(?=[!-/:-@[-`{-~])/g,r=[],a=[],o=e+n;let l=-1,h=0,d;for(;d=t.exec(o);)r.push(d.index);for(;++l<r.length;)h!==r[l]&&a.push(e.slice(h,r[l])),a.push("\\"),h=r[l];return a.push(e.slice(h)),a.join("")}function MX(e){const n=e||{},t=n.now||{};let r=n.lineShift||0,a=t.line||1,o=t.column||1;return{move:d,current:l,shift:h};function l(){return{now:{line:a,column:o},lineShift:r}}function h(u){r+=u}function d(u){const f=u||"",g=f.split(/\r?\n|\r/g),b=g[g.length-1];return a+=g.length-1,o=g.length===1?o+b.length:1+b.length+r,f}}function RX(e,n){const t=n||{},r={associationId:_X,containerPhrasing:$X,containerFlow:zX,createTracker:MX,compilePattern:CX,enter:o,handlers:{...wX},handle:void 0,indentLines:DX,indexStack:[],join:[...NX],options:{},safe:BX,stack:[],unsafe:[...jX]};JT(r,t),r.options.tightDefinitions&&r.join.push(FX),r.handle=QT("type",{invalid:OX,unknown:LX,handlers:r.handlers});let a=r.handle(e,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return a&&a.charCodeAt(a.length-1)!==10&&a.charCodeAt(a.length-1)!==13&&(a+=`
`),a;function o(l){return r.stack.push(l),h;function h(){r.stack.pop()}}}function OX(e){throw new Error("Cannot handle value `"+e+"`, expected node")}function LX(e){const n=e;throw new Error("Cannot handle unknown node `"+n.type+"`")}function FX(e,n){if(e.type==="definition"&&e.type===n.type)return 0}function $X(e,n){return kX(e,this,n)}function zX(e,n){return TX(e,this,n)}function BX(e,n){return PX(this,e,n)}function UX(e){const n=this;n.compiler=t;function t(r){return RX(r,{...n.data("settings"),...e,extensions:n.data("toMarkdownExtensions")||[]})}}function q_(e){if(e)throw e}var B0,V_;function qX(){if(V_)return B0;V_=1;var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=function(u){return typeof Array.isArray=="function"?Array.isArray(u):n.call(u)==="[object Array]"},o=function(u){if(!u||n.call(u)!=="[object Object]")return!1;var f=e.call(u,"constructor"),g=u.constructor&&u.constructor.prototype&&e.call(u.constructor.prototype,"isPrototypeOf");if(u.constructor&&!f&&!g)return!1;var b;for(b in u);return typeof b>"u"||e.call(u,b)},l=function(u,f){t&&f.name==="__proto__"?t(u,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):u[f.name]=f.newValue},h=function(u,f){if(f==="__proto__")if(e.call(u,f)){if(r)return r(u,f).value}else return;return u[f]};return B0=function d(){var u,f,g,b,v,S,T=arguments[0],E=1,C=arguments.length,P=!1;for(typeof T=="boolean"&&(P=T,T=arguments[1]||{},E=2),(T==null||typeof T!="object"&&typeof T!="function")&&(T={});E<C;++E)if(u=arguments[E],u!=null)for(f in u)g=h(T,f),b=h(u,f),T!==b&&(P&&b&&(o(b)||(v=a(b)))?(v?(v=!1,S=g&&a(g)?g:[]):S=g&&o(g)?g:{},l(T,{name:f,newValue:d(P,S,b)})):typeof b<"u"&&l(T,{name:f,newValue:b}));return T},B0}var VX=qX();const U0=ah(VX);function Y1(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function HX(){const e=[],n={run:t,use:r};return n;function t(...a){let o=-1;const l=a.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);h(null,...a);function h(d,...u){const f=e[++o];let g=-1;if(d){l(d);return}for(;++g<a.length;)(u[g]===null||u[g]===void 0)&&(u[g]=a[g]);a=u,f?GX(f,h)(...u):l(null,...u)}}function r(a){if(typeof a!="function")throw new TypeError("Expected `middelware` to be a function, not "+a);return e.push(a),n}}function GX(e,n){let t;return r;function r(...l){const h=e.length>l.length;let d;h&&l.push(a);try{d=e.apply(this,l)}catch(u){const f=u;if(h&&t)throw f;return a(f)}h||(d&&d.then&&typeof d.then=="function"?d.then(o,a):d instanceof Error?a(d):o(d))}function a(l,...h){t||(t=!0,n(l,...h))}function o(l){a(null,l)}}class Oa extends Error{constructor(n,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let a="",o={},l=!1;if(t&&("line"in t&&"column"in t?o={place:t}:"start"in t&&"end"in t?o={place:t}:"type"in t?o={ancestors:[t],place:t.position}:o={...t}),typeof n=="string"?a=n:!o.cause&&n&&(l=!0,a=n.message,o.cause=n),!o.ruleId&&!o.source&&typeof r=="string"){const d=r.indexOf(":");d===-1?o.ruleId=r:(o.source=r.slice(0,d),o.ruleId=r.slice(d+1))}if(!o.place&&o.ancestors&&o.ancestors){const d=o.ancestors[o.ancestors.length-1];d&&(o.place=d.position)}const h=o.place&&"start"in o.place?o.place.start:o.place;this.ancestors=o.ancestors||void 0,this.cause=o.cause||void 0,this.column=h?h.column:void 0,this.fatal=void 0,this.file="",this.message=a,this.line=h?h.line:void 0,this.name=ng(o.place)||"1:1",this.place=o.place||void 0,this.reason=this.message,this.ruleId=o.ruleId||void 0,this.source=o.source||void 0,this.stack=l&&o.cause&&typeof o.cause.stack=="string"?o.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Oa.prototype.file="";Oa.prototype.name="";Oa.prototype.reason="";Oa.prototype.message="";Oa.prototype.stack="";Oa.prototype.column=void 0;Oa.prototype.line=void 0;Oa.prototype.ancestors=void 0;Oa.prototype.cause=void 0;Oa.prototype.fatal=void 0;Oa.prototype.place=void 0;Oa.prototype.ruleId=void 0;Oa.prototype.source=void 0;const Cl={basename:YX,dirname:WX,extname:QX,join:JX,sep:"/"};function YX(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');_g(e);let t=0,r=-1,a=e.length,o;if(n===void 0||n.length===0||n.length>e.length){for(;a--;)if(e.codePointAt(a)===47){if(o){t=a+1;break}}else r<0&&(o=!0,r=a+1);return r<0?"":e.slice(t,r)}if(n===e)return"";let l=-1,h=n.length-1;for(;a--;)if(e.codePointAt(a)===47){if(o){t=a+1;break}}else l<0&&(o=!0,l=a+1),h>-1&&(e.codePointAt(a)===n.codePointAt(h--)?h<0&&(r=a):(h=-1,r=l));return t===r?r=l:r<0&&(r=e.length),e.slice(t,r)}function WX(e){if(_g(e),e.length===0)return".";let n=-1,t=e.length,r;for(;--t;)if(e.codePointAt(t)===47){if(r){n=t;break}}else r||(r=!0);return n<0?e.codePointAt(0)===47?"/":".":n===1&&e.codePointAt(0)===47?"//":e.slice(0,n)}function QX(e){_g(e);let n=e.length,t=-1,r=0,a=-1,o=0,l;for(;n--;){const h=e.codePointAt(n);if(h===47){if(l){r=n+1;break}continue}t<0&&(l=!0,t=n+1),h===46?a<0?a=n:o!==1&&(o=1):a>-1&&(o=-1)}return a<0||t<0||o===0||o===1&&a===t-1&&a===r+1?"":e.slice(a,t)}function JX(...e){let n=-1,t;for(;++n<e.length;)_g(e[n]),e[n]&&(t=t===void 0?e[n]:t+"/"+e[n]);return t===void 0?".":KX(t)}function KX(e){_g(e);const n=e.codePointAt(0)===47;let t=XX(e,!n);return t.length===0&&!n&&(t="."),t.length>0&&e.codePointAt(e.length-1)===47&&(t+="/"),n?"/"+t:t}function XX(e,n){let t="",r=0,a=-1,o=0,l=-1,h,d;for(;++l<=e.length;){if(l<e.length)h=e.codePointAt(l);else{if(h===47)break;h=47}if(h===47){if(!(a===l-1||o===1))if(a!==l-1&&o===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(d=t.lastIndexOf("/"),d!==t.length-1){d<0?(t="",r=0):(t=t.slice(0,d),r=t.length-1-t.lastIndexOf("/")),a=l,o=0;continue}}else if(t.length>0){t="",r=0,a=l,o=0;continue}}n&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+e.slice(a+1,l):t=e.slice(a+1,l),r=l-a-1;a=l,o=0}else h===46&&o>-1?o++:o=-1}return t}function _g(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const ZX={cwd:eZ};function eZ(){return"/"}function W1(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function tZ(e){if(typeof e=="string")e=new URL(e);else if(!W1(e)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(e.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return nZ(e)}function nZ(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const n=e.pathname;let t=-1;for(;++t<n.length;)if(n.codePointAt(t)===37&&n.codePointAt(t+1)===50){const r=n.codePointAt(t+2);if(r===70||r===102){const a=new TypeError("File URL path must not include encoded / characters");throw a.code="ERR_INVALID_FILE_URL_PATH",a}}return decodeURIComponent(n)}const q0=["history","path","basename","stem","extname","dirname"];class iZ{constructor(n){let t;n?W1(n)?t={path:n}:typeof n=="string"||rZ(n)?t={value:n}:t=n:t={},this.cwd="cwd"in t?"":ZX.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<q0.length;){const o=q0[r];o in t&&t[o]!==void 0&&t[o]!==null&&(this[o]=o==="history"?[...t[o]]:t[o])}let a;for(a in t)q0.includes(a)||(this[a]=t[a])}get basename(){return typeof this.path=="string"?Cl.basename(this.path):void 0}set basename(n){H0(n,"basename"),V0(n,"basename"),this.path=Cl.join(this.dirname||"",n)}get dirname(){return typeof this.path=="string"?Cl.dirname(this.path):void 0}set dirname(n){H_(this.basename,"dirname"),this.path=Cl.join(n||"",this.basename)}get extname(){return typeof this.path=="string"?Cl.extname(this.path):void 0}set extname(n){if(V0(n,"extname"),H_(this.dirname,"extname"),n){if(n.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Cl.join(this.dirname,this.stem+(n||""))}get path(){return this.history[this.history.length-1]}set path(n){W1(n)&&(n=tZ(n)),H0(n,"path"),this.path!==n&&this.history.push(n)}get stem(){return typeof this.path=="string"?Cl.basename(this.path,this.extname):void 0}set stem(n){H0(n,"stem"),V0(n,"stem"),this.path=Cl.join(this.dirname||"",n+(this.extname||""))}fail(n,t,r){const a=this.message(n,t,r);throw a.fatal=!0,a}info(n,t,r){const a=this.message(n,t,r);return a.fatal=void 0,a}message(n,t,r){const a=new Oa(n,t,r);return this.path&&(a.name=this.path+":"+a.name,a.file=this.path),a.fatal=!1,this.messages.push(a),a}toString(n){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(n||void 0).decode(this.value)}}function V0(e,n){if(e&&e.includes(Cl.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+Cl.sep+"`")}function H0(e,n){if(!e)throw new Error("`"+n+"` cannot be empty")}function H_(e,n){if(!e)throw new Error("Setting `"+n+"` requires `path` to be set too")}function rZ(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const aZ=function(e){const r=this.constructor.prototype,a=r[e],o=function(){return a.apply(o,arguments)};return Object.setPrototypeOf(o,r),o},sZ={}.hasOwnProperty;class aN extends aZ{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=HX()}copy(){const n=new aN;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];n.use(...r)}return n.data(U0(!0,{},this.namespace)),n}data(n,t){return typeof n=="string"?arguments.length===2?(W0("data",this.frozen),this.namespace[n]=t,this):sZ.call(this.namespace,n)&&this.namespace[n]||void 0:n?(W0("data",this.frozen),this.namespace=n,this):this.namespace}freeze(){if(this.frozen)return this;const n=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const a=t.call(n,...r);typeof a=="function"&&this.transformers.use(a)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(n){this.freeze();const t=Fx(n),r=this.parser||this.Parser;return G0("parse",r),r(String(t),t)}process(n,t){const r=this;return this.freeze(),G0("process",this.parser||this.Parser),Y0("process",this.compiler||this.Compiler),t?a(void 0,t):new Promise(a);function a(o,l){const h=Fx(n),d=r.parse(h);r.run(d,h,function(f,g,b){if(f||!g||!b)return u(f);const v=g,S=r.stringify(v,b);cZ(S)?b.value=S:b.result=S,u(f,b)});function u(f,g){f||!g?l(f):o?o(g):t(void 0,g)}}}processSync(n){let t=!1,r;return this.freeze(),G0("processSync",this.parser||this.Parser),Y0("processSync",this.compiler||this.Compiler),this.process(n,a),Y_("processSync","process",t),r;function a(o,l){t=!0,q_(o),r=l}}run(n,t,r){G_(n),this.freeze();const a=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?o(void 0,r):new Promise(o);function o(l,h){const d=Fx(t);a.run(n,d,u);function u(f,g,b){const v=g||n;f?h(f):l?l(v):r(void 0,v,b)}}}runSync(n,t){let r=!1,a;return this.run(n,t,o),Y_("runSync","run",r),a;function o(l,h){q_(l),a=h,r=!0}}stringify(n,t){this.freeze();const r=Fx(t),a=this.compiler||this.Compiler;return Y0("stringify",a),G_(n),a(n,r)}use(n,...t){const r=this.attachers,a=this.namespace;if(W0("use",this.frozen),n!=null)if(typeof n=="function")d(n,t);else if(typeof n=="object")Array.isArray(n)?h(n):l(n);else throw new TypeError("Expected usable value, not `"+n+"`");return this;function o(u){if(typeof u=="function")d(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[f,...g]=u;d(f,g)}else l(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function l(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");h(u.plugins),u.settings&&(a.settings=U0(!0,a.settings,u.settings))}function h(u){let f=-1;if(u!=null)if(Array.isArray(u))for(;++f<u.length;){const g=u[f];o(g)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function d(u,f){let g=-1,b=-1;for(;++g<r.length;)if(r[g][0]===u){b=g;break}if(b===-1)r.push([u,...f]);else if(f.length>0){let[v,...S]=f;const T=r[b][1];Y1(T)&&Y1(v)&&(v=U0(!0,T,v)),r[b]=[u,v,...S]}}}}const oZ=new aN().freeze();function G0(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function Y0(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function W0(e,n){if(n)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function G_(e){if(!Y1(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Y_(e,n,t){if(!t)throw new Error("`"+e+"` finished async. Use `"+n+"` instead")}function Fx(e){return lZ(e)?e:new iZ(e)}function lZ(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function cZ(e){return typeof e=="string"||uZ(e)}function uZ(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const dZ=oZ().use(MK).use(UX).freeze(),dE=-1,ev=0,ig=1,Cb=2,sN=3,oN=4,lN=5,cN=6,hE=7,fE=8,W_=typeof self=="object"?self:globalThis,hZ=(e,n)=>{const t=(a,o)=>(e.set(o,a),a),r=a=>{if(e.has(a))return e.get(a);const[o,l]=n[a];switch(o){case ev:case dE:return t(l,a);case ig:{const h=t([],a);for(const d of l)h.push(r(d));return h}case Cb:{const h=t({},a);for(const[d,u]of l)h[r(d)]=r(u);return h}case sN:return t(new Date(l),a);case oN:{const{source:h,flags:d}=l;return t(new RegExp(h,d),a)}case lN:{const h=t(new Map,a);for(const[d,u]of l)h.set(r(d),r(u));return h}case cN:{const h=t(new Set,a);for(const d of l)h.add(r(d));return h}case hE:{const{name:h,message:d}=l;return t(new W_[h](d),a)}case fE:return t(BigInt(l),a);case"BigInt":return t(Object(BigInt(l)),a);case"ArrayBuffer":return t(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:h}=new Uint8Array(l);return t(new DataView(h),l)}}return t(new W_[o](l),a)};return r},Q_=e=>hZ(new Map,e)(0),Lf="",{toString:fZ}={},{keys:pZ}=Object,Wm=e=>{const n=typeof e;if(n!=="object"||!e)return[ev,n];const t=fZ.call(e).slice(8,-1);switch(t){case"Array":return[ig,Lf];case"Object":return[Cb,Lf];case"Date":return[sN,Lf];case"RegExp":return[oN,Lf];case"Map":return[lN,Lf];case"Set":return[cN,Lf];case"DataView":return[ig,t]}return t.includes("Array")?[ig,t]:t.includes("Error")?[hE,t]:[Cb,t]},$x=([e,n])=>e===ev&&(n==="function"||n==="symbol"),mZ=(e,n,t,r)=>{const a=(l,h)=>{const d=r.push(l)-1;return t.set(h,d),d},o=l=>{if(t.has(l))return t.get(l);let[h,d]=Wm(l);switch(h){case ev:{let f=l;switch(d){case"bigint":h=fE,f=l.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+d);f=null;break;case"undefined":return a([dE],l)}return a([h,f],l)}case ig:{if(d){let b=l;return d==="DataView"?b=new Uint8Array(l.buffer):d==="ArrayBuffer"&&(b=new Uint8Array(l)),a([d,[...b]],l)}const f=[],g=a([h,f],l);for(const b of l)f.push(o(b));return g}case Cb:{if(d)switch(d){case"BigInt":return a([d,l.toString()],l);case"Boolean":case"Number":case"String":return a([d,l.valueOf()],l)}if(n&&"toJSON"in l)return o(l.toJSON());const f=[],g=a([h,f],l);for(const b of pZ(l))(e||!$x(Wm(l[b])))&&f.push([o(b),o(l[b])]);return g}case sN:return a([h,l.toISOString()],l);case oN:{const{source:f,flags:g}=l;return a([h,{source:f,flags:g}],l)}case lN:{const f=[],g=a([h,f],l);for(const[b,v]of l)(e||!($x(Wm(b))||$x(Wm(v))))&&f.push([o(b),o(v)]);return g}case cN:{const f=[],g=a([h,f],l);for(const b of l)(e||!$x(Wm(b)))&&f.push(o(b));return g}}const{message:u}=l;return a([h,{name:d,message:u}],l)};return o},J_=(e,{json:n,lossy:t}={})=>{const r=[];return mZ(!(n||t),!!n,new Map,r)(e),r},mg=typeof structuredClone=="function"?(e,n)=>n&&("json"in n||"lossy"in n)?Q_(J_(e,n)):structuredClone(e):(e,n)=>Q_(J_(e,n)),pE=gE("end"),mE=gE("start");function gE(e){return n;function n(t){const r=t&&t.position&&t.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function yE(e){const n=mE(e),t=pE(e);if(n&&t)return{start:n,end:t}}const Yd=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],K_={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...Yd,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...Yd],h2:[["className","sr-only"]],img:[...Yd,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...Yd,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...Yd],table:[...Yd],ul:[...Yd,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},Su={}.hasOwnProperty;function gZ(e,n){let t={type:"root",children:[]};const r={schema:n?{...K_,...n}:K_,stack:[]},a=xE(r,e);return a&&(Array.isArray(a)?a.length===1?t=a[0]:t.children=a:t=a),t}function xE(e,n){if(n&&typeof n=="object"){const t=n;switch(typeof t.type=="string"?t.type:""){case"comment":return yZ(e,t);case"doctype":return xZ(e,t);case"element":return bZ(e,t);case"root":return vZ(e,t);case"text":return wZ(e,t)}}}function yZ(e,n){if(e.schema.allowComments){const t=typeof n.value=="string"?n.value:"",r=t.indexOf("-->"),o={type:"comment",value:r<0?t:t.slice(0,r)};return Cg(o,n),o}}function xZ(e,n){if(e.schema.allowDoctypes){const t={type:"doctype"};return Cg(t,n),t}}function bZ(e,n){const t=typeof n.tagName=="string"?n.tagName:"";e.stack.push(t);const r=bE(e,n.children),a=NZ(e,n.properties);e.stack.pop();let o=!1;if(t&&t!=="*"&&(!e.schema.tagNames||e.schema.tagNames.includes(t))&&(o=!0,e.schema.ancestors&&Su.call(e.schema.ancestors,t))){const h=e.schema.ancestors[t];let d=-1;for(o=!1;++d<h.length;)e.stack.includes(h[d])&&(o=!0)}if(!o)return e.schema.strip&&!e.schema.strip.includes(t)?r:void 0;const l={type:"element",tagName:t,properties:a,children:r};return Cg(l,n),l}function vZ(e,n){const r={type:"root",children:bE(e,n.children)};return Cg(r,n),r}function wZ(e,n){const r={type:"text",value:typeof n.value=="string"?n.value:""};return Cg(r,n),r}function bE(e,n){const t=[];if(Array.isArray(n)){const r=n;let a=-1;for(;++a<r.length;){const o=xE(e,r[a]);o&&(Array.isArray(o)?t.push(...o):t.push(o))}}return t}function NZ(e,n){const t=e.stack[e.stack.length-1],r=e.schema.attributes,a=e.schema.required,o=r&&Su.call(r,t)?r[t]:void 0,l=r&&Su.call(r,"*")?r["*"]:void 0,h=n&&typeof n=="object"?n:{},d={};let u;for(u in h)if(Su.call(h,u)){const f=h[u];let g=X_(e,Z_(o,u),u,f);g==null&&(g=X_(e,Z_(l,u),u,f)),g!=null&&(d[u]=g)}if(a&&Su.call(a,t)){const f=a[t];for(u in f)Su.call(f,u)&&!Su.call(d,u)&&(d[u]=f[u])}return d}function X_(e,n,t,r){return n?Array.isArray(r)?SZ(e,n,t,r):vE(e,n,t,r):void 0}function SZ(e,n,t,r){let a=-1;const o=[];for(;++a<r.length;){const l=vE(e,n,t,r[a]);(typeof l=="number"||typeof l=="string")&&o.push(l)}return o}function vE(e,n,t,r){if(!(typeof r!="boolean"&&typeof r!="number"&&typeof r!="string")&&jZ(e,t,r)){if(typeof n=="object"&&n.length>1){let a=!1,o=0;for(;++o<n.length;){const l=n[o];if(l&&typeof l=="object"&&"flags"in l){if(l.test(String(r))){a=!0;break}}else if(l===r){a=!0;break}}if(!a)return}return e.schema.clobber&&e.schema.clobberPrefix&&e.schema.clobber.includes(t)?e.schema.clobberPrefix+r:r}}function jZ(e,n,t){const r=e.schema.protocols&&Su.call(e.schema.protocols,n)?e.schema.protocols[n]:void 0;if(!r||r.length===0)return!0;const a=String(t),o=a.indexOf(":"),l=a.indexOf("?"),h=a.indexOf("#"),d=a.indexOf("/");if(o<0||d>-1&&o>d||l>-1&&o>l||h>-1&&o>h)return!0;let u=-1;for(;++u<r.length;){const f=r[u];if(o===f.length&&a.slice(0,f.length)===f)return!0}return!1}function Cg(e,n){const t=yE(n);n.data&&(e.data=mg(n.data)),t&&(e.position=t)}function Z_(e,n){let t,r=-1;if(e)for(;++r<e.length;){const a=e[r],o=typeof a=="string"?a:a[0];if(o===n)return a;o==="data*"&&(t=a)}if(n.length>4&&n.slice(0,4).toLowerCase()==="data")return t}function _Z(e,n){const t={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(n),!0)};return e.patch(n,t),e.applyData(n,t)}function CZ(e,n){const t={type:"element",tagName:"br",properties:{},children:[]};return e.patch(n,t),[e.applyData(n,t),{type:"text",value:`
`}]}function kZ(e,n){const t=n.value?n.value+`
`:"",r={};n.lang&&(r.className=["language-"+n.lang]);let a={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return n.meta&&(a.data={meta:n.meta}),e.patch(n,a),a=e.applyData(n,a),a={type:"element",tagName:"pre",properties:{},children:[a]},e.patch(n,a),a}function TZ(e,n){const t={type:"element",tagName:"del",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function EZ(e,n){const t={type:"element",tagName:"em",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function AZ(e,n){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(n.identifier).toUpperCase(),a=fp(r.toLowerCase()),o=e.footnoteOrder.indexOf(r);let l,h=e.footnoteCounts.get(r);h===void 0?(h=0,e.footnoteOrder.push(r),l=e.footnoteOrder.length):l=o+1,h+=1,e.footnoteCounts.set(r,h);const d={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+a,id:t+"fnref-"+a+(h>1?"-"+h:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};e.patch(n,d);const u={type:"element",tagName:"sup",properties:{},children:[d]};return e.patch(n,u),e.applyData(n,u)}function DZ(e,n){const t={type:"element",tagName:"h"+n.depth,properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function PZ(e,n){if(e.options.allowDangerousHtml){const t={type:"raw",value:n.value};return e.patch(n,t),e.applyData(n,t)}}function wE(e,n){const t=n.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return[{type:"text",value:"!["+n.alt+r}];const a=e.all(n),o=a[0];o&&o.type==="text"?o.value="["+o.value:a.unshift({type:"text",value:"["});const l=a[a.length-1];return l&&l.type==="text"?l.value+=r:a.push({type:"text",value:r}),a}function IZ(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return wE(e,n);const a={src:fp(r.url||""),alt:n.alt};r.title!==null&&r.title!==void 0&&(a.title=r.title);const o={type:"element",tagName:"img",properties:a,children:[]};return e.patch(n,o),e.applyData(n,o)}function MZ(e,n){const t={src:fp(n.url)};n.alt!==null&&n.alt!==void 0&&(t.alt=n.alt),n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"img",properties:t,children:[]};return e.patch(n,r),e.applyData(n,r)}function RZ(e,n){const t={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};e.patch(n,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return e.patch(n,r),e.applyData(n,r)}function OZ(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return wE(e,n);const a={href:fp(r.url||"")};r.title!==null&&r.title!==void 0&&(a.title=r.title);const o={type:"element",tagName:"a",properties:a,children:e.all(n)};return e.patch(n,o),e.applyData(n,o)}function LZ(e,n){const t={href:fp(n.url)};n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"a",properties:t,children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function FZ(e,n,t){const r=e.all(n),a=t?$Z(t):NE(n),o={},l=[];if(typeof n.checked=="boolean"){const f=r[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},r.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let h=-1;for(;++h<r.length;){const f=r[h];(a||h!==0||f.type!=="element"||f.tagName!=="p")&&l.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!a?l.push(...f.children):l.push(f)}const d=r[r.length-1];d&&(a||d.type!=="element"||d.tagName!=="p")&&l.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:o,children:l};return e.patch(n,u),e.applyData(n,u)}function $Z(e){let n=!1;if(e.type==="list"){n=e.spread||!1;const t=e.children;let r=-1;for(;!n&&++r<t.length;)n=NE(t[r])}return n}function NE(e){const n=e.spread;return n??e.children.length>1}function zZ(e,n){const t={},r=e.all(n);let a=-1;for(typeof n.start=="number"&&n.start!==1&&(t.start=n.start);++a<r.length;){const l=r[a];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const o={type:"element",tagName:n.ordered?"ol":"ul",properties:t,children:e.wrap(r,!0)};return e.patch(n,o),e.applyData(n,o)}function BZ(e,n){const t={type:"element",tagName:"p",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function UZ(e,n){const t={type:"root",children:e.wrap(e.all(n))};return e.patch(n,t),e.applyData(n,t)}function qZ(e,n){const t={type:"element",tagName:"strong",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function VZ(e,n){const t=e.all(n),r=t.shift(),a=[];if(r){const l={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(n.children[0],l),a.push(l)}if(t.length>0){const l={type:"element",tagName:"tbody",properties:{},children:e.wrap(t,!0)},h=mE(n.children[1]),d=pE(n.children[n.children.length-1]);h&&d&&(l.position={start:h,end:d}),a.push(l)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(a,!0)};return e.patch(n,o),e.applyData(n,o)}function HZ(e,n,t){const r=t?t.children:void 0,o=(r?r.indexOf(n):1)===0?"th":"td",l=t&&t.type==="table"?t.align:void 0,h=l?l.length:n.children.length;let d=-1;const u=[];for(;++d<h;){const g=n.children[d],b={},v=l?l[d]:void 0;v&&(b.align=v);let S={type:"element",tagName:o,properties:b,children:[]};g&&(S.children=e.all(g),e.patch(g,S),S=e.applyData(g,S)),u.push(S)}const f={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(n,f),e.applyData(n,f)}function GZ(e,n){const t={type:"element",tagName:"td",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}const eC=9,tC=32;function YZ(e){const n=String(e),t=/\r?\n|\r/g;let r=t.exec(n),a=0;const o=[];for(;r;)o.push(nC(n.slice(a,r.index),a>0,!0),r[0]),a=r.index+r[0].length,r=t.exec(n);return o.push(nC(n.slice(a),a>0,!1)),o.join("")}function nC(e,n,t){let r=0,a=e.length;if(n){let o=e.codePointAt(r);for(;o===eC||o===tC;)r++,o=e.codePointAt(r)}if(t){let o=e.codePointAt(a-1);for(;o===eC||o===tC;)a--,o=e.codePointAt(a-1)}return a>r?e.slice(r,a):""}function WZ(e,n){const t={type:"text",value:YZ(String(n.value))};return e.patch(n,t),e.applyData(n,t)}function QZ(e,n){const t={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(n,t),e.applyData(n,t)}const JZ={blockquote:_Z,break:CZ,code:kZ,delete:TZ,emphasis:EZ,footnoteReference:AZ,heading:DZ,html:PZ,imageReference:IZ,image:MZ,inlineCode:RZ,linkReference:OZ,link:LZ,listItem:FZ,list:zZ,paragraph:BZ,root:UZ,strong:qZ,table:VZ,tableCell:GZ,tableRow:HZ,text:WZ,thematicBreak:QZ,toml:zx,yaml:zx,definition:zx,footnoteDefinition:zx};function zx(){}function KZ(e,n){const t=[{type:"text",value:""}];return n>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(n)}]}),t}function XZ(e,n){return"Back to reference "+(e+1)+(n>1?"-"+n:"")}function ZZ(e){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",t=e.options.footnoteBackContent||KZ,r=e.options.footnoteBackLabel||XZ,a=e.options.footnoteLabel||"Footnotes",o=e.options.footnoteLabelTagName||"h2",l=e.options.footnoteLabelProperties||{className:["sr-only"]},h=[];let d=-1;for(;++d<e.footnoteOrder.length;){const u=e.footnoteById.get(e.footnoteOrder[d]);if(!u)continue;const f=e.all(u),g=String(u.identifier).toUpperCase(),b=fp(g.toLowerCase());let v=0;const S=[],T=e.footnoteCounts.get(g);for(;T!==void 0&&++v<=T;){S.length>0&&S.push({type:"text",value:" "});let P=typeof t=="string"?t:t(d,v);typeof P=="string"&&(P={type:"text",value:P}),S.push({type:"element",tagName:"a",properties:{href:"#"+n+"fnref-"+b+(v>1?"-"+v:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(d,v),className:["data-footnote-backref"]},children:Array.isArray(P)?P:[P]})}const E=f[f.length-1];if(E&&E.type==="element"&&E.tagName==="p"){const P=E.children[E.children.length-1];P&&P.type==="text"?P.value+=" ":E.children.push({type:"text",value:" "}),E.children.push(...S)}else f.push(...S);const C={type:"element",tagName:"li",properties:{id:n+"fn-"+b},children:e.wrap(f,!0)};e.patch(u,C),h.push(C)}if(h.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...mg(l),id:"footnote-label"},children:[{type:"text",value:a}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(h,!0)},{type:"text",value:`
`}]}}const Q1={}.hasOwnProperty,eee={};function tee(e,n){const t=n||eee,r=new Map,a=new Map,o=new Map,l={...JZ,...t.handlers},h={all:u,applyData:iee,definitionById:r,footnoteById:a,footnoteCounts:o,footnoteOrder:[],handlers:l,one:d,options:t,patch:nee,wrap:aee};return eE(e,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?r:a,b=String(f.identifier).toUpperCase();g.has(b)||g.set(b,f)}}),h;function d(f,g){const b=f.type,v=h.handlers[b];if(Q1.call(h.handlers,b)&&v)return v(h,f,g);if(h.options.passThrough&&h.options.passThrough.includes(b)){if("children"in f){const{children:T,...E}=f,C=mg(E);return C.children=h.all(f),C}return mg(f)}return(h.options.unknownHandler||ree)(h,f,g)}function u(f){const g=[];if("children"in f){const b=f.children;let v=-1;for(;++v<b.length;){const S=h.one(b[v],f);if(S){if(v&&b[v-1].type==="break"&&(!Array.isArray(S)&&S.type==="text"&&(S.value=iC(S.value)),!Array.isArray(S)&&S.type==="element")){const T=S.children[0];T&&T.type==="text"&&(T.value=iC(T.value))}Array.isArray(S)?g.push(...S):g.push(S)}}}return g}}function nee(e,n){e.position&&(n.position=yE(e))}function iee(e,n){let t=n;if(e&&e.data){const r=e.data.hName,a=e.data.hChildren,o=e.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const l="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:l}}t.type==="element"&&o&&Object.assign(t.properties,mg(o)),"children"in t&&t.children&&a!==null&&a!==void 0&&(t.children=a)}return t}function ree(e,n){const t=n.data||{},r="value"in n&&!(Q1.call(t,"hProperties")||Q1.call(t,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function aee(e,n){const t=[];let r=-1;for(n&&t.push({type:"text",value:`
`});++r<e.length;)r&&t.push({type:"text",value:`
`}),t.push(e[r]);return n&&e.length>0&&t.push({type:"text",value:`
`}),t}function iC(e){let n=0,t=e.charCodeAt(n);for(;t===9||t===32;)n++,t=e.charCodeAt(n);return e.slice(n)}function see(e,n){const t=tee(e,n),r=t.one(e,void 0),a=ZZ(t),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return a&&o.children.push({type:"text",value:`
`},a),o}const oee=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"];class kg{constructor(n,t,r){this.normal=t,this.property=n,r&&(this.space=r)}}kg.prototype.normal={};kg.prototype.property={};kg.prototype.space=void 0;function SE(e,n){const t={},r={};for(const a of e)Object.assign(t,a.property),Object.assign(r,a.normal);return new kg(t,r,n)}function J1(e){return e.toLowerCase()}class La{constructor(n,t){this.attribute=t,this.property=n}}La.prototype.attribute="";La.prototype.booleanish=!1;La.prototype.boolean=!1;La.prototype.commaOrSpaceSeparated=!1;La.prototype.commaSeparated=!1;La.prototype.defined=!1;La.prototype.mustUseProperty=!1;La.prototype.number=!1;La.prototype.overloadedBoolean=!1;La.prototype.property="";La.prototype.spaceSeparated=!1;La.prototype.space=void 0;let lee=0;const hn=lh(),rr=lh(),K1=lh(),xt=lh(),vi=lh(),Jf=lh(),as=lh();function lh(){return 2**++lee}const X1=Object.freeze(Object.defineProperty({__proto__:null,boolean:hn,booleanish:rr,commaOrSpaceSeparated:as,commaSeparated:Jf,number:xt,overloadedBoolean:K1,spaceSeparated:vi},Symbol.toStringTag,{value:"Module"})),Q0=Object.keys(X1);class uN extends La{constructor(n,t,r,a){let o=-1;if(super(n,t),rC(this,"space",a),typeof r=="number")for(;++o<Q0.length;){const l=Q0[o];rC(this,Q0[o],(r&X1[l])===X1[l])}}}uN.prototype.defined=!0;function rC(e,n,t){t&&(e[n]=t)}function pp(e){const n={},t={};for(const[r,a]of Object.entries(e.properties)){const o=new uN(r,e.transform(e.attributes||{},r),a,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),n[r]=o,t[J1(r)]=r,t[J1(o.attribute)]=r}return new kg(n,t,e.space)}const jE=pp({properties:{ariaActiveDescendant:null,ariaAtomic:rr,ariaAutoComplete:null,ariaBusy:rr,ariaChecked:rr,ariaColCount:xt,ariaColIndex:xt,ariaColSpan:xt,ariaControls:vi,ariaCurrent:null,ariaDescribedBy:vi,ariaDetails:null,ariaDisabled:rr,ariaDropEffect:vi,ariaErrorMessage:null,ariaExpanded:rr,ariaFlowTo:vi,ariaGrabbed:rr,ariaHasPopup:null,ariaHidden:rr,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:vi,ariaLevel:xt,ariaLive:null,ariaModal:rr,ariaMultiLine:rr,ariaMultiSelectable:rr,ariaOrientation:null,ariaOwns:vi,ariaPlaceholder:null,ariaPosInSet:xt,ariaPressed:rr,ariaReadOnly:rr,ariaRelevant:null,ariaRequired:rr,ariaRoleDescription:vi,ariaRowCount:xt,ariaRowIndex:xt,ariaRowSpan:xt,ariaSelected:rr,ariaSetSize:xt,ariaSort:null,ariaValueMax:xt,ariaValueMin:xt,ariaValueNow:xt,ariaValueText:null,role:null},transform(e,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function _E(e,n){return n in e?e[n]:n}function CE(e,n){return _E(e,n.toLowerCase())}const cee=pp({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Jf,acceptCharset:vi,accessKey:vi,action:null,allow:null,allowFullScreen:hn,allowPaymentRequest:hn,allowUserMedia:hn,alt:null,as:null,async:hn,autoCapitalize:null,autoComplete:vi,autoFocus:hn,autoPlay:hn,blocking:vi,capture:null,charSet:null,checked:hn,cite:null,className:vi,cols:xt,colSpan:null,content:null,contentEditable:rr,controls:hn,controlsList:vi,coords:xt|Jf,crossOrigin:null,data:null,dateTime:null,decoding:null,default:hn,defer:hn,dir:null,dirName:null,disabled:hn,download:K1,draggable:rr,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:hn,formTarget:null,headers:vi,height:xt,hidden:K1,high:xt,href:null,hrefLang:null,htmlFor:vi,httpEquiv:vi,id:null,imageSizes:null,imageSrcSet:null,inert:hn,inputMode:null,integrity:null,is:null,isMap:hn,itemId:null,itemProp:vi,itemRef:vi,itemScope:hn,itemType:vi,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:hn,low:xt,manifest:null,max:null,maxLength:xt,media:null,method:null,min:null,minLength:xt,multiple:hn,muted:hn,name:null,nonce:null,noModule:hn,noValidate:hn,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:hn,optimum:xt,pattern:null,ping:vi,placeholder:null,playsInline:hn,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:hn,referrerPolicy:null,rel:vi,required:hn,reversed:hn,rows:xt,rowSpan:xt,sandbox:vi,scope:null,scoped:hn,seamless:hn,selected:hn,shadowRootClonable:hn,shadowRootDelegatesFocus:hn,shadowRootMode:null,shape:null,size:xt,sizes:null,slot:null,span:xt,spellCheck:rr,src:null,srcDoc:null,srcLang:null,srcSet:null,start:xt,step:null,style:null,tabIndex:xt,target:null,title:null,translate:null,type:null,typeMustMatch:hn,useMap:null,value:rr,width:xt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:vi,axis:null,background:null,bgColor:null,border:xt,borderColor:null,bottomMargin:xt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:hn,declare:hn,event:null,face:null,frame:null,frameBorder:null,hSpace:xt,leftMargin:xt,link:null,longDesc:null,lowSrc:null,marginHeight:xt,marginWidth:xt,noResize:hn,noHref:hn,noShade:hn,noWrap:hn,object:null,profile:null,prompt:null,rev:null,rightMargin:xt,rules:null,scheme:null,scrolling:rr,standby:null,summary:null,text:null,topMargin:xt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:xt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:hn,disableRemotePlayback:hn,prefix:null,property:null,results:xt,security:null,unselectable:null},space:"html",transform:CE}),uee=pp({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:as,accentHeight:xt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:xt,amplitude:xt,arabicForm:null,ascent:xt,attributeName:null,attributeType:null,azimuth:xt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:xt,by:null,calcMode:null,capHeight:xt,className:vi,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:xt,diffuseConstant:xt,direction:null,display:null,dur:null,divisor:xt,dominantBaseline:null,download:hn,dx:null,dy:null,edgeMode:null,editable:null,elevation:xt,enableBackground:null,end:null,event:null,exponent:xt,externalResourcesRequired:null,fill:null,fillOpacity:xt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Jf,g2:Jf,glyphName:Jf,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:xt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:xt,horizOriginX:xt,horizOriginY:xt,id:null,ideographic:xt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:xt,k:xt,k1:xt,k2:xt,k3:xt,k4:xt,kernelMatrix:as,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:xt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:xt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:xt,overlineThickness:xt,paintOrder:null,panose1:null,path:null,pathLength:xt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:vi,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:xt,pointsAtY:xt,pointsAtZ:xt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:as,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:as,rev:as,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:as,requiredFeatures:as,requiredFonts:as,requiredFormats:as,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:xt,specularExponent:xt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:xt,strikethroughThickness:xt,string:null,stroke:null,strokeDashArray:as,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:xt,strokeOpacity:xt,strokeWidth:null,style:null,surfaceScale:xt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:as,tabIndex:xt,tableValues:null,target:null,targetX:xt,targetY:xt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:as,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:xt,underlineThickness:xt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:xt,values:null,vAlphabetic:xt,vMathematical:xt,vectorEffect:null,vHanging:xt,vIdeographic:xt,version:null,vertAdvY:xt,vertOriginX:xt,vertOriginY:xt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:xt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:_E}),kE=pp({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,n){return"xlink:"+n.slice(5).toLowerCase()}}),TE=pp({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:CE}),EE=pp({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,n){return"xml:"+n.slice(3).toLowerCase()}}),dee=/[A-Z]/g,aC=/-[a-z]/g,hee=/^data[-\w.:]+$/i;function fee(e,n){const t=J1(n);let r=n,a=La;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&hee.test(n)){if(n.charAt(4)==="-"){const o=n.slice(5).replace(aC,mee);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=n.slice(4);if(!aC.test(o)){let l=o.replace(dee,pee);l.charAt(0)!=="-"&&(l="-"+l),n="data"+l}}a=uN}return new a(r,n)}function pee(e){return"-"+e.toLowerCase()}function mee(e){return e.charAt(1).toUpperCase()}const gee=SE([jE,cee,kE,TE,EE],"html"),AE=SE([jE,uee,kE,TE,EE],"svg"),yee=/["&'<>`]/g,xee=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,bee=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,vee=/[|\\{}()[\]^$+*?.]/g,sC=new WeakMap;function wee(e,n){if(e=e.replace(n.subset?Nee(n.subset):yee,r),n.subset||n.escapeOnly)return e;return e.replace(xee,t).replace(bee,r);function t(a,o,l){return n.format((a.charCodeAt(0)-55296)*1024+a.charCodeAt(1)-56320+65536,l.charCodeAt(o+2),n)}function r(a,o,l){return n.format(a.charCodeAt(0),l.charCodeAt(o+1),n)}}function Nee(e){let n=sC.get(e);return n||(n=See(e),sC.set(e,n)),n}function See(e){const n=[];let t=-1;for(;++t<e.length;)n.push(e[t].replace(vee,"\\$&"));return new RegExp("(?:"+n.join("|")+")","g")}const jee=/[\dA-Fa-f]/;function _ee(e,n,t){const r="&#x"+e.toString(16).toUpperCase();return t&&n&&!jee.test(String.fromCharCode(n))?r:r+";"}const Cee=/\d/;function kee(e,n,t){const r="&#"+String(e);return t&&n&&!Cee.test(String.fromCharCode(n))?r:r+";"}const Tee=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],J0={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},Eee=["cent","copy","divide","gt","lt","not","para","times"],DE={}.hasOwnProperty,Z1={};let Bx;for(Bx in J0)DE.call(J0,Bx)&&(Z1[J0[Bx]]=Bx);const Aee=/[^\dA-Za-z]/;function Dee(e,n,t,r){const a=String.fromCharCode(e);if(DE.call(Z1,a)){const o=Z1[a],l="&"+o;return t&&Tee.includes(o)&&!Eee.includes(o)&&(!r||n&&n!==61&&Aee.test(String.fromCharCode(n)))?l:l+";"}return""}function Pee(e,n,t){let r=_ee(e,n,t.omitOptionalSemicolons),a;if((t.useNamedReferences||t.useShortestReferences)&&(a=Dee(e,n,t.omitOptionalSemicolons,t.attribute)),(t.useShortestReferences||!a)&&t.useShortestReferences){const o=kee(e,n,t.omitOptionalSemicolons);o.length<r.length&&(r=o)}return a&&(!t.useShortestReferences||a.length<r.length)?a:r}function Kf(e,n){return wee(e,Object.assign({format:Pee},n))}const Iee=/^>|^->|<!--|-->|--!>|<!-$/g,Mee=[">"],Ree=["<",">"];function Oee(e,n,t,r){return r.settings.bogusComments?"<?"+Kf(e.value,Object.assign({},r.settings.characterReferences,{subset:Mee}))+">":"<!--"+e.value.replace(Iee,a)+"-->";function a(o){return Kf(o,Object.assign({},r.settings.characterReferences,{subset:Ree}))}}function Lee(e,n,t,r){return"<!"+(r.settings.upperDoctype?"DOCTYPE":"doctype")+(r.settings.tightDoctype?"":" ")+"html>"}function oC(e,n){const t=String(e);if(typeof n!="string")throw new TypeError("Expected character");let r=0,a=t.indexOf(n);for(;a!==-1;)r++,a=t.indexOf(n,a+n.length);return r}function Fee(e,n){const t=n||{};return(e[e.length-1]===""?[...e,""]:e).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}function $ee(e){return e.join(" ").trim()}const zee=/[ \t\n\f\r]/g;function dN(e){return typeof e=="object"?e.type==="text"?lC(e.value):!1:lC(e)}function lC(e){return e.replace(zee,"")===""}const dr=IE(1),PE=IE(-1),Bee=[];function IE(e){return n;function n(t,r,a){const o=t?t.children:Bee;let l=(r||0)+e,h=o[l];if(!a)for(;h&&dN(h);)l+=e,h=o[l];return h}}const Uee={}.hasOwnProperty;function ME(e){return n;function n(t,r,a){return Uee.call(e,t.tagName)&&e[t.tagName](t,r,a)}}const hN=ME({body:Vee,caption:K0,colgroup:K0,dd:Wee,dt:Yee,head:K0,html:qee,li:Gee,optgroup:Qee,option:Jee,p:Hee,rp:cC,rt:cC,tbody:Xee,td:uC,tfoot:Zee,th:uC,thead:Kee,tr:ete});function K0(e,n,t){const r=dr(t,n,!0);return!r||r.type!=="comment"&&!(r.type==="text"&&dN(r.value.charAt(0)))}function qee(e,n,t){const r=dr(t,n);return!r||r.type!=="comment"}function Vee(e,n,t){const r=dr(t,n);return!r||r.type!=="comment"}function Hee(e,n,t){const r=dr(t,n);return r?r.type==="element"&&(r.tagName==="address"||r.tagName==="article"||r.tagName==="aside"||r.tagName==="blockquote"||r.tagName==="details"||r.tagName==="div"||r.tagName==="dl"||r.tagName==="fieldset"||r.tagName==="figcaption"||r.tagName==="figure"||r.tagName==="footer"||r.tagName==="form"||r.tagName==="h1"||r.tagName==="h2"||r.tagName==="h3"||r.tagName==="h4"||r.tagName==="h5"||r.tagName==="h6"||r.tagName==="header"||r.tagName==="hgroup"||r.tagName==="hr"||r.tagName==="main"||r.tagName==="menu"||r.tagName==="nav"||r.tagName==="ol"||r.tagName==="p"||r.tagName==="pre"||r.tagName==="section"||r.tagName==="table"||r.tagName==="ul"):!t||!(t.type==="element"&&(t.tagName==="a"||t.tagName==="audio"||t.tagName==="del"||t.tagName==="ins"||t.tagName==="map"||t.tagName==="noscript"||t.tagName==="video"))}function Gee(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&r.tagName==="li"}function Yee(e,n,t){const r=dr(t,n);return!!(r&&r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd"))}function Wee(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd")}function cC(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&(r.tagName==="rp"||r.tagName==="rt")}function Qee(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&r.tagName==="optgroup"}function Jee(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&(r.tagName==="option"||r.tagName==="optgroup")}function Kee(e,n,t){const r=dr(t,n);return!!(r&&r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot"))}function Xee(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot")}function Zee(e,n,t){return!dr(t,n)}function ete(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&r.tagName==="tr"}function uC(e,n,t){const r=dr(t,n);return!r||r.type==="element"&&(r.tagName==="td"||r.tagName==="th")}const tte=ME({body:rte,colgroup:ate,head:ite,html:nte,tbody:ste});function nte(e){const n=dr(e,-1);return!n||n.type!=="comment"}function ite(e){const n=new Set;for(const r of e.children)if(r.type==="element"&&(r.tagName==="base"||r.tagName==="title")){if(n.has(r.tagName))return!1;n.add(r.tagName)}const t=e.children[0];return!t||t.type==="element"}function rte(e){const n=dr(e,-1,!0);return!n||n.type!=="comment"&&!(n.type==="text"&&dN(n.value.charAt(0)))&&!(n.type==="element"&&(n.tagName==="meta"||n.tagName==="link"||n.tagName==="script"||n.tagName==="style"||n.tagName==="template"))}function ate(e,n,t){const r=PE(t,n),a=dr(e,-1,!0);return t&&r&&r.type==="element"&&r.tagName==="colgroup"&&hN(r,t.children.indexOf(r),t)?!1:!!(a&&a.type==="element"&&a.tagName==="col")}function ste(e,n,t){const r=PE(t,n),a=dr(e,-1);return t&&r&&r.type==="element"&&(r.tagName==="thead"||r.tagName==="tbody")&&hN(r,t.children.indexOf(r),t)?!1:!!(a&&a.type==="element"&&a.tagName==="tr")}const Ux={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function ote(e,n,t,r){const a=r.schema,o=a.space==="svg"?!1:r.settings.omitOptionalTags;let l=a.space==="svg"?r.settings.closeEmptyElements:r.settings.voids.includes(e.tagName.toLowerCase());const h=[];let d;a.space==="html"&&e.tagName==="svg"&&(r.schema=AE);const u=lte(r,e.properties),f=r.all(a.space==="html"&&e.tagName==="template"?e.content:e);return r.schema=a,f&&(l=!1),(u||!o||!tte(e,n,t))&&(h.push("<",e.tagName,u?" "+u:""),l&&(a.space==="svg"||r.settings.closeSelfClosing)&&(d=u.charAt(u.length-1),(!r.settings.tightSelfClosing||d==="/"||d&&d!=='"'&&d!=="'")&&h.push(" "),h.push("/")),h.push(">")),h.push(f),!l&&(!o||!hN(e,n,t))&&h.push("</"+e.tagName+">"),h.join("")}function lte(e,n){const t=[];let r=-1,a;if(n){for(a in n)if(n[a]!==null&&n[a]!==void 0){const o=cte(e,a,n[a]);o&&t.push(o)}}for(;++r<t.length;){const o=e.settings.tightAttributes?t[r].charAt(t[r].length-1):void 0;r!==t.length-1&&o!=='"'&&o!=="'"&&(t[r]+=" ")}return t.join("")}function cte(e,n,t){const r=fee(e.schema,n),a=e.settings.allowParseErrors&&e.schema.space==="html"?0:1,o=e.settings.allowDangerousCharacters?0:1;let l=e.quote,h;if(r.overloadedBoolean&&(t===r.attribute||t==="")?t=!0:(r.boolean||r.overloadedBoolean)&&(typeof t!="string"||t===r.attribute||t==="")&&(t=!!t),t==null||t===!1||typeof t=="number"&&Number.isNaN(t))return"";const d=Kf(r.attribute,Object.assign({},e.settings.characterReferences,{subset:Ux.name[a][o]}));return t===!0||(t=Array.isArray(t)?(r.commaSeparated?Fee:$ee)(t,{padLeft:!e.settings.tightCommaSeparatedLists}):String(t),e.settings.collapseEmptyAttributes&&!t)?d:(e.settings.preferUnquoted&&(h=Kf(t,Object.assign({},e.settings.characterReferences,{attribute:!0,subset:Ux.unquoted[a][o]}))),h!==t&&(e.settings.quoteSmart&&oC(t,l)>oC(t,e.alternative)&&(l=e.alternative),h=l+Kf(t,Object.assign({},e.settings.characterReferences,{subset:(l==="'"?Ux.single:Ux.double)[a][o],attribute:!0}))+l),d+(h&&"="+h))}const ute=["<","&"];function RE(e,n,t,r){return t&&t.type==="element"&&(t.tagName==="script"||t.tagName==="style")?e.value:Kf(e.value,Object.assign({},r.settings.characterReferences,{subset:ute}))}function dte(e,n,t,r){return r.settings.allowDangerousHtml?e.value:RE(e,n,t,r)}function hte(e,n,t,r){return r.all(e)}const fte=QT("type",{invalid:pte,unknown:mte,handlers:{comment:Oee,doctype:Lee,element:ote,raw:dte,root:hte,text:RE}});function pte(e){throw new Error("Expected node, not `"+e+"`")}function mte(e){const n=e;throw new Error("Cannot compile unknown node `"+n.type+"`")}const gte={},yte={},xte=[];function bte(e,n){const t=n||gte,r=t.quote||'"',a=r==='"'?"'":'"';if(r!=='"'&&r!=="'")throw new Error("Invalid quote `"+r+"`, expected `'` or `\"`");return{one:vte,all:wte,settings:{omitOptionalTags:t.omitOptionalTags||!1,allowParseErrors:t.allowParseErrors||!1,allowDangerousCharacters:t.allowDangerousCharacters||!1,quoteSmart:t.quoteSmart||!1,preferUnquoted:t.preferUnquoted||!1,tightAttributes:t.tightAttributes||!1,upperDoctype:t.upperDoctype||!1,tightDoctype:t.tightDoctype||!1,bogusComments:t.bogusComments||!1,tightCommaSeparatedLists:t.tightCommaSeparatedLists||!1,tightSelfClosing:t.tightSelfClosing||!1,collapseEmptyAttributes:t.collapseEmptyAttributes||!1,allowDangerousHtml:t.allowDangerousHtml||!1,voids:t.voids||oee,characterReferences:t.characterReferences||yte,closeSelfClosing:t.closeSelfClosing||!1,closeEmptyElements:t.closeEmptyElements||!1},schema:t.space==="svg"?AE:gee,quote:r,alternative:a}.one(Array.isArray(e)?{type:"root",children:e}:e,void 0,void 0)}function vte(e,n,t){return fte(e,n,t,this)}function wte(e){const n=[],t=e&&e.children||xte;let r=-1;for(;++r<t.length;)n[r]=this.one(t[r],r,e);return n.join("")}const Nte={};function Ste(e){const n=this,{handlers:t,sanitize:r,...a}=e||Nte;let o=!1,l;typeof r=="boolean"?o=!r:r&&(l=r),n.compiler=h;function h(d,u){const f=see(d,{handlers:t,allowDangerousHtml:o}),g=o?f:gZ(f,l),b=bte(g,{...a,allowDangerousHtml:o});return u.extname&&(u.extname=".html"),d&&d.type==="root"&&b&&/[^\r\n]/.test(b.charAt(b.length-1))?b+`
`:b}}const jte=()=>{var Kl,nl,Pr;const{recordId:e}=ia(),n=Ft(),t=$r(),[r,a]=w.useState(""),[o,l]=w.useState([]),h=(G,le)=>{l(se=>[...se,{id:crypto.randomUUID(),sender:G,text:le,timestamp:new Date}])},d=()=>{l([])},[u,f]=w.useState(null),[g,b]=w.useState(null),[v,S]=w.useState(void 0),[T,E]=w.useState(void 0),[C,P]=w.useState(null),[I,q]=w.useState(!1),[L,O]=w.useState(""),[B,$]=w.useState(!1),[F,z]=w.useState(null),[U,V]=w.useState(null),[ee,ie]=w.useState(!1),[ae,J]=w.useState(!1),[K,W]=w.useState(null),[re,A]=w.useState(""),[te,xe]=w.useState(""),[M,Se]=w.useState(null),[$e,he]=w.useState(!1),[ge,me]=w.useState(!1),[de,Le]=w.useState(!1),[He,pe]=w.useState(null),[ne,Pe]=w.useState(window.innerHeight),[Ye,rt]=w.useState([]),[ut,je]=w.useState(!1),[Qe,ze]=w.useState(null),[dt,Ze]=w.useState([]),[ct,ft]=w.useState([]),[fe,Q]=w.useState(!1),[ue,De]=w.useState(null),Ge=w.useRef(null),ye=w.useRef(null),Ne=w.useRef(!1),Me=w.useRef(null),Fe=w.useRef(null),ve=w.useRef(null),[ke,Ee]=w.useState("context"),[Ve,Ke]=w.useState(50),[vt,wt]=w.useState(!1),nt=w.useRef(null),bt=w.useRef(null),Mt=150,[tt,Nt]=w.useState([]),[Lt,pn]=w.useState([]),[Kt,ln]=w.useState(!1),[Dt,mn]=w.useState(null),[Dn,ii]=w.useState(null),[Ie,pt]=w.useState(""),[mt,rn]=w.useState(null),[Xt,Zn]=w.useState(""),[Bi,Qi]=w.useState(null),[Mi,hr]=w.useState(""),[Mn,Li]=w.useState([]),[fr,aa]=w.useState(!1),[fi,Pn]=w.useState(null),[pr,sr]=w.useState(!1),[Ol,or]=w.useState(null),[Fa,Sr]=w.useState({}),[Gs,Ys]=w.useState(!1),[$a,Ws]=w.useState(!1),[Iu,ch]=w.useState(!1),[_c,jr]=w.useState(null),[Qs,Cc]=w.useState(!1),[Js,kc]=w.useState(!1),[ya,Mu]=w.useState(!1),[lr,Ll]=w.useState(!1),[Fo,$o]=w.useState(!1),[za,zo]=w.useState(!1),Ks=w.useMemo(()=>(g==null?void 0:g.admission_date)&&!(g!=null&&g.discharge_date),[g]),[ms,Ba]=w.useState(!1),[Fl,$l]=w.useState(""),[gs,zl]=w.useState(void 0),[Tc,Xs]=w.useState(void 0),[Bo,Bl]=w.useState(void 0),[mr,ys]=w.useState(!1),[Ec,Ua]=w.useState(null),[Ru,Zs]=w.useState(!1),[xa,Uo]=w.useState(""),[qo,qa]=w.useState(""),[Ac,Ul]=w.useState(""),[Ou,Bn]=w.useState(""),[$n,Lu]=w.useState(""),[cr,xs]=w.useState(""),[ql,Vo]=w.useState(!1),[uh,eo]=w.useState(null),[to,Ni]=w.useState(!1),Va=w.useRef(null),[Ha,Dc]=w.useState(null),[Vl,_r]=w.useState(null),no=w.useRef(null),[dh,Pc]=w.useState(!1),[Ic,Fu]=w.useState(!1),[Un,Ji]=w.useState(null),[Mc,gr]=w.useState(""),[Hl,Ho]=w.useState(""),[ba,Gl]=w.useState(!0),[bs,ri]=w.useState(!1),[sa,Go]=w.useState(!1),[Yo,Rc]=w.useState(!1),[vs,Oc]=w.useState([]),[gp,hh]=w.useState(!1),[ws,io]=w.useState({}),Ns=w.useRef({header:null,vitals:null,pharmacy:null,lab:null,complaints:null}),Ga=w.useRef([]),Lc=w.useRef(!1),Wo=w.useCallback(()=>{if(Lc.current||Ga.current.length===0)return;Lc.current=!0;const G=Ga.current.shift(),le=Ns.current[G];le&&le.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{io(se=>({...se,[G]:!0})),setTimeout(()=>{io(se=>({...se,[G]:!1})),Lc.current=!1,Wo()},2e3)},400)},[]),ro=w.useCallback(G=>{Ga.current.includes(G)||Ga.current.push(G),Wo()},[Wo]),Qo=w.useRef(null),$u=G=>{const le=G==="context"?Fe:ve;le.current&&(le.current.scrollIntoView({behavior:"smooth",block:"start"}),Ee(G))};w.useEffect(()=>{const G=()=>{var it,St;if(window.innerWidth>768)return;const se=(it=Fe.current)==null?void 0:it.getBoundingClientRect(),_e=(St=ve.current)==null?void 0:St.getBoundingClientRect();se&&_e&&(_e.top<200?Ee("response"):Ee("context"))},le=nt.current;if(le)return le.addEventListener("scroll",G),()=>le.removeEventListener("scroll",G)},[]);const va=async G=>{try{const le=await ce(`/api/patients/${G}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`Failed to fetch patient details: ${le.status}`)}const se=await le.json();if(b(se),S(se.age),E(se.gender),A(se.ai_response||""),b(_e=>_e?{..._e,current_status:se.current_status,admission_date:se.admission_date,discharge_date:se.discharge_date}:{...se,current_status:se.current_status,admission_date:se.admission_date,discharge_date:se.discharge_date}),se.insurance_type&&b(_e=>_e?{..._e,insurance_type:se.insurance_type}:{...se}),Ya(G),se.ai_response){const _e=/```json\s*([\s\S]*?)\s*```/,it=se.ai_response.match(_e);if(it&&it[1])xe(se.ai_response.replace(_e,"").trim()),Se(it[1].trim());else{const St=se.ai_response.trim();if(St.startsWith("{")&&St.endsWith("}"))try{JSON.parse(St),xe(""),Se(St)}catch{xe(St),Se(null)}else if(St.startsWith("[")&&St.endsWith("]"))try{JSON.parse(St),xe(""),Se(St)}catch{xe(St),Se(null)}else xe(St),Se(null)}}else xe(""),Se(null)}catch{b(null),A(""),xe(""),Se(null)}},Ss=async(G,le)=>{b(se=>se?{...se,insurance_type:le}:null);try{const se=await ce(`/api/patients/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:le})});if(!se.ok){const _e=await se.json();throw new Error(_e.message||"Failed to update insurance type")}}catch(se){console.error("Error updating insurance type:",se),G&&va(G)}},fh=async G=>{Q(!0),De(null),ft([]);try{const le=await ce(`/api/queue/patient/${G}/complaints`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();ft(se||[])}catch(le){De(`Past complaints error: ${le.message}`)}finally{Q(!1)}},ao=async G=>{Ze([]);try{const le=await ce(`/api/pharmacy-orders/patient/${G}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();Ze(se||[])}catch{}},Ri=async G=>{aa(!0),Pn(null),Li([]);try{const le=await ce(`/api/lab/orders/patient/${G}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();Li(se||[])}catch(le){Pn(`Pending labs error: ${le.message}`)}finally{aa(!1)}},js=async G=>{je(!0),ze(null),rt([]);try{const le=await ce(`/api/lab/patient/${G}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();rt(se||[])}catch(le){ze(`Lab reports error: ${le.message}`)}finally{je(!1)}},_s=async G=>{try{const le=await ce(`/api/recurring-medications?patientId=${G}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`Failed to fetch recurring medications: ${le.status}`)}const se=await le.json();Oc(se.recurringMedications||[])}catch(le){console.error("Error fetching recurring medications:",le)}},so=async G=>{ie(!0),Q(!0),aa(!0),je(!0),Ze([]);try{const le=await ce(`/api/patients/${G}/context`,{cache:"no-store"});if(!le.ok){const it=await le.json().catch(()=>({}));throw new Error(it.message||`Failed to fetch patient context: ${le.status}`)}const se=await le.json(),_e=se.patient;if(b(_e),S(_e.age),E(_e.gender),A(_e.ai_response||""),Ya(G),_e.ai_response){const it=/```json\s*([\s\S]*?)\s*```/,St=_e.ai_response.match(it);if(St&&St[1])xe(_e.ai_response.replace(it,"").trim()),Se(St[1].trim());else{const Pt=_e.ai_response.trim();if(Pt.startsWith("{")&&Pt.endsWith("}"))try{JSON.parse(Pt),xe(""),Se(Pt)}catch{xe(Pt),Se(null)}else if(Pt.startsWith("[")&&Pt.endsWith("]"))try{JSON.parse(Pt),xe(""),Se(Pt)}catch{xe(Pt),Se(null)}else xe(Pt),Se(null)}}else xe(""),Se(null);return ft(se.pastComplaints||[]),Ze(se.pharmacyOrders||[]),Li(se.labOrders||[]),rt(se.labReports||[]),Oc(se.recurringMedications||[]),se}catch(le){return console.error("Error fetching patient context:",le),W(le.message),b(null),A(""),xe(""),Se(null),ft([]),Ze([]),Li([]),rt([]),Oc([]),null}finally{ie(!1),Q(!1),aa(!1),je(!1)}},Ya=async G=>{try{const le=await ce(`/api/queue/patient/${G}/latest`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`Failed to fetch queue status: ${le.status}`)}const se=await le.json();if(se){const _e=new Date(se.createdAt),it=new Date,St=_e.getDate()===it.getDate()&&_e.getMonth()===it.getMonth()&&_e.getFullYear()===it.getFullYear(),Pt=["waiting","consulting"].includes(se.status);zo(St&&Pt)}else zo(!1)}catch(le){console.error("Error checking patient queue status:",le),zo(!1)}},ph=async G=>{var se;const le=dt.find(_e=>_e.id===G);if(le&&(le.status==="billed"||le.status==="dispensed"))try{const _e=await ce(`/api/bills?patientId=${u}`);if(!_e.ok)throw new Error("Failed to fetch bills");const St=(se=(await _e.json()).bills)==null?void 0:se.find(Pt=>Pt.related_id===G&&Pt.type==="pharmacy");if(St){n(`/dashboard/bills/${St.id}`);return}else{console.warn("Bill not found for billed order, falling back to edit page or alert"),alert("Bill record not found for this order.");return}}catch(_e){console.error("Error fetching bill:",_e),alert("Failed to fetch bill details.");return}n(`/dashboard/edit-pharmacy-order/${G}`)},Fc=G=>{W(null),console.log(`Preparing billing navigation for order: ${G}`);const le=dt.find(se=>se.id===G);if(le){const se=le.medications.map(_e=>{const it=_e.price??0;return(_e.price===void 0||_e.price===null)&&console.warn(`Medication "${_e.name}" in order ${G} is missing a price. Defaulting to 0.`),{name:_e.name,pack_quantity:_e.pack_quantity,loose_quantity:_e.loose_quantity,price:it,pack_price:_e.pack_price,loose_price:_e.loose_price,total_price:Number(_e.total_price)||0,isLoose:_e.isLoose,unit:_e.unit,drug_id:_e.drug_id?String(_e.drug_id):null,tabletsPerDay:_e.tabletsPerDay,numberOfDays:_e.numberOfDays,directions_to_use:_e.directions_to_use,discount_percentage:_e.discount_percentage??0,batch:_e.batch,expiry_date:_e.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:se}),n(`/dashboard/pharmacy-billing/${G}`,{state:{initialItems:se}})}else console.error(`Order with ID ${G} not found.`),W(`Order with ID ${G} not found.`),alert(`Error: Could not find order ${G} to bill.`)},mh=async(G,le)=>{W(null);const se=dt.find(it=>it.id===G);if(!se){W(`Order with ID ${G} not found.`);return}const _e={status:le,medications:se.medications};try{const it=await ce(`/api/pharmacy-orders/${G}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!it.ok){const Pt=await it.text();throw new Error(`Failed to update status: ${it.statusText} (${it.status}) - ${Pt}`)}const St=await it.json();Ze(Pt=>Pt.map(Et=>Et.id===St.id?St:Et)),u&&ao(u)}catch(it){console.error("Failed to update order status:",it),W(it.message||`Failed to update status for order ${G}.`),alert(`Error updating status for order ${G}: ${it.message||"Please try again."}`)}},gh=async G=>{W(null);try{const le=await ce(`/api/pharmacy-orders/${G}/recurring`,{method:"POST"});if(!le.ok){const se=await le.json().catch(()=>({}));throw new Error(se.message||"Failed to mark order as recurring")}u&&_s(u)}catch(le){console.error("Failed to mark order as recurring:",le),W(le.message||`Failed to mark order ${G} as recurring.`),alert(`Error: ${le.message||"Please try again."}`)}},zu=G=>{jr(G),ch(!0)},Cs=async G=>{if(window.confirm("Are you sure you want to delete this recurring medication?"))try{if(!(await ce(`/api/recurring-medications/${G}`,{method:"DELETE"})).ok)throw new Error("Failed to delete recurring medication");Oc(se=>se.filter(_e=>_e.id!==G))}catch(le){console.error("Error deleting recurring medication:",le),alert("Failed to delete. Please try again.")}},yh=G=>{Li(le=>le.map(se=>se.id===G?{...se,isEditing:!0,editedTests:[...se.tests],editedStatus:se.status}:{...se,isEditing:!1}))},xh=G=>{Li(le=>le.map(se=>se.id===G?{...se,isEditing:!1,editedTests:void 0,editedStatus:void 0}:se))},$c=(G,le,se,_e)=>{Li(it=>it.map(St=>{if(St.id===G){const Pt=St.editedTests?[...St.editedTests]:[...St.tests];if(se==="add")return{...St,editedTests:[...Pt,{id:"",name:"",price:0}]};if(se==="remove")return{...St,editedTests:_e};if(le!==-1){const Et={...Pt[le],[se]:_e};return Pt[le]=Et,{...St,editedTests:Pt}}}return St}))},bh=(G,le)=>{Li(se=>se.map(_e=>_e.id===G?{..._e,editedStatus:le}:_e))},ks=G=>{if(!G||!G.id){console.error("Cannot navigate to billing: Lab Order data or ID is missing."),alert("Could not open billing page: Lab Order information is missing.");return}n("/lab-billing",{state:{labOrderId:G.id}})},Jo=async(G,le)=>{try{if(!(await ce(`/api/lab/${G}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:le})})).ok)throw new Error("Failed to update lab order status");u&&Ri(u)}catch(se){console.error("Error updating lab order status:",se),alert("Failed to update status. Please try again.")}},Bu=G=>{G&&G.id?n(`/lab/report/${G.id}`):(console.error("Cannot navigate: Lab Order or Lab Order ID is missing."),alert("Could not open the lab report page: Lab Order information is missing."))},vh=async G=>{var le;if(!(!G||!G.id)){if(["billed","collected","processing","report_ready","reported","completed"].includes(G.status||""))try{const se=await ce(`/api/bills?patientId=${u}`);if(!se.ok)throw new Error("Failed to fetch bills");const it=(le=(await se.json()).bills)==null?void 0:le.find(St=>St.related_id===G.id&&St.type==="lab");if(it){n(`/dashboard/bills/${it.id}`);return}else console.warn("Bill not found for lab order, proceeding to report page")}catch(se){console.error("Error fetching bill:",se)}Bu(G)}},Cr=async(G,le,se)=>{Cc(!0),W(null);try{if(!le||le.length===0)throw new Error("Lab order must have at least one test.");for(const St of le)if(!St.id||!St.name||isNaN(St.price)||St.price<0)throw new Error(`Invalid test data: ${JSON.stringify(St)}. Each test must have id, name, and a valid price.`);const _e={tests:le,status:se},it=await ce(`/api/lab/orders/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!it.ok){const St=await it.json().catch(()=>({}));throw new Error(St.message||`Failed to update lab order: ${it.statusText}`)}u&&Ri(u),Li(St=>St.map(Pt=>Pt.id===G?{...Pt,isEditing:!1,editedTests:void 0,editedStatus:void 0}:Pt))}catch(_e){W(`Lab Order Save Error: ${_e.message}`)}finally{Cc(!1)}},kr=async G=>{if(!window.confirm(`Are you sure you want to delete this ${G.type.toLowerCase()} record? This action cannot be undone.`))return;sr(!0),or(null);let se=null,_e;const it=G.type;try{switch(it){case"Complaint":if(_e=G.data.id,!_e)throw new Error("Complaint ID is missing.");se=`/api/patients/complaints/${_e}`;break;case"Lab Order":if(_e=G.data.id,!_e)throw new Error("Lab Order ID is missing.");se=`/api/lab/orders/${_e}`;break;case"Lab Report":if(_e=G.data.reportId,!_e)throw new Error("Lab Report ID is missing.");se=`/api/lab/reports/${_e}`;break;case"Pharmacy Order":if(_e=G.data.id,!_e)throw new Error("Pharmacy Order ID is missing.");se=`/api/pharmacy-orders/${_e}`;break;default:throw new Error(`Deletion not supported for item type: ${it}`)}if(!se)throw new Error(`Could not determine delete URL for type: ${it}`);const St=await ce(se,{method:"DELETE"});if(!St.ok){const Pt=await St.json().catch(()=>({}));throw new Error(Pt.message||`Failed to delete ${it}: ${St.statusText}`)}u&&(it==="Complaint"?fh(u):it==="Lab Order"?(Ri(u),js(u)):it==="Lab Report"?js(u):it==="Pharmacy Order"&&ao(u))}catch(St){or(`Delete Error (${it}): ${St.message}`),pr&&sr(!1)}finally{sr(!1)}},zr=async()=>{if(!u)return;if(dt.filter(le=>le.status==="pending").length<2){alert("You need at least two pending orders to merge.");return}Fu(!0);try{const le=await ce(`/api/pharmacy-orders/patient/${u}/merge-pending`,{method:"POST"});if(!le.ok){const se=await le.json().catch(()=>({}));throw new Error(se.message||"Failed to merge orders")}ao(u)}catch(le){W(`Merge Error: ${le.message}`)}finally{Fu(!1)}},Uu=G=>{ft(le=>le.map(se=>se.id===G?{...se,isEditing:!0,editedComplaint:se.complaint}:se))},wh=G=>{ft(le=>le.map(se=>se.id===G?{...se,isEditing:!1,editedComplaint:void 0}:se))},Nh=(G,le)=>{ft(se=>se.map(_e=>_e.id===G?{..._e,editedComplaint:le}:_e))},qu=async(G,le)=>{try{const se=await ce(`/api/patients/complaints/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:le})});if(!se.ok){const _e=await se.json().catch(()=>({}));throw new Error(_e.message||"Failed to update complaint")}ft(_e=>_e.map(it=>it.id===G?{...it,complaint:le,isEditing:!1,editedComplaint:void 0}:it)),ro("complaints")}catch(se){console.error("Error updating complaint:",se),alert(`Failed to update complaint: ${se.message}`)}},Ts=w.useMemo(()=>{if(!u||!ct)return[];const G=[...ct].sort((le,se)=>new Date(se.createdAt).getTime()-new Date(le.createdAt).getTime());return G.map((le,se)=>({date:new Date(le.createdAt),type:"Complaint",data:{...le,serialNumber:G.length-se},originalDateString:le.createdAt})).filter(le=>!isNaN(le.date.getTime()))},[ct,u]),Tr=w.useMemo(()=>{if(!u)return[];const G=new Map;(Mn??[]).forEach(se=>{G.set(se.id,{...se})}),(Ye??[]).forEach(se=>{if(!G.has(se.id))G.set(se.id,{id:se.id,patient_id:se.patient_id,tests:se.tests,status:se.status,createdAt:se.createdAt,report:se});else{const _e=G.get(se.id);_e&&(_e.report=se,_e.status=se.status)}});let le=Array.from(G.values());return le.sort((se,_e)=>new Date(se.createdAt).getTime()-new Date(_e.createdAt).getTime()),le=le.map((se,_e)=>({...se,serialNumber:_e+1})),le.map(se=>({date:new Date(se.createdAt),type:"Lab Order",data:se,originalDateString:se.createdAt}))},[u,Mn,Ye]),Ki=w.useMemo(()=>{if(!u||!dt)return[];const G=dt.map(le=>({date:new Date(le.date),type:"Pharmacy Order",data:le,originalDateString:le.date})).filter(le=>!isNaN(le.date.getTime()));return G.sort((le,se)=>se.date.getTime()-le.date.getTime()),G},[u,dt]),[Ae,Xe]=w.useState(null),[Je,_t]=w.useState([]),[zt,wn]=w.useState(""),Si=(G,le)=>{if(!G||!G.report_content||!le)return"";try{const se=JSON.parse(G.report_content||"{}");if(typeof se!="object"||se===null)return`<p class="italic text-gray-500 text-xs">Report content is not structured data.</p><pre>${G.report_content}</pre>`;let _e="";return le.forEach(it=>{se[it.id]?(_e+=`<h5 class="font-semibold text-sm mt-2 mb-1">${it.name}</h5>`,_e+='<table class="lab-report-print-table"><thead><tr><th>Parameter</th><th>Value</th><th>Normal Range</th></tr></thead><tbody>',Object.entries(se[it.id]).map(([St,Pt])=>{var Gn;const Et=(Gn=it.default_parameters)==null?void 0:Gn.find(an=>an.name===St);let _n="N/A";Et&&Et.type==="number"&&(Et.lower_limit!=null||Et.upper_limit!=null)?(_n="",Et.lower_limit!=null&&(_n+=` > ${Et.lower_limit}`),Et.lower_limit!=null&&Et.upper_limit!=null&&(_n+=" - "),Et.upper_limit!=null&&(_n+=` < ${Et.upper_limit}`),_n=_n.trim()||"N/A"):(Et==null?void 0:Et.type)==="boolean"?_n="N/A":Et!=null&&Et.normal_range&&(_n=Et.normal_range),_e+=`<tr><td>${St}</td><td>${String(Pt)} ${(Et==null?void 0:Et.unit)||""}</td><td>${_n}</td></tr>`}),_e+="</tbody></table>"):_e+=`<p class="italic text-gray-500 text-xs">No parameters reported for ${it.name}.</p>`}),_e}catch{return`<p class="italic text-gray-500 text-xs">Error parsing report content.</p><pre>${G.report_content}</pre>`}};w.useEffect(()=>{const G=()=>{Pe(window.innerHeight)};return window.addEventListener("resize",G),G(),()=>window.removeEventListener("resize",G)},[]),w.useEffect(()=>{const G=se=>{if(!vt||!bt.current||!nt.current)return;const _e=nt.current.getBoundingClientRect(),St=se.clientX-bt.current.x;let Pt=bt.current.initialWidth-St;const Et=_e.width-Mt-10;Pt=Math.max(Mt,Pt),Pt=Math.min(Pt,Et);const _n=Pt/_e.width*100;Ke(_n)},le=()=>{wt(!1),bt.current=null,document.body.style.cursor="",document.body.style.userSelect=""};return vt&&(window.addEventListener("mousemove",G),window.addEventListener("mouseup",le),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",le),document.body.style.cursor="",document.body.style.userSelect=""}},[vt]);const jn=G=>{if(!nt.current)return;G.preventDefault();const le=nt.current.querySelector(".edit-complaint-context-column");le&&(bt.current={x:G.clientX,initialWidth:le.offsetWidth},wt(!0))},zc=()=>{Ke(50)},Vu=w.useCallback(async()=>{J(!0),W(null);try{const G=await ce("/api/queue/doctor/new",{method:"POST"});if(!G.ok){const se=await G.json().catch(()=>({}));throw new Error(se.message||`Failed to create record: ${G.statusText}`)}const le=await G.json();if(!le.recordId)throw new Error("New record ID not received from server.");n(`/edit-complaint/${le.recordId}`,{replace:!0})}catch(G){W(`Failed to create new complaint record: ${G.message}`)}finally{J(!1)}},[n]);w.useEffect(()=>{(async()=>{Gl(!0);try{const le=await ce("/api/clinics/settings");if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||"Failed to fetch clinic settings.")}const se=await le.json();Ji({admissionCharge:parseFloat(se.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(se.perDayCharge||0).toFixed(2),otherCharges:parseFloat(se.otherCharges||0).toFixed(2),aiMemory:se.aiMemory||"",aiMemoryUpdatedAt:se.aiMemoryUpdatedAt||null,clinicWideSystemPrompt:se.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:se.clinicWideSystemPromptUpdatedAt||null,gemini_api_key:se.gemini_api_key||""}),gr(se.aiMemory||""),Ho(se.clinicWideSystemPrompt||"")}catch{}finally{Gl(!1)}})()},[]),w.useEffect(()=>{var le,se;(le=t.state)!=null&&le.patientId&&f(Number(t.state.patientId)),(se=t.state)!=null&&se.initialMessage&&a(t.state.initialMessage),e?(async _e=>{var it;ie(!0),W(null);try{const St=await ce(`/api/queue/doctor/complaint/${_e}`);if(!St.ok){const Et=await St.json().catch(()=>({}));throw new Error(Et.message||`HTTP error! status: ${St.status}`)}const Pt=await St.json();f(Et=>Et===Pt.patientId?Et:Pt.patientId),S(Pt.age),E(Pt.gender),P(Pt.case_summary||null),V(Pt.updatedAt||null)}catch{W("Failed to load current complaint details."),(it=t.state)!=null&&it.patientId||f(null),S(void 0),E(void 0),P(null),V(null)}finally{ie(!1)}})(e):Vu()},[e,Vu,(Kl=t.state)==null?void 0:Kl.initialMessage,(nl=t.state)==null?void 0:nl.patientId]),w.useEffect(()=>{u?so(u):(b(null),ft([]),Ze([]),Li([]),rt([]),V(null),zo(!1))},[u]),w.useEffect(()=>{var se;const G=(se=t.state)==null?void 0:se.initialMessage;G&&e&&(!ee&&!fe&&!fr&&!ut&&!Kt)&&!Ne.current&&r===G&&(Ne.current=!0,_i(),n(t.pathname,{replace:!0,state:{}}))},[(Pr=t.state)==null?void 0:Pr.initialMessage,e,r,ee,fe,fr,ut,Kt,n]);const Er=()=>{O(C||""),q(!0),z(null)},Bc=()=>{q(!1),O(""),z(null)},yp=async()=>{if(!e){z("Missing Record ID.");return}$(!0),z(null);try{const G=await ce(`/api/queue/doctor/complaint/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:L.trim()})});if(!G.ok){const se=await G.json().catch(()=>({}));throw new Error(se.message||`Failed to save case summary: ${G.statusText}`)}const le=await G.json();P(le.case_summary||L.trim()),V(le.updatedAt||null),q(!1)}catch(G){z(`Save Error: ${G.message}`)}finally{$(!1)}};w.useEffect(()=>{(async()=>{ln(!0),mn(null);try{const[le,se]=await Promise.all([ce("/api/drugs"),ce("/api/lab-tests")]);if(!le.ok)throw new Error(`Pharmacy inventory error! status: ${le.status}`);const _e=await le.json();if(Nt(_e||[]),!se.ok)throw new Error(`Lab inventory error! status: ${se.status}`);const it=await se.json();pn(it||[])}catch(le){mn(le.message)}finally{ln(!1)}})()},[]);const Ko=async()=>{if(!Un)return;if(Mc===Un.aiMemory&&Hl===Un.clinicWideSystemPrompt){Go(!1);return}const G=Mc!==Un.aiMemory,le=Hl!==Un.clinicWideSystemPrompt;G&&ri(!0),le&&Rc(!0);try{const se={...Un};G&&(se.aiMemory=Mc),le&&(se.clinicWideSystemPrompt=Hl);const _e=await ce("/api/clinics/settings",{method:"PUT",body:JSON.stringify(se)});if(!_e.ok){const St=await _e.json().catch(()=>({}));throw new Error(St.message||"Failed to update clinic settings.")}const it=await _e.json();Ji({admissionCharge:parseFloat(it.settings.admissionCharge).toFixed(2),perDayCharge:parseFloat(it.settings.perDayCharge).toFixed(2),otherCharges:parseFloat(it.settings.otherCharges).toFixed(2),aiMemory:it.settings.aiMemory||"",aiMemoryUpdatedAt:it.settings.aiMemoryUpdatedAt||(Un==null?void 0:Un.aiMemoryUpdatedAt)||null,clinicWideSystemPrompt:it.settings.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:it.settings.clinicWideSystemPromptUpdatedAt||(Un==null?void 0:Un.clinicWideSystemPromptUpdatedAt)||null}),G&&gr(it.settings.aiMemory||""),le&&(Ho(it.settings.clinicWideSystemPrompt||""),Go(!1))}catch{}finally{G&&ri(!1),le&&Rc(!1)}},Yl=async()=>{if(u){Vo(!0),eo(null);try{const G={BP:xa,Pulse:qo,Temp:Ac,Weight:Ou,Other:$n},le=await ce(`/api/patients/${u}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vitals:G,next_follow_up:cr||null})});if(!le.ok){const se=await le.json().catch(()=>({}));throw new Error(se.message||"Failed to update vitals")}await va(u),Zs(!1),ro("vitals")}catch(G){console.error("Error saving vitals:",G),eo(G.message)}finally{Vo(!1)}}},Wl=()=>{var G,le,se,_e,it;g&&(Uo(((G=g.vitals)==null?void 0:G.BP)||""),qa(((le=g.vitals)==null?void 0:le.Pulse)||""),Ul(((se=g.vitals)==null?void 0:se.Temp)||""),Bn(((_e=g.vitals)==null?void 0:_e.Weight)||""),Lu(((it=g.vitals)==null?void 0:it.Other)||""),xs(g.next_follow_up||""),eo(null)),Zs(!0)},Rn=()=>{Zs(!1),eo(null)},oa=()=>{Un&&(Ho(Un.clinicWideSystemPrompt||""),Go(!0))},Hu=()=>{Go(!1),Un&&Ho(Un.clinicWideSystemPrompt||"")},_i=async G=>{let le=G??r;Ae&&le.trim()&&(le=`${Ae} -> ${le}`,Xe(null),_t([])),le.trim()&&(h("user",le),G||a("")),Qo.current&&await Qo.current.callGenerativeApi(le)},Br=G=>{navigator.clipboard.writeText(G).then(()=>{}).catch(le=>{console.error("Failed to copy text: ",le)})},Xo=async G=>{if(!(!G||!Ie))try{if(!(await ce(`/api/lab/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({createdAt:new Date(Ie).toISOString()})})).ok)throw new Error("Failed to update order date");u&&(Ri(u),js(u)),ii(null)}catch(le){console.error("Error updating order date:",le),alert("Failed to update order date")}},Gu=async G=>{if(!(!G||!Xt))try{if(!(await ce(`/api/lab/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_date:new Date(Xt).toISOString()})})).ok)throw new Error("Failed to update report date");u&&(js(u),Ri(u)),rn(null)}catch(le){console.error("Error updating report date:",le),alert("Failed to update report date")}},oo=async G=>{if(!(!G||!Mi))try{if(!(await ce(`/api/pharmacy-orders/${G}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({createdAt:new Date(Mi).toISOString()})})).ok)throw new Error("Failed to update pharmacy order date");u&&ao(u),Qi(null)}catch(le){console.error("Error updating pharmacy order date:",le),alert("Failed to update pharmacy order date")}},Ar=(G,le)=>{const se=window.open("","_blank");se&&(se.document.write(`
        <html>
          <head>
            <title>${le}</title>
            <style>
              body { font-family: sans-serif; margin: 20px; }
              h2 { text-align: center; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              pre { white-space: pre-wrap; word-wrap: break-word; }
              .ai-context-section { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 5px; }
              .ai-context-section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #333; }
              .ai-context-text { margin-bottom: 5px; }
              .text-gray-400 { color: #999; }
              .font-semibold { font-weight: 600; }
              .italic { font-style: italic; }
              .mt-2 { margin-top: 8px; }
              .ml-1 { margin-left: 4px; }
              .ml-2 { margin-left: 8px; }
              .flex { display: flex; }
              .flex-col { flex-direction: column; }
              .w-full { width: 100%; }
              .text-xs { font-size: 0.75rem; }
              .text-sm { font-size: 0.875rem; }
              .prose { max-width: 65ch; }
              .prose table { display: table; } /* Ensure tables in markdown render correctly */
            </style>
          </head>
          <body>
            <h2>${le}</h2>
            <div id="print-content">${G}</div>
          </body>
        </html>
      `),se.document.close(),se.print())},Zo=()=>{if(re){const G=dZ().use(os).use(Ste).processSync(te).toString();Ar(`<div class="prose">${G}</div>`,"AI Response")}};w.useEffect(()=>{if(g){let G=`
        <div class="print-section">
          <h3>Patient Details</h3>
          <p><strong>Name:</strong> ${g.name||"N/A"}</p>
          <p><strong>Token:</strong> ${g.patient_token_number||"N/A"}</p>
          <p><strong>Age:</strong> ${g.age||"N/A"}</p>
          <p><strong>Gender:</strong> ${g.gender||"N/A"}</p>
          <p><strong>Phone:</strong> ${g.phone||"N/A"}</p>
          <p><strong>Insurance:</strong> ${g.insurance_type||"N/A"}</p>
          <p><strong>Status:</strong> ${g.current_status||"N/A"}</p>
          <p><strong>Admitted:</strong> ${g.admission_date?new Date(g.admission_date).toLocaleDateString():"N/A"}</p>
          <p><strong>Discharged:</strong> ${g.discharge_date?new Date(g.discharge_date).toLocaleDateString():"N/A"}</p>
        </div>
        <div class="print-section">
          <h3>Case Summary</h3>
          <p>${C||"No summary available."}</p>
        </div>
        <div class="print-section">
          <h3>Complaints History</h3>
          ${Ts.length>0?`
            <ul>
              ${Ts.map(le=>`<li>${new Date(le.originalDateString).toLocaleDateString()}: ${le.data.complaint}</li>`).join("")}
            </ul>
          `:"<p>No past complaints.</p>"}
        </div>
        <div class="print-section">
          <h3>Pharmacy Orders</h3>
          ${Ki.length>0?`
            <table class="print-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Drug Name</th>
                  <th>Quantity</th>
                  <th>Dosage</th>
                  <th>Directions</th>
                </tr>
              </thead>
              <tbody>
                ${Ki.map(le=>le.data.medications.map((se,_e)=>`
                    <tr>
                      ${_e===0?`<td rowspan="${le.data.medications.length}">${new Date(le.originalDateString).toLocaleDateString()}</td>`:""}
                      ${_e===0?`<td rowspan="${le.data.medications.length}">${le.data.status}</td>`:""}
                      <td><strong>${se.name}</strong></td>
                      <td>
                        ${se.pack_quantity!==void 0&&se.pack_quantity>0?`Packs: ${se.pack_quantity}`:""}
                        ${se.pack_quantity!==void 0&&se.pack_quantity>0&&se.loose_quantity!==void 0&&se.loose_quantity>0?", ":""}
                        ${se.loose_quantity!==void 0&&se.loose_quantity>0?`Loose: ${se.loose_quantity}`:""}
                      </td>
                      <td>${se.tabletsPerDay&&se.numberOfDays?`${se.tabletsPerDay} tab/day for ${se.numberOfDays} days`:"N/A"}</td>
                      <td>${se.directions_to_use||"N/A"}</td>
                    </tr>
                  `).join("")).join("")}
              </tbody>
            </table>
          `:"<p>No pharmacy orders.</p>"}
        </div>
        <div class="print-section">
          <h3>Lab History (Orders & Reports)</h3>
          ${Tr.length>0?`
            ${Tr.map(le=>{const se=le.data.tests.map(it=>it.name).join(", ");let _e="";return le.data.report&&(_e=`
                  <div class="lab-report-print-container">
                    <h4>Lab Report (${new Date(le.data.report.report_date).toLocaleDateString()})</h4>
                    ${Si(le.data.report,le.data.report.tests)}
                  </div>
                `),`
                <div class="lab-history-item">
                  <p><strong>Order Date:</strong> ${new Date(le.originalDateString).toLocaleDateString()}</p>
                  <p><strong>Status:</strong> ${le.data.status}</p>
                  <p><strong>Tests:</strong> ${se}</p>
                  ${_e}
                </div>
              `}).join("")}
          `:"<p>No lab history.</p>"}
        </div>
      `;wn(G)}else wn("")},[g,C,Ts,Ki,Tr,Si]);const lo=()=>{zt&&Ar(zt,`Patient Details - ${g==null?void 0:g.name}`)},Ql=G=>{_i(G)},Dr=ee||ge||de||ae||mr||Qs||pr||Js||ya||lr||Fo||Ic,co=()=>{a("reports came,please anaylse"),setTimeout(()=>{_i()},0)},Jl=G=>{Sr(le=>({...le,[G]:!le[G]}))},yr=G=>{G.key==="Enter"&&!G.shiftKey&&(G.preventDefault(),!Dr&&!Kt&&!ae&&r.trim()&&e&&_i())};w.useEffect(()=>{const G=window.SpeechRecognition||window.webkitSpeechRecognition;if(!G){Dc("Speech recognition not supported in this browser.");return}const le=new G;return le.continuous=!0,le.interimResults=!0,le.lang="en-US",le.onresult=se=>{let _e="";for(let it=se.resultIndex;it<se.results.length;++it)se.results[it].isFinal&&(_e+=se.results[it][0].transcript);_e&&a(it=>it+(it.endsWith(" ")||it===""?"":" ")+_e)},le.onerror=se=>{Dc(`Speech error: ${se.error}`),Ni(!1)},le.onend=()=>{},Va.current=le,()=>{Va.current&&Va.current.stop()}},[]);const Es=async()=>{if(u)if(Ks){Mu(!0);try{const G=await ce(`/api/patients/${u}/discharge`,{method:"POST"});if(!G.ok){const le=await G.json().catch(()=>({}));throw new Error(le.message||`Failed to discharge patient: ${G.status}`)}va(u)}catch(G){W(`Discharge Error: ${G.message}`)}finally{Mu(!1)}}else{kc(!0);try{const G=await ce(`/api/patients/${u}/admit`,{method:"POST"});if(!G.ok){const le=await G.json().catch(()=>({}));throw new Error(le.message||`Failed to admit patient: ${G.status}`)}va(u)}catch(G){W(`Admit Error: ${G.message}`)}finally{kc(!1)}}},Xi=async G=>{if(u){Ll(!0);try{const se=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:u})});if(!se.ok){const it=await se.json().catch(()=>({}));throw new Error(it.message||`Failed to add patient to ${G} queue: ${se.status}`)}const _e=await se.json();u&&(G==="doctor"&&(_e!=null&&_e.id)&&n(`/dashboard/edit-complaint/${_e.id}`,{replace:!0}),va(u),Ya(u))}catch(le){W(`Add to Queue Error: ${le.message}`)}finally{Ll(!1)}}},el=async()=>{if(e){$o(!0),W(null);try{const G=await ce(`/api/queue/${e}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"seen"})});if(!G.ok){const le=await G.json().catch(()=>({}));throw new Error(le.message||"Failed to complete consultation")}u&&(va(u),Ya(u))}catch(G){W(`Error completing consultation: ${G.message}`)}finally{$o(!1)}}},Uc=async()=>{if(!u){Ua("Missing Patient ID.");return}if(!g){Ua("Patient details not loaded.");return}ys(!0),Ua(null);try{const G={};let le=!1;if(Fl!==g.name&&(G.name=Fl,le=!0),gs!==g.age&&(G.age=gs===""?0:typeof gs=="string"?parseInt(gs,10)||0:gs,le=!0),Tc!==g.gender&&(G.gender=Tc,le=!0),Bo!==g.phone&&(G.phone=Bo,le=!0),!le){Ua("No changes detected."),ys(!1),Ba(!1);return}const se=await ce(`/api/patients/${u}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(G)});if(!se.ok){const it=await se.json().catch(()=>({}));throw new Error(it.message||`Failed to update patient details: ${se.statusText}`)}const _e=await se.json();b(_e),S(_e.age),E(_e.gender),$l(_e.name),zl(_e.age),Xs(_e.gender),Bl(_e.phone),Ba(!1),ro("header")}catch(G){Ua(`Save Error: ${G.message}`)}finally{ys(!1)}},uo=w.useCallback(()=>{if(!g)return null;const G={token_number:g.patient_token_number||"N/A",name:g.name||"N/A",age:g.age||"N/A",gender:g.gender||"N/A",phone:g.phone||"N/A",vitals:g.vitals||"None",next_follow_up:g.next_follow_up||"None"};return Ts.length>0?G.complaints_history=Ts.map(le=>`${le.data.complaint} (${new Date(le.originalDateString).toLocaleDateString()})`).join("; "):G.complaints_history="No past complaints.",Ki.length>0?G.pharmacy_orders_history=Ki.map(le=>`Order: ${le.data.medications.map(_e=>{let it=`${_e.name}`;return _e.pack_quantity!==void 0&&_e.pack_quantity>0&&(it+=` Packs: ${_e.pack_quantity}`),_e.loose_quantity!==void 0&&_e.loose_quantity>0&&(it+=` Loose: ${_e.loose_quantity}`),it}).join(", ")} (${le.data.status}, ${new Date(le.originalDateString).toLocaleDateString()})`).join("; "):G.pharmacy_orders_history="No pharmacy orders.",Tr.length>0?G.lab_orders_history=Tr.map(le=>{let _e=`Lab Order: ${le.data.tests.map(it=>it.name).join(", ")} (${le.data.status}, ${new Date(le.originalDateString).toLocaleDateString()})`;return le.data.report&&(_e+=` - Report: ${le.data.report.report_content} (${new Date(le.data.report.report_date).toLocaleDateString()})`),_e}).join("; "):G.lab_orders_history="No lab history.",vs&&vs.length>0?G.recurring_medications=vs.map(le=>`${le.medications.map(_e=>_e.name).join(", ")} (Freq: ${le.frequency_days}d, Next: ${new Date(le.next_delivery_date).toLocaleDateString()})`).join("; "):G.recurring_medications="No recurring medications.",G},[g,Ts,Ki,Tr,vs]),Yu=()=>{if(!g){Dc("Patient details are required to use the Live API.");return}Pc(!0)},tl=()=>{var G;(G=no.current)==null||G.click()},Wa=G=>{var se;const le=(se=G.target.files)==null?void 0:se[0];le&&_r(le)},Qa=o.some(G=>G.sender==="user"||G.sender==="system");return i.jsxs("div",{className:"edit-complaint-page",style:{height:`${ne}px`},children:[i.jsx(AQ,{ref:Qo,recordId:e,patientId:u,patientDetails:g,caseSummary:C,caseSummaryUpdatedAt:U,clinicSettings:Un,userMessages:o.map(G=>`${G.sender==="user"?"User":G.sender==="ai"?"Assistant":"System"}: ${G.text}`),selectedImageFile:Vl,pendingLabOrders:Mn,labReports:Ye,pastComplaints:ct,recurringMedications:vs,pharmacyOrders:dt,pharmacyInventory:tt,labInventory:Lt,setAiResponse:A,setAiResponseText:xe,setAiResponseJsonString:Se,setShowAiJsonDetails:he,setIsLoadingAi:me,setCaseSummary:P,setCaseSummaryUpdatedAt:V,setFollowUpQuestion:Xe,setFollowUpOptions:_t,setError:W,setIsSavingAiResponse:Le,setSaveAiResponseError:pe,fetchPharmacyOrdersData:ao,fetchPendingLabOrdersData:Ri,fetchLabReportsData:js,fetchPastComplaintsData:fh,fetchRecurringMedicationsData:_s,fetchPatientDetails:va,fetchPatientContext:so,setClinicSettings:Ji,setEditedAiMemory:gr,handleDeleteItem:kr,handleAdmitDischargePatient:Es,handleCompleteConsultation:el,handleAddToQueue:Xi,setCanUndoAi:hh,addMessageToHistory:h,clearConversationHistory:d,triggerGlow:ro}),dh&&g&&i.jsx(NT,{onClose:()=>Pc(!1),patientData:uo(),tokenNumber:g.patient_token_number?String(g.patient_token_number):null,onAiSummaryChange:G=>{G&&(_i(G),Pc(!1))}}),i.jsxs("div",{className:"edit-complaint-header",children:[i.jsx("button",{onClick:()=>n(-1),disabled:Dr,className:"back-button",title:"Go Back",children:i.jsx(fn,{size:18})}),i.jsx("span",{ref:Me,style:{position:"absolute",visibility:"hidden",height:"auto",width:"auto",whiteSpace:"nowrap"}}),ee&&!g&&i.jsx("div",{className:"edit-complaint-patient-details skeleton",style:{width:"300px",height:"2.5rem"}}),g&&i.jsx("div",{ref:G=>{Ns.current.header=G},className:`edit-complaint-patient-details-wrapper ${ws.header?"glow-effect":""}`,children:ms?i.jsxs("div",{className:"patient-details-edit-form",children:[i.jsx("input",{type:"text",value:Fl,onChange:G=>$l(G.target.value),placeholder:"Name",className:"edit-input",disabled:mr}),i.jsx("input",{type:"number",value:gs??"",onChange:G=>zl(G.target.value),onBlur:G=>{G.target.value===""&&zl(0)},placeholder:"Age",className:"edit-input",disabled:mr}),i.jsxs("select",{value:Tc??"",onChange:G=>Xs(G.target.value||null),className:"edit-input",disabled:mr,children:[i.jsx("option",{value:"",children:"Select Gender"}),i.jsx("option",{value:"M",children:"Male"}),i.jsx("option",{value:"F",children:"Female"}),i.jsx("option",{value:"O",children:"Other"})]}),i.jsx("input",{type:"text",value:Bo??"",onChange:G=>Bl(G.target.value||null),placeholder:"Phone Number",className:"edit-input",disabled:mr}),i.jsxs("div",{className:"edit-actions",children:[i.jsx("button",{onClick:()=>{Ba(!1),Ua(null)},className:"button-secondary",disabled:mr,children:"Cancel"}),i.jsx("button",{onClick:Uc,className:"button-primary blue",disabled:mr,children:mr?i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-spin inline-block w-3 h-3 border-2 border-current border-t-transparent rounded-full mr-2"}),"Saving..."]}):"Save"})]}),Ec&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:Ec})]}):i.jsxs("div",{className:"edit-complaint-patient-details",children:[i.jsx("button",{onClick:()=>{Ba(!0),$l(g.name||""),zl(g.age),Xs(g.gender),Bl(g.phone),Ua(null)},className:"edit-patient-btn",title:"Edit Patient Details",disabled:mr,children:i.jsx(ss,{size:12})}),i.jsx("span",{className:"patient-name",children:g.name??"N/A"}),g.patient_token_number!==null&&i.jsxs("span",{className:"patient-token",children:["#",g.patient_token_number]}),i.jsx("button",{onClick:lo,disabled:!zt,title:"Print All Patient Details",className:"icon-button small ml-2",children:i.jsx(Ao,{size:14})}),i.jsxs("div",{className:"patient-meta",children:[i.jsxs("span",{className:"meta-item",children:[g.age??"N/A"," yrs"]}),i.jsx("span",{className:"meta-divider",children:"|"}),i.jsx("span",{className:"meta-item",children:g.gender??"O"}),g.phone&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"meta-divider",children:"|"}),i.jsx("span",{className:"meta-item",children:g.phone})]}),g.insurance_type&&i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"meta-divider",children:"|"}),i.jsx("div",{className:"insurance-type-container inline-block ml-1",children:i.jsx("span",{onClick:()=>{const G={cash:"insurance",insurance:"no_cash_insurance",no_cash_insurance:"cash"}[g.insurance_type||"cash"];Ss(g.id,G)},className:"insurance-type-toggle cursor-pointer hover:text-blue-600 select-none",style:{fontSize:"0.75rem",fontWeight:600},title:"Click to cycle: Cash -> Ins. -> None",children:{cash:"Cash",insurance:"Ins.",no_cash_insurance:"None"}[g.insurance_type||"cash"]})})]})]})]})}),!g&&v!==void 0&&T!==void 0&&i.jsxs("div",{className:"edit-complaint-patient-details",children:[v??"N/A"," / ",T??"N/A"]})]}),i.jsxs("div",{className:"edit-complaint-content-area",ref:nt,children:[Qa&&i.jsx("div",{className:"edit-complaint-chat-panel",style:{flex:"0 0 25%",display:"flex",flexDirection:"column",borderRight:"1px solid var(--border-color)",overflow:"hidden"},children:i.jsxs("div",{className:"chat-history-container",style:{flex:1,overflowY:"auto",padding:"0.5rem"},children:[i.jsx("h4",{style:{fontSize:"0.7rem",fontWeight:600,marginBottom:"0.5rem",color:"var(--text-muted)"},children:"Conversation"}),o.map(G=>i.jsx("div",{className:`chat-message ${G.sender}`,style:{marginBottom:"0.5rem",padding:"0.5rem 0.75rem",borderRadius:"0.5rem",background:G.sender==="user"?"var(--primary-color)":G.sender==="ai"?"#f3f4f6":G.text.startsWith("")?"var(--danger-bg, #f8d7da)":"var(--success-bg, #d4edda)",color:G.sender==="user"?"white":G.sender==="ai"?"#1f2937":G.text.startsWith("")?"var(--danger-text, #721c24)":"var(--success-text, #155724)",fontSize:G.sender==="system"||G.sender==="ai"?"0.7rem":"0.8rem",fontStyle:G.sender==="system"||G.sender==="ai"?"italic":"normal",wordBreak:"break-word"},children:i.jsx(Bs,{remarkPlugins:[os],children:G.text})},G.id))]})}),i.jsxs("div",{className:"edit-complaint-main-column",style:{flex:`0 0 calc(${100-Ve-(Qa?25:0)}% - 8px)`},children:[K&&i.jsxs("div",{className:"general-error-message",children:["Error: ",K]}),i.jsx("div",{ref:ve,className:"mobile-scroll-anchor"}),ae&&i.jsx("div",{className:"ai-function-status info text-center",children:"Creating record..."}),He&&i.jsxs("div",{className:"general-error-message",children:["Error saving AI response: ",He]}),de&&i.jsx("div",{className:"ai-function-status info text-center",children:"Saving AI response..."}),(te||M)&&i.jsxs("div",{ref:Ge,className:`${M?"ai-function-call-block":"ai-response-container"} group`,children:[te&&i.jsx(Bs,{remarkPlugins:[os],children:te}),M&&i.jsxs("div",{className:"ai-json-details-container",children:[i.jsxs("button",{onClick:()=>he(!$e),className:"ai-json-toggle-button",children:[$e?i.jsx(r1,{size:14,className:"mr-1"}):i.jsx(sb,{size:14,className:"mr-1"}),$e?"Hide":"Show"," AI Function Call Details"]}),$e&&i.jsx("pre",{className:"ai-json-pre",children:i.jsx("code",{children:JSON.stringify(JSON.parse(M),null,2)})})]}),i.jsxs("div",{className:"ai-response-actions",children:[i.jsx("button",{onClick:()=>Br(re),disabled:!re,title:"Copy Full AI Response",children:i.jsx(jI,{size:12})}),i.jsx("button",{onClick:Zo,disabled:!re,title:"Print AI Response",children:i.jsx(Ao,{size:12})})]})]})]}),i.jsx("div",{className:`draggable-divider ${vt?"active":""}`,onMouseDown:jn,onDoubleClick:zc,title:"Drag to resize. Double-click to reset."}),i.jsx("div",{className:"edit-complaint-context-column",ref:Fe,style:{flex:`0 0 calc(${Ve}% - 4px)`},children:i.jsxs("div",{className:"ai-context-container",children:[i.jsxs("div",{ref:G=>{Ns.current.vitals=G},className:`ai-context-section ${ws.vitals?"glow-effect":""}`,children:[i.jsxs("div",{className:"flex justify-between items-center px-4 mb-2",children:[i.jsx("h4",{className:"ai-context-section-title !p-0",children:"Current Status & Vitals"}),!Ru&&i.jsx("button",{onClick:Wl,className:"icon-button small",title:"Edit Status and Vitals",children:i.jsx(ss,{size:12})})]}),ee&&!g?i.jsxs("div",{className:"space-y-2 mt-2 px-4",children:[i.jsx("div",{className:"skeleton-text"}),i.jsx("div",{className:"skeleton-text short"})]}):i.jsxs("div",{className:"px-4",children:[Ru?i.jsxs("div",{className:"status-vitals-edit-form",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-1.5 focus-within:ring-0",children:[i.jsxs("div",{className:"vital-input-group",children:[i.jsx("span",{className:"vital-prefix",children:"BP"}),i.jsx("input",{type:"text",value:xa,onChange:G=>Uo(G.target.value),className:"vital-field",placeholder:"120/80"})]}),i.jsxs("div",{className:"vital-input-group",children:[i.jsx("span",{className:"vital-prefix",children:"Pulse"}),i.jsx("input",{type:"text",value:qo,onChange:G=>qa(G.target.value),className:"vital-field",placeholder:"72"})]}),i.jsxs("div",{className:"vital-input-group",children:[i.jsx("span",{className:"vital-prefix",children:"T"}),i.jsx("input",{type:"text",value:Ac,onChange:G=>Ul(G.target.value),className:"vital-field",placeholder:"98.6"})]}),i.jsxs("div",{className:"vital-input-group",children:[i.jsx("span",{className:"vital-prefix",children:"WT"}),i.jsx("input",{type:"text",value:Ou,onChange:G=>Bn(G.target.value),className:"vital-field",placeholder:"70"})]})]}),i.jsxs("div",{className:"vital-input-group mt-1.5",children:[i.jsx("span",{className:"vital-prefix",children:"Other"}),i.jsx("input",{type:"text",value:$n,onChange:G=>Lu(G.target.value),className:"vital-field",placeholder:"O2, Sugar..."})]}),i.jsxs("div",{className:"vital-input-group mt-1.5",children:[i.jsx("span",{className:"vital-prefix",children:"Next"}),i.jsx("input",{type:"date",value:cr,onChange:G=>xs(G.target.value),className:"vital-field follow-up-input"})]}),i.jsxs("div",{className:"flex justify-end space-x-1.5 pt-1.5 mt-1.5 border-t border-gray-100 dark:border-gray-800",children:[i.jsx("button",{onClick:Rn,className:"text-[9px] font-bold px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-700 hover:opacity-80",children:"Cancel"}),i.jsx("button",{onClick:Yl,disabled:ql,className:"text-[9px] font-bold px-2 py-0.5 rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:ql?"...":"Save"})]}),uh&&i.jsx("p",{className:"text-red-500 text-[8px] mt-0.5",children:uh})]}):i.jsxs(i.Fragment,{children:[(g==null?void 0:g.admission_date)&&i.jsxs("p",{className:"ai-context-text",children:[i.jsx("strong",{children:"Admitted:"})," ",new Date(g.admission_date).toLocaleDateString()]}),(g==null?void 0:g.discharge_date)&&i.jsxs("p",{className:"ai-context-text",children:[i.jsx("strong",{children:"Discharged:"})," ",new Date(g.discharge_date).toLocaleDateString()]}),(g==null?void 0:g.current_status)&&i.jsxs("p",{className:"ai-context-text !mb-1",children:[i.jsx("strong",{children:"Status:"})," ",i.jsx("span",{className:"font-semibold",children:g.current_status})]}),(g==null?void 0:g.vitals)&&Object.keys(g.vitals).length>0&&i.jsxs("p",{className:"ai-context-text text-[0.7rem] !mb-1",children:[i.jsx("strong",{className:"text-gray-500 uppercase tracking-tighter mr-1",children:"Vitals:"}),Object.entries(g.vitals).filter(([G,le])=>le).map(([G,le],se,_e)=>i.jsxs("span",{className:"inline-flex items-center",children:[i.jsxs("span",{className:"font-bold",children:[G,":"]})," ",i.jsx("span",{className:"ml-0.5",children:le}),se<_e.length-1&&i.jsx("span",{className:"mx-1 text-gray-300",children:"|"})]},G))]}),(g==null?void 0:g.next_follow_up)&&i.jsxs("p",{className:"ai-context-text text-blue-600 dark:text-blue-400 !mb-0",children:[i.jsx("strong",{children:"Next Follow-up:"})," ",new Date(g.next_follow_up).toLocaleDateString()]})]}),i.jsxs("div",{className:"flex space-x-1 mt-2 pt-2 border-t border-gray-50 dark:border-gray-800",children:[i.jsxs("button",{onClick:Es,className:`admit-discharge-button ${Ks?"discharge":"admit"} flex-1 !p-1 !text-[9px] !h-7`,title:Ks?"Discharge Patient":"Admit Patient",disabled:!u||Js||ya,children:[(Js||ya)&&i.jsx("span",{className:"animate-spin inline-block w-2 h-2 border-2 border-current border-t-transparent rounded-full mr-1"}),Js||ya?"...":Ks?"Discharge":"Admit"]}),i.jsxs("button",{onClick:()=>Xi("doctor"),className:`queue-status-button ${za?"in-queue":"add-to-queue"} flex-1 !p-1 !text-[9px] !h-7`,title:za?"Patient is in Doctor Queue":"Add Patient to Doctor Queue",disabled:!u||lr||za,children:[lr&&i.jsx("span",{className:"animate-spin inline-block w-2 h-2 border-2 border-current border-t-transparent rounded-full mr-1"}),lr?"...":"Queue"]}),i.jsxs("button",{onClick:el,className:"complete-consultation-button flex-1 !p-1 !text-[9px] !h-7",title:"Mark Consultation as Complete",disabled:Fo,children:[Fo&&i.jsx("span",{className:"animate-spin inline-block w-2 h-2 border-2 border-current border-t-transparent rounded-full mr-1"}),Fo?"...":"Done"]})]})]})]}),i.jsxs("div",{className:"ai-context-section",children:[i.jsx("h4",{className:"ai-context-section-title px-4",children:"Recurring Medications"}),ee&&vs.length===0?i.jsxs("div",{className:"space-y-2 mt-2 px-4",children:[i.jsx("div",{className:"skeleton-text"}),i.jsx("div",{className:"skeleton-text short"})]}):vs.length>0?i.jsx("div",{className:"recurring-meds-container space-y-3",children:vs.map((G,le)=>i.jsxs("div",{className:"ai-context-item flex flex-col px-4 py-3 border-b border-gray-50 last:border-0",style:{"--i":le},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2 pb-2 border-b border-gray-50 dark:border-gray-800",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:"text-xs font-semibold text-gray-500",children:["#",le+1," Status:"]}),i.jsx("span",{className:`status-badge text-[10px] uppercase font-bold px-1.5 py-0.5 rounded ${G.status==="active"?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":G.status==="paused"?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"}`,children:G.status})]}),i.jsxs("div",{className:"flex space-x-1",children:[i.jsx("button",{onClick:()=>zu(G),className:"icon-button small",title:"Edit Recurring Medication",children:i.jsx(ss,{size:12})}),i.jsx("button",{onClick:()=>Cs(G.id),className:"icon-button small text-red-500",title:"Delete Recurring Medication",children:i.jsx(Wi,{size:12})})]})]}),i.jsx("div",{className:"pharmacy-order-drugs-table-container",children:i.jsxs("table",{className:"pharmacy-order-drugs-table w-full text-[11px] table-fixed",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-1 px-2 text-left w-[40%]",children:"Medications"}),i.jsx("th",{className:"py-1 px-2 text-left w-[20%]",children:"Dosage"}),i.jsx("th",{className:"py-1 px-2 text-left w-[40%]",children:"Freq / Next"})]})}),i.jsx("tbody",{children:i.jsxs("tr",{children:[i.jsx("td",{className:"py-2 px-2 align-top",children:i.jsx("div",{className:"space-y-2",children:G.medications.map((se,_e)=>i.jsxs("div",{className:"flex flex-col border-b border-gray-50 dark:border-gray-800/50 last:border-0 pb-1 last:pb-0",children:[i.jsx("strong",{className:"break-words leading-tight",children:se.name}),i.jsx("div",{className:"flex flex-wrap gap-x-2 text-gray-500 text-[10px]",children:i.jsxs("span",{children:[se.pack_quantity?`${se.pack_quantity}p`:"",se.pack_quantity&&se.loose_quantity?" + ":"",se.loose_quantity?`${se.loose_quantity}l`:""]})}),se.directions_to_use&&i.jsx("span",{className:"text-[10px] text-blue-600 dark:text-blue-400 italic mt-0.5 line-clamp-2",title:se.directions_to_use,children:se.directions_to_use})]},_e))})}),i.jsx("td",{className:"py-2 px-2 align-top",children:i.jsx("div",{className:"space-y-2",children:G.medications.map((se,_e)=>i.jsx("div",{className:"flex flex-col border-b border-gray-50 dark:border-gray-800/50 last:border-0 pb-1 last:pb-0 h-[32px] justify-center",children:se.tabletsPerDay?`${se.tabletsPerDay} / day`:"-"},_e))})}),i.jsxs("td",{className:"py-2 px-2 align-top italic text-gray-500 break-words leading-tight",children:[i.jsxs("div",{className:"font-semibold text-gray-700 dark:text-gray-300",children:["Every ",G.frequency_days,"d"]}),i.jsxs("div",{className:"text-[10px] not-italic mt-1 text-gray-400",children:["Next: ",new Date(G.next_delivery_date).toLocaleDateString()]}),G.last_delivery_date&&i.jsxs("div",{className:"text-[9px] not-italic mt-0.5 text-gray-400",children:["Last: ",new Date(G.last_delivery_date).toLocaleDateString()]})]})]})})]})})]},G.id))}):i.jsx("p",{className:"ai-context-text italic text-gray-400 mt-2 px-4",children:"No recurring medications."})]}),i.jsx(O0,{title:"Pharmacy Order History",className:ws.pharmacy?"glow-effect":"",sectionRef:G=>{Ns.current.pharmacy=G},headerAction:i.jsxs("div",{className:"flex space-x-2",children:[gp&&i.jsxs("button",{onClick:()=>{var G;return(G=Qo.current)==null?void 0:G.undoLastBatch()},className:"flex items-center justify-center bg-red-100 hover:bg-red-200 text-red-700 border border-red-200 rounded text-xs px-2 py-1 transition-colors",disabled:Dr,title:"Undo Last AI Batch",children:[i.jsx(wM,{size:12,className:"mr-1"})," Undo AI"]}),i.jsx("button",{onClick:zr,className:"action-button primary",disabled:Ic||dt.filter(G=>G.status==="pending").length<2,title:"Merge all pending orders into one",children:Ic?i.jsx(i.Fragment,{children:i.jsx("span",{className:"animate-spin inline-block w-3 h-3 border-2 border-current border-t-transparent rounded-full mr-2"})}):"Merge Orders"}),i.jsxs("button",{onClick:()=>Ws(!0),className:"action-button success",title:"Manually create a new pharmacy order",disabled:!u,children:[i.jsx(Pl,{size:12})," Add Pharmacy Order"]})]}),items:Ki,isLoading:ee,loadingText:"Loading...",noDataText:"No orders.",renderItemContent:(G,le)=>i.jsxs("div",{className:"flex flex-col w-full",children:[i.jsxs("span",{className:"ai-context-text flex items-center",children:[(()=>{const se=IY(G.data.status);return i.jsxs(i.Fragment,{children:[Ki.length-le,". Order Status:"," ",i.jsx("span",{className:`${se.className} ml-1`,children:se.text})]})})(),Bi===G.data.id?i.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[i.jsx("input",{type:"datetime-local",value:Mi,onChange:se=>hr(se.target.value),className:"text-xs p-1 border rounded",style:{width:"auto"}}),i.jsx("button",{onClick:()=>oo(G.data.id),className:"text-green-600 hover:text-green-800",children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>Qi(null),className:"text-red-500 hover:text-red-700",children:i.jsx(Sn,{size:14})})]}):i.jsxs("span",{className:"text-gray-400 ml-1 flex items-center group",children:["(",new Date(G.originalDateString).toLocaleDateString(),")",i.jsx("button",{onClick:se=>{se.stopPropagation(),hr(new Date(G.originalDateString).toISOString().slice(0,16)),Qi(G.data.id)},className:"ml-1 hover:text-blue-600",title:"Edit Order Date",children:i.jsx(ss,{size:10})})]}),i.jsxs("div",{className:"inline-flex space-x-2 ml-2",children:[i.jsx("button",{onClick:()=>ph(G.data.id),className:"icon-button small",title:"Edit Pharmacy Order",children:i.jsx(ss,{size:12})}),G.data.prescriptionForUnavailableDrugs&&i.jsx("button",{onClick:()=>Ar(G.data.prescriptionForUnavailableDrugs,"Unavailable Drugs Prescription"),className:"icon-button small",title:"Print Unavailable Drugs Prescription",children:i.jsx(Ao,{size:12})}),i.jsx("button",{onClick:()=>kr({type:"Pharmacy Order",data:G.data}),className:"icon-button small text-red-500",title:"Delete Pharmacy Order",children:i.jsx(Wi,{size:12})}),i.jsx("button",{onClick:()=>gh(G.data.id),className:"icon-button small",title:"Mark as Recurring Medication",disabled:Qs,children:i.jsx(bM,{size:12})}),G.data.status==="pending"&&i.jsx("button",{onClick:()=>Fc(G.data.id),className:"icon-button small",title:"Bill this pharmacy order",disabled:Qs,children:i.jsx(ag,{size:12})}),G.data.status==="billed"&&i.jsx("button",{onClick:()=>mh(G.data.id,"dispensed"),className:"icon-button small",title:"Dispense this pharmacy order",disabled:Qs,children:i.jsx(Nr,{size:12})}),G.data.status==="dispensed"&&i.jsx("button",{onClick:async()=>{var se;try{const _e=await ce(`/api/bills?patientId=${G.data.patientId}`);if(!_e.ok)throw new Error("Failed to fetch bills");const St=(se=(await _e.json()).bills)==null?void 0:se.find(Pt=>Pt.related_id===G.data.id&&Pt.type==="pharmacy");St?n(`/dashboard/bills/${St.id}`):alert("Bill not found for this order.")}catch(_e){console.error("Error fetching bill:",_e),alert("Failed to fetch bill. Please try again.")}},className:"icon-button small",title:"View Bill",children:i.jsx(sg,{size:12})})]})]}),i.jsx("div",{className:"pharmacy-order-drugs-table-container mt-2 clickable",onClick:()=>ph(G.data.id),title:"Click to edit pharmacy order",children:i.jsxs("table",{className:"pharmacy-order-drugs-table w-full text-xs",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-1 px-2 text-left",children:"Drug Name"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Quantity"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Dosage"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Directions"})]})}),i.jsx("tbody",{children:G.data.medications.map((se,_e)=>i.jsxs("tr",{children:[i.jsx("td",{className:"py-1 px-2",children:i.jsx("strong",{children:se.name})}),i.jsxs("td",{className:"py-1 px-2",children:[se.pack_quantity!==void 0&&se.pack_quantity>0&&`Packs: ${se.pack_quantity}`,se.pack_quantity!==void 0&&se.pack_quantity>0&&se.loose_quantity!==void 0&&se.loose_quantity>0&&", ",se.loose_quantity!==void 0&&se.loose_quantity>0&&`Loose: ${se.loose_quantity}`]}),i.jsx("td",{className:"py-1 px-2",children:se.tabletsPerDay&&se.numberOfDays?`${se.tabletsPerDay} tab/day for ${se.numberOfDays} days`:"N/A"}),i.jsx("td",{className:"py-1 px-2",children:se.directions_to_use||"N/A"})]},se.drug_id||se.name||_e))})]})}),G.data.prescriptionForUnavailableDrugs&&i.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[i.jsx("span",{className:"font-semibold",children:"Prescription:"})," ",G.data.prescriptionForUnavailableDrugs]})]})}),i.jsx(FW,{isOpen:$a,onClose:()=>Ws(!1),patientId:u,pharmacyInventory:tt,fetchPharmacyOrdersData:ao}),i.jsx(O0,{title:"Lab History (Orders & Reports)",className:ws.lab?"glow-effect":"",sectionRef:G=>{Ns.current.lab=G},headerAction:i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:co,className:"action-button primary",title:"Tell AI to analyse the reports",disabled:Dr,children:"Analyse Reports"}),i.jsx("button",{onClick:()=>Ys(!0),className:"action-button success",title:"Manually create a new lab order",disabled:!u,children:"Create Lab Order"})]}),items:Tr,onSaveLabOrder:Cr,onCancelEditLabOrder:xh,onLabOrderTestChange:$c,onLabOrderStatusChange:bh,labInventory:Lt,isSavingLabOrder:Qs,isLoading:fr||ut,loadingText:"Loading...",noDataText:"No lab Hx.",expandedLabReports:Fa,toggleLabReport:Jl,renderItemContent:(G,le)=>{const se=PY(G.data.report?G.data.report.status:G.data.status);return i.jsxs("div",{className:"ai-context-text",children:[i.jsxs("div",{className:"flex justify-between items-center w-full mb-1",children:[i.jsxs("span",{onClick:()=>vh(G.data),style:{cursor:"pointer"},className:"hover:text-blue-600 font-medium",title:"Click to view details or bill",children:[G.data.serialNumber,". ",i.jsx("span",{className:"text-blue-600",children:"[Order]"})," ","(",i.jsx("span",{className:se.className,children:se.text}),")"]}),Dn===G.data.id?i.jsxs("div",{className:"flex items-center space-x-1",children:[i.jsx("input",{type:"datetime-local",value:Ie,onChange:_e=>pt(_e.target.value),className:"text-xs p-1 border rounded",style:{width:"auto"}}),i.jsx("button",{onClick:()=>Xo(G.data.id),className:"text-green-600 hover:text-green-800",children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>ii(null),className:"text-red-500 hover:text-red-700",children:i.jsx(Sn,{size:14})})]}):i.jsxs("span",{className:"text-xs text-gray-400 flex items-center group-hover:text-gray-600",children:[new Date(G.originalDateString).toLocaleDateString(),i.jsx("button",{onClick:_e=>{_e.stopPropagation(),pt(new Date(G.originalDateString).toISOString().slice(0,16)),ii(G.data.id)},className:"ml-1 hover:text-blue-600",title:"Edit Order Date",children:i.jsx(ss,{size:10})})]})]}),G.data.tests&&G.data.tests.length>0?i.jsx("div",{className:"lab-order-tests-table-container clickable",onClick:()=>vh(G.data),title:"Click to view details or bill",children:i.jsxs("table",{className:"lab-order-tests-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Test name"}),i.jsx("th",{className:"text-right",children:"Price"})]})}),i.jsxs("tbody",{children:[G.data.tests.map(_e=>i.jsxs("tr",{children:[i.jsx("td",{children:i.jsx("strong",{children:_e.name})}),i.jsxs("td",{className:"text-right font-mono",children:["",Number(_e.price).toFixed(2)]})]},_e.id||_e.name)),i.jsxs("tr",{className:"total-row",children:[i.jsx("td",{children:"Total"}),i.jsxs("td",{className:"text-right font-mono",children:["",G.data.tests.reduce((_e,it)=>_e+(Number(it.price)||0),0).toFixed(2)]})]})]})]})}):i.jsx("div",{className:"italic text-gray-500 text-xs py-1 px-2 border border-dashed border-gray-200 rounded my-1",children:"No tests specified"}),i.jsxs("div",{className:"inline-flex space-x-2 ml-2",children:[i.jsx("button",{onClick:()=>yh(G.data.id),className:"icon-button small",title:"Edit Order Details",children:i.jsx(ss,{size:12})}),i.jsx("button",{onClick:()=>kr({type:"Lab Order",data:G.data}),className:"icon-button small text-red-500",title:"Delete Lab Order",children:i.jsx(Wi,{size:12})}),G.data.status==="billed"&&i.jsx("button",{onClick:()=>Jo(G.data.id,"collected"),className:"icon-button small",title:"Collect Sample",children:i.jsx(To,{size:12})}),G.data.status==="collected"&&i.jsx("button",{onClick:()=>Jo(G.data.id,"processing"),className:"icon-button small",title:"Mark Processing",children:i.jsx(Km,{size:12})}),(G.data.status==="processing"||G.data.status==="report_ready"||G.data.status==="reported")&&i.jsx("button",{onClick:()=>Bu(G.data),className:"icon-button small",title:"Enter Report",children:i.jsx(ds,{size:12})}),(G.data.status==="report_ready"||G.data.status==="reported")&&i.jsx("button",{onClick:()=>Jo(G.data.id,"completed"),className:"icon-button small",title:"Mark Completed",children:i.jsx(Nr,{size:12})}),(G.data.status==="completed"||G.data.status==="report_ready"||G.data.status==="reported")&&i.jsx("button",{onClick:()=>Bu(G.data),className:"icon-button small",title:"View Report",children:i.jsx(sg,{size:12})}),G.data.status==="pending"&&i.jsx("button",{onClick:()=>ks(G.data),className:"icon-button small",title:`Pay (Total: ${G.data.tests.reduce((_e,it)=>_e+(Number(it.price)||0),0).toFixed(2)})`,children:i.jsx(ag,{size:12})})]}),G.data.report&&i.jsxs("div",{className:"ml-4 mt-1 p-2 border-l-2 border-gray-200",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"font-medium",children:"[Report]"}),mt===G.data.id?i.jsxs("div",{className:"flex items-center space-x-1 ml-2",children:[i.jsx("input",{type:"datetime-local",value:Xt,onChange:_e=>Zn(_e.target.value),className:"text-xs p-1 border rounded",style:{width:"auto"}}),i.jsx("button",{onClick:()=>Gu(G.data.id),className:"text-green-600 hover:text-green-800",children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>rn(null),className:"text-red-500 hover:text-red-700",children:i.jsx(Sn,{size:14})})]}):i.jsxs("span",{className:"text-gray-400 ml-1 flex items-center group",children:["(",new Date(G.data.report.report_date).toLocaleDateString(),")",i.jsx("button",{onClick:_e=>{_e.stopPropagation(),Zn(new Date(G.data.report.report_date).toISOString().slice(0,16)),rn(G.data.id)},className:"ml-1 hover:text-blue-600",title:"Edit Report Date",children:i.jsx(ss,{size:10})})]}),i.jsx("button",{onClick:()=>Jl(G.data.report.reportId),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:Fa[G.data.report.reportId]?"Collapse Report":"Expand Report",children:Fa[G.data.report.reportId]?i.jsx(r1,{size:14}):i.jsx(sb,{size:14})})]}),Fa[G.data.report.reportId]&&(()=>{try{const _e=JSON.parse(G.data.report.report_content||"{}");return typeof _e=="object"&&_e!==null&&G.data.report.tests?G.data.report.tests.map(it=>i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsx("h5",{className:"font-semibold text-sm mt-2 mb-1",children:it.name}),_e[it.id]?i.jsxs("table",{className:"lab-inventory-table w-full text-xs",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-1 px-2",children:"Parameter"}),i.jsx("th",{className:"py-1 px-2",children:"Value"}),i.jsx("th",{className:"py-1 px-2",children:"Normal Range"})]})}),i.jsx("tbody",{children:Object.entries(_e[it.id]).map(([St,Pt])=>{var Ur;const Et=(Ur=it.default_parameters)==null?void 0:Ur.find(Oi=>Oi.name===St),_n=typeof Pt=="string"?parseFloat(Pt):typeof Pt=="number"?Pt:NaN,Gn=(Et==null?void 0:Et.type)==="number"&&!isNaN(_n)&&Pt!==""&&Pt!==null&&Pt!==void 0&&(Et.lower_limit!=null&&_n<Et.lower_limit||Et.upper_limit!=null&&_n>Et.upper_limit),an=(Et==null?void 0:Et.type)==="boolean"&&(Pt===!0||Pt==="true");return i.jsxs("tr",{children:[i.jsx("td",{className:"py-1 px-2",children:St}),i.jsxs("td",{className:`py-1 px-2 ${Gn?"abnormal-result":""} ${an?"reactive-result":""}`,children:[String(Pt)," ",(Et==null?void 0:Et.unit)||""]}),i.jsx("td",{className:"py-1 px-2",children:(()=>{if(Et&&Et.type==="number"&&(Et.lower_limit!=null||Et.upper_limit!=null)){let Oi="";return Et.lower_limit!=null&&(Oi+=` > ${Et.lower_limit}`),Et.lower_limit!=null&&Et.upper_limit!=null&&(Oi+=" - "),Et.upper_limit!=null&&(Oi+=` < ${Et.upper_limit}`),Oi.trim()||"N/A"}else if((Et==null?void 0:Et.type)==="boolean")return"Non-Reactive";return(Et==null?void 0:Et.normal_range)||"N/A"})()})]},St)})})]}):i.jsx("p",{className:"italic text-gray-500 text-xs",children:"No parameters reported for this test."})]},it.id)):i.jsx(Bs,{remarkPlugins:[os],children:G.data.report.report_content})}catch{return i.jsx(Bs,{remarkPlugins:[os],children:G.data.report.report_content||"*No findings recorded.*"})}})()]})]})}}),i.jsx(sW,{isOpen:Gs,onClose:()=>Ys(!1),patientId:u,labInventory:Lt,fetchPendingLabOrdersData:Ri}),_c&&i.jsx(MT,{isOpen:Iu,onClose:()=>ch(!1),recurringMedication:_c,onUpdate:()=>u&&_s(u),inventory:tt}),i.jsx(O0,{title:"Complaints History",className:ws.complaints?"glow-effect":"",sectionRef:G=>{Ns.current.complaints=G},items:Ts,isLoading:fe,loadingText:"Loading...",noDataText:"No past Hx.",renderItemContent:(G,le)=>i.jsxs("span",{className:"ai-context-text w-full block",children:[i.jsxs("strong",{className:"mr-2 text-gray-600",children:["#",G.data.serialNumber]}),G.data.isEditing?i.jsx("textarea",{className:"w-full text-sm p-2 border rounded focus:outline-none focus:ring-1 focus:ring-blue-500 mt-1",value:G.data.editedComplaint!==void 0?G.data.editedComplaint:G.data.complaint,onChange:se=>Nh(G.data.id,se.target.value),rows:2,autoFocus:!0}):i.jsxs(i.Fragment,{children:[G.data.complaint,i.jsxs("span",{className:"text-gray-400 ml-1",children:["(",new Date(G.originalDateString).toLocaleDateString(),")"]})]})]}),onDeleteItem:kr,onEditComplaint:Uu,onSaveComplaint:qu,onCancelEditComplaint:wh}),i.jsxs("div",{className:"ai-context-section",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("h4",{className:"ai-context-section-title px-4",children:[i.jsx(Km,{size:16,className:"text-purple-600"})," Clinic-wide System Prompt"]}),!sa&&i.jsx("button",{onClick:oa,className:"edit-button",title:"Edit System Prompt",disabled:ba||bs||Yo,children:i.jsx(ss,{size:14})})]}),sa&&Un?i.jsxs("div",{className:"mt-2",children:[i.jsx("textarea",{value:Hl,onChange:G=>Ho(G.target.value),className:"context-edit-textarea",placeholder:"Enter clinic system prompt...",disabled:bs||Yo}),i.jsxs("div",{className:"context-edit-actions",children:[i.jsx("button",{onClick:Hu,disabled:bs||Yo,className:"button-secondary",children:"Cancel"}),i.jsxs("button",{onClick:Ko,disabled:bs||Yo||Mc===Un.aiMemory&&Hl===Un.clinicWideSystemPrompt,className:"button-primary purple",children:[Yo||bs?i.jsx("span",{className:"animate-spin inline-block w-3 h-3 border-2 border-current border-t-transparent rounded-full mr-2"}):i.jsx(vc,{size:14,className:"mr-1"}),Yo||bs?"Saving...":"Save Settings"]})]})]}):i.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none px-4",children:Un!=null&&Un.clinicWideSystemPrompt?i.jsx(Bs,{remarkPlugins:[os],children:Un.clinicWideSystemPrompt}):i.jsx("span",{className:"italic text-gray-400",children:"N/A - Click edit to add."})}),!sa&&(Un==null?void 0:Un.clinicWideSystemPromptUpdatedAt)&&i.jsxs("p",{className:"ai-context-text text-gray-400 mt-1 px-4",style:{fontSize:"0.625rem"},children:["Prompt Last Updated: ",new Date(Un.clinicWideSystemPromptUpdatedAt).toLocaleDateString()]})]}),i.jsxs("div",{className:"ai-context-section",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h4",{className:"ai-context-section-title px-4",children:"Case Summary"}),!I&&i.jsx("button",{onClick:Er,className:"edit-button",title:"Edit Case Summary",disabled:ee||B,children:i.jsx(ss,{size:14})})]}),I?i.jsxs("div",{className:"mt-2",children:[i.jsx("textarea",{value:L,onChange:G=>O(G.target.value),className:"context-edit-textarea",rows:4,placeholder:"Enter case summary...",disabled:B}),F&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:F}),i.jsxs("div",{className:"context-edit-actions",children:[i.jsx("button",{onClick:Bc,disabled:B,className:"button-secondary",children:"Cancel"}),i.jsx("button",{onClick:yp,disabled:B||L===C,className:"button-primary blue",children:B?i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"animate-spin inline-block w-3 h-3 border-2 border-current border-t-transparent rounded-full mr-2"}),"Saving..."]}):"Save"})]})]}):i.jsxs("div",{className:"px-4",children:[i.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none",children:C?i.jsx(Bs,{remarkPlugins:[os],components:{},children:C}):i.jsx("span",{className:"italic text-gray-400",children:"N/A - Click edit to add."})}),U&&i.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Last Edited: ",new Date(U).toLocaleDateString()]})]})]}),Ts.length===0&&Tr.length===0&&Ki.length===0&&!(fe||fr||ut)&&i.jsx("p",{className:"ai-context-text italic mt-4 px-4",children:"No recent history for this patient."}),pr&&i.jsx("p",{className:"text-yellow-600 text-xs mt-2 ai-context-text",children:"Deleting..."}),Ol&&i.jsx("p",{className:"text-red-600 text-xs mt-2 ai-context-text",children:Ol})]})})]}),i.jsxs("div",{className:"mobile-section-selector",children:[i.jsxs("button",{className:`selector-item ${ke==="context"?"active":""}`,onClick:()=>$u("context"),children:[i.jsx(Km,{size:14}),i.jsx("span",{children:"Case"})]}),i.jsxs("button",{className:`selector-item ${ke==="response"?"active":""}`,onClick:()=>$u("response"),children:[i.jsx(To,{size:14,className:"rotate-180"}),i.jsx("span",{children:"AI"})]})]}),i.jsxs("div",{className:"edit-complaint-input-area",children:[i.jsxs("div",{className:"status-messages-container",children:[Qe&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Qe}),ue&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:ue}),fi&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:fi}),Dt&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Dt})]}),e&&!ae&&i.jsxs(w.Fragment,{children:[Ae&&i.jsxs("div",{className:"follow-up-question-container",children:[i.jsx("p",{className:"question-text",children:Ae}),Je.length>0&&i.jsx("div",{className:"options-grid",children:Je.map((G,le)=>i.jsx("button",{onClick:()=>Ql(G),className:"option-button",children:G},le))})]}),Ha&&i.jsx("div",{className:"speech-error-display",children:Ha}),Vl&&i.jsxs("div",{className:"selected-file-display",children:[i.jsxs("span",{children:["Selected: ",Vl.name]}),i.jsx("button",{onClick:()=>{_r(null),no.current&&(no.current.value="")},className:"remove-file-button",title:"Remove image",children:""})]}),i.jsx("div",{className:"input-wrapper",children:i.jsxs("div",{className:"main-input-container",children:[i.jsx("input",{type:"file",ref:no,onChange:Wa,accept:"image/*",className:"hidden"}),i.jsx("textarea",{ref:ye,className:"complaint-textarea",value:r,onChange:G=>a(G.target.value),onKeyDown:yr,placeholder:"Chat with AI...",disabled:Dr||!e||to}),i.jsxs("div",{className:"chat-input-actions-container",children:[u&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>n(`/patient/${u}/lab-reports`),disabled:ut||!u,className:"icon-button",title:"View Lab Reports",children:i.jsx(ds,{size:14})}),i.jsx("button",{onClick:()=>n("/inventory"),disabled:Kt,className:"icon-button",title:"View Inventory",children:i.jsx(Eo,{size:14})})]}),i.jsx("button",{type:"button",onClick:tl,disabled:Dr||!e||to,className:"icon-button",title:"Attach Image",children:i.jsx(oM,{size:14})}),i.jsx("button",{type:"button",onClick:Yu,disabled:Dr||!e||!Va.current,className:`mic-button ${to?"listening":""}`,title:to?"Stop":"Mic",children:i.jsx(e2,{size:14})}),i.jsx("button",{onClick:()=>_i(),disabled:Dr||Kt||ae||!r.trim()||!e||to||ee||fe||fr,className:`send-button ${ge||ee||Kt||fe||fr?"loading":""}`,title:Dr||Kt||ae?"Processing...":"Save & Ask AI",children:ge||ee||Kt||fe||fr?i.jsx("span",{className:"animate-spin",role:"status","aria-label":"loading"}):i.jsx(To,{size:14})})]})]})})]})]})]})},_te=()=>{const{patientId:e}=ia(),n=Ft(),[t,r]=w.useState([]),[a,o]=w.useState(null),[l,h]=w.useState(!1),[d,u]=w.useState(null);w.useEffect(()=>{(async()=>{if(!e){u("Patient ID not provided.");return}h(!0),u(null);try{const b=await ce(`/api/patients/${e}`);if(!b.ok)throw new Error(`Failed to fetch patient details: ${b.status}`);const v=await b.json();o({name:v.name,age:v.age,gender:v.gender});const S=await ce(`/api/patients/${e}/complaints`);if(S.ok){const E=(await S.json()).sort((C,P)=>new Date(P.createdAt).getTime()-new Date(C.createdAt).getTime());r(E)}else if(S.status===404)r([]);else throw new Error(`Failed to fetch complaints: ${S.status}`)}catch(b){console.error("Error fetching past complaints or patient info:",b),u(`Failed to load data. ${b.message}`),r([]),o(null)}finally{h(!1)}})()},[e]);const f=g=>{navigator.clipboard.writeText(g).then(()=>console.log("Complaint copied to clipboard")).catch(b=>console.error("Failed to copy complaint: ",b))};return i.jsxs("div",{className:"container mx-auto p-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("button",{onClick:()=>n(-1),className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-3 rounded text-sm",children:"< Back"}),i.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-center flex-grow",children:"Past Complaints"}),i.jsx("div",{className:"w-16"})," "]}),a&&i.jsxs("div",{className:"mb-4 p-2 bg-gray-100 rounded text-center text-sm sm:text-base",children:["Patient: ",i.jsx("strong",{children:a.name})," (",a.age??"N/A"," / ",a.gender??"N/A",")"]}),d&&i.jsxs("div",{className:"text-red-500 p-3 mb-4 border border-red-500 rounded bg-red-50 text-sm",children:["Error: ",d]}),l&&i.jsx("p",{className:"text-center text-gray-500",children:"Loading..."}),!l&&t.length===0&&!d&&i.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No past complaints found for this patient."}),!l&&t.length>0&&i.jsx("div",{className:"space-y-4",children:t.map(g=>i.jsxs("div",{className:"p-3 border rounded shadow-sm bg-white group relative",children:[i.jsx("p",{className:"text-xs text-gray-500 mb-1",children:new Date(g.createdAt).toLocaleString()}),i.jsx("p",{className:"text-sm whitespace-pre-wrap",children:g.complaint}),i.jsx("button",{onClick:()=>f(g.complaint),className:"absolute top-1 right-1 bg-gray-200 hover:bg-gray-300 text-gray-600 text-xs p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Copy complaint text",children:""})]},g.id))})]})},qx=500,dC="defaultConsultationFee",Cte=({patientId:e,billId:n,queueId:t,onBillCreated:r,onBillUpdated:a,initialItems:o=[],billType:l="other",relatedId:h,initialStatus:d="pending",initialDiscountPercentage:u=0,readOnlyMode:f=!1,doctorId:g,labOrderId:b,patientInsuranceType:v})=>{const[S,T]=w.useState(null),[E,C]=w.useState([]),P=w.useRef(null),[I,q]=w.useState(""),[L,O]=w.useState(""),[B,$]=w.useState(1),[F,z]=w.useState(u),[U,V]=w.useState("cash"),[ee,ie]=w.useState(!1),[ae,J]=w.useState(null),[K,W]=w.useState(!1),[re,A]=w.useState(!1),[te,xe]=w.useState(!1),[M,Se]=w.useState(null),[,$e]=w.useState([]),[he,ge]=w.useState(null),[me,de]=w.useState(""),[Le,He]=w.useState("cash"),[pe,ne]=w.useState(!1),[Pe,Ye]=w.useState(qx),[rt,ut]=w.useState(qx.toString()),je=n?"view_pay":"create";w.useEffect(()=>{const ve=localStorage.getItem(dC),ke=ve?parseFloat(ve):qx;isNaN(ke)||(Ye(ke),ut(ke.toString()))},[]);const Qe=o.length===0;w.useEffect(()=>{e?(async()=>{ie(!0),J(null);try{const ke=await ce(`/api/patients/${e}`);if(!ke.ok){const Ve=await ke.json().catch(()=>({}));throw new Error(Ve.message||"Failed to fetch patient details")}const Ee=await ke.json();T(Ee)}catch(ke){J(`Failed to load patient details: ${ke.message}`),T(null)}finally{ie(!1)}})():T(null)},[e]),w.useEffect(()=>{n?(async()=>{xe(!0),J(null),Se(null),$e([]),ge(null);try{const ke=await ce(`/api/bills/${n}`);if(!ke.ok){const Ve=await ke.json().catch(()=>({}));throw new Error(Ve.message||"Failed to fetch bill details")}const Ee=await ke.json();if(!Ee.bill||!Ee.payments||!Ee.calculated)throw new Error("Invalid bill details structure.");Se(Ee.bill),$e(Ee.payments),ge(Ee.calculated),z(Ee.bill.discount_percentage!==void 0&&Ee.bill.discount_percentage!==null?parseFloat(Ee.bill.discount_percentage.toString()):0),!S&&Ee.bill.patient_id&&ze(Ee.bill.patient_id.toString())}catch(ke){J(`Failed to load bill details: ${ke.message}`),Se(null),$e([]),ge(null)}finally{xe(!1)}})():(Se(null),$e([]),ge(null))},[n]);const ze=async ve=>{ie(!0);try{const ke=await ce(`/api/patients/${ve}`);if(!ke.ok)throw new Error("Failed to fetch patient");const Ee=await ke.json();T(Ee)}catch(ke){console.error("Error fetching patient details:",ke),T(null)}finally{ie(!1)}},dt=w.useCallback(async ve=>{A(!0),J(null);const ke=ve.filter(Ee=>Ee.drug_id!=null).map(async Ee=>{try{const Ve=await ce(`/api/drugs/${Ee.drug_id}`);if(!Ve.ok)throw new Error(`Drug ${Ee.drug_id} not found.`);const Ke=await Ve.json();return{...Ee,price:Ke.price,total:Ke.price*Ee.quantity}}catch{return J(Ke=>`${Ke?Ke+"; ":""}Failed to fetch price for ${Ee.name}`),Ee}});try{const Ee=await Promise.all(ke);C(Ve=>{const Ke=new Map(Ee.map(vt=>[vt.id,vt]));return Ve.map(vt=>Ke.get(vt.id)||vt)})}catch{}finally{A(!1)}},[ce]);w.useEffect(()=>{if(n){C([]),P.current=null;return}P.current!==null&&JSON.stringify(o)===JSON.stringify(P.current)||(async()=>{let Ee=[];if(o&&o.length>0)Ee=o.map((Ve,Ke)=>({...Ve,id:`initial-${Ke}-${Date.now()}`})),V(d==="paid"?"cash":v==="no_cash_insurance"?"no_cash_insurance":"cash"),z(u),l==="pharmacy"&&!f&&await dt(Ee);else if(e&&Qe&&l==="consultation"){let Ve=Pe;if(g)try{const Ke=await ce(`/api/staff/${g}`);if(!Ke.ok){const wt=await Ke.json().catch(()=>({}));throw new Error(wt.message||"Doctor not found or error fetching fee")}const vt=await Ke.json();vt.opd_fee!=null&&!isNaN(parseFloat(String(vt.opd_fee)))&&parseFloat(String(vt.opd_fee))>=0&&(Ve=parseFloat(String(vt.opd_fee)))}catch(Ke){J(vt=>`${vt?vt+"; ":""}Could not fetch doctor's fee, using default. (${Ke.message})`)}Ee=[{id:Date.now(),name:"Consultation Fee",price:Ve,quantity:1,total:Ve*1,drug_id:null}],V(v==="no_cash_insurance"?"no_cash_insurance":"cash")}else Ee=[],V(v==="no_cash_insurance"?"no_cash_insurance":"cash");C(Ee),P.current=o})()},[n,e,g,o,l,Pe,Qe,d,f,dt,u,v]);const Ze=()=>{const ve=parseFloat(L);if(!f)if(I&&!isNaN(ve)&&ve>=0&&B>0){if(I.trim().toLowerCase()==="consultation fee"&&E.some(Ee=>Ee.name.toLowerCase()==="consultation fee")){alert("Consultation Fee already added.");return}const ke={id:Date.now(),name:I.trim(),price:ve,quantity:B,total:ve*B,drug_id:null};C([...E,ke]),q(""),O(""),$(1)}else alert("Invalid item details.")},ct=ve=>{f||C(E.filter(ke=>ke.id!==ve))},ft=w.useMemo(()=>{let ve=E.reduce((Ee,Ve)=>Ee+Ve.total,0);const ke=typeof F=="string"?parseFloat(F)||0:F;return je==="create"&&ke>0&&(ve=ve*(1-ke/100)),(he==null?void 0:he.totalDue)!==void 0&&(he==null?void 0:he.totalDue)!==null?he.totalDue:ve},[E,he,F,je]),fe=w.useMemo(()=>(he==null?void 0:he.totalPaid)??0,[he]),Q=w.useMemo(()=>(he==null?void 0:he.balance)!==void 0&&(he==null?void 0:he.balance)!==null?he.balance:ft-fe,[he,ft,fe]),ue=()=>{const ve=parseFloat(rt);!isNaN(ve)&&ve>=0?(Ye(ve),localStorage.setItem(dC,ve.toString()),alert(`Default Fee set to ${ve.toFixed(2)}`)):alert("Invalid fee amount.")},De=async(ve,ke)=>{W(!0),J(null);try{const Ee=await ce("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:ke,billId:ve})}),Ve=await Ee.json();if(!Ee.ok||!Ve.order)throw new Error(Ve.message||"Failed to create Razorpay order.");const{key_id:Ke,order:vt}=Ve,wt={key:Ke,amount:vt.amount,currency:vt.currency,name:"Newtons Ai HMS Clinic",description:`Bill Payment for Patient ID: ${e}`,order_id:vt.id,handler:async function(nt){try{const bt=await ce("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_payment_id:nt.razorpay_payment_id,razorpay_order_id:nt.razorpay_order_id,razorpay_signature:nt.razorpay_signature,billId:ve})}),Mt=await bt.json();if(bt.ok&&Mt.success)alert("Payment Successful!"),r&&r(ve),a&&a(),setTimeout(()=>window.print(),200);else throw new Error(Mt.message||"Payment verification failed.")}catch(bt){J(`Payment verification failed: ${bt.message}. Contact support.`)}finally{W(!1)}},prefill:{name:(S==null?void 0:S.name)||""},notes:{bill_id:ve,patient_id:e},theme:{color:"#3399cc"},modal:{ondismiss:function(){J("Payment cancelled."),W(!1)}}};if(window.Razorpay)new window.Razorpay(wt).open();else throw new Error("Razorpay SDK not loaded.")}catch(Ee){J(`Failed to initiate online payment: ${Ee.message}`),W(!1)}},Ge=async()=>{if(!n){J("Bill ID is missing.");return}if(!me||isNaN(parseFloat(me))||parseFloat(me)<=0){J("Please enter a valid positive payment amount.");return}ne(!0),J(null);const ve={amount_paid:parseFloat(me),payment_mode:Le};try{const ke=await ce(`/api/bills/${n}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ve)}),Ee=await ke.json();if(!ke.ok)throw new Error(Ee.message||`Failed to record payment (Status: ${ke.status})`);alert(`Payment of ${ve.amount_paid.toFixed(2)} recorded.`),de(""),a?a():console.log("Payment recorded.")}catch(ke){J(`Failed to record payment: ${ke.message}`)}finally{ne(!1)}},ye=async()=>{if(je==="view_pay")return;if(!e){J("Patient ID is missing for creating a bill.");return}if(E.length===0){J("Cannot finalize an empty bill.");return}W(!0),J(null);const ve=ft,ke=E.map(({id:Ee,...Ve})=>Ve);if(U==="online"){const Ee={patientId:e,queueId:t||null,items:ke,amount:ve,paymentMode:"online",type:l,related_id:h||b||null,status:"pending",discountPercentage:Number(F)||0,labOrderId:b||null};try{const Ve=await ce("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ee)}),Ke=await Ve.json();if(!Ve.ok)throw new Error(Ke.message||"Failed to create pending bill.");De(Ke.id,Math.round(ve*100))}catch(Ve){J(`Failed to create pending bill: ${Ve.message}`),W(!1)}}else{const Ee="paid";if(!U){J("Payment mode required."),W(!1);return}const Ve={patientId:e,queueId:t||null,items:ke,amount:ve,paymentMode:U,type:l,related_id:h||b||null,status:Ee,discountPercentage:Number(F)||0,labOrderId:b||null};setTimeout(()=>window.print(),200);try{const Ke=await ce("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ve)}),vt=await Ke.json();if(!Ke.ok)throw new Error(vt.message||"Failed to create bill.");alert("Bill marked as paid!"),r&&r(vt.id),W(!1)}catch(Ke){J(`Failed to process bill: ${Ke.message}`),W(!1)}}},Ne=(M==null?void 0:M.type)??l,Me=(M==null?void 0:M.status)??d,Fe=je==="view_pay"&&M&&Me==="pending";return!e&&!n?i.jsx("div",{className:"p-6 bg-white rounded-lg shadow text-gray-500",children:"Select patient or provide Bill ID."}):ee||je==="view_pay"&&te?i.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:"Loading..."}):je==="view_pay"&&!M&&!te&&ae?i.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading bill: ",ae]}):je==="create"&&!S&&!ee&&ae?i.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading patient: ",ae]}):i.jsxs("div",{className:"billing-container printable-section",children:[i.jsxs("div",{className:"billing-header",children:[i.jsx("h2",{children:je==="create"?b?"New Lab Bill":"New Bill":"Bill Analysis"}),je==="create"&&l==="consultation"&&!f&&i.jsxs("div",{className:"default-fee-section",children:[i.jsx("label",{htmlFor:"defaultFee",children:"Default Fee"}),i.jsx("input",{id:"defaultFee",type:"number",value:rt,onChange:ve=>ut(ve.target.value),placeholder:qx.toString(),disabled:f}),i.jsx("button",{onClick:ue,title:"Save Fee",disabled:f,children:i.jsx(vc,{size:16})})]})]}),ae&&!te&&!pe&&i.jsxs("div",{className:"error-box",role:"alert",children:[i.jsx(mi,{size:18}),i.jsx("span",{children:ae})]}),i.jsxs("div",{className:"billing-layout-grid",children:[i.jsxs("div",{className:"billing-left-column",children:[S&&i.jsxs("div",{className:"billing-card",children:[i.jsxs("h3",{children:[i.jsx(qs,{size:18})," Patient Case"]}),i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem",fontSize:"0.9rem"},children:[i.jsxs("div",{children:[i.jsx("span",{style:{opacity:.7},children:"Name:"})," ",i.jsx("strong",{children:S.name})]}),i.jsxs("div",{children:[i.jsx("span",{style:{opacity:.7},children:"ID:"})," ",i.jsxs("strong",{children:["#",S.id]})]}),i.jsxs("div",{children:[i.jsx("span",{style:{opacity:.7},children:"Age/Sex:"})," ",i.jsxs("strong",{children:[S.age||"N/A"," / ",S.gender||"N/A"]})]}),v&&i.jsxs("div",{children:[i.jsx("span",{style:{opacity:.7},children:"Type:"})," ",i.jsx("strong",{className:"capitalize",children:v})]})]})]}),i.jsxs("div",{className:"billing-card",style:{flexGrow:1},children:[i.jsxs("div",{className:"bill-items-header",children:[i.jsx("h3",{children:"Bill Particulars"}),je==="create"&&l==="pharmacy"&&!f&&E.some(ve=>ve.drug_id!=null)&&i.jsxs("button",{onClick:()=>dt(E),disabled:re,className:"refresh-prices-button",children:[i.jsx(Il,{size:14,className:re?"animate-spin":""}),i.jsx("span",{children:"Sync Prices"})]})]}),je==="view_pay"&&M&&i.jsxs("div",{className:"bill-info-bar",style:{background:"transparent",border:"none",padding:"0 0 1rem 0"},children:[i.jsx("span",{className:`status-badge ${Me==="paid"?"status-paid":"status-pending"}`,children:Me}),i.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--billing-text-soft)"},children:["ID: #",M.id," | ",Ne]})]}),i.jsx("div",{className:"bill-items-container",children:i.jsxs("table",{className:"billing-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"#"}),i.jsx("th",{children:"Description"}),i.jsx("th",{children:"Qty"}),i.jsx("th",{style:{textAlign:"right"},children:"Total"}),!f&&je==="create"&&i.jsx("th",{style:{width:"40px"}})]})}),i.jsxs("tbody",{children:[je==="create"&&!re&&E.map((ve,ke)=>i.jsxs("tr",{children:[i.jsx("td",{style:{width:"30px",opacity:.5},children:ke+1}),i.jsx("td",{className:"item-name-cell",children:ve.name}),i.jsx("td",{className:"item-qty-cell",children:ve.quantity}),i.jsxs("td",{className:"item-price-cell",children:["",ve.total.toFixed(2)]}),!f&&i.jsx("td",{children:typeof ve.id=="number"&&ve.name!=="Consultation Fee"?i.jsx("button",{onClick:()=>ct(ve.id),className:"btn-remove",title:"Remove",children:i.jsx(Wi,{size:16})}):i.jsx(JI,{size:14,style:{opacity:.3}})})]},ve.id)),je==="view_pay"&&M&&M.items.map((ve,ke)=>i.jsxs("tr",{children:[i.jsx("td",{style:{width:"30px",opacity:.5},children:ke+1}),i.jsx("td",{className:"item-name-cell",children:ve.name}),i.jsx("td",{className:"item-qty-cell",children:ve.quantity}),i.jsxs("td",{className:"item-price-cell",children:["",(ve.total??ve.price*ve.quantity).toFixed(2)]})]},ke)),(je==="create"?E.length:(M==null?void 0:M.items.length)||0)===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"2rem",opacity:.5},children:"No particulars added yet."})})]})]})}),je==="create"&&!f&&i.jsxs("div",{className:"add-item-modern-form",style:{marginTop:"1.5rem",paddingTop:"1.5rem",borderTop:"1px solid var(--billing-border)"},children:[i.jsxs("div",{className:"form-field",children:[i.jsx("label",{children:"Add Particular"}),i.jsx("input",{type:"text",value:I,onChange:ve=>q(ve.target.value),placeholder:"Service description...",className:"modern-input"})]}),i.jsxs("div",{className:"form-field",children:[i.jsx("label",{children:"Qty"}),i.jsx("input",{type:"number",min:"1",value:B,onChange:ve=>$(parseInt(ve.target.value)||1),placeholder:"1",className:"modern-input"})]}),i.jsxs("div",{className:"form-field",children:[i.jsx("label",{children:"Price"}),i.jsx("input",{type:"number",value:L,onChange:ve=>O(ve.target.value),placeholder:"0.00",className:"modern-input"})]}),i.jsxs("button",{onClick:Ze,className:"btn-add-item",children:[i.jsx(Pl,{size:18})," Add"]})]})]})]}),i.jsxs("div",{className:"billing-right-column",children:[i.jsxs("div",{className:"summary-card",children:[i.jsx("div",{className:"card-header",children:i.jsx("h3",{children:"Billing Summary"})}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{className:"summary-label",children:"Subtotal"}),i.jsxs("span",{className:"summary-value",children:["",E.reduce((ve,ke)=>ve+ke.price*ke.quantity,0).toFixed(2)]})]}),i.jsxs("div",{className:"discount-control",children:[i.jsx(Xd,{size:18}),i.jsxs("div",{style:{flex:1},children:[i.jsx("div",{style:{fontSize:"0.75rem",opacity:.8,fontWeight:600},children:"DISCOUNT %"}),je==="create"&&!f?i.jsx("input",{type:"number",min:"0",max:"100",step:"0.01",value:F,onChange:ve=>z(ve.target.value),onBlur:ve=>{ve.target.value===""&&z(0)}}):i.jsxs("span",{style:{fontWeight:700},children:[Number(F).toFixed(1),"%"]})]}),i.jsxs("div",{style:{textAlign:"right"},children:[i.jsx("div",{style:{fontSize:"0.75rem",opacity:.8},children:"SAVINGS"}),i.jsxs("div",{style:{fontWeight:700},children:["-",(E.reduce((ve,ke)=>ve+ke.price*ke.quantity,0)-ft).toFixed(0)]})]})]}),i.jsxs("div",{className:"summary-row grand-total",children:[i.jsx("span",{className:"summary-label",children:"GRAND TOTAL"}),i.jsxs("div",{style:{textAlign:"right"},children:[i.jsxs("div",{className:"total-amount",children:["",ft.toFixed(0)]}),i.jsx("div",{style:{fontSize:"0.8rem",opacity:.8},children:"Total Payable Amount"})]})]}),je==="view_pay"&&he&&i.jsxs("div",{style:{marginTop:"1rem",borderTop:"1px solid rgba(255,255,255,0.2)",paddingTop:"1rem",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsxs("div",{className:"summary-row",style:{opacity:.9},children:[i.jsx("span",{children:"Paid Amount"}),i.jsxs("span",{children:["",fe.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row",style:{fontWeight:700},children:[i.jsx("span",{children:"Balance Due"}),i.jsxs("span",{children:["",Q.toFixed(2)]})]})]})]}),i.jsxs("div",{className:"payment-card",children:[i.jsxs("h3",{children:[i.jsx(Hf,{size:18})," Local Settlement"]}),je==="create"&&!f&&i.jsxs("div",{className:"billing-actions",children:[i.jsx("div",{className:"payment-grid",children:[{id:"cash",label:"Cash",icon:i.jsx(LN,{size:20})},{id:"upi",label:"UPI",icon:i.jsx(t0,{size:20})},{id:"card",label:"Card",icon:i.jsx(Hf,{size:20})},{id:"online",label:"Razorpay",icon:i.jsx(t0,{size:20})},{id:"no_cash_insurance",label:"Insurance",icon:i.jsx(Xd,{size:20})},{id:"credit",label:"Credit",icon:i.jsx(Xd,{size:20})}].map(ve=>i.jsxs("label",{className:"payment-option",children:[i.jsx("input",{type:"radio",name:"paymentMode",value:ve.id,checked:U===ve.id,onChange:()=>V(ve.id)}),i.jsxs("div",{className:"payment-btn",children:[ve.icon,i.jsx("span",{children:ve.label})]})]},ve.id))}),i.jsx("button",{onClick:ye,disabled:K||E.length===0,className:"btn-primary",children:K?"Generating Bill...":U==="online"?"Pay Online & Finalize":"Complete Settlement"})]}),je==="view_pay"&&Fe&&!f&&i.jsxs("div",{className:"billing-actions",children:[i.jsxs("div",{className:"form-field",style:{marginBottom:"1rem"},children:[i.jsx("label",{children:"Settle Amount"}),i.jsx("input",{type:"number",value:me,onChange:ve=>de(ve.target.value),onBlur:ve=>{ve.target.value===""&&de("0")},placeholder:`Balance: ${Q.toFixed(0)}`,className:"modern-input"})]}),i.jsx("div",{className:"payment-grid",children:[{id:"cash",label:"Cash",icon:i.jsx(LN,{size:20})},{id:"upi",label:"UPI",icon:i.jsx(t0,{size:20})},{id:"card",label:"Card",icon:i.jsx(Hf,{size:20})},{id:"no_cash_insurance",label:"Insurance",icon:i.jsx(Xd,{size:20})}].map(ve=>i.jsxs("label",{className:"payment-option",children:[i.jsx("input",{type:"radio",name:"paymentMode",value:ve.id,checked:Le===ve.id,onChange:()=>He(ve.id)}),i.jsxs("div",{className:"payment-btn",children:[ve.icon,i.jsx("span",{children:ve.label})]})]},ve.id))}),i.jsx("button",{onClick:Ge,disabled:pe||!me||parseFloat(me)<=0||parseFloat(me)>Q+.1,className:"btn-secondary",children:pe?"Settling...":"Record Payment"})]}),Me==="paid"&&i.jsx("div",{className:"status-badge status-paid",style:{textAlign:"center",width:"100%",padding:"1rem"},children:"This invoice is fully settled."}),Me==="cancelled"&&i.jsx("div",{className:"status-badge status-cancelled",style:{textAlign:"center",width:"100%",padding:"1rem"},children:"This invoice was cancelled."})]})]})]})]})},kte=()=>{const e=Ft(),n=$r(),{patientId:t,queueId:r,initialItems:a,billType:o,relatedId:l,initialStatus:h,initialDiscountPercentage:d,doctorId:u,billId:f,labOrderId:g}=n.state||{},[b,v]=w.useState(null),[S,T]=w.useState(null),[E,C]=w.useState(null),[P,I]=w.useState(null),[q,L]=w.useState(null),[O,B]=w.useState(null),[$,F]=w.useState(!0),[z,U]=w.useState(null);if(w.useEffect(()=>{(async()=>{if(!t&&!f){F(!1);return}F(!0),U(null);try{let J=t;if(f){const K=await ce(`/api/bills/${f}`);if(!K.ok){const re=await K.json().catch(()=>({}));throw new Error(re.message||"Failed to fetch bill details")}const W=await K.json();W.bill&&(T(W.bill.items||[]),C(W.bill.status),I(W.bill.type),L(W.bill.related_id),B(W.bill.discount_percentage?parseFloat(W.bill.discount_percentage):0),W.bill.patient_id&&(J=W.bill.patient_id.toString()))}if(J){const K=await ce(`/api/patients/${J}`);if(K.ok){const W=await K.json();v(W.insurance_type??null)}}}catch(J){console.error("Error loading billing details:",J),U(J.message||"Failed to load details")}finally{F(!1)}})()},[f,t,g]),!t&&!f&&!$)return i.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-gray-600",children:[i.jsx(ob,{size:48,className:"mb-4 text-red-500"}),i.jsx("p",{className:"text-lg font-medium mb-2",children:"Missing Patient/Bill Information"}),i.jsx("button",{onClick:()=>e("/"),className:"mt-4 px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700",children:"Go to Dashboard"})]});if($)return i.jsx("div",{className:"min-h-screen bg-neutral-light flex items-center justify-center",children:i.jsx("p",{className:"text-teal-600 animate-pulse",children:"Loading Billing Details..."})});if(z)return i.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-red-600 p-4",children:[i.jsx(ob,{size:48,className:"mb-4"}),i.jsx("p",{className:"text-lg font-medium mb-2",children:"Error Loading Billing Details"}),i.jsx("p",{className:"text-sm text-center mb-4",children:z}),i.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"}),i.jsx("button",{onClick:()=>e(-1),className:"mt-2 text-sm text-gray-600 hover:text-teal-700",children:"Go Back"})]});const ee=(E??h)==="paid",ie=async ae=>{var J,K;if((J=n.state)!=null&&J.finalizeQueueAssignment&&r&&u)try{const W={status:"waiting",doctorId:u};(await ce(`/api/queue/${r}/status`,{method:"PATCH",body:JSON.stringify(W)})).ok?console.log("Queue assigned successfully after payment."):console.error("Failed to assign queue after payment.")}catch(W){console.error("Error finalizing queue assignment:",W)}(K=n.state)!=null&&K.finalizeQueueAssignment?e("/dashboard",{state:{activeTab:"queue"}}):e(-1)};return i.jsx(Cte,{patientId:t,labOrderId:g,queueId:r,doctorId:u,billId:f,initialItems:S??a,billType:P??o,relatedId:q??l,initialStatus:E??h,initialDiscountPercentage:O??d,readOnlyMode:ee,patientInsuranceType:b??void 0,onBillCreated:ie,onBillUpdated:()=>e(-1)})},Tte=({patientId:e,labOrderId:n,onBillingSuccess:t,initialItems:r,patientName:a})=>{const[o]=w.useState(r),[l,h]=w.useState(0),[d,u]=w.useState("cash"),[f,g]=w.useState(null),[b,v]=w.useState(!1),S=w.useMemo(()=>{const E=o.reduce((P,I)=>P+I.total,0),C=typeof l=="string"?parseFloat(l)||0:l;return E*(1-C/100)},[o,l]),T=async()=>{if(o.length===0){g("Cannot finalize an empty bill.");return}v(!0),g(null);const E={patientId:e,items:o,amount:S,paymentMode:d,type:"lab",related_id:n,status:"paid",discountPercentage:Number(l)||0,labOrderId:n};try{const C=await ce("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)}),P=await C.json();if(!C.ok)throw new Error(P.message||"Failed to create bill.");alert("Bill created successfully!");const I=window.open("","_blank");if(I){const q=`
                    <html>
                        <head>
                            <title>Lab Bill</title>
                            <style>
                                body { font-family: sans-serif; }
                                .bill-container { max-width: 800px; margin: auto; padding: 20px; border: 1px solid #ccc; }
                                .bill-header { text-align: center; margin-bottom: 20px; }
                                .bill-item { display: flex; justify-content: space-between; padding: 5px 0; }
                                .bill-total { text-align: right; margin-top: 20px; font-weight: bold; }
                            </style>
                        </head>
                        <body>
                            <div class="bill-container">
                                <div class="bill-header">
                                    <h2>Lab Bill for ${a}</h2>
                                </div>
                                <div class="bill-items-list">
                                    ${o.map(L=>`
                                        <div class="bill-item">
                                            <span>${L.name}</span>
                                            <span>${L.total.toFixed(2)}</span>
                                        </div>
                                    `).join("")}
                                </div>
                                <div class="bill-total">
                                    Total: ${S.toFixed(2)}
                                </div>
                            </div>
                        </body>
                    </html>
                `;I.document.write(q),I.document.close(),I.print()}t()}catch(C){g(`Failed to process bill: ${C.message}`)}finally{v(!1)}};return i.jsxs("div",{className:"billing-layout",children:[i.jsx("main",{className:"order-content",children:i.jsxs("section",{className:"medications-card",children:[i.jsx("div",{className:"card-header no-print",children:i.jsx("h2",{children:"Lab Tests"})}),o.length>0?i.jsxs("table",{className:"medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"S.No."}),i.jsx("th",{children:"DESCRIPTION"}),i.jsx("th",{children:"PRICE"})]})}),i.jsx("tbody",{children:o.map((E,C)=>i.jsxs("tr",{children:[i.jsx("td",{children:C+1}),i.jsx("td",{children:E.name}),i.jsx("td",{children:E.total.toFixed(2)})]},C))})]}):i.jsx("p",{children:"No lab tests in this order."})]})}),i.jsx("aside",{className:"billing-sidebar no-print",children:i.jsxs("div",{className:"billing-summary-card",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Billing Summary"})}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["",o.reduce((E,C)=>E+C.total,0).toFixed(2)]})]}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Discount"}),i.jsxs("div",{className:"discount-input-wrapper",children:[i.jsx("input",{type:"number",value:l,onChange:E=>h(E.target.value),onBlur:E=>{E.target.value===""&&h(0)},min:"0",max:"100",className:"discount-input-total",disabled:b}),"%"]})]}),i.jsxs("div",{className:"summary-row grand-total-row",children:[i.jsx("strong",{children:"Grand Total"}),i.jsxs("strong",{children:["",S.toFixed(2)]})]}),f&&i.jsx("p",{className:"error-message",style:{color:"red",textAlign:"center"},children:f}),i.jsxs("div",{className:"payment-mode-section",children:[i.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:i.jsx("strong",{children:"Payment Mode"})}),i.jsxs("select",{id:"paymentMode",value:d,onChange:E=>u(E.target.value),className:"payment-mode-select",disabled:b,children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"upi",children:"UPI"}),i.jsx("option",{value:"card",children:"Card"}),i.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),i.jsx("option",{value:"credit",children:"Credit"})]})]}),i.jsx("div",{className:"bill-actions",children:i.jsx("button",{onClick:T,className:"primary-button",disabled:b||o.length===0,children:b?"Processing...":"Finalise and Bill"})})]})})]})},Ete=()=>{const e=Ft(),n=$r(),{labOrderId:t}=n.state||{},[r,a]=w.useState(null),[o,l]=w.useState(""),[h,d]=w.useState(null),[u,f]=w.useState(null),[g,b]=w.useState(null),[v,S]=w.useState(!0),[T,E]=w.useState(null);w.useEffect(()=>{if(!t){console.error("LabBillingPage loaded without a labOrderId."),e("/");return}(async()=>{S(!0),E(null);try{const I=await ce(`/api/lab/${t}`);if(!I.ok){const O=await I.json().catch(()=>({}));throw new Error(O.message||`Failed to fetch lab order details (Status: ${I.status})`)}const q=await I.json(),L=(q.tests||[]).filter(O=>O&&typeof O.name=="string"&&O.price!==void 0&&O.id!==void 0).map(O=>{const B=parseFloat(O.price||"0"),$=!isNaN(B)&&isFinite(B)?B:0;return{drug_id:O.id,name:O.name,price:$,quantity:1,total:$,type:"lab_test"}});if(b(L),q.patient_id){a(q.patient_id);const O=await ce(`/api/patients/${q.patient_id}`);if(O.ok){const B=await O.json();l(B.name),d(B.phone??null),f(B.insurance_type??null)}else l("Patient (Not Found)")}else throw new Error("Lab order does not have an associated patient.")}catch(I){console.error("Error fetching lab billing details:",I),E(`Failed to load details: ${I.message}`)}finally{S(!1)}})()},[t,e]);const C=()=>{console.log(`Lab billing process completed for Lab Order ID: ${t}`),e(-1)};return t?v?i.jsx("div",{className:"min-h-screen bg-neutral-light flex items-center justify-center",children:i.jsx("p",{className:"text-teal-600 animate-pulse",children:"Loading Lab Bill..."})}):T?i.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-red-600 p-4",children:[i.jsx(ob,{size:48,className:"mb-4"}),i.jsx("p",{className:"text-lg font-medium mb-2",children:"Error Loading Lab Bill"}),i.jsx("p",{className:"text-sm text-center mb-4",children:T}),i.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"}),i.jsx("button",{onClick:()=>e(-1),className:"mt-2 text-sm text-gray-600 hover:text-teal-700",children:"Go Back"})]}):i.jsx("div",{className:"pharmacy-billing-page",children:i.jsxs("div",{className:"billing-container printable-section",children:[i.jsxs("header",{className:"billing-header no-print",children:[i.jsxs("button",{onClick:()=>e(-1),className:"back-button",children:[i.jsx(fn,{size:20}),i.jsx("span",{children:"Back"})]}),i.jsx("h1",{children:"Lab Bill"})]}),i.jsx("div",{className:"billing-layout",children:i.jsxs("main",{className:"order-content",children:[i.jsxs("section",{className:"order-details-card no-print",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Patient Information"})}),i.jsxs("div",{className:"patient-info-grid",children:[i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Patient Name:"})," ",o]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Phone:"})," ",h||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Lab Order ID:"})," ",t]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Insurance:"})," ",u?u.replace(/_/g," "):"N/A"]})]})]}),r&&g&&i.jsx(Tte,{patientId:r,labOrderId:t,onBillingSuccess:C,initialItems:g,patientInsuranceType:u,patientName:o})]})})]})}):i.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-gray-600",children:[i.jsx(ob,{size:48,className:"mb-4 text-red-500"}),i.jsx("p",{className:"text-lg font-medium mb-2",children:"Missing Lab Order Information"}),i.jsx("p",{className:"text-sm",children:"Cannot load the lab billing page without a lab order ID."}),i.jsx("button",{onClick:()=>e("/"),className:"mt-4 px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700",children:"Go to Dashboard"})]})},Ate=()=>{const{patientId:e}=ia(),n=Ft(),[t,r]=w.useState([]),[a,o]=w.useState(!1),[l,h]=w.useState(null),[d,u]=w.useState("");return w.useEffect(()=>{(async()=>{if(!e){h("Patient ID not provided in URL.");return}o(!0),h(null),r([]);try{try{const v=await ce(`/api/patients/${e}`);if(v.ok){const S=await v.json();u(S.name)}}catch(v){console.warn("Could not fetch patient name:",v)}console.log(`Fetching pharmacy orders for patient ID: ${e}`);const g=await ce(`/api/pharmacy-orders/patient/${e}`);if(!g.ok){const v=await g.json().catch(()=>({}));throw new Error(v.message||`HTTP error! status: ${g.status}`)}const b=await g.json();console.log("Fetched Pharmacy Orders:",b),r(b||[])}catch(g){console.error("Error fetching pharmacy orders:",g),h(`Failed to load pharmacy orders: ${g.message}`)}finally{o(!1)}})()},[e]),i.jsxs("div",{className:"p-4 md:p-6 max-w-4xl mx-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6 border-b pb-3",children:[i.jsxs("button",{onClick:()=>n(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[i.jsx(fn,{size:16,className:"mr-1"}),"Back"]}),i.jsxs("h2",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[i.jsx(Eo,{size:20,className:"mr-2 text-purple-600"}),"Pharmacy Order History ",d&&`for ${d}`]}),i.jsx("div",{})," "]}),a&&i.jsx("p",{className:"text-center text-gray-500",children:"Loading pharmacy orders..."}),l&&i.jsx("p",{className:"text-center text-red-500 bg-red-100 p-3 rounded border border-red-300",children:l}),!a&&t.length===0&&!l&&i.jsx("p",{className:"text-center text-gray-500",children:"No pharmacy orders found for this patient."}),!a&&t.length>0&&i.jsx("div",{className:"space-y-4",children:t.map(f=>i.jsxs("div",{className:"p-4 border rounded bg-white shadow-sm",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsxs("p",{className:"text-sm text-gray-600",children:[i.jsx("strong",{children:"Date:"})," ",new Date(f.date).toLocaleDateString()]}),i.jsxs("p",{className:"text-sm font-medium capitalize",children:[i.jsx("strong",{children:"Status:"})," ",f.status]})]}),i.jsxs("p",{className:"text-sm text-gray-600",children:[i.jsx("strong",{children:"Prescribed By:"})," ",f.prescribedBy||"N/A"]}),f.dispensedBy&&i.jsxs("p",{className:"text-sm text-gray-600",children:[i.jsx("strong",{children:"Dispensed By:"})," ",f.dispensedBy]}),i.jsx("h4",{className:"text-md font-semibold mt-3 mb-1",children:"Medications:"}),i.jsx("ul",{className:"list-disc list-inside ml-4 text-sm text-gray-700 space-y-1",children:f.medications.map((g,b)=>i.jsxs("li",{children:[g.name," - Qty: ",g.quantity,g.tabletsPerDay&&` (${g.tabletsPerDay} per day`,g.numberOfDays&&` for ${g.numberOfDays} days)`,!g.tabletsPerDay&&g.numberOfDays&&` (for ${g.numberOfDays} days)`,g.tabletsPerDay&&!g.numberOfDays&&")"]},b))})]},f.id))})]})},hC=()=>{const e=Ft(),n=$r(),[t,r]=w.useState(null),[a,o]=w.useState([]),[l,h]=w.useState([]),[d,u]=w.useState(""),[f,g]=w.useState([]),[b,v]=w.useState(null),[S,T]=w.useState(!1),[E,C]=w.useState(null),[P,I]=w.useState(!0),[q,L]=w.useState(""),[O,B]=w.useState([]),[$,F]=w.useState(!1),[z,U]=w.useState(null),[V,ee]=w.useState(!1),[ie,ae]=w.useState(!1),[J,K]=w.useState([]),W=/^\+?[0-9\s\-().]{7,20}$/,re=/^[a-zA-Z\s'-]{2,}$/,A=w.useCallback(async()=>{try{const je=await ce("/api/drugs");if(!je.ok)throw new Error("Failed to fetch drugs");const Qe=await je.json();o(Qe)}catch(je){console.error("Failed to fetch available drugs:",je),v("Could not load drug list. "+je.message)}},[]),te=w.useCallback(async je=>{try{const Qe=await ce(`/api/pharmacy-orders/patient/${je}`);if(!Qe.ok){const dt=await Qe.json().catch(()=>({}));throw new Error(dt.message||`HTTP error! status: ${Qe.status}`)}const ze=await Qe.json();K(ze||[])}catch(Qe){console.error("Failed to fetch previous pharmacy orders:",Qe)}finally{}},[]);w.useEffect(()=>{var je;A(),(je=n.state)!=null&&je.patient?Se(n.state.patient):I(!0)},[A,n.state]),w.useEffect(()=>{t!=null&&t.id?te(t.id):K([])},[t,te]),w.useEffect(()=>{if(!d){g([]);return}const je=d.toLowerCase();g(a.filter(Qe=>{const ze=Qe.name&&Qe.name.toLowerCase().includes(je),dt=Qe.brand_name&&Qe.brand_name.toLowerCase().includes(je);return ze||dt}).slice(0,10))},[d,a]);const xe=w.useMemo(()=>Vb(async je=>{if(je.trim().length<2){B([]),F(!1),U(null);return}F(!0),U(null);try{const Qe=new URLSearchParams({search:encodeURIComponent(je),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),ze=await ce(`/api/patients?${Qe.toString()}`);if(!ze.ok)throw new Error("API Error");const dt=await ze.json();B(dt.patients)}catch(Qe){console.error("Error searching patients:",Qe),U(Qe.message||"Failed to search patients."),B([])}finally{F(!1)}},300),[W]),M=je=>{const Qe=je.target.value;L(Qe),ee(W.test(Qe)),ae(re.test(Qe)&&!W.test(Qe)),F(!0),xe(Qe)},Se=w.useCallback(je=>{r(je),I(!1),L(""),B([]),U(null)},[]),$e=w.useCallback(async je=>{if(!q||je==="phone"&&!V||je==="name"&&!ie){U(`Invalid ${je} to create a new patient.`);return}F(!0),U(null);try{const dt=await(await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:je==="name"?q:"direct pharmacy",phone:je==="phone"?q:null,age:null,gender:null,token:null})})).json();Se(dt)}catch(Qe){const ze=Qe.message||"";if(ze.toLowerCase().includes("patient limit")){e("/start-clinic-subscription",{state:{errorMessage:ze}});return}U(ze||"Failed to create new patient.")}finally{F(!1)}},[q,V,ie,Se]),he=()=>{r(null),I(!0),h([]),v(null),K([])},ge=je=>{if(!je)return null;const Qe=je.match(/(?:\d+x)?(\d+)/);return Qe?parseInt(Qe[1],10):null},me=je=>{if(l.some(Qe=>Qe.drug_id===je.id)){v(`${je.name||je.brand_name} is already in the order.`),setTimeout(()=>v(null),3e3),u(""),g([]);return}h(Qe=>[...Qe,{drug_id:je.id,name:je.name||je.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,tabletsPerDay:1,numberOfDays:1,price:Number(je.price)||0,originalPrice:Number(je.price)||0,stock:je.quantity_in_stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(je.price)||0)/(ge(je.unit)||1),unit:je.unit}]),u(""),g([])},de=()=>{const je=d.trim();je&&e("/dashboard/inventory/add",{state:{initialDrugName:je}})},Le=je=>{h(Qe=>Qe.filter(ze=>(ze.drug_id??ze.name)!==je))},He=(je,Qe)=>{h(ze=>ze.map(dt=>{if((dt.drug_id??dt.name)===je&&dt.isLoose){const Ze=ge(dt.unit),ct=parseInt(Qe,10),ft=isNaN(ct)?Qe:Math.max(0,ct),fe=(isNaN(ct)?0:ft)*(Ze??1)+(Number(dt.looseUnits)||0);return{...dt,loosePacks:ft,looseQuantity:fe}}return dt}))},pe=je=>{h(Qe=>Qe.map(ze=>(ze.drug_id??ze.name)===je&&ze.loosePacks===""?{...ze,loosePacks:0}:ze))},ne=(je,Qe)=>{h(ze=>ze.map(dt=>{if((dt.drug_id??dt.name)===je&&dt.isLoose){const Ze=ge(dt.unit),ct=parseInt(Qe,10),ft=isNaN(ct)?Qe:Math.max(0,ct),fe=(Number(dt.loosePacks)||0)*(Ze??1)+(isNaN(ct)?0:ft);return{...dt,looseUnits:ft,looseQuantity:fe}}return dt}))},Pe=je=>{h(Qe=>Qe.map(ze=>(ze.drug_id??ze.name)===je&&ze.looseUnits===""?{...ze,looseUnits:0}:ze))},Ye=je=>{const Qe=[];je.medications.forEach(ze=>{if(!l.find(Ze=>Ze.drug_id&&ze.drug_id&&Ze.drug_id===ze.drug_id||Ze.name.toLowerCase()===ze.name.toLowerCase())){let Ze=ze.drug_id,ct=ze.drug_id?a.find(ft=>ft.id===ze.drug_id):void 0;if(!ct&&ze.name){const ft=a.find(fe=>fe.name&&fe.name.toLowerCase()===ze.name.toLowerCase());ft?(Ze=ft.id,ct=ft):Ze&&(Ze=null)}Qe.push({drug_id:Ze,name:ze.name,pack_quantity:ze.pack_quantity??0,loose_quantity:ze.loose_quantity??0,directions_to_use:ze.directions_to_use,tabletsPerDay:ze.tabletsPerDay??1,numberOfDays:ze.numberOfDays??1,price:ct?ct.price:ze.price,stock:ct?ct.quantity_in_stock:ze.stock,isLoose:!0,loosePacks:0,looseUnits:(ze.pack_quantity??0)*(ge((ct==null?void 0:ct.unit)||ze.unit)??1)+(ze.loose_quantity??0),looseQuantity:(ze.pack_quantity??0)*(ge((ct==null?void 0:ct.unit)||ze.unit)??1)+(ze.loose_quantity??0),pricePerLooseUnit:(ct?Number(ct.price):Number(ze.price)||0)/(ge((ct==null?void 0:ct.unit)||ze.unit)||1),unit:(ct==null?void 0:ct.unit)||ze.unit})}}),h(ze=>[...ze,...Qe]),je.prescriptionForUnavailableDrugs&&(!E||!E.includes(je.prescriptionForUnavailableDrugs))&&C(ze=>ze?`${ze}

-- From previous order --
${je.prescriptionForUnavailableDrugs}`:je.prescriptionForUnavailableDrugs),v("Medications from previous order added."),setTimeout(()=>v(null),3e3)},rt=async je=>{if(je.preventDefault(),v(null),T(!0),!t){v("No patient selected."),T(!1);return}if(l.length===0&&!(E!=null&&E.trim())){v("Add medication or prescription notes."),T(!1);return}const Qe={patient_id:t.id,items:l.map(ze=>{const dt=Number(ze.price??0),Ze=Number(ze.pricePerLooseUnit??0),ct=Number((Ze*(ze.looseQuantity??0)).toFixed(2));return{drug_id:ze.drug_id||null,name:ze.name,pack_quantity:Number(ze.loosePacks)||0,loose_quantity:Number(ze.looseUnits)||0,pack_price:dt,loose_price:Ze,total_price:ct,price:Number(ze.originalPrice??0),directions_to_use:ze.directions_to_use??null,tabletsPerDay:Number(ze.tabletsPerDay??1),numberOfDays:Number(ze.numberOfDays??1)}}),order_total:ut,prescription_for_unavailable_drugs:E};try{const ze=await ce("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Qe)});if(!ze.ok)throw new Error("Order creation failed");await ze.json(),alert(`Order created successfully for ${t.name}!`);let dt=t.queueId;if(!dt)try{const Ze=await ce(`/api/queue/patient/${t.id}/latest`);if(Ze.ok){const ct=await Ze.json();ct!=null&&ct._id&&(dt=ct._id)}}catch(Ze){console.error("Error checking queue:",Ze)}if(!dt)try{const Ze=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:t.id})});if(Ze.ok){const ct=await Ze.json();ct!=null&&ct.id&&(dt=ct.id)}}catch(Ze){console.error("Error creating queue:",Ze)}dt?e(`/dashboard/edit-complaint/${dt}`,{state:{patientId:t.id}}):e(-1)}catch(ze){v(ze.message||"Failed to create order.")}finally{T(!1)}},ut=w.useMemo(()=>l.reduce((je,Qe)=>{const ze=Qe.isLoose?Qe.pricePerLooseUnit??0:Qe.price??0,dt=Qe.isLoose?Qe.looseQuantity??0:Qe.quantity??0;return je+ze*dt},0),[l]);return i.jsxs("div",{className:"add-pharmacy-order-page p-4 md:p-8 max-w-7xl mx-auto",children:[i.jsx("div",{className:"page-header",children:i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>e(-1),className:"back-button",title:"Go Back",children:i.jsx(fn,{size:20})}),i.jsx("h2",{children:"Create Pharmacy Order"})]})}),b&&i.jsxs("div",{className:"bg-red-900/20 border border-red-500/50 text-red-200 p-4 rounded-xl mb-6 flex items-start gap-3 animate-fade-in",children:[i.jsx(mi,{className:"shrink-0 mt-0.5",size:18}),i.jsx("span",{children:b})]}),P&&i.jsx("div",{className:"max-w-2xl mx-auto mt-10",children:i.jsxs("div",{className:"content-panel",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Mo,{size:20,className:"text-indigo-400"})," Select Patient"]}),i.jsxs("div",{className:"patient-search-container",children:[i.jsxs("div",{className:"pharmacy-search-bar",children:[i.jsx(Pi,{className:"search-icon",size:20}),i.jsx("input",{type:"text",placeholder:"Search by Name, Token # or Phone...",value:q,onChange:M,className:"pharmacy-search-input",autoFocus:!0}),$&&i.jsx("div",{className:"pr-4 text-xs text-indigo-400 animate-pulse",children:"Searching..."})]}),z&&i.jsx("p",{className:"text-red-400 text-sm mt-2 pl-1 animate-fadeIn",children:z}),O.length>0&&i.jsx("div",{className:"search-results-dropdown",children:O.map(je=>i.jsxs("div",{onClick:()=>Se(je),className:"search-result-item",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("span",{className:"text-white font-medium flex items-center",children:[i.jsxs("span",{className:"token-badge",children:["#",je.token]}),je.name]}),i.jsxs("span",{className:"text-xs text-gray-400 mt-1 pl-1",children:[je.gender,"  ",je.age," yrs  ",je.phone||"No phone"]})]}),i.jsx(sb,{size:16,className:"text-gray-600 -rotate-90"})]},je.id))}),!$&&q.length>2&&O.length===0&&i.jsxs("div",{className:"mt-4 p-4 bg-zinc-800/50 rounded-lg text-center border border-dashed border-zinc-700",children:[i.jsxs("p",{className:"text-gray-400 mb-3 text-sm",children:['No patient found matching "',q,'"']}),i.jsxs("div",{className:"flex justify-center gap-3",children:[V&&i.jsx("button",{onClick:()=>$e("phone"),className:"px-4 py-2 bg-green-600/20 text-green-400 border border-green-600/50 rounded-lg text-sm hover:bg-green-600/30 transition-colors",children:"Create with Phone"}),ie&&i.jsx("button",{onClick:()=>$e("name"),className:"px-4 py-2 bg-indigo-600/20 text-indigo-400 border border-indigo-600/50 rounded-lg text-sm hover:bg-indigo-600/30 transition-colors",children:"Create with Name"})]})]})]})]})}),!P&&t&&i.jsxs("form",{onSubmit:rt,className:"pharmacy-order-grid animate-fade-in",children:[i.jsxs("div",{className:"order-main-column",children:[i.jsxs("div",{className:"content-panel mb-6",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Pi,{size:18,className:"text-indigo-400"})," Add Medication"]}),i.jsxs("div",{className:"relative drug-search-container",children:[i.jsxs("div",{className:"pharmacy-search-bar",children:[i.jsx(Pi,{className:"search-icon",size:18}),i.jsx("input",{type:"text",placeholder:"Search for drugs...",value:d,onChange:je=>u(je.target.value),className:"pharmacy-search-input"})]}),f.length>0&&i.jsx("div",{className:"search-results-dropdown",children:f.map(je=>i.jsx("div",{onClick:()=>me(je),className:"search-result-item",children:i.jsxs("div",{className:"flex justify-between w-full",children:[i.jsxs("div",{children:[i.jsx("span",{className:"drug-name",children:je.name||je.brand_name}),i.jsxs("span",{className:"drug-meta text-xs",children:["Stock: ",je.quantity_in_stock]})]}),i.jsx("div",{className:"text-right",children:i.jsxs("span",{className:"text-indigo-300 font-mono",children:["",Number(je.price).toFixed(2)]})})]})},je.id))}),d&&f.length===0&&!a.find(je=>{var Qe;return((Qe=je.name)==null?void 0:Qe.toLowerCase())===d.toLowerCase()})&&i.jsx("div",{className:"search-results-dropdown p-2",children:i.jsxs("button",{type:"button",onClick:de,className:"w-full text-left px-4 py-2 text-indigo-400 hover:bg-zinc-800 rounded-lg text-sm transition-colors",children:['+ Add "',d,'" to Inventory']})})]})]}),i.jsxs("div",{className:"content-panel min-h-[400px]",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Io,{size:18,className:"text-indigo-400"})," Order Items (",l.length,")"]}),l.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx(Io,{size:48,className:"empty-icon mx-auto",strokeWidth:1}),i.jsx("p",{className:"empty-text",children:"No medications added yet"}),i.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Search above to add items to the order"})]}):i.jsx("div",{className:"order-table-container",children:i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"30%"},children:"Drug Name"}),i.jsx("th",{children:"Dosage / Directions"}),i.jsx("th",{children:"Qty (Packs/Loose)"}),i.jsx("th",{children:"Price"}),i.jsx("th",{})]})}),i.jsx("tbody",{children:l.map((je,Qe)=>{const ze=je.drug_id??je.name,dt=(je.pricePerLooseUnit??0)*(je.looseQuantity??0);return i.jsxs("tr",{className:"group",children:[i.jsxs("td",{children:[i.jsx("span",{className:"drug-name",children:je.name}),i.jsxs("span",{className:"drug-meta",children:["Stock: ",je.stock,"  Box of ",ge(je.unit)||1]})]}),i.jsx("td",{children:i.jsx("div",{className:"flex flex-col gap-2",children:i.jsx("input",{type:"text",placeholder:"Directions...",value:je.directions_to_use||"",onChange:Ze=>{const ct=Ze.target.value;h(ft=>ft.map(fe=>(fe.drug_id??fe.name)===ze?{...fe,directions_to_use:ct}:fe))},className:"table-input w-full"})})}),i.jsx("td",{children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"qty-input-group",children:[i.jsx("span",{className:"text-xs text-gray-500 w-8",children:"Pks:"}),i.jsx("input",{type:"number",min:"0",value:je.loosePacks,onChange:Ze=>He(ze,Ze.target.value),onBlur:()=>pe(ze),className:"table-input medium"})]}),i.jsxs("div",{className:"qty-input-group",children:[i.jsx("span",{className:"text-xs text-gray-500 w-8",children:"Unit:"}),i.jsx("input",{type:"number",min:"0",value:je.looseUnits,onChange:Ze=>ne(ze,Ze.target.value),onBlur:()=>Pe(ze),className:"table-input medium"})]})]})}),i.jsx("td",{children:i.jsxs("div",{className:"font-mono text-sm",children:["",dt.toFixed(2)]})}),i.jsx("td",{children:i.jsx("button",{type:"button",onClick:()=>Le(ze),className:"delete-btn opacity-0 group-hover:opacity-100",title:"Remove Item",children:i.jsx(Wi,{size:16})})})]},`${ze}-${Qe}`)})})]})})]}),i.jsxs("div",{className:"content-panel",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(ds,{size:18,className:"text-indigo-400"})," Additional Notes / Prescription"]}),i.jsx("textarea",{value:E??"",onChange:je=>C(je.target.value||null),placeholder:"Enter notes for unavailable drugs or special instructions...",className:"custom-text-input bg-zinc-900/50 min-h-[100px] border border-zinc-800 rounded-lg resize-y"})]})]}),i.jsxs("div",{className:"order-sidebar",children:[i.jsxs("div",{className:"patient-card mb-6",children:[i.jsx("div",{className:"patient-avatar",children:t.name.charAt(0).toUpperCase()}),i.jsx("h3",{className:"patient-name",children:t.name}),i.jsx("div",{className:"patient-meta",children:i.jsxs("span",{children:["Token: #",t.token]})}),i.jsxs("div",{className:"patient-detail-grid",children:[i.jsxs("div",{className:"detail-item",children:[i.jsx("label",{children:"Age / Gender"}),i.jsxs("p",{children:[t.age||"--"," / ",t.gender||"--"]})]}),i.jsxs("div",{className:"detail-item",children:[i.jsx("label",{children:"Phone"}),i.jsx("p",{children:t.phone||"--"})]})]}),i.jsx("button",{type:"button",onClick:he,className:"change-patient-btn",children:"Change Patient"})]}),J.length>0&&i.jsxs("div",{className:"content-panel mb-6 p-4",children:[i.jsxs("div",{className:"section-title text-sm mb-3",children:[i.jsx(NI,{size:16,className:"text-indigo-400"})," Recent Orders"]}),i.jsx("div",{className:"max-h-[200px] overflow-y-auto pr-1 custom-scrollbar",children:J.map(je=>i.jsxs("div",{className:`prev-order-item status-${je.status}`,children:[i.jsxs("div",{className:"prev-order-header",children:[i.jsx("span",{className:"prev-order-date",children:new Date(je.date).toLocaleDateString()}),i.jsx("span",{className:`status-badge ${je.status}`,children:je.status})]}),i.jsx("div",{className:"text-xs text-gray-500 mb-2 truncate",children:je.medications.map(Qe=>Qe.name).join(", ")}),i.jsx("button",{type:"button",onClick:()=>Ye(je),className:"add-prev-btn",children:"+ Add items"})]},je.id))})]}),i.jsxs("div",{className:"content-panel order-summary-container",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Xd,{size:18,className:"text-indigo-400"})," Summary"]}),i.jsx("div",{className:"summary-details",children:i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Total Items"}),i.jsx("span",{children:l.length})]})}),i.jsxs("div",{className:"summary-total",children:[i.jsx("span",{className:"total-label",children:"Grand Total"}),i.jsxs("span",{className:"total-value",children:["",ut.toFixed(2)]})]}),i.jsxs("button",{type:"submit",disabled:S||l.length===0&&!E,className:"create-order-btn",children:[S?i.jsx("div",{className:"spinner"}):i.jsx(Vs,{size:20}),S?"Processing...":"Create Order"]})]})]})]})]})},OE=()=>{const{orderId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState(null),[l,h]=w.useState([]),[d,u]=w.useState([]),[f,g]=w.useState(""),[b,v]=w.useState([]),[S,T]=w.useState(null),[E,C]=w.useState(!1),[P,I]=w.useState(null),[q,L]=w.useState(!0),O=W=>{if(!W)return null;const re=W.match(/(?:\d+x)?(\d+)/);return re?parseInt(re[1],10):null},B=w.useCallback(async()=>{L(!0);try{const W=await ce(`/api/pharmacy-orders/${e}`);if(!W.ok)throw new Error("Failed to fetch order details");const re=await W.json();r(re),o({id:re.patientId,name:re.patientName||"N/A",token:re.patientTokenNumber}),I(re.prescriptionForUnavailableDrugs);const A=re.medications.map(te=>{const xe=O(te.unit),M=te.pack_quantity*(xe??1)+te.loose_quantity;return{...te,isLoose:!0,loosePacks:te.pack_quantity,looseUnits:te.loose_quantity,looseQuantity:M,pack_price:te.pack_price,loose_price:te.loose_price,total_price:te.total_price,pricePerLooseUnit:te.loose_price,originalPrice:te.pack_price,box_number:te.box_number,unit:te.unit,batch:te.batch,expiry_date:te.expiry_date,discount_percentage:te.discount_percentage}});u(A)}catch(W){T("Could not load order details. "+W.message)}finally{L(!1)}},[e]),$=w.useCallback(async()=>{try{const W=await ce("/api/drugs");if(!W.ok)throw new Error("Failed to fetch drugs");const re=await W.json();h(re)}catch(W){T("Could not load drug list. "+W.message)}},[]);w.useEffect(()=>{B(),$()},[B,$]),w.useEffect(()=>{if(!f){v([]);return}const W=f.toLowerCase();v(l.filter(re=>{const A=re.name&&re.name.toLowerCase().includes(W),te=re.brand_name&&re.brand_name.toLowerCase().includes(W);return A||te}).slice(0,10))},[f,l]);const F=W=>{if(d.some(re=>re.drug_id===W.id)){T(`${W.name||W.brand_name} is already in the order.`),setTimeout(()=>T(null),3e3),g(""),v([]);return}u(re=>[...re,{drug_id:W.id,name:W.name||W.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,pack_price:Number(W.price)||0,loose_price:(Number(W.price)||0)/(O(W.unit)||1),total_price:(Number(W.price)||0)/(O(W.unit)||1),discount_percentage:0,directions_to_use:"",tabletsPerDay:1,numberOfDays:1,stock:W.quantity_in_stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(W.price)||0)/(O(W.unit)||1),originalPrice:Number(W.price)||0,unit:W.unit}]),g(""),v([])},z=W=>{u(re=>re.filter(A=>(A.drug_id??A.name)!==W))},U=(W,re)=>{u(A=>A.map(te=>{if((te.drug_id??te.name)===W&&te.isLoose){const xe=O(te.unit),M=parseInt(re,10),Se=isNaN(M)?re:Math.max(0,M),$e=(isNaN(M)?0:Se)*(xe??1)+(Number(te.looseUnits)||0);return{...te,loosePacks:Se,looseQuantity:$e,pack_quantity:isNaN(M)?0:Se}}return te}))},V=W=>{u(re=>re.map(A=>(A.drug_id??A.name)===W&&A.loosePacks===""?{...A,loosePacks:0}:A))},ee=(W,re)=>{u(A=>A.map(te=>{if((te.drug_id??te.name)===W&&te.isLoose){const xe=O(te.unit),M=parseInt(re,10),Se=isNaN(M)?re:Math.max(0,M),$e=(Number(te.loosePacks)||0)*(xe??1)+(isNaN(M)?0:Se);return{...te,looseUnits:Se,looseQuantity:$e,loose_quantity:isNaN(M)?0:Se}}return te}))},ie=W=>{u(re=>re.map(A=>(A.drug_id??A.name)===W&&A.looseUnits===""?{...A,looseUnits:0}:A))},ae=w.useMemo(()=>d.reduce((W,re)=>{const A=re.loose_price??0,te=re.looseQuantity??0;return W+A*te},0),[d]),J=(Number(ae)||0).toFixed(2),K=async W=>{if(W.preventDefault(),T(null),C(!0),d.length===0&&!(P!=null&&P.trim())){T("Please add at least one medication or provide a prescription."),C(!1);return}const re={items:d.map(A=>({drug_id:A.drug_id??null,name:A.name,pack_quantity:Number(A.loosePacks)||0,loose_quantity:Number(A.looseUnits)||0,pack_price:A.pack_price??0,loose_price:A.loose_price??0,total_price:(A.loose_price??0)*(A.looseQuantity??0),discount_percentage:A.discount_percentage??0,directions_to_use:A.directions_to_use??null,tabletsPerDay:A.tabletsPerDay??1,numberOfDays:A.numberOfDays??1})),prescription_for_unavailable_drugs:P,order_total:ae};try{if(!(await ce(`/api/pharmacy-orders/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)})).ok)throw new Error("Failed to update order");alert("Pharmacy order updated successfully!"),n(-1)}catch(A){T(A.message||"Failed to update order.")}finally{C(!1)}};return q?i.jsx("div",{className:"add-pharmacy-order-page flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"spinner mb-4 mx-auto"}),i.jsx("p",{className:"text-gray-400 animate-pulse",children:"Loading order details..."})]})}):t?i.jsxs("div",{className:"add-pharmacy-order-page max-w-7xl mx-auto",children:[i.jsx("div",{className:"page-header px-2 md:px-4",children:i.jsxs("div",{className:"flex items-center justify-between w-full",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>n(-1),className:"back-button",title:"Go Back",children:i.jsx(fn,{size:20})}),i.jsxs("div",{className:"flex flex-col",children:[i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("h2",{className:"m-0 bg-transparent -webkit-text-fill-color-current text-indigo-500 font-bold text-lg md:text-xl",children:"Edit Order"}),i.jsx("span",{className:"text-gray-400 font-light px-2 hidden md:block",children:"|"}),i.jsxs("div",{className:"header-patient-info flex items-center gap-2",children:[i.jsx("span",{className:"text-slate-800 dark:text-gray-200 font-bold text-lg md:text-xl",children:a==null?void 0:a.name}),i.jsxs("span",{className:"bg-indigo-500/10 text-indigo-400 px-2.5 py-0.5 rounded-full font-bold text-xs",children:["#",(a==null?void 0:a.token)||"N/A"]})]})]}),i.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[i.jsx(Xf,{size:12,className:"text-gray-500"}),i.jsxs("span",{className:"text-xs text-gray-500",children:["Order Date: ",new Date(t.date).toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})]})]})]})]}),i.jsx("div",{className:"flex items-center gap-3",children:i.jsx("span",{className:`status-badge ${t.status}`,children:t.status})})]})}),i.jsxs("form",{onSubmit:K,className:"pharmacy-order-grid animate-fade-in px-2 md:px-4",children:[i.jsxs("div",{className:"order-main-column",children:[i.jsxs("div",{className:"content-panel search-panel mb-4",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Pi,{size:20,className:"text-indigo-400"}),i.jsx("span",{children:"Find & Add Medication"})]}),i.jsxs("div",{className:"relative",children:[i.jsxs("div",{className:"pharmacy-search-bar",children:[i.jsx(Pi,{className:"search-icon",size:20}),i.jsx("input",{type:"text",placeholder:"Search by name or brand...",value:f,onChange:W=>g(W.target.value),className:"pharmacy-search-input"})]}),b.length>0&&i.jsx("div",{className:"search-results-dropdown",children:b.map(W=>i.jsxs("div",{onClick:()=>F(W),className:"search-result-item",children:[i.jsxs("div",{children:[i.jsx("div",{className:"drug-name-result",children:W.name||W.brand_name}),i.jsxs("div",{className:"drug-stock-result flex items-center gap-1",children:[i.jsx(Eo,{size:12})," Stock: ",W.quantity_in_stock]})]}),i.jsxs("div",{className:"text-right",children:[i.jsxs("div",{className:"text-indigo-400 font-bold",children:["",Number(W.price).toFixed(2)]}),i.jsx("div",{className:"text-[10px] text-gray-500 uppercase tracking-tighter",children:"per unit"})]})]},W.id))})]})]}),i.jsxs("div",{className:"content-panel min-h-[250px]",children:[i.jsx("div",{className:"section-title flex justify-between items-center",children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Io,{size:20,className:"text-indigo-400"}),i.jsx("span",{children:"Medications in Order"}),i.jsxs("span",{className:"bg-indigo-500/10 text-indigo-400 text-xs px-2 py-0.5 rounded-full ml-2",children:[d.length," items"]})]})}),d.length===0?i.jsxs("div",{className:"empty-state",children:[i.jsx("div",{className:"p-6 bg-indigo-500/5 rounded-full mb-4",children:i.jsx(Io,{size:48,className:"empty-icon",strokeWidth:1})}),i.jsx("p",{className:"empty-text",children:"No medications added yet"}),i.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Search and add drugs from the panel above"})]}):i.jsx("div",{className:"order-table-container",children:i.jsxs("table",{className:"order-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"35%"},children:"Medication"}),i.jsx("th",{style:{width:"25%"},children:i.jsx("div",{className:"flex items-center gap-1",children:"Directions"})}),i.jsx("th",{style:{width:"25%"},children:i.jsx("div",{className:"flex items-center gap-1",children:"Quantity"})}),i.jsx("th",{style:{width:"10%"},children:"Subtotal"}),i.jsx("th",{style:{width:"5%"}})]})}),i.jsx("tbody",{children:d.map((W,re)=>{const A=W.drug_id??W.name,te=(W.loose_price??0)*(W.looseQuantity??0);return i.jsxs("tr",{className:"group",children:[i.jsx("td",{children:i.jsxs("div",{className:"drug-info-cell",children:[i.jsx("span",{className:"drug-name",children:W.name}),i.jsxs("div",{className:"drug-meta",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Eo,{size:12})," Stock: ",W.stock]}),i.jsx("span",{className:"text-gray-600",children:""}),i.jsxs("span",{className:"flex items-center gap-1 text-xs px-1.5 py-0.5 bg-zinc-800 rounded",children:["BOX OF ",O(W.unit)||1]})]})]})}),i.jsx("td",{children:i.jsx("input",{type:"text",placeholder:"e.g. 1-0-1 after food",value:W.directions_to_use||"",onChange:xe=>{const M=xe.target.value;u(Se=>Se.map($e=>($e.drug_id??$e.name)===A?{...$e,directions_to_use:M}:$e))},className:"table-input"})}),i.jsx("td",{children:i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsxs("div",{className:"qty-input-group",children:[i.jsx("span",{className:"qty-label",children:"PACKS"}),i.jsx("input",{type:"number",min:"0",value:W.loosePacks,onChange:xe=>U(A,xe.target.value),onBlur:()=>V(A),className:"table-input"})]}),i.jsxs("div",{className:"qty-input-group",children:[i.jsx("span",{className:"qty-label",children:"UNITS"}),i.jsx("input",{type:"number",min:"0",value:W.looseUnits,onChange:xe=>ee(A,xe.target.value),onBlur:()=>ie(A),className:"table-input"})]})]})}),i.jsx("td",{children:i.jsxs("div",{className:"font-mono font-bold text-indigo-400",children:["",te.toFixed(2)]})}),i.jsx("td",{children:i.jsx("button",{type:"button",onClick:()=>z(A),className:"delete-btn",title:"Remove Item",children:i.jsx(Wi,{size:16})})})]},`${A}-${re}`)})})]})})]})]}),i.jsxs("div",{className:"order-sidebar",children:[i.jsxs("div",{className:"content-panel order-summary-container",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(Xd,{size:20,className:"text-indigo-400"}),i.jsx("span",{children:"Billing Summary"})]}),i.jsxs("div",{className:"summary-details",children:[i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Medications Count"}),i.jsx("span",{className:"text-slate-700 dark:text-gray-200 font-bold",children:d.length})]}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Tax (Inc.)"}),i.jsx("span",{className:"text-slate-700 dark:text-gray-200",children:"0.00"})]})]}),i.jsxs("div",{className:"summary-total",children:[i.jsx("span",{className:"total-label",children:"Grand Total"}),i.jsxs("span",{className:"total-value",children:["",J]})]}),S&&i.jsxs("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-xl flex items-start gap-3 text-sm text-red-400 animate-pulse mt-4",children:[i.jsx(mi,{size:18,className:"shrink-0"}),i.jsx("span",{children:S})]}),i.jsxs("button",{type:"submit",disabled:E,className:`floating-action-btn w-full mt-4 py-2.5 rounded-lg font-bold flex items-center justify-center gap-2 ${E?"opacity-70 cursor-not-allowed":""}`,style:{position:"relative",bottom:"auto",right:"auto"},children:[E?i.jsx("div",{className:"spinner"}):i.jsx(Vs,{size:22}),E?"Updating Order...":"Confirm Changes"]})]}),i.jsxs("div",{className:"content-panel mt-3",children:[i.jsxs("div",{className:"section-title",children:[i.jsx(qs,{size:18,className:"text-indigo-400"}),i.jsx("span",{className:"text-sm",children:"Prescription Notes"})]}),i.jsx("textarea",{rows:3,value:P??"",onChange:W=>I(W.target.value||null),placeholder:"Add notes about unavailable drugs...",className:"table-input w-full resize-none min-h-[80px] text-sm"})]})]})]})]}):i.jsx("div",{className:"add-pharmacy-order-page flex items-center justify-center",children:i.jsxs("div",{className:"content-panel text-center max-w-md",children:[i.jsx(mi,{size:48,className:"text-red-500 mx-auto mb-4"}),i.jsx("h2",{className:"text-xl font-bold mb-2",children:"Order Not Found"}),i.jsx("p",{className:"text-gray-400 mb-6",children:"We couldn't find the pharmacy order you're looking for."}),i.jsx("button",{onClick:()=>n(-1),className:"back-button mx-auto",children:i.jsx(fn,{size:20})})]})})},Dte="gemini-3-flash-preview";async function Pte(){const e=nh();if(!e)throw new Error("Authentication token not found. Please log in.");try{const t=await(await ce("/api/clinics/settings",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch clinic-specific Gemini API key, trying global fallback.",n)}try{const t=await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch global Gemini API key.",n)}throw new Error("Gemini API key not found. Please contact your administrator.")}let X0=null;async function Ite(){if(!X0){const e=await Pte();X0=new Sg({apiKey:e})}return X0}const Mte=`You are an expert Pharmacy Inventory Manager. You help the user manage their drug stock, find items, and update details.

**Your Goal:**
Help the user strictly based on the provided inventory data.

**Capabilities:**
1.  **Analyze:** Value of stock, low stock items, expiry dates.
2.  **Navigate:** Filter the list (Low Stock, Expired) or Search.
3.  **Edit:** Update drug details (Price, Stock, Name) using the **Serial Number** (#).

**Tools / Actions:**
To respond, you must output a **JSON object**.

- **Text Response:**
  \`{ "response_type": "text", "content": "Your answer..." }\`

- **Set Filter:** Change the view filter.
  Options: 'all', 'low-stock', 'near-expiry', 'expired'
  \`{ "response_type": "action", "action_name": "set_filter", "parameters": { "filter": "low-stock" } }\`

- **Search Drug:** Type into the search bar.
  \`{ "response_type": "action", "action_name": "search_drug", "parameters": { "query": "Para" } }\`

- **Edit Drug:** Update a drug's details using its **Serial Number**.
  *IMPORTANT:* Use the \`serialNumber\` provided in the data list, NOT the database ID.
  \`{ "response_type": "action", "action_name": "edit_drug", "parameters": { "serialNumber": 5, "updates": { "price": 100, "quantity_in_stock": 50 } } }\`

- **End Analysis:** Stop the loop.
  \`{ "response_type": "action", "action_name": "end_analysis", "content": "Done." }\`

**Important Note on Loops:** 
If you use an action (Filter, Search, Edit), the system will automatically refresh the data and call you again. You do not need to ask the user to wait.

**Response Format:**
ALWAYS return valid JSON code block.
\`\`\`json
{ ... }
\`\`\`
`;async function Rte(e){const{query:n,inventoryData:t,currentFilter:r,currentSearch:a,history:o=[],imageBase64:l,imageMimeType:h}=e,d=t.map(v=>({"#":v.serialNumber,name:v.name,stock:v.quantity_in_stock,price:v.price,expiry:v.expiry_date,batch:v.batch,loose:v.loose}));let u=`Current Filter: ${r}
`;u+=`Current Search Term: "${a}"
`,u+=`Visible Inventory (${d.length} items): ${JSON.stringify(d)}
`;const f=[];l&&h&&f.push({inlineData:{data:l,mimeType:h}});const g=`User Question: "${n}"

Context Data:
${u}

Act on this request based on the data above.`;f.push({text:g});const b=[{role:"user",parts:[{text:`SYSTEM INSTRUCTION:
${Mte}`}]},{role:"model",parts:[{text:"Understood. I am your expert Pharmacy Inventory Manager. I will help you analyze stock, navigate filters, and edit drug details using valid JSON actions."}]},...o.map(v=>({role:v.role==="model"?"model":"user",parts:[{text:v.content}]})),{role:"user",parts:f}];try{const v=await Ite(),S={model:Dte,contents:b,config:{responseMimeType:"application/json"}},T=await v.models.generateContentStream(S);let E="";for await(const C of T){const P=C.text;P&&(E+=P)}try{const C=E.replace(/```json/g,"").replace(/```/g,"").trim();return JSON.parse(C)}catch(C){return console.warn("Failed to parse Gemini JSON response:",C),{response_type:"text",content:E}}}catch(v){throw console.error("Pharmacy AI Error:",v),new Error(v.message||"Failed to generate response.")}}const fC=10,Ote=3,LE=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState([]),[o,l]=w.useState(""),[h,d]=w.useState(!0),[u,f]=w.useState(null),[g,b]=w.useState(new Set),[v,S]=w.useState("all"),[T,E]=w.useState(1),[C]=w.useState(15),P=async()=>{try{const Ie=await ce("/api/inventory/download-csv");if(!Ie.ok)throw new Error(`Failed to download CSV: ${Ie.statusText}`);const pt=await Ie.blob(),mt=window.URL.createObjectURL(pt),rn=document.createElement("a");rn.href=mt,rn.download="pharmacy_inventory.csv",document.body.appendChild(rn),rn.click(),rn.remove(),window.URL.revokeObjectURL(mt)}catch(Ie){console.error("Failed to download CSV:",Ie),f(Ie.message||"Failed to download inventory CSV. Please try again.")}},[I,q]=w.useState(!1),[L,O]=w.useState(!1),[B,$]=w.useState(null),[F,z]=w.useState(!1),[U,V]=w.useState(new Set),[ee,ie]=w.useState(null),[ae,J]=w.useState(0),[K,W]=w.useState(!1),[re,A]=w.useState(null),[te,xe]=w.useState(1),[M,Se]=w.useState(!1),[$e,he]=w.useState(!1),[ge,me]=w.useState([]),[de,Le]=w.useState([]),[He,pe]=w.useState(""),[ne,Pe]=w.useState(!1),[Ye,rt]=w.useState(null),ut=w.useRef(null),je=w.useRef(null),Qe=w.useRef(null);w.useEffect(()=>{$e&&ut.current&&ut.current.scrollIntoView({behavior:"smooth"})},[ge,$e]);const ze=w.useCallback(async()=>{d(!0),f(null);try{const Ie=await ce("/api/drugs");if(!Ie.ok)throw new Error(`Failed to fetch drugs: ${Ie.statusText} (${Ie.status})`);let pt=await Ie.json();pt=pt.map(mt=>({...mt,price:parseFloat(String(mt.price))||0,buying_price:mt.buying_price!==null&&mt.buying_price!==void 0?parseFloat(String(mt.buying_price)):null,quantity_in_stock:parseInt(String(mt.quantity_in_stock),10)||0,gst:mt.gst!==null&&mt.gst!==void 0?parseFloat(String(mt.gst)):null,margin:mt.margin!==null&&mt.margin!==void 0?parseFloat(String(mt.margin)):null,discount:mt.discount!==null&&mt.discount!==void 0?parseFloat(String(mt.discount)):null})),t(pt),a(pt)}catch(Ie){console.error("Failed to fetch drugs:",Ie),f(Ie.message||"Failed to load inventory. Please try again.")}finally{d(!1)}},[]);w.useEffect(()=>{ze()},[ze]);const dt=(Ie,pt,mt)=>{const rn=$1(mt,Ote);return pt==="low-stock"?Ie.filter(Xt=>Xt.quantity_in_stock<=fC):pt==="near-expiry"?Ie.filter(Xt=>{if(!Xt.expiry_date)return!1;const Zn=Sb(Xt.expiry_date);return pg(Zn)&&Zd(Zn,rn)&&!Zd(Zn,mt)}):pt==="expired"?Ie.filter(Xt=>{if(!Xt.expiry_date)return!1;const Zn=Sb(Xt.expiry_date);return pg(Zn)&&Zd(Zn,mt)}):Ie};w.useEffect(()=>{const Ie=o.toLowerCase();let pt=n.filter(mt=>{var Mi,hr,Mn,Li,fr;const rn=((Mi=mt.name)==null?void 0:Mi.toLowerCase())||"",Xt=((hr=mt.description)==null?void 0:hr.toLowerCase())||"",Zn=((Mn=mt.supplier)==null?void 0:Mn.toLowerCase())||"",Bi=((Li=mt.box_number)==null?void 0:Li.toLowerCase())||"",Qi=((fr=mt.brand_name)==null?void 0:fr.toLowerCase())||"";return rn.includes(Ie)||Xt.includes(Ie)||Zn.includes(Ie)||Bi.includes(Ie)||Qi.includes(Ie)});pt=dt(pt,v,new Date),a(pt),E(1)},[o,n,v]);const Ze=T*C,ct=Ze-C,ft=r.slice(ct,Ze),fe=Math.ceil(r.length/C),Q=Ie=>{E(Ie)},ue=()=>{q(!1),ie(null)},De=Ie=>{J(parseInt(Ie.target.value,10)||0)},Ge=async Ie=>{if(Ie.preventDefault(),f(null),!ee||!ee.id||ae===0){f("No drug selected or adjustment amount is zero.");return}try{const pt=await ce(`/api/drugs/${ee.id}/adjust-stock`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantityChange:ae})});if(!pt.ok){const rn=await pt.json();throw new Error(rn.message||`Failed to adjust stock: ${pt.statusText}`)}const mt=await pt.json();t(rn=>rn.map(Xt=>Xt.id===mt.id?mt:Xt)),ue(),alert(`Stock for "${mt.name}" adjusted successfully. New stock: ${mt.quantity_in_stock}`)}catch(pt){console.error("Failed to adjust stock:",pt),f(pt.message||"Failed to adjust stock. Please try again.")}},ye=Ie=>{$(Ie),O(!0)},Ne=()=>{O(!1),$(null)},Me=async()=>{if(!B||!B.id){f("No drug selected for deletion.");return}d(!0),f(null);try{const Ie=await ce(`/api/drugs/${B.id}`,{method:"DELETE"});if(!Ie.ok){const pt=await Ie.json();throw new Error(pt.message||`Failed to delete drug: ${Ie.statusText}`)}alert(`Drug "${B.name}" deleted successfully.`),ze(),Ne()}catch(Ie){console.error("Failed to delete drug:",Ie),f(Ie.message||"Failed to delete drug. Please try again.")}finally{d(!1)}},Fe=()=>{z(!0)},ve=()=>{z(!1)},[ke,Ee]=w.useState(!1),Ve=()=>{U.size>0&&Ee(!0)},Ke=()=>{Ee(!1)},vt=async()=>{if(U.size===0){f("No drugs selected for deletion.");return}d(!0),f(null);try{const Ie=await ce("/api/drugs/batch-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({drugIds:Array.from(U)})});if(!Ie.ok){const pt=await Ie.json();throw new Error(pt.message||`Failed to delete selected drugs: ${Ie.statusText}`)}alert(`${U.size} drug(s) deleted successfully.`),ze(),V(new Set),Ke()}catch(Ie){console.error("Failed to delete selected drugs:",Ie),f(Ie.message||"Failed to delete selected drugs. Please try again.")}finally{d(!1)}},wt=async()=>{d(!0),f(null);try{const Ie=await ce("/api/drugs/all",{method:"DELETE"});if(!Ie.ok){const pt=await Ie.json();throw new Error(pt.message||`Failed to delete all drugs: ${Ie.statusText}`)}alert("All drugs deleted successfully."),ze(),ve()}catch(Ie){console.error("Failed to delete all drugs:",Ie),f(Ie.message||"Failed to delete all drugs. Please try again.")}finally{d(!1)}},nt=Ie=>{if(!Ie)return null;const pt=Ie.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return pt?parseInt(pt[1],10):null},bt=Ie=>{A(Ie),xe(1),W(!0)},Mt=()=>{W(!1),A(null),xe(1)},tt=Ie=>{xe(parseInt(Ie.target.value,10)||0)},Nt=async Ie=>{if(Ie.preventDefault(),f(null),!re||!re.id||te<=0){f("No drug selected or invalid number of packs to convert.");return}const pt=nt(re.unit);if(!pt||pt<=0){f(`Cannot convert "${re.name}" to loose. Invalid pack unit: ${re.unit||"N/A"}.`);return}if(te>(re.quantity_in_stock??0)){f(`Cannot convert ${te} packs. Only ${re.quantity_in_stock??0} packs are in stock.`);return}try{const mt=await ce(`/api/drugs/${re.id}/convert-to-loose`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({packsToConvert:te,packSize:pt})});if(!mt.ok){const Xt=await mt.json();throw new Error(Xt.message||`Failed to convert to loose: ${mt.statusText}`)}const rn=await mt.json();t(Xt=>Xt.map(Zn=>Zn.id===rn.id?rn:Zn)),Mt(),alert(`Converted ${te} pack(s) of "${rn.name}" to loose. New stock: ${rn.quantity_in_stock} packs, ${rn.loose??0} loose units.`)}catch(mt){console.error("Failed to convert to loose:",mt),f(mt.message||"Failed to convert to loose. Please try again.")}finally{d(!1)}},Lt=()=>{Se(!0)},pn=()=>{Se(!1)},Kt=async()=>{d(!0),f(null);try{const Ie=await ce("/api/drugs/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!Ie.ok){const pt=await Ie.json();throw new Error(pt.message||`Failed to add default medications: ${Ie.statusText}`)}alert("Default medications added successfully."),ze(),pn()}catch(Ie){console.error("Failed to add default medications:",Ie),f(Ie.message||"Failed to add default medications. Please try again.")}finally{d(!1)}},ln=Ie=>{var rn;const pt=(rn=Ie.target.files)==null?void 0:rn[0];if(!pt)return;const mt=new FileReader;mt.onloadend=()=>{rt({file:pt,preview:URL.createObjectURL(pt),base64:mt.result.split(",")[1]})},mt.readAsDataURL(pt)},Dt=async()=>{const Ie=await ce("/api/drugs",{cache:"no-store"});if(!Ie.ok)throw new Error("Failed to fetch fresh drugs for AI.");return(await Ie.json()).map(mt=>({...mt,price:parseFloat(String(mt.price))||0,buying_price:mt.buying_price!==null&&mt.buying_price!==void 0?parseFloat(String(mt.buying_price)):null,quantity_in_stock:parseInt(String(mt.quantity_in_stock),10)||0,gst:mt.gst!==null&&mt.gst!==void 0?parseFloat(String(mt.gst)):null,margin:mt.margin!==null&&mt.margin!==void 0?parseFloat(String(mt.margin)):null,discount:mt.discount!==null&&mt.discount!==void 0?parseFloat(String(mt.discount)):null,loose:mt.loose!==null&&mt.loose!==void 0?parseInt(String(mt.loose),10):null}))},mn=async(Ie,pt,mt)=>{let rn=Ie,Xt=v,Zn=o,Bi=0;const Qi=5,Mi=[...de];!rn.trim()&&pt&&(rn="Analyze this image and tell me what items are listed or what I should do with it.");try{for(;Bi<Qi;){const hr=await Dt(),Mn=Zn.toLowerCase();let Li=hr.filter(Pn=>{var Sr,Gs,Ys,$a,Ws;const pr=((Sr=Pn.name)==null?void 0:Sr.toLowerCase())||"",sr=((Gs=Pn.description)==null?void 0:Gs.toLowerCase())||"",Ol=((Ys=Pn.supplier)==null?void 0:Ys.toLowerCase())||"",or=(($a=Pn.box_number)==null?void 0:$a.toLowerCase())||"",Fa=((Ws=Pn.brand_name)==null?void 0:Ws.toLowerCase())||"";return pr.includes(Mn)||sr.includes(Mn)||Ol.includes(Mn)||or.includes(Mn)||Fa.includes(Mn)});Li=dt(Li,Xt,new Date);const fr=Li.map((Pn,pr)=>({...Pn,serialNumber:pr+1})),fi=await Rte({query:rn,inventoryData:fr,currentFilter:Xt,currentSearch:Zn,history:Mi,imageBase64:Bi===0?pt:void 0,imageMimeType:Bi===0?mt:void 0});if(fi.response_type==="action"){if(["set_filter","search_drug","edit_drug"].includes(fi.action_name)&&setTimeout(()=>{var Pn;(Pn=Qe.current)==null||Pn.scrollIntoView({behavior:"smooth",block:"start"})},100),fi.action_name==="set_filter"){const Pn=fi.parameters.filter;Xt=Pn,S(Pn),me(pr=>[...pr,{role:"ai",content:`Filtering list to show: ${Pn}...`}])}else if(fi.action_name==="search_drug"){const Pn=fi.parameters.query;Zn=Pn,l(Pn),me(pr=>[...pr,{role:"ai",content:`Searching for: "${Pn}"...`}])}else if(fi.action_name==="edit_drug"){const{serialNumber:Pn,updates:pr}=fi.parameters,sr=fr.find(or=>or.serialNumber===Pn);if(!sr||!sr.id){me(or=>[...or,{role:"ai",content:`Error: I couldn't find item #${Pn} to edit.`}]);break}if(me(or=>[...or,{role:"ai",content:`Updating "${sr.name}" (Item #${Pn})...`}]),!(await ce(`/api/drugs/${sr.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(pr)})).ok)throw new Error("Failed to update drug details via AI.");ze(),me(or=>[...or,{role:"ai",content:`Successfully updated "${sr.name}".`}])}else if(fi.action_name==="end_analysis"){fi.content&&me(Pn=>[...Pn,{role:"ai",content:fi.content}]);break}Mi.push({role:"model",content:JSON.stringify(fi)}),Mi.push({role:"user",content:`Action ${fi.action_name} executed successfully. Data refreshed.`}),Bi++}else{me(Pn=>[...Pn,{role:"ai",content:fi.content||"Done."}]),Mi.push({role:"model",content:fi.content||"Done."});break}}Le(Mi)}catch(hr){console.error("AI Loop Error:",hr),me(Mn=>[...Mn,{role:"ai",content:"Sorry, I encountered an error."}])}},Dn=async Ie=>{var Xt;const pt=Ie||He;if(!pt.trim()&&!Ye)return;const mt=Ye==null?void 0:Ye.base64,rn=(Xt=Ye==null?void 0:Ye.file)==null?void 0:Xt.type;pe(""),rt(null),me(Zn=>[...Zn,{role:"user",content:pt||(Ye?"[Image Attached]":"")}]),Le(Zn=>[...Zn,{role:"user",content:pt||"Analyze image."}]),Pe(!0),await mn(pt,mt,rn),Pe(!1)},ii=()=>{me([]),Le([]),pe(""),rt(null)};return h?i.jsx("div",{className:"loading-indicator",children:"Loading Inventory..."}):u?i.jsxs("div",{className:"error-indicator",children:["Error: ",u]}):i.jsxs("div",{className:"pharmacy-inventory-page",children:[i.jsxs("div",{className:"inventory-actions-group",children:[i.jsxs("div",{className:"action-group-left",children:[i.jsxs("button",{onClick:()=>e("/dashboard/purchase"),className:"action-btn-clean btn-clean-teal",children:[i.jsx(gc,{className:"button-icon"}),"Add New Drug"]}),i.jsxs("button",{onClick:()=>e("/dashboard/purchase"),className:"action-btn-clean btn-clean-blue",children:[i.jsx(gc,{className:"button-icon"}),"Purchase Page"]}),i.jsxs("button",{onClick:()=>e("/dashboard/distributors"),className:"action-btn-clean btn-clean-violet",children:[i.jsx(gc,{className:"button-icon"}),"Distributors"]})]}),i.jsxs("div",{className:"action-group-right",children:[i.jsx("button",{onClick:P,className:"action-btn-clean btn-clean-slate",children:"Download CSV"}),i.jsxs("button",{onClick:Lt,className:"action-btn-clean btn-clean-emerald",children:[i.jsx(gc,{className:"button-icon"}),"Import Defaults"]}),i.jsxs("button",{onClick:Ve,disabled:U.size===0,className:"action-btn-clean btn-clean-amber",children:[i.jsx(Wi,{className:"button-icon"}),"Delete (",U.size,")"]}),i.jsxs("button",{onClick:Fe,className:"action-btn-clean btn-clean-red",children:[i.jsx(Wi,{className:"button-icon"}),"Delete All"]})]})]}),i.jsxs("div",{className:"search-bar-container",children:[i.jsxs("div",{className:"search-input-wrapper",children:[i.jsx(Pi,{size:18,className:"search-input-icon"}),i.jsx("input",{type:"text",placeholder:"Search drugs...",value:o,onChange:Ie=>l(Ie.target.value),className:"inventory-search-input"})]}),i.jsxs("select",{value:v,onChange:Ie=>S(Ie.target.value),className:"inventory-filter-select",children:[i.jsx("option",{value:"all",children:"All Drugs"}),i.jsx("option",{value:"low-stock",children:"Low Stock"}),i.jsx("option",{value:"near-expiry",children:"Near Expiry"}),i.jsx("option",{value:"expired",children:"Expired"})]})]}),i.jsx("div",{className:"inventory-table-container",ref:Qe,children:i.jsxs("table",{className:"inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"checkbox-header text-center",children:i.jsx("input",{type:"checkbox",onChange:Ie=>{if(Ie.target.checked){const pt=new Set(r.map(mt=>mt.id));V(pt)}else V(new Set)},checked:U.size===r.length&&r.length>0,disabled:r.length===0})}),i.jsx("th",{className:"drug-name-header",children:"Drug Name"}),i.jsx("th",{className:"brand-name-header",children:"Brand"}),i.jsx("th",{className:"pack-header",children:"Pack"}),i.jsx("th",{className:"expiry-header",children:"Expiry"}),i.jsx("th",{className:"qty-header text-right",children:"Stock"}),i.jsx("th",{className:"mrp-header text-right",children:"MRP"}),i.jsx("th",{className:"rate-header text-right",children:"Rate"}),i.jsx("th",{className:"box-number-header",children:"Box"}),i.jsx("th",{className:"discount-header text-right",children:"Disc %"}),i.jsx("th",{className:"margin-header text-right",children:"Margin"}),i.jsx("th",{className:"actions-cell text-center",children:"Actions"}),i.jsx("th",{className:"expand-collapse-header"})]})}),i.jsxs("tbody",{children:[r.length===0&&i.jsx("tr",{className:"no-results-message",children:i.jsx("td",{colSpan:15,children:"No drugs found matching your search."})}),ft.map(Ie=>i.jsxs(i.Fragment,{children:[i.jsxs("tr",{className:"drug-row",onClick:()=>{const pt=new Set(g);pt.has(Ie.id)&&Ie.id!==void 0?pt.delete(Ie.id):Ie.id!==void 0&&pt.add(Ie.id),b(pt)},children:[i.jsx("td",{className:"checkbox-cell",children:i.jsx("input",{type:"checkbox",onClick:pt=>pt.stopPropagation(),checked:U.has(Ie.id),onChange:()=>{const pt=new Set(U);pt.has(Ie.id)?pt.delete(Ie.id):pt.add(Ie.id),V(pt)}})}),i.jsx("td",{className:"drug-name-cell",children:Ie.name||"-"}),i.jsx("td",{className:"brand-name-cell",children:Ie.brand_name||"-"}),i.jsx("td",{className:"pack-cell text-muted",children:Ie.unit||"-"}),i.jsx("td",{className:"expiry-cell text-muted",children:Ie.expiry_date?new Date(Ie.expiry_date).toLocaleDateString():"-"}),i.jsxs("td",{className:`qty-cell text-right ${Ie.quantity_in_stock<=fC?"text-stock low-stock":"text-stock"}`,children:[i.jsx("div",{children:Ie.quantity_in_stock}),i.jsx("div",{className:"loose-quantity",style:{fontSize:"0.75rem",color:"#94a3b8"},children:Ie.loose!==null&&Ie.loose!==void 0?`${Ie.loose} loose`:""})]}),i.jsxs("td",{className:"mrp-cell text-right text-muted",children:["",typeof Ie.price=="number"?Ie.price.toFixed(2):"N/A"]}),i.jsx("td",{className:"rate-cell text-right text-muted",children:Ie.buying_price!==null&&Ie.buying_price!==void 0?`${Ie.buying_price.toFixed(2)}`:"-"}),i.jsx("td",{className:"box-number-cell text-muted",children:Ie.box_number||"-"}),i.jsx("td",{className:"discount-cell text-right text-muted",children:Ie.discount!==null&&Ie.discount!==void 0?`${Ie.discount.toFixed(2)}%`:"-"}),i.jsx("td",{className:"margin-cell text-right text-muted",children:(()=>{const pt=Ie.price||0,mt=Ie.buying_price||0,rn=Ie.discount||0,Xt=Ie.gst||0,Bi=mt*(1-rn/100)*(1+Xt/100),Qi=pt-Bi;return`${(pt>0?Qi/pt*100:0).toFixed(2)}%`})()}),i.jsx("td",{className:"actions-cell text-center",children:i.jsxs("div",{className:"actions-buttons-group",children:[i.jsx("button",{onClick:pt=>{pt.stopPropagation(),e(`/dashboard/inventory/edit/${Ie.id}`)},className:"action-icon-button",title:"Edit Drug",children:i.jsx(eh,{size:16})}),i.jsx("button",{onClick:pt=>{pt.stopPropagation(),ye(Ie)},className:"action-icon-button delete-button",title:"Delete Drug",children:i.jsx(Wi,{size:16})}),i.jsx("button",{onClick:pt=>{pt.stopPropagation(),ie(Ie),q(!0)},className:"action-icon-button adjust-stock-button",title:"Adjust Stock",children:i.jsx(mI,{size:16})}),i.jsx("button",{onClick:pt=>{pt.stopPropagation(),bt(Ie)},className:"action-icon-button convert-to-loose-button",title:"Convert to Loose",disabled:!Ie.unit||nt(Ie.unit)===null,children:i.jsx(rM,{size:16})})]})}),i.jsx("td",{className:"expand-collapse-cell",children:g.has(Ie.id)?i.jsx(r1,{size:16}):i.jsx(sb,{size:16})})]},Ie.id),g.has(Ie.id)&&i.jsx("tr",{className:"collapsible-row",children:i.jsx("td",{colSpan:15,children:i.jsxs("div",{className:"collapsible-content",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Drug Name:"})," ",Ie.name||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Description:"})," ",Ie.description||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Supplier:"})," ",Ie.supplier||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Brand Name:"})," ",Ie.brand_name||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Batch:"})," ",Ie.batch||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"HSN Code:"})," ",Ie.hsn_code||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"MFG:"})," ",Ie.mfg||"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Loose:"})," ",Ie.loose!==null&&Ie.loose!==void 0?Ie.loose:"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Loose Price:"}),(()=>{const pt=nt(Ie.unit);return pt&&pt>0&&typeof Ie.price=="number"?`${(Ie.price/pt).toFixed(2)}`:"N/A"})()]}),i.jsxs("p",{children:[i.jsx("strong",{children:"GST:"})," ",Ie.gst!==null&&Ie.gst!==void 0?`${Ie.gst.toFixed(2)}%`:"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Discount:"})," ",Ie.discount!==null&&Ie.discount!==void 0?`${Ie.discount.toFixed(2)}%`:"-"]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Calculated Margin:"}),(()=>{const pt=Ie.price||0,mt=Ie.buying_price||0,rn=Ie.discount||0,Xt=Ie.gst||0,Bi=mt*(1-rn/100)*(1+Xt/100),Qi=pt-Bi;return`${(pt>0?Qi/pt*100:0).toFixed(2)}%`})()]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Last Updated:"})," ",new Date(Ie.last_updated).toLocaleString()]})]})})})]}))]})]})}),r.length>C&&i.jsxs("div",{className:"pagination-controls",style:{display:"flex",justifyContent:"center",alignItems:"center",marginTop:"20px",gap:"15px"},children:[i.jsx("button",{onClick:()=>Q(T-1),disabled:T===1,className:"pagination-button",style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ddd",background:T===1?"#f5f5f5":"white",cursor:T===1?"not-allowed":"pointer"},children:"Previous"}),i.jsxs("span",{className:"pagination-info",style:{fontWeight:500},children:["Page ",T," of ",fe]}),i.jsx("button",{onClick:()=>Q(T+1),disabled:T===fe,className:"pagination-button",style:{padding:"8px 16px",borderRadius:"4px",border:"1px solid #ddd",background:T===fe?"#f5f5f5":"white",cursor:T===fe?"not-allowed":"pointer"},children:"Next"})]}),i.jsxs("div",{className:`${Tt.chatWidget} ${$e?Tt.open:""}`,children:[!$e&&i.jsxs("button",{className:Tt.chatToggleBtn,onClick:()=>he(!0),children:[i.jsx(cs,{size:24}),i.jsx("span",{className:Tt.chatToggleText,children:"Ask Inventory AI"})]}),$e&&i.jsxs("div",{className:Tt.chatWindow,children:[i.jsxs("div",{className:Tt.chatHeader,children:[i.jsxs("div",{className:Tt.chatHeaderTitle,children:[i.jsx("div",{className:Tt.logoContainer,children:i.jsx(cs,{size:18,color:"white"})}),i.jsx("span",{children:"Inventory Analyst"})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i.jsx("button",{onClick:ii,title:"Refresh chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:Ie=>Ie.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:Ie=>Ie.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(Il,{size:16,color:"#ffffff",strokeWidth:2.5})}),i.jsx("button",{onClick:()=>he(!1),title:"Minimize chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:Ie=>Ie.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:Ie=>Ie.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(xw,{size:16,color:"#ffffff",strokeWidth:2.5})})]})]}),i.jsxs("div",{className:Tt.chatMessages,children:[ge.length===0&&i.jsxs("div",{className:Tt.emptyChatState,children:[i.jsx("div",{className:Tt.emptyIconWrapper,children:i.jsx(cs,{size:32})}),i.jsx("p",{children:"Hello! I can help you manage stock, find expired items, or update prices."}),i.jsxs("div",{className:Tt.suggestionChips,children:[i.jsx("button",{onClick:()=>Dn("Show low stock items"),children:"Show low stock"}),i.jsx("button",{onClick:()=>Dn("Any expired drugs?"),children:"Expired drugs?"}),i.jsx("button",{onClick:()=>Dn("Find Metformin"),children:"Find Metformin"})]})]}),ge.map((Ie,pt)=>i.jsxs("div",{className:`${Tt.messageBubble} ${Ie.role==="user"?Tt.userMessage:Tt.aiMessage}`,children:[Ie.role==="ai"&&i.jsx("div",{className:Tt.aiAvatar,children:i.jsx(cs,{size:14})}),i.jsx("div",{className:Tt.messageContent,children:i.jsx(Bs,{remarkPlugins:[os],children:Ie.content})})]},pt)),ne&&i.jsxs("div",{className:`${Tt.messageBubble} ${Tt.aiMessage}`,children:[i.jsx("div",{className:Tt.aiAvatar,children:i.jsx(cs,{size:14})}),i.jsxs("div",{className:Tt.typingIndicator,children:[i.jsx("span",{}),i.jsx("span",{}),i.jsx("span",{})]})]}),i.jsx("div",{ref:ut})]}),i.jsxs("div",{className:Tt.chatInputArea,children:[i.jsx("input",{type:"file",ref:je,style:{display:"none"},accept:"image/*",onChange:ln}),Ye?i.jsxs("div",{className:Tt.aiImagePreviewBox,children:[i.jsx("img",{src:Ye.preview,alt:"Preview",className:Tt.aiImagePreviewThumbnail}),i.jsx("button",{className:Tt.aiImageRemoveBadge,onClick:()=>rt(null),children:i.jsx(Sn,{size:12})})]}):i.jsx("button",{className:Tt.aiAttachBtn,onClick:()=>{var Ie;return(Ie=je.current)==null?void 0:Ie.click()},title:"Attach Image",children:i.jsx(yw,{size:22,strokeWidth:2.5})}),i.jsx("input",{type:"text",className:Tt.chatInputAreaInput,value:He,onChange:Ie=>pe(Ie.target.value),onKeyDown:Ie=>Ie.key==="Enter"&&Dn(),placeholder:"Ask about inventory or attach an image...",disabled:ne,autoFocus:!0}),i.jsx("button",{className:Tt.sendBtn,onClick:()=>Dn(),disabled:!He.trim()&&!Ye||ne,children:i.jsx(Mb,{size:18})})]})]})]}),L&&B&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:Ne,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Confirm Deletion"}),i.jsxs("p",{className:"modal-description",children:['Are you sure you want to delete "',i.jsx("span",{className:"drug-name",children:B.name||"Unnamed Drug"}),'"? This action cannot be undone.']}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:Ne,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:Me,className:"button-delete",children:"Delete"})]})]})}),I&&ee&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:ue,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Adjust Stock"}),i.jsxs("p",{className:"modal-description",children:["Drug: ",i.jsx("span",{className:"drug-name",children:ee.name||"Unnamed Drug"}),i.jsx("br",{}),"Current Stock: ",ee.quantity_in_stock]}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("form",{onSubmit:Ge,children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"adjustment",className:"form-label",children:"Adjustment Amount"}),i.jsx("input",{type:"number",name:"adjustment",id:"adjustment",required:!0,step:"1",value:ae,onChange:De,placeholder:"e.g., 10 or -5",className:"form-input"}),i.jsx("p",{className:"form-help-text",children:"Enter a positive number to add stock, negative to remove."})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:ue,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"submit",className:"button-submit",children:"Adjust Stock"})]})]})]})}),F&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:ve,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Confirm Deletion of All Drugs"}),i.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",i.jsx("span",{className:"drug-name",children:"ALL"})," drugs from the inventory? This action cannot be undone."]}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:ve,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:wt,className:"button-delete",children:"Delete All"})]})]})}),ke&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:Ke,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Confirm Deletion of Selected Drugs"}),i.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",i.jsx("span",{className:"drug-name",children:U.size})," selected drug(s)? This action cannot be undone."]}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:Ke,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:vt,className:"button-delete",children:"Delete Selected"})]})]})}),K&&re&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:Mt,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Convert Pack to Loose"}),i.jsxs("p",{className:"modal-description",children:["Drug: ",i.jsx("span",{className:"drug-name",children:re.name||"Unnamed Drug"}),i.jsx("br",{}),"Current Packs in Stock: ",re.quantity_in_stock??0,i.jsx("br",{}),"Current Loose Units: ",re.loose??0,i.jsx("br",{}),"Pack Size: ",nt(re.unit)||"N/A"," units per pack"]}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("form",{onSubmit:Nt,children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"packs-to-convert",className:"form-label",children:"Number of Packs to Convert"}),i.jsx("input",{type:"number",name:"packs-to-convert",id:"packs-to-convert",required:!0,min:"1",step:"1",value:te,onChange:tt,placeholder:"e.g., 1",className:"form-input"}),i.jsxs("p",{className:"form-help-text",children:["This will reduce pack quantity by ",te," and add ",te*(nt(re.unit)||0)," to loose quantity."]})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:Mt,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"submit",className:"button-submit",children:"Convert to Loose"})]})]})]})}),M&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:pn,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Confirm Add Default Medications"}),i.jsx("p",{className:"modal-description",children:"Are you sure you want to add default medications to the inventory? This will add a predefined set of common medications."}),u&&i.jsx("div",{className:"modal-error-message",children:u}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:pn,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:Kt,className:"button-submit",children:"Add Defaults"})]})]})})]})},Lte="_container_172jt_1",Fte="_title_172jt_19",$te="_dateRangeContainer_172jt_37",zte="_dateInputLabel_172jt_59",Bte="_dateInput_172jt_59",Ute="_fetchButton_172jt_103",qte="_sectionTitle_172jt_145",Vte="_tableContainer_172jt_163",Hte="_analysisTable_172jt_181",Gte="_textRight_172jt_259",Yte="_textGreen_172jt_267",Wte="_textRed_172jt_277",Qte="_textOrange_172jt_297",Jte="_alertBox_172jt_315",Kte="_alertBoxError_172jt_333",Xte="_alertBoxIcon_172jt_351",Zte="_loadingContainer_172jt_359",ene="_viewSwitcher_172jt_379",tne="_viewButton_172jt_401",nne="_viewButtonActive_172jt_437",ine="_viewButtonInactive_172jt_465",rne="_reasonDistribution_172jt_599",ane="_totalRow_172jt_621",dn={container:Lte,title:Fte,dateRangeContainer:$te,dateInputLabel:zte,dateInput:Bte,fetchButton:Ute,sectionTitle:qte,tableContainer:Vte,analysisTable:Hte,textRight:Gte,textGreen:Yte,textRed:Wte,textOrange:Qte,alertBox:Jte,alertBoxError:Kte,alertBoxIcon:Xte,loadingContainer:Zte,viewSwitcher:ene,viewButton:tne,viewButtonActive:nne,viewButtonInactive:ine,reasonDistribution:rne,totalRow:ane},sne=()=>{const e=Ft(),n=new Date().toISOString().split("T")[0],[t,r]=w.useState(n),[a,o]=w.useState(n),[l,h]=w.useState(null),[d,u]=w.useState(!1),[f,g]=w.useState(null),[b,v]=w.useState("analysis"),S=async()=>{if(u(!0),g(null),h(null),!t||!a){g("Please select both start and end dates."),u(!1);return}if(new Date(t)>new Date(a)){g("Start date cannot be after end date."),u(!1);return}try{const C=x1();if(!C){g("Clinic ID not found. Please log in again."),u(!1);return}const P=await ce(`/api/inventory/comprehensive-analysis?startDate=${t}&endDate=${a}&clinicId=${C}`);if(!P.ok){const q=await P.json();throw new Error(q.message||`HTTP error! status: ${P.status}`)}const I=await P.json();h(I)}catch(C){console.error("Failed to fetch comprehensive inventory analysis data:",C),g(C.message||"Failed to fetch data. Check console for details.")}finally{u(!1)}},T=()=>{S()},E=C=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(C);return i.jsxs("div",{className:dn.container,children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[" ",i.jsx("h2",{className:dn.title,children:"Inventory Analysis & Management"}),i.jsx("button",{onClick:()=>e(-1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 text-sm",children:"Back"})]}),i.jsxs("div",{className:dn.viewSwitcher,children:[i.jsxs("button",{onClick:()=>v("analysis"),className:`${dn.viewButton} ${b==="analysis"?dn.viewButtonActive:dn.viewButtonInactive}`,children:[i.jsx(QC,{size:16})," ","Analysis"]}),i.jsxs("button",{onClick:()=>v("labInventory"),className:`${dn.viewButton} ${b==="labInventory"?dn.viewButtonActive:dn.viewButtonInactive}`,children:[i.jsx(Pb,{size:16}),"Lab Test Inventory"]}),i.jsxs("button",{onClick:()=>e("/dashboard/inventory"),className:`${dn.viewButton} ${b==="pharmacyInventory"?dn.viewButtonActive:dn.viewButtonInactive}`,children:[i.jsx(Io,{size:16}),"Pharmacy Inventory"]})]}),b==="analysis"&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:dn.dateRangeContainer,children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"start-date-inventory",className:dn.dateInputLabel,children:"Start Date:"}),i.jsx("input",{type:"date",id:"start-date-inventory",value:t,onChange:C=>r(C.target.value),className:dn.dateInput})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"end-date-inventory",className:dn.dateInputLabel,children:"End Date:"}),i.jsx("input",{type:"date",id:"end-date-inventory",value:a,onChange:C=>o(C.target.value),className:dn.dateInput})]}),i.jsx("button",{onClick:T,disabled:d,className:dn.fetchButton,children:d?"Loading...":"Fetch Comprehensive Analysis"})]}),f&&i.jsxs("div",{className:`${dn.alertBox} ${dn.alertBoxError}`,role:"alert",children:[i.jsx("div",{className:dn.alertBoxIcon,children:i.jsx(mi,{size:18})}),i.jsxs("div",{children:[" ",i.jsxs("span",{children:["Error: ",f]})]})]}),d&&i.jsxs("div",{className:dn.loadingContainer,children:[" ",i.jsx("p",{children:"Loading data..."})]}),l&&!d&&i.jsxs("div",{className:"space-y-6",children:[" ",i.jsxs("div",{children:[i.jsxs("h3",{className:dn.sectionTitle,children:["Pharmacy Inventory Changes (",l.startDate," to ",l.endDate,")"]}),l.pharmacyAnalysis.length>0?i.jsx("div",{className:dn.tableContainer,children:i.jsxs("table",{className:dn.analysisTable,children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Drug Name"}),i.jsx("th",{children:"Unit"}),i.jsx("th",{className:dn.textRight,children:"Price"}),i.jsx("th",{children:"Qty In (+)"}),i.jsx("th",{className:dn.textRight,children:"Packs Out (-)"}),i.jsx("th",{className:dn.textRight,children:"Loose Qty Out (-)"}),i.jsx("th",{className:dn.textRight,children:"Packs Converted"})]})}),i.jsx("tbody",{children:l.pharmacyAnalysis.map(C=>i.jsxs("tr",{children:[i.jsx("td",{children:C.name}),i.jsx("td",{children:C.unit||"N/A"}),i.jsx("td",{className:dn.textRight,children:E(C.price)}),i.jsxs("td",{className:dn.textGreen,children:[" ",i.jsxs("div",{className:dn.reasonDistribution,children:[Object.entries(C.quantity_in_by_reason).map(([P,I])=>i.jsxs("div",{children:[i.jsxs("span",{children:[P,":"]}),i.jsx("span",{children:I})]},P)),Object.keys(C.quantity_in_by_reason).length>0&&i.jsxs("div",{className:dn.totalRow,children:[i.jsx("span",{children:"Total:"}),i.jsx("span",{children:C.quantity_in})]})]})]}),i.jsxs("td",{className:dn.textRed,children:[" ",i.jsxs("div",{className:dn.reasonDistribution,children:[Object.entries(C.quantity_out_by_reason||{}).map(([P,I])=>i.jsxs("div",{children:[i.jsxs("span",{children:[P,":"]}),i.jsx("span",{children:I})]},P)),Object.keys(C.quantity_out_by_reason||{}).length>0&&i.jsxs("div",{className:dn.totalRow,children:[i.jsx("span",{children:"Total:"}),i.jsx("span",{children:C.quantity_out})]}),(!C.quantity_out_by_reason||Object.keys(C.quantity_out_by_reason).length===0)&&i.jsx("div",{className:dn.textRight,children:C.quantity_out})]})]}),i.jsx("td",{className:`${dn.textRed} ${dn.textRight}`,children:C.loose_quantity_out}),i.jsx("td",{className:`${dn.textOrange} ${dn.textRight}`,children:C.quantity_converted})]},C.drug_id))})]})}):i.jsx("p",{className:"text-gray-500",children:"No pharmacy inventory changes found for the selected period."})]})]})]}),b==="labInventory"&&i.jsxs("div",{className:"mt-4",children:[" ",i.jsx(Kb,{})]}),b==="pharmacyInventory"&&i.jsxs("div",{className:"mt-4",children:[" ",i.jsx(LE,{})]})]})},one=(e,n,t,r="non-black")=>{if(isNaN(e)||isNaN(n)||e<=0||n<=0)return null;let a;return t==="female"?e<=.7?a=141*Math.pow(e/.7,-.329)*Math.pow(.993,n):a=141*Math.pow(e/.7,-1.209)*Math.pow(.993,n):e<=.9?a=141*Math.pow(e/.9,-.411)*Math.pow(.993,n):a=141*Math.pow(e/.9,-1.209)*Math.pow(.993,n),r==="black"&&(a*=1.018),parseFloat(a.toFixed(2))},lne=(e,n,t)=>{if(isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0||t>=400)return null;const r=e-n-t/5;return parseFloat(r.toFixed(2))},cne=(e,n)=>{if(isNaN(e)||isNaN(n)||e<0||n<0)return null;const t=e-n;return parseFloat(t.toFixed(2))},une=(e,n)=>{if(isNaN(e)||isNaN(n)||e<0||n<0)return null;const t=e-n;return parseFloat(t.toFixed(2))},dne=(e,n,t)=>{if(isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0)return null;const r=e-(n+t);return parseFloat(r.toFixed(2))},hne=(e,n,t)=>{if(isNaN(e)||isNaN(n)||isNaN(t)||e<0||n<0||t<0)return null;const r=2*e+n/18+t/2.8;return parseFloat(r.toFixed(2))},pC=e=>["eGFR","LDL Cholesterol","Indirect Bilirubin","Globulin","Anion Gap","Osmolality"].includes(e),mC=()=>{var he,ge,me;const{orderId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState({}),[l,h]=w.useState(!0),[d,u]=w.useState(!1),[f,g]=w.useState(null),[b,v]=w.useState(null),[S,T]=w.useState(null),[E,C]=w.useState({}),[P,I]=w.useState(null),[q,L]=w.useState(!1),[O,B]=w.useState(""),[$,F]=w.useState(!1),[z,U]=w.useState(""),[V,ee]=w.useState(!0),ie=de=>{const Le=document.querySelector(`[data-test-id='${de}']`);Le&&(document.body.classList.add("printing-single-test"),Le.classList.add("printing"),window.print())};w.useEffect(()=>{const de=()=>{document.body.classList.remove("printing-single-test");const Le=document.querySelector(".printing");Le&&Le.classList.remove("printing")};return window.addEventListener("afterprint",de),()=>{window.removeEventListener("afterprint",de)}},[]);const ae=()=>{t&&Kw(t)},J=w.useCallback(async de=>{var Le;try{const He=await ce(`/api/patients/${de}`);if(!He.ok)throw new Error(`Failed to fetch patient details: ${He.status}`);const pe=await He.json();v(pe.age),T(((Le=pe.sex)==null?void 0:Le.toLowerCase())==="female"?"female":"male")}catch(He){console.error("Error fetching patient details:",He),v(null),T(null)}},[]),K=w.useCallback(async()=>{if(e){h(!0),g(null);try{const de=await ce(`/api/lab/${e}`);if(!de.ok){const pe=await de.json().catch(()=>({message:`HTTP error! status: ${de.status}`}));throw new Error(pe.message||`HTTP error! status: ${de.status}`)}const Le=await de.json();r(Le),Le.patient_id&&J(Le.patient_id);const He={};if(Le.tests&&Le.tests.forEach(pe=>{He[pe.id]={},pe.default_parameters&&pe.default_parameters.length>0?pe.default_parameters.forEach(ne=>{He[pe.id][ne.name]=ne.defaultValue}):He[pe.id].report_content=""}),Le.report_content)try{const pe=JSON.parse(Le.report_content);if(typeof pe=="object"&&pe!==null&&!Array.isArray(pe)){const ne={...He};Object.keys(pe).forEach(Pe=>{ne[Pe]?ne[Pe]={...ne[Pe],...pe[Pe]}:ne[Pe]=pe[Pe]}),o(ne)}else console.warn("Legacy or unexpected report content format detected. Initializing with defaults."),o(He)}catch{console.warn("Legacy report content detected (not JSON). Initializing with defaults."),o(He)}else o(He)}catch(de){console.error("Failed to fetch lab order details:",de),g(de instanceof Error?de.message:"An unknown error occurred while fetching order details.")}finally{h(!1)}}},[e,J]),W=async()=>{if(!(!e||!O))try{if(!(await ce(`/api/lab/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({createdAt:new Date(O).toISOString()})})).ok)throw new Error("Failed to update order date");r(Le=>Le?{...Le,createdAt:new Date(O).toISOString()}:null),L(!1)}catch(de){console.error("Error updating date:",de),alert("Failed to update order date")}},re=async()=>{if(!(!e||!z))try{if(!(await ce(`/api/lab/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_date:new Date(z).toISOString()})})).ok)throw new Error("Failed to update report date");r(Le=>Le?{...Le,report_date:new Date(z).toISOString()}:null),F(!1)}catch(de){console.error("Error updating report date:",de),alert("Failed to update report date")}};w.useEffect(()=>{e?K():(g("No Order ID provided in the URL."),h(!1))},[e,K]);const A=(de,Le,He)=>{o(pe=>{var Ge,ye,Ne,Me,Fe,ve,ke,Ee,Ve,Ke,vt,wt,nt,bt,Mt,tt,Nt,Lt,pn;const ne={...pe,[de]:{...pe[de],[Le]:He}},Pe=parseFloat((Ge=ne[de])==null?void 0:Ge.Creatinine),Ye=b,rt=S;if(Le==="Creatinine"&&!isNaN(Pe)&&Ye!==null&&rt!==null){const Kt=one(Pe,Ye,rt);Kt!==null&&((ye=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&ye.default_parameters.find(Dt=>Dt.name==="eGFR"))&&(ne[de].eGFR=Kt)}const ut=parseFloat((Ne=ne[de])==null?void 0:Ne["Total Cholesterol"]),je=parseFloat((Me=ne[de])==null?void 0:Me["HDL Cholesterol"]),Qe=parseFloat((Fe=ne[de])==null?void 0:Fe.Triglycerides);if((Le==="Total Cholesterol"||Le==="HDL Cholesterol"||Le==="Triglycerides")&&!isNaN(ut)&&!isNaN(je)&&!isNaN(Qe)){const Kt=lne(ut,je,Qe);Kt!==null&&((ve=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&ve.default_parameters.find(Dt=>Dt.name==="LDL Cholesterol"))&&(ne[de]["LDL Cholesterol"]=Kt)}const ze=parseFloat((ke=ne[de])==null?void 0:ke["Total Bilirubin"]),dt=parseFloat((Ee=ne[de])==null?void 0:Ee["Direct Bilirubin"]);if((Le==="Total Bilirubin"||Le==="Direct Bilirubin")&&!isNaN(ze)&&!isNaN(dt)){const Kt=cne(ze,dt);Kt!==null&&((Ve=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&Ve.default_parameters.find(Dt=>Dt.name==="Indirect Bilirubin"))&&(ne[de]["Indirect Bilirubin"]=Kt)}const Ze=parseFloat((Ke=ne[de])==null?void 0:Ke["Total Protein"]),ct=parseFloat((vt=ne[de])==null?void 0:vt.Albumin);if((Le==="Total Protein"||Le==="Albumin")&&!isNaN(Ze)&&!isNaN(ct)){const Kt=une(Ze,ct);Kt!==null&&((wt=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&wt.default_parameters.find(Dt=>Dt.name==="Globulin"))&&(ne[de].Globulin=Kt)}const ft=parseFloat((nt=ne[de])==null?void 0:nt.Sodium),fe=parseFloat((bt=ne[de])==null?void 0:bt.Chloride),Q=parseFloat((Mt=ne[de])==null?void 0:Mt.Bicarbonate);if((Le==="Sodium"||Le==="Chloride"||Le==="Bicarbonate")&&!isNaN(ft)&&!isNaN(fe)&&!isNaN(Q)){const Kt=dne(ft,fe,Q);Kt!==null&&((tt=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&tt.default_parameters.find(Dt=>Dt.name==="Anion Gap"))&&(ne[de]["Anion Gap"]=Kt)}const ue=parseFloat((Nt=ne[de])==null?void 0:Nt.Glucose),De=parseFloat((Lt=ne[de])==null?void 0:Lt.BUN);if((Le==="Sodium"||Le==="Glucose"||Le==="BUN")&&!isNaN(ft)&&!isNaN(ue)&&!isNaN(De)){const Kt=hne(ft,ue,De);Kt!==null&&((pn=t==null?void 0:t.tests.find(Dt=>Dt.id===de))!=null&&pn.default_parameters.find(Dt=>Dt.name==="Osmolality"))&&(ne[de].Osmolality=Kt)}return ne})},te=async(de,Le)=>{if(!e){alert("Cannot submit report without an Order ID.");return}if(!a[de]||Object.keys(a[de]).length===0){alert(`Please enter data for ${Le} before saving.`);return}I(de),g(null);try{const pe={...t!=null&&t.report_content?JSON.parse(t.report_content):{}};pe[de]=a[de];const ne=await ce(`/api/lab/${e}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(pe)})});if(!ne.ok){const Pe=await ne.json().catch(()=>({message:`Submission failed: ${ne.status}`}));throw new Error(Pe.message||`Submission failed: ${ne.status}`)}t&&r({...t,report_content:JSON.stringify(pe)}),alert(`Report for ${Le} saved successfully!`)}catch(He){console.error(`Error submitting report for ${Le}:`,He),alert(`Failed to save report for ${Le}: ${He instanceof Error?He.message:"Unknown error"}`)}finally{I(null)}},xe=async()=>{if(Object.keys(a).length===0){alert("Report content cannot be empty.");return}if(!e){alert("Cannot submit report without an Order ID.");return}u(!0),g(null);try{const de=await ce(`/api/lab/${e}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(a)})});if(!de.ok){const Le=await de.json().catch(()=>({message:`Submission failed: ${de.status}`}));throw new Error(Le.message||`Submission failed: ${de.status}`)}alert("Report submitted successfully!"),n(-1)}catch(de){console.error("Error submitting report:",de),g(de instanceof Error?de.message:"An unknown error occurred during submission.")}finally{u(!1)}};if(l)return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card",style:{textAlign:"center",padding:"50px"},children:[" ",i.jsxs("div",{className:"loading-text",children:[i.jsx(Gf,{className:"animate-spin h-8 w-8 inline mr-2"}),"Loading details..."]})]})});if(f&&!t)return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card error-message-container",style:{textAlign:"center",padding:"30px"},children:[i.jsx(mi,{size:48,className:"mb-3",style:{margin:"0 auto"}}),i.jsx("h3",{className:"error-title",style:{borderBottom:"none"},children:"Error Loading Details"}),i.jsx("p",{className:"error-text",children:f}),i.jsxs("button",{onClick:()=>n(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"20px"},children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});if(!t)return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card no-data-message",style:{textAlign:"center",padding:"30px"},children:[i.jsx(qs,{size:48,className:"mb-3",style:{margin:"0 auto"}}),i.jsx("p",{className:"no-data-message",style:{fontSize:"1.1em"},children:`Lab order not found for ID: ${e}.`}),i.jsxs("button",{onClick:()=>n(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"15px"},children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});const M=(he=t==null?void 0:t.Patient)==null?void 0:he.name,Se=(ge=t==null?void 0:t.Patient)==null?void 0:ge.patient_token_number,$e=`Enter Report for Order #${(t==null?void 0:t.lab_token_number)??e}`;return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"none",paddingBottom:0,marginBottom:0},children:[" ",i.jsx("h2",{style:{margin:0,fontSize:"1.5em"},children:$e})," ",i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsxs("button",{onClick:()=>window.print(),className:"lab-inventory-button",disabled:d,"aria-label":"Print report",children:[i.jsx(Ao,{size:16,style:{marginRight:"5px"}}),"Print"]}),i.jsxs("button",{onClick:ae,className:"lab-inventory-button",disabled:d||!((me=t==null?void 0:t.Patient)!=null&&me.phone)||!(t!=null&&t.report_content),"aria-label":"Share report via WhatsApp",style:{backgroundColor:"#25D366",borderColor:"#25D366",color:"white"},children:[i.jsx(t2,{size:16,style:{marginRight:"5px"}}),"WhatsApp"]}),i.jsxs("button",{onClick:()=>n(-1),className:"lab-inventory-button lab-inventory-button-secondary",disabled:d,children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]})]})]}),t&&i.jsxs("div",{className:`lab-inventory-card printable-section patient-info-section ${V?"":"no-print"}`,style:{marginTop:"20px"},children:[i.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[V?i.jsxs("div",{children:[i.jsx(qs,{size:18,className:"no-print",style:{marginRight:"8px",verticalAlign:"middle"}})," Order Summary"]}):i.jsx("div",{}),i.jsx("button",{onClick:()=>ee(!V),className:"lab-action-button no-print",style:{background:"none",border:"none",boxShadow:"none",color:"#666",padding:"4px"},title:V?"Hide Summary":"Show Summary",children:V?i.jsx(KC,{size:18}):i.jsx(sg,{size:18})})]}),V&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"10px",fontSize:"0.95em"},children:[i.jsxs("div",{children:[i.jsx(Mo,{size:15,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle"}}),i.jsx("strong",{children:"Patient:"})," ",M??"N/A"," (Token: ",Se??"N/A",")"]}),i.jsxs("div",{children:[i.jsx(ab,{size:15,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle",display:"inline"}}),i.jsx("strong",{children:"Order Date:"}),q?i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"5px",marginLeft:"5px"},children:[i.jsx("input",{type:"datetime-local",value:O,onChange:de=>B(de.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",height:"auto",margin:0,fontSize:"0.9em"}}),i.jsx("button",{onClick:W,className:"lab-action-button",style:{padding:"2px",color:"green"},children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>L(!1),className:"lab-action-button",style:{padding:"2px",color:"red"},children:i.jsx(Sn,{size:14})})]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"no-print",style:{marginLeft:"5px"},children:Fr(new Date(t.createdAt),"PPpp")}),i.jsx("span",{className:"print-only",style:{marginLeft:"5px"},children:Fr(new Date(t.createdAt),"PP")}),i.jsx("button",{onClick:()=>{B(Fr(new Date(t.createdAt),"yyyy-MM-dd'T'HH:mm")),L(!0)},className:"lab-action-button no-print",style:{padding:"2px",marginLeft:"5px",background:"none",border:"none",boxShadow:"none",color:"#666"},title:"Edit Date",children:i.jsx(og,{size:12})})]})]}),t.report_date&&i.jsxs("div",{children:[i.jsx(ab,{size:15,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle",display:"inline"}}),i.jsx("strong",{children:"Report Date:"}),$?i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"5px",marginLeft:"5px"},children:[i.jsx("input",{type:"datetime-local",value:z,onChange:de=>U(de.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",height:"auto",margin:0,fontSize:"0.9em"}}),i.jsx("button",{onClick:re,className:"lab-action-button",style:{padding:"2px",color:"green"},children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>F(!1),className:"lab-action-button",style:{padding:"2px",color:"red"},children:i.jsx(Sn,{size:14})})]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"no-print",style:{marginLeft:"5px"},children:Fr(new Date(t.report_date),"PPpp")}),i.jsx("span",{className:"print-only",style:{marginLeft:"5px"},children:Fr(new Date(t.report_date),"PP")}),i.jsx("button",{onClick:()=>{U(Fr(new Date(t.report_date),"yyyy-MM-dd'T'HH:mm")),F(!0)},className:"lab-action-button no-print",style:{padding:"2px",marginLeft:"5px",background:"none",border:"none",boxShadow:"none",color:"#666"},title:"Edit Report Date",children:i.jsx(og,{size:12})})]})]}),i.jsxs("div",{style:{gridColumn:"1 / -1"},children:[i.jsx(HI,{size:15,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle"}}),i.jsx("strong",{children:"Tests:"})," ",(t.tests||[]).map(de=>de.name).join(", ")]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Status:"})," ",i.jsx("span",{className:pne(t.status),children:fne(t.status)})]})]})]}),i.jsxs("div",{className:"printable-section",style:{marginTop:"20px"},children:[i.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginBottom:"10px"},children:[i.jsx(ds,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),"Lab Report"]}),t==null?void 0:t.tests.map(de=>{var Le;return i.jsxs("div",{"data-test-id":de.id,className:"lab-inventory-card test-report-container",style:{marginBottom:"15px"},children:[i.jsxs("div",{className:"lab-inventory-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[i.jsx("h4",{style:{fontSize:"1.1em",margin:0},children:de.name}),i.jsx("div",{className:"no-print",style:{display:"flex",gap:"10px"},children:i.jsx("button",{onClick:()=>ie(de.id),className:"lab-inventory-button print-test-button","aria-label":`Print ${de.name}`,children:i.jsx(Ao,{size:16})})})]}),de.default_parameters&&de.default_parameters.length>0?i.jsx(i.Fragment,{children:i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Parameter"}),i.jsx("th",{children:"Value"}),i.jsx("th",{children:"Normal Range"})]})}),i.jsx("tbody",{children:de.default_parameters.map(He=>{var rt,ut,je;const pe=(rt=a[de.id])==null?void 0:rt[He.name],ne=typeof pe=="string"?parseFloat(pe):typeof pe=="number"?pe:NaN,Pe=He.type==="number"&&!isNaN(ne)&&pe!==""&&pe!==null&&pe!==void 0&&(He.lower_limit!=null&&ne<He.lower_limit||He.upper_limit!=null&&ne>He.upper_limit),Ye=He.type==="boolean"&&(pe===!0||pe==="true");return i.jsxs("tr",{children:[i.jsxs("td",{style:{fontWeight:"500"},children:[He.name,He.unit&&i.jsxs("span",{style:{color:"#6b7280",fontSize:"0.9em"},children:[" (",He.unit,")"]})]}),i.jsxs("td",{className:`${Pe?"abnormal-result":""} ${Ye?"reactive-result":""}`,children:[i.jsxs("div",{className:"no-print",children:[He.type==="boolean"?i.jsxs("select",{id:`${de.id}-${He.name}`,value:(pe==null?void 0:pe.toString())??"false",onChange:Qe=>A(de.id,He.name,Qe.target.value==="true"),className:"lab-inventory-input",style:{margin:0,width:"100%"},disabled:d,children:[i.jsx("option",{value:"false",children:"Non-Reactive"}),i.jsx("option",{value:"true",children:"Reactive"})]}):i.jsx("input",{id:`${de.id}-${He.name}`,type:He.type==="number"?"number":"text",value:pe??"",onChange:Qe=>{A(de.id,He.name,Qe.target.value)},onBlur:Qe=>{He.type==="number"&&Qe.target.value===""&&A(de.id,He.name,0)},className:"lab-inventory-input",style:{margin:0,width:"100%"},disabled:d||pC(He.name)&&!((ut=E[de.id])!=null&&ut[He.name]),placeholder:`Enter ${He.name.toLowerCase()}`}),pC(He.name)&&i.jsx("button",{type:"button",onClick:()=>C(Qe=>{var ze;return{...Qe,[de.id]:{...Qe[de.id]||{},[He.name]:!((ze=Qe[de.id])!=null&&ze[He.name])}}}),className:"lab-inventory-button lab-inventory-button-tertiary",style:{fontSize:"0.75em",padding:"3px 8px",marginTop:"5px"},disabled:d,children:(je=E[de.id])!=null&&je[He.name]?"Lock":"Edit"})]}),i.jsx("span",{className:"print-only",children:He.type==="boolean"?pe===!0||pe==="true"?"Reactive":"Non-Reactive":`${pe??""} ${He.unit??""}`})]}),i.jsx("td",{style:{color:"#6b7280",fontSize:"0.9em"},children:He.type==="number"&&(He.lower_limit!==null||He.upper_limit!==null)?i.jsxs(i.Fragment,{children:[He.lower_limit!=null&&`> ${He.lower_limit}`,He.lower_limit!=null&&He.upper_limit!=null&&" - ",He.upper_limit!=null&&`< ${He.upper_limit}`,He.unit&&` ${He.unit}`]}):He.type==="boolean"?"Non-Reactive":"N/A"})]},He.name)})})]})}):i.jsxs("div",{className:"lab-inventory-form-group no-print",children:[i.jsx("label",{htmlFor:`${de.id}-report_content`,children:"Report Content"}),i.jsx("textarea",{id:`${de.id}-report_content`,value:((Le=a[de.id])==null?void 0:Le.report_content)??"",onChange:He=>A(de.id,"report_content",He.target.value),className:"lab-inventory-input",rows:5,placeholder:`Enter report for ${de.name}...`,disabled:d})]}),i.jsx("div",{className:"no-print",style:{marginTop:"15px",textAlign:"right"},children:i.jsx("button",{type:"button",onClick:()=>te(de.id,de.name),disabled:d||P===de.id,className:"lab-inventory-button",style:{fontSize:"0.9em",padding:"8px 16px"},children:P===de.id?i.jsxs(i.Fragment,{children:[i.jsx(Gf,{className:"animate-spin mr-2",size:14})," Saving..."]}):i.jsxs(i.Fragment,{children:[i.jsx(vc,{size:14,style:{marginRight:"5px"}})," Save ",de.name]})})})]},de.id)}),f&&i.jsxs("p",{className:"error-text no-print",style:{marginTop:"10px"},children:[i.jsx(mi,{size:15,className:"inline mr-1"}),f]})]}),i.jsxs("div",{className:"no-print",style:{marginTop:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"},children:[" ",i.jsx("button",{type:"button",onClick:()=>n(-1),disabled:d,className:"lab-inventory-button lab-inventory-button-secondary",children:"Cancel"}),i.jsx("button",{type:"button",onClick:xe,disabled:d||Object.keys(a).length===0,className:"lab-inventory-button",children:d?i.jsxs(i.Fragment,{children:[i.jsx(Gf,{className:"animate-spin mr-2",size:16})," Submitting..."]}):i.jsxs(i.Fragment,{children:[i.jsx(vc,{size:16,style:{marginRight:"5px"}})," Submit All Reports"]})})]})]})})},fne=e=>e?e.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()):"Unknown",pne=e=>{if(!e)return"status-badge";switch(e.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}},mne=()=>{const{orderId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(!1),[f,g]=w.useState(""),[b,v]=w.useState(!1),[S,T]=w.useState(""),[E,C]=w.useState(!0),P=w.useCallback(async B=>{if(!B){h("No Order ID specified in the URL."),o(!1),r(null);return}o(!0),h(null),r(null);try{console.log(`Fetching order details for ID: ${B}`);const $=await ce(`/api/lab/orders/${B}/report`);if(!$.ok){let z;try{z=await $.json()}catch{z={message:`Server returned status ${$.status}`}}throw console.error("Fetch order details error response:",z),new Error(z.message||`Failed to fetch order details: ${$.status}`)}const F=await $.json();if(console.log("Received order data:",F),!F)throw console.error("Invalid order data structure:",F),new Error("Invalid order data received from server.");r(F)}catch($){console.error("Error fetching order details:",$),h($ instanceof Error?$.message:"An unknown error occurred while fetching the order details")}finally{o(!1)}},[ce]);w.useEffect(()=>{P(e)},[e,P]);const I=B=>{const $=document.querySelector(`[data-test-id='${B}']`);$&&(document.body.classList.add("printing-single-test"),$.classList.add("printing"),window.print())};w.useEffect(()=>{const B=()=>{document.body.classList.remove("printing-single-test");const $=document.querySelector(".printing");$&&$.classList.remove("printing")};return window.addEventListener("afterprint",B),()=>{window.removeEventListener("afterprint",B)}},[]);const q=()=>{t&&Kw(t)},L=async()=>{if(!(!e||!f))try{if(!(await ce(`/api/lab/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({createdAt:new Date(f).toISOString()})})).ok)throw new Error("Failed to update order date");r($=>$?{...$,createdAt:new Date(f).toISOString()}:null),u(!1)}catch(B){console.error("Error updating date:",B),alert("Failed to update order date")}},O=async()=>{if(!(!e||!S))try{if(!(await ce(`/api/lab/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_date:new Date(S).toISOString()})})).ok)throw new Error("Failed to update report date");r($=>$?{...$,report_date:new Date(S).toISOString()}:null),v(!1)}catch(B){console.error("Error updating report date:",B),alert("Failed to update report date")}};return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0,paddingBottom:0,borderBottom:"none"},children:[i.jsx("h2",{style:{margin:0,fontSize:"1.5em"},children:"Lab Report Viewer"})," ",i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsxs(Hs,{to:"/lab/search-report",className:"lab-inventory-button","aria-label":"Search for other reports",children:[i.jsx(Pi,{size:16,style:{marginRight:"5px"}}),"Search Reports"]}),i.jsxs("button",{onClick:()=>n(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]}),i.jsxs("button",{onClick:()=>window.print(),className:"lab-inventory-button","aria-label":"Print report",children:[i.jsx(Ao,{size:16,style:{marginRight:"5px"}}),"Print"]}),i.jsxs("button",{onClick:q,className:"lab-inventory-button","aria-label":"Share report via WhatsApp",style:{backgroundColor:"#25D366",borderColor:"#25D366",color:"white"},children:[i.jsx(t2,{size:16,style:{marginRight:"5px"}}),"WhatsApp"]})]})]}),i.jsxs("div",{style:{marginTop:"20px"},children:[i.jsxs("h3",{className:"lab-inventory-header",children:["Report Details (Order ID: ",e||"None Specified",")"]}),a&&i.jsx("div",{className:"loading-text",children:"Loading report..."}),l&&!a&&i.jsxs("div",{className:"error-message-container",style:{textAlign:"center"},children:[i.jsx(mi,{size:48}),i.jsx("h3",{className:"error-title",children:"Error Loading Report"}),i.jsx("p",{children:l}),e&&i.jsx("button",{onClick:()=>P(e),className:"retry-button",children:"Retry"})]}),i.jsxs("div",{className:"printable-section",children:[!a&&!l&&(t==null?void 0:t.Patient)&&i.jsxs("div",{className:`lab-inventory-card ${E?"":"no-print"}`,style:{marginBottom:"20px"},children:[i.jsxs("h3",{className:"lab-inventory-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[E?i.jsxs("div",{children:[i.jsx(Mo,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Patient Information"]}):i.jsx("div",{}),i.jsx("button",{onClick:()=>C(!E),className:"lab-action-button no-print",style:{background:"none",border:"none",boxShadow:"none",color:"#666",padding:"4px"},title:E?"Hide Summary":"Show Summary",children:E?i.jsx(KC,{size:18}):i.jsx(sg,{size:18})})]}),E&&i.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",fontSize:"0.9em"},children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Name:"})," ",t.Patient.name||"N/A"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Age:"})," ",t.Patient.age??"N/A"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Gender:"})," ",t.Patient.gender||"N/A"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Token No:"})," ",t.Patient.patient_token_number||"N/A"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Patient ID:"})," ",t.Patient.id]}),t.Patient.phone&&i.jsxs("div",{children:[i.jsx("strong",{children:"Phone:"})," ",t.Patient.phone]}),i.jsxs("div",{children:[i.jsx(ab,{size:16,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle",display:"inline"}}),i.jsx("strong",{children:"Order Date:"}),d?i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"5px",marginLeft:"5px"},children:[i.jsx("input",{type:"datetime-local",value:f,onChange:B=>g(B.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",height:"auto",margin:0,fontSize:"0.9em"}}),i.jsx("button",{onClick:L,className:"lab-action-button",style:{padding:"2px",color:"green"},children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>u(!1),className:"lab-action-button",style:{padding:"2px",color:"red"},children:i.jsx(Sn,{size:14})})]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"no-print",style:{marginLeft:"5px"},children:Fr(new Date(t.createdAt),"PPpp")}),i.jsx("span",{className:"print-only",style:{marginLeft:"5px"},children:Fr(new Date(t.createdAt),"PP")}),i.jsx("button",{onClick:()=>{g(Fr(new Date(t.createdAt),"yyyy-MM-dd'T'HH:mm")),u(!0)},className:"lab-action-button no-print",style:{padding:"2px",marginLeft:"5px",background:"none",border:"none",boxShadow:"none",color:"#666"},title:"Edit Date",children:i.jsx(og,{size:12})})]})]}),t.report_date&&i.jsxs("div",{children:[i.jsx(ab,{size:16,className:"no-print",style:{marginRight:"5px",verticalAlign:"middle",display:"inline"}}),i.jsx("strong",{children:"Report Date:"}),b?i.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:"5px",marginLeft:"5px"},children:[i.jsx("input",{type:"datetime-local",value:S,onChange:B=>T(B.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",height:"auto",margin:0,fontSize:"0.9em"}}),i.jsx("button",{onClick:O,className:"lab-action-button",style:{padding:"2px",color:"green"},children:i.jsx(Vs,{size:14})}),i.jsx("button",{onClick:()=>v(!1),className:"lab-action-button",style:{padding:"2px",color:"red"},children:i.jsx(Sn,{size:14})})]}):i.jsxs(i.Fragment,{children:[i.jsx("span",{className:"no-print",style:{marginLeft:"5px"},children:Fr(new Date(t.report_date),"PPpp")}),i.jsx("span",{className:"print-only",style:{marginLeft:"5px"},children:Fr(new Date(t.report_date),"PP")}),i.jsx("button",{onClick:()=>{T(Fr(new Date(t.report_date),"yyyy-MM-dd'T'HH:mm")),v(!0)},className:"lab-action-button no-print",style:{padding:"2px",marginLeft:"5px",background:"none",border:"none",boxShadow:"none",color:"#666"},title:"Edit Report Date",children:i.jsx(og,{size:12})})]})]})]})]}),!a&&!l&&(t==null?void 0:t.report_content)&&i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("h3",{className:"lab-inventory-header",children:[i.jsx(ds,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Report Findings"]}),i.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6"},children:(()=>{try{const B=JSON.parse(t.report_content||"{}");return typeof B=="object"&&B!==null&&t.tests?t.tests.map($=>i.jsxs("div",{"data-test-id":$.id,className:"test-report-container",style:{marginBottom:"20px"},children:[i.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h4",{style:{fontSize:"1.1em",margin:0},children:$.name}),i.jsx("button",{onClick:()=>I($.id),className:"lab-inventory-button print-test-button","aria-label":`Print ${$.name}`,children:i.jsx(Ao,{size:16})})]}),B[$.id]?i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Parameter"}),i.jsx("th",{children:"Value"}),i.jsx("th",{children:"Normal Range"})]})}),i.jsx("tbody",{children:Object.entries(B[$.id]).map(([F,z])=>{var J;const U=(J=$.default_parameters)==null?void 0:J.find(K=>K.name===F),V=typeof z=="string"?parseFloat(z):typeof z=="number"?z:NaN,ee=(U==null?void 0:U.type)==="number"&&!isNaN(V)&&(U.lower_limit!=null&&V<U.lower_limit||U.upper_limit!=null&&V>U.upper_limit),ie=(U==null?void 0:U.type)==="boolean"?z===!0||z==="true"?"Reactive":"Non-Reactive":String(z),ae=(U==null?void 0:U.type)==="boolean"&&(z===!0||z==="true");return i.jsxs("tr",{children:[i.jsx("td",{children:F}),i.jsxs("td",{className:`${ee?"abnormal-result":""} ${ae?"reactive-result":""}`,children:[ie," ",U==null?void 0:U.unit]}),i.jsx("td",{children:U&&U.type==="number"&&(U.lower_limit!==null||U.upper_limit!==null)?i.jsxs(i.Fragment,{children:[U.lower_limit!=null&&` > ${U.lower_limit}`,U.lower_limit!=null&&U.upper_limit!=null&&" - ",U.upper_limit!=null&&` < ${U.upper_limit}`,U.unit&&` ${U.unit}`]}):((U==null?void 0:U.type)==="boolean","N/A")})]},F)})})]}):i.jsx("p",{children:"No parameters reported for this test."})]},$.id)):i.jsx(Bs,{remarkPlugins:[os],children:t.report_content})}catch{return i.jsx(Bs,{remarkPlugins:[os],children:t.report_content||"*No findings recorded.*"})}})()})]})]}),!a&&!l&&!(t!=null&&t.report_content)&&!(t!=null&&t.Patient)&&e&&i.jsxs("div",{className:"no-data-message",children:["No report content or patient details found for Order ID: ",e,". The order might be processing, does not exist, or the ID is incorrect."]}),!e&&!a&&!l&&i.jsxs("div",{className:"no-data-message",children:["No order ID specified in the URL.",i.jsx(Hs,{to:"/lab/search-report",className:"lab-inventory-link",style:{display:"block",marginTop:"10px"},children:"Go to Search Page"})]})]})]})})},gne=()=>{const e=Ft(),[n,t]=w.useState(""),[r,a]=w.useState(!1),[o,l]=w.useState([]),[h,d]=w.useState(null),[u,f]=w.useState(n);w.useEffect(()=>{const T=setTimeout(()=>{f(n)},500);return()=>{clearTimeout(T)}},[n]),w.useEffect(()=>{g()},[u]);const g=async()=>{const T=n.trim();if(!T){l([]),d(null);return}a(!0),d(null),l([]),console.log(`Searching for: ${T}`);try{const E=await ce("/api/lab");if(!E.ok){let O;try{O=await E.json()}catch{O={message:`Server returned status ${E.status}`}}throw console.error("Search fetch error response:",O),new Error(O.message||`HTTP error! status: ${E.status}`)}const{orders:C}=await E.json();console.log("Received lab orders for search:",C);const I=C.filter(O=>!!O.report_content).map(O=>{var B,$;return{id:O.id,labTokenNumber:String(O.lab_token_number??"N/A"),patientName:((B=O.Patient)==null?void 0:B.name)||"N/A",patientId:O.patient_id,patientTokenNumber:String((($=O.Patient)==null?void 0:$.patient_token_number)??"N/A"),tests:(O.tests||[]).map(F=>F.name||"Unknown Test"),date:Fr(new Date(O.createdAt),"yyyy-MM-dd"),status:O.status}}),q=n.toLowerCase(),L=I.filter(O=>{var F,z,U,V,ee;const B=String(O.labTokenNumber).toLowerCase(),$=String(O.patientTokenNumber).toLowerCase();return(((F=O.patientName)==null?void 0:F.toLowerCase())||"").includes(q)||B.includes(q)||$.includes(q)||(((U=(z=O.tests)==null?void 0:z.join(" "))==null?void 0:U.toLowerCase())||"").includes(q)||(((V=O.id)==null?void 0:V.toLowerCase())||"").includes(q)||(((ee=O.patientId)==null?void 0:ee.toLowerCase())||"").includes(q)});console.log("Filtered search results:",L),l(L),L.length===0&&T?d(`No matching reports found for "${T}".`):d(null)}catch(E){console.error("Failed to search lab reports:",E),d(E instanceof Error?E.message:"An unknown error occurred during search")}finally{a(!1)}},b=T=>{console.log(`Result clicked, navigating to view report for order ID: ${T}`),e(`/lab/view-report/${T}`)},v=T=>{switch(T){case"pending":return{text:"Sample Pending",color:"text-red-600 bg-red-100"};case"collected":return{text:"Sample Collected",color:"text-yellow-600 bg-yellow-100"};case"processing":return{text:"Processing",color:"text-blue-600 bg-blue-100"};case"completed":return{text:"Completed",color:"text-green-600 bg-green-100"};case"cancelled":return{text:"Cancelled",color:"text-gray-600 bg-gray-100 line-through"};case"reported":return{text:"Reported",color:"text-purple-600 bg-purple-100"};default:return{text:T,color:"text-gray-600 bg-gray-100"}}},S=T=>{switch(T){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}};return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("div",{className:"lab-inventory-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsx("h2",{style:{margin:0},children:"Search Lab Reports"}),i.jsxs("button",{onClick:()=>e(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]})]}),i.jsxs("div",{className:"lab-inventory-form-group",style:{marginTop:"20px",position:"relative"},children:[i.jsx("label",{htmlFor:"report-search",children:"Enter Search Term"}),i.jsxs("div",{style:{display:"flex",alignItems:"center",position:"relative"},children:[i.jsx(Pi,{size:20,style:{position:"absolute",left:"10px",color:"#777"}}),i.jsx("input",{id:"report-search",type:"text",placeholder:"Patient name, ID, token, report ID, test name...",value:n,onChange:T=>t(T.target.value),className:"lab-inventory-input",style:{paddingLeft:"40px",marginBottom:"0"}})]})]}),i.jsxs("div",{style:{marginTop:"20px"},children:[r&&i.jsx("div",{className:"loading-text",children:"Searching..."}),h&&!r&&i.jsxs("div",{className:"error-text",children:[i.jsx(mi,{size:20,className:"inline mr-2"})," ",h]}),o.length>0&&!r&&i.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:o.map(T=>i.jsxs("li",{className:"lab-inventory-card",onClick:()=>b(T.id),style:{marginBottom:"15px",cursor:"pointer",padding:"15px"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:[i.jsx(xI,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),T.patientName," (Token: ",T.patientTokenNumber,")"]}),i.jsx("span",{className:S(T.status),children:v(T.status).text})]}),i.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:[i.jsxs("div",{style:{marginBottom:"5px"},children:[i.jsx(ds,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Order ID: ",T.id]}),i.jsxs("div",{style:{marginBottom:"5px"},children:[i.jsx(OM,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Tests: ",T.tests.join(", ")]}),i.jsxs("div",{children:[i.jsx(rI,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Date: ",T.date]})]})]},T.id))}),!r&&o.length===0&&!h&&n.trim()&&i.jsxs("div",{className:"no-data-message",children:['No results found for "',n,'".']}),!r&&o.length===0&&!h&&!n.trim()&&i.jsx("div",{className:"no-data-message",style:{backgroundColor:"transparent",border:"none",textAlign:"left",padding:"5px 0"},children:"Enter a search term above to find lab reports."})]})]})})},yne=()=>{const{patientId:e}=ia(),n=Ft(),[t,r]=w.useState([]),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(null),[f,g]=w.useState(null);w.useEffect(()=>{(async()=>{if(!e){h("Patient ID is missing from the URL."),o(!1);return}o(!0),h(null),r([]),g(null);try{const S=await ce(`/api/patients/${e}`);if(S.ok){const C=await S.json();g(C.name||`Patient ID: ${e}`)}else console.warn(`Failed to fetch patient name for ID ${e}`),g(`Patient ID: ${e}`);const T=await ce(`/api/lab/patient/${e}`);if(!T.ok){const C=await T.json().catch(()=>({}));throw new Error(C.message||`HTTP error! status: ${T.status}`)}const E=await T.json();r(E||[])}catch(S){console.error("Error fetching data:",S),h(`Failed to load data: ${S.message}`)}finally{o(!1)}})()},[e]);const b=v=>{v.report_content?n(`/lab/view-report/${v.id}`):n(`/lab/enter-report/${v.id}`)};return i.jsx("div",{className:"lab-inventory-container",children:i.jsxs("div",{className:"lab-inventory-card",children:[i.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("h2",{style:{margin:0},children:["Lab Reports ",f?`for ${f}`:`for Patient ID: ${e}`]}),i.jsxs("div",{style:{display:"flex",gap:"10px"},children:[i.jsxs("button",{onClick:async()=>{if(!e){alert("Patient ID is missing. Cannot create a new report.");return}try{const v=await ce("/api/lab/create-empty-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:e})});if(!v.ok){const T=await v.json().catch(()=>({message:`Failed to create new lab order: ${v.status}`}));throw new Error(T.message||`Failed to create new lab order: ${v.status}`)}const S=await v.json();n(`/lab/enter-report/${S.newOrderId}`)}catch(v){console.error("Error creating new lab order:",v),alert(`Error creating new lab order: ${v.message}`)}},className:"lab-inventory-button",disabled:!e,title:e?"Enter a new lab report for this patient":"Patient ID missing",children:[i.jsx(gc,{size:16,style:{marginRight:"5px"}}),"Enter New Report"]}),i.jsxs("button",{onClick:()=>n(-1),className:"lab-inventory-button lab-inventory-button-secondary",children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Back"]})]})]}),i.jsx("div",{style:{marginTop:"20px"},children:a?i.jsxs("div",{className:"loading-text",children:[i.jsx(Gf,{className:"animate-spin h-8 w-8 inline mr-2"}),"Loading reports..."]}):l?i.jsxs("div",{className:"error-text",style:{textAlign:"center",padding:"20px"},children:[i.jsx(i2,{size:40,style:{marginBottom:"10px",color:"#721c24"}}),i.jsx("h3",{style:{fontSize:"1.2em",color:"#721c24",margin:"10px 0"},children:"Error Loading Reports"}),i.jsx("p",{children:l})]}):t.length===0?i.jsxs("div",{className:"no-data-message",style:{textAlign:"center",padding:"30px"},children:[i.jsx(ds,{size:48,className:"mb-3",style:{margin:"0 auto 15px auto",display:"block"}}),i.jsx("p",{children:"No lab reports found for this patient."}),i.jsxs("p",{children:["You can ",i.jsx(Hs,{to:`/lab/create-order/${e}`,className:"lab-inventory-link",children:"create a new lab order"}),"."]})]}):d?i.jsxs("div",{className:"lab-inventory-card",style:{backgroundColor:"#fdfdfd"},children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[i.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.3em",borderBottom:"none",margin:0},children:["Report from: ",d.report_date?Fr(new Date(d.report_date),"PPP p"):"N/A"]}),i.jsxs("button",{onClick:()=>u(null),className:"lab-inventory-button lab-inventory-button-secondary",style:{fontSize:"0.9em",padding:"8px 12px"},children:[i.jsx(fn,{size:16,style:{marginRight:"5px"}})," Back to List"]})]}),i.jsxs("p",{style:{marginBottom:"15px",fontSize:"1em"},children:[i.jsx("strong",{children:"Tests Ordered:"})," ",(d.tests||[]).map(v=>v.name).join(", ")]}),i.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6",border:"1px solid #eee",padding:"15px",borderRadius:"4px",background:"#fff"},children:i.jsx(Bs,{remarkPlugins:[os],children:d.report_content||"*No findings recorded.*"})})]}):i.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:t.map(v=>i.jsxs("li",{className:"lab-inventory-card",onClick:()=>b(v),tabIndex:0,onKeyPress:S=>S.key==="Enter"&&b(v),style:{marginBottom:"15px",cursor:"pointer",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[i.jsx(ds,{size:24,style:{marginRight:"15px",color:"#007bff"}}),i.jsxs("div",{children:[i.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:["Order Date: ",Fr(new Date(v.createdAt),"PPP")]}),i.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:["Tests: ",v.tests&&v.tests.length>0?v.tests.map(S=>S.name).join(", "):"N/A"]})]})]}),i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[v.status&&i.jsx("span",{className:bne(v.status),children:xne(v.status)}),i.jsx(xg,{size:20,style:{color:"#6c757d"}})]})]},v.id))})})]})})},xne=e=>{if(!e)return"Unknown";switch(e.toLowerCase()){case"pending":return"Pending Sample";case"collected":return"Sample Collected";case"processing":return"Processing";case"report_ready":return"Report Ready";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return e.charAt(0).toUpperCase()+e.slice(1)}},bne=e=>{if(!e)return"status-badge";switch(e.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}},FE=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState([]),[o,l]=w.useState(!1),[h,d]=w.useState(null),[u,f]=w.useState(""),[g,b]=w.useState("all"),v=10,S=1;w.useEffect(()=>{(async()=>{l(!0),d(null);try{console.log("Fetching pharmacy inventory for view page...");const C=await ce("/api/drugs");if(!C.ok)throw new Error(`HTTP error! status: ${C.status}`);const P=await C.json();console.log("Fetched Pharmacy Inventory for view page:",P),t(P||[])}catch(C){console.error("Error fetching pharmacy inventory:",C),d("Failed to load pharmacy inventory.")}finally{}})()},[]),w.useEffect(()=>{(async()=>{try{console.log("Fetching lab inventory for view page...");const C=await ce("/api/lab-tests");if(!C.ok)throw new Error(`HTTP error! status: ${C.status}`);const P=await C.json();console.log("Fetched Lab Inventory for view page:",P),a(P||[])}catch(C){console.error("Error fetching lab inventory:",C),d(P=>P?`${P} & Failed to load lab inventory.`:"Failed to load lab inventory.")}finally{l(!1)}})()},[]);const T=w.useMemo(()=>{let E=n;return u&&(E=E.filter(C=>C.name.toLowerCase().includes(u.toLowerCase()))),g!=="all"&&(E=E.filter(C=>{const P=(C.quantity_in_stock??1/0)<=v;let I=!1,q=!1;if(C.expiry_date)try{const L=Sb(C.expiry_date);if(pg(L)){const O=$1(new Date,S),B=new Date;B.setHours(0,0,0,0),q=Zd(L,B),I=!q&&Zd(L,O)}}catch(L){console.error("Error parsing expiry date for filter:",C.expiry_date,L),I=!0}else I=!0;switch(g){case"low-stock":return P;case"near-expiry":return I;case"expired":return q;default:return!0}})),E},[n,u,g]);return i.jsxs("div",{className:"lab-inventory-container",children:[i.jsxs("div",{className:"lab-inventory-header",children:[i.jsx("h1",{children:"Inventory Overview"}),i.jsxs("button",{onClick:()=>e(-1),className:"lab-inventory-button lab-inventory-button-secondary",title:"Go Back",children:[i.jsx(fn,{size:18,style:{marginRight:"5px"}})," Back"]})]}),o&&i.jsx("p",{className:"loading-text",children:"Loading inventory..."}),h&&i.jsx("p",{className:"error-text",children:h}),!o&&!h&&i.jsxs("div",{className:"inventory-sections-container",children:[i.jsxs("div",{className:"lab-inventory-card",children:[" ",i.jsxs("div",{className:"inventory-section__header-bar",children:[i.jsxs("h2",{className:"lab-inventory-header",children:[i.jsx(Io,{size:24,style:{marginRight:"10px",verticalAlign:"middle"}})," Pharmacy Inventory"]}),i.jsxs("div",{className:"inventory-section__controls",children:[" ",i.jsxs("div",{className:"inventory-section__search-area",children:[i.jsx("input",{type:"text",placeholder:"Search drugs...",value:u,onChange:E=>f(E.target.value),className:"lab-inventory-input",style:{marginRight:"5px",marginBottom:"0"}}),i.jsx(Pi,{size:18,style:{color:"#777"}})]}),i.jsxs("div",{className:"inventory-section__filter-area",children:[" ",i.jsxs("select",{value:g,onChange:E=>b(E.target.value),className:"lab-inventory-select",children:[i.jsx("option",{value:"all",children:"All Drugs"}),i.jsx("option",{value:"low-stock",children:"Low Stock"}),i.jsx("option",{value:"near-expiry",children:"Near Expiry"}),i.jsx("option",{value:"expired",children:"Expired"})]})]})]})]}),T.length>0?i.jsxs("div",{className:"table-container",children:[" ",i.jsxs("div",{className:"table-scroll-wrapper",children:[" ",i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Stock"}),i.jsx("th",{children:"Expiry Date"}),i.jsx("th",{children:"Buying Price"}),i.jsx("th",{children:"Selling Price"})]})}),i.jsx("tbody",{children:T.map(E=>{let C="N/A",P="";const I=(E.quantity_in_stock??1/0)<=v;if(E.expiry_date)try{const q=Sb(E.expiry_date);if(pg(q)){C=Fr(q,"dd/MM/yyyy");const L=$1(new Date,1),O=new Date;O.setHours(0,0,0,0),Zd(q,O)?P="highlight-expired":Zd(q,L)&&(P="highlight-near-expiry")}else C="Invalid Date",P="highlight-near-expiry"}catch(q){console.error("Error parsing expiry date:",E.expiry_date,q),C="Error Parsing",P="highlight-near-expiry"}else P="highlight-near-expiry";return i.jsxs("tr",{children:[i.jsx("td",{children:E.name}),i.jsx("td",{children:i.jsx("span",{className:`highlight-box ${I?"highlight-low-stock":""}`,children:E.quantity_in_stock??"N/A"})}),i.jsx("td",{children:i.jsx("span",{className:`highlight-box ${P}`,children:C})}),i.jsx("td",{className:"price-text",children:E.buying_price?`${E.buying_price}`:"N/A"}),i.jsx("td",{className:"price-text",children:E.price?`${E.price}`:"N/A"})]},E.id)})})]})]})]}):i.jsx("p",{className:"no-data-message",children:u?`No drugs found matching "${u}".`:"No pharmacy inventory data available."})]}),i.jsxs("div",{className:"lab-inventory-card",children:[" ",i.jsxs("h2",{className:"lab-inventory-header inventory-section__lab-title",children:[i.jsx(Pb,{size:24,style:{marginRight:"10px",verticalAlign:"middle"}})," Lab Test Inventory"]}),r.length>0?i.jsxs("div",{className:"table-container",children:[" ",i.jsxs("div",{className:"table-scroll-wrapper",children:[" ",i.jsxs("table",{className:"lab-inventory-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Price"})]})}),i.jsx("tbody",{children:r.map(E=>i.jsxs("tr",{children:[i.jsx("td",{children:E.name}),i.jsx("td",{className:"price-text",children:E.price?`${E.price}`:"N/A"})]},E.id))})]})]})]}):i.jsx("p",{className:"no-data-message",children:"No lab test inventory data available."})]})]})]})},vne=()=>{const e=Ft(),[n,t]=w.useState("pharmacy");return i.jsxs("div",{className:"inventory-management-page",children:[i.jsxs("div",{className:"page-header",children:[i.jsxs("div",{className:"inventory-header-left",children:[i.jsx("button",{onClick:()=>e(-1),className:"back-button",title:"Go Back",children:i.jsx(fn,{size:20})}),i.jsx("h1",{children:"Inventory Management"})]}),i.jsx("div",{className:"header-spacer"}),i.jsxs("div",{className:"tab-switcher",children:[i.jsxs("button",{onClick:()=>t("pharmacy"),className:`tab-button ${n==="pharmacy"?"active":""}`,children:[i.jsx(Io,{size:16})," Pharmacy Stock"]}),i.jsxs("button",{onClick:()=>t("lab"),className:`tab-button ${n==="lab"?"active":""}`,children:[i.jsx(Pb,{size:16})," Lab Stock"]})]})]}),i.jsx("div",{className:"inventory-content",children:n==="pharmacy"?i.jsx(LE,{}):i.jsx(Kb,{showHeader:!1})})]})},wne=()=>{var T,E,C,P,I,q,L,O,B,$,F,z,U,V;const{patientId:e,billId:n}=ia(),t=Ft(),[r,a]=w.useState(null),[o,l]=w.useState(!0),[h,d]=w.useState(null),[u,f]=w.useState(""),[g,b]=w.useState("cash"),v=((T=r==null?void 0:r.patient)==null?void 0:T.insurance_type)==="no_cash_insurance";w.useEffect(()=>{b(v?"no_cash_insurance":"cash")},[v]),w.useEffect(()=>{n?(async()=>{l(!0),d(null);try{const ie=await ce(`/api/bills/${n}`);if(!ie.ok)throw new Error(`HTTP error! status: ${ie.status}`);const ae=await ie.json();if(!ae||!ae.bill||!ae.calculated)throw new Error("Incomplete data structure received from backend (missing bill or calculated fields).");if(ae.bill.type!=="admission")throw console.error("Fetched bill is not an admission bill. Bill Type:",ae.bill.type),new Error(`Unexpected bill type received: ${ae.bill.type}. Expected 'admission'.`);console.log("Raw API data received:",JSON.stringify(ae,null,2));const J=Array.isArray(ae.admissionPayments)?ae.admissionPayments:[];console.log("Processed admissionPaymentsData:",J);const K={...ae.bill,amount:ae.bill.amount,AdmissionPayments:J,calculated:ae.calculated,patient:ae.bill.Patient?{id:ae.bill.Patient.id,name:ae.bill.Patient.name,admission_date:ae.bill.Patient.admission_date,discharge_date:ae.bill.Patient.discharge_date}:void 0};console.log("Setting billDetails state to:",JSON.stringify(K,null,2)),a(K)}catch(ie){console.error("Failed to fetch admission bill details:",ie),d(ie instanceof Error?ie.message:"An unknown error occurred")}finally{l(!1)}})():(d("Bill ID is missing."),l(!1))},[n,e]);const S=async ee=>{var ie;if(ee.preventDefault(),!e||!u||isNaN(parseFloat(u))||parseFloat(u)<=0||parseFloat(u)>(((ie=r==null?void 0:r.calculated)==null?void 0:ie.balance)??0)){d("Please enter a valid payment amount within the balance due. Patient ID must be present.");return}d(null);try{const ae=await ce(`/api/patients/${e}/admission-payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_paid:parseFloat(u),payment_mode:g})});if(!ae.ok){const W=await ae.json();throw new Error(W.message||`HTTP error! status: ${ae.status}`)}const K=await(await ce(`/api/bills/${n}`)).json();if(K&&K.bill&&K.calculated&&K.admissionPayments)a({...K.bill,amount:parseFloat(K.bill.amount),AdmissionPayments:K.admissionPayments,calculated:K.calculated,patient:K.bill.Patient?{id:K.bill.Patient.id,name:K.bill.Patient.name,admission_date:K.bill.Patient.admission_date,discharge_date:K.bill.Patient.discharge_date}:void 0});else throw new Error("Invalid data structure received after payment submission.");f("")}catch(ae){console.error("Failed to submit payment:",ae),d(ae instanceof Error?ae.message:"Failed to record payment")}};return o?i.jsx("div",{className:"p-4",children:"Loading admission bill details..."}):h?i.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",h]}):!r||!r.calculated?i.jsx("div",{className:"p-4",children:"No bill details found or data is incomplete."}):i.jsx("div",{className:"admission-page-container",children:i.jsxs("div",{className:"admission-section",children:[" ",i.jsxs("div",{className:"p-4 border-b",children:[" ",i.jsxs("h2",{className:"admission-header",children:["Admission Billing Details (Bill #",r.id,")"]}),i.jsxs("p",{className:"text-sm text-gray-600",children:["Patient: ",((E=r.patient)==null?void 0:E.name)??"N/A"," (ID: ",r.patient_id,")"]})," ",i.jsxs("p",{className:"text-sm text-gray-600",children:["Admission Date: ",(C=r.patient)!=null&&C.admission_date?new Date(r.patient.admission_date).toLocaleDateString():"N/A"]}),((P=r.patient)==null?void 0:P.discharge_date)&&i.jsxs("p",{className:"text-sm text-gray-600",children:["Discharge Date: ",new Date(r.patient.discharge_date).toLocaleDateString()]}),i.jsxs("p",{className:"text-sm",children:["Status: ",i.jsx("span",{className:`font-semibold ${r.status==="paid"?"text-green-600":"text-orange-600"}`,children:((I=r.status)==null?void 0:I.toUpperCase())??"UNKNOWN"})]})]}),i.jsxs("div",{className:"p-4",children:[" ",i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[i.jsxs("div",{className:"admission-card",children:[i.jsx("h3",{className:"admission-card-title",children:"Billing Summary"}),i.jsxs("div",{className:"admission-card-content",children:[i.jsxs("p",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Initial Charges:"})," ",i.jsxs("span",{children:["",(parseFloat((r==null?void 0:r.amount)||"0")||0).toFixed(2)]})]}),i.jsxs("p",{className:"flex justify-between text-sm",children:[i.jsx("span",{children:"Days Stayed:"})," ",i.jsx("span",{children:((q=r==null?void 0:r.calculated)==null?void 0:q.daysStayed)??0})]}),i.jsxs("p",{className:"flex justify-between text-sm font-semibold mt-2 pt-2 border-t",children:[i.jsx("span",{children:"Total Due:"})," ",i.jsxs("span",{children:["",(Number((L=r==null?void 0:r.calculated)==null?void 0:L.totalDue)||0).toFixed(2)]})]}),i.jsxs("p",{className:"flex justify-between text-sm text-green-700",children:[i.jsx("span",{children:"Total Paid:"})," ",i.jsxs("span",{children:["",(Number((O=r==null?void 0:r.calculated)==null?void 0:O.totalPaid)||0).toFixed(2)]})]}),i.jsxs("p",{className:"flex justify-between text-lg font-bold mt-1 text-red-600",children:[i.jsx("span",{children:"Balance Due:"})," ",i.jsxs("span",{children:["",(Number((B=r==null?void 0:r.calculated)==null?void 0:B.balance)||0).toFixed(2)]})]})]})]}),(r==null?void 0:r.status)!=="paid"&&(Number(($=r==null?void 0:r.calculated)==null?void 0:$.balance)||0)>0&&i.jsxs("div",{className:"admission-card",children:[i.jsx("h3",{className:"admission-card-title text-blue-800",children:"Record New Payment"}),i.jsxs("form",{onSubmit:S,className:"space-y-4",children:[i.jsxs("div",{className:"admission-form-group",children:[i.jsx("label",{htmlFor:"paymentAmount",className:"admission-label",children:"Amount Paid ()"}),i.jsx("input",{id:"paymentAmount",type:"number",value:u,onChange:ee=>f(ee.target.value),onBlur:ee=>{ee.target.value===""&&f("0")},placeholder:`Max ${(Number((F=r==null?void 0:r.calculated)==null?void 0:F.balance)||0).toFixed(2)}`,required:!0,min:"0.01",step:"0.01",max:Number((z=r==null?void 0:r.calculated)==null?void 0:z.balance)||0,className:"admission-input"})]}),i.jsxs("div",{className:"admission-form-group",children:[i.jsx("label",{htmlFor:"paymentMode",className:"admission-label",children:"Payment Mode"}),i.jsxs("select",{id:"paymentMode",value:g,onChange:ee=>b(ee.target.value),className:"admission-select",children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"card",children:"Card"}),i.jsx("option",{value:"upi",children:"UPI"}),v&&i.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})]}),i.jsx("button",{type:"submit",className:"admission-button",disabled:o||!u||parseFloat(u)<=0||parseFloat(u)>(Number((U=r==null?void 0:r.calculated)==null?void 0:U.balance)||0)||v&&g!=="no_cash_insurance",children:"Record Payment"})]})]})]}),i.jsx("h3",{className:"admission-section-title mt-6 border-t pt-4",children:"Admission Payment History"}),Array.isArray(r==null?void 0:r.AdmissionPayments)&&r.AdmissionPayments.length>0?i.jsxs("div",{className:"overflow-x-auto",children:[" ",i.jsxs("table",{className:"admission-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Payment ID"}),i.jsx("th",{children:"Date"}),i.jsx("th",{children:"Amount Paid"}),i.jsx("th",{children:"Mode"})]})}),i.jsx("tbody",{children:(V=r==null?void 0:r.AdmissionPayments)==null?void 0:V.map(ee=>{if(!ee||typeof ee!="object")return null;let ie="Invalid Date";try{ee.payment_date&&!isNaN(new Date(ee.payment_date).getTime())&&(ie=new Date(ee.payment_date).toLocaleString())}catch(ae){console.error("Error formatting payment date:",ee.payment_date,ae)}return i.jsxs("tr",{children:[" ",i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ee.id??"N/A"}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ie}),i.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["",(Number(ee.amount_paid)||0).toFixed(2)]}),i.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:ee.payment_mode??"N/A"})]},ee.id??Math.random())})})]})]}):i.jsx("p",{className:"text-gray-500 text-sm",children:"No payments recorded yet."})]}),i.jsxs("div",{className:"p-4 border-t bg-gray-50 text-right",children:[" ",i.jsx("button",{type:"button",onClick:()=>t(-1),className:"admission-button admission-button-secondary",children:"Back"})]})]})})};var Nne=Object.defineProperty,kb=Object.getOwnPropertySymbols,$E=Object.prototype.hasOwnProperty,zE=Object.prototype.propertyIsEnumerable,gC=(e,n,t)=>n in e?Nne(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,ew=(e,n)=>{for(var t in n||(n={}))$E.call(n,t)&&gC(e,t,n[t]);if(kb)for(var t of kb(n))zE.call(n,t)&&gC(e,t,n[t]);return e},tw=(e,n)=>{var t={};for(var r in e)$E.call(e,r)&&n.indexOf(r)<0&&(t[r]=e[r]);if(e!=null&&kb)for(var r of kb(e))n.indexOf(r)<0&&zE.call(e,r)&&(t[r]=e[r]);return t};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var rh;(e=>{const n=class En{constructor(d,u,f,g){if(this.version=d,this.errorCorrectionLevel=u,this.modules=[],this.isFunction=[],d<En.MIN_VERSION||d>En.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=d*4+17;let b=[];for(let S=0;S<this.size;S++)b.push(!1);for(let S=0;S<this.size;S++)this.modules.push(b.slice()),this.isFunction.push(b.slice());this.drawFunctionPatterns();const v=this.addEccAndInterleave(f);if(this.drawCodewords(v),g==-1){let S=1e9;for(let T=0;T<8;T++){this.applyMask(T),this.drawFormatBits(T);const E=this.getPenaltyScore();E<S&&(g=T,S=E),this.applyMask(T)}}a(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(d,u){const f=e.QrSegment.makeSegments(d);return En.encodeSegments(f,u)}static encodeBinary(d,u){const f=e.QrSegment.makeBytes(d);return En.encodeSegments([f],u)}static encodeSegments(d,u,f=1,g=40,b=-1,v=!0){if(!(En.MIN_VERSION<=f&&f<=g&&g<=En.MAX_VERSION)||b<-1||b>7)throw new RangeError("Invalid value");let S,T;for(S=f;;S++){const I=En.getNumDataCodewords(S,u)*8,q=l.getTotalBits(d,S);if(q<=I){T=q;break}if(S>=g)throw new RangeError("Data too long")}for(const I of[En.Ecc.MEDIUM,En.Ecc.QUARTILE,En.Ecc.HIGH])v&&T<=En.getNumDataCodewords(S,I)*8&&(u=I);let E=[];for(const I of d){t(I.mode.modeBits,4,E),t(I.numChars,I.mode.numCharCountBits(S),E);for(const q of I.getData())E.push(q)}a(E.length==T);const C=En.getNumDataCodewords(S,u)*8;a(E.length<=C),t(0,Math.min(4,C-E.length),E),t(0,(8-E.length%8)%8,E),a(E.length%8==0);for(let I=236;E.length<C;I^=253)t(I,8,E);let P=[];for(;P.length*8<E.length;)P.push(0);return E.forEach((I,q)=>P[q>>>3]|=I<<7-(q&7)),new En(S,u,P,b)}getModule(d,u){return 0<=d&&d<this.size&&0<=u&&u<this.size&&this.modules[u][d]}getModules(){return this.modules}drawFunctionPatterns(){for(let f=0;f<this.size;f++)this.setFunctionModule(6,f,f%2==0),this.setFunctionModule(f,6,f%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const d=this.getAlignmentPatternPositions(),u=d.length;for(let f=0;f<u;f++)for(let g=0;g<u;g++)f==0&&g==0||f==0&&g==u-1||f==u-1&&g==0||this.drawAlignmentPattern(d[f],d[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(d){const u=this.errorCorrectionLevel.formatBits<<3|d;let f=u;for(let b=0;b<10;b++)f=f<<1^(f>>>9)*1335;const g=(u<<10|f)^21522;a(g>>>15==0);for(let b=0;b<=5;b++)this.setFunctionModule(8,b,r(g,b));this.setFunctionModule(8,7,r(g,6)),this.setFunctionModule(8,8,r(g,7)),this.setFunctionModule(7,8,r(g,8));for(let b=9;b<15;b++)this.setFunctionModule(14-b,8,r(g,b));for(let b=0;b<8;b++)this.setFunctionModule(this.size-1-b,8,r(g,b));for(let b=8;b<15;b++)this.setFunctionModule(8,this.size-15+b,r(g,b));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let d=this.version;for(let f=0;f<12;f++)d=d<<1^(d>>>11)*7973;const u=this.version<<12|d;a(u>>>18==0);for(let f=0;f<18;f++){const g=r(u,f),b=this.size-11+f%3,v=Math.floor(f/3);this.setFunctionModule(b,v,g),this.setFunctionModule(v,b,g)}}drawFinderPattern(d,u){for(let f=-4;f<=4;f++)for(let g=-4;g<=4;g++){const b=Math.max(Math.abs(g),Math.abs(f)),v=d+g,S=u+f;0<=v&&v<this.size&&0<=S&&S<this.size&&this.setFunctionModule(v,S,b!=2&&b!=4)}}drawAlignmentPattern(d,u){for(let f=-2;f<=2;f++)for(let g=-2;g<=2;g++)this.setFunctionModule(d+g,u+f,Math.max(Math.abs(g),Math.abs(f))!=1)}setFunctionModule(d,u,f){this.modules[u][d]=f,this.isFunction[u][d]=!0}addEccAndInterleave(d){const u=this.version,f=this.errorCorrectionLevel;if(d.length!=En.getNumDataCodewords(u,f))throw new RangeError("Invalid argument");const g=En.NUM_ERROR_CORRECTION_BLOCKS[f.ordinal][u],b=En.ECC_CODEWORDS_PER_BLOCK[f.ordinal][u],v=Math.floor(En.getNumRawDataModules(u)/8),S=g-v%g,T=Math.floor(v/g);let E=[];const C=En.reedSolomonComputeDivisor(b);for(let I=0,q=0;I<g;I++){let L=d.slice(q,q+T-b+(I<S?0:1));q+=L.length;const O=En.reedSolomonComputeRemainder(L,C);I<S&&L.push(0),E.push(L.concat(O))}let P=[];for(let I=0;I<E[0].length;I++)E.forEach((q,L)=>{(I!=T-b||L>=S)&&P.push(q[I])});return a(P.length==v),P}drawCodewords(d){if(d.length!=Math.floor(En.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let u=0;for(let f=this.size-1;f>=1;f-=2){f==6&&(f=5);for(let g=0;g<this.size;g++)for(let b=0;b<2;b++){const v=f-b,T=(f+1&2)==0?this.size-1-g:g;!this.isFunction[T][v]&&u<d.length*8&&(this.modules[T][v]=r(d[u>>>3],7-(u&7)),u++)}}a(u==d.length*8)}applyMask(d){if(d<0||d>7)throw new RangeError("Mask value out of range");for(let u=0;u<this.size;u++)for(let f=0;f<this.size;f++){let g;switch(d){case 0:g=(f+u)%2==0;break;case 1:g=u%2==0;break;case 2:g=f%3==0;break;case 3:g=(f+u)%3==0;break;case 4:g=(Math.floor(f/3)+Math.floor(u/2))%2==0;break;case 5:g=f*u%2+f*u%3==0;break;case 6:g=(f*u%2+f*u%3)%2==0;break;case 7:g=((f+u)%2+f*u%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[u][f]&&g&&(this.modules[u][f]=!this.modules[u][f])}}getPenaltyScore(){let d=0;for(let b=0;b<this.size;b++){let v=!1,S=0,T=[0,0,0,0,0,0,0];for(let E=0;E<this.size;E++)this.modules[b][E]==v?(S++,S==5?d+=En.PENALTY_N1:S>5&&d++):(this.finderPenaltyAddHistory(S,T),v||(d+=this.finderPenaltyCountPatterns(T)*En.PENALTY_N3),v=this.modules[b][E],S=1);d+=this.finderPenaltyTerminateAndCount(v,S,T)*En.PENALTY_N3}for(let b=0;b<this.size;b++){let v=!1,S=0,T=[0,0,0,0,0,0,0];for(let E=0;E<this.size;E++)this.modules[E][b]==v?(S++,S==5?d+=En.PENALTY_N1:S>5&&d++):(this.finderPenaltyAddHistory(S,T),v||(d+=this.finderPenaltyCountPatterns(T)*En.PENALTY_N3),v=this.modules[E][b],S=1);d+=this.finderPenaltyTerminateAndCount(v,S,T)*En.PENALTY_N3}for(let b=0;b<this.size-1;b++)for(let v=0;v<this.size-1;v++){const S=this.modules[b][v];S==this.modules[b][v+1]&&S==this.modules[b+1][v]&&S==this.modules[b+1][v+1]&&(d+=En.PENALTY_N2)}let u=0;for(const b of this.modules)u=b.reduce((v,S)=>v+(S?1:0),u);const f=this.size*this.size,g=Math.ceil(Math.abs(u*20-f*10)/f)-1;return a(0<=g&&g<=9),d+=g*En.PENALTY_N4,a(0<=d&&d<=2568888),d}getAlignmentPatternPositions(){if(this.version==1)return[];{const d=Math.floor(this.version/7)+2,u=this.version==32?26:Math.ceil((this.version*4+4)/(d*2-2))*2;let f=[6];for(let g=this.size-7;f.length<d;g-=u)f.splice(1,0,g);return f}}static getNumRawDataModules(d){if(d<En.MIN_VERSION||d>En.MAX_VERSION)throw new RangeError("Version number out of range");let u=(16*d+128)*d+64;if(d>=2){const f=Math.floor(d/7)+2;u-=(25*f-10)*f-55,d>=7&&(u-=36)}return a(208<=u&&u<=29648),u}static getNumDataCodewords(d,u){return Math.floor(En.getNumRawDataModules(d)/8)-En.ECC_CODEWORDS_PER_BLOCK[u.ordinal][d]*En.NUM_ERROR_CORRECTION_BLOCKS[u.ordinal][d]}static reedSolomonComputeDivisor(d){if(d<1||d>255)throw new RangeError("Degree out of range");let u=[];for(let g=0;g<d-1;g++)u.push(0);u.push(1);let f=1;for(let g=0;g<d;g++){for(let b=0;b<u.length;b++)u[b]=En.reedSolomonMultiply(u[b],f),b+1<u.length&&(u[b]^=u[b+1]);f=En.reedSolomonMultiply(f,2)}return u}static reedSolomonComputeRemainder(d,u){let f=u.map(g=>0);for(const g of d){const b=g^f.shift();f.push(0),u.forEach((v,S)=>f[S]^=En.reedSolomonMultiply(v,b))}return f}static reedSolomonMultiply(d,u){if(d>>>8||u>>>8)throw new RangeError("Byte out of range");let f=0;for(let g=7;g>=0;g--)f=f<<1^(f>>>7)*285,f^=(u>>>g&1)*d;return a(f>>>8==0),f}finderPenaltyCountPatterns(d){const u=d[1];a(u<=this.size*3);const f=u>0&&d[2]==u&&d[3]==u*3&&d[4]==u&&d[5]==u;return(f&&d[0]>=u*4&&d[6]>=u?1:0)+(f&&d[6]>=u*4&&d[0]>=u?1:0)}finderPenaltyTerminateAndCount(d,u,f){return d&&(this.finderPenaltyAddHistory(u,f),u=0),u+=this.size,this.finderPenaltyAddHistory(u,f),this.finderPenaltyCountPatterns(f)}finderPenaltyAddHistory(d,u){u[0]==0&&(d+=this.size),u.pop(),u.unshift(d)}};n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=n;function t(h,d,u){if(d<0||d>31||h>>>d)throw new RangeError("Value out of range");for(let f=d-1;f>=0;f--)u.push(h>>>f&1)}function r(h,d){return(h>>>d&1)!=0}function a(h){if(!h)throw new Error("Assertion error")}const o=class $i{constructor(d,u,f){if(this.mode=d,this.numChars=u,this.bitData=f,u<0)throw new RangeError("Invalid argument");this.bitData=f.slice()}static makeBytes(d){let u=[];for(const f of d)t(f,8,u);return new $i($i.Mode.BYTE,d.length,u)}static makeNumeric(d){if(!$i.isNumeric(d))throw new RangeError("String contains non-numeric characters");let u=[];for(let f=0;f<d.length;){const g=Math.min(d.length-f,3);t(parseInt(d.substring(f,f+g),10),g*3+1,u),f+=g}return new $i($i.Mode.NUMERIC,d.length,u)}static makeAlphanumeric(d){if(!$i.isAlphanumeric(d))throw new RangeError("String contains unencodable characters in alphanumeric mode");let u=[],f;for(f=0;f+2<=d.length;f+=2){let g=$i.ALPHANUMERIC_CHARSET.indexOf(d.charAt(f))*45;g+=$i.ALPHANUMERIC_CHARSET.indexOf(d.charAt(f+1)),t(g,11,u)}return f<d.length&&t($i.ALPHANUMERIC_CHARSET.indexOf(d.charAt(f)),6,u),new $i($i.Mode.ALPHANUMERIC,d.length,u)}static makeSegments(d){return d==""?[]:$i.isNumeric(d)?[$i.makeNumeric(d)]:$i.isAlphanumeric(d)?[$i.makeAlphanumeric(d)]:[$i.makeBytes($i.toUtf8ByteArray(d))]}static makeEci(d){let u=[];if(d<0)throw new RangeError("ECI assignment value out of range");if(d<128)t(d,8,u);else if(d<16384)t(2,2,u),t(d,14,u);else if(d<1e6)t(6,3,u),t(d,21,u);else throw new RangeError("ECI assignment value out of range");return new $i($i.Mode.ECI,0,u)}static isNumeric(d){return $i.NUMERIC_REGEX.test(d)}static isAlphanumeric(d){return $i.ALPHANUMERIC_REGEX.test(d)}getData(){return this.bitData.slice()}static getTotalBits(d,u){let f=0;for(const g of d){const b=g.mode.numCharCountBits(u);if(g.numChars>=1<<b)return 1/0;f+=4+b+g.bitData.length}return f}static toUtf8ByteArray(d){d=encodeURI(d);let u=[];for(let f=0;f<d.length;f++)d.charAt(f)!="%"?u.push(d.charCodeAt(f)):(u.push(parseInt(d.substring(f+1,f+3),16)),f+=2);return u}};o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let l=o;e.QrSegment=o})(rh||(rh={}));(e=>{(n=>{const t=class{constructor(a,o){this.ordinal=a,this.formatBits=o}};t.LOW=new t(0,1),t.MEDIUM=new t(1,0),t.QUARTILE=new t(2,3),t.HIGH=new t(3,2),n.Ecc=t})(e.QrCode||(e.QrCode={}))})(rh||(rh={}));(e=>{(n=>{const t=class{constructor(a,o){this.modeBits=a,this.numBitsCharCount=o}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}};t.NUMERIC=new t(1,[10,12,14]),t.ALPHANUMERIC=new t(2,[9,11,13]),t.BYTE=new t(4,[8,16,16]),t.KANJI=new t(8,[8,10,12]),t.ECI=new t(7,[0,0,0]),n.Mode=t})(e.QrSegment||(e.QrSegment={}))})(rh||(rh={}));var Vf=rh;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Sne={L:Vf.QrCode.Ecc.LOW,M:Vf.QrCode.Ecc.MEDIUM,Q:Vf.QrCode.Ecc.QUARTILE,H:Vf.QrCode.Ecc.HIGH},BE=128,UE="L",qE="#FFFFFF",VE="#000000",HE=!1,GE=1,jne=4,_ne=0,Cne=.1;function YE(e,n=0){const t=[];return e.forEach(function(r,a){let o=null;r.forEach(function(l,h){if(!l&&o!==null){t.push(`M${o+n} ${a+n}h${h-o}v1H${o+n}z`),o=null;return}if(h===r.length-1){if(!l)return;o===null?t.push(`M${h+n},${a+n} h1v1H${h+n}z`):t.push(`M${o+n},${a+n} h${h+1-o}v1H${o+n}z`);return}l&&o===null&&(o=h)})}),t.join("")}function WE(e,n){return e.slice().map((t,r)=>r<n.y||r>=n.y+n.h?t:t.map((a,o)=>o<n.x||o>=n.x+n.w?a:!1))}function kne(e,n,t,r){if(r==null)return null;const a=e.length+t*2,o=Math.floor(n*Cne),l=a/n,h=(r.width||o)*l,d=(r.height||o)*l,u=r.x==null?e.length/2-h/2:r.x*l,f=r.y==null?e.length/2-d/2:r.y*l,g=r.opacity==null?1:r.opacity;let b=null;if(r.excavate){let S=Math.floor(u),T=Math.floor(f),E=Math.ceil(h+u-S),C=Math.ceil(d+f-T);b={x:S,y:T,w:E,h:C}}const v=r.crossOrigin;return{x:u,y:f,h:d,w:h,excavation:b,opacity:g,crossOrigin:v}}function Tne(e,n){return n!=null?Math.max(Math.floor(n),0):e?jne:_ne}function QE({value:e,level:n,minVersion:t,includeMargin:r,marginSize:a,imageSettings:o,size:l,boostLevel:h}){let d=Fn.useMemo(()=>{const S=(Array.isArray(e)?e:[e]).reduce((T,E)=>(T.push(...Vf.QrSegment.makeSegments(E)),T),[]);return Vf.QrCode.encodeSegments(S,Sne[n],t,void 0,void 0,h)},[e,n,t,h]);const{cells:u,margin:f,numCells:g,calculatedImageSettings:b}=Fn.useMemo(()=>{let v=d.getModules();const S=Tne(r,a),T=v.length+S*2,E=kne(v,l,S,o);return{cells:v,margin:S,numCells:T,calculatedImageSettings:E}},[d,l,o,r,a]);return{qrcode:d,margin:f,cells:u,numCells:g,calculatedImageSettings:b}}var Ene=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),ap=Fn.forwardRef(function(n,t){const r=n,{value:a,size:o=BE,level:l=UE,bgColor:h=qE,fgColor:d=VE,includeMargin:u=HE,minVersion:f=GE,boostLevel:g,marginSize:b,imageSettings:v}=r,T=tw(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:E}=T,C=tw(T,["style"]),P=v==null?void 0:v.src,I=Fn.useRef(null),q=Fn.useRef(null),L=Fn.useCallback(ie=>{I.current=ie,typeof t=="function"?t(ie):t&&(t.current=ie)},[t]),[O,B]=Fn.useState(!1),{margin:$,cells:F,numCells:z,calculatedImageSettings:U}=QE({value:a,level:l,minVersion:f,boostLevel:g,includeMargin:u,marginSize:b,imageSettings:v,size:o});Fn.useEffect(()=>{if(I.current!=null){const ie=I.current,ae=ie.getContext("2d");if(!ae)return;let J=F;const K=q.current,W=U!=null&&K!==null&&K.complete&&K.naturalHeight!==0&&K.naturalWidth!==0;W&&U.excavation!=null&&(J=WE(F,U.excavation));const re=window.devicePixelRatio||1;ie.height=ie.width=o*re;const A=o/z*re;ae.scale(A,A),ae.fillStyle=h,ae.fillRect(0,0,z,z),ae.fillStyle=d,Ene?ae.fill(new Path2D(YE(J,$))):F.forEach(function(te,xe){te.forEach(function(M,Se){M&&ae.fillRect(Se+$,xe+$,1,1)})}),U&&(ae.globalAlpha=U.opacity),W&&ae.drawImage(K,U.x+$,U.y+$,U.w,U.h)}}),Fn.useEffect(()=>{B(!1)},[P]);const V=ew({height:o,width:o},E);let ee=null;return P!=null&&(ee=Fn.createElement("img",{src:P,key:P,style:{display:"none"},onLoad:()=>{B(!0)},ref:q,crossOrigin:U==null?void 0:U.crossOrigin})),Fn.createElement(Fn.Fragment,null,Fn.createElement("canvas",ew({style:V,height:o,width:o,ref:L,role:"img"},C)),ee)});ap.displayName="QRCodeCanvas";var Ane=Fn.forwardRef(function(n,t){const r=n,{value:a,size:o=BE,level:l=UE,bgColor:h=qE,fgColor:d=VE,includeMargin:u=HE,minVersion:f=GE,boostLevel:g,title:b,marginSize:v,imageSettings:S}=r,T=tw(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:E,cells:C,numCells:P,calculatedImageSettings:I}=QE({value:a,level:l,minVersion:f,boostLevel:g,includeMargin:u,marginSize:v,imageSettings:S,size:o});let q=C,L=null;S!=null&&I!=null&&(I.excavation!=null&&(q=WE(C,I.excavation)),L=Fn.createElement("image",{href:S.src,height:I.h,width:I.w,x:I.x+E,y:I.y+E,preserveAspectRatio:"none",opacity:I.opacity,crossOrigin:I.crossOrigin}));const O=YE(q,E);return Fn.createElement("svg",ew({height:o,width:o,viewBox:`0 0 ${P} ${P}`,ref:t,role:"img"},T),!!b&&Fn.createElement("title",null,b),Fn.createElement("path",{fill:h,d:`M0,0 h${P}v${P}H0z`,shapeRendering:"crispEdges"}),Fn.createElement("path",{fill:d,d:O,shapeRendering:"crispEdges"}),L)});Ane.displayName="QRCodeSVG";const Dne=e=>{switch(e){case"pending":return{text:"text-orange-700",bg:"bg-orange-100"};case"billed":return{text:"text-blue-700",bg:"bg-blue-100"};case"dispensed":return{text:"text-green-700",bg:"bg-green-100"};case"cancelled":return{text:"text-red-700",bg:"bg-red-100"};default:return{text:"text-gray-600",bg:"bg-gray-100"}}},Pne=()=>{const{orderId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(!1),[f,g]=w.useState({}),[b,v]=w.useState(""),[S,T]=w.useState(""),[E,C]=w.useState("cash"),P=w.useMemo(()=>(t==null?void 0:t.medications.reduce((U,V)=>{const ee=V.total_price??0,ie=ee*(V.discount_percentage??0)/100;return U+ee-ie},0))??0,[t==null?void 0:t.medications]),I=5,q=w.useMemo(()=>!t||!t.medications?0:t.medications.reduce((U,V,ee)=>{var re,A;const ie=V.drug_id??`index-${ee}`,ae=((re=f[ie])==null?void 0:re.pack)||0,J=((A=f[ie])==null?void 0:A.loose)||0,K=V.pack_price??0,W=V.loose_price??0;return U+ae*K+J*W},0),[t,f]),L=w.useCallback(async()=>{if(!e){h("Order ID is missing."),o(!1);return}o(!0),h(null);try{const U=await ce(`/api/pharmacy-orders/${e}`);if(!U.ok)throw U.status===404?new Error(`Order with ID ${e} not found.`):new Error(`Failed to fetch order details: ${U.statusText} (${U.status})`);const V=await U.json();console.log("Fetched order data after return:",V);const ie=V.medications.map(J=>J.pack_price&&J.loose_price&&J.loose_price>0?{...J,unitsPerPack:Math.round(J.pack_price/J.loose_price)}:{...J,unitsPerPack:0}).map(J=>({...J,discount_percentage:J.discount_percentage??0}));r({...V,medications:ie});const ae={};ie.forEach((J,K)=>{const W=J.drug_id??`index-${K}`;ae[W]={pack:0,loose:0}}),g(ae)}catch(U){console.error("Failed to fetch order details:",U),h(U.message||"Failed to load order details.")}finally{o(!1)}},[e]);w.useEffect(()=>{L()},[L]),w.useEffect(()=>{(async()=>{try{const V=await ce("/api/clinics/settings");if(!V.ok)throw new Error("Failed to fetch clinic settings");const ee=await V.json();console.log("Fetched clinic settings:",ee),v(ee.upi_id||"")}catch(V){console.error("Error fetching clinic settings:",V)}})()},[]),w.useEffect(()=>{if((t==null?void 0:t.order_total)!==void 0&&t.order_total>0&&b){const U=`upi://pay?pa=${b}&pn=ClinicName&am=${t.order_total.toFixed(2)}&cu=INR`;T(U)}else T("")},[t==null?void 0:t.order_total,b]);const O=(U,V)=>{r(ee=>{if(!ee)return null;const ie=ee.medications.map((J,K)=>(J.drug_id??`index-${K}`)===U?{...J,discount_percentage:isNaN(V)?0:V}:J),ae=ie.reduce((J,K)=>{const W=K.total_price??0,re=W*(K.discount_percentage??0)/100;return J+W-re},0);return{...ee,medications:ie,order_total:ae}})},B=(U,V,ee)=>{g(ie=>{const ae=ee.unitsPerPack||0,K=ee.pack_quantity*ae+ee.loose_quantity,W=Math.max(0,Math.min(V,K));let re=0,A=W;return ae>0&&(re=Math.floor(W/ae),A=W%ae),{...ie,[U]:{pack:re,loose:A}}})},$=async()=>{const U=t==null?void 0:t.medications.map((V,ee)=>{var K,W;const ie=V.drug_id??`index-${ee}`,ae=((K=f[ie])==null?void 0:K.pack)||0,J=((W=f[ie])==null?void 0:W.loose)||0;return ae>0||J>0?{drug_id:V.drug_id,name:V.name,pack_quantity:V.pack_quantity,loose_quantity:V.loose_quantity,returnPackQuantity:ae,returnLooseQuantity:J}:null}).filter(V=>V!==null);if(!U||U.length===0){alert("Please select a quantity greater than 0 for at least one item to return.");return}if(!e){alert("Order ID is missing. Cannot process return.");return}if(!U){alert("Could not prepare items for return.");return}u(!0),h(null);try{const V=await ce(`/api/pharmacy-orders/${e}/return`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemsToReturn:U})}),ee=await V.json();if(!V.ok)throw new Error(ee.message||`Failed to process return: ${V.statusText}`);alert("Return processed successfully! Stock has been updated.");const ie={};t==null||t.medications.forEach((ae,J)=>{const K=ae.drug_id??`index-${J}`;ie[K]={pack:0,loose:0}}),g(ie),L()}catch(V){console.error("Failed to process return:",V),h(V.message||"An error occurred while processing the return."),alert(`Error processing return: ${V.message||"Unknown error"}`)}finally{u(!1)}};if(a)return i.jsx("div",{className:"text-center p-6 text-gray-500 animate-pulse",children:"Loading Order Details..."});if(l)return i.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[i.jsxs("button",{onClick:()=>n(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[i.jsx(fn,{size:14,className:"mr-1.5"})," Back"]}),i.jsxs("div",{className:"bg-red-50 border border-red-300 text-red-700 rounded p-4",children:["Error: ",l]})]});if(!t)return i.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[i.jsxs("button",{onClick:()=>n(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[i.jsx(fn,{size:14,className:"mr-1.5"})," Back"]}),i.jsx("div",{className:"text-center py-10 px-4 text-gray-500 bg-white rounded-lg shadow",children:"Order details could not be loaded."})]});const F=()=>{window.print()},z=Dne(t.status);return i.jsx("div",{className:"pharmacy-order-details-page",children:i.jsxs("div",{className:"order-details-container printable-section",children:[i.jsxs("div",{className:"order-details-header no-print",children:[i.jsx("h1",{children:"Pharmacy Order Details"}),i.jsxs("div",{className:"actions",children:[i.jsxs("button",{onClick:()=>n(-1),className:"back-button",children:[i.jsx(fn,{size:18})," Back to Queue"]}),i.jsxs("button",{onClick:F,className:"print-button",children:[i.jsx(Ao,{size:18})," Print Bill"]})]})]}),i.jsxs("div",{className:"billing-header print-only",children:[i.jsx("div",{className:"clinic-header-left",children:i.jsx("div",{className:"clinic-info-print",children:i.jsxs("div",{className:"clinic-name-and-details-print",children:[i.jsx("h1",{children:"Mahajan Pharmacy"}),i.jsxs("div",{className:"clinic-details-print",children:[i.jsx("span",{className:"small-text clinic-address",children:"D.No: 3-1-289, Plot No. 101, Kabela Center, RR Nagar, Vijayawada  520012."}),i.jsx("span",{className:"small-text clinic-notes",children:"Phone: 93919 44733"}),i.jsx("span",{className:"small-text clinic-license",children:"Licence No:RLF20AP2025003328"})]})]})})}),i.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Patient Name:"})," RESHMA"]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Token:"})," 12"]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Order Date:"})," 31/10/2025"]})]})]}),i.jsxs("div",{className:"order-info-section no-print",children:[i.jsxs("div",{className:"order-info-item",children:[i.jsx("strong",{children:"Order ID:"})," ",t.id]}),i.jsxs("div",{className:"order-info-item",children:[i.jsx("strong",{children:"Patient:"})," ",t.patientName||"N/A"," (",t.patientTokenNumber||"N/A",")"]}),i.jsxs("div",{className:"order-info-item",children:[i.jsx("strong",{children:"Date:"})," ",new Date(t.date).toLocaleString()]}),i.jsxs("div",{className:"order-info-item",children:[i.jsx("strong",{children:"Prescribed By:"})," ",t.prescribedBy||"N/A"]}),i.jsxs("div",{className:"order-info-item",children:[i.jsx("strong",{children:"Status:"})," ",i.jsx("span",{className:`status-pill ${z.text} ${z.bg}`,children:t.status})]})]}),i.jsxs("div",{className:"medications-section",children:[i.jsx("h2",{children:"Medications Ordered"}),t.medications.length>0?i.jsxs("table",{className:"medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"DESCRIPTION"}),i.jsx("th",{children:"PACK QTY"}),i.jsx("th",{children:"PACK PRICE"}),i.jsx("th",{children:"LOOSE QTY"}),i.jsx("th",{children:"LOOSE PRICE"}),i.jsx("th",{children:"MRP"}),i.jsx("th",{children:"RATE"}),i.jsx("th",{children:"DIS %"}),i.jsx("th",{children:"GST%"}),i.jsx("th",{children:"AMT"}),(t.status==="dispensed"||t.status==="billed")&&i.jsxs(i.Fragment,{children:[i.jsx("th",{className:"no-print",children:"RETURN PACK QTY"}),i.jsx("th",{className:"no-print",children:"RETURN LOOSE QTY"})]})]})}),i.jsx("tbody",{children:t.medications.map((U,V)=>{var re,A,te,xe,M,Se;const ee=U.drug_id??`index-${V}`,ie=U.total_price??0,ae=ie*(U.discount_percentage??0)/100,J=ie-ae,K=((re=f[ee])==null?void 0:re.pack)||0,W=((A=f[ee])==null?void 0:A.loose)||0;return i.jsxs("tr",{children:[i.jsx("td",{children:U.name}),i.jsx("td",{children:U.pack_quantity??0}),i.jsx("td",{children:((te=U.pack_price)==null?void 0:te.toFixed(2))??"N/A"}),i.jsx("td",{children:U.loose_quantity??0}),i.jsx("td",{children:((xe=U.loose_price)==null?void 0:xe.toFixed(2))??"N/A"}),i.jsx("td",{children:((M=U.price)==null?void 0:M.toFixed(2))??"N/A"})," ",i.jsx("td",{children:((Se=U.price)==null?void 0:Se.toFixed(2))??"N/A"})," ",i.jsxs("td",{children:[i.jsx("input",{type:"number",value:U.discount_percentage??0,onChange:$e=>O(ee,parseFloat($e.target.value)),min:"0",max:"100",className:"discount-input-table no-print"}),i.jsxs("span",{className:"print-only",children:[U.discount_percentage??0,"%"]})]}),i.jsxs("td",{children:[I.toFixed(1),"%"]}),i.jsx("td",{children:J.toFixed(2)}),(t.status==="dispensed"||t.status==="billed")&&i.jsxs(i.Fragment,{children:[i.jsx("td",{className:"no-print",children:i.jsx("input",{type:"number",min:"0",max:U.pack_quantity,value:K,onChange:$e=>{const ge=(parseInt($e.target.value,10)||0)*(U.unitsPerPack||0)+W;B(ee,ge,U)},className:"return-quantity-input"})}),i.jsx("td",{className:"no-print",children:i.jsx("input",{type:"number",min:"0",max:U.loose_quantity+U.pack_quantity*(U.unitsPerPack||0)-K*(U.unitsPerPack||0),value:W,onChange:$e=>{const he=parseInt($e.target.value,10)||0,ge=K*(U.unitsPerPack||0)+he;B(ee,ge,U)},className:"return-quantity-input"})})]})]},ee)})})]}):i.jsx("p",{className:"text-sm text-gray-500 italic",children:"No medications listed for this order."})]}),i.jsx("div",{className:"print-only-total",children:i.jsxs("strong",{children:["Grand Total: ",P.toFixed(2)]})}),i.jsxs("div",{className:"order-total-section no-print",children:[i.jsx("span",{className:"total-label",children:"Order Total:"}),i.jsxs("span",{className:"total-amount",children:["",P.toFixed(2)]})]}),i.jsxs("div",{className:"payment-section no-print",children:[i.jsxs("div",{className:"payment-mode-group",children:[i.jsx("label",{htmlFor:"paymentMode",children:"Payment Mode:"}),i.jsxs("select",{id:"paymentMode",value:E,onChange:U=>C(U.target.value),className:"payment-mode-select",children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"upi",children:"UPI"}),i.jsx("option",{value:"card",children:"Card"}),i.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),i.jsx("option",{value:"credit",children:"Credit"})]})]}),S&&i.jsxs("div",{className:"qr-code-container",children:[i.jsx(ap,{value:S,size:128}),i.jsx("p",{children:"Scan to pay using UPI"})]})]}),(t.status==="dispensed"||t.status==="billed")&&t.medications.length>0&&i.jsxs("div",{className:"return-action-section no-print",children:[q>0&&i.jsxs("div",{className:"total-refund-display",children:["Total Refund: ",q.toFixed(2)]}),i.jsx("button",{onClick:$,disabled:Object.values(f).every(U=>U.pack===0&&U.loose===0)||d,className:"process-return-button",children:d?i.jsxs(i.Fragment,{children:[i.jsx(Il,{size:16,className:"mr-2 animate-spin"})," Processing..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Il,{size:16,className:"mr-2"})," Process Return"]})})]})]})})},Ine=async()=>{const e=await ce("/subscriptions");if(!e.ok)throw new Error("Failed to fetch subscription plans");return await e.json()},Mne=async e=>{const n=await ce(`/subscriptions/${e}`);if(!n.ok){const t=await n.json().catch(()=>({message:"Failed to fetch subscription plan details"}));throw new Error(t.message||"Failed to fetch subscription plan details")}return await n.json()},Rne=async e=>{const n=await ce("/subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){const t=await n.json().catch(()=>({message:"Failed to create subscription plan"}));throw new Error(t.message||"Failed to create subscription plan")}return await n.json()},One=async(e,n)=>{const t=await ce(`/subscriptions/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){const r=await t.json().catch(()=>({message:"Failed to update subscription plan"}));throw new Error(r.message||"Failed to update subscription plan")}return await t.json()},Lne=async e=>{const n=await ce(`/subscriptions/${e}`,{method:"DELETE"});if(!n.ok){const t=await n.json().catch(()=>({message:"Failed to deactivate subscription plan"}));throw new Error(t.message||"Failed to deactivate subscription plan")}return await n.json()},Fne=async(e,n)=>{const t=await ce("/api/payment/razorpay-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:e,planId:n})});if(!t.ok){const r=await t.json().catch(()=>({message:"Failed to initiate Razorpay subscription"}));throw new Error(r.message||"Failed to initiate Razorpay subscription")}return await t.json()},$ne=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null),u=w.useCallback(async()=>{a(!0),l(null);try{const g=await Ine();t(g)}catch(g){l(g.message||"Failed to fetch subscription plans."),d({type:"error",message:g.message||"Failed to fetch plans."})}finally{a(!1)}},[]);w.useEffect(()=>{u()},[u]),w.useEffect(()=>{if(h){const g=setTimeout(()=>d(null),5e3);return()=>clearTimeout(g)}},[h]);const f=async g=>{if(d(null),l(null),window.confirm("Are you sure you want to deactivate this plan? This action cannot be undone directly.")){a(!0),l(null),d(null);try{await Lne(g),d({type:"success",message:"Plan deactivated successfully!"}),u()}catch(b){l(b.message||"Failed to deactivate plan."),d({type:"error",message:b.message||"Failed to deactivate plan."})}finally{a(!1)}}};return i.jsxs("div",{className:"subscription-page-container",children:[h&&i.jsxs("div",{className:`${h.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[h.type==="success"?i.jsx(Nr,{size:18,className:"mr-2 text-green-500"}):i.jsx(mi,{size:18,className:"mr-2 text-red-500"}),i.jsx("span",{children:h.message})]}),i.jsx("button",{onClick:()=>d(null),className:`${h.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{children:[" ",i.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[i.jsxs("button",{onClick:()=>e(-1),className:"back-button",children:[i.jsx(fn,{size:16}),"Back"]}),i.jsx("h1",{children:"Manage Subscription Plans"}),i.jsxs("button",{onClick:()=>e("/dashboard/subscriptions/add"),className:"subscription-btn",children:[i.jsx(Pl,{size:16,className:"mr-1 inline-block"})," Add New Plan"]})]}),r&&n.length===0&&i.jsx("div",{className:"flex items-center justify-center p-8",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"loading-animation-container",style:{height:"auto",margin:"20px 0"},children:i.jsx("div",{className:"breathing-ball",style:{width:"25px",height:"25px"}})}),i.jsx("div",{className:"mt-2 text-gray-600 text-md font-medium",children:"Loading plans..."})]})}),!r&&o&&n.length===0&&i.jsx("p",{className:"text-center text-red-500",children:o}),n.length>0&&i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"subscription-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Price"}),i.jsx("th",{children:"Billing Cycle"}),i.jsx("th",{children:"Status"}),i.jsx("th",{className:"text-right",children:"Actions"})]})}),i.jsx("tbody",{children:n.map(g=>i.jsxs("tr",{children:[i.jsx("td",{children:g.name}),i.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),i.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),i.jsx("td",{children:i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),i.jsxs("td",{className:"actions-cell text-right",children:[i.jsx("button",{onClick:()=>e(`/dashboard/subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:i.jsx(eh,{size:16,className:"inline-block"})}),g.status==="active"&&i.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:r,children:i.jsx(Wi,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!r&&n.length===0&&!o&&i.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No subscription plans found. Add one to get started!"})]})]})},zne=()=>{const e=Ft(),[n,t]=w.useState({name:"",description:"",price:"",period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null);w.useEffect(()=>{if(h){const b=setTimeout(()=>d(null),5e3);return()=>clearTimeout(b)}},[h]);const u=b=>{const{name:v,value:S}=b.target;t(T=>({...T,[v]:S}))},f=async b=>{if(b.preventDefault(),a(!0),l(null),d(null),!n.name||!n.price||!n.period||n.interval===void 0||n.interval<=0){l("Please fill in all required fields (Name, Price, Period, Interval > 0)."),a(!1);return}try{await Rne(n),d({type:"success",message:"Plan created successfully! Redirecting..."}),setTimeout(()=>{e("/dashboard/subscriptions")},2e3)}catch(v){const S=v.message||"Failed to create plan.";l(S),d({type:"error",message:S})}finally{a(!1)}},g=()=>{e(-1)};return i.jsxs("div",{className:"subscription-page-container",children:[h&&i.jsxs("div",{className:`${h.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[h.type==="success"?i.jsx(Nr,{size:18,className:"mr-2 text-green-500"}):i.jsx(mi,{size:18,className:"mr-2 text-red-500"}),i.jsx("span",{children:h.message})]}),i.jsx("button",{onClick:()=>d(null),className:`${h.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{className:"subscription-form",children:[i.jsx("h1",{children:"Add New Subscription Plan"}),o&&i.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:o}),i.jsxs("form",{onSubmit:f,children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Plan Name ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:n.name||"",onChange:u,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",rows:3,value:n.description||"",onChange:u})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price (INR) ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:n.price||"",onChange:u,required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"period",children:["Billing Period ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsxs("select",{id:"period",name:"period",value:n.period||"monthly",onChange:u,required:!0,children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"weekly",children:"Weekly"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"yearly",children:"Yearly"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"interval",children:["Interval ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:n.interval||1,onChange:u,required:!0})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),i.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:n.razorpay_plan_id||"",onChange:u})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),i.jsxs("button",{type:"submit",disabled:r,className:"subscription-btn",children:[r?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,r?"Creating...":"Create Plan"]})]})]})]})]})},Bne=()=>{const{id:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState({}),[l,h]=w.useState(!1),[d,u]=w.useState(!0),[f,g]=w.useState(null),[b,v]=w.useState(null),S=w.useCallback(async()=>{if(!e){g("Plan ID is missing."),u(!1);return}u(!0),g(null);try{const P=await Mne(e);r(P),o({name:P.name,description:P.description||"",price:P.price,period:P.period,interval:P.interval,razorpay_plan_id:P.razorpay_plan_id||"",status:P.status})}catch(P){g(P.message||"Failed to fetch plan details."),v({type:"error",message:P.message||"Failed to fetch plan details."})}finally{u(!1)}},[e]);w.useEffect(()=>{S()},[S]),w.useEffect(()=>{if(b){const P=setTimeout(()=>v(null),5e3);return()=>clearTimeout(P)}},[b]);const T=P=>{const{name:I,value:q}=P.target;o(L=>({...L,[I]:q}))},E=async P=>{if(P.preventDefault(),!e){g("Plan ID is missing.");return}if(h(!0),g(null),v(null),!a.name||!a.price||!a.period||a.interval===void 0||a.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),h(!1);return}try{await One(e,a),v({type:"success",message:"Plan updated successfully! Redirecting..."}),setTimeout(()=>{n(-1)},2e3)}catch(I){const q=I.message||"Failed to update plan.";g(q),v({type:"error",message:q})}finally{h(!1)}},C=()=>{n(-1)};return d?i.jsx("div",{className:"p-6 text-center",children:"Loading plan details..."}):f&&!t?i.jsx("div",{className:"p-6 text-center text-red-500",children:f}):t?i.jsxs("div",{className:"subscription-page-container",children:[b&&i.jsxs("div",{className:`${b.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[b.type==="success"?i.jsx(Nr,{size:18,className:"mr-2"}):i.jsx(mi,{size:18,className:"mr-2"}),i.jsx("span",{children:b.message})]}),i.jsx("button",{onClick:()=>v(null),className:"ml-4",children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{className:"subscription-form",children:[i.jsx("h1",{children:"Edit Subscription Plan"}),f&&i.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),i.jsxs("form",{onSubmit:E,children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Plan Name ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:a.name||"",onChange:T,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description||"",onChange:T})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price (INR) ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:a.price||"",onChange:T,required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"period",children:["Billing Period ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsxs("select",{id:"period",name:"period",value:a.period||"monthly",onChange:T,required:!0,children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"weekly",children:"Weekly"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"yearly",children:"Yearly"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"interval",children:["Interval ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:a.interval||1,onChange:T,required:!0})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),i.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:a.razorpay_plan_id||"",onChange:T})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"status",children:"Status"}),i.jsxs("select",{id:"status",name:"status",value:a.status||"active",onChange:T,children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"inactive",children:"Inactive"})]})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:C,className:"subscription-btn subscription-btn-secondary",children:"Back"}),i.jsxs("button",{type:"submit",disabled:l,className:"subscription-btn",children:[l?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,l?"Saving...":"Save Changes"]})]})]})]})]}):i.jsx("div",{className:"p-6 text-center text-gray-500",children:"Plan not found."})},Une=()=>{const{patientId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState([]),[l,h]=w.useState(""),[d,u]=w.useState(!0),[f,g]=w.useState(null),[b,v]=w.useState("manual"),[S,T]=w.useState(!1),[E,C]=w.useState(null),P=w.useCallback(async()=>{u(!0),g(null);try{const L=await ce(`/api/patients/${e}`);if(!L.ok){const F=await L.json();throw new Error(F.message||"Failed to fetch patient details")}const O=await L.json();r(O);const B=await ce("/api/subscriptions");if(!B.ok){const F=await B.json();throw new Error(F.message||"Failed to fetch subscription plans")}const $=await B.json();o($.filter(F=>F.status==="active"))}catch(L){console.error("Error fetching data:",L),g(`Failed to load data: ${L.message}`)}finally{u(!1)}},[e]);w.useEffect(()=>{e?P():(g("Patient ID is missing."),u(!1))},[e,P]);const I=(L,O)=>{const B=new Date(L),$=O.interval||1;switch(O.period){case"daily":B.setDate(L.getDate()+$);break;case"weekly":B.setDate(L.getDate()+$*7);break;case"monthly":B.setMonth(L.getMonth()+$);break;case"yearly":B.setFullYear(L.getFullYear()+$);break;default:console.warn(`Unknown subscription period: ${O.period}. Defaulting to 1 month.`),B.setMonth(L.getMonth()+1)}return B},q=async()=>{if(!e||!l){C("Please select a subscription plan.");return}const L=a.find(O=>O.id===l);if(!L){C("Selected plan details not found.");return}T(!0),C(null);try{const O=new Date,B=I(O,L);if(b==="manual"){const $={subscription_plan_id:l,subscription_status:"active",subscription_start_date:O.toISOString(),subscription_end_date:B.toISOString(),subscription_payment_method:"manual"},F=await ce(`/api/patients/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!F.ok){const z=await F.json();throw new Error(z.message||"Failed to start subscription manually")}alert(`Subscription started successfully for ${t==null?void 0:t.name} (Manual Payment)!`),n("/all-patients")}else if(b==="razorpay"){console.log("Initiating Razorpay subscription for plan:",L);const $=await Fne(e,l);if($&&$.short_url)window.location.href=$.short_url;else throw new Error("Failed to get Razorpay subscription link from backend.")}}catch(O){console.error("Error starting subscription:",O),C(`Failed to start subscription: ${O.message}`),T(!1)}};return d?i.jsx("div",{className:"loading-state-subscription",children:"Loading patient and plans..."}):f?i.jsxs("div",{className:"subscription-page-container",children:[i.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[i.jsx("strong",{children:"Error: "}),i.jsx("span",{children:f})]}),i.jsxs("button",{onClick:()=>n(-1),className:"all-patients-back-button",children:[i.jsx(fn,{size:16})," ","Back"]})]}):t?i.jsxs("div",{className:"subscription-page-container",children:[i.jsxs("button",{onClick:()=>n(-1),className:"all-patients-back-button",children:[i.jsx(fn,{size:16})," ","Back"]}),i.jsxs("h1",{children:[i.jsx(Mo,{size:28})," ","Start Subscription for ",t.name]}),E&&i.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[" ",i.jsx("span",{children:E})]}),i.jsxs("div",{className:"subscription-form",children:[" ",i.jsx("h2",{children:"Available Subscription Plans"}),a.length===0?i.jsx("p",{className:"empty-state",children:"No active subscription plans found."}):i.jsx("div",{className:"subscription-plan-list",children:a.map(L=>i.jsxs("div",{className:`subscription-plan-card ${l===L.id?"selected-plan":""}`,onClick:()=>h(L.id),children:[i.jsx("h3",{children:L.name}),i.jsxs("p",{className:"price",children:["",L.price]}),i.jsxs("p",{className:"duration",children:["Every ",L.interval," ",L.period,L.interval>1?"s":""]}),L.description&&i.jsx("p",{children:L.description})]},L.id))})]}),i.jsxs("div",{className:"subscription-form mb-6",children:[" ",i.jsx("h2",{children:"Select Payment Method"}),i.jsx("div",{className:"form-group",children:i.jsxs("label",{className:"inline-flex items-center",children:[i.jsx("input",{type:"radio",name:"paymentMethod",value:"manual",checked:b==="manual",onChange:()=>v("manual"),className:"mr-2"}),i.jsx("span",{children:"Cash (Manual)"})]})}),i.jsx("div",{className:"form-group",children:i.jsxs("label",{className:"inline-flex items-center",children:[i.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:b==="razorpay",onChange:()=>v("razorpay"),className:"mr-2"}),i.jsx("span",{children:"Razorpay"})]})})]}),i.jsx("div",{className:"flex justify-end",children:i.jsxs("button",{onClick:q,disabled:!l||S||a.length===0,className:"subscription-btn",children:[S&&i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),S?"Starting...":"Start Subscription"]})})]}):i.jsxs("div",{className:"subscription-page-container",children:[i.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[i.jsx("strong",{children:"Warning: "}),i.jsx("span",{children:"Patient not found."})]}),i.jsxs("button",{onClick:()=>n(-1),className:"all-patients-back-button",children:[i.jsx(fn,{size:16}),"Back"]})]})},qne=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null),u=w.useCallback(async()=>{a(!0),l(null);try{const g=await Fw();t(g)}catch(g){l(g.message||"Failed to fetch clinic subscription plans."),d({type:"error",message:g.message||"Failed to fetch plans."})}finally{a(!1)}},[]);w.useEffect(()=>{u()},[u]),w.useEffect(()=>{if(h){const g=setTimeout(()=>d(null),5e3);return()=>clearTimeout(g)}},[h]);const f=async g=>{if(d(null),l(null),window.confirm("Are you sure you want to deactivate this clinic plan? This action cannot be undone directly.")){a(!0),l(null),d(null);try{await k9(g),d({type:"success",message:"Clinic plan deactivated successfully!"}),u()}catch(b){l(b.message||"Failed to deactivate clinic plan."),d({type:"error",message:b.message||"Failed to deactivate plan."})}finally{a(!1)}}};return i.jsxs("div",{className:"subscription-page-container",children:[h&&i.jsxs("div",{className:`${h.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[h.type==="success"?i.jsx(Nr,{size:18,className:"mr-2 text-green-500"}):i.jsx(mi,{size:18,className:"mr-2 text-red-500"}),i.jsx("span",{children:h.message})]}),i.jsx("button",{onClick:()=>d(null),className:`${h.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx("button",{onClick:()=>e(-1),className:"p-2 rounded-md hover:bg-gray-200",children:i.jsx(fn,{size:20})}),i.jsx("h1",{className:"text-2xl font-bold",children:"Manage Clinic Subscription Plans"})]}),i.jsxs("button",{onClick:()=>e("/dashboard/clinic-subscriptions/add"),className:"subscription-btn",children:[i.jsx(Pl,{size:16,className:"mr-1 inline-block"})," Add New Clinic Plan"]})]}),r&&n.length===0&&i.jsx("div",{className:"flex items-center justify-center p-8",children:i.jsxs("div",{className:"flex flex-col items-center",children:[i.jsx("div",{className:"loading-animation-container",style:{height:"auto",margin:"20px 0"},children:i.jsx("div",{className:"breathing-ball",style:{width:"25px",height:"25px"}})}),i.jsx("div",{className:"mt-2 text-gray-600 text-md font-medium",children:"Loading clinic plans..."})]})}),!r&&o&&n.length===0&&i.jsx("p",{className:"text-center text-red-500",children:o}),n.length>0&&i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"subscription-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Price"}),i.jsx("th",{children:"Billing Cycle"}),i.jsx("th",{children:"Status"}),i.jsx("th",{className:"text-right",children:"Actions"})]})}),i.jsx("tbody",{children:n.map(g=>i.jsxs("tr",{children:[i.jsx("td",{children:g.name}),i.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),i.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),i.jsx("td",{children:i.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),i.jsxs("td",{className:"actions-cell text-right",children:[i.jsx("button",{onClick:()=>e(`/dashboard/clinic-subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:i.jsx(eh,{size:16,className:"inline-block"})}),g.status==="active"&&i.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:r,children:i.jsx(Wi,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!r&&n.length===0&&!o&&i.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No clinic subscription plans found. Add one to get started!"})]})]})},Vne=()=>{const e=Ft(),[n,t]=w.useState({name:"",description:"",price:0,period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[r,a]=w.useState(!1),[o,l]=w.useState(null),[h,d]=w.useState(null);w.useEffect(()=>{if(h){const b=setTimeout(()=>d(null),5e3);return()=>clearTimeout(b)}},[h]);const u=b=>{const{name:v,value:S,type:T}=b.target;t(E=>({...E,[v]:T==="number"?parseFloat(S):S}))},f=async b=>{if(b.preventDefault(),a(!0),l(null),d(null),!n.name||!n.price||!n.period||n.interval===void 0||n.interval<=0){l("Please fill in all required fields (Name, Price, Period, Interval > 0)."),a(!1);return}try{await _9(n),d({type:"success",message:"Clinic plan created successfully! Redirecting..."}),setTimeout(()=>{e("/dashboard/clinic-subscriptions")},2e3)}catch(v){const S=v.message||"Failed to create clinic plan.";l(S),d({type:"error",message:S})}finally{a(!1)}},g=()=>{e(-1)};return i.jsxs("div",{className:"subscription-page-container",children:[h&&i.jsxs("div",{className:`${h.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[h.type==="success"?i.jsx(Nr,{size:18,className:"mr-2 text-green-500"}):i.jsx(mi,{size:18,className:"mr-2 text-red-500"}),i.jsx("span",{children:h.message})]}),i.jsx("button",{onClick:()=>d(null),className:`${h.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{className:"subscription-form",children:[i.jsx("h1",{children:"Add New Clinic Subscription Plan"}),o&&i.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:o}),i.jsxs("form",{onSubmit:f,children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Plan Name ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:n.name||"",onChange:u,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",rows:3,value:n.description||"",onChange:u})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price (INR) ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:n.price||"",onChange:u,required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"period",children:["Billing Period ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsxs("select",{id:"period",name:"period",value:n.period||"monthly",onChange:u,required:!0,children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"weekly",children:"Weekly"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"yearly",children:"Yearly"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"interval",children:["Interval ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:n.interval||1,onChange:u,required:!0})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),i.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:n.razorpay_plan_id||"",onChange:u})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),i.jsxs("button",{type:"submit",disabled:r,className:"subscription-btn",children:[r?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,r?"Creating...":"Create Plan"]})]})]})]})]})},Hne=()=>{const{id:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState({}),[l,h]=w.useState(!1),[d,u]=w.useState(!0),[f,g]=w.useState(null),[b,v]=w.useState(null),S=w.useCallback(async()=>{if(!e){g("Plan ID is missing."),u(!1);return}u(!0),g(null);try{const P=await j9(e);r(P),o({name:P.name,description:P.description||"",price:Number(P.price),period:P.period,interval:Number(P.interval),razorpay_plan_id:P.razorpay_plan_id||"",status:P.status})}catch(P){g(P.message||"Failed to fetch clinic plan details."),v({type:"error",message:P.message||"Failed to fetch plan details."})}finally{u(!1)}},[e]);w.useEffect(()=>{S()},[S]),w.useEffect(()=>{if(b){const P=setTimeout(()=>v(null),5e3);return()=>clearTimeout(P)}},[b]);const T=P=>{const{name:I,value:q,type:L}=P.target;o(O=>({...O,[I]:L==="number"?parseFloat(q):q}))},E=async P=>{if(P.preventDefault(),!e){g("Plan ID is missing.");return}if(h(!0),g(null),v(null),!a.name||!a.price||!a.period||a.interval===void 0||a.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),h(!1);return}try{await C9(e,a),v({type:"success",message:"Clinic plan updated successfully! Redirecting..."}),setTimeout(()=>{n(-1)},2e3)}catch(I){const q=I.message||"Failed to update clinic plan.";g(q),v({type:"error",message:q})}finally{h(!1)}},C=()=>{n(-1)};return d?i.jsx("div",{className:"p-6 text-center",children:"Loading clinic plan details..."}):f&&!t?i.jsx("div",{className:"p-6 text-center text-red-500",children:f}):t?i.jsxs("div",{className:"subscription-page-container",children:[b&&i.jsxs("div",{className:`${b.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[i.jsxs("div",{className:"flex items-center",children:[b.type==="success"?i.jsx(Nr,{size:18,className:"mr-2"}):i.jsx(mi,{size:18,className:"mr-2"}),i.jsx("span",{children:b.message})]}),i.jsx("button",{onClick:()=>v(null),className:"ml-4",children:i.jsx(Sn,{size:16})})]}),i.jsxs("div",{className:"subscription-form",children:[i.jsx("h1",{children:"Edit Clinic Subscription Plan"}),f&&i.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),i.jsxs("form",{onSubmit:E,children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"name",children:["Plan Name ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"text",id:"name",name:"name",value:a.name||"",onChange:T,required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"description",children:"Description"}),i.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description||"",onChange:T})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"price",children:["Price (INR) ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:a.price!==void 0?a.price:"",onChange:T,required:!0})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"period",children:["Billing Period ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsxs("select",{id:"period",name:"period",value:a.period||"monthly",onChange:T,required:!0,children:[i.jsx("option",{value:"daily",children:"Daily"}),i.jsx("option",{value:"weekly",children:"Weekly"}),i.jsx("option",{value:"monthly",children:"Monthly"}),i.jsx("option",{value:"yearly",children:"Yearly"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsxs("label",{htmlFor:"interval",children:["Interval ",i.jsx("span",{className:"text-red-500",children:"*"})]}),i.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:a.interval!==void 0?a.interval:"",onChange:T,required:!0})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),i.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:a.razorpay_plan_id||"",onChange:T})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"status",children:"Status"}),i.jsxs("select",{id:"status",name:"status",value:a.status||"active",onChange:T,children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"inactive",children:"Inactive"})]})]}),i.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[i.jsx("button",{type:"button",onClick:C,className:"subscription-btn subscription-btn-secondary",children:"Back"}),i.jsxs("button",{type:"submit",disabled:l,className:"subscription-btn",children:[l?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,l?"Saving...":"Save Changes"]})]})]})]})]}):i.jsx("div",{className:"p-6 text-center text-gray-500",children:"Clinic plan not found."})},Gne=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(""),[o,l]=w.useState(!0),[h,d]=w.useState(null),[u,f]=w.useState(!1),[g,b]=w.useState(null),v=w.useCallback(async()=>{d(null);try{const P=(await Fw()).filter(I=>I.status==="active");t(P),P.length>0&&!r&&a(P[0].id)}catch(C){console.error("Error fetching plans:",C),d(`Failed to load subscription plans: ${C.message}`)}},[r]);w.useEffect(()=>{(async()=>{l(!0);try{const P=await E9();P&&P.short_url&&console.log("Pending subscription found, but allowing new selection.")}catch(P){P.message!=="No pending subscription found."&&console.error("Error checking for pending subscription:",P)}try{await v()}catch(P){console.error("Error fetching plans:",P),d(`Failed to load subscription plans: ${P.message}`)}finally{l(!1)}})()},[v]);const S=async C=>{if(!n.find(I=>I.id===C)){b("Plan details not found.");return}a(C),f(!0),b(null);try{const I=await T9(C);if(I&&I.short_url)window.location.href=I.short_url;else throw new Error("Failed to get Razorpay clinic subscription link from backend.")}catch(I){console.error("Error starting clinic subscription:",I),b(`Failed to start clinic subscription: ${I.message}`),f(!1)}};if(o)return i.jsx("div",{className:"subscription-page-container flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})});const T=(C,P)=>C===1?P==="yearly"?"Billed Annually":P==="monthly"?"Billed Monthly":`per ${P}`:`every ${C} ${P}s`,E=C=>{const P=[{icon:i.jsx(Nr,{size:18}),text:"Voice AI Agent Integration"},{icon:i.jsx(Nr,{size:18}),text:"Unlimited Patient Records"},{icon:i.jsx(Nr,{size:18}),text:"Advanced Pharmacy & Lab Flow"}];return C==="yearly"?[...P,{icon:i.jsx(tR,{size:18}),text:"Priority 24/7 Developer Support"},{icon:i.jsx(e0,{size:18}),text:"Advanced Business Analytics"},{icon:i.jsx(s1,{size:18}),text:"Lock in current pricing"}]:[...P,{icon:i.jsx(Nr,{size:18}),text:"Standard Support"}]};return i.jsxs("div",{className:"subscription-page-container",children:[i.jsxs("header",{className:"subscription-header-row",children:[i.jsxs("button",{onClick:()=>e(-1),className:"all-patients-back-button compact",children:[i.jsx(fn,{size:16}),"Back"]}),i.jsx("div",{className:"header-title-group",children:i.jsxs("h1",{children:[i.jsx(WC,{size:28}),i.jsx("span",{children:"Go Pro"})]})})]}),h&&i.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[i.jsx(e0,{size:20}),i.jsx("span",{children:h})]}),g&&i.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[i.jsx(e0,{size:20}),i.jsx("span",{children:g})]}),i.jsx("div",{className:"subscription-plan-list",children:n.length===0?i.jsx("p",{className:"empty-state",children:"No active clinic subscription plans found."}):n.map((C,P)=>{const I=C.period==="yearly",q=I||C.name.toLowerCase().includes("pro");return i.jsxs("div",{className:`subscription-plan-card period-${C.period} ${r===C.id?"selected-plan":""} ${q?"is-popular":""} ${u&&r===C.id?"loading":""}`,onClick:()=>!u&&S(C.id),style:{animationDelay:`${P*.15}s`,opacity:1,animationFillMode:"forwards",cursor:u?"not-allowed":"pointer"},children:[I&&i.jsx("span",{className:"popular-badge",children:"Best Value - 20% Off Included"}),!I&&q&&i.jsx("span",{className:"popular-badge",children:"Most Popular"}),i.jsx("h3",{children:C.name}),i.jsxs("div",{className:"price-container",children:[i.jsx("span",{className:"currency",children:""}),i.jsx("span",{className:"price",children:Number(C.price).toLocaleString()}),i.jsxs("span",{className:"duration",children:["/",T(C.interval,C.period)]})]}),C.description&&i.jsx("p",{className:"description",children:C.description}),i.jsx("ul",{className:"plan-features",children:E(C.period).map((L,O)=>i.jsxs("li",{children:[L.icon," ",L.text]},O))}),i.jsx("button",{className:"plan-buy-btn",onClick:L=>{L.stopPropagation(),u||S(C.id)},disabled:u,children:u&&r===C.id?i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/30 border-t-white"}):i.jsxs(i.Fragment,{children:[i.jsxs("span",{children:["Choose ",C.name]}),i.jsx(s1,{size:14})]})}),u&&r===C.id&&i.jsx("div",{className:"card-loading-overlay",children:i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-indigo-600"})})]},C.id)})})]})},Yne=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(!0),[o,l]=w.useState(null),[h,d]=w.useState(!1),[u,f]=w.useState(!1),[g,b]=w.useState(null),[v,S]=w.useState({name:"",email:"",password:"",role:"user"}),[T,E]=w.useState({name:"",email:"",role:"",password:"",confirmPassword:""}),[C,P]=w.useState(""),[I,q]=w.useState(""),[L,O]=w.useState({}),[B,$]=w.useState(!1),[F,z]=w.useState(null),[U,V]=w.useState([]),[ee,ie]=w.useState(""),[ae,J]=w.useState(!1),[K,W]=w.useState(null);w.useEffect(()=>{const me=setTimeout(()=>{q(C)},500);return()=>{clearTimeout(me)}},[C]),w.useEffect(()=>{re(I)},[I]);const re=async(me="")=>{a(!0);try{const de=me?`/api/users?search=${encodeURIComponent(me)}`:"/api/users",He=await(await ce(de)).json();if(t(He),He.length>0){const pe=[...new Set(He.map(Pe=>Pe.clinic_id).filter(Pe=>!!Pe))],ne={};await Promise.all(pe.map(async Pe=>{try{const Ye=await S9(Pe);ne[Pe]=Ye}catch(Ye){console.error(`Failed to fetch subscription status for clinic ${Pe}`,Ye),ne[Pe]={hasProPlan:!1}}})),O(ne)}l(null)}catch(de){l("Failed to fetch users."),console.error(de)}finally{a(!1)}},A=async me=>{me.preventDefault();try{await ce("/users",{method:"POST",body:JSON.stringify(v)}),d(!1),S({name:"",email:"",password:"",role:"user"}),re()}catch(de){l("Failed to add user."),console.error(de)}},te=async me=>{if(me.preventDefault(),!g)return;const{password:de,confirmPassword:Le,...He}=T,pe={...He};if(de){if(de.length<6){l("Password must be at least 6 characters long.");return}if(de!==Le){l("Passwords do not match.");return}pe.password=de}try{await ce(`/users/${g.id}`,{method:"PUT",body:JSON.stringify(pe)}),f(!1),b(null),E({...T,password:"",confirmPassword:""}),re()}catch(ne){l("Failed to update user."),console.error(ne)}},xe=async me=>{if(window.confirm("Are you sure you want to delete this user?"))try{await ce(`/users/${me}`,{method:"DELETE"}),re()}catch(de){l("Failed to delete user."),console.error(de)}},M=me=>{b(me),E({name:me.name,email:me.email,role:me.role,password:"",confirmPassword:""}),f(!0)},Se=async()=>{J(!0);try{const me=await Fw();V(me),me.length>0&&ie(me[0].id),W(null)}catch(me){W("Failed to fetch subscription plans."),console.error(me)}finally{J(!1)}},$e=me=>{z(me),$(!0),Se()},he=async me=>{if(me.preventDefault(),!F||!ee){l("Please select a clinic and a plan.");return}try{await ce("/clinic-subscriptions/manual-activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicId:F,planId:ee})}),$(!1),z(null),ie(""),re(),l(null)}catch(de){l("Failed to manually activate clinic subscription."),console.error(de)}},ge=async me=>{if(window.confirm("Are you sure you want to cancel this clinic's subscription? This action cannot be undone."))try{await N9(me),re(),l(null)}catch(de){l("Failed to cancel subscription."),console.error(de)}};return r?i.jsx("div",{children:"Loading users..."}):o?i.jsx("div",{className:"error-message",children:o}):i.jsxs("div",{className:"user-management-page",children:[i.jsxs("div",{className:"user-management-header",children:[i.jsxs("button",{onClick:()=>e(-1),className:"back-button",children:[i.jsx(fn,{size:16}),"Back"]}),i.jsx("h1",{children:"User Management"})]}),i.jsxs("div",{className:"controls-container",children:[i.jsx("input",{type:"text",placeholder:"Search by name or email...",value:C,onChange:me=>P(me.target.value),className:"search-input"}),i.jsx("button",{onClick:()=>d(!0),className:"add-user-button",children:"Add New User"})]}),h&&i.jsx("div",{className:"modal",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("span",{className:"close-button",onClick:()=>d(!1),children:""}),i.jsx("h2",{children:"Add New User"}),i.jsxs("form",{onSubmit:A,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Name:"}),i.jsx("input",{type:"text",value:v.name,onChange:me=>S({...v,name:me.target.value}),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Email:"}),i.jsx("input",{type:"email",value:v.email,onChange:me=>S({...v,email:me.target.value}),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Password:"}),i.jsx("input",{type:"password",value:v.password,onChange:me=>S({...v,password:me.target.value}),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Role:"}),i.jsxs("select",{value:v.role,onChange:me=>S({...v,role:me.target.value}),children:[i.jsx("option",{value:"user",children:"User"}),i.jsx("option",{value:"admin",children:"Admin"}),i.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),i.jsx("button",{type:"submit",children:"Add User"})]})]})}),u&&g&&i.jsx("div",{className:"modal",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("span",{className:"close-button",onClick:()=>f(!1),children:""}),i.jsx("h2",{children:"Edit User"}),i.jsxs("form",{onSubmit:te,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Name:"}),i.jsx("input",{type:"text",value:T.name,onChange:me=>E({...T,name:me.target.value}),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Email:"}),i.jsx("input",{type:"email",value:T.email,onChange:me=>E({...T,email:me.target.value}),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Role:"}),i.jsxs("select",{value:T.role,onChange:me=>E({...T,role:me.target.value}),children:[i.jsx("option",{value:"user",children:"User"}),i.jsx("option",{value:"admin",children:"Admin"}),i.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"New Password (optional):"}),i.jsx("input",{type:"password",value:T.password,onChange:me=>E({...T,password:me.target.value})})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Confirm New Password:"}),i.jsx("input",{type:"password",value:T.confirmPassword,onChange:me=>E({...T,confirmPassword:me.target.value})})]}),i.jsx("button",{type:"submit",children:"Update User"})]})]})}),B&&i.jsx("div",{className:"modal",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("span",{className:"close-button",onClick:()=>$(!1),children:""}),i.jsx("h2",{children:"Select Subscription Plan for Clinic"}),ae&&i.jsx("div",{children:"Loading plans..."}),K&&i.jsx("div",{className:"error-message",children:K}),!ae&&!K&&U.length===0&&i.jsx("div",{children:"No active subscription plans available."}),!ae&&!K&&U.length>0&&i.jsxs("form",{onSubmit:he,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Select Plan:"}),i.jsx("select",{value:ee,onChange:me=>ie(me.target.value),required:!0,children:U.map(me=>i.jsxs("option",{value:me.id,children:[me.name," - $",me.price,"/",me.interval," ",me.period]},me.id))})]}),i.jsx("button",{type:"submit",children:"Activate Selected Plan"})]})]})}),i.jsxs("table",{className:"user-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Email"}),i.jsx("th",{children:"Role"}),i.jsx("th",{children:"Clinic ID"}),i.jsx("th",{children:"Subscription Status"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:n.map(me=>{const de=me.clinic_id||"N/A",Le=de!=="N/A"?L[de]:null,He=(Le==null?void 0:Le.hasProPlan)??!1,pe=He?"PRO":"Standard";return i.jsxs("tr",{children:[i.jsx("td",{children:me.name}),i.jsx("td",{children:me.email}),i.jsx("td",{children:me.role}),i.jsx("td",{children:de}),i.jsx("td",{children:de!=="N/A"?i.jsx("span",{className:He?"pro-badge":"standard-badge",children:pe}):"N/A"}),i.jsxs("td",{children:[i.jsx("button",{onClick:()=>M(me),className:"edit-button",children:"Edit"}),i.jsx("button",{onClick:()=>xe(me.id),className:"delete-button",children:"Delete"}),me.clinic_id&&!He&&i.jsx("button",{onClick:()=>$e(me.clinic_id),className:"start-subscription-button",children:"Start Subscription"}),me.clinic_id&&He&&i.jsx("button",{onClick:()=>ge(me.clinic_id),className:"cancel-subscription-button",children:"Cancel Subscription"})]})]},me.id)})})]})]})},Wne=()=>{const[e,n]=w.useState(""),[t,r]=w.useState(!0),[a,o]=w.useState(null);w.useEffect(()=>{(async()=>{try{const d=nh();if(!d)throw new Error("Authentication token not found.");const f=await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${d}`}})).json();n(f.gemini_api_key||"")}catch(d){console.error("Error fetching Gemini API key:",d),o({type:"error",text:"Failed to fetch Gemini API key."})}finally{r(!1)}})()},[]);const l=async()=>{r(!0),o(null);try{const h=nh();if(!h)throw new Error("Authentication token not found.");await ce("/api/super-admin-settings/gemini-api-key",{method:"PUT",headers:{Authorization:`Bearer ${h}`,"Content-Type":"application/json"},body:JSON.stringify({gemini_api_key:e})}),o({type:"success",text:"Gemini API key updated successfully!"})}catch(h){console.error("Error updating Gemini API key:",h),o({type:"error",text:"Failed to update Gemini API key."})}finally{r(!1)}};return i.jsxs("div",{className:"admin-panel-container",children:[i.jsxs("h1",{className:"admin-panel-title",children:[i.jsx(Km,{size:32,className:"icon-margin"}),"Super Admin Dashboard"]}),i.jsxs("div",{className:"admin-panel-grid",children:[i.jsxs(Hs,{to:"/dashboard/clinic-subscriptions",className:"admin-panel-card",children:[i.jsx(ag,{size:48,className:"card-icon"}),i.jsx("h2",{children:"Manage Clinic Subscription Plans"}),i.jsx("p",{children:"Add, edit, and view clinic subscription plans."})]}),i.jsxs(Hs,{to:"/dashboard/users",className:"admin-panel-card",children:[i.jsx(Zf,{size:48,className:"card-icon"}),i.jsx("h2",{children:"User Management"}),i.jsx("p",{children:"Add, edit, and delete users; manage user roles."})]}),i.jsxs("div",{className:"admin-panel-card",children:[i.jsx(BI,{size:48,className:"card-icon"}),i.jsx("h2",{children:"Global Gemini API Key"}),i.jsx("p",{children:"Set the global default Gemini API key."}),i.jsxs("div",{className:"flex flex-col mt-4",children:[i.jsx("input",{type:"password",value:e,onChange:h=>n(h.target.value),placeholder:"Enter Global Gemini API Key",className:"p-2 border border-gray-300 rounded mb-2",disabled:t}),i.jsx("button",{onClick:l,className:"bg-blue-500 text-white p-2 rounded hover:bg-blue-600 disabled:bg-blue-300",disabled:t,children:t?"Saving...":"Save Global API Key"}),a&&i.jsx("p",{className:`mt-2 text-sm ${a.type==="success"?"text-green-600":"text-red-600"}`,children:a.text})]})]})]})]})},Vx="tutorialCurrentStep",JE=({onActionComplete:e,onStaffAdded:n,requiredRole:t})=>{const[r,a]=w.useState(""),[o,l]=w.useState(""),[h,d]=w.useState(""),[u,f]=w.useState(!1),g=t||"receptionist";w.useEffect(()=>{a(t==="lab"?"Lab":t==="pharmacy"?"Pharmacy":"")},[t]);const b=async()=>{if(!r||!o||!h){e(!1,"Please fill all fields.");return}f(!0);try{const v=await ce("/api/staff",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,email:o,role:g,password:h})});if(v.ok)e(!0,`Successfully added "${r}" as a ${g}!`),a(""),l(""),d(""),n&&n(g);else{const S=await v.json();e(!1,`Failed to add staff: ${S.message||v.statusText}`)}}catch(v){console.error("Error adding staff:",v),e(!1,`Error adding staff: ${v instanceof Error?v.message:String(v)}`)}finally{f(!1)}};return i.jsxs("div",{className:"tutorial-interactive-component",children:[i.jsx("h3",{children:"Add a New Staff Member"}),i.jsx("input",{type:"text",placeholder:"Staff Name",value:r,onChange:v=>a(v.target.value),className:"tutorial-input",disabled:u}),i.jsx("input",{type:"email",placeholder:"Email",value:o,onChange:v=>l(v.target.value),className:"tutorial-input",disabled:u}),i.jsx("input",{type:"password",placeholder:"Password",value:h,onChange:v=>d(v.target.value),className:"tutorial-input",disabled:u}),i.jsx("input",{type:"text",placeholder:"Role",value:g==="lab"?"Lab Technician":g==="pharmacy"?"Pharmacist":"Receptionist",className:"tutorial-input",disabled:!0}),i.jsx("button",{onClick:b,className:"tutorial-button primary",disabled:u,children:u?"Adding...":"Add Staff"})]})},Qne=({onActionComplete:e})=>{const[n,t]=w.useState(!1),[r,a]=w.useState([]),[o,l]=w.useState(!1),h=async()=>{t(!0);try{const d=await ce("/api/drugs/import-defaults",{method:"POST"});if(d.ok){const u=await d.json(),f=u.drugs?u.drugs.map(g=>g.name):[];a(f),l(!0),e(!0,`Default medications imported: Added ${u.details.added}, Updated ${u.details.updated}.`,"pharmacyImport")}else{const u=await d.json();e(!1,`Failed to import default medications: ${u.message||d.statusText}`)}}catch(d){console.error("Error importing default medications:",d),e(!1,`Error importing default medications: ${d instanceof Error?d.message:String(d)}`)}finally{t(!1)}};return i.jsxs("div",{className:"tutorial-interactive-component",children:[i.jsx("h3",{children:"Import Default Medications"}),i.jsx("p",{children:"Click the button below to populate your pharmacy inventory with a list of common medications."}),i.jsx("button",{onClick:h,className:"tutorial-button primary",disabled:n,children:n?"Importing...":i.jsxs(i.Fragment,{children:[" ",i.jsx("i",{className:"fas fa-pills"})," Import Default Drugs"]})}),o&&r.length>0&&i.jsxs("div",{className:"imported-drugs-list",children:[i.jsx("h4",{children:"Medications Imported:"}),i.jsx("ul",{children:r.map((d,u)=>i.jsx("li",{children:d},u))})]})]})},Jne=({onActionComplete:e})=>{const[n,t]=w.useState(!1),[r,a]=w.useState([]),[o,l]=w.useState(!1),h=async()=>{t(!0);try{const d=await ce("/api/lab-tests/import-defaults",{method:"POST"});if(d.ok){const u=await d.json(),f=u.tests?u.tests.map(g=>g.name):[];a(f),l(!0),e(!0,`Default lab tests imported: Added ${u.details.added}, Updated ${u.details.updated}.`,"labImport")}else{const u=await d.json();e(!1,`Failed to import default lab tests: ${u.message||d.statusText}`)}}catch(d){console.error("Error importing default lab tests:",d),e(!1,`Error importing default lab tests: ${d instanceof Error?d.message:String(d)}`)}finally{t(!1)}};return i.jsxs("div",{className:"tutorial-interactive-component",children:[i.jsx("h3",{children:"Import Default Lab Tests"}),i.jsx("p",{children:"Click the button below to populate your lab test inventory with a list of common tests."}),i.jsx("button",{onClick:h,className:"tutorial-button primary",disabled:n,children:n?"Importing...":i.jsxs(i.Fragment,{children:[" ",i.jsx("i",{className:"fas fa-flask"})," Import Default Lab Tests"]})}),o&&r.length>0&&i.jsxs("div",{className:"imported-drugs-list",children:[i.jsx("h4",{children:"Tests Imported:"}),i.jsx("ul",{children:r.map((d,u)=>i.jsx("li",{children:d},u))})]})]})},KE=({onAutoSubmit:e})=>{const n=["John Doe, 45, Male. Severe chest pain for 2 hours, radiating to left arm.","Jane Smith, 28, Female. Throbbing headache with nausea and light sensitivity.","Sam, 60, Male. Frequent urination and excessive thirst for 2 weeks."],t=r=>{e&&e({complaint:r})};return i.jsxs("div",{className:"tutorial-interactive-component ai-setup-action",children:[i.jsxs("div",{className:"ai-setup-instruction",children:[i.jsxs("p",{children:["Providing details like ",i.jsx("strong",{children:"Name, Age, Sex, and Complaint"})," in a single sentence allows the AI to capture full patient context instantly."]}),i.jsx("p",{className:"select-prompt",children:"Select an example below to see it in action:"})]}),i.jsx("div",{className:"ai-examples-grid",children:n.map((r,a)=>i.jsxs("div",{className:"ai-example-card",onClick:()=>t(r),children:[i.jsx("div",{className:"example-header",children:i.jsxs("span",{className:"example-badge",children:["Example ",a+1]})}),i.jsx("p",{className:"example-preview",children:r})]},a))})]})},Wd=[{title:"Welcome to Your Admin Dashboard!",description:"This quick tour will guide you through essential features to get your clinic set up. We'll help you manage your pharmacy, lab, and staff in no time.",actionText:"Let's Start!",actionPath:null,component:null,icon:"fas fa-hospital"},{title:"Step 1: Manage Pharmacy Inventory",description:"Set up your pharmacy by adding drugs, managing stock levels, and importing default drug lists. This ensures smooth prescription fulfillment. Import default medications now!",actionText:"Go to Pharmacy Inventory",actionPath:"/dashboard/inventory",component:Qne,icon:"fas fa-pills"},{title:"Step 2: Manage Lab Test Inventory",description:"Configure your laboratory by adding available lab tests and importing default test lists. This is crucial for accurate diagnostics. Import default lab tests now!",actionText:"Go to Lab Test Inventory",actionPath:"/lab-inventory",component:Jne,icon:"fas fa-flask"},{title:"Step 3: Add Staff Members (Optional)",description:"You can add your clinic's staff, including doctors, receptionists, lab technicians, and pharmacists. Each role has specific permissions. You can skip this step for now.",actionText:"Go to Staff Management",actionPath:null,component:JE,icon:"fas fa-user-md"},{title:"You're All Set!",description:"Try the AI-powered complaint analysis! Pick an example below or enter patient details to see how the AI helps you manage records.",actionText:"Try the AI!",actionPath:"/edit-complaints",component:KE,icon:"fas fa-robot"}],Kne=({onClose:e,onMarkAsSeen:n})=>{const[t,r]=w.useState(()=>{const O=localStorage.getItem(Vx);return O?parseInt(O,10):0}),[a,o]=w.useState(null),[l,h]=w.useState(null),[d,u]=w.useState(!1),[f,g]=w.useState(null),[b,v]=w.useState(4),[S,T]=w.useState({complaint:""}),E=Ft();w.useEffect(()=>{if(localStorage.setItem(Vx,t.toString()),o(null),h(null),t===0){v(4);const O=setTimeout(()=>{r($=>$+1)},4e3),B=setInterval(()=>{v($=>$-1)},1e3);return()=>{clearTimeout(O),clearInterval(B)}}},[t]);const C=(O,B,$)=>{h(O),o(B),O&&($==="pharmacyImport"||$==="labImport")&&r(F=>F+1)},P=()=>{},I=async O=>{u(!0),g(null);const B=(O==null?void 0:O.complaint)||S.complaint;try{const $=await ce("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"New Patient - AI Entry",age:null,gender:null,phone:null,address:null})});if(!$.ok)throw new Error("Failed to create patient");const z=(await $.json()).id,U=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:z,complaint:B||""})});if(!U.ok)throw new Error("Failed to create queue entry");const ee=(await U.json()).id;E(`/dashboard/edit-complaint/${ee}`,{state:{initialMessage:B,patientId:z}}),e(),n(),localStorage.removeItem(Vx)}catch($){g($.message||"Failed to initialize AI setup. Please try again.")}finally{u(!1)}},q=async()=>{const O=Wd[t];if(t===Wd.length-1){I();return}else O.actionPath&&(E(O.actionPath),e(),t===Wd.length-1&&(n(),localStorage.removeItem(Vx)))},L=Wd[t];return i.jsx("div",{className:"tutorial-modal-overlay",children:i.jsxs("div",{className:"tutorial-modal-content",children:[i.jsxs("div",{className:"tutorial-step-indicator",children:["Step ",t+1," of ",Wd.length]}),i.jsx("div",{className:"tutorial-progress-container",children:i.jsx("div",{className:"tutorial-progress-bar",style:{width:`${(t+1)/Wd.length*100}%`}})}),i.jsxs("div",{className:"tutorial-body-scroll",children:[i.jsxs("div",{className:"tutorial-content-wrapper",children:[i.jsxs("div",{className:t===0?"tutorial-welcome-animation":"",children:[i.jsx("i",{className:`tutorial-step-icon ${L.icon}`}),i.jsx("h2",{children:L.title})]}),i.jsx("p",{children:L.description}),L.component&&i.jsxs("div",{className:"tutorial-interactive-area",children:[t===3?i.jsx(JE,{onActionComplete:C,onStaffAdded:P,requiredRole:null}):t===4?i.jsx(KE,{onActionComplete:C,onDataChange:T,onAutoSubmit:I}):i.jsx(L.component,{onActionComplete:C}),a&&i.jsxs("p",{className:`tutorial-message ${l?"success":"error"}`,children:[l?i.jsx("i",{className:"fas fa-check-circle",style:{marginRight:"8px"}}):i.jsx("i",{className:"fas fa-exclamation-circle",style:{marginRight:"8px"}}),a]})]}),f&&i.jsxs("p",{className:"tutorial-message error",children:[i.jsx("i",{className:"fas fa-exclamation-triangle",style:{marginRight:"8px"}})," ",f]})]},t),t===0&&i.jsxs("div",{className:"tutorial-countdown-indicator",children:[i.jsx("i",{className:"fas fa-clock"})," Next step in ",b,"s"]})]}),i.jsxs("div",{className:"tutorial-modal-actions",children:[t===3&&i.jsx("button",{onClick:()=>r(t+1),className:"tutorial-button secondary",children:"Next Step"}),L.actionPath&&t!==Wd.length-1&&i.jsx("button",{onClick:q,className:"tutorial-button action",disabled:d,children:d?i.jsxs(i.Fragment,{children:[i.jsx("i",{className:"fas fa-spinner fa-spin",style:{marginRight:"8px"}})," Creating..."]}):i.jsxs(i.Fragment,{children:[L.actionText," ",i.jsx("i",{className:"fas fa-arrow-right",style:{marginLeft:"8px"}})]})})]})]})})},Xne=(e,n,t)=>{const r=Math.abs(e.getTime()-n.getTime());return Math.ceil(r/(1e3*60*60*24))<=t},yC=e=>{if(e.match(/^\d{4}-\d{2}-\d{2}$/))return new Date(e);const n=e.split("/");if(n.length===3){const t=parseInt(n[0],10),r=parseInt(n[1],10)-1,a=parseInt(n[2],10),o=new Date(a,r,t),l=parseInt(n[0],10)-1,h=parseInt(n[1],10),d=parseInt(n[2],10),u=new Date(d,l,h),f=!isNaN(o.getTime()),g=!isNaN(u.getTime());if(f&&g)return o;if(f)return o;if(g)return u}return new Date(e)},XE=()=>{const[e,n]=w.useState([]),[t,r]=w.useState(!0),[a,o]=w.useState(null),[l,h]=w.useState(""),[d,u]=w.useState(""),[f,g]=w.useState(1),[b]=w.useState(10),v=new Date,S=Ft();w.useEffect(()=>{(async()=>{r(!0);try{const z=await ce("/api/pharmacy-orders/refill-reminders");if(z.ok){const U=await z.json();n(U)}else o("Failed to fetch refill reminders.")}catch{o("An error occurred while fetching data.")}finally{r(!1)}})()},[]);const T=$=>{h($.target.value),g(1)},E=$=>{u($.target.value),g(1)},C=e.filter($=>{const F=l?$.medicationRefillDates.some(U=>{const V=yC(U.refillDate);return!isNaN(V.getTime())&&V.toISOString().split("T")[0]===l}):!0,z=d?$.patientName.toLowerCase().includes(d.toLowerCase())||$.patientPhoneNumber.includes(d)||$.items.some(U=>U.name.toLowerCase().includes(d.toLowerCase())):!0;return F&&z}),P=f*b,I=P-b,q=C.slice(I,P),L=Math.ceil(C.length/b),O=$=>g($),B=async $=>{try{const F=await ce(`/api/queue/patient/${$}/latest`);if(F.ok){const U=await F.json();if(U!=null&&U._id){S(`/dashboard/edit-complaint/${U._id}`,{state:{patientId:$}});return}}const z=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:$})});if(z.ok){const U=await z.json();U!=null&&U.id&&S(`/dashboard/edit-complaint/${U.id}`,{state:{patientId:$}})}}catch(F){console.error("Error handling row click:",F),o("Failed to navigate to patient complaint.")}};return t?i.jsx("div",{children:"Loading..."}):a?i.jsx("div",{children:a}):i.jsxs("div",{className:"refill-reminders-container",children:[i.jsx("h1",{children:"Refill Reminders"}),i.jsxs("div",{className:"controls-container",children:[i.jsxs("div",{className:"filter-container",children:[i.jsx("label",{htmlFor:"refillDate",children:"Filter by Refill Date: "}),i.jsx("input",{type:"date",id:"refillDate",value:l,onChange:T})]}),i.jsxs("div",{className:"search-container",children:[i.jsx("label",{htmlFor:"search",children:"Search: "}),i.jsx("input",{type:"text",id:"search",placeholder:"Search by patient name, phone, or medication",value:d,onChange:E})]})]}),i.jsxs("table",{children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Patient Name"}),i.jsx("th",{children:"Patient Phone Number"}),i.jsx("th",{children:"Medications"}),i.jsx("th",{children:"Refill Dates"})]})}),i.jsx("tbody",{children:q.length>0?q.map($=>i.jsxs("tr",{onClick:()=>B($.patientId),style:{cursor:"pointer"},children:[i.jsx("td",{children:$.patientName}),i.jsx("td",{children:$.patientPhoneNumber}),i.jsxs("td",{children:[i.jsx("ul",{children:$.items.map((F,z)=>i.jsxs("li",{children:[F.name," (Qty: ",F.quantity,")",F.tabletsPerDay&&i.jsxs("span",{children:[" - ",F.tabletsPerDay," / day"]}),F.numberOfDays&&i.jsxs("span",{children:[" for ",F.numberOfDays," days"]})]},z))}),i.jsxs("div",{children:["Last Updated: ",new Date($.updatedAt).toLocaleDateString()]}),$.prescription_for_unavailable_drugs&&i.jsxs("div",{className:"unavailable-prescription",children:[i.jsx("strong",{children:"Unavailable:"})," ",$.prescription_for_unavailable_drugs]})]}),i.jsx("td",{children:i.jsx("ul",{children:$.medicationRefillDates.map((F,z)=>{const U=yC(F.refillDate),V=!isNaN(U.getTime())&&Xne(U,v,2);return i.jsxs("li",{className:V?"highlight-refill-date":"",children:[F.name,": ",isNaN(U.getTime())?"Invalid Date":U.toLocaleDateString()]},z)})})})]},$.id)):i.jsx("tr",{children:i.jsx("td",{colSpan:4,children:"No refill reminders found."})})})]}),i.jsxs("div",{className:"pagination-container",children:[i.jsx("button",{onClick:()=>O(f-1),disabled:f===1,children:"Previous"}),Array.from({length:L},($,F)=>i.jsx("button",{onClick:()=>O(F+1),className:f===F+1?"active":"",children:F+1},F+1)),i.jsx("button",{onClick:()=>O(f+1),disabled:f===L,children:"Next"})]})]})},Zne=()=>{const e=Ft(),n=$r();return w.useEffect(()=>{const t=new URLSearchParams(n.search),r=t.get("token"),a=t.get("caseDetails");r?(async()=>{try{const l=await ce(`/api/patients?search=${r}&limit=1`);if(!l.ok)throw new Error("Failed to fetch patient by token");const d=(await l.json()).patients[0];if(!d)throw new Error("Patient with the given token not found");const u=await ce(`/api/queue/patient/${d.id}/latest`);if(u.ok){const b=await u.json();if(b!=null&&b._id){e(`/dashboard/edit-complaint/${b._id}`,{state:{initialMessage:a,patientId:d.id}});return}}const f=await ce("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:d.id})});if(!f.ok)throw new Error("Failed to create queue entry");const g=await f.json();if(g!=null&&g.id)e(`/dashboard/edit-complaint/${g.id}`,{state:{initialMessage:a,patientId:d.id}});else throw new Error("Failed to get ID from new queue entry.")}catch(l){console.error("Error handling complaint URL:",l),e("/dashboard/search-patient")}})():e("/dashboard/search-patient")},[n,e]),i.jsx("div",{children:"Loading..."})},eie=()=>{const[e,n]=w.useState([]),[t,r]=w.useState(!0),[a,o]=w.useState(null),[l,h]=w.useState("all"),[d,u]=w.useState(""),f=w.useCallback(async()=>{r(!0),o(null);try{const T=await ce("/api/notifications?all=true");if(T.ok){const C=(await T.json()).sort((P,I)=>{const q={expired_drug:1,near_expiry_drug:2,low_stock:3},L=q[P.type]||99,O=q[I.type]||99;return L!==O?L-O:new Date(I.created_at).getTime()-new Date(P.created_at).getTime()});n(C)}else o("Failed to fetch notifications."),console.error("Failed to fetch notifications:",T.statusText)}catch(T){o("Error fetching notifications."),console.error("Error fetching notifications:",T)}finally{r(!1)}},[]);w.useEffect(()=>{f()},[f]);const g=async T=>{try{const E=await ce(`/api/notifications/${T}/read`,{method:"PUT"});E.ok?n(C=>C.map(P=>P.id===T?{...P,is_read:!0}:P)):console.error("Failed to mark notification as read:",E.statusText)}catch(E){console.error("Error marking notification as read:",E)}},b=async(T,E)=>{if(window.confirm("Are you sure you want to delete this drug from the inventory? This action cannot be undone."))try{const C=await ce(`/api/drugs/${T}`,{method:"DELETE"});if(C.ok)alert("Drug deleted successfully."),await g(E);else{const P=await C.json();alert(`Failed to delete drug: ${P.message||C.statusText}`)}}catch(C){console.error("Error deleting drug:",C),alert("An error occurred while trying to delete the drug.")}},v=async()=>{try{const T=e.filter(C=>!C.is_read).map(C=>C.id);if(T.length===0)return;const E=await ce("/api/notifications/mark-all-read",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({notificationIds:T})});E.ok?n(C=>C.map(P=>({...P,is_read:!0}))):console.error("Failed to mark all notifications as read:",E.statusText)}catch(T){console.error("Error marking all notifications as read:",T)}},S=e.filter(T=>{const E=T.message.toLowerCase().includes(d.toLowerCase()),C=l==="all"||l==="unread"&&!T.is_read||l==="expired"&&(T.type==="expired_drug"||T.type==="near_expiry_drug");return E&&C});return t?i.jsx("div",{className:"notifications-page-container",children:"Loading notifications..."}):a?i.jsx("div",{className:"notifications-page-container error-message",children:a}):i.jsxs("div",{className:"notifications-page-container",children:[i.jsx("h2",{className:"notifications-page-title",children:"All Notifications"}),i.jsxs("div",{className:"notifications-controls",children:[i.jsxs("div",{className:"filters-group",children:[i.jsx("input",{type:"text",placeholder:"Search notifications...",value:d,onChange:T=>u(T.target.value),className:"search-input"}),i.jsxs("select",{value:l,onChange:T=>h(T.target.value),className:"type-filter",children:[i.jsx("option",{value:"all",children:"All Notifications"}),i.jsx("option",{value:"unread",children:"Unread Only"}),i.jsx("option",{value:"expired",children:"Expiry Alerts"})]})]}),i.jsx("div",{className:"notifications-actions",children:i.jsx("button",{onClick:v,disabled:e.every(T=>T.is_read),className:"mark-all-read-button",children:"Mark All As Read"})})]}),S.length===0?i.jsx("p",{className:"no-notifications-message",children:"No notifications matching your criteria."}):i.jsx("ul",{className:"notifications-list",children:S.map(T=>i.jsxs("li",{className:`notification-item ${T.is_read?"read":"unread"}`,children:[i.jsxs("div",{className:"notification-main",children:[i.jsxs("div",{className:"notification-content",children:[i.jsx("span",{className:`notification-badge ${T.type}`,children:T.type.replace(/_/g," ")}),i.jsx("p",{className:"notification-message",children:T.message})]}),i.jsxs("div",{className:"notification-fix-actions",children:[(T.type==="expired_drug"||T.type==="near_expiry_drug")&&T.related_entity_id&&i.jsx("button",{onClick:()=>b(T.related_entity_id,T.id),className:"fix-button delete-drug",title:`Delete this ${T.type==="expired_drug"?"expired":"near expiry"} drug from inventory`,children:"Delete from Inventory"}),T.type==="low_stock"&&i.jsx("button",{className:"fix-button restock-drug",onClick:()=>window.location.href="/dashboard/inventory",children:"Restock"})]})]}),i.jsxs("div",{className:"notification-meta",children:[i.jsx("span",{className:"notification-timestamp",children:new Date(T.created_at).toLocaleString()}),!T.is_read&&i.jsx("button",{onClick:()=>g(T.id),className:"mark-read-button",children:"Mark as Read"})]})]},T.id))})]})},xC=()=>{const e=Ft(),[n,t]=w.useState([]),[r,a]=w.useState(!0),[o,l]=w.useState(null),[h,d]=w.useState(!1),[u,f]=w.useState(!1),[g,b]=w.useState(!1),[v,S]=w.useState(!1),[T,E]=w.useState(!1),[C,P]=w.useState(null),[I,q]=w.useState([]),[L,O]=w.useState(null),[B,$]=w.useState(""),[F,z]=w.useState(""),[U,V]=w.useState(""),[ee,ie]=w.useState(""),[ae,J]=w.useState(""),[K,W]=w.useState(""),[re,A]=w.useState(""),[te,xe]=w.useState(""),[M,Se]=w.useState(""),[$e,he]=w.useState(""),[ge,me]=w.useState(""),de=w.useCallback(async()=>{a(!0),l(null);try{const fe=await ce("/api/distributors");if(!fe.ok)throw new Error(`Failed to fetch distributors: ${fe.statusText}`);const Q=await fe.json();t(Q)}catch(fe){console.error("Failed to fetch distributors:",fe),l(fe.message||"Failed to load distributors.")}finally{a(!1)}},[]);w.useEffect(()=>{de()},[de]);const Le=async fe=>{fe.preventDefault(),l(null);try{const Q=await ce("/api/distributors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B,contact_person:F,phone:U,email:ee,address:ae,gst_number:K,drug_license_number:re})});if(!Q.ok){const ue=await Q.json();throw new Error(ue.message||"Failed to add distributor.")}alert("Distributor added successfully!"),rt(),de()}catch(Q){console.error("Error adding distributor:",Q),l(Q.message||"Failed to add distributor.")}},He=async fe=>{if(fe.preventDefault(),l(null),!!C)try{const Q=await ce(`/api/distributors/${C.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:B,contact_person:F,phone:U,email:ee,address:ae,gst_number:K,drug_license_number:re})});if(!Q.ok){const ue=await Q.json();throw new Error(ue.message||"Failed to update distributor.")}alert("Distributor updated successfully!"),je(),de()}catch(Q){console.error("Error updating distributor:",Q),l(Q.message||"Failed to update distributor.")}},pe=async()=>{if(l(null),!!C)try{const fe=await ce(`/api/distributors/${C.id}`,{method:"DELETE"});if(!fe.ok){const Q=await fe.json();throw new Error(Q.message||"Failed to delete distributor.")}alert("Distributor deleted successfully!"),ze(),de()}catch(fe){console.error("Error deleting distributor:",fe),l(fe.message||"Failed to delete distributor.")}},ne=w.useCallback(async fe=>{l(null);try{const Q=await ce(`/api/distributors/${fe}/payments`);if(!Q.ok)throw new Error(`Failed to fetch payments: ${Q.statusText}`);const De=(await Q.json()).map(Ne=>({...Ne,order_value:parseFloat(Ne.order_value),amount_paid:parseFloat(Ne.amount_paid),balance_remaining:parseFloat(Ne.balance_remaining)}));q(De);const Ge=await ce(`/api/distributors/${fe}/balance`);if(!Ge.ok)throw new Error(`Failed to fetch balance: ${Ge.statusText}`);const ye=await Ge.json();O({totalOrderValue:parseFloat(ye.totalOrderValue),totalAmountPaid:parseFloat(ye.totalAmountPaid),remainingBalance:parseFloat(ye.remainingBalance)})}catch(Q){console.error("Error fetching payments/balance:",Q),l(Q.message||"Failed to load payments or balance.")}},[]),Pe=async fe=>{if(fe.preventDefault(),l(null),!!C)try{const Q=await ce(`/api/distributors/${C.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:te,order_value:parseFloat(M||"0"),amount_paid:parseFloat($e||"0"),notes:ge})});if(!Q.ok){const ue=await Q.json();throw new Error(ue.message||"Failed to add payment.")}alert("Payment added successfully!"),ft(),ne(C.id)}catch(Q){console.error("Error adding payment:",Q),l(Q.message||"Failed to add payment.")}},Ye=()=>{$(""),z(""),V(""),ie(""),J(""),W(""),A(""),l(null),d(!0)},rt=()=>{d(!1)},ut=fe=>{P(fe),$(fe.name),z(fe.contact_person||""),V(fe.phone||""),ie(fe.email||""),J(fe.address||""),W(fe.gst_number||""),A(fe.drug_license_number||""),l(null),f(!0)},je=()=>{f(!1),P(null)},Qe=fe=>{P(fe),l(null),b(!0)},ze=()=>{b(!1),P(null)},dt=fe=>{P(fe),ne(fe.id),l(null),S(!0)},Ze=()=>{S(!1),P(null),q([]),O(null)},ct=fe=>{P(fe),xe(new Date().toISOString().split("T")[0]),Se("0"),he("0"),me(""),l(null),E(!0)},ft=()=>{E(!1),P(null)};return r?i.jsx("div",{className:"loading-indicator",children:"Loading Distributors..."}):o?i.jsxs("div",{className:"error-indicator",children:["Error: ",o]}):i.jsxs("div",{className:"distributor-management-page",children:[i.jsxs("div",{className:"distributor-management-header",children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[i.jsx("button",{onClick:()=>e(-1),className:"back-button",title:"Go Back",children:i.jsx(fn,{size:24})}),i.jsx("h2",{children:"Distributor Management"})]}),(()=>{const fe=n.reduce((ue,De)=>ue+parseFloat(De.remainingBalance||"0"),0),Q=fe>=0?"balance-positive":"balance-negative";return i.jsxs("div",{className:`total-balance-display ${Q}`,children:[i.jsx("strong",{children:"Total Combined Balance:"})," ",fe.toFixed(2)]})})(),i.jsxs("button",{onClick:Ye,className:"add-distributor-button",children:[i.jsx(gc,{size:18}),"Add New Distributor"]})]}),i.jsx("div",{className:"distributor-table-container",children:i.jsxs("table",{className:"distributor-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Contact Person"}),i.jsx("th",{children:"Phone"}),i.jsx("th",{children:"Email"}),i.jsx("th",{children:"Address"}),i.jsx("th",{children:"GST Number"})," ",i.jsx("th",{children:"Drug License Number"})," ",i.jsx("th",{children:"Remaining Balance"})," ",i.jsx("th",{className:"actions-cell",children:"Actions"})]})}),i.jsx("tbody",{children:n.length===0?i.jsxs("tr",{children:[i.jsx("td",{colSpan:9,className:"no-results-message",children:"No distributors found."})," "]}):n.map(fe=>i.jsxs("tr",{children:[i.jsx("td",{children:fe.name}),i.jsx("td",{children:fe.contact_person||"-"}),i.jsx("td",{children:fe.phone||"-"}),i.jsx("td",{children:fe.email||"-"}),i.jsx("td",{children:fe.address||"-"}),i.jsx("td",{children:fe.gst_number||"-"})," ",i.jsx("td",{children:fe.drug_license_number||"-"})," ",i.jsxs("td",{className:parseFloat(fe.remainingBalance||"0")>0?"balance-positive":"balance-negative",children:["",fe.remainingBalance||"0.00"]})," ",i.jsx("td",{className:"actions-cell",children:i.jsxs("div",{className:"actions-buttons-group",children:[i.jsxs("button",{onClick:()=>dt(fe),className:"action-text-button view-button",title:"View Payments & Balance",children:[i.jsx(sg,{size:16})," View Payments"]}),i.jsxs("button",{onClick:()=>ct(fe),className:"action-text-button add-payment-button",title:"Add Payment",children:[i.jsx(gc,{size:16})," Add Payment"]}),i.jsx("button",{onClick:()=>ut(fe),className:"action-icon-button edit-button",title:"Edit Distributor",children:i.jsx(eh,{size:16})}),i.jsx("button",{onClick:()=>Qe(fe),className:"action-icon-button delete-button",title:"Delete Distributor",children:i.jsx(Wi,{size:16})})]})})]},fe.id))})]})}),h&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:rt,className:"modal-close-button",children:""}),i.jsx("h3",{className:"modal-title",children:"Add New Distributor"}),o&&i.jsx("div",{className:"modal-error-message",children:o}),i.jsxs("form",{onSubmit:Le,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"name",children:"Name:"}),i.jsx("input",{type:"text",id:"name",value:B,onChange:fe=>$(fe.target.value),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"contact_person",children:"Contact Person:"}),i.jsx("input",{type:"text",id:"contact_person",value:F,onChange:fe=>z(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"phone",children:"Phone:"}),i.jsx("input",{type:"text",id:"phone",value:U,onChange:fe=>V(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"email",children:"Email:"}),i.jsx("input",{type:"email",id:"email",value:ee,onChange:fe=>ie(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"address",children:"Address:"}),i.jsx("textarea",{id:"address",value:ae,onChange:fe=>J(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"gst_number",children:"GST Number:"}),i.jsx("input",{type:"text",id:"gst_number",value:K,onChange:fe=>W(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"drug_license_number",children:"Drug License Number:"}),i.jsx("input",{type:"text",id:"drug_license_number",value:re,onChange:fe=>A(fe.target.value)})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:rt,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"submit",className:"button-submit",children:"Add Distributor"})]})]})]})}),u&&C&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:je,className:"modal-close-button",children:""}),i.jsx("h3",{className:"modal-title",children:"Edit Distributor"}),o&&i.jsx("div",{className:"modal-error-message",children:o}),i.jsxs("form",{onSubmit:He,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-name",children:"Name:"}),i.jsx("input",{type:"text",id:"edit-name",value:B,onChange:fe=>$(fe.target.value),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-contact_person",children:"Contact Person:"}),i.jsx("input",{type:"text",id:"edit-contact_person",value:F,onChange:fe=>z(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-phone",children:"Phone:"}),i.jsx("input",{type:"text",id:"edit-phone",value:U,onChange:fe=>V(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-email",children:"Email:"}),i.jsx("input",{type:"email",id:"edit-email",value:ee,onChange:fe=>ie(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-address",children:"Address:"}),i.jsx("textarea",{id:"edit-address",value:ae,onChange:fe=>J(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-gst_number",children:"GST Number:"}),i.jsx("input",{type:"text",id:"edit-gst_number",value:K,onChange:fe=>W(fe.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"edit-drug_license_number",children:"Drug License Number:"}),i.jsx("input",{type:"text",id:"edit-drug_license_number",value:re,onChange:fe=>A(fe.target.value)})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:je,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"submit",className:"button-submit",children:"Save Changes"})]})]})]})}),g&&C&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:ze,className:"modal-close-button",children:""}),i.jsx("h3",{className:"modal-title",children:"Confirm Delete"}),i.jsxs("p",{children:['Are you sure you want to delete distributor "',C.name,'"?']}),o&&i.jsx("div",{className:"modal-error-message",children:o}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:ze,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:pe,className:"button-delete",children:"Delete"})]})]})}),v&&C&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content large-modal",children:[i.jsx("button",{onClick:Ze,className:"modal-close-button",children:""}),i.jsxs("h3",{className:"modal-title",children:["Payments & Balance for ",C.name]}),o&&i.jsx("div",{className:"modal-error-message",children:o}),L&&i.jsxs("div",{className:"balance-summary",children:[i.jsxs("p",{children:[i.jsx("strong",{children:"Total Order Value:"})," ",L.totalOrderValue.toFixed(2)]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Total Amount Paid:"})," ",L.totalAmountPaid.toFixed(2)]}),i.jsxs("p",{children:[i.jsx("strong",{children:"Remaining Balance:"})," ",L.remainingBalance.toFixed(2)]})]}),i.jsx("h4",{children:"Payment History"}),I.length===0?i.jsx("p",{children:"No payments recorded for this distributor."}):i.jsx("div",{className:"table-responsive",children:i.jsxs("table",{className:"distributor-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Date"}),i.jsx("th",{children:"Order Value"}),i.jsx("th",{children:"Amount Paid"}),i.jsx("th",{children:"Balance Remaining"}),i.jsx("th",{children:"Notes"})]})}),i.jsx("tbody",{children:I.map(fe=>i.jsxs("tr",{children:[i.jsx("td",{children:new Date(fe.payment_date).toLocaleDateString()}),i.jsxs("td",{children:["",fe.order_value.toFixed(2)]}),i.jsxs("td",{children:["",fe.amount_paid.toFixed(2)]}),i.jsxs("td",{children:["",fe.balance_remaining.toFixed(2)]}),i.jsx("td",{children:fe.notes||"-"})]},fe.id))})]})}),i.jsx("div",{className:"modal-actions",children:i.jsx("button",{type:"button",onClick:Ze,className:"button-cancel",children:"Close"})})]})}),T&&C&&i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsx("button",{onClick:ft,className:"modal-close-button",children:""}),i.jsxs("h3",{className:"modal-title",children:["Add Payment for ",C.name]}),o&&i.jsx("div",{className:"modal-error-message",children:o}),i.jsxs("form",{onSubmit:Pe,children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"payment_date",children:"Payment Date:"}),i.jsx("input",{type:"date",id:"payment_date",value:te,onChange:fe=>xe(fe.target.value),required:!0})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"order_value",children:"Order Value:"}),i.jsx("input",{type:"number",id:"order_value",value:M,onChange:fe=>Se(fe.target.value),onBlur:fe=>{fe.target.value===""&&Se("0")},step:"0.01"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"amount_paid",children:"Amount Paid:"}),i.jsx("input",{type:"number",id:"amount_paid",value:$e,onChange:fe=>he(fe.target.value),onBlur:fe=>{fe.target.value===""&&he("0")},step:"0.01"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"payment_notes",children:"Notes:"}),i.jsx("textarea",{id:"payment_notes",value:ge,onChange:fe=>me(fe.target.value)})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:ft,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"submit",className:"button-submit",children:"Add Payment"})]})]})]})})]})},tie=({isOpen:e,onClose:n,excelHeaders:t,onConfirm:r,availableFields:a})=>{const[o,l]=w.useState({});if(w.useEffect(()=>{e&&d()},[e,t,a]),!e)return null;const h=(f,g)=>{l(b=>({...b,[f]:g}))},d=()=>{const f={};t.forEach(g=>{const b=a.map(S=>({name:S})),v=Jd(g,b);v&&(f[g]=v.name)}),l(f)},u=()=>{const f={};for(const g in o)o[g]&&o[g]!=="none"&&(f[g]=o[g]);r(f),n()};return i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content",children:[i.jsxs("div",{className:"modal-body",children:[i.jsx("button",{onClick:n,className:"modal-close-button",children:i.jsx(Sn,{size:20})}),i.jsx("h3",{className:"modal-title",children:"Match File Columns"}),i.jsx("p",{className:"modal-description",children:'Please match the columns from your uploaded file to the corresponding fields in the drug inventory. You can use the "Auto Match" button for suggestions.'}),i.jsx("div",{className:"modal-actions-top",children:i.jsx("button",{type:"button",onClick:d,className:"button-auto-match",children:"Auto Match"})}),i.jsxs("div",{className:"column-mapping-grid",children:[i.jsx("div",{className:"grid-header",children:"Excel Column"}),i.jsx("div",{className:"grid-header",children:"App Field"}),t.map((f,g)=>i.jsxs(Fn.Fragment,{children:[i.jsx("div",{className:"excel-header-cell",children:f}),i.jsx("div",{className:"app-field-cell",children:i.jsxs("select",{value:o[f]||"",onChange:b=>h(f,b.target.value),className:"app-field-select",children:[i.jsx("option",{value:"",children:"-- Select Field --"}),i.jsx("option",{value:"none",children:"None (Ignore Column)"}),a.map((b,v)=>i.jsxs("option",{value:b,children:[b==="name"?"Composition Name":b==="brand_name"?"Brand Name":b==="price"?"MRP":b==="buying_price"?"Rate":b==="unit"?"Pack":b==="batch"?"Batch":b==="hsn_code"?"HSN Code":b==="mfg"?"MFG":b==="loose_quantity"?"Loose":b.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase())," "]},v))]})})]},g))]})]}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",onClick:n,className:"button-cancel",children:"Cancel"}),i.jsx("button",{type:"button",onClick:u,className:"button-submit",children:"Confirm Mapping"})]})]})})},nie=({isOpen:e,onClose:n,onDrugAddedToPurchase:t})=>{const[r,a]=w.useState({name:"",composition:"",description:"",price:0,quantity_in_stock:0,unit:"",expiry_date:"",buying_price:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null}),[o,l]=w.useState(null),[h,d]=w.useState(!1),[u,f]=w.useState(!1),g=w.useRef(null),b=w.useRef(null),v=w.useRef(null);w.useEffect(()=>{e&&(a({name:"",composition:"",description:"",price:0,quantity_in_stock:0,unit:"",expiry_date:"",buying_price:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null}),l(null),d(!1),f(!1))},[e]),w.useEffect(()=>{const C=I=>{I.key==="Tab"&&b.current===document.activeElement&&(u||(f(!0),setTimeout(()=>{var q;(q=v.current)==null||q.focus()},0),I.preventDefault()))},P=I=>{g.current&&!g.current.contains(I.target)&&f(!1)};return document.addEventListener("keydown",C),document.addEventListener("mousedown",P),()=>{document.removeEventListener("keydown",C),document.removeEventListener("mousedown",P)}},[u]);const S=C=>{const{name:P,value:I}=C.target;a(q=>({...q,[P]:I}))},T=C=>{const{name:P,value:I}=C.target;a(I===""?q=>({...q,[P]:0}):q=>({...q,[P]:parseFloat(I)||0}))},E=C=>{if(C.preventDefault(),l(null),d(!0),r.price===void 0||r.quantity_in_stock===void 0){l("MRP and Stock Quantity are required."),d(!1);return}const P={...r,name:r.name===""?null:r.name,composition:r.composition===""?null:r.composition,buying_price:r.buying_price===0?null:r.buying_price,expiry_date:r.expiry_date===""?null:r.expiry_date,gst:r.gst===0?null:r.gst,margin:r.margin===0?null:r.margin,discount:r.discount===0?null:r.discount,brand_name:r.brand_name===""?null:r.brand_name,batch:r.batch===""?null:r.batch,hsn_code:r.hsn_code===""?null:r.hsn_code,mfg:r.mfg===""?null:r.mfg,loose:r.loose===0?null:r.loose};t(P),d(!1),n()};return e?i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"modal-content add-drug-form-container max-w-2xl mx-auto",children:[i.jsxs("div",{className:"add-drug-form-header",children:[i.jsx("h2",{children:"Add New Drug"}),i.jsx("button",{onClick:n,className:"cancel-button",title:"Close",children:i.jsx(Sn,{size:24})})]}),o&&i.jsx("div",{className:"error-message",children:o}),i.jsxs("form",{onSubmit:E,className:"add-drug-form",children:[i.jsxs("div",{className:"form-grid",children:[i.jsxs("div",{className:"sm-col-span-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"name",className:"form-label",children:"Composition Name"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),i.jsx("input",{type:"text",name:"name",id:"name",value:r.name||"",onChange:S,className:"custom-text-input mt-1",placeholder:"e.g., Paracetamol",tabIndex:1})]}),i.jsxs("div",{className:"sm-col-span-2",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"brand_name",className:"form-label",children:"Brand Name"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),i.jsx("input",{type:"text",name:"brand_name",id:"brand_name",value:r.brand_name||"",onChange:S,className:"custom-text-input mt-1",placeholder:"e.g., Calpol",tabIndex:2})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"price",className:"form-label",children:"MRP () *"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),i.jsx("input",{type:"number",name:"price",id:"price",required:!0,step:"0.01",min:"0",value:r.price??"",onChange:S,onBlur:T,className:"custom-text-input mt-1",placeholder:"e.g., 500",tabIndex:3})]}),i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("label",{htmlFor:"quantity_in_stock",className:"form-label",children:"Stock Quantity *"}),i.jsxs("div",{className:"relative ml-2 group",children:[i.jsx(qs,{size:16,className:"text-gray-400"}),i.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),i.jsx("input",{type:"number",name:"quantity_in_stock",id:"quantity_in_stock",required:!0,step:"1",min:"0",value:r.quantity_in_stock??"",onChange:S,onBlur:T,className:"custom-text-input mt-1",placeholder:"e.g., 5",tabIndex:4})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"unit",className:"form-label",children:"Pack (e.g., strip, bottle)"}),i.jsx("input",{type:"text",name:"unit",id:"unit",value:r.unit||"",onChange:S,className:"custom-text-input mt-1",placeholder:"e.g., strip, bottle",tabIndex:5})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"expiry_date",className:"form-label",children:"Expiry Date"}),i.jsx("input",{type:"date",name:"expiry_date",id:"expiry_date",value:r.expiry_date||"",onChange:S,className:"custom-text-input mt-1",tabIndex:6})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"box_number",className:"form-label",children:"Box Number"}),i.jsx("input",{type:"text",name:"box_number",id:"box_number",value:r.box_number||"",onChange:S,className:"custom-text-input mt-1",tabIndex:7})]}),i.jsxs("div",{className:"relative sm-col-span-2",ref:g,children:[i.jsx("button",{type:"button",onClick:()=>f(!u),className:"form-button w-full text-left",tabIndex:8,ref:b,children:"Others"}),u&&i.jsxs("div",{className:"others-fields-grid",children:[" ",i.jsxs("div",{className:"sm-col-span-2",children:[i.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),i.jsx("textarea",{name:"description",id:"description",rows:3,value:r.description||"",onChange:S,className:"custom-text-input mt-1",tabIndex:9})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"buying_price",className:"form-label",children:"Rate ()"}),i.jsx("input",{type:"number",name:"buying_price",id:"buying_price",step:"0.01",min:"0",value:r.buying_price??"",onChange:S,onBlur:T,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:10,ref:v})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"gst",className:"form-label",children:"GST (%)"}),i.jsx("input",{type:"number",name:"gst",id:"gst",step:"0.01",min:"0",max:"100",value:r.gst??"",onChange:S,onBlur:T,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:11})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"margin",className:"form-label",children:"Margin (%)"}),i.jsx("input",{type:"number",name:"margin",id:"margin",step:"0.01",min:"0",max:"100",value:r.margin??"",onChange:S,onBlur:T,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:12})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"discount",className:"form-label",children:"Discount (%)"}),i.jsx("input",{type:"number",name:"discount",id:"discount",step:"0.01",min:"0",max:"100",value:r.discount??"",onChange:S,onBlur:T,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:13})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"batch",className:"form-label",children:"Batch"}),i.jsx("input",{type:"text",name:"batch",id:"batch",value:r.batch||"",onChange:S,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:14})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"hsn_code",className:"form-label",children:"HSN Code"}),i.jsx("input",{type:"text",name:"hsn_code",id:"hsn_code",value:r.hsn_code||"",onChange:S,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:15})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"mfg",className:"form-label",children:"MFG"}),i.jsx("input",{type:"text",name:"mfg",id:"mfg",value:r.mfg||"",onChange:S,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:16})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"loose",className:"form-label",children:"Loose Quantity"}),i.jsx("input",{type:"number",name:"loose",id:"loose",step:"1",min:"0",value:r.loose??"",onChange:S,onBlur:T,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:17})]})]})]})]}),i.jsxs("div",{className:"form-actions",children:[i.jsx("button",{type:"button",onClick:n,disabled:h,className:"form-button cancel-form-button",tabIndex:18,children:"Cancel"}),i.jsx("button",{type:"submit",disabled:h,className:"form-button submit-form-button inline-flex justify-center",tabIndex:19,children:h?"Adding...":"Add Drug"})]})]})]})}):null},iie="gemini-3-flash-preview";async function rie(){const e=nh();if(!e)throw new Error("Authentication token not found. Please log in.");try{const t=await(await ce("/api/clinics/settings",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch clinic-specific Gemini API key, trying global fallback.",n)}try{const t=await(await ce("/api/super-admin-settings/gemini-api-key",{headers:{Authorization:`Bearer ${e}`}})).json();if(t.gemini_api_key)return t.gemini_api_key}catch(n){console.warn("Failed to fetch global Gemini API key.",n)}throw new Error("Gemini API key not found. Please contact your administrator.")}let Z0=null;async function aie(){if(!Z0){const e=await rie();Z0=new Sg({apiKey:e})}return Z0}const sie=`You are a helpful Purchase Assistant for a pharmacy/clinic. You help users manage their drug purchase entries.

**Your Capabilities:**
1. **Analyze Purchase Data:** Review items in the purchase table, identify duplicates, calculate totals, check margins.
2. **Update Rows:** Modify specific fields in purchase rows (price, quantity, GST, expiry, etc.)
3. **Batch Updates:** Apply changes to multiple existing rows at once (e.g., "set GST to 12% for all items")
4. **Add/Remove Rows:** Add new drug entries or remove existing ones. You can add multiple drugs at once using the \`batch_add_rows\` action.

**FIELD NAMES - VERY IMPORTANT:**
The following are the EXACT field names you must use in additions and updates. Pay careful attention:
- \`name\` = The DRUG NAME (e.g., "Paracetamol 500mg", "Amoxicillin 250mg") - This is the generic/medicine name
- \`brand_name\` = The BRAND NAME (e.g., "Crocin", "Dolo", "Mox") - This is the manufacturer's brand
- \`batch\` = Batch number
- \`expiry_date\` = Expiry date (YYYY-MM-DD format)
- \`quantity_in_stock\` = Quantity
- \`loose\` = Free/loose units
- \`unit\` = Unit type (e.g., "Tab", "Strip", "Bottle")
- \`buying_price\` = Buying/Purchase price
- \`price\` = MRP (selling price)
- \`discount\` = Discount percentage
- \`gst\` = GST percentage
- \`hsn_code\` = HSN code
- \`mfg\` = Manufacturer name
- \`box_number\` = Rack/Box location

**CRITICAL: When the user says "brand name" or "brand", use field \`brand_name\`. When they say "drug name" or "medicine name", use field \`name\`. NEVER confuse these two fields. If multiple drugs are present in an image or query, ALWAYS use \`batch_add_rows\` instead of multiple \`add_row\` calls.**

**IMPORTANT RULES:**
- Rows are identified by their **serialNumber** (1-indexed, shown in first column)
- When updating rows, only include fields that need to change
- For batch updates, provide an array of updates with serialNumber and fields to change
- Always confirm what action you're taking before executing

**Response Format:**
You MUST respond with a JSON object in one of these formats:

1. **Text Response** (for answers, questions, confirmations):
\`\`\`json
{ "response_type": "text", "content": "Your message here using markdown..." }
\`\`\`

2. **Update Single Row:**
\`\`\`json
{ 
  "response_type": "action", 
  "action_name": "update_row", 
  "parameters": { 
    "serialNumber": 1, 
    "updates": { "brand_name": "Dolo", "price": 150 }
  },
  "message": "Updated row 1: brand name to Dolo, MRP to 150"
}
\`\`\`

3. **Batch Update Multiple Existing Rows:**
\`\`\`json
{ 
  "response_type": "action", 
  "action_name": "batch_update_rows", 
  "parameters": { 
    "updates": [
      { "serialNumber": 1, "fields": { "gst": 12 } },
      { "serialNumber": 2, "fields": { "gst": 12 } }
    ]
  },
  "message": "Updated GST to 12% for rows 1 and 2"
}
\`\`\`

4. **Delete Row:**
\`\`\`json
{ 
  "response_type": "action", 
  "action_name": "delete_row", 
  "parameters": { "serialNumber": 2 },
  "message": "Deleted row 2"
}
\`\`\`

5. **Add Single Row:**
\`\`\`json
{ 
  "response_type": "action", 
  "action_name": "add_row", 
  "parameters": { 
    "name": "Paracetamol 500mg",
    "brand_name": "Dolo",
    "quantity_in_stock": 100,
    "buying_price": 25,
    "price": 35
  },
  "message": "Added Paracetamol 500mg (Brand: Dolo)"
}
\`\`\`

6. **Batch Add Multiple New Rows:**
\`\`\`json
{ 
  "response_type": "action", 
  "action_name": "batch_add_rows", 
  "parameters": { 
    "drugs": [
      { "name": "Drug A", "quantity_in_stock": 10, "price": 100 },
      { "name": "Drug B", "quantity_in_stock": 20, "price": 200 }
    ]
  },
  "message": "Added 2 new drugs to the table"
}
\`\`\`

7. **End Conversation:**
\`\`\`json
{ "response_type": "action", "action_name": "end_analysis", "content": "All done!" }
\`\`\`

ALWAYS respond with valid JSON wrapped in a code block.
`;async function oie(e){var b,v,S,T,E;const{query:n,purchaseRows:t,distributorName:r,totals:a,history:o=[],imageBase64:l,imageMimeType:h}=e;let d=`--- Current Purchase Context ---
`;d+=`Distributor: ${r||"Not selected"}
`,d+=`Total Items: ${a.itemCount}
`,d+=`Total Value: ${a.totalValue.toFixed(2)}

`,t.length>0?(d+=`--- Purchase Items (${t.length} rows) ---
`,d+=JSON.stringify(t,null,2)):d+=`No items in purchase table yet.
`;const u=`User Request: "${n}"

Analyze the data above and respond appropriately.`,f=[{text:d},{text:u}];l&&h&&f.push({inlineData:{mimeType:h,data:l}});const g=[{role:"user",parts:[{text:sie}]},...o.map(C=>({role:C.role==="model"?"model":"user",parts:[{text:C.content}]})),{role:"user",parts:f}];try{const C=await aie(),P={model:iie,contents:g,generationConfig:{responseMimeType:"application/json",temperature:.1}};console.log("Sending request to Gemini with image:",!!l);const I=await C.models.generateContentStream(P);let q="";for await(const L of I){let O="";typeof L.text=="string"?O=L.text:typeof L.text=="function"?O=L.text():(E=(T=(S=(v=(b=L.candidates)==null?void 0:b[0])==null?void 0:v.content)==null?void 0:S.parts)==null?void 0:T[0])!=null&&E.text&&(O=L.candidates[0].content.parts[0].text),O&&(q+=O)}console.log("Raw Gemini Response:",q);try{const L=q.replace(/```json/g,"").replace(/```/g,"").trim(),O=JSON.parse(L);return console.log("Parsed Gemini JSON:",O),O}catch(L){return console.warn("Failed to parse Gemini JSON response for purchase:",L),{response_type:"text",content:q}}}catch(C){throw console.error("Purchase AI Error:",C),new Error(C.message||"Failed to generate response.")}}const lie=e=>{if(!e)return null;const n=String(e).trim().toLowerCase();if(!n)return null;const t={jan:"01",feb:"02",mar:"03",apr:"04",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",oct:"10",nov:"11",dec:"12",january:"01",february:"02",march:"03",april:"04",june:"06",july:"07",august:"08",september:"09",october:"10",november:"11",december:"12"};let r,a,o;const l=n.match(/^(\d{1,2})[\s\-./]*([a-z]{3})[a-z]*[\s\-./]*(\d{2,4})$/),h=n.match(/^([a-z]{3})[a-z]*[\s\-./]*(\d{1,2})[\s\-./]*(\d{2,4})$/),d=n.match(/^(\d{1,2})[\s\-./]+(\d{1,2})[\s\-./]+(\d{2,4})$/);if(l)r=l[1],a=t[l[2].substring(0,3)],o=l[3];else if(h)a=t[h[1].substring(0,3)],r=h[2],o=h[3];else if(d)r=d[1],a=d[2],o=d[3];else{const f=Date.parse(n);return isNaN(f)?null:new Date(f).toISOString().split("T")[0]}if(!r||!a||!o)return null;o.length===2&&(o=(parseInt(o)<50?"20":"19")+o),r=r.padStart(2,"0"),a=a.padStart(2,"0");const u=new Date(parseInt(o),parseInt(a)-1,parseInt(r));return u.getFullYear()===parseInt(o)&&u.getMonth()===parseInt(a)-1&&u.getDate()===parseInt(r)?`${o}-${a}-${r}`:null},cie=({purchaseRows:e,onCellChange:n,onRemoveDrug:t,onAddEmptyRow:r,lastAddMethod:a})=>{const o=w.useRef(new Map),[l,h]=w.useState(e.length);w.useEffect(()=>{var u;if(e.length>l&&a==="manual"){const f=e.length-1;(u=o.current.get(`${f}-name`))==null||u.focus()}h(e.length)},[e.length,l,a]);const d=(u,f,g)=>{const b=f===e.length-1;b&&u.key==="Enter"&&(u.preventDefault(),r()),b&&u.key==="Tab"&&g==="box_number"&&!u.shiftKey&&(u.preventDefault(),r())};return i.jsxs("table",{className:"data-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{style:{width:"40px"},children:"#"}),i.jsx("th",{style:{minWidth:"180px"},children:"Drug Name"}),i.jsx("th",{style:{minWidth:"120px"},children:"Brand"}),i.jsx("th",{style:{minWidth:"100px"},children:"Batch"}),i.jsx("th",{style:{minWidth:"130px"},children:"Expiry"}),i.jsx("th",{style:{minWidth:"70px"},children:"Qty"}),i.jsx("th",{style:{minWidth:"70px"},children:"Free"}),i.jsx("th",{style:{minWidth:"70px"},children:"Unit"}),i.jsx("th",{style:{minWidth:"90px"},children:"Buy "}),i.jsx("th",{style:{minWidth:"90px"},children:"MRP "}),i.jsx("th",{style:{minWidth:"60px"},children:"Disc%"}),i.jsx("th",{style:{minWidth:"60px"},children:"GST%"}),i.jsx("th",{style:{minWidth:"70px"},children:"Mrgn%"}),i.jsx("th",{style:{minWidth:"80px"},children:"HSN"}),i.jsx("th",{style:{minWidth:"80px"},children:"Mfg"}),i.jsx("th",{style:{minWidth:"80px"},children:"Rack"}),i.jsx("th",{className:"sticky-col-right",style:{width:"50px",textAlign:"center"},children:i.jsx(Wi,{size:16})})]})}),i.jsx("tbody",{children:e.map((u,f)=>i.jsxs("tr",{children:[i.jsx("td",{style:{textAlign:"center",color:"var(--text-tertiary)",fontWeight:600,fontSize:"0.85rem"},children:f+1}),i.jsx("td",{children:i.jsx("input",{ref:g=>{o.current.set(`${f}-name`,g)},className:"table-input",value:u.name||"",placeholder:"Name",onChange:g=>n(g,u.id||"","name"),onKeyDown:g=>d(g,f,"name"),autoComplete:"off"})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.brand_name||"",placeholder:"Brand",onChange:g=>n(g,u.id||"","brand_name"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.batch||"",placeholder:"Batch",onChange:g=>n(g,u.id||"","batch"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"date",className:"table-input",value:u.expiry_date||"",onChange:g=>n(g,u.id||"","expiry_date"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.quantity_in_stock??"",placeholder:"0",onChange:g=>n(g,u.id||"","quantity_in_stock"),onBlur:g=>n(g,u.id||"","quantity_in_stock"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.loose??"",placeholder:"0",onChange:g=>n(g,u.id||"","loose"),onBlur:g=>n(g,u.id||"","loose"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.unit||"",placeholder:"Tab/Strip",onChange:g=>n(g,u.id||"","unit"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.buying_price??"",placeholder:"0.00",onChange:g=>n(g,u.id||"","buying_price"),onBlur:g=>n(g,u.id||"","buying_price"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.price??"",placeholder:"0.00",onChange:g=>n(g,u.id||"","price"),onBlur:g=>n(g,u.id||"","price"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.discount??"",placeholder:"0",onChange:g=>n(g,u.id||"","discount"),onBlur:g=>n(g,u.id||"","discount"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.gst??"",placeholder:"5",onChange:g=>n(g,u.id||"","gst"),onBlur:g=>n(g,u.id||"","gst"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{type:"number",className:"table-input",value:u.margin||"",placeholder:"0",onChange:g=>n(g,u.id||"","margin"),onKeyDown:g=>d(g,f),readOnly:!0,style:{color:"var(--secondary)",fontWeight:"bold",cursor:"default"}})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.hsn_code||"",placeholder:"HSN",onChange:g=>n(g,u.id||"","hsn_code"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.mfg||"",placeholder:"Mfg",onChange:g=>n(g,u.id||"","mfg"),onKeyDown:g=>d(g,f)})}),i.jsx("td",{children:i.jsx("input",{className:"table-input",value:u.box_number||"",placeholder:"Rack",onChange:g=>n(g,u.id||"","box_number"),onKeyDown:g=>d(g,f,"box_number")})}),i.jsx("td",{className:"sticky-col-right",style:{textAlign:"center"},children:i.jsx("button",{onClick:()=>t(u.id||""),className:"delete-row-btn",tabIndex:-1,title:"Remove Row",children:i.jsx(Wi,{size:16})})})]},u.id))})]})},bC=()=>{const e=Ft(),[,n]=w.useState(!1),t=w.useRef(null),[r,a]=w.useState(""),[o,l]=w.useState([]),[h,d]=w.useState(null),[u,f]=w.useState(!1),g=w.useRef(null),[b,v]=w.useState(!1),[S,T]=w.useState(!1),[E,C]=w.useState([]),[P,I]=w.useState(null),[q,L]=w.useState(null),[O,B]=w.useState(0),[$,F]=w.useState([]),[z,U]=w.useState("manual"),V=["name","description","price","quantity_in_stock","unit","supplier","expiry_date","buying_price","box_number","gst","margin","discount","brand_name","batch","hsn_code","mfg","loose"],[ee,ie]=w.useState(!1),[ae,J]=w.useState([]),[K,W]=w.useState(""),[re,A]=w.useState(!1),te=w.useRef(null),xe=w.useRef(null),M=w.useRef(null),[Se,$e]=w.useState(null),[he,ge]=w.useState([]),me=()=>{var fe;(fe=te.current)==null||fe.scrollIntoView({behavior:"smooth"})};w.useEffect(()=>{me()},[ae,ee]);const de=w.useCallback((fe,Q="manual")=>{const ue=fe||(h?h.name:"");U(Q),F(De=>[...De,{id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:"",composition:"",description:"",price:0,quantity_in_stock:0,unit:"",supplier:ue,expiry_date:"",buying_price:0,box_number:"",gst:5,margin:0,discount:0,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:0,last_updated:"",created_at:""}])},[h]),Le=fe=>F(Q=>Q.filter(ue=>ue.id!==fe)),He=(fe,Q,ue)=>{const{value:De}=fe.target;F(Ge=>(Ge.findIndex(Ne=>Ne.id===Q)===Ge.length-1&&De.trim()!==""&&setTimeout(()=>de(void 0,"auto"),0),Ge.map(Ne=>{if(Ne.id===Q){let Me=De;["price","quantity_in_stock","buying_price","gst","margin","discount","loose"].includes(ue)?fe.type==="blur"?Me=parseFloat(De)||0:Me=De:ue==="expiry_date"&&(Me=De.trim()===""?null:De);const Fe={...Ne,[ue]:Me};if(h&&(Fe.supplier=h.name),["buying_price","price","gst"].includes(ue)){const ve=Number(ue==="buying_price"?Me:Fe.buying_price),ke=Number(ue==="price"?Me:Fe.price),Ee=Number(ue==="gst"?Me:Fe.gst);if(ke&&ke>0&&ve!==void 0&&ve!==null){const Ve=ve*(1+(Ee||0)/100);Fe.margin=parseFloat(((ke-Ve)/ke*100).toFixed(2))}}return Fe}return Ne})))},pe=w.useCallback(()=>$.reduce((fe,Q)=>{const ue=Number(Q.quantity_in_stock)||0,De=Number(Q.buying_price)||0,Ge=Number(Q.gst)||0,ye=Number(Q.discount)||0;let Ne=De*(1-ye/100),Me=ue*Ne;return Me+=Me*(Ge/100),fe+Me},0),[$]),ne=async()=>{if(!h){L("Select a distributor.");return}const fe=$.filter(Q=>Q.name&&Q.name.trim()!==""||Number(Q.buying_price)>0);if(fe.length===0){L("No valid items.");return}n(!0),L(null),ko.addRequest();try{for(const De of fe){const Ge={...De,price:Number(De.price),quantity_in_stock:Number(De.quantity_in_stock),buying_price:Number(De.buying_price),gst:Number(De.gst),margin:Number(De.margin),discount:Number(De.discount),loose:Number(De.loose),supplier:h.name,expiry_date:De.expiry_date||null,distributorId:h.id};if(!(await ce("/api/drugs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ge)})).ok)throw new Error(`Failed to add ${De.name}`)}const Q=pe();if(!(await ce(`/api/distributors/${h.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:new Date().toISOString().split("T")[0],order_value:Q,amount_paid:O,notes:`Purchase - ${fe.length} items`})})).ok)throw new Error("Payment record failed.");F([]),d(null),a(""),B(0),alert("Success!"),e("/dashboard/inventory")}catch(Q){L(Q.message||"Failed.")}finally{n(!1),ko.removeRequest()}},Pe=async fe=>{var De,Ge;const Q=(De=fe.target.files)==null?void 0:De[0];if(!Q)return;n(!0),ko.addRequest(),L(null),I(Q);const ue=(Ge=Q.name.split(".").pop())==null?void 0:Ge.toLowerCase();if(["xlsx","xls","csv"].includes(ue||"")){const ye=new FormData;ye.append("inventoryFile",Q);try{const Ne=await ce("/api/drugs/get-file-headers",{method:"POST",body:ye});if(!Ne.ok)throw new Error("Failed headers");const{headers:Me}=await Ne.json();C(Me),v(!0)}catch(Ne){L(Ne.message),I(null)}finally{n(!1),ko.removeRequest()}}else if(["pdf","png","jpg","jpeg"].includes(ue||"")){const ye=new FormData;ye.append("file",Q),ye.append("output_type","csv");const Ne="00841ac4-b279-11f0-ab55-0a3a41e3fad1";try{const Me=await fetch("https://extraction-api.nanonets.com/extract",{method:"POST",headers:{Authorization:`Bearer ${Ne}`},body:ye});if(!Me.ok)throw new Error("OCR Failed");const Fe=await Me.json();if(!Fe.success||!Fe.content)throw new Error("No data from OCR");let ve=Fe.content.split(`
`).filter(vt=>!vt.startsWith("#")&&vt.trim()).join(`
`);const ke=new File([ve],"ocr.csv",{type:"text/csv"}),Ee=new FormData;Ee.append("inventoryFile",ke);const Ve=await ce("/api/drugs/get-file-headers",{method:"POST",body:Ee});if(!Ve.ok)throw new Error("Failed parsing OCR CSV");const{headers:Ke}=await Ve.json();C(Ke),I(ke),v(!0)}catch(Me){L(Me.message),I(null)}finally{n(!1),ko.removeRequest()}}else L("Unsupported file"),n(!1),ko.removeRequest()},Ye=async fe=>{if(!P)return;n(!0),ko.addRequest();const Q=new FormData;Q.append("inventoryFile",P),Q.append("columnMapping",JSON.stringify(fe));try{const ue=await ce("/api/drugs/parse-excel",{method:"POST",body:Q});if(!ue.ok)throw new Error("Parse Failed");const Ge=(await ue.json()).map(ye=>({...ye,id:Date.now().toString()+Math.random(),supplier:(h==null?void 0:h.name)||ye.supplier,expiry_date:lie(ye.expiry_date)}));F(ye=>[...ye,...Ge])}catch(ue){L(ue.message)}finally{n(!1),ko.removeRequest(),v(!1),t.current&&(t.current.value="")}},rt=w.useCallback(async fe=>{const Q=fe.trim()===""?"/api/distributors":`/api/distributors?search=${encodeURIComponent(fe)}`;try{const ue=await ce(Q);if(ue.ok){const De=await ue.json();l(fe.trim()===""?De.slice(0,4):De)}}catch(ue){console.error(ue)}},[]),ut=fe=>{const Q=fe.target.value;a(Q),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{rt(Q),f(!0)},300)},je=()=>{r.trim()===""&&rt(""),f(!0)},Qe=fe=>{d(fe),a(""),f(!1),l([]),F(Q=>Q.map(ue=>({...ue,supplier:fe.name}))),$.length===0&&de(fe.name,"manual")},ze=()=>$.map((fe,Q)=>({serialNumber:Q+1,name:fe.name||"",brand_name:fe.brand_name||void 0,batch:fe.batch||void 0,expiry_date:fe.expiry_date||void 0,quantity_in_stock:Number(fe.quantity_in_stock)||0,loose:Number(fe.loose)||0,unit:fe.unit||void 0,buying_price:Number(fe.buying_price)||0,price:Number(fe.price)||0,discount:Number(fe.discount)||0,gst:Number(fe.gst)||0,margin:Number(fe.margin)||0,hsn_code:fe.hsn_code||void 0,mfg:fe.mfg||void 0,box_number:fe.box_number||void 0})),dt=async fe=>{let Q=fe,ue=0;const De=5;let Ge=[...he];try{for(;ue<De;){console.log("Building AI payload. Image present:",!!Se);const ye={query:Q,purchaseRows:ze(),distributorName:h==null?void 0:h.name,totals:{itemCount:$.length,totalValue:pe()},history:Ge,imageBase64:Se==null?void 0:Se.base64,imageMimeType:Se==null?void 0:Se.mimeType};console.log("Calling generatePurchaseSuggestion...");const Ne=await oie(ye);if(console.log("AI Response received:",Ne.response_type),Ne.response_type==="action"){const Me=Ne.action_name,Fe=Ne.message||"";if(Me==="update_row"){const{serialNumber:ve,updates:ke}=Ne.parameters,Ee=ve-1;Ee>=0&&Ee<$.length?(F(Ve=>Ve.map((Ke,vt)=>vt===Ee?{...Ke,...ke}:Ke)),J(Ve=>[...Ve,{role:"ai",content:` ${Fe}`}])):J(Ve=>[...Ve,{role:"ai",content:` Row ${ve} not found.`}]),Ge.push({role:"model",content:JSON.stringify(Ne)});break}else if(Me==="batch_update_rows"){const{updates:ve}=Ne.parameters;F(ke=>{const Ee=[...ke];return ve.forEach(Ve=>{const Ke=Ve.serialNumber-1;Ke>=0&&Ke<Ee.length&&(Ee[Ke]={...Ee[Ke],...Ve.fields})}),Ee}),J(ke=>[...ke,{role:"ai",content:` ${Fe}`}]),Ge.push({role:"model",content:JSON.stringify(Ne)});break}else if(Me==="delete_row"){const{serialNumber:ve}=Ne.parameters,ke=ve-1;if(ke>=0&&ke<$.length){const Ee=$[ke].id;Ee&&Le(Ee),J(Ve=>[...Ve,{role:"ai",content:` ${Fe}`}])}else J(Ee=>[...Ee,{role:"ai",content:` Row ${ve} not found.`}]);Ge.push({role:"model",content:JSON.stringify(Ne)});break}else if(Me==="add_row"){const ve=Ne.parameters;F(ke=>[...ke,{id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:ve.name||"",composition:"",description:"",price:ve.price||0,quantity_in_stock:ve.quantity_in_stock||0,unit:ve.unit||"",supplier:(h==null?void 0:h.name)||"",expiry_date:ve.expiry_date||"",buying_price:ve.buying_price||0,box_number:ve.box_number||"",gst:ve.gst||5,margin:0,discount:0,brand_name:ve.brand_name||"",batch:ve.batch||"",hsn_code:ve.hsn_code||"",mfg:ve.mfg||"",loose:0,last_updated:"",created_at:""}]),J(ke=>[...ke,{role:"ai",content:` ${Fe}`}]),setTimeout(()=>{var ke;(ke=xe.current)==null||ke.scrollIntoView({behavior:"smooth",block:"end"})},100),Ge.push({role:"model",content:JSON.stringify(Ne)});break}else if(Me==="batch_add_rows"){const{drugs:ve}=Ne.parameters;F(ke=>{const Ee=ve.map(Ve=>({id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:Ve.name||"",composition:"",description:"",price:Ve.price||0,quantity_in_stock:Ve.quantity_in_stock||0,unit:Ve.unit||"",supplier:(h==null?void 0:h.name)||"",expiry_date:Ve.expiry_date||"",buying_price:Ve.buying_price||0,box_number:Ve.box_number||"",gst:Ve.gst||5,margin:0,discount:0,brand_name:Ve.brand_name||"",batch:Ve.batch||"",hsn_code:Ve.hsn_code||"",mfg:Ve.mfg||"",loose:0,last_updated:"",created_at:""}));return[...ke,...Ee]}),J(ke=>[...ke,{role:"ai",content:` ${Fe}`}]),setTimeout(()=>{var ke;(ke=xe.current)==null||ke.scrollIntoView({behavior:"smooth",block:"end"})},100),Ge.push({role:"model",content:JSON.stringify(Ne)});break}else if(Me==="end_analysis"){Ne.content&&J(ve=>[...ve,{role:"ai",content:Ne.content}]);break}ue++}else{J(Me=>[...Me,{role:"ai",content:Ne.content||"I'm here to help!"}]),Ge.push({role:"model",content:JSON.stringify(Ne)});break}}ge(Ge)}catch(ye){console.error("AI Loop Error:",ye),J(Ne=>[...Ne,{role:"ai",content:"I encountered an error. Please try again."}])}},Ze=async()=>{if(!K.trim()&&!Se)return;const fe=K,Q=Se==null?void 0:Se.preview,ue=Q?`${fe}

 [Image attached]`:fe;J(De=>[...De,{role:"user",content:ue}]),ge(De=>[...De,{role:"user",content:fe||(Q?"Analyze this image":"")}]),W(""),A(!0),await dt(fe||"Analyze this image"),$e(null),A(!1)},ct=fe=>{var De;const Q=(De=fe.target.files)==null?void 0:De[0];if(!Q)return;const ue=new FileReader;ue.onload=()=>{const Ge=ue.result,ye=Ge.split(",")[1];$e({base64:ye,mimeType:Q.type,preview:Ge})},ue.readAsDataURL(Q),M.current&&(M.current.value="")},ft=()=>{J([]),W("")};return i.jsxs("div",{className:"purchase-page",children:[i.jsx("div",{className:"purchase-header",children:i.jsxs("div",{className:"header-left",children:[i.jsx("button",{onClick:()=>e(-1),className:"icon-btn",children:i.jsx(fn,{size:20})}),i.jsx("h2",{className:"purchase-page-title",children:"New Purchase"})]})}),q&&i.jsxs("div",{className:"error-banner",style:{background:"var(--danger-bg)",color:"var(--danger)",padding:"12px",borderRadius:"8px",marginBottom:"20px",display:"flex",gap:"10px"},children:[i.jsx(mi,{size:20}),i.jsx("span",{children:q})]}),i.jsxs("div",{className:"purchase-controls-grid",children:[i.jsxs("div",{className:"control-card",children:[i.jsxs("div",{className:"card-header",children:[i.jsxs("h3",{children:[i.jsx(UM,{size:20,className:"card-icon"})," Distributor"]}),i.jsxs("button",{onClick:()=>e("/dashboard/distributors"),className:"icon-btn",style:{width:"auto",borderRadius:"6px",fontSize:"0.8rem",padding:"6px 12px"},children:[i.jsx(Zf,{size:16})," Manage"]})]}),h?i.jsxs("div",{className:"selected-distributor-card",children:[i.jsxs("div",{children:[i.jsx("strong",{children:h.name}),i.jsx("br",{}),i.jsx("span",{style:{opacity:.8},children:h.contact_person})]}),i.jsx("button",{onClick:()=>d(null),style:{background:"none",border:"none",color:"var(--primary)",fontWeight:"bold",cursor:"pointer"},children:"Change"})]}):i.jsxs("div",{className:"distributor-search-wrapper",children:[i.jsxs("div",{className:"search-input-group",children:[i.jsx(Pi,{size:18,className:"search-input-icon"}),i.jsx("input",{className:"distributor-input",placeholder:"Search...",value:r,onChange:ut,onFocus:je})]}),u&&o.length>0&&i.jsx("ul",{className:"search-dropdown",children:o.map(fe=>i.jsx("li",{onClick:()=>Qe(fe),children:fe.name},fe.id))})]})]}),i.jsxs("div",{className:"control-card",children:[i.jsx("div",{className:"card-header",children:i.jsxs("h3",{children:[i.jsx(VM,{size:20,className:"card-icon"})," Import & Actions"]})}),i.jsxs("div",{className:"action-buttons-row",children:[i.jsx("input",{ref:t,type:"file",hidden:!0,accept:".xlsx,.xls,.csv,.pdf,.png,.jpg",onChange:Pe}),i.jsxs("button",{onClick:()=>{var fe;return(fe=t.current)==null?void 0:fe.click()},disabled:!h,className:"btn-base btn-primary",children:[i.jsx(ds,{size:18})," Import File"]}),i.jsxs("button",{onClick:()=>T(!0),disabled:!h,className:"btn-base btn-manual",children:[i.jsx(Pl,{size:18})," Manual"]})]}),i.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-tertiary)",marginTop:"8px",textAlign:"center"},children:"Supports Excel, CSV, PDF, Images"})]})]}),i.jsx(tie,{isOpen:b,onClose:()=>v(!1),excelHeaders:E,onConfirm:Ye,availableFields:V}),S&&i.jsx(nie,{isOpen:S,onClose:()=>T(!1),onDrugAddedToPurchase:fe=>{F(Q=>[...Q,{...fe,id:Date.now().toString(),supplier:(h==null?void 0:h.name)||""}]),T(!1)}}),i.jsxs("div",{className:"table-container",children:[i.jsx("div",{className:"table-header-title",children:i.jsxs("h3",{children:["Items (",$.length,")"]})}),i.jsx("div",{className:"table-scroll-wrapper",children:i.jsx(cie,{purchaseRows:$,onCellChange:He,onRemoveDrug:Le,onAddEmptyRow:()=>de(void 0,"manual"),lastAddMethod:z})}),$.length===0&&i.jsx("div",{style:{padding:"40px",textAlign:"center",color:"var(--text-tertiary)"},children:"Select distributor to start."})]}),i.jsxs("div",{className:"purchase-footer",children:[i.jsxs("button",{onClick:()=>de(void 0,"manual"),className:"btn-base btn-secondary",style:{width:"auto",flex:0},children:[i.jsx(Pl,{size:16})," Add Row"]}),i.jsxs("div",{className:"footer-right",children:[i.jsxs("div",{className:"financial-input-group",children:[i.jsx("label",{children:"Paid:"}),i.jsx("input",{type:"number",value:O,onChange:fe=>B(parseFloat(fe.target.value)||0),className:"amount-paid-input"})]}),i.jsxs("div",{className:"total-display",children:[i.jsx("span",{children:"Total"}),i.jsxs("span",{className:"total-value",children:["",pe().toFixed(2)]})]}),i.jsxs("button",{onClick:ne,className:"submit-btn success",disabled:$.length===0,children:[i.jsx(Vs,{size:20,className:"btn-icon"}),"Submit Purchase"]})]})]}),i.jsxs("div",{className:`${Tt.chatWidget} ${ee?Tt.chatOpen:""}`,style:{bottom:"5.5rem"},children:[!ee&&i.jsxs("button",{className:Tt.chatToggleBtn,onClick:()=>ie(!0),children:[i.jsx(cs,{size:24}),i.jsx("span",{className:Tt.chatToggleText,children:"Ask AI Assistant"})]}),ee&&i.jsxs("div",{className:Tt.chatWindow,children:[i.jsxs("div",{className:Tt.chatHeader,children:[i.jsxs("div",{className:Tt.chatHeaderTitle,children:[i.jsx(cs,{size:22}),i.jsx("span",{children:"Purchase Assistant"})]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[i.jsx("button",{onClick:ft,title:"Refresh chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:fe=>fe.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:fe=>fe.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(Il,{size:16,color:"#ffffff",strokeWidth:2.5})}),i.jsx("button",{onClick:()=>ie(!1),title:"Minimize chat",style:{background:"rgba(255, 255, 255, 0.2)",border:"none",color:"#ffffff",width:"32px",height:"32px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",transition:"all 0.2s",padding:"0"},onMouseEnter:fe=>fe.currentTarget.style.background="rgba(255, 255, 255, 0.35)",onMouseLeave:fe=>fe.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:i.jsx(xw,{size:16,color:"#ffffff",strokeWidth:2.5})})]})]}),i.jsxs("div",{className:Tt.chatMessages,children:[ae.length===0&&i.jsxs("div",{className:Tt.emptyChatState,children:[i.jsx("div",{className:Tt.emptyChatIcon,children:i.jsx(cs,{size:42})}),i.jsx("p",{children:"Hi! I can help you manage your purchase. Ask me to fix spelling errors, add compositions, check for duplicates, or update any field."}),i.jsxs("div",{className:Tt.suggestionChips,children:[i.jsx("button",{onClick:()=>W("Fix any spelling errors in drug names"),children:"Fix spelling errors"}),i.jsx("button",{onClick:()=>W("Add drug name with composition for items that only have brand names"),children:"Add compositions"}),i.jsx("button",{onClick:()=>W("Check for duplicate items"),children:"Check duplicates"})]})]}),ae.map((fe,Q)=>i.jsxs("div",{className:`${Tt.messageBubble} ${fe.role==="user"?Tt.userMessage:Tt.aiMessage}`,children:[i.jsx("div",{className:Tt.messageIcon,children:fe.role==="user"?i.jsx(Mo,{size:16}):i.jsx(cs,{size:16})}),i.jsx("div",{className:Tt.messageContent,children:i.jsx(Bs,{remarkPlugins:[os],children:fe.content})})]},Q)),re&&i.jsx("div",{className:`${Tt.messageBubble} ${Tt.aiMessage}`,children:i.jsxs("div",{className:Tt.typingIndicator,children:[i.jsx("span",{}),i.jsx("span",{}),i.jsx("span",{})]})}),i.jsx("div",{ref:te})]}),i.jsxs("div",{className:"ai-chat-input-container",children:[i.jsx("input",{ref:M,type:"file",accept:"image/*",hidden:!0,onChange:ct}),i.jsx("button",{onClick:()=>{var fe;return(fe=M.current)==null?void 0:fe.click()},disabled:re,title:"Attach image",className:`ai-attach-btn ${Se?"active":""}`,children:i.jsx(yw,{size:22,strokeWidth:2.5})}),Se&&i.jsxs("div",{className:"ai-image-preview-box",children:[i.jsx("img",{src:Se.preview,alt:"Preview",className:"ai-image-preview-thumbnail"}),i.jsx("button",{onClick:()=>$e(null),className:"ai-image-remove-badge",title:"Remove image",children:i.jsx(Sn,{size:14,strokeWidth:3})})]}),i.jsx("input",{type:"text",value:K,onChange:fe=>W(fe.target.value),onKeyDown:fe=>fe.key==="Enter"&&Ze(),placeholder:Se?"Describe what to do with this image...":"Ask about your purchase...",disabled:re,className:"ai-chat-text-input",autoFocus:!0}),i.jsx("button",{onClick:Ze,disabled:!K.trim()&&!Se||re,className:"ai-chat-send-btn",children:i.jsx(Mb,{size:20})})]})]})]})]})},uie=e=>{if(!e)return 1;const n=e.match(/(?:\d+x)?(\d+)/);return n&&n[1]?parseInt(n[1],10):1},die=()=>{const e=Ft(),n=$r(),[t,r]=w.useState(null),[a,o]=w.useState([]),[l,h]=w.useState(!0),[d,u]=w.useState(null),[f,g]=w.useState(!1),[b,v]=w.useState("cash"),[S,T]=w.useState(""),[E,C]=w.useState(""),[P,I]=w.useState(""),[q,L]=w.useState(""),[O,B]=w.useState(""),[$,F]=w.useState(0),z=w.useRef(!1),U=te=>{if(F(te),te!==""){const xe=Math.max(0,Math.min(100,parseFloat(te)||0));z.current=!0;const M=a.map(Se=>({...Se,discount_percentage:xe}));o(M)}},V=()=>{if($==="")U("0");else{const te=Math.max(0,Math.min(100,parseFloat(String($))||0));F(te)}},ee=(te,xe)=>{const M=[...a];M[te].discount_percentage=xe,o(M)},ie=te=>{const xe=[...a],M=xe[te].discount_percentage;M===""?xe[te].discount_percentage=0:xe[te].discount_percentage=Math.max(0,Math.min(100,parseFloat(String(M))||0)),o(xe)};w.useEffect(()=>{if(z.current){z.current=!1;return}const te=a.reduce((Se,$e)=>Se+($e.total_price??0),0);if(te===0){F(0);return}const M=a.reduce((Se,$e)=>{const ge=($e.total_price??0)*((Number($e.discount_percentage)??0)/100);return Se+ge},0)/te*100;F(Se=>Math.abs(Number(Se)-M)>.01?M:Se)},[a]);const ae=async()=>{if(!t)return u("No order data available to bill."),null;if(a.length===0)return u("Cannot bill an empty order."),null;g(!0),u(null);try{const te=a.map(he=>{const ge=(he.pricePerLooseUnit??0)*(he.looseQuantity??0),me=ge*((Number(he.discount_percentage)||0)/100),de=ge-me;return{name:he.name,pack_quantity:he.loosePacks??0,loose_quantity:he.looseUnits??0,price:he.originalPrice??0,pack_price:he.originalPrice??0,loose_price:he.pricePerLooseUnit??0,total:de,drug_id:he.drug_id,discount_percentage:Number(he.discount_percentage)??0,batch:he.batch,expiry_date:he.expiry_date}}),xe={patientId:t.patientId,queueId:t.id,items:te,amount:A,paymentMode:b,type:"pharmacy",related_id:t.id,status:"paid",discountPercentage:Number($)},M=await ce("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(xe)}),Se=await M.json();if(!M.ok||!Se.id)throw new Error(Se.message||"Failed to create bill.");const $e=await ce(`/api/pharmacy-orders/${t.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:Se.id,medications:a})});if(!$e.ok){const he=await $e.text();throw new Error(`Failed to update pharmacy order status: ${$e.statusText} - ${he}`)}return r(he=>he?{...he,status:"billed",bill_id:Se.id}:null),alert(`Order ${t.patientName}'s bill created (ID: ${Se.id}) and marked as billed.`),e(`/dashboard/pharmacy-billing/${t.id}`,{replace:!0,state:{order:{...t,status:"billed",bill_id:Se.id},initialItems:a}}),Se.id}catch(te){return console.error("Billing process failed:",te),u(te.message||"Failed to mark order as billed. Please try again."),null}finally{g(!1)}},J=()=>{window.print()},K=async()=>{await ae()&&(window.print(),e(-1))};w.useEffect(()=>{const te=n.pathname.split("/"),xe=te[te.length-1];xe?(async()=>{try{const Se=await ce(`/api/pharmacy-orders/${xe}`);if(!Se.ok)throw new Error("Failed to fetch pharmacy order details");const $e=await Se.json();r($e);const he=$e.medications.map(ge=>{const me=uie(ge.unit),de=(ge.pack_quantity??0)*me+(ge.loose_quantity??0);return{...ge,isLoose:!0,loosePacks:ge.pack_quantity??0,looseUnits:ge.loose_quantity??0,looseQuantity:de,pack_price:Number(ge.pack_price)||0,loose_price:Number(ge.loose_price)||0,total_price:Number(ge.total_price)||0,pricePerLooseUnit:Number(ge.loose_price)||0,originalPrice:Number(ge.pack_price)||0,discount_percentage:Number(ge.discount_percentage)??0,directions_to_use:ge.directions_to_use,tabletsPerDay:ge.tabletsPerDay,numberOfDays:ge.numberOfDays,batch:ge.batch,expiry_date:ge.expiry_date}});o(he)}catch(Se){console.error("Failed to fetch order:",Se),u(Se.message||"Failed to load order details.")}finally{h(!1)}})():(u("No pharmacy order ID provided."),h(!1))},[n.pathname]),w.useEffect(()=>{(async()=>{try{const xe=await ce("/api/clinics/settings");if(!xe.ok)throw new Error("Failed to fetch clinic settings");const M=await xe.json();C(M.upi_id||""),I(M.name||""),L(M.address||""),B(M.notes||"")}catch(xe){console.error("Error fetching clinic settings:",xe)}})()},[]);const W=w.useMemo(()=>a.reduce((te,xe)=>te+(xe.total_price??0),0),[a]),re=w.useMemo(()=>a.reduce((te,xe)=>{const Se=(xe.total_price??0)*(Number(xe.discount_percentage)??0)/100;return te+Se},0),[a]),A=w.useMemo(()=>W-re,[W,re]);return w.useEffect(()=>{if(A>0&&E){const te=`upi://pay?pa=${E}&pn=ClinicName&am=${A.toFixed(2)}&cu=INR`;T(te)}else T("")},[A,E]),l?i.jsx("div",{className:"loading-pulse",children:"Loading Bill..."}):d?i.jsxs("div",{className:"error-message-box",children:["Error: ",d]}):t?i.jsx("div",{className:"pharmacy-billing-page",children:i.jsxs("div",{className:"billing-container printable-section",children:[i.jsxs("div",{className:"billing-header print-only",children:[i.jsx("div",{className:"clinic-header-left",children:i.jsx("div",{className:"clinic-info-print",children:i.jsxs("div",{className:"clinic-name-and-details-print",children:[i.jsx("h1",{className:"bill-title",children:"TAX INVOICE"}),i.jsx("h2",{className:"clinic-name-print",children:P?`${P} Pharmacy`:"Pharmacy Bill"}),(q||O)&&i.jsxs("div",{className:"clinic-details-print",children:[q&&i.jsx("span",{className:"small-text clinic-address",children:q}),O&&i.jsx("span",{className:"small-text clinic-notes",children:O})]})]})})}),i.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Mo,{size:16})," Patient Name"]})," ",t.patientName]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Token"]})," ",t.patientTokenNumber??"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Xf,{size:16})," Order Date"]})," ",new Date(t.date).toLocaleDateString()]})]})]}),i.jsxs("header",{className:"billing-header no-print",children:[i.jsxs("button",{onClick:()=>e(-1),className:"back-button",children:[i.jsx(fn,{size:20}),i.jsx("span",{children:"Back"})]}),i.jsx("h1",{children:"Pharmacy Bill"})]}),i.jsxs("div",{className:"billing-layout",children:[i.jsxs("main",{className:"order-content",children:[i.jsxs("section",{className:"order-details-card no-print",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Patient Information"})}),i.jsxs("div",{className:"patient-info-grid",children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Mo,{size:16})," Patient Name"]})," ",t.patientName]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Token"]})," ",t.patientTokenNumber??"N/A"]}),i.jsxs("div",{className:"info-item no-print",children:[i.jsxs("strong",{children:[i.jsx(Io,{size:16})," Order ID"]})," ",t.id]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Xf,{size:16})," Order Date"]})," ",new Date(t.date).toLocaleDateString()]})]})]}),i.jsxs("section",{className:"medications-card",children:[i.jsx("div",{className:"card-header no-print",children:i.jsx("h2",{children:"Medications"})}),a.length>0?i.jsxs("table",{className:"medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"S.No."}),i.jsx("th",{children:"DESCRIPTION"}),i.jsx("th",{children:"BATCH"}),i.jsx("th",{children:"EXPIRY"}),i.jsx("th",{children:"QUANTITY"}),i.jsx("th",{children:"MRP"}),i.jsx("th",{children:"RATE"}),i.jsx("th",{children:"DIS %"}),i.jsx("th",{children:"GST%"}),i.jsx("th",{children:"AMT"})]})}),i.jsx("tbody",{children:a.map((te,xe)=>{var ge,me;const M=te.total_price??0,Se=M*(Number(te.discount_percentage)||0)/100,$e=M-Se;return i.jsxs("tr",{children:[i.jsx("td",{children:xe+1}),i.jsx("td",{children:te.name}),i.jsx("td",{children:te.batch||"N/A"}),i.jsx("td",{children:te.expiry_date?new Date(te.expiry_date).toLocaleDateString():"N/A"}),i.jsxs("td",{children:[i.jsxs("div",{children:["Packs: ",te.loosePacks??0]}),i.jsxs("div",{children:["Loose: ",te.looseUnits??0]})]}),i.jsx("td",{children:((ge=te.originalPrice)==null?void 0:ge.toFixed(2))??"N/A"}),i.jsx("td",{children:((me=te.pricePerLooseUnit)==null?void 0:me.toFixed(2))??"N/A"}),i.jsxs("td",{children:[i.jsx("input",{type:"number",value:te.discount_percentage??0,onChange:de=>ee(xe,de.target.value),onBlur:()=>ie(xe),min:"0",max:"100",className:"discount-input-table"}),"%"]}),i.jsxs("td",{children:[5 .toFixed(1),"%"]}),i.jsx("td",{children:$e.toFixed(2)})]},xe)})})]}):i.jsx("p",{children:"No medications in this order."})]}),i.jsxs("div",{className:"bill-summary-print print-only",children:[S&&i.jsxs("div",{className:`qr-code-container qr-code-printable-section ${b!=="upi"?"hide-on-screen":""}`,children:[i.jsx(ap,{value:S,size:100}),i.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]}),i.jsxs("div",{className:"bill-summary-details",children:[i.jsxs("div",{className:"summary-row-print",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["",W.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print",children:[i.jsxs("span",{children:["Total Discount (",Number($).toFixed(2),"%)"]}),i.jsxs("span",{children:["- ",re.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print",children:[i.jsx("span",{children:"GST (Included)"}),i.jsxs("span",{children:["",(A*.05).toFixed(2)]})]}),i.jsx("div",{className:"print-only-total",children:i.jsxs("strong",{children:["Grand Total: ",A.toFixed(2)]})})]})]})]}),i.jsx("aside",{className:"billing-sidebar no-print",children:i.jsxs("div",{className:"billing-summary-card",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Billing Summary"})}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["",W.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Total Discount"}),i.jsxs("span",{children:["- ",re.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Discount Percentage"}),i.jsxs("div",{className:"discount-input-wrapper",children:[i.jsx("input",{type:"number",value:$,onChange:te=>U(te.target.value),onBlur:V,min:"0",max:"100",className:"discount-input-total",disabled:f||t.status==="billed"}),"%"]})]}),i.jsxs("div",{className:"summary-row grand-total-row",children:[i.jsx("strong",{children:"Grand Total"}),i.jsxs("strong",{children:["",A.toFixed(2)]})]}),i.jsx("div",{className:"qr-code-container",children:S?i.jsxs(i.Fragment,{children:[i.jsx(ap,{value:S,size:90}),i.jsx("p",{children:"Scan to pay using UPI"})]}):i.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),i.jsxs("div",{className:"payment-mode-section",children:[i.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:i.jsx("strong",{children:"Payment Mode"})}),i.jsxs("select",{id:"paymentMode",value:b,onChange:te=>v(te.target.value),className:"payment-mode-select",disabled:f||t.status==="billed",children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"upi",children:"UPI"}),i.jsx("option",{value:"card",children:"Card"}),i.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),i.jsx("option",{value:"credit",children:"Credit"})]})]}),i.jsxs("div",{className:"bill-actions",children:[t.status==="pending"&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:J,className:"secondary-button print-preview-button no-print",disabled:f||a.length===0,children:"Print Preview"}),i.jsx("button",{onClick:K,className:"primary-button",disabled:f||a.length===0,children:f?"Processing...":"Finalise and Bill"})]}),t.status==="billed"&&i.jsx("button",{onClick:()=>e(`/dashboard/bills/${t.bill_id}`),className:"secondary-button",children:"View Bill"})]})]})})]}),i.jsxs("footer",{className:"billing-footer print-only",children:[i.jsx("p",{children:"Thank you for your business!"}),i.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})}):i.jsx("div",{className:"error-message-box",children:"No order data available."})},hie=()=>{var q,L,O,B,$;const{billId:e}=ia(),n=Ft(),[t,r]=w.useState(null),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(""),[f,g]=w.useState(""),[b,v]=w.useState(""),[S,T]=w.useState("");w.useEffect(()=>{(async()=>{try{if(!e)throw new Error("Bill ID is missing");const z=await ce(`/api/bills/${e}`);if(!z.ok)throw new Error("Failed to fetch bill details");const U=await z.json();r(U.bill);const V=await ce("/api/clinics/settings");if(V.ok){const ee=await V.json();if(u(ee.name||""),g(ee.address||""),v(ee.notes||""),ee.upi_id&&U.amount>0){const ie=`upi://pay?pa=${ee.upi_id}&pn=${encodeURIComponent(ee.name||"Clinic")}&am=${Number(U.amount).toFixed(2)}&cu=INR`;T(ie)}}}catch(z){console.error("Error fetching data:",z),h(z.message||"Failed to load bill details.")}finally{o(!1)}})()},[e]);const E=()=>{window.print()};if(a)return i.jsx("div",{className:"loading-pulse",children:"Loading Bill..."});if(l)return i.jsxs("div",{className:"error-message-box",children:["Error: ",l]});if(!t)return i.jsx("div",{className:"error-message-box",children:"No bill found."});const C=(t.items||[]).reduce((F,z)=>{const U=(Number(z.pack_price)||0)*(Number(z.pack_quantity)||0),V=(Number(z.loose_price)||0)*(Number(z.loose_quantity)||0);return F+U+V},0),P=C-Number(t.amount),I=Number(t.amount)*.05;return i.jsx("div",{className:"pharmacy-billing-page",children:i.jsxs("div",{className:"billing-container printable-section",children:[i.jsxs("div",{className:"billing-header print-only",children:[i.jsx("div",{className:"clinic-header-left",children:i.jsx("div",{className:"clinic-info-print",children:i.jsxs("div",{className:"clinic-name-and-details-print",children:[i.jsx("h1",{className:"bill-title",children:"TAX INVOICE"}),i.jsx("h2",{className:"clinic-name-print",children:d?`${d} Pharmacy`:"Pharmacy Bill"}),(f||b)&&i.jsxs("div",{className:"clinic-details-print",children:[f&&i.jsx("span",{className:"small-text clinic-address",children:f}),b&&i.jsx("span",{className:"small-text clinic-notes",children:b})]})]})})}),i.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Mo,{size:16})," Patient Name"]})," ",((q=t.Patient)==null?void 0:q.name)||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Token"]})," ",((L=t.Patient)==null?void 0:L.token_no)||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Xf,{size:16})," Bill Date"]})," ",new Date(t.createdAt).toLocaleDateString()]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Bill No"]})," ",((O=t.id)==null?void 0:O.slice(0,8).toUpperCase())||"N/A"]})]})]}),i.jsxs("header",{className:"billing-header no-print",children:[i.jsxs("button",{onClick:()=>n(-1),className:"back-button",children:[i.jsx(fn,{size:20}),i.jsx("span",{children:"Back"})]}),i.jsx("h1",{children:"View Bill"}),i.jsxs("button",{onClick:E,className:"primary-button",style:{marginLeft:"auto",width:"auto",padding:"0.5rem 1rem"},children:[i.jsx(Ao,{size:16,style:{marginRight:"8px"}})," Print"]})]}),i.jsxs("div",{className:"billing-layout",children:[i.jsxs("main",{className:"order-content",children:[i.jsxs("section",{className:"order-details-card no-print",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Bill Information"})}),i.jsxs("div",{className:"patient-info-grid",children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Mo,{size:16})," Patient Name"]})," ",((B=t.Patient)==null?void 0:B.name)||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Token"]})," ",(($=t.Patient)==null?void 0:$.token_no)||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Uf,{size:16})," Bill ID"]})," ",t.id]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{children:[i.jsx(Xf,{size:16})," Date"]})," ",new Date(t.createdAt).toLocaleString()]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Status"})," ",i.jsx("span",{className:"status-badge status-billed",children:t.status})]})]})]}),i.jsxs("section",{className:"medications-card",children:[i.jsx("div",{className:"card-header no-print",children:i.jsx("h2",{children:"Items"})}),t.items&&t.items.length>0?i.jsxs("table",{className:"medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"S.No."}),i.jsx("th",{children:"DESCRIPTION"}),i.jsx("th",{children:"BATCH"}),i.jsx("th",{children:"EXPIRY"}),i.jsx("th",{children:"QUANTITY"}),i.jsx("th",{children:"MRP"}),i.jsx("th",{children:"RATE"}),i.jsx("th",{children:"DIS %"}),i.jsx("th",{children:"GST%"}),i.jsx("th",{children:"AMT"})]})}),i.jsx("tbody",{children:t.items.map((F,z)=>{const U=Number(F.total)||0,V=5;let ee="N/A";if(F.expiry_date)try{ee=new Date(F.expiry_date).toLocaleDateString()}catch{}return i.jsxs("tr",{children:[i.jsx("td",{children:z+1}),i.jsx("td",{children:F.name}),i.jsx("td",{children:F.batch||"N/A"}),i.jsx("td",{children:ee}),i.jsxs("td",{children:[i.jsxs("div",{children:["Packs: ",F.pack_quantity??0]}),i.jsxs("div",{children:["Loose: ",F.loose_quantity??0]})]}),i.jsx("td",{children:Number(F.pack_price||0).toFixed(2)}),i.jsx("td",{children:Number(F.loose_price||0).toFixed(2)}),i.jsxs("td",{children:[Number(F.discount_percentage||0),"%"]}),i.jsxs("td",{children:[V.toFixed(1),"%"]}),i.jsx("td",{children:U.toFixed(2)})]},z)})})]}):i.jsx("p",{children:"No items in this bill."})]}),i.jsxs("div",{className:"bill-summary-print print-only",children:[S&&i.jsxs("div",{className:"qr-code-container qr-code-printable-section",children:[i.jsx(ap,{value:S,size:100}),i.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]}),i.jsxs("div",{className:"bill-summary-details",children:[i.jsxs("div",{className:"summary-row-print",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["",C.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print",children:[i.jsx("span",{children:"Discount"}),i.jsxs("span",{children:["- ",P.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print",children:[i.jsx("span",{children:"GST (Included)"}),i.jsxs("span",{children:["",I.toFixed(2)]})]}),i.jsx("div",{className:"print-only-total",children:i.jsxs("strong",{children:["Grand Total: ",Number(t.amount).toFixed(2)]})})]})]})]}),i.jsx("aside",{className:"billing-sidebar no-print",children:i.jsxs("div",{className:"billing-summary-card",children:[i.jsx("div",{className:"card-header",children:i.jsx("h2",{children:"Payment Summary"})}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["",C.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row",children:[i.jsx("span",{children:"Total Discount"}),i.jsxs("span",{children:["- ",P.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row grand-total-row",children:[i.jsx("strong",{children:"Grand Total"}),i.jsxs("strong",{children:["",Number(t.amount).toFixed(2)]})]}),i.jsxs("div",{className:"payment-mode-section",style:{marginTop:"1rem",padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Payment Mode:"})," ",(t.payment_mode||"N/A").toUpperCase()]}),i.jsxs("div",{className:"info-item",children:[i.jsx("strong",{children:"Payment Status:"})," ",(t.status||"N/A").toUpperCase()]})]}),i.jsx("div",{className:"qr-code-container",children:S&&i.jsxs(i.Fragment,{children:[i.jsx(ap,{value:S,size:128}),i.jsx("p",{children:"Scan to pay using UPI"})]})}),i.jsx("div",{className:"bill-actions",children:i.jsxs("button",{onClick:E,className:"primary-button",style:{width:"100%"},children:[i.jsx(Ao,{size:16,style:{marginRight:"8px"}})," Print Bill"]})})]})})]}),i.jsxs("footer",{className:"billing-footer print-only",children:[i.jsx("p",{children:"Thank you for your business!"}),i.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})})};function Nc(e){return Array.isArray?Array.isArray(e):tA(e)==="[object Array]"}function fie(e){if(typeof e=="string")return e;let n=e+"";return n=="0"&&1/e==-1/0?"-0":n}function pie(e){return e==null?"":fie(e)}function Al(e){return typeof e=="string"}function ZE(e){return typeof e=="number"}function mie(e){return e===!0||e===!1||gie(e)&&tA(e)=="[object Boolean]"}function eA(e){return typeof e=="object"}function gie(e){return eA(e)&&e!==null}function ls(e){return e!=null}function e1(e){return!e.trim().length}function tA(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}const yie="Incorrect 'index' type",xie=e=>`Invalid value for key ${e}`,bie=e=>`Pattern length exceeds max of ${e}.`,vie=e=>`Missing ${e} property in key`,wie=e=>`Property 'weight' in key '${e}' must be a positive integer`,vC=Object.prototype.hasOwnProperty;class Nie{constructor(n){this._keys=[],this._keyMap={};let t=0;n.forEach(r=>{let a=nA(r);this._keys.push(a),this._keyMap[a.id]=a,t+=a.weight}),this._keys.forEach(r=>{r.weight/=t})}get(n){return this._keyMap[n]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function nA(e){let n=null,t=null,r=null,a=1,o=null;if(Al(e)||Nc(e))r=e,n=wC(e),t=nw(e);else{if(!vC.call(e,"name"))throw new Error(vie("name"));const l=e.name;if(r=l,vC.call(e,"weight")&&(a=e.weight,a<=0))throw new Error(wie(l));n=wC(l),t=nw(l),o=e.getFn}return{path:n,id:t,weight:a,src:r,getFn:o}}function wC(e){return Nc(e)?e:e.split(".")}function nw(e){return Nc(e)?e.join("."):e}function Sie(e,n){let t=[],r=!1;const a=(o,l,h)=>{if(ls(o))if(!l[h])t.push(o);else{let d=l[h];const u=o[d];if(!ls(u))return;if(h===l.length-1&&(Al(u)||ZE(u)||mie(u)))t.push(pie(u));else if(Nc(u)){r=!0;for(let f=0,g=u.length;f<g;f+=1)a(u[f],l,h+1)}else l.length&&a(u,l,h+1)}};return a(e,Al(n)?n.split("."):n,0),r?t:t[0]}const jie={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},_ie={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(e,n)=>e.score===n.score?e.idx<n.idx?-1:1:e.score<n.score?-1:1},Cie={location:0,threshold:.6,distance:100},kie={useExtendedSearch:!1,getFn:Sie,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Zt={..._ie,...jie,...Cie,...kie};const Tie=/[^ ]+/g;function Eie(e=1,n=3){const t=new Map,r=Math.pow(10,n);return{get(a){const o=a.match(Tie).length;if(t.has(o))return t.get(o);const l=1/Math.pow(o,.5*e),h=parseFloat(Math.round(l*r)/r);return t.set(o,h),h},clear(){t.clear()}}}class fN{constructor({getFn:n=Zt.getFn,fieldNormWeight:t=Zt.fieldNormWeight}={}){this.norm=Eie(t,3),this.getFn=n,this.isCreated=!1,this.setIndexRecords()}setSources(n=[]){this.docs=n}setIndexRecords(n=[]){this.records=n}setKeys(n=[]){this.keys=n,this._keysMap={},n.forEach((t,r)=>{this._keysMap[t.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Al(this.docs[0])?this.docs.forEach((n,t)=>{this._addString(n,t)}):this.docs.forEach((n,t)=>{this._addObject(n,t)}),this.norm.clear())}add(n){const t=this.size();Al(n)?this._addString(n,t):this._addObject(n,t)}removeAt(n){this.records.splice(n,1);for(let t=n,r=this.size();t<r;t+=1)this.records[t].i-=1}getValueForItemAtKeyId(n,t){return n[this._keysMap[t]]}size(){return this.records.length}_addString(n,t){if(!ls(n)||e1(n))return;let r={v:n,i:t,n:this.norm.get(n)};this.records.push(r)}_addObject(n,t){let r={i:t,$:{}};this.keys.forEach((a,o)=>{let l=a.getFn?a.getFn(n):this.getFn(n,a.path);if(ls(l)){if(Nc(l)){let h=[];const d=[{nestedArrIndex:-1,value:l}];for(;d.length;){const{nestedArrIndex:u,value:f}=d.pop();if(ls(f))if(Al(f)&&!e1(f)){let g={v:f,i:u,n:this.norm.get(f)};h.push(g)}else Nc(f)&&f.forEach((g,b)=>{d.push({nestedArrIndex:b,value:g})})}r.$[o]=h}else if(Al(l)&&!e1(l)){let h={v:l,n:this.norm.get(l)};r.$[o]=h}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}}function iA(e,n,{getFn:t=Zt.getFn,fieldNormWeight:r=Zt.fieldNormWeight}={}){const a=new fN({getFn:t,fieldNormWeight:r});return a.setKeys(e.map(nA)),a.setSources(n),a.create(),a}function Aie(e,{getFn:n=Zt.getFn,fieldNormWeight:t=Zt.fieldNormWeight}={}){const{keys:r,records:a}=e,o=new fN({getFn:n,fieldNormWeight:t});return o.setKeys(r),o.setIndexRecords(a),o}function Hx(e,{errors:n=0,currentLocation:t=0,expectedLocation:r=0,distance:a=Zt.distance,ignoreLocation:o=Zt.ignoreLocation}={}){const l=n/e.length;if(o)return l;const h=Math.abs(r-t);return a?l+h/a:h?1:l}function Die(e=[],n=Zt.minMatchCharLength){let t=[],r=-1,a=-1,o=0;for(let l=e.length;o<l;o+=1){let h=e[o];h&&r===-1?r=o:!h&&r!==-1&&(a=o-1,a-r+1>=n&&t.push([r,a]),r=-1)}return e[o-1]&&o-r>=n&&t.push([r,o-1]),t}const Kd=32;function Pie(e,n,t,{location:r=Zt.location,distance:a=Zt.distance,threshold:o=Zt.threshold,findAllMatches:l=Zt.findAllMatches,minMatchCharLength:h=Zt.minMatchCharLength,includeMatches:d=Zt.includeMatches,ignoreLocation:u=Zt.ignoreLocation}={}){if(n.length>Kd)throw new Error(bie(Kd));const f=n.length,g=e.length,b=Math.max(0,Math.min(r,g));let v=o,S=b;const T=h>1||d,E=T?Array(g):[];let C;for(;(C=e.indexOf(n,S))>-1;){let B=Hx(n,{currentLocation:C,expectedLocation:b,distance:a,ignoreLocation:u});if(v=Math.min(B,v),S=C+f,T){let $=0;for(;$<f;)E[C+$]=1,$+=1}}S=-1;let P=[],I=1,q=f+g;const L=1<<f-1;for(let B=0;B<f;B+=1){let $=0,F=q;for(;$<F;)Hx(n,{errors:B,currentLocation:b+F,expectedLocation:b,distance:a,ignoreLocation:u})<=v?$=F:q=F,F=Math.floor((q-$)/2+$);q=F;let z=Math.max(1,b-F+1),U=l?g:Math.min(b+F,g)+f,V=Array(U+2);V[U+1]=(1<<B)-1;for(let ie=U;ie>=z;ie-=1){let ae=ie-1,J=t[e.charAt(ae)];if(T&&(E[ae]=+!!J),V[ie]=(V[ie+1]<<1|1)&J,B&&(V[ie]|=(P[ie+1]|P[ie])<<1|1|P[ie+1]),V[ie]&L&&(I=Hx(n,{errors:B,currentLocation:ae,expectedLocation:b,distance:a,ignoreLocation:u}),I<=v)){if(v=I,S=ae,S<=b)break;z=Math.max(1,2*b-S)}}if(Hx(n,{errors:B+1,currentLocation:b,expectedLocation:b,distance:a,ignoreLocation:u})>v)break;P=V}const O={isMatch:S>=0,score:Math.max(.001,I)};if(T){const B=Die(E,h);B.length?d&&(O.indices=B):O.isMatch=!1}return O}function Iie(e){let n={};for(let t=0,r=e.length;t<r;t+=1){const a=e.charAt(t);n[a]=(n[a]||0)|1<<r-t-1}return n}const Tb=String.prototype.normalize?e=>e.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):e=>e;class rA{constructor(n,{location:t=Zt.location,threshold:r=Zt.threshold,distance:a=Zt.distance,includeMatches:o=Zt.includeMatches,findAllMatches:l=Zt.findAllMatches,minMatchCharLength:h=Zt.minMatchCharLength,isCaseSensitive:d=Zt.isCaseSensitive,ignoreDiacritics:u=Zt.ignoreDiacritics,ignoreLocation:f=Zt.ignoreLocation}={}){if(this.options={location:t,threshold:r,distance:a,includeMatches:o,findAllMatches:l,minMatchCharLength:h,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:f},n=d?n:n.toLowerCase(),n=u?Tb(n):n,this.pattern=n,this.chunks=[],!this.pattern.length)return;const g=(v,S)=>{this.chunks.push({pattern:v,alphabet:Iie(v),startIndex:S})},b=this.pattern.length;if(b>Kd){let v=0;const S=b%Kd,T=b-S;for(;v<T;)g(this.pattern.substr(v,Kd),v),v+=Kd;if(S){const E=b-Kd;g(this.pattern.substr(E),E)}}else g(this.pattern,0)}searchIn(n){const{isCaseSensitive:t,ignoreDiacritics:r,includeMatches:a}=this.options;if(n=t?n:n.toLowerCase(),n=r?Tb(n):n,this.pattern===n){let T={isMatch:!0,score:0};return a&&(T.indices=[[0,n.length-1]]),T}const{location:o,distance:l,threshold:h,findAllMatches:d,minMatchCharLength:u,ignoreLocation:f}=this.options;let g=[],b=0,v=!1;this.chunks.forEach(({pattern:T,alphabet:E,startIndex:C})=>{const{isMatch:P,score:I,indices:q}=Pie(n,T,E,{location:o+C,distance:l,threshold:h,findAllMatches:d,minMatchCharLength:u,includeMatches:a,ignoreLocation:f});P&&(v=!0),b+=I,P&&q&&(g=[...g,...q])});let S={isMatch:v,score:v?b/this.chunks.length:1};return v&&a&&(S.indices=g),S}}class Pu{constructor(n){this.pattern=n}static isMultiMatch(n){return NC(n,this.multiRegex)}static isSingleMatch(n){return NC(n,this.singleRegex)}search(){}}function NC(e,n){const t=e.match(n);return t?t[1]:null}class Mie extends Pu{constructor(n){super(n)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(n){const t=n===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Rie extends Pu{constructor(n){super(n)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(n){const r=n.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,n.length-1]}}}class Oie extends Pu{constructor(n){super(n)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(n){const t=n.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}class Lie extends Pu{constructor(n){super(n)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(n){const t=!n.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,n.length-1]}}}class Fie extends Pu{constructor(n){super(n)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(n){const t=n.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[n.length-this.pattern.length,n.length-1]}}}class $ie extends Pu{constructor(n){super(n)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(n){const t=!n.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,n.length-1]}}}class aA extends Pu{constructor(n,{location:t=Zt.location,threshold:r=Zt.threshold,distance:a=Zt.distance,includeMatches:o=Zt.includeMatches,findAllMatches:l=Zt.findAllMatches,minMatchCharLength:h=Zt.minMatchCharLength,isCaseSensitive:d=Zt.isCaseSensitive,ignoreDiacritics:u=Zt.ignoreDiacritics,ignoreLocation:f=Zt.ignoreLocation}={}){super(n),this._bitapSearch=new rA(n,{location:t,threshold:r,distance:a,includeMatches:o,findAllMatches:l,minMatchCharLength:h,isCaseSensitive:d,ignoreDiacritics:u,ignoreLocation:f})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(n){return this._bitapSearch.searchIn(n)}}class sA extends Pu{constructor(n){super(n)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(n){let t=0,r;const a=[],o=this.pattern.length;for(;(r=n.indexOf(this.pattern,t))>-1;)t=r+o,a.push([r,t-1]);const l=!!a.length;return{isMatch:l,score:l?0:1,indices:a}}}const iw=[Mie,sA,Oie,Lie,$ie,Fie,Rie,aA],SC=iw.length,zie=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,Bie="|";function Uie(e,n={}){return e.split(Bie).map(t=>{let r=t.trim().split(zie).filter(o=>o&&!!o.trim()),a=[];for(let o=0,l=r.length;o<l;o+=1){const h=r[o];let d=!1,u=-1;for(;!d&&++u<SC;){const f=iw[u];let g=f.isMultiMatch(h);g&&(a.push(new f(g,n)),d=!0)}if(!d)for(u=-1;++u<SC;){const f=iw[u];let g=f.isSingleMatch(h);if(g){a.push(new f(g,n));break}}}return a})}const qie=new Set([aA.type,sA.type]);class Vie{constructor(n,{isCaseSensitive:t=Zt.isCaseSensitive,ignoreDiacritics:r=Zt.ignoreDiacritics,includeMatches:a=Zt.includeMatches,minMatchCharLength:o=Zt.minMatchCharLength,ignoreLocation:l=Zt.ignoreLocation,findAllMatches:h=Zt.findAllMatches,location:d=Zt.location,threshold:u=Zt.threshold,distance:f=Zt.distance}={}){this.query=null,this.options={isCaseSensitive:t,ignoreDiacritics:r,includeMatches:a,minMatchCharLength:o,findAllMatches:h,ignoreLocation:l,location:d,threshold:u,distance:f},n=t?n:n.toLowerCase(),n=r?Tb(n):n,this.pattern=n,this.query=Uie(this.pattern,this.options)}static condition(n,t){return t.useExtendedSearch}searchIn(n){const t=this.query;if(!t)return{isMatch:!1,score:1};const{includeMatches:r,isCaseSensitive:a,ignoreDiacritics:o}=this.options;n=a?n:n.toLowerCase(),n=o?Tb(n):n;let l=0,h=[],d=0;for(let u=0,f=t.length;u<f;u+=1){const g=t[u];h.length=0,l=0;for(let b=0,v=g.length;b<v;b+=1){const S=g[b],{isMatch:T,indices:E,score:C}=S.search(n);if(T){if(l+=1,d+=C,r){const P=S.constructor.type;qie.has(P)?h=[...h,...E]:h.push(E)}}else{d=0,l=0,h.length=0;break}}if(l){let b={isMatch:!0,score:d/l};return r&&(b.indices=h),b}}return{isMatch:!1,score:1}}}const rw=[];function Hie(...e){rw.push(...e)}function aw(e,n){for(let t=0,r=rw.length;t<r;t+=1){let a=rw[t];if(a.condition(e,n))return new a(e,n)}return new rA(e,n)}const Eb={AND:"$and",OR:"$or"},sw={PATH:"$path",PATTERN:"$val"},ow=e=>!!(e[Eb.AND]||e[Eb.OR]),Gie=e=>!!e[sw.PATH],Yie=e=>!Nc(e)&&eA(e)&&!ow(e),jC=e=>({[Eb.AND]:Object.keys(e).map(n=>({[n]:e[n]}))});function oA(e,n,{auto:t=!0}={}){const r=a=>{let o=Object.keys(a);const l=Gie(a);if(!l&&o.length>1&&!ow(a))return r(jC(a));if(Yie(a)){const d=l?a[sw.PATH]:o[0],u=l?a[sw.PATTERN]:a[d];if(!Al(u))throw new Error(xie(d));const f={keyId:nw(d),pattern:u};return t&&(f.searcher=aw(u,n)),f}let h={children:[],operator:o[0]};return o.forEach(d=>{const u=a[d];Nc(u)&&u.forEach(f=>{h.children.push(r(f))})}),h};return ow(e)||(e=jC(e)),r(e)}function Wie(e,{ignoreFieldNorm:n=Zt.ignoreFieldNorm}){e.forEach(t=>{let r=1;t.matches.forEach(({key:a,norm:o,score:l})=>{const h=a?a.weight:null;r*=Math.pow(l===0&&h?Number.EPSILON:l,(h||1)*(n?1:o))}),t.score=r})}function Qie(e,n){const t=e.matches;n.matches=[],ls(t)&&t.forEach(r=>{if(!ls(r.indices)||!r.indices.length)return;const{indices:a,value:o}=r;let l={indices:a,value:o};r.key&&(l.key=r.key.src),r.idx>-1&&(l.refIndex=r.idx),n.matches.push(l)})}function Jie(e,n){n.score=e.score}function Kie(e,n,{includeMatches:t=Zt.includeMatches,includeScore:r=Zt.includeScore}={}){const a=[];return t&&a.push(Qie),r&&a.push(Jie),e.map(o=>{const{idx:l}=o,h={item:n[l],refIndex:l};return a.length&&a.forEach(d=>{d(o,h)}),h})}class mp{constructor(n,t={},r){this.options={...Zt,...t},this.options.useExtendedSearch,this._keyStore=new Nie(this.options.keys),this.setCollection(n,r)}setCollection(n,t){if(this._docs=n,t&&!(t instanceof fN))throw new Error(yie);this._myIndex=t||iA(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(n){ls(n)&&(this._docs.push(n),this._myIndex.add(n))}remove(n=()=>!1){const t=[];for(let r=0,a=this._docs.length;r<a;r+=1){const o=this._docs[r];n(o,r)&&(this.removeAt(r),r-=1,a-=1,t.push(o))}return t}removeAt(n){this._docs.splice(n,1),this._myIndex.removeAt(n)}getIndex(){return this._myIndex}search(n,{limit:t=-1}={}){const{includeMatches:r,includeScore:a,shouldSort:o,sortFn:l,ignoreFieldNorm:h}=this.options;let d=Al(n)?Al(this._docs[0])?this._searchStringList(n):this._searchObjectList(n):this._searchLogical(n);return Wie(d,{ignoreFieldNorm:h}),o&&d.sort(l),ZE(t)&&t>-1&&(d=d.slice(0,t)),Kie(d,this._docs,{includeMatches:r,includeScore:a})}_searchStringList(n){const t=aw(n,this.options),{records:r}=this._myIndex,a=[];return r.forEach(({v:o,i:l,n:h})=>{if(!ls(o))return;const{isMatch:d,score:u,indices:f}=t.searchIn(o);d&&a.push({item:o,idx:l,matches:[{score:u,value:o,norm:h,indices:f}]})}),a}_searchLogical(n){const t=oA(n,this.options),r=(h,d,u)=>{if(!h.children){const{keyId:g,searcher:b}=h,v=this._findMatches({key:this._keyStore.get(g),value:this._myIndex.getValueForItemAtKeyId(d,g),searcher:b});return v&&v.length?[{idx:u,item:d,matches:v}]:[]}const f=[];for(let g=0,b=h.children.length;g<b;g+=1){const v=h.children[g],S=r(v,d,u);if(S.length)f.push(...S);else if(h.operator===Eb.AND)return[]}return f},a=this._myIndex.records,o={},l=[];return a.forEach(({$:h,i:d})=>{if(ls(h)){let u=r(t,h,d);u.length&&(o[d]||(o[d]={idx:d,item:h,matches:[]},l.push(o[d])),u.forEach(({matches:f})=>{o[d].matches.push(...f)}))}}),l}_searchObjectList(n){const t=aw(n,this.options),{keys:r,records:a}=this._myIndex,o=[];return a.forEach(({$:l,i:h})=>{if(!ls(l))return;let d=[];r.forEach((u,f)=>{d.push(...this._findMatches({key:u,value:l[f],searcher:t}))}),d.length&&o.push({idx:h,item:l,matches:d})}),o}_findMatches({key:n,value:t,searcher:r}){if(!ls(t))return[];let a=[];if(Nc(t))t.forEach(({v:o,i:l,n:h})=>{if(!ls(o))return;const{isMatch:d,score:u,indices:f}=r.searchIn(o);d&&a.push({score:u,key:n,value:o,idx:l,norm:h,indices:f})});else{const{v:o,n:l}=t,{isMatch:h,score:d,indices:u}=r.searchIn(o);h&&a.push({score:d,key:n,value:o,norm:l,indices:u})}return a}}mp.version="7.1.0";mp.createIndex=iA;mp.parseIndex=Aie;mp.config=Zt;mp.parseQuery=oA;Hie(Vie);const Xie="_modalOverlay_qkqmh_1",Zie="_modalContent_qkqmh_45",ere="_modalHeader_qkqmh_99",tre="_modalTitle_qkqmh_119",nre="_modalCloseButton_qkqmh_141",ire="_modalBody_qkqmh_179",rre="_itemCard_qkqmh_199",are="_highConfidence_qkqmh_225",sre="_mediumConfidence_qkqmh_235",ore="_lowConfidence_qkqmh_245",lre="_itemLabel_qkqmh_255",cre="_itemName_qkqmh_273",ure="_itemQty_qkqmh_285",dre="_statusIcon_qkqmh_299",hre="_searchContainer_qkqmh_319",fre="_searchWrapper_qkqmh_327",pre="_searchInput_qkqmh_357",mre="_searchResults_qkqmh_377",gre="_searchItem_qkqmh_405",yre="_matchedItemInfo_qkqmh_427",xre="_errorText_qkqmh_453",bre="_modalFooter_qkqmh_465",vre="_btn_qkqmh_485",wre="_btnSecondary_qkqmh_509",Nre="_btnPrimary_qkqmh_529",hi={modalOverlay:Xie,modalContent:Zie,modalHeader:ere,modalTitle:tre,modalCloseButton:nre,modalBody:ire,itemCard:rre,highConfidence:are,mediumConfidence:sre,lowConfidence:ore,itemLabel:lre,itemName:cre,itemQty:ure,statusIcon:dre,searchContainer:hre,searchWrapper:fre,searchInput:pre,searchResults:mre,searchItem:gre,matchedItemInfo:yre,errorText:xre,modalFooter:bre,btn:vre,btnSecondary:wre,btnPrimary:Nre},Sre=({isOpen:e,onClose:n,recurringItems:t,inventory:r,onCreateOrder:a})=>{const[o,l]=w.useState([]),[h,d]=w.useState(""),[u,f]=w.useState(null),[g,b]=w.useState([]),v=w.useMemo(()=>new mp(r,{keys:["name","composition"],threshold:.4,includeScore:!0}),[r]);w.useEffect(()=>{if(e&&t.length>0&&r.length>0){const C=t.map(P=>{const I=v.search(P.name);let q=null,L="none";if(I.length>0){q=I[0].item;const O=I[0].score||1;O<.1?L="high":O<.4?L="medium":L="low"}return{original:P,matchedDrug:q,confidence:L}});l(C)}},[e,t,r,v]),w.useEffect(()=>{if(h){const C=v.search(h).map(P=>P.item);b(C.slice(0,10))}else b([])},[h,v]);const S=(C,P)=>{l(I=>{const q=[...I];return q[C]={...q[C],matchedDrug:P,confidence:"high"},q}),f(null),d("")},T=()=>{const C=o.filter(P=>P.matchedDrug).map(P=>{const I=Number(P.matchedDrug.price),q=E(P.matchedDrug.unit),L=I/(q||1),O=P.original.pack_quantity||0,B=P.original.loose_quantity||0,$=O*I+B*L;return{drug_id:P.matchedDrug.id,name:P.matchedDrug.name,pack_quantity:O,loose_quantity:B,pack_price:I,loose_price:L,total_price:$,unit:P.matchedDrug.unit,tabletsPerDay:P.original.tabletsPerDay,numberOfDays:P.original.numberOfDays,directions_to_use:P.original.directions_to_use}});a(C)},E=C=>{if(!C)return 1;const P=C.match(/(?:\d+x)?(\d+)/);return P?parseInt(P[1],10):1};return e?i.jsx("div",{className:hi.modalOverlay,children:i.jsxs("div",{className:hi.modalContent,children:[i.jsxs("div",{className:hi.modalHeader,children:[i.jsx("h2",{className:hi.modalTitle,children:"Review Recurring Items"}),i.jsx("button",{onClick:n,className:hi.modalCloseButton,title:"Close",children:i.jsx(Sn,{size:24})})]}),i.jsx("div",{className:hi.modalBody,children:i.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:o.map((C,P)=>i.jsxs("div",{className:`${hi.itemCard} ${C.confidence==="high"?hi.highConfidence:C.confidence==="medium"?hi.mediumConfidence:hi.lowConfidence}`,children:[i.jsxs("div",{children:[i.jsx("p",{className:hi.itemLabel,children:"Recurring Item"}),i.jsx("p",{className:hi.itemName,children:C.original.name}),i.jsxs("p",{className:hi.itemQty,children:["Qty: ",C.original.pack_quantity?`${C.original.pack_quantity} packs`:"",C.original.loose_quantity?` ${C.original.loose_quantity} loose`:""]})]}),i.jsx("div",{className:hi.statusIcon,children:C.confidence==="high"?i.jsx(Vs,{size:20,style:{color:"#22c55e"}}):i.jsx(i2,{size:20,style:{color:"#eab308"}})}),i.jsxs("div",{className:hi.searchContainer,children:[i.jsx("p",{className:hi.itemLabel,children:"Matched Inventory"}),u===P?i.jsxs("div",{className:hi.searchContainer,children:[i.jsxs("div",{className:hi.searchWrapper,children:[i.jsx(Pi,{size:16,style:{color:"#9ca3af"}}),i.jsx("input",{type:"text",value:h,onChange:I=>d(I.target.value),placeholder:"Search inventory...",className:hi.searchInput,autoFocus:!0}),i.jsx("button",{onClick:()=>f(null),style:{background:"none",border:"none",cursor:"pointer",color:"#9ca3af"},children:i.jsx(Sn,{size:16})})]}),g.length>0&&i.jsx("div",{className:hi.searchResults,children:g.map(I=>i.jsxs("div",{onClick:()=>S(P,I),className:hi.searchItem,children:[i.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem"},children:I.name}),i.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:["Stock: ",I.quantity_in_stock," | ",I.price]})]},I.id))})]}):i.jsx("div",{onClick:()=>{f(P),d("")},className:hi.matchedItemInfo,children:C.matchedDrug?i.jsxs("div",{children:[i.jsx("p",{style:{fontWeight:700,color:"var(--heading-color)"},children:C.matchedDrug.name}),i.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--secondary-text-color)"},children:["Stock: ",C.matchedDrug.quantity_in_stock," | ",C.matchedDrug.price]})]}):i.jsx("p",{className:hi.errorText,children:"No match found. Click to search."})})]})]},P))})}),i.jsxs("div",{className:hi.modalFooter,children:[i.jsx("button",{onClick:n,className:`${hi.btn} ${hi.btnSecondary}`,children:"Cancel"}),i.jsxs("button",{onClick:T,disabled:o.some(C=>!C.matchedDrug),className:`${hi.btn} ${hi.btnPrimary}`,children:[i.jsx(Vs,{size:18}),"Create Order"]})]})]})}):null},t1=15,_C=()=>{const[e,n]=w.useState([]),[t,r]=w.useState(!0),[a,o]=w.useState(null),[l,h]=w.useState(!1),[d,u]=w.useState(!1),[f,g]=w.useState(null),[b,v]=w.useState([]),[S,T]=w.useState(null),[E,C]=w.useState(30),P=Ft(),[I,q]=w.useState(""),[L,O]=w.useState(""),[B,$]=w.useState(1),[F,z]=w.useState(1),[U,V]=w.useState(0),[ee,ie]=w.useState("next_delivery_date"),[ae,J]=w.useState("asc"),[K,W]=w.useState("");w.useEffect(()=>{const pe=setTimeout(()=>{O(I),$(1)},500);return()=>{clearTimeout(pe)}},[I]);const re=w.useCallback(async(pe,ne,Pe,Ye,rt)=>{r(!0),o(null);try{const ut=new URLSearchParams({page:pe.toString(),limit:t1.toString(),sortBy:Pe,sortOrder:Ye});ne&&ut.append("search",ne),rt&&ut.append("status",rt);const je=await ce(`/api/recurring-medications?${ut.toString()}`);if(!je.ok){const ze=await je.json().catch(()=>({}));throw new Error(ze.message||"Failed to fetch recurring medications")}const Qe=await je.json();n(Qe.recurringMedications),V(Qe.totalCount),$(Qe.currentPage),z(Qe.totalPages)}catch(ut){o(ut.message),n([]),V(0),$(1),z(1)}finally{r(!1)}},[]),A=async()=>{try{const pe=await ce("/api/drugs");if(pe.ok){const ne=await pe.json();v(ne)}}catch(pe){console.error("Failed to fetch inventory:",pe)}};w.useEffect(()=>{re(B,L,ee,ae,K),A()},[B,L,ee,ae,K,re]);const te=pe=>{const ne=ee===pe&&ae==="asc"?"desc":"asc";ie(pe),J(ne),$(1)},xe=async(pe,ne)=>{try{if(!(await ce(`/api/recurring-medications/${pe}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:ne})})).ok)throw new Error("Failed to update status");re(B,L,ee,ae,K)}catch(Pe){alert(`Error updating status: ${Pe.message}`)}},M=(pe,ne)=>{T(pe),C(ne)},Se=async pe=>{if(E<1||E>365){alert("Frequency must be between 1 and 365 days");return}try{const ne=await ce(`/api/recurring-medications/${pe}/frequency`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({frequency_days:E})});if(!ne.ok){const Pe=await ne.json().catch(()=>({}));throw new Error(Pe.message||"Failed to update frequency")}T(null),re(B,L,ee,ae,K)}catch(ne){alert(`Error updating frequency: ${ne.message}`)}},$e=()=>{T(null)},he=pe=>{g(pe),h(!0),u(!1)},ge=pe=>{g(pe),u(!0),h(!1)},me=pe=>{re(B,L,ee,ae,K)},de=async pe=>{if(f)try{const ne={patient_id:f.patient_id,items:pe,prescription_for_unavailable_drugs:"",status:"pending",date:new Date().toISOString(),order_total:pe.reduce((Ye,rt)=>Ye+(rt.total_price||rt.pack_quantity*rt.pack_price+rt.loose_quantity*rt.loose_price),0),recurring_medication_id:f.id},Pe=await ce("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)});if(!Pe.ok){const Ye=await Pe.json().catch(()=>({}));throw new Error(Ye.message||"Failed to create order")}alert("Order created successfully!"),h(!1),g(null),re(B,L,ee,ae,K)}catch(ne){alert(`Failed to create order: ${ne.message}`)}},Le=(pe,ne)=>{const Pe=ne.map(Ye=>({name:Ye.name,pack_quantity:Ye.pack_quantity,loose_quantity:Ye.loose_quantity,price:Ye.price,pack_price:Ye.pack_price,loose_price:Ye.loose_price,total_price:Number(Ye.total_price)||0,isLoose:Ye.isLoose,unit:Ye.unit,drug_id:Ye.drug_id?String(Ye.drug_id):null,tabletsPerDay:Ye.tabletsPerDay,numberOfDays:Ye.numberOfDays,directions_to_use:Ye.directions_to_use,discount_percentage:Ye.discount_percentage??0,batch:Ye.batch,expiry_date:Ye.expiry_date}));P(`/dashboard/pharmacy-billing/${pe}`,{state:{initialItems:Pe}})},He=async(pe,ne)=>{try{const Pe=await ce(`/api/pharmacy-orders/${pe}`);if(!Pe.ok)throw new Error("Failed to fetch order details");const Ye=await Pe.json(),rt={status:ne,medications:Ye.medications},ut=await ce(`/api/pharmacy-orders/${pe}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(rt)});if(!ut.ok){const je=await ut.text();throw new Error(`Failed to update status: ${ut.statusText} (${ut.status}) - ${je}`)}re(B,L,ee,ae,K),alert(`Order marked as ${ne} successfully!`)}catch(Pe){console.error("Failed to update order status:",Pe),alert(`Error updating status: ${Pe.message}`)}};return i.jsxs("div",{className:"recurring-medications-page-container",children:[i.jsxs("div",{className:"recurring-medications-header",children:[i.jsxs("div",{className:"recurring-medications-header-left",children:[i.jsxs("button",{onClick:()=>P(-1),className:"recurring-medications-button recurring-medications-button-back",children:[i.jsx(fn,{size:20}),"Back"]}),i.jsx("h1",{className:"recurring-medications-page-title",children:"Recurring Medications"})]}),i.jsxs("div",{className:"recurring-medications-header-controls",children:[i.jsxs("div",{className:"search-wrapper",children:[i.jsx(Pi,{size:18,className:"search-icon"}),i.jsx("input",{type:"text",placeholder:"Search patients...",value:I,onChange:pe=>q(pe.target.value)})]}),i.jsxs("div",{className:"filter-wrapper",children:[i.jsx(XC,{size:18,className:"filter-icon"}),i.jsxs("select",{id:"statusFilter",value:K,onChange:pe=>W(pe.target.value),children:[i.jsx("option",{value:"",children:"All Status"}),i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"paused",children:"Paused"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),i.jsxs("button",{onClick:()=>re(B,L,ee,ae,K),className:"recurring-medications-button recurring-medications-button-primary refresh-button",title:"Refresh Data",children:[i.jsx(Il,{size:18}),i.jsx("span",{children:"Refresh"})]})]})]}),i.jsxs("div",{className:"recurring-medications-summary-bar",children:[!t&&U>0&&i.jsxs("div",{className:"summary-text",children:["Found ",i.jsx("span",{className:"highlight-count",children:U})," recurring medication",U!==1?"s":"",(L||K)&&" matching criteria"]}),!t&&e.length>0&&i.jsxs("div",{className:"header-stats",children:[i.jsxs("div",{className:"stat-item",children:[i.jsx("span",{className:"stat-dot active"}),i.jsxs("span",{children:["Active: ",i.jsx("span",{className:"stat-value",children:e.filter(pe=>pe.status==="active").length})]})]}),i.jsxs("div",{className:"stat-item",children:[i.jsx("span",{className:"stat-dot paused"}),i.jsxs("span",{children:["Paused: ",i.jsx("span",{className:"stat-value",children:e.filter(pe=>pe.status==="paused").length})]})]}),i.jsxs("div",{className:"stat-item",children:[i.jsx("span",{className:"stat-dot cancelled"}),i.jsxs("span",{children:["Cancelled: ",i.jsx("span",{className:"stat-value",children:e.filter(pe=>pe.status==="cancelled").length})]})]})]})]}),i.jsxs("div",{className:"recurring-medications-content-box",children:[a&&i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",padding:"1rem 1.25rem",backgroundColor:"#fee2e2",border:"2px solid #fca5a5",borderRadius:"0.75rem",color:"#991b1b",marginBottom:"1.5rem",boxShadow:"0 2px 4px rgba(239, 68, 68, 0.1)"},children:[i.jsx(mi,{size:24,style:{flexShrink:0}}),i.jsxs("div",{children:[i.jsx("p",{style:{fontWeight:600,marginBottom:"0.25rem"},children:"Error Loading Data"}),i.jsx("p",{style:{fontSize:"0.875rem",margin:0},children:a})]})]}),t?i.jsx("div",{className:"recurring-medications-table-container",children:i.jsxs("table",{className:"recurring-medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"Name"}),i.jsx("th",{children:"Medications"}),i.jsx("th",{children:"Next Delivery"}),i.jsx("th",{children:"Frequency"}),i.jsx("th",{children:"Status"}),i.jsx("th",{children:"Last Order"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:[...Array(5)].map((pe,ne)=>i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("div",{className:"skeleton skeleton-title"}),i.jsx("div",{className:"skeleton skeleton-text"})]}),i.jsxs("td",{children:[i.jsx("div",{className:"skeleton skeleton-text"}),i.jsx("div",{className:"skeleton skeleton-text"})]}),i.jsx("td",{children:i.jsx("div",{className:"skeleton skeleton-text",style:{width:"4rem"}})}),i.jsx("td",{children:i.jsx("div",{className:"skeleton skeleton-text",style:{width:"6rem"}})}),i.jsx("td",{children:i.jsx("div",{className:"skeleton skeleton-badge"})}),i.jsx("td",{children:i.jsx("div",{className:"skeleton skeleton-text"})}),i.jsx("td",{children:i.jsx("div",{className:"skeleton skeleton-text",style:{width:"3rem"}})})]},ne))})]})}):e.length===0?i.jsxs("div",{style:{textAlign:"center",padding:"4rem 2rem",background:"linear-gradient(135deg, #f9fafb 0%, #ffffff 100%)",borderRadius:"1rem",border:"2px dashed #d1d5db",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.05)"},children:[i.jsx("div",{style:{width:"4rem",height:"4rem",margin:"0 auto 1.5rem",borderRadius:"50%",background:"linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%)",display:"flex",alignItems:"center",justifyContent:"center"},children:i.jsx(mi,{size:32,style:{color:"#3b82f6"}})}),i.jsx("p",{style:{color:"#1f2937",fontSize:"1.125rem",fontWeight:600,marginBottom:"0.5rem"},children:L||K?"No matches found":"No recurring medications"}),i.jsx("p",{style:{color:"#6b7280",fontSize:"0.95rem"},children:L||K?"Try adjusting your search or filter criteria":"Recurring medications will appear here once created"})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"recurring-medications-table-container",children:i.jsxs("table",{className:"recurring-medications-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[i.jsxs("div",{className:"sortable-header",onClick:()=>te("patient_name"),style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx("span",{children:"Name"}),ee==="patient_name"&&(ae==="asc"?i.jsx(To,{size:12}):i.jsx(Nu,{size:12}))]}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem",fontSize:"0.75rem",color:"#6b7280"},children:[i.jsxs("div",{className:"sortable-header",onClick:()=>te("patient_phone"),style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx("span",{children:"Phone"}),ee==="patient_phone"&&(ae==="asc"?i.jsx(To,{size:10}):i.jsx(Nu,{size:10}))]}),i.jsx("span",{children:"|"}),i.jsxs("div",{className:"sortable-header",onClick:()=>te("patient_token"),style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",gap:"0.25rem"},children:[i.jsx("span",{children:"Token"}),ee==="patient_token"&&(ae==="asc"?i.jsx(To,{size:10}):i.jsx(Nu,{size:10}))]})]})]})}),i.jsx("th",{children:"Medications"}),i.jsxs("th",{className:"sortable-header",onClick:()=>te("next_delivery_date"),style:{cursor:"pointer",userSelect:"none"},children:["Next Delivery",ee==="next_delivery_date"&&(ae==="asc"?i.jsx(To,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}):i.jsx(Nu,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}))]}),i.jsxs("th",{className:"sortable-header",onClick:()=>te("frequency_days"),style:{cursor:"pointer",userSelect:"none"},children:["Frequency",ee==="frequency_days"&&(ae==="asc"?i.jsx(To,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}):i.jsx(Nu,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}))]}),i.jsxs("th",{className:"sortable-header",onClick:()=>te("status"),style:{cursor:"pointer",userSelect:"none"},children:["Status",ee==="status"&&(ae==="asc"?i.jsx(To,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}):i.jsx(Nu,{size:14,style:{display:"inline",marginLeft:"0.25rem"}}))]}),i.jsx("th",{children:"Last Order"}),i.jsx("th",{children:"Actions"})]})}),i.jsx("tbody",{children:e.map(pe=>i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("div",{style:{fontWeight:500,color:"#1f2937"},children:pe.patient_name}),i.jsx("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:pe.patient_phone}),i.jsxs("div",{style:{fontSize:"0.875rem",color:"#6b7280"},children:["Token: ",pe.patient_token]})]}),i.jsx("td",{children:i.jsx("div",{className:"med-list-compact",children:pe.medications.map((ne,Pe)=>i.jsxs("div",{className:"med-item-compact",children:[i.jsxs("div",{className:"med-name-primary",children:[ne.name,i.jsxs("span",{style:{fontSize:"0.75rem",fontWeight:400,color:"#64748b",marginLeft:"0.25rem"},children:["(",ne.pack_quantity?`${ne.pack_quantity}p`:"",ne.pack_quantity&&ne.loose_quantity?" + ":"",ne.loose_quantity?`${ne.loose_quantity}l`:"",")"]})]}),i.jsxs("div",{className:"med-details-secondary",children:[ne.tabletsPerDay&&ne.numberOfDays?`${ne.tabletsPerDay} tab/day for ${ne.numberOfDays} days`:"",ne.directions_to_use&&`  ${ne.directions_to_use}`]})]},Pe))})}),i.jsx("td",{children:i.jsx("div",{style:{fontSize:"0.875rem"},children:new Date(pe.next_delivery_date).toLocaleDateString()})}),i.jsx("td",{children:S===pe.id?i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsx("input",{type:"number",min:"1",max:"365",value:E,onChange:ne=>C(parseInt(ne.target.value,10)||1),style:{width:"4rem",padding:"0.25rem 0.5rem",border:"2px solid #6d28d9",borderRadius:"0.375rem",fontSize:"0.875rem",outline:"none"},autoFocus:!0,onKeyDown:ne=>{ne.key==="Enter"&&Se(pe.id),ne.key==="Escape"&&$e()}}),i.jsx("span",{style:{fontSize:"0.875rem",color:"#4b5563"},children:"days"}),i.jsx("button",{onClick:()=>Se(pe.id),style:{padding:"0.25rem 0.5rem",backgroundColor:"#22c55e",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},title:"Save (Enter)",children:""}),i.jsx("button",{onClick:$e,style:{padding:"0.25rem 0.5rem",backgroundColor:"#ef4444",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontSize:"0.75rem",fontWeight:600},title:"Cancel (Esc)",children:""})]}):i.jsxs("div",{onClick:()=>M(pe.id,pe.frequency_days||30),style:{fontSize:"0.875rem",color:"#4b5563",cursor:"pointer",padding:"0.25rem 0.5rem",borderRadius:"0.375rem",transition:"all 0.2s ease",display:"inline-block"},onMouseEnter:ne=>{ne.currentTarget.style.backgroundColor="#f3f4f6",ne.currentTarget.style.color="#6d28d9"},onMouseLeave:ne=>{ne.currentTarget.style.backgroundColor="transparent",ne.currentTarget.style.color="#4b5563"},title:"Click to edit frequency",children:["Every ",pe.frequency_days||30," days "]})}),i.jsx("td",{children:i.jsxs("span",{className:`status-badge ${pe.status}`,children:[pe.status==="active"&&i.jsx(Nr,{size:10}),pe.status==="paused"&&i.jsx(Il,{size:10}),pe.status==="cancelled"&&i.jsx(mi,{size:10}),pe.status]})}),i.jsx("td",{children:pe.last_order?i.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[i.jsxs("div",{style:{fontSize:"0.875rem"},children:[i.jsx("span",{style:{fontWeight:500},children:"Status: "}),i.jsx("span",{className:`status-badge ${pe.last_order.status}`,children:pe.last_order.status})]}),i.jsx("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:new Date(pe.last_order.date).toLocaleDateString()}),i.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[pe.last_order.status==="pending"&&i.jsxs("button",{onClick:()=>Le(pe.last_order.id,pe.medications),className:"small-action-button bill",children:[i.jsx(Hf,{size:12})," Bill"]}),pe.last_order.status==="billed"&&i.jsxs("button",{onClick:()=>He(pe.last_order.id,"dispensed"),className:"small-action-button dispense",children:[i.jsx(Eo,{size:12})," Dispense"]}),pe.last_order.status==="dispensed"&&i.jsxs("span",{style:{display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem",color:"#16a34a"},children:[i.jsx(Nr,{size:12})," Complete"]})]})]}):i.jsx("span",{style:{fontSize:"0.875rem",color:"#9ca3af"},children:"No recent order"})}),i.jsx("td",{children:i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[i.jsxs("select",{value:pe.status,onChange:ne=>xe(pe.id,ne.target.value),style:{fontSize:"0.875rem",borderColor:"#d1d5db",borderRadius:"0.375rem",padding:"0.25rem 0.5rem"},children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"paused",children:"Paused"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]}),i.jsx("button",{onClick:()=>ge(pe),className:"action-button",title:"Edit Recurring Medication",style:{color:"#6d28d9"},children:i.jsx(eh,{size:18})}),i.jsx("button",{onClick:()=>he(pe),className:"action-button",title:"Create Order",children:i.jsx(n2,{size:18})})]})})]},pe.id))})]})}),F>1&&i.jsxs("div",{className:"pagination-controls",children:[i.jsxs("div",{className:"pagination-info",children:["Showing ",i.jsx("span",{children:(B-1)*t1+1})," to ",i.jsx("span",{children:Math.min(B*t1,U)})," of ",i.jsx("span",{children:U})," results"]}),i.jsxs("div",{className:"pagination-buttons",children:[i.jsxs("button",{onClick:()=>$(pe=>Math.max(pe-1,1)),disabled:B===1||t,className:"pagination-button",children:[i.jsx(Ib,{size:14}),"Previous"]}),i.jsxs("div",{className:"pagination-page-info",children:["Page ",i.jsx("span",{children:B})," of ",i.jsx("span",{children:F})]}),i.jsxs("button",{onClick:()=>$(pe=>Math.min(pe+1,F)),disabled:B===F||t,className:"pagination-button",children:["Next",i.jsx(xg,{size:14})]})]})]})]})]}),f&&i.jsx(Sre,{isOpen:l,onClose:()=>{h(!1),g(null)},recurringItems:f.medications,inventory:b,onCreateOrder:de}),f&&i.jsx(MT,{isOpen:d,onClose:()=>{u(!1),g(null)},recurringMedication:f,onUpdate:me,inventory:b})]})},jre="_overlay_ezztw_1",_re="_content_ezztw_45",Cre="_header_ezztw_101",kre="_searchBar_ezztw_111",Tre="_searchIcon_ezztw_151",Ere="_input_ezztw_169",Are="_results_ezztw_205",Dre="_list_ezztw_215",Pre="_listItem_ezztw_227",Ire="_selected_ezztw_257",Mre="_iconWrapper_ezztw_279",Rre="_linkName_ezztw_315",Ore="_arrowIcon_ezztw_327",Lre="_noResults_ezztw_353",Ea={overlay:jre,content:_re,header:Cre,searchBar:kre,searchIcon:Tre,input:Ere,results:Are,list:Dre,listItem:Pre,selected:Ire,iconWrapper:Mre,linkName:Rre,arrowIcon:Ore,noResults:Lre},Fre=({isOpen:e,onClose:n,userRole:t})=>{const[r,a]=w.useState(""),[o,l]=w.useState(0),h=Ft(),d=w.useRef(null),u=w.useMemo(()=>(gw[t]||[]).flatMap(S=>S.links),[t]),f=w.useMemo(()=>r?u.filter(v=>v.name.toLowerCase().includes(r.toLowerCase())):[],[r,u]);w.useEffect(()=>{e&&(a(""),l(0),setTimeout(()=>{var v;return(v=d.current)==null?void 0:v.focus()},50))},[e]),w.useEffect(()=>{l(0)},[r]);const g=v=>{v.key==="ArrowDown"?(v.preventDefault(),l(S=>S<f.length-1?S+1:S)):v.key==="ArrowUp"?(v.preventDefault(),l(S=>S>0?S-1:S)):v.key==="Enter"&&f[o]?b(f[o].path):v.key==="Escape"&&n()},b=v=>{h(v),n()};return e?i.jsx("div",{className:Ea.overlay,onClick:n,children:i.jsxs("div",{className:Ea.content,onClick:v=>v.stopPropagation(),children:[i.jsx("div",{className:Ea.header,children:i.jsxs("div",{className:Ea.searchBar,children:[i.jsx(Pi,{size:20,className:Ea.searchIcon}),i.jsx("input",{ref:d,type:"text",placeholder:"Where would you like to go?",className:Ea.input,value:r,onChange:v=>a(v.target.value),onKeyDown:g})]})}),i.jsx("div",{className:Ea.results,children:f.length>0?i.jsx("ul",{className:Ea.list,children:f.map((v,S)=>{const T=v.icon||qP;return i.jsxs("li",{onClick:()=>b(v.path),className:`${Ea.listItem} ${S===o?Ea.selected:""}`,onMouseEnter:()=>l(S),children:[i.jsx("div",{className:Ea.iconWrapper,children:i.jsx(T,{size:18})}),i.jsx("span",{className:Ea.linkName,children:v.name}),S===o&&i.jsx(CI,{size:14,className:Ea.arrowIcon})]},v.path)})}):r&&i.jsxs("div",{className:Ea.noResults,children:[i.jsxs("p",{children:['No pages found matching "',r,'"']}),i.jsx("span",{className:"text-sm opacity-50",children:"Try searching for something else"})]})})]})}):null};function $re(){const[e,n]=w.useState(!1),[t,r]=w.useState(null),[a,o]=w.useState(!0),[l,h]=w.useState(null),[d,u]=w.useState(!1),f=P=>{r(P),n(!0),P.role==="admin"&&!P.has_seen_tutorial&&u(!0)},g=()=>{n(!1),r(null),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")};w.useEffect(()=>{const P=localStorage.getItem("authToken"),I=localStorage.getItem("currentUser");if(P&&I)try{const q=JSON.parse(I);r(q),n(!0),q.role==="admin"&&!q.has_seen_tutorial&&u(!0)}catch(q){console.error("Error parsing stored user data:",q),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")}o(!1)},[]),w.useEffect(()=>{(async()=>{if(e&&t)try{const I=await kk();h(I)}catch(I){console.error("Error fetching clinic pro plan status:",I),h({hasProPlan:!1})}else h(null)})()},[e,t]);const[b,v]=w.useState(null),[S,T]=w.useState(!1);w.useEffect(()=>{const P=I=>{I.preventDefault(),v(I),T(!0),console.log("beforeinstallprompt event fired")};return window.addEventListener("beforeinstallprompt",P),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&(console.log("App is already installed (standalone)."),T(!1)),()=>{window.removeEventListener("beforeinstallprompt",P)}},[]),w.useEffect(()=>{const P=window.matchMedia("(prefers-color-scheme: dark)"),I=()=>{P.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")};return I(),P.addEventListener("change",I),()=>{P.removeEventListener("change",I),document.body.classList.remove("dark-mode")}},[]);const E=w.useCallback(async()=>{if(!b){console.log("Install prompt event not available.");return}const P=b;P.prompt();const{outcome:I}=await P.userChoice;console.log(`User response to the install prompt: ${I}`),v(null),T(!1)},[b]),C=async()=>{if(t)try{(await ce(`/api/users/${t.id}/tutorial-seen`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({has_seen_tutorial:!0})})).ok?(r(I=>I?{...I,has_seen_tutorial:!0}:null),localStorage.setItem("currentUser",JSON.stringify({...t,has_seen_tutorial:!0})),u(!1)):console.error("Failed to update tutorial status on backend.")}catch(P){console.error("Error marking tutorial as seen:",P)}};return a?i.jsx("div",{className:"initial-app-loading-screen",children:i.jsx("img",{src:"/logo.png",alt:"Loading App",className:"initial-app-loader-logo"})}):i.jsxs(oP,{children:[i.jsx(xP,{children:i.jsxs(Ff,{children:[i.jsx(jt,{path:"/login",element:e?i.jsx(Hn,{to:"/dashboard"}):i.jsx(NP,{onLoginSuccess:f})}),i.jsx(jt,{path:"/register",element:e?i.jsx(Hn,{to:"/dashboard"}):i.jsx(SP,{})}),i.jsx(jt,{path:"/handle-complaint-url",element:e?i.jsx(Zne,{}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/live-api",element:e?i.jsx(qH,{}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/create-lab-order",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(CT,{currentUser:t})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/manage-admission",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(jT,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab/report/:orderId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(mC,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab/enter-report/:orderId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(mC,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/add-patient",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(z1,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/billing",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(kte,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab-billing",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(Ete,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/edit-complaint/:recordId",element:e&&t?i.jsx(jte,{}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/edit-pharmacy-order/:orderId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(OE,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/*",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:zre(t.role,t,ce)}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab/view-report/:orderId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(mne,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab/search-report",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(gne,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/patient/:patientId/lab-reports",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(yne,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/patient/:patientId/pharmacy-orders",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(Ate,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/inventory",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(FE,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/lab-inventory",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(Kb,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/patient/:patientId/complaints",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(_te,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/patient/:patientId/admission-bill/:billId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(wne,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/start-subscription/:patientId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(Une,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/start-clinic-subscription",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(Gne,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/refill-reminders",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(XE,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/notifications",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(eie,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/create-custom-bill",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(_T,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/pharmacy-billing/:orderId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(die,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"/dashboard/bills/:billId",element:e&&t?i.jsx(Ai,{user:t,onLogout:g,showInstallPrompt:S,onInstallClick:E,clinicProPlanStatus:l,children:i.jsx(hie,{})}):i.jsx(Hn,{to:"/login"})}),i.jsx(jt,{path:"*",element:i.jsx(Hn,{to:e?"/dashboard":"/login"})})]})}),d&&i.jsx(Kne,{onClose:()=>u(!1),onMarkAsSeen:C})]})}const zre=(e,n,t)=>{switch(e){case"superadmin":return i.jsxs(Ff,{children:[i.jsx(jt,{index:!0,element:i.jsx(Wne,{})}),i.jsx(jt,{path:"clinic-subscriptions",element:i.jsx(qne,{})}),i.jsx(jt,{path:"clinic-subscriptions/add",element:i.jsx(Vne,{})}),i.jsx(jt,{path:"clinic-subscriptions/edit/:id",element:i.jsx(Hne,{})}),i.jsx(jt,{path:"users",element:i.jsx(Yne,{})})," ",i.jsx(jt,{path:"*",element:i.jsx("div",{children:"Unknown Super Admin Section"})})]});case"admin":return i.jsxs(Ff,{children:[i.jsx(jt,{index:!0,element:i.jsx(ZH,{fetchWithAuth:t})}),i.jsx(jt,{path:"clinic-hub",element:i.jsx(ST,{fetchWithAuth:t})}),i.jsx(jt,{path:"staff/add",element:i.jsx(EY,{clinicId:n==null?void 0:n.clinic_id})}),i.jsx(jt,{path:"staff/edit/:id",element:i.jsx(AY,{})}),i.jsx(jt,{path:"patients/add",element:i.jsx(z1,{})}),i.jsx(jt,{path:"search-patient",element:i.jsx(qf,{})}),i.jsx(jt,{path:"patients",element:i.jsx(F1,{})}),i.jsx(jt,{path:"analysis",element:i.jsx(Ck,{})}),i.jsx(jt,{path:"inventory",element:i.jsx(vne,{})}),i.jsx(jt,{path:"inventory/edit/:id",element:i.jsx(TY,{})}),i.jsx(jt,{path:"recurring-medications",element:i.jsx(_C,{})}),i.jsx(jt,{path:"distributors",element:i.jsx(xC,{})}),i.jsx(jt,{path:"purchase",element:i.jsx(bC,{})})," ",i.jsx(jt,{path:"queue",element:i.jsx(I0,{})}),i.jsx(jt,{path:"subscriptions",element:i.jsx($ne,{})}),i.jsx(jt,{path:"subscriptions/add",element:i.jsx(zne,{})}),i.jsx(jt,{path:"subscriptions/edit/:id",element:i.jsx(Bne,{})}),i.jsx(jt,{path:"add-pharmacy-order",element:i.jsx(hC,{})}),i.jsx(jt,{path:"*",element:i.jsx("div",{children:"Unknown Admin Section"})})," "]});case"doctor":return i.jsxs(Ff,{children:[i.jsx(jt,{index:!0,element:i.jsx(Hn,{to:"search-patient",replace:!0})}),i.jsx(jt,{path:"search-patient",element:i.jsx(qf,{})}),i.jsx(jt,{path:"queue",element:i.jsx(I0,{})}),i.jsx(jt,{path:":patientId",element:i.jsx(I0,{})}),i.jsx(jt,{path:"add-patient",element:i.jsx(z1,{})}),i.jsx(jt,{path:"*",element:i.jsx("div",{children:"Unknown Doctor Section"})})]});case"receptionist":return i.jsxs(Ff,{children:[i.jsx(jt,{index:!0,element:i.jsx(nG,{currentUser:n})}),i.jsx(jt,{path:"all-patients",element:i.jsx(F1,{})}),i.jsx(jt,{path:"search-patient",element:i.jsx(qf,{})}),i.jsx(jt,{path:"*",element:i.jsx("div",{children:"Unknown Reception Section"})})," "]});case"lab":return i.jsx(_Y,{});case"pharmacy":return i.jsxs(Ff,{children:[i.jsx(jt,{index:!0,element:i.jsx(CY,{})}),i.jsx(jt,{path:"inventory",element:i.jsx(FE,{})}),i.jsx(jt,{path:"settings",element:i.jsx(kY,{})}),i.jsx(jt,{path:"add-order",element:i.jsx(hC,{})}),i.jsx(jt,{path:"edit-pharmacy-order/:orderId",element:i.jsx(OE,{})}),i.jsx(jt,{path:"analysis",element:i.jsx(sne,{})}),i.jsx(jt,{path:"orders/:orderId",element:i.jsx(Pne,{})}),i.jsx(jt,{path:"search-patient-records",element:i.jsx(qf,{})}),i.jsx(jt,{path:"recurring-medications",element:i.jsx(_C,{})}),i.jsx(jt,{path:"distributors",element:i.jsx(xC,{})}),i.jsx(jt,{path:"purchase",element:i.jsx(bC,{})})," ",i.jsx(jt,{path:"refill-reminders",element:i.jsx(XE,{})})," ",i.jsx(jt,{path:"*",element:i.jsx(Hn,{to:"/dashboard",replace:!0})})]});default:return i.jsxs("div",{children:["Unknown role (",e,") or dashboard not implemented."]},e)}},Ai=({user:e,onLogout:n,children:t,showInstallPrompt:r,onInstallClick:a,clinicProPlanStatus:o})=>{const l=Ft(),[h,d]=w.useState(!1),[u,f]=w.useState(!1),[g,b]=w.useState(window.innerWidth<=768),[v,S]=w.useState(!1),[T,E]=w.useState([]),[C,P]=w.useState(0),[I,q]=w.useState(!1),[L,O]=w.useState("Newtons Ai"),[B,$]=w.useState(null),[F,z]=w.useState(!1),U=w.useRef(null);w.useEffect(()=>{const W=()=>{b(window.innerWidth<=768)};return window.addEventListener("resize",W),()=>window.removeEventListener("resize",W)},[]),w.useEffect(()=>ko.subscribe(re=>{z(re)}),[]);const V=w.useCallback(async()=>{try{const W=await ce("/api/notifications");if(W.ok){const te=(await W.json()).reduce((xe,M)=>{const Se=xe.find($e=>$e.message===M.message);return Se?new Date(M.created_at)>new Date(Se.created_at)?xe.map($e=>$e.message===M.message?M:$e):xe:[...xe,M]},[]).sort((xe,M)=>{const Se={expired_drug:1,near_expiry_drug:2,low_stock:3},$e=Se[xe.type]||99,he=Se[M.type]||99;return $e!==he?$e-he:new Date(M.created_at).getTime()-new Date(xe.created_at).getTime()});E(te),P(te.filter(xe=>!xe.is_read).length)}else console.error("Failed to fetch notifications:",W.statusText)}catch(W){console.error("Error fetching notifications:",W)}},[]);w.useEffect(()=>{(async()=>{if(e!=null&&e.clinic_id)try{const re=await ce("/api/clinics/settings");if(re.ok){const A=await re.json();A.name===""?O("Newtons Ai"):O(A.name),$(A.logoUrl)}else console.error("Failed to fetch clinic details for display:",re.statusText),O("Newtons Ai"),$(null)}catch(re){console.error("Error fetching clinic details for display:",re),O("Newtons Ai"),$(null)}else O("Newtons Ai"),$(null)})()},[e==null?void 0:e.clinic_id]),w.useEffect(()=>{if(e!=null&&e.clinic_id){V();const W=setInterval(V,5*60*1e3);return()=>clearInterval(W)}},[e==null?void 0:e.clinic_id,V]);const ee=()=>{d(!h),h||(f(!1),S(!1))},ie=()=>{f(!u),u||(d(!1),S(!1))},ae=()=>{S(!v),v||(d(!1),f(!1))};w.useEffect(()=>{const W=re=>{U.current&&!U.current.contains(re.target)&&v&&S(!1)};return v&&document.addEventListener("mousedown",W),()=>{document.removeEventListener("mousedown",W)}},[v]);const J=async W=>{try{const re=await ce(`/api/notifications/${W}/read`,{method:"PUT"});re.ok?V():console.error("Failed to mark notification as read:",re.statusText)}catch(re){console.error("Error marking notification as read:",re)}},K=async()=>{q(!0);try{const W=await ce("/api/notifications/trigger-all",{method:"POST"});W.ok?(console.log("Notification checks triggered successfully."),await V()):console.error("Failed to trigger notification checks:",W.statusText)}catch(W){console.error("Error triggering notification checks:",W)}finally{q(!1)}};return i.jsxs("div",{className:"dashboard-layout",children:[" ",i.jsxs("nav",{className:"app-header no-print",children:[i.jsxs("div",{className:"header-left",children:[g&&F?i.jsx("div",{className:"global-loading-indicator",title:"Loading...",children:i.jsx("div",{className:"spinner"})}):i.jsx("a",{href:"#",onClick:W=>{W.preventDefault(),l("/dashboard")},className:"logo-container",children:i.jsx("img",{src:B||"/logo.png",alt:"App Logo",className:"logo-image"})}),i.jsxs("div",{className:"title-section",children:[i.jsx("span",{className:"app-title-link",children:L}),i.jsxs("span",{className:"user-role-panel",children:["(",e.role.charAt(0).toUpperCase()+e.role.slice(1)," Panel)"]})]})]}),i.jsxs("div",{className:"header-right",children:[!g&&F&&i.jsx("div",{className:"global-loading-indicator",title:"Loading...",children:i.jsx("div",{className:"spinner"})}),r&&i.jsxs("button",{onClick:a,className:"install-button",title:"Install App",children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),i.jsx("span",{children:"Install"})]}),o&&(o.hasProPlan?i.jsx("span",{className:"pro-badge",children:"PRO"}):i.jsx("button",{onClick:()=>l("/start-clinic-subscription"),className:"go-pro-button",children:"GoPro"})),!g&&i.jsx("button",{className:"header-search-button",onClick:ie,"aria-label":"Search pages",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),i.jsxs("div",{className:"notifications-section",ref:U,children:[" ",i.jsxs("button",{className:`notification-icon ${C>0?"pulse-animation":""}`,"aria-label":`Notifications, ${C} unread`,onClick:ae,children:[i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),C>0&&i.jsx("span",{className:"notification-count","aria-hidden":"true",children:C})]}),v&&i.jsxs("div",{className:"notifications-dropdown",children:[i.jsx("div",{className:"dropdown-header",children:"Notifications"}),i.jsx("ul",{className:"dropdown-list",children:T.length>0?T.map(W=>i.jsx("li",{className:`dropdown-item ${W.is_read?"read":"unread"}`,onClick:()=>J(W.id),children:i.jsxs("div",{className:"notification-item-content",children:[i.jsxs("div",{className:"notification-icon-wrapper",children:[W.type==="expired_drug"&&i.jsx("svg",{className:"type-icon error",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),W.type==="near_expiry_drug"&&i.jsx("svg",{className:"type-icon warning",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),W.type==="low_stock"&&i.jsx("svg",{className:"type-icon info",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})}),!["expired_drug","near_expiry_drug","low_stock"].includes(W.type)&&i.jsx("svg",{className:"type-icon default",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),i.jsxs("div",{className:"notification-text-wrapper",children:[i.jsx("p",{className:"notification-message-text",children:W.message}),i.jsx("span",{className:"notification-timestamp",children:new Date(W.created_at).toLocaleString()})]})]})},W.id)):i.jsx("li",{className:"dropdown-item",children:"No new notifications"})}),i.jsxs("div",{className:"dropdown-footer",children:[i.jsx("button",{onClick:()=>l("/dashboard/notifications"),children:"View All"}),(e.role==="admin"||e.role==="superadmin")&&i.jsx("button",{onClick:K,className:"fetch-all-button",disabled:I,children:I?"Fetching...":"Fetch All"})]})]})]}),i.jsx("button",{className:"hamburger-icon",onClick:ee,"aria-label":"Open navigation",children:i.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]})]}),i.jsx("main",{className:"main-content",children:t}),g?i.jsx(IP,{user:e,onLogout:n,userRole:e.role,isOpen:h,onClose:ee,roleNavigation:gw}):i.jsx(PP,{user:e,onLogout:n,userRole:e.role,isOpen:h,onClose:ee}),!g&&h&&i.jsx("div",{className:"side-panel-overlay",onClick:ee}),i.jsx(Fre,{isOpen:u,onClose:()=>f(!1),userRole:e.role})]})};BA.createRoot(document.getElementById("root")).render(i.jsx(w.StrictMode,{children:i.jsx(qA,{clientId:"277898779560-33obduhn8r758rini4qagetdrupvisri.apps.googleusercontent.com",children:i.jsx($re,{})})}));
