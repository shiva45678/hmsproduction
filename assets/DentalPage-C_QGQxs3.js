import{j as e,f as S,S as y,o as Oe}from"./index-B0SGsixC.js";import{r as s,u as Ue,f as $e}from"./react-vendor-Cc0P4_ZX.js";import{g as ve,D as Le}from"./DentalChart-dfOGuB_2.js";import{X,f as we,ar as Fe,ab as We,e as Ee,i as be,_ as je,af as Te,u as Ie,v as Ne,aq as Je}from"./ui-vendor-CZgqa0n4.js";import{Q as De}from"./index-CZ6CIOFr.js";/* empty css                            */import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const He=({patient:A,onClose:v,onSave:D})=>{const[N,c]=s.useState({name:A.name,age:A.age,gender:A.gender,phone:A.phone||""}),[z,u]=s.useState(!1),h=async j=>{j.preventDefault(),u(!0);try{await D({...N,phone:N.phone||void 0}),v()}catch(F){console.error(F),alert("Failed to update patient")}finally{u(!1)}};return e.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"modal-content",style:{backgroundColor:"white",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 4px 20px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",color:"#333"},children:"Edit Patient Details"}),e.jsx("button",{onClick:v,style:{border:"none",background:"none",cursor:"pointer",color:"#666"},children:e.jsx(X,{size:20})})]}),e.jsxs("form",{onSubmit:h,style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Name"}),e.jsx("input",{type:"text",value:N.name,onChange:j=>c({...N,name:j.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},required:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Age"}),e.jsx("input",{type:"number",value:N.age||"",onChange:j=>c({...N,age:parseInt(j.target.value)||0}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Gender"}),e.jsxs("select",{value:N.gender||"",onChange:j=>c({...N,gender:j.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem",width:"100%"},children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Phone"}),e.jsx("input",{type:"tel",value:N.phone,onChange:j=>c({...N,phone:j.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},placeholder:"Optional"})]}),e.jsx("button",{type:"submit",className:"save-btn",style:{marginTop:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},disabled:z,children:z?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(we,{size:18})," Save Changes"]})})]})]})})},Ge=({onClose:A,onUpdate:v})=>{const[D,N]=s.useState([]),[c,z]=s.useState(!0),[u,h]=s.useState(null),[j,F]=s.useState({}),[J,P]=s.useState(!1),[x,T]=s.useState({name:"",cost:0,type:"general"});s.useEffect(()=>{E()},[]);const E=async()=>{z(!0);try{const a=await S("/api/dental/procedures");if(a.ok){const C=await a.json();N(C)}}catch(a){console.error(a)}finally{z(!1)}},ae=async()=>{if(!(!x.name||!x.cost))try{(await S("/api/dental/procedures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).ok&&(P(!1),T({name:"",cost:0,type:"general"}),E(),v())}catch(a){console.error(a)}},V=async a=>{try{(await S(`/api/dental/procedures/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).ok&&(h(null),F({}),E(),v())}catch(C){console.error(C)}},Z=async a=>{if(window.confirm("Are you sure you want to delete this procedure?"))try{(await S(`/api/dental/procedures/${a}`,{method:"DELETE"})).ok&&(E(),v())}catch(C){console.error(C)}},K=a=>{h(a.id),F({name:a.name,cost:a.cost,type:a.type})};return e.jsx("div",{className:"manage-procedures-modal-overlay",children:e.jsxs("div",{className:"manage-procedures-modal-content",children:[e.jsxs("div",{className:"manage-procedures-modal-header",children:[e.jsx("h2",{className:"manage-procedures-modal-title",children:"Manage Procedures"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:async()=>{if(window.confirm("Import missing default procedures?"))try{await S("/api/dental/procedures/import-defaults",{method:"POST"}),E(),v()}catch(a){console.error(a)}},className:"btn-secondary",style:{padding:"6px 12px",fontSize:"0.8rem"},children:"Import Defaults"}),e.jsx("button",{onClick:A,className:"manage-procedures-close-btn",children:e.jsx(X,{size:20})})]})]}),e.jsx("div",{className:"manage-procedures-list-container",children:c?e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading procedures..."}):e.jsxs("table",{className:"manage-procedures-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Name"}),e.jsx("th",{style:{width:"20%"},children:"Type"}),e.jsx("th",{style:{width:"20%"},children:"Cost (₹)"}),e.jsx("th",{style:{width:"20%"},children:"Actions"})]})}),e.jsx("tbody",{children:D.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center",padding:"20px",color:"#888"},children:"No procedures found. Add one below."})}):D.map(a=>e.jsx("tr",{children:u===a.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",className:"edit-input",value:j.name||"",onChange:C=>F({...j,name:C.target.value}),placeholder:"Procedure Name"})}),e.jsx("td",{children:e.jsxs("select",{className:"edit-select",value:j.type||"general",onChange:C=>F({...j,type:C.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"}),e.jsx("option",{value:"bridge",children:"Bridge"}),e.jsx("option",{value:"implant",children:"Implant"})]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"edit-input",value:j.cost||0,onChange:C=>F({...j,cost:parseFloat(C.target.value)}),placeholder:"Cost"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>V(a.id),className:"action-btn btn-save",title:"Save",children:e.jsx(we,{size:18})}),e.jsx("button",{onClick:()=>h(null),className:"action-btn btn-cancel",title:"Cancel",children:e.jsx(X,{size:18})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:a.name}),e.jsx("td",{children:e.jsx("span",{className:`procedure-badge badge-${a.type}`,children:a.type})}),e.jsxs("td",{style:{fontWeight:500},children:["₹",a.cost]}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>K(a),className:"action-btn btn-edit",title:"Edit",children:e.jsx(Fe,{size:18})}),e.jsx("button",{onClick:()=>Z(a.id),className:"action-btn btn-delete",title:"Delete",children:e.jsx(We,{size:18})})]})]})},a.id))})]})}),e.jsx("div",{className:"add-procedure-section",children:J?e.jsxs("div",{className:"add-procedure-card",children:[e.jsx("h4",{className:"add-procedure-title",children:"Add New Procedure"}),e.jsxs("div",{className:"add-form-grid",children:[e.jsx("input",{type:"text",className:"form-input",placeholder:"Procedure Name",value:x.name||"",onChange:a=>T({...x,name:a.target.value})}),e.jsxs("select",{className:"form-select",value:x.type||"general",onChange:a=>T({...x,type:a.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"}),e.jsx("option",{value:"bridge",children:"Bridge"}),e.jsx("option",{value:"implant",children:"Implant"})]}),e.jsx("input",{type:"number",className:"form-input",placeholder:"Cost",value:x.cost||"",onChange:a=>T({...x,cost:parseFloat(a.target.value)})}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{onClick:ae,className:"btn-primary",children:"Save"}),e.jsx("button",{onClick:()=>P(!1),className:"btn-secondary",children:"Cancel"})]})]})]}):e.jsxs("button",{onClick:()=>P(!0),className:"add-trigger-btn",children:[e.jsx(Ee,{size:18})," Add New Procedure"]})})]})})},qe=({toothNumber:A,procedures:v,history:D=[],onSelect:N,onClose:c,numberingSystem:z="universal"})=>{const[u,h]=s.useState(""),[j,F]=s.useState(D.length>0?"history":"add"),J=ve(A,z),P=s.useMemo(()=>v.filter(x=>x.name.toLowerCase().includes(u.toLowerCase())),[v,u]);return e.jsxs("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:[e.jsxs("div",{className:"modal-content",style:{backgroundColor:"var(--dp-card-bg)",borderRadius:"12px",width:"100%",maxWidth:"400px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",animation:"scaleUp 0.2s ease-out"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--dp-border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--dp-bg)"},children:[e.jsxs("h3",{style:{margin:0,color:"var(--dp-text)",fontSize:"1.1rem"},children:["Tooth ",J]}),e.jsx("button",{onClick:c,style:{background:"none",border:"none",color:"var(--dp-text-sec)",cursor:"pointer",padding:"4px"},children:e.jsx(X,{size:20})})]}),D.length>0&&e.jsxs("div",{className:"sidebar-tabs",style:{padding:"0 16px",paddingTop:"8px",background:"var(--dp-bg)"},children:[e.jsx("button",{className:j==="add"?"active":"",onClick:()=>F("add"),style:{padding:"8px 12px",borderBottomWidth:"2px"},children:"Add Procedure"}),e.jsxs("button",{className:j==="history"?"active":"",onClick:()=>F("history"),style:{padding:"8px 12px",borderBottomWidth:"2px"},children:["History (",D.length,")"]})]}),j==="add"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--dp-border)"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx(be,{size:16,style:{position:"absolute",left:"12px",color:"var(--dp-text-sec)"}}),e.jsx("input",{type:"text",placeholder:"Search procedures...",value:u,onChange:x=>h(x.target.value),style:{width:"100%",padding:"8px 12px 8px 36px",borderRadius:"8px",border:"1px solid var(--dp-border)",backgroundColor:"var(--dp-bg)",color:"var(--dp-text)",fontSize:"0.9rem",outline:"none"},autoFocus:!0})]})}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:P.length===0?e.jsx("div",{style:{padding:"24px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.9rem"},children:"No procedures found."}):e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:P.map(x=>e.jsxs("button",{onClick:()=>N(x),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"none",background:"transparent",borderBottom:"1px solid var(--dp-border)",cursor:"pointer",textAlign:"left",transition:"background-color 0.1s"},className:"procedure-modal-item",onMouseOver:T=>T.currentTarget.style.backgroundColor="var(--dp-bg)",onMouseOut:T=>T.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--dp-text)",fontWeight:500,fontSize:"0.95rem"},children:x.name}),e.jsx("div",{style:{color:"var(--dp-text-sec)",fontSize:"0.8rem",textTransform:"capitalize"},children:x.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--dp-primary)",fontWeight:600,fontSize:"0.9rem"},children:[e.jsxs("span",{children:["₹",x.cost]}),e.jsx(Ee,{size:16})]})]},x.id))})})]}),j==="history"&&e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",padding:"0"},children:D.map((x,T)=>e.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--dp-border)"},children:[e.jsx("div",{style:{fontWeight:500,fontSize:"0.9rem"},children:x.name}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--dp-text-sec)"},children:[x.date," ",x.isPast?"(Past)":"(Current)"]})]},T))})]}),e.jsx("style",{children:`
                @keyframes scaleUp {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
            `})]})},Ve=({isOpen:A,onClose:v,recordId:D,onBillingComplete:N})=>{var ce,ne,Y,ue,xe;const[c,z]=s.useState(null),[u,h]=s.useState([]),[j,F]=s.useState(!0),[J,P]=s.useState(null),[x,T]=s.useState(!1),[E,ae]=s.useState("cash"),[V,Z]=s.useState(""),[K,a]=s.useState(""),[C,ie]=s.useState(""),[oe,H]=s.useState(""),[G,q]=s.useState(""),[B,O]=s.useState(0),ee=s.useRef(!1),[U,te]=s.useState(null),[me,re]=s.useState(!1),he=d=>{const m=Math.max(0,Math.min(100,isNaN(d)?0:d));ee.current=!0,O(m);const w=u.map(p=>({...p,discount_percentage:m}));h(w)},Q=(d,m)=>{const w=[...u];w[d].discount_percentage=isNaN(m)?0:m,h(w)};s.useEffect(()=>{if(ee.current){ee.current=!1;return}const d=u.reduce((p,M)=>p+(M.price??0),0);if(d===0){O(0);return}const w=u.reduce((p,M)=>{const R=(M.price??0)*((M.discount_percentage??0)/100);return p+R},0)/d*100;O(p=>Math.abs(p-w)>.01?w:p)},[u]);const pe=async()=>{if(!c)return P("No record data available to bill."),null;if(u.length===0)return P("Cannot bill an empty procedure list."),null;T(!0),P(null);try{const d=u.map(I=>{const R=I.price,_=R*((I.discount_percentage??0)/100),fe=R-_;return{name:I.name,price:I.price,quantity:1,total:fe,item_id:I.id||`proc_${Date.now()}`,type:"service",discount_percentage:I.discount_percentage??0}}),m={patientId:c.patientId.id,items:d,amount:$,paymentMode:E,type:"dental",related_id:c.id,status:"paid",discountPercentage:B},w=await S("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),p=await w.json();if(!w.ok||!p.id)throw new Error(p.message||"Failed to create bill.");if((await S(`/api/dental/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",billId:p.id})})).ok||console.error("Failed to update dental record status"),z(I=>I?{...I,status:"billed",billId:p.id}:null),E==="credit")try{await S(`/api/patient-debts/${c.patientId.id}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:$,related_bill_id:p.id,notes:`Dental Bill #${p.id}`})})}catch(I){console.error("Failed to create debt entry:",I)}return N&&N(),p.id}catch(d){return console.error("Billing process failed:",d),P(d.message||"Failed to create bill."),null}finally{T(!1)}},L=()=>{window.print()},ge=async()=>{await pe()&&setTimeout(()=>window.print(),800)};s.useEffect(()=>{A&&D&&(async()=>{F(!0);try{const[m,w]=await Promise.all([S(`/api/dental/${D}`),S("/api/clinics/settings").catch(()=>({ok:!1,json:async()=>({})}))]);if(!m.ok)throw new Error("Failed to fetch dental record");const p=await m.json(),M={...p,patientId:p.Patient||p.patientId};if(z(M),w.ok){const _=await w.json();a(_.upi_id||""),ie(_.name||""),H(_.address||""),q(_.notes||"")}const R=(M.selected_procedures||M.selectedProcedures||[]).map(_=>({..._,price:_.cost,discount_percentage:0}));h(R)}catch(m){console.error("Failed to fetch data:",m),P(m.message)}finally{F(!1)}})()},[A,D]);const le=s.useMemo(()=>u.reduce((d,m)=>d+(m.price??0),0),[u]),se=s.useMemo(()=>u.reduce((d,m)=>{const p=(m.price??0)*(m.discount_percentage??0)/100;return d+p},0),[u]),$=s.useMemo(()=>le-se,[le,se]);return s.useEffect(()=>{if($>0&&K){const d=`upi://pay?pa=${K}&pn=${encodeURIComponent(C)}&am=${$.toFixed(2)}&cu=INR`;Z(d)}else Z("")},[$,K,C]),s.useEffect(()=>{(async()=>{var m;if(E==="credit"&&((m=c==null?void 0:c.patientId)!=null&&m.id)){re(!0);try{const w=await S(`/api/patient-debts/${c.patientId.id}/balance`);if(w.ok){const p=await w.json();te(p.netDebt||0)}else te(0)}catch{te(0)}finally{re(!1)}}})()},[E,(ce=c==null?void 0:c.patientId)==null?void 0:ce.id]),A?e.jsx("div",{className:"dental-billing-modal-overlay",children:e.jsxs("div",{className:"dental-billing-modal-content",children:[e.jsxs("header",{className:"dental-billing-modal-header no-print",children:[e.jsx("h2",{children:"Dental Invoice"}),e.jsx("button",{onClick:v,className:"close-modal-btn",children:e.jsx(X,{size:20})})]}),e.jsx("div",{className:"dental-billing-modal-body",children:j?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsx("div",{className:"billing-container",children:e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(y,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx("div",{className:"info-item",children:e.jsx(y,{width:200,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(y,{width:150,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(y,{width:180,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(y,{width:150,height:20})})]})]}),e.jsxs("div",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(y,{width:120,height:24})})}),e.jsx("div",{className:"p-4",children:e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(y,{width:30,height:20})}),e.jsx("th",{children:e.jsx(y,{width:150,height:20})}),e.jsx("th",{children:e.jsx(y,{width:80,height:20})}),e.jsx("th",{children:e.jsx(y,{width:80,height:20})}),e.jsx("th",{children:e.jsx(y,{width:100,height:20})})]})}),e.jsx("tbody",{children:[1,2,3].map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(y,{width:20,height:20})}),e.jsx("td",{children:e.jsx(y,{width:180,height:20})}),e.jsx("td",{children:e.jsx(y,{width:70,height:20})}),e.jsx("td",{children:e.jsx(y,{width:70,height:20})}),e.jsx("td",{children:e.jsx(y,{width:90,height:20})})]},d))})]})})]})]}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(y,{width:160,height:24})})}),e.jsxs("div",{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{width:100,height:20}),e.jsx(y,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{width:100,height:20}),e.jsx(y,{width:80,height:20})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(y,{width:120,height:28}),e.jsx(y,{width:100,height:28})]})]})]})})]})})}):J?e.jsxs("div",{className:"error-message-box",children:["Error: ",J]}):c?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"DENTAL INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:C||"Clinic Name"}),(oe||G)&&e.jsxs("div",{className:"clinic-details-print",children:[oe&&e.jsx("span",{className:"small-text clinic-address",children:oe}),G&&e.jsx("span",{className:"small-text clinic-notes",children:G})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(je,{size:16})," Patient Name"]})," ",((ne=c.patientId)==null?void 0:ne.name)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Te,{size:16})," Token"]})," ",((Y=c.patientId)==null?void 0:Y.patient_token_number)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ie,{size:16})," Date"]})," ",new Date(c.date||c.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(je,{size:16})," Patient Name"]})," ",((ue=c.patientId)==null?void 0:ue.name)||"N/A"," "]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Te,{size:16})," Token"]})," ",((xe=c.patientId)==null?void 0:xe.patient_token_number)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ne,{size:16})," Record ID"]})," ",c.id.substring(c.id.length-6)]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ie,{size:16})," Date"]})," ",new Date(c.createdAt).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Procedures"})}),u.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"PROCEDURE"}),e.jsx("th",{children:"PRICE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:u.map((d,m)=>{const w=d.price??0,p=w*(d.discount_percentage??0)/100,M=w-p;return e.jsxs("tr",{children:[e.jsx("td",{children:m+1}),e.jsx("td",{children:d.name}),e.jsx("td",{children:d.price.toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:d.discount_percentage===0?"":d.discount_percentage,onChange:I=>Q(m,parseFloat(I.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsx("td",{children:M.toFixed(2)})]},m)})})]}):e.jsx("p",{className:"p-4 text-gray-500",children:"No procedures selected."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",le.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Discount (",B.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ₹",se.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ₹",$.toFixed(2)]})})]}),V&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${E!=="upi"?"hide-on-screen":""}`,children:[e.jsx(De,{value:V,size:80}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",le.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ₹",se.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:B===0?"":B,onChange:d=>he(parseFloat(d.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:x||c.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["₹",$.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:V?e.jsxs(e.Fragment,{children:[e.jsx(De,{value:V,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"UPI QR code not available."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{value:E,onChange:d=>ae(d.target.value),className:"payment-mode-select",disabled:x||c.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt)"})]})]}),E==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:"⚠️ Debt to Patient"}),me?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:U&&U>0?"#dc3545":"#28a745"},children:["₹",(U||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ₹",$.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["₹",((U||0)+$).toFixed(2)]})]})]})]}),e.jsx("div",{className:"bill-actions mt-6 flex flex-col gap-3",children:c.status!=="billed"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:L,className:"secondary-button print-preview-button no-print",disabled:x,children:"Print Preview"}),e.jsx("button",{onClick:ge,className:"primary-button",disabled:x,children:x?"Processing...":"Finalise and Bill"})]}):e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"p-3 bg-green-50 text-green-700 text-center rounded-lg font-medium border border-green-100 flex items-center justify-center gap-2",children:[e.jsx(Je,{size:20})," Bill Generated"]}),e.jsx("button",{onClick:L,className:"secondary-button print-preview-button no-print",children:"Print Preview"})]})})]})})]}),e.jsx("footer",{className:"billing-footer print-only",children:e.jsx("p",{children:"Computer generated invoice."})})]})}):e.jsx("div",{className:"error-message-box",children:"No record found."})})]})}):null},ze=/^\+?[0-9\s\-().]{7,20}$/,Qe=/^[a-zA-Z\s'-]{2,}$/,it=()=>{const A=Ue(),[v,D]=s.useState(""),[N,c]=s.useState([]),[z,u]=s.useState(!1),[h,j]=s.useState(null),[F,J]=s.useState(!1),[P,x]=s.useState(!1),[T,E]=s.useState(!1),[ae,V]=s.useState([]),[Z,K]=s.useState(!0),[a,C]=s.useState(()=>{const t=localStorage.getItem("dentalNumberingSystem");return t==="fdi"||t==="universal"?t:"universal"});s.useEffect(()=>{localStorage.setItem("dentalNumberingSystem",a)},[a]);const ie=$e();s.useEffect(()=>{ie.state&&ie.state.patient&&p(ie.state.patient)},[ie.state]);const[oe,H]=s.useState([]),[G,q]=s.useState([]),[B,O]=s.useState({}),[ee,U]=s.useState(""),[te,me]=s.useState(!1),[re,he]=s.useState("plan"),[Q,pe]=s.useState([]),[L,ge]=s.useState([]),[le,se]=s.useState(!1),[$,ce]=s.useState(!1),[ne,Y]=s.useState(null);s.useEffect(()=>{xe(),ue()},[]);const ue=async()=>{try{const t=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),n=await S(`/api/patients?${t.toString()}`);if(n.ok){const i=await n.json();V(i.patients||[])}}catch(t){console.error("Error fetching recent patients",t)}finally{K(!1)}},xe=async()=>{try{const t=await S("/api/dental/procedures");if(t.ok){const n=await t.json();ge(n)}}catch(t){console.error("Error fetching procedures",t)}};s.useEffect(()=>{(async()=>{if(!h){pe([]),Y(null),U(""),q([]),O({}),H([]);return}try{const n=await S(`/api/dental/patient/${h.id}`);if(n.ok){const i=await n.json();pe(i);const o=new Date().toDateString(),g=i.find(r=>r.status==="draft"&&new Date(r.date||r.createdAt||Date.now()).toDateString()===o);if(g){Y(g.id),U(g.notes||"");const r=g.selected_procedures.filter(l=>!g.teeth.some(k=>k.procedures.includes(l.id)));q(r.map(l=>({instanceId:crypto.randomUUID(),procedureId:l.id,name:l.name,price:l.cost,type:l.type})));const f={},b=[];g.teeth.forEach(l=>{const k=l.procedures.map(W=>{const de=g.selected_procedures.find(ye=>ye.id===W)||L.find(ye=>ye.id===W);return{instanceId:crypto.randomUUID(),procedureId:W,name:de?de.name:W,price:de?de.cost:0,type:de?de.type:"general"}});k.length>0&&(f[l.toothNumber]=k,b.push(l.toothNumber))}),O(f),H(b)}else Y(null),U(""),q([]),O({}),H([])}}catch(n){console.error("Error fetching history",n)}})()},[h,L]);const d=s.useMemo(()=>Oe(async t=>{if(!t.trim()||t.length<2){c([]),u(!1);return}u(!0);try{const n=await S(`/api/patients?search=${encodeURIComponent(t)}&limit=10`);if(n.ok){const i=await n.json();c(i.patients||[])}}catch(n){console.error("Search error:",n)}finally{u(!1)}},300),[]);s.useEffect(()=>{d(v)},[v,d]);const m=t=>{const n=t.target.value;D(n),x(ze.test(n)),E(Qe.test(n)&&!ze.test(n))},w=async t=>{if(!(!v||t==="phone"&&!P||t==="name"&&!T)){u(!0);try{const i=await S("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t==="name"?v:"direct dental",phone:t==="phone"?v:null,age:null,gender:null,token:null})});if(i.ok){const o=await i.json();p({id:o.id,name:o.name,token:o.token??null,age:o.age??null,gender:o.gender??null,phone:o.phone})}else alert("Failed to create patient")}catch(n){console.error("Error creating patient:",n),alert("Error creating patient")}finally{u(!1)}}},p=t=>{j(t),D(""),c([])},M=()=>{j(null),H([]),q([]),O({}),U("")},I=async t=>{if(!h)return;const n=await S(`/api/patients/${h.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(n.ok)await n.json(),j(i=>i?{...i,...t}:null);else throw new Error("Failed to update")},[R,_]=s.useState(null),fe=t=>{_(t)},Re=t=>{if(!R)return;const n={instanceId:crypto.randomUUID(),procedureId:t.id,name:t.name,price:t.cost,type:t.type};O(i=>{const o=i[R]||[];return{...i,[R]:[...o,n]}}),H(i=>i.includes(R)?i:[...i,R]),_(null)},Ae=()=>{const t={},n={},i=(r,f)=>{t[r]||(t[r]=[]);const b=`condition-${f}`;t[r].includes(b)||t[r].push(b)},o=(r,f)=>{n[r]||(n[r]=[]),n[r].push(f)};return[...Q].sort((r,f)=>new Date(r.date).getTime()-new Date(f.date).getTime()).forEach(r=>{r.teeth&&Array.isArray(r.teeth)&&r.teeth.forEach(f=>{f.procedures.forEach(b=>{var k;let l=(k=r.selected_procedures)==null?void 0:k.find(W=>W.id===b);l||(l=L.find(W=>W.id===b)),l&&l.type!=="general"?(i(f.toothNumber,l.type),o(f.toothNumber,{name:l.name,date:new Date(r.date||r.createdAt||0).toLocaleDateString(),recordId:r.id,isPast:!0})):b&&o(f.toothNumber,{name:`Procedure: ${b}`,date:new Date(r.date||r.createdAt||0).toLocaleDateString(),recordId:r.id,isPast:!0})})})}),Object.keys(B).forEach(r=>{const f=parseInt(r),b=B[f];b&&b.length>0&&b.forEach(l=>{l.type!=="general"&&(i(f,l.type),o(f,{name:l.name,date:"Current",isPast:!1}))})}),{conditions:t,details:n}},{conditions:Be,details:Se}=s.useMemo(()=>Ae(),[Q,B,L]),Me=t=>{const n=Q.find(r=>r.id===t);if(!n)return;U(n.notes||"");const i=n.selected_procedures.filter(r=>!n.teeth.some(f=>f.procedures.includes(r.id)));q(i.map(r=>({instanceId:crypto.randomUUID(),procedureId:r.id,name:r.name,price:r.cost,type:r.type})));const o={},g=[];n.teeth.forEach(r=>{const f=r.procedures.map(b=>{const l=n.selected_procedures.find(k=>k.id===b)||L.find(k=>k.id===b);return{instanceId:crypto.randomUUID(),procedureId:b,name:l?l.name:b,price:l?l.cost:0,type:l?l.type:"general"}});f.length>0&&(o[r.toothNumber]=f,g.push(r.toothNumber))}),O(o),H(g),he("plan")},Ce=(t,n)=>{n?(O(i=>{const o={...i};return o[n]=(i[n]||[]).filter(g=>g.instanceId!==t),o[n].length===0&&delete o[n],o}),H(i=>i)):q(i=>i.filter(o=>o.instanceId!==t))},Pe=(t,n,i)=>{i?O(o=>({...o,[i]:(o[i]||[]).map(g=>g.instanceId===t?{...g,price:n}:g)})):q(o=>o.map(g=>g.instanceId===t?{...g,price:n}:g))},_e=()=>{window.print()},ke=async(t=!0)=>{var n;if(h){me(!0);try{const o=[...G,...Object.values(B).flat()].map(l=>({id:l.procedureId,name:l.name,cost:l.price,type:l.type})),r=Object.keys(B).map(Number).map(l=>({toothNumber:l,procedures:(B[l]||[]).map(k=>k.procedureId),notes:ee})),f={patientId:h.id,teeth:r,selectedProcedures:o,notes:ee};let b;if(ne?((n=Q.find(k=>k.id===ne))==null?void 0:n.status)==="draft"?b=await S(`/api/dental/${ne}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}):b=await S("/api/dental",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}):b=await S("/api/dental",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),b.ok){const l=await b.json();Y(l.id);const k=await S(`/api/dental/patient/${h.id}`);if(k.ok){const W=await k.json();pe(W)}t?ce(!0):setTimeout(()=>alert("Notes and procedures saved successfully."),100)}else alert("Failed to save dental record.")}catch(i){console.error(i),alert("Error saving record.")}finally{me(!1)}}};return e.jsxs("div",{className:"dental-page-container printable-section",children:[e.jsxs("header",{className:"dental-header",children:[e.jsxs("div",{className:"dental-title-group",children:[e.jsx(Ne,{className:"dental-title-icon"}),e.jsxs("div",{children:[e.jsx("h1",{className:"dental-title",children:"Dental Procedure"}),e.jsx("p",{className:"dental-subtitle",children:"Create new dental records and bills"})]}),e.jsxs("div",{className:"numbering-toggle",style:{marginLeft:"auto",marginRight:"16px",display:"flex",gap:"4px",background:"var(--dp-bg-sec)",padding:"4px",borderRadius:"8px"},children:[e.jsx("button",{onClick:()=>C("universal"),style:{padding:"4px 8px",borderRadius:"6px",border:"none",background:a==="universal"?"var(--dp-card-bg)":"transparent",boxShadow:a==="universal"?"0 1px 2px rgba(0,0,0,0.1)":"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:600,color:a==="universal"?"var(--dp-text)":"var(--dp-text-sec)"},children:"Universal"}),e.jsx("button",{onClick:()=>C("fdi"),style:{padding:"4px 8px",borderRadius:"6px",border:"none",background:a==="fdi"?"var(--dp-card-bg)":"transparent",boxShadow:a==="fdi"?"0 1px 2px rgba(0,0,0,0.1)":"none",cursor:"pointer",fontSize:"0.75rem",fontWeight:600,color:a==="fdi"?"var(--dp-text)":"var(--dp-text-sec)"},children:"FDI"})]})]}),h&&e.jsxs("div",{className:"selected-patient-header-group",children:[e.jsxs("div",{className:"header-patient-info",children:[e.jsx("div",{className:"patient-avatar small",children:h.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"header-patient-text",children:[e.jsxs("div",{className:"header-patient-name-row",children:[e.jsx("span",{className:"header-patient-name",children:h.name}),e.jsx("button",{onClick:()=>J(!0),className:"icon-button-sm text-gray-500 hover:text-blue-600",title:"Edit Patient",children:e.jsx(Fe,{size:12})})]}),e.jsxs("span",{className:"header-patient-meta",children:[h.gender," / ",h.age,"y • ",h.phone]})]}),e.jsx("button",{onClick:M,className:"header-close-patient-btn",title:"Change Patient",children:e.jsx(X,{size:16})})]}),e.jsx("div",{className:"header-search-wrapper",children:e.jsxs("div",{className:"search-input-wrapper header-variant",children:[e.jsx(be,{className:"search-icon-overlay",size:16}),e.jsx("input",{type:"text",placeholder:"Search patient...",className:"dental-search-input header-input",value:v,onChange:m}),z&&e.jsx("div",{className:"search-spinner small"}),N.length>0&&e.jsx("div",{className:"search-results-dropdown header-dropdown",children:N.map(t=>e.jsxs("div",{onClick:()=>p(t),className:"search-result-item",children:[e.jsxs("div",{children:[e.jsx("span",{className:"patient-name-highlight",children:t.name}),e.jsxs("div",{className:"patient-meta",children:[t.age," yrs / ",t.gender," • ",t.phone]})]}),e.jsx(je,{size:16,color:"var(--dp-text-sec)"})]},t.id))}),v.length>=2&&!z&&N.length===0&&e.jsxs("div",{className:"search-results-dropdown header-dropdown",style:{padding:"12px",textAlign:"center"},children:[e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--dp-text-sec)",marginBottom:"8px"},children:['No match for "',v,'"']}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"8px"},children:(P||T)&&e.jsx("button",{type:"button",onClick:()=>w(P?"phone":"name"),className:"register-new-btn-sm",children:"Create"})})]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:()=>A(-1),className:"dental-back-btn no-print",children:"Back"})})]}),!h&&e.jsxs("div",{className:"patient-search-container",children:[!h&&e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:700,marginBottom:"24px",color:"var(--dp-text)"},children:"Who is this for?"}),e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(be,{className:"search-icon-overlay",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name or phone...",className:"dental-search-input",value:v,onChange:m,autoFocus:!0}),z&&e.jsx("div",{className:"search-spinner"})]}),N.length>0&&e.jsx("div",{className:"search-results-dropdown",children:N.map(t=>e.jsxs("div",{onClick:()=>p(t),className:"search-result-item",children:[e.jsxs("div",{children:[e.jsx("span",{className:"patient-name-highlight",children:t.name}),e.jsxs("div",{className:"patient-meta",children:[t.age," yrs / ",t.gender," • ",t.phone]})]}),e.jsx(je,{size:18,color:"var(--dp-text-sec)"})]},t.id))}),v.length>=2&&!z&&N.length===0&&e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsxs("p",{style:{color:"var(--dp-text-sec)",marginBottom:"15px"},children:['No patients found matching "',v,'".']}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"15px"},children:(P||T)&&e.jsxs("button",{type:"button",onClick:()=>w(P?"phone":"name"),className:"register-new-btn",style:{backgroundColor:"var(--dp-card-bg)",border:"1px solid var(--dp-primary)",padding:"8px 16px",borderRadius:"8px"},children:['Create "',v,'"']})})]}),!h&&e.jsx("div",{style:{marginTop:"32px"},children:e.jsx("button",{onClick:()=>se(!0),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Manage Procedures"})}),!h&&(Z||ae.length>0)&&e.jsxs("div",{className:"recent-registered-section",children:[e.jsx("div",{className:"recent-registered-label",children:"Recent Patients"}),e.jsx("div",{className:"recent-list",children:Z?[1,2,3].map(t=>e.jsxs("div",{className:"recent-patient-pill",style:{cursor:"default"},children:[e.jsxs("div",{className:"recent-name-container",children:[e.jsx(y,{width:100,height:18}),e.jsx(y,{width:30,height:20})]}),e.jsx("div",{className:"recent-info",children:e.jsx(y,{width:80,height:14})})]},t)):ae.map(t=>e.jsxs("div",{className:"recent-patient-pill",onClick:()=>p(t),children:[e.jsxs("div",{className:"recent-name-container",children:[e.jsx("span",{className:"recent-name",children:t.name||"New Patient"}),t.token&&e.jsxs("span",{className:"recent-token",children:["#",t.token]})]}),e.jsxs("div",{className:"recent-info",children:[t.age?`${t.age} yrs`:"",t.age&&t.gender?" / ":"",t.gender||""]})]},t.id))})]})]}),h&&e.jsx("div",{className:"dental-workspace",children:e.jsxs("div",{className:"dental-grid",children:[e.jsxs("div",{className:"chart-section",children:[e.jsx("div",{className:"dental-card chart-card-scroll",children:e.jsx(Le,{selectedTeeth:oe,toothConditions:Be,toothDetails:Se,onToothClick:fe,onEditPastRecord:Me,onPrint:_e,numberingSystem:a})}),e.jsxs("div",{className:"dental-card notes-container",children:[e.jsxs("div",{className:"notes-header",children:[e.jsx("h4",{className:"section-title-sm",children:"Clinical Notes"}),e.jsxs("button",{className:"notes-save-btn",onClick:()=>ke(!1),disabled:te,title:"Save notes and procedures without billing",children:[e.jsx(we,{size:12})," Save"]})]}),e.jsx("textarea",{className:"notes-area",placeholder:"Enter clinical findings...",value:ee,onChange:t=>U(t.target.value)})]})]}),e.jsx("div",{className:"dental-card procedures-section",children:e.jsxs("div",{className:"treatment-plan-container",style:{borderTop:"none"},children:[e.jsxs("div",{className:"sidebar-tabs",children:[e.jsx("button",{onClick:()=>he("plan"),className:re==="plan"?"active":"",children:"Treatment Plan"}),e.jsx("button",{onClick:()=>he("history"),className:re==="history"?"active":"",children:"Visit History"})]}),e.jsx("div",{className:"treatment-plan-list custom-scrollbar",children:re==="plan"?e.jsx(e.Fragment,{children:G.length===0&&Object.keys(B).length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"Select a tooth to add procedures."}):e.jsxs(e.Fragment,{children:[G.length>0&&e.jsxs("div",{className:"plan-group",children:[e.jsx("h4",{children:"General"}),G.map(t=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:t.name,children:t.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:t.price,onChange:n=>Pe(t.instanceId,parseFloat(n.target.value)||0),className:"cost-input"}),e.jsx("button",{onClick:()=>Ce(t.instanceId),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(X,{size:14})})]})]},t.instanceId))]}),Object.entries(B).map(([t,n])=>n.length===0?null:e.jsxs("div",{className:"plan-group",children:[e.jsxs("h4",{children:["Tooth ",ve(parseInt(t),a)]}),n.map(i=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:i.name,children:i.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:i.price,onChange:o=>Pe(i.instanceId,parseFloat(o.target.value)||0,parseInt(t)),className:"cost-input"}),e.jsx("button",{onClick:()=>Ce(i.instanceId,parseInt(t)),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(X,{size:14})})]})]},i.instanceId))]},t))]})}):e.jsx("div",{className:"history-list",children:Q.length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"No past visits found."}):Q.map(t=>e.jsxs("div",{className:"history-record-card",children:[e.jsxs("div",{className:"history-record-header",children:[e.jsx("span",{className:"record-date",children:new Date(t.date).toLocaleDateString()}),e.jsx("span",{className:"record-status",children:t.status})]}),e.jsxs("div",{className:"history-record-body",children:[t.teeth.map(n=>e.jsxs("div",{className:"history-tooth-group",children:[e.jsxs("strong",{children:["Tooth ",ve(n.toothNumber,a),":"]})," ",n.procedures.map(i=>{const o=t.selected_procedures.find(g=>g.id===i)||L.find(g=>g.id===i);return o?o.name:i}).join(", ")]},n.toothNumber)),t.notes&&e.jsx("p",{className:"history-notes",children:e.jsxs("em",{children:["Notes: ",t.notes]})}),t.status==="billed"&&e.jsx("div",{className:"history-record-actions mt-3",children:e.jsxs("button",{onClick:()=>{Y(t.id),ce(!0)},className:"view-bill-btn",children:[e.jsx(Ne,{size:14})," View Bill"]})})]})]},t.id))})}),e.jsx("div",{className:"action-footer",children:e.jsx("button",{onClick:()=>ke(!0),className:"save-btn",disabled:te||G.length===0&&Object.keys(B).length===0,children:te?"Saving...":"Save & Bill"})})]})})]})}),F&&h&&e.jsx(He,{patient:h,onClose:()=>J(!1),onSave:I}),le&&e.jsx(Ge,{onClose:()=>se(!1),onUpdate:xe}),R!==null&&e.jsx(qe,{toothNumber:R,procedures:L.map(t=>({id:t.id,name:t.name,cost:t.cost,type:t.type})),history:Se[R]||[],onSelect:Re,onClose:()=>_(null),numberingSystem:a}),e.jsx(Ve,{isOpen:$,recordId:ne,onClose:()=>{ce(!1),M()},onBillingComplete:()=>{}})]})};export{it as default};
