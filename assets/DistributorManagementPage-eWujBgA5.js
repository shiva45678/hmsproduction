import{f as c,j as e,S as d,E as fe}from"./index-B0SGsixC.js";import{u as De,r as t}from"./react-vendor-Cc0P4_ZX.js";import{W as Ce,a0 as _e,az as we,a1 as Pe,ag as Fe,aK as Se,m as ke,ab as Ee}from"./ui-vendor-CZgqa0n4.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Le=()=>{const ne=De(),[m,re]=t.useState([]),[ie,V]=t.useState(!0),[i,l]=t.useState(null),[E,L]=t.useState(!1),[de,$]=t.useState(!1),[oe,z]=t.useState(!1),[ce,I]=t.useState(!1),[me,G]=t.useState(!1),[ue,R]=t.useState(!1),[r,o]=t.useState(null),[J,W]=t.useState([]),[h,q]=t.useState(null),[j,b]=t.useState(""),[g,N]=t.useState(""),[y,v]=t.useState(""),[f,D]=t.useState(""),[C,_]=t.useState(""),[w,P]=t.useState(""),[F,S]=t.useState(""),[U,H]=t.useState(""),[K,Q]=t.useState(""),[X,Y]=t.useState(""),[Z,ee]=t.useState(""),[ae,se]=t.useState("cash"),u=t.useCallback(async()=>{V(!0),l(null);try{const a=await c("/api/distributors");if(!a.ok)throw new Error(`Failed to fetch distributors: ${a.statusText}`);const s=await a.json();re(s)}catch(a){console.error("Failed to fetch distributors:",a),l(a.message||"Failed to load distributors.")}finally{V(!1)}},[]);t.useEffect(()=>{u()},[u]);const pe=async a=>{a.preventDefault(),l(null);try{const s=await c("/api/distributors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j,contact_person:g,phone:y,email:f,address:C,gst_number:w,drug_license_number:F})});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to add distributor.")}A(),u()}catch(s){console.error("Error adding distributor:",s),l(s.message||"Failed to add distributor.")}},he=async a=>{if(a.preventDefault(),l(null),!!r)try{const s=await c(`/api/distributors/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:j,contact_person:g,phone:y,email:f,address:C,gst_number:w,drug_license_number:F})});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to update distributor.")}M(),u()}catch(s){console.error("Error updating distributor:",s),l(s.message||"Failed to update distributor.")}},xe=async()=>{if(l(null),!!r)try{const a=await c(`/api/distributors/${r.id}`,{method:"DELETE"});if(!a.ok){const s=await a.json();throw new Error(s.message||"Failed to delete distributor.")}B(),u()}catch(a){console.error("Error deleting distributor:",a),l(a.message||"Failed to delete distributor.")}},te=t.useCallback(async a=>{l(null);try{const s=await c(`/api/distributors/${a}/payments`);if(!s.ok)throw new Error(`Failed to fetch payments: ${s.statusText}`);const p=(await s.json()).map(k=>({...k,order_value:parseFloat(k.order_value),amount_paid:parseFloat(k.amount_paid),balance_remaining:parseFloat(k.balance_remaining)}));W(p);const x=await c(`/api/distributors/${a}/balance`);if(!x.ok)throw new Error(`Failed to fetch balance: ${x.statusText}`);const T=await x.json();q({totalOrderValue:parseFloat(T.totalOrderValue),totalAmountPaid:parseFloat(T.totalAmountPaid),remainingBalance:parseFloat(T.remainingBalance)})}catch(s){console.error("Error fetching payments/balance:",s),l(s.message||"Failed to load payments or balance.")}},[]),je=async a=>{if(a.preventDefault(),l(null),!!r)try{const s=await c(`/api/distributors/${r.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:U,order_value:parseFloat(K||"0"),amount_paid:parseFloat(X||"0"),notes:Z,payment_mode:ae})});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to add payment.")}O(),te(r.id)}catch(s){console.error("Error adding payment:",s),l(s.message||"Failed to add payment.")}},be=()=>{b(""),N(""),v(""),D(""),_(""),P(""),S(""),l(null),$(!0)},A=()=>{$(!1)},ge=a=>{o(a),b(a.name),N(a.contact_person||""),v(a.phone||""),D(a.email||""),_(a.address||""),P(a.gst_number||""),S(a.drug_license_number||""),l(null),z(!0)},M=()=>{z(!1),o(null)},Ne=a=>{o(a),l(null),I(!0)},B=()=>{I(!1),o(null)},ye=a=>{o(a),te(a.id),l(null),G(!0)},le=()=>{G(!1),o(null),W([]),q(null)},ve=a=>{o(a),H(new Date().toISOString().split("T")[0]),Q("0"),Y("0"),ee(""),se("cash"),l(null),R(!0)},O=()=>{R(!1),o(null)};return ie?e.jsxs("div",{id:"distributor-page-container",children:[e.jsxs("div",{className:"distributor-header",style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(d,{width:80,height:36}),e.jsx(d,{width:200,height:32})]}),e.jsxs("div",{className:"header-actions",children:[e.jsx(d,{width:150,height:36}),e.jsx(d,{width:150,height:36}),e.jsx(d,{width:180,height:36})]})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"dmp-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(d,{width:150,height:20})}),e.jsx("td",{children:e.jsx(d,{width:120,height:20})}),e.jsx("td",{children:e.jsx(d,{width:100,height:20})}),e.jsx("td",{children:e.jsx(d,{width:180,height:20})}),e.jsx("td",{children:e.jsx(d,{width:80,height:20})}),e.jsx("td",{children:e.jsx(d,{width:100,height:30})})]},a))})]})})]}):i?e.jsxs("div",{className:"error-indicator",children:["Error: ",i]}):e.jsxs("div",{id:"distributor-page-container",children:[e.jsxs("div",{className:"distributor-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>ne(-1),className:"dmp-button dmp-button-secondary",title:"Go Back",children:[e.jsx(Ce,{size:20})," Back"]}),e.jsx("h2",{children:"Distributor Management"})]}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("div",{className:"view-mode-toggle",style:{display:"flex",gap:"8px"},children:[e.jsxs("button",{onClick:()=>L(!1),className:`dmp-button ${E?"dmp-button-secondary":"dmp-button-primary"}`,title:"List View",children:[e.jsx(_e,{size:18})," List"]}),e.jsxs("button",{onClick:()=>L(!0),className:`dmp-button ${E?"dmp-button-primary":"dmp-button-secondary"}`,title:"Excel Mode (Edit)",children:[e.jsx(we,{size:18})," Excel"]})]}),e.jsxs("button",{onClick:be,className:"dmp-button dmp-button-primary",children:[e.jsx(Pe,{size:18}),"Add Distributor"]})]})]}),(()=>{const a=m.reduce((n,p)=>n+parseFloat(p.remainingBalance||"0"),0),s=a>=0;return e.jsxs("div",{className:"stats-container",children:[e.jsxs("div",{className:`stat-card ${s?"positive":"negative"}`,children:[e.jsx("span",{className:"label",children:"Total Balance"}),e.jsxs("span",{className:"value",children:["₹",a.toFixed(2)]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"label",children:"Total Distributors"}),e.jsx("span",{className:"value",children:m.length})]})]})})(),e.jsx("div",{className:"table-wrapper",children:E?e.jsx(fe,{columns:[{key:"name",label:"Name",editable:!0,type:"text"},{key:"contact_person",label:"Contact Person",editable:!0,type:"text"},{key:"phone",label:"Phone",editable:!0,type:"text"},{key:"email",label:"Email",editable:!0,type:"text"},{key:"address",label:"Address",editable:!0,type:"text"},{key:"gst_number",label:"GST Number",editable:!0,type:"text"},{key:"drug_license_number",label:"Drug License",editable:!0,type:"text"}],data:m,editable:!0,showRowNumbers:!0,title:"Distributors",onSave:async a=>{const s=a.map(async n=>{const p=m.find(x=>x.id===n.id);if(p&&JSON.stringify(p)!==JSON.stringify(n))return c(`/api/distributors/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})});try{await Promise.all(s),u()}catch(n){alert("Error saving changes"),console.error(n)}}}):e.jsxs("table",{className:"dmp-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name / Contact"}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Tax / License"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"2rem",color:"var(--dmp-text-secondary)"},children:"No distributors found."})}):m.map(a=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"primary-text",children:a.name}),e.jsx("div",{className:"secondary-text",children:a.contact_person})]}),e.jsxs("td",{children:[e.jsx("div",{className:"secondary-text",children:a.phone||"-"}),e.jsx("div",{className:"secondary-text",children:a.email||"-"}),e.jsx("div",{className:"secondary-text",children:a.address||"-"})]}),e.jsxs("td",{children:[e.jsxs("div",{className:"secondary-text",children:["GST: ",a.gst_number||"-"]}),e.jsxs("div",{className:"secondary-text",children:["DL: ",a.drug_license_number||"-"]})]}),e.jsx("td",{children:e.jsxs("span",{className:`status-badge ${parseFloat(a.remainingBalance||"0")>0?"balance-ok":"balance-owed"}`,children:["₹",a.remainingBalance||"0.00"]})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:()=>ye(a),className:"dmp-button-icon",title:"View Payments & Balance",children:e.jsx(Fe,{size:18})}),e.jsx("button",{onClick:()=>ve(a),className:"dmp-button-icon",title:"Add Payment",children:e.jsx(Se,{size:18})}),e.jsx("button",{onClick:()=>ge(a),className:"dmp-button-icon edit",title:"Edit Distributor",children:e.jsx(ke,{size:18})}),e.jsx("button",{onClick:()=>Ne(a),className:"dmp-button-icon delete",title:"Delete Distributor",children:e.jsx(Ee,{size:18})})]})})]},a.id))})]})}),de&&e.jsx("div",{className:"dmp-modal-overlay",children:e.jsxs("div",{className:"dmp-modal",children:[e.jsx("button",{onClick:A,className:"dmp-modal-close",children:"×"}),e.jsx("h3",{className:"dmp-modal-title",children:"Add New Distributor"}),i&&e.jsx("div",{className:"error-indicator",style:{marginBottom:"1rem"},children:i}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"name",children:"Name:"}),e.jsx("input",{type:"text",id:"name",className:"dmp-input",value:j,onChange:a=>b(a.target.value),required:!0})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"contact_person",className:"dmp-input",value:g,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",className:"dmp-input",value:y,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",className:"dmp-input",value:f,onChange:a=>D(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"address",children:"Address:"}),e.jsx("textarea",{id:"address",className:"dmp-textarea",value:C,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"gst_number",className:"dmp-input",value:w,onChange:a=>P(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"drug_license_number",className:"dmp-input",value:F,onChange:a=>S(a.target.value)})]}),e.jsxs("div",{className:"dmp-modal-actions",children:[e.jsx("button",{type:"button",onClick:A,className:"dmp-button dmp-button-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"dmp-button dmp-button-primary",children:"Add Distributor"})]})]})]})}),oe&&r&&e.jsx("div",{className:"dmp-modal-overlay",children:e.jsxs("div",{className:"dmp-modal",children:[e.jsx("button",{onClick:M,className:"dmp-modal-close",children:"×"}),e.jsx("h3",{className:"dmp-modal-title",children:"Edit Distributor"}),i&&e.jsx("div",{className:"error-indicator",style:{marginBottom:"1rem"},children:i}),e.jsxs("form",{onSubmit:he,children:[e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-name",children:"Name:"}),e.jsx("input",{type:"text",id:"edit-name",className:"dmp-input",value:j,onChange:a=>b(a.target.value),required:!0})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"edit-contact_person",className:"dmp-input",value:g,onChange:a=>N(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"edit-phone",className:"dmp-input",value:y,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-email",children:"Email:"}),e.jsx("input",{type:"email",id:"edit-email",className:"dmp-input",value:f,onChange:a=>D(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-address",children:"Address:"}),e.jsx("textarea",{id:"edit-address",className:"dmp-textarea",value:C,onChange:a=>_(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"edit-gst_number",className:"dmp-input",value:w,onChange:a=>P(a.target.value)})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"edit-drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"edit-drug_license_number",className:"dmp-input",value:F,onChange:a=>S(a.target.value)})]}),e.jsxs("div",{className:"dmp-modal-actions",children:[e.jsx("button",{type:"button",onClick:M,className:"dmp-button dmp-button-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"dmp-button dmp-button-primary",children:"Save Changes"})]})]})]})}),ce&&r&&e.jsx("div",{className:"dmp-modal-overlay",children:e.jsxs("div",{className:"dmp-modal",children:[e.jsx("button",{onClick:B,className:"dmp-modal-close",children:"×"}),e.jsx("h3",{className:"dmp-modal-title",children:"Confirm Delete"}),e.jsxs("p",{children:['Are you sure you want to delete distributor "',r.name,'"?']}),i&&e.jsx("div",{className:"error-indicator",style:{marginBottom:"1rem"},children:i}),e.jsxs("div",{className:"dmp-modal-actions",children:[e.jsx("button",{type:"button",onClick:B,className:"dmp-button dmp-button-secondary",children:"Cancel"}),e.jsx("button",{type:"button",onClick:xe,className:"dmp-button dmp-button-primary",style:{backgroundColor:"var(--dmp-danger-color)"},children:"Delete"})]})]})}),me&&r&&e.jsx("div",{className:"dmp-modal-overlay",children:e.jsxs("div",{className:"dmp-modal",style:{maxWidth:"900px"},children:[e.jsx("button",{onClick:le,className:"dmp-modal-close",children:"×"}),e.jsxs("h3",{className:"dmp-modal-title",children:["Payments & Balance for ",r.name]}),i&&e.jsx("div",{className:"error-indicator",style:{marginBottom:"1rem"},children:i}),h&&e.jsxs("div",{className:"stats-container",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"label",children:"Total Order Value"}),e.jsxs("span",{className:"value",children:["₹",h.totalOrderValue.toFixed(2)]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("span",{className:"label",children:"Total Amount Paid"}),e.jsxs("span",{className:"value",children:["₹",h.totalAmountPaid.toFixed(2)]})]}),e.jsxs("div",{className:`stat-card ${h.remainingBalance>0?"positive":"negative"}`,children:[e.jsx("span",{className:"label",children:"Remaining Balance"}),e.jsxs("span",{className:"value",children:["₹",h.remainingBalance.toFixed(2)]})]})]}),e.jsx("h4",{children:"Payment History"}),J.length===0?e.jsx("p",{children:"No payments recorded for this distributor."}):e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"dmp-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Order Value"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Balance Remaining"}),e.jsx("th",{children:"Payment Mode"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:J.map(a=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Date",children:new Date(a.payment_date).toLocaleDateString()}),e.jsxs("td",{"data-label":"Order Value",children:["₹",a.order_value.toFixed(2)]}),e.jsxs("td",{"data-label":"Amount Paid",children:["₹",a.amount_paid.toFixed(2)]}),e.jsxs("td",{"data-label":"Balance Remaining",children:["₹",a.balance_remaining.toFixed(2)]}),e.jsx("td",{"data-label":"Payment Mode",children:a.payment_mode?a.payment_mode.charAt(0).toUpperCase()+a.payment_mode.slice(1):"-"}),e.jsx("td",{"data-label":"Notes",children:a.notes||"-"})]},a.id))})]})}),e.jsx("div",{className:"dmp-modal-actions",children:e.jsx("button",{type:"button",onClick:le,className:"dmp-button dmp-button-secondary",children:"Close"})})]})}),ue&&r&&e.jsx("div",{className:"dmp-modal-overlay",children:e.jsxs("div",{className:"dmp-modal",style:{maxWidth:"420px"},children:[e.jsx("button",{onClick:O,className:"dmp-modal-close",children:"×"}),e.jsx("h3",{className:"dmp-modal-title",children:"Add Payment"}),i&&e.jsx("div",{className:"error-indicator",style:{marginBottom:"1rem"},children:i}),e.jsxs("form",{onSubmit:je,children:[e.jsxs("div",{className:"form-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"payment_date",children:"Date:"}),e.jsx("input",{type:"date",id:"payment_date",className:"dmp-input",value:U,onChange:a=>H(a.target.value),required:!0})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"payment_mode",children:"Mode:"}),e.jsxs("select",{id:"payment_mode",className:"dmp-select",value:ae,onChange:a=>se(a.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]})]}),e.jsxs("div",{className:"form-row",style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"order_value",children:"Order Value:"}),e.jsx("input",{type:"number",id:"order_value",className:"dmp-input",value:K,onChange:a=>Q(a.target.value),step:"0.01"})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"amount_paid",children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount_paid",className:"dmp-input",value:X,onChange:a=>Y(a.target.value),step:"0.01"})]})]}),e.jsxs("div",{className:"dmp-form-group",children:[e.jsx("label",{className:"dmp-label",htmlFor:"payment_notes",children:"Notes:"}),e.jsx("textarea",{id:"payment_notes",className:"dmp-textarea",value:Z,onChange:a=>ee(a.target.value),rows:2,style:{resize:"none"}})]}),e.jsxs("div",{className:"dmp-modal-actions",children:[e.jsx("button",{type:"button",onClick:O,className:"dmp-button dmp-button-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"dmp-button dmp-button-primary",children:"Add Payment"})]})]})]})})]})};export{Le as default};
