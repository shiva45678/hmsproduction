import{j as e}from"./index-DE8wu5Ou.js";import{j as C,u as S,r}from"./react-vendor-Cc0P4_ZX.js";import{a as z,u as F}from"./subscriptionApi-D456Iqzk.js";/* empty css                           */import{z as _,E as I,X as w,W as D}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const M=()=>{const{id:c}=C(),h=S(),[j,f]=r.useState(null),[a,v]=r.useState({}),[u,p]=r.useState(!1),[b,m]=r.useState(!0),[o,t]=r.useState(null),[n,l]=r.useState(null),g=r.useCallback(async()=>{if(!c){t("Plan ID is missing."),m(!1);return}m(!0),t(null);try{const s=await z(c);f(s),v({name:s.name,description:s.description||"",price:s.price,period:s.period,interval:s.interval,razorpay_plan_id:s.razorpay_plan_id||"",status:s.status})}catch(s){t(s.message||"Failed to fetch plan details."),l({type:"error",message:s.message||"Failed to fetch plan details."})}finally{m(!1)}},[c]);r.useEffect(()=>{g()},[g]),r.useEffect(()=>{if(n){const s=setTimeout(()=>l(null),5e3);return()=>clearTimeout(s)}},[n]);const i=s=>{const{name:x,value:d}=s.target;v(P=>({...P,[x]:d}))},y=async s=>{if(s.preventDefault(),!c){t("Plan ID is missing.");return}if(p(!0),t(null),l(null),!a.name||!a.price||!a.period||a.interval===void 0||a.interval<=0){t("Please fill in all required fields (Name, Price, Period, Interval > 0)."),p(!1);return}try{await F(c,a),l({type:"success",message:"Plan updated successfully! Redirecting..."}),setTimeout(()=>{h(-1)},2e3)}catch(x){const d=x.message||"Failed to update plan.";t(d),l({type:"error",message:d})}finally{p(!1)}},N=()=>{h(-1)};return b?e.jsx("div",{className:"p-6 text-center",children:"Loading plan details..."}):o&&!j?e.jsx("div",{className:"p-6 text-center text-red-500",children:o}):j?e.jsxs("div",{className:"subscription-page-container",children:[n&&e.jsxs("div",{className:`${n.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[n.type==="success"?e.jsx(_,{size:18,className:"mr-2"}):e.jsx(I,{size:18,className:"mr-2"}),e.jsx("span",{children:n.message})]}),e.jsx("button",{onClick:()=>l(null),className:"ml-4",children:e.jsx(w,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Edit Subscription Plan"}),o&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:o}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name||"",onChange:i,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description||"",onChange:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:a.price!==void 0?a.price:"",onChange:i,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:a.period||"monthly",onChange:i,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:a.interval||1,onChange:i,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:a.razorpay_plan_id||"",onChange:i})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:a.status||"active",onChange:i,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:N,className:"subscription-btn subscription-btn-secondary",children:e.jsx(D,{size:16})}),e.jsxs("button",{type:"submit",disabled:u,className:"subscription-btn",children:[u?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,u?"Saving...":"Save Changes"]})]})]})]})]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Plan not found."})};export{M as default};
