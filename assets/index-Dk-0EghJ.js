var hw=Object.defineProperty;var mw=(t,s,n)=>s in t?hw(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var Gt=(t,s,n)=>mw(t,typeof s!="symbol"?s+"":s,n);import{d as pw,e as fw,r as y,b as en,u as ot,g as Sc,f as za,L as us,O as gw,h as Qn,i as xw,B as yw,j as Dl,k as Ye,N as Pt}from"./react-vendor-Bn2uLbq_.js";import{G as uf,T as yd,M as bd}from"./ai-vendor-CB5T-uN5.js";import{B as jd,R as Wj,X as Et,L as Va,P as Td,S as bw,a as Ad,r as jw,b as Zj,M as vw,c as kc,d as Nw,V as ww,e as Sw,f as kw,g as Cw,h as _w,i as mn,j as ds,k as Dw,A as qy,U as Bl,l as df,m as Ew,n as vr,o as Tp,C as Li,T as Tw,F as Ga,p as hs,q as e0,s as Aw,G as va,t as aa,u as pn,H as t0,v as n0,w as Ap,x as hf,y as Pw,z as Nr,D as vt,E as Oa,I as Iw,J as Pp,K as Hy,N as Pd,O as Ul,Q as a0,W as s0,Y as Ia,Z as on,_ as Ow,$ as zw,a0 as ya,a1 as Rw,a2 as i0,a3 as Ll,a4 as Lw,a5 as $w,a6 as cs,a7 as mf,a8 as wr,a9 as qa,aa as r0,ab as ls,ac as pf,ad as Vy,ae as Gy,af as Fw,ag as Id,ah as Ip,ai as Qy,aj as Yy,ak as jc,al as Mw,am as l0,an as Jy,ao as vd,ap as zm,aq as Bw,ar as Uw,as as qw,at as Hw,au as Vw,av as o0,aw as Gw,ax as c0,ay as Qw,az as Yw,aA as Jw,aB as Xw,aC as Kw}from"./ui-vendor-CRVNbJRW.js";import{r as Ww,E as u0,a as Zw,b as eS,f as jr,c as tS,p as Xy,i as Ky,d as Rm}from"./utils-vendor-Bgqozsj_.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=n(o);fetch(o.href,u)}})();var Lm={exports:{}},sc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wy;function nS(){if(Wy)return sc;Wy=1;var t=Symbol.for("react.transitional.element"),s=Symbol.for("react.fragment");function n(r,o,u){var c=null;if(u!==void 0&&(c=""+u),o.key!==void 0&&(c=""+o.key),"key"in o){u={};for(var d in o)d!=="key"&&(u[d]=o[d])}else u=o;return o=u.ref,{$$typeof:t,type:r,key:c,ref:o!==void 0?o:null,props:u}}return sc.Fragment=s,sc.jsx=n,sc.jsxs=n,sc}var Zy;function aS(){return Zy||(Zy=1,Lm.exports=nS()),Lm.exports}var e=aS(),$m={exports:{}},ic={},Fm={exports:{}},Mm={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var eb;function sS(){return eb||(eb=1,function(t){function s(L,M){var Z=L.length;L.push(M);e:for(;0<Z;){var Q=Z-1>>>1,S=L[Q];if(0<o(S,M))L[Q]=M,L[Z]=S,Z=Q;else break e}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var M=L[0],Z=L.pop();if(Z!==M){L[0]=Z;e:for(var Q=0,S=L.length,ge=S>>>1;Q<ge;){var fe=2*(Q+1)-1,w=L[fe],ue=fe+1,Ne=L[ue];if(0>o(w,Z))ue<S&&0>o(Ne,w)?(L[Q]=Ne,L[ue]=Z,Q=ue):(L[Q]=w,L[fe]=Z,Q=fe);else if(ue<S&&0>o(Ne,Z))L[Q]=Ne,L[ue]=Z,Q=ue;else break e}}return M}function o(L,M){var Z=L.sortIndex-M.sortIndex;return Z!==0?Z:L.id-M.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var u=performance;t.unstable_now=function(){return u.now()}}else{var c=Date,d=c.now();t.unstable_now=function(){return c.now()-d}}var p=[],m=[],f=1,g=null,x=3,j=!1,N=!1,k=!1,D=!1,_=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,E=typeof setImmediate<"u"?setImmediate:null;function U(L){for(var M=n(m);M!==null;){if(M.callback===null)r(m);else if(M.startTime<=L)r(m),M.sortIndex=M.expirationTime,s(p,M);else break;M=n(m)}}function X(L){if(k=!1,U(L),!N)if(n(p)!==null)N=!0,I||(I=!0,P());else{var M=n(m);M!==null&&R(X,M.startTime-L)}}var I=!1,F=-1,B=5,G=-1;function C(){return D?!0:!(t.unstable_now()-G<B)}function A(){if(D=!1,I){var L=t.unstable_now();G=L;var M=!0;try{e:{N=!1,k&&(k=!1,T(F),F=-1),j=!0;var Z=x;try{t:{for(U(L),g=n(p);g!==null&&!(g.expirationTime>L&&C());){var Q=g.callback;if(typeof Q=="function"){g.callback=null,x=g.priorityLevel;var S=Q(g.expirationTime<=L);if(L=t.unstable_now(),typeof S=="function"){g.callback=S,U(L),M=!0;break t}g===n(p)&&r(p),U(L)}else r(p);g=n(p)}if(g!==null)M=!0;else{var ge=n(m);ge!==null&&R(X,ge.startTime-L),M=!1}}break e}finally{g=null,x=Z,j=!1}M=void 0}}finally{M?P():I=!1}}}var P;if(typeof E=="function")P=function(){E(A)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,J=$.port2;$.port1.onmessage=A,P=function(){J.postMessage(null)}}else P=function(){_(A,0)};function R(L,M){F=_(function(){L(t.unstable_now())},M)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_next=function(L){switch(x){case 1:case 2:case 3:var M=3;break;default:M=x}var Z=x;x=M;try{return L()}finally{x=Z}},t.unstable_requestPaint=function(){D=!0},t.unstable_runWithPriority=function(L,M){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var Z=x;x=L;try{return M()}finally{x=Z}},t.unstable_scheduleCallback=function(L,M,Z){var Q=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?Q+Z:Q):Z=Q,L){case 1:var S=-1;break;case 2:S=250;break;case 5:S=1073741823;break;case 4:S=1e4;break;default:S=5e3}return S=Z+S,L={id:f++,callback:M,priorityLevel:L,startTime:Z,expirationTime:S,sortIndex:-1},Z>Q?(L.sortIndex=Z,s(m,L),n(p)===null&&L===n(m)&&(k?(T(F),F=-1):k=!0,R(X,Z-Q))):(L.sortIndex=S,s(p,L),N||j||(N=!0,I||(I=!0,P()))),L},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(L){var M=x;return function(){var Z=x;x=M;try{return L.apply(this,arguments)}finally{x=Z}}}}(Mm)),Mm}var tb;function iS(){return tb||(tb=1,Fm.exports=sS()),Fm.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nb;function rS(){if(nb)return ic;nb=1;var t=iS(),s=pw(),n=fw();function r(a){var i="https://react.dev/errors/"+a;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)i+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+a+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function u(a){var i=a,l=a;if(a.alternate)for(;i.return;)i=i.return;else{a=i;do i=a,(i.flags&4098)!==0&&(l=i.return),a=i.return;while(a)}return i.tag===3?l:null}function c(a){if(a.tag===13){var i=a.memoizedState;if(i===null&&(a=a.alternate,a!==null&&(i=a.memoizedState)),i!==null)return i.dehydrated}return null}function d(a){if(u(a)!==a)throw Error(r(188))}function p(a){var i=a.alternate;if(!i){if(i=u(a),i===null)throw Error(r(188));return i!==a?null:a}for(var l=a,h=i;;){var b=l.return;if(b===null)break;var v=b.alternate;if(v===null){if(h=b.return,h!==null){l=h;continue}break}if(b.child===v.child){for(v=b.child;v;){if(v===l)return d(b),a;if(v===h)return d(b),i;v=v.sibling}throw Error(r(188))}if(l.return!==h.return)l=b,h=v;else{for(var z=!1,H=b.child;H;){if(H===l){z=!0,l=b,h=v;break}if(H===h){z=!0,h=b,l=v;break}H=H.sibling}if(!z){for(H=v.child;H;){if(H===l){z=!0,l=v,h=b;break}if(H===h){z=!0,h=v,l=b;break}H=H.sibling}if(!z)throw Error(r(189))}}if(l.alternate!==h)throw Error(r(190))}if(l.tag!==3)throw Error(r(188));return l.stateNode.current===l?a:i}function m(a){var i=a.tag;if(i===5||i===26||i===27||i===6)return a;for(a=a.child;a!==null;){if(i=m(a),i!==null)return i;a=a.sibling}return null}var f=Object.assign,g=Symbol.for("react.element"),x=Symbol.for("react.transitional.element"),j=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),T=Symbol.for("react.consumer"),E=Symbol.for("react.context"),U=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),B=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),C=Symbol.for("react.memo_cache_sentinel"),A=Symbol.iterator;function P(a){return a===null||typeof a!="object"?null:(a=A&&a[A]||a["@@iterator"],typeof a=="function"?a:null)}var $=Symbol.for("react.client.reference");function J(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===$?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case N:return"Fragment";case D:return"Profiler";case k:return"StrictMode";case X:return"Suspense";case I:return"SuspenseList";case G:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case j:return"Portal";case E:return(a.displayName||"Context")+".Provider";case T:return(a._context.displayName||"Context")+".Consumer";case U:var i=a.render;return a=a.displayName,a||(a=i.displayName||i.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case F:return i=a.displayName||null,i!==null?i:J(a.type)||"Memo";case B:i=a._payload,a=a._init;try{return J(a(i))}catch{}}return null}var R=Array.isArray,L=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},Q=[],S=-1;function ge(a){return{current:a}}function fe(a){0>S||(a.current=Q[S],Q[S]=null,S--)}function w(a,i){S++,Q[S]=a.current,a.current=i}var ue=ge(null),Ne=ge(null),K=ge(null),Y=ge(null);function V(a,i){switch(w(K,i),w(Ne,a),w(ue,null),i.nodeType){case 9:case 11:a=(a=i.documentElement)&&(a=a.namespaceURI)?xy(a):0;break;default:if(a=i.tagName,i=i.namespaceURI)i=xy(i),a=yy(i,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}fe(ue),w(ue,a)}function oe(){fe(ue),fe(Ne),fe(K)}function Pe(a){a.memoizedState!==null&&w(Y,a);var i=ue.current,l=yy(i,a.type);i!==l&&(w(Ne,a),w(ue,l))}function se(a){Ne.current===a&&(fe(ue),fe(Ne)),Y.current===a&&(fe(Y),Zo._currentValue=Z)}var Ce=Object.prototype.hasOwnProperty,ee=t.unstable_scheduleCallback,je=t.unstable_cancelCallback,Ie=t.unstable_shouldYield,$e=t.unstable_requestPaint,Fe=t.unstable_now,Be=t.unstable_getCurrentPriorityLevel,qe=t.unstable_ImmediatePriority,et=t.unstable_UserBlockingPriority,ye=t.unstable_NormalPriority,Oe=t.unstable_LowPriority,xe=t.unstable_IdlePriority,he=t.log,W=t.unstable_setDisableYieldValue,O=null,te=null;function re(a){if(typeof he=="function"&&W(a),te&&typeof te.setStrictMode=="function")try{te.setStrictMode(O,a)}catch{}}var ke=Math.clz32?Math.clz32:Ze,Ue=Math.log,Qe=Math.LN2;function Ze(a){return a>>>=0,a===0?32:31-(Ue(a)/Qe|0)|0}var lt=256,le=4194304;function pe(a){var i=a&42;if(i!==0)return i;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function de(a,i,l){var h=a.pendingLanes;if(h===0)return 0;var b=0,v=a.suspendedLanes,z=a.pingedLanes;a=a.warmLanes;var H=h&134217727;return H!==0?(h=H&~v,h!==0?b=pe(h):(z&=H,z!==0?b=pe(z):l||(l=H&~a,l!==0&&(b=pe(l))))):(H=h&~v,H!==0?b=pe(H):z!==0?b=pe(z):l||(l=h&~a,l!==0&&(b=pe(l)))),b===0?0:i!==0&&i!==b&&(i&v)===0&&(v=b&-b,l=i&-i,v>=l||v===32&&(l&4194048)!==0)?i:b}function we(a,i){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&i)===0}function Ae(a,i){switch(a){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Re(){var a=lt;return lt<<=1,(lt&4194048)===0&&(lt=256),a}function at(){var a=le;return le<<=1,(le&62914560)===0&&(le=4194304),a}function tt(a){for(var i=[],l=0;31>l;l++)i.push(a);return i}function Je(a,i){a.pendingLanes|=i,i!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function wt(a,i,l,h,b,v){var z=a.pendingLanes;a.pendingLanes=l,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=l,a.entangledLanes&=l,a.errorRecoveryDisabledLanes&=l,a.shellSuspendCounter=0;var H=a.entanglements,ce=a.expirationTimes,_e=a.hiddenUpdates;for(l=z&~l;0<l;){var ze=31-ke(l),Me=1<<ze;H[ze]=0,ce[ze]=-1;var De=_e[ze];if(De!==null)for(_e[ze]=null,ze=0;ze<De.length;ze++){var Te=De[ze];Te!==null&&(Te.lane&=-536870913)}l&=~Me}h!==0&&Mt(a,h,0),v!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=v&~(z&~i))}function Mt(a,i,l){a.pendingLanes|=i,a.suspendedLanes&=~i;var h=31-ke(i);a.entangledLanes|=i,a.entanglements[h]=a.entanglements[h]|1073741824|l&4194090}function pt(a,i){var l=a.entangledLanes|=i;for(a=a.entanglements;l;){var h=31-ke(l),b=1<<h;b&i|a[h]&i&&(a[h]|=i),l&=~b}}function nt(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function Xe(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function At(){var a=M.p;return a!==0?a:(a=window.event,a===void 0?32:Ly(a.type))}function Qt(a,i){var l=M.p;try{return M.p=a,i()}finally{M.p=l}}var kt=Math.random().toString(36).slice(2),Xt="__reactFiber$"+kt,sn="__reactProps$"+kt,cn="__reactContainer$"+kt,La="__reactEvents$"+kt,Dr="__reactListeners$"+kt,Oc="__reactHandles$"+kt,zc="__reactResources$"+kt,fs="__reactMarker$"+kt;function Ql(a){delete a[Xt],delete a[sn],delete a[La],delete a[Dr],delete a[Oc]}function $a(a){var i=a[Xt];if(i)return i;for(var l=a.parentNode;l;){if(i=l[cn]||l[Xt]){if(l=i.alternate,i.child!==null||l!==null&&l.child!==null)for(a=Ny(a);a!==null;){if(l=a[Xt])return l;a=Ny(a)}return i}a=l,l=a.parentNode}return null}function gs(a){if(a=a[Xt]||a[cn]){var i=a.tag;if(i===5||i===6||i===13||i===26||i===27||i===3)return a}return null}function Us(a){var i=a.tag;if(i===5||i===26||i===27||i===6)return a.stateNode;throw Error(r(33))}function xs(a){var i=a[zc];return i||(i=a[zc]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function yn(a){a[fs]=!0}var Rc=new Set,Lc={};function ys(a,i){qs(a,i),qs(a+"Capture",i)}function qs(a,i){for(Lc[a]=i,a=0;a<i.length;a++)Rc.add(i[a])}var Hd=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),$c={},Fc={};function Vd(a){return Ce.call(Fc,a)?!0:Ce.call($c,a)?!1:Hd.test(a)?Fc[a]=!0:($c[a]=!0,!1)}function Er(a,i,l){if(Vd(i))if(l===null)a.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":a.removeAttribute(i);return;case"boolean":var h=i.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){a.removeAttribute(i);return}}a.setAttribute(i,""+l)}}function Hs(a,i,l){if(l===null)a.removeAttribute(i);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(i);return}a.setAttribute(i,""+l)}}function bn(a,i,l,h){if(h===null)a.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(l);return}a.setAttributeNS(i,l,""+h)}}var bs,Yl;function js(a){if(bs===void 0)try{throw Error()}catch(l){var i=l.stack.trim().match(/\n( *(at )?)/);bs=i&&i[1]||"",Yl=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bs+a+Yl}var Tr=!1;function Ui(a,i){if(!a||Tr)return"";Tr=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(i){var Me=function(){throw Error()};if(Object.defineProperty(Me.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Me,[])}catch(Te){var De=Te}Reflect.construct(a,[],Me)}else{try{Me.call()}catch(Te){De=Te}a.call(Me.prototype)}}else{try{throw Error()}catch(Te){De=Te}(Me=a())&&typeof Me.catch=="function"&&Me.catch(function(){})}}catch(Te){if(Te&&De&&typeof Te.stack=="string")return[Te.stack,De.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var v=h.DetermineComponentFrameRoot(),z=v[0],H=v[1];if(z&&H){var ce=z.split(`
`),_e=H.split(`
`);for(b=h=0;h<ce.length&&!ce[h].includes("DetermineComponentFrameRoot");)h++;for(;b<_e.length&&!_e[b].includes("DetermineComponentFrameRoot");)b++;if(h===ce.length||b===_e.length)for(h=ce.length-1,b=_e.length-1;1<=h&&0<=b&&ce[h]!==_e[b];)b--;for(;1<=h&&0<=b;h--,b--)if(ce[h]!==_e[b]){if(h!==1||b!==1)do if(h--,b--,0>b||ce[h]!==_e[b]){var ze=`
`+ce[h].replace(" at new "," at ");return a.displayName&&ze.includes("<anonymous>")&&(ze=ze.replace("<anonymous>",a.displayName)),ze}while(1<=h&&0<=b);break}}}finally{Tr=!1,Error.prepareStackTrace=l}return(l=a?a.displayName||a.name:"")?js(l):""}function Jl(a){switch(a.tag){case 26:case 27:case 5:return js(a.type);case 16:return js("Lazy");case 13:return js("Suspense");case 19:return js("SuspenseList");case 0:case 15:return Ui(a.type,!1);case 11:return Ui(a.type.render,!1);case 1:return Ui(a.type,!0);case 31:return js("Activity");default:return""}}function Xl(a){try{var i="";do i+=Jl(a),a=a.return;while(a);return i}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function Mn(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function qi(a){var i=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Gd(a){var i=qi(a)?"checked":"value",l=Object.getOwnPropertyDescriptor(a.constructor.prototype,i),h=""+a[i];if(!a.hasOwnProperty(i)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var b=l.get,v=l.set;return Object.defineProperty(a,i,{configurable:!0,get:function(){return b.call(this)},set:function(z){h=""+z,v.call(this,z)}}),Object.defineProperty(a,i,{enumerable:l.enumerable}),{getValue:function(){return h},setValue:function(z){h=""+z},stopTracking:function(){a._valueTracker=null,delete a[i]}}}}function Ar(a){a._valueTracker||(a._valueTracker=Gd(a))}function Kl(a){if(!a)return!1;var i=a._valueTracker;if(!i)return!0;var l=i.getValue(),h="";return a&&(h=qi(a)?a.checked?"true":"false":a.value),a=h,a!==l?(i.setValue(a),!0):!1}function Hi(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Mc=/[\n"\\]/g;function Bn(a){return a.replace(Mc,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Pr(a,i,l,h,b,v,z,H){a.name="",z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"?a.type=z:a.removeAttribute("type"),i!=null?z==="number"?(i===0&&a.value===""||a.value!=i)&&(a.value=""+Mn(i)):a.value!==""+Mn(i)&&(a.value=""+Mn(i)):z!=="submit"&&z!=="reset"||a.removeAttribute("value"),i!=null?Vs(a,z,Mn(i)):l!=null?Vs(a,z,Mn(l)):h!=null&&a.removeAttribute("value"),b==null&&v!=null&&(a.defaultChecked=!!v),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),H!=null&&typeof H!="function"&&typeof H!="symbol"&&typeof H!="boolean"?a.name=""+Mn(H):a.removeAttribute("name")}function Wl(a,i,l,h,b,v,z,H){if(v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"&&(a.type=v),i!=null||l!=null){if(!(v!=="submit"&&v!=="reset"||i!=null))return;l=l!=null?""+Mn(l):"",i=i!=null?""+Mn(i):l,H||i===a.value||(a.value=i),a.defaultValue=i}h=h??b,h=typeof h!="function"&&typeof h!="symbol"&&!!h,a.checked=H?a.checked:!!h,a.defaultChecked=!!h,z!=null&&typeof z!="function"&&typeof z!="symbol"&&typeof z!="boolean"&&(a.name=z)}function Vs(a,i,l){i==="number"&&Hi(a.ownerDocument)===a||a.defaultValue===""+l||(a.defaultValue=""+l)}function vs(a,i,l,h){if(a=a.options,i){i={};for(var b=0;b<l.length;b++)i["$"+l[b]]=!0;for(l=0;l<a.length;l++)b=i.hasOwnProperty("$"+a[l].value),a[l].selected!==b&&(a[l].selected=b),b&&h&&(a[l].defaultSelected=!0)}else{for(l=""+Mn(l),i=null,b=0;b<a.length;b++){if(a[b].value===l){a[b].selected=!0,h&&(a[b].defaultSelected=!0);return}i!==null||a[b].disabled||(i=a[b])}i!==null&&(i.selected=!0)}}function Ir(a,i,l){if(i!=null&&(i=""+Mn(i),i!==a.value&&(a.value=i),l==null)){a.defaultValue!==i&&(a.defaultValue=i);return}a.defaultValue=l!=null?""+Mn(l):""}function Zl(a,i,l,h){if(i==null){if(h!=null){if(l!=null)throw Error(r(92));if(R(h)){if(1<h.length)throw Error(r(93));h=h[0]}l=h}l==null&&(l=""),i=l}l=Mn(i),a.defaultValue=l,h=a.textContent,h===l&&h!==""&&h!==null&&(a.value=h)}function Na(a,i){if(i){var l=a.firstChild;if(l&&l===a.lastChild&&l.nodeType===3){l.nodeValue=i;return}}a.textContent=i}var eo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Vi(a,i,l){var h=i.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?h?a.setProperty(i,""):i==="float"?a.cssFloat="":a[i]="":h?a.setProperty(i,l):typeof l!="number"||l===0||eo.has(i)?i==="float"?a.cssFloat=l:a[i]=(""+l).trim():a[i]=l+"px"}function Yn(a,i,l){if(i!=null&&typeof i!="object")throw Error(r(62));if(a=a.style,l!=null){for(var h in l)!l.hasOwnProperty(h)||i!=null&&i.hasOwnProperty(h)||(h.indexOf("--")===0?a.setProperty(h,""):h==="float"?a.cssFloat="":a[h]="");for(var b in i)h=i[b],i.hasOwnProperty(b)&&l[b]!==h&&Vi(a,b,h)}else for(var v in i)i.hasOwnProperty(v)&&Vi(a,v,i[v])}function Or(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var to=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Bc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Gs(a){return Bc.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var zr=null;function Gi(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ns=null,Qa=null;function no(a){var i=gs(a);if(i&&(a=i.stateNode)){var l=a[sn]||null;e:switch(a=i.stateNode,i.type){case"input":if(Pr(a,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),i=l.name,l.type==="radio"&&i!=null){for(l=a;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+Bn(""+i)+'"][type="radio"]'),i=0;i<l.length;i++){var h=l[i];if(h!==a&&h.form===a.form){var b=h[sn]||null;if(!b)throw Error(r(90));Pr(h,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(i=0;i<l.length;i++)h=l[i],h.form===a.form&&Kl(h)}break e;case"textarea":Ir(a,l.value,l.defaultValue);break e;case"select":i=l.value,i!=null&&vs(a,!!l.multiple,i,!1)}}}var Qs=!1;function Ys(a,i,l){if(Qs)return a(i,l);Qs=!0;try{var h=a(i);return h}finally{if(Qs=!1,(Ns!==null||Qa!==null)&&(Ou(),Ns&&(i=Ns,a=Qa,Qa=Ns=null,no(i),a)))for(i=0;i<a.length;i++)no(a[i])}}function Ya(a,i){var l=a.stateNode;if(l===null)return null;var h=l[sn]||null;if(h===null)return null;l=h[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(a=a.type,h=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!h;break e;default:a=!1}if(a)return null;if(l&&typeof l!="function")throw Error(r(231,i,typeof l));return l}var wa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Js=!1;if(wa)try{var Qi={};Object.defineProperty(Qi,"passive",{get:function(){Js=!0}}),window.addEventListener("test",Qi,Qi),window.removeEventListener("test",Qi,Qi)}catch{Js=!1}var Sa=null,Yi=null,Xs=null;function Rr(){if(Xs)return Xs;var a,i=Yi,l=i.length,h,b="value"in Sa?Sa.value:Sa.textContent,v=b.length;for(a=0;a<l&&i[a]===b[a];a++);var z=l-a;for(h=1;h<=z&&i[l-h]===b[v-h];h++);return Xs=b.slice(a,1<h?1-h:void 0)}function Ks(a){var i=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&i===13&&(a=13)):a=i,a===10&&(a=13),32<=a||a===13?a:0}function Ws(){return!0}function Lr(){return!1}function _n(a){function i(l,h,b,v,z){this._reactName=l,this._targetInst=b,this.type=h,this.nativeEvent=v,this.target=z,this.currentTarget=null;for(var H in a)a.hasOwnProperty(H)&&(l=a[H],this[H]=l?l(v):v[H]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Ws:Lr,this.isPropagationStopped=Lr,this}return f(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ws)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ws)},persist:function(){},isPersistent:Ws}),i}var Fa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jn=_n(Fa),ws=f({},Fa,{view:0,detail:0}),Uc=_n(ws),Ma,ao,Ss,$r=f({},ws,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ki,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Ss&&(Ss&&a.type==="mousemove"?(Ma=a.screenX-Ss.screenX,ao=a.screenY-Ss.screenY):ao=Ma=0,Ss=a),Ma)},movementY:function(a){return"movementY"in a?a.movementY:ao}}),Fr=_n($r),Qd=f({},$r,{dataTransfer:0}),Ji=_n(Qd),Ja=f({},ws,{relatedTarget:0}),Xa=_n(Ja),Mr=f({},Fa,{animationName:0,elapsedTime:0,pseudoElement:0}),Br=_n(Mr),Xi=f({},Fa,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Yd=_n(Xi),Ur=f({},Fa,{data:0}),so=_n(Ur),io={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Hc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Vc(a){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(a):(a=Hc[a])?!!i[a]:!1}function Ki(){return Vc}var Gc=f({},ws,{key:function(a){if(a.key){var i=io[a.key]||a.key;if(i!=="Unidentified")return i}return a.type==="keypress"?(a=Ks(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?qc[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ki,charCode:function(a){return a.type==="keypress"?Ks(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Ks(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),qr=_n(Gc),Hr=f({},$r,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Qc=_n(Hr),ro=f({},ws,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ki}),lo=_n(ro),Yc=f({},Fa,{propertyName:0,elapsedTime:0,pseudoElement:0}),$t=_n(Yc),oo=f({},$r,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),Vr=_n(oo),co=f({},Fa,{newState:0,oldState:0}),Wi=_n(co),Zi=[9,13,27,32],uo=wa&&"CompositionEvent"in window,Zs=null;wa&&"documentMode"in document&&(Zs=document.documentMode);var ei=wa&&"TextEvent"in window&&!Zs,ho=wa&&(!uo||Zs&&8<Zs&&11>=Zs),Gr=" ",er=!1;function ks(a,i){switch(a){case"keyup":return Zi.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mo(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ti=!1;function Jc(a,i){switch(a){case"compositionend":return mo(i);case"keypress":return i.which!==32?null:(er=!0,Gr);case"textInput":return a=i.data,a===Gr&&er?null:a;default:return null}}function tr(a,i){if(ti)return a==="compositionend"||!uo&&ks(a,i)?(a=Rr(),Xs=Yi=Sa=null,ti=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return ho&&i.locale!=="ko"?null:i.data;default:return null}}var Jd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cs(a){var i=a&&a.nodeName&&a.nodeName.toLowerCase();return i==="input"?!!Jd[a.type]:i==="textarea"}function Xc(a,i,l,h){Ns?Qa?Qa.push(h):Qa=[h]:Ns=h,i=Mu(i,"onChange"),0<i.length&&(l=new Jn("onChange","change",null,l,h),a.push({event:l,listeners:i}))}var ni=null,ka=null;function ai(a){hy(a,0)}function Ka(a){var i=Us(a);if(Kl(i))return a}function si(a,i){if(a==="change")return i}var Qr=!1;if(wa){var Yr;if(wa){var ii="oninput"in document;if(!ii){var po=document.createElement("div");po.setAttribute("oninput","return;"),ii=typeof po.oninput=="function"}Yr=ii}else Yr=!1;Qr=Yr&&(!document.documentMode||9<document.documentMode)}function Kc(){ni&&(ni.detachEvent("onpropertychange",Wc),ka=ni=null)}function Wc(a){if(a.propertyName==="value"&&Ka(ka)){var i=[];Xc(i,ka,a,Gi(a)),Ys(ai,i)}}function Xd(a,i,l){a==="focusin"?(Kc(),ni=i,ka=l,ni.attachEvent("onpropertychange",Wc)):a==="focusout"&&Kc()}function Zc(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ka(ka)}function Kd(a,i){if(a==="click")return Ka(i)}function Wd(a,i){if(a==="input"||a==="change")return Ka(i)}function Zd(a,i){return a===i&&(a!==0||1/a===1/i)||a!==a&&i!==i}var Un=typeof Object.is=="function"?Object.is:Zd;function _s(a,i){if(Un(a,i))return!0;if(typeof a!="object"||a===null||typeof i!="object"||i===null)return!1;var l=Object.keys(a),h=Object.keys(i);if(l.length!==h.length)return!1;for(h=0;h<l.length;h++){var b=l[h];if(!Ce.call(i,b)||!Un(a[b],i[b]))return!1}return!0}function Jr(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function eu(a,i){var l=Jr(a);a=0;for(var h;l;){if(l.nodeType===3){if(h=a+l.textContent.length,a<=i&&h>=i)return{node:l,offset:i-a};a=h}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Jr(l)}}function ri(a,i){return a&&i?a===i?!0:a&&a.nodeType===3?!1:i&&i.nodeType===3?ri(a,i.parentNode):"contains"in a?a.contains(i):a.compareDocumentPosition?!!(a.compareDocumentPosition(i)&16):!1:!1}function tu(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var i=Hi(a.document);i instanceof a.HTMLIFrameElement;){try{var l=typeof i.contentWindow.location.href=="string"}catch{l=!1}if(l)a=i.contentWindow;else break;i=Hi(a.document)}return i}function Ca(a){var i=a&&a.nodeName&&a.nodeName.toLowerCase();return i&&(i==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||i==="textarea"||a.contentEditable==="true")}var Wa=wa&&"documentMode"in document&&11>=document.documentMode,zn=null,Xr=null,li=null,Kr=!1;function fo(a,i,l){var h=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Kr||zn==null||zn!==Hi(h)||(h=zn,"selectionStart"in h&&Ca(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),li&&_s(li,h)||(li=h,h=Mu(Xr,"onSelect"),0<h.length&&(i=new Jn("onSelect","select",null,i,l),a.push({event:i,listeners:h}),i.target=zn)))}function la(a,i){var l={};return l[a.toLowerCase()]=i.toLowerCase(),l["Webkit"+a]="webkit"+i,l["Moz"+a]="moz"+i,l}var Ds={animationend:la("Animation","AnimationEnd"),animationiteration:la("Animation","AnimationIteration"),animationstart:la("Animation","AnimationStart"),transitionrun:la("Transition","TransitionRun"),transitionstart:la("Transition","TransitionStart"),transitioncancel:la("Transition","TransitionCancel"),transitionend:la("Transition","TransitionEnd")},Wr={},nu={};wa&&(nu=document.createElement("div").style,"AnimationEvent"in window||(delete Ds.animationend.animation,delete Ds.animationiteration.animation,delete Ds.animationstart.animation),"TransitionEvent"in window||delete Ds.transitionend.transition);function Za(a){if(Wr[a])return Wr[a];if(!Ds[a])return a;var i=Ds[a],l;for(l in i)if(i.hasOwnProperty(l)&&l in nu)return Wr[a]=i[l];return a}var go=Za("animationend"),au=Za("animationiteration"),su=Za("animationstart"),eh=Za("transitionrun"),iu=Za("transitionstart"),th=Za("transitioncancel"),Es=Za("transitionend"),ru=new Map,nr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nr.push("scrollEnd");function oa(a,i){ru.set(a,i),ys(i,[a])}var Zr=new WeakMap;function Xn(a,i){if(typeof a=="object"&&a!==null){var l=Zr.get(a);return l!==void 0?l:(i={value:a,source:i,stack:Xl(i)},Zr.set(a,i),i)}return{value:a,source:i,stack:Xl(i)}}var rn=[],oi=0,xo=0;function ar(){for(var a=oi,i=xo=oi=0;i<a;){var l=rn[i];rn[i++]=null;var h=rn[i];rn[i++]=null;var b=rn[i];rn[i++]=null;var v=rn[i];if(rn[i++]=null,h!==null&&b!==null){var z=h.pending;z===null?b.next=b:(b.next=z.next,z.next=b),h.pending=b}v!==0&&lu(l,b,v)}}function el(a,i,l,h){rn[oi++]=a,rn[oi++]=i,rn[oi++]=l,rn[oi++]=h,xo|=h,a.lanes|=h,a=a.alternate,a!==null&&(a.lanes|=h)}function yo(a,i,l,h){return el(a,i,l,h),tl(a)}function ci(a,i){return el(a,null,null,i),tl(a)}function lu(a,i,l){a.lanes|=l;var h=a.alternate;h!==null&&(h.lanes|=l);for(var b=!1,v=a.return;v!==null;)v.childLanes|=l,h=v.alternate,h!==null&&(h.childLanes|=l),v.tag===22&&(a=v.stateNode,a===null||a._visibility&1||(b=!0)),a=v,v=v.return;return a.tag===3?(v=a.stateNode,b&&i!==null&&(b=31-ke(l),a=v.hiddenUpdates,h=a[b],h===null?a[b]=[i]:h.push(i),i.lane=l|536870912),v):null}function tl(a){if(50<Vo)throw Vo=0,im=null,Error(r(185));for(var i=a.return;i!==null;)a=i,i=a.return;return a.tag===3?a.stateNode:null}var ui={};function nh(a,i,l,h){this.tag=a,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(a,i,l,h){return new nh(a,i,l,h)}function bo(a){return a=a.prototype,!(!a||!a.isReactComponent)}function _a(a,i){var l=a.alternate;return l===null?(l=qn(a.tag,i,a.key,a.mode),l.elementType=a.elementType,l.type=a.type,l.stateNode=a.stateNode,l.alternate=a,a.alternate=l):(l.pendingProps=i,l.type=a.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=a.flags&65011712,l.childLanes=a.childLanes,l.lanes=a.lanes,l.child=a.child,l.memoizedProps=a.memoizedProps,l.memoizedState=a.memoizedState,l.updateQueue=a.updateQueue,i=a.dependencies,l.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},l.sibling=a.sibling,l.index=a.index,l.ref=a.ref,l.refCleanup=a.refCleanup,l}function jo(a,i){a.flags&=65011714;var l=a.alternate;return l===null?(a.childLanes=0,a.lanes=i,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,i=l.dependencies,a.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),a}function sr(a,i,l,h,b,v){var z=0;if(h=a,typeof a=="function")bo(a)&&(z=1);else if(typeof a=="string")z=ZN(a,l,ue.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case G:return a=qn(31,l,i,b),a.elementType=G,a.lanes=v,a;case N:return q(l.children,b,v,i);case k:z=8,b|=24;break;case D:return a=qn(12,l,i,b|2),a.elementType=D,a.lanes=v,a;case X:return a=qn(13,l,i,b),a.elementType=X,a.lanes=v,a;case I:return a=qn(19,l,i,b),a.elementType=I,a.lanes=v,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case _:case E:z=10;break e;case T:z=9;break e;case U:z=11;break e;case F:z=14;break e;case B:z=16,h=null;break e}z=29,l=Error(r(130,a===null?"null":typeof a,"")),h=null}return i=qn(z,l,i,b),i.elementType=a,i.type=h,i.lanes=v,i}function q(a,i,l,h){return a=qn(7,a,h,i),a.lanes=l,a}function ie(a,i,l){return a=qn(6,a,null,i),a.lanes=l,a}function ne(a,i,l){return i=qn(4,a.children!==null?a.children:[],a.key,i),i.lanes=l,i.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},i}var ve=[],Ee=0,He=null,st=0,gt=[],ft=0,ca=null,Dn=1,Ts="";function ir(a,i){ve[Ee++]=st,ve[Ee++]=He,He=a,st=i}function Wf(a,i,l){gt[ft++]=Dn,gt[ft++]=Ts,gt[ft++]=ca,ca=a;var h=Dn;a=Ts;var b=32-ke(h)-1;h&=~(1<<b),l+=1;var v=32-ke(i)+b;if(30<v){var z=b-b%5;v=(h&(1<<z)-1).toString(32),h>>=z,b-=z,Dn=1<<32-ke(i)+b|l<<b|h,Ts=v+a}else Dn=1<<v|l<<b|h,Ts=a}function ah(a){a.return!==null&&(ir(a,1),Wf(a,1,0))}function sh(a){for(;a===He;)He=ve[--Ee],ve[Ee]=null,st=ve[--Ee],ve[Ee]=null;for(;a===ca;)ca=gt[--ft],gt[ft]=null,Ts=gt[--ft],gt[ft]=null,Dn=gt[--ft],gt[ft]=null}var Hn=null,un=null,Rt=!1,rr=null,es=!1,ih=Error(r(519));function lr(a){var i=Error(r(418,""));throw wo(Xn(i,a)),ih}function Zf(a){var i=a.stateNode,l=a.type,h=a.memoizedProps;switch(i[Xt]=a,i[sn]=h,l){case"dialog":_t("cancel",i),_t("close",i);break;case"iframe":case"object":case"embed":_t("load",i);break;case"video":case"audio":for(l=0;l<Qo.length;l++)_t(Qo[l],i);break;case"source":_t("error",i);break;case"img":case"image":case"link":_t("error",i),_t("load",i);break;case"details":_t("toggle",i);break;case"input":_t("invalid",i),Wl(i,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0),Ar(i);break;case"select":_t("invalid",i);break;case"textarea":_t("invalid",i),Zl(i,h.value,h.defaultValue,h.children),Ar(i)}l=h.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||i.textContent===""+l||h.suppressHydrationWarning===!0||gy(i.textContent,l)?(h.popover!=null&&(_t("beforetoggle",i),_t("toggle",i)),h.onScroll!=null&&_t("scroll",i),h.onScrollEnd!=null&&_t("scrollend",i),h.onClick!=null&&(i.onclick=Bu),i=!0):i=!1,i||lr(a)}function eg(a){for(Hn=a.return;Hn;)switch(Hn.tag){case 5:case 13:es=!1;return;case 27:case 3:es=!0;return;default:Hn=Hn.return}}function vo(a){if(a!==Hn)return!1;if(!Rt)return eg(a),Rt=!0,!1;var i=a.tag,l;if((l=i!==3&&i!==27)&&((l=i===5)&&(l=a.type,l=!(l!=="form"&&l!=="button")||vm(a.type,a.memoizedProps)),l=!l),l&&un&&lr(a),eg(a),i===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(r(317));e:{for(a=a.nextSibling,i=0;a;){if(a.nodeType===8)if(l=a.data,l==="/$"){if(i===0){un=Ua(a.nextSibling);break e}i--}else l!=="$"&&l!=="$!"&&l!=="$?"||i++;a=a.nextSibling}un=null}}else i===27?(i=un,Ci(a.type)?(a=km,km=null,un=a):un=i):un=Hn?Ua(a.stateNode.nextSibling):null;return!0}function No(){un=Hn=null,Rt=!1}function tg(){var a=rr;return a!==null&&(Zn===null?Zn=a:Zn.push.apply(Zn,a),rr=null),a}function wo(a){rr===null?rr=[a]:rr.push(a)}var rh=ge(null),or=null,As=null;function di(a,i,l){w(rh,i._currentValue),i._currentValue=l}function Ps(a){a._currentValue=rh.current,fe(rh)}function lh(a,i,l){for(;a!==null;){var h=a.alternate;if((a.childLanes&i)!==i?(a.childLanes|=i,h!==null&&(h.childLanes|=i)):h!==null&&(h.childLanes&i)!==i&&(h.childLanes|=i),a===l)break;a=a.return}}function oh(a,i,l,h){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var v=b.dependencies;if(v!==null){var z=b.child;v=v.firstContext;e:for(;v!==null;){var H=v;v=b;for(var ce=0;ce<i.length;ce++)if(H.context===i[ce]){v.lanes|=l,H=v.alternate,H!==null&&(H.lanes|=l),lh(v.return,l,a),h||(z=null);break e}v=H.next}}else if(b.tag===18){if(z=b.return,z===null)throw Error(r(341));z.lanes|=l,v=z.alternate,v!==null&&(v.lanes|=l),lh(z,l,a),z=null}else z=b.child;if(z!==null)z.return=b;else for(z=b;z!==null;){if(z===a){z=null;break}if(b=z.sibling,b!==null){b.return=z.return,z=b;break}z=z.return}b=z}}function So(a,i,l,h){a=null;for(var b=i,v=!1;b!==null;){if(!v){if((b.flags&524288)!==0)v=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var z=b.alternate;if(z===null)throw Error(r(387));if(z=z.memoizedProps,z!==null){var H=b.type;Un(b.pendingProps.value,z.value)||(a!==null?a.push(H):a=[H])}}else if(b===Y.current){if(z=b.alternate,z===null)throw Error(r(387));z.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Zo):a=[Zo])}b=b.return}a!==null&&oh(i,a,l,h),i.flags|=262144}function ou(a){for(a=a.firstContext;a!==null;){if(!Un(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function cr(a){or=a,As=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Rn(a){return ng(or,a)}function cu(a,i){return or===null&&cr(a),ng(a,i)}function ng(a,i){var l=i._currentValue;if(i={context:i,memoizedValue:l,next:null},As===null){if(a===null)throw Error(r(308));As=i,a.dependencies={lanes:0,firstContext:i},a.flags|=524288}else As=As.next=i;return l}var W1=typeof AbortController<"u"?AbortController:function(){var a=[],i=this.signal={aborted:!1,addEventListener:function(l,h){a.push(h)}};this.abort=function(){i.aborted=!0,a.forEach(function(l){return l()})}},Z1=t.unstable_scheduleCallback,eN=t.unstable_NormalPriority,Sn={$$typeof:E,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ch(){return{controller:new W1,data:new Map,refCount:0}}function ko(a){a.refCount--,a.refCount===0&&Z1(eN,function(){a.controller.abort()})}var Co=null,uh=0,nl=0,al=null;function tN(a,i){if(Co===null){var l=Co=[];uh=0,nl=hm(),al={status:"pending",value:void 0,then:function(h){l.push(h)}}}return uh++,i.then(ag,ag),i}function ag(){if(--uh===0&&Co!==null){al!==null&&(al.status="fulfilled");var a=Co;Co=null,nl=0,al=null;for(var i=0;i<a.length;i++)(0,a[i])()}}function nN(a,i){var l=[],h={status:"pending",value:null,reason:null,then:function(b){l.push(b)}};return a.then(function(){h.status="fulfilled",h.value=i;for(var b=0;b<l.length;b++)(0,l[b])(i)},function(b){for(h.status="rejected",h.reason=b,b=0;b<l.length;b++)(0,l[b])(void 0)}),h}var sg=L.S;L.S=function(a,i){typeof i=="object"&&i!==null&&typeof i.then=="function"&&tN(a,i),sg!==null&&sg(a,i)};var ur=ge(null);function dh(){var a=ur.current;return a!==null?a:Kt.pooledCache}function uu(a,i){i===null?w(ur,ur.current):w(ur,i.pool)}function ig(){var a=dh();return a===null?null:{parent:Sn._currentValue,pool:a}}var _o=Error(r(460)),rg=Error(r(474)),du=Error(r(542)),hh={then:function(){}};function lg(a){return a=a.status,a==="fulfilled"||a==="rejected"}function hu(){}function og(a,i,l){switch(l=a[l],l===void 0?a.push(i):l!==i&&(i.then(hu,hu),i=l),i.status){case"fulfilled":return i.value;case"rejected":throw a=i.reason,ug(a),a;default:if(typeof i.status=="string")i.then(hu,hu);else{if(a=Kt,a!==null&&100<a.shellSuspendCounter)throw Error(r(482));a=i,a.status="pending",a.then(function(h){if(i.status==="pending"){var b=i;b.status="fulfilled",b.value=h}},function(h){if(i.status==="pending"){var b=i;b.status="rejected",b.reason=h}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw a=i.reason,ug(a),a}throw Do=i,_o}}var Do=null;function cg(){if(Do===null)throw Error(r(459));var a=Do;return Do=null,a}function ug(a){if(a===_o||a===du)throw Error(r(483))}var hi=!1;function mh(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ph(a,i){a=a.updateQueue,i.updateQueue===a&&(i.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function mi(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function pi(a,i,l){var h=a.updateQueue;if(h===null)return null;if(h=h.shared,(Bt&2)!==0){var b=h.pending;return b===null?i.next=i:(i.next=b.next,b.next=i),h.pending=i,i=tl(a),lu(a,null,l),i}return el(a,h,i,l),tl(a)}function Eo(a,i,l){if(i=i.updateQueue,i!==null&&(i=i.shared,(l&4194048)!==0)){var h=i.lanes;h&=a.pendingLanes,l|=h,i.lanes=l,pt(a,l)}}function fh(a,i){var l=a.updateQueue,h=a.alternate;if(h!==null&&(h=h.updateQueue,l===h)){var b=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var z={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};v===null?b=v=z:v=v.next=z,l=l.next}while(l!==null);v===null?b=v=i:v=v.next=i}else b=v=i;l={baseState:h.baseState,firstBaseUpdate:b,lastBaseUpdate:v,shared:h.shared,callbacks:h.callbacks},a.updateQueue=l;return}a=l.lastBaseUpdate,a===null?l.firstBaseUpdate=i:a.next=i,l.lastBaseUpdate=i}var gh=!1;function To(){if(gh){var a=al;if(a!==null)throw a}}function Ao(a,i,l,h){gh=!1;var b=a.updateQueue;hi=!1;var v=b.firstBaseUpdate,z=b.lastBaseUpdate,H=b.shared.pending;if(H!==null){b.shared.pending=null;var ce=H,_e=ce.next;ce.next=null,z===null?v=_e:z.next=_e,z=ce;var ze=a.alternate;ze!==null&&(ze=ze.updateQueue,H=ze.lastBaseUpdate,H!==z&&(H===null?ze.firstBaseUpdate=_e:H.next=_e,ze.lastBaseUpdate=ce))}if(v!==null){var Me=b.baseState;z=0,ze=_e=ce=null,H=v;do{var De=H.lane&-536870913,Te=De!==H.lane;if(Te?(It&De)===De:(h&De)===De){De!==0&&De===nl&&(gh=!0),ze!==null&&(ze=ze.next={lane:0,tag:H.tag,payload:H.payload,callback:null,next:null});e:{var ht=a,ut=H;De=i;var Vt=l;switch(ut.tag){case 1:if(ht=ut.payload,typeof ht=="function"){Me=ht.call(Vt,Me,De);break e}Me=ht;break e;case 3:ht.flags=ht.flags&-65537|128;case 0:if(ht=ut.payload,De=typeof ht=="function"?ht.call(Vt,Me,De):ht,De==null)break e;Me=f({},Me,De);break e;case 2:hi=!0}}De=H.callback,De!==null&&(a.flags|=64,Te&&(a.flags|=8192),Te=b.callbacks,Te===null?b.callbacks=[De]:Te.push(De))}else Te={lane:De,tag:H.tag,payload:H.payload,callback:H.callback,next:null},ze===null?(_e=ze=Te,ce=Me):ze=ze.next=Te,z|=De;if(H=H.next,H===null){if(H=b.shared.pending,H===null)break;Te=H,H=Te.next,Te.next=null,b.lastBaseUpdate=Te,b.shared.pending=null}}while(!0);ze===null&&(ce=Me),b.baseState=ce,b.firstBaseUpdate=_e,b.lastBaseUpdate=ze,v===null&&(b.shared.lanes=0),Ni|=z,a.lanes=z,a.memoizedState=Me}}function dg(a,i){if(typeof a!="function")throw Error(r(191,a));a.call(i)}function hg(a,i){var l=a.callbacks;if(l!==null)for(a.callbacks=null,a=0;a<l.length;a++)dg(l[a],i)}var sl=ge(null),mu=ge(0);function mg(a,i){a=Fs,w(mu,a),w(sl,i),Fs=a|i.baseLanes}function xh(){w(mu,Fs),w(sl,sl.current)}function yh(){Fs=mu.current,fe(sl),fe(mu)}var fi=0,Nt=null,qt=null,jn=null,pu=!1,il=!1,dr=!1,fu=0,Po=0,rl=null,aN=0;function fn(){throw Error(r(321))}function bh(a,i){if(i===null)return!1;for(var l=0;l<i.length&&l<a.length;l++)if(!Un(a[l],i[l]))return!1;return!0}function jh(a,i,l,h,b,v){return fi=v,Nt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,L.H=a===null||a.memoizedState===null?Xg:Kg,dr=!1,v=l(h,b),dr=!1,il&&(v=fg(i,l,h,b)),pg(a),v}function pg(a){L.H=vu;var i=qt!==null&&qt.next!==null;if(fi=0,jn=qt=Nt=null,pu=!1,Po=0,rl=null,i)throw Error(r(300));a===null||En||(a=a.dependencies,a!==null&&ou(a)&&(En=!0))}function fg(a,i,l,h){Nt=a;var b=0;do{if(il&&(rl=null),Po=0,il=!1,25<=b)throw Error(r(301));if(b+=1,jn=qt=null,a.updateQueue!=null){var v=a.updateQueue;v.lastEffect=null,v.events=null,v.stores=null,v.memoCache!=null&&(v.memoCache.index=0)}L.H=uN,v=i(l,h)}while(il);return v}function sN(){var a=L.H,i=a.useState()[0];return i=typeof i.then=="function"?Io(i):i,a=a.useState()[0],(qt!==null?qt.memoizedState:null)!==a&&(Nt.flags|=1024),i}function vh(){var a=fu!==0;return fu=0,a}function Nh(a,i,l){i.updateQueue=a.updateQueue,i.flags&=-2053,a.lanes&=~l}function wh(a){if(pu){for(a=a.memoizedState;a!==null;){var i=a.queue;i!==null&&(i.pending=null),a=a.next}pu=!1}fi=0,jn=qt=Nt=null,il=!1,Po=fu=0,rl=null}function Kn(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jn===null?Nt.memoizedState=jn=a:jn=jn.next=a,jn}function vn(){if(qt===null){var a=Nt.alternate;a=a!==null?a.memoizedState:null}else a=qt.next;var i=jn===null?Nt.memoizedState:jn.next;if(i!==null)jn=i,qt=a;else{if(a===null)throw Nt.alternate===null?Error(r(467)):Error(r(310));qt=a,a={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},jn===null?Nt.memoizedState=jn=a:jn=jn.next=a}return jn}function Sh(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Io(a){var i=Po;return Po+=1,rl===null&&(rl=[]),a=og(rl,a,i),i=Nt,(jn===null?i.memoizedState:jn.next)===null&&(i=i.alternate,L.H=i===null||i.memoizedState===null?Xg:Kg),a}function gu(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Io(a);if(a.$$typeof===E)return Rn(a)}throw Error(r(438,String(a)))}function kh(a){var i=null,l=Nt.updateQueue;if(l!==null&&(i=l.memoCache),i==null){var h=Nt.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(i={data:h.data.map(function(b){return b.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),l===null&&(l=Sh(),Nt.updateQueue=l),l.memoCache=i,l=i.data[i.index],l===void 0)for(l=i.data[i.index]=Array(a),h=0;h<a;h++)l[h]=C;return i.index++,l}function Is(a,i){return typeof i=="function"?i(a):i}function xu(a){var i=vn();return Ch(i,qt,a)}function Ch(a,i,l){var h=a.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=l;var b=a.baseQueue,v=h.pending;if(v!==null){if(b!==null){var z=b.next;b.next=v.next,v.next=z}i.baseQueue=b=v,h.pending=null}if(v=a.baseState,b===null)a.memoizedState=v;else{i=b.next;var H=z=null,ce=null,_e=i,ze=!1;do{var Me=_e.lane&-536870913;if(Me!==_e.lane?(It&Me)===Me:(fi&Me)===Me){var De=_e.revertLane;if(De===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null}),Me===nl&&(ze=!0);else if((fi&De)===De){_e=_e.next,De===nl&&(ze=!0);continue}else Me={lane:0,revertLane:_e.revertLane,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ce===null?(H=ce=Me,z=v):ce=ce.next=Me,Nt.lanes|=De,Ni|=De;Me=_e.action,dr&&l(v,Me),v=_e.hasEagerState?_e.eagerState:l(v,Me)}else De={lane:Me,revertLane:_e.revertLane,action:_e.action,hasEagerState:_e.hasEagerState,eagerState:_e.eagerState,next:null},ce===null?(H=ce=De,z=v):ce=ce.next=De,Nt.lanes|=Me,Ni|=Me;_e=_e.next}while(_e!==null&&_e!==i);if(ce===null?z=v:ce.next=H,!Un(v,a.memoizedState)&&(En=!0,ze&&(l=al,l!==null)))throw l;a.memoizedState=v,a.baseState=z,a.baseQueue=ce,h.lastRenderedState=v}return b===null&&(h.lanes=0),[a.memoizedState,h.dispatch]}function _h(a){var i=vn(),l=i.queue;if(l===null)throw Error(r(311));l.lastRenderedReducer=a;var h=l.dispatch,b=l.pending,v=i.memoizedState;if(b!==null){l.pending=null;var z=b=b.next;do v=a(v,z.action),z=z.next;while(z!==b);Un(v,i.memoizedState)||(En=!0),i.memoizedState=v,i.baseQueue===null&&(i.baseState=v),l.lastRenderedState=v}return[v,h]}function gg(a,i,l){var h=Nt,b=vn(),v=Rt;if(v){if(l===void 0)throw Error(r(407));l=l()}else l=i();var z=!Un((qt||b).memoizedState,l);z&&(b.memoizedState=l,En=!0),b=b.queue;var H=bg.bind(null,h,b,a);if(Oo(2048,8,H,[a]),b.getSnapshot!==i||z||jn!==null&&jn.memoizedState.tag&1){if(h.flags|=2048,ll(9,yu(),yg.bind(null,h,b,l,i),null),Kt===null)throw Error(r(349));v||(fi&124)!==0||xg(h,i,l)}return l}function xg(a,i,l){a.flags|=16384,a={getSnapshot:i,value:l},i=Nt.updateQueue,i===null?(i=Sh(),Nt.updateQueue=i,i.stores=[a]):(l=i.stores,l===null?i.stores=[a]:l.push(a))}function yg(a,i,l,h){i.value=l,i.getSnapshot=h,jg(i)&&vg(a)}function bg(a,i,l){return l(function(){jg(i)&&vg(a)})}function jg(a){var i=a.getSnapshot;a=a.value;try{var l=i();return!Un(a,l)}catch{return!0}}function vg(a){var i=ci(a,2);i!==null&&pa(i,a,2)}function Dh(a){var i=Kn();if(typeof a=="function"){var l=a;if(a=l(),dr){re(!0);try{l()}finally{re(!1)}}}return i.memoizedState=i.baseState=a,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:a},i}function Ng(a,i,l,h){return a.baseState=l,Ch(a,qt,typeof h=="function"?h:Is)}function iN(a,i,l,h,b){if(ju(a))throw Error(r(485));if(a=i.action,a!==null){var v={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(z){v.listeners.push(z)}};L.T!==null?l(!0):v.isTransition=!1,h(v),l=i.pending,l===null?(v.next=i.pending=v,wg(i,v)):(v.next=l.next,i.pending=l.next=v)}}function wg(a,i){var l=i.action,h=i.payload,b=a.state;if(i.isTransition){var v=L.T,z={};L.T=z;try{var H=l(b,h),ce=L.S;ce!==null&&ce(z,H),Sg(a,i,H)}catch(_e){Eh(a,i,_e)}finally{L.T=v}}else try{v=l(b,h),Sg(a,i,v)}catch(_e){Eh(a,i,_e)}}function Sg(a,i,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(h){kg(a,i,h)},function(h){return Eh(a,i,h)}):kg(a,i,l)}function kg(a,i,l){i.status="fulfilled",i.value=l,Cg(i),a.state=l,i=a.pending,i!==null&&(l=i.next,l===i?a.pending=null:(l=l.next,i.next=l,wg(a,l)))}function Eh(a,i,l){var h=a.pending;if(a.pending=null,h!==null){h=h.next;do i.status="rejected",i.reason=l,Cg(i),i=i.next;while(i!==h)}a.action=null}function Cg(a){a=a.listeners;for(var i=0;i<a.length;i++)(0,a[i])()}function _g(a,i){return i}function Dg(a,i){if(Rt){var l=Kt.formState;if(l!==null){e:{var h=Nt;if(Rt){if(un){t:{for(var b=un,v=es;b.nodeType!==8;){if(!v){b=null;break t}if(b=Ua(b.nextSibling),b===null){b=null;break t}}v=b.data,b=v==="F!"||v==="F"?b:null}if(b){un=Ua(b.nextSibling),h=b.data==="F!";break e}}lr(h)}h=!1}h&&(i=l[0])}}return l=Kn(),l.memoizedState=l.baseState=i,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_g,lastRenderedState:i},l.queue=h,l=Qg.bind(null,Nt,h),h.dispatch=l,h=Dh(!1),v=Oh.bind(null,Nt,!1,h.queue),h=Kn(),b={state:i,dispatch:null,action:a,pending:null},h.queue=b,l=iN.bind(null,Nt,b,v,l),b.dispatch=l,h.memoizedState=a,[i,l,!1]}function Eg(a){var i=vn();return Tg(i,qt,a)}function Tg(a,i,l){if(i=Ch(a,i,_g)[0],a=xu(Is)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var h=Io(i)}catch(z){throw z===_o?du:z}else h=i;i=vn();var b=i.queue,v=b.dispatch;return l!==i.memoizedState&&(Nt.flags|=2048,ll(9,yu(),rN.bind(null,b,l),null)),[h,v,a]}function rN(a,i){a.action=i}function Ag(a){var i=vn(),l=qt;if(l!==null)return Tg(i,l,a);vn(),i=i.memoizedState,l=vn();var h=l.queue.dispatch;return l.memoizedState=a,[i,h,!1]}function ll(a,i,l,h){return a={tag:a,create:l,deps:h,inst:i,next:null},i=Nt.updateQueue,i===null&&(i=Sh(),Nt.updateQueue=i),l=i.lastEffect,l===null?i.lastEffect=a.next=a:(h=l.next,l.next=a,a.next=h,i.lastEffect=a),a}function yu(){return{destroy:void 0,resource:void 0}}function Pg(){return vn().memoizedState}function bu(a,i,l,h){var b=Kn();h=h===void 0?null:h,Nt.flags|=a,b.memoizedState=ll(1|i,yu(),l,h)}function Oo(a,i,l,h){var b=vn();h=h===void 0?null:h;var v=b.memoizedState.inst;qt!==null&&h!==null&&bh(h,qt.memoizedState.deps)?b.memoizedState=ll(i,v,l,h):(Nt.flags|=a,b.memoizedState=ll(1|i,v,l,h))}function Ig(a,i){bu(8390656,8,a,i)}function Og(a,i){Oo(2048,8,a,i)}function zg(a,i){return Oo(4,2,a,i)}function Rg(a,i){return Oo(4,4,a,i)}function Lg(a,i){if(typeof i=="function"){a=a();var l=i(a);return function(){typeof l=="function"?l():i(null)}}if(i!=null)return a=a(),i.current=a,function(){i.current=null}}function $g(a,i,l){l=l!=null?l.concat([a]):null,Oo(4,4,Lg.bind(null,i,a),l)}function Th(){}function Fg(a,i){var l=vn();i=i===void 0?null:i;var h=l.memoizedState;return i!==null&&bh(i,h[1])?h[0]:(l.memoizedState=[a,i],a)}function Mg(a,i){var l=vn();i=i===void 0?null:i;var h=l.memoizedState;if(i!==null&&bh(i,h[1]))return h[0];if(h=a(),dr){re(!0);try{a()}finally{re(!1)}}return l.memoizedState=[h,i],h}function Ah(a,i,l){return l===void 0||(fi&1073741824)!==0?a.memoizedState=i:(a.memoizedState=l,a=qx(),Nt.lanes|=a,Ni|=a,l)}function Bg(a,i,l,h){return Un(l,i)?l:sl.current!==null?(a=Ah(a,l,h),Un(a,i)||(En=!0),a):(fi&42)===0?(En=!0,a.memoizedState=l):(a=qx(),Nt.lanes|=a,Ni|=a,i)}function Ug(a,i,l,h,b){var v=M.p;M.p=v!==0&&8>v?v:8;var z=L.T,H={};L.T=H,Oh(a,!1,i,l);try{var ce=b(),_e=L.S;if(_e!==null&&_e(H,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var ze=nN(ce,h);zo(a,i,ze,ma(a))}else zo(a,i,h,ma(a))}catch(Me){zo(a,i,{then:function(){},status:"rejected",reason:Me},ma())}finally{M.p=v,L.T=z}}function lN(){}function Ph(a,i,l,h){if(a.tag!==5)throw Error(r(476));var b=qg(a).queue;Ug(a,b,i,Z,l===null?lN:function(){return Hg(a),l(h)})}function qg(a){var i=a.memoizedState;if(i!==null)return i;i={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:Z},next:null};var l={};return i.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Is,lastRenderedState:l},next:null},a.memoizedState=i,a=a.alternate,a!==null&&(a.memoizedState=i),i}function Hg(a){var i=qg(a).next.queue;zo(a,i,{},ma())}function Ih(){return Rn(Zo)}function Vg(){return vn().memoizedState}function Gg(){return vn().memoizedState}function oN(a){for(var i=a.return;i!==null;){switch(i.tag){case 24:case 3:var l=ma();a=mi(l);var h=pi(i,a,l);h!==null&&(pa(h,i,l),Eo(h,i,l)),i={cache:ch()},a.payload=i;return}i=i.return}}function cN(a,i,l){var h=ma();l={lane:h,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},ju(a)?Yg(i,l):(l=yo(a,i,l,h),l!==null&&(pa(l,a,h),Jg(l,i,h)))}function Qg(a,i,l){var h=ma();zo(a,i,l,h)}function zo(a,i,l,h){var b={lane:h,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(ju(a))Yg(i,b);else{var v=a.alternate;if(a.lanes===0&&(v===null||v.lanes===0)&&(v=i.lastRenderedReducer,v!==null))try{var z=i.lastRenderedState,H=v(z,l);if(b.hasEagerState=!0,b.eagerState=H,Un(H,z))return el(a,i,b,0),Kt===null&&ar(),!1}catch{}finally{}if(l=yo(a,i,b,h),l!==null)return pa(l,a,h),Jg(l,i,h),!0}return!1}function Oh(a,i,l,h){if(h={lane:2,revertLane:hm(),action:h,hasEagerState:!1,eagerState:null,next:null},ju(a)){if(i)throw Error(r(479))}else i=yo(a,l,h,2),i!==null&&pa(i,a,2)}function ju(a){var i=a.alternate;return a===Nt||i!==null&&i===Nt}function Yg(a,i){il=pu=!0;var l=a.pending;l===null?i.next=i:(i.next=l.next,l.next=i),a.pending=i}function Jg(a,i,l){if((l&4194048)!==0){var h=i.lanes;h&=a.pendingLanes,l|=h,i.lanes=l,pt(a,l)}}var vu={readContext:Rn,use:gu,useCallback:fn,useContext:fn,useEffect:fn,useImperativeHandle:fn,useLayoutEffect:fn,useInsertionEffect:fn,useMemo:fn,useReducer:fn,useRef:fn,useState:fn,useDebugValue:fn,useDeferredValue:fn,useTransition:fn,useSyncExternalStore:fn,useId:fn,useHostTransitionStatus:fn,useFormState:fn,useActionState:fn,useOptimistic:fn,useMemoCache:fn,useCacheRefresh:fn},Xg={readContext:Rn,use:gu,useCallback:function(a,i){return Kn().memoizedState=[a,i===void 0?null:i],a},useContext:Rn,useEffect:Ig,useImperativeHandle:function(a,i,l){l=l!=null?l.concat([a]):null,bu(4194308,4,Lg.bind(null,i,a),l)},useLayoutEffect:function(a,i){return bu(4194308,4,a,i)},useInsertionEffect:function(a,i){bu(4,2,a,i)},useMemo:function(a,i){var l=Kn();i=i===void 0?null:i;var h=a();if(dr){re(!0);try{a()}finally{re(!1)}}return l.memoizedState=[h,i],h},useReducer:function(a,i,l){var h=Kn();if(l!==void 0){var b=l(i);if(dr){re(!0);try{l(i)}finally{re(!1)}}}else b=i;return h.memoizedState=h.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},h.queue=a,a=a.dispatch=cN.bind(null,Nt,a),[h.memoizedState,a]},useRef:function(a){var i=Kn();return a={current:a},i.memoizedState=a},useState:function(a){a=Dh(a);var i=a.queue,l=Qg.bind(null,Nt,i);return i.dispatch=l,[a.memoizedState,l]},useDebugValue:Th,useDeferredValue:function(a,i){var l=Kn();return Ah(l,a,i)},useTransition:function(){var a=Dh(!1);return a=Ug.bind(null,Nt,a.queue,!0,!1),Kn().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,i,l){var h=Nt,b=Kn();if(Rt){if(l===void 0)throw Error(r(407));l=l()}else{if(l=i(),Kt===null)throw Error(r(349));(It&124)!==0||xg(h,i,l)}b.memoizedState=l;var v={value:l,getSnapshot:i};return b.queue=v,Ig(bg.bind(null,h,v,a),[a]),h.flags|=2048,ll(9,yu(),yg.bind(null,h,v,l,i),null),l},useId:function(){var a=Kn(),i=Kt.identifierPrefix;if(Rt){var l=Ts,h=Dn;l=(h&~(1<<32-ke(h)-1)).toString(32)+l,i=""+i+"R"+l,l=fu++,0<l&&(i+="H"+l.toString(32)),i+=""}else l=aN++,i=""+i+"r"+l.toString(32)+"";return a.memoizedState=i},useHostTransitionStatus:Ih,useFormState:Dg,useActionState:Dg,useOptimistic:function(a){var i=Kn();i.memoizedState=i.baseState=a;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=l,i=Oh.bind(null,Nt,!0,l),l.dispatch=i,[a,i]},useMemoCache:kh,useCacheRefresh:function(){return Kn().memoizedState=oN.bind(null,Nt)}},Kg={readContext:Rn,use:gu,useCallback:Fg,useContext:Rn,useEffect:Og,useImperativeHandle:$g,useInsertionEffect:zg,useLayoutEffect:Rg,useMemo:Mg,useReducer:xu,useRef:Pg,useState:function(){return xu(Is)},useDebugValue:Th,useDeferredValue:function(a,i){var l=vn();return Bg(l,qt.memoizedState,a,i)},useTransition:function(){var a=xu(Is)[0],i=vn().memoizedState;return[typeof a=="boolean"?a:Io(a),i]},useSyncExternalStore:gg,useId:Vg,useHostTransitionStatus:Ih,useFormState:Eg,useActionState:Eg,useOptimistic:function(a,i){var l=vn();return Ng(l,qt,a,i)},useMemoCache:kh,useCacheRefresh:Gg},uN={readContext:Rn,use:gu,useCallback:Fg,useContext:Rn,useEffect:Og,useImperativeHandle:$g,useInsertionEffect:zg,useLayoutEffect:Rg,useMemo:Mg,useReducer:_h,useRef:Pg,useState:function(){return _h(Is)},useDebugValue:Th,useDeferredValue:function(a,i){var l=vn();return qt===null?Ah(l,a,i):Bg(l,qt.memoizedState,a,i)},useTransition:function(){var a=_h(Is)[0],i=vn().memoizedState;return[typeof a=="boolean"?a:Io(a),i]},useSyncExternalStore:gg,useId:Vg,useHostTransitionStatus:Ih,useFormState:Ag,useActionState:Ag,useOptimistic:function(a,i){var l=vn();return qt!==null?Ng(l,qt,a,i):(l.baseState=a,[a,l.queue.dispatch])},useMemoCache:kh,useCacheRefresh:Gg},ol=null,Ro=0;function Nu(a){var i=Ro;return Ro+=1,ol===null&&(ol=[]),og(ol,a,i)}function Lo(a,i){i=i.props.ref,a.ref=i!==void 0?i:null}function wu(a,i){throw i.$$typeof===g?Error(r(525)):(a=Object.prototype.toString.call(i),Error(r(31,a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)))}function Wg(a){var i=a._init;return i(a._payload)}function Zg(a){function i(be,me){if(a){var Se=be.deletions;Se===null?(be.deletions=[me],be.flags|=16):Se.push(me)}}function l(be,me){if(!a)return null;for(;me!==null;)i(be,me),me=me.sibling;return null}function h(be){for(var me=new Map;be!==null;)be.key!==null?me.set(be.key,be):me.set(be.index,be),be=be.sibling;return me}function b(be,me){return be=_a(be,me),be.index=0,be.sibling=null,be}function v(be,me,Se){return be.index=Se,a?(Se=be.alternate,Se!==null?(Se=Se.index,Se<me?(be.flags|=67108866,me):Se):(be.flags|=67108866,me)):(be.flags|=1048576,me)}function z(be){return a&&be.alternate===null&&(be.flags|=67108866),be}function H(be,me,Se,Le){return me===null||me.tag!==6?(me=ie(Se,be.mode,Le),me.return=be,me):(me=b(me,Se),me.return=be,me)}function ce(be,me,Se,Le){var We=Se.type;return We===N?ze(be,me,Se.props.children,Le,Se.key):me!==null&&(me.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===B&&Wg(We)===me.type)?(me=b(me,Se.props),Lo(me,Se),me.return=be,me):(me=sr(Se.type,Se.key,Se.props,null,be.mode,Le),Lo(me,Se),me.return=be,me)}function _e(be,me,Se,Le){return me===null||me.tag!==4||me.stateNode.containerInfo!==Se.containerInfo||me.stateNode.implementation!==Se.implementation?(me=ne(Se,be.mode,Le),me.return=be,me):(me=b(me,Se.children||[]),me.return=be,me)}function ze(be,me,Se,Le,We){return me===null||me.tag!==7?(me=q(Se,be.mode,Le,We),me.return=be,me):(me=b(me,Se),me.return=be,me)}function Me(be,me,Se){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=ie(""+me,be.mode,Se),me.return=be,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case x:return Se=sr(me.type,me.key,me.props,null,be.mode,Se),Lo(Se,me),Se.return=be,Se;case j:return me=ne(me,be.mode,Se),me.return=be,me;case B:var Le=me._init;return me=Le(me._payload),Me(be,me,Se)}if(R(me)||P(me))return me=q(me,be.mode,Se,null),me.return=be,me;if(typeof me.then=="function")return Me(be,Nu(me),Se);if(me.$$typeof===E)return Me(be,cu(be,me),Se);wu(be,me)}return null}function De(be,me,Se,Le){var We=me!==null?me.key:null;if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return We!==null?null:H(be,me,""+Se,Le);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case x:return Se.key===We?ce(be,me,Se,Le):null;case j:return Se.key===We?_e(be,me,Se,Le):null;case B:return We=Se._init,Se=We(Se._payload),De(be,me,Se,Le)}if(R(Se)||P(Se))return We!==null?null:ze(be,me,Se,Le,null);if(typeof Se.then=="function")return De(be,me,Nu(Se),Le);if(Se.$$typeof===E)return De(be,me,cu(be,Se),Le);wu(be,Se)}return null}function Te(be,me,Se,Le,We){if(typeof Le=="string"&&Le!==""||typeof Le=="number"||typeof Le=="bigint")return be=be.get(Se)||null,H(me,be,""+Le,We);if(typeof Le=="object"&&Le!==null){switch(Le.$$typeof){case x:return be=be.get(Le.key===null?Se:Le.key)||null,ce(me,be,Le,We);case j:return be=be.get(Le.key===null?Se:Le.key)||null,_e(me,be,Le,We);case B:var St=Le._init;return Le=St(Le._payload),Te(be,me,Se,Le,We)}if(R(Le)||P(Le))return be=be.get(Se)||null,ze(me,be,Le,We,null);if(typeof Le.then=="function")return Te(be,me,Se,Nu(Le),We);if(Le.$$typeof===E)return Te(be,me,Se,cu(me,Le),We);wu(me,Le)}return null}function ht(be,me,Se,Le){for(var We=null,St=null,it=me,dt=me=0,An=null;it!==null&&dt<Se.length;dt++){it.index>dt?(An=it,it=null):An=it.sibling;var zt=De(be,it,Se[dt],Le);if(zt===null){it===null&&(it=An);break}a&&it&&zt.alternate===null&&i(be,it),me=v(zt,me,dt),St===null?We=zt:St.sibling=zt,St=zt,it=An}if(dt===Se.length)return l(be,it),Rt&&ir(be,dt),We;if(it===null){for(;dt<Se.length;dt++)it=Me(be,Se[dt],Le),it!==null&&(me=v(it,me,dt),St===null?We=it:St.sibling=it,St=it);return Rt&&ir(be,dt),We}for(it=h(it);dt<Se.length;dt++)An=Te(it,be,dt,Se[dt],Le),An!==null&&(a&&An.alternate!==null&&it.delete(An.key===null?dt:An.key),me=v(An,me,dt),St===null?We=An:St.sibling=An,St=An);return a&&it.forEach(function(Ai){return i(be,Ai)}),Rt&&ir(be,dt),We}function ut(be,me,Se,Le){if(Se==null)throw Error(r(151));for(var We=null,St=null,it=me,dt=me=0,An=null,zt=Se.next();it!==null&&!zt.done;dt++,zt=Se.next()){it.index>dt?(An=it,it=null):An=it.sibling;var Ai=De(be,it,zt.value,Le);if(Ai===null){it===null&&(it=An);break}a&&it&&Ai.alternate===null&&i(be,it),me=v(Ai,me,dt),St===null?We=Ai:St.sibling=Ai,St=Ai,it=An}if(zt.done)return l(be,it),Rt&&ir(be,dt),We;if(it===null){for(;!zt.done;dt++,zt=Se.next())zt=Me(be,zt.value,Le),zt!==null&&(me=v(zt,me,dt),St===null?We=zt:St.sibling=zt,St=zt);return Rt&&ir(be,dt),We}for(it=h(it);!zt.done;dt++,zt=Se.next())zt=Te(it,be,dt,zt.value,Le),zt!==null&&(a&&zt.alternate!==null&&it.delete(zt.key===null?dt:zt.key),me=v(zt,me,dt),St===null?We=zt:St.sibling=zt,St=zt);return a&&it.forEach(function(dw){return i(be,dw)}),Rt&&ir(be,dt),We}function Vt(be,me,Se,Le){if(typeof Se=="object"&&Se!==null&&Se.type===N&&Se.key===null&&(Se=Se.props.children),typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case x:e:{for(var We=Se.key;me!==null;){if(me.key===We){if(We=Se.type,We===N){if(me.tag===7){l(be,me.sibling),Le=b(me,Se.props.children),Le.return=be,be=Le;break e}}else if(me.elementType===We||typeof We=="object"&&We!==null&&We.$$typeof===B&&Wg(We)===me.type){l(be,me.sibling),Le=b(me,Se.props),Lo(Le,Se),Le.return=be,be=Le;break e}l(be,me);break}else i(be,me);me=me.sibling}Se.type===N?(Le=q(Se.props.children,be.mode,Le,Se.key),Le.return=be,be=Le):(Le=sr(Se.type,Se.key,Se.props,null,be.mode,Le),Lo(Le,Se),Le.return=be,be=Le)}return z(be);case j:e:{for(We=Se.key;me!==null;){if(me.key===We)if(me.tag===4&&me.stateNode.containerInfo===Se.containerInfo&&me.stateNode.implementation===Se.implementation){l(be,me.sibling),Le=b(me,Se.children||[]),Le.return=be,be=Le;break e}else{l(be,me);break}else i(be,me);me=me.sibling}Le=ne(Se,be.mode,Le),Le.return=be,be=Le}return z(be);case B:return We=Se._init,Se=We(Se._payload),Vt(be,me,Se,Le)}if(R(Se))return ht(be,me,Se,Le);if(P(Se)){if(We=P(Se),typeof We!="function")throw Error(r(150));return Se=We.call(Se),ut(be,me,Se,Le)}if(typeof Se.then=="function")return Vt(be,me,Nu(Se),Le);if(Se.$$typeof===E)return Vt(be,me,cu(be,Se),Le);wu(be,Se)}return typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint"?(Se=""+Se,me!==null&&me.tag===6?(l(be,me.sibling),Le=b(me,Se),Le.return=be,be=Le):(l(be,me),Le=ie(Se,be.mode,Le),Le.return=be,be=Le),z(be)):l(be,me)}return function(be,me,Se,Le){try{Ro=0;var We=Vt(be,me,Se,Le);return ol=null,We}catch(it){if(it===_o||it===du)throw it;var St=qn(29,it,null,be.mode);return St.lanes=Le,St.return=be,St}finally{}}}var cl=Zg(!0),ex=Zg(!1),Da=ge(null),ts=null;function gi(a){var i=a.alternate;w(kn,kn.current&1),w(Da,a),ts===null&&(i===null||sl.current!==null||i.memoizedState!==null)&&(ts=a)}function tx(a){if(a.tag===22){if(w(kn,kn.current),w(Da,a),ts===null){var i=a.alternate;i!==null&&i.memoizedState!==null&&(ts=a)}}else xi()}function xi(){w(kn,kn.current),w(Da,Da.current)}function Os(a){fe(Da),ts===a&&(ts=null),fe(kn)}var kn=ge(0);function Su(a){for(var i=a;i!==null;){if(i.tag===13){var l=i.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||Sm(l)))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break;for(;i.sibling===null;){if(i.return===null||i.return===a)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}function zh(a,i,l,h){i=a.memoizedState,l=l(h,i),l=l==null?i:f({},i,l),a.memoizedState=l,a.lanes===0&&(a.updateQueue.baseState=l)}var Rh={enqueueSetState:function(a,i,l){a=a._reactInternals;var h=ma(),b=mi(h);b.payload=i,l!=null&&(b.callback=l),i=pi(a,b,h),i!==null&&(pa(i,a,h),Eo(i,a,h))},enqueueReplaceState:function(a,i,l){a=a._reactInternals;var h=ma(),b=mi(h);b.tag=1,b.payload=i,l!=null&&(b.callback=l),i=pi(a,b,h),i!==null&&(pa(i,a,h),Eo(i,a,h))},enqueueForceUpdate:function(a,i){a=a._reactInternals;var l=ma(),h=mi(l);h.tag=2,i!=null&&(h.callback=i),i=pi(a,h,l),i!==null&&(pa(i,a,l),Eo(i,a,l))}};function nx(a,i,l,h,b,v,z){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(h,v,z):i.prototype&&i.prototype.isPureReactComponent?!_s(l,h)||!_s(b,v):!0}function ax(a,i,l,h){a=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(l,h),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(l,h),i.state!==a&&Rh.enqueueReplaceState(i,i.state,null)}function hr(a,i){var l=i;if("ref"in i){l={};for(var h in i)h!=="ref"&&(l[h]=i[h])}if(a=a.defaultProps){l===i&&(l=f({},l));for(var b in a)l[b]===void 0&&(l[b]=a[b])}return l}var ku=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function sx(a){ku(a)}function ix(a){console.error(a)}function rx(a){ku(a)}function Cu(a,i){try{var l=a.onUncaughtError;l(i.value,{componentStack:i.stack})}catch(h){setTimeout(function(){throw h})}}function lx(a,i,l){try{var h=a.onCaughtError;h(l.value,{componentStack:l.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function Lh(a,i,l){return l=mi(l),l.tag=3,l.payload={element:null},l.callback=function(){Cu(a,i)},l}function ox(a){return a=mi(a),a.tag=3,a}function cx(a,i,l,h){var b=l.type.getDerivedStateFromError;if(typeof b=="function"){var v=h.value;a.payload=function(){return b(v)},a.callback=function(){lx(i,l,h)}}var z=l.stateNode;z!==null&&typeof z.componentDidCatch=="function"&&(a.callback=function(){lx(i,l,h),typeof b!="function"&&(wi===null?wi=new Set([this]):wi.add(this));var H=h.stack;this.componentDidCatch(h.value,{componentStack:H!==null?H:""})})}function dN(a,i,l,h,b){if(l.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(i=l.alternate,i!==null&&So(i,l,b,!0),l=Da.current,l!==null){switch(l.tag){case 13:return ts===null?lm():l.alternate===null&&dn===0&&(dn=3),l.flags&=-257,l.flags|=65536,l.lanes=b,h===hh?l.flags|=16384:(i=l.updateQueue,i===null?l.updateQueue=new Set([h]):i.add(h),cm(a,h,b)),!1;case 22:return l.flags|=65536,h===hh?l.flags|=16384:(i=l.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([h])},l.updateQueue=i):(l=i.retryQueue,l===null?i.retryQueue=new Set([h]):l.add(h)),cm(a,h,b)),!1}throw Error(r(435,l.tag))}return cm(a,h,b),lm(),!1}if(Rt)return i=Da.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=b,h!==ih&&(a=Error(r(422),{cause:h}),wo(Xn(a,l)))):(h!==ih&&(i=Error(r(423),{cause:h}),wo(Xn(i,l))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,h=Xn(h,l),b=Lh(a.stateNode,h,b),fh(a,b),dn!==4&&(dn=2)),!1;var v=Error(r(520),{cause:h});if(v=Xn(v,l),Ho===null?Ho=[v]:Ho.push(v),dn!==4&&(dn=2),i===null)return!0;h=Xn(h,l),l=i;do{switch(l.tag){case 3:return l.flags|=65536,a=b&-b,l.lanes|=a,a=Lh(l.stateNode,h,a),fh(l,a),!1;case 1:if(i=l.type,v=l.stateNode,(l.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(wi===null||!wi.has(v))))return l.flags|=65536,b&=-b,l.lanes|=b,b=ox(b),cx(b,a,l,h),fh(l,b),!1}l=l.return}while(l!==null);return!1}var ux=Error(r(461)),En=!1;function Pn(a,i,l,h){i.child=a===null?ex(i,null,l,h):cl(i,a.child,l,h)}function dx(a,i,l,h,b){l=l.render;var v=i.ref;if("ref"in h){var z={};for(var H in h)H!=="ref"&&(z[H]=h[H])}else z=h;return cr(i),h=jh(a,i,l,z,v,b),H=vh(),a!==null&&!En?(Nh(a,i,b),zs(a,i,b)):(Rt&&H&&ah(i),i.flags|=1,Pn(a,i,h,b),i.child)}function hx(a,i,l,h,b){if(a===null){var v=l.type;return typeof v=="function"&&!bo(v)&&v.defaultProps===void 0&&l.compare===null?(i.tag=15,i.type=v,mx(a,i,v,h,b)):(a=sr(l.type,null,h,i,i.mode,b),a.ref=i.ref,a.return=i,i.child=a)}if(v=a.child,!Vh(a,b)){var z=v.memoizedProps;if(l=l.compare,l=l!==null?l:_s,l(z,h)&&a.ref===i.ref)return zs(a,i,b)}return i.flags|=1,a=_a(v,h),a.ref=i.ref,a.return=i,i.child=a}function mx(a,i,l,h,b){if(a!==null){var v=a.memoizedProps;if(_s(v,h)&&a.ref===i.ref)if(En=!1,i.pendingProps=h=v,Vh(a,b))(a.flags&131072)!==0&&(En=!0);else return i.lanes=a.lanes,zs(a,i,b)}return $h(a,i,l,h,b)}function px(a,i,l){var h=i.pendingProps,b=h.children,v=a!==null?a.memoizedState:null;if(h.mode==="hidden"){if((i.flags&128)!==0){if(h=v!==null?v.baseLanes|l:l,a!==null){for(b=i.child=a.child,v=0;b!==null;)v=v|b.lanes|b.childLanes,b=b.sibling;i.childLanes=v&~h}else i.childLanes=0,i.child=null;return fx(a,i,h,l)}if((l&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},a!==null&&uu(i,v!==null?v.cachePool:null),v!==null?mg(i,v):xh(),tx(i);else return i.lanes=i.childLanes=536870912,fx(a,i,v!==null?v.baseLanes|l:l,l)}else v!==null?(uu(i,v.cachePool),mg(i,v),xi(),i.memoizedState=null):(a!==null&&uu(i,null),xh(),xi());return Pn(a,i,b,l),i.child}function fx(a,i,l,h){var b=dh();return b=b===null?null:{parent:Sn._currentValue,pool:b},i.memoizedState={baseLanes:l,cachePool:b},a!==null&&uu(i,null),xh(),tx(i),a!==null&&So(a,i,h,!0),null}function _u(a,i){var l=i.ref;if(l===null)a!==null&&a.ref!==null&&(i.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(r(284));(a===null||a.ref!==l)&&(i.flags|=4194816)}}function $h(a,i,l,h,b){return cr(i),l=jh(a,i,l,h,void 0,b),h=vh(),a!==null&&!En?(Nh(a,i,b),zs(a,i,b)):(Rt&&h&&ah(i),i.flags|=1,Pn(a,i,l,b),i.child)}function gx(a,i,l,h,b,v){return cr(i),i.updateQueue=null,l=fg(i,h,l,b),pg(a),h=vh(),a!==null&&!En?(Nh(a,i,v),zs(a,i,v)):(Rt&&h&&ah(i),i.flags|=1,Pn(a,i,l,v),i.child)}function xx(a,i,l,h,b){if(cr(i),i.stateNode===null){var v=ui,z=l.contextType;typeof z=="object"&&z!==null&&(v=Rn(z)),v=new l(h,v),i.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,v.updater=Rh,i.stateNode=v,v._reactInternals=i,v=i.stateNode,v.props=h,v.state=i.memoizedState,v.refs={},mh(i),z=l.contextType,v.context=typeof z=="object"&&z!==null?Rn(z):ui,v.state=i.memoizedState,z=l.getDerivedStateFromProps,typeof z=="function"&&(zh(i,l,z,h),v.state=i.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(z=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),z!==v.state&&Rh.enqueueReplaceState(v,v.state,null),Ao(i,h,v,b),To(),v.state=i.memoizedState),typeof v.componentDidMount=="function"&&(i.flags|=4194308),h=!0}else if(a===null){v=i.stateNode;var H=i.memoizedProps,ce=hr(l,H);v.props=ce;var _e=v.context,ze=l.contextType;z=ui,typeof ze=="object"&&ze!==null&&(z=Rn(ze));var Me=l.getDerivedStateFromProps;ze=typeof Me=="function"||typeof v.getSnapshotBeforeUpdate=="function",H=i.pendingProps!==H,ze||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(H||_e!==z)&&ax(i,v,h,z),hi=!1;var De=i.memoizedState;v.state=De,Ao(i,h,v,b),To(),_e=i.memoizedState,H||De!==_e||hi?(typeof Me=="function"&&(zh(i,l,Me,h),_e=i.memoizedState),(ce=hi||nx(i,l,ce,h,De,_e,z))?(ze||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(i.flags|=4194308)):(typeof v.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=h,i.memoizedState=_e),v.props=h,v.state=_e,v.context=z,h=ce):(typeof v.componentDidMount=="function"&&(i.flags|=4194308),h=!1)}else{v=i.stateNode,ph(a,i),z=i.memoizedProps,ze=hr(l,z),v.props=ze,Me=i.pendingProps,De=v.context,_e=l.contextType,ce=ui,typeof _e=="object"&&_e!==null&&(ce=Rn(_e)),H=l.getDerivedStateFromProps,(_e=typeof H=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(z!==Me||De!==ce)&&ax(i,v,h,ce),hi=!1,De=i.memoizedState,v.state=De,Ao(i,h,v,b),To();var Te=i.memoizedState;z!==Me||De!==Te||hi||a!==null&&a.dependencies!==null&&ou(a.dependencies)?(typeof H=="function"&&(zh(i,l,H,h),Te=i.memoizedState),(ze=hi||nx(i,l,ze,h,De,Te,ce)||a!==null&&a.dependencies!==null&&ou(a.dependencies))?(_e||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(h,Te,ce),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(h,Te,ce)),typeof v.componentDidUpdate=="function"&&(i.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof v.componentDidUpdate!="function"||z===a.memoizedProps&&De===a.memoizedState||(i.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||z===a.memoizedProps&&De===a.memoizedState||(i.flags|=1024),i.memoizedProps=h,i.memoizedState=Te),v.props=h,v.state=Te,v.context=ce,h=ze):(typeof v.componentDidUpdate!="function"||z===a.memoizedProps&&De===a.memoizedState||(i.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||z===a.memoizedProps&&De===a.memoizedState||(i.flags|=1024),h=!1)}return v=h,_u(a,i),h=(i.flags&128)!==0,v||h?(v=i.stateNode,l=h&&typeof l.getDerivedStateFromError!="function"?null:v.render(),i.flags|=1,a!==null&&h?(i.child=cl(i,a.child,null,b),i.child=cl(i,null,l,b)):Pn(a,i,l,b),i.memoizedState=v.state,a=i.child):a=zs(a,i,b),a}function yx(a,i,l,h){return No(),i.flags|=256,Pn(a,i,l,h),i.child}var Fh={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Mh(a){return{baseLanes:a,cachePool:ig()}}function Bh(a,i,l){return a=a!==null?a.childLanes&~l:0,i&&(a|=Ea),a}function bx(a,i,l){var h=i.pendingProps,b=!1,v=(i.flags&128)!==0,z;if((z=v)||(z=a!==null&&a.memoizedState===null?!1:(kn.current&2)!==0),z&&(b=!0,i.flags&=-129),z=(i.flags&32)!==0,i.flags&=-33,a===null){if(Rt){if(b?gi(i):xi(),Rt){var H=un,ce;if(ce=H){e:{for(ce=H,H=es;ce.nodeType!==8;){if(!H){H=null;break e}if(ce=Ua(ce.nextSibling),ce===null){H=null;break e}}H=ce}H!==null?(i.memoizedState={dehydrated:H,treeContext:ca!==null?{id:Dn,overflow:Ts}:null,retryLane:536870912,hydrationErrors:null},ce=qn(18,null,null,0),ce.stateNode=H,ce.return=i,i.child=ce,Hn=i,un=null,ce=!0):ce=!1}ce||lr(i)}if(H=i.memoizedState,H!==null&&(H=H.dehydrated,H!==null))return Sm(H)?i.lanes=32:i.lanes=536870912,null;Os(i)}return H=h.children,h=h.fallback,b?(xi(),b=i.mode,H=Du({mode:"hidden",children:H},b),h=q(h,b,l,null),H.return=i,h.return=i,H.sibling=h,i.child=H,b=i.child,b.memoizedState=Mh(l),b.childLanes=Bh(a,z,l),i.memoizedState=Fh,h):(gi(i),Uh(i,H))}if(ce=a.memoizedState,ce!==null&&(H=ce.dehydrated,H!==null)){if(v)i.flags&256?(gi(i),i.flags&=-257,i=qh(a,i,l)):i.memoizedState!==null?(xi(),i.child=a.child,i.flags|=128,i=null):(xi(),b=h.fallback,H=i.mode,h=Du({mode:"visible",children:h.children},H),b=q(b,H,l,null),b.flags|=2,h.return=i,b.return=i,h.sibling=b,i.child=h,cl(i,a.child,null,l),h=i.child,h.memoizedState=Mh(l),h.childLanes=Bh(a,z,l),i.memoizedState=Fh,i=b);else if(gi(i),Sm(H)){if(z=H.nextSibling&&H.nextSibling.dataset,z)var _e=z.dgst;z=_e,h=Error(r(419)),h.stack="",h.digest=z,wo({value:h,source:null,stack:null}),i=qh(a,i,l)}else if(En||So(a,i,l,!1),z=(l&a.childLanes)!==0,En||z){if(z=Kt,z!==null&&(h=l&-l,h=(h&42)!==0?1:nt(h),h=(h&(z.suspendedLanes|l))!==0?0:h,h!==0&&h!==ce.retryLane))throw ce.retryLane=h,ci(a,h),pa(z,a,h),ux;H.data==="$?"||lm(),i=qh(a,i,l)}else H.data==="$?"?(i.flags|=192,i.child=a.child,i=null):(a=ce.treeContext,un=Ua(H.nextSibling),Hn=i,Rt=!0,rr=null,es=!1,a!==null&&(gt[ft++]=Dn,gt[ft++]=Ts,gt[ft++]=ca,Dn=a.id,Ts=a.overflow,ca=i),i=Uh(i,h.children),i.flags|=4096);return i}return b?(xi(),b=h.fallback,H=i.mode,ce=a.child,_e=ce.sibling,h=_a(ce,{mode:"hidden",children:h.children}),h.subtreeFlags=ce.subtreeFlags&65011712,_e!==null?b=_a(_e,b):(b=q(b,H,l,null),b.flags|=2),b.return=i,h.return=i,h.sibling=b,i.child=h,h=b,b=i.child,H=a.child.memoizedState,H===null?H=Mh(l):(ce=H.cachePool,ce!==null?(_e=Sn._currentValue,ce=ce.parent!==_e?{parent:_e,pool:_e}:ce):ce=ig(),H={baseLanes:H.baseLanes|l,cachePool:ce}),b.memoizedState=H,b.childLanes=Bh(a,z,l),i.memoizedState=Fh,h):(gi(i),l=a.child,a=l.sibling,l=_a(l,{mode:"visible",children:h.children}),l.return=i,l.sibling=null,a!==null&&(z=i.deletions,z===null?(i.deletions=[a],i.flags|=16):z.push(a)),i.child=l,i.memoizedState=null,l)}function Uh(a,i){return i=Du({mode:"visible",children:i},a.mode),i.return=a,a.child=i}function Du(a,i){return a=qn(22,a,null,i),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function qh(a,i,l){return cl(i,a.child,null,l),a=Uh(i,i.pendingProps.children),a.flags|=2,i.memoizedState=null,a}function jx(a,i,l){a.lanes|=i;var h=a.alternate;h!==null&&(h.lanes|=i),lh(a.return,i,l)}function Hh(a,i,l,h,b){var v=a.memoizedState;v===null?a.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:h,tail:l,tailMode:b}:(v.isBackwards=i,v.rendering=null,v.renderingStartTime=0,v.last=h,v.tail=l,v.tailMode=b)}function vx(a,i,l){var h=i.pendingProps,b=h.revealOrder,v=h.tail;if(Pn(a,i,h.children,l),h=kn.current,(h&2)!==0)h=h&1|2,i.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=i.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&jx(a,l,i);else if(a.tag===19)jx(a,l,i);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break e;for(;a.sibling===null;){if(a.return===null||a.return===i)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}h&=1}switch(w(kn,h),b){case"forwards":for(l=i.child,b=null;l!==null;)a=l.alternate,a!==null&&Su(a)===null&&(b=l),l=l.sibling;l=b,l===null?(b=i.child,i.child=null):(b=l.sibling,l.sibling=null),Hh(i,!1,b,l,v);break;case"backwards":for(l=null,b=i.child,i.child=null;b!==null;){if(a=b.alternate,a!==null&&Su(a)===null){i.child=b;break}a=b.sibling,b.sibling=l,l=b,b=a}Hh(i,!0,l,null,v);break;case"together":Hh(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function zs(a,i,l){if(a!==null&&(i.dependencies=a.dependencies),Ni|=i.lanes,(l&i.childLanes)===0)if(a!==null){if(So(a,i,l,!1),(l&i.childLanes)===0)return null}else return null;if(a!==null&&i.child!==a.child)throw Error(r(153));if(i.child!==null){for(a=i.child,l=_a(a,a.pendingProps),i.child=l,l.return=i;a.sibling!==null;)a=a.sibling,l=l.sibling=_a(a,a.pendingProps),l.return=i;l.sibling=null}return i.child}function Vh(a,i){return(a.lanes&i)!==0?!0:(a=a.dependencies,!!(a!==null&&ou(a)))}function hN(a,i,l){switch(i.tag){case 3:V(i,i.stateNode.containerInfo),di(i,Sn,a.memoizedState.cache),No();break;case 27:case 5:Pe(i);break;case 4:V(i,i.stateNode.containerInfo);break;case 10:di(i,i.type,i.memoizedProps.value);break;case 13:var h=i.memoizedState;if(h!==null)return h.dehydrated!==null?(gi(i),i.flags|=128,null):(l&i.child.childLanes)!==0?bx(a,i,l):(gi(i),a=zs(a,i,l),a!==null?a.sibling:null);gi(i);break;case 19:var b=(a.flags&128)!==0;if(h=(l&i.childLanes)!==0,h||(So(a,i,l,!1),h=(l&i.childLanes)!==0),b){if(h)return vx(a,i,l);i.flags|=128}if(b=i.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),w(kn,kn.current),h)break;return null;case 22:case 23:return i.lanes=0,px(a,i,l);case 24:di(i,Sn,a.memoizedState.cache)}return zs(a,i,l)}function Nx(a,i,l){if(a!==null)if(a.memoizedProps!==i.pendingProps)En=!0;else{if(!Vh(a,l)&&(i.flags&128)===0)return En=!1,hN(a,i,l);En=(a.flags&131072)!==0}else En=!1,Rt&&(i.flags&1048576)!==0&&Wf(i,st,i.index);switch(i.lanes=0,i.tag){case 16:e:{a=i.pendingProps;var h=i.elementType,b=h._init;if(h=b(h._payload),i.type=h,typeof h=="function")bo(h)?(a=hr(h,a),i.tag=1,i=xx(null,i,h,a,l)):(i.tag=0,i=$h(null,i,h,a,l));else{if(h!=null){if(b=h.$$typeof,b===U){i.tag=11,i=dx(null,i,h,a,l);break e}else if(b===F){i.tag=14,i=hx(null,i,h,a,l);break e}}throw i=J(h)||h,Error(r(306,i,""))}}return i;case 0:return $h(a,i,i.type,i.pendingProps,l);case 1:return h=i.type,b=hr(h,i.pendingProps),xx(a,i,h,b,l);case 3:e:{if(V(i,i.stateNode.containerInfo),a===null)throw Error(r(387));h=i.pendingProps;var v=i.memoizedState;b=v.element,ph(a,i),Ao(i,h,null,l);var z=i.memoizedState;if(h=z.cache,di(i,Sn,h),h!==v.cache&&oh(i,[Sn],l,!0),To(),h=z.element,v.isDehydrated)if(v={element:h,isDehydrated:!1,cache:z.cache},i.updateQueue.baseState=v,i.memoizedState=v,i.flags&256){i=yx(a,i,h,l);break e}else if(h!==b){b=Xn(Error(r(424)),i),wo(b),i=yx(a,i,h,l);break e}else{switch(a=i.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(un=Ua(a.firstChild),Hn=i,Rt=!0,rr=null,es=!0,l=ex(i,null,h,l),i.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(No(),h===b){i=zs(a,i,l);break e}Pn(a,i,h,l)}i=i.child}return i;case 26:return _u(a,i),a===null?(l=Cy(i.type,null,i.pendingProps,null))?i.memoizedState=l:Rt||(l=i.type,a=i.pendingProps,h=Uu(K.current).createElement(l),h[Xt]=i,h[sn]=a,On(h,l,a),yn(h),i.stateNode=h):i.memoizedState=Cy(i.type,a.memoizedProps,i.pendingProps,a.memoizedState),null;case 27:return Pe(i),a===null&&Rt&&(h=i.stateNode=wy(i.type,i.pendingProps,K.current),Hn=i,es=!0,b=un,Ci(i.type)?(km=b,un=Ua(h.firstChild)):un=b),Pn(a,i,i.pendingProps.children,l),_u(a,i),a===null&&(i.flags|=4194304),i.child;case 5:return a===null&&Rt&&((b=h=un)&&(h=MN(h,i.type,i.pendingProps,es),h!==null?(i.stateNode=h,Hn=i,un=Ua(h.firstChild),es=!1,b=!0):b=!1),b||lr(i)),Pe(i),b=i.type,v=i.pendingProps,z=a!==null?a.memoizedProps:null,h=v.children,vm(b,v)?h=null:z!==null&&vm(b,z)&&(i.flags|=32),i.memoizedState!==null&&(b=jh(a,i,sN,null,null,l),Zo._currentValue=b),_u(a,i),Pn(a,i,h,l),i.child;case 6:return a===null&&Rt&&((a=l=un)&&(l=BN(l,i.pendingProps,es),l!==null?(i.stateNode=l,Hn=i,un=null,a=!0):a=!1),a||lr(i)),null;case 13:return bx(a,i,l);case 4:return V(i,i.stateNode.containerInfo),h=i.pendingProps,a===null?i.child=cl(i,null,h,l):Pn(a,i,h,l),i.child;case 11:return dx(a,i,i.type,i.pendingProps,l);case 7:return Pn(a,i,i.pendingProps,l),i.child;case 8:return Pn(a,i,i.pendingProps.children,l),i.child;case 12:return Pn(a,i,i.pendingProps.children,l),i.child;case 10:return h=i.pendingProps,di(i,i.type,h.value),Pn(a,i,h.children,l),i.child;case 9:return b=i.type._context,h=i.pendingProps.children,cr(i),b=Rn(b),h=h(b),i.flags|=1,Pn(a,i,h,l),i.child;case 14:return hx(a,i,i.type,i.pendingProps,l);case 15:return mx(a,i,i.type,i.pendingProps,l);case 19:return vx(a,i,l);case 31:return h=i.pendingProps,l=i.mode,h={mode:h.mode,children:h.children},a===null?(l=Du(h,l),l.ref=i.ref,i.child=l,l.return=i,i=l):(l=_a(a.child,h),l.ref=i.ref,i.child=l,l.return=i,i=l),i;case 22:return px(a,i,l);case 24:return cr(i),h=Rn(Sn),a===null?(b=dh(),b===null&&(b=Kt,v=ch(),b.pooledCache=v,v.refCount++,v!==null&&(b.pooledCacheLanes|=l),b=v),i.memoizedState={parent:h,cache:b},mh(i),di(i,Sn,b)):((a.lanes&l)!==0&&(ph(a,i),Ao(i,null,null,l),To()),b=a.memoizedState,v=i.memoizedState,b.parent!==h?(b={parent:h,cache:h},i.memoizedState=b,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=b),di(i,Sn,h)):(h=v.cache,di(i,Sn,h),h!==b.cache&&oh(i,[Sn],l,!0))),Pn(a,i,i.pendingProps.children,l),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function Rs(a){a.flags|=4}function wx(a,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Ay(i)){if(i=Da.current,i!==null&&((It&4194048)===It?ts!==null:(It&62914560)!==It&&(It&536870912)===0||i!==ts))throw Do=hh,rg;a.flags|=8192}}function Eu(a,i){i!==null&&(a.flags|=4),a.flags&16384&&(i=a.tag!==22?at():536870912,a.lanes|=i,ml|=i)}function $o(a,i){if(!Rt)switch(a.tailMode){case"hidden":i=a.tail;for(var l=null;i!==null;)i.alternate!==null&&(l=i),i=i.sibling;l===null?a.tail=null:l.sibling=null;break;case"collapsed":l=a.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?i||a.tail===null?a.tail=null:a.tail.sibling=null:h.sibling=null}}function ln(a){var i=a.alternate!==null&&a.alternate.child===a.child,l=0,h=0;if(i)for(var b=a.child;b!==null;)l|=b.lanes|b.childLanes,h|=b.subtreeFlags&65011712,h|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)l|=b.lanes|b.childLanes,h|=b.subtreeFlags,h|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=h,a.childLanes=l,i}function mN(a,i,l){var h=i.pendingProps;switch(sh(i),i.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ln(i),null;case 1:return ln(i),null;case 3:return l=i.stateNode,h=null,a!==null&&(h=a.memoizedState.cache),i.memoizedState.cache!==h&&(i.flags|=2048),Ps(Sn),oe(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(a===null||a.child===null)&&(vo(i)?Rs(i):a===null||a.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,tg())),ln(i),null;case 26:return l=i.memoizedState,a===null?(Rs(i),l!==null?(ln(i),wx(i,l)):(ln(i),i.flags&=-16777217)):l?l!==a.memoizedState?(Rs(i),ln(i),wx(i,l)):(ln(i),i.flags&=-16777217):(a.memoizedProps!==h&&Rs(i),ln(i),i.flags&=-16777217),null;case 27:se(i),l=K.current;var b=i.type;if(a!==null&&i.stateNode!=null)a.memoizedProps!==h&&Rs(i);else{if(!h){if(i.stateNode===null)throw Error(r(166));return ln(i),null}a=ue.current,vo(i)?Zf(i):(a=wy(b,h,l),i.stateNode=a,Rs(i))}return ln(i),null;case 5:if(se(i),l=i.type,a!==null&&i.stateNode!=null)a.memoizedProps!==h&&Rs(i);else{if(!h){if(i.stateNode===null)throw Error(r(166));return ln(i),null}if(a=ue.current,vo(i))Zf(i);else{switch(b=Uu(K.current),a){case 1:a=b.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:a=b.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":a=b.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":a=b.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":a=b.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof h.is=="string"?b.createElement("select",{is:h.is}):b.createElement("select"),h.multiple?a.multiple=!0:h.size&&(a.size=h.size);break;default:a=typeof h.is=="string"?b.createElement(l,{is:h.is}):b.createElement(l)}}a[Xt]=i,a[sn]=h;e:for(b=i.child;b!==null;){if(b.tag===5||b.tag===6)a.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===i)break e;for(;b.sibling===null;){if(b.return===null||b.return===i)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}i.stateNode=a;e:switch(On(a,l,h),l){case"button":case"input":case"select":case"textarea":a=!!h.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&Rs(i)}}return ln(i),i.flags&=-16777217,null;case 6:if(a&&i.stateNode!=null)a.memoizedProps!==h&&Rs(i);else{if(typeof h!="string"&&i.stateNode===null)throw Error(r(166));if(a=K.current,vo(i)){if(a=i.stateNode,l=i.memoizedProps,h=null,b=Hn,b!==null)switch(b.tag){case 27:case 5:h=b.memoizedProps}a[Xt]=i,a=!!(a.nodeValue===l||h!==null&&h.suppressHydrationWarning===!0||gy(a.nodeValue,l)),a||lr(i)}else a=Uu(a).createTextNode(h),a[Xt]=i,i.stateNode=a}return ln(i),null;case 13:if(h=i.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=vo(i),h!==null&&h.dehydrated!==null){if(a===null){if(!b)throw Error(r(318));if(b=i.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(r(317));b[Xt]=i}else No(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;ln(i),b=!1}else b=tg(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return i.flags&256?(Os(i),i):(Os(i),null)}if(Os(i),(i.flags&128)!==0)return i.lanes=l,i;if(l=h!==null,a=a!==null&&a.memoizedState!==null,l){h=i.child,b=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(b=h.alternate.memoizedState.cachePool.pool);var v=null;h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(v=h.memoizedState.cachePool.pool),v!==b&&(h.flags|=2048)}return l!==a&&l&&(i.child.flags|=8192),Eu(i,i.updateQueue),ln(i),null;case 4:return oe(),a===null&&gm(i.stateNode.containerInfo),ln(i),null;case 10:return Ps(i.type),ln(i),null;case 19:if(fe(kn),b=i.memoizedState,b===null)return ln(i),null;if(h=(i.flags&128)!==0,v=b.rendering,v===null)if(h)$o(b,!1);else{if(dn!==0||a!==null&&(a.flags&128)!==0)for(a=i.child;a!==null;){if(v=Su(a),v!==null){for(i.flags|=128,$o(b,!1),a=v.updateQueue,i.updateQueue=a,Eu(i,a),i.subtreeFlags=0,a=l,l=i.child;l!==null;)jo(l,a),l=l.sibling;return w(kn,kn.current&1|2),i.child}a=a.sibling}b.tail!==null&&Fe()>Pu&&(i.flags|=128,h=!0,$o(b,!1),i.lanes=4194304)}else{if(!h)if(a=Su(v),a!==null){if(i.flags|=128,h=!0,a=a.updateQueue,i.updateQueue=a,Eu(i,a),$o(b,!0),b.tail===null&&b.tailMode==="hidden"&&!v.alternate&&!Rt)return ln(i),null}else 2*Fe()-b.renderingStartTime>Pu&&l!==536870912&&(i.flags|=128,h=!0,$o(b,!1),i.lanes=4194304);b.isBackwards?(v.sibling=i.child,i.child=v):(a=b.last,a!==null?a.sibling=v:i.child=v,b.last=v)}return b.tail!==null?(i=b.tail,b.rendering=i,b.tail=i.sibling,b.renderingStartTime=Fe(),i.sibling=null,a=kn.current,w(kn,h?a&1|2:a&1),i):(ln(i),null);case 22:case 23:return Os(i),yh(),h=i.memoizedState!==null,a!==null?a.memoizedState!==null!==h&&(i.flags|=8192):h&&(i.flags|=8192),h?(l&536870912)!==0&&(i.flags&128)===0&&(ln(i),i.subtreeFlags&6&&(i.flags|=8192)):ln(i),l=i.updateQueue,l!==null&&Eu(i,l.retryQueue),l=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),h=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(h=i.memoizedState.cachePool.pool),h!==l&&(i.flags|=2048),a!==null&&fe(ur),null;case 24:return l=null,a!==null&&(l=a.memoizedState.cache),i.memoizedState.cache!==l&&(i.flags|=2048),Ps(Sn),ln(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function pN(a,i){switch(sh(i),i.tag){case 1:return a=i.flags,a&65536?(i.flags=a&-65537|128,i):null;case 3:return Ps(Sn),oe(),a=i.flags,(a&65536)!==0&&(a&128)===0?(i.flags=a&-65537|128,i):null;case 26:case 27:case 5:return se(i),null;case 13:if(Os(i),a=i.memoizedState,a!==null&&a.dehydrated!==null){if(i.alternate===null)throw Error(r(340));No()}return a=i.flags,a&65536?(i.flags=a&-65537|128,i):null;case 19:return fe(kn),null;case 4:return oe(),null;case 10:return Ps(i.type),null;case 22:case 23:return Os(i),yh(),a!==null&&fe(ur),a=i.flags,a&65536?(i.flags=a&-65537|128,i):null;case 24:return Ps(Sn),null;case 25:return null;default:return null}}function Sx(a,i){switch(sh(i),i.tag){case 3:Ps(Sn),oe();break;case 26:case 27:case 5:se(i);break;case 4:oe();break;case 13:Os(i);break;case 19:fe(kn);break;case 10:Ps(i.type);break;case 22:case 23:Os(i),yh(),a!==null&&fe(ur);break;case 24:Ps(Sn)}}function Fo(a,i){try{var l=i.updateQueue,h=l!==null?l.lastEffect:null;if(h!==null){var b=h.next;l=b;do{if((l.tag&a)===a){h=void 0;var v=l.create,z=l.inst;h=v(),z.destroy=h}l=l.next}while(l!==b)}}catch(H){Yt(i,i.return,H)}}function yi(a,i,l){try{var h=i.updateQueue,b=h!==null?h.lastEffect:null;if(b!==null){var v=b.next;h=v;do{if((h.tag&a)===a){var z=h.inst,H=z.destroy;if(H!==void 0){z.destroy=void 0,b=i;var ce=l,_e=H;try{_e()}catch(ze){Yt(b,ce,ze)}}}h=h.next}while(h!==v)}}catch(ze){Yt(i,i.return,ze)}}function kx(a){var i=a.updateQueue;if(i!==null){var l=a.stateNode;try{hg(i,l)}catch(h){Yt(a,a.return,h)}}}function Cx(a,i,l){l.props=hr(a.type,a.memoizedProps),l.state=a.memoizedState;try{l.componentWillUnmount()}catch(h){Yt(a,i,h)}}function Mo(a,i){try{var l=a.ref;if(l!==null){switch(a.tag){case 26:case 27:case 5:var h=a.stateNode;break;case 30:h=a.stateNode;break;default:h=a.stateNode}typeof l=="function"?a.refCleanup=l(h):l.current=h}}catch(b){Yt(a,i,b)}}function ns(a,i){var l=a.ref,h=a.refCleanup;if(l!==null)if(typeof h=="function")try{h()}catch(b){Yt(a,i,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(b){Yt(a,i,b)}else l.current=null}function _x(a){var i=a.type,l=a.memoizedProps,h=a.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":l.autoFocus&&h.focus();break e;case"img":l.src?h.src=l.src:l.srcSet&&(h.srcset=l.srcSet)}}catch(b){Yt(a,a.return,b)}}function Gh(a,i,l){try{var h=a.stateNode;zN(h,a.type,l,i),h[sn]=i}catch(b){Yt(a,a.return,b)}}function Dx(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Ci(a.type)||a.tag===4}function Qh(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Dx(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Ci(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Yh(a,i,l){var h=a.tag;if(h===5||h===6)a=a.stateNode,i?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(a,i):(i=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,i.appendChild(a),l=l._reactRootContainer,l!=null||i.onclick!==null||(i.onclick=Bu));else if(h!==4&&(h===27&&Ci(a.type)&&(l=a.stateNode,i=null),a=a.child,a!==null))for(Yh(a,i,l),a=a.sibling;a!==null;)Yh(a,i,l),a=a.sibling}function Tu(a,i,l){var h=a.tag;if(h===5||h===6)a=a.stateNode,i?l.insertBefore(a,i):l.appendChild(a);else if(h!==4&&(h===27&&Ci(a.type)&&(l=a.stateNode),a=a.child,a!==null))for(Tu(a,i,l),a=a.sibling;a!==null;)Tu(a,i,l),a=a.sibling}function Ex(a){var i=a.stateNode,l=a.memoizedProps;try{for(var h=a.type,b=i.attributes;b.length;)i.removeAttributeNode(b[0]);On(i,h,l),i[Xt]=a,i[sn]=l}catch(v){Yt(a,a.return,v)}}var Ls=!1,gn=!1,Jh=!1,Tx=typeof WeakSet=="function"?WeakSet:Set,Tn=null;function fN(a,i){if(a=a.containerInfo,bm=Yu,a=tu(a),Ca(a)){if("selectionStart"in a)var l={start:a.selectionStart,end:a.selectionEnd};else e:{l=(l=a.ownerDocument)&&l.defaultView||window;var h=l.getSelection&&l.getSelection();if(h&&h.rangeCount!==0){l=h.anchorNode;var b=h.anchorOffset,v=h.focusNode;h=h.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var z=0,H=-1,ce=-1,_e=0,ze=0,Me=a,De=null;t:for(;;){for(var Te;Me!==l||b!==0&&Me.nodeType!==3||(H=z+b),Me!==v||h!==0&&Me.nodeType!==3||(ce=z+h),Me.nodeType===3&&(z+=Me.nodeValue.length),(Te=Me.firstChild)!==null;)De=Me,Me=Te;for(;;){if(Me===a)break t;if(De===l&&++_e===b&&(H=z),De===v&&++ze===h&&(ce=z),(Te=Me.nextSibling)!==null)break;Me=De,De=Me.parentNode}Me=Te}l=H===-1||ce===-1?null:{start:H,end:ce}}else l=null}l=l||{start:0,end:0}}else l=null;for(jm={focusedElem:a,selectionRange:l},Yu=!1,Tn=i;Tn!==null;)if(i=Tn,a=i.child,(i.subtreeFlags&1024)!==0&&a!==null)a.return=i,Tn=a;else for(;Tn!==null;){switch(i=Tn,v=i.alternate,a=i.flags,i.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&v!==null){a=void 0,l=i,b=v.memoizedProps,v=v.memoizedState,h=l.stateNode;try{var ht=hr(l.type,b,l.elementType===l.type);a=h.getSnapshotBeforeUpdate(ht,v),h.__reactInternalSnapshotBeforeUpdate=a}catch(ut){Yt(l,l.return,ut)}}break;case 3:if((a&1024)!==0){if(a=i.stateNode.containerInfo,l=a.nodeType,l===9)wm(a);else if(l===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":wm(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(r(163))}if(a=i.sibling,a!==null){a.return=i.return,Tn=a;break}Tn=i.return}}function Ax(a,i,l){var h=l.flags;switch(l.tag){case 0:case 11:case 15:bi(a,l),h&4&&Fo(5,l);break;case 1:if(bi(a,l),h&4)if(a=l.stateNode,i===null)try{a.componentDidMount()}catch(z){Yt(l,l.return,z)}else{var b=hr(l.type,i.memoizedProps);i=i.memoizedState;try{a.componentDidUpdate(b,i,a.__reactInternalSnapshotBeforeUpdate)}catch(z){Yt(l,l.return,z)}}h&64&&kx(l),h&512&&Mo(l,l.return);break;case 3:if(bi(a,l),h&64&&(a=l.updateQueue,a!==null)){if(i=null,l.child!==null)switch(l.child.tag){case 27:case 5:i=l.child.stateNode;break;case 1:i=l.child.stateNode}try{hg(a,i)}catch(z){Yt(l,l.return,z)}}break;case 27:i===null&&h&4&&Ex(l);case 26:case 5:bi(a,l),i===null&&h&4&&_x(l),h&512&&Mo(l,l.return);break;case 12:bi(a,l);break;case 13:bi(a,l),h&4&&Ox(a,l),h&64&&(a=l.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(l=SN.bind(null,l),UN(a,l))));break;case 22:if(h=l.memoizedState!==null||Ls,!h){i=i!==null&&i.memoizedState!==null||gn,b=Ls;var v=gn;Ls=h,(gn=i)&&!v?ji(a,l,(l.subtreeFlags&8772)!==0):bi(a,l),Ls=b,gn=v}break;case 30:break;default:bi(a,l)}}function Px(a){var i=a.alternate;i!==null&&(a.alternate=null,Px(i)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(i=a.stateNode,i!==null&&Ql(i)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var an=null,Wn=!1;function $s(a,i,l){for(l=l.child;l!==null;)Ix(a,i,l),l=l.sibling}function Ix(a,i,l){if(te&&typeof te.onCommitFiberUnmount=="function")try{te.onCommitFiberUnmount(O,l)}catch{}switch(l.tag){case 26:gn||ns(l,i),$s(a,i,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:gn||ns(l,i);var h=an,b=Wn;Ci(l.type)&&(an=l.stateNode,Wn=!1),$s(a,i,l),Jo(l.stateNode),an=h,Wn=b;break;case 5:gn||ns(l,i);case 6:if(h=an,b=Wn,an=null,$s(a,i,l),an=h,Wn=b,an!==null)if(Wn)try{(an.nodeType===9?an.body:an.nodeName==="HTML"?an.ownerDocument.body:an).removeChild(l.stateNode)}catch(v){Yt(l,i,v)}else try{an.removeChild(l.stateNode)}catch(v){Yt(l,i,v)}break;case 18:an!==null&&(Wn?(a=an,vy(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,l.stateNode),ac(a)):vy(an,l.stateNode));break;case 4:h=an,b=Wn,an=l.stateNode.containerInfo,Wn=!0,$s(a,i,l),an=h,Wn=b;break;case 0:case 11:case 14:case 15:gn||yi(2,l,i),gn||yi(4,l,i),$s(a,i,l);break;case 1:gn||(ns(l,i),h=l.stateNode,typeof h.componentWillUnmount=="function"&&Cx(l,i,h)),$s(a,i,l);break;case 21:$s(a,i,l);break;case 22:gn=(h=gn)||l.memoizedState!==null,$s(a,i,l),gn=h;break;default:$s(a,i,l)}}function Ox(a,i){if(i.memoizedState===null&&(a=i.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{ac(a)}catch(l){Yt(i,i.return,l)}}function gN(a){switch(a.tag){case 13:case 19:var i=a.stateNode;return i===null&&(i=a.stateNode=new Tx),i;case 22:return a=a.stateNode,i=a._retryCache,i===null&&(i=a._retryCache=new Tx),i;default:throw Error(r(435,a.tag))}}function Xh(a,i){var l=gN(a);i.forEach(function(h){var b=kN.bind(null,a,h);l.has(h)||(l.add(h),h.then(b,b))})}function ua(a,i){var l=i.deletions;if(l!==null)for(var h=0;h<l.length;h++){var b=l[h],v=a,z=i,H=z;e:for(;H!==null;){switch(H.tag){case 27:if(Ci(H.type)){an=H.stateNode,Wn=!1;break e}break;case 5:an=H.stateNode,Wn=!1;break e;case 3:case 4:an=H.stateNode.containerInfo,Wn=!0;break e}H=H.return}if(an===null)throw Error(r(160));Ix(v,z,b),an=null,Wn=!1,v=b.alternate,v!==null&&(v.return=null),b.return=null}if(i.subtreeFlags&13878)for(i=i.child;i!==null;)zx(i,a),i=i.sibling}var Ba=null;function zx(a,i){var l=a.alternate,h=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:ua(i,a),da(a),h&4&&(yi(3,a,a.return),Fo(3,a),yi(5,a,a.return));break;case 1:ua(i,a),da(a),h&512&&(gn||l===null||ns(l,l.return)),h&64&&Ls&&(a=a.updateQueue,a!==null&&(h=a.callbacks,h!==null&&(l=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=l===null?h:l.concat(h))));break;case 26:var b=Ba;if(ua(i,a),da(a),h&512&&(gn||l===null||ns(l,l.return)),h&4){var v=l!==null?l.memoizedState:null;if(h=a.memoizedState,l===null)if(h===null)if(a.stateNode===null){e:{h=a.type,l=a.memoizedProps,b=b.ownerDocument||b;t:switch(h){case"title":v=b.getElementsByTagName("title")[0],(!v||v[fs]||v[Xt]||v.namespaceURI==="http://www.w3.org/2000/svg"||v.hasAttribute("itemprop"))&&(v=b.createElement(h),b.head.insertBefore(v,b.querySelector("head > title"))),On(v,h,l),v[Xt]=a,yn(v),h=v;break e;case"link":var z=Ey("link","href",b).get(h+(l.href||""));if(z){for(var H=0;H<z.length;H++)if(v=z[H],v.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&v.getAttribute("rel")===(l.rel==null?null:l.rel)&&v.getAttribute("title")===(l.title==null?null:l.title)&&v.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){z.splice(H,1);break t}}v=b.createElement(h),On(v,h,l),b.head.appendChild(v);break;case"meta":if(z=Ey("meta","content",b).get(h+(l.content||""))){for(H=0;H<z.length;H++)if(v=z[H],v.getAttribute("content")===(l.content==null?null:""+l.content)&&v.getAttribute("name")===(l.name==null?null:l.name)&&v.getAttribute("property")===(l.property==null?null:l.property)&&v.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&v.getAttribute("charset")===(l.charSet==null?null:l.charSet)){z.splice(H,1);break t}}v=b.createElement(h),On(v,h,l),b.head.appendChild(v);break;default:throw Error(r(468,h))}v[Xt]=a,yn(v),h=v}a.stateNode=h}else Ty(b,a.type,a.stateNode);else a.stateNode=Dy(b,h,a.memoizedProps);else v!==h?(v===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):v.count--,h===null?Ty(b,a.type,a.stateNode):Dy(b,h,a.memoizedProps)):h===null&&a.stateNode!==null&&Gh(a,a.memoizedProps,l.memoizedProps)}break;case 27:ua(i,a),da(a),h&512&&(gn||l===null||ns(l,l.return)),l!==null&&h&4&&Gh(a,a.memoizedProps,l.memoizedProps);break;case 5:if(ua(i,a),da(a),h&512&&(gn||l===null||ns(l,l.return)),a.flags&32){b=a.stateNode;try{Na(b,"")}catch(Te){Yt(a,a.return,Te)}}h&4&&a.stateNode!=null&&(b=a.memoizedProps,Gh(a,b,l!==null?l.memoizedProps:b)),h&1024&&(Jh=!0);break;case 6:if(ua(i,a),da(a),h&4){if(a.stateNode===null)throw Error(r(162));h=a.memoizedProps,l=a.stateNode;try{l.nodeValue=h}catch(Te){Yt(a,a.return,Te)}}break;case 3:if(Vu=null,b=Ba,Ba=qu(i.containerInfo),ua(i,a),Ba=b,da(a),h&4&&l!==null&&l.memoizedState.isDehydrated)try{ac(i.containerInfo)}catch(Te){Yt(a,a.return,Te)}Jh&&(Jh=!1,Rx(a));break;case 4:h=Ba,Ba=qu(a.stateNode.containerInfo),ua(i,a),da(a),Ba=h;break;case 12:ua(i,a),da(a);break;case 13:ua(i,a),da(a),a.child.flags&8192&&a.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(nm=Fe()),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,Xh(a,h)));break;case 22:b=a.memoizedState!==null;var ce=l!==null&&l.memoizedState!==null,_e=Ls,ze=gn;if(Ls=_e||b,gn=ze||ce,ua(i,a),gn=ze,Ls=_e,da(a),h&8192)e:for(i=a.stateNode,i._visibility=b?i._visibility&-2:i._visibility|1,b&&(l===null||ce||Ls||gn||mr(a)),l=null,i=a;;){if(i.tag===5||i.tag===26){if(l===null){ce=l=i;try{if(v=ce.stateNode,b)z=v.style,typeof z.setProperty=="function"?z.setProperty("display","none","important"):z.display="none";else{H=ce.stateNode;var Me=ce.memoizedProps.style,De=Me!=null&&Me.hasOwnProperty("display")?Me.display:null;H.style.display=De==null||typeof De=="boolean"?"":(""+De).trim()}}catch(Te){Yt(ce,ce.return,Te)}}}else if(i.tag===6){if(l===null){ce=i;try{ce.stateNode.nodeValue=b?"":ce.memoizedProps}catch(Te){Yt(ce,ce.return,Te)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===a)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;l===i&&(l=null),i=i.return}l===i&&(l=null),i.sibling.return=i.return,i=i.sibling}h&4&&(h=a.updateQueue,h!==null&&(l=h.retryQueue,l!==null&&(h.retryQueue=null,Xh(a,l))));break;case 19:ua(i,a),da(a),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,Xh(a,h)));break;case 30:break;case 21:break;default:ua(i,a),da(a)}}function da(a){var i=a.flags;if(i&2){try{for(var l,h=a.return;h!==null;){if(Dx(h)){l=h;break}h=h.return}if(l==null)throw Error(r(160));switch(l.tag){case 27:var b=l.stateNode,v=Qh(a);Tu(a,v,b);break;case 5:var z=l.stateNode;l.flags&32&&(Na(z,""),l.flags&=-33);var H=Qh(a);Tu(a,H,z);break;case 3:case 4:var ce=l.stateNode.containerInfo,_e=Qh(a);Yh(a,_e,ce);break;default:throw Error(r(161))}}catch(ze){Yt(a,a.return,ze)}a.flags&=-3}i&4096&&(a.flags&=-4097)}function Rx(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var i=a;Rx(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),a=a.sibling}}function bi(a,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Ax(a,i.alternate,i),i=i.sibling}function mr(a){for(a=a.child;a!==null;){var i=a;switch(i.tag){case 0:case 11:case 14:case 15:yi(4,i,i.return),mr(i);break;case 1:ns(i,i.return);var l=i.stateNode;typeof l.componentWillUnmount=="function"&&Cx(i,i.return,l),mr(i);break;case 27:Jo(i.stateNode);case 26:case 5:ns(i,i.return),mr(i);break;case 22:i.memoizedState===null&&mr(i);break;case 30:mr(i);break;default:mr(i)}a=a.sibling}}function ji(a,i,l){for(l=l&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var h=i.alternate,b=a,v=i,z=v.flags;switch(v.tag){case 0:case 11:case 15:ji(b,v,l),Fo(4,v);break;case 1:if(ji(b,v,l),h=v,b=h.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(_e){Yt(h,h.return,_e)}if(h=v,b=h.updateQueue,b!==null){var H=h.stateNode;try{var ce=b.shared.hiddenCallbacks;if(ce!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ce.length;b++)dg(ce[b],H)}catch(_e){Yt(h,h.return,_e)}}l&&z&64&&kx(v),Mo(v,v.return);break;case 27:Ex(v);case 26:case 5:ji(b,v,l),l&&h===null&&z&4&&_x(v),Mo(v,v.return);break;case 12:ji(b,v,l);break;case 13:ji(b,v,l),l&&z&4&&Ox(b,v);break;case 22:v.memoizedState===null&&ji(b,v,l),Mo(v,v.return);break;case 30:break;default:ji(b,v,l)}i=i.sibling}}function Kh(a,i){var l=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(l=a.memoizedState.cachePool.pool),a=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(a=i.memoizedState.cachePool.pool),a!==l&&(a!=null&&a.refCount++,l!=null&&ko(l))}function Wh(a,i){a=null,i.alternate!==null&&(a=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==a&&(i.refCount++,a!=null&&ko(a))}function as(a,i,l,h){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Lx(a,i,l,h),i=i.sibling}function Lx(a,i,l,h){var b=i.flags;switch(i.tag){case 0:case 11:case 15:as(a,i,l,h),b&2048&&Fo(9,i);break;case 1:as(a,i,l,h);break;case 3:as(a,i,l,h),b&2048&&(a=null,i.alternate!==null&&(a=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==a&&(i.refCount++,a!=null&&ko(a)));break;case 12:if(b&2048){as(a,i,l,h),a=i.stateNode;try{var v=i.memoizedProps,z=v.id,H=v.onPostCommit;typeof H=="function"&&H(z,i.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ce){Yt(i,i.return,ce)}}else as(a,i,l,h);break;case 13:as(a,i,l,h);break;case 23:break;case 22:v=i.stateNode,z=i.alternate,i.memoizedState!==null?v._visibility&2?as(a,i,l,h):Bo(a,i):v._visibility&2?as(a,i,l,h):(v._visibility|=2,ul(a,i,l,h,(i.subtreeFlags&10256)!==0)),b&2048&&Kh(z,i);break;case 24:as(a,i,l,h),b&2048&&Wh(i.alternate,i);break;default:as(a,i,l,h)}}function ul(a,i,l,h,b){for(b=b&&(i.subtreeFlags&10256)!==0,i=i.child;i!==null;){var v=a,z=i,H=l,ce=h,_e=z.flags;switch(z.tag){case 0:case 11:case 15:ul(v,z,H,ce,b),Fo(8,z);break;case 23:break;case 22:var ze=z.stateNode;z.memoizedState!==null?ze._visibility&2?ul(v,z,H,ce,b):Bo(v,z):(ze._visibility|=2,ul(v,z,H,ce,b)),b&&_e&2048&&Kh(z.alternate,z);break;case 24:ul(v,z,H,ce,b),b&&_e&2048&&Wh(z.alternate,z);break;default:ul(v,z,H,ce,b)}i=i.sibling}}function Bo(a,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var l=a,h=i,b=h.flags;switch(h.tag){case 22:Bo(l,h),b&2048&&Kh(h.alternate,h);break;case 24:Bo(l,h),b&2048&&Wh(h.alternate,h);break;default:Bo(l,h)}i=i.sibling}}var Uo=8192;function dl(a){if(a.subtreeFlags&Uo)for(a=a.child;a!==null;)$x(a),a=a.sibling}function $x(a){switch(a.tag){case 26:dl(a),a.flags&Uo&&a.memoizedState!==null&&tw(Ba,a.memoizedState,a.memoizedProps);break;case 5:dl(a);break;case 3:case 4:var i=Ba;Ba=qu(a.stateNode.containerInfo),dl(a),Ba=i;break;case 22:a.memoizedState===null&&(i=a.alternate,i!==null&&i.memoizedState!==null?(i=Uo,Uo=16777216,dl(a),Uo=i):dl(a));break;default:dl(a)}}function Fx(a){var i=a.alternate;if(i!==null&&(a=i.child,a!==null)){i.child=null;do i=a.sibling,a.sibling=null,a=i;while(a!==null)}}function qo(a){var i=a.deletions;if((a.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var h=i[l];Tn=h,Bx(h,a)}Fx(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Mx(a),a=a.sibling}function Mx(a){switch(a.tag){case 0:case 11:case 15:qo(a),a.flags&2048&&yi(9,a,a.return);break;case 3:qo(a);break;case 12:qo(a);break;case 22:var i=a.stateNode;a.memoizedState!==null&&i._visibility&2&&(a.return===null||a.return.tag!==13)?(i._visibility&=-3,Au(a)):qo(a);break;default:qo(a)}}function Au(a){var i=a.deletions;if((a.flags&16)!==0){if(i!==null)for(var l=0;l<i.length;l++){var h=i[l];Tn=h,Bx(h,a)}Fx(a)}for(a=a.child;a!==null;){switch(i=a,i.tag){case 0:case 11:case 15:yi(8,i,i.return),Au(i);break;case 22:l=i.stateNode,l._visibility&2&&(l._visibility&=-3,Au(i));break;default:Au(i)}a=a.sibling}}function Bx(a,i){for(;Tn!==null;){var l=Tn;switch(l.tag){case 0:case 11:case 15:yi(8,l,i);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var h=l.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:ko(l.memoizedState.cache)}if(h=l.child,h!==null)h.return=l,Tn=h;else e:for(l=a;Tn!==null;){h=Tn;var b=h.sibling,v=h.return;if(Px(h),h===l){Tn=null;break e}if(b!==null){b.return=v,Tn=b;break e}Tn=v}}}var xN={getCacheForType:function(a){var i=Rn(Sn),l=i.data.get(a);return l===void 0&&(l=a(),i.data.set(a,l)),l}},yN=typeof WeakMap=="function"?WeakMap:Map,Bt=0,Kt=null,Ct=null,It=0,Ut=0,ha=null,vi=!1,hl=!1,Zh=!1,Fs=0,dn=0,Ni=0,pr=0,em=0,Ea=0,ml=0,Ho=null,Zn=null,tm=!1,nm=0,Pu=1/0,Iu=null,wi=null,In=0,Si=null,pl=null,fl=0,am=0,sm=null,Ux=null,Vo=0,im=null;function ma(){if((Bt&2)!==0&&It!==0)return It&-It;if(L.T!==null){var a=nl;return a!==0?a:hm()}return At()}function qx(){Ea===0&&(Ea=(It&536870912)===0||Rt?Re():536870912);var a=Da.current;return a!==null&&(a.flags|=32),Ea}function pa(a,i,l){(a===Kt&&(Ut===2||Ut===9)||a.cancelPendingCommit!==null)&&(gl(a,0),ki(a,It,Ea,!1)),Je(a,l),((Bt&2)===0||a!==Kt)&&(a===Kt&&((Bt&2)===0&&(pr|=l),dn===4&&ki(a,It,Ea,!1)),ss(a))}function Hx(a,i,l){if((Bt&6)!==0)throw Error(r(327));var h=!l&&(i&124)===0&&(i&a.expiredLanes)===0||we(a,i),b=h?vN(a,i):om(a,i,!0),v=h;do{if(b===0){hl&&!h&&ki(a,i,0,!1);break}else{if(l=a.current.alternate,v&&!bN(l)){b=om(a,i,!1),v=!1;continue}if(b===2){if(v=i,a.errorRecoveryDisabledLanes&v)var z=0;else z=a.pendingLanes&-536870913,z=z!==0?z:z&536870912?536870912:0;if(z!==0){i=z;e:{var H=a;b=Ho;var ce=H.current.memoizedState.isDehydrated;if(ce&&(gl(H,z).flags|=256),z=om(H,z,!1),z!==2){if(Zh&&!ce){H.errorRecoveryDisabledLanes|=v,pr|=v,b=4;break e}v=Zn,Zn=b,v!==null&&(Zn===null?Zn=v:Zn.push.apply(Zn,v))}b=z}if(v=!1,b!==2)continue}}if(b===1){gl(a,0),ki(a,i,0,!0);break}e:{switch(h=a,v=b,v){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:ki(h,i,Ea,!vi);break e;case 2:Zn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(b=nm+300-Fe(),10<b)){if(ki(h,i,Ea,!vi),de(h,0,!0)!==0)break e;h.timeoutHandle=by(Vx.bind(null,h,l,Zn,Iu,tm,i,Ea,pr,ml,vi,v,2,-0,0),b);break e}Vx(h,l,Zn,Iu,tm,i,Ea,pr,ml,vi,v,0,-0,0)}}break}while(!0);ss(a)}function Vx(a,i,l,h,b,v,z,H,ce,_e,ze,Me,De,Te){if(a.timeoutHandle=-1,Me=i.subtreeFlags,(Me&8192||(Me&16785408)===16785408)&&(Wo={stylesheets:null,count:0,unsuspend:ew},$x(i),Me=nw(),Me!==null)){a.cancelPendingCommit=Me(Wx.bind(null,a,i,v,l,h,b,z,H,ce,ze,1,De,Te)),ki(a,v,z,!_e);return}Wx(a,i,v,l,h,b,z,H,ce)}function bN(a){for(var i=a;;){var l=i.tag;if((l===0||l===11||l===15)&&i.flags&16384&&(l=i.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var h=0;h<l.length;h++){var b=l[h],v=b.getSnapshot;b=b.value;try{if(!Un(v(),b))return!1}catch{return!1}}if(l=i.child,i.subtreeFlags&16384&&l!==null)l.return=i,i=l;else{if(i===a)break;for(;i.sibling===null;){if(i.return===null||i.return===a)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ki(a,i,l,h){i&=~em,i&=~pr,a.suspendedLanes|=i,a.pingedLanes&=~i,h&&(a.warmLanes|=i),h=a.expirationTimes;for(var b=i;0<b;){var v=31-ke(b),z=1<<v;h[v]=-1,b&=~z}l!==0&&Mt(a,l,i)}function Ou(){return(Bt&6)===0?(Go(0),!1):!0}function rm(){if(Ct!==null){if(Ut===0)var a=Ct.return;else a=Ct,As=or=null,wh(a),ol=null,Ro=0,a=Ct;for(;a!==null;)Sx(a.alternate,a),a=a.return;Ct=null}}function gl(a,i){var l=a.timeoutHandle;l!==-1&&(a.timeoutHandle=-1,LN(l)),l=a.cancelPendingCommit,l!==null&&(a.cancelPendingCommit=null,l()),rm(),Kt=a,Ct=l=_a(a.current,null),It=i,Ut=0,ha=null,vi=!1,hl=we(a,i),Zh=!1,ml=Ea=em=pr=Ni=dn=0,Zn=Ho=null,tm=!1,(i&8)!==0&&(i|=i&32);var h=a.entangledLanes;if(h!==0)for(a=a.entanglements,h&=i;0<h;){var b=31-ke(h),v=1<<b;i|=a[b],h&=~v}return Fs=i,ar(),l}function Gx(a,i){Nt=null,L.H=vu,i===_o||i===du?(i=cg(),Ut=3):i===rg?(i=cg(),Ut=4):Ut=i===ux?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,ha=i,Ct===null&&(dn=1,Cu(a,Xn(i,a.current)))}function Qx(){var a=L.H;return L.H=vu,a===null?vu:a}function Yx(){var a=L.A;return L.A=xN,a}function lm(){dn=4,vi||(It&4194048)!==It&&Da.current!==null||(hl=!0),(Ni&134217727)===0&&(pr&134217727)===0||Kt===null||ki(Kt,It,Ea,!1)}function om(a,i,l){var h=Bt;Bt|=2;var b=Qx(),v=Yx();(Kt!==a||It!==i)&&(Iu=null,gl(a,i)),i=!1;var z=dn;e:do try{if(Ut!==0&&Ct!==null){var H=Ct,ce=ha;switch(Ut){case 8:rm(),z=6;break e;case 3:case 2:case 9:case 6:Da.current===null&&(i=!0);var _e=Ut;if(Ut=0,ha=null,xl(a,H,ce,_e),l&&hl){z=0;break e}break;default:_e=Ut,Ut=0,ha=null,xl(a,H,ce,_e)}}jN(),z=dn;break}catch(ze){Gx(a,ze)}while(!0);return i&&a.shellSuspendCounter++,As=or=null,Bt=h,L.H=b,L.A=v,Ct===null&&(Kt=null,It=0,ar()),z}function jN(){for(;Ct!==null;)Jx(Ct)}function vN(a,i){var l=Bt;Bt|=2;var h=Qx(),b=Yx();Kt!==a||It!==i?(Iu=null,Pu=Fe()+500,gl(a,i)):hl=we(a,i);e:do try{if(Ut!==0&&Ct!==null){i=Ct;var v=ha;t:switch(Ut){case 1:Ut=0,ha=null,xl(a,i,v,1);break;case 2:case 9:if(lg(v)){Ut=0,ha=null,Xx(i);break}i=function(){Ut!==2&&Ut!==9||Kt!==a||(Ut=7),ss(a)},v.then(i,i);break e;case 3:Ut=7;break e;case 4:Ut=5;break e;case 7:lg(v)?(Ut=0,ha=null,Xx(i)):(Ut=0,ha=null,xl(a,i,v,7));break;case 5:var z=null;switch(Ct.tag){case 26:z=Ct.memoizedState;case 5:case 27:var H=Ct;if(!z||Ay(z)){Ut=0,ha=null;var ce=H.sibling;if(ce!==null)Ct=ce;else{var _e=H.return;_e!==null?(Ct=_e,zu(_e)):Ct=null}break t}}Ut=0,ha=null,xl(a,i,v,5);break;case 6:Ut=0,ha=null,xl(a,i,v,6);break;case 8:rm(),dn=6;break e;default:throw Error(r(462))}}NN();break}catch(ze){Gx(a,ze)}while(!0);return As=or=null,L.H=h,L.A=b,Bt=l,Ct!==null?0:(Kt=null,It=0,ar(),dn)}function NN(){for(;Ct!==null&&!Ie();)Jx(Ct)}function Jx(a){var i=Nx(a.alternate,a,Fs);a.memoizedProps=a.pendingProps,i===null?zu(a):Ct=i}function Xx(a){var i=a,l=i.alternate;switch(i.tag){case 15:case 0:i=gx(l,i,i.pendingProps,i.type,void 0,It);break;case 11:i=gx(l,i,i.pendingProps,i.type.render,i.ref,It);break;case 5:wh(i);default:Sx(l,i),i=Ct=jo(i,Fs),i=Nx(l,i,Fs)}a.memoizedProps=a.pendingProps,i===null?zu(a):Ct=i}function xl(a,i,l,h){As=or=null,wh(i),ol=null,Ro=0;var b=i.return;try{if(dN(a,b,i,l,It)){dn=1,Cu(a,Xn(l,a.current)),Ct=null;return}}catch(v){if(b!==null)throw Ct=b,v;dn=1,Cu(a,Xn(l,a.current)),Ct=null;return}i.flags&32768?(Rt||h===1?a=!0:hl||(It&536870912)!==0?a=!1:(vi=a=!0,(h===2||h===9||h===3||h===6)&&(h=Da.current,h!==null&&h.tag===13&&(h.flags|=16384))),Kx(i,a)):zu(i)}function zu(a){var i=a;do{if((i.flags&32768)!==0){Kx(i,vi);return}a=i.return;var l=mN(i.alternate,i,Fs);if(l!==null){Ct=l;return}if(i=i.sibling,i!==null){Ct=i;return}Ct=i=a}while(i!==null);dn===0&&(dn=5)}function Kx(a,i){do{var l=pN(a.alternate,a);if(l!==null){l.flags&=32767,Ct=l;return}if(l=a.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!i&&(a=a.sibling,a!==null)){Ct=a;return}Ct=a=l}while(a!==null);dn=6,Ct=null}function Wx(a,i,l,h,b,v,z,H,ce){a.cancelPendingCommit=null;do Ru();while(In!==0);if((Bt&6)!==0)throw Error(r(327));if(i!==null){if(i===a.current)throw Error(r(177));if(v=i.lanes|i.childLanes,v|=xo,wt(a,l,v,z,H,ce),a===Kt&&(Ct=Kt=null,It=0),pl=i,Si=a,fl=l,am=v,sm=b,Ux=h,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,CN(ye,function(){return ay(),null})):(a.callbackNode=null,a.callbackPriority=0),h=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||h){h=L.T,L.T=null,b=M.p,M.p=2,z=Bt,Bt|=4;try{fN(a,i,l)}finally{Bt=z,M.p=b,L.T=h}}In=1,Zx(),ey(),ty()}}function Zx(){if(In===1){In=0;var a=Si,i=pl,l=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||l){l=L.T,L.T=null;var h=M.p;M.p=2;var b=Bt;Bt|=4;try{zx(i,a);var v=jm,z=tu(a.containerInfo),H=v.focusedElem,ce=v.selectionRange;if(z!==H&&H&&H.ownerDocument&&ri(H.ownerDocument.documentElement,H)){if(ce!==null&&Ca(H)){var _e=ce.start,ze=ce.end;if(ze===void 0&&(ze=_e),"selectionStart"in H)H.selectionStart=_e,H.selectionEnd=Math.min(ze,H.value.length);else{var Me=H.ownerDocument||document,De=Me&&Me.defaultView||window;if(De.getSelection){var Te=De.getSelection(),ht=H.textContent.length,ut=Math.min(ce.start,ht),Vt=ce.end===void 0?ut:Math.min(ce.end,ht);!Te.extend&&ut>Vt&&(z=Vt,Vt=ut,ut=z);var be=eu(H,ut),me=eu(H,Vt);if(be&&me&&(Te.rangeCount!==1||Te.anchorNode!==be.node||Te.anchorOffset!==be.offset||Te.focusNode!==me.node||Te.focusOffset!==me.offset)){var Se=Me.createRange();Se.setStart(be.node,be.offset),Te.removeAllRanges(),ut>Vt?(Te.addRange(Se),Te.extend(me.node,me.offset)):(Se.setEnd(me.node,me.offset),Te.addRange(Se))}}}}for(Me=[],Te=H;Te=Te.parentNode;)Te.nodeType===1&&Me.push({element:Te,left:Te.scrollLeft,top:Te.scrollTop});for(typeof H.focus=="function"&&H.focus(),H=0;H<Me.length;H++){var Le=Me[H];Le.element.scrollLeft=Le.left,Le.element.scrollTop=Le.top}}Yu=!!bm,jm=bm=null}finally{Bt=b,M.p=h,L.T=l}}a.current=i,In=2}}function ey(){if(In===2){In=0;var a=Si,i=pl,l=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||l){l=L.T,L.T=null;var h=M.p;M.p=2;var b=Bt;Bt|=4;try{Ax(a,i.alternate,i)}finally{Bt=b,M.p=h,L.T=l}}In=3}}function ty(){if(In===4||In===3){In=0,$e();var a=Si,i=pl,l=fl,h=Ux;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?In=5:(In=0,pl=Si=null,ny(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(wi=null),Xe(l),i=i.stateNode,te&&typeof te.onCommitFiberRoot=="function")try{te.onCommitFiberRoot(O,i,void 0,(i.current.flags&128)===128)}catch{}if(h!==null){i=L.T,b=M.p,M.p=2,L.T=null;try{for(var v=a.onRecoverableError,z=0;z<h.length;z++){var H=h[z];v(H.value,{componentStack:H.stack})}}finally{L.T=i,M.p=b}}(fl&3)!==0&&Ru(),ss(a),b=a.pendingLanes,(l&4194090)!==0&&(b&42)!==0?a===im?Vo++:(Vo=0,im=a):Vo=0,Go(0)}}function ny(a,i){(a.pooledCacheLanes&=i)===0&&(i=a.pooledCache,i!=null&&(a.pooledCache=null,ko(i)))}function Ru(a){return Zx(),ey(),ty(),ay()}function ay(){if(In!==5)return!1;var a=Si,i=am;am=0;var l=Xe(fl),h=L.T,b=M.p;try{M.p=32>l?32:l,L.T=null,l=sm,sm=null;var v=Si,z=fl;if(In=0,pl=Si=null,fl=0,(Bt&6)!==0)throw Error(r(331));var H=Bt;if(Bt|=4,Mx(v.current),Lx(v,v.current,z,l),Bt=H,Go(0,!1),te&&typeof te.onPostCommitFiberRoot=="function")try{te.onPostCommitFiberRoot(O,v)}catch{}return!0}finally{M.p=b,L.T=h,ny(a,i)}}function sy(a,i,l){i=Xn(l,i),i=Lh(a.stateNode,i,2),a=pi(a,i,2),a!==null&&(Je(a,2),ss(a))}function Yt(a,i,l){if(a.tag===3)sy(a,a,l);else for(;i!==null;){if(i.tag===3){sy(i,a,l);break}else if(i.tag===1){var h=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(wi===null||!wi.has(h))){a=Xn(l,a),l=ox(2),h=pi(i,l,2),h!==null&&(cx(l,h,i,a),Je(h,2),ss(h));break}}i=i.return}}function cm(a,i,l){var h=a.pingCache;if(h===null){h=a.pingCache=new yN;var b=new Set;h.set(i,b)}else b=h.get(i),b===void 0&&(b=new Set,h.set(i,b));b.has(l)||(Zh=!0,b.add(l),a=wN.bind(null,a,i,l),i.then(a,a))}function wN(a,i,l){var h=a.pingCache;h!==null&&h.delete(i),a.pingedLanes|=a.suspendedLanes&l,a.warmLanes&=~l,Kt===a&&(It&l)===l&&(dn===4||dn===3&&(It&62914560)===It&&300>Fe()-nm?(Bt&2)===0&&gl(a,0):em|=l,ml===It&&(ml=0)),ss(a)}function iy(a,i){i===0&&(i=at()),a=ci(a,i),a!==null&&(Je(a,i),ss(a))}function SN(a){var i=a.memoizedState,l=0;i!==null&&(l=i.retryLane),iy(a,l)}function kN(a,i){var l=0;switch(a.tag){case 13:var h=a.stateNode,b=a.memoizedState;b!==null&&(l=b.retryLane);break;case 19:h=a.stateNode;break;case 22:h=a.stateNode._retryCache;break;default:throw Error(r(314))}h!==null&&h.delete(i),iy(a,l)}function CN(a,i){return ee(a,i)}var Lu=null,yl=null,um=!1,$u=!1,dm=!1,fr=0;function ss(a){a!==yl&&a.next===null&&(yl===null?Lu=yl=a:yl=yl.next=a),$u=!0,um||(um=!0,DN())}function Go(a,i){if(!dm&&$u){dm=!0;do for(var l=!1,h=Lu;h!==null;){if(a!==0){var b=h.pendingLanes;if(b===0)var v=0;else{var z=h.suspendedLanes,H=h.pingedLanes;v=(1<<31-ke(42|a)+1)-1,v&=b&~(z&~H),v=v&201326741?v&201326741|1:v?v|2:0}v!==0&&(l=!0,cy(h,v))}else v=It,v=de(h,h===Kt?v:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(v&3)===0||we(h,v)||(l=!0,cy(h,v));h=h.next}while(l);dm=!1}}function _N(){ry()}function ry(){$u=um=!1;var a=0;fr!==0&&(RN()&&(a=fr),fr=0);for(var i=Fe(),l=null,h=Lu;h!==null;){var b=h.next,v=ly(h,i);v===0?(h.next=null,l===null?Lu=b:l.next=b,b===null&&(yl=l)):(l=h,(a!==0||(v&3)!==0)&&($u=!0)),h=b}Go(a)}function ly(a,i){for(var l=a.suspendedLanes,h=a.pingedLanes,b=a.expirationTimes,v=a.pendingLanes&-62914561;0<v;){var z=31-ke(v),H=1<<z,ce=b[z];ce===-1?((H&l)===0||(H&h)!==0)&&(b[z]=Ae(H,i)):ce<=i&&(a.expiredLanes|=H),v&=~H}if(i=Kt,l=It,l=de(a,a===i?l:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h=a.callbackNode,l===0||a===i&&(Ut===2||Ut===9)||a.cancelPendingCommit!==null)return h!==null&&h!==null&&je(h),a.callbackNode=null,a.callbackPriority=0;if((l&3)===0||we(a,l)){if(i=l&-l,i===a.callbackPriority)return i;switch(h!==null&&je(h),Xe(l)){case 2:case 8:l=et;break;case 32:l=ye;break;case 268435456:l=xe;break;default:l=ye}return h=oy.bind(null,a),l=ee(l,h),a.callbackPriority=i,a.callbackNode=l,i}return h!==null&&h!==null&&je(h),a.callbackPriority=2,a.callbackNode=null,2}function oy(a,i){if(In!==0&&In!==5)return a.callbackNode=null,a.callbackPriority=0,null;var l=a.callbackNode;if(Ru()&&a.callbackNode!==l)return null;var h=It;return h=de(a,a===Kt?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h===0?null:(Hx(a,h,i),ly(a,Fe()),a.callbackNode!=null&&a.callbackNode===l?oy.bind(null,a):null)}function cy(a,i){if(Ru())return null;Hx(a,i,!0)}function DN(){$N(function(){(Bt&6)!==0?ee(qe,_N):ry()})}function hm(){return fr===0&&(fr=Re()),fr}function uy(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Gs(""+a)}function dy(a,i){var l=i.ownerDocument.createElement("input");return l.name=i.name,l.value=i.value,a.id&&l.setAttribute("form",a.id),i.parentNode.insertBefore(l,i),a=new FormData(a),l.parentNode.removeChild(l),a}function EN(a,i,l,h,b){if(i==="submit"&&l&&l.stateNode===b){var v=uy((b[sn]||null).action),z=h.submitter;z&&(i=(i=z[sn]||null)?uy(i.formAction):z.getAttribute("formAction"),i!==null&&(v=i,z=null));var H=new Jn("action","action",null,h,b);a.push({event:H,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(fr!==0){var ce=z?dy(b,z):new FormData(b);Ph(l,{pending:!0,data:ce,method:b.method,action:v},null,ce)}}else typeof v=="function"&&(H.preventDefault(),ce=z?dy(b,z):new FormData(b),Ph(l,{pending:!0,data:ce,method:b.method,action:v},v,ce))},currentTarget:b}]})}}for(var mm=0;mm<nr.length;mm++){var pm=nr[mm],TN=pm.toLowerCase(),AN=pm[0].toUpperCase()+pm.slice(1);oa(TN,"on"+AN)}oa(go,"onAnimationEnd"),oa(au,"onAnimationIteration"),oa(su,"onAnimationStart"),oa("dblclick","onDoubleClick"),oa("focusin","onFocus"),oa("focusout","onBlur"),oa(eh,"onTransitionRun"),oa(iu,"onTransitionStart"),oa(th,"onTransitionCancel"),oa(Es,"onTransitionEnd"),qs("onMouseEnter",["mouseout","mouseover"]),qs("onMouseLeave",["mouseout","mouseover"]),qs("onPointerEnter",["pointerout","pointerover"]),qs("onPointerLeave",["pointerout","pointerover"]),ys("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ys("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ys("onBeforeInput",["compositionend","keypress","textInput","paste"]),ys("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ys("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ys("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),PN=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Qo));function hy(a,i){i=(i&4)!==0;for(var l=0;l<a.length;l++){var h=a[l],b=h.event;h=h.listeners;e:{var v=void 0;if(i)for(var z=h.length-1;0<=z;z--){var H=h[z],ce=H.instance,_e=H.currentTarget;if(H=H.listener,ce!==v&&b.isPropagationStopped())break e;v=H,b.currentTarget=_e;try{v(b)}catch(ze){ku(ze)}b.currentTarget=null,v=ce}else for(z=0;z<h.length;z++){if(H=h[z],ce=H.instance,_e=H.currentTarget,H=H.listener,ce!==v&&b.isPropagationStopped())break e;v=H,b.currentTarget=_e;try{v(b)}catch(ze){ku(ze)}b.currentTarget=null,v=ce}}}}function _t(a,i){var l=i[La];l===void 0&&(l=i[La]=new Set);var h=a+"__bubble";l.has(h)||(my(i,a,2,!1),l.add(h))}function fm(a,i,l){var h=0;i&&(h|=4),my(l,a,h,i)}var Fu="_reactListening"+Math.random().toString(36).slice(2);function gm(a){if(!a[Fu]){a[Fu]=!0,Rc.forEach(function(l){l!=="selectionchange"&&(PN.has(l)||fm(l,!1,a),fm(l,!0,a))});var i=a.nodeType===9?a:a.ownerDocument;i===null||i[Fu]||(i[Fu]=!0,fm("selectionchange",!1,i))}}function my(a,i,l,h){switch(Ly(i)){case 2:var b=iw;break;case 8:b=rw;break;default:b=Tm}l=b.bind(null,i,l,a),b=void 0,!Js||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(b=!0),h?b!==void 0?a.addEventListener(i,l,{capture:!0,passive:b}):a.addEventListener(i,l,!0):b!==void 0?a.addEventListener(i,l,{passive:b}):a.addEventListener(i,l,!1)}function xm(a,i,l,h,b){var v=h;if((i&1)===0&&(i&2)===0&&h!==null)e:for(;;){if(h===null)return;var z=h.tag;if(z===3||z===4){var H=h.stateNode.containerInfo;if(H===b)break;if(z===4)for(z=h.return;z!==null;){var ce=z.tag;if((ce===3||ce===4)&&z.stateNode.containerInfo===b)return;z=z.return}for(;H!==null;){if(z=$a(H),z===null)return;if(ce=z.tag,ce===5||ce===6||ce===26||ce===27){h=v=z;continue e}H=H.parentNode}}h=h.return}Ys(function(){var _e=v,ze=Gi(l),Me=[];e:{var De=ru.get(a);if(De!==void 0){var Te=Jn,ht=a;switch(a){case"keypress":if(Ks(l)===0)break e;case"keydown":case"keyup":Te=qr;break;case"focusin":ht="focus",Te=Xa;break;case"focusout":ht="blur",Te=Xa;break;case"beforeblur":case"afterblur":Te=Xa;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Te=Fr;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Te=Ji;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Te=lo;break;case go:case au:case su:Te=Br;break;case Es:Te=$t;break;case"scroll":case"scrollend":Te=Uc;break;case"wheel":Te=Vr;break;case"copy":case"cut":case"paste":Te=Yd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Te=Qc;break;case"toggle":case"beforetoggle":Te=Wi}var ut=(i&4)!==0,Vt=!ut&&(a==="scroll"||a==="scrollend"),be=ut?De!==null?De+"Capture":null:De;ut=[];for(var me=_e,Se;me!==null;){var Le=me;if(Se=Le.stateNode,Le=Le.tag,Le!==5&&Le!==26&&Le!==27||Se===null||be===null||(Le=Ya(me,be),Le!=null&&ut.push(Yo(me,Le,Se))),Vt)break;me=me.return}0<ut.length&&(De=new Te(De,ht,null,l,ze),Me.push({event:De,listeners:ut}))}}if((i&7)===0){e:{if(De=a==="mouseover"||a==="pointerover",Te=a==="mouseout"||a==="pointerout",De&&l!==zr&&(ht=l.relatedTarget||l.fromElement)&&($a(ht)||ht[cn]))break e;if((Te||De)&&(De=ze.window===ze?ze:(De=ze.ownerDocument)?De.defaultView||De.parentWindow:window,Te?(ht=l.relatedTarget||l.toElement,Te=_e,ht=ht?$a(ht):null,ht!==null&&(Vt=u(ht),ut=ht.tag,ht!==Vt||ut!==5&&ut!==27&&ut!==6)&&(ht=null)):(Te=null,ht=_e),Te!==ht)){if(ut=Fr,Le="onMouseLeave",be="onMouseEnter",me="mouse",(a==="pointerout"||a==="pointerover")&&(ut=Qc,Le="onPointerLeave",be="onPointerEnter",me="pointer"),Vt=Te==null?De:Us(Te),Se=ht==null?De:Us(ht),De=new ut(Le,me+"leave",Te,l,ze),De.target=Vt,De.relatedTarget=Se,Le=null,$a(ze)===_e&&(ut=new ut(be,me+"enter",ht,l,ze),ut.target=Se,ut.relatedTarget=Vt,Le=ut),Vt=Le,Te&&ht)t:{for(ut=Te,be=ht,me=0,Se=ut;Se;Se=bl(Se))me++;for(Se=0,Le=be;Le;Le=bl(Le))Se++;for(;0<me-Se;)ut=bl(ut),me--;for(;0<Se-me;)be=bl(be),Se--;for(;me--;){if(ut===be||be!==null&&ut===be.alternate)break t;ut=bl(ut),be=bl(be)}ut=null}else ut=null;Te!==null&&py(Me,De,Te,ut,!1),ht!==null&&Vt!==null&&py(Me,Vt,ht,ut,!0)}}e:{if(De=_e?Us(_e):window,Te=De.nodeName&&De.nodeName.toLowerCase(),Te==="select"||Te==="input"&&De.type==="file")var We=si;else if(Cs(De))if(Qr)We=Wd;else{We=Zc;var St=Xd}else Te=De.nodeName,!Te||Te.toLowerCase()!=="input"||De.type!=="checkbox"&&De.type!=="radio"?_e&&Or(_e.elementType)&&(We=si):We=Kd;if(We&&(We=We(a,_e))){Xc(Me,We,l,ze);break e}St&&St(a,De,_e),a==="focusout"&&_e&&De.type==="number"&&_e.memoizedProps.value!=null&&Vs(De,"number",De.value)}switch(St=_e?Us(_e):window,a){case"focusin":(Cs(St)||St.contentEditable==="true")&&(zn=St,Xr=_e,li=null);break;case"focusout":li=Xr=zn=null;break;case"mousedown":Kr=!0;break;case"contextmenu":case"mouseup":case"dragend":Kr=!1,fo(Me,l,ze);break;case"selectionchange":if(Wa)break;case"keydown":case"keyup":fo(Me,l,ze)}var it;if(uo)e:{switch(a){case"compositionstart":var dt="onCompositionStart";break e;case"compositionend":dt="onCompositionEnd";break e;case"compositionupdate":dt="onCompositionUpdate";break e}dt=void 0}else ti?ks(a,l)&&(dt="onCompositionEnd"):a==="keydown"&&l.keyCode===229&&(dt="onCompositionStart");dt&&(ho&&l.locale!=="ko"&&(ti||dt!=="onCompositionStart"?dt==="onCompositionEnd"&&ti&&(it=Rr()):(Sa=ze,Yi="value"in Sa?Sa.value:Sa.textContent,ti=!0)),St=Mu(_e,dt),0<St.length&&(dt=new so(dt,a,null,l,ze),Me.push({event:dt,listeners:St}),it?dt.data=it:(it=mo(l),it!==null&&(dt.data=it)))),(it=ei?Jc(a,l):tr(a,l))&&(dt=Mu(_e,"onBeforeInput"),0<dt.length&&(St=new so("onBeforeInput","beforeinput",null,l,ze),Me.push({event:St,listeners:dt}),St.data=it)),EN(Me,a,_e,l,ze)}hy(Me,i)})}function Yo(a,i,l){return{instance:a,listener:i,currentTarget:l}}function Mu(a,i){for(var l=i+"Capture",h=[];a!==null;){var b=a,v=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||v===null||(b=Ya(a,l),b!=null&&h.unshift(Yo(a,b,v)),b=Ya(a,i),b!=null&&h.push(Yo(a,b,v))),a.tag===3)return h;a=a.return}return[]}function bl(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function py(a,i,l,h,b){for(var v=i._reactName,z=[];l!==null&&l!==h;){var H=l,ce=H.alternate,_e=H.stateNode;if(H=H.tag,ce!==null&&ce===h)break;H!==5&&H!==26&&H!==27||_e===null||(ce=_e,b?(_e=Ya(l,v),_e!=null&&z.unshift(Yo(l,_e,ce))):b||(_e=Ya(l,v),_e!=null&&z.push(Yo(l,_e,ce)))),l=l.return}z.length!==0&&a.push({event:i,listeners:z})}var IN=/\r\n?/g,ON=/\u0000|\uFFFD/g;function fy(a){return(typeof a=="string"?a:""+a).replace(IN,`
`).replace(ON,"")}function gy(a,i){return i=fy(i),fy(a)===i}function Bu(){}function Ht(a,i,l,h,b,v){switch(l){case"children":typeof h=="string"?i==="body"||i==="textarea"&&h===""||Na(a,h):(typeof h=="number"||typeof h=="bigint")&&i!=="body"&&Na(a,""+h);break;case"className":Hs(a,"class",h);break;case"tabIndex":Hs(a,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Hs(a,l,h);break;case"style":Yn(a,h,v);break;case"data":if(i!=="object"){Hs(a,"data",h);break}case"src":case"href":if(h===""&&(i!=="a"||l!=="href")){a.removeAttribute(l);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(l);break}h=Gs(""+h),a.setAttribute(l,h);break;case"action":case"formAction":if(typeof h=="function"){a.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof v=="function"&&(l==="formAction"?(i!=="input"&&Ht(a,i,"name",b.name,b,null),Ht(a,i,"formEncType",b.formEncType,b,null),Ht(a,i,"formMethod",b.formMethod,b,null),Ht(a,i,"formTarget",b.formTarget,b,null)):(Ht(a,i,"encType",b.encType,b,null),Ht(a,i,"method",b.method,b,null),Ht(a,i,"target",b.target,b,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(l);break}h=Gs(""+h),a.setAttribute(l,h);break;case"onClick":h!=null&&(a.onclick=Bu);break;case"onScroll":h!=null&&_t("scroll",a);break;case"onScrollEnd":h!=null&&_t("scrollend",a);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(r(61));if(l=h.__html,l!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=l}}break;case"multiple":a.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":a.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){a.removeAttribute("xlink:href");break}l=Gs(""+h),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(l,""+h):a.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(l,""):a.removeAttribute(l);break;case"capture":case"download":h===!0?a.setAttribute(l,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(l,h):a.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?a.setAttribute(l,h):a.removeAttribute(l);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?a.removeAttribute(l):a.setAttribute(l,h);break;case"popover":_t("beforetoggle",a),_t("toggle",a),Er(a,"popover",h);break;case"xlinkActuate":bn(a,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":bn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":bn(a,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":bn(a,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":bn(a,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":bn(a,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":bn(a,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":bn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":bn(a,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":Er(a,"is",h);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=to.get(l)||l,Er(a,l,h))}}function ym(a,i,l,h,b,v){switch(l){case"style":Yn(a,h,v);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(r(61));if(l=h.__html,l!=null){if(b.children!=null)throw Error(r(60));a.innerHTML=l}}break;case"children":typeof h=="string"?Na(a,h):(typeof h=="number"||typeof h=="bigint")&&Na(a,""+h);break;case"onScroll":h!=null&&_t("scroll",a);break;case"onScrollEnd":h!=null&&_t("scrollend",a);break;case"onClick":h!=null&&(a.onclick=Bu);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Lc.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(b=l.endsWith("Capture"),i=l.slice(2,b?l.length-7:void 0),v=a[sn]||null,v=v!=null?v[l]:null,typeof v=="function"&&a.removeEventListener(i,v,b),typeof h=="function")){typeof v!="function"&&v!==null&&(l in a?a[l]=null:a.hasAttribute(l)&&a.removeAttribute(l)),a.addEventListener(i,h,b);break e}l in a?a[l]=h:h===!0?a.setAttribute(l,""):Er(a,l,h)}}}function On(a,i,l){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":_t("error",a),_t("load",a);var h=!1,b=!1,v;for(v in l)if(l.hasOwnProperty(v)){var z=l[v];if(z!=null)switch(v){case"src":h=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ht(a,i,v,z,l,null)}}b&&Ht(a,i,"srcSet",l.srcSet,l,null),h&&Ht(a,i,"src",l.src,l,null);return;case"input":_t("invalid",a);var H=v=z=b=null,ce=null,_e=null;for(h in l)if(l.hasOwnProperty(h)){var ze=l[h];if(ze!=null)switch(h){case"name":b=ze;break;case"type":z=ze;break;case"checked":ce=ze;break;case"defaultChecked":_e=ze;break;case"value":v=ze;break;case"defaultValue":H=ze;break;case"children":case"dangerouslySetInnerHTML":if(ze!=null)throw Error(r(137,i));break;default:Ht(a,i,h,ze,l,null)}}Wl(a,v,H,ce,_e,z,b,!1),Ar(a);return;case"select":_t("invalid",a),h=z=v=null;for(b in l)if(l.hasOwnProperty(b)&&(H=l[b],H!=null))switch(b){case"value":v=H;break;case"defaultValue":z=H;break;case"multiple":h=H;default:Ht(a,i,b,H,l,null)}i=v,l=z,a.multiple=!!h,i!=null?vs(a,!!h,i,!1):l!=null&&vs(a,!!h,l,!0);return;case"textarea":_t("invalid",a),v=b=h=null;for(z in l)if(l.hasOwnProperty(z)&&(H=l[z],H!=null))switch(z){case"value":h=H;break;case"defaultValue":b=H;break;case"children":v=H;break;case"dangerouslySetInnerHTML":if(H!=null)throw Error(r(91));break;default:Ht(a,i,z,H,l,null)}Zl(a,h,b,v),Ar(a);return;case"option":for(ce in l)if(l.hasOwnProperty(ce)&&(h=l[ce],h!=null))switch(ce){case"selected":a.selected=h&&typeof h!="function"&&typeof h!="symbol";break;default:Ht(a,i,ce,h,l,null)}return;case"dialog":_t("beforetoggle",a),_t("toggle",a),_t("cancel",a),_t("close",a);break;case"iframe":case"object":_t("load",a);break;case"video":case"audio":for(h=0;h<Qo.length;h++)_t(Qo[h],a);break;case"image":_t("error",a),_t("load",a);break;case"details":_t("toggle",a);break;case"embed":case"source":case"link":_t("error",a),_t("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_e in l)if(l.hasOwnProperty(_e)&&(h=l[_e],h!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:Ht(a,i,_e,h,l,null)}return;default:if(Or(i)){for(ze in l)l.hasOwnProperty(ze)&&(h=l[ze],h!==void 0&&ym(a,i,ze,h,l,void 0));return}}for(H in l)l.hasOwnProperty(H)&&(h=l[H],h!=null&&Ht(a,i,H,h,l,null))}function zN(a,i,l,h){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,v=null,z=null,H=null,ce=null,_e=null,ze=null;for(Te in l){var Me=l[Te];if(l.hasOwnProperty(Te)&&Me!=null)switch(Te){case"checked":break;case"value":break;case"defaultValue":ce=Me;default:h.hasOwnProperty(Te)||Ht(a,i,Te,null,h,Me)}}for(var De in h){var Te=h[De];if(Me=l[De],h.hasOwnProperty(De)&&(Te!=null||Me!=null))switch(De){case"type":v=Te;break;case"name":b=Te;break;case"checked":_e=Te;break;case"defaultChecked":ze=Te;break;case"value":z=Te;break;case"defaultValue":H=Te;break;case"children":case"dangerouslySetInnerHTML":if(Te!=null)throw Error(r(137,i));break;default:Te!==Me&&Ht(a,i,De,Te,h,Me)}}Pr(a,z,H,ce,_e,ze,v,b);return;case"select":Te=z=H=De=null;for(v in l)if(ce=l[v],l.hasOwnProperty(v)&&ce!=null)switch(v){case"value":break;case"multiple":Te=ce;default:h.hasOwnProperty(v)||Ht(a,i,v,null,h,ce)}for(b in h)if(v=h[b],ce=l[b],h.hasOwnProperty(b)&&(v!=null||ce!=null))switch(b){case"value":De=v;break;case"defaultValue":H=v;break;case"multiple":z=v;default:v!==ce&&Ht(a,i,b,v,h,ce)}i=H,l=z,h=Te,De!=null?vs(a,!!l,De,!1):!!h!=!!l&&(i!=null?vs(a,!!l,i,!0):vs(a,!!l,l?[]:"",!1));return;case"textarea":Te=De=null;for(H in l)if(b=l[H],l.hasOwnProperty(H)&&b!=null&&!h.hasOwnProperty(H))switch(H){case"value":break;case"children":break;default:Ht(a,i,H,null,h,b)}for(z in h)if(b=h[z],v=l[z],h.hasOwnProperty(z)&&(b!=null||v!=null))switch(z){case"value":De=b;break;case"defaultValue":Te=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(r(91));break;default:b!==v&&Ht(a,i,z,b,h,v)}Ir(a,De,Te);return;case"option":for(var ht in l)if(De=l[ht],l.hasOwnProperty(ht)&&De!=null&&!h.hasOwnProperty(ht))switch(ht){case"selected":a.selected=!1;break;default:Ht(a,i,ht,null,h,De)}for(ce in h)if(De=h[ce],Te=l[ce],h.hasOwnProperty(ce)&&De!==Te&&(De!=null||Te!=null))switch(ce){case"selected":a.selected=De&&typeof De!="function"&&typeof De!="symbol";break;default:Ht(a,i,ce,De,h,Te)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ut in l)De=l[ut],l.hasOwnProperty(ut)&&De!=null&&!h.hasOwnProperty(ut)&&Ht(a,i,ut,null,h,De);for(_e in h)if(De=h[_e],Te=l[_e],h.hasOwnProperty(_e)&&De!==Te&&(De!=null||Te!=null))switch(_e){case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(r(137,i));break;default:Ht(a,i,_e,De,h,Te)}return;default:if(Or(i)){for(var Vt in l)De=l[Vt],l.hasOwnProperty(Vt)&&De!==void 0&&!h.hasOwnProperty(Vt)&&ym(a,i,Vt,void 0,h,De);for(ze in h)De=h[ze],Te=l[ze],!h.hasOwnProperty(ze)||De===Te||De===void 0&&Te===void 0||ym(a,i,ze,De,h,Te);return}}for(var be in l)De=l[be],l.hasOwnProperty(be)&&De!=null&&!h.hasOwnProperty(be)&&Ht(a,i,be,null,h,De);for(Me in h)De=h[Me],Te=l[Me],!h.hasOwnProperty(Me)||De===Te||De==null&&Te==null||Ht(a,i,Me,De,h,Te)}var bm=null,jm=null;function Uu(a){return a.nodeType===9?a:a.ownerDocument}function xy(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function yy(a,i){if(a===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&i==="foreignObject"?0:a}function vm(a,i){return a==="textarea"||a==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Nm=null;function RN(){var a=window.event;return a&&a.type==="popstate"?a===Nm?!1:(Nm=a,!0):(Nm=null,!1)}var by=typeof setTimeout=="function"?setTimeout:void 0,LN=typeof clearTimeout=="function"?clearTimeout:void 0,jy=typeof Promise=="function"?Promise:void 0,$N=typeof queueMicrotask=="function"?queueMicrotask:typeof jy<"u"?function(a){return jy.resolve(null).then(a).catch(FN)}:by;function FN(a){setTimeout(function(){throw a})}function Ci(a){return a==="head"}function vy(a,i){var l=i,h=0,b=0;do{var v=l.nextSibling;if(a.removeChild(l),v&&v.nodeType===8)if(l=v.data,l==="/$"){if(0<h&&8>h){l=h;var z=a.ownerDocument;if(l&1&&Jo(z.documentElement),l&2&&Jo(z.body),l&4)for(l=z.head,Jo(l),z=l.firstChild;z;){var H=z.nextSibling,ce=z.nodeName;z[fs]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&z.rel.toLowerCase()==="stylesheet"||l.removeChild(z),z=H}}if(b===0){a.removeChild(v),ac(i);return}b--}else l==="$"||l==="$?"||l==="$!"?b++:h=l.charCodeAt(0)-48;else h=0;l=v}while(l);ac(i)}function wm(a){var i=a.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var l=i;switch(i=i.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":wm(l),Ql(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}a.removeChild(l)}}function MN(a,i,l,h){for(;a.nodeType===1;){var b=l;if(a.nodeName.toLowerCase()!==i.toLowerCase()){if(!h&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(h){if(!a[fs])switch(i){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(v=a.getAttribute("rel"),v==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(v!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(v=a.getAttribute("src"),(v!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&v&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(i==="input"&&a.type==="hidden"){var v=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===v)return a}else return a;if(a=Ua(a.nextSibling),a===null)break}return null}function BN(a,i,l){if(i==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!l||(a=Ua(a.nextSibling),a===null))return null;return a}function Sm(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function UN(a,i){var l=a.ownerDocument;if(a.data!=="$?"||l.readyState==="complete")i();else{var h=function(){i(),l.removeEventListener("DOMContentLoaded",h)};l.addEventListener("DOMContentLoaded",h),a._reactRetry=h}}function Ua(a){for(;a!=null;a=a.nextSibling){var i=a.nodeType;if(i===1||i===3)break;if(i===8){if(i=a.data,i==="$"||i==="$!"||i==="$?"||i==="F!"||i==="F")break;if(i==="/$")return null}}return a}var km=null;function Ny(a){a=a.previousSibling;for(var i=0;a;){if(a.nodeType===8){var l=a.data;if(l==="$"||l==="$!"||l==="$?"){if(i===0)return a;i--}else l==="/$"&&i++}a=a.previousSibling}return null}function wy(a,i,l){switch(i=Uu(l),a){case"html":if(a=i.documentElement,!a)throw Error(r(452));return a;case"head":if(a=i.head,!a)throw Error(r(453));return a;case"body":if(a=i.body,!a)throw Error(r(454));return a;default:throw Error(r(451))}}function Jo(a){for(var i=a.attributes;i.length;)a.removeAttributeNode(i[0]);Ql(a)}var Ta=new Map,Sy=new Set;function qu(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Ms=M.d;M.d={f:qN,r:HN,D:VN,C:GN,L:QN,m:YN,X:XN,S:JN,M:KN};function qN(){var a=Ms.f(),i=Ou();return a||i}function HN(a){var i=gs(a);i!==null&&i.tag===5&&i.type==="form"?Hg(i):Ms.r(a)}var jl=typeof document>"u"?null:document;function ky(a,i,l){var h=jl;if(h&&typeof i=="string"&&i){var b=Bn(i);b='link[rel="'+a+'"][href="'+b+'"]',typeof l=="string"&&(b+='[crossorigin="'+l+'"]'),Sy.has(b)||(Sy.add(b),a={rel:a,crossOrigin:l,href:i},h.querySelector(b)===null&&(i=h.createElement("link"),On(i,"link",a),yn(i),h.head.appendChild(i)))}}function VN(a){Ms.D(a),ky("dns-prefetch",a,null)}function GN(a,i){Ms.C(a,i),ky("preconnect",a,i)}function QN(a,i,l){Ms.L(a,i,l);var h=jl;if(h&&a&&i){var b='link[rel="preload"][as="'+Bn(i)+'"]';i==="image"&&l&&l.imageSrcSet?(b+='[imagesrcset="'+Bn(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(b+='[imagesizes="'+Bn(l.imageSizes)+'"]')):b+='[href="'+Bn(a)+'"]';var v=b;switch(i){case"style":v=vl(a);break;case"script":v=Nl(a)}Ta.has(v)||(a=f({rel:"preload",href:i==="image"&&l&&l.imageSrcSet?void 0:a,as:i},l),Ta.set(v,a),h.querySelector(b)!==null||i==="style"&&h.querySelector(Xo(v))||i==="script"&&h.querySelector(Ko(v))||(i=h.createElement("link"),On(i,"link",a),yn(i),h.head.appendChild(i)))}}function YN(a,i){Ms.m(a,i);var l=jl;if(l&&a){var h=i&&typeof i.as=="string"?i.as:"script",b='link[rel="modulepreload"][as="'+Bn(h)+'"][href="'+Bn(a)+'"]',v=b;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":v=Nl(a)}if(!Ta.has(v)&&(a=f({rel:"modulepreload",href:a},i),Ta.set(v,a),l.querySelector(b)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Ko(v)))return}h=l.createElement("link"),On(h,"link",a),yn(h),l.head.appendChild(h)}}}function JN(a,i,l){Ms.S(a,i,l);var h=jl;if(h&&a){var b=xs(h).hoistableStyles,v=vl(a);i=i||"default";var z=b.get(v);if(!z){var H={loading:0,preload:null};if(z=h.querySelector(Xo(v)))H.loading=5;else{a=f({rel:"stylesheet",href:a,"data-precedence":i},l),(l=Ta.get(v))&&Cm(a,l);var ce=z=h.createElement("link");yn(ce),On(ce,"link",a),ce._p=new Promise(function(_e,ze){ce.onload=_e,ce.onerror=ze}),ce.addEventListener("load",function(){H.loading|=1}),ce.addEventListener("error",function(){H.loading|=2}),H.loading|=4,Hu(z,i,h)}z={type:"stylesheet",instance:z,count:1,state:H},b.set(v,z)}}}function XN(a,i){Ms.X(a,i);var l=jl;if(l&&a){var h=xs(l).hoistableScripts,b=Nl(a),v=h.get(b);v||(v=l.querySelector(Ko(b)),v||(a=f({src:a,async:!0},i),(i=Ta.get(b))&&_m(a,i),v=l.createElement("script"),yn(v),On(v,"link",a),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},h.set(b,v))}}function KN(a,i){Ms.M(a,i);var l=jl;if(l&&a){var h=xs(l).hoistableScripts,b=Nl(a),v=h.get(b);v||(v=l.querySelector(Ko(b)),v||(a=f({src:a,async:!0,type:"module"},i),(i=Ta.get(b))&&_m(a,i),v=l.createElement("script"),yn(v),On(v,"link",a),l.head.appendChild(v)),v={type:"script",instance:v,count:1,state:null},h.set(b,v))}}function Cy(a,i,l,h){var b=(b=K.current)?qu(b):null;if(!b)throw Error(r(446));switch(a){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(i=vl(l.href),l=xs(b).hoistableStyles,h=l.get(i),h||(h={type:"style",instance:null,count:0,state:null},l.set(i,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){a=vl(l.href);var v=xs(b).hoistableStyles,z=v.get(a);if(z||(b=b.ownerDocument||b,z={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},v.set(a,z),(v=b.querySelector(Xo(a)))&&!v._p&&(z.instance=v,z.state.loading=5),Ta.has(a)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Ta.set(a,l),v||WN(b,a,l,z.state))),i&&h===null)throw Error(r(528,""));return z}if(i&&h!==null)throw Error(r(529,""));return null;case"script":return i=l.async,l=l.src,typeof l=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=Nl(l),l=xs(b).hoistableScripts,h=l.get(i),h||(h={type:"script",instance:null,count:0,state:null},l.set(i,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,a))}}function vl(a){return'href="'+Bn(a)+'"'}function Xo(a){return'link[rel="stylesheet"]['+a+"]"}function _y(a){return f({},a,{"data-precedence":a.precedence,precedence:null})}function WN(a,i,l,h){a.querySelector('link[rel="preload"][as="style"]['+i+"]")?h.loading=1:(i=a.createElement("link"),h.preload=i,i.addEventListener("load",function(){return h.loading|=1}),i.addEventListener("error",function(){return h.loading|=2}),On(i,"link",l),yn(i),a.head.appendChild(i))}function Nl(a){return'[src="'+Bn(a)+'"]'}function Ko(a){return"script[async]"+a}function Dy(a,i,l){if(i.count++,i.instance===null)switch(i.type){case"style":var h=a.querySelector('style[data-href~="'+Bn(l.href)+'"]');if(h)return i.instance=h,yn(h),h;var b=f({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return h=(a.ownerDocument||a).createElement("style"),yn(h),On(h,"style",b),Hu(h,l.precedence,a),i.instance=h;case"stylesheet":b=vl(l.href);var v=a.querySelector(Xo(b));if(v)return i.state.loading|=4,i.instance=v,yn(v),v;h=_y(l),(b=Ta.get(b))&&Cm(h,b),v=(a.ownerDocument||a).createElement("link"),yn(v);var z=v;return z._p=new Promise(function(H,ce){z.onload=H,z.onerror=ce}),On(v,"link",h),i.state.loading|=4,Hu(v,l.precedence,a),i.instance=v;case"script":return v=Nl(l.src),(b=a.querySelector(Ko(v)))?(i.instance=b,yn(b),b):(h=l,(b=Ta.get(v))&&(h=f({},l),_m(h,b)),a=a.ownerDocument||a,b=a.createElement("script"),yn(b),On(b,"link",h),a.head.appendChild(b),i.instance=b);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(h=i.instance,i.state.loading|=4,Hu(h,l.precedence,a));return i.instance}function Hu(a,i,l){for(var h=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=h.length?h[h.length-1]:null,v=b,z=0;z<h.length;z++){var H=h[z];if(H.dataset.precedence===i)v=H;else if(v!==b)break}v?v.parentNode.insertBefore(a,v.nextSibling):(i=l.nodeType===9?l.head:l,i.insertBefore(a,i.firstChild))}function Cm(a,i){a.crossOrigin==null&&(a.crossOrigin=i.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=i.referrerPolicy),a.title==null&&(a.title=i.title)}function _m(a,i){a.crossOrigin==null&&(a.crossOrigin=i.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=i.referrerPolicy),a.integrity==null&&(a.integrity=i.integrity)}var Vu=null;function Ey(a,i,l){if(Vu===null){var h=new Map,b=Vu=new Map;b.set(l,h)}else b=Vu,h=b.get(l),h||(h=new Map,b.set(l,h));if(h.has(a))return h;for(h.set(a,null),l=l.getElementsByTagName(a),b=0;b<l.length;b++){var v=l[b];if(!(v[fs]||v[Xt]||a==="link"&&v.getAttribute("rel")==="stylesheet")&&v.namespaceURI!=="http://www.w3.org/2000/svg"){var z=v.getAttribute(i)||"";z=a+z;var H=h.get(z);H?H.push(v):h.set(z,[v])}}return h}function Ty(a,i,l){a=a.ownerDocument||a,a.head.insertBefore(l,i==="title"?a.querySelector("head > title"):null)}function ZN(a,i,l){if(l===1||i.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return a=i.disabled,typeof i.precedence=="string"&&a==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function Ay(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var Wo=null;function ew(){}function tw(a,i,l){if(Wo===null)throw Error(r(475));var h=Wo;if(i.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var b=vl(l.href),v=a.querySelector(Xo(b));if(v){a=v._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(h.count++,h=Gu.bind(h),a.then(h,h)),i.state.loading|=4,i.instance=v,yn(v);return}v=a.ownerDocument||a,l=_y(l),(b=Ta.get(b))&&Cm(l,b),v=v.createElement("link"),yn(v);var z=v;z._p=new Promise(function(H,ce){z.onload=H,z.onerror=ce}),On(v,"link",l),i.instance=v}h.stylesheets===null&&(h.stylesheets=new Map),h.stylesheets.set(i,a),(a=i.state.preload)&&(i.state.loading&3)===0&&(h.count++,i=Gu.bind(h),a.addEventListener("load",i),a.addEventListener("error",i))}}function nw(){if(Wo===null)throw Error(r(475));var a=Wo;return a.stylesheets&&a.count===0&&Dm(a,a.stylesheets),0<a.count?function(i){var l=setTimeout(function(){if(a.stylesheets&&Dm(a,a.stylesheets),a.unsuspend){var h=a.unsuspend;a.unsuspend=null,h()}},6e4);return a.unsuspend=i,function(){a.unsuspend=null,clearTimeout(l)}}:null}function Gu(){if(this.count--,this.count===0){if(this.stylesheets)Dm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Qu=null;function Dm(a,i){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Qu=new Map,i.forEach(aw,a),Qu=null,Gu.call(a))}function aw(a,i){if(!(i.state.loading&4)){var l=Qu.get(a);if(l)var h=l.get(null);else{l=new Map,Qu.set(a,l);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),v=0;v<b.length;v++){var z=b[v];(z.nodeName==="LINK"||z.getAttribute("media")!=="not all")&&(l.set(z.dataset.precedence,z),h=z)}h&&l.set(null,h)}b=i.instance,z=b.getAttribute("data-precedence"),v=l.get(z)||h,v===h&&l.set(null,b),l.set(z,b),this.count++,h=Gu.bind(this),b.addEventListener("load",h),b.addEventListener("error",h),v?v.parentNode.insertBefore(b,v.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),i.state.loading|=4}}var Zo={$$typeof:E,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function sw(a,i,l,h,b,v,z,H){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tt(0),this.hiddenUpdates=tt(null),this.identifierPrefix=h,this.onUncaughtError=b,this.onCaughtError=v,this.onRecoverableError=z,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=H,this.incompleteTransitions=new Map}function Py(a,i,l,h,b,v,z,H,ce,_e,ze,Me){return a=new sw(a,i,l,z,H,ce,_e,Me),i=1,v===!0&&(i|=24),v=qn(3,null,null,i),a.current=v,v.stateNode=a,i=ch(),i.refCount++,a.pooledCache=i,i.refCount++,v.memoizedState={element:h,isDehydrated:l,cache:i},mh(v),a}function Iy(a){return a?(a=ui,a):ui}function Oy(a,i,l,h,b,v){b=Iy(b),h.context===null?h.context=b:h.pendingContext=b,h=mi(i),h.payload={element:l},v=v===void 0?null:v,v!==null&&(h.callback=v),l=pi(a,h,i),l!==null&&(pa(l,a,i),Eo(l,a,i))}function zy(a,i){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var l=a.retryLane;a.retryLane=l!==0&&l<i?l:i}}function Em(a,i){zy(a,i),(a=a.alternate)&&zy(a,i)}function Ry(a){if(a.tag===13){var i=ci(a,67108864);i!==null&&pa(i,a,67108864),Em(a,67108864)}}var Yu=!0;function iw(a,i,l,h){var b=L.T;L.T=null;var v=M.p;try{M.p=2,Tm(a,i,l,h)}finally{M.p=v,L.T=b}}function rw(a,i,l,h){var b=L.T;L.T=null;var v=M.p;try{M.p=8,Tm(a,i,l,h)}finally{M.p=v,L.T=b}}function Tm(a,i,l,h){if(Yu){var b=Am(h);if(b===null)xm(a,i,h,Ju,l),$y(a,h);else if(ow(b,a,i,l,h))h.stopPropagation();else if($y(a,h),i&4&&-1<lw.indexOf(a)){for(;b!==null;){var v=gs(b);if(v!==null)switch(v.tag){case 3:if(v=v.stateNode,v.current.memoizedState.isDehydrated){var z=pe(v.pendingLanes);if(z!==0){var H=v;for(H.pendingLanes|=2,H.entangledLanes|=2;z;){var ce=1<<31-ke(z);H.entanglements[1]|=ce,z&=~ce}ss(v),(Bt&6)===0&&(Pu=Fe()+500,Go(0))}}break;case 13:H=ci(v,2),H!==null&&pa(H,v,2),Ou(),Em(v,2)}if(v=Am(h),v===null&&xm(a,i,h,Ju,l),v===b)break;b=v}b!==null&&h.stopPropagation()}else xm(a,i,h,null,l)}}function Am(a){return a=Gi(a),Pm(a)}var Ju=null;function Pm(a){if(Ju=null,a=$a(a),a!==null){var i=u(a);if(i===null)a=null;else{var l=i.tag;if(l===13){if(a=c(i),a!==null)return a;a=null}else if(l===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;a=null}else i!==a&&(a=null)}}return Ju=a,null}function Ly(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Be()){case qe:return 2;case et:return 8;case ye:case Oe:return 32;case xe:return 268435456;default:return 32}default:return 32}}var Im=!1,_i=null,Di=null,Ei=null,ec=new Map,tc=new Map,Ti=[],lw="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function $y(a,i){switch(a){case"focusin":case"focusout":_i=null;break;case"dragenter":case"dragleave":Di=null;break;case"mouseover":case"mouseout":Ei=null;break;case"pointerover":case"pointerout":ec.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":tc.delete(i.pointerId)}}function nc(a,i,l,h,b,v){return a===null||a.nativeEvent!==v?(a={blockedOn:i,domEventName:l,eventSystemFlags:h,nativeEvent:v,targetContainers:[b]},i!==null&&(i=gs(i),i!==null&&Ry(i)),a):(a.eventSystemFlags|=h,i=a.targetContainers,b!==null&&i.indexOf(b)===-1&&i.push(b),a)}function ow(a,i,l,h,b){switch(i){case"focusin":return _i=nc(_i,a,i,l,h,b),!0;case"dragenter":return Di=nc(Di,a,i,l,h,b),!0;case"mouseover":return Ei=nc(Ei,a,i,l,h,b),!0;case"pointerover":var v=b.pointerId;return ec.set(v,nc(ec.get(v)||null,a,i,l,h,b)),!0;case"gotpointercapture":return v=b.pointerId,tc.set(v,nc(tc.get(v)||null,a,i,l,h,b)),!0}return!1}function Fy(a){var i=$a(a.target);if(i!==null){var l=u(i);if(l!==null){if(i=l.tag,i===13){if(i=c(l),i!==null){a.blockedOn=i,Qt(a.priority,function(){if(l.tag===13){var h=ma();h=nt(h);var b=ci(l,h);b!==null&&pa(b,l,h),Em(l,h)}});return}}else if(i===3&&l.stateNode.current.memoizedState.isDehydrated){a.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Xu(a){if(a.blockedOn!==null)return!1;for(var i=a.targetContainers;0<i.length;){var l=Am(a.nativeEvent);if(l===null){l=a.nativeEvent;var h=new l.constructor(l.type,l);zr=h,l.target.dispatchEvent(h),zr=null}else return i=gs(l),i!==null&&Ry(i),a.blockedOn=l,!1;i.shift()}return!0}function My(a,i,l){Xu(a)&&l.delete(i)}function cw(){Im=!1,_i!==null&&Xu(_i)&&(_i=null),Di!==null&&Xu(Di)&&(Di=null),Ei!==null&&Xu(Ei)&&(Ei=null),ec.forEach(My),tc.forEach(My)}function Ku(a,i){a.blockedOn===i&&(a.blockedOn=null,Im||(Im=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,cw)))}var Wu=null;function By(a){Wu!==a&&(Wu=a,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Wu===a&&(Wu=null);for(var i=0;i<a.length;i+=3){var l=a[i],h=a[i+1],b=a[i+2];if(typeof h!="function"){if(Pm(h||l)===null)continue;break}var v=gs(l);v!==null&&(a.splice(i,3),i-=3,Ph(v,{pending:!0,data:b,method:l.method,action:h},h,b))}}))}function ac(a){function i(ce){return Ku(ce,a)}_i!==null&&Ku(_i,a),Di!==null&&Ku(Di,a),Ei!==null&&Ku(Ei,a),ec.forEach(i),tc.forEach(i);for(var l=0;l<Ti.length;l++){var h=Ti[l];h.blockedOn===a&&(h.blockedOn=null)}for(;0<Ti.length&&(l=Ti[0],l.blockedOn===null);)Fy(l),l.blockedOn===null&&Ti.shift();if(l=(a.ownerDocument||a).$$reactFormReplay,l!=null)for(h=0;h<l.length;h+=3){var b=l[h],v=l[h+1],z=b[sn]||null;if(typeof v=="function")z||By(l);else if(z){var H=null;if(v&&v.hasAttribute("formAction")){if(b=v,z=v[sn]||null)H=z.formAction;else if(Pm(b)!==null)continue}else H=z.action;typeof H=="function"?l[h+1]=H:(l.splice(h,3),h-=3),By(l)}}}function Om(a){this._internalRoot=a}Zu.prototype.render=Om.prototype.render=function(a){var i=this._internalRoot;if(i===null)throw Error(r(409));var l=i.current,h=ma();Oy(l,h,a,i,null,null)},Zu.prototype.unmount=Om.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var i=a.containerInfo;Oy(a.current,2,null,a,null,null),Ou(),i[cn]=null}};function Zu(a){this._internalRoot=a}Zu.prototype.unstable_scheduleHydration=function(a){if(a){var i=At();a={blockedOn:null,target:a,priority:i};for(var l=0;l<Ti.length&&i!==0&&i<Ti[l].priority;l++);Ti.splice(l,0,a),l===0&&Fy(a)}};var Uy=s.version;if(Uy!=="19.1.0")throw Error(r(527,Uy,"19.1.0"));M.findDOMNode=function(a){var i=a._reactInternals;if(i===void 0)throw typeof a.render=="function"?Error(r(188)):(a=Object.keys(a).join(","),Error(r(268,a)));return a=p(i),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var uw={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ed=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ed.isDisabled&&ed.supportsFiber)try{O=ed.inject(uw),te=ed}catch{}}return ic.createRoot=function(a,i){if(!o(a))throw Error(r(299));var l=!1,h="",b=sx,v=ix,z=rx,H=null;return i!=null&&(i.unstable_strictMode===!0&&(l=!0),i.identifierPrefix!==void 0&&(h=i.identifierPrefix),i.onUncaughtError!==void 0&&(b=i.onUncaughtError),i.onCaughtError!==void 0&&(v=i.onCaughtError),i.onRecoverableError!==void 0&&(z=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(H=i.unstable_transitionCallbacks)),i=Py(a,1,!1,null,null,l,h,b,v,z,H,null),a[cn]=i.current,gm(a),new Om(i)},ic.hydrateRoot=function(a,i,l){if(!o(a))throw Error(r(299));var h=!1,b="",v=sx,z=ix,H=rx,ce=null,_e=null;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(b=l.identifierPrefix),l.onUncaughtError!==void 0&&(v=l.onUncaughtError),l.onCaughtError!==void 0&&(z=l.onCaughtError),l.onRecoverableError!==void 0&&(H=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(ce=l.unstable_transitionCallbacks),l.formState!==void 0&&(_e=l.formState)),i=Py(a,1,!0,i,l??null,h,b,v,z,H,ce,_e),i.context=Iy(null),l=i.current,h=ma(),h=nt(h),b=mi(h),b.callback=null,pi(l,b,h),l=h,i.current.lanes=l,Je(i,l),ss(i),a[cn]=i.current,gm(a),new Zu(i)},ic.version="19.1.0",ic}var ab;function lS(){if(ab)return $m.exports;ab=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(s){console.error(s)}}return t(),$m.exports=rS(),$m.exports}var oS=lS();const cS=({message:t="Newtons Ai HMS"})=>e.jsx("div",{className:"loading-container",children:e.jsxs("div",{className:"loading-content",children:[e.jsxs("div",{className:"spinner-ring",children:[e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{})]}),e.jsx("div",{className:"loading-title",children:t}),e.jsx("div",{className:"loading-subtitle",children:"Loading your workspace..."})]})});function uS(t={}){const{nonce:s,locale:n,onScriptLoadSuccess:r,onScriptLoadError:o}=t,[u,c]=y.useState(!1),d=y.useRef(r);d.current=r;const p=y.useRef(o);return p.current=o,y.useEffect(()=>{const m=document.createElement("script");return m.src="https://accounts.google.com/gsi/client",n&&(m.src+=`?hl=${n}`),m.async=!0,m.defer=!0,m.nonce=s,m.onload=()=>{var f;c(!0),(f=d.current)===null||f===void 0||f.call(d)},m.onerror=()=>{var f;c(!1),(f=p.current)===null||f===void 0||f.call(p)},document.body.appendChild(m),()=>{document.body.removeChild(m)}},[s]),u}const d0=y.createContext(null);function dS({clientId:t,nonce:s,locale:n,onScriptLoadSuccess:r,onScriptLoadError:o,children:u}){const c=uS({nonce:s,onScriptLoadSuccess:r,onScriptLoadError:o,locale:n}),d=y.useMemo(()=>({locale:n,clientId:t,scriptLoadedSuccessfully:c}),[t,c]);return en.createElement(d0.Provider,{value:d},u)}function hS(){const t=y.useContext(d0);if(!t)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return t}function mS(t){var s;return(s=t==null?void 0:t.clientId)!==null&&s!==void 0?s:t==null?void 0:t.client_id}const pS={large:40,medium:32,small:20};function fS({onSuccess:t,onError:s,useOneTap:n,promptMomentNotification:r,type:o="standard",theme:u="outline",size:c="large",text:d,shape:p,logo_alignment:m,width:f,click_listener:g,state:x,containerProps:j,...N}){const k=y.useRef(null),{clientId:D,locale:_,scriptLoadedSuccessfully:T}=hS(),E=y.useRef(t);E.current=t;const U=y.useRef(s);U.current=s;const X=y.useRef(r);return X.current=r,y.useEffect(()=>{var I,F,B,G,C,A,P,$,J;if(T)return(B=(F=(I=window==null?void 0:window.google)===null||I===void 0?void 0:I.accounts)===null||F===void 0?void 0:F.id)===null||B===void 0||B.initialize({client_id:D,callback:R=>{var L;if(!(R!=null&&R.credential))return(L=U.current)===null||L===void 0?void 0:L.call(U);const{credential:M,select_by:Z}=R;E.current({credential:M,clientId:mS(R),select_by:Z})},...N}),(A=(C=(G=window==null?void 0:window.google)===null||G===void 0?void 0:G.accounts)===null||C===void 0?void 0:C.id)===null||A===void 0||A.renderButton(k.current,{type:o,theme:u,size:c,text:d,shape:p,logo_alignment:m,width:f,locale:_,click_listener:g,state:x}),n&&((J=($=(P=window==null?void 0:window.google)===null||P===void 0?void 0:P.accounts)===null||$===void 0?void 0:$.id)===null||J===void 0||J.prompt(X.current)),()=>{var R,L,M;n&&((M=(L=(R=window==null?void 0:window.google)===null||R===void 0?void 0:R.accounts)===null||L===void 0?void 0:L.id)===null||M===void 0||M.cancel())}},[D,T,n,o,u,c,d,p,m,f,_]),en.createElement("div",{...j,ref:k,style:{height:pS[c],...j==null?void 0:j.style}})}class gS extends y.Component{constructor(){super(...arguments);Gt(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,r){console.error("Uncaught error:",n,r)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"red",border:"1px solid red",borderRadius:"5px"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsx("p",{children:"We are sorry for the inconvenience. Please try again later."})]}):this.props.children}}const h0=y.createContext(void 0),xS=({children:t})=>{const[s,n]=y.useState(!1),[r,o]=y.useState({startDate:null,endDate:null}),[u,c]=y.useState(null),[d,p]=y.useState(null),[m,f]=y.useState(null),g=y.useCallback(()=>n(!0),[]),x=y.useCallback(()=>n(!1),[]),j=y.useCallback(()=>n(U=>!U),[]),N=y.useCallback(U=>{f(()=>U)},[]),k=y.useCallback(U=>{m?m(U):console.warn("Analysis navigator not registered")},[m]),[D,_]=y.useState(null),T=y.useCallback(U=>{_(()=>U)},[]),E=y.useCallback(async()=>D?await D():(console.warn("Analysis refresher not registered"),null),[D]);return e.jsx(h0.Provider,{value:{isOpen:s,openAssistant:g,closeAssistant:x,toggleAssistant:j,analysisDateRange:r,setAnalysisDateRange:o,analysisData:u,setAnalysisData:c,analysisNavigate:k,registerAnalysisNavigator:N,refreshAnalysis:E,registerAnalysisRefresher:T,pageContext:d,setPageContext:p},children:t})},Od=()=>{const t=y.useContext(h0);if(t===void 0)throw new Error("useClinicAssistantContext must be used within a ClinicAssistantProvider");return t},m0=y.createContext(void 0),yS=({children:t})=>{const[s,n]=y.useState([]),[r,o]=y.useState(null),[u,c]=y.useState(""),[d,p]=y.useState(0),[m,f]=y.useState([]),g=y.useCallback(k=>{n(D=>[...D,k])},[]),x=y.useCallback((k,D)=>{n(_=>_.map(T=>T.id===k?{...T,...D}:T))},[]),j=y.useCallback(k=>{n(D=>D.filter(_=>_.id!==k))},[]),N=y.useCallback(()=>{n([]),o(null),c(""),p(0),f([])},[]);return e.jsx(m0.Provider,{value:{purchaseRows:s,setPurchaseRows:n,selectedDistributor:r,setSelectedDistributor:o,searchTerm:u,setSearchTerm:c,amountPaidToDistributor:d,setAmountPaidToDistributor:p,distributors:m,setDistributors:f,addPurchaseRow:g,updatePurchaseRow:x,removePurchaseRow:j,resetPurchase:N},children:t})},p0=()=>{const t=y.useContext(m0);if(!t)throw new Error("usePurchaseContext must be used within a PurchaseProvider");return t},f0=y.createContext(void 0),bS=({children:t})=>{const[s,n]=y.useState(!1),[r,o]=y.useState(""),u=y.useCallback(()=>n(!0),[]),c=y.useCallback(()=>n(!1),[]),d=y.useCallback(()=>n(p=>!p),[]);return y.useEffect(()=>{const p=m=>{(m.ctrlKey||m.metaKey)&&m.key==="k"&&(m.preventDefault(),d()),m.key==="Escape"&&s&&c()};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[s,d,c]),e.jsx(f0.Provider,{value:{isOpen:s,openCommandBar:u,closeCommandBar:c,toggleCommandBar:d,preFilledQuery:r,setPreFilledQuery:o},children:t})},$l=()=>{const t=y.useContext(f0);if(t===void 0)throw new Error("useCommandBar must be used within a CommandBarProvider");return t},jS=()=>{const t=localStorage.getItem("currentClinicId");return t||(console.warn("getCurrentClinicId: Clinic ID not found. Returning null. Ensure this is implemented correctly."),null)},ff=()=>localStorage.getItem("authToken");class vS{constructor(){Gt(this,"listeners",[]);Gt(this,"activeRequests",0)}subscribe(s){return this.listeners.push(s),s(this.activeRequests>0),()=>this.unsubscribe(s)}unsubscribe(s){this.listeners=this.listeners.filter(n=>n!==s)}notify(s){s?this.activeRequests++:this.activeRequests=Math.max(0,this.activeRequests-1);const n=this.activeRequests>0;this.listeners.forEach(r=>r(n))}}const Op=new vS,NS="https://backend.newtons.in",wS=()=>localStorage.getItem("authToken"),ae=async(t,s={})=>{const n=wS(),r={...s.headers};n&&(r.Authorization=`Bearer ${n}`),!(s.body instanceof FormData)&&!r["Content-Type"]&&(r["Content-Type"]="application/json");const o=r;let u=t.startsWith("/")?t:`/${t}`;u.startsWith("/api/")||(u=`/api${u}`);const c=`${NS}${u}`;Op.notify(!0);try{console.log(`Making API call to: ${c}`);const d=await fetch(c,{...s,headers:o});if(d.status===401)throw console.error("Unauthorized access - Token might be invalid or expired. Logging out."),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),window.location.href="/login",new Error("Unauthorized");if(!d.ok){let p=`HTTP error! status: ${d.status}`;try{const m=await d.json();p=(m==null?void 0:m.message)||(m==null?void 0:m.error)||p}catch{}throw console.error(`API Error: ${d.status} ${d.statusText} - ${p}`),new Error(p)}return d}catch(d){throw d instanceof TypeError&&d.message==="Failed to fetch"?console.error("API Fetch Error: Network error or CORS issue. Check backend CORS configuration.",d):console.error("API Fetch Error:",d),d}finally{Op.notify(!1)}},Bm="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",SS="models/gemini-3-flash-preview",kS=`You are an intelligent Clinic Hub Assistant for a Clinic Management System. Your role is to help the Clinic Administrator or Doctor manage their clinic ecosystem efficiently.

You have access to the current state of the clinic settings and the staff list. You can perform actions to update these settings or manage staff members.

**Capabilities:**
1.  **View Settings & Staff:** User can ask about current charges, clinic details, or staff members. Answer based on the provided context.
2.  **Update Settings:** Change fees, clinic name, address, etc.
3.  **Manage Staff:** Add new staff members or update existing ones.
4.  **Voice AI Settings:** Update the \`voice_ai_language\` for the Live API Assistant. Available codes:
    -   India: \`en-US\` (English), \`hi-IN\` (Hindi), \`te-IN\` (Telugu), \`bn-IN\` (Bengali), \`mr-IN\` (Marathi), \`ta-IN\` (Tamil), \`gu-IN\` (Gujarati), \`kn-IN\` (Kannada), \`ml-IN\` (Malayalam), \`pa-IN\` (Punjabi)
    -   Global: \`es-ES\` (Spanish), \`fr-FR\` (French), \`de-DE\` (German), \`it-IT\` (Italian), \`pt-PT\` (Portuguese), \`ru-RU\` (Russian), \`ja-JP\` (Japanese), \`ko-KR\` (Korean), \`zh-CN\` (Chinese), \`ar-SA\` (Arabic).
5.  **Analyze Financials & Inventory:** Access the Analysis Dashboard to view revenue, expenses, and inventory movement. Set date ranges to filter data.
6.  **Manage Inventory:** Update pharmacy tokens (drugs) and lab tests. You will reference items by their **Serial Number** as provided in the context.
7.  **Purchase Management:** Search for distributors, select one, and build a purchase order by adding items. You can add multiple items at once. Editing items uses Serial Numbers.
8.  **Looping & Reasoning:** You should think step-by-step. If a user request involves multiple steps or if you need to check something after an action, you can continue the loop.
9.  **Follow-up:** If critical information is missing, ask the user.

**Interpretation Rules:**
- **Analysis Dates:** When the user asks for analysis (financial or inventory) for a specific time range (e.g., "last month", "yesterday"), you **MUST** include \`startDate\` and \`endDate\` in the \`navigate_to\` action for \`/dashboard/analysis\`.
- If the user says "add drug", "buy medicine", or "new stock", they **usually mean "Add Item to Purchase Order"** (use \`add_purchase_items\` or navigate to \`/dashboard/purchase\`).
- **Prerequisite:** If you are using ANY purchase tools (\`add_purchase_items\`, \`search_distributor_purchase\`, \`set_distributor_purchase\`, \`edit_purchase_items\`), you **MUST** include a \`navigate_to\` action with \`page: "/dashboard/purchase"\` as the **FIRST** action in your list, unless you are already on that page.
- **ONLY** use \`update_drug\` (create) if the user explicitly says "create new drug definition" or "add to master inventory".
- The correct route for purchasing is \`/dashboard/purchase\`.

- **Inventory Navigation:** If you execute "update_drug" or "search_pharmacy_inventory", you **MUST** include a "navigate_to" action for "/dashboard/inventory". If you searched for or updated a specific term, append it as "?search=Term" (e.g. "/dashboard/inventory?search=Paracetamol").
- **Lab Navigation:** If you execute "update_lab_test", you **MUST** include a "navigate_to" action for "/lab-inventory", unless you are already on that page.

**Action Tools:**
You can perform the following actions. Return a JSON array of actions.

\`\`\`json
[
  {
    "action": "update_clinic_settings",
    "updates": {
       "admissionCharge": "number string",
       "perDayCharge": "number string",
       "otherCharges": "number string",
       "name": "string",
       "address": "string",
       "notes": "string",
       "logoUrl": "string",
       "upi_id": "string",
       "low_stock_threshold": number,
        "clinicWideSystemPrompt": "string",
        "aiMemory": "string",
        "clinicWideSystemPrompt": "string",
        "aiMemory": "string",
        "gemini_api_key": "string",
        "voice_ai_language": "string (e.g. 'en-US', 'te-IN')"
    }
  },
  {
    "action": "create_staff_member",
    "staff": {
       "name": "string",
       "email": "string",
       "role": "doctor" | "receptionist" | "pharmacy" | "lab",
       "password": "string",
       "opd_fee": number | null
    }
  },
  {
    "action": "update_staff_member",
    "id": "string | number", 
    "updates": {
       "name": "string",
       "email": "string",
       "role": "doctor" | "receptionist" | "pharmacy" | "lab",
       "password": "string",
       "opd_fee": number | null,
       "active": boolean
    }
  },
  {
    "action": "set_analysis_dates",
    "startDate": "YYYY-MM-DD",
    "endDate": "YYYY-MM-DD"
  },
  {
    "action": "navigate_to",
    "page": "/dashboard/inventory" | "/lab-inventory" | "/dashboard/queue" | "/dashboard/staff" | "/dashboard/purchase" | "/dashboard/analysis" | "/dashboard/clinic-hub" | "/billing" | "/dashboard/patients",
    "section": "financial" | "inventory" | "string (optional)",
    "startDate": "YYYY-MM-DD (optional, for analysis page)",
    "endDate": "YYYY-MM-DD (optional, for analysis page)"
  },
  {
    "action": "highlight_section",
    "elementId": "string"
  },
  {
    "action": "refresh_analysis"
  },
  {
    "action": "ask_followup_question",
    "question": "string"
  },
  {
    "action": "search_pharmacy_inventory",
    "query": "string (name, brand, or composition)"
  },
  {
    "action": "update_drug",
    "id": "number",
    "updates": {
       "name": "string",
       "brand_name": "string",
       "description": "string",
       "mrp": "number (MRP)",
       "stock": "number",
       "pack": "string (e.g. strip, bottle)",
       "supplier": "string",
       "expiry_date": "YYYY-MM-DD",
       "rate": "number",
       "box_number": "string",
       "gst": "number",
       "margin": "number",
       "discount": "number",
       "batch": "string",
       "hsn_code": "string",
       "mfg": "string",
       "loose": "number"
    }
  },
  {
    "action": "update_lab_test",
    "serial_number": 1,
    "updates": {
       "name": "string",
       "price": "number",
       "description": "string",
       "default_parameters": "array of objects { name, type, defaultValue, unit, lower_limit, upper_limit }"
    }
  },
  {
    "action": "search_distributor_purchase",
    "query": "string"
  },
  {
    "action": "set_distributor_purchase",
    "distributorId": "string"
  },
  {
    "action": "add_purchase_items",
    "items": [
        {
            "name": "string",
            "stock": "number (quantity)",
            "rate": "number (buying price)",
            "mrp": "number",
             "pack": "string", 
             "expiry_date": "YYYY-MM-DD",
             "batch": "string",
             "discount": "number",
             "gst": "number"
        }
    ]
  },
  {
    "action": "edit_purchase_items",
     "updates": [
         {
             "serial_number": "number (The Row # from context)",
             "field": "string (name, stock, rate, etc.)",
             "value": "string | number"
         }
     ]
  },
  {
    "action": "end_task",
    "summary": "string"
  },
  {
    "action": "open_new_case",
    "name": "string (Patient Name)",
    "age": "number (optional)",
    "gender": "M | F | O (optional)",
    "phone": "string (optional)",
    "complaint": "string (The medical complaint/reason)"
  }
]
\`\`\`

**Navigation Reference:**
- **Pharmacy Inventory:** \`/dashboard/inventory\`
- **Lab Inventory:** \`/lab-inventory\`
- **Doctor Queue:** \`/dashboard/queue\`
- **Staff Management:** \`/dashboard/staff\`
- **All Patients:** \`/dashboard/patients\`
- **Billing:** \`/billing\`
- **Purchase Page:** \`/dashboard/purchase\`
- **Analysis:** \`/dashboard/analysis\`
- **Clinic Hub:** \`/dashboard/clinic-hub\`
\`\`\`

**Rules:**
-   **Always** return a JSON array as the last part of your response.
-   If the user's request is satisfied, use the \`end_task\` action with a summary of what was done.
-   If you need more info, use \`ask_followup_question\`.
-   If you perform an action (like updating settings), and there's nothing else to do *immediately* but you want to confirm it's done, you can return the action. The system will execute it and call you back with the result. Then you can \`end_task\`.
-   For \`create_staff_member\`, if password is not provided by user, generate a secure random password and mention it in the summary.
-   Update numeric strings as strings (e.g., "500.00").
-   **CRITICAL DO's and DON'Ts:**
    -   **DO NOT** fill in empty fields (like \`gemini_api_key\`, \`logoUrl\`, \`upi_id\`, etc.) with fake, placeholder, or example data.
    -   **ONLY** update fields that the user *intentionally* asked to change.
    -   **PRESERVE** existing values for any fields not explicitly mentioned in the user's request.
    -   If a field is empty and the user didn't ask to set it, **leave it empty**.
    -   Do not invent values.
`;async function CS(){var n;if(!ff()&&Bm)return Bm;let s=null;try{const r=await ae("/api/clinics/settings");if(r.ok){const o=await r.json();(n=o.gemini_api_key)!=null&&n.trim()&&(s=o.gemini_api_key.trim())}}catch(r){console.warn("Error fetching updated key",r)}if(s)return s;try{const r=await ae("/api/global-settings/app_gemini_api_key");if(r.ok){const u=(await r.json()).value;if(u&&u.trim()!=="")return u.trim()}}catch(r){console.warn("Could not fetch global API key.",r)}return Bm}let Um=null;async function _S(){if(!Um){const t=await CS();Um=new uf({apiKey:t})}return Um}async function DS(t,s,n=[],r){var m,f,g,x,j;const o=await _S(),u=[];u.push({role:"user",parts:[{text:kS}]}),u.push({role:"model",parts:[{text:"Understood. I am ready to assist with Clinic Hub management."}]}),n.forEach(N=>{u.push({role:N.role,parts:[{text:N.text}]})});const p=[{text:`
    Context:
    ${`
    --- Current Clinic Context ---
    Settings: ${JSON.stringify(s.settings,null,2)}
    
    Staff List: ${JSON.stringify(s.staffList.map(N=>({id:N.id||N._id,name:N.name,role:N.role,email:N.email,active:N.active,opd_fee:N.opd_fee})),null,2)}
    
    Previous Action Results (if any): ${JSON.stringify(s.actionResults||[],null,2)}

    Analysis Data (if active): ${JSON.stringify(s.analysisData||{},null,2)}

    Pharmacy Inventory: ${s.pharmacyInventory?JSON.stringify(s.pharmacyInventory,null,2):"Not loaded. Use 'search_pharmacy_inventory' to find items."}

    Distributors List: ${JSON.stringify((s.distributors||[]).map(N=>({serial_number:N.serial_number,name:N.name,contact_person:N.contact_person,phone:N.phone,remainingBalance:N.remainingBalance})),null,2)}

    Lab Tests Inventory: ${JSON.stringify((s.labInventory||[]).map(N=>({serial:N.serial_number,name:N.name,price:N.price,description:N.description,default_parameters:N.default_parameters})),null,2)}

    Current Purchase Page Rows: ${JSON.stringify((s.purchaseRows||[]).map((N,k)=>({serial_number:k+1,name:N.name,stock:N.stock,rate:N.rate,mrp:N.mrp,net_value:(N.stock*N.rate).toFixed(2)})),null,2)}

    Current Application Page Context: ${s.pageContext?JSON.stringify(s.pageContext,null,2):"Unknown/General Dashboard"}
    `}

    User Query/Input:
    ${t}
    `}];if(r){const N=r.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"");p.push({inlineData:{data:N,mimeType:"image/jpeg"}})}u.push({role:"user",parts:p});try{const N={model:SS,contents:u,generationConfig:{temperature:.7,maxOutputTokens:2048,responseMimeType:"text/plain"}},k=await o.models.generateContentStream(N);let D="";for await(const _ of k){const T=_;T.text&&typeof T.text=="function"?D+=T.text():(j=(x=(g=(f=(m=T.candidates)==null?void 0:m[0])==null?void 0:f.content)==null?void 0:g.parts)==null?void 0:x[0])!=null&&j.text&&(D+=T.candidates[0].content.parts[0].text)}if(!D)throw new Error("Empty response from AI");return D}catch(N){throw console.error("Gemini Interaction Error:",N),new Error("Failed to communicate with AI Assistant.")}}const gf=({settings:t,staffList:s,onSettingsUpdate:n,onStaffUpdate:r,onHighlight:o})=>{const u=ot(),{setAnalysisDateRange:c,analysisData:d,analysisNavigate:p,refreshAnalysis:m,pageContext:f}=Od(),{setDistributors:g,setSelectedDistributor:x,setSearchTerm:j,addPurchaseRow:N,updatePurchaseRow:k,distributors:D,purchaseRows:_}=p0(),[T,E]=y.useState(""),U=y.useRef(d),X=y.useRef(_);y.useEffect(()=>{U.current=d},[d]),y.useEffect(()=>{X.current=_},[_]);const[I,F]=y.useState([]),[B,G]=y.useState(!1),[C,A]=y.useState(null),P=y.useRef(!1),$=y.useRef(0),J=5,R=()=>{P.current=!1,G(!1),F(ge=>[...ge,{role:"system",text:" Task stopped by user."}])},L=ge=>{const fe=new FileReader;fe.onloadend=()=>{A(fe.result)},fe.readAsDataURL(ge)},M=()=>{A(null)},Z=async(ge,fe,w=[],ue)=>{var Ne,K,Y;if(P.current){if($.current+=1,$.current>J){F(V=>[...V,{role:"system",text:" Task limit reached. Stopping automatically."}]),G(!1),P.current=!1;return}try{let V=t,oe=s,Pe=[],se=[],Ce=[];try{const[xe,he]=await Promise.all([ae("/api/clinics/settings"),ae("/staff")]);if(xe.ok&&he.ok){const W=await xe.json(),O=await he.json(),[te,re,ke]=await Promise.all([ae("/api/drugs"),ae("/api/lab-tests"),ae("/api/distributors")]);if(te.ok){const Ue=await te.json();Pe=Ue.drugs||Ue||[]}re.ok&&(se=(await re.json()).map((Qe,Ze)=>({...Qe,serial_number:Ze+1}))),ke.ok&&(Ce=(await ke.json()||[]).map((Qe,Ze)=>({...Qe,serial_number:Ze+1}))),V={...W,admissionCharge:parseFloat(W.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(W.perDayCharge||0).toFixed(2),otherCharges:parseFloat(W.otherCharges||0).toFixed(2),aiMemory:W.aiMemory||"",clinicWideSystemPrompt:W.clinicWideSystemPrompt||"",gemini_api_key:W.gemini_api_key||"",low_stock_threshold:W.low_stock_threshold!==void 0&&W.low_stock_threshold!==null?String(W.low_stock_threshold):"10",name:W.name||"",logoUrl:W.logoUrl||"",upi_id:W.upi_id||"",address:W.address||"",notes:W.notes||"",clinic_id:W.clinic_id},oe=O.map(Ue=>({...Ue,id:Ue._id||Ue.id}))}}catch(xe){console.warn("Failed to fetch fresh context for AI loop, falling back to props",xe)}const ee={settings:V,staffList:oe,analysisData:U.current,pharmacyInventory:Pe.length>50?void 0:Pe,labInventory:se,distributors:Ce,purchaseRows:X.current,actionResults:w,pageContext:f||void 0},je=fe.filter(xe=>xe.role!=="system"),Ie=await DS(ge,ee,je,ue);if(!P.current)return;let $e=[];try{const xe=Ie.match(/\[[\s\S]*\]/);if(xe)$e=JSON.parse(xe[0]);else{F(he=>[...he,{role:"model",text:Ie}]),G(!1),P.current=!1;return}}catch(xe){console.error("Failed to parse AI response",xe),F(he=>[...he,{role:"model",text:"I'm having trouble processing that. Please try again."}]),G(!1),P.current=!1;return}const Fe=[];let Be=[],qe=[];for(const xe of $e){if(!P.current)break;if(xe.action==="end_task"){F(he=>[...he,{role:"model",text:xe.summary}]),G(!1),P.current=!1;return}if(xe.action==="ask_followup_question"){F(he=>[...he,{role:"model",text:xe.question}]),G(!1),P.current=!1;return}try{if(xe.action==="update_clinic_settings"){const he=xe.updates;Object.keys(he).forEach(te=>Be.push(`setting-${te}`));const W={...V,...he},O={...W,admissionCharge:parseFloat(W.admissionCharge),perDayCharge:parseFloat(W.perDayCharge),otherCharges:parseFloat(W.otherCharges),low_stock_threshold:parseInt(W.low_stock_threshold)};await ae("/api/clinics/settings",{method:"PUT",body:JSON.stringify(O)}),n&&n(),Fe.push({action:"update_clinic_settings",status:"success"}),qe.push({role:"system",text:" Updated clinic settings"})}if(xe.action==="create_staff_member"&&(await ae("/api/staff",{method:"POST",body:JSON.stringify({...xe.staff,clinic_id:V.clinic_id})}),r&&r(),Fe.push({action:"create_staff_member",status:"success",name:xe.staff.name}),qe.push({role:"system",text:` Created staff member: ${xe.staff.name}`})),xe.action==="update_staff_member"){const he=xe.id;await ae(`/api/staff/${he}`,{method:"PUT",body:JSON.stringify(xe.updates)}),r&&r(),Be.push(`staff-member-${he}`),Fe.push({action:"update_staff_member",status:"success",id:he}),qe.push({role:"system",text:" Updated staff member details"})}if(xe.action==="set_analysis_dates"){const{startDate:he,endDate:W}=xe;c({startDate:new Date(he),endDate:new Date(W)}),Fe.push({action:"set_analysis_dates",status:"success",startDate:he,endDate:W}),qe.push({role:"system",text:` Set analysis dates: ${he} to ${W}`})}if(xe.action==="navigate_to"){let he=xe.page;if(xe.page&&xe.page.includes("analysis")&&xe.startDate&&xe.endDate){const W=he.includes("?")?"&":"?";he=`${he}${W}startDate=${xe.startDate}&endDate=${xe.endDate}`}else xe.page&&xe.page.includes("analysis")&&((Ne=U.current)!=null&&Ne.startDate)&&((K=U.current)!=null&&K.endDate);u(he),xe.section&&setTimeout(()=>p(xe.section),500),Fe.push({action:"navigate_to",status:"success",page:he}),qe.push({role:"system",text:` Navigated to ${he}`})}if(xe.action==="highlight_section"&&(Be.push(xe.elementId),Fe.push({action:"highlight_section",status:"success",id:xe.elementId})),xe.action==="refresh_analysis"){qe.push({role:"system",text:" Refreshing analysis data..."});const he=await m();he?(U.current=he,Fe.push({action:"refresh_analysis",status:"success",summary:"Data refreshed successfully"}),qe.push({role:"system",text:" Analysis data refreshed"})):(Fe.push({action:"refresh_analysis",status:"error",error:"No data returned"}),qe.push({role:"system",text:" Failed to refresh analysis data"}))}if(xe.action==="search_pharmacy_inventory"){const he=xe.query.toLowerCase(),W=Pe.filter(te=>te.name&&te.name.toLowerCase().includes(he)||te.brand_name&&te.brand_name.toLowerCase().includes(he)||te.description&&te.description.toLowerCase().includes(he)),O=W.slice(0,10);Fe.push({action:"search_pharmacy_inventory",status:"success",count:W.length,results:O}),W.length>0?qe.push({role:"system",text:` Found ${W.length} matches for "${xe.query}". Showing top ${O.length}.`}):qe.push({role:"system",text:` No matches found for "${xe.query}"`})}if(xe.action==="update_drug"){const he=xe.id;try{const W=Pe.find(te=>te.id===he);if(!W)throw new Error(`Drug with ID ${he} not found.`);const O={...W,...xe.updates};await ae(`/api/drugs/${he}`,{method:"PUT",body:JSON.stringify(O)}),Fe.push({action:"update_drug",status:"success",id:he,updates:xe.updates}),qe.push({role:"system",text:` Updated drug: ${W.name}`})}catch(W){Fe.push({action:"update_drug",status:"error",error:W.message}),qe.push({role:"system",text:` Failed to update drug: ${W.message}`})}}if(xe.action==="update_lab_test"){const he=se.find(W=>W.serial_number===xe.serial_number);if(he){const W={...he,...xe.updates};await ae(`/api/lab-tests/${he.id}`,{method:"PUT",body:JSON.stringify(W)}),Fe.push({action:"update_lab_test",status:"success",item:he.name}),qe.push({role:"system",text:` Updated lab test: ${he.name}`})}else Fe.push({action:"update_lab_test",status:"error",error:`Test with serial ${xe.serial_number} not found`}),qe.push({role:"system",text:` Lab test with serial ${xe.serial_number} not found`})}if(xe.action==="search_distributor_purchase"){const he=xe.query,W=await ae(`/api/distributors?search=${encodeURIComponent(he)}`);if(W.ok){const O=await W.json();g(O),j(he),Fe.push({action:"search_distributor_purchase",status:"success",count:O.length,results:O}),qe.push({role:"system",text:` Found ${O.length} distributors for "${he}"`})}else Fe.push({action:"search_distributor_purchase",status:"error",error:W.statusText}),qe.push({role:"system",text:" Failed to search distributors"})}if(xe.action==="set_distributor_purchase"){const he=xe.distributorId;let W=D.find(O=>O.id===he);W?(x(W),j(W.name),Fe.push({action:"set_distributor_purchase",status:"success",distributor:W.name}),qe.push({role:"system",text:` Selected distributor: ${W.name}`})):(Fe.push({action:"set_distributor_purchase",status:"error",error:"Distributor not found in current search results. Please search first."}),qe.push({role:"system",text:" Distributor not found. Please search first."}))}if(xe.action==="add_purchase_items"){const he=xe.items;let W=0;he.forEach(O=>{const re={id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:O.name||"",composition:O.composition||"",description:O.description||"",mrp:O.mrp||0,stock:O.stock||0,pack:O.pack||"",supplier:"",expiry_date:O.expiry_date||"",rate:O.rate||0,box_number:O.box_number||"",gst:O.gst||0,margin:O.margin||0,discount:O.discount||0,brand_name:O.brand_name||"",batch:O.batch||"",hsn_code:O.hsn_code||"",mfg:O.mfg||"",loose:O.loose||0,last_updated:"",created_at:""};N(re),W++}),Fe.push({action:"add_purchase_items",status:"success",count:W}),qe.push({role:"system",text:` Added ${W} items to purchase list`})}if(xe.action==="edit_purchase_items"){const he=xe.updates;let W=0;const O=X.current||[];he.forEach(te=>{if(te.serial_number){const re=te.serial_number-1,ke=O[re];ke&&ke.id?(k(ke.id,{[te.field]:te.value}),W++):(console.warn(`Row with serial number ${te.serial_number} not found.`),qe.push({role:"system",text:` Row #${te.serial_number} not found.`}))}}),Fe.push({action:"edit_purchase_items",status:"success",count:W}),qe.push({role:"system",text:` Updated ${W} items`})}if(xe.action==="open_new_case"){const{name:he,age:W,gender:O,complaint:te,phone:re}=xe;try{const ke=await ae("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:he||"New Patient",age:W||null,gender:O||null,phone:re||null,address:null})});if(!ke.ok){const lt=await ke.json().catch(()=>({}));throw ke.status===403&&((Y=lt.message)!=null&&Y.includes("Patient limit"))?new Error(`Patient limit reached: ${lt.message}`):new Error(lt.message||"Failed to create patient")}const Ue=await ke.json();if(!Ue||!Ue.id)throw new Error("Created patient has no ID");const Qe=await ae("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:Ue.id,complaint:te||"New Case"})});if(!Qe.ok)throw new Error("Failed to create queue entry");const Ze=await Qe.json();u(`/dashboard/edit-complaint/${Ze.id}`,{state:{initialComplaint:te}}),Fe.push({action:"open_new_case",status:"success",patientId:Ue.id,queueId:Ze.id}),qe.push({role:"system",text:` Opened new case for ${he}`}),G(!1),P.current=!1;return}catch(ke){ke.message.includes("Patient limit")&&(u("/start-clinic-subscription"),qe.push({role:"system",text:" Patient limit reached. Redirecting to subscription."})),Fe.push({action:"open_new_case",status:"error",error:ke.message}),qe.push({role:"system",text:` Failed to open new case: ${ke.message}`})}}}catch(he){console.error("Action execution failed",xe,he),Fe.push({action:xe.action,status:"error",error:he.message}),qe.push({role:"system",text:` Failed to execute action: ${xe.action}`})}}Be.length>0&&o&&setTimeout(()=>o(Be),500),qe.length>0&&F(xe=>[...xe,...qe]);const et=[...w,...Fe],ye=`Reflecting on previous actions: ${JSON.stringify(Fe)}. What is the next step? If done, call end_task.`,Oe=[...fe,...qe,{role:"model",text:Ie},{role:"user",text:ye}];await Z(ye,Oe,et,void 0)}catch(V){console.error(V),F(oe=>[...oe,{role:"model",text:"Something went wrong."}]),G(!1),P.current=!1}}};return{chatQuery:T,setChatQuery:E,chatHistory:I,isProcessing:B,handleSendMessage:ge=>{const fe=ge!==void 0?ge:T;if(!fe.trim()&&!C)return;P.current=!0,G(!0),$.current=0;const w={role:"user",text:fe};C&&(w.text+=" [Image Attached]"),F(Ne=>[...Ne,w]);const ue=C||void 0;E(""),A(null),Z(fe,I,[],ue)},refreshChat:()=>{F([]),E(""),G(!1),P.current=!1,$.current=0,A(null)},stopGeneration:R,selectedImage:C,handleImageSelect:L,clearImage:M}};function ES(t,s){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const TS=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,AS=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,PS={};function sb(t,s){return(PS.jsx?AS:TS).test(t)}const IS=/[ \t\n\f\r]/g;function OS(t){return typeof t=="object"?t.type==="text"?ib(t.value):!1:ib(t)}function ib(t){return t.replace(IS,"")===""}let Cc=class{constructor(s,n,r){this.normal=n,this.property=s,r&&(this.space=r)}};Cc.prototype.normal={};Cc.prototype.property={};Cc.prototype.space=void 0;function g0(t,s){const n={},r={};for(const o of t)Object.assign(n,o.property),Object.assign(r,o.normal);return new Cc(n,r,s)}function zp(t){return t.toLowerCase()}let sa=class{constructor(s,n){this.attribute=n,this.property=s}};sa.prototype.attribute="";sa.prototype.booleanish=!1;sa.prototype.boolean=!1;sa.prototype.commaOrSpaceSeparated=!1;sa.prototype.commaSeparated=!1;sa.prototype.defined=!1;sa.prototype.mustUseProperty=!1;sa.prototype.number=!1;sa.prototype.overloadedBoolean=!1;sa.prototype.property="";sa.prototype.spaceSeparated=!1;sa.prototype.space=void 0;let zS=0;const yt=Cr(),Nn=Cr(),x0=Cr(),Ve=Cr(),Wt=Cr(),Il=Cr(),fa=Cr();function Cr(){return 2**++zS}const Rp=Object.freeze(Object.defineProperty({__proto__:null,boolean:yt,booleanish:Nn,commaOrSpaceSeparated:fa,commaSeparated:Il,number:Ve,overloadedBoolean:x0,spaceSeparated:Wt},Symbol.toStringTag,{value:"Module"})),qm=Object.keys(Rp);let xf=class extends sa{constructor(s,n,r,o){let u=-1;if(super(s,n),rb(this,"space",o),typeof r=="number")for(;++u<qm.length;){const c=qm[u];rb(this,qm[u],(r&Rp[c])===Rp[c])}}};xf.prototype.defined=!0;function rb(t,s,n){n&&(t[s]=n)}function ql(t){const s={},n={};for(const[r,o]of Object.entries(t.properties)){const u=new xf(r,t.transform(t.attributes||{},r),o,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),s[r]=u,n[zp(r)]=r,n[zp(u.attribute)]=r}return new Cc(s,n,t.space)}const y0=ql({properties:{ariaActiveDescendant:null,ariaAtomic:Nn,ariaAutoComplete:null,ariaBusy:Nn,ariaChecked:Nn,ariaColCount:Ve,ariaColIndex:Ve,ariaColSpan:Ve,ariaControls:Wt,ariaCurrent:null,ariaDescribedBy:Wt,ariaDetails:null,ariaDisabled:Nn,ariaDropEffect:Wt,ariaErrorMessage:null,ariaExpanded:Nn,ariaFlowTo:Wt,ariaGrabbed:Nn,ariaHasPopup:null,ariaHidden:Nn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Wt,ariaLevel:Ve,ariaLive:null,ariaModal:Nn,ariaMultiLine:Nn,ariaMultiSelectable:Nn,ariaOrientation:null,ariaOwns:Wt,ariaPlaceholder:null,ariaPosInSet:Ve,ariaPressed:Nn,ariaReadOnly:Nn,ariaRelevant:null,ariaRequired:Nn,ariaRoleDescription:Wt,ariaRowCount:Ve,ariaRowIndex:Ve,ariaRowSpan:Ve,ariaSelected:Nn,ariaSetSize:Ve,ariaSort:null,ariaValueMax:Ve,ariaValueMin:Ve,ariaValueNow:Ve,ariaValueText:null,role:null},transform(t,s){return s==="role"?s:"aria-"+s.slice(4).toLowerCase()}});function b0(t,s){return s in t?t[s]:s}function j0(t,s){return b0(t,s.toLowerCase())}const RS=ql({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Il,acceptCharset:Wt,accessKey:Wt,action:null,allow:null,allowFullScreen:yt,allowPaymentRequest:yt,allowUserMedia:yt,alt:null,as:null,async:yt,autoCapitalize:null,autoComplete:Wt,autoFocus:yt,autoPlay:yt,blocking:Wt,capture:null,charSet:null,checked:yt,cite:null,className:Wt,cols:Ve,colSpan:null,content:null,contentEditable:Nn,controls:yt,controlsList:Wt,coords:Ve|Il,crossOrigin:null,data:null,dateTime:null,decoding:null,default:yt,defer:yt,dir:null,dirName:null,disabled:yt,download:x0,draggable:Nn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:yt,formTarget:null,headers:Wt,height:Ve,hidden:yt,high:Ve,href:null,hrefLang:null,htmlFor:Wt,httpEquiv:Wt,id:null,imageSizes:null,imageSrcSet:null,inert:yt,inputMode:null,integrity:null,is:null,isMap:yt,itemId:null,itemProp:Wt,itemRef:Wt,itemScope:yt,itemType:Wt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:yt,low:Ve,manifest:null,max:null,maxLength:Ve,media:null,method:null,min:null,minLength:Ve,multiple:yt,muted:yt,name:null,nonce:null,noModule:yt,noValidate:yt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:yt,optimum:Ve,pattern:null,ping:Wt,placeholder:null,playsInline:yt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:yt,referrerPolicy:null,rel:Wt,required:yt,reversed:yt,rows:Ve,rowSpan:Ve,sandbox:Wt,scope:null,scoped:yt,seamless:yt,selected:yt,shadowRootClonable:yt,shadowRootDelegatesFocus:yt,shadowRootMode:null,shape:null,size:Ve,sizes:null,slot:null,span:Ve,spellCheck:Nn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ve,step:null,style:null,tabIndex:Ve,target:null,title:null,translate:null,type:null,typeMustMatch:yt,useMap:null,value:Nn,width:Ve,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Wt,axis:null,background:null,bgColor:null,border:Ve,borderColor:null,bottomMargin:Ve,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:yt,declare:yt,event:null,face:null,frame:null,frameBorder:null,hSpace:Ve,leftMargin:Ve,link:null,longDesc:null,lowSrc:null,marginHeight:Ve,marginWidth:Ve,noResize:yt,noHref:yt,noShade:yt,noWrap:yt,object:null,profile:null,prompt:null,rev:null,rightMargin:Ve,rules:null,scheme:null,scrolling:Nn,standby:null,summary:null,text:null,topMargin:Ve,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ve,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:yt,disableRemotePlayback:yt,prefix:null,property:null,results:Ve,security:null,unselectable:null},space:"html",transform:j0}),LS=ql({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:fa,accentHeight:Ve,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ve,amplitude:Ve,arabicForm:null,ascent:Ve,attributeName:null,attributeType:null,azimuth:Ve,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ve,by:null,calcMode:null,capHeight:Ve,className:Wt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ve,diffuseConstant:Ve,direction:null,display:null,dur:null,divisor:Ve,dominantBaseline:null,download:yt,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ve,enableBackground:null,end:null,event:null,exponent:Ve,externalResourcesRequired:null,fill:null,fillOpacity:Ve,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Il,g2:Il,glyphName:Il,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ve,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ve,horizOriginX:Ve,horizOriginY:Ve,id:null,ideographic:Ve,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ve,k:Ve,k1:Ve,k2:Ve,k3:Ve,k4:Ve,kernelMatrix:fa,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ve,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ve,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ve,overlineThickness:Ve,paintOrder:null,panose1:null,path:null,pathLength:Ve,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Wt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ve,pointsAtY:Ve,pointsAtZ:Ve,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:fa,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:fa,rev:fa,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:fa,requiredFeatures:fa,requiredFonts:fa,requiredFormats:fa,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ve,specularExponent:Ve,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ve,strikethroughThickness:Ve,string:null,stroke:null,strokeDashArray:fa,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ve,strokeOpacity:Ve,strokeWidth:null,style:null,surfaceScale:Ve,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:fa,tabIndex:Ve,tableValues:null,target:null,targetX:Ve,targetY:Ve,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:fa,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ve,underlineThickness:Ve,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ve,values:null,vAlphabetic:Ve,vMathematical:Ve,vectorEffect:null,vHanging:Ve,vIdeographic:Ve,version:null,vertAdvY:Ve,vertOriginX:Ve,vertOriginY:Ve,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ve,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:b0}),v0=ql({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,s){return"xlink:"+s.slice(5).toLowerCase()}}),N0=ql({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:j0}),w0=ql({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,s){return"xml:"+s.slice(3).toLowerCase()}}),$S={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},FS=/[A-Z]/g,lb=/-[a-z]/g,MS=/^data[-\w.:]+$/i;function BS(t,s){const n=zp(s);let r=s,o=sa;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&MS.test(s)){if(s.charAt(4)==="-"){const u=s.slice(5).replace(lb,qS);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=s.slice(4);if(!lb.test(u)){let c=u.replace(FS,US);c.charAt(0)!=="-"&&(c="-"+c),s="data"+c}}o=xf}return new o(r,s)}function US(t){return"-"+t.toLowerCase()}function qS(t){return t.charAt(1).toUpperCase()}const HS=g0([y0,RS,v0,N0,w0],"html"),yf=g0([y0,LS,v0,N0,w0],"svg");function VS(t){return t.join(" ").trim()}var wl={},Hm,ob;function GS(){if(ob)return Hm;ob=1;var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,s=/\n/g,n=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,o=/^:\s*/,u=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,c=/^[;\s]*/,d=/^\s+|\s+$/g,p=`
`,m="/",f="*",g="",x="comment",j="declaration";Hm=function(k,D){if(typeof k!="string")throw new TypeError("First argument must be a string");if(!k)return[];D=D||{};var _=1,T=1;function E($){var J=$.match(s);J&&(_+=J.length);var R=$.lastIndexOf(p);T=~R?$.length-R:T+$.length}function U(){var $={line:_,column:T};return function(J){return J.position=new X($),B(),J}}function X($){this.start=$,this.end={line:_,column:T},this.source=D.source}X.prototype.content=k;function I($){var J=new Error(D.source+":"+_+":"+T+": "+$);if(J.reason=$,J.filename=D.source,J.line=_,J.column=T,J.source=k,!D.silent)throw J}function F($){var J=$.exec(k);if(J){var R=J[0];return E(R),k=k.slice(R.length),J}}function B(){F(n)}function G($){var J;for($=$||[];J=C();)J!==!1&&$.push(J);return $}function C(){var $=U();if(!(m!=k.charAt(0)||f!=k.charAt(1))){for(var J=2;g!=k.charAt(J)&&(f!=k.charAt(J)||m!=k.charAt(J+1));)++J;if(J+=2,g===k.charAt(J-1))return I("End of comment missing");var R=k.slice(2,J-2);return T+=2,E(R),k=k.slice(J),T+=2,$({type:x,comment:R})}}function A(){var $=U(),J=F(r);if(J){if(C(),!F(o))return I("property missing ':'");var R=F(u),L=$({type:j,property:N(J[0].replace(t,g)),value:R?N(R[0].replace(t,g)):g});return F(c),L}}function P(){var $=[];G($);for(var J;J=A();)J!==!1&&($.push(J),G($));return $}return B(),P()};function N(k){return k?k.replace(d,g):g}return Hm}var cb;function QS(){if(cb)return wl;cb=1;var t=wl&&wl.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(wl,"__esModule",{value:!0}),wl.default=n;var s=t(GS());function n(r,o){var u=null;if(!r||typeof r!="string")return u;var c=(0,s.default)(r),d=typeof o=="function";return c.forEach(function(p){if(p.type==="declaration"){var m=p.property,f=p.value;d?o(m,f,p):f&&(u=u||{},u[m]=f)}}),u}return wl}var rc={},ub;function YS(){if(ub)return rc;ub=1,Object.defineProperty(rc,"__esModule",{value:!0}),rc.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,s=/-([a-z])/g,n=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,o=/^-(ms)-/,u=function(m){return!m||n.test(m)||t.test(m)},c=function(m,f){return f.toUpperCase()},d=function(m,f){return"".concat(f,"-")},p=function(m,f){return f===void 0&&(f={}),u(m)?m:(m=m.toLowerCase(),f.reactCompat?m=m.replace(o,d):m=m.replace(r,d),m.replace(s,c))};return rc.camelCase=p,rc}var lc,db;function JS(){if(db)return lc;db=1;var t=lc&&lc.__importDefault||function(o){return o&&o.__esModule?o:{default:o}},s=t(QS()),n=YS();function r(o,u){var c={};return!o||typeof o!="string"||(0,s.default)(o,function(d,p){d&&p&&(c[(0,n.camelCase)(d,u)]=p)}),c}return r.default=r,lc=r,lc}var XS=JS();const KS=Sc(XS),S0=k0("end"),bf=k0("start");function k0(t){return s;function s(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function WS(t){const s=bf(t),n=S0(t);if(s&&n)return{start:s,end:n}}function pc(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?hb(t.position):"start"in t||"end"in t?hb(t):"line"in t||"column"in t?Lp(t):""}function Lp(t){return mb(t&&t.line)+":"+mb(t&&t.column)}function hb(t){return Lp(t&&t.start)+"-"+Lp(t&&t.end)}function mb(t){return t&&typeof t=="number"?t:1}let Fn=class extends Error{constructor(s,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let o="",u={},c=!1;if(n&&("line"in n&&"column"in n?u={place:n}:"start"in n&&"end"in n?u={place:n}:"type"in n?u={ancestors:[n],place:n.position}:u={...n}),typeof s=="string"?o=s:!u.cause&&s&&(c=!0,o=s.message,u.cause=s),!u.ruleId&&!u.source&&typeof r=="string"){const p=r.indexOf(":");p===-1?u.ruleId=r:(u.source=r.slice(0,p),u.ruleId=r.slice(p+1))}if(!u.place&&u.ancestors&&u.ancestors){const p=u.ancestors[u.ancestors.length-1];p&&(u.place=p.position)}const d=u.place&&"start"in u.place?u.place.start:u.place;this.ancestors=u.ancestors||void 0,this.cause=u.cause||void 0,this.column=d?d.column:void 0,this.fatal=void 0,this.file,this.message=o,this.line=d?d.line:void 0,this.name=pc(u.place)||"1:1",this.place=u.place||void 0,this.reason=this.message,this.ruleId=u.ruleId||void 0,this.source=u.source||void 0,this.stack=c&&u.cause&&typeof u.cause.stack=="string"?u.cause.stack:"",this.actual,this.expected,this.note,this.url}};Fn.prototype.file="";Fn.prototype.name="";Fn.prototype.reason="";Fn.prototype.message="";Fn.prototype.stack="";Fn.prototype.column=void 0;Fn.prototype.line=void 0;Fn.prototype.ancestors=void 0;Fn.prototype.cause=void 0;Fn.prototype.fatal=void 0;Fn.prototype.place=void 0;Fn.prototype.ruleId=void 0;Fn.prototype.source=void 0;const jf={}.hasOwnProperty,ZS=new Map,ek=/[A-Z]/g,tk=new Set(["table","tbody","thead","tfoot","tr"]),nk=new Set(["td","th"]),C0="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function ak(t,s){if(!s||s.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=s.filePath||void 0;let r;if(s.development){if(typeof s.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=dk(n,s.jsxDEV)}else{if(typeof s.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof s.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=uk(n,s.jsx,s.jsxs)}const o={Fragment:s.Fragment,ancestors:[],components:s.components||{},create:r,elementAttributeNameCase:s.elementAttributeNameCase||"react",evaluater:s.createEvaluater?s.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:s.ignoreInvalidStyle||!1,passKeys:s.passKeys!==!1,passNode:s.passNode||!1,schema:s.space==="svg"?yf:HS,stylePropertyNameCase:s.stylePropertyNameCase||"dom",tableCellAlignToStyle:s.tableCellAlignToStyle!==!1},u=_0(o,t,void 0);return u&&typeof u!="string"?u:o.create(t,o.Fragment,{children:u||void 0},void 0)}function _0(t,s,n){if(s.type==="element")return sk(t,s,n);if(s.type==="mdxFlowExpression"||s.type==="mdxTextExpression")return ik(t,s);if(s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement")return lk(t,s,n);if(s.type==="mdxjsEsm")return rk(t,s);if(s.type==="root")return ok(t,s,n);if(s.type==="text")return ck(t,s)}function sk(t,s,n){const r=t.schema;let o=r;s.tagName.toLowerCase()==="svg"&&r.space==="html"&&(o=yf,t.schema=o),t.ancestors.push(s);const u=E0(t,s.tagName,!1),c=hk(t,s);let d=Nf(t,s);return tk.has(s.tagName)&&(d=d.filter(function(p){return typeof p=="string"?!OS(p):!0})),D0(t,c,u,s),vf(c,d),t.ancestors.pop(),t.schema=r,t.create(s,u,c,n)}function ik(t,s){if(s.data&&s.data.estree&&t.evaluater){const r=s.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}vc(t,s.position)}function rk(t,s){if(s.data&&s.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(s.data.estree);vc(t,s.position)}function lk(t,s,n){const r=t.schema;let o=r;s.name==="svg"&&r.space==="html"&&(o=yf,t.schema=o),t.ancestors.push(s);const u=s.name===null?t.Fragment:E0(t,s.name,!0),c=mk(t,s),d=Nf(t,s);return D0(t,c,u,s),vf(c,d),t.ancestors.pop(),t.schema=r,t.create(s,u,c,n)}function ok(t,s,n){const r={};return vf(r,Nf(t,s)),t.create(s,t.Fragment,r,n)}function ck(t,s){return s.value}function D0(t,s,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(s.node=r)}function vf(t,s){if(s.length>0){const n=s.length>1?s:s[0];n&&(t.children=n)}}function uk(t,s,n){return r;function r(o,u,c,d){const m=Array.isArray(c.children)?n:s;return d?m(u,c,d):m(u,c)}}function dk(t,s){return n;function n(r,o,u,c){const d=Array.isArray(u.children),p=bf(r);return s(o,u,c,d,{columnNumber:p?p.column-1:void 0,fileName:t,lineNumber:p?p.line:void 0},void 0)}}function hk(t,s){const n={};let r,o;for(o in s.properties)if(o!=="children"&&jf.call(s.properties,o)){const u=pk(t,o,s.properties[o]);if(u){const[c,d]=u;t.tableCellAlignToStyle&&c==="align"&&typeof d=="string"&&nk.has(s.tagName)?r=d:n[c]=d}}if(r){const u=n.style||(n.style={});u[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function mk(t,s){const n={};for(const r of s.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const u=r.data.estree.body[0];u.type;const c=u.expression;c.type;const d=c.properties[0];d.type,Object.assign(n,t.evaluater.evaluateExpression(d.argument))}else vc(t,s.position);else{const o=r.name;let u;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const d=r.value.data.estree.body[0];d.type,u=t.evaluater.evaluateExpression(d.expression)}else vc(t,s.position);else u=r.value===null?!0:r.value;n[o]=u}return n}function Nf(t,s){const n=[];let r=-1;const o=t.passKeys?new Map:ZS;for(;++r<s.children.length;){const u=s.children[r];let c;if(t.passKeys){const p=u.type==="element"?u.tagName:u.type==="mdxJsxFlowElement"||u.type==="mdxJsxTextElement"?u.name:void 0;if(p){const m=o.get(p)||0;c=p+"-"+m,o.set(p,m+1)}}const d=_0(t,u,c);d!==void 0&&n.push(d)}return n}function pk(t,s,n){const r=BS(t.schema,s);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?ES(n):VS(n)),r.property==="style"){let o=typeof n=="object"?n:fk(t,String(n));return t.stylePropertyNameCase==="css"&&(o=gk(o)),["style",o]}return[t.elementAttributeNameCase==="react"&&r.space?$S[r.property]||r.property:r.attribute,n]}}function fk(t,s){try{return KS(s,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,o=new Fn("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw o.file=t.filePath||void 0,o.url=C0+"#cannot-parse-style-attribute",o}}function E0(t,s,n){let r;if(!n)r={type:"Literal",value:s};else if(s.includes(".")){const o=s.split(".");let u=-1,c;for(;++u<o.length;){const d=sb(o[u])?{type:"Identifier",name:o[u]}:{type:"Literal",value:o[u]};c=c?{type:"MemberExpression",object:c,property:d,computed:!!(u&&d.type==="Literal"),optional:!1}:d}r=c}else r=sb(s)&&!/^[a-z]/.test(s)?{type:"Identifier",name:s}:{type:"Literal",value:s};if(r.type==="Literal"){const o=r.value;return jf.call(t.components,o)?t.components[o]:o}if(t.evaluater)return t.evaluater.evaluateExpression(r);vc(t)}function vc(t,s){const n=new Fn("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:s,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=C0+"#cannot-handle-mdx-estrees-without-createevaluater",n}function gk(t){const s={};let n;for(n in t)jf.call(t,n)&&(s[xk(n)]=t[n]);return s}function xk(t){let s=t.replace(ek,yk);return s.slice(0,3)==="ms-"&&(s="-"+s),s}function yk(t){return"-"+t.toLowerCase()}const Vm={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},bk={};function wf(t,s){const n=bk,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,o=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return T0(t,r,o)}function T0(t,s,n){if(jk(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(s&&"alt"in t&&t.alt)return t.alt;if("children"in t)return pb(t.children,s,n)}return Array.isArray(t)?pb(t,s,n):""}function pb(t,s,n){const r=[];let o=-1;for(;++o<t.length;)r[o]=T0(t[o],s,n);return r.join("")}function jk(t){return!!(t&&typeof t=="object")}const fb=document.createElement("i");function Sf(t){const s="&"+t+";";fb.innerHTML=s;const n=fb.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===s?!1:n}function ja(t,s,n,r){const o=t.length;let u=0,c;if(s<0?s=-s>o?0:o+s:s=s>o?o:s,n=n>0?n:0,r.length<1e4)c=Array.from(r),c.unshift(s,n),t.splice(...c);else for(n&&t.splice(s,n);u<r.length;)c=r.slice(u,u+1e4),c.unshift(s,0),t.splice(...c),u+=1e4,s+=1e4}function Aa(t,s){return t.length>0?(ja(t,t.length,0,s),t):s}const gb={}.hasOwnProperty;function A0(t){const s={};let n=-1;for(;++n<t.length;)vk(s,t[n]);return s}function vk(t,s){let n;for(n in s){const o=(gb.call(t,n)?t[n]:void 0)||(t[n]={}),u=s[n];let c;if(u)for(c in u){gb.call(o,c)||(o[c]=[]);const d=u[c];Nk(o[c],Array.isArray(d)?d:d?[d]:[])}}}function Nk(t,s){let n=-1;const r=[];for(;++n<s.length;)(s[n].add==="after"?t:r).push(s[n]);ja(t,0,0,r)}function P0(t,s){const n=Number.parseInt(t,s);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Ha(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Gn=Fi(/[A-Za-z]/),$n=Fi(/[\dA-Za-z]/),wk=Fi(/[#-'*+\--9=?A-Z^-~]/);function Nd(t){return t!==null&&(t<32||t===127)}const $p=Fi(/\d/),Sk=Fi(/[\dA-Fa-f]/),kk=Fi(/[!-/:-@[-`{-~]/);function ct(t){return t!==null&&t<-2}function Jt(t){return t!==null&&(t<0||t===32)}function Tt(t){return t===-2||t===-1||t===32}const zd=Fi(new RegExp("\\p{P}|\\p{S}","u")),Sr=Fi(/\s/);function Fi(t){return s;function s(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Hl(t){const s=[];let n=-1,r=0,o=0;for(;++n<t.length;){const u=t.charCodeAt(n);let c="";if(u===37&&$n(t.charCodeAt(n+1))&&$n(t.charCodeAt(n+2)))o=2;else if(u<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(u))||(c=String.fromCharCode(u));else if(u>55295&&u<57344){const d=t.charCodeAt(n+1);u<56320&&d>56319&&d<57344?(c=String.fromCharCode(u,d),o=1):c=""}else c=String.fromCharCode(u);c&&(s.push(t.slice(r,n),encodeURIComponent(c)),r=n+o+1,c=""),o&&(n+=o,o=0)}return s.join("")+t.slice(r)}function Ot(t,s,n,r){const o=r?r-1:Number.POSITIVE_INFINITY;let u=0;return c;function c(p){return Tt(p)?(t.enter(n),d(p)):s(p)}function d(p){return Tt(p)&&u++<o?(t.consume(p),d):(t.exit(n),s(p))}}const Ck={tokenize:_k};function _k(t){const s=t.attempt(this.parser.constructs.contentInitial,r,o);let n;return s;function r(d){if(d===null){t.consume(d);return}return t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),Ot(t,s,"linePrefix")}function o(d){return t.enter("paragraph"),u(d)}function u(d){const p=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=p),n=p,c(d)}function c(d){if(d===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(d);return}return ct(d)?(t.consume(d),t.exit("chunkText"),u):(t.consume(d),c)}}const Dk={tokenize:Ek},xb={tokenize:Tk};function Ek(t){const s=this,n=[];let r=0,o,u,c;return d;function d(E){if(r<n.length){const U=n[r];return s.containerState=U[1],t.attempt(U[0].continuation,p,m)(E)}return m(E)}function p(E){if(r++,s.containerState._closeFlow){s.containerState._closeFlow=void 0,o&&T();const U=s.events.length;let X=U,I;for(;X--;)if(s.events[X][0]==="exit"&&s.events[X][1].type==="chunkFlow"){I=s.events[X][1].end;break}_(r);let F=U;for(;F<s.events.length;)s.events[F][1].end={...I},F++;return ja(s.events,X+1,0,s.events.slice(U)),s.events.length=F,m(E)}return d(E)}function m(E){if(r===n.length){if(!o)return x(E);if(o.currentConstruct&&o.currentConstruct.concrete)return N(E);s.interrupt=!!(o.currentConstruct&&!o._gfmTableDynamicInterruptHack)}return s.containerState={},t.check(xb,f,g)(E)}function f(E){return o&&T(),_(r),x(E)}function g(E){return s.parser.lazy[s.now().line]=r!==n.length,c=s.now().offset,N(E)}function x(E){return s.containerState={},t.attempt(xb,j,N)(E)}function j(E){return r++,n.push([s.currentConstruct,s.containerState]),x(E)}function N(E){if(E===null){o&&T(),_(0),t.consume(E);return}return o=o||s.parser.flow(s.now()),t.enter("chunkFlow",{_tokenizer:o,contentType:"flow",previous:u}),k(E)}function k(E){if(E===null){D(t.exit("chunkFlow"),!0),_(0),t.consume(E);return}return ct(E)?(t.consume(E),D(t.exit("chunkFlow")),r=0,s.interrupt=void 0,d):(t.consume(E),k)}function D(E,U){const X=s.sliceStream(E);if(U&&X.push(null),E.previous=u,u&&(u.next=E),u=E,o.defineSkip(E.start),o.write(X),s.parser.lazy[E.start.line]){let I=o.events.length;for(;I--;)if(o.events[I][1].start.offset<c&&(!o.events[I][1].end||o.events[I][1].end.offset>c))return;const F=s.events.length;let B=F,G,C;for(;B--;)if(s.events[B][0]==="exit"&&s.events[B][1].type==="chunkFlow"){if(G){C=s.events[B][1].end;break}G=!0}for(_(r),I=F;I<s.events.length;)s.events[I][1].end={...C},I++;ja(s.events,B+1,0,s.events.slice(F)),s.events.length=I}}function _(E){let U=n.length;for(;U-- >E;){const X=n[U];s.containerState=X[1],X[0].exit.call(s,t)}n.length=E}function T(){o.write([null]),u=void 0,o=void 0,s.containerState._closeFlow=void 0}}function Tk(t,s,n){return Ot(t,t.attempt(this.parser.constructs.document,s,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Fl(t){if(t===null||Jt(t)||Sr(t))return 1;if(zd(t))return 2}function Rd(t,s,n){const r=[];let o=-1;for(;++o<t.length;){const u=t[o].resolveAll;u&&!r.includes(u)&&(s=u(s,n),r.push(u))}return s}const Fp={name:"attention",resolveAll:Ak,tokenize:Pk};function Ak(t,s){let n=-1,r,o,u,c,d,p,m,f;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&s.sliceSerialize(t[r][1]).charCodeAt(0)===s.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;p=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const g={...t[r][1].end},x={...t[n][1].start};yb(g,-p),yb(x,p),c={type:p>1?"strongSequence":"emphasisSequence",start:g,end:{...t[r][1].end}},d={type:p>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:x},u={type:p>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},o={type:p>1?"strong":"emphasis",start:{...c.start},end:{...d.end}},t[r][1].end={...c.start},t[n][1].start={...d.end},m=[],t[r][1].end.offset-t[r][1].start.offset&&(m=Aa(m,[["enter",t[r][1],s],["exit",t[r][1],s]])),m=Aa(m,[["enter",o,s],["enter",c,s],["exit",c,s],["enter",u,s]]),m=Aa(m,Rd(s.parser.constructs.insideSpan.null,t.slice(r+1,n),s)),m=Aa(m,[["exit",u,s],["enter",d,s],["exit",d,s],["exit",o,s]]),t[n][1].end.offset-t[n][1].start.offset?(f=2,m=Aa(m,[["enter",t[n][1],s],["exit",t[n][1],s]])):f=0,ja(t,r-1,n-r+3,m),n=r+m.length-f-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function Pk(t,s){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,o=Fl(r);let u;return c;function c(p){return u=p,t.enter("attentionSequence"),d(p)}function d(p){if(p===u)return t.consume(p),d;const m=t.exit("attentionSequence"),f=Fl(p),g=!f||f===2&&o||n.includes(p),x=!o||o===2&&f||n.includes(r);return m._open=!!(u===42?g:g&&(o||!x)),m._close=!!(u===42?x:x&&(f||!g)),s(p)}}function yb(t,s){t.column+=s,t.offset+=s,t._bufferIndex+=s}const Ik={name:"autolink",tokenize:Ok};function Ok(t,s,n){let r=0;return o;function o(j){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),u}function u(j){return Gn(j)?(t.consume(j),c):j===64?n(j):m(j)}function c(j){return j===43||j===45||j===46||$n(j)?(r=1,d(j)):m(j)}function d(j){return j===58?(t.consume(j),r=0,p):(j===43||j===45||j===46||$n(j))&&r++<32?(t.consume(j),d):(r=0,m(j))}function p(j){return j===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.exit("autolink"),s):j===null||j===32||j===60||Nd(j)?n(j):(t.consume(j),p)}function m(j){return j===64?(t.consume(j),f):wk(j)?(t.consume(j),m):n(j)}function f(j){return $n(j)?g(j):n(j)}function g(j){return j===46?(t.consume(j),r=0,f):j===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.exit("autolink"),s):x(j)}function x(j){if((j===45||$n(j))&&r++<63){const N=j===45?x:g;return t.consume(j),N}return n(j)}}const _c={partial:!0,tokenize:zk};function zk(t,s,n){return r;function r(u){return Tt(u)?Ot(t,o,"linePrefix")(u):o(u)}function o(u){return u===null||ct(u)?s(u):n(u)}}const I0={continuation:{tokenize:Lk},exit:$k,name:"blockQuote",tokenize:Rk};function Rk(t,s,n){const r=this;return o;function o(c){if(c===62){const d=r.containerState;return d.open||(t.enter("blockQuote",{_container:!0}),d.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(c),t.exit("blockQuoteMarker"),u}return n(c)}function u(c){return Tt(c)?(t.enter("blockQuotePrefixWhitespace"),t.consume(c),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),s):(t.exit("blockQuotePrefix"),s(c))}}function Lk(t,s,n){const r=this;return o;function o(c){return Tt(c)?Ot(t,u,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(c):u(c)}function u(c){return t.attempt(I0,s,n)(c)}}function $k(t){t.exit("blockQuote")}const O0={name:"characterEscape",tokenize:Fk};function Fk(t,s,n){return r;function r(u){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(u),t.exit("escapeMarker"),o}function o(u){return kk(u)?(t.enter("characterEscapeValue"),t.consume(u),t.exit("characterEscapeValue"),t.exit("characterEscape"),s):n(u)}}const z0={name:"characterReference",tokenize:Mk};function Mk(t,s,n){const r=this;let o=0,u,c;return d;function d(g){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),p}function p(g){return g===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(g),t.exit("characterReferenceMarkerNumeric"),m):(t.enter("characterReferenceValue"),u=31,c=$n,f(g))}function m(g){return g===88||g===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(g),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),u=6,c=Sk,f):(t.enter("characterReferenceValue"),u=7,c=$p,f(g))}function f(g){if(g===59&&o){const x=t.exit("characterReferenceValue");return c===$n&&!Sf(r.sliceSerialize(x))?n(g):(t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),t.exit("characterReference"),s)}return c(g)&&o++<u?(t.consume(g),f):n(g)}}const bb={partial:!0,tokenize:Uk},jb={concrete:!0,name:"codeFenced",tokenize:Bk};function Bk(t,s,n){const r=this,o={partial:!0,tokenize:X};let u=0,c=0,d;return p;function p(I){return m(I)}function m(I){const F=r.events[r.events.length-1];return u=F&&F[1].type==="linePrefix"?F[2].sliceSerialize(F[1],!0).length:0,d=I,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),f(I)}function f(I){return I===d?(c++,t.consume(I),f):c<3?n(I):(t.exit("codeFencedFenceSequence"),Tt(I)?Ot(t,g,"whitespace")(I):g(I))}function g(I){return I===null||ct(I)?(t.exit("codeFencedFence"),r.interrupt?s(I):t.check(bb,k,U)(I)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),x(I))}function x(I){return I===null||ct(I)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),g(I)):Tt(I)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Ot(t,j,"whitespace")(I)):I===96&&I===d?n(I):(t.consume(I),x)}function j(I){return I===null||ct(I)?g(I):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),N(I))}function N(I){return I===null||ct(I)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),g(I)):I===96&&I===d?n(I):(t.consume(I),N)}function k(I){return t.attempt(o,U,D)(I)}function D(I){return t.enter("lineEnding"),t.consume(I),t.exit("lineEnding"),_}function _(I){return u>0&&Tt(I)?Ot(t,T,"linePrefix",u+1)(I):T(I)}function T(I){return I===null||ct(I)?t.check(bb,k,U)(I):(t.enter("codeFlowValue"),E(I))}function E(I){return I===null||ct(I)?(t.exit("codeFlowValue"),T(I)):(t.consume(I),E)}function U(I){return t.exit("codeFenced"),s(I)}function X(I,F,B){let G=0;return C;function C(R){return I.enter("lineEnding"),I.consume(R),I.exit("lineEnding"),A}function A(R){return I.enter("codeFencedFence"),Tt(R)?Ot(I,P,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(R):P(R)}function P(R){return R===d?(I.enter("codeFencedFenceSequence"),$(R)):B(R)}function $(R){return R===d?(G++,I.consume(R),$):G>=c?(I.exit("codeFencedFenceSequence"),Tt(R)?Ot(I,J,"whitespace")(R):J(R)):B(R)}function J(R){return R===null||ct(R)?(I.exit("codeFencedFence"),F(R)):B(R)}}}function Uk(t,s,n){const r=this;return o;function o(c){return c===null?n(c):(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),u)}function u(c){return r.parser.lazy[r.now().line]?n(c):s(c)}}const Gm={name:"codeIndented",tokenize:Hk},qk={partial:!0,tokenize:Vk};function Hk(t,s,n){const r=this;return o;function o(m){return t.enter("codeIndented"),Ot(t,u,"linePrefix",5)(m)}function u(m){const f=r.events[r.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?c(m):n(m)}function c(m){return m===null?p(m):ct(m)?t.attempt(qk,c,p)(m):(t.enter("codeFlowValue"),d(m))}function d(m){return m===null||ct(m)?(t.exit("codeFlowValue"),c(m)):(t.consume(m),d)}function p(m){return t.exit("codeIndented"),s(m)}}function Vk(t,s,n){const r=this;return o;function o(c){return r.parser.lazy[r.now().line]?n(c):ct(c)?(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),o):Ot(t,u,"linePrefix",5)(c)}function u(c){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):ct(c)?o(c):n(c)}}const Gk={name:"codeText",previous:Yk,resolve:Qk,tokenize:Jk};function Qk(t){let s=t.length-4,n=3,r,o;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[s][1].type==="lineEnding"||t[s][1].type==="space")){for(r=n;++r<s;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[s][1].type="codeTextPadding",n+=2,s-=2;break}}for(r=n-1,s++;++r<=s;)o===void 0?r!==s&&t[r][1].type!=="lineEnding"&&(o=r):(r===s||t[r][1].type==="lineEnding")&&(t[o][1].type="codeTextData",r!==o+2&&(t[o][1].end=t[r-1][1].end,t.splice(o+2,r-o-2),s-=r-o-2,r=o+2),o=void 0);return t}function Yk(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function Jk(t,s,n){let r=0,o,u;return c;function c(g){return t.enter("codeText"),t.enter("codeTextSequence"),d(g)}function d(g){return g===96?(t.consume(g),r++,d):(t.exit("codeTextSequence"),p(g))}function p(g){return g===null?n(g):g===32?(t.enter("space"),t.consume(g),t.exit("space"),p):g===96?(u=t.enter("codeTextSequence"),o=0,f(g)):ct(g)?(t.enter("lineEnding"),t.consume(g),t.exit("lineEnding"),p):(t.enter("codeTextData"),m(g))}function m(g){return g===null||g===32||g===96||ct(g)?(t.exit("codeTextData"),p(g)):(t.consume(g),m)}function f(g){return g===96?(t.consume(g),o++,f):o===r?(t.exit("codeTextSequence"),t.exit("codeText"),s(g)):(u.type="codeTextData",m(g))}}let Xk=class{constructor(s){this.left=s?[...s]:[],this.right=[]}get(s){if(s<0||s>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+s+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return s<this.left.length?this.left[s]:this.right[this.right.length-s+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(s,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(s,r):s>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-s+this.left.length).reverse():this.left.slice(s).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(s,n,r){const o=n||0;this.setCursor(Math.trunc(s));const u=this.right.splice(this.right.length-o,Number.POSITIVE_INFINITY);return r&&oc(this.left,r),u.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(s){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(s)}pushMany(s){this.setCursor(Number.POSITIVE_INFINITY),oc(this.left,s)}unshift(s){this.setCursor(0),this.right.push(s)}unshiftMany(s){this.setCursor(0),oc(this.right,s.reverse())}setCursor(s){if(!(s===this.left.length||s>this.left.length&&this.right.length===0||s<0&&this.left.length===0))if(s<this.left.length){const n=this.left.splice(s,Number.POSITIVE_INFINITY);oc(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-s,Number.POSITIVE_INFINITY);oc(this.left,n.reverse())}}};function oc(t,s){let n=0;if(s.length<1e4)t.push(...s);else for(;n<s.length;)t.push(...s.slice(n,n+1e4)),n+=1e4}function R0(t){const s={};let n=-1,r,o,u,c,d,p,m;const f=new Xk(t);for(;++n<f.length;){for(;n in s;)n=s[n];if(r=f.get(n),n&&r[1].type==="chunkFlow"&&f.get(n-1)[1].type==="listItemPrefix"&&(p=r[1]._tokenizer.events,u=0,u<p.length&&p[u][1].type==="lineEndingBlank"&&(u+=2),u<p.length&&p[u][1].type==="content"))for(;++u<p.length&&p[u][1].type!=="content";)p[u][1].type==="chunkText"&&(p[u][1]._isInFirstContentOfListItem=!0,u++);if(r[0]==="enter")r[1].contentType&&(Object.assign(s,Kk(f,n)),n=s[n],m=!0);else if(r[1]._container){for(u=n,o=void 0;u--;)if(c=f.get(u),c[1].type==="lineEnding"||c[1].type==="lineEndingBlank")c[0]==="enter"&&(o&&(f.get(o)[1].type="lineEndingBlank"),c[1].type="lineEnding",o=u);else if(!(c[1].type==="linePrefix"||c[1].type==="listItemIndent"))break;o&&(r[1].end={...f.get(o)[1].start},d=f.slice(o,n),d.unshift(r),f.splice(o,n-o+1,d))}}return ja(t,0,Number.POSITIVE_INFINITY,f.slice(0)),!m}function Kk(t,s){const n=t.get(s)[1],r=t.get(s)[2];let o=s-1;const u=[];let c=n._tokenizer;c||(c=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(c._contentTypeTextTrailing=!0));const d=c.events,p=[],m={};let f,g,x=-1,j=n,N=0,k=0;const D=[k];for(;j;){for(;t.get(++o)[1]!==j;);u.push(o),j._tokenizer||(f=r.sliceStream(j),j.next||f.push(null),g&&c.defineSkip(j.start),j._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=!0),c.write(f),j._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=void 0)),g=j,j=j.next}for(j=n;++x<d.length;)d[x][0]==="exit"&&d[x-1][0]==="enter"&&d[x][1].type===d[x-1][1].type&&d[x][1].start.line!==d[x][1].end.line&&(k=x+1,D.push(k),j._tokenizer=void 0,j.previous=void 0,j=j.next);for(c.events=[],j?(j._tokenizer=void 0,j.previous=void 0):D.pop(),x=D.length;x--;){const _=d.slice(D[x],D[x+1]),T=u.pop();p.push([T,T+_.length-1]),t.splice(T,2,_)}for(p.reverse(),x=-1;++x<p.length;)m[N+p[x][0]]=N+p[x][1],N+=p[x][1]-p[x][0]-1;return m}const Wk={resolve:eC,tokenize:tC},Zk={partial:!0,tokenize:nC};function eC(t){return R0(t),t}function tC(t,s){let n;return r;function r(d){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),o(d)}function o(d){return d===null?u(d):ct(d)?t.check(Zk,c,u)(d):(t.consume(d),o)}function u(d){return t.exit("chunkContent"),t.exit("content"),s(d)}function c(d){return t.consume(d),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,o}}function nC(t,s,n){const r=this;return o;function o(c){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),Ot(t,u,"linePrefix")}function u(c){if(c===null||ct(c))return n(c);const d=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):t.interrupt(r.parser.constructs.flow,n,s)(c)}}function L0(t,s,n,r,o,u,c,d,p){const m=p||Number.POSITIVE_INFINITY;let f=0;return g;function g(_){return _===60?(t.enter(r),t.enter(o),t.enter(u),t.consume(_),t.exit(u),x):_===null||_===32||_===41||Nd(_)?n(_):(t.enter(r),t.enter(c),t.enter(d),t.enter("chunkString",{contentType:"string"}),k(_))}function x(_){return _===62?(t.enter(u),t.consume(_),t.exit(u),t.exit(o),t.exit(r),s):(t.enter(d),t.enter("chunkString",{contentType:"string"}),j(_))}function j(_){return _===62?(t.exit("chunkString"),t.exit(d),x(_)):_===null||_===60||ct(_)?n(_):(t.consume(_),_===92?N:j)}function N(_){return _===60||_===62||_===92?(t.consume(_),j):j(_)}function k(_){return!f&&(_===null||_===41||Jt(_))?(t.exit("chunkString"),t.exit(d),t.exit(c),t.exit(r),s(_)):f<m&&_===40?(t.consume(_),f++,k):_===41?(t.consume(_),f--,k):_===null||_===32||_===40||Nd(_)?n(_):(t.consume(_),_===92?D:k)}function D(_){return _===40||_===41||_===92?(t.consume(_),k):k(_)}}function $0(t,s,n,r,o,u){const c=this;let d=0,p;return m;function m(j){return t.enter(r),t.enter(o),t.consume(j),t.exit(o),t.enter(u),f}function f(j){return d>999||j===null||j===91||j===93&&!p||j===94&&!d&&"_hiddenFootnoteSupport"in c.parser.constructs?n(j):j===93?(t.exit(u),t.enter(o),t.consume(j),t.exit(o),t.exit(r),s):ct(j)?(t.enter("lineEnding"),t.consume(j),t.exit("lineEnding"),f):(t.enter("chunkString",{contentType:"string"}),g(j))}function g(j){return j===null||j===91||j===93||ct(j)||d++>999?(t.exit("chunkString"),f(j)):(t.consume(j),p||(p=!Tt(j)),j===92?x:g)}function x(j){return j===91||j===92||j===93?(t.consume(j),d++,g):g(j)}}function F0(t,s,n,r,o,u){let c;return d;function d(x){return x===34||x===39||x===40?(t.enter(r),t.enter(o),t.consume(x),t.exit(o),c=x===40?41:x,p):n(x)}function p(x){return x===c?(t.enter(o),t.consume(x),t.exit(o),t.exit(r),s):(t.enter(u),m(x))}function m(x){return x===c?(t.exit(u),p(c)):x===null?n(x):ct(x)?(t.enter("lineEnding"),t.consume(x),t.exit("lineEnding"),Ot(t,m,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===c||x===null||ct(x)?(t.exit("chunkString"),m(x)):(t.consume(x),x===92?g:f)}function g(x){return x===c||x===92?(t.consume(x),f):f(x)}}function fc(t,s){let n;return r;function r(o){return ct(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),n=!0,r):Tt(o)?Ot(t,r,n?"linePrefix":"lineSuffix")(o):s(o)}}const aC={name:"definition",tokenize:iC},sC={partial:!0,tokenize:rC};function iC(t,s,n){const r=this;let o;return u;function u(j){return t.enter("definition"),c(j)}function c(j){return $0.call(r,t,d,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(j)}function d(j){return o=Ha(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),j===58?(t.enter("definitionMarker"),t.consume(j),t.exit("definitionMarker"),p):n(j)}function p(j){return Jt(j)?fc(t,m)(j):m(j)}function m(j){return L0(t,f,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(j)}function f(j){return t.attempt(sC,g,g)(j)}function g(j){return Tt(j)?Ot(t,x,"whitespace")(j):x(j)}function x(j){return j===null||ct(j)?(t.exit("definition"),r.parser.defined.push(o),s(j)):n(j)}}function rC(t,s,n){return r;function r(d){return Jt(d)?fc(t,o)(d):n(d)}function o(d){return F0(t,u,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(d)}function u(d){return Tt(d)?Ot(t,c,"whitespace")(d):c(d)}function c(d){return d===null||ct(d)?s(d):n(d)}}const lC={name:"hardBreakEscape",tokenize:oC};function oC(t,s,n){return r;function r(u){return t.enter("hardBreakEscape"),t.consume(u),o}function o(u){return ct(u)?(t.exit("hardBreakEscape"),s(u)):n(u)}}const cC={name:"headingAtx",resolve:uC,tokenize:dC};function uC(t,s){let n=t.length-2,r=3,o,u;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(o={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},u={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},ja(t,r,n-r+1,[["enter",o,s],["enter",u,s],["exit",u,s],["exit",o,s]])),t}function dC(t,s,n){let r=0;return o;function o(f){return t.enter("atxHeading"),u(f)}function u(f){return t.enter("atxHeadingSequence"),c(f)}function c(f){return f===35&&r++<6?(t.consume(f),c):f===null||Jt(f)?(t.exit("atxHeadingSequence"),d(f)):n(f)}function d(f){return f===35?(t.enter("atxHeadingSequence"),p(f)):f===null||ct(f)?(t.exit("atxHeading"),s(f)):Tt(f)?Ot(t,d,"whitespace")(f):(t.enter("atxHeadingText"),m(f))}function p(f){return f===35?(t.consume(f),p):(t.exit("atxHeadingSequence"),d(f))}function m(f){return f===null||f===35||Jt(f)?(t.exit("atxHeadingText"),d(f)):(t.consume(f),m)}}const hC=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],vb=["pre","script","style","textarea"],mC={concrete:!0,name:"htmlFlow",resolveTo:gC,tokenize:xC},pC={partial:!0,tokenize:bC},fC={partial:!0,tokenize:yC};function gC(t){let s=t.length;for(;s--&&!(t[s][0]==="enter"&&t[s][1].type==="htmlFlow"););return s>1&&t[s-2][1].type==="linePrefix"&&(t[s][1].start=t[s-2][1].start,t[s+1][1].start=t[s-2][1].start,t.splice(s-2,2)),t}function xC(t,s,n){const r=this;let o,u,c,d,p;return m;function m(w){return f(w)}function f(w){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(w),g}function g(w){return w===33?(t.consume(w),x):w===47?(t.consume(w),u=!0,k):w===63?(t.consume(w),o=3,r.interrupt?s:S):Gn(w)?(t.consume(w),c=String.fromCharCode(w),D):n(w)}function x(w){return w===45?(t.consume(w),o=2,j):w===91?(t.consume(w),o=5,d=0,N):Gn(w)?(t.consume(w),o=4,r.interrupt?s:S):n(w)}function j(w){return w===45?(t.consume(w),r.interrupt?s:S):n(w)}function N(w){const ue="CDATA[";return w===ue.charCodeAt(d++)?(t.consume(w),d===ue.length?r.interrupt?s:P:N):n(w)}function k(w){return Gn(w)?(t.consume(w),c=String.fromCharCode(w),D):n(w)}function D(w){if(w===null||w===47||w===62||Jt(w)){const ue=w===47,Ne=c.toLowerCase();return!ue&&!u&&vb.includes(Ne)?(o=1,r.interrupt?s(w):P(w)):hC.includes(c.toLowerCase())?(o=6,ue?(t.consume(w),_):r.interrupt?s(w):P(w)):(o=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(w):u?T(w):E(w))}return w===45||$n(w)?(t.consume(w),c+=String.fromCharCode(w),D):n(w)}function _(w){return w===62?(t.consume(w),r.interrupt?s:P):n(w)}function T(w){return Tt(w)?(t.consume(w),T):C(w)}function E(w){return w===47?(t.consume(w),C):w===58||w===95||Gn(w)?(t.consume(w),U):Tt(w)?(t.consume(w),E):C(w)}function U(w){return w===45||w===46||w===58||w===95||$n(w)?(t.consume(w),U):X(w)}function X(w){return w===61?(t.consume(w),I):Tt(w)?(t.consume(w),X):E(w)}function I(w){return w===null||w===60||w===61||w===62||w===96?n(w):w===34||w===39?(t.consume(w),p=w,F):Tt(w)?(t.consume(w),I):B(w)}function F(w){return w===p?(t.consume(w),p=null,G):w===null||ct(w)?n(w):(t.consume(w),F)}function B(w){return w===null||w===34||w===39||w===47||w===60||w===61||w===62||w===96||Jt(w)?X(w):(t.consume(w),B)}function G(w){return w===47||w===62||Tt(w)?E(w):n(w)}function C(w){return w===62?(t.consume(w),A):n(w)}function A(w){return w===null||ct(w)?P(w):Tt(w)?(t.consume(w),A):n(w)}function P(w){return w===45&&o===2?(t.consume(w),L):w===60&&o===1?(t.consume(w),M):w===62&&o===4?(t.consume(w),ge):w===63&&o===3?(t.consume(w),S):w===93&&o===5?(t.consume(w),Q):ct(w)&&(o===6||o===7)?(t.exit("htmlFlowData"),t.check(pC,fe,$)(w)):w===null||ct(w)?(t.exit("htmlFlowData"),$(w)):(t.consume(w),P)}function $(w){return t.check(fC,J,fe)(w)}function J(w){return t.enter("lineEnding"),t.consume(w),t.exit("lineEnding"),R}function R(w){return w===null||ct(w)?$(w):(t.enter("htmlFlowData"),P(w))}function L(w){return w===45?(t.consume(w),S):P(w)}function M(w){return w===47?(t.consume(w),c="",Z):P(w)}function Z(w){if(w===62){const ue=c.toLowerCase();return vb.includes(ue)?(t.consume(w),ge):P(w)}return Gn(w)&&c.length<8?(t.consume(w),c+=String.fromCharCode(w),Z):P(w)}function Q(w){return w===93?(t.consume(w),S):P(w)}function S(w){return w===62?(t.consume(w),ge):w===45&&o===2?(t.consume(w),S):P(w)}function ge(w){return w===null||ct(w)?(t.exit("htmlFlowData"),fe(w)):(t.consume(w),ge)}function fe(w){return t.exit("htmlFlow"),s(w)}}function yC(t,s,n){const r=this;return o;function o(c){return ct(c)?(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),u):n(c)}function u(c){return r.parser.lazy[r.now().line]?n(c):s(c)}}function bC(t,s,n){return r;function r(o){return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),t.attempt(_c,s,n)}}const jC={name:"htmlText",tokenize:vC};function vC(t,s,n){const r=this;let o,u,c;return d;function d(S){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(S),p}function p(S){return S===33?(t.consume(S),m):S===47?(t.consume(S),X):S===63?(t.consume(S),E):Gn(S)?(t.consume(S),B):n(S)}function m(S){return S===45?(t.consume(S),f):S===91?(t.consume(S),u=0,N):Gn(S)?(t.consume(S),T):n(S)}function f(S){return S===45?(t.consume(S),j):n(S)}function g(S){return S===null?n(S):S===45?(t.consume(S),x):ct(S)?(c=g,M(S)):(t.consume(S),g)}function x(S){return S===45?(t.consume(S),j):g(S)}function j(S){return S===62?L(S):S===45?x(S):g(S)}function N(S){const ge="CDATA[";return S===ge.charCodeAt(u++)?(t.consume(S),u===ge.length?k:N):n(S)}function k(S){return S===null?n(S):S===93?(t.consume(S),D):ct(S)?(c=k,M(S)):(t.consume(S),k)}function D(S){return S===93?(t.consume(S),_):k(S)}function _(S){return S===62?L(S):S===93?(t.consume(S),_):k(S)}function T(S){return S===null||S===62?L(S):ct(S)?(c=T,M(S)):(t.consume(S),T)}function E(S){return S===null?n(S):S===63?(t.consume(S),U):ct(S)?(c=E,M(S)):(t.consume(S),E)}function U(S){return S===62?L(S):E(S)}function X(S){return Gn(S)?(t.consume(S),I):n(S)}function I(S){return S===45||$n(S)?(t.consume(S),I):F(S)}function F(S){return ct(S)?(c=F,M(S)):Tt(S)?(t.consume(S),F):L(S)}function B(S){return S===45||$n(S)?(t.consume(S),B):S===47||S===62||Jt(S)?G(S):n(S)}function G(S){return S===47?(t.consume(S),L):S===58||S===95||Gn(S)?(t.consume(S),C):ct(S)?(c=G,M(S)):Tt(S)?(t.consume(S),G):L(S)}function C(S){return S===45||S===46||S===58||S===95||$n(S)?(t.consume(S),C):A(S)}function A(S){return S===61?(t.consume(S),P):ct(S)?(c=A,M(S)):Tt(S)?(t.consume(S),A):G(S)}function P(S){return S===null||S===60||S===61||S===62||S===96?n(S):S===34||S===39?(t.consume(S),o=S,$):ct(S)?(c=P,M(S)):Tt(S)?(t.consume(S),P):(t.consume(S),J)}function $(S){return S===o?(t.consume(S),o=void 0,R):S===null?n(S):ct(S)?(c=$,M(S)):(t.consume(S),$)}function J(S){return S===null||S===34||S===39||S===60||S===61||S===96?n(S):S===47||S===62||Jt(S)?G(S):(t.consume(S),J)}function R(S){return S===47||S===62||Jt(S)?G(S):n(S)}function L(S){return S===62?(t.consume(S),t.exit("htmlTextData"),t.exit("htmlText"),s):n(S)}function M(S){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(S),t.exit("lineEnding"),Z}function Z(S){return Tt(S)?Ot(t,Q,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(S):Q(S)}function Q(S){return t.enter("htmlTextData"),c(S)}}const kf={name:"labelEnd",resolveAll:kC,resolveTo:CC,tokenize:_C},NC={tokenize:DC},wC={tokenize:EC},SC={tokenize:TC};function kC(t){let s=-1;const n=[];for(;++s<t.length;){const r=t[s][1];if(n.push(t[s]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const o=r.type==="labelImage"?4:2;r.type="data",s+=o}}return t.length!==n.length&&ja(t,0,t.length,n),t}function CC(t,s){let n=t.length,r=0,o,u,c,d;for(;n--;)if(o=t[n][1],u){if(o.type==="link"||o.type==="labelLink"&&o._inactive)break;t[n][0]==="enter"&&o.type==="labelLink"&&(o._inactive=!0)}else if(c){if(t[n][0]==="enter"&&(o.type==="labelImage"||o.type==="labelLink")&&!o._balanced&&(u=n,o.type!=="labelLink")){r=2;break}}else o.type==="labelEnd"&&(c=n);const p={type:t[u][1].type==="labelLink"?"link":"image",start:{...t[u][1].start},end:{...t[t.length-1][1].end}},m={type:"label",start:{...t[u][1].start},end:{...t[c][1].end}},f={type:"labelText",start:{...t[u+r+2][1].end},end:{...t[c-2][1].start}};return d=[["enter",p,s],["enter",m,s]],d=Aa(d,t.slice(u+1,u+r+3)),d=Aa(d,[["enter",f,s]]),d=Aa(d,Rd(s.parser.constructs.insideSpan.null,t.slice(u+r+4,c-3),s)),d=Aa(d,[["exit",f,s],t[c-2],t[c-1],["exit",m,s]]),d=Aa(d,t.slice(c+1)),d=Aa(d,[["exit",p,s]]),ja(t,u,t.length,d),t}function _C(t,s,n){const r=this;let o=r.events.length,u,c;for(;o--;)if((r.events[o][1].type==="labelImage"||r.events[o][1].type==="labelLink")&&!r.events[o][1]._balanced){u=r.events[o][1];break}return d;function d(x){return u?u._inactive?g(x):(c=r.parser.defined.includes(Ha(r.sliceSerialize({start:u.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(x),t.exit("labelMarker"),t.exit("labelEnd"),p):n(x)}function p(x){return x===40?t.attempt(NC,f,c?f:g)(x):x===91?t.attempt(wC,f,c?m:g)(x):c?f(x):g(x)}function m(x){return t.attempt(SC,f,g)(x)}function f(x){return s(x)}function g(x){return u._balanced=!0,n(x)}}function DC(t,s,n){return r;function r(g){return t.enter("resource"),t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),o}function o(g){return Jt(g)?fc(t,u)(g):u(g)}function u(g){return g===41?f(g):L0(t,c,d,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function c(g){return Jt(g)?fc(t,p)(g):f(g)}function d(g){return n(g)}function p(g){return g===34||g===39||g===40?F0(t,m,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function m(g){return Jt(g)?fc(t,f)(g):f(g)}function f(g){return g===41?(t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),t.exit("resource"),s):n(g)}}function EC(t,s,n){const r=this;return o;function o(d){return $0.call(r,t,u,c,"reference","referenceMarker","referenceString")(d)}function u(d){return r.parser.defined.includes(Ha(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?s(d):n(d)}function c(d){return n(d)}}function TC(t,s,n){return r;function r(u){return t.enter("reference"),t.enter("referenceMarker"),t.consume(u),t.exit("referenceMarker"),o}function o(u){return u===93?(t.enter("referenceMarker"),t.consume(u),t.exit("referenceMarker"),t.exit("reference"),s):n(u)}}const AC={name:"labelStartImage",resolveAll:kf.resolveAll,tokenize:PC};function PC(t,s,n){const r=this;return o;function o(d){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(d),t.exit("labelImageMarker"),u}function u(d){return d===91?(t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelImage"),c):n(d)}function c(d){return d===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(d):s(d)}}const IC={name:"labelStartLink",resolveAll:kf.resolveAll,tokenize:OC};function OC(t,s,n){const r=this;return o;function o(c){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(c),t.exit("labelMarker"),t.exit("labelLink"),u}function u(c){return c===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(c):s(c)}}const Qm={name:"lineEnding",tokenize:zC};function zC(t,s){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Ot(t,s,"linePrefix")}}const gd={name:"thematicBreak",tokenize:RC};function RC(t,s,n){let r=0,o;return u;function u(m){return t.enter("thematicBreak"),c(m)}function c(m){return o=m,d(m)}function d(m){return m===o?(t.enter("thematicBreakSequence"),p(m)):r>=3&&(m===null||ct(m))?(t.exit("thematicBreak"),s(m)):n(m)}function p(m){return m===o?(t.consume(m),r++,p):(t.exit("thematicBreakSequence"),Tt(m)?Ot(t,d,"whitespace")(m):d(m))}}const ea={continuation:{tokenize:MC},exit:UC,name:"list",tokenize:FC},LC={partial:!0,tokenize:qC},$C={partial:!0,tokenize:BC};function FC(t,s,n){const r=this,o=r.events[r.events.length-1];let u=o&&o[1].type==="linePrefix"?o[2].sliceSerialize(o[1],!0).length:0,c=0;return d;function d(j){const N=r.containerState.type||(j===42||j===43||j===45?"listUnordered":"listOrdered");if(N==="listUnordered"?!r.containerState.marker||j===r.containerState.marker:$p(j)){if(r.containerState.type||(r.containerState.type=N,t.enter(N,{_container:!0})),N==="listUnordered")return t.enter("listItemPrefix"),j===42||j===45?t.check(gd,n,m)(j):m(j);if(!r.interrupt||j===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),p(j)}return n(j)}function p(j){return $p(j)&&++c<10?(t.consume(j),p):(!r.interrupt||c<2)&&(r.containerState.marker?j===r.containerState.marker:j===41||j===46)?(t.exit("listItemValue"),m(j)):n(j)}function m(j){return t.enter("listItemMarker"),t.consume(j),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||j,t.check(_c,r.interrupt?n:f,t.attempt(LC,x,g))}function f(j){return r.containerState.initialBlankLine=!0,u++,x(j)}function g(j){return Tt(j)?(t.enter("listItemPrefixWhitespace"),t.consume(j),t.exit("listItemPrefixWhitespace"),x):n(j)}function x(j){return r.containerState.size=u+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,s(j)}}function MC(t,s,n){const r=this;return r.containerState._closeFlow=void 0,t.check(_c,o,u);function o(d){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Ot(t,s,"listItemIndent",r.containerState.size+1)(d)}function u(d){return r.containerState.furtherBlankLines||!Tt(d)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,c(d)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt($C,s,c)(d))}function c(d){return r.containerState._closeFlow=!0,r.interrupt=void 0,Ot(t,t.attempt(ea,s,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(d)}}function BC(t,s,n){const r=this;return Ot(t,o,"listItemIndent",r.containerState.size+1);function o(u){const c=r.events[r.events.length-1];return c&&c[1].type==="listItemIndent"&&c[2].sliceSerialize(c[1],!0).length===r.containerState.size?s(u):n(u)}}function UC(t){t.exit(this.containerState.type)}function qC(t,s,n){const r=this;return Ot(t,o,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function o(u){const c=r.events[r.events.length-1];return!Tt(u)&&c&&c[1].type==="listItemPrefixWhitespace"?s(u):n(u)}}const Nb={name:"setextUnderline",resolveTo:HC,tokenize:VC};function HC(t,s){let n=t.length,r,o,u;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(o=n)}else t[n][1].type==="content"&&t.splice(n,1),!u&&t[n][1].type==="definition"&&(u=n);const c={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[o][1].type="setextHeadingText",u?(t.splice(o,0,["enter",c,s]),t.splice(u+1,0,["exit",t[r][1],s]),t[r][1].end={...t[u][1].end}):t[r][1]=c,t.push(["exit",c,s]),t}function VC(t,s,n){const r=this;let o;return u;function u(m){let f=r.events.length,g;for(;f--;)if(r.events[f][1].type!=="lineEnding"&&r.events[f][1].type!=="linePrefix"&&r.events[f][1].type!=="content"){g=r.events[f][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||g)?(t.enter("setextHeadingLine"),o=m,c(m)):n(m)}function c(m){return t.enter("setextHeadingLineSequence"),d(m)}function d(m){return m===o?(t.consume(m),d):(t.exit("setextHeadingLineSequence"),Tt(m)?Ot(t,p,"lineSuffix")(m):p(m))}function p(m){return m===null||ct(m)?(t.exit("setextHeadingLine"),s(m)):n(m)}}const GC={tokenize:QC};function QC(t){const s=this,n=t.attempt(_c,r,t.attempt(this.parser.constructs.flowInitial,o,Ot(t,t.attempt(this.parser.constructs.flow,o,t.attempt(Wk,o)),"linePrefix")));return n;function r(u){if(u===null){t.consume(u);return}return t.enter("lineEndingBlank"),t.consume(u),t.exit("lineEndingBlank"),s.currentConstruct=void 0,n}function o(u){if(u===null){t.consume(u);return}return t.enter("lineEnding"),t.consume(u),t.exit("lineEnding"),s.currentConstruct=void 0,n}}const YC={resolveAll:B0()},JC=M0("string"),XC=M0("text");function M0(t){return{resolveAll:B0(t==="text"?KC:void 0),tokenize:s};function s(n){const r=this,o=this.parser.constructs[t],u=n.attempt(o,c,d);return c;function c(f){return m(f)?u(f):d(f)}function d(f){if(f===null){n.consume(f);return}return n.enter("data"),n.consume(f),p}function p(f){return m(f)?(n.exit("data"),u(f)):(n.consume(f),p)}function m(f){if(f===null)return!0;const g=o[f];let x=-1;if(g)for(;++x<g.length;){const j=g[x];if(!j.previous||j.previous.call(r,r.previous))return!0}return!1}}}function B0(t){return s;function s(n,r){let o=-1,u;for(;++o<=n.length;)u===void 0?n[o]&&n[o][1].type==="data"&&(u=o,o++):(!n[o]||n[o][1].type!=="data")&&(o!==u+2&&(n[u][1].end=n[o-1][1].end,n.splice(u+2,o-u-2),o=u+2),u=void 0);return t?t(n,r):n}}function KC(t,s){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],o=s.sliceStream(r);let u=o.length,c=-1,d=0,p;for(;u--;){const m=o[u];if(typeof m=="string"){for(c=m.length;m.charCodeAt(c-1)===32;)d++,c--;if(c)break;c=-1}else if(m===-2)p=!0,d++;else if(m!==-1){u++;break}}if(s._contentTypeTextTrailing&&n===t.length&&(d=0),d){const m={type:n===t.length||p||d<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:u?c:r.start._bufferIndex+c,_index:r.start._index+u,line:r.end.line,column:r.end.column-d,offset:r.end.offset-d},end:{...r.end}};r.end={...m.start},r.start.offset===r.end.offset?Object.assign(r,m):(t.splice(n,0,["enter",m,s],["exit",m,s]),n+=2)}n++}return t}const WC={42:ea,43:ea,45:ea,48:ea,49:ea,50:ea,51:ea,52:ea,53:ea,54:ea,55:ea,56:ea,57:ea,62:I0},ZC={91:aC},e_={[-2]:Gm,[-1]:Gm,32:Gm},t_={35:cC,42:gd,45:[Nb,gd],60:mC,61:Nb,95:gd,96:jb,126:jb},n_={38:z0,92:O0},a_={[-5]:Qm,[-4]:Qm,[-3]:Qm,33:AC,38:z0,42:Fp,60:[Ik,jC],91:IC,92:[lC,O0],93:kf,95:Fp,96:Gk},s_={null:[Fp,YC]},i_={null:[42,95]},r_={null:[]},l_=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:i_,contentInitial:ZC,disable:r_,document:WC,flow:t_,flowInitial:e_,insideSpan:s_,string:n_,text:a_},Symbol.toStringTag,{value:"Module"}));function o_(t,s,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const o={},u=[];let c=[],d=[];const p={attempt:F(X),check:F(I),consume:T,enter:E,exit:U,interrupt:F(I,{interrupt:!0})},m={code:null,containerState:{},defineSkip:k,events:[],now:N,parser:t,previous:null,sliceSerialize:x,sliceStream:j,write:g};let f=s.tokenize.call(m,p);return s.resolveAll&&u.push(s),m;function g(A){return c=Aa(c,A),D(),c[c.length-1]!==null?[]:(B(s,0),m.events=Rd(u,m.events,m),m.events)}function x(A,P){return u_(j(A),P)}function j(A){return c_(c,A)}function N(){const{_bufferIndex:A,_index:P,line:$,column:J,offset:R}=r;return{_bufferIndex:A,_index:P,line:$,column:J,offset:R}}function k(A){o[A.line]=A.column,C()}function D(){let A;for(;r._index<c.length;){const P=c[r._index];if(typeof P=="string")for(A=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===A&&r._bufferIndex<P.length;)_(P.charCodeAt(r._bufferIndex));else _(P)}}function _(A){f=f(A)}function T(A){ct(A)?(r.line++,r.column=1,r.offset+=A===-3?2:1,C()):A!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===c[r._index].length&&(r._bufferIndex=-1,r._index++)),m.previous=A}function E(A,P){const $=P||{};return $.type=A,$.start=N(),m.events.push(["enter",$,m]),d.push($),$}function U(A){const P=d.pop();return P.end=N(),m.events.push(["exit",P,m]),P}function X(A,P){B(A,P.from)}function I(A,P){P.restore()}function F(A,P){return $;function $(J,R,L){let M,Z,Q,S;return Array.isArray(J)?fe(J):"tokenize"in J?fe([J]):ge(J);function ge(K){return Y;function Y(V){const oe=V!==null&&K[V],Pe=V!==null&&K.null,se=[...Array.isArray(oe)?oe:oe?[oe]:[],...Array.isArray(Pe)?Pe:Pe?[Pe]:[]];return fe(se)(V)}}function fe(K){return M=K,Z=0,K.length===0?L:w(K[Z])}function w(K){return Y;function Y(V){return S=G(),Q=K,K.partial||(m.currentConstruct=K),K.name&&m.parser.constructs.disable.null.includes(K.name)?Ne():K.tokenize.call(P?Object.assign(Object.create(m),P):m,p,ue,Ne)(V)}}function ue(K){return A(Q,S),R}function Ne(K){return S.restore(),++Z<M.length?w(M[Z]):L}}}function B(A,P){A.resolveAll&&!u.includes(A)&&u.push(A),A.resolve&&ja(m.events,P,m.events.length-P,A.resolve(m.events.slice(P),m)),A.resolveTo&&(m.events=A.resolveTo(m.events,m))}function G(){const A=N(),P=m.previous,$=m.currentConstruct,J=m.events.length,R=Array.from(d);return{from:J,restore:L};function L(){r=A,m.previous=P,m.currentConstruct=$,m.events.length=J,d=R,C()}}function C(){r.line in o&&r.column<2&&(r.column=o[r.line],r.offset+=o[r.line]-1)}}function c_(t,s){const n=s.start._index,r=s.start._bufferIndex,o=s.end._index,u=s.end._bufferIndex;let c;if(n===o)c=[t[n].slice(r,u)];else{if(c=t.slice(n,o),r>-1){const d=c[0];typeof d=="string"?c[0]=d.slice(r):c.shift()}u>0&&c.push(t[o].slice(0,u))}return c}function u_(t,s){let n=-1;const r=[];let o;for(;++n<t.length;){const u=t[n];let c;if(typeof u=="string")c=u;else switch(u){case-5:{c="\r";break}case-4:{c=`
`;break}case-3:{c=`\r
`;break}case-2:{c=s?" ":"	";break}case-1:{if(!s&&o)continue;c=" ";break}default:c=String.fromCharCode(u)}o=u===-2,r.push(c)}return r.join("")}function d_(t){const r={constructs:A0([l_,...(t||{}).extensions||[]]),content:o(Ck),defined:[],document:o(Dk),flow:o(GC),lazy:{},string:o(JC),text:o(XC)};return r;function o(u){return c;function c(d){return o_(r,u,d)}}}function h_(t){for(;!R0(t););return t}const wb=/[\0\t\n\r]/g;function m_(){let t=1,s="",n=!0,r;return o;function o(u,c,d){const p=[];let m,f,g,x,j;for(u=s+(typeof u=="string"?u.toString():new TextDecoder(c||void 0).decode(u)),g=0,s="",n&&(u.charCodeAt(0)===65279&&g++,n=void 0);g<u.length;){if(wb.lastIndex=g,m=wb.exec(u),x=m&&m.index!==void 0?m.index:u.length,j=u.charCodeAt(x),!m){s=u.slice(g);break}if(j===10&&g===x&&r)p.push(-3),r=void 0;else switch(r&&(p.push(-5),r=void 0),g<x&&(p.push(u.slice(g,x)),t+=x-g),j){case 0:{p.push(65533),t++;break}case 9:{for(f=Math.ceil(t/4)*4,p.push(-2);t++<f;)p.push(-1);break}case 10:{p.push(-4),t=1;break}default:r=!0,t=1}g=x+1}return d&&(r&&p.push(-5),s&&p.push(s),p.push(null)),p}}const p_=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function f_(t){return t.replace(p_,g_)}function g_(t,s,n){if(s)return s;if(n.charCodeAt(0)===35){const o=n.charCodeAt(1),u=o===120||o===88;return P0(n.slice(u?2:1),u?16:10)}return Sf(n)||t}const U0={}.hasOwnProperty;function x_(t,s,n){return typeof s!="string"&&(n=s,s=void 0),y_(n)(h_(d_(n).document().write(m_()(t,s,!0))))}function y_(t){const s={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:u(qe),autolinkProtocol:G,autolinkEmail:G,atxHeading:u(Ie),blockQuote:u(Pe),characterEscape:G,characterReference:G,codeFenced:u(se),codeFencedFenceInfo:c,codeFencedFenceMeta:c,codeIndented:u(se,c),codeText:u(Ce,c),codeTextData:G,data:G,codeFlowValue:G,definition:u(ee),definitionDestinationString:c,definitionLabelString:c,definitionTitleString:c,emphasis:u(je),hardBreakEscape:u($e),hardBreakTrailing:u($e),htmlFlow:u(Fe,c),htmlFlowData:G,htmlText:u(Fe,c),htmlTextData:G,image:u(Be),label:c,link:u(qe),listItem:u(ye),listItemValue:x,listOrdered:u(et,g),listUnordered:u(et),paragraph:u(Oe),reference:w,referenceString:c,resourceDestinationString:c,resourceTitleString:c,setextHeading:u(Ie),strong:u(xe),thematicBreak:u(W)},exit:{atxHeading:p(),atxHeadingSequence:X,autolink:p(),autolinkEmail:oe,autolinkProtocol:V,blockQuote:p(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:Ne,characterReferenceMarkerNumeric:Ne,characterReferenceValue:K,characterReference:Y,codeFenced:p(D),codeFencedFence:k,codeFencedFenceInfo:j,codeFencedFenceMeta:N,codeFlowValue:C,codeIndented:p(_),codeText:p(R),codeTextData:C,data:C,definition:p(),definitionDestinationString:U,definitionLabelString:T,definitionTitleString:E,emphasis:p(),hardBreakEscape:p(P),hardBreakTrailing:p(P),htmlFlow:p($),htmlFlowData:C,htmlText:p(J),htmlTextData:C,image:p(M),label:Q,labelText:Z,lineEnding:A,link:p(L),listItem:p(),listOrdered:p(),listUnordered:p(),paragraph:p(),referenceString:ue,resourceDestinationString:S,resourceTitleString:ge,resource:fe,setextHeading:p(B),setextHeadingLineSequence:F,setextHeadingText:I,strong:p(),thematicBreak:p()}};q0(s,(t||{}).mdastExtensions||[]);const n={};return r;function r(O){let te={type:"root",children:[]};const re={stack:[te],tokenStack:[],config:s,enter:d,exit:m,buffer:c,resume:f,data:n},ke=[];let Ue=-1;for(;++Ue<O.length;)if(O[Ue][1].type==="listOrdered"||O[Ue][1].type==="listUnordered")if(O[Ue][0]==="enter")ke.push(Ue);else{const Qe=ke.pop();Ue=o(O,Qe,Ue)}for(Ue=-1;++Ue<O.length;){const Qe=s[O[Ue][0]];U0.call(Qe,O[Ue][1].type)&&Qe[O[Ue][1].type].call(Object.assign({sliceSerialize:O[Ue][2].sliceSerialize},re),O[Ue][1])}if(re.tokenStack.length>0){const Qe=re.tokenStack[re.tokenStack.length-1];(Qe[1]||Sb).call(re,void 0,Qe[0])}for(te.position={start:Pi(O.length>0?O[0][1].start:{line:1,column:1,offset:0}),end:Pi(O.length>0?O[O.length-2][1].end:{line:1,column:1,offset:0})},Ue=-1;++Ue<s.transforms.length;)te=s.transforms[Ue](te)||te;return te}function o(O,te,re){let ke=te-1,Ue=-1,Qe=!1,Ze,lt,le,pe;for(;++ke<=re;){const de=O[ke];switch(de[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{de[0]==="enter"?Ue++:Ue--,pe=void 0;break}case"lineEndingBlank":{de[0]==="enter"&&(Ze&&!pe&&!Ue&&!le&&(le=ke),pe=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:pe=void 0}if(!Ue&&de[0]==="enter"&&de[1].type==="listItemPrefix"||Ue===-1&&de[0]==="exit"&&(de[1].type==="listUnordered"||de[1].type==="listOrdered")){if(Ze){let we=ke;for(lt=void 0;we--;){const Ae=O[we];if(Ae[1].type==="lineEnding"||Ae[1].type==="lineEndingBlank"){if(Ae[0]==="exit")continue;lt&&(O[lt][1].type="lineEndingBlank",Qe=!0),Ae[1].type="lineEnding",lt=we}else if(!(Ae[1].type==="linePrefix"||Ae[1].type==="blockQuotePrefix"||Ae[1].type==="blockQuotePrefixWhitespace"||Ae[1].type==="blockQuoteMarker"||Ae[1].type==="listItemIndent"))break}le&&(!lt||le<lt)&&(Ze._spread=!0),Ze.end=Object.assign({},lt?O[lt][1].start:de[1].end),O.splice(lt||ke,0,["exit",Ze,de[2]]),ke++,re++}if(de[1].type==="listItemPrefix"){const we={type:"listItem",_spread:!1,start:Object.assign({},de[1].start),end:void 0};Ze=we,O.splice(ke,0,["enter",we,de[2]]),ke++,re++,le=void 0,pe=!0}}}return O[te][1]._spread=Qe,re}function u(O,te){return re;function re(ke){d.call(this,O(ke),ke),te&&te.call(this,ke)}}function c(){this.stack.push({type:"fragment",children:[]})}function d(O,te,re){this.stack[this.stack.length-1].children.push(O),this.stack.push(O),this.tokenStack.push([te,re||void 0]),O.position={start:Pi(te.start),end:void 0}}function p(O){return te;function te(re){O&&O.call(this,re),m.call(this,re)}}function m(O,te){const re=this.stack.pop(),ke=this.tokenStack.pop();if(ke)ke[0].type!==O.type&&(te?te.call(this,O,ke[0]):(ke[1]||Sb).call(this,O,ke[0]));else throw new Error("Cannot close `"+O.type+"` ("+pc({start:O.start,end:O.end})+"): its not open");re.position.end=Pi(O.end)}function f(){return wf(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function x(O){if(this.data.expectingFirstListItemValue){const te=this.stack[this.stack.length-2];te.start=Number.parseInt(this.sliceSerialize(O),10),this.data.expectingFirstListItemValue=void 0}}function j(){const O=this.resume(),te=this.stack[this.stack.length-1];te.lang=O}function N(){const O=this.resume(),te=this.stack[this.stack.length-1];te.meta=O}function k(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function D(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O.replace(/(\r?\n|\r)$/g,"")}function T(O){const te=this.resume(),re=this.stack[this.stack.length-1];re.label=te,re.identifier=Ha(this.sliceSerialize(O)).toLowerCase()}function E(){const O=this.resume(),te=this.stack[this.stack.length-1];te.title=O}function U(){const O=this.resume(),te=this.stack[this.stack.length-1];te.url=O}function X(O){const te=this.stack[this.stack.length-1];if(!te.depth){const re=this.sliceSerialize(O).length;te.depth=re}}function I(){this.data.setextHeadingSlurpLineEnding=!0}function F(O){const te=this.stack[this.stack.length-1];te.depth=this.sliceSerialize(O).codePointAt(0)===61?1:2}function B(){this.data.setextHeadingSlurpLineEnding=void 0}function G(O){const re=this.stack[this.stack.length-1].children;let ke=re[re.length-1];(!ke||ke.type!=="text")&&(ke=he(),ke.position={start:Pi(O.start),end:void 0},re.push(ke)),this.stack.push(ke)}function C(O){const te=this.stack.pop();te.value+=this.sliceSerialize(O),te.position.end=Pi(O.end)}function A(O){const te=this.stack[this.stack.length-1];if(this.data.atHardBreak){const re=te.children[te.children.length-1];re.position.end=Pi(O.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&s.canContainEols.includes(te.type)&&(G.call(this,O),C.call(this,O))}function P(){this.data.atHardBreak=!0}function $(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function J(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function R(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function L(){const O=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";O.type+="Reference",O.referenceType=te,delete O.url,delete O.title}else delete O.identifier,delete O.label;this.data.referenceType=void 0}function M(){const O=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";O.type+="Reference",O.referenceType=te,delete O.url,delete O.title}else delete O.identifier,delete O.label;this.data.referenceType=void 0}function Z(O){const te=this.sliceSerialize(O),re=this.stack[this.stack.length-2];re.label=f_(te),re.identifier=Ha(te).toLowerCase()}function Q(){const O=this.stack[this.stack.length-1],te=this.resume(),re=this.stack[this.stack.length-1];if(this.data.inReference=!0,re.type==="link"){const ke=O.children;re.children=ke}else re.alt=te}function S(){const O=this.resume(),te=this.stack[this.stack.length-1];te.url=O}function ge(){const O=this.resume(),te=this.stack[this.stack.length-1];te.title=O}function fe(){this.data.inReference=void 0}function w(){this.data.referenceType="collapsed"}function ue(O){const te=this.resume(),re=this.stack[this.stack.length-1];re.label=te,re.identifier=Ha(this.sliceSerialize(O)).toLowerCase(),this.data.referenceType="full"}function Ne(O){this.data.characterReferenceType=O.type}function K(O){const te=this.sliceSerialize(O),re=this.data.characterReferenceType;let ke;re?(ke=P0(te,re==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ke=Sf(te);const Ue=this.stack[this.stack.length-1];Ue.value+=ke}function Y(O){const te=this.stack.pop();te.position.end=Pi(O.end)}function V(O){C.call(this,O);const te=this.stack[this.stack.length-1];te.url=this.sliceSerialize(O)}function oe(O){C.call(this,O);const te=this.stack[this.stack.length-1];te.url="mailto:"+this.sliceSerialize(O)}function Pe(){return{type:"blockquote",children:[]}}function se(){return{type:"code",lang:null,meta:null,value:""}}function Ce(){return{type:"inlineCode",value:""}}function ee(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function je(){return{type:"emphasis",children:[]}}function Ie(){return{type:"heading",depth:0,children:[]}}function $e(){return{type:"break"}}function Fe(){return{type:"html",value:""}}function Be(){return{type:"image",title:null,url:"",alt:null}}function qe(){return{type:"link",title:null,url:"",children:[]}}function et(O){return{type:"list",ordered:O.type==="listOrdered",start:null,spread:O._spread,children:[]}}function ye(O){return{type:"listItem",spread:O._spread,checked:null,children:[]}}function Oe(){return{type:"paragraph",children:[]}}function xe(){return{type:"strong",children:[]}}function he(){return{type:"text",value:""}}function W(){return{type:"thematicBreak"}}}function Pi(t){return{line:t.line,column:t.column,offset:t.offset}}function q0(t,s){let n=-1;for(;++n<s.length;){const r=s[n];Array.isArray(r)?q0(t,r):b_(t,r)}}function b_(t,s){let n;for(n in s)if(U0.call(s,n))switch(n){case"canContainEols":{const r=s[n];r&&t[n].push(...r);break}case"transforms":{const r=s[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=s[n];r&&Object.assign(t[n],r);break}}}function Sb(t,s){throw t?new Error("Cannot close `"+t.type+"` ("+pc({start:t.start,end:t.end})+"): a different token (`"+s.type+"`, "+pc({start:s.start,end:s.end})+") is open"):new Error("Cannot close document, a token (`"+s.type+"`, "+pc({start:s.start,end:s.end})+") is still open")}function j_(t){const s=this;s.parser=n;function n(r){return x_(r,{...s.data("settings"),...t,extensions:s.data("micromarkExtensions")||[],mdastExtensions:s.data("fromMarkdownExtensions")||[]})}}function v_(t,s){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(s),!0)};return t.patch(s,n),t.applyData(s,n)}function N_(t,s){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(s,n),[t.applyData(s,n),{type:"text",value:`
`}]}function w_(t,s){const n=s.value?s.value+`
`:"",r={};s.lang&&(r.className=["language-"+s.lang]);let o={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return s.meta&&(o.data={meta:s.meta}),t.patch(s,o),o=t.applyData(s,o),o={type:"element",tagName:"pre",properties:{},children:[o]},t.patch(s,o),o}function S_(t,s){const n={type:"element",tagName:"del",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function k_(t,s){const n={type:"element",tagName:"em",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function C_(t,s){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(s.identifier).toUpperCase(),o=Hl(r.toLowerCase()),u=t.footnoteOrder.indexOf(r);let c,d=t.footnoteCounts.get(r);d===void 0?(d=0,t.footnoteOrder.push(r),c=t.footnoteOrder.length):c=u+1,d+=1,t.footnoteCounts.set(r,d);const p={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+o,id:n+"fnref-"+o+(d>1?"-"+d:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(c)}]};t.patch(s,p);const m={type:"element",tagName:"sup",properties:{},children:[p]};return t.patch(s,m),t.applyData(s,m)}function __(t,s){const n={type:"element",tagName:"h"+s.depth,properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function D_(t,s){if(t.options.allowDangerousHtml){const n={type:"raw",value:s.value};return t.patch(s,n),t.applyData(s,n)}}function H0(t,s){const n=s.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(s.label||s.identifier)+"]"),s.type==="imageReference")return[{type:"text",value:"!["+s.alt+r}];const o=t.all(s),u=o[0];u&&u.type==="text"?u.value="["+u.value:o.unshift({type:"text",value:"["});const c=o[o.length-1];return c&&c.type==="text"?c.value+=r:o.push({type:"text",value:r}),o}function E_(t,s){const n=String(s.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return H0(t,s);const o={src:Hl(r.url||""),alt:s.alt};r.title!==null&&r.title!==void 0&&(o.title=r.title);const u={type:"element",tagName:"img",properties:o,children:[]};return t.patch(s,u),t.applyData(s,u)}function T_(t,s){const n={src:Hl(s.url)};s.alt!==null&&s.alt!==void 0&&(n.alt=s.alt),s.title!==null&&s.title!==void 0&&(n.title=s.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(s,r),t.applyData(s,r)}function A_(t,s){const n={type:"text",value:s.value.replace(/\r?\n|\r/g," ")};t.patch(s,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(s,r),t.applyData(s,r)}function P_(t,s){const n=String(s.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return H0(t,s);const o={href:Hl(r.url||"")};r.title!==null&&r.title!==void 0&&(o.title=r.title);const u={type:"element",tagName:"a",properties:o,children:t.all(s)};return t.patch(s,u),t.applyData(s,u)}function I_(t,s){const n={href:Hl(s.url)};s.title!==null&&s.title!==void 0&&(n.title=s.title);const r={type:"element",tagName:"a",properties:n,children:t.all(s)};return t.patch(s,r),t.applyData(s,r)}function O_(t,s,n){const r=t.all(s),o=n?z_(n):V0(s),u={},c=[];if(typeof s.checked=="boolean"){const f=r[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},r.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:s.checked,disabled:!0},children:[]}),u.className=["task-list-item"]}let d=-1;for(;++d<r.length;){const f=r[d];(o||d!==0||f.type!=="element"||f.tagName!=="p")&&c.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!o?c.push(...f.children):c.push(f)}const p=r[r.length-1];p&&(o||p.type!=="element"||p.tagName!=="p")&&c.push({type:"text",value:`
`});const m={type:"element",tagName:"li",properties:u,children:c};return t.patch(s,m),t.applyData(s,m)}function z_(t){let s=!1;if(t.type==="list"){s=t.spread||!1;const n=t.children;let r=-1;for(;!s&&++r<n.length;)s=V0(n[r])}return s}function V0(t){const s=t.spread;return s??t.children.length>1}function R_(t,s){const n={},r=t.all(s);let o=-1;for(typeof s.start=="number"&&s.start!==1&&(n.start=s.start);++o<r.length;){const c=r[o];if(c.type==="element"&&c.tagName==="li"&&c.properties&&Array.isArray(c.properties.className)&&c.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const u={type:"element",tagName:s.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(s,u),t.applyData(s,u)}function L_(t,s){const n={type:"element",tagName:"p",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function $_(t,s){const n={type:"root",children:t.wrap(t.all(s))};return t.patch(s,n),t.applyData(s,n)}function F_(t,s){const n={type:"element",tagName:"strong",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function M_(t,s){const n=t.all(s),r=n.shift(),o=[];if(r){const c={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(s.children[0],c),o.push(c)}if(n.length>0){const c={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},d=bf(s.children[1]),p=S0(s.children[s.children.length-1]);d&&p&&(c.position={start:d,end:p}),o.push(c)}const u={type:"element",tagName:"table",properties:{},children:t.wrap(o,!0)};return t.patch(s,u),t.applyData(s,u)}function B_(t,s,n){const r=n?n.children:void 0,u=(r?r.indexOf(s):1)===0?"th":"td",c=n&&n.type==="table"?n.align:void 0,d=c?c.length:s.children.length;let p=-1;const m=[];for(;++p<d;){const g=s.children[p],x={},j=c?c[p]:void 0;j&&(x.align=j);let N={type:"element",tagName:u,properties:x,children:[]};g&&(N.children=t.all(g),t.patch(g,N),N=t.applyData(g,N)),m.push(N)}const f={type:"element",tagName:"tr",properties:{},children:t.wrap(m,!0)};return t.patch(s,f),t.applyData(s,f)}function U_(t,s){const n={type:"element",tagName:"td",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}const kb=9,Cb=32;function q_(t){const s=String(t),n=/\r?\n|\r/g;let r=n.exec(s),o=0;const u=[];for(;r;)u.push(_b(s.slice(o,r.index),o>0,!0),r[0]),o=r.index+r[0].length,r=n.exec(s);return u.push(_b(s.slice(o),o>0,!1)),u.join("")}function _b(t,s,n){let r=0,o=t.length;if(s){let u=t.codePointAt(r);for(;u===kb||u===Cb;)r++,u=t.codePointAt(r)}if(n){let u=t.codePointAt(o-1);for(;u===kb||u===Cb;)o--,u=t.codePointAt(o-1)}return o>r?t.slice(r,o):""}function H_(t,s){const n={type:"text",value:q_(String(s.value))};return t.patch(s,n),t.applyData(s,n)}function V_(t,s){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(s,n),t.applyData(s,n)}const G_={blockquote:v_,break:N_,code:w_,delete:S_,emphasis:k_,footnoteReference:C_,heading:__,html:D_,imageReference:E_,image:T_,inlineCode:A_,linkReference:P_,link:I_,listItem:O_,list:R_,paragraph:L_,root:$_,strong:F_,table:M_,tableCell:U_,tableRow:B_,text:H_,thematicBreak:V_,toml:td,yaml:td,definition:td,footnoteDefinition:td};function td(){}const G0=-1,Ld=0,gc=1,wd=2,Cf=3,_f=4,Df=5,Ef=6,Q0=7,Y0=8,Db=typeof self=="object"?self:globalThis,Q_=(t,s)=>{const n=(o,u)=>(t.set(u,o),o),r=o=>{if(t.has(o))return t.get(o);const[u,c]=s[o];switch(u){case Ld:case G0:return n(c,o);case gc:{const d=n([],o);for(const p of c)d.push(r(p));return d}case wd:{const d=n({},o);for(const[p,m]of c)d[r(p)]=r(m);return d}case Cf:return n(new Date(c),o);case _f:{const{source:d,flags:p}=c;return n(new RegExp(d,p),o)}case Df:{const d=n(new Map,o);for(const[p,m]of c)d.set(r(p),r(m));return d}case Ef:{const d=n(new Set,o);for(const p of c)d.add(r(p));return d}case Q0:{const{name:d,message:p}=c;return n(new Db[d](p),o)}case Y0:return n(BigInt(c),o);case"BigInt":return n(Object(BigInt(c)),o);case"ArrayBuffer":return n(new Uint8Array(c).buffer,c);case"DataView":{const{buffer:d}=new Uint8Array(c);return n(new DataView(d),c)}}return n(new Db[u](c),o)};return r},Eb=t=>Q_(new Map,t)(0),Sl="",{toString:Y_}={},{keys:J_}=Object,cc=t=>{const s=typeof t;if(s!=="object"||!t)return[Ld,s];const n=Y_.call(t).slice(8,-1);switch(n){case"Array":return[gc,Sl];case"Object":return[wd,Sl];case"Date":return[Cf,Sl];case"RegExp":return[_f,Sl];case"Map":return[Df,Sl];case"Set":return[Ef,Sl];case"DataView":return[gc,n]}return n.includes("Array")?[gc,n]:n.includes("Error")?[Q0,n]:[wd,n]},nd=([t,s])=>t===Ld&&(s==="function"||s==="symbol"),X_=(t,s,n,r)=>{const o=(c,d)=>{const p=r.push(c)-1;return n.set(d,p),p},u=c=>{if(n.has(c))return n.get(c);let[d,p]=cc(c);switch(d){case Ld:{let f=c;switch(p){case"bigint":d=Y0,f=c.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+p);f=null;break;case"undefined":return o([G0],c)}return o([d,f],c)}case gc:{if(p){let x=c;return p==="DataView"?x=new Uint8Array(c.buffer):p==="ArrayBuffer"&&(x=new Uint8Array(c)),o([p,[...x]],c)}const f=[],g=o([d,f],c);for(const x of c)f.push(u(x));return g}case wd:{if(p)switch(p){case"BigInt":return o([p,c.toString()],c);case"Boolean":case"Number":case"String":return o([p,c.valueOf()],c)}if(s&&"toJSON"in c)return u(c.toJSON());const f=[],g=o([d,f],c);for(const x of J_(c))(t||!nd(cc(c[x])))&&f.push([u(x),u(c[x])]);return g}case Cf:return o([d,c.toISOString()],c);case _f:{const{source:f,flags:g}=c;return o([d,{source:f,flags:g}],c)}case Df:{const f=[],g=o([d,f],c);for(const[x,j]of c)(t||!(nd(cc(x))||nd(cc(j))))&&f.push([u(x),u(j)]);return g}case Ef:{const f=[],g=o([d,f],c);for(const x of c)(t||!nd(cc(x)))&&f.push(u(x));return g}}const{message:m}=c;return o([d,{name:p,message:m}],c)};return u},Tb=(t,{json:s,lossy:n}={})=>{const r=[];return X_(!(s||n),!!s,new Map,r)(t),r},Sd=typeof structuredClone=="function"?(t,s)=>s&&("json"in s||"lossy"in s)?Eb(Tb(t,s)):structuredClone(t):(t,s)=>Eb(Tb(t,s));function K_(t,s){const n=[{type:"text",value:""}];return s>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(s)}]}),n}function W_(t,s){return"Back to reference "+(t+1)+(s>1?"-"+s:"")}function Z_(t){const s=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||K_,r=t.options.footnoteBackLabel||W_,o=t.options.footnoteLabel||"Footnotes",u=t.options.footnoteLabelTagName||"h2",c=t.options.footnoteLabelProperties||{className:["sr-only"]},d=[];let p=-1;for(;++p<t.footnoteOrder.length;){const m=t.footnoteById.get(t.footnoteOrder[p]);if(!m)continue;const f=t.all(m),g=String(m.identifier).toUpperCase(),x=Hl(g.toLowerCase());let j=0;const N=[],k=t.footnoteCounts.get(g);for(;k!==void 0&&++j<=k;){N.length>0&&N.push({type:"text",value:" "});let T=typeof n=="string"?n:n(p,j);typeof T=="string"&&(T={type:"text",value:T}),N.push({type:"element",tagName:"a",properties:{href:"#"+s+"fnref-"+x+(j>1?"-"+j:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(p,j),className:["data-footnote-backref"]},children:Array.isArray(T)?T:[T]})}const D=f[f.length-1];if(D&&D.type==="element"&&D.tagName==="p"){const T=D.children[D.children.length-1];T&&T.type==="text"?T.value+=" ":D.children.push({type:"text",value:" "}),D.children.push(...N)}else f.push(...N);const _={type:"element",tagName:"li",properties:{id:s+"fn-"+x},children:t.wrap(f,!0)};t.patch(m,_),d.push(_)}if(d.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:u,properties:{...Sd(c),id:"footnote-label"},children:[{type:"text",value:o}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(d,!0)},{type:"text",value:`
`}]}}const $d=function(t){if(t==null)return a2;if(typeof t=="function")return Fd(t);if(typeof t=="object")return Array.isArray(t)?e2(t):t2(t);if(typeof t=="string")return n2(t);throw new Error("Expected function, string, or object as test")};function e2(t){const s=[];let n=-1;for(;++n<t.length;)s[n]=$d(t[n]);return Fd(r);function r(...o){let u=-1;for(;++u<s.length;)if(s[u].apply(this,o))return!0;return!1}}function t2(t){const s=t;return Fd(n);function n(r){const o=r;let u;for(u in t)if(o[u]!==s[u])return!1;return!0}}function n2(t){return Fd(s);function s(n){return n&&n.type===t}}function Fd(t){return s;function s(n,r,o){return!!(s2(n)&&t.call(this,n,typeof r=="number"?r:void 0,o||void 0))}}function a2(){return!0}function s2(t){return t!==null&&typeof t=="object"&&"type"in t}const J0=[],i2=!0,Mp=!1,r2="skip";function X0(t,s,n,r){let o;typeof s=="function"&&typeof n!="function"?(r=n,n=s):o=s;const u=$d(o),c=r?-1:1;d(t,void 0,[])();function d(p,m,f){const g=p&&typeof p=="object"?p:{};if(typeof g.type=="string"){const j=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(x,"name",{value:"node ("+(p.type+(j?"<"+j+">":""))+")"})}return x;function x(){let j=J0,N,k,D;if((!s||u(p,m,f[f.length-1]||void 0))&&(j=l2(n(p,f)),j[0]===Mp))return j;if("children"in p&&p.children){const _=p;if(_.children&&j[0]!==r2)for(k=(r?_.children.length:-1)+c,D=f.concat(_);k>-1&&k<_.children.length;){const T=_.children[k];if(N=d(T,k,D)(),N[0]===Mp)return N;k=typeof N[1]=="number"?N[1]:k+c}}return j}}}function l2(t){return Array.isArray(t)?t:typeof t=="number"?[i2,t]:t==null?J0:[t]}function Tf(t,s,n,r){let o,u,c;typeof s=="function"?(u=void 0,c=s,o=n):(u=s,c=n,o=r),X0(t,u,d,o);function d(p,m){const f=m[m.length-1],g=f?f.children.indexOf(p):void 0;return c(p,g,f)}}const Bp={}.hasOwnProperty,o2={};function c2(t,s){const n=s||o2,r=new Map,o=new Map,u=new Map,c={...G_,...n.handlers},d={all:m,applyData:d2,definitionById:r,footnoteById:o,footnoteCounts:u,footnoteOrder:[],handlers:c,one:p,options:n,patch:u2,wrap:m2};return Tf(t,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?r:o,x=String(f.identifier).toUpperCase();g.has(x)||g.set(x,f)}}),d;function p(f,g){const x=f.type,j=d.handlers[x];if(Bp.call(d.handlers,x)&&j)return j(d,f,g);if(d.options.passThrough&&d.options.passThrough.includes(x)){if("children"in f){const{children:k,...D}=f,_=Sd(D);return _.children=d.all(f),_}return Sd(f)}return(d.options.unknownHandler||h2)(d,f,g)}function m(f){const g=[];if("children"in f){const x=f.children;let j=-1;for(;++j<x.length;){const N=d.one(x[j],f);if(N){if(j&&x[j-1].type==="break"&&(!Array.isArray(N)&&N.type==="text"&&(N.value=Ab(N.value)),!Array.isArray(N)&&N.type==="element")){const k=N.children[0];k&&k.type==="text"&&(k.value=Ab(k.value))}Array.isArray(N)?g.push(...N):g.push(N)}}}return g}}function u2(t,s){t.position&&(s.position=WS(t))}function d2(t,s){let n=s;if(t&&t.data){const r=t.data.hName,o=t.data.hChildren,u=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const c="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:c}}n.type==="element"&&u&&Object.assign(n.properties,Sd(u)),"children"in n&&n.children&&o!==null&&o!==void 0&&(n.children=o)}return n}function h2(t,s){const n=s.data||{},r="value"in s&&!(Bp.call(n,"hProperties")||Bp.call(n,"hChildren"))?{type:"text",value:s.value}:{type:"element",tagName:"div",properties:{},children:t.all(s)};return t.patch(s,r),t.applyData(s,r)}function m2(t,s){const n=[];let r=-1;for(s&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return s&&t.length>0&&n.push({type:"text",value:`
`}),n}function Ab(t){let s=0,n=t.charCodeAt(s);for(;n===9||n===32;)s++,n=t.charCodeAt(s);return t.slice(s)}function Pb(t,s){const n=c2(t,s),r=n.one(t,void 0),o=Z_(n),u=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return o&&u.children.push({type:"text",value:`
`},o),u}function p2(t,s){return t&&"run"in t?async function(n,r){const o=Pb(n,{file:r,...s});await t.run(o,r)}:function(n,r){return Pb(n,{file:r,...t||s})}}function Ib(t){if(t)throw t}var Ym,Ob;function f2(){if(Ob)return Ym;Ob=1;var t=Object.prototype.hasOwnProperty,s=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=function(m){return typeof Array.isArray=="function"?Array.isArray(m):s.call(m)==="[object Array]"},u=function(m){if(!m||s.call(m)!=="[object Object]")return!1;var f=t.call(m,"constructor"),g=m.constructor&&m.constructor.prototype&&t.call(m.constructor.prototype,"isPrototypeOf");if(m.constructor&&!f&&!g)return!1;var x;for(x in m);return typeof x>"u"||t.call(m,x)},c=function(m,f){n&&f.name==="__proto__"?n(m,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):m[f.name]=f.newValue},d=function(m,f){if(f==="__proto__")if(t.call(m,f)){if(r)return r(m,f).value}else return;return m[f]};return Ym=function p(){var m,f,g,x,j,N,k=arguments[0],D=1,_=arguments.length,T=!1;for(typeof k=="boolean"&&(T=k,k=arguments[1]||{},D=2),(k==null||typeof k!="object"&&typeof k!="function")&&(k={});D<_;++D)if(m=arguments[D],m!=null)for(f in m)g=d(k,f),x=d(m,f),k!==x&&(T&&x&&(u(x)||(j=o(x)))?(j?(j=!1,N=g&&o(g)?g:[]):N=g&&u(g)?g:{},c(k,{name:f,newValue:p(T,N,x)})):typeof x<"u"&&c(k,{name:f,newValue:x}));return k},Ym}var g2=f2();const Jm=Sc(g2);function Up(t){if(typeof t!="object"||t===null)return!1;const s=Object.getPrototypeOf(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function x2(){const t=[],s={run:n,use:r};return s;function n(...o){let u=-1;const c=o.pop();if(typeof c!="function")throw new TypeError("Expected function as last argument, not "+c);d(null,...o);function d(p,...m){const f=t[++u];let g=-1;if(p){c(p);return}for(;++g<o.length;)(m[g]===null||m[g]===void 0)&&(m[g]=o[g]);o=m,f?y2(f,d)(...m):c(null,...m)}}function r(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return t.push(o),s}}function y2(t,s){let n;return r;function r(...c){const d=t.length>c.length;let p;d&&c.push(o);try{p=t.apply(this,c)}catch(m){const f=m;if(d&&n)throw f;return o(f)}d||(p&&p.then&&typeof p.then=="function"?p.then(u,o):p instanceof Error?o(p):u(p))}function o(c,...d){n||(n=!0,s(c,...d))}function u(c){o(null,c)}}const is={basename:b2,dirname:j2,extname:v2,join:N2,sep:"/"};function b2(t,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');Dc(t);let n=0,r=-1,o=t.length,u;if(s===void 0||s.length===0||s.length>t.length){for(;o--;)if(t.codePointAt(o)===47){if(u){n=o+1;break}}else r<0&&(u=!0,r=o+1);return r<0?"":t.slice(n,r)}if(s===t)return"";let c=-1,d=s.length-1;for(;o--;)if(t.codePointAt(o)===47){if(u){n=o+1;break}}else c<0&&(u=!0,c=o+1),d>-1&&(t.codePointAt(o)===s.codePointAt(d--)?d<0&&(r=o):(d=-1,r=c));return n===r?r=c:r<0&&(r=t.length),t.slice(n,r)}function j2(t){if(Dc(t),t.length===0)return".";let s=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){s=n;break}}else r||(r=!0);return s<0?t.codePointAt(0)===47?"/":".":s===1&&t.codePointAt(0)===47?"//":t.slice(0,s)}function v2(t){Dc(t);let s=t.length,n=-1,r=0,o=-1,u=0,c;for(;s--;){const d=t.codePointAt(s);if(d===47){if(c){r=s+1;break}continue}n<0&&(c=!0,n=s+1),d===46?o<0?o=s:u!==1&&(u=1):o>-1&&(u=-1)}return o<0||n<0||u===0||u===1&&o===n-1&&o===r+1?"":t.slice(o,n)}function N2(...t){let s=-1,n;for(;++s<t.length;)Dc(t[s]),t[s]&&(n=n===void 0?t[s]:n+"/"+t[s]);return n===void 0?".":w2(n)}function w2(t){Dc(t);const s=t.codePointAt(0)===47;let n=S2(t,!s);return n.length===0&&!s&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),s?"/"+n:n}function S2(t,s){let n="",r=0,o=-1,u=0,c=-1,d,p;for(;++c<=t.length;){if(c<t.length)d=t.codePointAt(c);else{if(d===47)break;d=47}if(d===47){if(!(o===c-1||u===1))if(o!==c-1&&u===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(p=n.lastIndexOf("/"),p!==n.length-1){p<0?(n="",r=0):(n=n.slice(0,p),r=n.length-1-n.lastIndexOf("/")),o=c,u=0;continue}}else if(n.length>0){n="",r=0,o=c,u=0;continue}}s&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(o+1,c):n=t.slice(o+1,c),r=c-o-1;o=c,u=0}else d===46&&u>-1?u++:u=-1}return n}function Dc(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const k2={cwd:C2};function C2(){return"/"}function qp(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function _2(t){if(typeof t=="string")t=new URL(t);else if(!qp(t)){const s=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw s.code="ERR_INVALID_ARG_TYPE",s}if(t.protocol!=="file:"){const s=new TypeError("The URL must be of scheme file");throw s.code="ERR_INVALID_URL_SCHEME",s}return D2(t)}function D2(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const s=t.pathname;let n=-1;for(;++n<s.length;)if(s.codePointAt(n)===37&&s.codePointAt(n+1)===50){const r=s.codePointAt(n+2);if(r===70||r===102){const o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(s)}const Xm=["history","path","basename","stem","extname","dirname"];let K0=class{constructor(s){let n;s?qp(s)?n={path:s}:typeof s=="string"||E2(s)?n={value:s}:n=s:n={},this.cwd="cwd"in n?"":k2.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Xm.length;){const u=Xm[r];u in n&&n[u]!==void 0&&n[u]!==null&&(this[u]=u==="history"?[...n[u]]:n[u])}let o;for(o in n)Xm.includes(o)||(this[o]=n[o])}get basename(){return typeof this.path=="string"?is.basename(this.path):void 0}set basename(s){Wm(s,"basename"),Km(s,"basename"),this.path=is.join(this.dirname||"",s)}get dirname(){return typeof this.path=="string"?is.dirname(this.path):void 0}set dirname(s){zb(this.basename,"dirname"),this.path=is.join(s||"",this.basename)}get extname(){return typeof this.path=="string"?is.extname(this.path):void 0}set extname(s){if(Km(s,"extname"),zb(this.dirname,"extname"),s){if(s.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(s.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=is.join(this.dirname,this.stem+(s||""))}get path(){return this.history[this.history.length-1]}set path(s){qp(s)&&(s=_2(s)),Wm(s,"path"),this.path!==s&&this.history.push(s)}get stem(){return typeof this.path=="string"?is.basename(this.path,this.extname):void 0}set stem(s){Wm(s,"stem"),Km(s,"stem"),this.path=is.join(this.dirname||"",s+(this.extname||""))}fail(s,n,r){const o=this.message(s,n,r);throw o.fatal=!0,o}info(s,n,r){const o=this.message(s,n,r);return o.fatal=void 0,o}message(s,n,r){const o=new Fn(s,n,r);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(s){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(s||void 0).decode(this.value)}};function Km(t,s){if(t&&t.includes(is.sep))throw new Error("`"+s+"` cannot be a path: did not expect `"+is.sep+"`")}function Wm(t,s){if(!t)throw new Error("`"+s+"` cannot be empty")}function zb(t,s){if(!t)throw new Error("Setting `"+s+"` requires `path` to be set too")}function E2(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const T2=function(t){const r=this.constructor.prototype,o=r[t],u=function(){return o.apply(u,arguments)};return Object.setPrototypeOf(u,r),u},A2={}.hasOwnProperty;let P2=class W0 extends T2{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=x2()}copy(){const s=new W0;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];s.use(...r)}return s.data(Jm(!0,{},this.namespace)),s}data(s,n){return typeof s=="string"?arguments.length===2?(tp("data",this.frozen),this.namespace[s]=n,this):A2.call(this.namespace,s)&&this.namespace[s]||void 0:s?(tp("data",this.frozen),this.namespace=s,this):this.namespace}freeze(){if(this.frozen)return this;const s=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const o=n.call(s,...r);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(s){this.freeze();const n=ad(s),r=this.parser||this.Parser;return Zm("parse",r),r(String(n),n)}process(s,n){const r=this;return this.freeze(),Zm("process",this.parser||this.Parser),ep("process",this.compiler||this.Compiler),n?o(void 0,n):new Promise(o);function o(u,c){const d=ad(s),p=r.parse(d);r.run(p,d,function(f,g,x){if(f||!g||!x)return m(f);const j=g,N=r.stringify(j,x);z2(N)?x.value=N:x.result=N,m(f,x)});function m(f,g){f||!g?c(f):u?u(g):n(void 0,g)}}}processSync(s){let n=!1,r;return this.freeze(),Zm("processSync",this.parser||this.Parser),ep("processSync",this.compiler||this.Compiler),this.process(s,o),Lb("processSync","process",n),r;function o(u,c){n=!0,Ib(u),r=c}}run(s,n,r){Rb(s),this.freeze();const o=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?u(void 0,r):new Promise(u);function u(c,d){const p=ad(n);o.run(s,p,m);function m(f,g,x){const j=g||s;f?d(f):c?c(j):r(void 0,j,x)}}}runSync(s,n){let r=!1,o;return this.run(s,n,u),Lb("runSync","run",r),o;function u(c,d){Ib(c),o=d,r=!0}}stringify(s,n){this.freeze();const r=ad(n),o=this.compiler||this.Compiler;return ep("stringify",o),Rb(s),o(s,r)}use(s,...n){const r=this.attachers,o=this.namespace;if(tp("use",this.frozen),s!=null)if(typeof s=="function")p(s,n);else if(typeof s=="object")Array.isArray(s)?d(s):c(s);else throw new TypeError("Expected usable value, not `"+s+"`");return this;function u(m){if(typeof m=="function")p(m,[]);else if(typeof m=="object")if(Array.isArray(m)){const[f,...g]=m;p(f,g)}else c(m);else throw new TypeError("Expected usable value, not `"+m+"`")}function c(m){if(!("plugins"in m)&&!("settings"in m))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");d(m.plugins),m.settings&&(o.settings=Jm(!0,o.settings,m.settings))}function d(m){let f=-1;if(m!=null)if(Array.isArray(m))for(;++f<m.length;){const g=m[f];u(g)}else throw new TypeError("Expected a list of plugins, not `"+m+"`")}function p(m,f){let g=-1,x=-1;for(;++g<r.length;)if(r[g][0]===m){x=g;break}if(x===-1)r.push([m,...f]);else if(f.length>0){let[j,...N]=f;const k=r[x][1];Up(k)&&Up(j)&&(j=Jm(!0,k,j)),r[x]=[m,j,...N]}}}};const I2=new P2().freeze();function Zm(t,s){if(typeof s!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function ep(t,s){if(typeof s!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function tp(t,s){if(s)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Rb(t){if(!Up(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Lb(t,s,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+s+"` instead")}function ad(t){return O2(t)?t:new K0(t)}function O2(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function z2(t){return typeof t=="string"||R2(t)}function R2(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const L2="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",$b=[],Fb={allowDangerousHtml:!0},$2=/^(https?|ircs?|mailto|xmpp)$/i,F2=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function xa(t){const s=M2(t),n=B2(t);return U2(s.runSync(s.parse(n),n),t)}function M2(t){const s=t.rehypePlugins||$b,n=t.remarkPlugins||$b,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...Fb}:Fb;return I2().use(j_).use(n).use(p2,r).use(s)}function B2(t){const s=t.children||"",n=new K0;return typeof s=="string"&&(n.value=s),n}function U2(t,s){const n=s.allowedElements,r=s.allowElement,o=s.components,u=s.disallowedElements,c=s.skipHtml,d=s.unwrapDisallowed,p=s.urlTransform||q2;for(const f of F2)Object.hasOwn(s,f.from)&&(""+f.from+(f.to?"use `"+f.to+"` instead":"remove it")+L2+f.id,void 0);return Tf(t,m),ak(t,{Fragment:e.Fragment,components:o,ignoreInvalidStyle:!0,jsx:e.jsx,jsxs:e.jsxs,passKeys:!0,passNode:!0});function m(f,g,x){if(f.type==="raw"&&x&&typeof g=="number")return c?x.children.splice(g,1):x.children[g]={type:"text",value:f.value},g;if(f.type==="element"){let j;for(j in Vm)if(Object.hasOwn(Vm,j)&&Object.hasOwn(f.properties,j)){const N=f.properties[j],k=Vm[j];(k===null||k.includes(f.tagName))&&(f.properties[j]=p(String(N||""),j,f))}}if(f.type==="element"){let j=n?!n.includes(f.tagName):u?u.includes(f.tagName):!1;if(!j&&r&&typeof g=="number"&&(j=!r(f,g,x)),j&&x&&typeof g=="number")return d&&f.children?x.children.splice(g,1,...f.children):x.children.splice(g,1),g}}}function q2(t){const s=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),o=t.indexOf("/");return s===-1||o!==-1&&s>o||n!==-1&&s>n||r!==-1&&s>r||$2.test(t.slice(0,s))?t:""}function Mb(t,s){const n=String(t);if(typeof s!="string")throw new TypeError("Expected character");let r=0,o=n.indexOf(s);for(;o!==-1;)r++,o=n.indexOf(s,o+s.length);return r}function H2(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function V2(t,s,n){const o=$d((n||{}).ignore||[]),u=G2(s);let c=-1;for(;++c<u.length;)X0(t,"text",d);function d(m,f){let g=-1,x;for(;++g<f.length;){const j=f[g],N=x?x.children:void 0;if(o(j,N?N.indexOf(j):void 0,x))return;x=j}if(x)return p(m,f)}function p(m,f){const g=f[f.length-1],x=u[c][0],j=u[c][1];let N=0;const D=g.children.indexOf(m);let _=!1,T=[];x.lastIndex=0;let E=x.exec(m.value);for(;E;){const U=E.index,X={index:E.index,input:E.input,stack:[...f,m]};let I=j(...E,X);if(typeof I=="string"&&(I=I.length>0?{type:"text",value:I}:void 0),I===!1?x.lastIndex=U+1:(N!==U&&T.push({type:"text",value:m.value.slice(N,U)}),Array.isArray(I)?T.push(...I):I&&T.push(I),N=U+E[0].length,_=!0),!x.global)break;E=x.exec(m.value)}return _?(N<m.value.length&&T.push({type:"text",value:m.value.slice(N)}),g.children.splice(D,1,...T)):T=[m],D+T.length}}function G2(t){const s=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const o=n[r];s.push([Q2(o[0]),Y2(o[1])])}return s}function Q2(t){return typeof t=="string"?new RegExp(H2(t),"g"):t}function Y2(t){return typeof t=="function"?t:function(){return t}}const np="phrasing",ap=["autolink","link","image","label"];function J2(){return{transforms:[nD],enter:{literalAutolink:K2,literalAutolinkEmail:sp,literalAutolinkHttp:sp,literalAutolinkWww:sp},exit:{literalAutolink:tD,literalAutolinkEmail:eD,literalAutolinkHttp:W2,literalAutolinkWww:Z2}}}function X2(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:np,notInConstruct:ap},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:np,notInConstruct:ap},{character:":",before:"[ps]",after:"\\/",inConstruct:np,notInConstruct:ap}]}}function K2(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function sp(t){this.config.enter.autolinkProtocol.call(this,t)}function W2(t){this.config.exit.autolinkProtocol.call(this,t)}function Z2(t){this.config.exit.data.call(this,t);const s=this.stack[this.stack.length-1];s.type,s.url="http://"+this.sliceSerialize(t)}function eD(t){this.config.exit.autolinkEmail.call(this,t)}function tD(t){this.exit(t)}function nD(t){V2(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,aD],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),sD]],{ignore:["link","linkReference"]})}function aD(t,s,n,r,o){let u="";if(!Z0(o)||(/^w/i.test(s)&&(n=s+n,s="",u="http://"),!iD(n)))return!1;const c=rD(n+r);if(!c[0])return!1;const d={type:"link",title:null,url:u+s+c[0],children:[{type:"text",value:s+c[0]}]};return c[1]?[d,{type:"text",value:c[1]}]:d}function sD(t,s,n,r){return!Z0(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+s+"@"+n,children:[{type:"text",value:s+"@"+n}]}}function iD(t){const s=t.split(".");return!(s.length<2||s[s.length-1]&&(/_/.test(s[s.length-1])||!/[a-zA-Z\d]/.test(s[s.length-1]))||s[s.length-2]&&(/_/.test(s[s.length-2])||!/[a-zA-Z\d]/.test(s[s.length-2])))}function rD(t){const s=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!s)return[t,void 0];t=t.slice(0,s.index);let n=s[0],r=n.indexOf(")");const o=Mb(t,"(");let u=Mb(t,")");for(;r!==-1&&o>u;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),u++;return[t,n]}function Z0(t,s){const n=t.input.charCodeAt(t.index-1);return(t.index===0||Sr(n)||zd(n))&&(!s||n!==47)}ev.peek=fD;function lD(){this.buffer()}function oD(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function cD(){this.buffer()}function uD(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function dD(t){const s=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Ha(this.sliceSerialize(t)).toLowerCase(),n.label=s}function hD(t){this.exit(t)}function mD(t){const s=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=Ha(this.sliceSerialize(t)).toLowerCase(),n.label=s}function pD(t){this.exit(t)}function fD(){return"["}function ev(t,s,n,r){const o=n.createTracker(r);let u=o.move("[^");const c=n.enter("footnoteReference"),d=n.enter("reference");return u+=o.move(n.safe(n.associationId(t),{after:"]",before:u})),d(),c(),u+=o.move("]"),u}function gD(){return{enter:{gfmFootnoteCallString:lD,gfmFootnoteCall:oD,gfmFootnoteDefinitionLabelString:cD,gfmFootnoteDefinition:uD},exit:{gfmFootnoteCallString:dD,gfmFootnoteCall:hD,gfmFootnoteDefinitionLabelString:mD,gfmFootnoteDefinition:pD}}}function xD(t){let s=!1;return t&&t.firstLineBlank&&(s=!0),{handlers:{footnoteDefinition:n,footnoteReference:ev},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(r,o,u,c){const d=u.createTracker(c);let p=d.move("[^");const m=u.enter("footnoteDefinition"),f=u.enter("label");return p+=d.move(u.safe(u.associationId(r),{before:p,after:"]"})),f(),p+=d.move("]:"),r.children&&r.children.length>0&&(d.shift(4),p+=d.move((s?`
`:" ")+u.indentLines(u.containerFlow(r,d.current()),s?tv:yD))),m(),p}}function yD(t,s,n){return s===0?t:tv(t,s,n)}function tv(t,s,n){return(n?"":"    ")+t}const bD=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];nv.peek=SD;function jD(){return{canContainEols:["delete"],enter:{strikethrough:ND},exit:{strikethrough:wD}}}function vD(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:bD}],handlers:{delete:nv}}}function ND(t){this.enter({type:"delete",children:[]},t)}function wD(t){this.exit(t)}function nv(t,s,n,r){const o=n.createTracker(r),u=n.enter("strikethrough");let c=o.move("~~");return c+=n.containerPhrasing(t,{...o.current(),before:c,after:"~"}),c+=o.move("~~"),u(),c}function SD(){return"~"}function kD(t){return t.length}function CD(t,s){const n=s||{},r=(n.align||[]).concat(),o=n.stringLength||kD,u=[],c=[],d=[],p=[];let m=0,f=-1;for(;++f<t.length;){const k=[],D=[];let _=-1;for(t[f].length>m&&(m=t[f].length);++_<t[f].length;){const T=_D(t[f][_]);if(n.alignDelimiters!==!1){const E=o(T);D[_]=E,(p[_]===void 0||E>p[_])&&(p[_]=E)}k.push(T)}c[f]=k,d[f]=D}let g=-1;if(typeof r=="object"&&"length"in r)for(;++g<m;)u[g]=Bb(r[g]);else{const k=Bb(r);for(;++g<m;)u[g]=k}g=-1;const x=[],j=[];for(;++g<m;){const k=u[g];let D="",_="";k===99?(D=":",_=":"):k===108?D=":":k===114&&(_=":");let T=n.alignDelimiters===!1?1:Math.max(1,p[g]-D.length-_.length);const E=D+"-".repeat(T)+_;n.alignDelimiters!==!1&&(T=D.length+T+_.length,T>p[g]&&(p[g]=T),j[g]=T),x[g]=E}c.splice(1,0,x),d.splice(1,0,j),f=-1;const N=[];for(;++f<c.length;){const k=c[f],D=d[f];g=-1;const _=[];for(;++g<m;){const T=k[g]||"";let E="",U="";if(n.alignDelimiters!==!1){const X=p[g]-(D[g]||0),I=u[g];I===114?E=" ".repeat(X):I===99?X%2?(E=" ".repeat(X/2+.5),U=" ".repeat(X/2-.5)):(E=" ".repeat(X/2),U=E):U=" ".repeat(X)}n.delimiterStart!==!1&&!g&&_.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&T==="")&&(n.delimiterStart!==!1||g)&&_.push(" "),n.alignDelimiters!==!1&&_.push(E),_.push(T),n.alignDelimiters!==!1&&_.push(U),n.padding!==!1&&_.push(" "),(n.delimiterEnd!==!1||g!==m-1)&&_.push("|")}N.push(n.delimiterEnd===!1?_.join("").replace(/ +$/,""):_.join(""))}return N.join(`
`)}function _D(t){return t==null?"":String(t)}function Bb(t){const s=typeof t=="string"?t.codePointAt(0):0;return s===67||s===99?99:s===76||s===108?108:s===82||s===114?114:0}function DD(t,s,n,r){const o=n.enter("blockquote"),u=n.createTracker(r);u.move("> "),u.shift(2);const c=n.indentLines(n.containerFlow(t,u.current()),ED);return o(),c}function ED(t,s,n){return">"+(n?"":" ")+t}function TD(t,s){return Ub(t,s.inConstruct,!0)&&!Ub(t,s.notInConstruct,!1)}function Ub(t,s,n){if(typeof s=="string"&&(s=[s]),!s||s.length===0)return n;let r=-1;for(;++r<s.length;)if(t.includes(s[r]))return!0;return!1}function qb(t,s,n,r){let o=-1;for(;++o<n.unsafe.length;)if(n.unsafe[o].character===`
`&&TD(n.stack,n.unsafe[o]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function AD(t,s){const n=String(t);let r=n.indexOf(s),o=r,u=0,c=0;if(typeof s!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===o?++u>c&&(c=u):u=1,o=r+s.length,r=n.indexOf(s,o);return c}function PD(t,s){return!!(s.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function ID(t){const s=t.options.fence||"`";if(s!=="`"&&s!=="~")throw new Error("Cannot serialize code with `"+s+"` for `options.fence`, expected `` ` `` or `~`");return s}function OD(t,s,n,r){const o=ID(n),u=t.value||"",c=o==="`"?"GraveAccent":"Tilde";if(PD(t,n)){const g=n.enter("codeIndented"),x=n.indentLines(u,zD);return g(),x}const d=n.createTracker(r),p=o.repeat(Math.max(AD(u,o)+1,3)),m=n.enter("codeFenced");let f=d.move(p);if(t.lang){const g=n.enter(`codeFencedLang${c}`);f+=d.move(n.safe(t.lang,{before:f,after:" ",encode:["`"],...d.current()})),g()}if(t.lang&&t.meta){const g=n.enter(`codeFencedMeta${c}`);f+=d.move(" "),f+=d.move(n.safe(t.meta,{before:f,after:`
`,encode:["`"],...d.current()})),g()}return f+=d.move(`
`),u&&(f+=d.move(u+`
`)),f+=d.move(p),m(),f}function zD(t,s,n){return(n?"":"    ")+t}function Af(t){const s=t.options.quote||'"';if(s!=='"'&&s!=="'")throw new Error("Cannot serialize title with `"+s+"` for `options.quote`, expected `\"`, or `'`");return s}function RD(t,s,n,r){const o=Af(n),u=o==='"'?"Quote":"Apostrophe",c=n.enter("definition");let d=n.enter("label");const p=n.createTracker(r);let m=p.move("[");return m+=p.move(n.safe(n.associationId(t),{before:m,after:"]",...p.current()})),m+=p.move("]: "),d(),!t.url||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=p.move("<"),m+=p.move(n.safe(t.url,{before:m,after:">",...p.current()})),m+=p.move(">")):(d=n.enter("destinationRaw"),m+=p.move(n.safe(t.url,{before:m,after:t.title?" ":`
`,...p.current()}))),d(),t.title&&(d=n.enter(`title${u}`),m+=p.move(" "+o),m+=p.move(n.safe(t.title,{before:m,after:o,...p.current()})),m+=p.move(o),d()),c(),m}function LD(t){const s=t.options.emphasis||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize emphasis with `"+s+"` for `options.emphasis`, expected `*`, or `_`");return s}function Nc(t){return"&#x"+t.toString(16).toUpperCase()+";"}function kd(t,s,n){const r=Fl(t),o=Fl(s);return r===void 0?o===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}av.peek=$D;function av(t,s,n,r){const o=LD(n),u=n.enter("emphasis"),c=n.createTracker(r),d=c.move(o);let p=c.move(n.containerPhrasing(t,{after:o,before:d,...c.current()}));const m=p.charCodeAt(0),f=kd(r.before.charCodeAt(r.before.length-1),m,o);f.inside&&(p=Nc(m)+p.slice(1));const g=p.charCodeAt(p.length-1),x=kd(r.after.charCodeAt(0),g,o);x.inside&&(p=p.slice(0,-1)+Nc(g));const j=c.move(o);return u(),n.attentionEncodeSurroundingInfo={after:x.outside,before:f.outside},d+p+j}function $D(t,s,n){return n.options.emphasis||"*"}function FD(t,s){let n=!1;return Tf(t,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,Mp}),!!((!t.depth||t.depth<3)&&wf(t)&&(s.options.setext||n))}function MD(t,s,n,r){const o=Math.max(Math.min(6,t.depth||1),1),u=n.createTracker(r);if(FD(t,n)){const f=n.enter("headingSetext"),g=n.enter("phrasing"),x=n.containerPhrasing(t,{...u.current(),before:`
`,after:`
`});return g(),f(),x+`
`+(o===1?"=":"-").repeat(x.length-(Math.max(x.lastIndexOf("\r"),x.lastIndexOf(`
`))+1))}const c="#".repeat(o),d=n.enter("headingAtx"),p=n.enter("phrasing");u.move(c+" ");let m=n.containerPhrasing(t,{before:"# ",after:`
`,...u.current()});return/^[\t ]/.test(m)&&(m=Nc(m.charCodeAt(0))+m.slice(1)),m=m?c+" "+m:c,n.options.closeAtx&&(m+=" "+c),p(),d(),m}sv.peek=BD;function sv(t){return t.value||""}function BD(){return"<"}iv.peek=UD;function iv(t,s,n,r){const o=Af(n),u=o==='"'?"Quote":"Apostrophe",c=n.enter("image");let d=n.enter("label");const p=n.createTracker(r);let m=p.move("![");return m+=p.move(n.safe(t.alt,{before:m,after:"]",...p.current()})),m+=p.move("]("),d(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=p.move("<"),m+=p.move(n.safe(t.url,{before:m,after:">",...p.current()})),m+=p.move(">")):(d=n.enter("destinationRaw"),m+=p.move(n.safe(t.url,{before:m,after:t.title?" ":")",...p.current()}))),d(),t.title&&(d=n.enter(`title${u}`),m+=p.move(" "+o),m+=p.move(n.safe(t.title,{before:m,after:o,...p.current()})),m+=p.move(o),d()),m+=p.move(")"),c(),m}function UD(){return"!"}rv.peek=qD;function rv(t,s,n,r){const o=t.referenceType,u=n.enter("imageReference");let c=n.enter("label");const d=n.createTracker(r);let p=d.move("![");const m=n.safe(t.alt,{before:p,after:"]",...d.current()});p+=d.move(m+"]["),c();const f=n.stack;n.stack=[],c=n.enter("reference");const g=n.safe(n.associationId(t),{before:p,after:"]",...d.current()});return c(),n.stack=f,u(),o==="full"||!m||m!==g?p+=d.move(g+"]"):o==="shortcut"?p=p.slice(0,-1):p+=d.move("]"),p}function qD(){return"!"}lv.peek=HD;function lv(t,s,n){let r=t.value||"",o="`",u=-1;for(;new RegExp("(^|[^`])"+o+"([^`]|$)").test(r);)o+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++u<n.unsafe.length;){const c=n.unsafe[u],d=n.compilePattern(c);let p;if(c.atBreak)for(;p=d.exec(r);){let m=p.index;r.charCodeAt(m)===10&&r.charCodeAt(m-1)===13&&m--,r=r.slice(0,m)+" "+r.slice(p.index+1)}}return o+r+o}function HD(){return"`"}function ov(t,s){const n=wf(t);return!!(!s.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}cv.peek=VD;function cv(t,s,n,r){const o=Af(n),u=o==='"'?"Quote":"Apostrophe",c=n.createTracker(r);let d,p;if(ov(t,n)){const f=n.stack;n.stack=[],d=n.enter("autolink");let g=c.move("<");return g+=c.move(n.containerPhrasing(t,{before:g,after:">",...c.current()})),g+=c.move(">"),d(),n.stack=f,g}d=n.enter("link"),p=n.enter("label");let m=c.move("[");return m+=c.move(n.containerPhrasing(t,{before:m,after:"](",...c.current()})),m+=c.move("]("),p(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(p=n.enter("destinationLiteral"),m+=c.move("<"),m+=c.move(n.safe(t.url,{before:m,after:">",...c.current()})),m+=c.move(">")):(p=n.enter("destinationRaw"),m+=c.move(n.safe(t.url,{before:m,after:t.title?" ":")",...c.current()}))),p(),t.title&&(p=n.enter(`title${u}`),m+=c.move(" "+o),m+=c.move(n.safe(t.title,{before:m,after:o,...c.current()})),m+=c.move(o),p()),m+=c.move(")"),d(),m}function VD(t,s,n){return ov(t,n)?"<":"["}uv.peek=GD;function uv(t,s,n,r){const o=t.referenceType,u=n.enter("linkReference");let c=n.enter("label");const d=n.createTracker(r);let p=d.move("[");const m=n.containerPhrasing(t,{before:p,after:"]",...d.current()});p+=d.move(m+"]["),c();const f=n.stack;n.stack=[],c=n.enter("reference");const g=n.safe(n.associationId(t),{before:p,after:"]",...d.current()});return c(),n.stack=f,u(),o==="full"||!m||m!==g?p+=d.move(g+"]"):o==="shortcut"?p=p.slice(0,-1):p+=d.move("]"),p}function GD(){return"["}function Pf(t){const s=t.options.bullet||"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bullet`, expected `*`, `+`, or `-`");return s}function QD(t){const s=Pf(t),n=t.options.bulletOther;if(!n)return s==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===s)throw new Error("Expected `bullet` (`"+s+"`) and `bulletOther` (`"+n+"`) to be different");return n}function YD(t){const s=t.options.bulletOrdered||".";if(s!=="."&&s!==")")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOrdered`, expected `.` or `)`");return s}function dv(t){const s=t.options.rule||"*";if(s!=="*"&&s!=="-"&&s!=="_")throw new Error("Cannot serialize rules with `"+s+"` for `options.rule`, expected `*`, `-`, or `_`");return s}function JD(t,s,n,r){const o=n.enter("list"),u=n.bulletCurrent;let c=t.ordered?YD(n):Pf(n);const d=t.ordered?c==="."?")":".":QD(n);let p=s&&n.bulletLastUsed?c===n.bulletLastUsed:!1;if(!t.ordered){const f=t.children?t.children[0]:void 0;if((c==="*"||c==="-")&&f&&(!f.children||!f.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(p=!0),dv(n)===c&&f){let g=-1;for(;++g<t.children.length;){const x=t.children[g];if(x&&x.type==="listItem"&&x.children&&x.children[0]&&x.children[0].type==="thematicBreak"){p=!0;break}}}}p&&(c=d),n.bulletCurrent=c;const m=n.containerFlow(t,r);return n.bulletLastUsed=c,n.bulletCurrent=u,o(),m}function XD(t){const s=t.options.listItemIndent||"one";if(s!=="tab"&&s!=="one"&&s!=="mixed")throw new Error("Cannot serialize items with `"+s+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return s}function KD(t,s,n,r){const o=XD(n);let u=n.bulletCurrent||Pf(n);s&&s.type==="list"&&s.ordered&&(u=(typeof s.start=="number"&&s.start>-1?s.start:1)+(n.options.incrementListMarker===!1?0:s.children.indexOf(t))+u);let c=u.length+1;(o==="tab"||o==="mixed"&&(s&&s.type==="list"&&s.spread||t.spread))&&(c=Math.ceil(c/4)*4);const d=n.createTracker(r);d.move(u+" ".repeat(c-u.length)),d.shift(c);const p=n.enter("listItem"),m=n.indentLines(n.containerFlow(t,d.current()),f);return p(),m;function f(g,x,j){return x?(j?"":" ".repeat(c))+g:(j?u:u+" ".repeat(c-u.length))+g}}function WD(t,s,n,r){const o=n.enter("paragraph"),u=n.enter("phrasing"),c=n.containerPhrasing(t,r);return u(),o(),c}const ZD=$d(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function eE(t,s,n,r){return(t.children.some(function(c){return ZD(c)})?n.containerPhrasing:n.containerFlow).call(n,t,r)}function tE(t){const s=t.options.strong||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize strong with `"+s+"` for `options.strong`, expected `*`, or `_`");return s}hv.peek=nE;function hv(t,s,n,r){const o=tE(n),u=n.enter("strong"),c=n.createTracker(r),d=c.move(o+o);let p=c.move(n.containerPhrasing(t,{after:o,before:d,...c.current()}));const m=p.charCodeAt(0),f=kd(r.before.charCodeAt(r.before.length-1),m,o);f.inside&&(p=Nc(m)+p.slice(1));const g=p.charCodeAt(p.length-1),x=kd(r.after.charCodeAt(0),g,o);x.inside&&(p=p.slice(0,-1)+Nc(g));const j=c.move(o+o);return u(),n.attentionEncodeSurroundingInfo={after:x.outside,before:f.outside},d+p+j}function nE(t,s,n){return n.options.strong||"*"}function aE(t,s,n,r){return n.safe(t.value,r)}function sE(t){const s=t.options.ruleRepetition||3;if(s<3)throw new Error("Cannot serialize rules with repetition `"+s+"` for `options.ruleRepetition`, expected `3` or more");return s}function iE(t,s,n){const r=(dv(n)+(n.options.ruleSpaces?" ":"")).repeat(sE(n));return n.options.ruleSpaces?r.slice(0,-1):r}const mv={blockquote:DD,break:qb,code:OD,definition:RD,emphasis:av,hardBreak:qb,heading:MD,html:sv,image:iv,imageReference:rv,inlineCode:lv,link:cv,linkReference:uv,list:JD,listItem:KD,paragraph:WD,root:eE,strong:hv,text:aE,thematicBreak:iE};function rE(){return{enter:{table:lE,tableData:Hb,tableHeader:Hb,tableRow:cE},exit:{codeText:uE,table:oE,tableData:ip,tableHeader:ip,tableRow:ip}}}function lE(t){const s=t._align;this.enter({type:"table",align:s.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function oE(t){this.exit(t),this.data.inTable=void 0}function cE(t){this.enter({type:"tableRow",children:[]},t)}function ip(t){this.exit(t)}function Hb(t){this.enter({type:"tableCell",children:[]},t)}function uE(t){let s=this.resume();this.data.inTable&&(s=s.replace(/\\([\\|])/g,dE));const n=this.stack[this.stack.length-1];n.type,n.value=s,this.exit(t)}function dE(t,s){return s==="|"?s:t}function hE(t){const s=t||{},n=s.tableCellPadding,r=s.tablePipeAlign,o=s.stringLength,u=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:x,table:c,tableCell:p,tableRow:d}};function c(j,N,k,D){return m(f(j,k,D),j.align)}function d(j,N,k,D){const _=g(j,k,D),T=m([_]);return T.slice(0,T.indexOf(`
`))}function p(j,N,k,D){const _=k.enter("tableCell"),T=k.enter("phrasing"),E=k.containerPhrasing(j,{...D,before:u,after:u});return T(),_(),E}function m(j,N){return CD(j,{align:N,alignDelimiters:r,padding:n,stringLength:o})}function f(j,N,k){const D=j.children;let _=-1;const T=[],E=N.enter("table");for(;++_<D.length;)T[_]=g(D[_],N,k);return E(),T}function g(j,N,k){const D=j.children;let _=-1;const T=[],E=N.enter("tableRow");for(;++_<D.length;)T[_]=p(D[_],j,N,k);return E(),T}function x(j,N,k){let D=mv.inlineCode(j,N,k);return k.stack.includes("tableCell")&&(D=D.replace(/\|/g,"\\$&")),D}}function mE(){return{exit:{taskListCheckValueChecked:Vb,taskListCheckValueUnchecked:Vb,paragraph:fE}}}function pE(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:gE}}}function Vb(t){const s=this.stack[this.stack.length-2];s.type,s.checked=t.type==="taskListCheckValueChecked"}function fE(t){const s=this.stack[this.stack.length-2];if(s&&s.type==="listItem"&&typeof s.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const o=s.children;let u=-1,c;for(;++u<o.length;){const d=o[u];if(d.type==="paragraph"){c=d;break}}c===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(t)}function gE(t,s,n,r){const o=t.children[0],u=typeof t.checked=="boolean"&&o&&o.type==="paragraph",c="["+(t.checked?"x":" ")+"] ",d=n.createTracker(r);u&&d.move(c);let p=mv.listItem(t,s,n,{...r,...d.current()});return u&&(p=p.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,m)),p;function m(f){return f+c}}function xE(){return[J2(),gD(),jD(),rE(),mE()]}function yE(t){return{extensions:[X2(),xD(t),vD(),hE(t),pE()]}}const bE={tokenize:kE,partial:!0},pv={tokenize:CE,partial:!0},fv={tokenize:_E,partial:!0},gv={tokenize:DE,partial:!0},jE={tokenize:EE,partial:!0},xv={name:"wwwAutolink",tokenize:wE,previous:bv},yv={name:"protocolAutolink",tokenize:SE,previous:jv},Bs={name:"emailAutolink",tokenize:NE,previous:vv},ps={};function vE(){return{text:ps}}let gr=48;for(;gr<123;)ps[gr]=Bs,gr++,gr===58?gr=65:gr===91&&(gr=97);ps[43]=Bs;ps[45]=Bs;ps[46]=Bs;ps[95]=Bs;ps[72]=[Bs,yv];ps[104]=[Bs,yv];ps[87]=[Bs,xv];ps[119]=[Bs,xv];function NE(t,s,n){const r=this;let o,u;return c;function c(g){return!Hp(g)||!vv.call(r,r.previous)||If(r.events)?n(g):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),d(g))}function d(g){return Hp(g)?(t.consume(g),d):g===64?(t.consume(g),p):n(g)}function p(g){return g===46?t.check(jE,f,m)(g):g===45||g===95||$n(g)?(u=!0,t.consume(g),p):f(g)}function m(g){return t.consume(g),o=!0,p}function f(g){return u&&o&&Gn(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),s(g)):n(g)}}function wE(t,s,n){const r=this;return o;function o(c){return c!==87&&c!==119||!bv.call(r,r.previous)||If(r.events)?n(c):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(bE,t.attempt(pv,t.attempt(fv,u),n),n)(c))}function u(c){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),s(c)}}function SE(t,s,n){const r=this;let o="",u=!1;return c;function c(g){return(g===72||g===104)&&jv.call(r,r.previous)&&!If(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),o+=String.fromCodePoint(g),t.consume(g),d):n(g)}function d(g){if(Gn(g)&&o.length<5)return o+=String.fromCodePoint(g),t.consume(g),d;if(g===58){const x=o.toLowerCase();if(x==="http"||x==="https")return t.consume(g),p}return n(g)}function p(g){return g===47?(t.consume(g),u?m:(u=!0,p)):n(g)}function m(g){return g===null||Nd(g)||Jt(g)||Sr(g)||zd(g)?n(g):t.attempt(pv,t.attempt(fv,f),n)(g)}function f(g){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),s(g)}}function kE(t,s,n){let r=0;return o;function o(c){return(c===87||c===119)&&r<3?(r++,t.consume(c),o):c===46&&r===3?(t.consume(c),u):n(c)}function u(c){return c===null?n(c):s(c)}}function CE(t,s,n){let r,o,u;return c;function c(m){return m===46||m===95?t.check(gv,p,d)(m):m===null||Jt(m)||Sr(m)||m!==45&&zd(m)?p(m):(u=!0,t.consume(m),c)}function d(m){return m===95?r=!0:(o=r,r=void 0),t.consume(m),c}function p(m){return o||r||!u?n(m):s(m)}}function _E(t,s){let n=0,r=0;return o;function o(c){return c===40?(n++,t.consume(c),o):c===41&&r<n?u(c):c===33||c===34||c===38||c===39||c===41||c===42||c===44||c===46||c===58||c===59||c===60||c===63||c===93||c===95||c===126?t.check(gv,s,u)(c):c===null||Jt(c)||Sr(c)?s(c):(t.consume(c),o)}function u(c){return c===41&&r++,t.consume(c),o}}function DE(t,s,n){return r;function r(d){return d===33||d===34||d===39||d===41||d===42||d===44||d===46||d===58||d===59||d===63||d===95||d===126?(t.consume(d),r):d===38?(t.consume(d),u):d===93?(t.consume(d),o):d===60||d===null||Jt(d)||Sr(d)?s(d):n(d)}function o(d){return d===null||d===40||d===91||Jt(d)||Sr(d)?s(d):r(d)}function u(d){return Gn(d)?c(d):n(d)}function c(d){return d===59?(t.consume(d),r):Gn(d)?(t.consume(d),c):n(d)}}function EE(t,s,n){return r;function r(u){return t.consume(u),o}function o(u){return $n(u)?n(u):s(u)}}function bv(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||Jt(t)}function jv(t){return!Gn(t)}function vv(t){return!(t===47||Hp(t))}function Hp(t){return t===43||t===45||t===46||t===95||$n(t)}function If(t){let s=t.length,n=!1;for(;s--;){const r=t[s][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const TE={tokenize:$E,partial:!0};function AE(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:zE,continuation:{tokenize:RE},exit:LE}},text:{91:{name:"gfmFootnoteCall",tokenize:OE},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:PE,resolveTo:IE}}}}function PE(t,s,n){const r=this;let o=r.events.length;const u=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let c;for(;o--;){const p=r.events[o][1];if(p.type==="labelImage"){c=p;break}if(p.type==="gfmFootnoteCall"||p.type==="labelLink"||p.type==="label"||p.type==="image"||p.type==="link")break}return d;function d(p){if(!c||!c._balanced)return n(p);const m=Ha(r.sliceSerialize({start:c.end,end:r.now()}));return m.codePointAt(0)!==94||!u.includes(m.slice(1))?n(p):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(p),t.exit("gfmFootnoteCallLabelMarker"),s(p))}}function IE(t,s){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},o={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};o.end.column++,o.end.offset++,o.end._bufferIndex++;const u={type:"gfmFootnoteCallString",start:Object.assign({},o.end),end:Object.assign({},t[t.length-1][1].start)},c={type:"chunkString",contentType:"string",start:Object.assign({},u.start),end:Object.assign({},u.end)},d=[t[n+1],t[n+2],["enter",r,s],t[n+3],t[n+4],["enter",o,s],["exit",o,s],["enter",u,s],["enter",c,s],["exit",c,s],["exit",u,s],t[t.length-2],t[t.length-1],["exit",r,s]];return t.splice(n,t.length-n+1,...d),t}function OE(t,s,n){const r=this,o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let u=0,c;return d;function d(g){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(g),t.exit("gfmFootnoteCallLabelMarker"),p}function p(g){return g!==94?n(g):(t.enter("gfmFootnoteCallMarker"),t.consume(g),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",m)}function m(g){if(u>999||g===93&&!c||g===null||g===91||Jt(g))return n(g);if(g===93){t.exit("chunkString");const x=t.exit("gfmFootnoteCallString");return o.includes(Ha(r.sliceSerialize(x)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(g),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),s):n(g)}return Jt(g)||(c=!0),u++,t.consume(g),g===92?f:m}function f(g){return g===91||g===92||g===93?(t.consume(g),u++,m):m(g)}}function zE(t,s,n){const r=this,o=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let u,c=0,d;return p;function p(N){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(N),t.exit("gfmFootnoteDefinitionLabelMarker"),m}function m(N){return N===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(N),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",f):n(N)}function f(N){if(c>999||N===93&&!d||N===null||N===91||Jt(N))return n(N);if(N===93){t.exit("chunkString");const k=t.exit("gfmFootnoteDefinitionLabelString");return u=Ha(r.sliceSerialize(k)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(N),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),x}return Jt(N)||(d=!0),c++,t.consume(N),N===92?g:f}function g(N){return N===91||N===92||N===93?(t.consume(N),c++,f):f(N)}function x(N){return N===58?(t.enter("definitionMarker"),t.consume(N),t.exit("definitionMarker"),o.includes(u)||o.push(u),Ot(t,j,"gfmFootnoteDefinitionWhitespace")):n(N)}function j(N){return s(N)}}function RE(t,s,n){return t.check(_c,s,t.attempt(TE,s,n))}function LE(t){t.exit("gfmFootnoteDefinition")}function $E(t,s,n){const r=this;return Ot(t,o,"gfmFootnoteDefinitionIndent",5);function o(u){const c=r.events[r.events.length-1];return c&&c[1].type==="gfmFootnoteDefinitionIndent"&&c[2].sliceSerialize(c[1],!0).length===4?s(u):n(u)}}function FE(t){let n=(t||{}).singleTilde;const r={name:"strikethrough",tokenize:u,resolveAll:o};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function o(c,d){let p=-1;for(;++p<c.length;)if(c[p][0]==="enter"&&c[p][1].type==="strikethroughSequenceTemporary"&&c[p][1]._close){let m=p;for(;m--;)if(c[m][0]==="exit"&&c[m][1].type==="strikethroughSequenceTemporary"&&c[m][1]._open&&c[p][1].end.offset-c[p][1].start.offset===c[m][1].end.offset-c[m][1].start.offset){c[p][1].type="strikethroughSequence",c[m][1].type="strikethroughSequence";const f={type:"strikethrough",start:Object.assign({},c[m][1].start),end:Object.assign({},c[p][1].end)},g={type:"strikethroughText",start:Object.assign({},c[m][1].end),end:Object.assign({},c[p][1].start)},x=[["enter",f,d],["enter",c[m][1],d],["exit",c[m][1],d],["enter",g,d]],j=d.parser.constructs.insideSpan.null;j&&ja(x,x.length,0,Rd(j,c.slice(m+1,p),d)),ja(x,x.length,0,[["exit",g,d],["enter",c[p][1],d],["exit",c[p][1],d],["exit",f,d]]),ja(c,m-1,p-m+3,x),p=m+x.length-2;break}}for(p=-1;++p<c.length;)c[p][1].type==="strikethroughSequenceTemporary"&&(c[p][1].type="data");return c}function u(c,d,p){const m=this.previous,f=this.events;let g=0;return x;function x(N){return m===126&&f[f.length-1][1].type!=="characterEscape"?p(N):(c.enter("strikethroughSequenceTemporary"),j(N))}function j(N){const k=Fl(m);if(N===126)return g>1?p(N):(c.consume(N),g++,j);if(g<2&&!n)return p(N);const D=c.exit("strikethroughSequenceTemporary"),_=Fl(N);return D._open=!_||_===2&&!!k,D._close=!k||k===2&&!!_,d(N)}}}class ME{constructor(){this.map=[]}add(s,n,r){BE(this,s,n,r)}consume(s){if(this.map.sort(function(u,c){return u[0]-c[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(s.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),s.length=this.map[n][0];r.push(s.slice()),s.length=0;let o=r.pop();for(;o;){for(const u of o)s.push(u);o=r.pop()}this.map.length=0}}function BE(t,s,n,r){let o=0;if(!(n===0&&r.length===0)){for(;o<t.map.length;){if(t.map[o][0]===s){t.map[o][1]+=n,t.map[o][2].push(...r);return}o+=1}t.map.push([s,n,r])}}function UE(t,s){let n=!1;const r=[];for(;s<t.length;){const o=t[s];if(n){if(o[0]==="enter")o[1].type==="tableContent"&&r.push(t[s+1][1].type==="tableDelimiterMarker"?"left":"none");else if(o[1].type==="tableContent"){if(t[s-1][1].type==="tableDelimiterMarker"){const u=r.length-1;r[u]=r[u]==="left"?"center":"right"}}else if(o[1].type==="tableDelimiterRow")break}else o[0]==="enter"&&o[1].type==="tableDelimiterRow"&&(n=!0);s+=1}return r}function qE(){return{flow:{null:{name:"table",tokenize:HE,resolveAll:VE}}}}function HE(t,s,n){const r=this;let o=0,u=0,c;return d;function d(C){let A=r.events.length-1;for(;A>-1;){const J=r.events[A][1].type;if(J==="lineEnding"||J==="linePrefix")A--;else break}const P=A>-1?r.events[A][1].type:null,$=P==="tableHead"||P==="tableRow"?I:p;return $===I&&r.parser.lazy[r.now().line]?n(C):$(C)}function p(C){return t.enter("tableHead"),t.enter("tableRow"),m(C)}function m(C){return C===124||(c=!0,u+=1),f(C)}function f(C){return C===null?n(C):ct(C)?u>1?(u=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(C),t.exit("lineEnding"),j):n(C):Tt(C)?Ot(t,f,"whitespace")(C):(u+=1,c&&(c=!1,o+=1),C===124?(t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),c=!0,f):(t.enter("data"),g(C)))}function g(C){return C===null||C===124||Jt(C)?(t.exit("data"),f(C)):(t.consume(C),C===92?x:g)}function x(C){return C===92||C===124?(t.consume(C),g):g(C)}function j(C){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(C):(t.enter("tableDelimiterRow"),c=!1,Tt(C)?Ot(t,N,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):N(C))}function N(C){return C===45||C===58?D(C):C===124?(c=!0,t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),k):X(C)}function k(C){return Tt(C)?Ot(t,D,"whitespace")(C):D(C)}function D(C){return C===58?(u+=1,c=!0,t.enter("tableDelimiterMarker"),t.consume(C),t.exit("tableDelimiterMarker"),_):C===45?(u+=1,_(C)):C===null||ct(C)?U(C):X(C)}function _(C){return C===45?(t.enter("tableDelimiterFiller"),T(C)):X(C)}function T(C){return C===45?(t.consume(C),T):C===58?(c=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(C),t.exit("tableDelimiterMarker"),E):(t.exit("tableDelimiterFiller"),E(C))}function E(C){return Tt(C)?Ot(t,U,"whitespace")(C):U(C)}function U(C){return C===124?N(C):C===null||ct(C)?!c||o!==u?X(C):(t.exit("tableDelimiterRow"),t.exit("tableHead"),s(C)):X(C)}function X(C){return n(C)}function I(C){return t.enter("tableRow"),F(C)}function F(C){return C===124?(t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),F):C===null||ct(C)?(t.exit("tableRow"),s(C)):Tt(C)?Ot(t,F,"whitespace")(C):(t.enter("data"),B(C))}function B(C){return C===null||C===124||Jt(C)?(t.exit("data"),F(C)):(t.consume(C),C===92?G:B)}function G(C){return C===92||C===124?(t.consume(C),B):B(C)}}function VE(t,s){let n=-1,r=!0,o=0,u=[0,0,0,0],c=[0,0,0,0],d=!1,p=0,m,f,g;const x=new ME;for(;++n<t.length;){const j=t[n],N=j[1];j[0]==="enter"?N.type==="tableHead"?(d=!1,p!==0&&(Gb(x,s,p,m,f),f=void 0,p=0),m={type:"table",start:Object.assign({},N.start),end:Object.assign({},N.end)},x.add(n,0,[["enter",m,s]])):N.type==="tableRow"||N.type==="tableDelimiterRow"?(r=!0,g=void 0,u=[0,0,0,0],c=[0,n+1,0,0],d&&(d=!1,f={type:"tableBody",start:Object.assign({},N.start),end:Object.assign({},N.end)},x.add(n,0,[["enter",f,s]])),o=N.type==="tableDelimiterRow"?2:f?3:1):o&&(N.type==="data"||N.type==="tableDelimiterMarker"||N.type==="tableDelimiterFiller")?(r=!1,c[2]===0&&(u[1]!==0&&(c[0]=c[1],g=sd(x,s,u,o,void 0,g),u=[0,0,0,0]),c[2]=n)):N.type==="tableCellDivider"&&(r?r=!1:(u[1]!==0&&(c[0]=c[1],g=sd(x,s,u,o,void 0,g)),u=c,c=[u[1],n,0,0])):N.type==="tableHead"?(d=!0,p=n):N.type==="tableRow"||N.type==="tableDelimiterRow"?(p=n,u[1]!==0?(c[0]=c[1],g=sd(x,s,u,o,n,g)):c[1]!==0&&(g=sd(x,s,c,o,n,g)),o=0):o&&(N.type==="data"||N.type==="tableDelimiterMarker"||N.type==="tableDelimiterFiller")&&(c[3]=n)}for(p!==0&&Gb(x,s,p,m,f),x.consume(s.events),n=-1;++n<s.events.length;){const j=s.events[n];j[0]==="enter"&&j[1].type==="table"&&(j[1]._align=UE(s.events,n))}return t}function sd(t,s,n,r,o,u){const c=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",d="tableContent";n[0]!==0&&(u.end=Object.assign({},El(s.events,n[0])),t.add(n[0],0,[["exit",u,s]]));const p=El(s.events,n[1]);if(u={type:c,start:Object.assign({},p),end:Object.assign({},p)},t.add(n[1],0,[["enter",u,s]]),n[2]!==0){const m=El(s.events,n[2]),f=El(s.events,n[3]),g={type:d,start:Object.assign({},m),end:Object.assign({},f)};if(t.add(n[2],0,[["enter",g,s]]),r!==2){const x=s.events[n[2]],j=s.events[n[3]];if(x[1].end=Object.assign({},j[1].end),x[1].type="chunkText",x[1].contentType="text",n[3]>n[2]+1){const N=n[2]+1,k=n[3]-n[2]-1;t.add(N,k,[])}}t.add(n[3]+1,0,[["exit",g,s]])}return o!==void 0&&(u.end=Object.assign({},El(s.events,o)),t.add(o,0,[["exit",u,s]]),u=void 0),u}function Gb(t,s,n,r,o){const u=[],c=El(s.events,n);o&&(o.end=Object.assign({},c),u.push(["exit",o,s])),r.end=Object.assign({},c),u.push(["exit",r,s]),t.add(n+1,0,u)}function El(t,s){const n=t[s],r=n[0]==="enter"?"start":"end";return n[1][r]}const GE={name:"tasklistCheck",tokenize:YE};function QE(){return{text:{91:GE}}}function YE(t,s,n){const r=this;return o;function o(p){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(p):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(p),t.exit("taskListCheckMarker"),u)}function u(p){return Jt(p)?(t.enter("taskListCheckValueUnchecked"),t.consume(p),t.exit("taskListCheckValueUnchecked"),c):p===88||p===120?(t.enter("taskListCheckValueChecked"),t.consume(p),t.exit("taskListCheckValueChecked"),c):n(p)}function c(p){return p===93?(t.enter("taskListCheckMarker"),t.consume(p),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),d):n(p)}function d(p){return ct(p)?s(p):Tt(p)?t.check({tokenize:JE},s,n)(p):n(p)}}function JE(t,s,n){return Ot(t,r,"whitespace");function r(o){return o===null?n(o):s(o)}}function XE(t){return A0([vE(),AE(),FE(t),qE(),QE()])}const KE={};function Ln(t){const s=this,n=t||KE,r=s.data(),o=r.micromarkExtensions||(r.micromarkExtensions=[]),u=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),c=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);o.push(XE(n)),u.push(xE()),c.push(yE(n))}const WE="_container_plki7_3",ZE="_header_plki7_21",eT="_titleGroup_plki7_41",tT="_title_plki7_41",nT="_closeButton_plki7_59",aT="_messageList_plki7_79",sT="_emptyState_plki7_108",iT="_emptyStateIcon_plki7_119",rT="_exampleContainer_plki7_145",lT="_exampleChip_plki7_153",oT="_messageRow_plki7_176",cT="_messageRowUser_plki7_194",uT="_messageRowModel_plki7_198",dT="_messageRowSystem_plki7_202",hT="_bubble_plki7_208",mT="_bubbleUser_plki7_224",pT="_bubbleModel_plki7_234",fT="_bubbleSystem_plki7_247",gT="_processingIndicator_plki7_330",xT="_spin_plki7_343",yT="_inputArea_plki7_358",bT="_imagePreviewContainer_plki7_365",jT="_inputContainer_plki7_376",vT="_inputField_plki7_393",NT="_sendButton_plki7_407",Ft={container:WE,header:ZE,titleGroup:eT,title:tT,closeButton:nT,messageList:aT,emptyState:sT,emptyStateIcon:iT,exampleContainer:rT,exampleChip:lT,messageRow:oT,messageRowUser:cT,messageRowModel:uT,messageRowSystem:dT,bubble:hT,bubbleUser:mT,bubbleModel:pT,bubbleSystem:fT,processingIndicator:gT,spin:xT,inputArea:yT,imagePreviewContainer:bT,inputContainer:jT,inputField:vT,sendButton:NT},Nv=({onClose:t,settings:s,staffList:n,onSettingsUpdate:r,onStaffUpdate:o,onHighlight:u})=>{const{chatQuery:c,setChatQuery:d,chatHistory:p,isProcessing:m,handleSendMessage:f,refreshChat:g,stopGeneration:x,selectedImage:j,handleImageSelect:N,clearImage:k}=gf({settings:s,staffList:n,onSettingsUpdate:r,onStaffUpdate:o,onHighlight:u}),D=y.useRef(null),_=y.useRef(null),T=()=>{var I;(I=D.current)==null||I.scrollIntoView({behavior:"smooth"})};y.useEffect(()=>{T()},[p,m]);const E=I=>{var B;const F=(B=I.target.files)==null?void 0:B[0];F&&N(F)},U=["Check Paracetamol stock","Go to Pharmacy","Analysis for last month","Add nurse Sarah"],X=I=>{d(I)};return e.jsxs("div",{className:Ft.container,children:[e.jsxs("header",{className:Ft.header,children:[e.jsxs("div",{className:Ft.titleGroup,children:[e.jsx(jd,{size:20,className:"text-violet-600"}),e.jsx("h3",{className:Ft.title,children:"Clinic Assistant"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:g,className:Ft.closeButton,title:"Refresh Chat",children:e.jsx(Wj,{size:18})}),e.jsx("button",{onClick:t,className:Ft.closeButton,title:"Close",children:e.jsx(Et,{size:20})})]})]}),e.jsxs("div",{className:Ft.messageList,children:[p.length===0&&e.jsxs("div",{className:Ft.emptyState,children:[e.jsx(jd,{size:48,className:Ft.emptyStateIcon}),e.jsx("p",{children:"How can I help you manage the clinic today?"}),e.jsx("div",{className:Ft.exampleContainer,children:U.map((I,F)=>e.jsx("button",{className:Ft.exampleChip,onClick:()=>X(I),children:I},F))})]}),p.map((I,F)=>e.jsx("div",{className:`${Ft.messageRow} ${I.role==="user"?Ft.messageRowUser:I.role==="model"?Ft.messageRowModel:Ft.messageRowSystem}`,children:e.jsx("div",{className:`${Ft.bubble} ${I.role==="user"?Ft.bubbleUser:I.role==="model"?Ft.bubbleModel:Ft.bubbleSystem}`,children:I.role==="user"||I.role==="system"?I.text:e.jsx(xa,{remarkPlugins:[Ln],children:I.text})})},F)),m&&e.jsx("div",{className:`${Ft.messageRow} ${Ft.messageRowModel}`,children:e.jsxs("div",{className:Ft.processingIndicator,children:[e.jsx(Va,{size:14,className:Ft.spin}),"Thinking..."]})}),e.jsx("div",{ref:D})]}),e.jsxs("div",{className:Ft.inputArea,children:[j&&e.jsxs("div",{className:Ft.imagePreviewContainer,style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",width:"60px",height:"60px",border:"1px solid #e5e7eb",borderRadius:"4px",overflow:"hidden"},children:[e.jsx("img",{src:j,alt:"Selected",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("button",{onClick:k,style:{position:"absolute",top:0,right:0,background:"rgba(0,0,0,0.5)",color:"white",border:"none",cursor:"pointer",padding:"1px"},children:e.jsx(Et,{size:12})})]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#6b7280"},children:"Image attached"})]}),e.jsxs("div",{className:Ft.inputContainer,children:[e.jsx("input",{type:"file",ref:_,onChange:E,accept:"image/*",style:{display:"none"}}),e.jsx("button",{className:Ft.sendButton,onClick:()=>{var I;return(I=_.current)==null?void 0:I.click()},disabled:m,title:"Attach Image",style:{marginRight:"0.5rem",color:"#6b7280"},children:e.jsx(Td,{size:18})}),e.jsx("input",{type:"text",className:Ft.inputField,placeholder:"Type your request...",value:c,onChange:I=>d(I.target.value),onKeyDown:I=>I.key==="Enter"&&!m&&f(),disabled:m,autoFocus:!0}),m?e.jsx("button",{className:Ft.sendButton,onClick:x,title:"Stop Generating",style:{color:"#ef4444"},children:e.jsx(bw,{size:18,fill:"currentColor"})}):e.jsx("button",{className:Ft.sendButton,onClick:()=>f(),disabled:!c.trim()&&!j,children:e.jsx(Ad,{size:18})})]})]})]})};var wT=Ww();const Ec=Sc(wT);var ST=jw();const Ri=Sc(ST),kl=new Map,wv=(()=>{const t=new Promise(s=>{window.addEventListener("pointerdown",s,{once:!0}),window.addEventListener("keydown",s,{once:!0})});return async s=>{try{const n=new Audio;if(n.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",await n.play(),s!=null&&s.id&&kl.has(s.id)){const o=kl.get(s.id);if(o)return o}const r=new AudioContext(s);return s!=null&&s.id&&kl.set(s.id,r),r}catch{if(await t,s!=null&&s.id&&kl.has(s.id)){const o=kl.get(s.id);if(o)return o}const r=new AudioContext(s);return s!=null&&s.id&&kl.set(s.id,r),r}}})();function kT(t){var s=atob(t),n=new Uint8Array(s.length);for(let r=0;r<s.length;r++)n[r]=s.charCodeAt(r);return n.buffer}const CT=`
class AudioProcessingWorklet extends AudioWorkletProcessor {

  // send and clear buffer every 2048 samples, 
  // which at 16khz is about 8 times a second
  buffer = new Int16Array(2048);

  // current write index
  bufferWriteIndex = 0;

  constructor() {
    super();
    this.hasAudio = false;
  }

  /**
   * @param inputs Float32Array[][] [input#][channel#][sample#] so to access first inputs 1st channel inputs[0][0]
   * @param outputs Float32Array[][]
   */
  process(inputs) {
    if (inputs[0].length) {
      const channel0 = inputs[0][0];
      this.processChunk(channel0);
    }
    return true;
  }

  sendAndClearBuffer(){
    this.port.postMessage({
      event: "chunk",
      data: {
        int16arrayBuffer: this.buffer.slice(0, this.bufferWriteIndex).buffer,
      },
    });
    this.bufferWriteIndex = 0;
  }

  processChunk(float32Array) {
    const l = float32Array.length;
    
    for (let i = 0; i < l; i++) {
      // convert float32 -1 to 1 to int16 -32768 to 32767
      const int16Value = float32Array[i] * 32768;
      this.buffer[this.bufferWriteIndex++] = int16Value;
      if(this.bufferWriteIndex >= this.buffer.length) {
        this.sendAndClearBuffer();
      }
    }

    if(this.bufferWriteIndex >= this.buffer.length) {
      this.sendAndClearBuffer();
    }
  }
}
`,Sv=`
  class VolMeter extends AudioWorkletProcessor {
    volume
    updateIntervalInMS
    nextUpdateFrame

    constructor() {
      super()
      this.volume = 0
      this.updateIntervalInMS = 25
      this.nextUpdateFrame = this.updateIntervalInMS
      this.port.onmessage = event => {
        if (event.data.updateIntervalInMS) {
          this.updateIntervalInMS = event.data.updateIntervalInMS
        }
      }
    }

    get intervalInFrames() {
      return (this.updateIntervalInMS / 1000) * sampleRate
    }

    process(inputs) {
      const input = inputs[0]

      if (input.length > 0) {
        const samples = input[0]
        let sum = 0
        let rms = 0

        for (let i = 0; i < samples.length; ++i) {
          sum += samples[i] * samples[i]
        }

        rms = Math.sqrt(sum / samples.length)
        this.volume = Math.max(rms, this.volume * 0.7)

        this.nextUpdateFrame -= samples.length
        if (this.nextUpdateFrame < 0) {
          this.nextUpdateFrame += this.intervalInFrames
          this.port.postMessage({volume: this.volume})
        }
      }

      return true
    }
  }`,id=new Map,Vp=(t,s)=>{const n=new Blob([`registerProcessor("${t}", ${s})`],{type:"application/javascript"});return URL.createObjectURL(n)};function _T(t){for(var s="",n=new Uint8Array(t),r=n.byteLength,o=0;o<r;o++)s+=String.fromCharCode(n[o]);return window.btoa(s)}class kv extends u0{constructor(n=16e3){super();Gt(this,"stream");Gt(this,"audioContext");Gt(this,"source");Gt(this,"recording",!1);Gt(this,"recordingWorklet");Gt(this,"vuWorklet");Gt(this,"starting",null);this.sampleRate=n}async start(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Could not request user media");this.starting=new Promise(async n=>{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=await wv({sampleRate:this.sampleRate}),this.source=this.audioContext.createMediaStreamSource(this.stream);const r="audio-recorder-worklet",o=Vp(r,CT);await this.audioContext.audioWorklet.addModule(o),this.recordingWorklet=new AudioWorkletNode(this.audioContext,r),this.recordingWorklet.port.onmessage=async c=>{const d=c.data.data.int16arrayBuffer;if(d){const p=_T(d);this.emit("data",p)}},this.source.connect(this.recordingWorklet);const u="vu-meter";await this.audioContext.audioWorklet.addModule(Vp(u,Sv)),this.vuWorklet=new AudioWorkletNode(this.audioContext,u),this.vuWorklet.port.onmessage=c=>{this.emit("volume",c.data.volume)},this.source.connect(this.vuWorklet),this.recording=!0,n(),this.starting=null})}stop(){const n=()=>{var r,o;(r=this.source)==null||r.disconnect(),(o=this.stream)==null||o.getTracks().forEach(u=>u.stop()),this.stream=void 0,this.recordingWorklet=void 0,this.vuWorklet=void 0,this.audioContext&&(this.audioContext.close(),this.audioContext=void 0)};if(this.starting){this.starting.then(n);return}n()}}const DT=3,ET=({active:t,volume:s,hover:n})=>{const r=y.useRef([]);return y.useEffect(()=>{let o=null;const u=()=>{r.current.forEach((c,d)=>{c&&(c.style.height=`${Math.min(24,4+s*(d===1?400:60))}px`)}),o=window.setTimeout(u,100)};return u(),()=>clearTimeout(o)},[s]),e.jsx("div",{className:Ri("audioPulse",{active:t,hover:n}),children:Array(DT).fill(null).map((o,u)=>e.jsx("div",{ref:c=>{r.current[u]=c},style:{animationDelay:`${u*133}ms`}},u))})};var Cv=Zw();class TT{constructor(s){Gt(this,"sampleRate",24e3);Gt(this,"bufferSize",7680);Gt(this,"audioQueue",[]);Gt(this,"isPlaying",!1);Gt(this,"isStreamComplete",!1);Gt(this,"checkInterval",null);Gt(this,"scheduledTime",0);Gt(this,"initialBufferTime",.1);Gt(this,"gainNode");Gt(this,"source");Gt(this,"endOfQueueAudioSource",null);Gt(this,"onComplete",()=>{});this.context=s,this.gainNode=this.context.createGain(),this.source=this.context.createBufferSource(),this.gainNode.connect(this.context.destination),this.addPCM16=this.addPCM16.bind(this)}async addWorklet(s,n,r){let o=id.get(this.context);if(o&&o[s])return o[s].handlers.push(r),Promise.resolve(this);o||(id.set(this.context,{}),o=id.get(this.context)),o[s]={handlers:[r]};const u=Vp(s,n);await this.context.audioWorklet.addModule(u);const c=new AudioWorkletNode(this.context,s);return o[s].node=c,this}_processPCM16Chunk(s){const n=new Float32Array(s.length/2),r=new DataView(s.buffer);for(let o=0;o<s.length/2;o++)try{const u=r.getInt16(o*2,!0);n[o]=u/32768}catch(u){console.error(u)}return n}addPCM16(s){this.isStreamComplete=!1;let n=this._processPCM16Chunk(s);for(;n.length>=this.bufferSize;){const r=n.slice(0,this.bufferSize);this.audioQueue.push(r),n=n.slice(this.bufferSize)}n.length>0&&this.audioQueue.push(n),this.isPlaying||(this.isPlaying=!0,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.scheduleNextBuffer())}createAudioBuffer(s){const n=this.context.createBuffer(1,s.length,this.sampleRate);return n.getChannelData(0).set(s),n}scheduleNextBuffer(){for(;this.audioQueue.length>0&&this.scheduledTime<this.context.currentTime+.2;){const n=this.audioQueue.shift(),r=this.createAudioBuffer(n),o=this.context.createBufferSource();this.audioQueue.length===0&&(this.endOfQueueAudioSource&&(this.endOfQueueAudioSource.onended=null),this.endOfQueueAudioSource=o,o.onended=()=>{!this.audioQueue.length&&this.endOfQueueAudioSource===o&&(this.endOfQueueAudioSource=null,this.onComplete())}),o.buffer=r,o.connect(this.gainNode);const u=id.get(this.context);u&&Object.entries(u).forEach(([,d])=>{const{node:p,handlers:m}=d;p&&(o.connect(p),p.port.onmessage=function(f){m.forEach(g=>{g.call(p.port,f)})},p.connect(this.context.destination))});const c=Math.max(this.scheduledTime,this.context.currentTime);o.start(c),this.scheduledTime=c+r.duration}if(this.audioQueue.length===0)this.isStreamComplete?(this.isPlaying=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)):this.checkInterval||(this.checkInterval=window.setInterval(()=>{this.audioQueue.length>0&&this.scheduleNextBuffer()},100));else{const n=(this.scheduledTime-this.context.currentTime)*1e3;setTimeout(()=>this.scheduleNextBuffer(),Math.max(0,n-50))}}stop(){this.isPlaying=!1,this.isStreamComplete=!0,this.audioQueue=[],this.scheduledTime=this.context.currentTime,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.1),setTimeout(()=>{this.gainNode.disconnect(),this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)},200)}async resume(){this.context.state==="suspended"&&await this.context.resume(),this.isStreamComplete=!1,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.gainNode.gain.setValueAtTime(1,this.context.currentTime)}complete(){this.isStreamComplete=!0,this.onComplete()}}function AT(){const[t,s]=y.useState(null),[n,r]=y.useState(!1);return y.useEffect(()=>{const d=()=>{r(!1),s(null)};if(t)return t.getTracks().forEach(p=>p.addEventListener("ended",d)),()=>{t.getTracks().forEach(p=>p.removeEventListener("ended",d))}},[t]),{type:"screen",start:async()=>{const d=await navigator.mediaDevices.getDisplayMedia({video:!0});return s(d),r(!0),d},stop:()=>{t&&(t.getTracks().forEach(d=>d.stop()),s(null),r(!1))},isStreaming:n,stream:t}}function PT(){const[t,s]=y.useState(null),[n,r]=y.useState(!1);return y.useEffect(()=>{const d=()=>{r(!1),s(null)};if(t)return t.getTracks().forEach(p=>p.addEventListener("ended",d)),()=>{t.getTracks().forEach(p=>p.removeEventListener("ended",d))}},[t]),{type:"webcam",start:async()=>{const d=await navigator.mediaDevices.getUserMedia({video:!0});return s(d),r(!0),d},stop:()=>{t&&(t.getTracks().forEach(d=>d.stop()),s(null),r(!1))},isStreaming:n,stream:t}}class IT extends u0{constructor(n){super();Gt(this,"client");Gt(this,"_status","disconnected");Gt(this,"_session",null);Gt(this,"_model",null);Gt(this,"config",null);this.client=new uf(n),this.send=this.send.bind(this),this.onopen=this.onopen.bind(this),this.onerror=this.onerror.bind(this),this.onclose=this.onclose.bind(this),this.onmessage=this.onmessage.bind(this)}get status(){return this._status}get session(){return this._session}get model(){return this._model}getConfig(){return{...this.config}}log(n,r){const o={date:new Date,type:n,message:r};this.emit("log",o)}async connect(n,r){if(this._status==="connected"||this._status==="connecting")return!1;this._status="connecting",this.config=r,this._model=n;const o={onopen:this.onopen,onmessage:this.onmessage,onerror:this.onerror,onclose:this.onclose};try{this._session=await this.client.live.connect({model:n,config:r,callbacks:o})}catch(u){return console.error("Error connecting to GenAI Live:",u),this._status="disconnected",!1}return this._status="connected",!0}disconnect(){var n;return this.session?((n=this.session)==null||n.close(),this._session=null,this._status="disconnected",this.log("client.close","Disconnected"),!0):!1}onopen(){this.log("client.open","Connected"),this.emit("open")}onerror(n){this.log("server.error",n.message),this.emit("error",n)}onclose(n){this.log("server.close",`disconnected ${n.reason?`with reason: ${n.reason}`:""}`),this.emit("close",n)}async onmessage(n){var r;if(n.setupComplete){this.log("server.send","setupComplete"),this.emit("setupcomplete");return}if(n.toolCall){this.log("server.toolCall",n),this.emit("toolcall",n.toolCall);return}if(n.toolCallCancellation){this.log("server.toolCallCancellation",n),this.emit("toolcallcancellation",n.toolCallCancellation);return}if(n.serverContent){const{serverContent:o}=n;if("interrupted"in o){this.log("server.content","interrupted"),this.emit("interrupted");return}if("turnComplete"in o&&(this.log("server.content","turnComplete"),this.emit("turncomplete")),"modelTurn"in o){let u=((r=o.modelTurn)==null?void 0:r.parts)||[];const c=u.filter(f=>{var g;return f.inlineData&&((g=f.inlineData.mimeType)==null?void 0:g.startsWith("audio/pcm"))}),d=c.map(f=>{var g;return(g=f.inlineData)==null?void 0:g.data}),p=Cv.difference(u,c);if(d.forEach(f=>{if(f){const g=kT(f);this.emit("audio",g),this.log("server.audio",`buffer (${g.byteLength})`)}}),!p.length)return;u=p;const m={modelTurn:{parts:u}};this.emit("content",m),this.log("server.content",n)}}else console.log("received unmatched message",n)}sendRealtimeInput(n){var c;let r=!1,o=!1;for(const d of n)if((c=this.session)==null||c.sendRealtimeInput({media:d}),d.mimeType.includes("audio")&&(r=!0),d.mimeType.includes("image")&&(o=!0),r&&o)break;const u=r&&o?"audio + video":r?"audio":o?"video":"unknown";this.log("client.realtimeInput",u)}sendToolResponse(n){var r;n.functionResponses&&n.functionResponses.length&&((r=this.session)==null||r.sendToolResponse({functionResponses:n.functionResponses}),this.log("client.toolResponse",n))}send(n,r=!0){var o;(o=this.session)==null||o.sendClientContent({turns:n,turnComplete:r}),this.log("client.send",{turns:Array.isArray(n)?n:[n],turnComplete:r})}}function OT(t){const s=y.useMemo(()=>new IT(t),[t]),n=y.useRef(null),[r,o]=y.useState("models/gemini-2.5-flash-live-preview"),[u,c]=y.useState({}),[d,p]=y.useState(!1),[m,f]=y.useState(0),[g,x]=y.useState(null);y.useEffect(()=>{n.current||wv({id:"audio-out"}).then(k=>{n.current=new TT(k),n.current.addWorklet("vumeter-out",Sv,D=>{f(D.data.volume)}).then(()=>{})})},[n]),y.useEffect(()=>{const k=()=>{p(!0)},D=()=>{p(!1)},_=X=>{console.error("error",X)},T=()=>{var X;return(X=n.current)==null?void 0:X.stop()},E=X=>{var I;return(I=n.current)==null?void 0:I.addPCM16(new Uint8Array(X))},U=X=>{if(console.log("Received content event:",X),X.modelTurn&&X.modelTurn.parts){const I=X.modelTurn.parts.filter(F=>"text"in F&&F.text);if(I.length>0){const F=I.map(B=>B.text).join(" ");x(F),console.log("AI Summary received:",F)}}};return s.on("error",_).on("open",k).on("close",D).on("interrupted",T).on("audio",E).on("content",U),()=>{s.off("error",_).off("open",k).off("close",D).off("interrupted",T).off("audio",E).off("content",U).disconnect()}},[s]);const j=y.useCallback(async()=>{if(!u)throw new Error("config has not been set");s.disconnect(),await s.connect(r,u)},[s,u,r]),N=y.useCallback(async()=>{s.disconnect(),p(!1)},[p,s]);return{client:s,config:u,setConfig:c,model:r,setModel:o,connected:d,connect:j,disconnect:N,volume:m,aiSummary:g}}const _v=y.createContext(void 0),Tc=({options:t,children:s})=>{const n=OT(t);return e.jsx(_v.Provider,{value:n,children:s})},Mi=()=>{const t=y.useContext(_v);if(!t)throw new Error("useLiveAPIContext must be used wihin a LiveAPIProvider");return t};function zT(){const{config:t,setConfig:s}=Mi(),[n,r]=y.useState({value:"audio",label:"audio"}),o=y.useCallback(u=>{s({...t,responseModalities:[u==="audio"?bd.AUDIO:bd.TEXT]})},[t,s]);return e.jsxs("div",{className:"select-group",children:[e.jsx("label",{htmlFor:"response-modality-selector",children:"Response modality"}),e.jsx(Zj,{id:"response-modality-selector",className:"react-select",classNamePrefix:"react-select",styles:{},defaultValue:n,options:[{value:"audio",label:"audio"},{value:"text",label:"text"}],onChange:u=>{r(u),u&&(u.value==="audio"||u.value==="text")&&o(u.value)}})]})}const Qb=[{value:"Puck",label:"Puck"},{value:"Charon",label:"Charon"},{value:"Kore",label:"Kore"},{value:"Fenrir",label:"Fenrir"},{value:"Aoede",label:"Aoede"}];function RT(){const{config:t,setConfig:s}=Mi();y.useEffect(()=>{var d,p,m;const u=((m=(p=(d=t.speechConfig)==null?void 0:d.voiceConfig)==null?void 0:p.prebuiltVoiceConfig)==null?void 0:m.voiceName)||"Atari02";r({value:u,label:u})},[t]);const[n,r]=y.useState(Qb[5]),o=y.useCallback(u=>{s({...t,speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:u}}}})},[t,s]);return e.jsxs("div",{className:"select-group",children:[e.jsx("label",{htmlFor:"voice-selector",children:"Voice"}),e.jsx(Zj,{id:"voice-selector",className:"react-select",classNamePrefix:"react-select",styles:{},value:n,defaultValue:n,options:Qb,onChange:u=>{r(u),u&&o(u.value)}})]})}function LT(){const[t,s]=y.useState(!1),{config:n,setConfig:r,connected:o}=Mi(),u=y.useMemo(()=>Array.isArray(n.tools)?n.tools.filter(m=>Array.isArray(m.functionDeclarations)).map(m=>m.functionDeclarations).filter(m=>!!m).flat():[],[n]),c=y.useMemo(()=>{var m;return n.systemInstruction?typeof n.systemInstruction=="string"?n.systemInstruction:Array.isArray(n.systemInstruction)?n.systemInstruction.map(f=>typeof f=="string"?f:f.text).join(`
`):typeof n.systemInstruction=="object"&&"parts"in n.systemInstruction&&((m=n.systemInstruction.parts)==null?void 0:m.map(f=>f.text).join(`
`))||"":""},[n]),d=y.useCallback(m=>{const f={...n,systemInstruction:m.target.value};r(f)},[n,r]),p=y.useCallback((m,f)=>{var x;const g={...n,tools:((x=n.tools)==null?void 0:x.map(j=>{const N=j;return Array.isArray(N.functionDeclarations)?{...j,functionDeclarations:N.functionDeclarations.map(k=>k.name===m?{...k,description:f}:k)}:j}))||[]};r(g)},[n,r]);return e.jsxs("div",{className:"settings-dialog",children:[e.jsx("button",{className:"action-button material-symbols-outlined",onClick:()=>s(!t),children:"settings"}),e.jsx("dialog",{className:"dialog",style:{display:t?"block":"none"},children:e.jsxs("div",{className:`dialog-container ${o?"disabled":""}`,children:[o&&e.jsx("div",{className:"connected-indicator",children:e.jsx("p",{children:"These settings can only be applied before connecting and will override other settings."})}),e.jsxs("div",{className:"mode-selectors",children:[e.jsx(zT,{}),e.jsx(RT,{})]}),e.jsx("h3",{children:"System Instructions"}),e.jsx("textarea",{className:"system",onChange:d,value:c}),e.jsx("h4",{children:"Function declarations"}),e.jsx("div",{className:"function-declarations",children:e.jsx("div",{className:"fd-rows",children:u.map((m,f)=>{var g;return e.jsxs("div",{className:"fd-row",children:[e.jsx("span",{className:"fd-row-name",children:m.name}),e.jsx("span",{className:"fd-row-args",children:Object.keys(((g=m.parameters)==null?void 0:g.properties)||{}).map((x,j)=>e.jsx("span",{children:x},j))}),e.jsx("input",{className:"fd-row-description",type:"text",defaultValue:m.description,onBlur:x=>p(m.name,x.target.value)},`fd-${m.description}`)]},`function-${f}`)})})})]})})]})}const Yb=y.memo(({isStreaming:t,onIcon:s,offIcon:n,start:r,stop:o})=>t?e.jsx("button",{className:"action-button",onClick:o,children:e.jsx("span",{className:"material-symbols-outlined",children:s})}):e.jsx("button",{className:"action-button",onClick:r,children:e.jsx("span",{className:"material-symbols-outlined",children:n})}));function $T({videoRef:t,children:s,onVideoStreamChange:n=()=>{},supportsVideo:r,enableEditingSettings:o}){const u=[PT(),AT()],[c,d]=y.useState(null),[p,m]=u,[f,g]=y.useState(0),[x]=y.useState(()=>new kv),[j,N]=y.useState(!1),k=y.useRef(null),D=y.useRef(null),{client:_,connected:T,connect:E,disconnect:U,volume:X}=Mi();y.useEffect(()=>{!T&&D.current&&D.current.focus()},[T]),y.useEffect(()=>{document.documentElement.style.setProperty("--volume",`${Math.max(5,Math.min(f*200,8))}px`)},[f]),y.useEffect(()=>{const F=B=>{_.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:B}])};return T&&!j&&x?x.on("data",F).on("volume",g).start():x.stop(),()=>{x.off("data",F).off("volume",g)}},[T,_,j,x]),y.useEffect(()=>{t.current&&(t.current.srcObject=c);let F=-1;function B(){const G=t.current,C=k.current;if(!G||!C)return;const A=C.getContext("2d");if(C.width=G.videoWidth*.25,C.height=G.videoHeight*.25,C.width+C.height>0){A.drawImage(G,0,0,C.width,C.height);const P=C.toDataURL("image/jpeg",1),$=P.slice(P.indexOf(",")+1,1/0);_.sendRealtimeInput([{mimeType:"image/jpeg",data:$}])}T&&(F=window.setTimeout(B,1e3/.5))}return T&&c!==null&&requestAnimationFrame(B),()=>{clearTimeout(F)}},[T,c,_,t]);const I=F=>async()=>{if(F){const B=await F.start();d(B),n(B)}else d(null),n(null);u.filter(B=>B!==F).forEach(B=>B.stop())};return e.jsxs("section",{className:"control-tray",children:[e.jsx("canvas",{style:{display:"none"},ref:k}),e.jsxs("nav",{className:Ri("actions-nav",{disabled:!T}),children:[e.jsx("button",{className:Ri("action-button mic-button",{recording:!j&&T}),onClick:()=>N(!j),children:j?e.jsx("span",{className:"material-symbols-outlined filled",children:"mic_off"}):e.jsx("span",{className:"material-symbols-outlined filled",children:"mic"})}),e.jsx("div",{className:"action-button no-action outlined",children:e.jsx(ET,{volume:X,active:T,hover:!1})}),r&&e.jsxs(e.Fragment,{children:[e.jsx(Yb,{isStreaming:m.isStreaming,start:I(m),stop:I(),onIcon:"cancel_presentation",offIcon:"present_to_all"}),e.jsx(Yb,{isStreaming:p.isStreaming,start:I(p),stop:I(),onIcon:"videocam_off",offIcon:"videocam"})]}),s]}),e.jsxs("div",{className:Ri("connection-container",{connected:T}),children:[e.jsx("div",{className:"connection-button-container",children:e.jsx("button",{ref:D,className:Ri("action-button connect-toggle",{connected:T}),onClick:T?U:E,children:e.jsx("span",{className:"material-symbols-outlined filled",children:T?"pause":"play_arrow"})})}),e.jsx("span",{className:"text-indicator",children:"Streaming"})]}),o?e.jsx(LT,{}):""]})}const Jb={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:yd.OBJECT,properties:{summary:{type:yd.STRING,description:"The summary of the patient's case."}},required:["summary"]}},FT=({patientData:t,tokenNumber:s})=>{const[n,r]=y.useState(""),{client:o,setConfig:u,setModel:c}=Mi();return y.useEffect(()=>{c("models/gemini-2.5-flash-live-preview"),u({responseModalities:[bd.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},systemInstruction:{parts:[{text:`Your job is to:

If patient details like name, age, sex, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details (e.g., phone number) are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's name, age, sex, and phone number.

When pronouncing a phone number, always state each digit individually (e.g., "six three" instead of "sixty-three" or "six billion three").

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception. You should always speak in Telugu.dont write the telugu words in english`}]},tools:[{functionDeclarations:[Jb]}]})},[u,c]),y.useEffect(()=>{const d=p=>{if(!p.functionCalls)return;const m=p.functionCalls.find(f=>f.name===Jb.name);if(m){const f=m.args.summary;r(f)}p.functionCalls.length&&setTimeout(()=>{var f;return o.sendToolResponse({functionResponses:(f=p.functionCalls)==null?void 0:f.map(g=>({response:{output:{success:!0}},id:g.id,name:g.name}))})},200)};return o.on("toolcall",d),()=>{o.off("toolcall",d)}},[o]),y.useEffect(()=>{if(n){const d=encodeURIComponent(n);s?window.location.href=`https://hms.newtons.in/handle-complaint-url?token=${s}&caseDetails=${d}`:window.location.href=`https://hms.newtons.in/dashboard/search-patient?caseDetails=${d}`}},[n,s]),e.jsxs("div",{className:"hospital-reception",children:[e.jsx("h1",{children:"Newtons Ai"}),e.jsx("p",{children:"Newtons Ai"}),s&&e.jsxs("h2",{children:["Token Number: ",s]}),t&&e.jsxs("div",{children:[e.jsx("h2",{children:"Patient Details"}),e.jsx("pre",{children:JSON.stringify(t,null,2)})]}),n&&e.jsxs("div",{children:[e.jsx("h2",{children:"Case Summary (from Tool Call)"}),e.jsx("p",{children:n})]})]})},Xb="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes";async function MT(){const t=ff();if(!t)return console.warn("No auth token found, using default Live API key."),Xb;try{const n=(await eS.get("/api/clinics/gemini-api-key",{headers:{Authorization:`Bearer ${t}`}})).data.geminiApiKey;if(n)return n}catch(s){console.error("Failed to fetch clinic-specific Live API key:",s)}return console.warn("Clinic-specific Live API key not found or failed to fetch, using default."),Xb}function BT(){const t=y.useRef(null),[s,n]=y.useState(null),[r,o]=y.useState(null);return y.useEffect(()=>{(async()=>{try{const c=await MT();o({apiKey:c})}catch(c){console.error("Error setting Live API options:",c)}})()},[]),r?e.jsx("div",{className:"App",children:e.jsx(Tc,{options:r,children:e.jsx(UT,{videoRef:t,setVideoStream:n,videoStream:s})})}):e.jsx("div",{children:"Loading Live API settings..."})}const UT=({videoRef:t,setVideoStream:s,videoStream:n})=>{const[r,o]=y.useState(null),[u,c]=y.useState(null),{connected:d,client:p,connect:m,config:f,model:g}=Mi(),[x,j]=y.useState(""),N=y.useRef(null),[k,D]=y.useState(!1);y.useEffect(()=>{const T=window.matchMedia("(prefers-color-scheme: dark)"),E=U=>{document.documentElement.setAttribute("data-theme",U.matches?"dark":"light")};return E(T),T.addEventListener("change",E),()=>T.removeEventListener("change",E)},[]),y.useEffect(()=>{const T=new URLSearchParams(window.location.search),E={};for(const[U,X]of T.entries())U==="token_number"?c(X):E[U]=X;o(E)},[]),y.useEffect(()=>{Object.keys(f).length>0&&g&&m()},[m,f,g]),y.useEffect(()=>{if(d&&r&&!k){const T=JSON.stringify(r,null,2);p.send([{text:T}]),j(""),D(!0)}},[d,r,p,k]),y.useEffect(()=>{r&&j(JSON.stringify(r,null,2))},[r]);const _=()=>{p.send([{text:x}]),j(""),N.current&&(N.current.innerText="")};return e.jsx("div",{className:"streaming-console",children:e.jsxs("main",{children:[e.jsxs("div",{className:"main-app-area",children:[e.jsx(FT,{patientData:r,tokenNumber:u}),e.jsx("video",{className:Ri("stream",{hidden:!t.current||!n}),ref:t,autoPlay:!0,playsInline:!0})]}),e.jsx("div",{className:Ri("input-container",{disabled:!d}),children:e.jsxs("div",{className:"input-content",children:[e.jsx("textarea",{className:"input-area",ref:N,onKeyDown:T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),T.stopPropagation(),_())},onChange:T=>j(T.target.value),value:x}),e.jsx("span",{className:Ri("input-content-placeholder",{hidden:x.length}),children:"Typesomething..."}),e.jsx("button",{className:"send-button material-symbols-outlined filled",onClick:_,children:"send"})]})}),e.jsx($T,{videoRef:t,supportsVideo:!0,onVideoStreamChange:s,enableEditingSettings:!0})]})})},Kb="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",qT=({volume:t,active:s})=>{const n=Array.from({length:5},(r,o)=>e.jsx("div",{className:`audio-bar ${s?"active":""}`,style:{height:s?`${Math.min(24,20+t*40*(1+Math.sin(o)*.3))}px`:"8px",animationDelay:`${o*.1}s`}},o));return e.jsx("div",{className:"audio-pulse",children:n})},HT=y.forwardRef(({videoRef:t,supportsVideo:s,onVideoStreamChange:n,textInput:r,onSubmitTextInput:o},u)=>{var I;const{connected:c,connect:d,disconnect:p,client:m,volume:f}=Mi(),[g,x]=y.useState(!1),[j,N]=y.useState(!1),[k,D]=y.useState(!1),[_]=y.useState(()=>new kv),T=async()=>{c?await p():(await d(),r.trim()&&o())};y.useEffect(()=>{const F=B=>{m.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:B}])};return c&&!g?_.on("data",F).start():_.stop(),()=>{_.off("data",F),_.stop()}},[c,m,g,_]);const E=y.useCallback(async()=>{if(j)X==null||X.getTracks().forEach(F=>F.stop()),n(null),N(!1);else try{const F=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});t.current&&(t.current.srcObject=F),n(F),N(!0)}catch(F){console.error("Error accessing webcam:",F),N(!1)}},[j,n,t]),U=y.useCallback(async()=>{if(k)X==null||X.getTracks().forEach(F=>F.stop()),n(null),D(!1);else try{const F=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});t.current&&(t.current.srcObject=F),n(F),D(!0)}catch(F){console.error("Error accessing screen share:",F),D(!1)}},[k,n,t]),X=(I=t.current)==null?void 0:I.srcObject;return y.useEffect(()=>()=>{X&&X.getTracks().forEach(F=>F.stop())},[X]),y.useImperativeHandle(u,()=>({handleConnect:T})),e.jsx("div",{className:"live-api-control-tray",children:e.jsxs("div",{className:"live-api-control-tray-inner",children:[e.jsxs("div",{className:"live-api-control-group",children:[e.jsx("button",{onClick:()=>x(!g),disabled:!c,className:`live-api-control-button ${c&&!g?"mic-active":"mic-inactive"}`,"aria-label":g?"Unmute microphone":"Mute microphone",children:g?e.jsx(vw,{className:"w-5 h-5"}):e.jsx(kc,{className:"w-5 h-5"})}),e.jsx("div",{className:"live-api-audio-pulse-container",children:e.jsx(qT,{volume:f,active:c})}),s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:U,disabled:!c,className:`live-api-control-button ${k?"video-active":"video-inactive"}`,"aria-label":k?"Stop screen share":"Start screen share",children:e.jsx(Nw,{className:"w-5 h-5"})}),e.jsx("button",{onClick:E,disabled:!c,className:`live-api-control-button ${j?"video-active":"video-inactive"}`,"aria-label":j?"Turn off webcam":"Turn on webcam",children:e.jsx(ww,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"live-api-control-group",children:[e.jsxs("div",{className:"live-api-status-indicator",children:[e.jsx("div",{className:`live-api-status-dot ${c?"connected":"disconnected"}`}),e.jsx("span",{className:"live-api-status-text",children:c?"Streaming":"Disconnected"})]}),e.jsx("button",{onClick:T,className:`live-api-connect-button ${c?"connected":"disconnected"}`,children:c?e.jsxs(e.Fragment,{children:[e.jsx(Sw,{className:"w-5 h-5"}),e.jsx("span",{children:"Pause"})]}):e.jsxs(e.Fragment,{children:[e.jsx(kw,{className:"w-5 h-5"}),e.jsx("span",{children:"Start"})]})})]})]})})}),VT=({tokenNumber:t,aiSummary:s,clinicName:n})=>e.jsxs("div",{className:"hospital-reception-container",children:[e.jsxs("div",{className:"hospital-reception-logo-section",children:[e.jsx("div",{className:"hospital-reception-logo",children:e.jsx("span",{children:n.charAt(0)})}),e.jsxs("h1",{className:"hospital-reception-title",children:[n," AI"]}),e.jsxs("p",{className:"hospital-reception-subtitle",children:["Intelligent ",n," Reception Assistant"]})]}),t&&e.jsxs("div",{className:"hospital-reception-token-card",children:[e.jsx("h2",{className:"hospital-reception-token-title",children:"Token Number"}),e.jsx("p",{className:"hospital-reception-token-number",children:t})]}),s&&e.jsxs("div",{className:"hospital-reception-summary-card",children:[e.jsx("h3",{className:"hospital-reception-summary-title",children:"Case Summary"}),e.jsx("p",{className:"hospital-reception-summary-text",children:s})]})]}),Wb={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:yd.OBJECT,properties:{summary:{type:yd.STRING,description:"The summary of the patient's case."}},required:["summary"]}},GT=({onClose:t,patientData:s,tokenNumber:n,onAiSummaryChange:r,clinicName:o,voiceAiLanguage:u})=>{const c=y.useRef(null),d=y.useRef(null),[p,m]=y.useState(null),[f,g]=y.useState("hi"),{client:x,connected:j,setConfig:N,setModel:k,disconnect:D,connect:_}=Mi(),T=y.useMemo(()=>{let B=`Your job is to:

If patient details like name, age, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details (Name, Age) are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's Name and Age only. Do not ask for their phone number.

    You should guess the patient's sex based on their voice or appearance.

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception.`;s&&(B+=`

Patient Data: ${JSON.stringify(s,null,2)}`);const C={"en-US":"English","hi-IN":"Hindi","te-IN":"Telugu","bn-IN":"Bengali","mr-IN":"Marathi","ta-IN":"Tamil","gu-IN":"Gujarati","kn-IN":"Kannada","ml-IN":"Malayalam","pa-IN":"Punjabi","es-ES":"Spanish","fr-FR":"French","de-DE":"German","it-IT":"Italian","pt-PT":"Portuguese","ru-RU":"Russian","ja-JP":"Japanese","ko-KR":"Korean","zh-CN":"Chinese","ar-SA":"Arabic"}[u]||"English";return B+=` You should always speak in ${C}.`,u==="te-IN"&&(B+=" Dont write the telugu words in english."),{responseModalities:[bd.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},systemInstruction:{parts:[{text:B}]},tools:[{functionDeclarations:[Wb]}]}},[s,u]);y.useEffect(()=>{k("models/gemini-2.5-flash-native-audio-preview-12-2025"),N(T);const B=setTimeout(()=>{d.current&&!j&&d.current.handleConnect()},2e3);return()=>clearTimeout(B)},[N,k,T,j]),y.useEffect(()=>()=>{j&&D()},[j,D]);const[E,U]=y.useState(null);y.useEffect(()=>{const B=G=>{if(!G.functionCalls)return;const C=G.functionCalls.find(A=>A.name===Wb.name);if(C){const A=C.args.summary;U(A),r(A)}G.functionCalls.length&&setTimeout(()=>{var A;return x.sendToolResponse({functionResponses:(A=G.functionCalls)==null?void 0:A.map(P=>({response:{output:{success:!0}},id:P.id,name:P.name}))})},200)};return x.on("toolcall",B),()=>{x.off("toolcall",B)}},[x,r]);const X=()=>{f.trim()&&(x.send([{text:f}]),g(""))},I=B=>{B.key==="Enter"&&!B.shiftKey&&(B.preventDefault(),X())},F=async()=>{U(null),r(null),g("hi"),j?(D(),setTimeout(()=>{_()},500)):_()};return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsxs("div",{className:"live-api-modal-content",children:[e.jsxs("div",{className:"live-api-modal-header",children:[e.jsxs("div",{className:"live-api-modal-header-left",children:[e.jsx("div",{className:"live-api-modal-logo",children:e.jsx("span",{children:o.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h1",{className:"live-api-modal-title",children:o}),e.jsxs("p",{className:"live-api-modal-subtitle",children:[o," Hospital Assistant"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:F,className:"live-api-modal-close-button",title:"Refresh Session","aria-label":"Refresh session",children:e.jsx(Wj,{className:"w-6 h-6"})}),e.jsx("button",{onClick:t,className:"live-api-modal-close-button","aria-label":"Close modal",children:e.jsx(Et,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"live-api-modal-main-content",children:e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"live-api-reception-area",children:[e.jsx(VT,{patientData:s,tokenNumber:n,aiSummary:E,clinicName:o}),p&&e.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,className:"live-api-video-stream"})]}),e.jsx("div",{className:"live-api-input-area",children:e.jsxs("div",{className:"live-api-input-container",children:[e.jsx("textarea",{value:f,onChange:B=>g(B.target.value),onKeyDown:I,placeholder:"Type your message here...",disabled:!j,rows:1,className:"live-api-textarea"}),e.jsx("button",{onClick:X,disabled:!j||!f.trim(),className:"live-api-send-button","aria-label":"Send message",children:e.jsx(Ad,{className:"w-5 h-5"})})]})}),e.jsx(HT,{ref:d,videoRef:c,supportsVideo:!0,onVideoStreamChange:m,textInput:f,onSubmitTextInput:X})]})})]})})},Md=({onClose:t,patientData:s,tokenNumber:n,onAiSummaryChange:r})=>{const[o,u]=y.useState(null),[c,d]=y.useState("Newtons Ai"),[p,m]=y.useState("en-US"),[f,g]=y.useState(!0);if(y.useEffect(()=>{(async()=>{try{let N=null,k="Newtons Ai",D="en-US";try{const _=await ae("/api/clinics/settings");if(_.ok){const T=await _.json();T.name&&T.name!==""&&(k=T.name),T.gemini_api_key&&T.gemini_api_key.trim()!==""&&(N=T.gemini_api_key.trim()),T.voice_ai_language&&(D=T.voice_ai_language)}}catch(_){console.warn("Failed to fetch clinic settings",_)}if(d(k),m(D),N)u(N);else{try{const _=await ae("/api/global-settings/app_gemini_api_key");if(_.ok){const T=await _.json();if(T.value&&T.value.trim()!==""){u(T.value.trim());return}}}catch(_){console.warn("Failed to fetch global key fallback",_)}u(Kb)}}catch(N){console.error("Unexpected error in getSettings:",N),u(Kb)}finally{g(!1)}})()},[]),f)return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsx("div",{className:"live-api-modal-content",style:{maxHeight:"200px",maxWidth:"400px",borderRadius:"1rem",justifyContent:"center"},children:e.jsxs("div",{className:"live-api-loading-container",children:[e.jsx("div",{className:"live-api-loading-spinner"}),e.jsx("div",{className:"live-api-loading-text",children:"Initializing AI Assistant..."})]})})});if(!o)return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsx("div",{className:"live-api-modal-content",children:e.jsx("div",{children:"Error: API Key not available."})})});const x={apiKey:o};return e.jsx(Tc,{options:x,children:e.jsx(GT,{onClose:t,patientData:s,tokenNumber:n,onAiSummaryChange:r,clinicName:c,voiceAiLanguage:p})})},QT="_overlay_79cew_5",YT="_overlayMinimized_79cew_55",JT="_modal_79cew_65",XT="_minimized_79cew_97",KT="_contentWrapper_79cew_113",WT="_exiting_79cew_161",ZT="_header_79cew_183",eA="_inputWrapper_79cew_197",tA="_inputContainer_79cew_215",nA="_minimizedSearchIcon_79cew_273",aA="_input_79cew_197",sA="_controlsGroup_79cew_347",iA="_iconButton_79cew_373",rA="_sendButton_79cew_413",lA="_dragBar_79cew_459",oA="_dragBarTitle_79cew_489",cA="_dragBarControls_79cew_519",uA="_dragBarControlsRight_79cew_537",dA="_newChatBtn_79cew_553",hA="_windowControlBtn_79cew_589",mA="_content_79cew_113",pA="_overlayContent_79cew_687",fA="_section_79cew_711",gA="_sectionTitle_79cew_723",xA="_recentList_79cew_743",yA="_recentPill_79cew_767",bA="_recentName_79cew_807",jA="_recentToken_79cew_819",vA="_recentInfo_79cew_837",NA="_examplesGrid_79cew_849",wA="_exampleCard_79cew_861",SA="_exampleIcon_79cew_897",kA="_exampleText_79cew_905",CA="_chatSectionFill_79cew_919",_A="_chatMessagesFill_79cew_935",DA="_chatBubble_79cew_955",EA="_chatBubbleUser_79cew_975",TA="_chatBubbleModel_79cew_991",AA="_chatBubbleSystem_79cew_1009",PA="_processing_79cew_1025",IA="_spinner_79cew_1043",OA="_resultItem_79cew_1065",zA="_resultName_79cew_1093",RA="_resultToken_79cew_1103",LA="_resultDetails_79cew_1115",$A="_noResults_79cew_1125",Ke={overlay:QT,overlayMinimized:YT,modal:JT,minimized:XT,contentWrapper:KT,exiting:WT,header:ZT,inputWrapper:eA,inputContainer:tA,minimizedSearchIcon:nA,input:aA,controlsGroup:sA,iconButton:iA,sendButton:rA,dragBar:lA,dragBarTitle:oA,dragBarControls:cA,dragBarControlsRight:uA,newChatBtn:dA,windowControlBtn:hA,content:mA,overlayContent:pA,section:fA,sectionTitle:gA,recentList:xA,recentPill:yA,recentName:bA,recentToken:jA,recentInfo:vA,examplesGrid:NA,exampleCard:wA,exampleIcon:SA,exampleText:kA,chatSectionFill:CA,chatMessagesFill:_A,chatBubble:DA,chatBubbleUser:EA,chatBubbleModel:TA,chatBubbleSystem:AA,processing:PA,spinner:IA,resultItem:OA,resultName:zA,resultToken:RA,resultDetails:LA,noResults:$A},Dv="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",FA={apiKey:Dv},rp=[{name:"Dashboard",path:"/dashboard",icon:e.jsx(Dw,{size:16}),keywords:["home","main","analytics","stats"],roles:["all"]},{name:"Clinic Hub",path:"/dashboard/clinic-hub",icon:e.jsx(qy,{size:16}),keywords:["central","hub","overview"],roles:["admin","superadmin"]},{name:"Analysis Dashboard",path:"/dashboard/analysis",icon:e.jsx(qy,{size:16}),keywords:["reports","stats","finance","money"],roles:["admin","superadmin"]},{name:"Live AI Assistant",path:"/live-api",icon:e.jsx(jd,{size:16}),keywords:["ai","chat","voice","assistant"],roles:["all"]},{name:"Patient Search",path:"/dashboard/search-patient",icon:e.jsx(mn,{size:16}),keywords:["find","lookup","patient"],roles:["all"]},{name:"All Patients",path:"/dashboard/all-patients",icon:e.jsx(Bl,{size:16}),keywords:["list","records","database"],roles:["admin","receptionist","doctor"]},{name:"Add New Patient",path:"/dashboard/add-patient",icon:e.jsx(df,{size:16}),keywords:["register","new","create","onboard"],roles:["admin","receptionist","doctor"]},{name:"Admissions",path:"/manage-admission",icon:e.jsx(Ew,{size:16}),keywords:["ipd","admit","discharge","rooms"],roles:["admin","doctor","receptionist"]},{name:"Pharmacy Inventory",path:"/dashboard/inventory",icon:e.jsx(vr,{size:16}),keywords:["drugs","medicine","stock","pharmacy"],roles:["admin","pharmacy"]},{name:"Add New Drug",path:"/dashboard/inventory/add",icon:e.jsx(vr,{size:16}),keywords:["create","medicine","stock"],roles:["admin","pharmacy"]},{name:"Add Pharmacy Order",path:"/dashboard/add-order",icon:e.jsx(Tp,{size:16}),keywords:["sell","bill","dispense"],roles:["admin","pharmacy"]},{name:"Refill Reminders",path:"/refill-reminders",icon:e.jsx(Li,{size:16}),keywords:["recurring","sms","alert"],roles:["admin","pharmacy"]},{name:"Distributors",path:"/dashboard/distributors",icon:e.jsx(Tw,{size:16}),keywords:["suppliers","vendors","stock"],roles:["admin","pharmacy"]},{name:"Purchase",path:"/dashboard/purchase",icon:e.jsx(Tp,{size:16}),keywords:["buy","procurement","stock"],roles:["admin","pharmacy"]},{name:"Create Lab Order",path:"/create-lab-order",icon:e.jsx(Ga,{size:16}),keywords:["test","pathology","diagnostics"],roles:["admin","doctor","lab"]},{name:"Search Lab Reports",path:"/lab/search-report",icon:e.jsx(mn,{size:16}),keywords:["results","history","find"],roles:["admin","doctor","lab"]},{name:"Lab Inventory",path:"/lab-inventory",icon:e.jsx(Ga,{size:16}),keywords:["reagents","tests","stock"],roles:["admin","lab"]},{name:"Create Custom Bill",path:"/create-custom-bill",icon:e.jsx(hs,{size:16}),keywords:["invoice","custom","charge"],roles:["admin","receptionist"]},{name:"Billing History",path:"/billing",icon:e.jsx(e0,{size:16}),keywords:["transactions","payments","history"],roles:["admin"]},{name:"Staff Management",path:"/dashboard/staff",icon:e.jsx(Aw,{size:16}),keywords:["users","employees","roles","admin"],roles:["admin","superadmin"]}],MA=[{icon:"",text:"Update Paracetamol stock to 100"},{icon:"",text:"Change CBC Test price to 350"},{icon:"",text:"Set Voice AI language to Hindi"},{icon:"",text:"Show revenue for last month"},{icon:"",text:"Purchase 50 strips of Aspirin"},{icon:"",text:"Update consultation fee to 500"},{icon:"",text:"Add new staff member"},{icon:"",text:"Register: John Doe, 25M, Fever"},{icon:"",text:"Check Metformin availability"}],BA=({user:t})=>{const{isOpen:s,closeCommandBar:n}=$l(),r=ot(),o=za(),u=y.useRef(null),[c,d]=y.useState(""),[p,m]=y.useState([]),[f,g]=y.useState([]),[x,j]=y.useState([]),[N,k]=y.useState(!1),[D,_]=y.useState(!0),[T,E]=y.useState(!1),[U,X]=y.useState(null),[I,F]=y.useState(!1),[B,G]=y.useState(!1),[C,A]=y.useState(!1);y.useEffect(()=>{if(s)G(!0),A(!1);else{A(!0);const re=setTimeout(()=>{G(!1),A(!1)},200);return()=>clearTimeout(re)}},[s]);const{setPageContext:P}=Od();y.useEffect(()=>{if(s){const re=o.pathname,ke=rp.find(Ue=>Ue.path===re)||rp.find(Ue=>re.startsWith(Ue.path)&&Ue.path!=="/dashboard");P(ke?{name:ke.name,path:re,data:{role:ke.roles}}:{name:"Current Page",path:re})}},[s,o.pathname,P]);const $=gf({settings:{},staffList:[]}),{selectedImage:J,handleImageSelect:R,clearImage:L}=$,M=y.useRef(null),Z=re=>{var Ue;const ke=(Ue=re.target.files)==null?void 0:Ue[0];ke&&R(ke)},[Q,S]=y.useState({x:0,y:0}),[ge,fe]=y.useState(!1),w=y.useRef({x:0,y:0}),ue=y.useRef({x:0,y:0}),Ne=y.useRef(!1),K=y.useRef(null);y.useEffect(()=>{const re=Ue=>{if(!ge)return;Ne.current=!0;const Qe=Ue.clientX-w.current.x,Ze=Ue.clientY-w.current.y;let lt=ue.current.x+Qe,le=ue.current.y+Ze;if(K.current){const pe=K.current.offsetWidth,de=K.current.offsetHeight,we=(window.innerWidth-pe)/2,Ae=(window.innerHeight-de)/2,Re=Math.max(0,we),at=Math.max(0,Ae);lt=Math.max(-Re,Math.min(Re,lt)),le=Math.max(-at,Math.min(at,le))}S({x:lt,y:le})},ke=()=>{fe(!1)};return ge&&(window.addEventListener("mousemove",re),window.addEventListener("mouseup",ke)),()=>{window.removeEventListener("mousemove",re),window.removeEventListener("mouseup",ke)}},[ge]);const Y=re=>{re.target.closest("input, button, .lucide")||(fe(!0),Ne.current=!1,w.current={x:re.clientX,y:re.clientY},ue.current={...Q})};y.useEffect(()=>{s&&F(!0)},[o.pathname]),y.useEffect(()=>{(f.length>0||x.length>0)&&I&&F(!1)},[f,x]),y.useEffect(()=>{if(s&&window.innerWidth<=768){window.history.pushState({commandBarOpen:!0},"");const re=ke=>{ke.preventDefault(),F(!0)};return window.addEventListener("popstate",re),()=>{window.removeEventListener("popstate",re)}}},[s]),y.useEffect(()=>{I||S({x:0,y:0})},[I]),y.useEffect(()=>{$.setChatQuery(c)},[c]),y.useEffect(()=>{s&&u.current&&u.current.focus()},[s]),y.useEffect(()=>{if(!s||I||!(window.innerWidth<=768))return;const ke=window.scrollY,Ue=document.body.style.overflow,Qe=document.documentElement.style.overflow,Ze=document.body.style.position,lt=document.body.style.top,le=document.body.style.width;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${ke}px`,document.body.style.width="100%",()=>{document.documentElement.style.overflow=Qe,document.body.style.overflow=Ue,document.body.style.position=Ze,document.body.style.top=lt,document.body.style.width=le,window.scrollTo(0,ke)}},[s,I]);const V=re=>{!re.trim()&&!J||(F(!1),$.handleSendMessage(re),d(""),g([]),j([]))},{preFilledQuery:oe,setPreFilledQuery:Pe}=$l();y.useEffect(()=>{s&&oe&&(d(oe),setTimeout(()=>{V(oe),Pe("")},300))},[s,oe,Pe]),y.useEffect(()=>{U&&(d(U),E(!1),setTimeout(()=>V(U),50),X(null))},[U]);const se=()=>{E(!0)},Ce=()=>{d(""),g([]),j([]),$.refreshChat(),u.current&&u.current.focus()};y.useEffect(()=>{s&&(async()=>{try{const ke=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),Ue=await ae(`/api/patients?${ke.toString()}`);if(Ue.ok){const Qe=await Ue.json();m(Qe.patients||[])}}catch(ke){console.error("Error fetching recent patients:",ke)}})()},[s]);const ee=y.useMemo(()=>Ec(async re=>{const ke=re.trim(),Ue=/^\d+$/.test(ke),Qe=ke.split(/\s+/).length;if(ke.length>1){const Ze=ke.toLowerCase(),lt=rp.filter(le=>{if(!(le.name.toLowerCase().includes(Ze)||le.keywords.some(we=>we.toLowerCase().includes(Ze))))return!1;if(!t)return!0;const de=t.role;return le.roles.includes("all")||le.roles.includes(de)});j(lt)}else j([]);if(ke.length<2||Ue&&ke.length>10||!Ue&&Qe>3){g([]),k(!1);return}k(!0);try{const Ze=new URLSearchParams({search:encodeURIComponent(re),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),lt=await ae(`/api/patients?${Ze.toString()}`);if(lt.ok){const le=await lt.json();g(le.patients||[])}}catch(Ze){console.error("Search error:",Ze)}finally{k(!1)}},300),[t]),je=re=>{const ke=re.target.value;d(ke),ee(ke)},Ie=re=>{re.id&&r(`/dashboard/edit-complaint/patient/${re.id}`)},$e=re=>{r(re.path)},Fe=re=>{d(re),setTimeout(()=>V(re),50)},Be=re=>{c.trim()&&V(c)},qe=re=>{re.key==="Enter"&&!re.shiftKey&&(re.preventDefault(),Be())},et=re=>{re.target===re.currentTarget&&n()};if(!s&&!B)return null;const ye=(f.length>0||x.length>0)&&!N,Oe=c.length===0&&f.length===0&&x.length===0,xe=c.length>=3&&f.length===0&&x.length===0&&!N,he=$.chatHistory.length>0||$.isProcessing,W=!he||ye,O=he&&ye,te=he&&!D&&!I&&!ye;return e.jsxs("div",{className:`${Ke.overlay} ${I?Ke.overlayMinimized:""} ${C?Ke.exiting:""}`,onClick:et,children:[e.jsxs("div",{ref:K,className:`${Ke.modal} ${I?Ke.minimized:""} ${te?Ke.collapsed:""} ${C?Ke.exiting:""}`,style:{transform:`translate(${Q.x}px, ${Q.y}px)`,height:te?"auto":void 0},onClick:()=>{Ne.current||(I?F(!1):te&&_(!0))},children:[e.jsxs("div",{className:Ke.dragBar,onMouseDown:Y,onDoubleClick:()=>!I&&F(!I),children:[e.jsxs("div",{className:Ke.dragBarControls,children:[e.jsx("button",{className:Ke.windowControlBtn,onClick:n,title:"Close",children:e.jsx(Et,{size:24,color:"#64748b"})}),e.jsx("button",{className:Ke.windowControlBtn,onClick:()=>F(!I),title:I?"Maximize":"Minimize",children:I?e.jsx(Cw,{size:24,color:"#64748b"}):e.jsx(_w,{size:24,color:"#64748b"})})]}),e.jsx("div",{className:Ke.dragBarTitle,children:he?e.jsxs(e.Fragment,{children:[e.jsx(jd,{size:14,className:"text-violet-600"}),e.jsx("span",{children:"AI Assistant"})]}):ye?e.jsxs(e.Fragment,{children:[e.jsx(mn,{size:14,className:"text-blue-500"}),e.jsx("span",{children:"Search Results"})]}):e.jsx("span",{style:{opacity:.5,fontWeight:500},children:"Command Bar"})}),e.jsx("div",{className:Ke.dragBarControlsRight,children:e.jsx("button",{className:Ke.newChatBtn,onClick:Ce,title:"New Chat",children:e.jsx(ds,{size:20})})})]}),e.jsxs("div",{className:Ke.contentWrapper,children:[he&&e.jsx("div",{className:Ke.chatSectionFill,children:e.jsxs("div",{className:Ke.chatMessagesFill,children:[$.chatHistory.map((re,ke)=>e.jsx("div",{className:`${Ke.chatBubble} ${re.role==="user"?Ke.chatBubbleUser:re.role==="model"?Ke.chatBubbleModel:Ke.chatBubbleSystem}`,children:re.role==="model"?e.jsx(xa,{remarkPlugins:[Ln],children:re.text}):re.text},ke)),$.isProcessing&&e.jsxs("div",{className:Ke.processing,children:[e.jsx(Va,{size:14,className:Ke.spinner}),"Thinking..."]})]})}),W&&e.jsxs("div",{className:O?Ke.overlayContent:Ke.content,children:[p.length>0&&Oe&&!he&&e.jsxs("div",{className:Ke.section,children:[e.jsx("div",{className:Ke.sectionTitle,children:"Newly Registered"}),e.jsx("div",{className:Ke.recentList,children:p.map(re=>e.jsxs("div",{className:Ke.recentPill,onClick:()=>Ie(re),children:[e.jsx("span",{className:Ke.recentName,children:re.name||"Patient"}),e.jsxs("span",{className:Ke.recentToken,children:["#",re.token]}),e.jsxs("span",{className:Ke.recentInfo,children:[re.age?`${re.age}y`:""," ",re.gender||""]})]},re.id))})]}),Oe&&!he&&e.jsxs("div",{className:Ke.section,children:[e.jsx("div",{className:Ke.sectionTitle,children:"Quick Commands"}),e.jsx("div",{className:Ke.examplesGrid,children:MA.map((re,ke)=>e.jsxs("div",{className:Ke.exampleCard,onClick:()=>Fe(re.text),children:[e.jsx("span",{className:Ke.exampleIcon,children:re.icon}),e.jsx("span",{className:Ke.exampleText,children:re.text})]},ke))})]}),N&&e.jsx("div",{className:Ke.section,children:e.jsxs("div",{className:Ke.processing,children:[e.jsx(Va,{size:16,className:Ke.spinner}),"Searching..."]})}),x.length>0&&!N&&e.jsxs("div",{className:Ke.section,children:[e.jsx("div",{className:Ke.sectionTitle,children:"Pages Found"}),e.jsx("div",{className:Ke.resultsList,children:x.map((re,ke)=>e.jsxs("div",{className:Ke.resultItem,onClick:()=>$e(re),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"#7c3aed"},children:re.icon}),e.jsx("span",{className:Ke.resultName,children:re.name})]}),e.jsx("span",{className:Ke.resultDetails,style:{fontSize:"0.7rem"},children:"Jump to page"})]},ke))})]}),ye&&f.length>0&&e.jsxs("div",{className:Ke.section,children:[e.jsx("div",{className:Ke.sectionTitle,children:"Patients Found"}),e.jsx("div",{className:Ke.resultsList,children:f.map(re=>e.jsxs("div",{className:Ke.resultItem,onClick:()=>Ie(re),children:[e.jsxs("div",{children:[e.jsxs("span",{className:Ke.resultToken,children:["[#",re.token,"]"]}),e.jsx("span",{className:Ke.resultName,children:re.name})]}),e.jsxs("span",{className:Ke.resultDetails,children:[re.age?`${re.age} yrs`:"",re.age&&re.gender?" / ":"",re.gender||""]})]},re.id))})]}),xe&&!he&&e.jsx("div",{className:Ke.section,children:e.jsxs("div",{className:Ke.noResults,children:["Press ",e.jsx("strong",{children:"Enter"}),' to send "',c,'" to AI Assistant']})})]})]}),e.jsx("div",{className:Ke.header,children:e.jsxs("div",{className:Ke.inputWrapper,children:[e.jsxs("div",{className:Ke.inputContainer,children:[e.jsx("div",{className:Ke.minimizedSearchIcon,children:e.jsx(mn,{size:24})}),e.jsx("textarea",{ref:re=>{u.current=re,re&&(re.style.height="auto",re.style.height=Math.min(re.scrollHeight,150)+"px")},className:Ke.input,placeholder:I?"Type here...":"Search (Name/Token/Phone), Ask AI, or Enter New Case (Name Age Sex Complaint)...",value:c,onChange:re=>{je(re),re.target.style.height="auto",re.target.style.height=Math.min(re.target.scrollHeight,150)+"px"},onKeyDown:qe,onFocus:re=>{re.target.scrollIntoView=()=>{},setTimeout(()=>{K.current&&(K.current.scrollTop=K.current.scrollHeight)},100)},rows:1,disabled:$.isProcessing}),J&&e.jsxs("div",{style:{position:"relative",marginRight:"0.5rem"},children:[e.jsx("img",{src:J,alt:"Selected",style:{width:"24px",height:"24px",objectFit:"cover",borderRadius:"4px",border:"1px solid #e2e8f0"}}),e.jsx("button",{onClick:L,style:{position:"absolute",top:-4,right:-4,background:"rgba(0,0,0,0.6)",color:"white",border:"none",borderRadius:"50%",padding:"1px",cursor:"pointer",display:"flex"},children:e.jsx(Et,{size:8})})]}),e.jsxs("div",{className:Ke.controlsGroup,children:[e.jsx("button",{className:Ke.iconButton,onClick:()=>{var re;return(re=M.current)==null?void 0:re.click()},title:"Attach Image",children:e.jsx(Td,{size:16})}),(c.trim().length>0||J)&&e.jsx("button",{className:`${Ke.iconButton} ${Ke.sendButton}`,onClick:()=>V(c),title:"Send to AI",children:e.jsx(Ad,{size:16})}),e.jsx("button",{className:Ke.iconButton,onClick:se,title:"Voice Input",children:e.jsx(kc,{size:16})})]})]}),e.jsx("input",{type:"file",ref:M,onChange:Z,accept:"image/*",style:{display:"none"}})]})})]}),T&&Dv&&e.jsx(Tc,{options:FA,children:e.jsx(Md,{onClose:()=>E(!1),patientData:{id:null,token:null,name:"New Case",age:null,gender:null},tokenNumber:null,onAiSummaryChange:X})})]})};function Ra(t,s=100){const n=y.useRef(!1);y.useEffect(()=>{if(n.current)return;const r=setTimeout(()=>{const o=document,u=['input[type="text"]:not([disabled]):not([readonly])','input[type="search"]:not([disabled]):not([readonly])','input[type="email"]:not([disabled]):not([readonly])','input[type="tel"]:not([disabled]):not([readonly])','input[type="url"]:not([disabled]):not([readonly])',"input:not([type]):not([disabled]):not([readonly])"].join(", "),c=o.querySelectorAll(u),d=Array.from(c).filter(p=>{const m=window.getComputedStyle(p),f=p.getBoundingClientRect();return m.display!=="none"&&m.visibility!=="hidden"&&m.opacity!=="0"&&f.width>0&&f.height>0});if(d.length>0){const p=d[0];p.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{p.focus()},50),n.current=!0}},s);return()=>clearTimeout(r)},[t,s])}const UA=({onLoginSuccess:t})=>{const[s,n]=y.useState(""),[r,o]=y.useState(""),[u,c]=y.useState(null),[d,p]=y.useState(!1),m=ot();Ra();const f=async j=>{j.preventDefault(),p(!0),c(null);try{const N=await ae("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s,password:r})});if(!N.ok){let D=`Login failed with status: ${N.status}`;try{D=(await N.json()).message||D}catch{try{const T=await N.text();T&&(D=`${D} - ${T}`)}catch{}}throw new Error(D)}const k=await N.json();console.log("Login successful:",k),localStorage.setItem("authToken",k.token),localStorage.setItem("currentUser",JSON.stringify(k.user)),k.user.clinic_id&&localStorage.setItem("currentClinicId",k.user.clinic_id),t(k.user),k.user.role==="doctor"?m("/dashboard/queue"):m("/dashboard")}catch(N){console.error("Login failed:",N),c(N.message||"Login failed. Please check your credentials.")}finally{p(!1)}},g=async j=>{p(!0),c(null);try{const N=await ae("/api/auth/google",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:j.credential})});if(!N.ok)throw new Error("Google Sign-In failed");const k=await N.json();localStorage.setItem("authToken",k.token),localStorage.setItem("currentUser",JSON.stringify(k.user)),k.user.clinic_id&&localStorage.setItem("currentClinicId",k.user.clinic_id),t(k.user),k.user.role==="doctor"?m("/dashboard/queue"):m("/dashboard")}catch(N){console.error("Google Login Error:",N),c("Google Sign-In failed. Please try again.")}finally{p(!1)}},x=()=>{console.error("Google Login Failed"),c("Google Sign-In was unsuccessful. Please try again.")};return e.jsx("div",{className:"auth-page-container",children:e.jsxs("div",{className:"auth-form-card",children:[e.jsx("h2",{className:"auth-title",children:"Newtons AI HMS"}),e.jsx("p",{className:"auth-subtitle",children:"Sign in to continue"}),e.jsxs("form",{onSubmit:f,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:j=>n(j.target.value),className:"auth-text-input",placeholder:" "}),e.jsx("label",{htmlFor:"email",children:"Email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:r,onChange:j=>o(j.target.value),className:"auth-text-input",placeholder:" "}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),u&&e.jsx("div",{className:"auth-error-message",children:e.jsx("p",{children:u})}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",disabled:d,className:"auth-submit-button",children:d?"Signing in...":"Sign In"})})]}),e.jsx("div",{className:"google-login-container",children:e.jsx(fS,{onSuccess:g,onError:x,useOneTap:!0})}),e.jsxs("div",{className:"auth-navigation-link-container",children:["Don't have an account?"," ",e.jsx(us,{to:"/register",className:"auth-navigation-link",children:"Create account"})]}),e.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})},qA=()=>{const[t,s]=y.useState(""),[n,r]=y.useState(""),[o,u]=y.useState(""),[c,d]=y.useState(""),[p,m]=y.useState(null),[f,g]=y.useState(!1),x=ot(),j=async N=>{N.preventDefault(),g(!0),m(null);try{const k=await ae("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicName:t,userName:n,userEmail:o,userPassword:c})}),D=await k.json();if(!k.ok)throw new Error(D.message||`HTTP error! status: ${k.status}`);console.log("Registration successful:",D),alert("Registration successful! Please log in."),x("/login")}catch(k){console.error("Registration failed:",k),m(k.message||"Registration failed. Please try again.")}finally{g(!1)}};return e.jsx("div",{className:"auth-page-container",children:e.jsxs("div",{className:"auth-form-card",children:[e.jsx("h2",{className:"auth-title",children:"Register Clinic & Admin"}),e.jsxs("form",{onSubmit:j,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"clinicName",children:"Clinic Name"}),e.jsx("input",{id:"clinicName",name:"clinicName",type:"text",required:!0,value:t,onChange:N=>s(N.target.value),className:"auth-text-input",placeholder:"Your Clinic's Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userName",children:"Your Name (Admin)"}),e.jsx("input",{id:"userName",name:"userName",type:"text",required:!0,value:n,onChange:N=>r(N.target.value),className:"auth-text-input",placeholder:"Your Full Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userEmail",children:"Your Email (Admin Login)"}),e.jsx("input",{id:"userEmail",name:"userEmail",type:"email",autoComplete:"email",required:!0,value:o,onChange:N=>u(N.target.value),className:"auth-text-input",placeholder:"you@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userPassword",children:"Password"}),e.jsx("input",{id:"userPassword",name:"userPassword",type:"password",required:!0,minLength:6,value:c,onChange:N=>d(N.target.value),className:"auth-text-input",placeholder:"Min. 6 characters"})]}),p&&e.jsx("div",{className:"auth-error-message",children:e.jsx("p",{children:p})}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",disabled:f,className:"auth-submit-button",children:f?"Registering...":"Register Clinic & Admin"})})]}),e.jsxs("div",{className:"auth-navigation-link-container",children:["Already have an account?"," ",e.jsx(us,{to:"/login",className:"auth-navigation-link",children:"Sign in"})]}),e.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})};function lp(t){return va({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM96 424c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm96-192c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm128 368c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"},child:[]}]})(t)}function Zb(t){return va({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(t)}function ej(t){return va({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(t)}function Tl(t){return va({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(t)}function rd(t){return va({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480 320a96 96 0 1 0-96-96 96 96 0 0 0 96 96zm48 32a22.88 22.88 0 0 0-7.06 1.09 124.76 124.76 0 0 1-81.89 0A22.82 22.82 0 0 0 432 352a112 112 0 0 0-112 112.62c.14 26.26 21.73 47.38 48 47.38h224c26.27 0 47.86-21.12 48-47.38A112 112 0 0 0 528 352zm-198.09 10.45A145.19 145.19 0 0 1 352 344.62V128a32 32 0 0 0-32-32h-32V32a32 32 0 0 0-32-32H96a32 32 0 0 0-32 32v64H32a32 32 0 0 0-32 32v368a16 16 0 0 0 16 16h288.31A78.62 78.62 0 0 1 288 464.79a143.06 143.06 0 0 1 41.91-102.34zM144 404a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm48-122a6 6 0 0 1-6 6h-20a6 6 0 0 1-6-6v-26h-26a6 6 0 0 1-6-6v-20a6 6 0 0 1 6-6h26V70a6 6 0 0 1 6-6h20a6 6 0 0 1 6 6v26h26a6 6 0 0 1 6 6v20a6 6 0 0 1-6 6h-26zm80 250a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12z"},child:[]}]})(t)}function ld(t){return va({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M352 288h-16v-88c0-4.42-3.58-8-8-8h-13.58c-4.74 0-9.37 1.4-13.31 4.03l-15.33 10.22a7.994 7.994 0 0 0-2.22 11.09l8.88 13.31a7.994 7.994 0 0 0 11.09 2.22l.47-.31V288h-16c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h64c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM608 64H32C14.33 64 0 78.33 0 96v320c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V96c0-17.67-14.33-32-32-32zM48 400v-64c35.35 0 64 28.65 64 64H48zm0-224v-64h64c0 35.35-28.65 64-64 64zm272 192c-53.02 0-96-50.15-96-112 0-61.86 42.98-112 96-112s96 50.14 96 112c0 61.87-43 112-96 112zm272 32h-64c0-35.35 28.65-64 64-64v64zm0-224c-35.35 0-64-28.65-64-64h64v64z"},child:[]}]})(t)}function od(t){return va({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M112 32C50.1 32 0 82.1 0 144v224c0 61.9 50.1 112 112 112s112-50.1 112-112V144c0-61.9-50.1-112-112-112zm48 224H64V144c0-26.5 21.5-48 48-48s48 21.5 48 48v112zm139.7-29.7c-3.5-3.5-9.4-3.1-12.3.8-45.3 62.5-40.4 150.1 15.9 206.4 56.3 56.3 143.9 61.2 206.4 15.9 4-2.9 4.3-8.8.8-12.3L299.7 226.3zm229.8-19c-56.3-56.3-143.9-61.2-206.4-15.9-4 2.9-4.3 8.8-.8 12.3l210.8 210.8c3.5 3.5 9.4 3.1 12.3-.8 45.3-62.6 40.5-150.1-15.9-206.4z"},child:[]}]})(t)}function Al(t){return va({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(t)}function Ev(t){return va({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function tj(t){return va({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M447.1 112c-34.2.5-62.3 28.4-63 62.6-.5 24.3 12.5 45.6 32 56.8V344c0 57.3-50.2 104-112 104-60 0-109.2-44.1-111.9-99.2C265 333.8 320 269.2 320 192V36.6c0-11.4-8.1-21.3-19.3-23.5L237.8.5c-13-2.6-25.6 5.8-28.2 18.8L206.4 35c-2.6 13 5.8 25.6 18.8 28.2l30.7 6.1v121.4c0 52.9-42.2 96.7-95.1 97.2-53.4.5-96.9-42.7-96.9-96V69.4l30.7-6.1c13-2.6 21.4-15.2 18.8-28.2l-3.1-15.7C107.7 6.4 95.1-2 82.1.6L19.3 13C8.1 15.3 0 25.1 0 36.6V192c0 77.3 55.1 142 128.1 156.8C130.7 439.2 208.6 512 304 512c97 0 176-75.4 176-168V231.4c19.1-11.1 32-31.7 32-55.4 0-35.7-29.2-64.5-64.9-64zm.9 80c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16z"},child:[]}]})(t)}function HA(t){return va({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function nj(t){return va({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zM104 424c0 13.3 10.7 24 24 24s24-10.7 24-24-10.7-24-24-24-24 10.7-24 24zm216-135.4v49c36.5 7.4 64 39.8 64 78.4v41.7c0 7.6-5.4 14.2-12.9 15.7l-32.2 6.4c-4.3.9-8.5-1.9-9.4-6.3l-3.1-15.7c-.9-4.3 1.9-8.6 6.3-9.4l19.3-3.9V416c0-62.8-96-65.1-96 1.9v26.7l19.3 3.9c4.3.9 7.1 5.1 6.3 9.4l-3.1 15.7c-.9 4.3-5.1 7.1-9.4 6.3l-31.2-4.2c-7.9-1.1-13.8-7.8-13.8-15.9V416c0-38.6 27.5-70.9 64-78.4v-45.2c-2.2.7-4.4 1.1-6.6 1.9-18 6.3-37.3 9.8-57.4 9.8s-39.4-3.5-57.4-9.8c-7.4-2.6-14.9-4.2-22.6-5.2v81.6c23.1 6.9 40 28.1 40 53.4 0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.3 16.9-46.5 40-53.4v-80.4C48.5 301 0 355.8 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-72-56.8-130.3-128-133.8z"},child:[]}]})(t)}function uc(t){return va({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(t)}const Tv={superadmin:[{title:"Admin Pages",links:[{path:"/dashboard",name:"Super Admin Dashboard",icon:Tl},{path:"/dashboard/clinic-subscriptions",name:"Clinic Subscriptions",icon:rd},{path:"/dashboard/users",name:"User Management",icon:uc}]}],admin:[{title:"Dashboard",links:[{path:"/dashboard",name:"Admin Dashboard",icon:Tl}]},{title:"Clinic Management",links:[{path:"/dashboard/clinic-hub",name:"Clinic Hub",icon:Zb}]},{title:"Patient Management",links:[{path:"/dashboard/patients/add",name:"Add Patient",icon:rd},{path:"/dashboard/patients",name:"All Patients",icon:uc},{path:"/dashboard/patients/search",name:"Search Patient",icon:Al}]},{title:"Inventory & Pharmacy",links:[{path:"/dashboard/analysis",name:"Analysis Dashboard",icon:lp},{path:"/dashboard/inventory",name:"Inventory Management",icon:od},{path:"/dashboard/inventory/add",name:"Add Drug",icon:od},{path:"/dashboard/distributors",name:"Distributor Management",icon:uc}]},{title:"Queue & Subscriptions",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:tj},{path:"/dashboard/subscriptions",name:"Manage Subscriptions",icon:ld},{path:"/dashboard/subscriptions/add",name:"Add Subscription Plan",icon:ld}]}],doctor:[{title:"Patient & Admissions",links:[{path:"/dashboard/search",name:"Patient Search",icon:Al},{path:"/dashboard/add-patient",name:"Add Patient",icon:rd},{path:"/manage-admission",name:"Manage Admission",icon:nj}]},{title:"Lab & Billing",links:[{path:"/create-lab-order",name:"Create Lab Order",icon:ej},{path:"/billing",name:"Billing",icon:ld}]},{title:"Queue",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:tj}]}],receptionist:[{title:"Reception",links:[{path:"/dashboard",name:"Reception Dashboard",icon:Tl}]},{title:"Patient Management",links:[{path:"/dashboard/all-patients",name:"All Patients",icon:uc},{path:"/dashboard/patients/add",name:"Add Patient",icon:rd},{path:"/dashboard/patients/search",name:"Search Patient",icon:Al}]},{title:"Billing & Admissions",links:[{path:"/billing",name:"Billing",icon:ld},{path:"/manage-admission",name:"Manage Admission",icon:nj}]}],lab:[{title:"Lab Operations",links:[{path:"/dashboard",name:"Lab Dashboard",icon:Tl},{path:"/lab-inventory",name:"Lab Test Inventory",icon:ej},{path:"/lab/search-report",name:"Search Lab Report",icon:Al}]}],pharmacy:[{title:"Pharmacy Operations",links:[{path:"/dashboard",name:"Pharmacy Queue",icon:Tl},{path:"/dashboard/inventory",name:"Pharmacy Inventory",icon:od},{path:"/dashboard/inventory/add",name:"Add Drug",icon:od},{path:"/dashboard/add-order",name:"Add Pharmacy Order",icon:lp},{path:"/dashboard/distributors",name:"Distributor Management",icon:uc}]},{title:"Analysis & Settings",links:[{path:"/dashboard/analysis",name:"Analysis Dashboard",icon:lp},{path:"/dashboard/settings",name:"Pharmacy Settings",icon:Zb},{path:"/dashboard/search-patient-records",name:"Search Patient Records",icon:Al}]}]},VA=({user:t,onLogout:s,userRole:n,isOpen:r,onClose:o})=>{const u=za(),[c,d]=y.useState(""),p=Tv[n]||[],[m,f]=y.useState(500),g=y.useRef(!1),x=y.useCallback(D=>{g.current=!0,D.preventDefault()},[]),j=y.useCallback(()=>{g.current=!1},[]),N=y.useCallback(D=>{if(g.current){const _=window.innerWidth-D.clientX;_>250&&_<window.innerWidth*.8&&f(_)}},[]);y.useEffect(()=>(window.addEventListener("mousemove",N),window.addEventListener("mouseup",j),()=>{window.removeEventListener("mousemove",N),window.removeEventListener("mouseup",j)}),[N,j]);const k=p.map(D=>({...D,links:D.links.filter(_=>_.name.toLowerCase().includes(c.toLowerCase()))})).filter(D=>D.links.length>0);return e.jsxs("div",{className:`side-panel ${r?"open":""}`,style:{width:`${m}px`,right:r?"0":`-${m}px`},children:[e.jsx("div",{className:"resizer",onMouseDown:x}),e.jsxs("div",{className:"side-panel-header",children:[e.jsx(us,{to:"/dashboard",className:"home-button",onClick:o,children:e.jsx(Tl,{})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Al,{style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{type:"text",placeholder:"Search pages...",className:"search-bar",value:c,onChange:D=>d(D.target.value)})]}),e.jsx("button",{className:"close-button",onClick:o,children:""})]}),e.jsx("nav",{children:k.map((D,_)=>e.jsxs("div",{className:"page-section",children:[e.jsx("div",{className:"page-title",children:D.title}),e.jsx("ul",{className:"sub-page-list",children:D.links.map(T=>{const E=T.icon;return e.jsx("li",{children:e.jsxs(us,{to:T.path,className:u.pathname===T.path?"active":"",onClick:o,children:[E&&e.jsx(E,{})," ",T.name]})},T.path)})})]},_))}),e.jsxs("div",{className:"user-info-section",children:[e.jsxs("span",{className:"user-name",children:["Welcome, ",t.name]}),e.jsxs("button",{onClick:s,className:"logout-button-sidebar",children:[e.jsx(Ev,{})," Logout"]})]})]})},GA=({user:t,onLogout:s,userRole:n,isOpen:r,onClose:o,roleNavigation:u})=>{const c=za(),d=u[n]||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`mobile-side-panel-overlay ${r?"open":""}`,onClick:o}),e.jsxs("div",{className:`mobile-side-panel ${r?"open":""}`,children:[e.jsxs("div",{className:"mobile-side-panel-header",children:[e.jsx("h3",{children:"Menu"}),e.jsx("button",{className:"close-button",onClick:o,children:e.jsx(HA,{})})]}),e.jsx("nav",{children:d.map((p,m)=>e.jsxs("div",{className:"page-section",children:[e.jsx("div",{className:"page-title",children:p.title}),e.jsx("ul",{className:"sub-page-list",children:p.links.map(f=>{const g=f.icon;return e.jsx("li",{children:e.jsxs(us,{to:f.path,className:c.pathname===f.path?"active":"",onClick:o,children:[g&&e.jsx(g,{})," ",f.name]})},f.path)})})]},m))}),e.jsxs("div",{className:"user-info-section",children:[e.jsxs("span",{className:"user-name",children:["Welcome, ",t.name]}),e.jsxs("button",{onClick:s,className:"logout-button-sidebar",children:[e.jsx(Ev,{})," Logout"]})]})]})]})},QA=({})=>{const t=ot(),[s]=y.useState(!1),[n,r]=y.useState(null),[o,u]=y.useState(null);return y.useEffect(()=>{if(o){const c=setTimeout(()=>u(null),5e3);return()=>clearTimeout(c)}},[o]),s?e.jsxs("div",{className:"loading-animation-container",children:[" ",e.jsx("div",{className:"breathing-ball"}),e.jsx("div",{className:"mt-4 text-teal-600 text-xl font-medium",children:"Loading Admin Panel..."})]}):e.jsxs("div",{className:"admin-panel-container",children:[" ",o&&e.jsxs("div",{className:`alert-box ${o.type==="success"?"alert-box-success":"alert-box-error"} fixed top-4 right-4 z-[100]`,role:"alert",children:[e.jsx("div",{className:"alert-box-icon",children:o.type==="success"?e.jsx(aa,{size:18}):e.jsx(pn,{size:18})}),e.jsx("div",{className:"alert-box-content",children:e.jsx("span",{children:o.message})}),e.jsx("button",{onClick:()=>u(null),className:"alert-box-close",children:e.jsx(Et,{size:16})})]}),n&&e.jsxs("div",{className:"alert-box alert-box-error mb-4",role:"alert",children:[" ",e.jsx("div",{className:"alert-box-icon",children:e.jsx(pn,{size:18})}),e.jsx("div",{className:"alert-box-content",children:e.jsx("span",{className:"block sm:inline flex-1",children:n})}),e.jsx("button",{onClick:()=>r(null),className:"alert-box-close",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"admin-nav-bar",children:[" ",e.jsxs("button",{onClick:()=>t("."),className:"admin-nav-button",title:"Home",children:[e.jsx(t0,{})," "]}),e.jsxs("button",{onClick:()=>t("/dashboard/clinic-hub"),className:"admin-nav-button",children:[e.jsx(n0,{})," Clinic"]}),e.jsxs("button",{onClick:()=>t("/dashboard/inventory"),className:"admin-nav-button",children:[e.jsx(vr,{})," Inventory"]}),e.jsxs("button",{onClick:()=>t("/dashboard/analysis"),className:"admin-nav-button",children:[e.jsx(Ap,{})," Analysis"]}),e.jsx("button",{onClick:()=>t("/lab-inventory"),className:"admin-nav-button hidden-button",children:"Lab Inventory"}),e.jsxs("button",{onClick:()=>t("/dashboard/subscriptions"),className:"admin-nav-button hidden-button",children:[e.jsx(e0,{})," Subscriptions"]}),e.jsx("button",{onClick:()=>t("/refill-reminders"),className:"admin-nav-button",children:"Refills"}),e.jsxs("button",{onClick:()=>t("/create-lab-order"),className:"admin-nav-button",children:[e.jsx(Ap,{})," Labs"]}),e.jsxs("button",{onClick:()=>t("patients"),className:"admin-nav-button",children:[e.jsx(Bl,{})," Patients"]}),e.jsxs("button",{onClick:()=>t("search-patient"),className:"admin-nav-button",children:[e.jsx(mn,{})," Search"]})]}),e.jsx("div",{className:"admin-content-section",children:e.jsx(gw,{})})]})},YA="_container_15l0t_5",JA="_visualContainer_15l0t_31",XA="_brandTitle_15l0t_49",KA="_searchBar_15l0t_105",WA="_searchIconWrapper_15l0t_153",ZA="_searchIcon_15l0t_153",eP="_placeholderText_15l0t_177",tP="_shortcutHint_15l0t_197",nP="_key_15l0t_213",aP="_plus_15l0t_237",sP="_micButtonWrapper_15l0t_247",iP="_micIcon_15l0t_295",rP="_newlyRegisteredSection_15l0t_491",lP="_recentList_15l0t_509",oP="_recentPatientPill_15l0t_523",cP="_recentNameContainer_15l0t_549",uP="_recentInfo_15l0t_561",dP="_newlyRegisteredLabel_15l0t_599",hP="_recentName_15l0t_549",mP="_recentToken_15l0t_763",xn={container:YA,visualContainer:JA,brandTitle:XA,searchBar:KA,searchIconWrapper:WA,searchIcon:ZA,placeholderText:eP,shortcutHint:tP,key:nP,plus:aP,micButtonWrapper:sP,micIcon:iP,newlyRegisteredSection:rP,recentList:lP,recentPatientPill:oP,recentNameContainer:cP,recentInfo:uP,newlyRegisteredLabel:dP,recentName:hP,recentToken:mP},Av="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",pP={apiKey:Av},fP=()=>{const{openCommandBar:t,isOpen:s,setPreFilledQuery:n}=$l(),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState([]),m=ot(),f=g=>{g.stopPropagation(),o(!0)};return y.useEffect(()=>{u&&(o(!1),n&&n(u),t(),c(null))},[u,t,n]),y.useEffect(()=>{(async()=>{try{const x=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),j=await ae(`/api/patients?${x.toString()}`);if(j.ok){const N=await j.json();p(N.patients||[])}}catch(x){console.error("Error fetching recent patients:",x)}})()},[]),e.jsxs("div",{className:xn.container,children:[e.jsxs("div",{className:xn.visualContainer,children:[e.jsx("h1",{className:xn.brandTitle,children:"Newtons Ai"}),!s&&e.jsxs("div",{className:xn.searchBar,onClick:()=>t(),children:[e.jsx("div",{className:xn.searchIconWrapper,children:e.jsx(mn,{className:xn.searchIcon})}),e.jsx("span",{className:xn.placeholderText,children:"Search or Ask AI..."}),e.jsx("div",{className:xn.micButtonWrapper,onClick:f,children:e.jsx(kc,{className:xn.micIcon})}),e.jsxs("div",{className:xn.shortcutHint,children:[e.jsx("span",{className:xn.key,children:"Ctrl"}),e.jsx("span",{className:xn.plus,children:"+"}),e.jsx("span",{className:xn.key,children:"K"})]})]}),!s&&d.length>0&&e.jsxs("div",{className:xn.newlyRegisteredSection,children:[e.jsx("div",{className:xn.newlyRegisteredLabel,children:"Newly Registered"}),e.jsx("div",{className:xn.recentList,children:d.map(g=>e.jsxs("div",{className:xn.recentPatientPill,onClick:()=>m(`/dashboard/edit-complaint/patient/${g.id}`),children:[e.jsxs("div",{className:xn.recentNameContainer,children:[e.jsx("span",{className:xn.recentName,children:g.name||"New Patient"}),e.jsxs("span",{className:xn.recentToken,children:["#",g.token]})]}),e.jsxs("div",{className:xn.recentInfo,children:[g.age?`${g.age} yrs`:"",g.age&&g.gender?" / ":"",g.gender||""]})]},g.id))})]})]}),r&&Av&&e.jsx(Tc,{options:pP,children:e.jsx(Md,{onClose:()=>o(!1),patientData:{id:null,token:null,name:"New Case",age:null,gender:null},tokenNumber:null,onAiSummaryChange:c})})]})},Ii=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},gP=t=>{if(!t)return"Unknown Date";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},Cl=({title:t,icon:s,items:n,renderItemContent:r,isLoading:o,loadingText:u,noDataText:c})=>{const d=y.useMemo(()=>{const p={};n.forEach(f=>{if(isNaN(f.date.getTime())){p["Unknown Date"]||(p["Unknown Date"]=[]),p["Unknown Date"].push(f);return}const g=gP(f.originalDateString);p[g]||(p[g]=[]),p[g].push(f)});const m=Object.keys(p);return m.sort((f,g)=>{if(f==="Unknown Date")return 1;if(g==="Unknown Date")return-1;try{const x=k=>{const D=k.split(" ");if(D.length===3){const T=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(D[1]);if(T!==-1)return new Date(parseInt(D[2]),T,parseInt(D[0]))}return new Date(k)},j=x(f),N=x(g);if(!isNaN(j.getTime())&&!isNaN(N.getTime()))return N.getTime()-j.getTime()}catch(x){console.error("Error parsing date for sorting:",x)}return g.localeCompare(f)}),m.map(f=>({date:f,items:p[f]}))},[n]);return e.jsxs("div",{className:"mb-2 bg-slate-50 rounded-lg border border-slate-200 overflow-hidden",children:[e.jsxs("h4",{className:"text-xs font-semibold text-slate-700 bg-slate-100 px-3 py-2 border-b border-slate-200 flex items-center",children:[s&&e.jsx(s,{size:14,className:"mr-2 text-indigo-600"}),t]}),e.jsxs("div",{className:"p-2",children:[o&&e.jsx("p",{className:"text-slate-500 italic text-xs px-1",children:u}),!o&&n.length===0&&e.jsx("p",{className:"text-slate-500 italic text-xs px-1",children:c}),!o&&n.length>0&&e.jsx("div",{className:"space-y-3",children:d.map(({date:p,items:m})=>e.jsxs("div",{children:[e.jsx("h5",{className:"text-[10px] font-bold text-slate-500 uppercase tracking-wider mb-1.5 px-1",children:p}),e.jsx("div",{className:"space-y-2 pl-2 border-l-2 border-slate-200 ml-1",children:m.map((f,g)=>e.jsx("div",{className:"flex items-start",children:e.jsx("div",{className:"flex-grow",children:r(f)})},`${f.type}-${f.originalDateString}-${g}`))})]},p))})]})]})},op=()=>{var M,Z;const[t,s]=y.useState({currentPatient:null,nextPatient:null,waitingCount:0}),[n,r]=y.useState(!0),[o,u]=y.useState(null),[c,d]=y.useState(null),[p,m]=y.useState(null),[f,g]=y.useState(null),[x,j]=y.useState({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),[N,k]=y.useState(!1),[D,_]=y.useState(null),{patientId:T}=Qn(),E=ot(),U=y.useCallback(async Q=>{g(null),d(null),m(null),k(!0),_(null),j({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]});try{const S=await ae(`/api/patients/${Q}`);if(!S.ok)throw new Error(`Patient details fetch failed (${S.status})`);const ge=await S.json();d(ge);const fe=await ae(`/api/queue/patient/${Q}/latest`);if(!fe.ok&&fe.status!==404)throw new Error(`Queue entry fetch failed (${fe.status})`);if(fe.ok){const w=await fe.json();m(w)}await X(Q)}catch(S){console.error("Error fetching specific patient data:",S),g(S.message||"Failed to load patient data."),_(S.message||"Failed to load patient history.")}finally{k(!1)}},[]),X=y.useCallback(async Q=>{k(!0),_(null);try{const[S,ge,fe,w]=await Promise.all([ae(`/api/queue/patient/${Q}/complaints`),ae(`/api/lab/patient/${Q}`),ae(`/api/lab/orders/patient/${Q}?status=pending`),ae(`/api/pharmacy-orders/patient/${Q}`)]),ue=S.ok?await S.json():[],Ne=ge.ok?await ge.json():[],K=fe.ok?await fe.json():[],Y=w.ok?await w.json():[];j({pastComplaints:ue||[],labReports:Ne||[],pendingLabOrders:K||[],pharmacyOrders:Y||[]})}catch(S){console.error("Error fetching patient history:",S),_(S.message||"Failed to load patient history."),j({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]})}finally{k(!1)}},[]),I=y.useCallback(async()=>{r(!0),u(null);try{const Q=await ae("/api/queue/doctor");if(!Q.ok){const ge=await Q.text();throw new Error(`API Error (${Q.status}): ${ge||Q.statusText}`)}const S=await Q.json();if(S===null||typeof S!="object"||typeof S.waitingCount!="number")throw console.error("Invalid queue data format:",S),new Error("Invalid queue data format received");s({currentPatient:S.currentPatient||null,nextPatient:S.nextPatient||null,waitingCount:S.waitingCount})}catch(Q){console.error("Error fetching queue data:",Q),u(Q.message||"Failed to fetch queue data.")}finally{r(!1)}},[]);y.useEffect(()=>{let Q=null;return T?(U(T),s({currentPatient:null,nextPatient:null,waitingCount:0})):(I(),Q=setInterval(I,1e4),d(null),m(null)),()=>{Q&&clearInterval(Q)}},[T,U,I]),y.useEffect(()=>{var Q;!T&&((Q=t.currentPatient)!=null&&Q.patientId)?X(t.currentPatient.patientId):!T&&!t.currentPatient&&(j({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),k(!1),_(null))},[T,(M=t.currentPatient)==null?void 0:M.patientId,X]);const F=((Z=t.currentPatient)==null?void 0:Z.patientId)||(T?parseInt(T,10):null),B=y.useMemo(()=>{if(!F||!x.pastComplaints)return[];const Q=x.pastComplaints.map(S=>({date:new Date(S.createdAt),type:"Complaint",data:S,originalDateString:S.createdAt})).filter(S=>!isNaN(S.date.getTime()));return Q.sort((S,ge)=>ge.date.getTime()-S.date.getTime()),Q},[F,x.pastComplaints]),G=y.useMemo(()=>{if(!F)return[];const Q=[];return(x.pendingLabOrders??[]).forEach(S=>{const ge=new Date(S.createdAt);isNaN(ge.getTime())||Q.push({date:ge,type:"Lab Order (Pending)",data:S,originalDateString:S.createdAt})}),(x.labReports??[]).forEach(S=>{const ge=S.reportCreatedAt?new Date(S.reportCreatedAt):null;ge&&!isNaN(ge.getTime())&&Q.push({date:ge,type:"Lab Report",data:S,originalDateString:S.reportCreatedAt})}),Q.sort((S,ge)=>ge.date.getTime()-S.date.getTime()),Q},[F,x.pendingLabOrders,x.labReports]),C=y.useMemo(()=>{if(!F||!x.pharmacyOrders)return[];const Q=x.pharmacyOrders.map(S=>({date:new Date(S.date),type:"Pharmacy Order",data:S,originalDateString:S.date})).filter(S=>!isNaN(S.date.getTime()));return Q.sort((S,ge)=>ge.date.getTime()-S.date.getTime()),Q},[F,x.pharmacyOrders]),A=async()=>{r(!0),u(null);try{await ae("/api/queue/doctor/next",{method:"POST"}),await I()}catch(Q){console.error("Error calling next patient:",Q),u(Q.message||"Failed to call next patient.")}finally{r(!1)}},P=async()=>{if(!(!t.currentPatient||T)){r(!0),u(null);try{await ae(`/api/queue/doctor/complete/${t.currentPatient._id}`,{method:"POST"}),await I(),j({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),k(!1),_(null)}catch(Q){console.error("Error completing consultation:",Q),u(Q.message||"Failed to complete consultation.")}finally{r(!1)}}},$=Q=>{switch(Q){case"waiting":return"Waiting";case"consulting":return"Consulting";case"seen":return"Seen";case"cancelled":return"Cancelled";default:return Q}},[J,R]=y.useState("info");let L=null;return t.currentPatient&&(L=e.jsxs("div",{className:"patient-info-section bg-white rounded-lg shadow-md md:p-6 border-l-4 md:border-l-8 border-teal-500 overflow-hidden",children:[e.jsxs("div",{className:"mobile-tabs md:hidden flex mb-4",children:[e.jsx("button",{className:`mobile-tab-btn ${J==="info"?"active":""}`,onClick:()=>R("info"),children:"Patient Details"}),e.jsx("button",{className:`mobile-tab-btn ${J==="history"?"active":""}`,onClick:()=>R("history"),children:"History & Context"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-6",children:[e.jsxs("div",{className:`flex-grow md:w-1/2 ${J==="info"?"block":"hidden md:block"}`,children:[e.jsxs("h2",{className:"text-xl text-teal-700 font-semibold mb-3 flex items-center",children:["NOW SEEING",e.jsx("span",{className:"ml-2 text-xs font-normal text-gray-500 bg-gray-100 px-2 py-0.5 rounded-full",children:"Live Consultation"})]}),e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-grow mr-4",children:[e.jsx("div",{className:"text-3xl md:text-3xl font-bold text-gray-800 mb-1 leading-tight",children:t.currentPatient.name}),e.jsxs("div",{className:"text-lg text-gray-600 flex items-center mt-1",children:[e.jsxs("span",{className:"font-semibold bg-gray-100 px-2 py-0.5 rounded text-sm mr-2",children:[t.currentPatient.age," Yrs"]}),e.jsx("span",{className:"font-semibold bg-gray-100 px-2 py-0.5 rounded text-sm",children:t.currentPatient.gender})]})]}),e.jsxs("div",{className:"text-right flex-shrink-0 flex flex-col items-end",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-700 mb-1",children:["#",t.currentPatient.token]}),e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wide ${t.currentPatient.status==="consulting"?"bg-teal-100 text-teal-800":"bg-gray-100 text-gray-800"}`,children:$(t.currentPatient.status)})]})]}),t.currentPatient.case_summary&&e.jsxs("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-100 rounded-md",children:[e.jsx("h4",{className:"text-xs font-bold text-amber-800 uppercase mb-1",children:"AI Brief"}),e.jsx("p",{className:"text-sm text-amber-900 leading-snug",children:t.currentPatient.case_summary})]}),e.jsxs("div",{className:"actions-section mt-4 md:mt-6 flex flex-col sm:flex-row justify-end gap-3 border-t pt-4",children:[e.jsxs("button",{onClick:()=>{var S;const Q=(S=t.currentPatient)==null?void 0:S._id;Q&&E(`/dashboard/edit-complaint/${Q}`)},disabled:n||!t.currentPatient||t.currentPatient.status!=="consulting",className:"btn btn-primary w-full sm:w-auto",children:[e.jsx(hf,{size:16})," Open Consultation"]}),e.jsxs("button",{onClick:P,disabled:n||!t.currentPatient||t.currentPatient.status!=="consulting",className:"btn btn-success w-full sm:w-auto",children:[e.jsx(Pw,{size:16})," Complete"]})]})]})," ",e.jsxs("div",{className:`complaint-section md:w-1/2 mt-4 md:mt-0 pt-4 md:pt-0 ${J==="history"?"block":"hidden md:block"} border-t md:border-t-0 md:border-l md:pl-6`,children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-800 mb-2 flex items-center justify-between",children:[e.jsx("span",{children:"History & Context"}),N&&e.jsx("span",{className:"text-xs font-normal text-indigo-600 animate-pulse",children:"Updating..."})]}),D&&e.jsx("p",{className:"text-red-500 text-xs mb-2 bg-red-50 p-2 rounded",children:D}),e.jsxs("div",{className:"space-y-3 pr-1 md:max-h-[500px] md:overflow-y-auto custom-scrollbar",children:[e.jsx(Cl,{title:"Past Complaints",icon:hs,items:B,isLoading:N,loadingText:"Fetching...",noDataText:"No past complaints.",renderItemContent:Q=>e.jsxs("span",{className:"block text-xs",children:[Q.data.complaint,e.jsx("div",{className:"text-gray-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]})}),e.jsx(Cl,{title:"Lab Reports & Orders",icon:Ga,items:G,isLoading:N,loadingText:"Fetching...",noDataText:"No lab history.",renderItemContent:Q=>Q.type==="Lab Order (Pending)"?e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-blue-700 mb-0.5",children:"Pending Order"}),Q.data.tests.map(S=>S.name).join(", "),e.jsx("div",{className:"text-gray-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]}):e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"font-medium text-green-700 mb-0.5",children:["Report: ",Q.data.testName]}),e.jsxs("div",{className:"text-gray-600 italic",children:['"',Q.data.reportFindings.substring(0,60),Q.data.reportFindings.length>60?"...":"",'"']}),e.jsx("div",{className:"text-gray-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]})}),e.jsx(Cl,{title:"Medications",icon:Nr,items:C,isLoading:N,loadingText:"Fetching...",noDataText:"No medication history.",renderItemContent:Q=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"text-gray-800",children:Q.data.medications.map(S=>`${S.name} (${S.quantity})`).join(", ")}),e.jsxs("div",{className:"text-gray-400 mt-0.5 text-[10px]",children:[Ii(Q.originalDateString),"  ",e.jsx("span",{className:"capitalize",children:Q.data.status})]})]})}),B.length===0&&G.length===0&&C.length===0&&!N&&e.jsx("div",{className:"text-gray-400 text-center py-4 text-xs italic bg-gray-50 rounded border border-dashed border-gray-200",children:"No history records found for this patient."})]})," "]})," "]})," "]})),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"doctor-screen-container flex-grow flex flex-col space-y-6 md:space-y-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>E(-1),className:"back-button mr-4",children:e.jsx(vt,{size:24})}),e.jsx("h1",{className:"doctor-screen-header",children:"Doctor Consultation Panel"})]}),T?e.jsxs(e.Fragment,{children:[f&&e.jsx("p",{className:"text-red-500 p-4 bg-red-50 rounded",children:f}),c&&e.jsxs("div",{className:"bg-white rounded-lg shadow-md md:p-6 border-l-4 md:border-l-8 border-purple-500 overflow-hidden",children:[e.jsxs("div",{className:"mobile-tabs md:hidden flex mb-4",children:[e.jsx("button",{className:`mobile-tab-btn ${J==="info"?"active":""}`,onClick:()=>R("info"),children:"Patient Record"}),e.jsx("button",{className:`mobile-tab-btn ${J==="history"?"active":""}`,onClick:()=>R("history"),children:"History"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-6",children:[e.jsxs("div",{className:`flex-grow md:w-1/2 ${J==="info"?"block":"hidden md:block"}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-xl text-purple-700 font-semibold flex items-center gap-2",children:"Patient Record"}),e.jsxs("button",{onClick:()=>E("/dashboard/doctor"),className:"text-xs font-medium text-slate-500 hover:text-slate-800 flex items-center gap-1 transition-colors px-2 py-1 bg-slate-100 rounded",children:[e.jsx(vt,{size:12})," Back to Queue"]})]}),e.jsx("div",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-700 to-indigo-600 mb-1 leading-tight",children:c.name}),e.jsxs("div",{className:"text-lg text-slate-600 mb-4 flex items-center gap-2",children:[e.jsxs("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-sm font-semibold",children:[c.age||"N/A"," Yrs"]}),e.jsx("span",{className:"bg-slate-100 px-2 py-0.5 rounded text-sm font-semibold",children:c.gender||"N/A"})]}),e.jsxs("div",{className:"mt-4 p-4 bg-slate-50 rounded-lg border border-slate-200 shadow-sm",children:[e.jsx("label",{className:"font-semibold block mb-2 text-xs uppercase tracking-wider text-slate-500",children:"Latest Activity"}),p?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("span",{className:"text-sm flex-1 break-words text-slate-700",children:[e.jsx("span",{className:"font-medium text-slate-900",children:"Complaint:"})," ",p.complaint||e.jsx("span",{className:"text-slate-400 italic",children:"None"}),e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium uppercase tracking-wide ${p.status==="consulting"?"bg-teal-100 text-teal-800":p.status==="seen"?"bg-emerald-100 text-emerald-800":p.status==="waiting"?"bg-blue-100 text-blue-800":"bg-slate-100 text-slate-800"}`,children:$(p.status)})})]}),p.status==="consulting"&&p._id&&e.jsx("button",{onClick:()=>E(`/dashboard/edit-complaint/${p._id}`),className:"ml-4 px-3 py-1.5 text-xs bg-indigo-50 hover:bg-indigo-100 text-indigo-700 rounded-md font-medium border border-indigo-200 transition-colors",children:"Resume"})]}),p.case_summary&&e.jsxs("div",{className:"text-xs text-slate-700 bg-amber-50 p-2.5 rounded border border-amber-100",children:[e.jsx("span",{className:"font-bold text-amber-800 uppercase text-[10px] block mb-1",children:"AI Summary"}),p.case_summary]})]}):e.jsx("p",{className:"text-slate-400 italic text-sm",children:"No queue entry found for this patient today."})]})]}),e.jsxs("div",{className:`md:w-1/2 mt-4 md:mt-0 pt-4 md:pt-0 ${J==="history"?"block":"hidden md:block"} border-t md:border-t-0 md:border-l md:pl-6`,children:[e.jsxs("h3",{className:"text-base font-semibold text-slate-800 mb-3 flex items-center justify-between",children:[e.jsx("span",{children:"Patient History"}),N&&e.jsx("span",{className:"text-xs font-normal text-indigo-600 animate-pulse",children:"Loading..."})]}),D&&e.jsx("p",{className:"text-red-500 text-xs mb-2 bg-red-50 p-2 rounded",children:D}),e.jsxs("div",{className:"space-y-3 pr-1 md:max-h-[500px] md:overflow-y-auto custom-scrollbar",children:[e.jsx(Cl,{title:"Past Complaints",icon:hs,items:B,isLoading:N,loadingText:"Loading...",noDataText:"No past complaints.",renderItemContent:Q=>e.jsxs("div",{className:"text-xs",children:[Q.data.complaint,e.jsx("div",{className:"text-slate-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]})}),e.jsx(Cl,{title:"Lab Reports",icon:Ga,items:G,isLoading:N,loadingText:"Loading...",noDataText:"No lab history.",renderItemContent:Q=>Q.type==="Lab Order (Pending)"?e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"font-medium text-blue-700 mb-0.5",children:"Pending Order"}),e.jsx("div",{children:Q.data.tests.map(S=>S.name).join(", ")}),e.jsx("div",{className:"text-slate-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]}):e.jsxs("div",{className:"text-xs",children:[e.jsxs("div",{className:"font-medium text-emerald-700 mb-0.5",children:["Report: ",Q.data.testName]}),e.jsxs("div",{className:"text-slate-600 italic",children:['"',Q.data.reportFindings.substring(0,50),Q.data.reportFindings.length>50?"...":"",'"']}),e.jsx("div",{className:"text-slate-400 mt-0.5 text-[10px]",children:Ii(Q.originalDateString)})]})}),e.jsx(Cl,{title:"Medications",icon:Nr,items:C,isLoading:N,loadingText:"Loading...",noDataText:"No pharmacy history.",renderItemContent:Q=>e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"text-slate-800",children:Q.data.medications.map(S=>`${S.name} (${S.quantity})`).join(", ")}),e.jsxs("div",{className:"text-slate-400 mt-0.5 text-[10px]",children:[Ii(Q.originalDateString),"  ",e.jsx("span",{className:"capitalize",children:Q.data.status})]})]})}),B.length===0&&G.length===0&&C.length===0&&!N&&e.jsx("div",{className:"text-slate-400 text-center py-4 text-xs italic bg-slate-50 rounded border border-dashed border-slate-200",children:"No history records found."})]})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-end space-x-3 mb-4",children:[e.jsxs("button",{onClick:()=>E("/dashboard/add-patient"),className:"bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded shadow flex items-center",children:[e.jsx(df,{size:18,className:"mr-2"})," Add Patient"]}),e.jsx("button",{onClick:()=>E("/search-patient"),className:"bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded shadow",children:"Search Patient"})]}),o&&e.jsx("p",{className:"text-red-500 p-4 bg-red-50 rounded",children:o}),n&&!t.currentPatient&&e.jsx("p",{className:"text-gray-500 p-4 text-center",children:"Loading queue..."}),e.jsx("div",{className:"mb-6 md:mb-8",children:L||e.jsx("div",{className:"bg-white rounded-lg shadow-md p-6 text-center text-gray-500",children:"No patient currently being seen. Use 'Call Next' or search for a patient record."})}),e.jsxs("div",{className:"current-queue-section mb-6 md:mb-8",children:[e.jsx("h2",{className:"text-xl text-blue-700 font-semibold mb-3 md:mb-4",children:"NEXT IN QUEUE:"}),t.nextPatient?e.jsxs("div",{className:"patient-info-section bg-blue-50 rounded-lg shadow-md p-5 md:p-6 border-l-8 border-blue-500",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3 md:mb-4",children:[e.jsxs("span",{className:"text-2xl md:text-3xl font-bold text-blue-800 mb-2 sm:mb-0",children:["Token #",t.nextPatient.token]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm md:text-base font-medium ${t.nextPatient.status==="waiting"?"bg-blue-200 text-blue-900":"bg-gray-200 text-gray-800"}`,children:$(t.nextPatient.status)})]}),e.jsx("div",{className:"text-2xl md:text-3xl font-bold mb-2 md:mb-3",children:t.nextPatient.name}),e.jsxs("div",{className:"text-lg md:text-xl text-gray-700 mb-3 md:mb-4",children:["Age: ",t.nextPatient.age," | ",t.nextPatient.gender]}),(t.nextPatient.complaint||t.nextPatient.case_summary)&&e.jsxs("div",{className:"mt-3 md:mt-4 pt-3 border-t border-blue-200 space-y-2",children:[t.nextPatient.complaint&&e.jsxs("p",{className:"text-base md:text-lg text-gray-800",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Complaint:"})," ",t.nextPatient.complaint]}),t.nextPatient.case_summary&&e.jsxs("p",{className:"text-sm text-gray-700 bg-yellow-50 p-2 rounded border border-yellow-200",children:[e.jsx("span",{className:"font-semibold text-gray-800",children:"AI Summary:"})," ",t.nextPatient.case_summary]})]})]}):e.jsx("div",{className:"bg-gray-50 rounded-lg shadow-inner p-6 text-center text-gray-600 border border-gray-200",children:"No patient waiting next in the queue."})]}),e.jsxs("div",{className:"actions-section mt-auto pt-4 md:pt-6 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("button",{onClick:A,disabled:n||!t.nextPatient||!!t.currentPatient,className:"btn btn-primary w-full sm:w-auto disabled:opacity-50 disabled:cursor-not-allowed order-1 sm:order-none",children:"Call Next Patient"}),e.jsx("div",{className:"bg-gray-200 inline-block px-4 py-2 rounded-full order-2 sm:order-none",children:e.jsxs("span",{className:"text-base md:text-lg font-medium",children:[t.waitingCount," patients waiting"]})})]})]})]})})},xP="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",yP={apiKey:xP},mc=()=>{const[t,s]=y.useState(""),[n,r]=y.useState([]),[o,u]=y.useState(!1),[c,d]=y.useState(null),[p,m]=y.useState(!1),[f,g]=y.useState(null),x=y.useRef(null),[j,N]=y.useState(!1),[k,D]=y.useState(!1),[_,T]=y.useState(null),[E,U]=y.useState(null),[X,I]=y.useState([]),[F,B]=y.useState(!1);Ra();const G=ot(),C=za(),A=gf({settings:{},staffList:[]}),{selectedImage:P,handleImageSelect:$,clearImage:J}=A,R=y.useRef(null),L=Y=>{var oe;const V=(oe=Y.target.files)==null?void 0:oe[0];V&&$(V)};y.useEffect(()=>{A.chatHistory.length>0&&F&&A.isProcessing},[A.chatHistory.length]),y.useEffect(()=>{(async()=>{try{const V=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),oe=await ae(`/api/patients?${V.toString()}`);if(oe.ok){const Pe=await oe.json();I(Pe.patients||[])}}catch(V){console.error("Error fetching recent patients:",V)}})()},[]),y.useEffect(()=>{A.setChatQuery(t)},[t]);const M=y.useCallback(async Y=>{if(!(Y||t).trim()){g("Please enter complaint details.");return}m(!0),g(null),Y&&Y!==A.chatQuery&&A.setChatQuery(Y);try{A.handleSendMessage(),s("")}catch(oe){console.error("AI Error:",oe),g("AI failed to process. Try again."),m(!1)}},[t,A]);y.useEffect(()=>{!A.isProcessing&&p&&m(!1)},[A.isProcessing,p]),y.useEffect(()=>{const Y=x.current;Y&&(Y.style.height="auto",Y.style.height=`${Y.scrollHeight}px`);const oe=new URLSearchParams(C.search).get("caseDetails");if(oe){const Pe=decodeURIComponent(oe);Pe!==t&&(s(Pe),N(!0))}},[C.search,t]),y.useEffect(()=>{j&&t.trim()&&(G(C.pathname,{replace:!0}),M(t),N(!1))},[j,t,M,G,C.pathname]),y.useEffect(()=>{const Y=x.current;Y&&(Y.style.height="auto",Y.style.height=`${Y.scrollHeight}px`)},[t]),y.useEffect(()=>{_&&(s(_),D(!1),A.setChatQuery(_),setTimeout(()=>A.handleSendMessage(),0),T(null))},[_,A]);const Z=()=>{U({id:null,token:null,name:"New Case",age:null,gender:null}),D(!0)},Q=y.useMemo(()=>Ec(async Y=>{const V=Y.trim(),oe=/^\d+$/.test(V),Pe=V.split(/\s+/).length;if(V.length<2||oe&&V.length>10||!oe&&Pe>2){r([]),u(!1),d(null);return}u(!0),d(null);try{const se=new URLSearchParams({search:encodeURIComponent(Y),page:"1",limit:"20",sortBy:"name",sortOrder:"asc"}),Ce=await ae(`/api/patients?${se.toString()}`);if(!Ce.ok){const je=await Ce.text();throw new Error(`API Error (${Ce.status}): ${je||Ce.statusText}`)}const ee=await Ce.json();r(ee.patients)}catch(se){console.error("Error searching patients:",se),d(se.message||"Failed to search patients."),r([])}finally{u(!1)}},300),[]),S=Y=>{const V=Y.target.value;s(V);const oe=V.trim(),Pe=/^\d+$/.test(oe),se=oe.split(/\s+/).length;oe.length>=2&&!(Pe&&oe.length>10||!Pe&&se>2)?u(!0):(u(!1),r([])),Q(V)},ge=Y=>{Y.key==="Enter"&&!Y.shiftKey&&(Y.preventDefault(),t.trim()&&!o&&K())},fe=async Y=>{Y&&Y.id&&G(`/dashboard/edit-complaint/patient/${Y.id}`)},w=[{icon:"",title:"Example: Fever & Cold",description:"Rajesh Kumar, 35 year old male, fever since 2 days, cold, body pain, no cough",text:"Rajesh Kumar, 35 year old male, fever since 2 days, cold, body pain, no cough"},{icon:"",title:"Example: Stomach Ache",description:"Priya Sharma, 28 year old female, stomach pain after eating, acidity, bloating since 3 days",text:"Priya Sharma, 28 year old female, stomach pain after eating, acidity, bloating since 3 days"}],ue=Y=>{s(Y),setTimeout(()=>{A.handleSendMessage(Y),s(""),r([])},50)},Ne=()=>{s(""),r([]),A.refreshChat()},K=()=>{!t.trim()&&!P||(Q.cancel(),A.handleSendMessage(t),s(""),r([]))};return e.jsxs("div",{className:"patient-search-page-container",children:[e.jsxs("div",{className:"patient-search-header",children:[e.jsx("button",{onClick:()=>G("/dashboard/queue"),className:"patient-search-button patient-search-button-primary",children:"OPD Queue"}),e.jsx("button",{onClick:()=>G(-1),className:"patient-search-button patient-search-button-back",children:e.jsx(vt,{size:16})})]}),e.jsxs("div",{className:"patient-search-content-box",children:[c&&e.jsx("p",{className:"patient-search-error",children:c}),f&&e.jsx("p",{className:"patient-search-error",children:f}),X.length>0&&e.jsxs("div",{className:"newly-registered-section",children:[e.jsx("div",{className:"recent-list",children:X.map(Y=>e.jsxs("div",{className:"recent-patient-pill",onClick:()=>fe(Y),children:[e.jsxs("div",{className:"recent-name-container",children:[e.jsx("span",{className:"recent-name",children:Y.name||"New Patient"}),e.jsxs("span",{className:"recent-token",children:["#",Y.token]})]}),e.jsxs("div",{className:"recent-info",children:[Y.age," yrs / ",Y.gender]})]},Y.id))}),e.jsx("div",{className:"newly-registered-label",children:"NEWLY REGISTERED"})]}),A.chatHistory.length===0&&n.length===0&&e.jsxs("div",{className:"example-cases-section",children:[e.jsxs("div",{className:"example-cases-header",children:[e.jsx("span",{className:"sparkles-icon",children:""}),e.jsx("h3",{children:"Try AI with Example Cases"})]}),e.jsx("div",{className:"example-cards-container",children:w.map((Y,V)=>e.jsxs("div",{className:"example-case-card",onClick:()=>ue(Y.text),children:[e.jsx("div",{className:"example-icon",children:Y.icon}),e.jsxs("div",{className:"example-content",children:[e.jsx("div",{className:"example-title",children:Y.title}),e.jsx("div",{className:"example-description",children:Y.description})]})]},V))})]})]}),A.chatHistory.length>0&&!p&&e.jsxs("div",{className:`ai-chat-overlay ${F?"minimized":""}`,children:[e.jsxs("div",{className:"ai-chat-header",children:[e.jsx("span",{children:"AI Assistant"}),e.jsx("div",{className:"ai-chat-controls",children:e.jsx("button",{className:"icon-btn",onClick:()=>Ne(),title:"Clear Chat",children:e.jsx(Et,{size:16})})})]}),e.jsxs("div",{className:"ai-chat-messages",children:[A.chatHistory.map((Y,V)=>e.jsx("div",{className:`chat-bubble ${Y.role==="model"?"model":"user"}`,children:Y.role==="system"?e.jsx("i",{children:Y.text}):Y.text},V)),A.isProcessing&&e.jsx("div",{className:"chat-bubble model",children:"Typing..."})]})]}),n.length>0&&!p&&e.jsxs("div",{className:"patient-search-results-overlay",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"0.5rem"},children:[e.jsx("div",{style:{fontWeight:600,color:"#64748b"},children:"Found Patients"}),e.jsx("button",{onClick:()=>r([]),style:{border:"none",background:"transparent",color:"#94a3b8",cursor:"pointer"},children:e.jsx(Et,{size:14})})]}),n.map(Y=>e.jsxs("div",{onClick:()=>fe(Y),className:"patient-search-result-item",children:[e.jsxs("div",{className:"patient-search-result-item-name-container",children:[e.jsxs("span",{className:"patient-search-result-item-token",children:["[#",Y.token,"]"]}),e.jsx("span",{className:"patient-search-result-item-name",children:Y.name})]}),e.jsxs("div",{className:"patient-search-result-item-details",children:[Y.age?`${Y.age} yrs`:"",Y.age&&Y.gender?" / ":"",Y.gender||"N/A"]})]},Y.id))]}),e.jsxs("div",{className:"sticky-chat-input-box",children:[e.jsxs("div",{className:"cmd-input-container",children:[P&&e.jsxs("div",{className:"cmd-image-preview",children:[e.jsx("img",{src:P,alt:"Selected"}),e.jsx("button",{className:"cmd-image-delete",onClick:J,children:e.jsx(Et,{size:12})})]}),e.jsx("textarea",{ref:x,placeholder:"Search (Name/Token/Phone), Ask AI, or Enter New Case...",value:t,onChange:S,onKeyDown:ge,className:"cmd-input",disabled:p||A.isProcessing,rows:1}),e.jsxs("div",{className:"cmd-controls-group",children:[e.jsx("input",{type:"file",ref:R,onChange:L,accept:"image/*",style:{display:"none"}}),e.jsx("button",{className:"cmd-icon-btn",onClick:()=>{var Y;return(Y=R.current)==null?void 0:Y.click()},title:"Attach Image",children:e.jsx(Td,{})}),e.jsx("button",{className:"cmd-icon-btn",onClick:Z,title:"Voice Input",children:e.jsx(kc,{})}),(t.length>0||P)&&e.jsx("button",{className:"cmd-icon-btn send-btn",onClick:K,title:"Send",children:e.jsx(Ad,{})})]})]}),k&&e.jsx(Tc,{options:yP,children:e.jsx(Md,{onClose:()=>D(!1),patientData:E,tokenNumber:null,onAiSummaryChange:T})})]})]})},Pv=()=>{const[t,s]=y.useState(""),[n,r]=y.useState([]),[o,u]=y.useState(null),[c,d]=y.useState(null),[p,m]=y.useState(null),[f,g]=y.useState(null),[x,j]=y.useState(!1),[N,k]=y.useState(!1),[D,_]=y.useState(null),T=ot(),E=y.useCallback(Cv.debounce(async C=>{if(C.trim().length<2){r([]),k(!1);return}k(!0),_(null);try{const A=new URLSearchParams({search:encodeURIComponent(C),page:"1",limit:"20",sortBy:"name",sortOrder:"asc"}),P=await ae(`/api/patients?${A.toString()}`);if(!P.ok){const J=await P.text();throw new Error(`API Error (${P.status}): ${J||P.statusText||"Failed to fetch patients"}`)}const $=await P.json();r($.patients)}catch(A){_(A instanceof Error?A.message:"An unknown error occurred while searching patients"),r([])}finally{k(!1)}},500),[]);y.useEffect(()=>(t?(k(!0),E(t)):(r([]),E.cancel()),()=>{E.cancel()}),[t,E]);const U=C=>{u(C),s(""),r([]),_(null),d(null),m(null),g(null),j(!1)},X=async()=>{if(!o){_("No patient selected.");return}_(null),k(!0);try{const C=await ae(`/api/patients/${o.id}/admit`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!C.ok){const P=await C.json().catch(()=>({message:"Failed to admit patient"}));throw new Error(P.message||"Failed to admit patient")}const A=await C.json();alert(A.message||"Patient admitted successfully!"),A.bill&&A.bill.id?T(`/patient/${o.id}/admission-bill/${A.bill.id}`):(console.error("Admission successful, but bill ID missing in response."),_("Admission successful, but couldn't navigate to billing."),u(A.patient))}catch(C){_(C instanceof Error?C.message:"Failed to admit patient")}finally{k(!1)}};y.useEffect(()=>{(async()=>{if(!o||!o.admission_date||o.discharge_date){d(null),g(null);return}j(!0),m(null),d(null),g(null);try{const A=await ae(`/api/patients/${o.id}/active-bill?type=admission`);if(!A.ok)throw A.status===404?new Error("No active admission bill found."):new Error("Failed to fetch active bill ID.");const P=await A.json(),$=P==null?void 0:P.id;if(!$)throw new Error("Active admission bill ID not found in response.");d($);const J=await ae(`/api/bills/${$}`);if(!J.ok)throw new Error(`Failed to fetch bill details (ID: ${$}). Status: ${J.status}`);const R=await J.json();if(R&&R.calculated)g(R.calculated);else throw console.error("Fetched bill details missing 'calculated' object:",R),new Error("Fetched bill details are incomplete (missing calculated data).")}catch(A){m(A instanceof Error?A.message:"An unknown error occurred while fetching bill details."),d(null),g(null)}finally{j(!1)}})()},[o]);const I=async()=>{if(!o){_("No patient selected.");return}if(!o.admission_date||o.discharge_date){_("Patient is not currently admitted.");return}_(null),k(!0);try{const C=await ae(`/api/patients/${o.id}/discharge`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!C.ok){const P=await C.json().catch(()=>({message:"Failed to discharge patient"}));throw new Error(P.message||"Failed to discharge patient")}const A=await C.json();alert(A.message||"Patient discharged successfully!"),A.patient?u(A.patient):(console.error("Discharge successful, but updated patient info missing in response."),u(null),_("Discharge successful, but couldn't update patient details locally."))}catch(C){_(C instanceof Error?C.message:"Failed to discharge patient")}finally{k(!1)}},F=()=>{if(!o||!c){_("Cannot navigate to billing: Patient or Bill ID missing.");return}T(`/patient/${o.id}/admission-bill/${c}`)};let B="",G=null;if(o){const C=o.admission_date?new Date(o.admission_date).toLocaleDateString():null,A=o.discharge_date?new Date(o.discharge_date).toLocaleDateString():null;o.admission_date?o.admission_date&&!o.discharge_date?(B=`Patient admitted on: ${C}`,G=e.jsxs("div",{className:"space-y-4",children:[" ",x&&e.jsx("p",{className:"text-sm text-gray-500 text-center",children:"Loading billing details..."})," ",p&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:p})," ",!x&&f&&e.jsxs("div",{className:"admission-card",children:[e.jsx("h3",{className:"admission-card-title",children:"Billing Summary"}),e.jsxs("div",{className:"admission-card-content",children:[e.jsxs("p",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Due:"}),e.jsxs("span",{children:["",(Number(f.totalDue)||0).toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between text-sm text-green-700",children:[" ",e.jsx("span",{children:"Total Paid:"}),e.jsxs("span",{children:["",(Number(f.totalPaid)||0).toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between text-sm font-bold mt-1 text-red-600",children:[" ",e.jsx("span",{children:"Balance Due:"}),e.jsxs("span",{children:["",(Number(f.balance)||0).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:F,disabled:N||x||!c,className:`admission-button admission-button-secondary ${N||x||!c?"opacity-50 cursor-not-allowed":""}`,children:x?"Loading Bill...":!c&&!p?"Finding Bill...":"Pay Bill / View Details"}),e.jsx("button",{onClick:I,disabled:N||x,className:`admission-button admission-button-danger ${N||x?"opacity-50 cursor-not-allowed":""}`,children:N?"Processing...":"Discharge Patient"})]})]})):(B=`Patient admitted on ${C} and discharged on ${A}.`,G=e.jsx("p",{className:"text-center text-gray-600 italic",children:"Patient has been discharged."})):(B="Patient is not admitted.",G=e.jsx("button",{onClick:X,disabled:N,className:`admission-button ${N?"opacity-50 cursor-not-allowed":""}`,children:N?"Processing...":"Admit Patient"}))}return e.jsxs("div",{className:"admission-page-container",children:[e.jsxs("div",{className:"admission-header-container",children:[e.jsxs("button",{onClick:()=>T(-1),className:"back-button",children:[e.jsx(vt,{size:16}),"Back"]}),e.jsx("h1",{className:"admission-header",children:"Manage Admission/Discharge"})]}),e.jsxs("div",{className:"admission-section mb-6 relative",children:[e.jsx("label",{htmlFor:"patientSearch",className:"admission-label",children:"Search Patient (Name, Phone, or Token)"}),e.jsx("input",{type:"text",id:"patientSearch",value:t,onChange:C=>s(C.target.value),placeholder:"Start typing to search...",className:"admission-input"}),N&&!o&&e.jsx("div",{className:"absolute right-3 top-9 text-sm text-gray-500",children:"Loading..."})," ",n.length>0&&!o&&e.jsxs("ul",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto",children:[" ",n.map(C=>e.jsxs("li",{onClick:()=>U(C),className:"px-4 py-2 hover:bg-gray-100 cursor-pointer",children:[" ",C.name," (Token: ",C.token,")",e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[C.admission_date?`Admitted: ${new Date(C.admission_date).toLocaleDateString()}`:"Not Admitted",C.discharge_date?`, Discharged: ${new Date(C.discharge_date).toLocaleDateString()}`:""]})]},C.id))]}),n.length===0&&t&&!N&&!o&&e.jsxs("div",{className:"absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg p-4 text-gray-500",children:['No patients found matching "',t,'".']})]}),o&&e.jsxs("div",{className:"admission-section",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"admission-section-title",children:"Selected Patient"}),e.jsx("button",{onClick:()=>u(null),className:"admission-link",children:"Clear Selection"})]}),e.jsxs("div",{className:"admission-card-content mb-4 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",o.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Token:"})," ",o.token]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",o.age??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Gender:"})," ",o.gender??"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",o.phone??"N/A"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Address:"})," ",o.address??"N/A"]})]}),e.jsx("hr",{className:"my-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:B})," ",D&&e.jsx("p",{className:"text-red-500 text-sm mb-3",children:D})," ",G]})]})},cp=15,Gp=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(!0),[u,c]=y.useState(null),[d,p]=y.useState(""),[m,f]=y.useState(1),[g,x]=y.useState(1),[j,N]=y.useState(0),[k,D]=y.useState("created_at"),[_,T]=y.useState("desc"),[E,U]=y.useState(""),[X,I]=y.useState(!1),[F,B]=y.useState(null),[G,C]=y.useState([]),[A,P]=y.useState(""),[$,J]=y.useState(!1),[R,L]=y.useState(null),[M,Z]=y.useState(!0),[Q,S]=y.useState(null),[ge,fe]=y.useState(d);Ra(),y.useEffect(()=>{const se=setTimeout(()=>{fe(d),f(1)},500);return()=>{clearTimeout(se)}},[d]);const w=y.useCallback(async()=>{Z(!0),S(null);try{const se=await ae("/api/subscriptions");if(!se.ok){let ee=`Failed to fetch subscription plans (${se.status})`;try{ee=(await se.json()).message||ee}catch{}throw new Error(ee)}const Ce=await se.json();C(Ce)}catch(se){console.error("Error fetching subscription plans:",se),S(se.message||"An unknown error occurred while fetching plans."),C([])}finally{Z(!1)}},[]),ue=y.useCallback(async(se,Ce,ee,je,Ie)=>{o(!0),c(null);try{const $e=new URLSearchParams({page:se.toString(),limit:cp.toString(),sortBy:ee,sortOrder:je});Ce&&$e.append("search",Ce),Ie&&$e.append("gender",Ie);const Fe=await ae(`/api/patients?${$e.toString()}`);if(!Fe.ok){const qe=await Fe.json();throw new Error(qe.message||"Failed to fetch patients")}const Be=await Fe.json();n(Be.patients),N(Be.totalCount),f(Be.currentPage),x(Be.totalPages)}catch($e){console.error("Error fetching patients:",$e),c(`Failed to load patients: ${$e.message}`),n([]),N(0),f(1),x(1)}finally{o(!1)}},[]);y.useEffect(()=>{ue(m,ge,k,_,E),w()},[m,ge,k,_,E,ue,w]);const Ne=se=>{const Ce=k===se&&_==="asc"?"desc":"asc";D(se),T(Ce),f(1)},K=se=>{try{return new Date(se).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},Y=()=>{I(!1),B(null),P(""),L(null),J(!1)},V=async(se,Ce)=>{n(ee=>ee.map(je=>je.id===se?{...je,insurance_type:Ce}:je));try{const ee=await ae(`/api/patients/${se}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:Ce})});if(!ee.ok){const je=await ee.json();throw new Error(je.message||"Failed to update insurance type")}}catch(ee){console.error("Error updating insurance type:",ee),ue(m,ge,k,_,E)}},oe=(se,Ce)=>{const ee=new Date(se),je=Ce.interval||1;switch(Ce.period){case"daily":ee.setDate(se.getDate()+je);break;case"weekly":ee.setDate(se.getDate()+je*7);break;case"monthly":ee.setMonth(se.getMonth()+je);break;case"yearly":ee.setFullYear(se.getFullYear()+je);break;default:console.warn(`Unknown subscription period: ${Ce.period}. Defaulting to 1 month.`),ee.setMonth(se.getMonth()+1)}return ee},Pe=async()=>{if(!F||!A){L("Please select a subscription plan.");return}const se=G.find(Ce=>Ce.id===A);if(!se){L("Selected plan details not found.");return}J(!0),L(null);try{const Ce=new Date,ee=oe(Ce,se),je={subscription_plan_id:A,subscription_status:"active",subscription_start_date:Ce.toISOString(),subscription_end_date:ee.toISOString(),subscription_payment_method:"manual"},Ie=await ae(`/api/patients/${F.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)});if(!Ie.ok){const $e=await Ie.json();throw new Error($e.message||"Failed to update patient subscription")}Y(),ue(m,ge,k,_,E)}catch(Ce){console.error("Error starting subscription:",Ce),L(`Failed to start subscription: ${Ce.message}`)}finally{J(!1)}};return e.jsxs("div",{className:"all-patients-container",children:[e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16}),"Back"]}),e.jsxs("h1",{className:"all-patients-title",children:[e.jsx(Oa,{size:28}),"All Registered Patients"]}),u&&e.jsxs("div",{className:"error-alert",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:u})]}),e.jsxs("div",{className:"subscription-plans-card",children:[e.jsx("h2",{className:"subscription-plans-title",children:"Available Subscription Plans"}),e.jsx("div",{children:M?e.jsx("p",{className:"loading-state",children:"Loading plans..."}):Q?e.jsxs("p",{className:"error-message",children:["Error loading plans: ",Q]}):G.length===0?e.jsx("p",{className:"empty-state",children:"No active subscription plans found."}):e.jsx("ul",{className:"subscription-plans-list",children:G.map(se=>e.jsxs("li",{children:[e.jsx("strong",{children:se.name}),": ",se.price," / ",se.interval," ",se.period,se.interval>1?"s":"",se.description&&e.jsx("span",{className:"plan-description",children:se.description})]},se.id))})})]}),e.jsxs("div",{className:"controls-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search by name or phone...",className:"search-input",value:d,onChange:se=>p(se.target.value)}),e.jsx(mn,{className:"search-input-icon",size:20})]}),e.jsxs("div",{className:"filter-dropdown-wrapper",children:[e.jsx("label",{htmlFor:"genderFilter",className:"sr-only",children:"Filter by Gender"}),e.jsxs("div",{className:"filter-select-container",children:[e.jsx(Iw,{size:16,className:"filter-select-icon"}),e.jsxs("select",{id:"genderFilter",value:E,onChange:se=>U(se.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]})]}),r?e.jsx("div",{className:"loading-state",children:"Loading patients..."}):s.length===0?e.jsx("div",{className:"empty-state",children:ge?"No patients found matching your search.":"No patients registered yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"patients-table-wrapper",children:e.jsxs("table",{className:"patients-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Token"}),e.jsxs("th",{className:"sortable-header",onClick:()=>Ne("name"),children:["Name",k==="name"&&(_==="asc"?e.jsx(Pp,{size:14,className:"sort-icon"}):e.jsx(Hy,{size:14,className:"sort-icon"}))]}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Gender"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsxs("th",{className:"sortable-header",onClick:()=>Ne("created_at"),children:["Registered On",k==="created_at"&&(_==="asc"?e.jsx(Pp,{size:14,className:"sort-icon"}):e.jsx(Hy,{size:14,className:"sort-icon"}))]}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Insurance Type"})," ",e.jsx("th",{children:"Action"})," "]})}),e.jsx("tbody",{children:s.map(se=>e.jsxs("tr",{children:[e.jsx("td",{children:se.token??"-"}),e.jsx("td",{className:"patient-name",children:se.name}),e.jsx("td",{children:se.age??"-"}),e.jsx("td",{children:se.gender??"-"}),e.jsx("td",{children:se.phone??"-"}),e.jsx("td",{children:se.address??"-"}),e.jsx("td",{children:K(se.created_at)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${se.subscription_status==="active"?"active":se.subscription_status==="cancelled"||se.subscription_status==="expired"?"inactive":"none"}`,children:se.subscription_status??"None"})}),e.jsx("td",{children:e.jsxs("select",{value:se.insurance_type,onChange:Ce=>V(se.id,Ce.target.value),className:"form-select insurance-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>t(`/start-subscription/${se.id}`),className:"action-button",children:"Start Sub"})})]},se.id))})]})}),g>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("div",{className:"pagination-info",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(m-1)*cp+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(m*cp,j)})," ","of"," ",e.jsx("span",{className:"font-medium",children:j})," results"]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsxs("button",{onClick:()=>f(se=>Math.max(se-1,1)),disabled:m===1||r,className:"pagination-button",children:[e.jsx(Pd,{size:16,className:"prev-icon"}),"Previous"]}),e.jsxs("span",{className:"pagination-current-page",children:["Page ",e.jsx("span",{className:"font-medium",children:m})," of ",e.jsx("span",{className:"font-medium",children:g})]}),e.jsxs("button",{onClick:()=>f(se=>Math.min(se+1,g)),disabled:m===g||r,className:"pagination-button",children:["Next",e.jsx(Ul,{size:16,className:"next-icon"})]})]})]})]}),X&&F&&e.jsx("div",{className:"subscription-modal-overlay",children:e.jsxs("div",{className:"subscription-modal-content",children:[e.jsxs("div",{className:"subscription-modal-header",children:[e.jsxs("h2",{className:"subscription-modal-title",children:["Start Subscription for ",F.name]}),e.jsx("button",{onClick:Y,className:"subscription-modal-close-button",children:e.jsx(Et,{size:24})})]}),R&&e.jsx("div",{className:"error-alert",role:"alert",children:e.jsx("span",{children:R})}),e.jsxs("div",{className:"subscription-modal-body",children:[e.jsx("label",{htmlFor:"subscriptionPlan",className:"form-label",children:"Select Plan:"}),e.jsxs("select",{id:"subscriptionPlan",value:A,onChange:se=>P(se.target.value),className:"form-select",disabled:$||M||Q!==null||G.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a Plan --"}),M?e.jsx("option",{value:"",disabled:!0,children:"Loading plans..."}):Q?e.jsx("option",{value:"",disabled:!0,children:"Error loading plans"}):G.length>0?G.map(se=>e.jsxs("option",{value:se.id,children:[se.name," - ",se.price," (",se.interval," ",se.period,se.interval>1?"s":"",")"]},se.id)):e.jsx("option",{value:"",disabled:!0,children:"No active plans found"})]}),Q&&e.jsx("p",{className:"error-message",children:Q}),G.length===0&&!M&&!Q&&e.jsx("p",{className:"empty-state",children:"No active subscription plans available."})]}),e.jsxs("div",{className:"subscription-modal-footer",children:[e.jsx("button",{onClick:Y,disabled:$,className:"subscription-modal-button cancel",children:"Cancel"}),e.jsx("button",{onClick:Pe,disabled:!A||$,className:"subscription-modal-button submit",children:$?"Starting...":"Start Subscription"})]})]})})]})},Iv=()=>{const t=ot(),[s]=y.useState(!0),[n,r]=y.useState(""),[o,u]=y.useState([]),[c,d]=y.useState(!1),[p,m]=y.useState(null),[f,g]=y.useState(!1),x=/^\+?[0-9\s\-().]{7,20}$/,j=y.useMemo(()=>Ec(async _=>{if(_.trim().length<2){u([]),d(!1),m(null);return}d(!0),m(null);try{const T=new URLSearchParams({search:encodeURIComponent(_),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),E=await ae(`/api/patients?${T.toString()}`);if(!E.ok){const X=await E.text();throw new Error(`API Error (${E.status}): ${X||E.statusText}`)}const U=await E.json();u(U.patients)}catch(T){console.error("Error searching patients:",T),m(T.message||"Failed to search patients."),u([])}finally{d(!1)}},300),[]),N=_=>{const T=_.target.value;r(T),g(x.test(T)),d(!0),j(T)},k=y.useCallback(_=>{t("/billing",{state:{patientId:_.id,patientName:_.name}})},[t]),D=y.useCallback(async()=>{if(!n||!f){m("Invalid phone number to create a new patient.");return}d(!0),m(null);try{const T=await ae("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"direct pharmacy",phone:n,age:null,gender:null,token:null})});if(!T.ok){const U=await T.json();throw new Error(U.message||`Failed to create patient: ${T.statusText}`)}const E=await T.json();alert(`New patient "direct pharmacy" created with phone ${E.phone}.`),k(E)}catch(_){console.error("Error creating new patient:",_),m(_.message||"Failed to create new patient.")}finally{d(!1)}},[n,f,k]);return e.jsxs("div",{className:"create-custom-bill-page p-4 md:p-6 max-w-5xl mx-auto",children:[e.jsx("div",{className:"page-header flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 pb-4",children:e.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[e.jsx("button",{onClick:()=>t(-1),className:"back-button p-2 rounded-full mr-3",title:"Go Back",children:e.jsx(vt,{size:20})}),e.jsx("h2",{className:"text-2xl",children:"Create Custom Bill"})]})}),s&&e.jsxs("div",{className:"content-section",children:[e.jsx("h3",{className:"section-title",children:"Select Patient"}),e.jsxs("div",{className:"mb-3 relative",children:[e.jsx("label",{htmlFor:"patient-search",className:"form-label",children:"Search Patient (Name, Token, or Phone)"}),e.jsx("input",{type:"text",id:"patient-search",placeholder:"Search by Name, Token No, or Phone No (min 2 chars)...",value:n,onChange:N,className:"custom-text-input mt-1",autoFocus:!0}),c&&e.jsx("span",{className:"absolute right-3 top-9 text-xs text-gray-400",children:"Searching..."})]}),p&&e.jsx("div",{className:"ai-function-status error mb-3 p-3",children:p}),o.length>0&&e.jsx("div",{className:"patient-search-results max-h-64 overflow-y-auto rounded-md shadow-sm mt-1 z-10",children:e.jsx("ul",{children:o.map(_=>e.jsxs("li",{onClick:()=>k({id:_.id,name:_.name,token:_.token,age:_.age,gender:_.gender,phone:_.phone}),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{className:"font-medium",children:[e.jsxs("span",{className:"patient-token mr-2",children:["#",_.token]}),_.name]}),e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:mt-0",children:[_.age?`${_.age} yrs`:"Age N/A",_.gender?` / ${_.gender}`:" / Gender N/A",_.phone&&e.jsxs("span",{className:"hidden sm:inline",children:[" / ",_.phone]})]})]}),_.phone&&e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:hidden",children:["Phone: ",_.phone]})]},_.id))})}),n.length>=2&&!c&&o.length===0&&!p&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-400 mt-2 text-sm",children:['No patients found matching "',n,'".']}),f&&e.jsx("button",{type:"button",onClick:D,className:"create-patient-button mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",disabled:c,children:'Create "direct pharmacy" Patient with this Phone'})]}),n.length<2&&!c&&e.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"Enter at least 2 characters to search."})]})]})},Ov=({currentUser:t})=>{const s=ot(),[n,r]=y.useState("select_patient"),[o,u]=y.useState({name:"",age:void 0,gender:null,phone:"",address:""}),[c,d]=y.useState(null),[p,m]=y.useState([]),[f,g]=y.useState([]),[x,j]=y.useState(""),[N,k]=y.useState([]),[D,_]=y.useState(""),[T,E]=y.useState([]),[U,X]=y.useState(!1),[I,F]=y.useState(null),[B,G]=y.useState(null),[C,A]=y.useState(null),[P,$]=y.useState(!1),[J,R]=y.useState(!1),[L,M]=y.useState(!1),Z=/^\+?[0-9\s\-().]{7,20}$/,Q=/^[a-zA-Z\s'-]{2,}$/,S=y.useCallback(async()=>{if(!(p.length>0)){$(!0),A(null);try{const se=await ae("/api/lab-tests");if(!se.ok)throw new Error("Failed to fetch lab tests");const Ce=await se.json();m(Ce)}catch(se){console.error("Failed to fetch available lab tests:",se),A("Could not load lab test list: "+se.message),m([])}finally{$(!1)}}},[p.length]);y.useEffect(()=>{if(!x){k([]);return}const se=x.toLowerCase();k(p.filter(Ce=>Ce.name.toLowerCase().includes(se)||Ce.description&&Ce.description.toLowerCase().includes(se)).slice(0,10))},[x,p]);const ge=y.useCallback(se=>{const Ce={id:se.id,name:se.name,token:se.token,age:se.age,gender:se.gender,phone:se.phone};d(Ce),r("create_order"),g([]),j(""),k([]),A(null),S()},[S]),fe=y.useMemo(()=>Ec(async se=>{if(se.trim().length<2){E([]),X(!1),F(null);return}X(!0),F(null);try{const Ce=new URLSearchParams({search:encodeURIComponent(se),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),ee=await ae(`/api/patients?${Ce.toString()}`);if(!ee.ok){const Ie=await ee.text();throw new Error(`API Error (${ee.status}): ${Ie||ee.statusText}`)}const je=await ee.json();E(je.patients)}catch(Ce){console.error("Error searching lab patients:",Ce),F(Ce.message||"Failed to search lab patients."),E([])}finally{X(!1)}},300),[Z,Q]),w=se=>{const Ce=se.target.value;_(Ce),R(Z.test(Ce)),M(Q.test(Ce)&&!Z.test(Ce)),X(!0),fe(Ce)},ue=y.useCallback(async se=>{if(!D||se==="phone"&&!J||se==="name"&&!L){F(`Invalid ${se} to create a new patient.`);return}X(!0),F(null);try{const ee=await ae("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:se==="name"?D:"direct lab",phone:se==="phone"?D:null,age:null,gender:null,token:null})});if(!ee.ok){const Ie=await ee.json();throw new Error(Ie.message||`Failed to create patient: ${ee.statusText}`)}const je=await ee.json();alert(`New patient "${je.name}" created with ${se==="phone"?`phone ${je.phone}`:`name ${je.name}`}.`),ge({id:je.id,name:je.name,token:je.token??null,age:je.age??null,gender:je.gender??null,phone:je.phone})}catch(Ce){console.error("Error creating new patient:",Ce),F(Ce.message||"Failed to create new patient.")}finally{X(!1)}},[D,J,L,ge]),Ne=()=>{r("select_patient"),d(null),_(""),E([]),F(null)},K=se=>{const{name:Ce,value:ee}=se.target;u(je=>({...je,[Ce]:Ce==="age"?ee?parseInt(ee,10):void 0:ee}))},Y=async se=>{if(se.preventDefault(),G(null),!o.name){G("Patient Name is required.");return}const Ce={name:o.name,age:o.age,gender:o.gender,phone:o.phone,address:o.address};try{const ee=await ae("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)});if(!ee.ok){const Ie=await ee.json();throw new Error(Ie.message||`Failed to create patient: ${ee.statusText}`)}const je=await ee.json();alert(`Patient "${je.name}" created successfully!`),ge({id:je.id,name:je.name,token:je.token??null,age:je.age??null,gender:je.gender??null,phone:je.phone})}catch(ee){console.error("Failed to create patient:",ee),G(ee.message||"Failed to create patient. Please try again.")}},V=se=>{if(f.some(Ce=>Ce.id===se.id)){A(`${se.name} is already in the order.`),setTimeout(()=>A(null),3e3),j(""),k([]);return}g(Ce=>[...Ce,{...se}]),j(""),k([])},oe=se=>{g(Ce=>Ce.filter(ee=>ee.id!==se))},Pe=async se=>{if(se.preventDefault(),A(null),!c){A("No patient selected.");return}if(f.length===0){A("No lab tests selected.");return}const Ce={patient_id:c.id,tests:f.map(ee=>({id:ee.id,name:ee.name,price:ee.price}))};console.log("Submitting Lab Order:",Ce);try{const ee=await ae("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)});if(!ee.ok){const $e=await ee.json();throw console.error("API Error Data:",$e),new Error($e.message||`Failed to create lab order: ${ee.statusText}`)}const je=await ee.json();console.log("Lab Order Creation Result:",je);let Ie=c.queueId;if(!Ie){const $e=await ae(`/api/queue/patient/${c.id}/latest`);if($e.ok){const Fe=await $e.json();Fe!=null&&Fe._id&&(Ie=Fe._id)}}if(!Ie){const $e=await ae("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:c.id})});if(!$e.ok){const Be=await $e.text();throw new Error(`Failed to create queue entry for redirection: ${Be||$e.statusText}`)}const Fe=await $e.json();if(Fe!=null&&Fe.id)Ie=Fe.id;else throw new Error("Failed to get ID from new queue entry for redirection.")}alert(`Lab order created successfully for ${c.name}!`),(t==null?void 0:t.role)==="lab"?s("/dashboard"):s(`/dashboard/edit-complaint/${Ie}`)}catch(ee){console.error("Failed to create lab order:",ee),A(ee.message||"Failed to create lab order.")}};return y.useEffect(()=>{S()},[S]),e.jsxs("div",{className:"create-lab-order-container",children:[e.jsxs("div",{className:"create-lab-order-header",children:[e.jsxs("button",{onClick:()=>s(-1),className:"back-button","aria-label":"Go back",children:[e.jsx(vt,{size:20,style:{marginRight:"8px"}}),"Back"]}),e.jsx("h1",{className:"create-lab-order-title",children:"Create New Lab Order"}),e.jsx("div",{style:{width:"64px"}})," "]}),(n==="select_patient"||n==="create_patient")&&e.jsxs("div",{className:"glass-card",children:[n==="select_patient"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-with-action",children:e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"Select Patient"})}),e.jsxs("div",{className:"search-container",children:[e.jsx(mn,{className:"search-icon",size:20}),e.jsx("input",{type:"text",id:"lab-patient-search",placeholder:"Search by Name, Token No, or Phone No...",value:D,onChange:w,className:"modern-input",autoFocus:!0,autoComplete:"off"}),U&&e.jsx("span",{className:"loading-text",style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)",fontSize:"0.8rem"},children:"Searching..."})]}),I&&e.jsxs("div",{className:"error-message",children:[e.jsx(pn,{size:18}),I]}),T.length>0&&e.jsx("ul",{className:"patient-list",children:T.map(se=>e.jsxs("li",{onClick:()=>ge(se),className:"patient-list-item",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("strong",{children:se.name}),e.jsxs("span",{className:"token-badge",children:["#",se.token||"N/A"]})]}),e.jsxs("div",{className:"patient-details",children:[se.age?`${se.age} yrs`:"",se.gender?` / ${se.gender}`:"",se.phone?`  ${se.phone}`:""]})]},se.id))}),D.length>=2&&!U&&T.length===0&&!I&&e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsxs("p",{className:"no-data-message",style:{background:"none",border:"none",padding:0},children:['No patients found matching "',D,'".']}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"15px",marginTop:"15px"},children:[J&&e.jsxs("button",{type:"button",onClick:()=>ue("phone"),className:"secondary-button",children:['Create "Direct Lab" Patient (Phone: ',D,")"]}),L&&e.jsxs("button",{type:"button",onClick:()=>ue("name"),className:"secondary-button",children:["Create Patient (Name: ",D,")"]})]})]}),D.length<2&&!U&&e.jsx("div",{className:"info-message",children:"Start typing to search for a patient..."})]}),n==="create_patient"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-with-action",children:[e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"New Patient Registration"}),e.jsx("button",{onClick:Ne,className:"text-button",children:" Back to Search "})]}),B&&e.jsxs("div",{className:"error-message",children:[e.jsx(pn,{size:18}),B]}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-name",className:"form-label",children:"Patient Name *"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(Oa,{className:"search-icon",size:18}),e.jsx("input",{type:"text",name:"name",id:"lab-patient-name",required:!0,value:o.name,onChange:K,className:"modern-input",placeholder:"Enter full name"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lab-patient-age",className:"form-label",children:"Age"}),e.jsx("input",{type:"number",name:"age",id:"lab-patient-age",value:o.age??"",onChange:K,className:"modern-input",style:{paddingLeft:"16px"},placeholder:"e.g. 30"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lab-patient-gender",className:"form-label",children:"Gender"}),e.jsxs("select",{name:"gender",id:"lab-patient-gender",value:o.gender??"",onChange:K,className:"modern-input",style:{paddingLeft:"16px"},children:[e.jsx("option",{value:"",children:"Select Gender..."}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-phone",className:"form-label",children:"Phone Number"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(a0,{className:"search-icon",size:18}),e.jsx("input",{type:"tel",name:"phone",id:"lab-patient-phone",value:o.phone||"",onChange:K,className:"modern-input",placeholder:"e.g. 9876543210"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-address",className:"form-label",children:"Address"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(s0,{className:"search-icon",size:18,style:{top:"20px"}}),e.jsx("textarea",{name:"address",id:"lab-patient-address",rows:2,value:o.address||"",onChange:K,className:"modern-input",style:{resize:"none"},placeholder:"Enter address (optional)"})]})]})]}),e.jsxs("div",{className:"flex-end",children:[e.jsx("button",{type:"button",onClick:Ne,className:"secondary-button",children:" Cancel "}),e.jsxs("button",{type:"submit",className:"primary-button",children:[e.jsx(Ia,{size:18}),"Create & Proceed"]})]})]})]})]}),n==="create_order"&&c&&e.jsxs("div",{className:"glass-card",children:[e.jsxs("div",{className:"header-with-action",children:[e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"Create Lab Order"}),e.jsx("button",{onClick:Ne,className:"text-button",children:" Change Patient "})]}),e.jsxs("div",{className:"patient-summary",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Oa,{size:20,className:"highlight-primary"}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"600"},children:c.name})]}),e.jsxs("div",{className:"patient-details",style:{marginLeft:"30px",marginTop:"4px"},children:[c.age?`${c.age} yrs`:"Age N/A",c.gender&&`  ${c.gender}`,c.phone&&`  ${c.phone}`]})]}),C&&e.jsxs("div",{className:"error-message",children:[e.jsx(pn,{size:18}),C]}),e.jsxs("form",{onSubmit:Pe,children:[e.jsxs("div",{className:"form-group",style:{position:"relative"},children:[e.jsx("label",{htmlFor:"lab-test-search",className:"form-label",children:"Add Lab Test"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(mn,{className:"search-icon",size:18}),e.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search tests (e.g. CBC, Lipid Profile)...",value:x,onChange:se=>j(se.target.value),className:"modern-input",disabled:P,autoComplete:"off"}),P&&e.jsx("div",{className:"loading-spinner-small",style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)"}})]}),x&&N.length>0&&e.jsx("div",{className:"search-results-dropdown",children:N.map(se=>e.jsxs("div",{onClick:()=>V(se),className:"search-result-item",children:[e.jsx("span",{style:{fontWeight:500},children:se.name}),e.jsxs("span",{className:"highlight-primary",style:{fontWeight:600},children:["",parseFloat(se.price).toFixed(2)]})]},se.id))}),x&&N.length===0&&!P&&e.jsxs("div",{className:"no-data-message",style:{marginTop:"5px",padding:"10px",fontSize:"0.9rem"},children:['No tests found matching "',x,'".']})]}),e.jsxs("div",{style:{marginTop:"30px"},children:[e.jsxs("h4",{className:"card-title",style:{fontSize:"1.1rem"},children:["Selected Tests (",f.length,")"]}),f.length===0?e.jsx("div",{className:"info-message",children:"No tests added yet. Search above to add tests."}):e.jsx("div",{className:"selected-tests-list",children:f.map(se=>e.jsxs("div",{className:"selected-test-item",children:[e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{fontWeight:500},children:se.name})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("span",{className:"highlight-primary",style:{fontWeight:600},children:["",parseFloat(se.price).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>oe(se.id),className:"remove-button",title:"Remove Test",children:e.jsx(on,{size:18})})]})]},se.id))})]}),f.length>0&&e.jsxs("div",{className:"total-price",children:["Total: ",f.reduce((se,Ce)=>se+parseFloat(Ce.price),0).toFixed(2)]}),e.jsxs("div",{className:"flex-end",children:[e.jsx("button",{type:"button",onClick:Ne,className:"secondary-button",children:" Cancel Order "}),e.jsxs("button",{type:"submit",disabled:f.length===0,className:"primary-button",children:[e.jsx(Tp,{size:18}),"Create Lab Order"]})]})]})]})]})},bP=({currentUser:t})=>{const[s,n]=y.useState("newtons-ai"),[r,o]=y.useState(""),[u,c]=y.useState([]),[d,p]=y.useState(!0),[m,f]=y.useState([]),[g,x]=y.useState(!1),[j,N]=y.useState(null),[k,D]=y.useState(null),_=ot(),T=za(),E=async()=>{p(!0),D(null);let C=[];try{const A=await ae("/api/queue");if(!A.ok){const J=await A.json();throw new Error(J.message||"Failed to fetch queue")}C=await A.json(),console.log("Fetched Initial Queue Data:",JSON.stringify(C,null,2));const P=C.map(async J=>{if(!J.patient_id)return console.warn(`Queue entry ${J.id} has no patient_id.`),J;try{const R=await ae(`/api/patients/${J.patient_id}`);if(!R.ok)return console.error(`Failed to fetch patient details for ${J.patient_id}: ${R.status}`),J;const L=await R.json();return{...J,Patient:{...J.Patient??{},...L}}}catch(R){return console.error(`Error fetching patient details for ${J.patient_id}:`,R),J}}),$=await Promise.all(P);console.log("Enriched Queue Data (Before Sort):",JSON.stringify($,null,2)),$.sort((J,R)=>{var S,ge;const L=((S=J.Patient)==null?void 0:S.subscription_status)==="active",M=((ge=R.Patient)==null?void 0:ge.subscription_status)==="active";if(L&&!M)return-1;if(!L&&M)return 1;const Z=J.created_at?new Date(J.created_at).getTime():0,Q=R.created_at?new Date(R.created_at).getTime():0;return Z-Q}),console.log("Sorted Queue Data:",JSON.stringify($,null,2)),c($)}catch(A){console.error("Error in fetchQueue process:",A),D(`Failed to load queue: ${A.message}`),c(C)}finally{p(!1)}},U=async()=>{x(!0),D(null);try{const C=await ae("/api/staff?role=doctor");if(!C.ok){const P=await C.json();throw new Error(P.message||"Failed to fetch doctors")}const A=await C.json();f(A.filter(P=>P.active))}catch(C){console.error("Error fetching doctors:",C),D(`Failed to fetch doctors: ${C.message}`)}finally{x(!1)}};y.useEffect(()=>{const A=new URLSearchParams(T.search).get("tab");A&&F.find($=>$.id===A)&&n(A)},[T.search]),y.useEffect(()=>{s==="queue"&&(E(),U()),N(null)},[s]);const X=y.useCallback(async(C,A)=>{if(console.log(`Attempting to assign doctor ${A} to queue ${C}`),D(null),N(null),!A){console.log("No doctor ID provided, skipping assignment.");return}const P=u.find(R=>R.id===C);if(!P){console.error(`Queue entry ${C} not found in local state.`),D("Queue entry not found.");return}if(P.doctor_id===A){console.log(`Queue ${C} already assigned to doctor ${A}. Skipping.`);return}const $=async R=>{if(!R||!R.id||!R.name){D("Cannot proceed: Patient ID or Name is missing."),console.error("assignAndNavigate called with invalid patientInfo",R);return}const L=async()=>{try{const M={status:"waiting",doctorId:A},Z=await ae(`/api/queue/${C}/status`,{method:"PATCH",body:JSON.stringify(M)}),Q=await Z.json();if(!Z.ok)throw new Error(Q.message||`HTTP error! status: ${Z.status}`);const S=m.find(ge=>ge.id===A);return console.log(`Successfully assigned doctor ${S==null?void 0:S.name} to queue ${C}.`),c(ge=>ge.map(fe=>fe.id===C?{...fe,doctor_id:A,status:Q.status||fe.status,User:S?{name:S.name}:null,Patient:R}:fe)),!0}catch(M){return console.error(`Error assigning doctor for queue ${C}:`,M),D(`Failed to assign doctor: ${M.message}`),!1}};R.subscription_status==="active"?(console.log(`Patient ${R.name} (ID: ${R.id}) has active subscription. Assigning doctor directly.`),await L()):(console.log(`Patient ${R.name} (ID: ${R.id}) does not have active subscription (Status: ${R.subscription_status}). Assigning doctor and proceeding to billing.`),await L()?(console.log(`Navigating to billing for patient ${R.name} (ID: ${R.id}), queue ID: ${C}, doctor ID: ${A}`),_("/billing",{state:{patientId:R.id,queueId:C,patientName:R.name,doctorId:A,billType:"consultation"}})):console.log(`Assignment failed for patient ${R.name}, skipping navigation.`))},J=P.Patient;if(J&&J.id&&J.name)console.log("Patient details found in state. Proceeding with assignment."),await $(J);else{console.warn(`Patient details missing for queue entry ${C}. Fetching patient ${P.patient_id}...`);try{const R=await ae(`/api/patients/${P.patient_id}`);if(!R.ok){const M=await R.json().catch(()=>({}));throw new Error(M.message||`Failed to fetch patient details (status ${R.status})`)}const L=await R.json();console.log("Successfully fetched patient details:",L),await $(L)}catch(R){console.error(`Failed to fetch patient details for patient ID ${P.patient_id}:`,R),D(`Failed to fetch required patient details: ${R.message}`)}}},[m,u,_]),I=async(C,A)=>{D(null);const P=A==="consulting"?"start consultation":"complete visit";try{const $=u.find(M=>M.id===C);if(!$&&A==="consulting")throw new Error("Queue entry not found to start consultation.");let J={status:A};if(A==="consulting"){if(!($!=null&&$.doctor_id))throw new Error("Cannot start consultation without an assigned doctor.");J.doctorId=$.doctor_id}const R=await ae(`/api/queue/${C}/status`,{method:"PATCH",body:JSON.stringify(J)}),L=await R.json();if(!R.ok)throw new Error(L.message||`HTTP error! status: ${R.status}`);c(M=>M.map(Z=>Z.id===C?{...Z,status:A}:Z))}catch($){console.error(`Error trying to ${P}:`,$),D(`Failed to ${P}: ${$.message}`)}},F=[{id:"queue",label:"Queue",icon:e.jsx(Bl,{size:20})},{id:"newtons-ai",label:"Newtons AI",icon:e.jsx(mn,{size:20})},{id:"manage-admission",label:"Manage Admission",icon:e.jsx(Ow,{size:20})},{id:"all-patients",label:"All Patients",icon:e.jsx(zw,{size:20})},{id:"lab",label:"Lab Tests",icon:e.jsx(Ap,{size:20})},{id:"custom-bill",label:"Custom Bill",icon:e.jsx(ya,{size:20})}],B=C=>{try{return new Date(C).toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},G=u.filter(C=>{var A,P;return(P=(A=C.Patient)==null?void 0:A.name)==null?void 0:P.toLowerCase().includes(r.toLowerCase())});return e.jsx("div",{className:"reception-dashboard-container",children:e.jsxs("main",{className:"flex-1 overflow-y-auto",children:[k&&e.jsxs("div",{className:"error-message-reception",role:"alert",children:[" ",e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:k})]}),e.jsxs("div",{className:"reception-tab-nav",children:[" ",F.map(C=>e.jsxs("button",{className:`reception-tab-button ${s===C.id?"active":""}`,onClick:()=>n(C.id),children:[e.jsx("span",{children:C.icon}),C.label]},C.id))]}),s==="queue"&&e.jsxs("div",{className:"space-y-6",children:[" ",e.jsxs("div",{className:"queue-header",children:[" ",e.jsxs("div",{className:"queue-actions",children:[" ",e.jsxs("div",{className:"search-bar-container",children:[" ",e.jsx("input",{type:"text",placeholder:"Search patients in queue...",className:"search-input",value:r,onChange:C=>o(C.target.value)}),e.jsx(mn,{className:"search-icon",size:18})]})]}),e.jsxs("div",{className:"summary-cards-grid",children:[" ",e.jsxs("div",{className:"summary-card card-waiting",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Waiting"})," ",e.jsx("div",{className:"summary-card-value",children:u.filter(C=>C.status==="waiting").length})," "]}),e.jsxs("div",{className:"summary-card card-consulting",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Consulting"})," ",e.jsx("div",{className:"summary-card-value",children:u.filter(C=>C.status==="consulting").length})," "]}),e.jsxs("div",{className:"summary-card card-completed",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Completed"})," ",e.jsx("div",{className:"summary-card-value",children:u.filter(C=>C.status==="seen").length})," "]})]})]}),d?e.jsxs("div",{className:"loading-container",children:[" ",e.jsx("div",{className:"breathing-ball"})," ",e.jsx("span",{children:"Loading queue..."})]}):G.length===0?e.jsx("div",{className:"empty-queue-message",children:r?"No patients found matching your search.":"Queue is empty."}):e.jsxs("div",{className:"queue-table-wrapper",children:[" ",e.jsxs("table",{className:"queue-table",children:[" ",e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Queue"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"Complaint"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{className:"hidden md:table-cell",children:"Time Added"})," ",e.jsx("th",{className:"text-center",children:"Action / Doctor"})," "]})}),e.jsx("tbody",{children:G.map(C=>{var A,P,$,J,R,L,M,Z,Q,S,ge;return e.jsxs("tr",{onClick:()=>_(`/dashboard/edit-complaint/${C.id}`),className:"queue-row-clickable",children:[e.jsxs("td",{children:[" ",e.jsxs("span",{className:"queue-token",children:["#",C.token_no]})," "]}),e.jsxs("td",{children:[" ",e.jsx("div",{className:"patient-name",children:((A=C.Patient)==null?void 0:A.name)||"N/A"})," ",e.jsxs("div",{className:"patient-details",children:[(P=C.Patient)!=null&&P.age?`${C.Patient.age} yrs, `:"",(($=C.Patient)==null?void 0:$.gender)||""]})," "]}),e.jsxs("td",{children:[" ",e.jsx("div",{className:"patient-phone",children:((J=C.Patient)==null?void 0:J.phone)||"N/A"})," "]}),e.jsx("td",{className:"complaint-text",children:C.complaint||"-"}),e.jsxs("td",{children:[e.jsx("span",{className:`subscription-status-badge ${((R=C.Patient)==null?void 0:R.subscription_status)==="active"?"status-active":((L=C.Patient)==null?void 0:L.subscription_status)==="cancelled"||((M=C.Patient)==null?void 0:M.subscription_status)==="expired"?"status-inactive":"status-none"}`,children:((Z=C.Patient)==null?void 0:Z.subscription_status)??"None"}),C.Patient&&C.Patient.id&&C.Patient.subscription_status!=="active"&&e.jsx("button",{onClick:fe=>{fe.stopPropagation(),C.Patient&&_(`/start-subscription/${C.Patient.id}`)},className:"action-button btn-start-sub-queue mt-2",children:"Start Sub"})]}),e.jsx("td",{className:"hidden md:table-cell time-added",children:B(C.created_at)}),e.jsx("td",{className:"action-doctor-cell",children:j===C.id?e.jsx("div",{className:"relative inline-block text-left w-full",onClick:fe=>fe.stopPropagation(),children:e.jsxs("select",{value:"",onChange:fe=>X(C.id,fe.target.value),onBlur:()=>N(null),className:"doctor-select-dropdown",autoFocus:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Doctor..."}),g?e.jsx("option",{disabled:!0,children:"Loading..."}):m.length>0?m.map(fe=>e.jsx("option",{value:fe.id,children:fe.name},fe.id)):e.jsx("option",{disabled:!0,children:"No doctors available"})]})}):e.jsxs("div",{className:"action-doctor-content",onClick:fe=>fe.stopPropagation(),children:[" ",C.status==="waiting"&&e.jsx(e.Fragment,{children:(Q=C.User)!=null&&Q.name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("button",{onClick:()=>I(C.id,"consulting"),className:"action-button btn-start",children:"Start"})]}):g?e.jsx("span",{className:"status-text-italic",children:"Loading..."}):m.length===0?e.jsx("span",{className:"status-text-red",children:"No doctors"}):m.length===1?e.jsxs("button",{onClick:()=>X(C.id,m[0].id),className:"action-button btn-assign",children:["Assign ",m[0].name]}):e.jsx("button",{onClick:()=>N(C.id),className:"action-button btn-assign",children:"Assign"})}),C.status==="consulting"&&e.jsxs(e.Fragment,{children:[((S=C.User)==null?void 0:S.name)&&e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("button",{onClick:()=>I(C.id,"seen"),className:"action-button btn-complete",children:"Complete"})]}),C.status==="seen"&&e.jsxs(e.Fragment,{children:[((ge=C.User)==null?void 0:ge.name)&&e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("span",{className:"status-text-italic",children:"Completed"})]}),C.status==="cancelled"&&e.jsx("span",{className:"status-text-red",children:"Cancelled"})]})})]},C.id)})})]})]})]}),s==="lab"&&e.jsxs("div",{className:"lab-tab-content",children:[" ",e.jsx(Ov,{currentUser:t}),e.jsxs("button",{onClick:()=>_("/lab/search-report"),className:"lab-action-button btn-search-lab-reports",children:[e.jsx(mn,{size:16}),"Search Lab Reports"]})]}),s==="newtons-ai"&&e.jsx("div",{className:"newtons-ai-tab-content",children:e.jsx(mc,{})}),s==="manage-admission"&&e.jsx("div",{className:"manage-admission-tab-content",children:e.jsx(Pv,{})}),s==="all-patients"&&e.jsx("div",{className:"all-patients-tab-content",children:e.jsx(Gp,{})}),s==="custom-bill"&&e.jsx("div",{className:"custom-bill-tab-content",children:e.jsx(Iv,{})})]})})},Of=({isEmbedded:t=!1})=>{const[s,n]=y.useState([]),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(!1),[m,f]=y.useState(null),g=y.useRef(null),[x,j]=y.useState(!1),[N,k]=y.useState(null),[D,_]=y.useState(!1),[T,E]=y.useState(!1),[U,X]=y.useState(null),[I,F]=y.useState({name:"",description:"",price:"",default_parameters:[]}),B=y.useCallback(async()=>{o(!0),c(null),f(null),k(null);try{const w=await ae("/api/lab-tests");if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const ue=await w.json();n(ue)}catch(w){console.error("Error fetching lab tests:",w),c(w.message||"Failed to fetch lab tests.")}finally{o(!1)}},[]);y.useEffect(()=>{B()},[B]);const G=w=>{const{name:ue,value:Ne}=w.target;F(K=>({...K,[ue]:Ne}))},C=(w,ue,Ne)=>{const K=[...I.default_parameters],Y=K[w];if(ue==="type")switch(Y.type=Ne,Ne){case"number":Y.defaultValue=0,Y.lower_limit=null,Y.upper_limit=null,Y.unit="";break;case"boolean":Y.defaultValue=!1,Y.lower_limit=void 0,Y.upper_limit=void 0,Y.unit=void 0;break;case"string":default:Y.defaultValue="",Y.lower_limit=void 0,Y.upper_limit=void 0,Y.unit=void 0;break}else ue==="defaultValue"?Y.type==="number"?Y.defaultValue=parseFloat(Ne)||0:(Y.type,Y.defaultValue=Ne):ue==="lower_limit"||ue==="upper_limit"?Y[ue]=Ne===""?null:parseFloat(Ne):Y[ue]=Ne;F(V=>({...V,default_parameters:K}))},A=()=>{F(w=>({...w,default_parameters:[...w.default_parameters,{name:"",type:"string",defaultValue:"",unit:"",lower_limit:null,upper_limit:null}]}))},P=w=>{F(ue=>({...ue,default_parameters:ue.default_parameters.filter((Ne,K)=>K!==w)}))},$=async w=>{w.preventDefault(),o(!0),c(null);const ue=U!==null,Ne=ue?`/api/lab-tests/${U}`:"/api/lab-tests",K=ue?"PUT":"POST";try{const Y=await ae(Ne,{method:K,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:I.name,description:I.description,price:parseFloat(I.price),default_parameters:I.default_parameters})});if(!Y.ok){const V=await Y.json();throw new Error(V.message||`HTTP error! status: ${Y.status}`)}E(!1),X(null),F({name:"",description:"",price:"",default_parameters:[]}),B()}catch(Y){console.error(`Error ${ue?"updating":"adding"} lab test:`,Y),c(Y.message||`Failed to ${ue?"update":"add"} lab test.`)}finally{o(!1)}},J=()=>{X(null),F({name:"",description:"",price:"",default_parameters:[]}),E(!0)},R=w=>{if(U===w.id)X(null);else{X(w.id);const ue=(w.default_parameters||[]).map(Ne=>({...Ne,unit:Ne.unit||"",lower_limit:Ne.lower_limit===void 0?null:Ne.lower_limit,upper_limit:Ne.upper_limit===void 0?null:Ne.upper_limit}));F({name:w.name,description:w.description||"",price:w.price,default_parameters:ue}),E(!1)}},L=async w=>{if(window.confirm("Are you sure you want to delete this lab test?")){o(!0),c(null);try{const ue=await ae(`/api/lab-tests/${w}`,{method:"DELETE"});if(!ue.ok){const Ne=await ue.json();throw new Error(Ne.message||`HTTP error! status: ${ue.status}`)}B()}catch(ue){console.error("Error deleting lab test:",ue),c(ue.message||"Failed to delete lab test.")}finally{o(!1)}}},M=()=>{E(!1),X(null),c(null),F({name:"",description:"",price:"",default_parameters:[]})},Z=async w=>{if(!w){f("No file selected.");return}p(!0),f(null),c(null);const ue=new FormData;ue.append("file",w);try{const Ne=await ae("/api/lab-tests/import",{method:"POST",body:ue});if(!Ne.ok){const K=await Ne.json();throw new Error(K.message||`Import failed: ${Ne.statusText}`)}B()}catch(Ne){console.error("Error importing lab tests from Excel:",Ne),f(Ne.message||"Failed to import lab tests from Excel.")}finally{p(!1)}},Q=async w=>{if(w.target.files&&w.target.files[0]){const ue=w.target.files[0];await Z(ue),w.target&&(w.target.value="")}},S=async()=>{if(window.confirm("Are you sure you want to import default biochemistry and pathology tests? This will add new tests and may duplicate existing ones if names match.")){j(!0),k(null),c(null);try{const w=await ae("/api/lab-tests/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"}});if(!w.ok){const ue=await w.json();throw new Error(ue.message||`Default import failed: ${w.statusText}`)}B()}catch(w){console.error("Error importing default lab tests:",w),k(w.message||"Failed to import default lab tests.")}finally{j(!1)}}},ge=async()=>{if(window.confirm("Are you sure you want to delete ALL lab tests? This action cannot be undone.")){_(!0),c(null),f(null),k(null);try{const w=await ae("/api/lab-tests/all",{method:"DELETE"});if(!w.ok){const ue=await w.json();throw new Error(ue.message||`Delete all failed: ${w.statusText}`)}B()}catch(w){console.error("Error deleting all lab tests:",w),c(w.message||"Failed to delete all lab tests.")}finally{_(!1)}}},fe=r||d||x||D;return e.jsxs("div",{className:`lab-inventory-card ${t?"embedded":""}`,style:t?{border:"none",boxShadow:"none",padding:0}:{},children:[!t&&e.jsx("h2",{className:"lab-inventory-header",children:"Available Lab Tests"}),e.jsxs("div",{className:"mb-4",style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:J,className:"lab-inventory-button",disabled:fe,children:"Add New Test"}),e.jsx("button",{onClick:()=>{var w;return(w=g.current)==null?void 0:w.click()},className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:d?"Importing...":"Import from Excel"}),e.jsx("input",{type:"file",ref:g,onChange:Q,accept:".xlsx, .xls",style:{display:"none"},disabled:d}),e.jsx("button",{onClick:S,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:x?"Importing Defaults...":"Import Default Tests"}),e.jsx("button",{onClick:ge,className:"lab-inventory-button lab-inventory-button-danger",disabled:fe,style:{backgroundColor:"#dc3545",borderColor:"#dc3545",color:"white"},children:D?"Deleting All...":"Delete All Tests"})]}),u&&e.jsx("div",{className:"error-text mb-4",children:u}),m&&e.jsxs("div",{className:"error-text mb-4",children:["Import Excel Error: ",m]}),N&&e.jsxs("div",{className:"error-text mb-4",children:["Import Default Error: ",N]}),T&&e.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"20px",marginBottom:"20px"},children:[" ",e.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.5em",borderBottom:"1px solid #eee",marginBottom:"15px"},children:"Add New Lab Test"}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:I.name,onChange:G,className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:I.description,onChange:G,rows:3,className:"lab-inventory-input",disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",value:I.price==="0"?"":I.price,onChange:G,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginTop:"20px",marginBottom:"10px"},children:"Default Parameters"}),I.default_parameters.map((w,ue)=>{var Ne,K;return e.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Parameter Name",value:w.name,onChange:Y=>C(ue,"name",Y.target.value),className:"lab-inventory-input"}),e.jsxs("select",{value:w.type,onChange:Y=>C(ue,"type",Y.target.value),className:"lab-inventory-input",children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),w.type==="boolean"?e.jsxs("select",{value:w.defaultValue.toString(),onChange:Y=>C(ue,"defaultValue",Y.target.value==="true"),className:"lab-inventory-input",children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-reactive"})]}):e.jsx("input",{type:w.type==="number"?"number":"text",placeholder:"Default Value",value:w.defaultValue===0?"":w.defaultValue.toString(),onChange:Y=>C(ue,"defaultValue",Y.target.value),className:"lab-inventory-input"}),w.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",placeholder:"Lower Limit",value:w.lower_limit===null?"":((Ne=w.lower_limit)==null?void 0:Ne.toString())??"",onChange:Y=>C(ue,"lower_limit",Y.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"number",placeholder:"Upper Limit",value:w.upper_limit===null?"":((K=w.upper_limit)==null?void 0:K.toString())??"",onChange:Y=>C(ue,"upper_limit",Y.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:w.unit||"",onChange:Y=>C(ue,"unit",Y.target.value),className:"lab-inventory-input"})]}),e.jsx("button",{type:"button",onClick:()=>P(ue),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},ue)}),e.jsx("button",{type:"button",onClick:A,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{type:"button",onClick:M,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:fe,children:r?"Saving...":"Add Test"})]})]})]}),fe&&!T&&e.jsxs("p",{className:"loading-text",children:[" ",d?"Importing Excel data...":x?"Importing default data...":"Loading tests..."]}),!fe&&s.length===0&&!u&&!m&&!N&&e.jsx("p",{className:"no-data-message",children:"No lab tests found. Add one or import from Excel to get started."}),!fe&&s.length>0&&e.jsxs("div",{className:"overflow-x-auto",children:[" ",e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Description"})," ",e.jsx("th",{children:"Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map(w=>{const ue=U===w.id,Ne=w.price&&typeof w.price=="string"?parseFloat(w.price):NaN,K=isNaN(Ne)?"0.00":Ne.toFixed(2);return e.jsxs(en.Fragment,{children:[e.jsxs("tr",{onClick:()=>R(w),style:{cursor:"pointer"},children:[e.jsx("td",{children:w.name}),e.jsx("td",{className:"hidden md:table-cell",style:{whiteSpace:"pre-wrap"},children:w.description||"-"}),e.jsxs("td",{children:["",K]}),e.jsx("td",{style:{textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{onClick:Y=>{Y.stopPropagation(),R(w)},className:"lab-inventory-link",disabled:fe,style:{background:"none",border:"none",padding:"0",cursor:"pointer"},children:"Edit"}),e.jsx("button",{onClick:Y=>{Y.stopPropagation(),L(w.id)},className:"lab-inventory-link",disabled:fe,style:{background:"none",border:"none",padding:"0",cursor:"pointer",color:"#dc3545"},children:"Delete"})]})})]}),ue&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:e.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"10px",marginBottom:"10px",border:"1px solid #ddd",padding:"15px"},children:[e.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em"},children:"Edit Lab Test"}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:I.name,onChange:G,className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:I.description,onChange:G,rows:3,className:"lab-inventory-input",disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",value:I.price==="0"?"":I.price,onChange:G,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em",marginTop:"15px"},children:"Default Parameters"}),I.default_parameters.map((Y,V)=>{var oe,Pe;return e.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Parameter Name",value:Y.name,onChange:se=>C(V,"name",se.target.value),className:"lab-inventory-input"}),e.jsxs("select",{value:Y.type,onChange:se=>C(V,"type",se.target.value),className:"lab-inventory-input",children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),Y.type==="boolean"?e.jsxs("select",{value:Y.defaultValue.toString(),onChange:se=>C(V,"defaultValue",se.target.value==="true"),className:"lab-inventory-input",children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-reactive"})]}):e.jsx("input",{type:Y.type==="number"?"number":"text",placeholder:"Default Value",value:Y.defaultValue===0?"":Y.defaultValue.toString(),onChange:se=>C(V,"defaultValue",se.target.value),className:"lab-inventory-input"}),Y.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",placeholder:"Lower Limit",value:Y.lower_limit===null?"":((oe=Y.lower_limit)==null?void 0:oe.toString())??"",onChange:se=>C(V,"lower_limit",se.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"number",placeholder:"Upper Limit",value:Y.upper_limit===null?"":((Pe=Y.upper_limit)==null?void 0:Pe.toString())??"",onChange:se=>C(V,"upper_limit",se.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:Y.unit||"",onChange:se=>C(V,"unit",se.target.value),className:"lab-inventory-input"})]}),e.jsx("button",{type:"button",onClick:()=>P(V),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},V)}),e.jsx("button",{type:"button",onClick:A,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{type:"button",onClick:M,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:fe,children:r?"Saving...":"Update Test"})]})]})]})})})]},w.id)})})]})]})]})},jP=t=>{let s="";if(!t.report_content)return"No report content available.";s+=`*Report Date:* ${t.report_date?new Date(t.report_date).toLocaleDateString():"N/A"}

`;try{const n=JSON.parse(t.report_content);typeof n=="object"&&n!==null&&t.tests?t.tests.forEach((r,o)=>{s+=`*Test: ${r.name}*
`,n[r.id]?Object.entries(n[r.id]).forEach(([u,c])=>{var f;const d=(f=r.default_parameters)==null?void 0:f.find(g=>g.name===u);let p=String(c),m="";if(d){const g=d.unit?` _${d.unit}_`:"";if(d.type==="boolean"){const x=c===!0||c==="true";p=x?"*Reactive*":"Non-Reactive",x||(m="`Normal: Non-Reactive`")}else if(d.type==="number"){const x=typeof c=="string"?parseFloat(c):typeof c=="number"?c:NaN;if(d.lower_limit!=null||d.upper_limit!=null){let j=[];d.lower_limit!=null&&j.push(`${d.lower_limit}`),d.upper_limit!=null&&j.push(`${d.upper_limit}`),m=`\`Normal: ${j.join(" - ")}\`${g}`,!isNaN(x)&&(d.lower_limit!=null&&x<d.lower_limit||d.upper_limit!=null&&x>d.upper_limit)&&(p=`*${p}*`)}}d.unit&&(p+=g)}s+=`${u}: ${p}
`,m&&((d==null?void 0:d.type)==="boolean"&&(c===!0||c==="true")||(s+=`${m}
`))}):s+=`_No parameters reported for this test._
`,o<t.tests.length-1&&(s+=`
`)}):s+=t.report_content}catch{s+=t.report_content}return s},zf=t=>{var c;if(!((c=t==null?void 0:t.Patient)!=null&&c.phone)){alert("Cannot share report via WhatsApp: Patient phone number is not available.");return}if(!(t!=null&&t.report_content)){alert("Cannot share report: No report content is available to share.");return}const s=t.Patient.name||"Patient",n=jP(t),r=`Hello ${s},

Your lab report is ready.

${n}`,u=`https://wa.me/${vP(t.Patient.phone)}?text=${encodeURIComponent(r)}`;window.open(u,"_blank")},vP=t=>{let s=t.replace(/\D/g,"");const n=/^(?:\\+?91)?[\\s-]*?(\\d{10})$/,r=s.match(n);return r?s="91"+r[1]:s.startsWith("91")||(s="91"+s),s},NP=()=>{const[t,s]=y.useState([]),[n,r]=y.useState(""),[o,u]=y.useState(!0),[c,d]=y.useState(null),[p,m]=y.useState("orders"),[f,g]=y.useState(1),[x]=y.useState(20),[j,N]=y.useState(0),k=y.useMemo(()=>Math.ceil(j/x),[j,x]),D=y.useCallback(async(B=1,G="")=>{u(!0),d(null);try{const C=new URLSearchParams({page:String(B),limit:String(x)});G&&C.append("search",G);const A=await ae(`/api/lab?${C.toString()}`);if(!A.ok)throw new Error(`HTTP error! status: ${A.status}`);const P=await A.json(),$=P.orders.map(J=>{var R,L;return{id:J.id,labTokenNumber:String(J.lab_token_number??"N/A"),patientName:((R=J.Patient)==null?void 0:R.name)||"N/A",patientId:J.patient_id,patientTokenNumber:String(((L=J.Patient)==null?void 0:L.patient_token_number)??"N/A"),tests:(J.tests||[]).map(M=>M.name||"Unknown Test"),date:jr(new Date(J.createdAt),"yyyy-MM-dd"),status:J.status,reportId:J.reportId,billId:J.billId}});s($),N(P.totalCount),g(B)}catch(C){console.error("Failed to fetch lab orders:",C),d(C instanceof Error?C.message:"An unknown error occurred"),s([]),N(0)}finally{u(!1)}},[x]);y.useEffect(()=>{console.log(`Fetch effect triggered. Current page: ${f}, Search term: "${n}"`),n.length===0||n.length>=2?(console.log(`Condition met (length ${n.length}). Fetching orders...`),D(f,n)):console.log(`Condition not met (length ${n.length}). Not fetching.`)},[D,f,n]),y.useEffect(()=>{const B=setTimeout(()=>{n.length>=2?f!==1&&g(1):n.length<2&&f!==1&&g(1)},1e3);return()=>{clearTimeout(B)}},[n]);const _=async(B,G)=>{console.log(`Updating order ${B} to status ${G}`);try{const C=await ae(`/api/lab/${B}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:G})});if(!C.ok){const A=await C.json();throw new Error(A.message||`Failed to update status: ${C.status}`)}if(G==="completed"){const A=await ae(`/api/lab/orders/${B}/report`);if(A.ok){const P=await A.json();zf(P)}}await D(f,n),console.log(`Order ${B} status updated to ${G}, refetching page ${f}`)}catch(C){console.error("Error updating status:",C),alert(`Failed to update status: ${C instanceof Error?C.message:"Unknown error"}`)}},T=ot(),E=B=>{if(!B){console.error("Cannot navigate to billing: Order data is missing."),alert("Could not open billing page: Order information is missing.");return}B.billId?(console.log(`Navigating to existing bill for Bill ID: ${B.billId}, Patient: ${B.patientName}`),T("/billing",{state:{billId:B.billId,patientId:B.patientId,patientName:B.patientName,billType:"lab"}})):(console.log(`Navigating to LabBillingPage for Order ID: ${B.id}`),T(`/dashboard/lab-billing/${B.id}`))},U=B=>{B&&B.id?T(`/lab/report/${B.id}`):(console.error("Cannot navigate: Order or Order ID is missing."),alert("Could not open the report entry page: Order information is missing."))},X=B=>{switch(B){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:B,className:"status-badge"}}};if(o)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsx("div",{className:"text-teal-600 text-xl animate-pulse",children:"Loading Lab Panel..."})});if(c)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-red-50 text-red-700",children:[e.jsx(pn,{size:48,className:"mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Error Loading Lab Data"}),e.jsx("p",{className:"mb-4",children:c}),e.jsx("button",{onClick:()=>D(1,""),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry Fetch"})]});const I=()=>{f>1&&g(B=>B-1)},F=()=>{f<k&&g(B=>B+1)};return e.jsxs("div",{className:"lab-inventory-container",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{onClick:()=>T(-1),className:"back-button mr-4",children:e.jsx(vt,{size:24})}),e.jsx("h2",{className:"text-2xl font-semibold",children:"Lab Panel"})]}),e.jsxs("main",{className:"flex-1 overflow-y-auto",children:[e.jsxs("div",{className:"mb-4",style:{display:"flex",gap:"10px",borderBottom:"1px solid #ddd",paddingBottom:"10px"},children:[e.jsxs("button",{onClick:()=>m("orders"),className:`lab-inventory-button ${p==="orders"?"":"lab-inventory-button-secondary"}`,style:{display:"flex",alignItems:"center"},children:[e.jsx(t0,{size:16,style:{marginRight:"8px"}}),"Orders"]}),e.jsx("button",{onClick:()=>T("/create-lab-order"),className:"lab-inventory-button",style:{display:"flex",alignItems:"center"},children:"Create New Lab Order"}),e.jsxs("button",{onClick:()=>m("inventory"),className:`lab-inventory-button ${p==="inventory"?"":"lab-inventory-button-secondary"}`,style:{display:"flex",alignItems:"center"},children:[e.jsx(Rw,{size:16,style:{marginRight:"8px"}}),"Inventory"]})]}),p==="orders"&&e.jsxs("div",{className:"lab-orders-view",children:[" ",e.jsxs("div",{className:"lab-orders-header-controls",children:[e.jsx("h3",{className:"lab-orders-title",children:"Current Lab Orders"}),e.jsxs("div",{className:"lab-orders-search-container",children:[e.jsx("input",{type:"text",placeholder:"Search name, token, tests...",value:n,onChange:B=>r(B.target.value),className:"lab-inventory-input lab-orders-search-input"}),e.jsx(mn,{size:18,className:"lab-orders-search-icon"})]})]}),e.jsx("div",{className:"lab-orders-table-container",children:e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient (Token)"}),e.jsx("th",{children:"Tests"}),e.jsx("th",{className:"hidden md:table-cell",children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"lab-table-actions-header",children:"Actions"})]})}),e.jsxs("tbody",{children:[o&&!c&&t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10",children:"Loading orders..."})}),!o&&!c&&t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10",children:n?`No lab orders found matching "${n}".`:"No lab orders available."})}),!o&&!c&&t.map(B=>{const G=X(B.status);return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{children:B.patientName}),e.jsxs("div",{className:"lab-table-patient-token",children:["Token: ",B.patientTokenNumber]})]}),e.jsx("td",{children:B.tests.map((C,A)=>e.jsx("div",{children:C},A))}),e.jsx("td",{className:"hidden md:table-cell",children:B.date}),e.jsx("td",{children:e.jsx("span",{className:G.className,children:G.text})}),e.jsx("td",{children:e.jsxs("div",{className:"lab-table-actions",children:[B.status==="pending"&&e.jsx("button",{onClick:()=>E(B),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),B.status==="billed"&&e.jsx("button",{onClick:()=>_(B.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),B.status==="collected"&&e.jsx("button",{onClick:()=>_(B.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),(B.status==="processing"||B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>U(B),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>_(B.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),(B.status==="completed"||B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>{B.id?T(`/lab/view-report/${B.id}`):(console.error("Attempted to view report for an order with no ID:",B),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})})]},B.id)})]})]})}),e.jsxs("div",{className:"lab-orders-card-container",children:[o&&!c&&t.length===0&&e.jsx("div",{className:"text-center py-10",children:"Loading orders..."}),!o&&!c&&t.length===0&&e.jsx("div",{className:"text-center py-10",children:n?`No lab orders found matching "${n}".`:"No lab orders available."}),!o&&!c&&t.map(B=>{const G=X(B.status);return e.jsxs("div",{className:"lab-order-card",children:[e.jsxs("div",{className:"lab-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"lab-card-patient-name",children:B.patientName}),e.jsxs("div",{className:"lab-card-patient-token",children:["Token: ",B.patientTokenNumber]}),e.jsx("div",{className:"lab-card-date",children:B.date})]}),e.jsx("span",{className:`${G.className} lab-card-status-pill`,children:G.text})]}),e.jsxs("div",{className:"lab-card-section",children:[e.jsx("p",{className:"lab-card-section-title",children:"Tests:"}),B.tests.map((C,A)=>e.jsx("div",{className:"lab-card-test-item",children:C},A)),B.tests.length===0&&e.jsx("div",{className:"lab-card-no-tests",children:"No tests listed."})]}),e.jsxs("div",{className:"lab-card-actions",children:[B.status==="pending"&&e.jsx("button",{onClick:()=>E(B),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),B.status==="billed"&&e.jsx("button",{onClick:()=>_(B.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),B.status==="collected"&&e.jsx("button",{onClick:()=>_(B.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),(B.status==="processing"||B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>U(B),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>_(B.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),(B.status==="completed"||B.status==="report_ready"||B.status==="reported")&&e.jsx("button",{onClick:()=>{B.id?T(`/lab/view-report/${B.id}`):(console.error("Attempted to view report for an order with no ID:",B),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})]},B.id)})]}),!o&&j>0&&e.jsxs("div",{className:"lab-pagination-controls",children:[e.jsxs("div",{className:"lab-pagination-info",children:["Showing"," ",e.jsx("strong",{children:(f-1)*x+1})," ","to"," ",e.jsx("strong",{children:Math.min(f*x,j)})," ","of"," ",e.jsx("strong",{children:j})," ","results"]}),e.jsxs("div",{className:"lab-pagination-buttons",children:[e.jsx("button",{onClick:I,disabled:f===1,className:"lab-pagination-button","aria-label":"Previous page",children:e.jsx(Pd,{size:18})}),e.jsxs("span",{children:["Page ",f," of ",k]}),e.jsx("button",{onClick:F,disabled:f===k,className:"lab-pagination-button","aria-label":"Next page",children:e.jsx(Ul,{size:18})})]})]})]}),p==="inventory"&&e.jsxs("div",{className:"lab-inventory-content-wrapper",children:[" ",e.jsx(Of,{})]})]})]})},wP=()=>{const[t,s]=y.useState([]),[n,r]=y.useState(""),[o,u]=y.useState(!0),[c,d]=y.useState(null),p=ot(),m=y.useRef(null),[f,g]=y.useState(1),[x,j]=y.useState(1),[N,k]=y.useState(0),D=10,_=y.useCallback(async(F,B,G)=>{u(!0),d(null);try{let C=`/api/pharmacy-orders?page=${F}&limit=${B}`;G&&G.trim()!==""&&(C+=`&search=${encodeURIComponent(G.trim())}`);const A=await ae(C);if(!A.ok)throw new Error(`Failed to fetch orders: ${A.statusText} (${A.status})`);const P=await A.json();if(P&&Array.isArray(P.orders)&&typeof P.totalOrders=="number"&&typeof P.totalPages=="number")console.log("Fetched pharmacy orders data:",P.orders),s(P.orders),k(P.totalOrders),j(P.totalPages),g(P.currentPage||F);else throw console.error("Received data does not match expected paginated structure:",P),new Error("Invalid data format received from API")}catch(C){console.error("Failed to fetch pharmacy orders:",C),d(C.message||"Failed to fetch orders. Please try again."),s([]),j(1),k(0)}finally{u(!1)}},[]);y.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{const F=n===""?f:1;n!==""&&f!==1&&g(1),_(F,D,n)},500),()=>{m.current&&clearTimeout(m.current)}),[n,f,_,D]);const T=F=>{p(`/dashboard/edit-pharmacy-order/${F}`)},E=F=>{d(null),console.log(`Preparing billing navigation for order: ${F}`);const B=t.find(G=>G.id===F);if(B){const G=B.medications.map(C=>{const A=C.price??0;return(C.price===void 0||C.price===null)&&console.warn(`Medication "${C.name}" in order ${F} is missing a price. Defaulting to 0.`),{name:C.name,pack_quantity:C.pack_quantity,loose_quantity:C.loose_quantity,price:A,pack_price:C.pack_price,loose_price:C.loose_price,total_price:C.total_price,isLoose:C.isLoose,unit:C.unit,drug_id:C.drug_id?String(C.drug_id):null,tabletsPerDay:C.tabletsPerDay,numberOfDays:C.numberOfDays,directions_to_use:C.directions_to_use,discount_percentage:0,batch:C.batch,expiry_date:C.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:G}),p(`/dashboard/pharmacy-billing/${F}`,{state:{initialItems:G}})}else console.error(`Order with ID ${F} not found.`),d(`Order with ID ${F} not found.`),alert(`Error: Could not find order ${F} to bill.`)},U=async(F,B)=>{d(null);const G=t.find(A=>A.id===F);if(!G){d(`Order with ID ${F} not found.`);return}const C={status:B,medications:G.medications};try{const A=await ae(`/api/pharmacy-orders/${F}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!A.ok){const $=await A.text();throw new Error(`Failed to update status: ${A.statusText} (${A.status}) - ${$}`)}const P=await A.json();s($=>$.map(J=>J.id===P.id?{...J,status:P.status}:J))}catch(A){console.error("Failed to update order status:",A),d(A.message||`Failed to update status for order ${F}.`),alert(`Error updating status for order ${F}: ${A.message||"Please try again."}`)}},X=F=>{switch(F){case"pending":return"status-pill status-pill-pending";case"billed":return"status-pill status-pill-billed";case"dispensed":return"status-pill status-pill-dispensed";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill status-pill-default"}},I=F=>{p(`/dashboard/orders/${F.id}`)};return o&&t.length===0&&!c?e.jsx("div",{className:"loading-pulse",children:"Loading Orders..."}):c&&t.length===0?e.jsxs("div",{className:"error-message-box",children:["Error loading orders: ",c]}):e.jsxs("div",{className:"pharmacy-queue-container",children:[e.jsxs("div",{className:"pharmacy-queue-header",children:[e.jsx("h3",{className:"pharmacy-queue-title",children:"Pharmacy Queue"}),e.jsxs("div",{className:"pharmacy-actions-container",children:[e.jsxs("div",{className:"pharmacy-buttons-group",children:[e.jsxs("button",{onClick:()=>p("/dashboard/add-order"),className:"pharmacy-action-button btn-add-order",children:[e.jsx(ya,{size:16}),"Add Order"]}),e.jsxs("button",{onClick:()=>p("/dashboard/inventory"),className:"pharmacy-action-button btn-inventory",title:"View Pharmacy Inventory",children:[e.jsx(Nr,{size:16}),"Inventory"]}),e.jsxs("button",{onClick:()=>p("/dashboard/search-patient-records"),className:"pharmacy-action-button btn-ai-search",title:"Search Patient Records with Newton's AI",children:[e.jsx(i0,{size:16}),"Newton's AI"]}),e.jsxs("button",{onClick:()=>p("/dashboard/distributors"),className:"pharmacy-action-button btn-distributors",title:"Manage Distributors",children:[e.jsx(Nr,{size:16}),"Distributors"]})]}),e.jsxs("div",{className:"pharmacy-search-input-container",children:[e.jsx("input",{type:"text",placeholder:"Search orders by patient name, token, or medication...",value:n,onChange:F=>r(F.target.value),className:"pharmacy-search-input"}),e.jsx(mn,{size:18,className:"pharmacy-search-icon"})]})]})]}),e.jsxs("div",{className:"pharmacy-orders-scroll-container",children:[c&&t.length>0&&e.jsxs("div",{className:"error-message-box",children:["Error: ",c]}),o&&t.length>0&&e.jsx("div",{className:"loading-pulse",children:"Updating Orders..."}),!o&&t.length===0&&!c&&e.jsx("div",{className:"empty-state-message",children:n?`No pharmacy orders found matching "${n}".`:"There are currently no pharmacy orders."}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pharmacy-table-container",children:e.jsxs("table",{className:"pharmacy-queue-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Medications"}),e.jsx("th",{className:"hidden md:table-cell",children:"Date"}),e.jsx("th",{children:"Order Total"})," ",e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(F=>e.jsxs("tr",{onClick:()=>I(F),style:{cursor:"pointer"},children:[e.jsxs("td",{children:[e.jsx("div",{className:"patient-name",children:F.patientName}),e.jsx("div",{className:"patient-token",title:`Patient Token: ${F.patientTokenNumber}`,children:F.patientTokenNumber})]}),e.jsxs("td",{className:"medication-info",children:[F.medications.map((B,G)=>e.jsxs("div",{className:"medication-item",children:[e.jsxs("span",{children:[B.name," (Packs: ",B.pack_quantity,", Loose: ",B.loose_quantity,", ",B.tabletsPerDay??"N/A","x",B.numberOfDays??"N/A","d)",B.box_number&&e.jsxs("span",{className:"medication-box-number",children:[" (Box: ",B.box_number,")"]})]}),B.directions_to_use&&e.jsxs("span",{className:"medication-directions",children:["Directions: ",B.directions_to_use]}),e.jsxs("div",{className:"medication-prices text-xs text-gray-500",children:[B.pack_price!==void 0&&`Pack Price: ${Number(B.pack_price).toFixed(2)}`,B.loose_price!==void 0&&` | Loose Price: ${Number(B.loose_price).toFixed(2)}`,B.total_price!==void 0&&` | Item Total: ${Number(B.total_price).toFixed(2)}`]})]},G)),F.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"unavailable-drugs-note",children:[e.jsx("strong",{children:"Unavailable Drugs Note:"})," ",F.prescriptionForUnavailableDrugs]})]}),e.jsx("td",{className:"hidden md:table-cell date-info",children:new Date(F.date).toLocaleDateString()}),e.jsxs("td",{className:"order-total-cell font-semibold",children:["",Number(F.order_total??0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:X(F.status),children:F.status})}),e.jsx("td",{children:e.jsxs("div",{className:"pharmacy-table-actions",children:[F.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:B=>{B.stopPropagation(),T(F.id)},className:"pharmacy-table-action-button btn-edit-order",children:[e.jsx(ds,{size:14})," Edit"]}),e.jsxs("button",{onClick:B=>{B.stopPropagation(),E(F.id)},className:"pharmacy-table-action-button btn-bill-order",children:[e.jsx(Ll,{size:14})," Bill"]})]}),F.status==="billed"&&e.jsxs("button",{onClick:B=>{B.stopPropagation(),U(F.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[e.jsx(aa,{size:14})," Dispense"]}),(F.status==="pending"||F.status==="billed")&&e.jsx("button",{onClick:B=>{B.stopPropagation(),U(F.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),e.jsx("button",{onClick:B=>{B.stopPropagation(),I(F)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})})]},F.id))})]})}),e.jsx("div",{className:"pharmacy-card-view-container",children:t.map(F=>{const B=X(F.status);return e.jsxs("div",{className:"pharmacy-order-card",onClick:()=>I(F),children:[e.jsxs("div",{className:"pharmacy-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"pharmacy-card-patient-name",children:F.patientName||"N/A"}),e.jsxs("div",{className:"pharmacy-card-patient-token",title:`Patient Token: ${F.patientTokenNumber}`,children:["Token: ",F.patientTokenNumber||"N/A"]}),e.jsx("div",{className:"pharmacy-card-date",children:new Date(F.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:B,children:F.status}),F.order_total!==void 0&&e.jsxs("span",{className:"pharmacy-card-order-total font-semibold",children:["",Number(F.order_total).toFixed(2)]})]})]}),e.jsxs("div",{className:"pharmacy-card-medications",children:[e.jsx("p",{className:"pharmacy-card-medications-title",children:"Medications:"}),e.jsxs("div",{className:"space-y-0_5",children:[F.medications.slice(0,2).map((G,C)=>e.jsxs("div",{className:"pharmacy-card-medication-item",children:[e.jsxs("span",{title:`${G.name} (Packs: ${G.pack_quantity}, Loose: ${G.loose_quantity}, ${G.tabletsPerDay??"N/A"}x${G.numberOfDays??"N/A"}d)`,children:[G.name," (Packs: ",G.pack_quantity,", Loose: ",G.loose_quantity,", ",G.tabletsPerDay??"N/A","x",G.numberOfDays??"N/A","d)",G.box_number&&e.jsxs("span",{className:"medication-box-number",children:[" (Box: ",G.box_number,")"]})]}),G.directions_to_use&&e.jsxs("span",{className:"medication-directions",title:`Directions: ${G.directions_to_use}`,children:["Directions: ",G.directions_to_use]}),e.jsxs("div",{className:"medication-prices text-xs text-gray-500",children:[G.pack_price!==void 0&&`Pack Price: ${Number(G.pack_price).toFixed(2)}`,G.loose_price!==void 0&&` | Loose Price: ${Number(G.loose_price).toFixed(2)}`,G.total_price!==void 0&&` | Item Total: ${Number(G.total_price).toFixed(2)}`]})]},C)),F.medications.length>2&&e.jsxs("div",{className:"pharmacy-card-medications-more",children:["...and ",F.medications.length-2," more"]}),F.medications.length===0&&e.jsx("div",{className:"pharmacy-card-no-medications",children:"No medications listed."})]}),F.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"unavailable-drugs-note",children:[e.jsx("strong",{children:"Unavailable Drugs Note:"})," ",F.prescriptionForUnavailableDrugs]})]}),e.jsxs("div",{className:"pharmacy-card-actions",children:[F.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:G=>{G.stopPropagation(),T(F.id)},className:"pharmacy-table-action-button btn-edit-order",children:[e.jsx(ds,{size:14})," Edit"]}),e.jsxs("button",{onClick:G=>{G.stopPropagation(),E(F.id)},className:"pharmacy-table-action-button btn-bill-order",children:[e.jsx(Ll,{size:14})," Bill"]})]}),F.status==="billed"&&e.jsxs("button",{onClick:G=>{G.stopPropagation(),U(F.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[e.jsx(aa,{size:14})," Dispense"]}),(F.status==="pending"||F.status==="billed")&&e.jsx("button",{onClick:G=>{G.stopPropagation(),U(F.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),e.jsx("button",{onClick:G=>{G.stopPropagation(),I(F)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})]},F.id)})})]}),!o&&x>1&&e.jsxs("div",{className:"pharmacy-pagination-container",children:[e.jsxs("div",{className:"pagination-mobile-controls",children:[e.jsx("button",{onClick:()=>g(F=>Math.max(F-1,1)),disabled:f===1,className:"pagination-button prev",children:"Previous"}),e.jsx("button",{onClick:()=>g(F=>Math.min(F+1,x)),disabled:f===x,className:"pagination-button next",children:"Next"})]}),e.jsxs("div",{className:"pagination-desktop-controls",children:[e.jsx("div",{className:"pagination-info",children:e.jsxs("p",{children:["Showing ",e.jsx("span",{className:"font-medium",children:(f-1)*D+1})," ","to ",e.jsx("span",{className:"font-medium",children:Math.min(f*D,N)})," ","of ",e.jsx("span",{className:"font-medium",children:N})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"pagination-nav","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>g(F=>Math.max(F-1,1)),disabled:f===1,className:"pagination-nav-button prev",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(Pd,{"aria-hidden":"true"})]}),e.jsxs("span",{"aria-current":"page",className:"pagination-current-page",children:["Page ",f," of ",x]}),e.jsxs("button",{onClick:()=>g(F=>Math.min(F+1,x)),disabled:f===x,className:"pagination-nav-button next",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(Ul,{"aria-hidden":"true"})]})]})})]})]})]})," "]})},aj=10,SP=3,zv=({isEmbedded:t=!1,initialSearch:s=""})=>{const n=ot(),[r,o]=y.useState([]),[u,c]=y.useState([]),[d,p]=y.useState(s),[m,f]=y.useState(!0),[g,x]=y.useState(null),[j,N]=y.useState(new Set),[k,D]=y.useState("all"),_=async()=>{try{const le=await ae("/api/inventory/download-csv");if(!le.ok)throw new Error(`Failed to download CSV: ${le.statusText}`);const pe=await le.blob(),de=window.URL.createObjectURL(pe),we=document.createElement("a");we.href=de,we.download="pharmacy_inventory.csv",document.body.appendChild(we),we.click(),we.remove(),window.URL.revokeObjectURL(de)}catch(le){console.error("Failed to download CSV:",le),x(le.message||"Failed to download inventory CSV. Please try again.")}},[T,E]=y.useState(!1),[U,X]=y.useState(!1),[I,F]=y.useState(null),[B,G]=y.useState(!1),[C,A]=y.useState(new Set),[P,$]=y.useState(1),J=8,[R,L]=y.useState(null),[M,Z]=y.useState(0),[Q,S]=y.useState(!1),[ge,fe]=y.useState(null),[w,ue]=y.useState(1),[Ne,K]=y.useState(!1),Y=P*J,V=Y-J,oe=u.slice(V,Y),Pe=Math.ceil(u.length/J);y.useEffect(()=>{$(1)},[d,k]);const se=y.useCallback(async()=>{f(!0),x(null);try{const le=await ae("/api/drugs");if(!le.ok)throw new Error(`Failed to fetch drugs: ${le.statusText} (${le.status})`);const pe=await le.json();let de=Array.isArray(pe)?pe:pe.drugs||[];de=de.map(we=>({...we,mrp:parseFloat(String(we.mrp))||0,rate:we.rate!==null&&we.rate!==void 0?parseFloat(String(we.rate)):null,stock:parseInt(String(we.stock),10)||0,gst:we.gst!==null&&we.gst!==void 0?parseFloat(String(we.gst)):null,margin:we.margin!==null&&we.margin!==void 0?parseFloat(String(we.margin)):null,discount:we.discount!==null&&we.discount!==void 0?parseFloat(String(we.discount)):null})),o(de),c(de)}catch(le){console.error("Failed to fetch drugs:",le),x(le.message||"Failed to load inventory. Please try again.")}finally{f(!1)}},[]);y.useEffect(()=>{se()},[se]),y.useEffect(()=>{s&&p(s)},[s]),y.useEffect(()=>{const le=d.toLowerCase();let pe=r.filter(Ae=>{var Mt,pt,nt,Xe,At;const Re=((Mt=Ae.name)==null?void 0:Mt.toLowerCase())||"",at=((pt=Ae.description)==null?void 0:pt.toLowerCase())||"",tt=((nt=Ae.supplier)==null?void 0:nt.toLowerCase())||"",Je=((Xe=Ae.box_number)==null?void 0:Xe.toLowerCase())||"",wt=((At=Ae.brand_name)==null?void 0:At.toLowerCase())||"";return Re.includes(le)||at.includes(le)||tt.includes(le)||Je.includes(le)||wt.includes(le)});const de=new Date,we=tS(de,SP);k==="low-stock"?pe=pe.filter(Ae=>Ae.stock<=aj):k==="near-expiry"?pe=pe.filter(Ae=>{if(!Ae.expiry_date)return!1;const Re=Xy(Ae.expiry_date);return Ky(Re)&&Rm(Re,we)&&!Rm(Re,de)}):k==="expired"&&(pe=pe.filter(Ae=>{if(!Ae.expiry_date)return!1;const Re=Xy(Ae.expiry_date);return Ky(Re)&&Rm(Re,de)})),c(pe)},[d,r,k]);const Ce=()=>{E(!1),L(null)},ee=le=>{Z(parseInt(le.target.value,10)||0)},je=async le=>{if(le.preventDefault(),x(null),!R||!R.id||M===0){x("No drug selected or adjustment amount is zero.");return}try{const pe=await ae(`/api/drugs/${R.id}/adjust-stock`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantityChange:M})});if(!pe.ok){const we=await pe.json();throw new Error(we.message||`Failed to adjust stock: ${pe.statusText}`)}const de=await pe.json();o(we=>we.map(Ae=>Ae.id===de.id?de:Ae)),Ce(),alert(`Stock for "${de.name}" adjusted successfully. New stock: ${de.stock}`)}catch(pe){console.error("Failed to adjust stock:",pe),x(pe.message||"Failed to adjust stock. Please try again.")}},Ie=le=>{F(le),X(!0)},$e=()=>{X(!1),F(null)},Fe=async()=>{if(!I||!I.id){x("No drug selected for deletion.");return}f(!0),x(null);try{const le=await ae(`/api/drugs/${I.id}`,{method:"DELETE"});if(!le.ok){const pe=await le.json();throw new Error(pe.message||`Failed to delete drug: ${le.statusText}`)}alert(`Drug "${I.name}" deleted successfully.`),se(),$e()}catch(le){console.error("Failed to delete drug:",le),x(le.message||"Failed to delete drug. Please try again.")}finally{f(!1)}},Be=()=>{G(!0)},qe=()=>{G(!1)},[et,ye]=y.useState(!1),Oe=()=>{C.size>0&&ye(!0)},xe=()=>{ye(!1)},he=async()=>{if(C.size===0){x("No drugs selected for deletion.");return}f(!0),x(null);try{const le=await ae("/api/drugs/batch-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({drugIds:Array.from(C)})});if(!le.ok){const pe=await le.json();throw new Error(pe.message||`Failed to delete selected drugs: ${le.statusText}`)}alert(`${C.size} drug(s) deleted successfully.`),se(),A(new Set),xe()}catch(le){console.error("Failed to delete selected drugs:",le),x(le.message||"Failed to delete selected drugs. Please try again.")}finally{f(!1)}},W=async()=>{f(!0),x(null);try{const le=await ae("/api/drugs/all",{method:"DELETE"});if(!le.ok){const pe=await le.json();throw new Error(pe.message||`Failed to delete all drugs: ${le.statusText}`)}alert("All drugs deleted successfully."),se(),qe()}catch(le){console.error("Failed to delete all drugs:",le),x(le.message||"Failed to delete all drugs. Please try again.")}finally{f(!1)}},O=le=>{if(!le)return null;const pe=le.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return pe?parseInt(pe[1],10):null},te=le=>{fe(le),ue(1),S(!0)},re=()=>{S(!1),fe(null),ue(1)},ke=le=>{ue(parseInt(le.target.value,10)||0)},Ue=async le=>{if(le.preventDefault(),x(null),!ge||!ge.id||w<=0){x("No drug selected or invalid number of packs to convert.");return}const pe=O(ge.pack);if(!pe||pe<=0){x(`Cannot convert "${ge.name}" to loose. Invalid pack unit: ${ge.pack||"N/A"}.`);return}if(w>(ge.stock??0)){x(`Cannot convert ${w} packs. Only ${ge.stock??0} packs are in stock.`);return}try{const de=await ae(`/api/drugs/${ge.id}/convert-to-loose`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({packsToConvert:w,packSize:pe})});if(!de.ok){const Ae=await de.json();throw new Error(Ae.message||`Failed to convert to loose: ${de.statusText}`)}const we=await de.json();o(Ae=>Ae.map(Re=>Re.id===we.id?we:Re)),re(),alert(`Converted ${w} pack(s) of "${we.name}" to loose. New stock: ${we.stock} packs, ${we.loose??0} loose units.`)}catch(de){console.error("Failed to convert to loose:",de),x(de.message||"Failed to convert to loose. Please try again.")}finally{f(!1)}},Qe=()=>{K(!0)},Ze=()=>{K(!1)},lt=async()=>{f(!0),x(null);try{const le=await ae("/api/drugs/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!le.ok){const pe=await le.json();throw new Error(pe.message||`Failed to add default medications: ${le.statusText}`)}alert("Default medications added successfully."),se(),Ze()}catch(le){console.error("Failed to add default medications:",le),x(le.message||"Failed to add default medications. Please try again.")}finally{f(!1)}};return m?e.jsx("div",{className:"loading-indicator",children:"Loading Inventory..."}):g?e.jsxs("div",{className:"error-indicator",children:["Error: ",g]}):e.jsxs("div",{className:`pharmacy-inventory-page ${t?"embedded":""}`,style:t?{minHeight:"auto",padding:"0",background:"transparent"}:{},children:[e.jsx("div",{className:"inventory-header-controls",style:{padding:"20px 20px 0 20px"},children:e.jsxs("div",{className:"inventory-actions-group",children:[e.jsxs("div",{className:"action-group-left",style:{display:"flex",gap:"12px"},children:[e.jsxs("button",{onClick:()=>n("/dashboard/purchase"),className:"action-button-outline add-drug-button",children:[e.jsx(ya,{size:18}),"Add New Drug"]}),e.jsxs("button",{onClick:()=>n("/dashboard/purchase"),className:"action-button-outline",children:[e.jsx(ya,{size:18}),"Purchase Page"]}),e.jsxs("button",{onClick:()=>n("/dashboard/distributors"),className:"action-button-outline",children:[e.jsx(ya,{size:18}),"Distributors"]})]}),e.jsxs("div",{className:"action-group-right",style:{display:"flex",gap:"12px"},children:[e.jsx("button",{onClick:_,className:"action-button-outline",children:"Download CSV"}),e.jsxs("button",{onClick:Qe,className:"action-button-outline",children:[e.jsx(ya,{size:18}),"Import Defaults"]}),e.jsxs("button",{onClick:Oe,className:"action-button-outline delete-button-outline",disabled:C.size===0,children:[e.jsx(on,{size:18}),"Delete (",C.size,")"]}),e.jsxs("button",{onClick:Be,className:"action-button-outline delete-all-button-outline",children:[e.jsx(on,{size:18}),"Delete All"]})]})]})}),e.jsxs("div",{className:"search-bar-container",style:{padding:"0 20px 20px 20px",borderBottom:"1px solid var(--border-color)",marginBottom:"0"},children:[e.jsxs("div",{className:"search-input-wrapper",style:{maxWidth:"600px"},children:[e.jsx(mn,{size:20,className:"search-input-icon"}),e.jsx("input",{type:"text",placeholder:"Search drugs...",value:d,onChange:le=>p(le.target.value),className:"inventory-search-input"})]}),e.jsx("div",{className:"filter-dropdown-wrapper",children:e.jsxs("select",{value:k,onChange:le=>D(le.target.value),className:"inventory-filter-select",children:[e.jsx("option",{value:"all",children:"All Drugs"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"near-expiry",children:"Near Expiry"}),e.jsx("option",{value:"expired",children:"Expired"})]})})]}),e.jsx("div",{className:"inventory-table-container",children:e.jsxs("table",{className:"inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-header",children:e.jsx("input",{type:"checkbox",onChange:le=>{if(le.target.checked){const pe=new Set(u.map(de=>de.id));A(pe)}else A(new Set)},checked:C.size===u.length&&u.length>0,disabled:u.length===0})}),e.jsx("th",{className:"drug-name-header",children:"DRUG DETAILS"}),e.jsx("th",{className:"pack-header",children:"PACK"}),e.jsx("th",{className:"expiry-header",children:"EXPIRY"}),e.jsx("th",{className:"text-stock qty-header",children:"STOCK"}),e.jsx("th",{className:"text-price mrp-header",children:"MRP"}),e.jsx("th",{className:"text-cost rate-header",children:"RATE"}),e.jsx("th",{className:"box-number-header",children:"BOX"}),e.jsx("th",{className:"discount-header",children:"DISC %"}),e.jsx("th",{className:"margin-header",children:"MARGIN"}),e.jsx("th",{className:"actions-cell",children:"ACTIONS"})]})}),e.jsxs("tbody",{children:[u.length===0&&e.jsx("tr",{className:"no-results-message",children:e.jsx("td",{colSpan:11,children:"No drugs found matching your search."})}),oe.map(le=>e.jsxs(en.Fragment,{children:[e.jsxs("tr",{className:"drug-row",onClick:()=>{const pe=new Set(j);pe.has(le.id)&&le.id!==void 0?pe.delete(le.id):le.id!==void 0&&pe.add(le.id),N(pe)},children:[e.jsx("td",{className:"checkbox-cell",children:e.jsx("input",{type:"checkbox",onClick:pe=>pe.stopPropagation(),checked:C.has(le.id),onChange:()=>{const pe=new Set(C);pe.has(le.id)?pe.delete(le.id):pe.add(le.id),A(pe)}})}),e.jsx("td",{className:"drug-name-cell",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:le.brand_name||le.name||"-"}),le.brand_name&&le.name&&le.brand_name!==le.name&&e.jsx("span",{className:"text-xs text-muted-foreground",style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:le.name})]})}),e.jsx("td",{className:"text-muted pack-cell",children:le.pack||"-"}),e.jsx("td",{className:"text-muted",children:le.expiry_date?new Date(le.expiry_date).toLocaleDateString("en-GB"):"-"}),e.jsxs("td",{className:`text-stock ${le.stock<=aj?"low-stock":""}`,children:[e.jsx("div",{style:{fontWeight:"bold"},children:le.stock}),e.jsx("div",{className:"loose-quantity",children:le.loose!==null&&le.loose!==void 0?`${le.loose} loose`:"0 loose"})]}),e.jsxs("td",{className:"text-muted text-price",children:["",typeof le.mrp=="number"?le.mrp.toFixed(2):"N/A"]}),e.jsx("td",{className:"text-muted text-cost",children:le.rate!==null&&le.rate!==void 0?`${le.rate.toFixed(2)}`:"-"}),e.jsx("td",{className:"text-muted",children:le.box_number||"-"}),e.jsx("td",{className:"text-muted",children:le.discount!==null&&le.discount!==void 0?`${le.discount.toFixed(2)}%`:"0.00%"}),e.jsx("td",{className:"text-muted",children:(()=>{const pe=le.mrp||0,de=le.rate||0,we=le.discount||0,Ae=le.gst||0,at=de*(1-we/100)*(1+Ae/100),tt=pe-at;return`${(pe>0?tt/pe*100:0).toFixed(2)}%`})()}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsx("button",{onClick:pe=>{pe.stopPropagation(),n(`/dashboard/inventory/edit/${le.id}`)},className:"action-icon-button",title:"Edit Drug",children:e.jsx(ds,{size:16})}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),Ie(le)},className:"action-icon-button delete-button",title:"Delete Drug",children:e.jsx(on,{size:16})}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),L(le),E(!0)},className:"action-icon-button adjust-stock-button",title:"Adjust Stock",children:e.jsx(Lw,{size:16})}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),te(le)},className:"action-icon-button convert-to-loose-button",title:"Convert to Loose",disabled:!le.pack||O(le.pack)===null,children:e.jsx($w,{size:16})})]})})]}),j.has(le.id)&&e.jsx("tr",{className:"collapsible-row",children:e.jsx("td",{colSpan:11,children:e.jsxs("div",{className:"collapsible-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",le.description||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supplier:"})," ",le.supplier||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Batch:"})," ",le.batch||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"HSN Code:"})," ",le.hsn_code||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"MFG:"})," ",le.mfg||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Loose Price:"}),(()=>{const pe=O(le.pack);return pe&&pe>0&&typeof le.mrp=="number"?`${(le.mrp/pe).toFixed(2)}`:"N/A"})()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"GST:"})," ",le.gst!==null&&le.gst!==void 0?`${le.gst.toFixed(2)}%`:"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(le.last_updated).toLocaleString()]})]})})})]},le.id))]})]})}),Pe>1&&e.jsxs("div",{className:"pagination-controls",style:{padding:"20px",display:"flex",justifyContent:"center",alignItems:"center",gap:"20px",backgroundColor:"var(--card-bg, #fff)",borderTop:"1px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>$(le=>Math.max(le-1,1)),disabled:P===1,className:"pagination-button",children:"Previous"}),e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Page ",P," of ",Pe]}),e.jsx("button",{onClick:()=>$(le=>Math.min(le+1,Pe)),disabled:P===Pe,className:"pagination-button",children:"Next"})]}),U&&I&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:$e,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion"}),e.jsxs("p",{className:"modal-description",children:['Are you sure you want to delete "',e.jsx("span",{className:"drug-name",children:I.name||"Unnamed Drug"}),'"? This action cannot be undone.']}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:$e,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Fe,className:"button-delete",children:"Delete"})]})]})}),T&&R&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Ce,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Adjust Stock"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:R.name||"Unnamed Drug"}),e.jsx("br",{}),"Current Stock: ",R.stock]}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("form",{onSubmit:je,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adjustment",className:"form-label",children:"Adjustment Amount"}),e.jsx("input",{type:"number",name:"adjustment",id:"adjustment",required:!0,step:"1",value:M===0?"":M,onChange:ee,placeholder:"e.g., 10 or -5",className:"form-input"}),e.jsx("p",{className:"form-help-text",children:"Enter a positive number to add stock, negative to remove."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Ce,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Adjust Stock"})]})]})]})}),B&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:qe,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of All Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:"ALL"})," drugs from the inventory? This action cannot be undone."]}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:qe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:W,className:"button-delete",children:"Delete All"})]})]})}),et&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:xe,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of Selected Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:C.size})," selected drug(s)? This action cannot be undone."]}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:xe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:he,className:"button-delete",children:"Delete Selected"})]})]})}),Q&&ge&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:re,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Convert to Loose"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:ge.name||"Unnamed Drug"}),e.jsx("br",{}),"Pack Size: ",ge.pack,e.jsx("br",{}),"Current Stock: ",ge.stock," packs, ",ge.loose??0," loose units."]}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("form",{onSubmit:Ue,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"packsToConvert",className:"form-label",children:"Packs to Convert"}),e.jsx("input",{type:"number",name:"packsToConvert",id:"packsToConvert",required:!0,step:"1",min:"1",max:ge.stock,value:w===0?"":w,onChange:ke,className:"form-input"}),e.jsxs("p",{className:"form-help-text",children:["Converting ",w," pack(s) will add ",w*(O(ge.pack)||0)," loose units."]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:re,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Convert"})]})]})]})}),Ne&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Ze,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Add Default Medications"}),e.jsx("p",{className:"modal-description",children:"Are you sure you want to add default medications to the inventory? This will add a predefined set of common medications."}),g&&e.jsx("div",{className:"modal-error-message",children:g}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Ze,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:lt,className:"button-submit",children:"Add Defaults"})]})]})})]})},kP=()=>{const t=ot();return e.jsxs("div",{className:"bg-white p-3 md:p-6 rounded-lg shadow",children:[e.jsx("button",{onClick:()=>t(-1),className:"mb-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Back"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Settings"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Pharmacy settings will be configured here."})]})},Rv=()=>{const{id:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState(!0),[c,d]=y.useState(null),[p,m]=y.useState(!1),[f,g]=y.useState(!1),x=y.useRef(null),j=y.useRef(null),N=y.useRef(null),k=y.useCallback(async()=>{if(!t){d("Drug ID is missing."),u(!1);return}u(!0),d(null);try{const E=await ae(`/api/drugs/${t}`);if(!E.ok){const X=await E.json();throw new Error(X.message||`Failed to fetch drug: ${E.statusText}`)}let U=await E.json();U={...U,name:U.name||"",brand_name:U.brand_name||"",mrp:parseFloat(String(U.mrp))||0,rate:U.rate!==null&&U.rate!==void 0?parseFloat(String(U.rate)):null,stock:parseInt(String(U.stock),10)||0,gst:U.gst!==null&&U.gst!==void 0?parseFloat(String(U.gst)):null,margin:U.margin!==null&&U.margin!==void 0?parseFloat(String(U.margin)):null,discount:U.discount!==null&&U.discount!==void 0?parseFloat(String(U.discount)):null,batch:U.batch||"",hsn_code:U.hsn_code||"",mfg:U.mfg||"",loose:U.loose!==null&&U.loose!==void 0?parseInt(String(U.loose),10):null},r(U)}catch(E){console.error("Failed to fetch drug:",E),d(E.message||"Failed to load drug data. Please try again.")}finally{u(!1)}},[t]);y.useEffect(()=>{k()},[k]),y.useEffect(()=>{const E=X=>{X.key==="Tab"&&j.current===document.activeElement&&(f||(g(!0),setTimeout(()=>{var I;(I=N.current)==null||I.focus()},0),X.preventDefault()))},U=X=>{x.current&&!x.current.contains(X.target)&&g(!1)};return document.addEventListener("keydown",E),document.addEventListener("mousedown",U),()=>{document.removeEventListener("keydown",E),document.removeEventListener("mousedown",U)}},[f]);const D=E=>{const{name:U,value:X,type:I}=E.target;r(F=>F?{...F,[U]:I==="number"?parseFloat(X)||null:X}:null)},_=()=>{s(-1)},T=async E=>{if(E.preventDefault(),d(null),m(!0),!n||!n.id){d("Cannot edit drug: No drug data available."),m(!1);return}if(n.mrp===void 0||n.stock===void 0){d("MRP and Stock Quantity are required."),m(!1);return}const U={...n,name:n.name===""?null:n.name,brand_name:n.brand_name===""?null:n.brand_name,rate:n.rate===0?null:n.rate,expiry_date:n.expiry_date===""?null:n.expiry_date,gst:n.gst===0?null:n.gst,margin:n.margin===0?null:n.margin,discount:n.discount===0?null:n.discount,batch:n.batch===""?null:n.batch,hsn_code:n.hsn_code===""?null:n.hsn_code,mfg:n.mfg===""?null:n.mfg,loose:n.loose===0?null:n.loose};try{const X=await ae(`/api/drugs/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(U)});if(!X.ok){const F=await X.json();throw new Error(F.message||`Failed to update drug: ${X.statusText}`)}const I=await X.json();alert(`Drug "${I.name}" updated successfully!`),s(-1)}catch(X){console.error("Failed to update drug:",X),d(X.message||"Failed to update drug. Please try again.")}finally{m(!1)}};return o?e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"loading-message",children:"Loading drug data..."})}):c&&!n?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"error-message-load",children:["Error: ",c]})}):n?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"edit-drug-form-container",children:[e.jsxs("div",{className:"edit-drug-form-header",children:[e.jsxs("h2",{children:["Edit Drug: ",n.name]}),e.jsx("button",{onClick:_,className:"cancel-button",title:"Go Back",children:e.jsx(Et,{size:24})})]}),c&&e.jsx("div",{className:"error-message-submit",children:c}),e.jsxs("form",{onSubmit:T,className:"edit-drug-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-name",className:"form-label",children:"Composition Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"name",id:"edit-name",value:n.name||"",onChange:D,className:"custom-text-input",placeholder:"e.g., Paracetamol",tabIndex:1})," "]}),e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-brand_name",className:"form-label",children:"Brand Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"brand_name",id:"edit-brand_name",value:n.brand_name||"",onChange:D,className:"custom-text-input",placeholder:"e.g., Calpol",tabIndex:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-mrp",className:"form-label",children:"MRP () *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),e.jsx("input",{type:"number",name:"mrp",id:"edit-mrp",required:!0,step:"0.01",min:"0",value:n.mrp||"",onChange:D,className:"custom-text-input",placeholder:"e.g., 500",tabIndex:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-stock",className:"form-label",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),e.jsx("input",{type:"number",name:"stock",id:"edit-stock",required:!0,step:"1",min:"0",value:n.stock||"",onChange:D,className:"custom-text-input",placeholder:"e.g., 5",tabIndex:4})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-pack",className:"form-label",children:"Pack (e.g., strip, bottle)"}),e.jsx("input",{type:"text",name:"pack",id:"edit-pack",value:n.pack||"",onChange:D,className:"custom-text-input",placeholder:"e.g., strip, bottle",tabIndex:5})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-expiry_date",className:"form-label",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",id:"edit-expiry_date",value:n.expiry_date||"",onChange:D,className:"custom-text-input",tabIndex:6})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-box_number",className:"form-label",children:"Box Number"}),e.jsx("input",{type:"text",name:"box_number",id:"edit-box_number",value:n.box_number||"",onChange:D,className:"custom-text-input",tabIndex:7})]}),e.jsxs("div",{className:"relative sm-col-span-2",ref:x,children:[e.jsx("button",{type:"button",onClick:()=>g(!f),className:"form-button w-full text-left",tabIndex:8,ref:j,children:"Others"}),f&&e.jsxs("div",{className:"others-fields-grid",children:[" ",e.jsxs("div",{className:"sm-col-span-2",children:[e.jsx("label",{htmlFor:"edit-description",className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",id:"edit-description",rows:3,value:n.description||"",onChange:D,className:"custom-text-input",tabIndex:9})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-supplier",className:"form-label",children:"Supplier"}),e.jsx("input",{type:"text",name:"supplier",id:"edit-supplier",value:n.supplier||"",onChange:D,className:"custom-text-input",placeholder:"Optional",tabIndex:10})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-rate",className:"form-label",children:"Rate ()"}),e.jsx("input",{type:"number",name:"rate",id:"edit-rate",step:"0.01",min:"0",value:n.rate??"",onChange:D,placeholder:"Optional",className:"custom-text-input",tabIndex:11,ref:N})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-gst",className:"form-label",children:"GST (%)"}),e.jsx("input",{type:"number",name:"gst",id:"edit-gst",step:"0.01",min:"0",max:"100",value:n.gst??"",onChange:D,placeholder:"Optional",className:"custom-text-input",tabIndex:12})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-margin",className:"form-label",children:"Margin (%)"}),e.jsx("input",{type:"number",name:"margin",id:"edit-margin",step:"0.01",min:"0",max:"100",value:n.margin??"",onChange:D,placeholder:"Optional",className:"custom-text-input",tabIndex:13})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-discount",className:"form-label",children:"Discount (%)"}),e.jsx("input",{type:"number",name:"discount",id:"edit-discount",step:"0.01",min:"0",max:"100",value:n.discount??"",onChange:D,placeholder:"Optional",className:"custom-text-input",tabIndex:14})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-batch",className:"form-label",children:"Batch"}),e.jsx("input",{type:"text",name:"batch",id:"edit-batch",value:n.batch||"",onChange:D,className:"custom-text-input",placeholder:"Optional",tabIndex:15})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-hsn_code",className:"form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsn_code",id:"edit-hsn_code",value:n.hsn_code||"",onChange:D,className:"custom-text-input",placeholder:"Optional",tabIndex:16})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-mfg",className:"form-label",children:"MFG"}),e.jsx("input",{type:"text",name:"mfg",id:"edit-mfg",value:n.mfg||"",onChange:D,className:"custom-text-input",placeholder:"Optional",tabIndex:17})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-loose",className:"form-label",children:"Loose"}),e.jsx("input",{type:"number",name:"loose",id:"edit-loose",step:"1",min:"0",value:n.loose??"",onChange:D,placeholder:"Optional",className:"custom-text-input",tabIndex:18})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:_,disabled:p,className:"form-button cancel-form-button",tabIndex:19,children:"Back"}),e.jsx("button",{type:"submit",disabled:p,className:"form-button submit-form-button",tabIndex:20,children:p?"Saving...":"Save Changes"})]})]})]})}):e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"not-found-message",children:"Drug not found."})})},Qp=()=>{const t=ot(),[s,n]=y.useState({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(null),[m,f]=y.useState(""),[g,x]=y.useState([]),[j,N]=y.useState(null),[k,D]=y.useState(!1),[_,T]=y.useState([]),[E,U]=y.useState(!0);Ra(),y.useEffect(()=>{(async()=>{U(!0);try{const A=await ae("/api/staff?role=doctor");if(!A.ok)throw new Error("Failed to fetch doctors");const P=await A.json();T(P),P.length>0&&n($=>({...$,doctorId:""}))}catch(A){console.error("Error fetching doctors:",A),c(`Failed to load doctors: ${A.message}`)}finally{U(!1)}})()},[]);const X=y.useCallback(async()=>{if(m.trim()){D(!0),c(null),x([]);try{const C=encodeURIComponent(m.trim()),A=await ae(`/api/patients?search=${C}&limit=10`);if(!A.ok){const $=await A.json().catch(()=>({message:"Failed to search patients"}));throw new Error($.message||"Failed to search patients")}const P=await A.json();P&&Array.isArray(P.patients)?x(P.patients):(console.error("Unexpected response format from patient search:",P),x([]))}catch(C){console.error("Error searching patients:",C),c(`Search failed: ${C.message}`)}finally{D(!1)}}},[m]);y.useEffect(()=>{if(m.trim().length<2){x([]),c(null);return}const C=setTimeout(()=>{X()},300);return()=>clearTimeout(C)},[m,X]);const I=C=>{N(C),f(""),x([]),c(null),n(A=>({...A,name:"",age:"",gender:"",phone:""}))},F=()=>{N(null),f(""),x([]),c(null),n(C=>({...C,name:"",age:"",gender:"",phone:""}))},B=C=>{const{name:A,value:P}=C.target;n($=>({...$,[A]:P}))},G=async C=>{var A;C.preventDefault(),c(null),p(null),o(!0);try{let P,$;if(j)P=j.id,$=j.name,console.log(`Adding existing patient ${P} to queue.`);else{console.log("Registering new patient...");const M=await ae("/api/patients",{method:"POST",body:JSON.stringify({name:s.name,age:s.age?parseInt(s.age,10):null,gender:s.gender||null,phone:s.phone||null})});if(!M.ok){const Q=await M.json();if(M.status===403&&Q.message.includes("Patient limit")){t("/start-clinic-subscription",{state:{errorMessage:Q.message}});return}throw new Error(Q.message||"Failed to register patient")}const Z=await M.json();P=Z.id,$=Z.name,console.log(`New patient ${P} registered.`)}const J=s.doctorId||null;console.log(`Adding patient ${P} to queue for doctor ${J||"Unassigned"}`);const R=await ae("/api/queue",{method:"POST",body:JSON.stringify({patientId:P,complaint:s.complaint||null,doctorId:J})});if(!R.ok){const M=await R.json();throw new Error(M.message||"Failed to add patient to queue")}const L=await R.json();if(console.log(`Patient added to queue, entry ID: ${L.id}`),N(null),f(""),x([]),n({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),J){const M=((A=_.find(Q=>Q.id===J))==null?void 0:A.name)||"Selected Doctor",Z=j?`Existing patient "${$}" added to queue for Dr. ${M}. Redirecting to billing...`:`Patient "${$}" registered and added to queue for Dr. ${M}. Redirecting to billing...`;p(Z),t("/billing",{state:{patientId:P,queueId:L.id,patientName:$,doctorId:J,billType:"consultation"}})}else{const M=j?`Existing patient "${$}" added to the general queue.`:`Patient "${$}" registered and added to the general queue.`;p(M)}}catch(P){console.error("Error in add/queue process:",P),P.message.includes("Patient limit")?(c(`Operation failed: ${P.message}. Please upgrade your plan.`),t("/start-clinic-subscription")):c(`Operation failed: ${P.message}`)}finally{o(!1)}};return e.jsxs("div",{className:"add-patient-page-container flex flex-col items-center justify-start",children:[e.jsxs("div",{className:"w-full max-w-3xl mb-2 flex justify-start",children:[" ",e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Back to Previous Page",children:[e.jsx(vt,{size:20,className:"btn-icon"})," Back"]})]}),e.jsxs("div",{className:"add-patient-card",children:[e.jsxs("h3",{className:"add-patient-title",children:[e.jsx(df,{size:28})," ",j?"Add Existing Patient to Queue":"Register New Patient & Add to Queue"]}),e.jsxs("div",{className:"search-section",children:[e.jsx("legend",{className:"form-fieldset legend",children:"Find Existing Patient"})," ",e.jsxs("div",{className:"flex items-center space-x-2",children:[" ",e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search by Name or Phone...",value:m,onChange:C=>f(C.target.value),className:"form-input",disabled:r||!!j}),e.jsx(mn,{size:18,className:`${k?"text-primary animate-pulse":""}`})," "]}),j&&e.jsxs("button",{type:"button",onClick:F,className:"btn btn-danger",title:"Clear Selection",children:[e.jsx(Et,{size:16,className:"btn-icon"})," Clear"]})]}),g.length>0&&!j&&e.jsx("ul",{className:"search-results-list",children:g.map(C=>e.jsxs("li",{onClick:()=>I(C),children:[C.name," (ID: ",C.id,", Phone: ",C.phone||"N/A",")"]},C.id))}),m.length>=2&&g.length===0&&!k&&!j&&e.jsxs("p",{className:"search-info-text",children:['No patients found matching "',m,'". You can register them below.']}),k&&m.length>=2&&e.jsx("p",{className:"search-info-text searching",children:"Searching..."})]}),u&&e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:u})]}),d&&e.jsxs("div",{className:"alert alert-success",role:"alert",children:[e.jsx("strong",{children:"Success: "}),e.jsx("span",{children:d})]}),e.jsxs("form",{onSubmit:G,className:"space-y-5",children:[" ",e.jsxs("fieldset",{className:`form-fieldset ${j?"fieldset-disabled":""}`,children:[e.jsx("legend",{children:j?`Selected Patient: ${j.name}`:"New Patient Details"}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",value:j?j.name:s.name,onChange:B,className:"form-input",required:!j,disabled:r||!!j})]}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Age"}),e.jsx("input",{type:"number",name:"age",value:j?j.age??"":s.age,onChange:B,className:"form-input",min:"0",disabled:r||!!j})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{name:"gender",value:j?j.gender??"":s.gender,onChange:B,className:"form-select",disabled:r||!!j,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:j?j.phone??"":s.phone,onChange:B,className:"form-input",disabled:r||!!j})]})]})]}),e.jsxs("fieldset",{className:"form-fieldset",children:[e.jsx("legend",{children:"Visit Details"}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Assign Doctor (Optional)"}),e.jsxs("select",{name:"doctorId",value:s.doctorId,onChange:B,className:`form-select ${E?"opacity-50":""}`,disabled:r||E,children:[e.jsx("option",{value:"",children:E?"Loading doctors...":_.length===0?"No doctors available":"-- No Doctor (Add to General Queue) --"}),_.map(C=>e.jsx("option",{value:C.id,children:C.name},C.id))]}),_.length===0&&!E&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Please add doctors via the Admin Panel."})]}),e.jsxs("div",{className:"form-grid-col-span-2",children:[" ",e.jsx("label",{className:"form-label",children:"Patient Data / Reason"}),e.jsx("textarea",{name:"complaint",value:s.complaint,onChange:B,rows:2,className:"form-textarea",disabled:r})]})]})]}),e.jsxs("div",{className:"flex justify-end pt-2",children:[" ",e.jsxs("button",{type:"submit",className:`btn btn-primary ${r||E?"disabled":""}`,disabled:r||E,children:[e.jsx(mf,{size:18,className:"btn-icon"}),r?"Processing...":j?"Add Existing to Queue":"Register & Add to Queue"]})]})]})]})]})},CP=({clinicId:t})=>{const s=ot(),[n,r]=y.useState({name:"",email:"",role:"receptionist",password:"",opd_fee:""}),[o,u]=y.useState(null),[c,d]=y.useState(!1);y.useEffect(()=>{u(t?null:"Clinic information is missing. Cannot add staff. Please ensure you are logged in correctly.")},[t]);const p=g=>{const{name:x,value:j}=g.target;r(N=>{const k={...N,[x]:j};return x==="role"&&j!=="doctor"&&(k.opd_fee=""),k})},m=async g=>{if(g.preventDefault(),u(null),!n.name||!n.email||!n.role||!n.password){u("Name, Email, Role, and Password are required.");return}if(!t){u("Clinic information is missing. Cannot add staff.");return}const x={...n,clinic_id:t,opd_fee:n.role==="doctor"&&n.opd_fee?parseFloat(String(n.opd_fee)):null};if(x.role==="doctor"&&n.opd_fee&&isNaN(x.opd_fee)){u("Invalid OPD Fee format. Please enter a number.");return}d(!0);try{const j=await ae("/api/staff",{method:"POST",body:JSON.stringify(x)});if(!j.ok){const N=await j.json();throw new Error(N.message||"Server responded with an error")}s(-1)}catch(j){u(`Failed to add staff: ${j.message}`)}finally{d(!1)}},f=()=>{s(-1)};return e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:f,className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(vt,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{children:"Add New Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),o&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),o]}),e.jsxs("form",{onSubmit:m,className:`staff-form ${t?"":"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{id:"name",type:"text",name:"name",value:n.name||"",onChange:p,required:!0,disabled:c||!t,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",name:"email",value:n.email||"",onChange:p,required:!0,disabled:c||!t,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Assign Role"}),e.jsxs("select",{id:"role",name:"role",value:n.role||"receptionist",onChange:p,required:!0,disabled:c||!t,children:[e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"}),e.jsx("option",{value:"lab",children:"Lab Technician"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Set Initial Password"}),e.jsx("input",{id:"password",type:"password",name:"password",value:n.password||"",onChange:p,required:!0,disabled:c||!t,placeholder:"Create a password"})]}),n.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Consultation Fee () (Optional)"}),e.jsx("input",{id:"opd_fee",type:"number",name:"opd_fee",value:n.opd_fee||"",onChange:p,step:"0.01",min:"0",placeholder:"e.g., 150.00",disabled:c||!t}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank if no specific fee is set for this doctor."})]}),e.jsxs("button",{type:"submit",disabled:c||!t,children:[c?e.jsx(Va,{size:18,className:"animate-spin mr-2"}):e.jsx(Ia,{size:18,className:"mr-2"}),c?"Adding...":"Add Staff Member"]})]})]})},_P=()=>{const{id:t}=Qn(),s=ot(),[n,r]=y.useState({name:"",email:"",role:"receptionist",opd_fee:"",active:!0}),[o,u]=y.useState(""),[c,d]=y.useState(!0),[p,m]=y.useState(!1),[f,g]=y.useState(null),[x,j]=y.useState(null),N=y.useCallback(async()=>{if(!t){g("Staff ID is missing."),d(!1);return}d(!0),g(null),j(null);try{const T=await ae(`/staff/${t}`);if(!T.ok){const U=await T.json();throw new Error(U.message||`HTTP error! status: ${T.status}`)}const E=await T.json();r({name:E.name,email:E.email,role:E.role,opd_fee:E.opd_fee??"",active:E.active})}catch(T){g(`Failed to load staff details: ${T.message}`)}finally{d(!1)}},[t]);y.useEffect(()=>{N()},[N]);const k=T=>{const{name:E,value:U,type:X}=T.target;if(X==="checkbox"){const{checked:I}=T.target;r(F=>({...F,[E]:I}))}else r(I=>({...I,[E]:U}))},D=T=>{u(T.target.value)},_=async T=>{if(T.preventDefault(),!t){g("Staff ID is missing.");return}m(!0),g(null),j(null);const E={name:n.name,email:n.email,role:n.role,active:n.active};if(n.role==="doctor"){const U=n.opd_fee?parseFloat(String(n.opd_fee)):null;if(U!==null&&isNaN(U)){g("OPD Fee must be a valid number."),m(!1);return}E.opd_fee=U}else E.opd_fee=null;o.trim()!==""&&(E.password=o.trim());try{const U=await ae(`/staff/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!U.ok){const X=await U.json();throw new Error(X.message||`HTTP error! status: ${U.status}`)}j("Staff details updated successfully!"),u(""),setTimeout(()=>s(-1),1500)}catch(U){g(`Failed to update staff: ${U.message}`)}finally{m(!1)}};return c?e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx(Va,{className:"h-12 w-12 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-4 text-xl text-gray-700",children:"Loading Staff Details..."})]}):e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>s(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(vt,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),f&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),f,e.jsx("button",{onClick:()=>g(null),className:"ml-auto text-red-600 hover:text-red-800 text-xl font-bold",children:""})]}),x&&e.jsxs("div",{className:"success-message mb-4 p-3 bg-green-100 border border-green-400 rounded-md flex items-center",children:[e.jsx(aa,{size:18,className:"mr-2 text-green-500"}),x,e.jsx("button",{onClick:()=>j(null),className:"ml-auto text-green-600 hover:text-green-800 text-xl font-bold",children:""})]}),e.jsxs("form",{onSubmit:_,className:"staff-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name||"",onChange:k,required:!0,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:n.email||"",onChange:k,required:!0,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"role",name:"role",value:n.role||"receptionist",onChange:k,required:!0,children:[e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"lab",children:"Lab Technician"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"})]})]}),n.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Fee ()"}),e.jsx("input",{type:"number",id:"opd_fee",name:"opd_fee",value:n.opd_fee||"",onChange:k,min:"0",step:"0.01",placeholder:"Enter OPD consultation fee (optional)"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{id:"active",name:"active",type:"checkbox",checked:n.active??!0,onChange:k}),e.jsxs("label",{htmlFor:"active",className:"mb-0",children:[" ","Account Active"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"New Password (optional)"}),e.jsx("input",{type:"password",id:"password",name:"password",value:o,onChange:D,placeholder:"Leave blank to keep current password",autoComplete:"new-password"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter a new password only if you want to change it. Minimum 6 characters."})]}),e.jsx("button",{type:"submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{size:16,className:"mr-2"}),"Save Changes"]})})]})]})},DP={};function Rf(t,s){const n=DP,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,o=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Lv(t,r,o)}function Lv(t,s,n){if(EP(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(s&&"alt"in t&&t.alt)return t.alt;if("children"in t)return sj(t.children,s,n)}return Array.isArray(t)?sj(t,s,n):""}function sj(t,s,n){const r=[];let o=-1;for(;++o<t.length;)r[o]=Lv(t[o],s,n);return r.join("")}function EP(t){return!!(t&&typeof t=="object")}const ij=document.createElement("i");function Lf(t){const s="&"+t+";";ij.innerHTML=s;const n=ij.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===s?!1:n}function ms(t,s,n,r){const o=t.length;let u=0,c;if(s<0?s=-s>o?0:o+s:s=s>o?o:s,n=n>0?n:0,r.length<1e4)c=Array.from(r),c.unshift(s,n),t.splice(...c);else for(n&&t.splice(s,n);u<r.length;)c=r.slice(u,u+1e4),c.unshift(s,0),t.splice(...c),u+=1e4,s+=1e4}function Pa(t,s){return t.length>0?(ms(t,t.length,0,s),t):s}const rj={}.hasOwnProperty;function TP(t){const s={};let n=-1;for(;++n<t.length;)AP(s,t[n]);return s}function AP(t,s){let n;for(n in s){const o=(rj.call(t,n)?t[n]:void 0)||(t[n]={}),u=s[n];let c;if(u)for(c in u){rj.call(o,c)||(o[c]=[]);const d=u[c];PP(o[c],Array.isArray(d)?d:d?[d]:[])}}}function PP(t,s){let n=-1;const r=[];for(;++n<s.length;)(s[n].add==="after"?t:r).push(s[n]);ms(t,0,0,r)}function $v(t,s){const n=Number.parseInt(t,s);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Ol(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const os=Bi(/[A-Za-z]/),ba=Bi(/[\dA-Za-z]/),IP=Bi(/[#-'*+\--9=?A-Z^-~]/);function Yp(t){return t!==null&&(t<32||t===127)}const Jp=Bi(/\d/),OP=Bi(/[\dA-Fa-f]/),zP=Bi(/[!-/:-@[-`{-~]/);function mt(t){return t!==null&&t<-2}function na(t){return t!==null&&(t<0||t===32)}function Lt(t){return t===-2||t===-1||t===32}const RP=Bi(new RegExp("\\p{P}|\\p{S}","u")),LP=Bi(/\s/);function Bi(t){return s;function s(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Vl(t){const s=[];let n=-1,r=0,o=0;for(;++n<t.length;){const u=t.charCodeAt(n);let c="";if(u===37&&ba(t.charCodeAt(n+1))&&ba(t.charCodeAt(n+2)))o=2;else if(u<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(u))||(c=String.fromCharCode(u));else if(u>55295&&u<57344){const d=t.charCodeAt(n+1);u<56320&&d>56319&&d<57344?(c=String.fromCharCode(u,d),o=1):c=""}else c=String.fromCharCode(u);c&&(s.push(t.slice(r,n),encodeURIComponent(c)),r=n+o+1,c=""),o&&(n+=o,o=0)}return s.join("")+t.slice(r)}function tn(t,s,n,r){const o=r?r-1:Number.POSITIVE_INFINITY;let u=0;return c;function c(p){return Lt(p)?(t.enter(n),d(p)):s(p)}function d(p){return Lt(p)&&u++<o?(t.consume(p),d):(t.exit(n),s(p))}}const $P={tokenize:FP};function FP(t){const s=t.attempt(this.parser.constructs.contentInitial,r,o);let n;return s;function r(d){if(d===null){t.consume(d);return}return t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),tn(t,s,"linePrefix")}function o(d){return t.enter("paragraph"),u(d)}function u(d){const p=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=p),n=p,c(d)}function c(d){if(d===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(d);return}return mt(d)?(t.consume(d),t.exit("chunkText"),u):(t.consume(d),c)}}const MP={tokenize:BP},lj={tokenize:UP};function BP(t){const s=this,n=[];let r=0,o,u,c;return d;function d(E){if(r<n.length){const U=n[r];return s.containerState=U[1],t.attempt(U[0].continuation,p,m)(E)}return m(E)}function p(E){if(r++,s.containerState._closeFlow){s.containerState._closeFlow=void 0,o&&T();const U=s.events.length;let X=U,I;for(;X--;)if(s.events[X][0]==="exit"&&s.events[X][1].type==="chunkFlow"){I=s.events[X][1].end;break}_(r);let F=U;for(;F<s.events.length;)s.events[F][1].end={...I},F++;return ms(s.events,X+1,0,s.events.slice(U)),s.events.length=F,m(E)}return d(E)}function m(E){if(r===n.length){if(!o)return x(E);if(o.currentConstruct&&o.currentConstruct.concrete)return N(E);s.interrupt=!!(o.currentConstruct&&!o._gfmTableDynamicInterruptHack)}return s.containerState={},t.check(lj,f,g)(E)}function f(E){return o&&T(),_(r),x(E)}function g(E){return s.parser.lazy[s.now().line]=r!==n.length,c=s.now().offset,N(E)}function x(E){return s.containerState={},t.attempt(lj,j,N)(E)}function j(E){return r++,n.push([s.currentConstruct,s.containerState]),x(E)}function N(E){if(E===null){o&&T(),_(0),t.consume(E);return}return o=o||s.parser.flow(s.now()),t.enter("chunkFlow",{_tokenizer:o,contentType:"flow",previous:u}),k(E)}function k(E){if(E===null){D(t.exit("chunkFlow"),!0),_(0),t.consume(E);return}return mt(E)?(t.consume(E),D(t.exit("chunkFlow")),r=0,s.interrupt=void 0,d):(t.consume(E),k)}function D(E,U){const X=s.sliceStream(E);if(U&&X.push(null),E.previous=u,u&&(u.next=E),u=E,o.defineSkip(E.start),o.write(X),s.parser.lazy[E.start.line]){let I=o.events.length;for(;I--;)if(o.events[I][1].start.offset<c&&(!o.events[I][1].end||o.events[I][1].end.offset>c))return;const F=s.events.length;let B=F,G,C;for(;B--;)if(s.events[B][0]==="exit"&&s.events[B][1].type==="chunkFlow"){if(G){C=s.events[B][1].end;break}G=!0}for(_(r),I=F;I<s.events.length;)s.events[I][1].end={...C},I++;ms(s.events,B+1,0,s.events.slice(F)),s.events.length=I}}function _(E){let U=n.length;for(;U-- >E;){const X=n[U];s.containerState=X[1],X[0].exit.call(s,t)}n.length=E}function T(){o.write([null]),u=void 0,o=void 0,s.containerState._closeFlow=void 0}}function UP(t,s,n){return tn(t,t.attempt(this.parser.constructs.document,s,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Cd(t){if(t===null||na(t)||LP(t))return 1;if(RP(t))return 2}function $f(t,s,n){const r=[];let o=-1;for(;++o<t.length;){const u=t[o].resolveAll;u&&!r.includes(u)&&(s=u(s,n),r.push(u))}return s}const Xp={name:"attention",resolveAll:qP,tokenize:HP};function qP(t,s){let n=-1,r,o,u,c,d,p,m,f;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&s.sliceSerialize(t[r][1]).charCodeAt(0)===s.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;p=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const g={...t[r][1].end},x={...t[n][1].start};oj(g,-p),oj(x,p),c={type:p>1?"strongSequence":"emphasisSequence",start:g,end:{...t[r][1].end}},d={type:p>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:x},u={type:p>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},o={type:p>1?"strong":"emphasis",start:{...c.start},end:{...d.end}},t[r][1].end={...c.start},t[n][1].start={...d.end},m=[],t[r][1].end.offset-t[r][1].start.offset&&(m=Pa(m,[["enter",t[r][1],s],["exit",t[r][1],s]])),m=Pa(m,[["enter",o,s],["enter",c,s],["exit",c,s],["enter",u,s]]),m=Pa(m,$f(s.parser.constructs.insideSpan.null,t.slice(r+1,n),s)),m=Pa(m,[["exit",u,s],["enter",d,s],["exit",d,s],["exit",o,s]]),t[n][1].end.offset-t[n][1].start.offset?(f=2,m=Pa(m,[["enter",t[n][1],s],["exit",t[n][1],s]])):f=0,ms(t,r-1,n-r+3,m),n=r+m.length-f-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function HP(t,s){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,o=Cd(r);let u;return c;function c(p){return u=p,t.enter("attentionSequence"),d(p)}function d(p){if(p===u)return t.consume(p),d;const m=t.exit("attentionSequence"),f=Cd(p),g=!f||f===2&&o||n.includes(p),x=!o||o===2&&f||n.includes(r);return m._open=!!(u===42?g:g&&(o||!x)),m._close=!!(u===42?x:x&&(f||!g)),s(p)}}function oj(t,s){t.column+=s,t.offset+=s,t._bufferIndex+=s}const VP={name:"autolink",tokenize:GP};function GP(t,s,n){let r=0;return o;function o(j){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),u}function u(j){return os(j)?(t.consume(j),c):j===64?n(j):m(j)}function c(j){return j===43||j===45||j===46||ba(j)?(r=1,d(j)):m(j)}function d(j){return j===58?(t.consume(j),r=0,p):(j===43||j===45||j===46||ba(j))&&r++<32?(t.consume(j),d):(r=0,m(j))}function p(j){return j===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.exit("autolink"),s):j===null||j===32||j===60||Yp(j)?n(j):(t.consume(j),p)}function m(j){return j===64?(t.consume(j),f):IP(j)?(t.consume(j),m):n(j)}function f(j){return ba(j)?g(j):n(j)}function g(j){return j===46?(t.consume(j),r=0,f):j===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(j),t.exit("autolinkMarker"),t.exit("autolink"),s):x(j)}function x(j){if((j===45||ba(j))&&r++<63){const N=j===45?x:g;return t.consume(j),N}return n(j)}}const Bd={partial:!0,tokenize:QP};function QP(t,s,n){return r;function r(u){return Lt(u)?tn(t,o,"linePrefix")(u):o(u)}function o(u){return u===null||mt(u)?s(u):n(u)}}const Fv={continuation:{tokenize:JP},exit:XP,name:"blockQuote",tokenize:YP};function YP(t,s,n){const r=this;return o;function o(c){if(c===62){const d=r.containerState;return d.open||(t.enter("blockQuote",{_container:!0}),d.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(c),t.exit("blockQuoteMarker"),u}return n(c)}function u(c){return Lt(c)?(t.enter("blockQuotePrefixWhitespace"),t.consume(c),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),s):(t.exit("blockQuotePrefix"),s(c))}}function JP(t,s,n){const r=this;return o;function o(c){return Lt(c)?tn(t,u,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(c):u(c)}function u(c){return t.attempt(Fv,s,n)(c)}}function XP(t){t.exit("blockQuote")}const Mv={name:"characterEscape",tokenize:KP};function KP(t,s,n){return r;function r(u){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(u),t.exit("escapeMarker"),o}function o(u){return zP(u)?(t.enter("characterEscapeValue"),t.consume(u),t.exit("characterEscapeValue"),t.exit("characterEscape"),s):n(u)}}const Bv={name:"characterReference",tokenize:WP};function WP(t,s,n){const r=this;let o=0,u,c;return d;function d(g){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),p}function p(g){return g===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(g),t.exit("characterReferenceMarkerNumeric"),m):(t.enter("characterReferenceValue"),u=31,c=ba,f(g))}function m(g){return g===88||g===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(g),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),u=6,c=OP,f):(t.enter("characterReferenceValue"),u=7,c=Jp,f(g))}function f(g){if(g===59&&o){const x=t.exit("characterReferenceValue");return c===ba&&!Lf(r.sliceSerialize(x))?n(g):(t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),t.exit("characterReference"),s)}return c(g)&&o++<u?(t.consume(g),f):n(g)}}const cj={partial:!0,tokenize:e4},uj={concrete:!0,name:"codeFenced",tokenize:ZP};function ZP(t,s,n){const r=this,o={partial:!0,tokenize:X};let u=0,c=0,d;return p;function p(I){return m(I)}function m(I){const F=r.events[r.events.length-1];return u=F&&F[1].type==="linePrefix"?F[2].sliceSerialize(F[1],!0).length:0,d=I,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),f(I)}function f(I){return I===d?(c++,t.consume(I),f):c<3?n(I):(t.exit("codeFencedFenceSequence"),Lt(I)?tn(t,g,"whitespace")(I):g(I))}function g(I){return I===null||mt(I)?(t.exit("codeFencedFence"),r.interrupt?s(I):t.check(cj,k,U)(I)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),x(I))}function x(I){return I===null||mt(I)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),g(I)):Lt(I)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),tn(t,j,"whitespace")(I)):I===96&&I===d?n(I):(t.consume(I),x)}function j(I){return I===null||mt(I)?g(I):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),N(I))}function N(I){return I===null||mt(I)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),g(I)):I===96&&I===d?n(I):(t.consume(I),N)}function k(I){return t.attempt(o,U,D)(I)}function D(I){return t.enter("lineEnding"),t.consume(I),t.exit("lineEnding"),_}function _(I){return u>0&&Lt(I)?tn(t,T,"linePrefix",u+1)(I):T(I)}function T(I){return I===null||mt(I)?t.check(cj,k,U)(I):(t.enter("codeFlowValue"),E(I))}function E(I){return I===null||mt(I)?(t.exit("codeFlowValue"),T(I)):(t.consume(I),E)}function U(I){return t.exit("codeFenced"),s(I)}function X(I,F,B){let G=0;return C;function C(R){return I.enter("lineEnding"),I.consume(R),I.exit("lineEnding"),A}function A(R){return I.enter("codeFencedFence"),Lt(R)?tn(I,P,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(R):P(R)}function P(R){return R===d?(I.enter("codeFencedFenceSequence"),$(R)):B(R)}function $(R){return R===d?(G++,I.consume(R),$):G>=c?(I.exit("codeFencedFenceSequence"),Lt(R)?tn(I,J,"whitespace")(R):J(R)):B(R)}function J(R){return R===null||mt(R)?(I.exit("codeFencedFence"),F(R)):B(R)}}}function e4(t,s,n){const r=this;return o;function o(c){return c===null?n(c):(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),u)}function u(c){return r.parser.lazy[r.now().line]?n(c):s(c)}}const up={name:"codeIndented",tokenize:n4},t4={partial:!0,tokenize:a4};function n4(t,s,n){const r=this;return o;function o(m){return t.enter("codeIndented"),tn(t,u,"linePrefix",5)(m)}function u(m){const f=r.events[r.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?c(m):n(m)}function c(m){return m===null?p(m):mt(m)?t.attempt(t4,c,p)(m):(t.enter("codeFlowValue"),d(m))}function d(m){return m===null||mt(m)?(t.exit("codeFlowValue"),c(m)):(t.consume(m),d)}function p(m){return t.exit("codeIndented"),s(m)}}function a4(t,s,n){const r=this;return o;function o(c){return r.parser.lazy[r.now().line]?n(c):mt(c)?(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),o):tn(t,u,"linePrefix",5)(c)}function u(c){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):mt(c)?o(c):n(c)}}const s4={name:"codeText",previous:r4,resolve:i4,tokenize:l4};function i4(t){let s=t.length-4,n=3,r,o;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[s][1].type==="lineEnding"||t[s][1].type==="space")){for(r=n;++r<s;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[s][1].type="codeTextPadding",n+=2,s-=2;break}}for(r=n-1,s++;++r<=s;)o===void 0?r!==s&&t[r][1].type!=="lineEnding"&&(o=r):(r===s||t[r][1].type==="lineEnding")&&(t[o][1].type="codeTextData",r!==o+2&&(t[o][1].end=t[r-1][1].end,t.splice(o+2,r-o-2),s-=r-o-2,r=o+2),o=void 0);return t}function r4(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function l4(t,s,n){let r=0,o,u;return c;function c(g){return t.enter("codeText"),t.enter("codeTextSequence"),d(g)}function d(g){return g===96?(t.consume(g),r++,d):(t.exit("codeTextSequence"),p(g))}function p(g){return g===null?n(g):g===32?(t.enter("space"),t.consume(g),t.exit("space"),p):g===96?(u=t.enter("codeTextSequence"),o=0,f(g)):mt(g)?(t.enter("lineEnding"),t.consume(g),t.exit("lineEnding"),p):(t.enter("codeTextData"),m(g))}function m(g){return g===null||g===32||g===96||mt(g)?(t.exit("codeTextData"),p(g)):(t.consume(g),m)}function f(g){return g===96?(t.consume(g),o++,f):o===r?(t.exit("codeTextSequence"),t.exit("codeText"),s(g)):(u.type="codeTextData",m(g))}}class o4{constructor(s){this.left=s?[...s]:[],this.right=[]}get(s){if(s<0||s>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+s+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return s<this.left.length?this.left[s]:this.right[this.right.length-s+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(s,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(s,r):s>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-s+this.left.length).reverse():this.left.slice(s).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(s,n,r){const o=n||0;this.setCursor(Math.trunc(s));const u=this.right.splice(this.right.length-o,Number.POSITIVE_INFINITY);return r&&dc(this.left,r),u.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(s){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(s)}pushMany(s){this.setCursor(Number.POSITIVE_INFINITY),dc(this.left,s)}unshift(s){this.setCursor(0),this.right.push(s)}unshiftMany(s){this.setCursor(0),dc(this.right,s.reverse())}setCursor(s){if(!(s===this.left.length||s>this.left.length&&this.right.length===0||s<0&&this.left.length===0))if(s<this.left.length){const n=this.left.splice(s,Number.POSITIVE_INFINITY);dc(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-s,Number.POSITIVE_INFINITY);dc(this.left,n.reverse())}}}function dc(t,s){let n=0;if(s.length<1e4)t.push(...s);else for(;n<s.length;)t.push(...s.slice(n,n+1e4)),n+=1e4}function Uv(t){const s={};let n=-1,r,o,u,c,d,p,m;const f=new o4(t);for(;++n<f.length;){for(;n in s;)n=s[n];if(r=f.get(n),n&&r[1].type==="chunkFlow"&&f.get(n-1)[1].type==="listItemPrefix"&&(p=r[1]._tokenizer.events,u=0,u<p.length&&p[u][1].type==="lineEndingBlank"&&(u+=2),u<p.length&&p[u][1].type==="content"))for(;++u<p.length&&p[u][1].type!=="content";)p[u][1].type==="chunkText"&&(p[u][1]._isInFirstContentOfListItem=!0,u++);if(r[0]==="enter")r[1].contentType&&(Object.assign(s,c4(f,n)),n=s[n],m=!0);else if(r[1]._container){for(u=n,o=void 0;u--;)if(c=f.get(u),c[1].type==="lineEnding"||c[1].type==="lineEndingBlank")c[0]==="enter"&&(o&&(f.get(o)[1].type="lineEndingBlank"),c[1].type="lineEnding",o=u);else if(!(c[1].type==="linePrefix"||c[1].type==="listItemIndent"))break;o&&(r[1].end={...f.get(o)[1].start},d=f.slice(o,n),d.unshift(r),f.splice(o,n-o+1,d))}}return ms(t,0,Number.POSITIVE_INFINITY,f.slice(0)),!m}function c4(t,s){const n=t.get(s)[1],r=t.get(s)[2];let o=s-1;const u=[];let c=n._tokenizer;c||(c=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(c._contentTypeTextTrailing=!0));const d=c.events,p=[],m={};let f,g,x=-1,j=n,N=0,k=0;const D=[k];for(;j;){for(;t.get(++o)[1]!==j;);u.push(o),j._tokenizer||(f=r.sliceStream(j),j.next||f.push(null),g&&c.defineSkip(j.start),j._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=!0),c.write(f),j._isInFirstContentOfListItem&&(c._gfmTasklistFirstContentOfListItem=void 0)),g=j,j=j.next}for(j=n;++x<d.length;)d[x][0]==="exit"&&d[x-1][0]==="enter"&&d[x][1].type===d[x-1][1].type&&d[x][1].start.line!==d[x][1].end.line&&(k=x+1,D.push(k),j._tokenizer=void 0,j.previous=void 0,j=j.next);for(c.events=[],j?(j._tokenizer=void 0,j.previous=void 0):D.pop(),x=D.length;x--;){const _=d.slice(D[x],D[x+1]),T=u.pop();p.push([T,T+_.length-1]),t.splice(T,2,_)}for(p.reverse(),x=-1;++x<p.length;)m[N+p[x][0]]=N+p[x][1],N+=p[x][1]-p[x][0]-1;return m}const u4={resolve:h4,tokenize:m4},d4={partial:!0,tokenize:p4};function h4(t){return Uv(t),t}function m4(t,s){let n;return r;function r(d){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),o(d)}function o(d){return d===null?u(d):mt(d)?t.check(d4,c,u)(d):(t.consume(d),o)}function u(d){return t.exit("chunkContent"),t.exit("content"),s(d)}function c(d){return t.consume(d),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,o}}function p4(t,s,n){const r=this;return o;function o(c){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),tn(t,u,"linePrefix")}function u(c){if(c===null||mt(c))return n(c);const d=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):t.interrupt(r.parser.constructs.flow,n,s)(c)}}function qv(t,s,n,r,o,u,c,d,p){const m=p||Number.POSITIVE_INFINITY;let f=0;return g;function g(_){return _===60?(t.enter(r),t.enter(o),t.enter(u),t.consume(_),t.exit(u),x):_===null||_===32||_===41||Yp(_)?n(_):(t.enter(r),t.enter(c),t.enter(d),t.enter("chunkString",{contentType:"string"}),k(_))}function x(_){return _===62?(t.enter(u),t.consume(_),t.exit(u),t.exit(o),t.exit(r),s):(t.enter(d),t.enter("chunkString",{contentType:"string"}),j(_))}function j(_){return _===62?(t.exit("chunkString"),t.exit(d),x(_)):_===null||_===60||mt(_)?n(_):(t.consume(_),_===92?N:j)}function N(_){return _===60||_===62||_===92?(t.consume(_),j):j(_)}function k(_){return!f&&(_===null||_===41||na(_))?(t.exit("chunkString"),t.exit(d),t.exit(c),t.exit(r),s(_)):f<m&&_===40?(t.consume(_),f++,k):_===41?(t.consume(_),f--,k):_===null||_===32||_===40||Yp(_)?n(_):(t.consume(_),_===92?D:k)}function D(_){return _===40||_===41||_===92?(t.consume(_),k):k(_)}}function Hv(t,s,n,r,o,u){const c=this;let d=0,p;return m;function m(j){return t.enter(r),t.enter(o),t.consume(j),t.exit(o),t.enter(u),f}function f(j){return d>999||j===null||j===91||j===93&&!p||j===94&&!d&&"_hiddenFootnoteSupport"in c.parser.constructs?n(j):j===93?(t.exit(u),t.enter(o),t.consume(j),t.exit(o),t.exit(r),s):mt(j)?(t.enter("lineEnding"),t.consume(j),t.exit("lineEnding"),f):(t.enter("chunkString",{contentType:"string"}),g(j))}function g(j){return j===null||j===91||j===93||mt(j)||d++>999?(t.exit("chunkString"),f(j)):(t.consume(j),p||(p=!Lt(j)),j===92?x:g)}function x(j){return j===91||j===92||j===93?(t.consume(j),d++,g):g(j)}}function Vv(t,s,n,r,o,u){let c;return d;function d(x){return x===34||x===39||x===40?(t.enter(r),t.enter(o),t.consume(x),t.exit(o),c=x===40?41:x,p):n(x)}function p(x){return x===c?(t.enter(o),t.consume(x),t.exit(o),t.exit(r),s):(t.enter(u),m(x))}function m(x){return x===c?(t.exit(u),p(c)):x===null?n(x):mt(x)?(t.enter("lineEnding"),t.consume(x),t.exit("lineEnding"),tn(t,m,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),f(x))}function f(x){return x===c||x===null||mt(x)?(t.exit("chunkString"),m(x)):(t.consume(x),x===92?g:f)}function g(x){return x===c||x===92?(t.consume(x),f):f(x)}}function xc(t,s){let n;return r;function r(o){return mt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),n=!0,r):Lt(o)?tn(t,r,n?"linePrefix":"lineSuffix")(o):s(o)}}const f4={name:"definition",tokenize:x4},g4={partial:!0,tokenize:y4};function x4(t,s,n){const r=this;let o;return u;function u(j){return t.enter("definition"),c(j)}function c(j){return Hv.call(r,t,d,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(j)}function d(j){return o=Ol(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),j===58?(t.enter("definitionMarker"),t.consume(j),t.exit("definitionMarker"),p):n(j)}function p(j){return na(j)?xc(t,m)(j):m(j)}function m(j){return qv(t,f,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(j)}function f(j){return t.attempt(g4,g,g)(j)}function g(j){return Lt(j)?tn(t,x,"whitespace")(j):x(j)}function x(j){return j===null||mt(j)?(t.exit("definition"),r.parser.defined.push(o),s(j)):n(j)}}function y4(t,s,n){return r;function r(d){return na(d)?xc(t,o)(d):n(d)}function o(d){return Vv(t,u,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(d)}function u(d){return Lt(d)?tn(t,c,"whitespace")(d):c(d)}function c(d){return d===null||mt(d)?s(d):n(d)}}const b4={name:"hardBreakEscape",tokenize:j4};function j4(t,s,n){return r;function r(u){return t.enter("hardBreakEscape"),t.consume(u),o}function o(u){return mt(u)?(t.exit("hardBreakEscape"),s(u)):n(u)}}const v4={name:"headingAtx",resolve:N4,tokenize:w4};function N4(t,s){let n=t.length-2,r=3,o,u;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(o={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},u={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},ms(t,r,n-r+1,[["enter",o,s],["enter",u,s],["exit",u,s],["exit",o,s]])),t}function w4(t,s,n){let r=0;return o;function o(f){return t.enter("atxHeading"),u(f)}function u(f){return t.enter("atxHeadingSequence"),c(f)}function c(f){return f===35&&r++<6?(t.consume(f),c):f===null||na(f)?(t.exit("atxHeadingSequence"),d(f)):n(f)}function d(f){return f===35?(t.enter("atxHeadingSequence"),p(f)):f===null||mt(f)?(t.exit("atxHeading"),s(f)):Lt(f)?tn(t,d,"whitespace")(f):(t.enter("atxHeadingText"),m(f))}function p(f){return f===35?(t.consume(f),p):(t.exit("atxHeadingSequence"),d(f))}function m(f){return f===null||f===35||na(f)?(t.exit("atxHeadingText"),d(f)):(t.consume(f),m)}}const S4=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],dj=["pre","script","style","textarea"],k4={concrete:!0,name:"htmlFlow",resolveTo:D4,tokenize:E4},C4={partial:!0,tokenize:A4},_4={partial:!0,tokenize:T4};function D4(t){let s=t.length;for(;s--&&!(t[s][0]==="enter"&&t[s][1].type==="htmlFlow"););return s>1&&t[s-2][1].type==="linePrefix"&&(t[s][1].start=t[s-2][1].start,t[s+1][1].start=t[s-2][1].start,t.splice(s-2,2)),t}function E4(t,s,n){const r=this;let o,u,c,d,p;return m;function m(w){return f(w)}function f(w){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(w),g}function g(w){return w===33?(t.consume(w),x):w===47?(t.consume(w),u=!0,k):w===63?(t.consume(w),o=3,r.interrupt?s:S):os(w)?(t.consume(w),c=String.fromCharCode(w),D):n(w)}function x(w){return w===45?(t.consume(w),o=2,j):w===91?(t.consume(w),o=5,d=0,N):os(w)?(t.consume(w),o=4,r.interrupt?s:S):n(w)}function j(w){return w===45?(t.consume(w),r.interrupt?s:S):n(w)}function N(w){const ue="CDATA[";return w===ue.charCodeAt(d++)?(t.consume(w),d===ue.length?r.interrupt?s:P:N):n(w)}function k(w){return os(w)?(t.consume(w),c=String.fromCharCode(w),D):n(w)}function D(w){if(w===null||w===47||w===62||na(w)){const ue=w===47,Ne=c.toLowerCase();return!ue&&!u&&dj.includes(Ne)?(o=1,r.interrupt?s(w):P(w)):S4.includes(c.toLowerCase())?(o=6,ue?(t.consume(w),_):r.interrupt?s(w):P(w)):(o=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(w):u?T(w):E(w))}return w===45||ba(w)?(t.consume(w),c+=String.fromCharCode(w),D):n(w)}function _(w){return w===62?(t.consume(w),r.interrupt?s:P):n(w)}function T(w){return Lt(w)?(t.consume(w),T):C(w)}function E(w){return w===47?(t.consume(w),C):w===58||w===95||os(w)?(t.consume(w),U):Lt(w)?(t.consume(w),E):C(w)}function U(w){return w===45||w===46||w===58||w===95||ba(w)?(t.consume(w),U):X(w)}function X(w){return w===61?(t.consume(w),I):Lt(w)?(t.consume(w),X):E(w)}function I(w){return w===null||w===60||w===61||w===62||w===96?n(w):w===34||w===39?(t.consume(w),p=w,F):Lt(w)?(t.consume(w),I):B(w)}function F(w){return w===p?(t.consume(w),p=null,G):w===null||mt(w)?n(w):(t.consume(w),F)}function B(w){return w===null||w===34||w===39||w===47||w===60||w===61||w===62||w===96||na(w)?X(w):(t.consume(w),B)}function G(w){return w===47||w===62||Lt(w)?E(w):n(w)}function C(w){return w===62?(t.consume(w),A):n(w)}function A(w){return w===null||mt(w)?P(w):Lt(w)?(t.consume(w),A):n(w)}function P(w){return w===45&&o===2?(t.consume(w),L):w===60&&o===1?(t.consume(w),M):w===62&&o===4?(t.consume(w),ge):w===63&&o===3?(t.consume(w),S):w===93&&o===5?(t.consume(w),Q):mt(w)&&(o===6||o===7)?(t.exit("htmlFlowData"),t.check(C4,fe,$)(w)):w===null||mt(w)?(t.exit("htmlFlowData"),$(w)):(t.consume(w),P)}function $(w){return t.check(_4,J,fe)(w)}function J(w){return t.enter("lineEnding"),t.consume(w),t.exit("lineEnding"),R}function R(w){return w===null||mt(w)?$(w):(t.enter("htmlFlowData"),P(w))}function L(w){return w===45?(t.consume(w),S):P(w)}function M(w){return w===47?(t.consume(w),c="",Z):P(w)}function Z(w){if(w===62){const ue=c.toLowerCase();return dj.includes(ue)?(t.consume(w),ge):P(w)}return os(w)&&c.length<8?(t.consume(w),c+=String.fromCharCode(w),Z):P(w)}function Q(w){return w===93?(t.consume(w),S):P(w)}function S(w){return w===62?(t.consume(w),ge):w===45&&o===2?(t.consume(w),S):P(w)}function ge(w){return w===null||mt(w)?(t.exit("htmlFlowData"),fe(w)):(t.consume(w),ge)}function fe(w){return t.exit("htmlFlow"),s(w)}}function T4(t,s,n){const r=this;return o;function o(c){return mt(c)?(t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),u):n(c)}function u(c){return r.parser.lazy[r.now().line]?n(c):s(c)}}function A4(t,s,n){return r;function r(o){return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),t.attempt(Bd,s,n)}}const P4={name:"htmlText",tokenize:I4};function I4(t,s,n){const r=this;let o,u,c;return d;function d(S){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(S),p}function p(S){return S===33?(t.consume(S),m):S===47?(t.consume(S),X):S===63?(t.consume(S),E):os(S)?(t.consume(S),B):n(S)}function m(S){return S===45?(t.consume(S),f):S===91?(t.consume(S),u=0,N):os(S)?(t.consume(S),T):n(S)}function f(S){return S===45?(t.consume(S),j):n(S)}function g(S){return S===null?n(S):S===45?(t.consume(S),x):mt(S)?(c=g,M(S)):(t.consume(S),g)}function x(S){return S===45?(t.consume(S),j):g(S)}function j(S){return S===62?L(S):S===45?x(S):g(S)}function N(S){const ge="CDATA[";return S===ge.charCodeAt(u++)?(t.consume(S),u===ge.length?k:N):n(S)}function k(S){return S===null?n(S):S===93?(t.consume(S),D):mt(S)?(c=k,M(S)):(t.consume(S),k)}function D(S){return S===93?(t.consume(S),_):k(S)}function _(S){return S===62?L(S):S===93?(t.consume(S),_):k(S)}function T(S){return S===null||S===62?L(S):mt(S)?(c=T,M(S)):(t.consume(S),T)}function E(S){return S===null?n(S):S===63?(t.consume(S),U):mt(S)?(c=E,M(S)):(t.consume(S),E)}function U(S){return S===62?L(S):E(S)}function X(S){return os(S)?(t.consume(S),I):n(S)}function I(S){return S===45||ba(S)?(t.consume(S),I):F(S)}function F(S){return mt(S)?(c=F,M(S)):Lt(S)?(t.consume(S),F):L(S)}function B(S){return S===45||ba(S)?(t.consume(S),B):S===47||S===62||na(S)?G(S):n(S)}function G(S){return S===47?(t.consume(S),L):S===58||S===95||os(S)?(t.consume(S),C):mt(S)?(c=G,M(S)):Lt(S)?(t.consume(S),G):L(S)}function C(S){return S===45||S===46||S===58||S===95||ba(S)?(t.consume(S),C):A(S)}function A(S){return S===61?(t.consume(S),P):mt(S)?(c=A,M(S)):Lt(S)?(t.consume(S),A):G(S)}function P(S){return S===null||S===60||S===61||S===62||S===96?n(S):S===34||S===39?(t.consume(S),o=S,$):mt(S)?(c=P,M(S)):Lt(S)?(t.consume(S),P):(t.consume(S),J)}function $(S){return S===o?(t.consume(S),o=void 0,R):S===null?n(S):mt(S)?(c=$,M(S)):(t.consume(S),$)}function J(S){return S===null||S===34||S===39||S===60||S===61||S===96?n(S):S===47||S===62||na(S)?G(S):(t.consume(S),J)}function R(S){return S===47||S===62||na(S)?G(S):n(S)}function L(S){return S===62?(t.consume(S),t.exit("htmlTextData"),t.exit("htmlText"),s):n(S)}function M(S){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(S),t.exit("lineEnding"),Z}function Z(S){return Lt(S)?tn(t,Q,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(S):Q(S)}function Q(S){return t.enter("htmlTextData"),c(S)}}const Ff={name:"labelEnd",resolveAll:L4,resolveTo:$4,tokenize:F4},O4={tokenize:M4},z4={tokenize:B4},R4={tokenize:U4};function L4(t){let s=-1;const n=[];for(;++s<t.length;){const r=t[s][1];if(n.push(t[s]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const o=r.type==="labelImage"?4:2;r.type="data",s+=o}}return t.length!==n.length&&ms(t,0,t.length,n),t}function $4(t,s){let n=t.length,r=0,o,u,c,d;for(;n--;)if(o=t[n][1],u){if(o.type==="link"||o.type==="labelLink"&&o._inactive)break;t[n][0]==="enter"&&o.type==="labelLink"&&(o._inactive=!0)}else if(c){if(t[n][0]==="enter"&&(o.type==="labelImage"||o.type==="labelLink")&&!o._balanced&&(u=n,o.type!=="labelLink")){r=2;break}}else o.type==="labelEnd"&&(c=n);const p={type:t[u][1].type==="labelLink"?"link":"image",start:{...t[u][1].start},end:{...t[t.length-1][1].end}},m={type:"label",start:{...t[u][1].start},end:{...t[c][1].end}},f={type:"labelText",start:{...t[u+r+2][1].end},end:{...t[c-2][1].start}};return d=[["enter",p,s],["enter",m,s]],d=Pa(d,t.slice(u+1,u+r+3)),d=Pa(d,[["enter",f,s]]),d=Pa(d,$f(s.parser.constructs.insideSpan.null,t.slice(u+r+4,c-3),s)),d=Pa(d,[["exit",f,s],t[c-2],t[c-1],["exit",m,s]]),d=Pa(d,t.slice(c+1)),d=Pa(d,[["exit",p,s]]),ms(t,u,t.length,d),t}function F4(t,s,n){const r=this;let o=r.events.length,u,c;for(;o--;)if((r.events[o][1].type==="labelImage"||r.events[o][1].type==="labelLink")&&!r.events[o][1]._balanced){u=r.events[o][1];break}return d;function d(x){return u?u._inactive?g(x):(c=r.parser.defined.includes(Ol(r.sliceSerialize({start:u.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(x),t.exit("labelMarker"),t.exit("labelEnd"),p):n(x)}function p(x){return x===40?t.attempt(O4,f,c?f:g)(x):x===91?t.attempt(z4,f,c?m:g)(x):c?f(x):g(x)}function m(x){return t.attempt(R4,f,g)(x)}function f(x){return s(x)}function g(x){return u._balanced=!0,n(x)}}function M4(t,s,n){return r;function r(g){return t.enter("resource"),t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),o}function o(g){return na(g)?xc(t,u)(g):u(g)}function u(g){return g===41?f(g):qv(t,c,d,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function c(g){return na(g)?xc(t,p)(g):f(g)}function d(g){return n(g)}function p(g){return g===34||g===39||g===40?Vv(t,m,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function m(g){return na(g)?xc(t,f)(g):f(g)}function f(g){return g===41?(t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),t.exit("resource"),s):n(g)}}function B4(t,s,n){const r=this;return o;function o(d){return Hv.call(r,t,u,c,"reference","referenceMarker","referenceString")(d)}function u(d){return r.parser.defined.includes(Ol(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?s(d):n(d)}function c(d){return n(d)}}function U4(t,s,n){return r;function r(u){return t.enter("reference"),t.enter("referenceMarker"),t.consume(u),t.exit("referenceMarker"),o}function o(u){return u===93?(t.enter("referenceMarker"),t.consume(u),t.exit("referenceMarker"),t.exit("reference"),s):n(u)}}const q4={name:"labelStartImage",resolveAll:Ff.resolveAll,tokenize:H4};function H4(t,s,n){const r=this;return o;function o(d){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(d),t.exit("labelImageMarker"),u}function u(d){return d===91?(t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelImage"),c):n(d)}function c(d){return d===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(d):s(d)}}const V4={name:"labelStartLink",resolveAll:Ff.resolveAll,tokenize:G4};function G4(t,s,n){const r=this;return o;function o(c){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(c),t.exit("labelMarker"),t.exit("labelLink"),u}function u(c){return c===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(c):s(c)}}const dp={name:"lineEnding",tokenize:Q4};function Q4(t,s){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),tn(t,s,"linePrefix")}}const xd={name:"thematicBreak",tokenize:Y4};function Y4(t,s,n){let r=0,o;return u;function u(m){return t.enter("thematicBreak"),c(m)}function c(m){return o=m,d(m)}function d(m){return m===o?(t.enter("thematicBreakSequence"),p(m)):r>=3&&(m===null||mt(m))?(t.exit("thematicBreak"),s(m)):n(m)}function p(m){return m===o?(t.consume(m),r++,p):(t.exit("thematicBreakSequence"),Lt(m)?tn(t,d,"whitespace")(m):d(m))}}const ta={continuation:{tokenize:W4},exit:e3,name:"list",tokenize:K4},J4={partial:!0,tokenize:t3},X4={partial:!0,tokenize:Z4};function K4(t,s,n){const r=this,o=r.events[r.events.length-1];let u=o&&o[1].type==="linePrefix"?o[2].sliceSerialize(o[1],!0).length:0,c=0;return d;function d(j){const N=r.containerState.type||(j===42||j===43||j===45?"listUnordered":"listOrdered");if(N==="listUnordered"?!r.containerState.marker||j===r.containerState.marker:Jp(j)){if(r.containerState.type||(r.containerState.type=N,t.enter(N,{_container:!0})),N==="listUnordered")return t.enter("listItemPrefix"),j===42||j===45?t.check(xd,n,m)(j):m(j);if(!r.interrupt||j===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),p(j)}return n(j)}function p(j){return Jp(j)&&++c<10?(t.consume(j),p):(!r.interrupt||c<2)&&(r.containerState.marker?j===r.containerState.marker:j===41||j===46)?(t.exit("listItemValue"),m(j)):n(j)}function m(j){return t.enter("listItemMarker"),t.consume(j),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||j,t.check(Bd,r.interrupt?n:f,t.attempt(J4,x,g))}function f(j){return r.containerState.initialBlankLine=!0,u++,x(j)}function g(j){return Lt(j)?(t.enter("listItemPrefixWhitespace"),t.consume(j),t.exit("listItemPrefixWhitespace"),x):n(j)}function x(j){return r.containerState.size=u+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,s(j)}}function W4(t,s,n){const r=this;return r.containerState._closeFlow=void 0,t.check(Bd,o,u);function o(d){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,tn(t,s,"listItemIndent",r.containerState.size+1)(d)}function u(d){return r.containerState.furtherBlankLines||!Lt(d)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,c(d)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(X4,s,c)(d))}function c(d){return r.containerState._closeFlow=!0,r.interrupt=void 0,tn(t,t.attempt(ta,s,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(d)}}function Z4(t,s,n){const r=this;return tn(t,o,"listItemIndent",r.containerState.size+1);function o(u){const c=r.events[r.events.length-1];return c&&c[1].type==="listItemIndent"&&c[2].sliceSerialize(c[1],!0).length===r.containerState.size?s(u):n(u)}}function e3(t){t.exit(this.containerState.type)}function t3(t,s,n){const r=this;return tn(t,o,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function o(u){const c=r.events[r.events.length-1];return!Lt(u)&&c&&c[1].type==="listItemPrefixWhitespace"?s(u):n(u)}}const hj={name:"setextUnderline",resolveTo:n3,tokenize:a3};function n3(t,s){let n=t.length,r,o,u;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(o=n)}else t[n][1].type==="content"&&t.splice(n,1),!u&&t[n][1].type==="definition"&&(u=n);const c={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[o][1].type="setextHeadingText",u?(t.splice(o,0,["enter",c,s]),t.splice(u+1,0,["exit",t[r][1],s]),t[r][1].end={...t[u][1].end}):t[r][1]=c,t.push(["exit",c,s]),t}function a3(t,s,n){const r=this;let o;return u;function u(m){let f=r.events.length,g;for(;f--;)if(r.events[f][1].type!=="lineEnding"&&r.events[f][1].type!=="linePrefix"&&r.events[f][1].type!=="content"){g=r.events[f][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||g)?(t.enter("setextHeadingLine"),o=m,c(m)):n(m)}function c(m){return t.enter("setextHeadingLineSequence"),d(m)}function d(m){return m===o?(t.consume(m),d):(t.exit("setextHeadingLineSequence"),Lt(m)?tn(t,p,"lineSuffix")(m):p(m))}function p(m){return m===null||mt(m)?(t.exit("setextHeadingLine"),s(m)):n(m)}}const s3={tokenize:i3};function i3(t){const s=this,n=t.attempt(Bd,r,t.attempt(this.parser.constructs.flowInitial,o,tn(t,t.attempt(this.parser.constructs.flow,o,t.attempt(u4,o)),"linePrefix")));return n;function r(u){if(u===null){t.consume(u);return}return t.enter("lineEndingBlank"),t.consume(u),t.exit("lineEndingBlank"),s.currentConstruct=void 0,n}function o(u){if(u===null){t.consume(u);return}return t.enter("lineEnding"),t.consume(u),t.exit("lineEnding"),s.currentConstruct=void 0,n}}const r3={resolveAll:Qv()},l3=Gv("string"),o3=Gv("text");function Gv(t){return{resolveAll:Qv(t==="text"?c3:void 0),tokenize:s};function s(n){const r=this,o=this.parser.constructs[t],u=n.attempt(o,c,d);return c;function c(f){return m(f)?u(f):d(f)}function d(f){if(f===null){n.consume(f);return}return n.enter("data"),n.consume(f),p}function p(f){return m(f)?(n.exit("data"),u(f)):(n.consume(f),p)}function m(f){if(f===null)return!0;const g=o[f];let x=-1;if(g)for(;++x<g.length;){const j=g[x];if(!j.previous||j.previous.call(r,r.previous))return!0}return!1}}}function Qv(t){return s;function s(n,r){let o=-1,u;for(;++o<=n.length;)u===void 0?n[o]&&n[o][1].type==="data"&&(u=o,o++):(!n[o]||n[o][1].type!=="data")&&(o!==u+2&&(n[u][1].end=n[o-1][1].end,n.splice(u+2,o-u-2),o=u+2),u=void 0);return t?t(n,r):n}}function c3(t,s){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],o=s.sliceStream(r);let u=o.length,c=-1,d=0,p;for(;u--;){const m=o[u];if(typeof m=="string"){for(c=m.length;m.charCodeAt(c-1)===32;)d++,c--;if(c)break;c=-1}else if(m===-2)p=!0,d++;else if(m!==-1){u++;break}}if(s._contentTypeTextTrailing&&n===t.length&&(d=0),d){const m={type:n===t.length||p||d<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:u?c:r.start._bufferIndex+c,_index:r.start._index+u,line:r.end.line,column:r.end.column-d,offset:r.end.offset-d},end:{...r.end}};r.end={...m.start},r.start.offset===r.end.offset?Object.assign(r,m):(t.splice(n,0,["enter",m,s],["exit",m,s]),n+=2)}n++}return t}const u3={42:ta,43:ta,45:ta,48:ta,49:ta,50:ta,51:ta,52:ta,53:ta,54:ta,55:ta,56:ta,57:ta,62:Fv},d3={91:f4},h3={[-2]:up,[-1]:up,32:up},m3={35:v4,42:xd,45:[hj,xd],60:k4,61:hj,95:xd,96:uj,126:uj},p3={38:Bv,92:Mv},f3={[-5]:dp,[-4]:dp,[-3]:dp,33:q4,38:Bv,42:Xp,60:[VP,P4],91:V4,92:[b4,Mv],93:Ff,95:Xp,96:s4},g3={null:[Xp,r3]},x3={null:[42,95]},y3={null:[]},b3=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:x3,contentInitial:d3,disable:y3,document:u3,flow:m3,flowInitial:h3,insideSpan:g3,string:p3,text:f3},Symbol.toStringTag,{value:"Module"}));function j3(t,s,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const o={},u=[];let c=[],d=[];const p={attempt:F(X),check:F(I),consume:T,enter:E,exit:U,interrupt:F(I,{interrupt:!0})},m={code:null,containerState:{},defineSkip:k,events:[],now:N,parser:t,previous:null,sliceSerialize:x,sliceStream:j,write:g};let f=s.tokenize.call(m,p);return s.resolveAll&&u.push(s),m;function g(A){return c=Pa(c,A),D(),c[c.length-1]!==null?[]:(B(s,0),m.events=$f(u,m.events,m),m.events)}function x(A,P){return N3(j(A),P)}function j(A){return v3(c,A)}function N(){const{_bufferIndex:A,_index:P,line:$,column:J,offset:R}=r;return{_bufferIndex:A,_index:P,line:$,column:J,offset:R}}function k(A){o[A.line]=A.column,C()}function D(){let A;for(;r._index<c.length;){const P=c[r._index];if(typeof P=="string")for(A=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===A&&r._bufferIndex<P.length;)_(P.charCodeAt(r._bufferIndex));else _(P)}}function _(A){f=f(A)}function T(A){mt(A)?(r.line++,r.column=1,r.offset+=A===-3?2:1,C()):A!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===c[r._index].length&&(r._bufferIndex=-1,r._index++)),m.previous=A}function E(A,P){const $=P||{};return $.type=A,$.start=N(),m.events.push(["enter",$,m]),d.push($),$}function U(A){const P=d.pop();return P.end=N(),m.events.push(["exit",P,m]),P}function X(A,P){B(A,P.from)}function I(A,P){P.restore()}function F(A,P){return $;function $(J,R,L){let M,Z,Q,S;return Array.isArray(J)?fe(J):"tokenize"in J?fe([J]):ge(J);function ge(K){return Y;function Y(V){const oe=V!==null&&K[V],Pe=V!==null&&K.null,se=[...Array.isArray(oe)?oe:oe?[oe]:[],...Array.isArray(Pe)?Pe:Pe?[Pe]:[]];return fe(se)(V)}}function fe(K){return M=K,Z=0,K.length===0?L:w(K[Z])}function w(K){return Y;function Y(V){return S=G(),Q=K,K.partial||(m.currentConstruct=K),K.name&&m.parser.constructs.disable.null.includes(K.name)?Ne():K.tokenize.call(P?Object.assign(Object.create(m),P):m,p,ue,Ne)(V)}}function ue(K){return A(Q,S),R}function Ne(K){return S.restore(),++Z<M.length?w(M[Z]):L}}}function B(A,P){A.resolveAll&&!u.includes(A)&&u.push(A),A.resolve&&ms(m.events,P,m.events.length-P,A.resolve(m.events.slice(P),m)),A.resolveTo&&(m.events=A.resolveTo(m.events,m))}function G(){const A=N(),P=m.previous,$=m.currentConstruct,J=m.events.length,R=Array.from(d);return{from:J,restore:L};function L(){r=A,m.previous=P,m.currentConstruct=$,m.events.length=J,d=R,C()}}function C(){r.line in o&&r.column<2&&(r.column=o[r.line],r.offset+=o[r.line]-1)}}function v3(t,s){const n=s.start._index,r=s.start._bufferIndex,o=s.end._index,u=s.end._bufferIndex;let c;if(n===o)c=[t[n].slice(r,u)];else{if(c=t.slice(n,o),r>-1){const d=c[0];typeof d=="string"?c[0]=d.slice(r):c.shift()}u>0&&c.push(t[o].slice(0,u))}return c}function N3(t,s){let n=-1;const r=[];let o;for(;++n<t.length;){const u=t[n];let c;if(typeof u=="string")c=u;else switch(u){case-5:{c="\r";break}case-4:{c=`
`;break}case-3:{c=`\r
`;break}case-2:{c=s?" ":"	";break}case-1:{if(!s&&o)continue;c=" ";break}default:c=String.fromCharCode(u)}o=u===-2,r.push(c)}return r.join("")}function w3(t){const r={constructs:TP([b3,...(t||{}).extensions||[]]),content:o($P),defined:[],document:o(MP),flow:o(s3),lazy:{},string:o(l3),text:o(o3)};return r;function o(u){return c;function c(d){return j3(r,u,d)}}}function S3(t){for(;!Uv(t););return t}const mj=/[\0\t\n\r]/g;function k3(){let t=1,s="",n=!0,r;return o;function o(u,c,d){const p=[];let m,f,g,x,j;for(u=s+(typeof u=="string"?u.toString():new TextDecoder(c||void 0).decode(u)),g=0,s="",n&&(u.charCodeAt(0)===65279&&g++,n=void 0);g<u.length;){if(mj.lastIndex=g,m=mj.exec(u),x=m&&m.index!==void 0?m.index:u.length,j=u.charCodeAt(x),!m){s=u.slice(g);break}if(j===10&&g===x&&r)p.push(-3),r=void 0;else switch(r&&(p.push(-5),r=void 0),g<x&&(p.push(u.slice(g,x)),t+=x-g),j){case 0:{p.push(65533),t++;break}case 9:{for(f=Math.ceil(t/4)*4,p.push(-2);t++<f;)p.push(-1);break}case 10:{p.push(-4),t=1;break}default:r=!0,t=1}g=x+1}return d&&(r&&p.push(-5),s&&p.push(s),p.push(null)),p}}const C3=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Yv(t){return t.replace(C3,_3)}function _3(t,s,n){if(s)return s;if(n.charCodeAt(0)===35){const o=n.charCodeAt(1),u=o===120||o===88;return $v(n.slice(u?2:1),u?16:10)}return Lf(n)||t}function yc(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?pj(t.position):"start"in t||"end"in t?pj(t):"line"in t||"column"in t?Kp(t):""}function Kp(t){return fj(t&&t.line)+":"+fj(t&&t.column)}function pj(t){return Kp(t&&t.start)+"-"+Kp(t&&t.end)}function fj(t){return t&&typeof t=="number"?t:1}const Jv={}.hasOwnProperty;function D3(t,s,n){return typeof s!="string"&&(n=s,s=void 0),E3(n)(S3(w3(n).document().write(k3()(t,s,!0))))}function E3(t){const s={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:u(qe),autolinkProtocol:G,autolinkEmail:G,atxHeading:u(Ie),blockQuote:u(Pe),characterEscape:G,characterReference:G,codeFenced:u(se),codeFencedFenceInfo:c,codeFencedFenceMeta:c,codeIndented:u(se,c),codeText:u(Ce,c),codeTextData:G,data:G,codeFlowValue:G,definition:u(ee),definitionDestinationString:c,definitionLabelString:c,definitionTitleString:c,emphasis:u(je),hardBreakEscape:u($e),hardBreakTrailing:u($e),htmlFlow:u(Fe,c),htmlFlowData:G,htmlText:u(Fe,c),htmlTextData:G,image:u(Be),label:c,link:u(qe),listItem:u(ye),listItemValue:x,listOrdered:u(et,g),listUnordered:u(et),paragraph:u(Oe),reference:w,referenceString:c,resourceDestinationString:c,resourceTitleString:c,setextHeading:u(Ie),strong:u(xe),thematicBreak:u(W)},exit:{atxHeading:p(),atxHeadingSequence:X,autolink:p(),autolinkEmail:oe,autolinkProtocol:V,blockQuote:p(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:Ne,characterReferenceMarkerNumeric:Ne,characterReferenceValue:K,characterReference:Y,codeFenced:p(D),codeFencedFence:k,codeFencedFenceInfo:j,codeFencedFenceMeta:N,codeFlowValue:C,codeIndented:p(_),codeText:p(R),codeTextData:C,data:C,definition:p(),definitionDestinationString:U,definitionLabelString:T,definitionTitleString:E,emphasis:p(),hardBreakEscape:p(P),hardBreakTrailing:p(P),htmlFlow:p($),htmlFlowData:C,htmlText:p(J),htmlTextData:C,image:p(M),label:Q,labelText:Z,lineEnding:A,link:p(L),listItem:p(),listOrdered:p(),listUnordered:p(),paragraph:p(),referenceString:ue,resourceDestinationString:S,resourceTitleString:ge,resource:fe,setextHeading:p(B),setextHeadingLineSequence:F,setextHeadingText:I,strong:p(),thematicBreak:p()}};Xv(s,(t||{}).mdastExtensions||[]);const n={};return r;function r(O){let te={type:"root",children:[]};const re={stack:[te],tokenStack:[],config:s,enter:d,exit:m,buffer:c,resume:f,data:n},ke=[];let Ue=-1;for(;++Ue<O.length;)if(O[Ue][1].type==="listOrdered"||O[Ue][1].type==="listUnordered")if(O[Ue][0]==="enter")ke.push(Ue);else{const Qe=ke.pop();Ue=o(O,Qe,Ue)}for(Ue=-1;++Ue<O.length;){const Qe=s[O[Ue][0]];Jv.call(Qe,O[Ue][1].type)&&Qe[O[Ue][1].type].call(Object.assign({sliceSerialize:O[Ue][2].sliceSerialize},re),O[Ue][1])}if(re.tokenStack.length>0){const Qe=re.tokenStack[re.tokenStack.length-1];(Qe[1]||gj).call(re,void 0,Qe[0])}for(te.position={start:Oi(O.length>0?O[0][1].start:{line:1,column:1,offset:0}),end:Oi(O.length>0?O[O.length-2][1].end:{line:1,column:1,offset:0})},Ue=-1;++Ue<s.transforms.length;)te=s.transforms[Ue](te)||te;return te}function o(O,te,re){let ke=te-1,Ue=-1,Qe=!1,Ze,lt,le,pe;for(;++ke<=re;){const de=O[ke];switch(de[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{de[0]==="enter"?Ue++:Ue--,pe=void 0;break}case"lineEndingBlank":{de[0]==="enter"&&(Ze&&!pe&&!Ue&&!le&&(le=ke),pe=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:pe=void 0}if(!Ue&&de[0]==="enter"&&de[1].type==="listItemPrefix"||Ue===-1&&de[0]==="exit"&&(de[1].type==="listUnordered"||de[1].type==="listOrdered")){if(Ze){let we=ke;for(lt=void 0;we--;){const Ae=O[we];if(Ae[1].type==="lineEnding"||Ae[1].type==="lineEndingBlank"){if(Ae[0]==="exit")continue;lt&&(O[lt][1].type="lineEndingBlank",Qe=!0),Ae[1].type="lineEnding",lt=we}else if(!(Ae[1].type==="linePrefix"||Ae[1].type==="blockQuotePrefix"||Ae[1].type==="blockQuotePrefixWhitespace"||Ae[1].type==="blockQuoteMarker"||Ae[1].type==="listItemIndent"))break}le&&(!lt||le<lt)&&(Ze._spread=!0),Ze.end=Object.assign({},lt?O[lt][1].start:de[1].end),O.splice(lt||ke,0,["exit",Ze,de[2]]),ke++,re++}if(de[1].type==="listItemPrefix"){const we={type:"listItem",_spread:!1,start:Object.assign({},de[1].start),end:void 0};Ze=we,O.splice(ke,0,["enter",we,de[2]]),ke++,re++,le=void 0,pe=!0}}}return O[te][1]._spread=Qe,re}function u(O,te){return re;function re(ke){d.call(this,O(ke),ke),te&&te.call(this,ke)}}function c(){this.stack.push({type:"fragment",children:[]})}function d(O,te,re){this.stack[this.stack.length-1].children.push(O),this.stack.push(O),this.tokenStack.push([te,re||void 0]),O.position={start:Oi(te.start),end:void 0}}function p(O){return te;function te(re){O&&O.call(this,re),m.call(this,re)}}function m(O,te){const re=this.stack.pop(),ke=this.tokenStack.pop();if(ke)ke[0].type!==O.type&&(te?te.call(this,O,ke[0]):(ke[1]||gj).call(this,O,ke[0]));else throw new Error("Cannot close `"+O.type+"` ("+yc({start:O.start,end:O.end})+"): its not open");re.position.end=Oi(O.end)}function f(){return Rf(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function x(O){if(this.data.expectingFirstListItemValue){const te=this.stack[this.stack.length-2];te.start=Number.parseInt(this.sliceSerialize(O),10),this.data.expectingFirstListItemValue=void 0}}function j(){const O=this.resume(),te=this.stack[this.stack.length-1];te.lang=O}function N(){const O=this.resume(),te=this.stack[this.stack.length-1];te.meta=O}function k(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function D(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O.replace(/(\r?\n|\r)$/g,"")}function T(O){const te=this.resume(),re=this.stack[this.stack.length-1];re.label=te,re.identifier=Ol(this.sliceSerialize(O)).toLowerCase()}function E(){const O=this.resume(),te=this.stack[this.stack.length-1];te.title=O}function U(){const O=this.resume(),te=this.stack[this.stack.length-1];te.url=O}function X(O){const te=this.stack[this.stack.length-1];if(!te.depth){const re=this.sliceSerialize(O).length;te.depth=re}}function I(){this.data.setextHeadingSlurpLineEnding=!0}function F(O){const te=this.stack[this.stack.length-1];te.depth=this.sliceSerialize(O).codePointAt(0)===61?1:2}function B(){this.data.setextHeadingSlurpLineEnding=void 0}function G(O){const re=this.stack[this.stack.length-1].children;let ke=re[re.length-1];(!ke||ke.type!=="text")&&(ke=he(),ke.position={start:Oi(O.start),end:void 0},re.push(ke)),this.stack.push(ke)}function C(O){const te=this.stack.pop();te.value+=this.sliceSerialize(O),te.position.end=Oi(O.end)}function A(O){const te=this.stack[this.stack.length-1];if(this.data.atHardBreak){const re=te.children[te.children.length-1];re.position.end=Oi(O.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&s.canContainEols.includes(te.type)&&(G.call(this,O),C.call(this,O))}function P(){this.data.atHardBreak=!0}function $(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function J(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function R(){const O=this.resume(),te=this.stack[this.stack.length-1];te.value=O}function L(){const O=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";O.type+="Reference",O.referenceType=te,delete O.url,delete O.title}else delete O.identifier,delete O.label;this.data.referenceType=void 0}function M(){const O=this.stack[this.stack.length-1];if(this.data.inReference){const te=this.data.referenceType||"shortcut";O.type+="Reference",O.referenceType=te,delete O.url,delete O.title}else delete O.identifier,delete O.label;this.data.referenceType=void 0}function Z(O){const te=this.sliceSerialize(O),re=this.stack[this.stack.length-2];re.label=Yv(te),re.identifier=Ol(te).toLowerCase()}function Q(){const O=this.stack[this.stack.length-1],te=this.resume(),re=this.stack[this.stack.length-1];if(this.data.inReference=!0,re.type==="link"){const ke=O.children;re.children=ke}else re.alt=te}function S(){const O=this.resume(),te=this.stack[this.stack.length-1];te.url=O}function ge(){const O=this.resume(),te=this.stack[this.stack.length-1];te.title=O}function fe(){this.data.inReference=void 0}function w(){this.data.referenceType="collapsed"}function ue(O){const te=this.resume(),re=this.stack[this.stack.length-1];re.label=te,re.identifier=Ol(this.sliceSerialize(O)).toLowerCase(),this.data.referenceType="full"}function Ne(O){this.data.characterReferenceType=O.type}function K(O){const te=this.sliceSerialize(O),re=this.data.characterReferenceType;let ke;re?(ke=$v(te,re==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ke=Lf(te);const Ue=this.stack[this.stack.length-1];Ue.value+=ke}function Y(O){const te=this.stack.pop();te.position.end=Oi(O.end)}function V(O){C.call(this,O);const te=this.stack[this.stack.length-1];te.url=this.sliceSerialize(O)}function oe(O){C.call(this,O);const te=this.stack[this.stack.length-1];te.url="mailto:"+this.sliceSerialize(O)}function Pe(){return{type:"blockquote",children:[]}}function se(){return{type:"code",lang:null,meta:null,value:""}}function Ce(){return{type:"inlineCode",value:""}}function ee(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function je(){return{type:"emphasis",children:[]}}function Ie(){return{type:"heading",depth:0,children:[]}}function $e(){return{type:"break"}}function Fe(){return{type:"html",value:""}}function Be(){return{type:"image",title:null,url:"",alt:null}}function qe(){return{type:"link",title:null,url:"",children:[]}}function et(O){return{type:"list",ordered:O.type==="listOrdered",start:null,spread:O._spread,children:[]}}function ye(O){return{type:"listItem",spread:O._spread,checked:null,children:[]}}function Oe(){return{type:"paragraph",children:[]}}function xe(){return{type:"strong",children:[]}}function he(){return{type:"text",value:""}}function W(){return{type:"thematicBreak"}}}function Oi(t){return{line:t.line,column:t.column,offset:t.offset}}function Xv(t,s){let n=-1;for(;++n<s.length;){const r=s[n];Array.isArray(r)?Xv(t,r):T3(t,r)}}function T3(t,s){let n;for(n in s)if(Jv.call(s,n))switch(n){case"canContainEols":{const r=s[n];r&&t[n].push(...r);break}case"transforms":{const r=s[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=s[n];r&&Object.assign(t[n],r);break}}}function gj(t,s){throw t?new Error("Cannot close `"+t.type+"` ("+yc({start:t.start,end:t.end})+"): a different token (`"+s.type+"`, "+yc({start:s.start,end:s.end})+") is open"):new Error("Cannot close document, a token (`"+s.type+"`, "+yc({start:s.start,end:s.end})+") is still open")}function A3(t){const s=this;s.parser=n;function n(r){return D3(r,{...s.data("settings"),...t,extensions:s.data("micromarkExtensions")||[],mdastExtensions:s.data("fromMarkdownExtensions")||[]})}}const xj={}.hasOwnProperty;function Kv(t,s){const n=s||{};function r(o,...u){let c=r.invalid;const d=r.handlers;if(o&&xj.call(o,t)){const p=String(o[t]);c=xj.call(d,p)?d[p]:r.unknown}if(c)return c.call(this,o,...u)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}const P3={}.hasOwnProperty;function Wv(t,s){let n=-1,r;if(s.extensions)for(;++n<s.extensions.length;)Wv(t,s.extensions[n]);for(r in s)if(P3.call(s,r))switch(r){case"extensions":break;case"unsafe":{yj(t[r],s[r]);break}case"join":{yj(t[r],s[r]);break}case"handlers":{I3(t[r],s[r]);break}default:t.options[r]=s[r]}return t}function yj(t,s){s&&t.push(...s)}function I3(t,s){s&&Object.assign(t,s)}function O3(t,s,n,r){const o=n.enter("blockquote"),u=n.createTracker(r);u.move("> "),u.shift(2);const c=n.indentLines(n.containerFlow(t,u.current()),z3);return o(),c}function z3(t,s,n){return">"+(n?"":" ")+t}function Zv(t,s){return bj(t,s.inConstruct,!0)&&!bj(t,s.notInConstruct,!1)}function bj(t,s,n){if(typeof s=="string"&&(s=[s]),!s||s.length===0)return n;let r=-1;for(;++r<s.length;)if(t.includes(s[r]))return!0;return!1}function jj(t,s,n,r){let o=-1;for(;++o<n.unsafe.length;)if(n.unsafe[o].character===`
`&&Zv(n.stack,n.unsafe[o]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function R3(t,s){const n=String(t);let r=n.indexOf(s),o=r,u=0,c=0;if(typeof s!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===o?++u>c&&(c=u):u=1,o=r+s.length,r=n.indexOf(s,o);return c}function Wp(t,s){return!!(s.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function L3(t){const s=t.options.fence||"`";if(s!=="`"&&s!=="~")throw new Error("Cannot serialize code with `"+s+"` for `options.fence`, expected `` ` `` or `~`");return s}function $3(t,s,n,r){const o=L3(n),u=t.value||"",c=o==="`"?"GraveAccent":"Tilde";if(Wp(t,n)){const g=n.enter("codeIndented"),x=n.indentLines(u,F3);return g(),x}const d=n.createTracker(r),p=o.repeat(Math.max(R3(u,o)+1,3)),m=n.enter("codeFenced");let f=d.move(p);if(t.lang){const g=n.enter(`codeFencedLang${c}`);f+=d.move(n.safe(t.lang,{before:f,after:" ",encode:["`"],...d.current()})),g()}if(t.lang&&t.meta){const g=n.enter(`codeFencedMeta${c}`);f+=d.move(" "),f+=d.move(n.safe(t.meta,{before:f,after:`
`,encode:["`"],...d.current()})),g()}return f+=d.move(`
`),u&&(f+=d.move(u+`
`)),f+=d.move(p),m(),f}function F3(t,s,n){return(n?"":"    ")+t}function Mf(t){const s=t.options.quote||'"';if(s!=='"'&&s!=="'")throw new Error("Cannot serialize title with `"+s+"` for `options.quote`, expected `\"`, or `'`");return s}function M3(t,s,n,r){const o=Mf(n),u=o==='"'?"Quote":"Apostrophe",c=n.enter("definition");let d=n.enter("label");const p=n.createTracker(r);let m=p.move("[");return m+=p.move(n.safe(n.associationId(t),{before:m,after:"]",...p.current()})),m+=p.move("]: "),d(),!t.url||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=p.move("<"),m+=p.move(n.safe(t.url,{before:m,after:">",...p.current()})),m+=p.move(">")):(d=n.enter("destinationRaw"),m+=p.move(n.safe(t.url,{before:m,after:t.title?" ":`
`,...p.current()}))),d(),t.title&&(d=n.enter(`title${u}`),m+=p.move(" "+o),m+=p.move(n.safe(t.title,{before:m,after:o,...p.current()})),m+=p.move(o),d()),c(),m}function B3(t){const s=t.options.emphasis||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize emphasis with `"+s+"` for `options.emphasis`, expected `*`, or `_`");return s}function $i(t){return"&#x"+t.toString(16).toUpperCase()+";"}function _d(t,s,n){const r=Cd(t),o=Cd(s);return r===void 0?o===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:o===void 0?{inside:!1,outside:!1}:o===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}e1.peek=U3;function e1(t,s,n,r){const o=B3(n),u=n.enter("emphasis"),c=n.createTracker(r),d=c.move(o);let p=c.move(n.containerPhrasing(t,{after:o,before:d,...c.current()}));const m=p.charCodeAt(0),f=_d(r.before.charCodeAt(r.before.length-1),m,o);f.inside&&(p=$i(m)+p.slice(1));const g=p.charCodeAt(p.length-1),x=_d(r.after.charCodeAt(0),g,o);x.inside&&(p=p.slice(0,-1)+$i(g));const j=c.move(o);return u(),n.attentionEncodeSurroundingInfo={after:x.outside,before:f.outside},d+p+j}function U3(t,s,n){return n.options.emphasis||"*"}const Bf=function(t){if(t==null)return G3;if(typeof t=="function")return Ud(t);if(typeof t=="object")return Array.isArray(t)?q3(t):H3(t);if(typeof t=="string")return V3(t);throw new Error("Expected function, string, or object as test")};function q3(t){const s=[];let n=-1;for(;++n<t.length;)s[n]=Bf(t[n]);return Ud(r);function r(...o){let u=-1;for(;++u<s.length;)if(s[u].apply(this,o))return!0;return!1}}function H3(t){const s=t;return Ud(n);function n(r){const o=r;let u;for(u in t)if(o[u]!==s[u])return!1;return!0}}function V3(t){return Ud(s);function s(n){return n&&n.type===t}}function Ud(t){return s;function s(n,r,o){return!!(Q3(n)&&t.call(this,n,typeof r=="number"?r:void 0,o||void 0))}}function G3(){return!0}function Q3(t){return t!==null&&typeof t=="object"&&"type"in t}const t1=[],Y3=!0,Zp=!1,J3="skip";function X3(t,s,n,r){let o;typeof s=="function"&&typeof n!="function"?(r=n,n=s):o=s;const u=Bf(o),c=r?-1:1;d(t,void 0,[])();function d(p,m,f){const g=p&&typeof p=="object"?p:{};if(typeof g.type=="string"){const j=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(x,"name",{value:"node ("+(p.type+(j?"<"+j+">":""))+")"})}return x;function x(){let j=t1,N,k,D;if((!s||u(p,m,f[f.length-1]||void 0))&&(j=K3(n(p,f)),j[0]===Zp))return j;if("children"in p&&p.children){const _=p;if(_.children&&j[0]!==J3)for(k=(r?_.children.length:-1)+c,D=f.concat(_);k>-1&&k<_.children.length;){const T=_.children[k];if(N=d(T,k,D)(),N[0]===Zp)return N;k=typeof N[1]=="number"?N[1]:k+c}}return j}}}function K3(t){return Array.isArray(t)?t:typeof t=="number"?[Y3,t]:t==null?t1:[t]}function n1(t,s,n,r){let o,u,c;typeof s=="function"?(u=void 0,c=s,o=n):(u=s,c=n,o=r),X3(t,u,d,o);function d(p,m){const f=m[m.length-1],g=f?f.children.indexOf(p):void 0;return c(p,g,f)}}function a1(t,s){let n=!1;return n1(t,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,Zp}),!!((!t.depth||t.depth<3)&&Rf(t)&&(s.options.setext||n))}function W3(t,s,n,r){const o=Math.max(Math.min(6,t.depth||1),1),u=n.createTracker(r);if(a1(t,n)){const f=n.enter("headingSetext"),g=n.enter("phrasing"),x=n.containerPhrasing(t,{...u.current(),before:`
`,after:`
`});return g(),f(),x+`
`+(o===1?"=":"-").repeat(x.length-(Math.max(x.lastIndexOf("\r"),x.lastIndexOf(`
`))+1))}const c="#".repeat(o),d=n.enter("headingAtx"),p=n.enter("phrasing");u.move(c+" ");let m=n.containerPhrasing(t,{before:"# ",after:`
`,...u.current()});return/^[\t ]/.test(m)&&(m=$i(m.charCodeAt(0))+m.slice(1)),m=m?c+" "+m:c,n.options.closeAtx&&(m+=" "+c),p(),d(),m}s1.peek=Z3;function s1(t){return t.value||""}function Z3(){return"<"}i1.peek=eI;function i1(t,s,n,r){const o=Mf(n),u=o==='"'?"Quote":"Apostrophe",c=n.enter("image");let d=n.enter("label");const p=n.createTracker(r);let m=p.move("![");return m+=p.move(n.safe(t.alt,{before:m,after:"]",...p.current()})),m+=p.move("]("),d(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=p.move("<"),m+=p.move(n.safe(t.url,{before:m,after:">",...p.current()})),m+=p.move(">")):(d=n.enter("destinationRaw"),m+=p.move(n.safe(t.url,{before:m,after:t.title?" ":")",...p.current()}))),d(),t.title&&(d=n.enter(`title${u}`),m+=p.move(" "+o),m+=p.move(n.safe(t.title,{before:m,after:o,...p.current()})),m+=p.move(o),d()),m+=p.move(")"),c(),m}function eI(){return"!"}r1.peek=tI;function r1(t,s,n,r){const o=t.referenceType,u=n.enter("imageReference");let c=n.enter("label");const d=n.createTracker(r);let p=d.move("![");const m=n.safe(t.alt,{before:p,after:"]",...d.current()});p+=d.move(m+"]["),c();const f=n.stack;n.stack=[],c=n.enter("reference");const g=n.safe(n.associationId(t),{before:p,after:"]",...d.current()});return c(),n.stack=f,u(),o==="full"||!m||m!==g?p+=d.move(g+"]"):o==="shortcut"?p=p.slice(0,-1):p+=d.move("]"),p}function tI(){return"!"}l1.peek=nI;function l1(t,s,n){let r=t.value||"",o="`",u=-1;for(;new RegExp("(^|[^`])"+o+"([^`]|$)").test(r);)o+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++u<n.unsafe.length;){const c=n.unsafe[u],d=n.compilePattern(c);let p;if(c.atBreak)for(;p=d.exec(r);){let m=p.index;r.charCodeAt(m)===10&&r.charCodeAt(m-1)===13&&m--,r=r.slice(0,m)+" "+r.slice(p.index+1)}}return o+r+o}function nI(){return"`"}function o1(t,s){const n=Rf(t);return!!(!s.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}c1.peek=aI;function c1(t,s,n,r){const o=Mf(n),u=o==='"'?"Quote":"Apostrophe",c=n.createTracker(r);let d,p;if(o1(t,n)){const f=n.stack;n.stack=[],d=n.enter("autolink");let g=c.move("<");return g+=c.move(n.containerPhrasing(t,{before:g,after:">",...c.current()})),g+=c.move(">"),d(),n.stack=f,g}d=n.enter("link"),p=n.enter("label");let m=c.move("[");return m+=c.move(n.containerPhrasing(t,{before:m,after:"](",...c.current()})),m+=c.move("]("),p(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(p=n.enter("destinationLiteral"),m+=c.move("<"),m+=c.move(n.safe(t.url,{before:m,after:">",...c.current()})),m+=c.move(">")):(p=n.enter("destinationRaw"),m+=c.move(n.safe(t.url,{before:m,after:t.title?" ":")",...c.current()}))),p(),t.title&&(p=n.enter(`title${u}`),m+=c.move(" "+o),m+=c.move(n.safe(t.title,{before:m,after:o,...c.current()})),m+=c.move(o),p()),m+=c.move(")"),d(),m}function aI(t,s,n){return o1(t,n)?"<":"["}u1.peek=sI;function u1(t,s,n,r){const o=t.referenceType,u=n.enter("linkReference");let c=n.enter("label");const d=n.createTracker(r);let p=d.move("[");const m=n.containerPhrasing(t,{before:p,after:"]",...d.current()});p+=d.move(m+"]["),c();const f=n.stack;n.stack=[],c=n.enter("reference");const g=n.safe(n.associationId(t),{before:p,after:"]",...d.current()});return c(),n.stack=f,u(),o==="full"||!m||m!==g?p+=d.move(g+"]"):o==="shortcut"?p=p.slice(0,-1):p+=d.move("]"),p}function sI(){return"["}function Uf(t){const s=t.options.bullet||"*";if(s!=="*"&&s!=="+"&&s!=="-")throw new Error("Cannot serialize items with `"+s+"` for `options.bullet`, expected `*`, `+`, or `-`");return s}function iI(t){const s=Uf(t),n=t.options.bulletOther;if(!n)return s==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===s)throw new Error("Expected `bullet` (`"+s+"`) and `bulletOther` (`"+n+"`) to be different");return n}function rI(t){const s=t.options.bulletOrdered||".";if(s!=="."&&s!==")")throw new Error("Cannot serialize items with `"+s+"` for `options.bulletOrdered`, expected `.` or `)`");return s}function d1(t){const s=t.options.rule||"*";if(s!=="*"&&s!=="-"&&s!=="_")throw new Error("Cannot serialize rules with `"+s+"` for `options.rule`, expected `*`, `-`, or `_`");return s}function lI(t,s,n,r){const o=n.enter("list"),u=n.bulletCurrent;let c=t.ordered?rI(n):Uf(n);const d=t.ordered?c==="."?")":".":iI(n);let p=s&&n.bulletLastUsed?c===n.bulletLastUsed:!1;if(!t.ordered){const f=t.children?t.children[0]:void 0;if((c==="*"||c==="-")&&f&&(!f.children||!f.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(p=!0),d1(n)===c&&f){let g=-1;for(;++g<t.children.length;){const x=t.children[g];if(x&&x.type==="listItem"&&x.children&&x.children[0]&&x.children[0].type==="thematicBreak"){p=!0;break}}}}p&&(c=d),n.bulletCurrent=c;const m=n.containerFlow(t,r);return n.bulletLastUsed=c,n.bulletCurrent=u,o(),m}function oI(t){const s=t.options.listItemIndent||"one";if(s!=="tab"&&s!=="one"&&s!=="mixed")throw new Error("Cannot serialize items with `"+s+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return s}function cI(t,s,n,r){const o=oI(n);let u=n.bulletCurrent||Uf(n);s&&s.type==="list"&&s.ordered&&(u=(typeof s.start=="number"&&s.start>-1?s.start:1)+(n.options.incrementListMarker===!1?0:s.children.indexOf(t))+u);let c=u.length+1;(o==="tab"||o==="mixed"&&(s&&s.type==="list"&&s.spread||t.spread))&&(c=Math.ceil(c/4)*4);const d=n.createTracker(r);d.move(u+" ".repeat(c-u.length)),d.shift(c);const p=n.enter("listItem"),m=n.indentLines(n.containerFlow(t,d.current()),f);return p(),m;function f(g,x,j){return x?(j?"":" ".repeat(c))+g:(j?u:u+" ".repeat(c-u.length))+g}}function uI(t,s,n,r){const o=n.enter("paragraph"),u=n.enter("phrasing"),c=n.containerPhrasing(t,r);return u(),o(),c}const dI=Bf(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function hI(t,s,n,r){return(t.children.some(function(c){return dI(c)})?n.containerPhrasing:n.containerFlow).call(n,t,r)}function mI(t){const s=t.options.strong||"*";if(s!=="*"&&s!=="_")throw new Error("Cannot serialize strong with `"+s+"` for `options.strong`, expected `*`, or `_`");return s}h1.peek=pI;function h1(t,s,n,r){const o=mI(n),u=n.enter("strong"),c=n.createTracker(r),d=c.move(o+o);let p=c.move(n.containerPhrasing(t,{after:o,before:d,...c.current()}));const m=p.charCodeAt(0),f=_d(r.before.charCodeAt(r.before.length-1),m,o);f.inside&&(p=$i(m)+p.slice(1));const g=p.charCodeAt(p.length-1),x=_d(r.after.charCodeAt(0),g,o);x.inside&&(p=p.slice(0,-1)+$i(g));const j=c.move(o+o);return u(),n.attentionEncodeSurroundingInfo={after:x.outside,before:f.outside},d+p+j}function pI(t,s,n){return n.options.strong||"*"}function fI(t,s,n,r){return n.safe(t.value,r)}function gI(t){const s=t.options.ruleRepetition||3;if(s<3)throw new Error("Cannot serialize rules with repetition `"+s+"` for `options.ruleRepetition`, expected `3` or more");return s}function xI(t,s,n){const r=(d1(n)+(n.options.ruleSpaces?" ":"")).repeat(gI(n));return n.options.ruleSpaces?r.slice(0,-1):r}const yI={blockquote:O3,break:jj,code:$3,definition:M3,emphasis:e1,hardBreak:jj,heading:W3,html:s1,image:i1,imageReference:r1,inlineCode:l1,link:c1,linkReference:u1,list:lI,listItem:cI,paragraph:uI,root:hI,strong:h1,text:fI,thematicBreak:xI},bI=[jI];function jI(t,s,n,r){if(s.type==="code"&&Wp(s,r)&&(t.type==="list"||t.type===s.type&&Wp(t,r)))return!1;if("spread"in n&&typeof n.spread=="boolean")return t.type==="paragraph"&&(t.type===s.type||s.type==="definition"||s.type==="heading"&&a1(s,r))?void 0:n.spread?1:0}const xr=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],vI=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:xr},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:xr},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:xr},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:xr},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:xr},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:xr},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:xr},{atBreak:!0,character:"~"}];function NI(t){return t.label||!t.identifier?t.label||"":Yv(t.identifier)}function wI(t){if(!t._compiled){const s=(t.atBreak?"[\\r\\n][\\t ]*":"")+(t.before?"(?:"+t.before+")":"");t._compiled=new RegExp((s?"("+s+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(t.character)?"\\":"")+t.character+(t.after?"(?:"+t.after+")":""),"g")}return t._compiled}function SI(t,s,n){const r=s.indexStack,o=t.children||[],u=[];let c=-1,d=n.before,p;r.push(-1);let m=s.createTracker(n);for(;++c<o.length;){const f=o[c];let g;if(r[r.length-1]=c,c+1<o.length){let N=s.handle.handlers[o[c+1].type];N&&N.peek&&(N=N.peek),g=N?N(o[c+1],t,s,{before:"",after:"",...m.current()}).charAt(0):""}else g=n.after;u.length>0&&(d==="\r"||d===`
`)&&f.type==="html"&&(u[u.length-1]=u[u.length-1].replace(/(\r?\n|\r)$/," "),d=" ",m=s.createTracker(n),m.move(u.join("")));let x=s.handle(f,t,s,{...m.current(),after:g,before:d});p&&p===x.slice(0,1)&&(x=$i(p.charCodeAt(0))+x.slice(1));const j=s.attentionEncodeSurroundingInfo;s.attentionEncodeSurroundingInfo=void 0,p=void 0,j&&(u.length>0&&j.before&&d===u[u.length-1].slice(-1)&&(u[u.length-1]=u[u.length-1].slice(0,-1)+$i(d.charCodeAt(0))),j.after&&(p=g)),m.move(x),u.push(x),d=x.slice(-1)}return r.pop(),u.join("")}function kI(t,s,n){const r=s.indexStack,o=t.children||[],u=s.createTracker(n),c=[];let d=-1;for(r.push(-1);++d<o.length;){const p=o[d];r[r.length-1]=d,c.push(u.move(s.handle(p,t,s,{before:`
`,after:`
`,...u.current()}))),p.type!=="list"&&(s.bulletLastUsed=void 0),d<o.length-1&&c.push(u.move(CI(p,o[d+1],t,s)))}return r.pop(),c.join("")}function CI(t,s,n,r){let o=r.join.length;for(;o--;){const u=r.join[o](t,s,n,r);if(u===!0||u===1)break;if(typeof u=="number")return`
`.repeat(1+u);if(u===!1)return`

<!---->

`}return`

`}const _I=/\r?\n|\r/g;function DI(t,s){const n=[];let r=0,o=0,u;for(;u=_I.exec(t);)c(t.slice(r,u.index)),n.push(u[0]),r=u.index+u[0].length,o++;return c(t.slice(r)),n.join("");function c(d){n.push(s(d,o,!d))}}function EI(t,s,n){const r=(n.before||"")+(s||"")+(n.after||""),o=[],u=[],c={};let d=-1;for(;++d<t.unsafe.length;){const f=t.unsafe[d];if(!Zv(t.stack,f))continue;const g=t.compilePattern(f);let x;for(;x=g.exec(r);){const j="before"in f||!!f.atBreak,N="after"in f,k=x.index+(j?x[1].length:0);o.includes(k)?(c[k].before&&!j&&(c[k].before=!1),c[k].after&&!N&&(c[k].after=!1)):(o.push(k),c[k]={before:j,after:N})}}o.sort(TI);let p=n.before?n.before.length:0;const m=r.length-(n.after?n.after.length:0);for(d=-1;++d<o.length;){const f=o[d];f<p||f>=m||f+1<m&&o[d+1]===f+1&&c[f].after&&!c[f+1].before&&!c[f+1].after||o[d-1]===f-1&&c[f].before&&!c[f-1].before&&!c[f-1].after||(p!==f&&u.push(vj(r.slice(p,f),"\\")),p=f,/[!-/:-@[-`{-~]/.test(r.charAt(f))&&(!n.encode||!n.encode.includes(r.charAt(f)))?u.push("\\"):(u.push($i(r.charCodeAt(f))),p++))}return u.push(vj(r.slice(p,m),n.after)),u.join("")}function TI(t,s){return t-s}function vj(t,s){const n=/\\(?=[!-/:-@[-`{-~])/g,r=[],o=[],u=t+s;let c=-1,d=0,p;for(;p=n.exec(u);)r.push(p.index);for(;++c<r.length;)d!==r[c]&&o.push(t.slice(d,r[c])),o.push("\\"),d=r[c];return o.push(t.slice(d)),o.join("")}function AI(t){const s=t||{},n=s.now||{};let r=s.lineShift||0,o=n.line||1,u=n.column||1;return{move:p,current:c,shift:d};function c(){return{now:{line:o,column:u},lineShift:r}}function d(m){r+=m}function p(m){const f=m||"",g=f.split(/\r?\n|\r/g),x=g[g.length-1];return o+=g.length-1,u=g.length===1?u+x.length:1+x.length+r,f}}function PI(t,s){const n=s||{},r={associationId:NI,containerPhrasing:RI,containerFlow:LI,createTracker:AI,compilePattern:wI,enter:u,handlers:{...yI},handle:void 0,indentLines:DI,indexStack:[],join:[...bI],options:{},safe:$I,stack:[],unsafe:[...vI]};Wv(r,n),r.options.tightDefinitions&&r.join.push(zI),r.handle=Kv("type",{invalid:II,unknown:OI,handlers:r.handlers});let o=r.handle(t,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return o&&o.charCodeAt(o.length-1)!==10&&o.charCodeAt(o.length-1)!==13&&(o+=`
`),o;function u(c){return r.stack.push(c),d;function d(){r.stack.pop()}}}function II(t){throw new Error("Cannot handle value `"+t+"`, expected node")}function OI(t){const s=t;throw new Error("Cannot handle unknown node `"+s.type+"`")}function zI(t,s){if(t.type==="definition"&&t.type===s.type)return 0}function RI(t,s){return SI(t,this,s)}function LI(t,s){return kI(t,this,s)}function $I(t,s){return EI(this,t,s)}function FI(t){const s=this;s.compiler=n;function n(r){return PI(r,{...s.data("settings"),...t,extensions:s.data("toMarkdownExtensions")||[]})}}function Nj(t){if(t)throw t}var hp,wj;function MI(){if(wj)return hp;wj=1;var t=Object.prototype.hasOwnProperty,s=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=function(m){return typeof Array.isArray=="function"?Array.isArray(m):s.call(m)==="[object Array]"},u=function(m){if(!m||s.call(m)!=="[object Object]")return!1;var f=t.call(m,"constructor"),g=m.constructor&&m.constructor.prototype&&t.call(m.constructor.prototype,"isPrototypeOf");if(m.constructor&&!f&&!g)return!1;var x;for(x in m);return typeof x>"u"||t.call(m,x)},c=function(m,f){n&&f.name==="__proto__"?n(m,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):m[f.name]=f.newValue},d=function(m,f){if(f==="__proto__")if(t.call(m,f)){if(r)return r(m,f).value}else return;return m[f]};return hp=function p(){var m,f,g,x,j,N,k=arguments[0],D=1,_=arguments.length,T=!1;for(typeof k=="boolean"&&(T=k,k=arguments[1]||{},D=2),(k==null||typeof k!="object"&&typeof k!="function")&&(k={});D<_;++D)if(m=arguments[D],m!=null)for(f in m)g=d(k,f),x=d(m,f),k!==x&&(T&&x&&(u(x)||(j=o(x)))?(j?(j=!1,N=g&&o(g)?g:[]):N=g&&u(g)?g:{},c(k,{name:f,newValue:p(T,N,x)})):typeof x<"u"&&c(k,{name:f,newValue:x}));return k},hp}var BI=MI();const mp=Sc(BI);function ef(t){if(typeof t!="object"||t===null)return!1;const s=Object.getPrototypeOf(t);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function UI(){const t=[],s={run:n,use:r};return s;function n(...o){let u=-1;const c=o.pop();if(typeof c!="function")throw new TypeError("Expected function as last argument, not "+c);d(null,...o);function d(p,...m){const f=t[++u];let g=-1;if(p){c(p);return}for(;++g<o.length;)(m[g]===null||m[g]===void 0)&&(m[g]=o[g]);o=m,f?qI(f,d)(...m):c(null,...m)}}function r(o){if(typeof o!="function")throw new TypeError("Expected `middelware` to be a function, not "+o);return t.push(o),s}}function qI(t,s){let n;return r;function r(...c){const d=t.length>c.length;let p;d&&c.push(o);try{p=t.apply(this,c)}catch(m){const f=m;if(d&&n)throw f;return o(f)}d||(p&&p.then&&typeof p.then=="function"?p.then(u,o):p instanceof Error?o(p):u(p))}function o(c,...d){n||(n=!0,s(c,...d))}function u(c){o(null,c)}}class ia extends Error{constructor(s,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let o="",u={},c=!1;if(n&&("line"in n&&"column"in n?u={place:n}:"start"in n&&"end"in n?u={place:n}:"type"in n?u={ancestors:[n],place:n.position}:u={...n}),typeof s=="string"?o=s:!u.cause&&s&&(c=!0,o=s.message,u.cause=s),!u.ruleId&&!u.source&&typeof r=="string"){const p=r.indexOf(":");p===-1?u.ruleId=r:(u.source=r.slice(0,p),u.ruleId=r.slice(p+1))}if(!u.place&&u.ancestors&&u.ancestors){const p=u.ancestors[u.ancestors.length-1];p&&(u.place=p.position)}const d=u.place&&"start"in u.place?u.place.start:u.place;this.ancestors=u.ancestors||void 0,this.cause=u.cause||void 0,this.column=d?d.column:void 0,this.fatal=void 0,this.file="",this.message=o,this.line=d?d.line:void 0,this.name=yc(u.place)||"1:1",this.place=u.place||void 0,this.reason=this.message,this.ruleId=u.ruleId||void 0,this.source=u.source||void 0,this.stack=c&&u.cause&&typeof u.cause.stack=="string"?u.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}ia.prototype.file="";ia.prototype.name="";ia.prototype.reason="";ia.prototype.message="";ia.prototype.stack="";ia.prototype.column=void 0;ia.prototype.line=void 0;ia.prototype.ancestors=void 0;ia.prototype.cause=void 0;ia.prototype.fatal=void 0;ia.prototype.place=void 0;ia.prototype.ruleId=void 0;ia.prototype.source=void 0;const rs={basename:HI,dirname:VI,extname:GI,join:QI,sep:"/"};function HI(t,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');Ac(t);let n=0,r=-1,o=t.length,u;if(s===void 0||s.length===0||s.length>t.length){for(;o--;)if(t.codePointAt(o)===47){if(u){n=o+1;break}}else r<0&&(u=!0,r=o+1);return r<0?"":t.slice(n,r)}if(s===t)return"";let c=-1,d=s.length-1;for(;o--;)if(t.codePointAt(o)===47){if(u){n=o+1;break}}else c<0&&(u=!0,c=o+1),d>-1&&(t.codePointAt(o)===s.codePointAt(d--)?d<0&&(r=o):(d=-1,r=c));return n===r?r=c:r<0&&(r=t.length),t.slice(n,r)}function VI(t){if(Ac(t),t.length===0)return".";let s=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){s=n;break}}else r||(r=!0);return s<0?t.codePointAt(0)===47?"/":".":s===1&&t.codePointAt(0)===47?"//":t.slice(0,s)}function GI(t){Ac(t);let s=t.length,n=-1,r=0,o=-1,u=0,c;for(;s--;){const d=t.codePointAt(s);if(d===47){if(c){r=s+1;break}continue}n<0&&(c=!0,n=s+1),d===46?o<0?o=s:u!==1&&(u=1):o>-1&&(u=-1)}return o<0||n<0||u===0||u===1&&o===n-1&&o===r+1?"":t.slice(o,n)}function QI(...t){let s=-1,n;for(;++s<t.length;)Ac(t[s]),t[s]&&(n=n===void 0?t[s]:n+"/"+t[s]);return n===void 0?".":YI(n)}function YI(t){Ac(t);const s=t.codePointAt(0)===47;let n=JI(t,!s);return n.length===0&&!s&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),s?"/"+n:n}function JI(t,s){let n="",r=0,o=-1,u=0,c=-1,d,p;for(;++c<=t.length;){if(c<t.length)d=t.codePointAt(c);else{if(d===47)break;d=47}if(d===47){if(!(o===c-1||u===1))if(o!==c-1&&u===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(p=n.lastIndexOf("/"),p!==n.length-1){p<0?(n="",r=0):(n=n.slice(0,p),r=n.length-1-n.lastIndexOf("/")),o=c,u=0;continue}}else if(n.length>0){n="",r=0,o=c,u=0;continue}}s&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(o+1,c):n=t.slice(o+1,c),r=c-o-1;o=c,u=0}else d===46&&u>-1?u++:u=-1}return n}function Ac(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const XI={cwd:KI};function KI(){return"/"}function tf(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function WI(t){if(typeof t=="string")t=new URL(t);else if(!tf(t)){const s=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw s.code="ERR_INVALID_ARG_TYPE",s}if(t.protocol!=="file:"){const s=new TypeError("The URL must be of scheme file");throw s.code="ERR_INVALID_URL_SCHEME",s}return ZI(t)}function ZI(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const s=t.pathname;let n=-1;for(;++n<s.length;)if(s.codePointAt(n)===37&&s.codePointAt(n+1)===50){const r=s.codePointAt(n+2);if(r===70||r===102){const o=new TypeError("File URL path must not include encoded / characters");throw o.code="ERR_INVALID_FILE_URL_PATH",o}}return decodeURIComponent(s)}const pp=["history","path","basename","stem","extname","dirname"];class eO{constructor(s){let n;s?tf(s)?n={path:s}:typeof s=="string"||tO(s)?n={value:s}:n=s:n={},this.cwd="cwd"in n?"":XI.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<pp.length;){const u=pp[r];u in n&&n[u]!==void 0&&n[u]!==null&&(this[u]=u==="history"?[...n[u]]:n[u])}let o;for(o in n)pp.includes(o)||(this[o]=n[o])}get basename(){return typeof this.path=="string"?rs.basename(this.path):void 0}set basename(s){gp(s,"basename"),fp(s,"basename"),this.path=rs.join(this.dirname||"",s)}get dirname(){return typeof this.path=="string"?rs.dirname(this.path):void 0}set dirname(s){Sj(this.basename,"dirname"),this.path=rs.join(s||"",this.basename)}get extname(){return typeof this.path=="string"?rs.extname(this.path):void 0}set extname(s){if(fp(s,"extname"),Sj(this.dirname,"extname"),s){if(s.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(s.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=rs.join(this.dirname,this.stem+(s||""))}get path(){return this.history[this.history.length-1]}set path(s){tf(s)&&(s=WI(s)),gp(s,"path"),this.path!==s&&this.history.push(s)}get stem(){return typeof this.path=="string"?rs.basename(this.path,this.extname):void 0}set stem(s){gp(s,"stem"),fp(s,"stem"),this.path=rs.join(this.dirname||"",s+(this.extname||""))}fail(s,n,r){const o=this.message(s,n,r);throw o.fatal=!0,o}info(s,n,r){const o=this.message(s,n,r);return o.fatal=void 0,o}message(s,n,r){const o=new ia(s,n,r);return this.path&&(o.name=this.path+":"+o.name,o.file=this.path),o.fatal=!1,this.messages.push(o),o}toString(s){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(s||void 0).decode(this.value)}}function fp(t,s){if(t&&t.includes(rs.sep))throw new Error("`"+s+"` cannot be a path: did not expect `"+rs.sep+"`")}function gp(t,s){if(!t)throw new Error("`"+s+"` cannot be empty")}function Sj(t,s){if(!t)throw new Error("Setting `"+s+"` requires `path` to be set too")}function tO(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const nO=function(t){const r=this.constructor.prototype,o=r[t],u=function(){return o.apply(u,arguments)};return Object.setPrototypeOf(u,r),u},aO={}.hasOwnProperty;class qf extends nO{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=UI()}copy(){const s=new qf;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];s.use(...r)}return s.data(mp(!0,{},this.namespace)),s}data(s,n){return typeof s=="string"?arguments.length===2?(bp("data",this.frozen),this.namespace[s]=n,this):aO.call(this.namespace,s)&&this.namespace[s]||void 0:s?(bp("data",this.frozen),this.namespace=s,this):this.namespace}freeze(){if(this.frozen)return this;const s=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const o=n.call(s,...r);typeof o=="function"&&this.transformers.use(o)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(s){this.freeze();const n=cd(s),r=this.parser||this.Parser;return xp("parse",r),r(String(n),n)}process(s,n){const r=this;return this.freeze(),xp("process",this.parser||this.Parser),yp("process",this.compiler||this.Compiler),n?o(void 0,n):new Promise(o);function o(u,c){const d=cd(s),p=r.parse(d);r.run(p,d,function(f,g,x){if(f||!g||!x)return m(f);const j=g,N=r.stringify(j,x);rO(N)?x.value=N:x.result=N,m(f,x)});function m(f,g){f||!g?c(f):u?u(g):n(void 0,g)}}}processSync(s){let n=!1,r;return this.freeze(),xp("processSync",this.parser||this.Parser),yp("processSync",this.compiler||this.Compiler),this.process(s,o),Cj("processSync","process",n),r;function o(u,c){n=!0,Nj(u),r=c}}run(s,n,r){kj(s),this.freeze();const o=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?u(void 0,r):new Promise(u);function u(c,d){const p=cd(n);o.run(s,p,m);function m(f,g,x){const j=g||s;f?d(f):c?c(j):r(void 0,j,x)}}}runSync(s,n){let r=!1,o;return this.run(s,n,u),Cj("runSync","run",r),o;function u(c,d){Nj(c),o=d,r=!0}}stringify(s,n){this.freeze();const r=cd(n),o=this.compiler||this.Compiler;return yp("stringify",o),kj(s),o(s,r)}use(s,...n){const r=this.attachers,o=this.namespace;if(bp("use",this.frozen),s!=null)if(typeof s=="function")p(s,n);else if(typeof s=="object")Array.isArray(s)?d(s):c(s);else throw new TypeError("Expected usable value, not `"+s+"`");return this;function u(m){if(typeof m=="function")p(m,[]);else if(typeof m=="object")if(Array.isArray(m)){const[f,...g]=m;p(f,g)}else c(m);else throw new TypeError("Expected usable value, not `"+m+"`")}function c(m){if(!("plugins"in m)&&!("settings"in m))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");d(m.plugins),m.settings&&(o.settings=mp(!0,o.settings,m.settings))}function d(m){let f=-1;if(m!=null)if(Array.isArray(m))for(;++f<m.length;){const g=m[f];u(g)}else throw new TypeError("Expected a list of plugins, not `"+m+"`")}function p(m,f){let g=-1,x=-1;for(;++g<r.length;)if(r[g][0]===m){x=g;break}if(x===-1)r.push([m,...f]);else if(f.length>0){let[j,...N]=f;const k=r[x][1];ef(k)&&ef(j)&&(j=mp(!0,k,j)),r[x]=[m,j,...N]}}}}const sO=new qf().freeze();function xp(t,s){if(typeof s!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function yp(t,s){if(typeof s!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function bp(t,s){if(s)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function kj(t){if(!ef(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Cj(t,s,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+s+"` instead")}function cd(t){return iO(t)?t:new eO(t)}function iO(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function rO(t){return typeof t=="string"||lO(t)}function lO(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const jp=sO().use(A3).use(FI).freeze(),oO=t=>{if(!t)return"Unknown Date";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},cO=t=>{switch(t){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:t,className:"status-badge"}}},vp=({title:t,items:s,renderItemContent:n,headerAction:r,isLoading:o,loadingText:u,noDataText:c,onDeleteItem:d,onEditLabOrder:p,onSaveLabOrder:m,onCancelEditLabOrder:f,onLabOrderTestChange:g,onLabOrderStatusChange:x,onEditPharmacyOrder:j,onPrintUnavailablePrescription:N,onBillLabOrder:k,onUpdateLabOrderStatus:D,onEnterLabReport:_,labInventory:T=[],isSavingLabOrder:E=!1,expandedLabReports:U={},toggleLabReport:X=()=>{},selectionEnabled:I=!1,selectedIds:F=new Set,onSelectionChange:B})=>{const G=y.useMemo(()=>{const A={};s.forEach($=>{if(isNaN($.date.getTime())){A["Unknown Date"]||(A["Unknown Date"]=[]),A["Unknown Date"].push($);return}const J=oO($.originalDateString);A[J]||(A[J]=[]),A[J].push($)});const P=Object.keys(A);return P.sort(($,J)=>{if($==="Unknown Date")return 1;if(J==="Unknown Date")return-1;try{const R=new Date($.split(" ").reverse().join(" ")),L=new Date(J.split(" ").reverse().join(" "));if(!isNaN(R.getTime())&&!isNaN(L.getTime()))return L.getTime()-R.getTime()}catch{}return J.localeCompare($)}),P.map($=>({date:$,items:A[$]}))},[s]),C=["pending","billed","collected","processing","report_ready","completed","cancelled","reported"];return e.jsxs("div",{className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"ai-context-section-title mb-2 pb-1",children:t}),r]}),o&&e.jsx("p",{className:"ai-context-text italic",children:u}),!o&&s.length===0&&e.jsx("p",{className:"ai-context-text italic",children:c}),!o&&s.length>0&&e.jsx("div",{className:"space-y-3",children:G.map(({date:A,items:P})=>e.jsxs("div",{children:[e.jsx("h5",{className:"grouped-history-date",children:A}),e.jsx("div",{className:"space-y-1 grouped-history-item-container",children:P.map(($,J)=>e.jsxs("div",{className:"grouped-history-item ai-context-item flex flex-col",children:[!($.type==="Lab Order"&&$.data.isEditing)&&e.jsxs("div",{className:"flex justify-between items-center w-full",children:[I&&B&&$.type==="Pharmacy Order"&&e.jsx("div",{className:"mr-2",children:e.jsx("input",{type:"checkbox",checked:F.has($.data.id),onChange:R=>B($.data.id,R.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("div",{className:"flex-grow mr-2 ai-context-text",children:n($,J,U,X)}),e.jsxs("div",{className:"flex items-center space-x-1",children:[$.type==="Lab Order"&&!$.data.isEditing&&p&&e.jsx("button",{onClick:()=>p($.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this lab order",disabled:E,children:e.jsx(qa,{size:14})}),$.type==="Lab Order"&&$.data.isEditing&&e.jsx(e.Fragment,{}),$.type==="Lab Order"&&e.jsxs("div",{className:"lab-table-actions",children:[$.data.status==="pending"&&k&&(()=>{const R=$.data.tests.reduce((L,M)=>L+(Number(M.price)||0),0).toFixed(2);return e.jsx("button",{onClick:()=>k($.data),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400",title:`Pay total of ${R}`,disabled:E,children:e.jsx(r0,{size:14})})})(),$.data.status==="billed"&&D&&e.jsx("button",{onClick:()=>D($.data.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),$.data.status==="collected"&&D&&e.jsx("button",{onClick:()=>D($.data.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),["pending","billed","collected","processing","report_ready","reported","completed"].includes($.data.status)&&_&&e.jsx("button",{onClick:()=>_($.data),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),($.data.status==="report_ready"||$.data.status==="reported")&&D&&e.jsx("button",{onClick:()=>D($.data.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"})]}),$.type==="Pharmacy Order"&&$.data.status==="pending"&&j&&e.jsx("button",{onClick:()=>j($.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this pharmacy order",disabled:E,children:e.jsx(qa,{size:14})}),$.type==="Pharmacy Order"&&$.data.prescriptionForUnavailableDrugs&&N&&e.jsx("button",{onClick:()=>N($.data.prescriptionForUnavailableDrugs,`Prescription for Order ${$.data.id}`),className:"text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-100 focus:outline-none focus:ring-1 focus:ring-purple-400",title:"Print Prescription for Unavailable Drugs",disabled:E,children:e.jsx(ls,{size:14})}),$.type==="Pharmacy Order"&&$.data.status==="pending"&&d&&e.jsx("button",{onClick:()=>d({type:$.type,data:$.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:"Delete this pending pharmacy order",disabled:E,children:e.jsx(on,{size:14})}),d&&["Complaint","Lab Order","Lab Report"].includes($.type)&&e.jsx("button",{onClick:()=>d({type:$.type,data:$.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:`Delete this ${$.type.toLowerCase()}`,disabled:E,children:e.jsx(on,{size:14})})]})]}),$.type==="Lab Order"&&$.data.isEditing&&e.jsxs("div",{className:"lab-order-edit-form w-full bg-gray-50 border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h6",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Edit Order"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Status:"}),e.jsx("select",{value:$.data.editedStatus||$.data.status,onChange:R=>x&&x($.data.id,R.target.value),className:"form-select text-xs py-1 pl-2 pr-6 rounded border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:E,children:C.map(R=>e.jsx("option",{value:R,children:R.replace(/_/g," ")},R))})]})]}),e.jsx("div",{className:"overflow-hidden border rounded-md bg-white mb-3",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 font-medium text-gray-600",children:"Test Name"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-600 w-20",children:"Price"}),e.jsx("th",{className:"py-2 px-3 w-10"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[$.data.editedTests.map((R,L)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 px-3",children:e.jsxs("select",{value:R.id,onChange:M=>{const Z=T.find(Q=>String(Q.id)===M.target.value);Z&&(g&&g($.data.id,L,"id",Z.id),g&&g($.data.id,L,"name",Z.name),g&&g($.data.id,L,"price",Z.price))},className:"form-select w-full text-xs border-0 bg-transparent focus:ring-0 p-0",disabled:E,children:[e.jsx("option",{value:"",children:"Select Test"}),T.map(M=>e.jsx("option",{value:M.id,children:M.name},M.id))]})}),e.jsxs("td",{className:"py-1 px-3 text-right text-gray-700",children:["",R.price]}),e.jsx("td",{className:"py-1 px-3 text-center",children:e.jsx("button",{onClick:()=>{const M=$.data.editedTests.filter((Z,Q)=>Q!==L);g&&g($.data.id,-1,"remove",M)},className:"text-red-400 hover:text-red-600 focus:outline-none",title:"Remove test",disabled:E,children:e.jsx(on,{size:12})})})]},L)),$.data.editedTests.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 px-3 text-center italic text-gray-400",children:"No tests selected"})})]}),e.jsx("tfoot",{className:"bg-gray-50 border-t",children:e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-1 px-3",children:e.jsx("button",{onClick:()=>{g&&g($.data.id,-1,"add",{id:"",name:"",price:0})},className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center py-1",disabled:E,children:"+ Add Test"})})})})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 border-t border-gray-200 pt-3 mt-1",children:[e.jsx("button",{onClick:()=>f&&f($.data.id),className:"px-3 py-1.5 rounded text-xs text-gray-600 hover:bg-white hover:text-gray-800 border border-transparent hover:border-gray-200 transition-colors",disabled:E,children:"Cancel"}),e.jsx("button",{onClick:()=>m&&m($.data.id,$.data.editedTests,$.data.editedStatus),className:"px-3 py-1.5 rounded text-xs bg-blue-600 text-white hover:bg-blue-700 shadow-sm flex items-center space-x-1 transition-colors",disabled:E,children:E?e.jsx("span",{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{size:12}),e.jsx("span",{children:"Save Changes"})]})})]})]})]},`${$.type}-${$.originalDateString}-${J}`))})]},A))})]})},uO="_modalOverlay_spc0l_3",dO="_modalContent_spc0l_29",hO="_modalHeader_spc0l_61",mO="_modalTitle_spc0l_79",pO="_modalCloseButton_spc0l_91",fO="_modalBody_spc0l_119",gO="_errorText_spc0l_137",xO="_formGroup_spc0l_155",yO="_inputField_spc0l_179",bO="_searchResultsCard_spc0l_221",jO="_searchResultsList_spc0l_249",vO="_searchResultItem_spc0l_261",NO="_searchResultPrice_spc0l_297",wO="_selectedTestsCard_spc0l_307",SO="_selectedTestsHeader_spc0l_327",kO="_noTestsMessage_spc0l_343",CO="_selectedTestsList_spc0l_359",_O="_selectedTestItem_spc0l_371",DO="_selectedTestName_spc0l_395",EO="_selectedTestPrice_spc0l_407",TO="_removeTestButton_spc0l_419",AO="_totalAmount_spc0l_445",PO="_modalFooter_spc0l_463",IO="_button_spc0l_489",OO="_buttonPrimary_spc0l_507",zO="_buttonSecondary_spc0l_529",rt={modalOverlay:uO,modalContent:dO,modalHeader:hO,modalTitle:mO,modalCloseButton:pO,modalBody:fO,errorText:gO,formGroup:xO,inputField:yO,searchResultsCard:bO,searchResultsList:jO,searchResultItem:vO,searchResultPrice:NO,selectedTestsCard:wO,selectedTestsHeader:SO,noTestsMessage:kO,selectedTestsList:CO,selectedTestItem:_O,selectedTestName:DO,selectedTestPrice:EO,removeTestButton:TO,totalAmount:AO,modalFooter:PO,button:IO,buttonPrimary:OO,buttonSecondary:zO},RO=({isOpen:t,onClose:s,patientId:n,labInventory:r,fetchPendingLabOrdersData:o})=>{const[u,c]=y.useState([]),[d,p]=y.useState(""),[m,f]=y.useState([]),[g,x]=y.useState(null),[j,N]=y.useState(!1);Ra(void 0,t?200:99999),y.useEffect(()=>{if(!d){f([]);return}const T=d.toLowerCase();f(r.filter(E=>E.name.toLowerCase().includes(T)||E.description&&E.description.toLowerCase().includes(T)).slice(0,10))},[d,r]);const k=async()=>{if(!n){x("Patient ID is missing.");return}if(u.length===0){x("Please select at least one lab test.");return}N(!0),x(null);try{const T={patient_id:n,tests:u.map(U=>({id:U.id,name:U.name,price:U.price}))},E=await ae("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(T)});if(!E.ok){const U=await E.json().catch(()=>({}));throw new Error(U.message||`Failed to create lab order: ${E.statusText}`)}await E.json(),o(n),s(),c([]),p("")}catch(T){x(`Lab Order Creation Error: ${T.message}`)}finally{N(!1)}},D=T=>{if(u.some(E=>E.id===T.id)){x(`${T.name} is already in the order.`),setTimeout(()=>x(null),3e3),p(""),f([]);return}c(E=>[...E,{...T}]),p(""),f([])},_=T=>{c(E=>E.filter(U=>U.id!==T))};return t?e.jsx("div",{className:rt.modalOverlay,children:e.jsxs("div",{className:rt.modalContent,children:[e.jsxs("div",{className:rt.modalHeader,children:[e.jsx("h3",{className:rt.modalTitle,children:"Create New Lab Order"}),e.jsx("button",{onClick:s,className:rt.modalCloseButton,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:rt.modalBody,children:[g&&e.jsx("div",{className:rt.errorText,children:g}),e.jsxs("div",{className:rt.formGroup,style:{position:"relative"},children:[e.jsx("label",{htmlFor:"lab-test-search",children:"Add Lab Test"}),e.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search available lab tests...",value:d,onChange:T=>p(T.target.value),className:rt.inputField}),d&&m.length>0&&e.jsx("div",{className:rt.searchResultsCard,children:e.jsx("ul",{className:rt.searchResultsList,children:m.map(T=>e.jsxs("li",{onClick:()=>D(T),className:rt.searchResultItem,children:[e.jsx("span",{children:T.name}),e.jsxs("span",{className:rt.searchResultPrice,children:["(",parseFloat(String(T.price)).toFixed(2),")"]})]},T.id))})})]}),e.jsxs("div",{className:rt.selectedTestsCard,children:[e.jsx("h4",{className:rt.selectedTestsHeader,children:"Selected Tests"}),u.length===0?e.jsx("p",{className:rt.noTestsMessage,children:"No tests added yet."}):e.jsx("ul",{className:rt.selectedTestsList,children:u.map(T=>e.jsxs("li",{className:rt.selectedTestItem,children:[e.jsx("span",{className:rt.selectedTestName,children:T.name}),e.jsxs("span",{className:rt.selectedTestPrice,children:["",parseFloat(String(T.price)).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>_(String(T.id)),className:rt.removeTestButton,title:"Remove Test",children:e.jsx(on,{size:16})})]},T.id))})]}),u.length>0&&e.jsxs("div",{className:rt.totalAmount,children:["Total: ",u.reduce((T,E)=>T+parseFloat(String(E.price)),0).toFixed(2)]})]}),e.jsxs("div",{className:rt.modalFooter,children:[e.jsx("button",{type:"button",onClick:s,className:`${rt.button} ${rt.buttonSecondary}`,children:" Cancel "}),e.jsxs("button",{type:"button",onClick:k,disabled:u.length===0||j,className:`${rt.button} ${rt.buttonPrimary} ${u.length===0||j?rt.buttonDisabled:""}`,children:[" ",j?"Saving...":"Create Lab Order"," "]})]})]})}):null},ud=t=>{if(!t)return"";let s=t.toLowerCase();return s=s.replace(/\b(mg|g|ml|iu|unit|tabs|tablet|tablets|capsule|capsules|injection|injections|syrup|solution|cream|ointment|lotion|spray|drops|patch|suppository|vial|ampoule|bottle|pack|kit)\b/g,""),s=s.replace(/\b(test|panel|profile|assay|screen|analysis|level|count|culture)\b/g,""),s=s.replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim(),s},br=(t,s)=>{if(!t||!s||s.length===0)return;const n=ud(t);let r=s.find(c=>ud(c.name)===n);if(r)return r;let o=s.find(c=>ud(c.name).includes(n));if(o)return o;let u=s.find(c=>n.includes(ud(c.name)));if(u)return u},LO=`You are an expert OPD (Outpatient Department) medical assistant for a Doctor in a clinic in India. You will receive all the medical data of the patient including complaints (history), labs, pharmacy orders, etc., along with their date and time. Your primary goal is to assist the doctor and analyze patient chief complaints (Co), provide a structured clinical assessment including lab test suggestions (Lx), differential diagnoses (Dx), and a treatment plan (Tx). You have access to tools (actions) to order lab tests and pharmacy items, and update patient details.



**1. Definitions:**
   - Co: Chief complaints
   - Pt: Patient (assume living in India)
   - Lx: Laboratory tests
   - Dx: Differential Diagnosis
   - Tx: Treatment Plan

**2. Workflow:**
   - Analyze Co, generate Lx, Dx, and Tx sections as described below.
   - **Prioritization for Orders:** Always prioritize using \`edit_pharmacy_order\` or \`edit_lab_order\` if there are existing pending orders for the patient, before considering \`create_pharmacy_order\` or \`create_lab_order\`.
   - using edit_lab_order edits the lab order with the given serial numnber use to add new tests to the existing order or remove the tests from existing order, marking the status affects all tests in the order not only the test,always use this tool if there are pending lab orders instead of creating new orders.
   - using edit_pharmacy_order edits the pharmacy order with the given serial numnber to add new items to the existing order, update existing items, or remove items (either by \`items_to_remove\` or by setting \`quantity\` to 0). Always use this tool if there are pending pharmacy orders instead of creating new orders.
   - If your Lx section suggests tests from the inventory, use the \`create_lab_order\` action, but only for tests that are both clinically required and have not already been ordered or are still pending. Skip tests that are already ordered and in pending.
   - If your Tx section prescribes medications, use the \`create_pharmacy_order\` action  but only for medications that are clinically required and have not already been prescribed or are still pending. Skip medications that are already dispensed or already ordered.
   - If your Tx section prescribes medications that are *not* available in the inventory, use the \`prescription_for_unavailable_drugs\` parameter within the \`create_pharmacy_order\` action to specify the prescription details. **IMPORTANT:** This string MUST be a **Markdown table** with columns: 'Drug Name', 'Quantity', 'Dosage', 'Directions'. Do not use plain text.
   - When ordering pharmacy items, specify both \`pack_quantity\` (number of full packs) and \`loose_quantity\` (number of individual units). The system will handle the conversion based on the drug's pack size.
   - **Patient Details Management:** Always store or update patient name, age, sex, and phone number using the \`update_patient_details\` action. If patient name, age, or sex is received as 'New Patient - Direct Entry', 'N/A', or blank, treat it as missing data; if the user input provides anything resembling a name, age, or sex (e.g., shiva 25m, robin 50m, priya 19f), update them using the \`update_patient_details\` action. If details are missing, you can ask the user for the missing details using the \`ask_followup_question\` action.
   - Always update new complaints of the patient using the \`add_complaint_history\` action.
   - If you generate a concise summary of the patient's current situation based on the interaction and history, use the \`update_case_summary\` action to save it.
   - Remember, when you use \`update_case_summary\`, the previous case summary will be replaced by the new one, so you can use it like a short-term memory to store other stuff that **keeps changing**, like the current treatment plan, plan of action, active problems, or current vitals, etc.
   - When you use \`add_complaint_history\`, it will add the complaint to the previous ones. You will be given all the previous complaints back in every query, so you can use it to store other long-term facts that do **not change**, like the history of a chronic illness, surgical history, allergies, or social history, etc.
   - while placing or editing a pharmacy order make sure to set the \`pack_quantity\` and \`loose_quantity\` right.
   - Use the \`update_clinic_ai_memory\` action to store or update **various types of clinic-wide persistent information in a concise way**. This can include 'summaries of common patient encounters'+'summeries of previous **Clinic-wide AI Memory**'(e.g., 'Patient X, 50m, chronic gastritis, last visit YYYY-MM-DD, prescribed Z, follow-up in N days'+'**Clinic-wide AI Memory** summary'), notes on local health trends, common diagnostic patterns observed in the clinic, specific operational protocols. This memory is shared across all interactions for the clinic and helps tailor responses to its specific context over time.
    -   **Recurring Medications:**
        -   Use \`create_recurring_medication_order\` to add a new recurring medication.
        -   Use \`edit_recurring_medication_order\` to edit an existing recurring medication (using its serial number).
        -   Recurring medications are long-term prescriptions (e.g., for chronic conditions) that automatically re-order or remind.
    -   **Important: Preventing Loops** If you determine that no further actions are needed (e.g., you have already performed necessary actions, or the user's input does not require any specific action), you **MUST** use the \`end_task\` action. This explicitly signals that your task is complete and prevents the system from re-prompting you unnecessarily.
**3.**Multiple Actions:** You can perform multiple actions (like ordering labs AND meds, adding complaints, updating patient information, and asking a follow-up question) in a single response by including multiple action objects within the main JSON array.


**4. Chief Complaints (Co):**
   - Analyze the provided chief complaints.
   - Present them in a table with two columns: 'Relevant Complaint (Score 8-10)' and 'Irrelevant Complaint (Score 0-7)', based on clinical relevance.

**5. Lab Tests (Lx):**
   - Suggest the most probable basic lab tests based on the clinical picture, ordered by likelihood.
   - If a basic test is positive/abnormal, suggest relevant advanced tests.
   - **Inventory Check:** Compare suggested tests against the provided inventory list.
   - **Table 1: Available Lab Tests:** Present tests *available* in the inventory in a table with columns: '**Clinical Importance (High/Medium/Low)**', 'Lab Test'. If suggesting tests from this table, prepare to use the \`create_lab_order\` tool in your response.
   - **Table 2: Unavailable Lab Tests:** Present tests *not available* in the inventory in a separate table with columns: '**Clinical Importance (High/Medium/Low)**', 'Unavailable Basic Test'. Clearly state these are not orderable via the tool (generate Table 2 only when required tests are unavailable).

**6. Differential Diagnosis (Dx):**
   - List potential differential diagnoses.
   - Provide a confidence score (0-10) for each.
   - Present in a table with columns: 'Differential Diagnosis' and 'Confidence Score (0-10)'.

**7. Treatment Plan (Tx):**
   - Create a structured treatment plan including ideal medications based on the diagnosis.
   - **Inventory Check:** Compare prescribed medications against the provided inventory list.
   - **Table 1: Available Medications:** Present medications *available* in the inventory in a table with columns: 'Time Frame' (from and to dates), 'Treatment Goal', 'Intervention', 'Medication Type', 'Drug Form', 'Drug Name', 'Regimen (Dose, Freq)', 'Duration'. Before using the \`create_pharmacy_order\` tool, check if an order for the same drug has already been placed for this patient today. If an order already exists for today, do *not* create a duplicate order. If no order exists for today, prepare to use the \`create_pharmacy_order\` tool in your response.
   - **Table 2: Unavailable Medications:** Present medications *not available* in the inventory in a separate table with columns: 'Unavailable Drug Name', 'Ideal Regimen', 'Reasoning/Indication', '**Clinical Importance (High/Medium/Low)**', 'Suggested Available Substitute (from inventory, if possible)'. Clearly state these are not orderable via the tool (generate Table 2 only when required medications are unavailable in the inventory).

**8. Tools / Actions:**
   When you need to perform actions like ordering tests/meds, updating patient info, or adding history, use the following JSON array format. The response should ONLY contain this JSON array, nothing else.

   ****STRICT JSON****>>>>>>\`\`\`json
[
  { "action": "create_pharmacy_order", "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "prescription_for_unavailable_drugs": "string | null" },
  { "action": "edit_pharmacy_order", "serialNumber": number, "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "items_to_remove": [ { "drug_id": number | null, "name": "Drug Name" } ], "status": "pending" | "billed" | "dispensed" | "cancelled", "prescription_for_unavailable_drugs": "string | null" },
  { "action": "create_lab_order", "tests": [ { "name": "Test Name" } ] },
  { "action": "edit_lab_order", "serialNumber": number, "tests": [ { "name": "Test Name" } ], "items_to_remove": [ { "id": number | string | null, "name": "Test Name" } ], "status": "pending" | "billed" | "collected" | "processing" | "report_ready" | "completed" | "cancelled" | "reported" },
  { "action": "create_lab_report", "tests": [ { "name": "Test Name", "parameters": [{ "name": "Parameter Name", "value": "Value" }] } ] },
  { "action": "edit_lab_report", "serialNumber": number, "tests": [ { "name": "Test Name", "parameters": [{ "name": "Parameter Name", "value": "Value" }] } ] },
  { "action": "add_complaint_history", "complaint": "Specific past complaint text..." },
  { "action": "update_patient_details", "name": "New Name (optional)", "age": number (optional), "gender": "M" | "F" | "O" | null (optional), "phone_number": "string (optional)" },
  { "action": "update_case_summary", "summary": "Concise summary text..." },
  { "action": "update_clinic_ai_memory", "memory_content": "New clinic-wide AI memory content..." },
  { "action": "create_recurring_medication_order", "items": [ { "medication_name": "Drug Name", "drug_id": "string | null", "quantity": number, "frequency_days": number, "next_delivery_date": "YYYY-MM-DD", "tablets_per_day": number | null, "number_of_days": number | null, "directions": "string | null", "notes": "string | null" } ] },
  { "action": "edit_recurring_medication_order", "serialNumber": number, "updates": { "medication_name": "string (opt)", "quantity": number, "frequency_days": number, "status": "active" | "paused" | "stopped", "next_delivery_date": "YYYY-MM-DD", "number_of_days": number, "tablets_per_day": number, "directions": "string" } },
  { "action": "end_task" }
]
\`\`\`

   - **Multiple Actions in One Response:** You can include multiple action objects within this single JSON array if several actions are required based on your analysis (e.g., adding history AND ordering labs).
   - **Prioritization Within the Array:** If including multiple actions, order them within the array according to this priority:
     1. \`add_complaint_history\`
     2. \`update_patient_details\`
     3. \`update_case_summary\`
     4. \`update_clinic_ai_memory\`
     5. \`create_lab_order\`
     6. \`edit_lab_order\`
     7. \`create_pharmacy_order\`
     8. \`edit_pharmacy_order\`
   - **Structure:**
     The AI response can be a flat array of actions OR a list of "function call" objects containing grouped actions.
     **Option 1: Flat Array (Simple)**
     \`\`\`json
     [
       { "action": "add_complaint_history", ... },
       { "action": "create_lab_order", ... }
     ]
     \`\`\`
     **Option 2: Grouped Function Calls (Complex)**
     You can group actions under logical "function calls" if needed.
     \`\`\`json
     [
       {
         "function_call": "assess_patient",
         "actions": [
           { "action": "ask_followup_question", "question": "..." }
         ]
       },
       {
         "function_call": "prescribe_treatment",
         "actions": [
            { "action": "create_pharmacy_order", "items": [...] },
            { "action": "create_lab_order", "tests": [...] }
         ]
       }
     ]
     \`\`\`

   - **Example (Multiple Actions):**
     \`\`\`json
     [
       { "action": "add_complaint_history", "complaint": "Patient also reports mild fever since yesterday." },
       { "action": "create_lab_order", "tests": [ { "name": "CBC" } ] }
     ]
     \`\`\`

   - **\`ask_followup_question\`**: Use this action (either standalone or inside a group) only when you need clarification.
     \`\`\`json
     {
       "action": "ask_followup_question",
       "question": "Your clear, specific question here.",
       "options": ["Optional Answer 1", "Optional Answer 2"]
     }
     \`\`\`
     *Description:* Ask the user a question to gather additional information needed to complete the task. This tool should be used when you encounter ambiguities, need clarification, or require more details to proceed effectively. It allows for interactive problem-solving by enabling direct communication with the user. Use this tool judiciously to maintain a balance between gathering necessary information and avoiding excessive back-and-forth.
     *Parameters:*
       - question: (required) The question to ask the user. This should be a clear, specific question that addresses the information you need.
       - options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible answer. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually.


**Important:**
- Ensure all tables are clearly formatted using Markdown.
- Strictly adhere to the inventory constraints for labs and medications when deciding whether to use \`create_lab_order\` or \`create_pharmacy_order\`.
- When using actions, provide ONLY the JSON array (or the single JSON object for \`ask_followup_question\`) as the *very last* part of your response, after all other content including tables. Do not include any other text after the JSON.

**Plan Mode:**
When the user asks a question about a patient's condition or general medical topics (not entering new medical data), respond in PLAN MODE. In this mode, focus on answering the user's inquiry, clarifying their request, brainstorming ideas, or architecting a solution (like exploring treatment options). Ask clarifying questions if needed. Present detailed plans or explanations **using clear table formats and markdown (like bolding) for easy readability**. Engage in back-and-back discussion to finalize details. Do not use action tools (\`create_lab_order\`, \`create_pharmacy_order\`, \`add_complaint_history\`, \`update_patient_details\`) while in PLAN MODE).`,_j="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",$O="models/gemini-3-flash-preview";async function FO(){if(!ff())return console.warn("No auth token found, using default Gemini API key."),_j;let s=null;try{const n=await ae("/api/clinics/settings");if(n.ok){const r=await n.json();r.gemini_api_key&&r.gemini_api_key.trim()!==""&&(s=r.gemini_api_key.trim())}}catch(n){console.warn("Could not fetch clinic settings (or key missing), proceeding to global fallback.",n)}if(s)return s;try{const n=await ae("/api/global-settings/app_gemini_api_key");if(n.ok){const o=(await n.json()).value;if(o&&o.trim()!=="")return o.trim()}}catch(n){console.warn("Could not fetch global API key.",n)}return console.warn("Clinic-specific and global Gemini API keys not found, using default env var."),_j}let Np=null;async function MO(){if(!Np){const t=await FO();Np=new uf({apiKey:t})}return Np}async function BO(t,s){const{query:n,currentDateTime:r,patientName:o,patientAge:u,patientGender:c,case_summary:d,case_summary_last_updated:p,clinic_ai_memory:m,clinic_ai_memory_last_updated:f,clinic_wide_system_prompt:g,labHistory:x,pharmacyOrders:j,pastComplaints:N,pharmacyInventory:k,labInventory:D,recurringMedications:_}=t;let T=`Patient Complaint: ${n}`;if(d&&(T+=`

--- Case Summary (Provided by Doctor) ---
${d}`,p))try{const P=new Date(p).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});T+=`
(Last Updated: ${P})`}catch{console.warn(`Could not format case_summary_last_updated: ${p}`),T+=`
(Last Updated: ${p})`}if(o&&(T+=`

Patient Name: ${o}`),u!=null&&(T+=`
Patient Age: ${u}`),c&&(T+=`
Patient Gender: ${c}`),r)try{const P=new Date(r).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});T+=`

Current Interaction Time: ${P}`}catch{console.warn(`Could not format currentDateTime: ${r}`),T+=`

Current Interaction Time: ${r}`}if(m&&(T+=`

--- Clinic-wide AI Memory/Context ---
${m}`,f))try{const P=new Date(f).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});T+=`
(Last Updated: ${P})`}catch{console.warn(`Could not format clinic_ai_memory_last_updated: ${f}`),T+=`
(Last Updated: ${f})`}let E="";x&&Array.isArray(x)&&x.length>0&&(E=`

--- Lab History (Orders & Reports) ---
`,x.forEach(P=>{let $="Unknown Date";try{$=new Date(P.orderDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab order: ${P.orderDate}`)}if(E+=`
Order #${P.serialNumber} Date: ${$} (Status: ${P.status})
`,E+=`Tests: ${P.tests.map(J=>J.name).join(", ")}
`,P.report){let J="Unknown Date";try{J=new Date(P.report.reportDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab report: ${P.report.reportDate}`)}E+=`  -> Report Date: ${J}
`,P.report.tests&&Array.isArray(P.report.tests)?(E+=`     Findings:
`,P.report.tests.forEach(R=>{E+=`       - Test: ${R.testName}
`,R.parameters&&Array.isArray(R.parameters)&&R.parameters.forEach(L=>{E+=`         - ${L.name}: ${L.value} (Normal: ${L.normal_range})
`})})):(E+=`     Findings: ${P.report.reportContent||"N/A"}
`,P.report.error&&(E+=`     Note: ${P.report.error}
`))}E+=`---
`}),T+=E);let U="";j&&Array.isArray(j)&&j.length>0&&(U=`

--- Recent Pharmacy Orders ---
`,j.forEach(P=>{let $="Unknown Date/Time";try{$=new Date(P.date).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for pharmacy order: ${P.date}`)}U+=`
Order #${P.serialNumber} Date/Time: ${$} (Status: ${P.status})
`,U+=`Prescribed By: ${P.prescribedBy||"N/A"}
`,P.dispensedBy&&(U+=`Dispensed By: ${P.dispensedBy}
`),U+=`Medications:
`,P.medications.forEach(J=>{U+=`  - ${J.name} (Qty: ${J.quantity}`,J.tabletsPerDay&&(U+=`, ${J.tabletsPerDay}/day`),J.numberOfDays&&(U+=` for ${J.numberOfDays} days`),U+=`)
`}),P.prescriptionForUnavailableDrugs&&(U+=`  Prescription for Unavailable Drugs: ${P.prescriptionForUnavailableDrugs}
`),U+=`---
`}),T+=U);let X="";_&&Array.isArray(_)&&_.length>0&&(X=`

--- Recurring Medications (Active) ---
`,_.forEach((P,$)=>{let J=`${$+1}. ${P.medicationName} (${P.frequencyDays} days)`;if(P.tabletsPerDay&&(J+=` - ${P.tabletsPerDay} tabs/day`),P.numberOfDays&&(J+=` for ${P.numberOfDays} days`),J+=` [Status: ${P.status}]`,P.nextDeliveryDate)try{const R=new Date(P.nextDeliveryDate).toLocaleDateString();J+=` (Next: ${R})`}catch{}X+=`${J}
`}),T+=X);let I="";N&&Array.isArray(N)&&N.length>0&&(I=`

--- Past Complaints History ---
`,N.forEach(P=>{let $="Unknown Date/Time";try{$=new Date(P.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for past complaint: ${P.createdAt}`)}I+=`
Date/Time: ${$}
Complaint: ${P.complaint||"N/A"}
---
`}),T+=I);let F="";k&&Array.isArray(k)&&k.length>0&&(F=`

--- Current Pharmacy Inventory (Stock Levels) ---
`,k.forEach(P=>{let $=`${P.stock??0} packs`;P.loose!==void 0&&P.loose!==null&&P.loose>0&&($+=`, ${P.loose} loose`);let J=`- ${P.name} (Pack: ${P.pack??"N/A"}): ${$}`;const R=[];P.brand_name&&R.push(`Brand: ${P.brand_name}`),P.batch&&R.push(`Batch: ${P.batch}`),P.expiry_date&&R.push(`Exp: ${P.expiry_date}`),R.length>0&&(J+=` [${R.join(", ")}]`),F+=`${J}
`}),T+=F);let B="";D&&Array.isArray(D)&&D.length>0&&(B=`

--- Available Lab Tests (with Parameters) ---
`,D.forEach(P=>{B+=`- ${P.name} (Price: ${P.price??"N/A"})
`,P.default_parameters&&Array.isArray(P.default_parameters)&&P.default_parameters.length>0&&P.default_parameters.forEach($=>{let J=`    * ${$.name}`;$.unit&&(J+=` (${$.unit})`),$.normal_range?J+=` [Normal: ${$.normal_range}]`:$.lower_limit!==void 0&&$.upper_limit!==void 0&&$.lower_limit!==null&&$.upper_limit!==null&&(J+=` [Normal: ${$.lower_limit} - ${$.upper_limit}]`),B+=`${J}
`})}),T+=B);const G=[{text:LO}];g&&g.trim()!==""&&G.push({text:`--- Additional Clinic-Specific Instructions ---
${g}`});const C=[{text:T}];if(s){const P=new FileReader,$=await new Promise((J,R)=>{P.onloadend=()=>{typeof P.result=="string"?J(P.result.split(",")[1]):R(new Error("Failed to read image file as base64."))},P.onerror=R,P.readAsDataURL(s)});C.push({inlineData:{mimeType:s.type,data:$}})}const A=[];G.length>0&&A.push({role:"user",parts:G}),A.push({role:"user",parts:C});try{const P={model:$O,contents:A,generationConfig:{temperature:.7,maxOutputTokens:1024,responseMimeType:"text/plain"}},J=await(await MO()).models.generateContentStream(P);let R="";for await(const L of J)if(L&&typeof L.text=="function"){const M=L.text;M&&(R+=M)}else L&&L.candidates&&L.candidates[0]&&L.candidates[0].content&&L.candidates[0].content.parts&&L.candidates[0].content.parts[0]&&L.candidates[0].content.parts[0].text&&(R+=L.candidates[0].content.parts[0].text);if(R&&R.trim()!=="")return R.trim();throw console.error("Empty or invalid response received from Gemini API stream."),new Error("Failed to get suggestion from AI (Gemini). Empty or invalid stream response.")}catch(P){console.error("Error calling Gemini API:",P);let $="Failed to get suggestion from Gemini.";throw P.message&&($=`Error processing Gemini request: ${P.message}`),new Error($)}}const UO=t=>{if(!t)return 1;const s=t.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return s?parseInt(s[1],10):1},qO=y.forwardRef(({recordId:t,patientId:s,patientDetails:n,caseSummary:r,caseSummaryUpdatedAt:o,clinicSettings:u,userMessages:c,selectedImageFile:d,pendingLabOrders:p,labReports:m,pastComplaints:f,pharmacyOrders:g,pharmacyInventory:x,labInventory:j,recurringMedications:N,currentComplaint:k,setCurrentComplaint:D,setAiResponse:_,setAiResponseText:T,setAiResponseJsonString:E,setShowAiJsonDetails:U,setIsLoadingAi:X,setAiError:I,setIsSubmittingAiOrder:F,setAiOrderSubmissionStatus:B,setIsSubmittingAiLabOrder:G,setAiLabOrderSubmissionStatus:C,setIsSubmittingAiComplaint:A,setAiComplaintSubmissionStatus:P,setIsUpdatingCaseSummary:$,setAiCaseSummaryUpdateStatus:J,setCaseSummary:R,setIsUpdatingAiMemoryByAI:L,setAiMemoryUpdateByAIStatus:M,setFollowUpQuestion:Z,setFollowUpOptions:Q,setError:S,setIsSavingAiResponse:ge,setSaveAiResponseError:fe,fetchPharmacyOrdersData:w,fetchPendingLabOrdersData:ue,fetchLabReportsData:Ne,fetchRecurringMedicationsData:K,fetchPastComplaintsData:Y,fetchPatientDetails:V,setClinicSettings:oe,setEditedAiMemory:Pe,setCanUndo:se,onAiActionSuccess:Ce,addMessage:ee},je)=>{const[Ie,$e]=en.useState(null);en.useEffect(()=>{se(!!Ie)},[Ie,se]);let Fe;const Be=async(xe,he,W,O=0)=>{let te;const ke=["AI response did not contain a recognized function call","AI response did not result in a recognized or performed function call"].some(Ue=>{var Qe;return(Qe=he.message)==null?void 0:Qe.includes(Ue)});W&&ke?te=`AI Error: ${he.message}

${W}`:(te=`I encountered a frontend error while trying to execute the '${xe}' function. The error message is: "${he.message}". Based on this error, please analyze what went wrong and either correct the function call and try again, or explain the problem.`,(xe==="create_pharmacy_order"||xe==="edit_pharmacy_order")&&(te+=`

IMPORTANT: When ordering medication, please first check if the medication ordered matches the exact name given in the inventory. If the name itself is not given in the inventory, you can use 'prescription_for_unavailable_drugs' to write a prescription. **NOTE:** This field MUST be formatted as a Markdown table (columns: Drug Name, Quantity, Dosage, Directions).`),W&&(te+=`

The original AI response that caused the error was:
\`\`\`
${W}
\`\`\``)),ee==null||ee({role:"system",type:"error",content:`AI Error: ${he.message}. Retrying...`}),await Fe(te,O+1)},qe=async xe=>{console.log("Executing Rollback for actions:",xe);for(const he of xe){const{actionType:W,undoData:O}=he;if(console.log(`Attempting to rollback ${W}`,O),!O){console.warn(`No undoData found for action ${W}, skipping.`);continue}try{if(W==="create_pharmacy_order")O!=null&&O.orderId?(console.log(`Deleting pharmacy order ${O.orderId}`),await ae(`/api/pharmacy-orders/${O.orderId}`,{method:"DELETE"}),w(s)):console.error("Missing orderId for create_pharmacy_order rollback");else if(W==="create_lab_order")O!=null&&O.orderId?(console.log(`Deleting lab order ${O.orderId}`),await ae(`/api/lab/orders/${O.orderId}`,{method:"DELETE"}),ue(s)):console.error("Missing orderId for create_lab_order rollback");else if(W==="update_patient_details")if(O!=null&&O.patientId&&(O!=null&&O.originalDetails)){console.log(`Reverting patient details for ${O.patientId}`);const te=O.originalDetails,re={name:te.name,age:te.age,gender:te.gender,phone:te.phone,ai_response:te.ai_response};await ae(`/api/patients/${O.patientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)}),V(O.patientId)}else console.error("Missing patientId or originalDetails for update_patient_details rollback");else if(W==="add_complaint_history")O!=null&&O.recordId?(console.log(`Reverting complaint history for ${O.recordId}`),await ae(`/api/queue/doctor/complaint/${O.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:O.originalComplaint||""})}),D(O.originalComplaint||"")):console.error("Missing recordId for add_complaint_history rollback");else if(W==="update_case_summary")O!=null&&O.recordId?(console.log(`Reverting case summary for ${O.recordId}`),await ae(`/api/queue/doctor/complaint/${O.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:O.originalSummary||""})}),R(O.originalSummary||"")):console.error("Missing recordId for update_case_summary rollback");else if(W==="update_clinic_ai_memory")(O==null?void 0:O.originalMemory)!==void 0?(console.log("Reverting AI memory"),await ae("/api/clinics/settings",{method:"PUT",body:JSON.stringify({...u,aiMemory:O.originalMemory})}),Pe(O.originalMemory)):console.error("Missing originalMemory for update_clinic_ai_memory rollback");else if(W==="edit_pharmacy_order")if(O!=null&&O.orderId&&(O!=null&&O.originalState)){console.log(`Reverting pharmacy order ${O.orderId}`);const te={items:O.originalState.medications||[],status:O.originalState.status,prescription_for_unavailable_drugs:O.originalState.prescription_for_unavailable_drugs,order_total:O.originalState.order_total};await ae(`/api/pharmacy-orders/${O.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)}),w(s)}else console.error("Missing orderId or originalState for edit_pharmacy_order rollback");else if(W==="edit_lab_order")if(O!=null&&O.orderId&&(O!=null&&O.originalState)){console.log(`Reverting lab order ${O.orderId}`);const te={tests:O.originalState.tests,status:O.originalState.status};await ae(`/api/lab/orders/${O.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)}),ue(s)}else console.error("Missing orderId or originalState for edit_lab_order rollback");else if(W==="create_recurring_medication_order")if(O!=null&&O.createdIds&&O.createdIds.length>0){console.log(`Deleting recurring medications: ${O.createdIds.join(", ")}`);for(const te of O.createdIds)await ae(`/api/recurring-medications/${te}`,{method:"DELETE"});s&&K&&K(s)}else console.error("Missing createdIds for create_recurring_medication_order rollback");else W==="edit_recurring_medication_order"?O!=null&&O.medicationId&&(O!=null&&O.originalState)?(console.log(`Reverting recurring medication ${O.medicationId}`),await ae(`/api/recurring-medications/${O.medicationId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(O.originalState)}),s&&K&&K(s)):console.error("Missing medicationId or originalState for edit_recurring_medication_order rollback"):console.warn(`Unknown action type for rollback: ${W}`)}catch(te){console.error(`Failed to rollback ${W}:`,te)}}},et=async()=>{!Ie||!window.confirm("Are you sure you want to undo the last AI actions?")||(X(!0),await qe([...Ie].reverse()),$e(null),X(!1),I("Last actions undone successfully."))},ye=async(xe,he)=>{$e(null),B(null),C(null),P(null),J(null),M(null),Z(null),Q([]),S(null);let W=null;const O=/```json\s*([\s\S]*?)\s*```/,te=xe.match(O);if(te&&te[1])W=te[1];else{const re=xe.trim();if(re.startsWith("{")&&re.endsWith("}"))W=re;else if(re.startsWith("[")&&re.endsWith("]"))W=re;else throw new Error("AI response did not contain a recognized function call.")}if(W)try{const re=JSON.parse(W),ke=de=>{const we=[],Ae=Array.isArray(de)?de:[de];for(const Re of Ae)Re&&(Re.actions&&Array.isArray(Re.actions)?we.push(...ke(Re.actions)):Re.sub_actions&&Array.isArray(Re.sub_actions)?we.push(...ke(Re.sub_actions)):Re.function_calls&&Array.isArray(Re.function_calls)?we.push(...ke(Re.function_calls)):typeof Re.action=="string"&&we.push(Re));return we},Ue=ke(re),Qe=[];let Ze=null,lt=!1;for(const de of Ue){if(de.action==="ask_followup_question"){Ze=de,lt=!0;continue}lt=!0;const we=de.action;we==="update_clinic_ai_memory"&&typeof de.memory_content=="string"?Qe.push((async()=>{L(!0),M("Processing AI mem..."),ee==null||ee({role:"system",type:"loading",content:"Processing AI memory..."});const Ae=(u==null?void 0:u.aiMemory)||"";try{if(!u)throw new Error("Clinic settings not loaded.");const Re={...u,aiMemory:de.memory_content.trim(),admissionCharge:u.admissionCharge,perDayCharge:u.perDayCharge,otherCharges:u.otherCharges,clinicWideSystemPrompt:u.clinicWideSystemPrompt},at=await ae("/api/clinics/settings",{method:"PUT",body:JSON.stringify(Re)});if(!at.ok){const Je=await at.json().catch(()=>({}));throw new Error(Je.message||`AI-triggered clinic memory update failed: ${at.statusText}`)}const tt=await at.json();return oe(Je=>Je?{...Je,aiMemory:tt.settings.aiMemory}:null),Pe(tt.settings.aiMemory||""),M("AI mem updated!"),ee==null||ee({role:"system",type:"success",content:"AI memory updated successfully."}),{success:!0,actionType:we,undoData:{originalMemory:Ae}}}catch(Re){return M("Failed"),{success:!1,actionType:we,error:Re,originalActionPayload:de}}finally{L(!1)}})()):we==="create_pharmacy_order"?Qe.push((async()=>{var Ae,Re;F(!0),B("Processing order..."),ee==null||ee({role:"system",type:"loading",content:"Processing pharmacy order..."});try{if(!s)throw new Error("Missing patient ID.");const at=[];let tt=null;if(Array.isArray(de.items))for(const nt of de.items){let Xe;if(nt.drug_id?Xe=x.find(Dr=>Dr.id===nt.drug_id):nt.name&&(Xe=br(nt.name,x)),!Xe){tt=`Drug "${nt.name||nt.drug_id}" not found.`;break}const At=UO(Xe.pack),Qt=Number(Xe.mrp),kt=Qt,Xt=At>0?Qt/At:0,sn=Number(nt.pack_quantity)||0,cn=Number(nt.loose_quantity)||0,La=sn*kt+cn*Xt;at.push({drug_id:String(Xe.id),name:Xe.name,pack_quantity:sn,loose_quantity:cn,tabletsPerDay:nt.tabletsPerDay,numberOfDays:nt.numberOfDays,directions_to_use:nt.directions_to_use,group_id:nt.group_id,pack_price:kt,loose_price:Xt,total_price:La,price:Qt,isLoose:nt.isLoose,unit:Xe.pack})}if(tt)throw new Error(tt);const Je=at.reduce((nt,Xe)=>nt+Xe.total_price,0),wt={patient_id:s,items:at,prescription_for_unavailable_drugs:de.prescription_for_unavailable_drugs,order_total:parseFloat(Je.toFixed(2))},Mt=await ae("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(wt)});if(!Mt.ok){const nt=await Mt.json().catch(()=>({}));throw new Error(nt.message||"Order creation failed.")}const pt=await Mt.json();return B("Order created!"),w(s),ee==null||ee({role:"system",type:"success",content:"Pharmacy order created successfully."}),{success:!0,actionType:we,data:pt,undoData:{orderId:((Re=(Ae=pt.orders)==null?void 0:Ae[0])==null?void 0:Re.id)||pt.id}}}catch(at){return ee==null||ee({role:"system",type:"error",content:`Pharmacy order failed: ${at.message}`}),{success:!1,actionType:we,error:at,originalActionPayload:de}}finally{F(!1)}})()):we==="update_patient_details"?Qe.push((async()=>{X(!0),ee==null||ee({role:"system",type:"loading",content:"Updating patient details..."});const Ae={...n};try{if(!s)throw new Error("Missing patient ID.");const Re={};if(de.name&&(Re.name=de.name),de.age&&(Re.age=de.age),de.gender&&(Re.gender=de.gender),de.phone_number!==void 0&&(Re.phone_number=de.phone_number),!(await ae(`/api/patients/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Re)})).ok)throw new Error("Patient update failed.");return V(s),ee==null||ee({role:"system",type:"success",content:"Patient details updated."}),{success:!0,actionType:we,undoData:{patientId:s,originalDetails:Ae}}}catch(Re){return{success:!1,actionType:we,error:Re,originalActionPayload:de}}finally{X(!1)}})()):we==="create_lab_order"?Qe.push((async()=>{G(!0),C("Processing lab..."),ee==null||ee({role:"system",type:"loading",content:"Processing lab order..."});try{if(!s)throw new Error("Missing patient ID.");const Ae=[];for(const tt of de.tests||[]){let Je;if(tt.id?Je=j.find(wt=>String(wt.id)===String(tt.id)):tt.name&&(Je=br(tt.name,j)),!Je)throw new Error(`Lab test "${tt.name}" not found.`);Ae.push({id:Je.id,name:Je.name,price:Number(Je.price)})}const Re=await ae("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:s,tests:Ae})});if(!Re.ok)throw new Error("Lab order creation failed.");const at=await Re.json();return C("Success!"),ue(s),ee==null||ee({role:"system",type:"success",content:"Lab order created."}),{success:!0,actionType:we,data:at.labOrder,undoData:{orderId:at.labOrder.id}}}catch(Ae){return ee==null||ee({role:"system",type:"error",content:`Lab order failed: ${Ae.message}`}),{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{G(!1)}})()):we==="create_lab_report"?Qe.push((async()=>{G(!0),C("Creating Report..."),ee==null||ee({role:"system",type:"loading",content:"Creating lab report..."});try{if(!s)throw new Error("Missing patient ID.");const Ae=[],Re=de.tests||[];for(const pt of Re){let nt;if(pt.id?nt=j.find(Xe=>String(Xe.id)===String(pt.id)):pt.name&&(nt=br(pt.name,j)),!nt)throw new Error(`Lab test "${pt.name}" not found.`);pt._matchedTest=nt,Ae.push({id:nt.id,name:nt.name,price:Number(nt.price)})}const at=await ae("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:s,tests:Ae,status:"reported"})});if(!at.ok)throw new Error("Lab order creation failed during report generation.");const tt=await at.json(),Je=tt.labOrder.id,wt={};if(Re.forEach(pt=>{const nt=pt._matchedTest,Xe=nt.id,At=pt.parameters||[],Qt={};nt.default_parameters&&nt.default_parameters.forEach(kt=>{kt.defaultValue!==void 0&&kt.defaultValue!==null&&(Qt[kt.name]=kt.defaultValue)}),At.forEach(kt=>{kt.name&&kt.value!==void 0&&(Qt[kt.name]=kt.value)}),wt[Xe]=Qt}),!(await ae(`/api/lab/${Je}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(wt)})})).ok)throw new Error("Report submission failed.");return C("Report Created!"),ue(s),Ne(s),ee==null||ee({role:"system",type:"success",content:"Lab report created successfully."}),{success:!0,actionType:we,data:tt.labOrder,undoData:{orderId:Je}}}catch(Ae){return ee==null||ee({role:"system",type:"error",content:`Lab report failed: ${Ae.message}`}),{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{G(!1)}})()):we==="edit_lab_report"?Qe.push((async()=>{G(!0),C("Updating Report...");try{const Ae=de.serialNumber;if(!Ae)throw new Error("Missing serial number for lab report edit.");const Re=new Map;(p??[]).forEach(At=>Re.set(At.id,{...At})),(m??[]).forEach(At=>{if(Re.has(At.id)){const Qt=Re.get(At.id);Qt.report=At,Qt.status=At.status}else Re.set(At.id,{...At,createdAt:At.createdAt})});const at=Array.from(Re.values());at.sort((At,Qt)=>new Date(Qt.createdAt).getTime()-new Date(At.createdAt).getTime());const tt=at.length-Ae,Je=at[tt];if(!Je)throw new Error(`Lab report #${Ae} not found.`);const wt=Je.id;let Mt={};if(Je.report&&Je.report.report_content)try{Mt=typeof Je.report.report_content=="string"?JSON.parse(Je.report.report_content):Je.report.report_content}catch{}const pt={...Mt};if((de.tests||[]).forEach(At=>{let kt=(Je.tests||[]).find(cn=>cn.name.toLowerCase()===At.name.toLowerCase());if(!kt)return;const Xt=kt.id,sn=At.parameters||[];pt[Xt]||(pt[Xt]={}),sn.forEach(cn=>{cn.name&&cn.value!==void 0&&(pt[Xt][cn.name]=cn.value)})}),!(await ae(`/api/lab/${wt}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(pt)})})).ok)throw new Error("Report update failed.");return C("Report Updated!"),ue(s),Ne(s),ee==null||ee({role:"system",type:"success",content:"Lab report updated successfully."}),{success:!0,actionType:we,data:{orderId:wt},undoData:{orderId:wt}}}catch(Ae){return ee==null||ee({role:"system",type:"error",content:`Update report failed: ${Ae.message}`}),{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{G(!1)}})()):we==="edit_pharmacy_order"?Qe.push((async()=>{F(!0);try{const Ae=de.serialNumber;let Re;if(Ae?Re=[...g].sort((Xe,At)=>new Date(Xe.date).getTime()-new Date(At.date).getTime())[Ae-1]:Re=g.find(nt=>nt.status==="pending"),!Re)throw new Error("Order to edit not found.");const at=JSON.parse(JSON.stringify(Re));let tt=[...Re.medications];const Je=de.items_to_remove,wt=de.items;if(Array.isArray(Je)&&(tt=tt.filter(nt=>!Je.some(Xe=>Xe.drug_id&&String(nt.drug_id)===String(Xe.drug_id)||Xe.name&&nt.name.toLowerCase()===Xe.name.toLowerCase()))),Array.isArray(wt))for(const nt of wt){let Xe;if(nt.drug_id?Xe=x.find(kt=>String(kt.id)===String(nt.drug_id)):nt.name&&(Xe=br(nt.name,x)),!Xe)throw new Error(`Drug ${nt.name} not found.`);const At=tt.findIndex(kt=>kt.drug_id===String(Xe==null?void 0:Xe.id)),Qt={drug_id:String(Xe.id),name:Xe.name,pack_quantity:nt.pack_quantity||0,loose_quantity:nt.loose_quantity||0,pack_price:Number(Xe.mrp),loose_price:0,total_price:0,price:Number(Xe.mrp)};At>=0?tt[At]={...tt[At],...Qt}:tt.push(Qt)}const Mt={items:tt,status:de.status,prescription_for_unavailable_drugs:de.prescription_for_unavailable_drugs,order_total:0};if(!(await ae(`/api/pharmacy-orders/${Re.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Mt)})).ok)throw new Error("Order edit failed.");return w(s),{success:!0,actionType:we,undoData:{orderId:Re.id,originalState:at}}}catch(Ae){return{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{F(!1)}})()):we==="edit_lab_order"?Qe.push((async()=>{G(!0);try{const Ae=p.sort((Je,wt)=>new Date(wt.createdAt).getTime()-new Date(Je.createdAt).getTime()).find(Je=>Je.status==="pending");if(!Ae)throw new Error("No pending lab order to edit.");const Re=JSON.parse(JSON.stringify(Ae)),at={tests:[],status:de.status};if(!(await ae(`/api/lab/orders/${Ae.id}`,{method:"PUT",body:JSON.stringify(at),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Lab edit failed.");return ue(s),{success:!0,actionType:we,undoData:{orderId:Ae.id,originalState:Re}}}catch(Ae){return{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{G(!1)}})()):we==="add_complaint_history"?Qe.push((async()=>{A(!0),ee==null||ee({role:"system",type:"loading",content:"Updating complaint history..."});const Ae=k;try{if(!t)throw new Error("No record ID.");if(!(await ae(`/api/queue/doctor/complaint/${t}`,{method:"PUT",body:JSON.stringify({complaint:de.complaint}),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Complaint update failed.");return D(de.complaint),s&&Y(s),ee==null||ee({role:"system",type:"success",content:"Complaint history updated."}),{success:!0,actionType:we,undoData:{recordId:t,originalComplaint:Ae}}}catch(Re){return ee==null||ee({role:"system",type:"error",content:`Complaint history update failed: ${Re.message}`}),{success:!1,actionType:we,error:Re,originalActionPayload:de}}finally{A(!1)}})()):we==="update_case_summary"?Qe.push((async()=>{$(!0),ee==null||ee({role:"system",type:"loading",content:"Updating case summary..."});const Ae=r;try{if(!t)throw new Error("No record ID.");const Re=await ae(`/api/queue/doctor/complaint/${t}`,{method:"PUT",body:JSON.stringify({case_summary:de.summary}),headers:{"Content-Type":"application/json"}});if(!Re.ok)throw new Error("Summary update failed.");const at=await Re.json();return R(at.case_summary),ee==null||ee({role:"system",type:"success",content:"Case summary updated."}),{success:!0,actionType:we,undoData:{recordId:t,originalSummary:Ae}}}catch(Re){return ee==null||ee({role:"system",type:"error",content:`Case summary update failed: ${Re.message}`}),{success:!1,actionType:we,error:Re,originalActionPayload:de}}finally{$(!1)}})()):we==="create_recurring_medication_order"?Qe.push((async()=>{F(!0),B("Creating recurring medication(s)..."),ee==null||ee({role:"system",type:"loading",content:"Creating recurring medication(s)..."});try{if(!s)throw new Error("Missing patient ID.");if(!de.items||!Array.isArray(de.items))throw new Error("No items provided for recurring medication order.");const Ae=await Promise.all(de.items.map(async Je=>{let wt=Je.drug_id;if(!wt){const Mt=br(Je.medication_name,x);wt=Mt?Mt.id:null}if(!wt)throw new Error(`Drug "${Je.medication_name}" not found in inventory for recurring medication.`);return{...Je,drug_id:wt}})),Re=await ae("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:s,items:Ae})});if(!Re.ok){const Je=await Re.json().catch(()=>({}));throw new Error(Je.message||"Failed to create recurring medication order")}const at=await Re.json(),tt=at.map(Je=>Je.id);return s&&K&&K(s),B("Recurring medication(s) created."),ee==null||ee({role:"system",type:"success",content:`Successfully created ${tt.length} recurring medication(s).`}),{success:!0,actionType:we,data:at,undoData:{createdIds:tt}}}catch(Ae){return ee==null||ee({role:"system",type:"error",content:`Error creating recurring medication: ${Ae.message}`}),{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{F(!1)}})()):we==="edit_recurring_medication_order"?Qe.push((async()=>{F(!0),B("Updating recurring medication..."),ee==null||ee({role:"system",type:"loading",content:"Updating recurring medication..."});try{if(!s)throw new Error("Missing patient ID.");if(!de.serialNumber||!de.updates)throw new Error("Missing serialNumber or updates for recurring medication edit.");if(!N||N.length===0)throw new Error("No recurring medications found to edit.");const Ae=de.serialNumber-1;if(Ae<0||Ae>=N.length)throw new Error(`Recurring medication with serial number ${de.serialNumber} not found.`);const Re=N[Ae],at=JSON.parse(JSON.stringify(Re));if(de.updates.drug_id===null||de.updates.medication_name){let Je=de.updates.drug_id;if(!Je&&de.updates.medication_name){const wt=br(de.updates.medication_name,x);Je=wt?wt.id:null}if(!Je&&de.updates.medication_name)throw new Error(`Drug "${de.updates.medication_name}" not found in inventory for update.`);de.updates.drug_id=Je}const tt=await ae(`/api/recurring-medications/${Re.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(de.updates)});if(!tt.ok){const Je=await tt.json().catch(()=>({}));throw new Error(Je.message||"Failed to update recurring medication")}return s&&K&&K(s),B("Recurring medication updated."),ee==null||ee({role:"system",type:"success",content:`Successfully updated recurring medication #${de.serialNumber}.`}),{success:!0,actionType:we,data:{id:Re.id,...de.updates},undoData:{medicationId:Re.id,originalState:at}}}catch(Ae){return ee==null||ee({role:"system",type:"error",content:`Error updating recurring medication: ${Ae.message}`}),{success:!1,actionType:we,error:Ae,originalActionPayload:de}}finally{F(!1)}})()):we==="end_task"?Qe.push((async()=>(ee==null||ee({role:"system",type:"success",content:"Task completed."}),{success:!0,actionType:we}))()):(console.warn(`Unknown action ${we}`),Qe.push(Promise.resolve({success:!1,actionType:we,error:new Error(`Unknown action: ${we}`),originalActionPayload:de})))}const le=await Promise.all(Qe),pe=le.filter(de=>!de.success);if(pe.length>0){console.log("AI Actions Failed. Initiating Rollback...",pe);const de=le.filter(tt=>tt.success),we=[...de].reverse();await qe(we);const Ae=pe.map(tt=>{var Je;return`${tt.actionType}: ${(Je=tt.error)==null?void 0:Je.message}`}).join("; "),Re=de.length>0?` I successfully rolled back ${de.length} other actions that succeeded.`:"",at=`One or more actions failed: [${Ae}].${Re} Please analyze the failure and try again.`;await Be("multiple_actions",{message:at},xe,he)}else{const de=le.filter(we=>we.success);if(de.length>0&&($e(de),Ce&&de.forEach(we=>Ce(we.actionType))),Ze&&typeof Ze.question=="string")Z(Ze.question),Q(Array.isArray(Ze.options)?Ze.options:[]);else if(!lt)throw new Error("AI response did not result in a recognized or performed function call.")}}catch(re){await Be("parse_json_actions",re,xe,he)}else throw new Error("AI response did not contain a recognized function call.")};Fe=async(xe,he=0)=>{if(he>1){I("AI call failed after multiple retries. Please try a different prompt."),X(!1);return}X(!0),I(null);let W;const te=[...c,xe].join(`

`);try{const re=new Map;(p??[]).forEach(pe=>{re.set(pe.id,{...pe})}),(m??[]).forEach(pe=>{if(!re.has(pe.id))re.set(pe.id,{id:pe.id,patient_id:pe.patient_id,tests:pe.tests,status:pe.status,createdAt:pe.createdAt,report:pe});else{const de=re.get(pe.id);de&&(de.report=pe,de.status=pe.status)}});const ke=Array.from(re.values());ke.sort((pe,de)=>new Date(de.createdAt).getTime()-new Date(pe.createdAt).getTime());const Ue=ke.map((pe,de)=>{let we=null;if(pe.report)try{const Ae=typeof pe.report.report_content=="string"?pe.report.report_content:JSON.stringify(pe.report.report_content||{}),Re=JSON.parse(Ae||"{}"),at=tt=>{const Je=Re[tt.id]||{},wt=Mt=>({name:Mt.name,value:Je[Mt.name]!==void 0?String(Je[Mt.name]):String(Mt.defaultValue),normal_range:Mt.normal_range||"N/A"});return{testId:tt.id,testName:tt.name,parameters:(tt.default_parameters||[]).map(wt)}};we={reportId:pe.report.reportId,reportDate:pe.report.report_date,tests:(pe.tests||[]).map(at)}}catch{we={reportId:pe.report.reportId,reportDate:pe.report.report_date,reportContent:typeof pe.report.report_content=="string"?pe.report.report_content:JSON.stringify(pe.report.report_content),error:"Failed to parse report content JSON."}}return{serialNumber:ke.length-de,orderId:pe.id,orderDate:isNaN(new Date(pe.createdAt).getTime())?pe.createdAt:new Date(pe.createdAt).toISOString(),tests:pe.tests.map(Ae=>({id:Ae.id,name:Ae.name,price:Ae.price})),status:pe.status,report:we}}),Qe=f.map(pe=>{try{return{...pe,createdAt:isNaN(new Date(pe.createdAt).getTime())?pe.createdAt:new Date(pe.createdAt).toISOString()}}catch{return pe}}),lt=[...g].sort((pe,de)=>{const we=new Date(pe.date).getTime(),Ae=new Date(de.date).getTime();return we-Ae}).map((pe,de)=>{try{return{serialNumber:de+1,...pe,date:pe.date&&!isNaN(new Date(pe.date).getTime())?new Date(pe.date).toISOString():pe.date}}catch{return{serialNumber:de+1,...pe}}}),le={query:te,currentDateTime:new Date().toISOString(),patientName:(n==null?void 0:n.name)||"",patientAge:(n==null?void 0:n.age)||void 0,patientGender:(n==null?void 0:n.gender)||void 0,case_summary:r||"",case_summary_last_updated:o?new Date(o).toISOString():void 0,clinic_ai_memory:(u==null?void 0:u.aiMemory)||"",clinic_ai_memory_last_updated:u!=null&&u.aiMemoryUpdatedAt?new Date(u.aiMemoryUpdatedAt).toISOString():void 0,clinic_wide_system_prompt:(u==null?void 0:u.clinicWideSystemPrompt)||"",labHistory:Ue,pharmacyOrders:lt,pastComplaints:Qe,pharmacyInventory:x,labInventory:j,recurringMedications:N};if(console.log("DEBUG: Payload before sending to Gemini API:",JSON.stringify(le,null,2)),W=await BO(le,d),W){_(W),ee==null||ee({role:"ai",content:W});const pe=/```json\s*([\s\S]*?)\s*```/,de=W.match(pe);if(de&&de[1])T(W.replace(pe,"").trim()),E(de[1].trim());else{const we=W.trim();if(we.startsWith("{")&&we.endsWith("}"))try{JSON.parse(we),T(""),E(we)}catch{T(we),E(null)}else if(we.startsWith("[")&&we.endsWith("]"))try{JSON.parse(we),T(""),E(we)}catch{T(we),E(null)}else T(we),E(null)}U(!1),s&&W&&await Oe(s,W),await ye(W,he),D("")}else throw new Error("Invalid AI response format.")}catch(re){await Be("call_generative_api",re,W,he)}finally{X(!1)}};const Oe=async(xe,he)=>{ge(!0),fe(null);try{const W={ai_response:he},O=await ae(`/api/patients/${xe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)});if(!O.ok){const te=await O.json().catch(()=>({}));throw new Error(te.message||`Failed to save AI response to patient: ${O.statusText}`)}}catch(W){fe(`AI Response Save Error: ${W.message}`),ee==null||ee({role:"system",type:"error",content:`AI Response Save Error: ${W.message}`})}finally{ge(!1)}};return y.useImperativeHandle(je,()=>({callGenerativeApi:Fe,undoLastAction:et})),null}),m1=-1,qd=0,bc=1,Dd=2,Hf=3,Vf=4,Gf=5,Qf=6,p1=7,f1=8,Dj=typeof self=="object"?self:globalThis,HO=(t,s)=>{const n=(o,u)=>(t.set(u,o),o),r=o=>{if(t.has(o))return t.get(o);const[u,c]=s[o];switch(u){case qd:case m1:return n(c,o);case bc:{const d=n([],o);for(const p of c)d.push(r(p));return d}case Dd:{const d=n({},o);for(const[p,m]of c)d[r(p)]=r(m);return d}case Hf:return n(new Date(c),o);case Vf:{const{source:d,flags:p}=c;return n(new RegExp(d,p),o)}case Gf:{const d=n(new Map,o);for(const[p,m]of c)d.set(r(p),r(m));return d}case Qf:{const d=n(new Set,o);for(const p of c)d.add(r(p));return d}case p1:{const{name:d,message:p}=c;return n(new Dj[d](p),o)}case f1:return n(BigInt(c),o);case"BigInt":return n(Object(BigInt(c)),o);case"ArrayBuffer":return n(new Uint8Array(c).buffer,c);case"DataView":{const{buffer:d}=new Uint8Array(c);return n(new DataView(d),c)}}return n(new Dj[u](c),o)};return r},Ej=t=>HO(new Map,t)(0),_l="",{toString:VO}={},{keys:GO}=Object,hc=t=>{const s=typeof t;if(s!=="object"||!t)return[qd,s];const n=VO.call(t).slice(8,-1);switch(n){case"Array":return[bc,_l];case"Object":return[Dd,_l];case"Date":return[Hf,_l];case"RegExp":return[Vf,_l];case"Map":return[Gf,_l];case"Set":return[Qf,_l];case"DataView":return[bc,n]}return n.includes("Array")?[bc,n]:n.includes("Error")?[p1,n]:[Dd,n]},dd=([t,s])=>t===qd&&(s==="function"||s==="symbol"),QO=(t,s,n,r)=>{const o=(c,d)=>{const p=r.push(c)-1;return n.set(d,p),p},u=c=>{if(n.has(c))return n.get(c);let[d,p]=hc(c);switch(d){case qd:{let f=c;switch(p){case"bigint":d=f1,f=c.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+p);f=null;break;case"undefined":return o([m1],c)}return o([d,f],c)}case bc:{if(p){let x=c;return p==="DataView"?x=new Uint8Array(c.buffer):p==="ArrayBuffer"&&(x=new Uint8Array(c)),o([p,[...x]],c)}const f=[],g=o([d,f],c);for(const x of c)f.push(u(x));return g}case Dd:{if(p)switch(p){case"BigInt":return o([p,c.toString()],c);case"Boolean":case"Number":case"String":return o([p,c.valueOf()],c)}if(s&&"toJSON"in c)return u(c.toJSON());const f=[],g=o([d,f],c);for(const x of GO(c))(t||!dd(hc(c[x])))&&f.push([u(x),u(c[x])]);return g}case Hf:return o([d,c.toISOString()],c);case Vf:{const{source:f,flags:g}=c;return o([d,{source:f,flags:g}],c)}case Gf:{const f=[],g=o([d,f],c);for(const[x,j]of c)(t||!(dd(hc(x))||dd(hc(j))))&&f.push([u(x),u(j)]);return g}case Qf:{const f=[],g=o([d,f],c);for(const x of c)(t||!dd(hc(x)))&&f.push(u(x));return g}}const{message:m}=c;return o([d,{name:p,message:m}],c)};return u},Tj=(t,{json:s,lossy:n}={})=>{const r=[];return QO(!(s||n),!!s,new Map,r)(t),r},wc=typeof structuredClone=="function"?(t,s)=>s&&("json"in s||"lossy"in s)?Ej(Tj(t,s)):structuredClone(t):(t,s)=>Ej(Tj(t,s)),g1=y1("end"),x1=y1("start");function y1(t){return s;function s(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function b1(t){const s=x1(t),n=g1(t);if(s&&n)return{start:s,end:n}}const yr=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],Aj={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...yr,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...yr],h2:[["className","sr-only"]],img:[...yr,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...yr,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...yr],table:[...yr],ul:[...yr,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},zi={}.hasOwnProperty;function YO(t,s){let n={type:"root",children:[]};const r={schema:s?{...Aj,...s}:Aj,stack:[]},o=j1(r,t);return o&&(Array.isArray(o)?o.length===1?n=o[0]:n.children=o:n=o),n}function j1(t,s){if(s&&typeof s=="object"){const n=s;switch(typeof n.type=="string"?n.type:""){case"comment":return JO(t,n);case"doctype":return XO(t,n);case"element":return KO(t,n);case"root":return WO(t,n);case"text":return ZO(t,n)}}}function JO(t,s){if(t.schema.allowComments){const n=typeof s.value=="string"?s.value:"",r=n.indexOf("-->"),u={type:"comment",value:r<0?n:n.slice(0,r)};return Pc(u,s),u}}function XO(t,s){if(t.schema.allowDoctypes){const n={type:"doctype"};return Pc(n,s),n}}function KO(t,s){const n=typeof s.tagName=="string"?s.tagName:"";t.stack.push(n);const r=v1(t,s.children),o=e6(t,s.properties);t.stack.pop();let u=!1;if(n&&n!=="*"&&(!t.schema.tagNames||t.schema.tagNames.includes(n))&&(u=!0,t.schema.ancestors&&zi.call(t.schema.ancestors,n))){const d=t.schema.ancestors[n];let p=-1;for(u=!1;++p<d.length;)t.stack.includes(d[p])&&(u=!0)}if(!u)return t.schema.strip&&!t.schema.strip.includes(n)?r:void 0;const c={type:"element",tagName:n,properties:o,children:r};return Pc(c,s),c}function WO(t,s){const r={type:"root",children:v1(t,s.children)};return Pc(r,s),r}function ZO(t,s){const r={type:"text",value:typeof s.value=="string"?s.value:""};return Pc(r,s),r}function v1(t,s){const n=[];if(Array.isArray(s)){const r=s;let o=-1;for(;++o<r.length;){const u=j1(t,r[o]);u&&(Array.isArray(u)?n.push(...u):n.push(u))}}return n}function e6(t,s){const n=t.stack[t.stack.length-1],r=t.schema.attributes,o=t.schema.required,u=r&&zi.call(r,n)?r[n]:void 0,c=r&&zi.call(r,"*")?r["*"]:void 0,d=s&&typeof s=="object"?s:{},p={};let m;for(m in d)if(zi.call(d,m)){const f=d[m];let g=Pj(t,Ij(u,m),m,f);g==null&&(g=Pj(t,Ij(c,m),m,f)),g!=null&&(p[m]=g)}if(o&&zi.call(o,n)){const f=o[n];for(m in f)zi.call(f,m)&&!zi.call(p,m)&&(p[m]=f[m])}return p}function Pj(t,s,n,r){return s?Array.isArray(r)?t6(t,s,n,r):N1(t,s,n,r):void 0}function t6(t,s,n,r){let o=-1;const u=[];for(;++o<r.length;){const c=N1(t,s,n,r[o]);(typeof c=="number"||typeof c=="string")&&u.push(c)}return u}function N1(t,s,n,r){if(!(typeof r!="boolean"&&typeof r!="number"&&typeof r!="string")&&n6(t,n,r)){if(typeof s=="object"&&s.length>1){let o=!1,u=0;for(;++u<s.length;){const c=s[u];if(c&&typeof c=="object"&&"flags"in c){if(c.test(String(r))){o=!0;break}}else if(c===r){o=!0;break}}if(!o)return}return t.schema.clobber&&t.schema.clobberPrefix&&t.schema.clobber.includes(n)?t.schema.clobberPrefix+r:r}}function n6(t,s,n){const r=t.schema.protocols&&zi.call(t.schema.protocols,s)?t.schema.protocols[s]:void 0;if(!r||r.length===0)return!0;const o=String(n),u=o.indexOf(":"),c=o.indexOf("?"),d=o.indexOf("#"),p=o.indexOf("/");if(u<0||p>-1&&u>p||c>-1&&u>c||d>-1&&u>d)return!0;let m=-1;for(;++m<r.length;){const f=r[m];if(u===f.length&&o.slice(0,f.length)===f)return!0}return!1}function Pc(t,s){const n=b1(s);s.data&&(t.data=wc(s.data)),n&&(t.position=n)}function Ij(t,s){let n,r=-1;if(t)for(;++r<t.length;){const o=t[r],u=typeof o=="string"?o:o[0];if(u===s)return o;u==="data*"&&(n=o)}if(s.length>4&&s.slice(0,4).toLowerCase()==="data")return n}function a6(t,s){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(s),!0)};return t.patch(s,n),t.applyData(s,n)}function s6(t,s){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(s,n),[t.applyData(s,n),{type:"text",value:`
`}]}function i6(t,s){const n=s.value?s.value+`
`:"",r={};s.lang&&(r.className=["language-"+s.lang]);let o={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return s.meta&&(o.data={meta:s.meta}),t.patch(s,o),o=t.applyData(s,o),o={type:"element",tagName:"pre",properties:{},children:[o]},t.patch(s,o),o}function r6(t,s){const n={type:"element",tagName:"del",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function l6(t,s){const n={type:"element",tagName:"em",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function o6(t,s){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(s.identifier).toUpperCase(),o=Vl(r.toLowerCase()),u=t.footnoteOrder.indexOf(r);let c,d=t.footnoteCounts.get(r);d===void 0?(d=0,t.footnoteOrder.push(r),c=t.footnoteOrder.length):c=u+1,d+=1,t.footnoteCounts.set(r,d);const p={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+o,id:n+"fnref-"+o+(d>1?"-"+d:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(c)}]};t.patch(s,p);const m={type:"element",tagName:"sup",properties:{},children:[p]};return t.patch(s,m),t.applyData(s,m)}function c6(t,s){const n={type:"element",tagName:"h"+s.depth,properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function u6(t,s){if(t.options.allowDangerousHtml){const n={type:"raw",value:s.value};return t.patch(s,n),t.applyData(s,n)}}function w1(t,s){const n=s.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(s.label||s.identifier)+"]"),s.type==="imageReference")return[{type:"text",value:"!["+s.alt+r}];const o=t.all(s),u=o[0];u&&u.type==="text"?u.value="["+u.value:o.unshift({type:"text",value:"["});const c=o[o.length-1];return c&&c.type==="text"?c.value+=r:o.push({type:"text",value:r}),o}function d6(t,s){const n=String(s.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return w1(t,s);const o={src:Vl(r.url||""),alt:s.alt};r.title!==null&&r.title!==void 0&&(o.title=r.title);const u={type:"element",tagName:"img",properties:o,children:[]};return t.patch(s,u),t.applyData(s,u)}function h6(t,s){const n={src:Vl(s.url)};s.alt!==null&&s.alt!==void 0&&(n.alt=s.alt),s.title!==null&&s.title!==void 0&&(n.title=s.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(s,r),t.applyData(s,r)}function m6(t,s){const n={type:"text",value:s.value.replace(/\r?\n|\r/g," ")};t.patch(s,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(s,r),t.applyData(s,r)}function p6(t,s){const n=String(s.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return w1(t,s);const o={href:Vl(r.url||"")};r.title!==null&&r.title!==void 0&&(o.title=r.title);const u={type:"element",tagName:"a",properties:o,children:t.all(s)};return t.patch(s,u),t.applyData(s,u)}function f6(t,s){const n={href:Vl(s.url)};s.title!==null&&s.title!==void 0&&(n.title=s.title);const r={type:"element",tagName:"a",properties:n,children:t.all(s)};return t.patch(s,r),t.applyData(s,r)}function g6(t,s,n){const r=t.all(s),o=n?x6(n):S1(s),u={},c=[];if(typeof s.checked=="boolean"){const f=r[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},r.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:s.checked,disabled:!0},children:[]}),u.className=["task-list-item"]}let d=-1;for(;++d<r.length;){const f=r[d];(o||d!==0||f.type!=="element"||f.tagName!=="p")&&c.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!o?c.push(...f.children):c.push(f)}const p=r[r.length-1];p&&(o||p.type!=="element"||p.tagName!=="p")&&c.push({type:"text",value:`
`});const m={type:"element",tagName:"li",properties:u,children:c};return t.patch(s,m),t.applyData(s,m)}function x6(t){let s=!1;if(t.type==="list"){s=t.spread||!1;const n=t.children;let r=-1;for(;!s&&++r<n.length;)s=S1(n[r])}return s}function S1(t){const s=t.spread;return s??t.children.length>1}function y6(t,s){const n={},r=t.all(s);let o=-1;for(typeof s.start=="number"&&s.start!==1&&(n.start=s.start);++o<r.length;){const c=r[o];if(c.type==="element"&&c.tagName==="li"&&c.properties&&Array.isArray(c.properties.className)&&c.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const u={type:"element",tagName:s.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(s,u),t.applyData(s,u)}function b6(t,s){const n={type:"element",tagName:"p",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function j6(t,s){const n={type:"root",children:t.wrap(t.all(s))};return t.patch(s,n),t.applyData(s,n)}function v6(t,s){const n={type:"element",tagName:"strong",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}function N6(t,s){const n=t.all(s),r=n.shift(),o=[];if(r){const c={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(s.children[0],c),o.push(c)}if(n.length>0){const c={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},d=x1(s.children[1]),p=g1(s.children[s.children.length-1]);d&&p&&(c.position={start:d,end:p}),o.push(c)}const u={type:"element",tagName:"table",properties:{},children:t.wrap(o,!0)};return t.patch(s,u),t.applyData(s,u)}function w6(t,s,n){const r=n?n.children:void 0,u=(r?r.indexOf(s):1)===0?"th":"td",c=n&&n.type==="table"?n.align:void 0,d=c?c.length:s.children.length;let p=-1;const m=[];for(;++p<d;){const g=s.children[p],x={},j=c?c[p]:void 0;j&&(x.align=j);let N={type:"element",tagName:u,properties:x,children:[]};g&&(N.children=t.all(g),t.patch(g,N),N=t.applyData(g,N)),m.push(N)}const f={type:"element",tagName:"tr",properties:{},children:t.wrap(m,!0)};return t.patch(s,f),t.applyData(s,f)}function S6(t,s){const n={type:"element",tagName:"td",properties:{},children:t.all(s)};return t.patch(s,n),t.applyData(s,n)}const Oj=9,zj=32;function k6(t){const s=String(t),n=/\r?\n|\r/g;let r=n.exec(s),o=0;const u=[];for(;r;)u.push(Rj(s.slice(o,r.index),o>0,!0),r[0]),o=r.index+r[0].length,r=n.exec(s);return u.push(Rj(s.slice(o),o>0,!1)),u.join("")}function Rj(t,s,n){let r=0,o=t.length;if(s){let u=t.codePointAt(r);for(;u===Oj||u===zj;)r++,u=t.codePointAt(r)}if(n){let u=t.codePointAt(o-1);for(;u===Oj||u===zj;)o--,u=t.codePointAt(o-1)}return o>r?t.slice(r,o):""}function C6(t,s){const n={type:"text",value:k6(String(s.value))};return t.patch(s,n),t.applyData(s,n)}function _6(t,s){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(s,n),t.applyData(s,n)}const D6={blockquote:a6,break:s6,code:i6,delete:r6,emphasis:l6,footnoteReference:o6,heading:c6,html:u6,imageReference:d6,image:h6,inlineCode:m6,linkReference:p6,link:f6,listItem:g6,list:y6,paragraph:b6,root:j6,strong:v6,table:N6,tableCell:S6,tableRow:w6,text:C6,thematicBreak:_6,toml:hd,yaml:hd,definition:hd,footnoteDefinition:hd};function hd(){}function E6(t,s){const n=[{type:"text",value:""}];return s>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(s)}]}),n}function T6(t,s){return"Back to reference "+(t+1)+(s>1?"-"+s:"")}function A6(t){const s=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||E6,r=t.options.footnoteBackLabel||T6,o=t.options.footnoteLabel||"Footnotes",u=t.options.footnoteLabelTagName||"h2",c=t.options.footnoteLabelProperties||{className:["sr-only"]},d=[];let p=-1;for(;++p<t.footnoteOrder.length;){const m=t.footnoteById.get(t.footnoteOrder[p]);if(!m)continue;const f=t.all(m),g=String(m.identifier).toUpperCase(),x=Vl(g.toLowerCase());let j=0;const N=[],k=t.footnoteCounts.get(g);for(;k!==void 0&&++j<=k;){N.length>0&&N.push({type:"text",value:" "});let T=typeof n=="string"?n:n(p,j);typeof T=="string"&&(T={type:"text",value:T}),N.push({type:"element",tagName:"a",properties:{href:"#"+s+"fnref-"+x+(j>1?"-"+j:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(p,j),className:["data-footnote-backref"]},children:Array.isArray(T)?T:[T]})}const D=f[f.length-1];if(D&&D.type==="element"&&D.tagName==="p"){const T=D.children[D.children.length-1];T&&T.type==="text"?T.value+=" ":D.children.push({type:"text",value:" "}),D.children.push(...N)}else f.push(...N);const _={type:"element",tagName:"li",properties:{id:s+"fn-"+x},children:t.wrap(f,!0)};t.patch(m,_),d.push(_)}if(d.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:u,properties:{...wc(c),id:"footnote-label"},children:[{type:"text",value:o}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(d,!0)},{type:"text",value:`
`}]}}const nf={}.hasOwnProperty,P6={};function I6(t,s){const n=s||P6,r=new Map,o=new Map,u=new Map,c={...D6,...n.handlers},d={all:m,applyData:z6,definitionById:r,footnoteById:o,footnoteCounts:u,footnoteOrder:[],handlers:c,one:p,options:n,patch:O6,wrap:L6};return n1(t,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?r:o,x=String(f.identifier).toUpperCase();g.has(x)||g.set(x,f)}}),d;function p(f,g){const x=f.type,j=d.handlers[x];if(nf.call(d.handlers,x)&&j)return j(d,f,g);if(d.options.passThrough&&d.options.passThrough.includes(x)){if("children"in f){const{children:k,...D}=f,_=wc(D);return _.children=d.all(f),_}return wc(f)}return(d.options.unknownHandler||R6)(d,f,g)}function m(f){const g=[];if("children"in f){const x=f.children;let j=-1;for(;++j<x.length;){const N=d.one(x[j],f);if(N){if(j&&x[j-1].type==="break"&&(!Array.isArray(N)&&N.type==="text"&&(N.value=Lj(N.value)),!Array.isArray(N)&&N.type==="element")){const k=N.children[0];k&&k.type==="text"&&(k.value=Lj(k.value))}Array.isArray(N)?g.push(...N):g.push(N)}}}return g}}function O6(t,s){t.position&&(s.position=b1(t))}function z6(t,s){let n=s;if(t&&t.data){const r=t.data.hName,o=t.data.hChildren,u=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const c="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:c}}n.type==="element"&&u&&Object.assign(n.properties,wc(u)),"children"in n&&n.children&&o!==null&&o!==void 0&&(n.children=o)}return n}function R6(t,s){const n=s.data||{},r="value"in s&&!(nf.call(n,"hProperties")||nf.call(n,"hChildren"))?{type:"text",value:s.value}:{type:"element",tagName:"div",properties:{},children:t.all(s)};return t.patch(s,r),t.applyData(s,r)}function L6(t,s){const n=[];let r=-1;for(s&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return s&&t.length>0&&n.push({type:"text",value:`
`}),n}function Lj(t){let s=0,n=t.charCodeAt(s);for(;n===9||n===32;)s++,n=t.charCodeAt(s);return t.slice(s)}function $6(t,s){const n=I6(t,s),r=n.one(t,void 0),o=A6(n),u=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return o&&u.children.push({type:"text",value:`
`},o),u}const F6=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"];class Ic{constructor(s,n,r){this.normal=n,this.property=s,r&&(this.space=r)}}Ic.prototype.normal={};Ic.prototype.property={};Ic.prototype.space=void 0;function k1(t,s){const n={},r={};for(const o of t)Object.assign(n,o.property),Object.assign(r,o.normal);return new Ic(n,r,s)}function af(t){return t.toLowerCase()}class ra{constructor(s,n){this.attribute=n,this.property=s}}ra.prototype.attribute="";ra.prototype.booleanish=!1;ra.prototype.boolean=!1;ra.prototype.commaOrSpaceSeparated=!1;ra.prototype.commaSeparated=!1;ra.prototype.defined=!1;ra.prototype.mustUseProperty=!1;ra.prototype.number=!1;ra.prototype.overloadedBoolean=!1;ra.prototype.property="";ra.prototype.spaceSeparated=!1;ra.prototype.space=void 0;let M6=0;const jt=_r(),wn=_r(),sf=_r(),Ge=_r(),Zt=_r(),zl=_r(),ga=_r();function _r(){return 2**++M6}const rf=Object.freeze(Object.defineProperty({__proto__:null,boolean:jt,booleanish:wn,commaOrSpaceSeparated:ga,commaSeparated:zl,number:Ge,overloadedBoolean:sf,spaceSeparated:Zt},Symbol.toStringTag,{value:"Module"})),wp=Object.keys(rf);class Yf extends ra{constructor(s,n,r,o){let u=-1;if(super(s,n),$j(this,"space",o),typeof r=="number")for(;++u<wp.length;){const c=wp[u];$j(this,wp[u],(r&rf[c])===rf[c])}}}Yf.prototype.defined=!0;function $j(t,s,n){n&&(t[s]=n)}function Gl(t){const s={},n={};for(const[r,o]of Object.entries(t.properties)){const u=new Yf(r,t.transform(t.attributes||{},r),o,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(u.mustUseProperty=!0),s[r]=u,n[af(r)]=r,n[af(u.attribute)]=r}return new Ic(s,n,t.space)}const C1=Gl({properties:{ariaActiveDescendant:null,ariaAtomic:wn,ariaAutoComplete:null,ariaBusy:wn,ariaChecked:wn,ariaColCount:Ge,ariaColIndex:Ge,ariaColSpan:Ge,ariaControls:Zt,ariaCurrent:null,ariaDescribedBy:Zt,ariaDetails:null,ariaDisabled:wn,ariaDropEffect:Zt,ariaErrorMessage:null,ariaExpanded:wn,ariaFlowTo:Zt,ariaGrabbed:wn,ariaHasPopup:null,ariaHidden:wn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Zt,ariaLevel:Ge,ariaLive:null,ariaModal:wn,ariaMultiLine:wn,ariaMultiSelectable:wn,ariaOrientation:null,ariaOwns:Zt,ariaPlaceholder:null,ariaPosInSet:Ge,ariaPressed:wn,ariaReadOnly:wn,ariaRelevant:null,ariaRequired:wn,ariaRoleDescription:Zt,ariaRowCount:Ge,ariaRowIndex:Ge,ariaRowSpan:Ge,ariaSelected:wn,ariaSetSize:Ge,ariaSort:null,ariaValueMax:Ge,ariaValueMin:Ge,ariaValueNow:Ge,ariaValueText:null,role:null},transform(t,s){return s==="role"?s:"aria-"+s.slice(4).toLowerCase()}});function _1(t,s){return s in t?t[s]:s}function D1(t,s){return _1(t,s.toLowerCase())}const B6=Gl({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:zl,acceptCharset:Zt,accessKey:Zt,action:null,allow:null,allowFullScreen:jt,allowPaymentRequest:jt,allowUserMedia:jt,alt:null,as:null,async:jt,autoCapitalize:null,autoComplete:Zt,autoFocus:jt,autoPlay:jt,blocking:Zt,capture:null,charSet:null,checked:jt,cite:null,className:Zt,cols:Ge,colSpan:null,content:null,contentEditable:wn,controls:jt,controlsList:Zt,coords:Ge|zl,crossOrigin:null,data:null,dateTime:null,decoding:null,default:jt,defer:jt,dir:null,dirName:null,disabled:jt,download:sf,draggable:wn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:jt,formTarget:null,headers:Zt,height:Ge,hidden:sf,high:Ge,href:null,hrefLang:null,htmlFor:Zt,httpEquiv:Zt,id:null,imageSizes:null,imageSrcSet:null,inert:jt,inputMode:null,integrity:null,is:null,isMap:jt,itemId:null,itemProp:Zt,itemRef:Zt,itemScope:jt,itemType:Zt,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:jt,low:Ge,manifest:null,max:null,maxLength:Ge,media:null,method:null,min:null,minLength:Ge,multiple:jt,muted:jt,name:null,nonce:null,noModule:jt,noValidate:jt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:jt,optimum:Ge,pattern:null,ping:Zt,placeholder:null,playsInline:jt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:jt,referrerPolicy:null,rel:Zt,required:jt,reversed:jt,rows:Ge,rowSpan:Ge,sandbox:Zt,scope:null,scoped:jt,seamless:jt,selected:jt,shadowRootClonable:jt,shadowRootDelegatesFocus:jt,shadowRootMode:null,shape:null,size:Ge,sizes:null,slot:null,span:Ge,spellCheck:wn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Ge,step:null,style:null,tabIndex:Ge,target:null,title:null,translate:null,type:null,typeMustMatch:jt,useMap:null,value:wn,width:Ge,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Zt,axis:null,background:null,bgColor:null,border:Ge,borderColor:null,bottomMargin:Ge,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:jt,declare:jt,event:null,face:null,frame:null,frameBorder:null,hSpace:Ge,leftMargin:Ge,link:null,longDesc:null,lowSrc:null,marginHeight:Ge,marginWidth:Ge,noResize:jt,noHref:jt,noShade:jt,noWrap:jt,object:null,profile:null,prompt:null,rev:null,rightMargin:Ge,rules:null,scheme:null,scrolling:wn,standby:null,summary:null,text:null,topMargin:Ge,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Ge,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:jt,disableRemotePlayback:jt,prefix:null,property:null,results:Ge,security:null,unselectable:null},space:"html",transform:D1}),U6=Gl({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:ga,accentHeight:Ge,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Ge,amplitude:Ge,arabicForm:null,ascent:Ge,attributeName:null,attributeType:null,azimuth:Ge,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Ge,by:null,calcMode:null,capHeight:Ge,className:Zt,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Ge,diffuseConstant:Ge,direction:null,display:null,dur:null,divisor:Ge,dominantBaseline:null,download:jt,dx:null,dy:null,edgeMode:null,editable:null,elevation:Ge,enableBackground:null,end:null,event:null,exponent:Ge,externalResourcesRequired:null,fill:null,fillOpacity:Ge,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:zl,g2:zl,glyphName:zl,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Ge,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Ge,horizOriginX:Ge,horizOriginY:Ge,id:null,ideographic:Ge,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Ge,k:Ge,k1:Ge,k2:Ge,k3:Ge,k4:Ge,kernelMatrix:ga,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Ge,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Ge,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Ge,overlineThickness:Ge,paintOrder:null,panose1:null,path:null,pathLength:Ge,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Zt,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Ge,pointsAtY:Ge,pointsAtZ:Ge,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ga,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ga,rev:ga,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ga,requiredFeatures:ga,requiredFonts:ga,requiredFormats:ga,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Ge,specularExponent:Ge,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Ge,strikethroughThickness:Ge,string:null,stroke:null,strokeDashArray:ga,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Ge,strokeOpacity:Ge,strokeWidth:null,style:null,surfaceScale:Ge,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ga,tabIndex:Ge,tableValues:null,target:null,targetX:Ge,targetY:Ge,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ga,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Ge,underlineThickness:Ge,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Ge,values:null,vAlphabetic:Ge,vMathematical:Ge,vectorEffect:null,vHanging:Ge,vIdeographic:Ge,version:null,vertAdvY:Ge,vertOriginX:Ge,vertOriginY:Ge,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Ge,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:_1}),E1=Gl({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,s){return"xlink:"+s.slice(5).toLowerCase()}}),T1=Gl({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:D1}),A1=Gl({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,s){return"xml:"+s.slice(3).toLowerCase()}}),q6=/[A-Z]/g,Fj=/-[a-z]/g,H6=/^data[-\w.:]+$/i;function V6(t,s){const n=af(s);let r=s,o=ra;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&H6.test(s)){if(s.charAt(4)==="-"){const u=s.slice(5).replace(Fj,Q6);r="data"+u.charAt(0).toUpperCase()+u.slice(1)}else{const u=s.slice(4);if(!Fj.test(u)){let c=u.replace(q6,G6);c.charAt(0)!=="-"&&(c="-"+c),s="data"+c}}o=Yf}return new o(r,s)}function G6(t){return"-"+t.toLowerCase()}function Q6(t){return t.charAt(1).toUpperCase()}const Y6=k1([C1,B6,E1,T1,A1],"html"),P1=k1([C1,U6,E1,T1,A1],"svg"),J6=/["&'<>`]/g,X6=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,K6=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,W6=/[|\\{}()[\]^$+*?.]/g,Mj=new WeakMap;function Z6(t,s){if(t=t.replace(s.subset?ez(s.subset):J6,r),s.subset||s.escapeOnly)return t;return t.replace(X6,n).replace(K6,r);function n(o,u,c){return s.format((o.charCodeAt(0)-55296)*1024+o.charCodeAt(1)-56320+65536,c.charCodeAt(u+2),s)}function r(o,u,c){return s.format(o.charCodeAt(0),c.charCodeAt(u+1),s)}}function ez(t){let s=Mj.get(t);return s||(s=tz(t),Mj.set(t,s)),s}function tz(t){const s=[];let n=-1;for(;++n<t.length;)s.push(t[n].replace(W6,"\\$&"));return new RegExp("(?:"+s.join("|")+")","g")}const nz=/[\dA-Fa-f]/;function az(t,s,n){const r="&#x"+t.toString(16).toUpperCase();return n&&s&&!nz.test(String.fromCharCode(s))?r:r+";"}const sz=/\d/;function iz(t,s,n){const r="&#"+String(t);return n&&s&&!sz.test(String.fromCharCode(s))?r:r+";"}const rz=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],Sp={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},lz=["cent","copy","divide","gt","lt","not","para","times"],I1={}.hasOwnProperty,lf={};let md;for(md in Sp)I1.call(Sp,md)&&(lf[Sp[md]]=md);const oz=/[^\dA-Za-z]/;function cz(t,s,n,r){const o=String.fromCharCode(t);if(I1.call(lf,o)){const u=lf[o],c="&"+u;return n&&rz.includes(u)&&!lz.includes(u)&&(!r||s&&s!==61&&oz.test(String.fromCharCode(s)))?c:c+";"}return""}function uz(t,s,n){let r=az(t,s,n.omitOptionalSemicolons),o;if((n.useNamedReferences||n.useShortestReferences)&&(o=cz(t,s,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!o)&&n.useShortestReferences){const u=iz(t,s,n.omitOptionalSemicolons);u.length<r.length&&(r=u)}return o&&(!n.useShortestReferences||o.length<r.length)?o:r}function Rl(t,s){return Z6(t,Object.assign({format:uz},s))}const dz=/^>|^->|<!--|-->|--!>|<!-$/g,hz=[">"],mz=["<",">"];function pz(t,s,n,r){return r.settings.bogusComments?"<?"+Rl(t.value,Object.assign({},r.settings.characterReferences,{subset:hz}))+">":"<!--"+t.value.replace(dz,o)+"-->";function o(u){return Rl(u,Object.assign({},r.settings.characterReferences,{subset:mz}))}}function fz(t,s,n,r){return"<!"+(r.settings.upperDoctype?"DOCTYPE":"doctype")+(r.settings.tightDoctype?"":" ")+"html>"}function Bj(t,s){const n=String(t);if(typeof s!="string")throw new TypeError("Expected character");let r=0,o=n.indexOf(s);for(;o!==-1;)r++,o=n.indexOf(s,o+s.length);return r}function gz(t,s){const n=s||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}function xz(t){return t.join(" ").trim()}const yz=/[ \t\n\f\r]/g;function Jf(t){return typeof t=="object"?t.type==="text"?Uj(t.value):!1:Uj(t)}function Uj(t){return t.replace(yz,"")===""}const Cn=z1(1),O1=z1(-1),bz=[];function z1(t){return s;function s(n,r,o){const u=n?n.children:bz;let c=(r||0)+t,d=u[c];if(!o)for(;d&&Jf(d);)c+=t,d=u[c];return d}}const jz={}.hasOwnProperty;function R1(t){return s;function s(n,r,o){return jz.call(t,n.tagName)&&t[n.tagName](n,r,o)}}const Xf=R1({body:Nz,caption:kp,colgroup:kp,dd:Cz,dt:kz,head:kp,html:vz,li:Sz,optgroup:_z,option:Dz,p:wz,rp:qj,rt:qj,tbody:Tz,td:Hj,tfoot:Az,th:Hj,thead:Ez,tr:Pz});function kp(t,s,n){const r=Cn(n,s,!0);return!r||r.type!=="comment"&&!(r.type==="text"&&Jf(r.value.charAt(0)))}function vz(t,s,n){const r=Cn(n,s);return!r||r.type!=="comment"}function Nz(t,s,n){const r=Cn(n,s);return!r||r.type!=="comment"}function wz(t,s,n){const r=Cn(n,s);return r?r.type==="element"&&(r.tagName==="address"||r.tagName==="article"||r.tagName==="aside"||r.tagName==="blockquote"||r.tagName==="details"||r.tagName==="div"||r.tagName==="dl"||r.tagName==="fieldset"||r.tagName==="figcaption"||r.tagName==="figure"||r.tagName==="footer"||r.tagName==="form"||r.tagName==="h1"||r.tagName==="h2"||r.tagName==="h3"||r.tagName==="h4"||r.tagName==="h5"||r.tagName==="h6"||r.tagName==="header"||r.tagName==="hgroup"||r.tagName==="hr"||r.tagName==="main"||r.tagName==="menu"||r.tagName==="nav"||r.tagName==="ol"||r.tagName==="p"||r.tagName==="pre"||r.tagName==="section"||r.tagName==="table"||r.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function Sz(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&r.tagName==="li"}function kz(t,s,n){const r=Cn(n,s);return!!(r&&r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd"))}function Cz(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd")}function qj(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&(r.tagName==="rp"||r.tagName==="rt")}function _z(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&r.tagName==="optgroup"}function Dz(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&(r.tagName==="option"||r.tagName==="optgroup")}function Ez(t,s,n){const r=Cn(n,s);return!!(r&&r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot"))}function Tz(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot")}function Az(t,s,n){return!Cn(n,s)}function Pz(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&r.tagName==="tr"}function Hj(t,s,n){const r=Cn(n,s);return!r||r.type==="element"&&(r.tagName==="td"||r.tagName==="th")}const Iz=R1({body:Rz,colgroup:Lz,head:zz,html:Oz,tbody:$z});function Oz(t){const s=Cn(t,-1);return!s||s.type!=="comment"}function zz(t){const s=new Set;for(const r of t.children)if(r.type==="element"&&(r.tagName==="base"||r.tagName==="title")){if(s.has(r.tagName))return!1;s.add(r.tagName)}const n=t.children[0];return!n||n.type==="element"}function Rz(t){const s=Cn(t,-1,!0);return!s||s.type!=="comment"&&!(s.type==="text"&&Jf(s.value.charAt(0)))&&!(s.type==="element"&&(s.tagName==="meta"||s.tagName==="link"||s.tagName==="script"||s.tagName==="style"||s.tagName==="template"))}function Lz(t,s,n){const r=O1(n,s),o=Cn(t,-1,!0);return n&&r&&r.type==="element"&&r.tagName==="colgroup"&&Xf(r,n.children.indexOf(r),n)?!1:!!(o&&o.type==="element"&&o.tagName==="col")}function $z(t,s,n){const r=O1(n,s),o=Cn(t,-1);return n&&r&&r.type==="element"&&(r.tagName==="thead"||r.tagName==="tbody")&&Xf(r,n.children.indexOf(r),n)?!1:!!(o&&o.type==="element"&&o.tagName==="tr")}const pd={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function Fz(t,s,n,r){const o=r.schema,u=o.space==="svg"?!1:r.settings.omitOptionalTags;let c=o.space==="svg"?r.settings.closeEmptyElements:r.settings.voids.includes(t.tagName.toLowerCase());const d=[];let p;o.space==="html"&&t.tagName==="svg"&&(r.schema=P1);const m=Mz(r,t.properties),f=r.all(o.space==="html"&&t.tagName==="template"?t.content:t);return r.schema=o,f&&(c=!1),(m||!u||!Iz(t,s,n))&&(d.push("<",t.tagName,m?" "+m:""),c&&(o.space==="svg"||r.settings.closeSelfClosing)&&(p=m.charAt(m.length-1),(!r.settings.tightSelfClosing||p==="/"||p&&p!=='"'&&p!=="'")&&d.push(" "),d.push("/")),d.push(">")),d.push(f),!c&&(!u||!Xf(t,s,n))&&d.push("</"+t.tagName+">"),d.join("")}function Mz(t,s){const n=[];let r=-1,o;if(s){for(o in s)if(s[o]!==null&&s[o]!==void 0){const u=Bz(t,o,s[o]);u&&n.push(u)}}for(;++r<n.length;){const u=t.settings.tightAttributes?n[r].charAt(n[r].length-1):void 0;r!==n.length-1&&u!=='"'&&u!=="'"&&(n[r]+=" ")}return n.join("")}function Bz(t,s,n){const r=V6(t.schema,s),o=t.settings.allowParseErrors&&t.schema.space==="html"?0:1,u=t.settings.allowDangerousCharacters?0:1;let c=t.quote,d;if(r.overloadedBoolean&&(n===r.attribute||n==="")?n=!0:(r.boolean||r.overloadedBoolean)&&(typeof n!="string"||n===r.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const p=Rl(r.attribute,Object.assign({},t.settings.characterReferences,{subset:pd.name[o][u]}));return n===!0||(n=Array.isArray(n)?(r.commaSeparated?gz:xz)(n,{padLeft:!t.settings.tightCommaSeparatedLists}):String(n),t.settings.collapseEmptyAttributes&&!n)?p:(t.settings.preferUnquoted&&(d=Rl(n,Object.assign({},t.settings.characterReferences,{attribute:!0,subset:pd.unquoted[o][u]}))),d!==n&&(t.settings.quoteSmart&&Bj(n,c)>Bj(n,t.alternative)&&(c=t.alternative),d=c+Rl(n,Object.assign({},t.settings.characterReferences,{subset:(c==="'"?pd.single:pd.double)[o][u],attribute:!0}))+c),p+(d&&"="+d))}const Uz=["<","&"];function L1(t,s,n,r){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?t.value:Rl(t.value,Object.assign({},r.settings.characterReferences,{subset:Uz}))}function qz(t,s,n,r){return r.settings.allowDangerousHtml?t.value:L1(t,s,n,r)}function Hz(t,s,n,r){return r.all(t)}const Vz=Kv("type",{invalid:Gz,unknown:Qz,handlers:{comment:pz,doctype:fz,element:Fz,raw:qz,root:Hz,text:L1}});function Gz(t){throw new Error("Expected node, not `"+t+"`")}function Qz(t){const s=t;throw new Error("Cannot compile unknown node `"+s.type+"`")}const Yz={},Jz={},Xz=[];function Kz(t,s){const n=s||Yz,r=n.quote||'"',o=r==='"'?"'":'"';if(r!=='"'&&r!=="'")throw new Error("Invalid quote `"+r+"`, expected `'` or `\"`");return{one:Wz,all:Zz,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||F6,characterReferences:n.characterReferences||Jz,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?P1:Y6,quote:r,alternative:o}.one(Array.isArray(t)?{type:"root",children:t}:t,void 0,void 0)}function Wz(t,s,n){return Vz(t,s,n,this)}function Zz(t){const s=[],n=t&&t.children||Xz;let r=-1;for(;++r<n.length;)s[r]=this.one(n[r],r,t);return s.join("")}const eR={};function Cp(t){const s=this,{handlers:n,sanitize:r,...o}=t||eR;let u=!1,c;typeof r=="boolean"?u=!r:r&&(c=r),s.compiler=d;function d(p,m){const f=$6(p,{handlers:n,allowDangerousHtml:u}),g=u?f:YO(f,c),x=Kz(g,{...o,allowDangerousHtml:u});return m.extname&&(m.extname=".html"),p&&p.type==="root"&&x&&/[^\r\n]/.test(x.charAt(x.length-1))?x+`
`:x}}const tR=({isOpen:t,onClose:s,patientId:n,pharmacyInventory:r,fetchPharmacyOrdersData:o})=>{const[u,c]=y.useState([]),[d,p]=y.useState(""),[m,f]=y.useState([]),[g,x]=y.useState(null),[j,N]=y.useState(!1);Ra(void 0,t?200:99999),y.useEffect(()=>{if(!d){f([]);return}const E=d.toLowerCase();f(r.filter(U=>U.name.toLowerCase().includes(E)).slice(0,10))},[d,r]);const k=async()=>{if(!n){x("Patient ID is missing.");return}if(u.length===0){x("Please select at least one drug.");return}for(const E of u)if(E.selected_pack_quantity===0&&E.selected_loose_quantity===0){x(`Please specify a quantity for ${E.name}.`);return}N(!0),x(null);try{const E={patient_id:n,items:u.map(X=>({drug_id:X.id,name:X.name,pack_quantity:X.selected_pack_quantity,loose_quantity:X.selected_loose_quantity,pack_price:0,loose_price:0,total_price:0,tabletsPerDay:1,numberOfDays:1,directions_to_use:"As directed"})),order_total:0,prescription_for_unavailable_drugs:""},U=await ae("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)});if(!U.ok){const X=await U.json().catch(()=>({}));throw new Error(X.message||`Failed to create pharmacy order: ${U.statusText} `)}await U.json(),o(n),s(),c([]),p("")}catch(E){x(`Order Creation Error: ${E.message} `)}finally{N(!1)}},D=E=>{if(u.some(U=>U.id===E.id)){x(`${E.name} is already in the order.`),setTimeout(()=>x(null),3e3),p(""),f([]);return}c(U=>[...U,{...E,selected_pack_quantity:0,selected_loose_quantity:0}]),p(""),f([])},_=E=>{c(U=>U.filter(X=>X.id!==E))},T=(E,U,X)=>{const I=parseInt(X)||0;c(F=>F.map(B=>B.id===E?{...B,[U==="pack"?"selected_pack_quantity":"selected_loose_quantity"]:I}:B))};return t?e.jsx("div",{className:rt.modalOverlay,children:e.jsxs("div",{className:rt.modalContent,children:[e.jsxs("div",{className:rt.modalHeader,children:[e.jsx("h3",{className:rt.modalTitle,children:"Create Pharmacy Order"}),e.jsx("button",{onClick:s,className:rt.modalCloseButton,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:rt.modalBody,children:[g&&e.jsx("div",{className:rt.errorText,children:g}),e.jsxs("div",{className:rt.formGroup,style:{position:"relative"},children:[e.jsx("label",{htmlFor:"drug-search",children:"Add Drug"}),e.jsx("input",{type:"text",id:"drug-search",placeholder:"Search available drugs...",value:d,onChange:E=>p(E.target.value),className:rt.inputField,autoComplete:"off"}),d&&m.length>0&&e.jsx("div",{className:rt.searchResultsCard,children:e.jsx("ul",{className:rt.searchResultsList,children:m.map(E=>e.jsx("li",{onClick:()=>D(E),className:rt.searchResultItem,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:E.name}),e.jsxs("span",{className:rt.searchResultPrice,children:["Stock: ",E.stock," (Box) / ",E.loose||0," (Loose)"]})]})},E.id))})})]}),e.jsxs("div",{className:rt.selectedTestsCard,children:[" ",e.jsx("h4",{className:rt.selectedTestsHeader,children:"Selected Drugs"}),u.length===0?e.jsx("p",{className:rt.noTestsMessage,children:"No drugs added yet."}):e.jsx("ul",{className:rt.selectedTestsList,children:u.map(E=>e.jsxs("li",{className:rt.selectedTestItem,style:{flexDirection:"column",alignItems:"flex-start",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[e.jsx("span",{className:rt.selectedTestName,style:{fontWeight:"bold"},children:E.name}),e.jsx("button",{type:"button",onClick:()=>_(String(E.id)),className:rt.removeTestButton,title:"Remove Drug",children:e.jsx(on,{size:16})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",width:"100%"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.75rem",color:"#666"},children:"Packs"}),e.jsx("input",{type:"number",min:"0",className:rt.inputField,style:{padding:"4px 8px"},value:E.selected_pack_quantity||"",onChange:U=>T(E.id,"pack",U.target.value),placeholder:"0"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.75rem",color:"#666"},children:"Loose"}),e.jsx("input",{type:"number",min:"0",className:rt.inputField,style:{padding:"4px 8px"},value:E.selected_loose_quantity||"",onChange:U=>T(E.id,"loose",U.target.value),placeholder:"0"})]})]})]},E.id))})]})]}),e.jsxs("div",{className:rt.modalFooter,children:[e.jsx("button",{type:"button",onClick:s,className:`${rt.button} ${rt.buttonSecondary} `,children:" Cancel "}),e.jsxs("button",{type:"button",onClick:k,disabled:u.length===0||j,className:`${rt.button} ${rt.buttonPrimary} ${u.length===0||j?rt.buttonDisabled:""} `,children:[" ",j?"Creating...":"Create Order"," "]})]})]})}):null},$1=({isOpen:t,onClose:s,onSuccess:n,medication:r,initialPatient:o,initialItems:u})=>{const[c,d]=y.useState(""),[p,m]=y.useState([]),[f,g]=y.useState(null),[x,j]=y.useState(!1);Ra(void 0,t?200:99999),y.useEffect(()=>{if(t&&r){k([{id:Date.now(),medication_name:r.medicationName,drug_id:null,quantity:r.quantity,tablets_per_day:r.tabletsPerDay||1,number_of_days:r.numberOfDays||30,directions:r.directions||"",notes:r.notes||""}]),_(r.frequencyDays);try{const Y=new Date(r.nextDeliveryDate);isNaN(Y.getTime())||E(Y.toISOString().split("T")[0])}catch(Y){console.error("Error parsing date",Y)}g({id:r.patientId,name:r.patientName,phone:r.patientPhone,patient_token_number:r.patientToken})}else t&&(o||u)?(u&&u.length>0&&k(u),o&&g(o)):t&&!r&&!u&&(k([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),_(30),E(""),g(null),d(""))},[t,r,o,u]);const[N,k]=y.useState([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),[D,_]=y.useState(30),[T,E]=y.useState(""),[U,X]=y.useState(null),[I,F]=y.useState(""),[B,G]=y.useState([]),[C,A]=y.useState(!1),[P,$]=y.useState(!1),[J,R]=y.useState(null),L=y.useRef(null),M=y.useRef(null);y.useEffect(()=>{if(t){const Y=new Date;Y.setDate(Y.getDate()+30),E(Y.toISOString().split("T")[0])}},[t]);const Z=y.useCallback(async Y=>{if(!Y.trim()){m([]);return}j(!0);try{const V=await ae(`/api/patients?search=${encodeURIComponent(Y)}&limit=10`);if(V.ok){const oe=await V.json();m(oe.patients||[])}}catch(V){console.error("Error searching patients:",V)}finally{j(!1)}},[]);y.useEffect(()=>{L.current&&clearTimeout(L.current),c&&!f?L.current=setTimeout(()=>Z(c),300):m([])},[c,f,Z]);const Q=y.useCallback(async Y=>{if(!Y.trim()){G([]);return}A(!0);try{const V=await ae(`/api/drugs?search=${encodeURIComponent(Y)}&limit=10`);if(V.ok){const oe=await V.json();G(oe.drugs||[])}}catch(V){console.error("Error searching drugs:",V)}finally{A(!1)}},[]);y.useEffect(()=>{M.current&&clearTimeout(M.current),I&&U!==null?M.current=setTimeout(()=>Q(I),300):G([])},[I,U,Q]);const S=Y=>{if(!Y)return 1;const V=Y.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return V?parseInt(V[1],10):1},ge=Y=>{g(Y),d(`${Y.name} (${Y.patient_token_number})`),m([])},fe=(Y,V)=>{const oe=[...N];oe[V]={...oe[V],medication_name:Y.name,drug_id:Y.id,pack_size:S(Y.pack),packs:0,loose:0,quantity:0},k(oe),X(null),F(""),G([])},w=(Y,V,oe)=>{const Pe=[...N],se={...Pe[Y]},Ce=se.pack_size||1;if(V==="packs"||V==="loose"){const ee=parseInt(oe)||0;V==="packs"&&(se.packs=ee),V==="loose"&&(se.loose=ee);const je=se.packs||0,Ie=se.loose||0;se.quantity=je*Ce+Ie}else if(V==="tablets_per_day"||V==="number_of_days"){V==="tablets_per_day"&&(se.tablets_per_day=oe),V==="number_of_days"&&(se.number_of_days=oe);const ee=parseFloat(se.tablets_per_day.toString())||0,je=parseInt(se.number_of_days.toString())||0,Ie=Math.ceil(ee*je);se.quantity=Ie,se.packs=Math.floor(Ie/Ce),se.loose=Ie%Ce}else se[V]=oe;Pe[Y]=se,k(Pe)},ue=()=>{k([...N,{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:D,directions:"",notes:"",packs:0,loose:0,pack_size:1}])},Ne=Y=>{N.length>1&&k(N.filter((V,oe)=>oe!==Y))},K=async Y=>{if(Y.preventDefault(),R(null),!f){R("Please select a patient.");return}if(N.some(oe=>!oe.medication_name||oe.quantity<=0)){R("Please ensure all items have a medication name and valid quantity.");return}$(!0);try{const oe={patient_id:f.id,items:N.map(se=>({medication_name:se.medication_name,drug_id:se.drug_id,quantity:se.quantity,tablets_per_day:se.tablets_per_day,number_of_days:se.number_of_days,directions:se.directions,notes:se.notes,frequency_days:D,next_delivery_date:T}))},Pe=await ae("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)});if(!Pe.ok){const se=await Pe.json();throw new Error(se.message+(se.error?": "+se.error:"")||"Failed to create recurring medication.")}n(),s(),g(null),d(""),k([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),_(30)}catch(oe){R(oe.message)}finally{$(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"800px",width:"95%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Recurring Medication Order"}),e.jsx("button",{className:"close-btn",onClick:s,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[J&&e.jsx("div",{className:"error-message",children:J}),e.jsxs("form",{onSubmit:K,className:"recurring-form",children:[e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsxs("label",{children:[e.jsx(Oa,{size:16})," Patient"]}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search patient...",value:c,onChange:Y=>{d(Y.target.value),g(null)},className:f?"selected":"unselected"}),x&&e.jsx("span",{className:"spinner",children:"..."}),c&&!f&&p.length>0&&e.jsx("ul",{className:"suggestions-list",children:p.map(Y=>e.jsxs("li",{onClick:()=>ge(Y),children:[e.jsx("div",{className:"suggestion-name",children:Y.name}),e.jsxs("div",{className:"suggestion-details",children:[Y.phone,"  ",Y.patient_token_number]})]},Y.id))})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pf,{size:16})," Frequency"]}),e.jsxs("select",{value:D,onChange:Y=>{const V=parseInt(Y.target.value);_(V);const oe=new Date;oe.setDate(oe.getDate()+V),E(oe.toISOString().split("T")[0]);const Pe=N.map(se=>({...se,number_of_days:V}));k(Pe)},children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(Li,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:T,onChange:Y=>E(Y.target.value)})]})]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"items-header",children:[e.jsx("h4",{children:"Medications"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:ue,children:[e.jsx(Ia,{size:14})," Add Drug"]})]}),e.jsx("div",{className:"items-list",children:N.map((Y,V)=>e.jsxs("div",{className:"medication-item-row",children:[e.jsxs("div",{className:"row-top",children:[e.jsxs("div",{className:"form-group med-search-group",children:[e.jsx("label",{children:"Drug Name"}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search drug...",value:U===V?I:Y.medication_name,onFocus:()=>{X(V),F(Y.medication_name)},onChange:oe=>{F(oe.target.value),w(V,"medication_name",oe.target.value)}}),U===V&&C&&e.jsx("span",{className:"spinner",children:"..."}),U===V&&I&&B.length>0&&e.jsx("ul",{className:"suggestions-list",children:B.map(oe=>e.jsxs("li",{onClick:()=>fe(oe,V),children:[e.jsx("div",{className:"suggestion-name",children:oe.name}),e.jsxs("div",{className:"suggestion-details",children:["Stock: ",oe.stock]})]},oe.id))})]})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:Y.tablets_per_day,onChange:oe=>w(V,"tablets_per_day",oe.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:Y.number_of_days,onChange:oe=>w(V,"number_of_days",oe.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Packs"}),e.jsx("input",{type:"number",min:"0",value:Y.packs||"",onChange:oe=>w(V,"packs",oe.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Loose"}),e.jsx("input",{type:"number",min:"0",value:Y.loose||"",onChange:oe=>w(V,"loose",oe.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Total"}),e.jsx("input",{type:"number",value:Y.quantity,disabled:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>Ne(V),disabled:N.length===1,children:e.jsx(on,{size:16})})]}),e.jsxs("div",{className:"row-bottom",children:[e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Directions (e.g. 1-0-1 after food)",value:Y.directions,onChange:oe=>w(V,"directions",oe.target.value)})}),e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Notes",value:Y.notes,onChange:oe=>w(V,"notes",oe.target.value)})})]})]},Y.id))}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:s,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:P,children:P?"Creating...":"Create Recurring Order"})]})]})]})]})}):null},nR=({isOpen:t,onClose:s,onSuccess:n,patientId:r,initialItems:o})=>{const[u,c]=y.useState([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]),[d,p]=y.useState(30),[m,f]=y.useState(""),[g,x]=y.useState(null),[j,N]=y.useState(""),[k,D]=y.useState([]),[_,T]=y.useState(!1),[E,U]=y.useState(!1),[X,I]=y.useState(null),F=y.useRef(null);y.useEffect(()=>{if(t){o&&o.length>0?c(o):c([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]);const R=new Date;R.setDate(R.getDate()+30),f(R.toISOString().split("T")[0]),p(30)}},[t,o]);const B=y.useCallback(async R=>{if(!R.trim()){D([]);return}T(!0);try{const L=await ae(`/api/drugs?search=${encodeURIComponent(R)}&limit=10`);if(L.ok){const M=await L.json();D(M.drugs||[])}}catch(L){console.error("Error searching drugs:",L)}finally{T(!1)}},[]);y.useEffect(()=>{F.current&&clearTimeout(F.current),j&&g!==null?F.current=setTimeout(()=>B(j),300):D([])},[j,g,B]);const G=R=>{if(!R)return 1;const L=R.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return L?parseInt(L[1],10):1},C=(R,L)=>{const M=[...u];M[L]={...M[L],medication_name:R.name,drug_id:R.id,pack_size:G(R.pack),packs:0,loose:0,quantity:0},c(M),x(null),N(""),D([])},A=(R,L,M)=>{const Z=[...u],Q={...Z[R]},S=Q.pack_size||1;if(L==="packs"||L==="loose"){const ge=parseInt(M)||0;L==="packs"&&(Q.packs=ge),L==="loose"&&(Q.loose=ge);const fe=Q.packs||0,w=Q.loose||0;Q.quantity=fe*S+w}else if(L==="tablets_per_day"||L==="number_of_days"){L==="tablets_per_day"&&(Q.tablets_per_day=M),L==="number_of_days"&&(Q.number_of_days=M);const ge=parseFloat(Q.tablets_per_day.toString())||0,fe=parseInt(Q.number_of_days.toString())||0,w=Math.ceil(ge*fe);Q.quantity=w,Q.packs=Math.floor(w/S),Q.loose=w%S}else Q[L]=M;Z[R]=Q,c(Z)},P=()=>{c([...u,{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:d,directions:"",notes:"",packs:0,loose:0,pack_size:1}])},$=R=>{u.length>1&&c(u.filter((L,M)=>M!==R))},J=async R=>{if(R.preventDefault(),I(null),!r){I("Patient ID is missing.");return}if(u.some(M=>!M.medication_name||M.quantity<=0)){I("Please ensure all items have a medication name and valid quantity.");return}U(!0);try{const M={patient_id:r,items:u.map(Q=>({medication_name:Q.medication_name,drug_id:Q.drug_id,quantity:Q.quantity,tablets_per_day:Q.tablets_per_day,number_of_days:Q.number_of_days,directions:Q.directions,notes:Q.notes,frequency_days:d,next_delivery_date:m}))},Z=await ae("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!Z.ok){const Q=await Z.json();throw new Error(Q.message+(Q.error?": "+Q.error:"")||"Failed to create recurring medication.")}n(),s()}catch(M){I(M.message)}finally{U(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"800px",width:"95%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Recurring Medications"}),e.jsx("button",{className:"close-btn",onClick:s,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[X&&e.jsx("div",{className:"error-message",children:X}),e.jsxs("form",{onSubmit:J,className:"recurring-form",children:[e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pf,{size:16})," Frequency"]}),e.jsxs("select",{value:d,onChange:R=>{const L=parseInt(R.target.value);p(L);const M=new Date;M.setDate(M.getDate()+L),f(M.toISOString().split("T")[0]);const Z=u.map(Q=>({...Q,number_of_days:L}));c(Z)},children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(Li,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:m,onChange:R=>f(R.target.value)})]})]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"items-header",children:[e.jsx("h4",{children:"Medications"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:P,children:[e.jsx(Ia,{size:14})," Add Drug"]})]}),e.jsx("div",{className:"items-list",children:u.map((R,L)=>e.jsxs("div",{className:"medication-item-row",children:[e.jsxs("div",{className:"row-top",children:[e.jsxs("div",{className:"form-group med-search-group",children:[e.jsx("label",{children:"Drug Name"}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search drug...",value:g===L?j:R.medication_name,onFocus:()=>{x(L),N(R.medication_name)},onChange:M=>{N(M.target.value),A(L,"medication_name",M.target.value)}}),g===L&&_&&e.jsx("span",{className:"spinner",children:"..."}),g===L&&j&&k.length>0&&e.jsx("ul",{className:"suggestions-list",children:k.map(M=>e.jsxs("li",{onClick:()=>C(M,L),children:[e.jsx("div",{className:"suggestion-name",children:M.name}),e.jsxs("div",{className:"suggestion-details",children:["Stock: ",M.stock]})]},M.id))})]})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:R.tablets_per_day,onChange:M=>A(L,"tablets_per_day",M.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:R.number_of_days,onChange:M=>A(L,"number_of_days",M.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Packs"}),e.jsx("input",{type:"number",min:"0",value:R.packs||"",onChange:M=>A(L,"packs",M.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Loose"}),e.jsx("input",{type:"number",min:"0",value:R.loose||"",onChange:M=>A(L,"loose",M.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Total"}),e.jsx("input",{type:"number",value:R.quantity,disabled:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>$(L),disabled:u.length===1,children:e.jsx(on,{size:16})})]}),e.jsxs("div",{className:"row-bottom",children:[e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Directions (e.g. 1-0-1 after food)",value:R.directions,onChange:M=>A(L,"directions",M.target.value)})}),e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Notes",value:R.notes,onChange:M=>A(L,"notes",M.target.value)})})]})]},R.id))}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:s,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:E,children:E?"Creating...":"Create Recurring Order"})]})]})]})]})}):null},aR=({isOpen:t,onClose:s,onSuccess:n,medication:r})=>{const[o,u]=y.useState(""),[c,d]=y.useState(0),[p,m]=y.useState(1),[f,g]=y.useState(30),[x,j]=y.useState(""),[N,k]=y.useState(""),[D,_]=y.useState(30),[T,E]=y.useState(""),[U,X]=y.useState("active"),[I,F]=y.useState(!1),[B,G]=y.useState(null);y.useEffect(()=>{if(t&&r){u(r.medicationName),d(r.quantity),m(r.tabletsPerDay||1),g(r.numberOfDays||30),j(r.directions||""),k(r.notes||""),_(r.frequencyDays),X(r.status);try{const P=new Date(r.nextDeliveryDate);isNaN(P.getTime())||E(P.toISOString().split("T")[0])}catch(P){console.error("Error parsing date",P)}}},[t,r]);const C=async P=>{if(P.preventDefault(),G(null),!o||c<=0){G("Please provide a valid medication name and quantity.");return}F(!0);try{const $={medication_name:o,quantity:c,tablets_per_day:p,number_of_days:f,directions:x,notes:N,frequency_days:D,next_delivery_date:T,status:U},J=await ae(`/api/recurring-medications/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!J.ok){const R=await J.json();throw new Error(R.message||"Failed to update recurring medication.")}n(),s()}catch($){G($.message)}finally{F(!1)}},A=async()=>{if(window.confirm("Are you sure you want to delete this recurring medication?")){F(!0);try{if(!(await ae(`/api/recurring-medications/${r.id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete recurring medication.");n(),s()}catch(P){G(P.message)}finally{F(!1)}}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"600px",width:"90%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Edit Recurring Medication"}),e.jsx("button",{className:"close-btn",onClick:s,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[B&&e.jsx("div",{className:"error-message",children:B}),e.jsxs("form",{onSubmit:C,className:"recurring-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medication Name"}),e.jsx("input",{type:"text",value:o,onChange:P=>u(P.target.value)})]}),e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pf,{size:16})," Frequency"]}),e.jsxs("select",{value:D,onChange:P=>_(parseInt(P.target.value)),children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(Li,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:T,onChange:P=>E(P.target.value)})]})]}),e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:p,onChange:P=>m(parseFloat(P.target.value))})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:f,onChange:P=>g(parseInt(P.target.value))})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Total Qty"}),e.jsx("input",{type:"number",min:"1",value:c,onChange:P=>d(parseInt(P.target.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Directions"}),e.jsx("input",{type:"text",value:x,onChange:P=>j(P.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:N,onChange:P=>k(P.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:U,onChange:P=>X(P.target.value),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"modal-actions",style:{justifyContent:"space-between"},children:[e.jsxs("button",{type:"button",className:"btn-cancel text-red-600 hover:bg-red-50",onClick:A,style:{color:"#dc3545"},children:[e.jsx(on,{size:16,style:{marginRight:"5px"}})," Delete"]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:s,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:I,children:I?"Saving...":"Save Changes"})]})]})]})]})]})}):null},sR=({messages:t})=>{const s=y.useRef(null);return y.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[t]),e.jsxs("div",{className:"conversation-panel",children:[e.jsxs("div",{className:"conversation-header",children:[e.jsx("div",{className:"conversation-title",children:e.jsx("h3",{children:"Conversation"})}),e.jsxs("span",{className:"conversation-count",children:[t.length," messages"]})]}),e.jsxs("div",{ref:s,className:"message-list custom-scrollbar",children:[t.length===0&&e.jsx("div",{className:"empty-state",children:"Start talking to the AI..."}),t.map(n=>e.jsxs("div",{className:`message-wrapper ${n.role}`,children:[e.jsx("div",{className:`message-bubble ${n.role} ${n.role==="system"?n.type||"info":""}`,children:n.role==="ai"||n.role==="system"&&n.type==="loading"?e.jsx("div",{className:"prose prose-sm max-w-none",children:n.role==="system"&&n.type==="loading"?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"})]}):e.jsx(xa,{remarkPlugins:[Ln],children:n.content})}):e.jsx("div",{className:"whitespace-pre-wrap",children:n.content})}),n.role!=="system"&&e.jsx("span",{className:"message-timestamp",children:n.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},n.id))]})]})},_p=t=>{if(!t)return"";const s=new Date(t);if(isNaN(s.getTime()))return"";const n=s.getTimezoneOffset()*6e4;return new Date(s.getTime()-n).toISOString().slice(0,16)},Vj=()=>{var jo,sr;const{openCommandBar:t}=$l(),{recordId:s,patientId:n}=Qn(),[r,o]=y.useState(s||void 0),u=ot(),c=za(),[d,p]=y.useState(""),[m]=y.useState([]),[f,g]=y.useState(null),[x,j]=y.useState(null),[N,k]=y.useState(void 0),[D,_]=y.useState(void 0),[T,E]=y.useState(null),[U,X]=y.useState(!1),[I,F]=y.useState(""),[B,G]=y.useState(!1),[C,A]=y.useState(null),[P,$]=y.useState(null),[J,R]=y.useState(!1),[L,M]=y.useState(!1),[Z,Q]=y.useState(null),[S,ge]=y.useState(""),[fe,w]=y.useState(""),[ue,Ne]=y.useState(null),[K,Y]=y.useState(!1),[V,oe]=y.useState(!1),[Pe,se]=y.useState(!1),[Ce,ee]=y.useState(window.innerHeight),[je,Ie]=y.useState([]),[$e,Fe]=y.useState(!1),[Be,qe]=y.useState(null),[et,ye]=y.useState([]),[Oe,xe]=y.useState([]),[he,W]=y.useState([]),[O,te]=y.useState(!1),[re,ke]=y.useState(null),Ue=y.useRef(null),Qe=y.useRef(null),Ze=y.useRef(!1),lt=y.useRef(null),le=y.useRef(null),pe=y.useRef(null),de=y.useRef(null),we=y.useRef(null),Ae=y.useRef(null),Re=y.useRef(null),[at,tt]=y.useState([]),[Je,wt]=y.useState(!1);y.useEffect(()=>{(async()=>{if(at.length>0&&!Je){wt(!0);const ie=at[0];ie.current&&(ie.current.scrollIntoView({behavior:"smooth",block:"center"}),ie.current.classList.add("ai-glow"),await new Promise(ne=>setTimeout(ne,2e3)),ie.current&&ie.current.classList.remove("ai-glow")),tt(ne=>ne.slice(1)),wt(!1)}})()},[at,Je]);const Mt=q=>{let ie=null;switch(q){case"update_patient_details":ie=pe;break;case"create_pharmacy_order":case"edit_pharmacy_order":ie=de;break;case"create_lab_order":case"edit_lab_order":ie=we;break;case"add_complaint_history":ie=Ae;break;case"update_case_summary":ie=Re;break}ie&&tt(ne=>[...ne,ie])},[pt,nt]=y.useState(55),[Xe,At]=y.useState(!1),Qt=y.useRef(null),kt=y.useRef(null),[Xt,sn]=y.useState("response"),cn=y.useRef(null),La=y.useRef(null),Dr=150,[Oc,zc]=y.useState([]),[fs,Ql]=y.useState([]),[$a,gs]=y.useState(!0),[Us,xs]=y.useState(null),[yn,Rc]=y.useState(!1),[Lc,ys]=y.useState(!1),[qs,Hd]=y.useState(!1),[$c,Fc]=y.useState(!1),[Vd,Er]=y.useState(!1),[Hs,bn]=y.useState([]),[bs,Yl]=y.useState(!1),[js,Tr]=y.useState(null),[Ui,Jl]=y.useState(!1),[Xl,Mn]=y.useState(null),[qi,Gd]=y.useState({}),[Ar,Kl]=y.useState(!1),[Hi,Mc]=y.useState(!1),[Bn,Pr]=y.useState(!1),[Wl,Vs]=y.useState(!1),[vs,Ir]=y.useState(!1),[Zl,Na]=y.useState([]),[eo,Vi]=y.useState(void 0),[Yn,Or]=y.useState(!1),[to,Bc]=y.useState(!1),[Gs,zr]=y.useState(!1),[Gi,Ns]=y.useState(!1),[Qa,no]=y.useState(!1),[Qs,Ys]=y.useState(!1),Ya=y.useMemo(()=>(x==null?void 0:x.admission_date)&&!(x!=null&&x.discharge_date),[x]),[wa,Js]=y.useState(!1),[Qi,Sa]=y.useState(null),[Yi,Xs]=y.useState(""),[Rr,Ks]=y.useState(void 0),[Ws,Lr]=y.useState(void 0),[_n,Fa]=y.useState(void 0),[Jn,ws]=y.useState(!1),[Uc,Ma]=y.useState(null),[ao,Ss]=y.useState(null),[$r,Fr]=y.useState(null),[Qd,Ji]=y.useState(null),[Ja,Xa]=y.useState(""),[Mr,Br]=y.useState(!1),[Xi,Yd]=y.useState(!1),Ur=y.useRef(null),[so,io]=y.useState(null),[qc,Hc]=y.useState([]),Vc=y.useCallback(q=>{Hc(ie=>[...ie,{id:Math.random().toString(36).substr(2,9),timestamp:new Date,role:"system",content:"",...q}])},[]),[Ki,Gc]=y.useState(null),qr=y.useRef(null),Hr=y.useRef(null),[Qc,ro]=y.useState(!1),[lo,Yc]=y.useState(!1),[$t,oo]=y.useState(null),[Vr,co]=y.useState(""),[Wi,Zi]=y.useState(""),[uo,Zs]=y.useState(!0),[ei,ho]=y.useState(!1),[Gr,er]=y.useState(!1),[ks,mo]=y.useState(!1),[ti,Jc]=y.useState(!1),tr=y.useRef(null),Jd=async()=>{tr.current&&(await tr.current.undoLastAction(),Jc(!1))},Cs=async q=>{try{const ie=await ae(`/api/patients/${q}`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`Failed to fetch patient details: ${ie.status}`)}const ne=await ie.json();if(j(ne),k(ne.age),_(ne.gender),ge(ne.ai_response||""),j(ve=>ve?{...ve,current_status:ne.current_status,admission_date:ne.admission_date,discharge_date:ne.discharge_date}:{...ne,current_status:ne.current_status,admission_date:ne.admission_date,discharge_date:ne.discharge_date}),ne.insurance_type&&j(ve=>ve?{...ve,insurance_type:ne.insurance_type}:{...ne}),Qr(q),ne.ai_response){const ve=/```json\s*([\s\S]*?)\s*```/,Ee=ne.ai_response.match(ve);if(Ee&&Ee[1])w(ne.ai_response.replace(ve,"").trim()),Ne(Ee[1].trim());else{const He=ne.ai_response.trim();if(He.startsWith("{")&&He.endsWith("}"))try{JSON.parse(He),w(""),Ne(He)}catch{w(He),Ne(null)}else if(He.startsWith("[")&&He.endsWith("]"))try{JSON.parse(He),w(""),Ne(He)}catch{w(He),Ne(null)}else w(He),Ne(null)}}else w(""),Ne(null)}catch{j(null),ge(""),w(""),Ne(null)}},Xc=async(q,ie)=>{j(ne=>ne?{...ne,insurance_type:ie}:null);try{const ne=await ae(`/api/patients/${q}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:ie})});if(!ne.ok){const ve=await ne.json();throw new Error(ve.message||"Failed to update insurance type")}}catch(ne){console.error("Error updating insurance type:",ne),q&&Cs(q)}},ni=async q=>{te(!0),ke(null),W([]);try{const ie=await ae(`/api/queue/patient/${q}/complaints`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`HTTP error! status: ${ie.status}`)}const ne=await ie.json();W(ne||[])}catch(ie){ke(`Past complaints error: ${ie.message}`)}finally{te(!1)}},ka=async q=>{ye([]);try{const ie=await ae(`/api/pharmacy-orders/patient/${q}`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`HTTP error! status: ${ie.status}`)}const ne=await ie.json();ye(ne||[])}catch{}},ai=async q=>{Yl(!0),Tr(null),bn([]);try{const ie=await ae(`/api/lab/orders/patient/${q}`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`HTTP error! status: ${ie.status}`)}const ne=await ie.json();bn(ne||[])}catch(ie){Tr(`Pending labs error: ${ie.message}`)}finally{Yl(!1)}},Ka=async q=>{Fe(!0),qe(null),Ie([]);try{const ie=await ae(`/api/lab/patient/${q}`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`HTTP error! status: ${ie.status}`)}const ne=await ie.json();Ie(ne||[])}catch(ie){qe(`Lab reports error: ${ie.message}`)}finally{Fe(!1)}},si=async q=>{try{const ie=await ae(`/api/patients/${q}/context`);if(!ie.ok){console.error("Failed to fetch patient context");return}const ne=await ie.json();if(j(ne.patient),k(ne.patient.age),_(ne.patient.gender),ge(ne.patient.ai_response||""),ne.patient.ai_response){const ve=/```json\s*([\s\S]*?)\s*```/,Ee=ne.patient.ai_response.match(ve);if(Ee&&Ee[1])w(ne.patient.ai_response.replace(ve,"").trim()),Ne(Ee[1].trim());else{const He=ne.patient.ai_response.trim();if(He.startsWith("{")&&He.endsWith("}"))try{JSON.parse(He),w(""),Ne(He)}catch{w(He),Ne(null)}else if(He.startsWith("[")&&He.endsWith("]"))try{JSON.parse(He),w(""),Ne(He)}catch{w(He),Ne(null)}else w(He),Ne(null)}}else w(""),Ne(null);if(Ys(ne.patient.current_status==="In Doctor Queue"||ne.patient.current_status==="In Consultation"),W(Array.isArray(ne.history)?ne.history:[]),ye(Array.isArray(ne.pharmacyOrders)?ne.pharmacyOrders:[]),Array.isArray(ne.labOrders)){const ve=ne.labOrders,Ee=ve.filter(st=>!st.report);bn(Ee);const He=ve.filter(st=>st.report).map(st=>({...st.report,id:st.id,patient_id:st.patient_id,createdAt:st.createdAt}));Ie(He),Ie(He)}else bn([]),Ie([]);Array.isArray(ne.recurringMedications)?xe(ne.recurringMedications):xe([])}catch(ie){console.error("Error fetching patient context:",ie)}},Qr=async q=>{try{const ie=await ae(`/api/queue/patient/${q}/latest`);if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||`Failed to fetch queue status: ${ie.status}`)}const ne=await ie.json();if(ne){const ve=new Date(ne.createdAt),Ee=new Date,He=ve.getDate()===Ee.getDate()&&ve.getMonth()===Ee.getMonth()&&ve.getFullYear()===Ee.getFullYear(),st=["waiting","consulting"].includes(ne.status);Ys(He&&st)}else Ys(!1)}catch(ie){console.error("Error checking patient queue status:",ie),Ys(!1)}},Yr=async(q,ie)=>{try{if(!(await ae(`/api/pharmacy-orders/${q}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:ie})})).ok)throw new Error("Failed to update pharmacy order date");f&&ka(f)}catch(ne){console.error("Error updating pharmacy order date:",ne),Q("Failed to update pharmacy order date")}},ii=async(q,ie,ne)=>{try{const ve={};if(ie==="order"?ve.date=ne:ie==="report"&&(ve.reportDate=ne),!(await ae(`/api/lab/orders/${q}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ve)})).ok)throw new Error("Failed to update lab date");f&&(ai(f),Ka(f))}catch(ve){console.error("Error updating lab order date:",ve),Q("Failed to update lab order date")}},po=q=>{u(`/dashboard/edit-pharmacy-order/${q}`)},Kc=q=>{const ie=q.medications.map((ne,ve)=>({id:Date.now()+ve,medication_name:ne.name,drug_id:ne.drug_id?String(ne.drug_id):null,quantity:(ne.pack_quantity||0)*(ne.pack_size||1)+(ne.loose_quantity||0),tablets_per_day:ne.tabletsPerDay||1,number_of_days:ne.numberOfDays||30,directions:ne.directions_to_use||"",notes:"",packs:ne.pack_quantity,loose:ne.loose_quantity,pack_size:ne.pack_size}));Na(ie),Vs(!0)},Wc=q=>{Q(null),console.log(`Preparing billing navigation for order: ${q}`);const ie=et.find(ne=>ne.id===q);if(ie){const ne=ie.medications.map(ve=>{const Ee=ve.price??0;return(ve.price===void 0||ve.price===null)&&console.warn(`Medication "${ve.name}" in order ${q} is missing a price. Defaulting to 0.`),{name:ve.name,pack_quantity:ve.pack_quantity,loose_quantity:ve.loose_quantity,price:Ee,pack_price:ve.pack_price,loose_price:ve.loose_price,total_price:Number(ve.total_price)||0,isLoose:ve.isLoose,unit:ve.unit,drug_id:ve.drug_id?String(ve.drug_id):null,tabletsPerDay:ve.tabletsPerDay,numberOfDays:ve.numberOfDays,directions_to_use:ve.directions_to_use,discount_percentage:ve.discount_percentage??0,batch:ve.batch,expiry_date:ve.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:ne}),u(`/dashboard/pharmacy-billing/${q}`,{state:{initialItems:ne}})}else console.error(`Order with ID ${q} not found.`),Q(`Order with ID ${q} not found.`),alert(`Error: Could not find order ${q} to bill.`)},Xd=async(q,ie)=>{Q(null);const ne=et.find(Ee=>Ee.id===q);if(!ne){Q(`Order with ID ${q} not found.`);return}const ve={status:ie,medications:ne.medications};try{const Ee=await ae(`/api/pharmacy-orders/${q}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ve)});if(!Ee.ok){const st=await Ee.text();throw new Error(`Failed to update status: ${Ee.statusText} (${Ee.status}) - ${st}`)}const He=await Ee.json();ye(st=>st.map(gt=>gt.id===He.id?{...gt,status:He.status}:gt)),f&&ka(f)}catch(Ee){console.error("Failed to update order status:",Ee),Q(Ee.message||`Failed to update status for order ${q}.`),alert(`Error updating status for order ${q}: ${Ee.message||"Please try again."}`)}},Zc=q=>{bn(ie=>ie.map(ne=>ne.id===q?{...ne,isEditing:!0,editedTests:[...ne.tests],editedStatus:ne.status}:{...ne,isEditing:!1}))},Kd=q=>{bn(ie=>ie.map(ne=>ne.id===q?{...ne,isEditing:!1,editedTests:void 0,editedStatus:void 0}:ne))},Wd=(q,ie,ne,ve)=>{bn(Ee=>Ee.map(He=>{if(He.id===q){const st=He.editedTests?[...He.editedTests]:[...He.tests];if(ne==="add")return{...He,editedTests:[...st,{id:"",name:"",price:0}]};if(ne==="remove")return{...He,editedTests:ve};if(ie!==-1){const gt={...st[ie],[ne]:ve};return st[ie]=gt,{...He,editedTests:st}}}return He}))},Zd=(q,ie)=>{bn(ne=>ne.map(ve=>ve.id===q?{...ve,editedStatus:ie}:ve))},Un=async q=>{if(!q){console.error("Cannot navigate to billing: Lab Order data is missing."),alert("Could not open billing page: Lab Order information is missing.");return}u(`/dashboard/lab-billing/${q.id}`)},_s=async(q,ie)=>{console.log(`Updating lab order ${q} to status ${ie}`);try{const ne=await ae(`/api/lab/${q}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:ie})});if(!ne.ok){const ve=await ne.json();throw new Error(ve.message||`Failed to update lab order status: ${ne.status}`)}f&&(ai(f),Ka(f)),console.log(`Lab Order ${q} status updated to ${ie}, refetching data.`)}catch(ne){console.error("Error updating lab order status:",ne),alert(`Failed to update lab order status: ${ne instanceof Error?ne.message:"Unknown error"}`)}},Jr=q=>{q&&q.id?u(`/lab/report/${q.id}`):(console.error("Cannot navigate: Lab Order or Lab Order ID is missing."),alert("Could not open the report entry page: Lab Order information is missing."))},eu=async(q,ie,ne)=>{Or(!0),Q(null);try{if(!ie||ie.length===0)throw new Error("Lab order must have at least one test.");for(const He of ie)if(!He.id||!He.name||isNaN(He.price)||He.price<0)throw new Error(`Invalid test data: ${JSON.stringify(He)}. Each test must have id, name, and a valid price.`);const ve={tests:ie,status:ne},Ee=await ae(`/api/lab/orders/${q}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ve)});if(!Ee.ok){const He=await Ee.json().catch(()=>({}));throw new Error(He.message||`Failed to update lab order: ${Ee.statusText}`)}f&&ai(f),bn(He=>He.map(st=>st.id===q?{...st,isEditing:!1,editedTests:void 0,editedStatus:void 0}:st))}catch(ve){Q(`Lab Order Save Error: ${ve.message}`)}finally{Or(!1)}},ri=async q=>{if(!window.confirm(`Are you sure you want to delete this ${q.type.toLowerCase()} record? This action cannot be undone.`))return;Jl(!0),Mn(null);let ne=null,ve;const Ee=q.type;try{switch(Ee){case"Complaint":if(ve=q.data.id,!ve)throw new Error("Complaint ID is missing.");ne=`/api/patients/complaints/${ve}`;break;case"Lab Order":if(ve=q.data.id,!ve)throw new Error("Lab Order ID is missing.");ne=`/api/lab/orders/${ve}`;break;case"Lab Report":if(ve=q.data.reportId,!ve)throw new Error("Lab Report ID is missing.");ne=`/api/lab/reports/${ve}`;break;case"Pharmacy Order":if(ve=q.data.id,!ve)throw new Error("Pharmacy Order ID is missing.");ne=`/api/pharmacy-orders/${ve}`;break;default:throw new Error(`Deletion not supported for item type: ${Ee}`)}if(!ne)throw new Error(`Could not determine delete URL for type: ${Ee}`);const He=await ae(ne,{method:"DELETE"});if(!He.ok){const st=await He.json().catch(()=>({}));throw new Error(st.message||`Failed to delete ${Ee}: ${He.statusText}`)}f&&(Ee==="Complaint"?ni(f):Ee==="Lab Order"?(ai(f),Ka(f)):Ee==="Lab Report"?Ka(f):Ee==="Pharmacy Order"&&ka(f))}catch(He){Mn(`Delete Error (${Ee}): ${He.message}`),Ui&&Jl(!1)}finally{Jl(!1)}},tu=async()=>{if(!f)return;if(et.filter(ie=>ie.status==="pending").length<2){alert("You need at least two pending orders to merge.");return}Yc(!0);try{const ie=await ae(`/api/pharmacy-orders/patient/${f}/merge-pending`,{method:"POST"});if(!ie.ok){const ne=await ie.json().catch(()=>({}));throw new Error(ne.message||"Failed to merge orders")}ka(f)}catch(ie){Q(`Merge Error: ${ie.message}`)}finally{Yc(!1)}},Ca=y.useMemo(()=>{if(!f||!he)return[];const q=he.map(ie=>({date:new Date(ie.createdAt),type:"Complaint",data:ie,originalDateString:ie.createdAt})).filter(ie=>!isNaN(ie.date.getTime()));return q.sort((ie,ne)=>ne.date.getTime()-ie.date.getTime()),q},[f,he]),Wa=y.useMemo(()=>{if(!f)return[];const q=new Map;(Hs??[]).forEach(ne=>{q.set(ne.id,{...ne})}),(je??[]).forEach(ne=>{if(!q.has(ne.id))q.set(ne.id,{id:ne.id,patient_id:ne.patient_id,tests:ne.tests,status:ne.status,createdAt:ne.createdAt,report:ne});else{const ve=q.get(ne.id);ve&&(ve.report=ne,ve.status=ne.status)}});let ie=Array.from(q.values());return ie.sort((ne,ve)=>new Date(ne.createdAt).getTime()-new Date(ve.createdAt).getTime()),ie=ie.map((ne,ve)=>({...ne,serialNumber:ve+1})),ie.map(ne=>({date:new Date(ne.createdAt),type:"Lab Order",data:ne,originalDateString:ne.createdAt}))},[f,Hs,je]),zn=y.useMemo(()=>{if(!f||!et)return[];const q=et.map(ie=>({date:new Date(ie.date),type:"Pharmacy Order",data:ie,originalDateString:ie.date})).filter(ie=>!isNaN(ie.date.getTime()));return q.sort((ie,ne)=>ne.date.getTime()-ie.date.getTime()),q},[f,et]),[Xr,li]=y.useState(null),[Kr,fo]=y.useState([]),[la,Ds]=y.useState(""),Wr=(q,ie)=>{if(!q||!q.report_content||!ie)return"";try{const ne=JSON.parse(q.report_content||"{}");if(typeof ne!="object"||ne===null)return`<p class="italic text-gray-500 text-xs">Report content is not structured data.</p><pre>${q.report_content}</pre>`;let ve="";return ie.forEach(Ee=>{ne[Ee.id]?(ve+=`<h5 class="font-semibold text-sm mt-2 mb-1">${Ee.name}</h5>`,ve+='<table class="lab-report-print-table"><thead><tr><th>Parameter</th><th>Value</th><th>Normal Range</th></tr></thead><tbody>',Object.entries(ne[Ee.id]).map(([He,st])=>{var ca;const gt=(ca=Ee.default_parameters)==null?void 0:ca.find(Dn=>Dn.name===He);let ft="N/A";gt&&gt.type==="number"&&(gt.lower_limit!=null||gt.upper_limit!=null)?(ft="",gt.lower_limit!=null&&(ft+=` > ${gt.lower_limit}`),gt.lower_limit!=null&&gt.upper_limit!=null&&(ft+=" - "),gt.upper_limit!=null&&(ft+=` < ${gt.upper_limit}`),ft=ft.trim()||"N/A"):(gt==null?void 0:gt.type)==="boolean"?ft="N/A":gt!=null&&gt.normal_range&&(ft=gt.normal_range),ve+=`<tr><td>${He}</td><td>${String(st)} ${(gt==null?void 0:gt.unit)||""}</td><td>${ft}</td></tr>`}),ve+="</tbody></table>"):ve+=`<p class="italic text-gray-500 text-xs">No parameters reported for ${Ee.name}.</p>`}),ve}catch{return`<p class="italic text-gray-500 text-xs">Error parsing report content.</p><pre>${q.report_content}</pre>`}};y.useEffect(()=>{const q=()=>{ee(window.innerHeight)};return window.addEventListener("resize",q),q(),()=>window.removeEventListener("resize",q)},[]),y.useEffect(()=>{const q=ne=>{if(!Xe||!La.current||!cn.current)return;const ve=cn.current.getBoundingClientRect(),He=ne.clientX-La.current.x;let st=La.current.initialWidth+He;const gt=ve.width-Dr-10;st=Math.max(Dr,st),st=Math.min(st,gt);const ft=st/ve.width*100;nt(ft)},ie=()=>{At(!1),La.current=null,document.body.style.cursor="",document.body.style.userSelect=""};return Xe&&(window.addEventListener("mousemove",q),window.addEventListener("mouseup",ie),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{window.removeEventListener("mousemove",q),window.removeEventListener("mouseup",ie),document.body.style.cursor="",document.body.style.userSelect=""}},[Xe]);const nu=q=>{if(!cn.current)return;q.preventDefault();const ie=cn.current.querySelector(".edit-complaint-context-column");ie&&(La.current={x:q.clientX,initialWidth:ie.offsetWidth},At(!0))},Za=y.useCallback(async()=>{M(!0),Q(null);try{const q=await ae("/api/queue/doctor/new",{method:"POST"});if(!q.ok){const ne=await q.json().catch(()=>({}));throw new Error(ne.message||`Failed to create record: ${q.statusText}`)}const ie=await q.json();if(!ie.recordId)throw new Error("New record ID not received from server.");u(`/edit-complaint/${ie.recordId}`,{replace:!0})}catch(q){Q(`Failed to create new complaint record: ${q.message}`)}finally{M(!1)}},[u]);y.useEffect(()=>{(async()=>{Zs(!0);try{const ie=await ae("/api/clinics/settings");if(!ie.ok){const ve=await ie.json().catch(()=>({}));throw new Error(ve.message||"Failed to fetch clinic settings.")}const ne=await ie.json();oo({admissionCharge:parseFloat(ne.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(ne.perDayCharge||0).toFixed(2),otherCharges:parseFloat(ne.otherCharges||0).toFixed(2),aiMemory:ne.aiMemory||"",aiMemoryUpdatedAt:ne.aiMemoryUpdatedAt||null,clinicWideSystemPrompt:ne.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:ne.clinicWideSystemPromptUpdatedAt||null,gemini_api_key:ne.gemini_api_key||""}),co(ne.aiMemory||""),Zi(ne.clinicWideSystemPrompt||"")}catch{}finally{Zs(!1)}})()},[]),y.useEffect(()=>{var ie;(ie=c.state)!=null&&ie.initialComplaint&&p(c.state.initialComplaint);const q=async ne=>{R(!0),Q(null);try{const ve=await ae(`/api/queue/doctor/complaint/${ne}`);if(!ve.ok){const He=await ve.json().catch(()=>({}));throw new Error(He.message||`HTTP error! status: ${ve.status}`)}const Ee=await ve.json();g(Ee.patientId),k(Ee.age),_(Ee.gender),E(Ee.case_summary||null),$(Ee.updatedAt||null)}catch{Q("Failed to load current complaint details."),g(null),k(void 0),_(void 0),E(null),$(null)}finally{R(!1)}};if(r)q(r);else if(n){const ne=n;ne&&(g(ne),(async()=>{try{const Ee=await ae(`/api/queue/patient/${ne}/latest`);if(Ee.ok){const st=await Ee.json();if(st!=null&&st._id){o(st._id),q(st._id);return}}const He=await ae("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:ne,complaint:"Visit Initiated"})});if(He.ok){const st=await He.json();if(st!=null&&st.id){o(st.id),q(st.id);return}}}catch(Ee){console.error("Background queue resolution failed",Ee),Q("Failed to initialize visit record.")}})())}else Za()},[r,Za,(jo=c.state)==null?void 0:jo.initialComplaint,n]),y.useEffect(()=>{f?si(f):(j(null),W([]),ye([]),bn([]),Ie([]),$(null),Ys(!1))},[f]),y.useEffect(()=>{var ne;const q=(ne=c.state)==null?void 0:ne.initialComplaint;q&&r&&(!J&&!O&&!bs&&!$e&&!$a)&&!Ze.current&&d===q&&(Ze.current=!0,Es(),u(c.pathname,{replace:!0,state:{}}))},[(sr=c.state)==null?void 0:sr.initialComplaint,r,d,J,O,bs,$e,$a,u]);const go=()=>{F(T||""),X(!0),A(null)},au=()=>{X(!1),F(""),A(null)},su=async()=>{if(!r){A("Missing Record ID.");return}G(!0),A(null);try{const q=await ae(`/api/queue/doctor/complaint/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:I.trim()})});if(!q.ok){const ne=await q.json().catch(()=>({}));throw new Error(ne.message||`Failed to save case summary: ${q.statusText}`)}const ie=await q.json();E(ie.case_summary||I.trim()),$(ie.updatedAt||null),X(!1)}catch(q){A(`Save Error: ${q.message}`)}finally{G(!1)}};y.useEffect(()=>{(async()=>{gs(!0),xs(null);try{const[ie,ne]=await Promise.all([ae("/api/drugs"),ae("/api/lab-tests")]);if(!ie.ok)throw new Error(`Pharmacy inventory error! status: ${ie.status}`);const ve=await ie.json(),Ee=ve.drugs||ve||[];if(zc(Ee),!ne.ok)throw new Error(`Lab inventory error! status: ${ne.status}`);const He=await ne.json();Ql(He||[])}catch(ie){xs(ie.message)}finally{gs(!1)}})()},[]);const eh=async()=>{if(!$t)return;if(Vr===$t.aiMemory&&Wi===$t.clinicWideSystemPrompt){er(!1);return}const q=Vr!==$t.aiMemory,ie=Wi!==$t.clinicWideSystemPrompt;q&&ho(!0),ie&&mo(!0);try{const ne={...$t};q&&(ne.aiMemory=Vr),ie&&(ne.clinicWideSystemPrompt=Wi);const ve=await ae("/api/clinics/settings",{method:"PUT",body:JSON.stringify(ne)});if(!ve.ok){const He=await ve.json().catch(()=>({}));throw new Error(He.message||"Failed to update clinic settings.")}const Ee=await ve.json();oo({admissionCharge:parseFloat(Ee.settings.admissionCharge).toFixed(2),perDayCharge:parseFloat(Ee.settings.perDayCharge).toFixed(2),otherCharges:parseFloat(Ee.settings.otherCharges).toFixed(2),aiMemory:Ee.settings.aiMemory||"",aiMemoryUpdatedAt:Ee.settings.aiMemoryUpdatedAt||($t==null?void 0:$t.aiMemoryUpdatedAt)||null,clinicWideSystemPrompt:Ee.settings.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:Ee.settings.clinicWideSystemPromptUpdatedAt||($t==null?void 0:$t.clinicWideSystemPromptUpdatedAt)||null}),q&&co(Ee.settings.aiMemory||""),ie&&(Zi(Ee.settings.clinicWideSystemPrompt||""),er(!1))}catch{}finally{q&&ho(!1),ie&&mo(!1)}},iu=()=>{$t&&(Zi($t.clinicWideSystemPrompt||""),er(!0))},th=()=>{er(!1),$t&&Zi($t.clinicWideSystemPrompt||"")},Es=async q=>{const ie=q??d;ie.trim()&&(Hr.current&&(clearTimeout(Hr.current),Hr.current=null),Vc({role:"user",content:ie}),tr.current&&(await tr.current.callGenerativeApi(ie),Hr.current=setTimeout(()=>{Hc([])},1e4)))},ru=q=>{navigator.clipboard.writeText(q).then(()=>{}).catch(ie=>{console.error("Failed to copy text: ",ie)})},nr=(q,ie)=>{const ne=window.open("","_blank");ne&&(ne.document.write(`
        <html>
          <head>
            <title>${ie}</title>
            <style>
              body { font-family: sans-serif; margin: 20px; }
              h2 { text-align: center; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              pre { white-space: pre-wrap; word-wrap: break-word; }
              .ai-context-section { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 5px; }
              .ai-context-section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #333; }
              .ai-context-text { margin-bottom: 5px; }
              .text-gray-400 { color: #999; }
              .font-semibold { font-weight: 600; }
              .italic { font-style: italic; }
              .mt-2 { margin-top: 8px; }
              .ml-1 { margin-left: 4px; }
              .ml-2 { margin-left: 8px; }
              .flex { display: flex; }
              .flex-col { flex-direction: column; }
              .w-full { width: 100%; }
              .text-xs { font-size: 0.75rem; }
              .text-sm { font-size: 0.875rem; }
              .prose { max-width: 65ch; }
              .prose table { display: table; } /* Ensure tables in markdown render correctly */
            </style>
          </head>
          <body>
            <h2>${ie}</h2>
            <div id="print-content">${q}</div>
          </body>
        </html>
      `),ne.document.close(),ne.print())},oa=()=>{if(S){const q=jp().use(Ln).use(Cp).processSync(fe).toString();nr(`<div class="prose">${q}</div>`,"AI Response")}};y.useEffect(()=>{if(x){let q=`
        <div class="print-section">
          <h3>Patient Details</h3>
          <p><strong>Name:</strong> ${x.name||"N/A"}</p>
          <p><strong>Token:</strong> ${x.patient_token_number||"N/A"}</p>
          <p><strong>Age:</strong> ${x.age||"N/A"}</p>
          <p><strong>Gender:</strong> ${x.gender||"N/A"}</p>
          <p><strong>Phone:</strong> ${x.phone||"N/A"}</p>
          <p><strong>Insurance:</strong> ${x.insurance_type||"N/A"}</p>
          <p><strong>Status:</strong> ${x.current_status||"N/A"}</p>
          <p><strong>Admitted:</strong> ${x.admission_date?new Date(x.admission_date).toLocaleDateString():"N/A"}</p>
          <p><strong>Discharged:</strong> ${x.discharge_date?new Date(x.discharge_date).toLocaleDateString():"N/A"}</p>
        </div>
        <div class="print-section">
          <h3>Case Summary</h3>
          <p>${T||"No summary available."}</p>
        </div>
        <div class="print-section">
          <h3>Complaints History</h3>
          ${Ca.length>0?`
            <ul>
              ${Ca.map(ie=>`<li>${new Date(ie.originalDateString).toLocaleDateString()}: ${ie.data.complaint}</li>`).join("")}
            </ul>
          `:"<p>No past complaints.</p>"}
        </div>
        <div class="print-section">
          <h3>Pharmacy Orders</h3>
          ${zn.length>0?`
            <table class="print-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Drug Name</th>
                  <th>Quantity</th>
                  <th>Dosage</th>
                  <th>Directions</th>
                </tr>
              </thead>
              <tbody>
                ${zn.map(ie=>{const ne=ie.data.medications.map((Ee,He)=>`
                    <tr>
                      ${He===0?`<td rowspan="${ie.data.medications.length+(ie.data.prescriptionForUnavailableDrugs?1:0)}">${new Date(ie.originalDateString).toLocaleDateString()}</td>`:""}
                      ${He===0?`<td rowspan="${ie.data.medications.length+(ie.data.prescriptionForUnavailableDrugs?1:0)}">${ie.data.status}</td>`:""}
                      <td><strong>${Ee.name}</strong></td>
                      <td>
                        ${Ee.pack_quantity!==void 0&&Ee.pack_quantity>0?`Packs: ${Ee.pack_quantity}`:""}
                        ${Ee.pack_quantity!==void 0&&Ee.pack_quantity>0&&Ee.loose_quantity!==void 0&&Ee.loose_quantity>0?", ":""}
                        ${Ee.loose_quantity!==void 0&&Ee.loose_quantity>0?`Loose: ${Ee.loose_quantity}`:""}
                      </td>
                      <td>${Ee.tabletsPerDay&&Ee.numberOfDays?`${Ee.tabletsPerDay} tab/day for ${Ee.numberOfDays} days`:"N/A"}</td>
                      <td>${Ee.directions_to_use||"N/A"}</td>
                    </tr>
                  `).join("");let ve="";return ie.data.prescriptionForUnavailableDrugs&&(ve=`
                      <tr>
                        <td colspan="4" style="background-color: #f9f9f9; padding: 10px;">
                          <div style="font-style: italic; margin-bottom: 5px; font-weight: 600;">Prescription for Unavailable Drugs:</div>
                          <div class="prose" style="font-size: 0.9em;">${jp().use(Ln).use(Cp).processSync(ie.data.prescriptionForUnavailableDrugs).toString()}</div>
                        </td>
                      </tr>
                    `),ne+ve}).join("")}
              </tbody>
            </table>
          `:"<p>No pharmacy orders.</p>"}
        </div>
        <div class="print-section">
          <h3>Lab History (Orders & Reports)</h3>
          ${Wa.length>0?`
            ${Wa.map(ie=>{const ne=ie.data.tests.map(Ee=>Ee.name).join(", ");let ve="";return ie.data.report&&(ve=`
                  <div class="lab-report-print-container">
                    <h4>Lab Report (${new Date(ie.data.report.report_date).toLocaleDateString()})</h4>
                    ${Wr(ie.data.report,ie.data.report.tests)}
                  </div>
                `),`
                <div class="lab-history-item">
                  <p><strong>Order Date:</strong> ${new Date(ie.originalDateString).toLocaleDateString()}</p>
                  <p><strong>Status:</strong> ${ie.data.status}</p>
                  <p><strong>Tests:</strong> ${ne}</p>
                  ${ve}
                </div>
              `}).join("")}
          `:"<p>No lab history.</p>"}
        </div>
      `;Ds(q)}else Ds("")},[x,T,Ca,zn,Wa,Wr]);const Zr=()=>{la&&nr(la,`Patient Details - ${x==null?void 0:x.name}`)},Xn=q=>{p(q),li(null),fo([]),setTimeout(()=>{Es(q)},0)},rn=J||V||Pe||$e||O||$a||bs||L||yn||Lc||qs||$c||Vd||Yn||Jn||ei||ks||lo||Ui||to||Gs||Gi||Qa||B,oi=rn,xo=()=>{p("reports came,please anaylse"),setTimeout(()=>{Es()},0)},ar=q=>{Gd(ie=>({...ie,[q]:!ie[q]}))},el=q=>{q.key==="Enter"&&!q.shiftKey&&(q.preventDefault(),!rn&&d.trim()&&r&&Es())};y.useEffect(()=>{const q=window.SpeechRecognition||window.webkitSpeechRecognition;if(!q){io("Speech recognition not supported in this browser.");return}const ie=new q;return ie.continuous=!0,ie.interimResults=!0,ie.lang="en-US",ie.onresult=ne=>{let ve="";for(let Ee=ne.resultIndex;Ee<ne.results.length;++Ee)ne.results[Ee].isFinal&&(ve+=ne.results[Ee][0].transcript);ve&&p(Ee=>Ee+(Ee.endsWith(" ")||Ee===""?"":" ")+ve)},ie.onerror=ne=>{io(`Speech error: ${ne.error}`),Yd(!1)},ie.onend=()=>{},Ur.current=ie,()=>{Ur.current&&Ur.current.stop()}},[]);const yo=async()=>{if(f)if(Ya){zr(!0);try{const q=await ae(`/api/patients/${f}/discharge`,{method:"POST"});if(!q.ok){const ie=await q.json().catch(()=>({}));throw new Error(ie.message||`Failed to discharge patient: ${q.status}`)}Cs(f)}catch(q){Q(`Discharge Error: ${q.message}`)}finally{zr(!1)}}else{Bc(!0);try{const q=await ae(`/api/patients/${f}/admit`,{method:"POST"});if(!q.ok){const ie=await q.json().catch(()=>({}));throw new Error(ie.message||`Failed to admit patient: ${q.status}`)}Cs(f)}catch(q){Q(`Admit Error: ${q.message}`)}finally{Bc(!1)}}},ci=async q=>{if(f){Ns(!0);try{const ne=await ae("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:f})});if(!ne.ok){const ve=await ne.json().catch(()=>({}));throw new Error(ve.message||`Failed to add patient to ${q} queue: ${ne.status}`)}alert(`Patient added to ${q} queue successfully!`),f&&(Cs(f),Qr(f))}catch(ie){Q(`Add to Queue Error: ${ie.message}`)}finally{Ns(!1)}}},lu=async()=>{if(r){no(!0),Q(null);try{const q=await ae(`/api/queue/${r}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"seen"})});if(!q.ok){const ie=await q.json().catch(()=>({}));throw new Error(ie.message||"Failed to complete consultation")}alert("Consultation completed successfully!"),f&&(Cs(f),Qr(f))}catch(q){Q(`Error completing consultation: ${q.message}`)}finally{no(!1)}}},tl=async()=>{if(!f){Ma("Missing Patient ID.");return}if(!x){Ma("Patient details not loaded.");return}ws(!0),Ma(null);try{const q={};let ie=!1;if(Yi!==x.name&&(q.name=Yi,ie=!0),Rr!==x.age&&(q.age=Rr,ie=!0),Ws!==x.gender&&(q.gender=Ws,ie=!0),_n!==x.phone&&(q.phone=_n,ie=!0),!ie){Ma("No changes detected."),ws(!1),Js(!1);return}const ne=await ae(`/api/patients/${f}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!ne.ok){const Ee=await ne.json().catch(()=>({}));throw new Error(Ee.message||`Failed to update patient details: ${ne.statusText}`)}const ve=await ne.json();j(ve),k(ve.age),_(ve.gender),Xs(ve.name),Ks(ve.age),Lr(ve.gender),Fa(ve.phone),Js(!1)}catch(q){Ma(`Save Error: ${q.message}`)}finally{ws(!1)}},ui=y.useCallback(()=>{if(!x)return null;const q={token_number:x.patient_token_number||"N/A",name:x.name||"N/A",age:x.age||"N/A",gender:x.gender||"N/A",phone:x.phone||"N/A"};return Ca.length>0?q.complaints_history=Ca.map(ie=>`${ie.data.complaint} (${new Date(ie.originalDateString).toLocaleDateString()})`).join("; "):q.complaints_history="No past complaints.",zn.length>0?q.pharmacy_orders_history=zn.map(ie=>`Order: ${ie.data.medications.map(ve=>{let Ee=`${ve.name}`;return ve.pack_quantity!==void 0&&ve.pack_quantity>0&&(Ee+=` Packs: ${ve.pack_quantity}`),ve.loose_quantity!==void 0&&ve.loose_quantity>0&&(Ee+=` Loose: ${ve.loose_quantity}`),Ee}).join(", ")} (${ie.data.status}, ${new Date(ie.originalDateString).toLocaleDateString()})`).join("; "):q.pharmacy_orders_history="No pharmacy orders.",Wa.length>0?q.lab_orders_history=Wa.map(ie=>{let ve=`Lab Order: ${ie.data.tests.map(Ee=>Ee.name).join(", ")} (${ie.data.status}, ${new Date(ie.originalDateString).toLocaleDateString()})`;return ie.data.report&&(ve+=` - Report: ${ie.data.report.report_content} (${new Date(ie.data.report.report_date).toLocaleDateString()})`),ve}).join("; "):q.lab_orders_history="No lab history.",Oe.length>0?q.recurring_medications=Oe.map((ie,ne)=>{let ve=`${ne+1}. ${ie.medicationName} (${ie.frequencyDays} days, ${ie.status})`;return ie.tabletsPerDay&&(ve+=` - ${ie.tabletsPerDay} tabs/day`),ie.numberOfDays&&(ve+=` for ${ie.numberOfDays} days`),ve}).join("; "):q.recurring_medications="No recurring medications.",q},[x,Ca,zn,Wa,Oe]),nh=()=>{if(!x){io("Patient details are required to use the Live API.");return}ro(!0)},qn=()=>{var q;(q=qr.current)==null||q.click()},bo=q=>{var ne;const ie=(ne=q.target.files)==null?void 0:ne[0];ie&&Gc(ie)},_a=q=>{sn(q),q==="context"&&Qt.current?Qt.current.scrollIntoView({behavior:"smooth",block:"start"}):q==="response"&&kt.current&&kt.current.scrollIntoView({behavior:"smooth",block:"start"})};return y.useEffect(()=>{const q=new IntersectionObserver(ie=>{ie.forEach(ne=>{ne.isIntersecting&&(ne.target===kt.current?sn("response"):ne.target===Qt.current&&sn("context"))})},{root:null,threshold:.5});return kt.current&&q.observe(kt.current),Qt.current&&q.observe(Qt.current),()=>{kt.current&&q.unobserve(kt.current),Qt.current&&q.unobserve(Qt.current)}},[]),e.jsxs("div",{className:"edit-complaint-page",style:{height:`${Ce}px`},children:[e.jsx(qO,{ref:tr,recordId:r,patientId:f,patientDetails:x,caseSummary:T,caseSummaryUpdatedAt:P,clinicSettings:$t,userMessages:m,selectedImageFile:Ki,pendingLabOrders:Hs,labReports:je,pastComplaints:he,pharmacyOrders:et,pharmacyInventory:Oc,labInventory:fs,recurringMedications:Oe,currentComplaint:d,setCurrentComplaint:p,setAiResponse:ge,setAiResponseText:w,setAiResponseJsonString:Ne,setShowAiJsonDetails:Y,setIsLoadingAi:oe,setAiError:()=>{},setIsSubmittingAiOrder:Rc,setAiOrderSubmissionStatus:()=>{},setIsSubmittingAiLabOrder:ys,setAiLabOrderSubmissionStatus:()=>{},setIsSubmittingAiComplaint:Hd,setAiComplaintSubmissionStatus:()=>{},setIsUpdatingCaseSummary:Fc,setAiCaseSummaryUpdateStatus:()=>{},setCaseSummary:E,setCaseSummaryUpdatedAt:$,setIsUpdatingAiMemoryByAI:Er,setAiMemoryUpdateByAIStatus:()=>{},setFollowUpQuestion:li,setFollowUpOptions:fo,setError:Q,setIsSavingAiResponse:se,setSaveAiResponseError:()=>{},fetchPharmacyOrdersData:ka,fetchPendingLabOrdersData:ai,fetchLabReportsData:Ka,fetchPastComplaintsData:ni,fetchPatientDetails:Cs,fetchRecurringMedicationsData:si,setClinicSettings:oo,setEditedAiMemory:co,handleDeleteItem:ri,setCanUndo:Jc,onAiActionSuccess:Mt,addMessage:Vc}),Qc&&x&&e.jsx(Md,{onClose:()=>ro(!1),patientData:ui(),tokenNumber:x.patient_token_number?String(x.patient_token_number):null,onAiSummaryChange:q=>{q&&(p(q),Es(q),ro(!1))}}),e.jsxs("div",{className:"edit-complaint-header",children:[e.jsx("button",{onClick:()=>u(-1),disabled:rn,className:"back-button",title:"Go Back",children:e.jsx(vt,{size:20})}),e.jsx("span",{ref:le,style:{position:"absolute",visibility:"hidden",height:"auto",width:"auto",whiteSpace:"nowrap"}}),x&&e.jsx("div",{className:"edit-complaint-patient-details",children:x&&!wa?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Js(!0),Xs(x.name||""),Ks(x.age),Lr(x.gender),Fa(x.phone),Ma(null)},className:"edit-button mr-2",title:"Edit Patient Details",disabled:Jn,children:e.jsx(qa,{size:14})}),x.name??"N/A",x.patient_token_number!==null&&x.patient_token_number!==void 0&&` (${x.patient_token_number})`," - ",x.age??"N/A"," / ",x.gender??"N/A",x.phone&&` / ${x.phone}`,e.jsx("button",{onClick:q=>{q.stopPropagation(),Zr()},disabled:!la,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900",children:e.jsx(ls,{size:14})})]}):x&&wa?e.jsxs("div",{className:"patient-details-edit-form",children:[e.jsx("input",{type:"text",value:Yi,onChange:q=>Xs(q.target.value),placeholder:"Name",className:"edit-input",disabled:Jn}),e.jsx("input",{type:"number",value:Rr??"",onChange:q=>Ks(q.target.value?parseInt(q.target.value):null),placeholder:"Age",className:"edit-input",disabled:Jn}),e.jsxs("select",{value:Ws??"",onChange:q=>Lr(q.target.value||null),className:"edit-input",disabled:Jn,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]}),e.jsx("input",{type:"text",value:_n??"",onChange:q=>Fa(q.target.value||null),placeholder:"Phone Number",className:"edit-input",disabled:Jn}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{onClick:()=>{Js(!1),Ma(null)},className:"button-secondary",disabled:Jn,children:"Cancel"}),e.jsx("button",{onClick:tl,className:"button-primary blue",disabled:Jn,children:Jn?"Saving...":"Save"})]}),Uc&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Uc})]}):e.jsxs("div",{className:"edit-complaint-patient-details",children:[N??"N/A"," / ",D??"N/A",e.jsx("button",{onClick:q=>{q.stopPropagation(),Zr()},disabled:!la,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900",children:e.jsx(ls,{size:14})})]})}),!x&&N!==void 0&&D!==void 0&&e.jsxs("div",{className:"edit-complaint-patient-details",children:[N??"N/A"," / ",D??"N/A",e.jsx("button",{onClick:q=>{q.stopPropagation(),Zr()},disabled:!la,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900",children:e.jsx(ls,{size:14})})]}),e.jsx("div",{style:{minWidth:"64px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:t,className:"icon-button small text-gray-600 hover:text-gray-900 bg-gray-100 hover:bg-gray-200",title:"Open Command Bar (Ctrl+K)",style:{padding:"0.2rem",borderRadius:"8px"},children:e.jsx(mn,{size:24})})})]}),e.jsxs("div",{className:"edit-complaint-content-area",ref:cn,children:[qc.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"edit-complaint-chat-column",style:{width:"30%",minWidth:"320px",maxWidth:"40%",flexShrink:0},children:e.jsx(sR,{messages:qc})}),e.jsx("div",{className:"draggable-divider",onMouseDown:()=>{}})]}),e.jsxs("div",{ref:kt,className:"edit-complaint-main-column",style:{flex:1,minWidth:0},children:[Z&&e.jsxs("div",{className:"general-error-message",children:["Error: ",Z]}),(fe||ue)&&e.jsxs("div",{ref:Ue,className:`${ue?"ai-function-call-block":"ai-response-container"} group`,children:[fe&&e.jsx(xa,{remarkPlugins:[Ln],children:fe}),ue&&e.jsxs("div",{className:"ai-json-details-container",children:[e.jsxs("button",{onClick:()=>Y(!K),className:"ai-json-toggle-button",children:[K?e.jsx(Vy,{size:14,className:"mr-1"}):e.jsx(Gy,{size:14,className:"mr-1"}),K?"Hide":"Show"," AI Function Call Details"]}),K&&e.jsx("pre",{className:"ai-json-pre",children:e.jsx("code",{children:JSON.stringify(JSON.parse(ue),null,2)})})]}),e.jsxs("div",{className:"ai-response-actions",children:[e.jsx("button",{onClick:()=>ru(S),disabled:!S,title:"Copy Full AI Response",children:e.jsx(Fw,{size:12})}),e.jsx("button",{onClick:oa,disabled:!S,title:"Print AI Response",children:e.jsx(ls,{size:12})})]})]})]}),e.jsx("div",{className:"draggable-divider",onMouseDown:nu}),e.jsx("div",{ref:Qt,className:"edit-complaint-context-column",style:{flexBasis:`calc(${100-pt}% - 5px)`},children:e.jsxs("div",{className:"ai-context-container",children:[e.jsxs("h3",{className:"ai-context-header",children:[e.jsx("span",{children:"AI Context:"}),(x==null?void 0:x.insurance_type)&&e.jsx("div",{className:"insurance-type-container mt-2",children:e.jsxs("select",{ref:lt,value:x.insurance_type,onChange:q=>Xc(x.id,q.target.value),className:"insurance-type-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})})]}),e.jsxs("div",{ref:pe,className:"ai-context-section",children:[e.jsx("h4",{className:"ai-context-section-title",children:"Admission Status"}),(x==null?void 0:x.admission_date)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Admitted:"})," ",new Date(x.admission_date).toLocaleDateString()]}),(x==null?void 0:x.discharge_date)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Discharged:"})," ",new Date(x.discharge_date).toLocaleDateString()]}),(x==null?void 0:x.current_status)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Current Status:"})," ",e.jsx("span",{className:"font-semibold",children:x.current_status})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx("button",{onClick:yo,className:`admit-discharge-button ${Ya?"discharge":"admit"}`,title:Ya?"Discharge Patient":"Admit Patient",disabled:!f||to||Gs,children:to?"Admitting...":Gs?"Discharging...":Ya?"Discharge":"Admit"}),e.jsx("button",{onClick:()=>ci("doctor"),className:`queue-status-button ${Qs?"in-queue":"add-to-queue"}`,title:Qs?"Patient is in Doctor Queue":"Add Patient to Doctor Queue",disabled:!f||Gi||Qs,children:Gi?"Adding...":Qs?"In Queue":"Add to Queue"}),e.jsx("button",{onClick:lu,className:"complete-consultation-button",title:"Mark Consultation as Complete",disabled:Qa,children:Qa?"Completing...":"Complete Consultation"})]})]}),e.jsx("div",{ref:de,children:e.jsx(vp,{title:"Pharmacy Order History",headerAction:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:tu,className:"button-primary blue text-xs px-2 py-1",disabled:lo||et.filter(q=>q.status==="pending").length<2,title:"Merge all pending orders into one",children:lo?"Merging...":"Merge Orders"}),e.jsxs("button",{onClick:()=>Mc(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new pharmacy order",disabled:!f,children:[e.jsx(Ia,{size:12,className:"mr-1"})," Create Order"]})]}),items:zn,isLoading:!1,loadingText:"Loading...",noDataText:"No orders.",renderItemContent:(q,ie)=>e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("span",{className:"ai-context-text flex items-center",children:[" ",zn.length-ie,". Order Status: (",q.data.status,")",e.jsx("span",{className:"text-gray-400 ml-1 flex items-center",children:Qi===q.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",children:e.jsx("input",{type:"datetime-local",defaultValue:_p(q.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:ne=>{ne.target.value&&Yr(q.data.id,ne.target.value),Sa(null)},onKeyDown:ne=>{if(ne.key==="Enter"){const ve=ne.target;ve.value&&Yr(q.data.id,ve.value),Sa(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:()=>Sa(q.data.id),title:"Click to edit date",children:["(",new Date(q.originalDateString).toLocaleDateString(),")",e.jsx(qa,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),e.jsxs("div",{className:"inline-flex space-x-2 ml-2",children:[" ",e.jsx("button",{onClick:()=>po(q.data.id),className:"icon-button small",title:"Edit Pharmacy Order",children:e.jsx(qa,{size:12})}),q.data.prescriptionForUnavailableDrugs&&e.jsx("button",{onClick:()=>{const ne=jp().use(Ln).use(Cp).processSync(q.data.prescriptionForUnavailableDrugs).toString();nr(ne,"Unavailable Drugs Prescription")},className:"icon-button small",title:"Print Unavailable Drugs Prescription",children:e.jsx(ls,{size:12})}),q.data.status==="dispensed"||q.data.status==="billed"?e.jsx("button",{onClick:()=>u(`/dashboard/pharmacy-billing/${q.data.id}`),className:"icon-button small text-blue-600",title:"View Pharmacy Bill",children:e.jsx(hs,{size:12})}):e.jsx("button",{onClick:()=>ri({type:"Pharmacy Order",data:q.data}),className:"icon-button small text-red-500",title:"Delete Pharmacy Order",children:e.jsx(on,{size:12})}),q.data.status==="pending"&&e.jsx("button",{onClick:()=>Wc(q.data.id),className:"icon-button small",title:"Bill this pharmacy order",disabled:Yn,children:e.jsx(Ll,{size:12})}),q.data.status==="billed"&&e.jsx("button",{onClick:()=>Xd(q.data.id,"dispensed"),className:"icon-button small",title:"Dispense this pharmacy order",disabled:Yn,children:e.jsx(aa,{size:12})}),e.jsx("button",{onClick:()=>Kc(q.data),className:"icon-button small group-hover:block",title:"Add to Recurring Medications",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-repeat",children:[e.jsx("path",{d:"m17 2 4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),e.jsx("path",{d:"m7 22-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]})})]})]}),e.jsx("div",{className:"pharmacy-order-drugs-table-container mt-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1",onClick:()=>po(q.data.id),title:"Click to edit order",children:e.jsxs("table",{className:"pharmacy-order-drugs-table w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-2 text-left",children:"Drug Name"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Quantity"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Dosage"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Directions"})]})}),e.jsx("tbody",{children:q.data.medications.map((ne,ve)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2",children:e.jsx("strong",{children:ne.name})}),e.jsxs("td",{className:"py-1 px-2",children:[ne.pack_quantity!==void 0&&ne.pack_quantity>0&&`Packs: ${ne.pack_quantity}`,ne.pack_quantity!==void 0&&ne.pack_quantity>0&&ne.loose_quantity!==void 0&&ne.loose_quantity>0&&", ",ne.loose_quantity!==void 0&&ne.loose_quantity>0&&`Loose: ${ne.loose_quantity}`]}),e.jsx("td",{className:"py-1 px-2",children:ne.tabletsPerDay&&ne.numberOfDays?`${ne.tabletsPerDay} tab/day for ${ne.numberOfDays} days`:"N/A"}),e.jsx("td",{className:"py-1 px-2",children:ne.directions_to_use||"N/A"})]},ne.drug_id||ne.name||ve))})]})}),q.data.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"unavailable-drugs-markdown mt-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-600 block mb-1",children:"Prescription for Unavailable Drugs:"}),e.jsx(xa,{remarkPlugins:[Ln],children:q.data.prescriptionForUnavailableDrugs})]})]})})}),e.jsxs("div",{className:"ai-context-section mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"ai-context-section-title mb-0",children:"Recurring Medications"}),e.jsxs("button",{onClick:()=>{Na([]),Vs(!0)},className:"text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(Ia,{size:12})," Add"]})]}),Oe.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"#"}),e.jsx("th",{className:"py-1 px-2",children:"Medication"}),e.jsx("th",{className:"py-1 px-2",children:"Qty"}),e.jsx("th",{className:"py-1 px-2",children:"Frequency"}),e.jsx("th",{className:"py-1 px-2",children:"Next Delivery"}),e.jsx("th",{className:"py-1 px-2",children:"Status"}),e.jsx("th",{className:"py-1 px-2"})]})}),e.jsx("tbody",{children:Oe.map((q,ie)=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 px-2 font-medium text-gray-500",children:ie+1}),e.jsxs("td",{className:"py-1 px-2 font-medium",children:[q.medicationName,e.jsxs("div",{className:"text-[10px] text-gray-500 font-normal",children:[q.tabletsPerDay?`${q.tabletsPerDay} tabs/day`:"",q.tabletsPerDay&&q.numberOfDays?"  ":"",q.numberOfDays?`${q.numberOfDays} days`:"",q.directions?`  ${q.directions}`:""]})]}),e.jsx("td",{className:"py-1 px-2",children:q.quantity}),e.jsxs("td",{className:"py-1 px-2",children:[q.frequencyDays," days"]}),e.jsx("td",{className:"py-1 px-2",children:new Date(q.nextDeliveryDate).toLocaleDateString()}),e.jsx("td",{className:"py-1 px-2",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${q.status==="active"?"bg-green-100 text-green-800":q.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:q.status})}),e.jsx("td",{className:"py-1 px-2 text-right",children:e.jsx("button",{onClick:()=>{Vi(q),Ir(!0)},className:"text-gray-400 hover:text-blue-600 p-1",title:"Edit",children:e.jsx(qa,{size:12})})})]},q.id))})]})}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No recurring medications."})]}),Hi&&e.jsx(tR,{isOpen:Hi,onClose:()=>Mc(!1),patientId:f,pharmacyInventory:Oc,fetchPharmacyOrdersData:ka}),e.jsxs("div",{ref:we,children:[e.jsx(vp,{title:"Lab History (Orders & Reports)",headerAction:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:xo,className:"button-primary blue text-xs px-2 py-1",title:"Tell AI to analyse the reports",disabled:oi,children:"Analyse Reports"}),e.jsxs("button",{onClick:()=>Kl(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new lab order",disabled:!f,children:[e.jsx(Ia,{size:12,className:"mr-1"})," Create Lab Order"]})]}),items:Wa,onDeleteItem:void 0,onEditLabOrder:void 0,onSaveLabOrder:eu,onCancelEditLabOrder:Kd,onLabOrderTestChange:Wd,onLabOrderStatusChange:Zd,onBillLabOrder:void 0,onUpdateLabOrderStatus:void 0,onEnterLabReport:void 0,labInventory:fs,isSavingLabOrder:Yn,isLoading:bs||$e,loadingText:"Loading...",noDataText:"No lab Hx.",expandedLabReports:qi,toggleLabReport:ar,renderItemContent:(q,ie)=>{const ne=cO(q.data.report?q.data.report.status:q.data.status),ve=(q.data.tests||[]).reduce((Ee,He)=>Ee+(Number(He.price)||0),0).toFixed(2);return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"ai-context-text flex items-center flex-wrap",children:[e.jsxs("span",{className:"font-medium cursor-pointer hover:text-blue-600 transition-colors mr-2",onClick:()=>Jr(q.data),title:"Click to enter report",children:["#",q.data.serialNumber," [Order]"]}),e.jsx("span",{className:`mr-2 ${ne.className}`,children:ne.text}),e.jsx("span",{className:"text-gray-400 inline-flex items-center",children:ao===q.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:Ee=>Ee.stopPropagation(),children:e.jsx("input",{type:"datetime-local",defaultValue:_p(q.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:Ee=>{Ee.target.value&&ii(q.data.id,"order",Ee.target.value),Ss(null)},onKeyDown:Ee=>{if(Ee.key==="Enter"){const He=Ee.target;He.value&&ii(q.data.id,"order",He.value),Ss(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:Ee=>{Ee.stopPropagation(),Ss(q.data.id)},title:"Click to edit order date",children:["(",new Date(q.originalDateString).toLocaleDateString(),")",e.jsx(qa,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})})]}),!q.data.isEditing&&e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("button",{onClick:()=>Zc(q.data.id),className:"icon-button small",title:"Edit",disabled:Yn,children:e.jsx(qa,{size:12})}),q.data.status==="pending"&&e.jsx("button",{onClick:()=>Un(q.data),className:"icon-button small font-medium text-green-600 w-auto px-1",title:`Pay total of ${ve}`,disabled:Yn,children:e.jsx(r0,{size:12})}),q.data.status==="billed"&&e.jsx("button",{onClick:()=>_s(q.data.id,"collected"),className:"icon-button small text-blue-600",title:"Collect Sample",disabled:Yn,children:"Collect"}),q.data.status==="collected"&&e.jsx("button",{onClick:()=>_s(q.data.id,"processing"),className:"icon-button small text-purple-600",title:"Mark Processing",disabled:Yn,children:"Process"}),["pending","billed","collected","processing","report_ready","reported","completed"].includes(q.data.status)&&e.jsx("button",{onClick:()=>Jr(q.data),className:"icon-button small text-indigo-600",title:"Enter Report",disabled:Yn,children:e.jsx(hs,{size:12})}),(q.data.status==="report_ready"||q.data.status==="reported")&&e.jsx("button",{onClick:()=>_s(q.data.id,"completed"),className:"icon-button small text-green-600",title:"Mark Completed",disabled:Yn,children:e.jsx(aa,{size:12})}),e.jsx("button",{onClick:()=>ri({type:"Lab Order",data:q.data}),className:"icon-button small text-red-500",title:"Delete",disabled:Yn,children:e.jsx(on,{size:12})})]})]}),e.jsx("div",{className:"lab-order-tests-table-container mt-1 mb-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1 border border-gray-100",onClick:()=>{q.data.status==="pending"?Zc(q.data.id):Jr(q.data)},title:q.data.status==="pending"?"Click to edit order":"Click to enter report",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"py-1 px-2 font-medium text-gray-600",children:"Test Name"}),e.jsx("th",{className:"py-1 px-2 text-right font-medium text-gray-600",children:"Price"})]})}),e.jsxs("tbody",{children:[q.data.tests&&q.data.tests.length>0?q.data.tests.map(Ee=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-100",children:[e.jsx("td",{className:"py-1 px-2",children:Ee.name}),e.jsxs("td",{className:"py-1 px-2 text-right",children:["",Ee.price]})]},Ee.id||Ee.name)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"py-1 px-2 italic text-gray-500",children:"No tests specified"})}),e.jsxs("tr",{className:"bg-gray-50 font-semibold",children:[e.jsx("td",{className:"py-1 px-2 text-right text-gray-700",children:"Total:"}),e.jsxs("td",{className:"py-1 px-2 text-right text-gray-900",children:["",ve]})]})]})]})}),q.data.report&&e.jsxs("div",{className:"ml-4 mt-1 p-2 border-l-2 border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-700",children:"[Report]"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 ml-1 flex items-center text-xs",children:$r===q.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:Ee=>Ee.stopPropagation(),children:e.jsx("input",{type:"datetime-local",defaultValue:_p(q.data.report.report_date),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:Ee=>{Ee.target.value&&ii(q.data.id,"report",Ee.target.value),Fr(null)},onKeyDown:Ee=>{if(Ee.key==="Enter"){const He=Ee.target;He.value&&ii(q.data.id,"report",He.value),Fr(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/reportDate ml-1",onClick:Ee=>{Ee.stopPropagation(),Fr(q.data.id)},title:"Click to edit report date",children:["(",new Date(q.data.report.report_date).toLocaleDateString(),")",e.jsx(qa,{size:12,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),e.jsx("button",{onClick:()=>ar(q.data.report.reportId),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400 ml-2",title:qi[q.data.report.reportId]?"Collapse Report":"Expand Report",children:qi[q.data.report.reportId]?e.jsx(Vy,{size:14}):e.jsx(Gy,{size:14})}),e.jsx("button",{onClick:()=>ri({type:"Lab Report",data:q.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400 ml-1",title:"Delete Report",children:e.jsx(on,{size:12})})]})]}),qi[q.data.report.reportId]&&(()=>{try{const Ee=JSON.parse(q.data.report.report_content||"{}");return typeof Ee=="object"&&Ee!==null&&q.data.report.tests?q.data.report.tests.map(He=>e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("h5",{className:"font-semibold text-xs mt-2 mb-1 text-gray-700",children:He.name}),Ee[He.id]?e.jsxs("table",{className:"lab-inventory-table w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Parameter"}),e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Value"}),e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Normal Range"})]})}),e.jsx("tbody",{children:Object.entries(Ee[He.id]).map(([st,gt])=>{var ca;const ft=(ca=He.default_parameters)==null?void 0:ca.find(Dn=>Dn.name===st);return e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-1 px-2",children:st}),e.jsxs("td",{className:"py-1 px-2",children:[String(gt)," ",(ft==null?void 0:ft.unit)||""]}),e.jsx("td",{className:"py-1 px-2 text-gray-500",children:(()=>{if(ft&&ft.type==="number"&&(ft.lower_limit!=null||ft.upper_limit!=null)){let Dn="";return ft.lower_limit!=null&&(Dn+=` > ${ft.lower_limit}`),ft.lower_limit!=null&&ft.upper_limit!=null&&(Dn+=" - "),ft.upper_limit!=null&&(Dn+=` < ${ft.upper_limit}`),Dn.trim()||"N/A"}else if((ft==null?void 0:ft.type)==="boolean")return"N/A";return(ft==null?void 0:ft.normal_range)||"N/A"})()})]},st)})})]}):e.jsx("p",{className:"italic text-gray-500 text-xs",children:"No parameters reported for this test."})]},He.id)):e.jsx("div",{className:"text-xs prose",children:e.jsx(xa,{remarkPlugins:[Ln],children:q.data.report.report_content})})}catch{return e.jsx("div",{className:"text-xs prose",children:e.jsx(xa,{remarkPlugins:[Ln],children:q.data.report.report_content||"*No findings recorded.*"})})}})()]})]})}}),e.jsx(RO,{isOpen:Ar,onClose:()=>Kl(!1),patientId:f,labInventory:fs,fetchPendingLabOrdersData:ai}),e.jsx("div",{ref:Ae,children:e.jsx(vp,{title:"Complaints History",items:Ca,isLoading:O,loadingText:"Loading...",noDataText:"No past Hx.",renderItemContent:(q,ie)=>e.jsx("div",{className:"ai-context-text w-full",children:Qd===q.data.id?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("input",{type:"text",value:Ja,onChange:ne=>Xa(ne.target.value),className:"border rounded px-2 py-1 text-sm w-full",autoFocus:!0,onKeyDown:async ne=>{if(ne.key==="Enter"&&Ja.trim()){Br(!0);try{await ae(`/api/patients/complaints/${q.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:Ja.trim()})}),q.data.complaint=Ja.trim(),Ji(null),Xa("")}catch(ve){console.error("Error updating complaint:",ve)}Br(!1)}ne.key==="Escape"&&(Ji(null),Xa(""))},disabled:Mr}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:async()=>{if(Ja.trim()){Br(!0);try{await ae(`/api/patients/complaints/${q.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:Ja.trim()})}),q.data.complaint=Ja.trim(),Ji(null),Xa("")}catch(ne){console.error("Error updating complaint:",ne)}Br(!1)}},className:"text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",disabled:Mr||!Ja.trim(),children:Mr?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{Ji(null),Xa("")},className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",disabled:Mr,children:"Cancel"})]})]}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 rounded px-1 -mx-1 transition-colors inline-block",onClick:()=>{Ji(q.data.id),Xa(q.data.complaint)},title:"Click to edit",children:[q.data.complaint,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",new Date(q.originalDateString).toLocaleDateString(),")"]})]})}),onDeleteItem:ri})}),e.jsxs("div",{className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"ai-context-section-title",children:[e.jsx(Id,{size:16,className:"text-purple-600"})," Clinic-wide System Prompt"]}),!Gr&&e.jsx("button",{onClick:iu,className:"edit-button",title:"Edit System Prompt",disabled:uo||ei||ks,children:e.jsx(qa,{size:14})})]}),Gr&&$t?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:Wi,onChange:q=>Zi(q.target.value),className:"context-edit-textarea",placeholder:"Enter clinic system prompt...",disabled:ei||ks}),e.jsxs("div",{className:"context-edit-actions",children:[e.jsx("button",{onClick:th,disabled:ei||ks,className:"button-secondary",children:"Cancel"}),e.jsxs("button",{onClick:eh,disabled:ei||ks||Vr===$t.aiMemory&&Wi===$t.clinicWideSystemPrompt,className:"button-primary purple",children:[e.jsx(wr,{size:14,className:"mr-1"}),ks||ei?"Saving...":"Save Settings"]})]})]}):e.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:iu,title:"Click to edit system prompt",children:$t!=null&&$t.clinicWideSystemPrompt?e.jsx(xa,{remarkPlugins:[Ln],children:$t.clinicWideSystemPrompt}):e.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),!Gr&&($t==null?void 0:$t.clinicWideSystemPromptUpdatedAt)&&e.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Prompt Last Updated: ",new Date($t.clinicWideSystemPromptUpdatedAt).toLocaleDateString()]})]}),e.jsxs("div",{ref:Re,className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"ai-context-section-title",children:"Case Summary"}),!U&&e.jsx("button",{onClick:go,className:"edit-button",title:"Edit Case Summary",disabled:J||B,children:e.jsx(qa,{size:14})})]}),U?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:I,onChange:q=>F(q.target.value),className:"context-edit-textarea",rows:4,placeholder:"Enter case summary...",disabled:B}),C&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C}),e.jsxs("div",{className:"context-edit-actions",children:[e.jsx("button",{onClick:au,disabled:B,className:"button-secondary",children:"Cancel"}),e.jsx("button",{onClick:su,disabled:B||I===T,className:"button-primary blue",children:B?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:go,title:"Click to edit case summary",children:T?e.jsx(xa,{remarkPlugins:[Ln],components:{},children:T}):e.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),P&&e.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Last Edited: ",new Date(P).toLocaleDateString()]})]})]}),Ca.length===0&&Wa.length===0&&zn.length===0&&!(O||bs||$e)&&e.jsx("p",{className:"ai-context-text italic mt-4",children:"No recent history for this patient."}),Ui&&e.jsx("p",{className:"text-yellow-600 text-xs mt-2 ai-context-text",children:"Deleting..."}),Xl&&e.jsx("p",{className:"text-red-600 text-xs mt-2 ai-context-text",children:Xl})]})]})})]}),e.jsxs("div",{className:"edit-complaint-input-area",children:[e.jsx("div",{className:"mobile-section-selector",children:e.jsxs("div",{className:"selector-container",children:[e.jsx("button",{onClick:()=>_a("response"),className:`selector-button ${Xt==="response"?"active":""}`,children:"AI Response"}),e.jsx("button",{onClick:()=>_a("context"),className:`selector-button ${Xt==="context"?"active":""}`,children:"Case"})]})}),e.jsxs("div",{className:"status-messages-container",children:[Be&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Be}),re&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:re}),js&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:js}),Us&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Us})]}),r&&!L&&e.jsxs(y.Fragment,{children:[Xr&&e.jsxs("div",{className:"follow-up-question-container",children:[e.jsx("p",{className:"question-text",children:Xr}),Kr.length>0&&e.jsx("div",{className:"options-grid",children:Kr.map((q,ie)=>e.jsx("button",{onClick:()=>Xn(q),className:"option-button",children:q},ie))})]}),so&&e.jsx("div",{className:"speech-error-display",children:so}),Ki&&e.jsxs("div",{className:"selected-file-display",children:[e.jsxs("span",{children:["Selected: ",Ki.name]}),e.jsx("button",{onClick:()=>{Gc(null),qr.current&&(qr.current.value="")},className:"remove-file-button",title:"Remove image",children:""})]}),e.jsx("div",{className:"input-wrapper",children:e.jsxs("div",{className:"main-input-container",children:[e.jsx("input",{type:"file",ref:qr,onChange:bo,accept:"image/*",className:"hidden"}),e.jsx("textarea",{ref:Qe,className:"complaint-textarea",value:d,onChange:q=>p(q.target.value),onKeyDown:el,placeholder:"name,age,sex,phone,complaints,reports,history",disabled:rn||!r||Xi}),e.jsxs("div",{className:"chat-input-actions-container",children:[f&&e.jsx("button",{onClick:()=>u("/inventory"),disabled:$a,className:"icon-button",title:"View Inventory",children:e.jsx(Nr,{size:14})}),e.jsx("button",{type:"button",onClick:qn,disabled:rn||!r||Xi,className:"icon-button",title:"Attach Image",children:e.jsx(Td,{size:14})}),e.jsx("button",{type:"button",onClick:nh,disabled:rn||!r||!Ur.current,className:`mic-button ${Xi?"listening":""}`,title:Xi?"Stop":"Mic",children:e.jsx(kc,{size:14})}),e.jsx("button",{onClick:()=>Es(),disabled:rn||!d.trim()||!r||Xi,className:"send-button",title:rn?"Processing...":"Save & Ask AI",children:rn?e.jsx("div",{className:"custom-loader-circle",role:"status","aria-label":"loading"}):e.jsx(Pp,{size:14})}),ti&&e.jsx("button",{type:"button",onClick:Jd,disabled:rn,className:"icon-button text-red-500",title:"Undo Last AI Actions",children:e.jsx(on,{size:14})})]})]})})]})]}),Wl&&f&&e.jsx(nR,{isOpen:Wl,onClose:()=>Vs(!1),onSuccess:()=>{f&&si(f),Vs(!1),Na([])},patientId:f,initialItems:Zl}),vs&&eo&&e.jsx(aR,{isOpen:vs,onClose:()=>Ir(!1),onSuccess:()=>{f&&si(f),Ir(!1),Vi(void 0)},medication:eo}),Bn&&e.jsx($1,{isOpen:Bn,onClose:()=>{Pr(!1),Vi(void 0),Na([])},onSuccess:()=>{f&&si(f),Pr(!1),Vi(void 0),Na([])},initialItems:Zl,medication:eo,initialPatient:x?{id:x.id,name:x.name,phone:x.phone||"",patient_token_number:String(x.patient_token_number||"")}:void 0})]})},iR=()=>{const{patientId:t}=Qn(),s=ot(),[n,r]=y.useState([]),[o,u]=y.useState(null),[c,d]=y.useState(!1),[p,m]=y.useState(null);y.useEffect(()=>{(async()=>{if(!t){m("Patient ID not provided.");return}d(!0),m(null);try{const x=await ae(`/api/patients/${t}`);if(!x.ok)throw new Error(`Failed to fetch patient details: ${x.status}`);const j=await x.json();u({name:j.name,age:j.age,gender:j.gender});const N=await ae(`/api/patients/${t}/complaints`);if(N.ok){const D=(await N.json()).sort((_,T)=>new Date(T.createdAt).getTime()-new Date(_.createdAt).getTime());r(D)}else if(N.status===404)r([]);else throw new Error(`Failed to fetch complaints: ${N.status}`)}catch(x){console.error("Error fetching past complaints or patient info:",x),m(`Failed to load data. ${x.message}`),r([]),u(null)}finally{d(!1)}})()},[t]);const f=g=>{navigator.clipboard.writeText(g).then(()=>console.log("Complaint copied to clipboard")).catch(x=>console.error("Failed to copy complaint: ",x))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>s(-1),className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-3 rounded text-sm",children:"< Back"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-center flex-grow",children:"Past Complaints"}),e.jsx("div",{className:"w-16"})," "]}),o&&e.jsxs("div",{className:"mb-4 p-2 bg-gray-100 rounded text-center text-sm sm:text-base",children:["Patient: ",e.jsx("strong",{children:o.name})," (",o.age??"N/A"," / ",o.gender??"N/A",")"]}),p&&e.jsxs("div",{className:"text-red-500 p-3 mb-4 border border-red-500 rounded bg-red-50 text-sm",children:["Error: ",p]}),c&&e.jsx("p",{className:"text-center text-gray-500",children:"Loading..."}),!c&&n.length===0&&!p&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No past complaints found for this patient."}),!c&&n.length>0&&e.jsx("div",{className:"space-y-4",children:n.map(g=>e.jsxs("div",{className:"p-3 border rounded shadow-sm bg-white group relative",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:new Date(g.createdAt).toLocaleString()}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:g.complaint}),e.jsx("button",{onClick:()=>f(g.complaint),className:"absolute top-1 right-1 bg-gray-200 hover:bg-gray-300 text-gray-600 text-xs p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Copy complaint text",children:""})]},g.id))})]})},fd=500,Gj="defaultConsultationFee",rR=({patientId:t,billId:s,queueId:n,onBillCreated:r,onBillUpdated:o,initialItems:u=[],billType:c="other",relatedId:d,initialStatus:p="pending",initialDiscountPercentage:m=0,readOnlyMode:f=!1,doctorId:g,labOrderId:x,patientInsuranceType:j})=>{const[N,k]=y.useState(null),[D,_]=y.useState([]),T=y.useRef([]),[E,U]=y.useState(""),[X,I]=y.useState(""),[F,B]=y.useState(1),[G,C]=y.useState(m),[A,P]=y.useState("cash"),[$,J]=y.useState(!1),[R,L]=y.useState(null),[M,Z]=y.useState(!1),[Q,S]=y.useState(!1),[ge,fe]=y.useState(!1),[w,ue]=y.useState(null),[,Ne]=y.useState([]),[K,Y]=y.useState(null),[V,oe]=y.useState(""),[Pe,se]=y.useState("cash"),[Ce,ee]=y.useState(!1),[je,Ie]=y.useState(fd),[$e,Fe]=y.useState(fd.toString()),Be=s?"view_pay":"create";y.useEffect(()=>{const le=localStorage.getItem(Gj),pe=le?parseFloat(le):fd;isNaN(pe)||(Ie(pe),Fe(pe.toString()))},[]);const qe=u.length===0;y.useEffect(()=>{t?(async()=>{J(!0),L(null);try{const pe=await ae(`/api/patients/${t}`);if(!pe.ok){const we=await pe.json().catch(()=>({}));throw new Error(we.message||"Failed to fetch patient details")}const de=await pe.json();k(de)}catch(pe){L(`Failed to load patient details: ${pe.message}`),k(null)}finally{J(!1)}})():k(null)},[t]),y.useEffect(()=>{s?(async()=>{fe(!0),L(null),ue(null),Ne([]),Y(null);try{const pe=await ae(`/api/bills/${s}`);if(!pe.ok){const we=await pe.json().catch(()=>({}));throw new Error(we.message||"Failed to fetch bill details")}const de=await pe.json();if(!de.bill||!de.payments||!de.calculated)throw new Error("Invalid bill details structure.");ue(de.bill),Ne(de.payments),Y(de.calculated),C(de.bill.discount_percentage!==void 0&&de.bill.discount_percentage!==null?parseFloat(de.bill.discount_percentage.toString()):0),!N&&de.bill.patient_id&&et(de.bill.patient_id.toString())}catch(pe){L(`Failed to load bill details: ${pe.message}`),ue(null),Ne([]),Y(null)}finally{fe(!1)}})():(ue(null),Ne([]),Y(null))},[s]);const et=async le=>{J(!0);try{const pe=await ae(`/api/patients/${le}`);if(!pe.ok)throw new Error("Failed to fetch patient");const de=await pe.json();k(de)}catch(pe){console.error("Error fetching patient details:",pe),k(null)}finally{J(!1)}},ye=y.useCallback(async le=>{S(!0),L(null);const pe=le.filter(de=>de.drug_id!=null).map(async de=>{try{const we=await ae(`/api/drugs/${de.drug_id}`);if(!we.ok)throw new Error(`Drug ${de.drug_id} not found.`);const Ae=await we.json();return{...de,price:Ae.price,total:Ae.price*de.quantity}}catch{return L(Ae=>`${Ae?Ae+"; ":""}Failed to fetch price for ${de.name}`),de}});try{const de=await Promise.all(pe);_(we=>{const Ae=new Map(de.map(Re=>[Re.id,Re]));return we.map(Re=>Ae.get(Re.id)||Re)})}catch{}finally{S(!1)}},[ae]);y.useEffect(()=>{if(s){_([]),T.current=[];return}JSON.stringify(u)===JSON.stringify(T.current)||(async()=>{let de=[];if(u&&u.length>0)de=u.map((we,Ae)=>({...we,id:`initial-${Ae}-${Date.now()}`})),P(p==="paid"?"cash":j==="no_cash_insurance"?"no_cash_insurance":"cash"),C(m),c==="pharmacy"&&!f&&await ye(de);else if(t&&qe&&c==="consultation"){let we=je;if(g)try{const Ae=await ae(`/api/staff/${g}`);if(!Ae.ok){const at=await Ae.json().catch(()=>({}));throw new Error(at.message||"Doctor not found or error fetching fee")}const Re=await Ae.json();Re.opd_fee!=null&&!isNaN(parseFloat(String(Re.opd_fee)))&&parseFloat(String(Re.opd_fee))>=0&&(we=parseFloat(String(Re.opd_fee)))}catch(Ae){L(Re=>`${Re?Re+"; ":""}Could not fetch doctor's fee, using default. (${Ae.message})`)}de=[{id:Date.now(),name:"Consultation Fee",price:we,quantity:1,total:we*1,drug_id:null}],P(j==="no_cash_insurance"?"no_cash_insurance":"cash")}else de=[],P(j==="no_cash_insurance"?"no_cash_insurance":"cash");_(de),T.current=u})()},[s,t,g,u,c,je,qe,p,f,ye,m,j]);const Oe=()=>{const le=parseFloat(X);if(!f)if(E&&!isNaN(le)&&le>=0&&F>0){if(E.trim().toLowerCase()==="consultation fee"&&D.some(de=>de.name.toLowerCase()==="consultation fee")){alert("Consultation Fee already added.");return}const pe={id:Date.now(),name:E.trim(),price:le,quantity:F,total:le*F,drug_id:null};_([...D,pe]),U(""),I(""),B(1)}else alert("Invalid item details.")},xe=le=>{f||_(D.filter(pe=>pe.id!==le))},he=y.useMemo(()=>{let le=D.reduce((pe,de)=>pe+de.total,0);return Be==="create"&&G>0&&(le=le*(1-G/100)),(K==null?void 0:K.totalDue)!==void 0&&(K==null?void 0:K.totalDue)!==null?K.totalDue:le},[D,K,G,Be]),W=y.useMemo(()=>(K==null?void 0:K.totalPaid)??0,[K]),O=y.useMemo(()=>(K==null?void 0:K.balance)!==void 0&&(K==null?void 0:K.balance)!==null?K.balance:he-W,[K,he,W]),te=()=>{const le=parseFloat($e);!isNaN(le)&&le>=0?(Ie(le),localStorage.setItem(Gj,le.toString()),alert(`Default Fee set to ${le.toFixed(2)}`)):alert("Invalid fee amount.")},re=async(le,pe)=>{Z(!0),L(null);try{const de=await ae("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:pe,billId:le})}),we=await de.json();if(!de.ok||!we.order)throw new Error(we.message||"Failed to create Razorpay order.");const{key_id:Ae,order:Re}=we,at={key:Ae,amount:Re.amount,currency:Re.currency,name:"Newtons Ai HMS Clinic",description:`Bill Payment for Patient ID: ${t}`,order_id:Re.id,handler:async function(tt){try{const Je=await ae("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_payment_id:tt.razorpay_payment_id,razorpay_order_id:tt.razorpay_order_id,razorpay_signature:tt.razorpay_signature,billId:le})}),wt=await Je.json();if(Je.ok&&wt.success)alert("Payment Successful!"),r&&r(le),o&&o(),setTimeout(()=>window.print(),200);else throw new Error(wt.message||"Payment verification failed.")}catch(Je){L(`Payment verification failed: ${Je.message}. Contact support.`)}finally{Z(!1)}},prefill:{name:(N==null?void 0:N.name)||""},notes:{bill_id:le,patient_id:t},theme:{color:"#3399cc"},modal:{ondismiss:function(){L("Payment cancelled."),Z(!1)}}};if(window.Razorpay)new window.Razorpay(at).open();else throw new Error("Razorpay SDK not loaded.")}catch(de){L(`Failed to initiate online payment: ${de.message}`),Z(!1)}},ke=async()=>{if(!s){L("Bill ID is missing.");return}if(!V||isNaN(parseFloat(V))||parseFloat(V)<=0){L("Please enter a valid positive payment amount.");return}ee(!0),L(null);const le={amount_paid:parseFloat(V),payment_mode:Pe};try{const pe=await ae(`/api/bills/${s}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(le)}),de=await pe.json();if(!pe.ok)throw new Error(de.message||`Failed to record payment (Status: ${pe.status})`);alert(`Payment of ${le.amount_paid.toFixed(2)} recorded.`),oe(""),o?o():console.log("Payment recorded.")}catch(pe){L(`Failed to record payment: ${pe.message}`)}finally{ee(!1)}},Ue=async()=>{if(Be==="view_pay")return;if(!t){L("Patient ID is missing for creating a bill.");return}if(D.length===0){L("Cannot finalize an empty bill.");return}Z(!0),L(null);const le=he,pe=D.map(({id:de,...we})=>we);if(A==="online"){const de={patientId:t,queueId:n||null,items:pe,amount:le,paymentMode:"online",type:c,related_id:d||x||null,status:"pending",discountPercentage:G,labOrderId:x||null};try{const we=await ae("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(de)}),Ae=await we.json();if(!we.ok)throw new Error(Ae.message||"Failed to create pending bill.");re(Ae.id,Math.round(le*100))}catch(we){L(`Failed to create pending bill: ${we.message}`),Z(!1)}}else{const de="paid";if(!A){L("Payment mode required."),Z(!1);return}const we={patientId:t,queueId:n||null,items:pe,amount:le,paymentMode:A,type:c,related_id:d||x||null,status:de,discountPercentage:G,labOrderId:x||null};setTimeout(()=>window.print(),200);try{const Ae=await ae("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(we)}),Re=await Ae.json();if(!Ae.ok)throw new Error(Re.message||"Failed to create bill.");alert("Bill marked as paid!"),r&&r(Re.id),Z(!1)}catch(Ae){L(`Failed to process bill: ${Ae.message}`),Z(!1)}}},Qe=(w==null?void 0:w.type)??c,Ze=(w==null?void 0:w.status)??p,lt=Be==="view_pay"&&w&&Ze==="pending";return!t&&!s?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow text-gray-500",children:"Select patient or provide Bill ID."}):$||Be==="view_pay"&&ge?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:"Loading..."}):Be==="view_pay"&&!w&&!ge&&R?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading bill: ",R]}):Be==="create"&&!N&&!$&&R?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading patient: ",R]}):e.jsxs("div",{className:"billing-component-container printable-section",children:[e.jsxs("div",{className:"billing-header",children:[e.jsx("h2",{children:Be==="create"?"Create Bill":"Bill Details"}),Be==="create"&&c==="consultation"&&!f&&e.jsxs("div",{className:"default-fee-section",children:[e.jsx("label",{htmlFor:"defaultFee",className:"whitespace-nowrap",children:"Default Fee:"}),e.jsx("input",{id:"defaultFee",type:"number",value:$e,onChange:le=>Fe(le.target.value),className:"",placeholder:fd.toString(),disabled:f}),e.jsx("button",{onClick:te,title:"Set Default Fee",className:"",disabled:f,children:e.jsx(wr,{size:16})})]})]}),R&&!ge&&!Ce&&e.jsxs("div",{className:"error-message",role:"alert",children:[e.jsx("strong",{children:"Error: "}),R]}),N&&e.jsxs("div",{className:"patient-details-section",children:[e.jsx("h3",{children:"Patient Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"ID:"})," ",N.id]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",N.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Age:"})," ",N.age||"N/A",", ",e.jsx("strong",{children:"Gender:"})," ",N.gender||"N/A"]})]}),e.jsxs("div",{className:"bill-items-summary-section",children:[e.jsxs("div",{className:"bill-items-header",children:[e.jsx("h3",{children:Be==="create"?"Bill Items":"Billing Summary"}),Be==="create"&&c==="pharmacy"&&!f&&D.some(le=>le.drug_id!=null)&&e.jsxs("button",{onClick:()=>ye(D),disabled:Q,className:"refresh-prices-button",title:"Refresh item prices from inventory",children:[e.jsx(Ip,{size:14,className:`lucide ${Q?"animate-spin":""}`}),Q?"Refreshing...":"Refresh"]})]}),Be==="view_pay"&&w&&e.jsxs("div",{className:"bill-info-bar",children:[e.jsxs("span",{children:["Bill ID: ",e.jsx("strong",{children:w.id})]}),e.jsxs("span",{children:["Type: ",e.jsx("strong",{className:"capitalize",children:Qe})]}),e.jsxs("span",{children:["Status: ",e.jsx("strong",{className:`capitalize ${Ze==="paid"?"status-paid":"status-pending"}`,children:Ze})]})]}),(Be==="create"||Be==="view_pay"&&w)&&e.jsxs("div",{className:"bill-items-list",children:[Be==="create"&&Q&&D.length>0&&e.jsx("div",{className:"loading-placeholder",children:"Updating prices..."}),Be==="create"&&!Q&&D.map((le,pe)=>e.jsxs("div",{className:"bill-item",children:[e.jsxs("div",{className:"bill-item-details",children:[e.jsxs("span",{children:[pe+1,". ",le.name]}),le.quantity>1&&e.jsxs("span",{className:"bill-item-quantity",children:["(Qty: ",le.quantity,")"]})]}),e.jsxs("div",{className:"bill-item-price-actions",children:[e.jsxs("span",{className:"bill-item-price",children:["",le.total.toFixed(2)]}),Be==="create"&&typeof le.id=="number"&&!f&&e.jsxs("button",{onClick:()=>xe(le.id),className:"remove-item-button",title:"Remove",children:[" ",e.jsx(Et,{size:16})," "]}),(typeof le.id!="number"||f||le.name==="Consultation Fee")&&e.jsxs("span",{className:"lock-icon",title:"Cannot remove",children:[" ",e.jsx(Qy,{size:14})," "]})]})]},le.id)),Be==="view_pay"&&w&&w.items.map((le,pe)=>e.jsxs("div",{className:"bill-item",children:[e.jsxs("div",{className:"bill-item-details",children:[e.jsxs("span",{children:[pe+1,". ",le.name]}),le.quantity>1&&e.jsxs("span",{className:"bill-item-quantity",children:["(Qty: ",le.quantity,")"]})]}),e.jsxs("div",{className:"bill-item-price-actions",children:[e.jsxs("span",{className:"bill-item-price",children:["",(le.total??le.price*le.quantity).toFixed(2)]}),e.jsxs("span",{className:"lock-icon",title:"Cannot remove from existing bill",children:[" ",e.jsx(Qy,{size:14})," "]})]})]},pe)),Be==="create"&&D.length===0&&e.jsx("p",{className:"empty-items-message",children:"No items added."}),Be==="view_pay"&&w&&w.items.length===0&&e.jsx("p",{className:"empty-items-message",children:"No items in bill."})]}),Be==="create"&&!f&&e.jsxs("div",{className:"add-item-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Item"}),e.jsx("input",{type:"text",value:E,onChange:le=>U(le.target.value),placeholder:"Service/Item",className:"custom-text-input"})]}),e.jsxs("div",{className:"form-group",style:{flexGrow:.5,minWidth:"80px"},children:[e.jsx("label",{children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:F,onChange:le=>B(parseInt(le.target.value)||1),placeholder:"1",className:"custom-text-input"})]}),e.jsxs("div",{className:"form-group",style:{flexGrow:.7,minWidth:"100px"},children:[e.jsx("label",{children:"Price ()"}),e.jsx("input",{type:"number",value:X,onChange:le=>I(le.target.value),placeholder:"0.00",className:"custom-text-input"})]}),e.jsx("button",{onClick:Oe,className:"add-item-button",children:"Add"})]})]})," ",e.jsxs("div",{className:"billing-footer",children:[e.jsxs("div",{className:"total-amount-section",children:[e.jsx("span",{className:"total-amount-label",children:"Total Amount:"}),e.jsxs("span",{className:"total-amount-value",children:["",typeof he=="number"?he.toFixed(2):"0.00"]}),Be==="create"&&!f&&e.jsxs("div",{className:"discount-section",children:[e.jsx("label",{htmlFor:"discountPercentage",className:"whitespace-nowrap",children:"Discount (%):"}),e.jsx("input",{id:"discountPercentage",type:"number",min:"0",max:"100",step:"0.01",value:G,onChange:le=>C(parseFloat(le.target.value)||0),className:"",disabled:f||M})]}),Be==="view_pay"&&w&&(w.status==="pending"||w.status==="paid")&&e.jsxs("div",{className:"discount-section",children:[e.jsx("label",{className:"whitespace-nowrap",children:"Discount (%):"}),e.jsxs("span",{className:"discount-value",children:[G.toFixed(2),"%"]})]})]}),Be==="view_pay"&&K&&e.jsxs("div",{className:"total-amount-section",children:[e.jsx("span",{className:"total-amount-label",children:"Amount Paid:"}),e.jsxs("span",{className:"total-amount-value",children:["",W.toFixed(2)]})]}),Be==="view_pay"&&K&&e.jsxs("div",{className:"total-amount-section",children:[e.jsx("span",{className:"total-amount-label",children:"Balance Due:"}),e.jsxs("span",{className:"total-amount-value",children:["",O.toFixed(2)]})]}),e.jsxs("div",{className:"footer-actions",children:[Be==="create"&&!f&&e.jsxs("div",{className:"action-group",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs("select",{value:A,onChange:le=>P(le.target.value),className:"custom-select-input",disabled:f||M,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"online",children:"Pay Online (Razorpay)"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),e.jsx("button",{onClick:Ue,disabled:M||D.length===0||f,className:"finalize-button",children:M?"Processing...":"Finalize Bill"})]}),Be==="view_pay"&&lt&&!f&&e.jsxs("div",{className:"action-group",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Record Payment Amount ()"}),e.jsx("input",{type:"number",value:V,onChange:le=>oe(le.target.value),placeholder:`Max: ${O.toFixed(2)}`,className:"custom-text-input",disabled:Ce})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Payment Mode"}),e.jsxs("select",{value:Pe,onChange:le=>se(le.target.value),className:"custom-select-input",disabled:Ce,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})]}),e.jsx("button",{onClick:ke,disabled:Ce||!V||parseFloat(V)<=0||parseFloat(V)>O,className:"record-payment-button",children:Ce?"Recording...":"Record Payment"})]}),Be==="create"&&f&&D.length>0&&e.jsx("div",{className:"status-message read-only",children:"Read-only."}),Be==="view_pay"&&Ze==="paid"&&e.jsx("div",{className:"status-message paid",children:"PAID."}),Be==="view_pay"&&Ze==="cancelled"&&e.jsx("div",{className:"status-message cancelled",children:"CANCELLED."})]})]})]})},lR=()=>{const t=ot(),s=za(),{patientId:n,queueId:r,patientName:o,initialItems:u,billType:c,relatedId:d,initialStatus:p,initialDiscountPercentage:m,doctorId:f,billId:g,labOrderId:x}=s.state||{},[j,N]=y.useState(null),[k,D]=y.useState(null),[_,T]=y.useState(null),[E,U]=y.useState(null),[X,I]=y.useState(null),[F,B]=y.useState(null),[G,C]=y.useState(null),[A,P]=y.useState(null),[$,J]=y.useState(!0),[R,L]=y.useState(null),[M,Z]=y.useState(o||"");y.useEffect(()=>{if(!n){console.error("BillingPage loaded without required patientId in location state."),t("/");return}(async()=>{J(!0),L(null);try{let ue=n,Ne=u||null,K=p||null,Y=c||null,V=d||null,oe=m!==void 0?parseFloat(m):null,Pe=o||null,se=null;if(g){console.log(`Fetching details for Bill ID: ${g}`);const Ce=await ae(`/api/bills/${g}`);if(!Ce.ok){const je=await Ce.json().catch(()=>({message:`Failed to fetch bill details for ID ${g}`}));throw new Error(je.message||`Failed to fetch bill details (Status: ${Ce.status})`)}const ee=await Ce.json();if(console.log("Fetched Bill Data:",ee),Ne=ee.bill.items||[],K=ee.bill.status||"pending",Y=ee.bill.type||null,V=ee.bill.related_id||null,oe=ee.bill.discount_percentage!==void 0&&ee.bill.discount_percentage!==null?parseFloat(ee.bill.discount_percentage):0,ue=ee.bill.patient_id,U(Ne),I(K),B(Y),C(V),P(oe),ue){const je=await ae(`/api/patients/${ue}`);if(je.ok){const Ie=await je.json();Pe=Ie.name,se=Ie.phone??null,T(Ie.insurance_type??null),Z(Pe),D(se)}else console.warn(`Could not fetch patient details for ID ${ue} from bill.`),Z("Patient (Not Found)")}else console.warn(`Bill ${g} does not have an associated patient_id.`),Z("Patient (Unknown)")}else if(x){console.log(`Fetching details for Lab Order ID: ${x}`);const Ce=await ae(`/api/lab/${x}`);if(!Ce.ok){let je=`Failed to fetch lab order details (Status: ${Ce.status} ${Ce.statusText})`;try{je=(await Ce.json()).message||je}catch{console.error("Response was not valid JSON:",await Ce.text())}throw new Error(je)}const ee=await Ce.json();if(console.log("Fetched Lab Order Data:",JSON.stringify(ee,null,2)),Ne=(ee.tests||[]).filter(je=>je&&typeof je.name=="string"&&je.price!==void 0&&je.id!==void 0).map(je=>{const Ie=parseFloat(je.price||"0"),$e=!isNaN(Ie)&&isFinite(Ie)?Ie:0;return{item_id:je.id,name:je.name,price:$e,quantity:1,total:$e*1,type:"lab_test"}}),Ne&&Ne.length===0&&(ee.tests||[]).length>0&&(console.warn("Warning: Some tests from the lab order were filtered out due to missing id, name, or price.",ee.tests),L(je=>`${je?je+"; ":""}Warning: Some lab items could not be added to the bill due to missing details.`)),K="pending",Y="lab",V=x,ue=ee.patient_id,U(Ne),I(K),B(Y),C(V),ue){const je=await ae(`/api/patients/${ue}`);if(je.ok){const Ie=await je.json();Pe=Ie.name,se=Ie.phone??null,T(Ie.insurance_type??null),Z(Pe),D(se)}else console.warn(`Could not fetch patient details for ID ${ue} from lab order.`),Z("Patient (Not Found)")}else console.warn(`Lab Order ${x} does not have an associated patient_id.`),Z("Patient (Unknown)")}else if(U(u||null),I(p||null),B(c||null),C(d||null),P(m!==void 0?parseFloat(m):null),Z(o||`ID ${n}`),ue){const Ce=await ae(`/api/patients/${ue}`);if(Ce.ok){const ee=await Ce.json();D(ee.phone??null),T(ee.insurance_type??null)}else console.warn(`Could not fetch patient details for ID ${ue}.`)}if(r){const Ce=await ae(`/api/queue/${r}`);if(Ce.ok){const ee=await Ce.json();N(ee.token_number)}else console.warn(`Could not fetch queue details for ID ${r}.`)}}catch(ue){console.error("Error fetching billing page details:",ue),L(`Failed to load details: ${ue.message}`),U(null),I(null),B(null),C(null),Z(o||""),D(null),N(null)}finally{J(!1)}})()},[n,g,x,r,t]);const Q=w=>{console.log(`Billing process completed for patient ID ${n}. New Bill ID: ${w}`),t(-1)},S=()=>{console.log(`Bill updated for patient ID ${n}.`),t(-1)};if(!n)return e.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-gray-600",children:[e.jsx(Yy,{size:48,className:"mb-4 text-red-500"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Missing Patient Information"}),e.jsx("p",{className:"text-sm",children:"Cannot load the billing page without a patient ID."}),e.jsx("button",{onClick:()=>t("/"),className:"mt-4 px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700",children:"Go to Dashboard"})]});if($)return e.jsx("div",{className:"min-h-screen bg-neutral-light flex items-center justify-center",children:e.jsx("p",{className:"text-teal-600 animate-pulse",children:"Loading Billing Details..."})});if(R)return e.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-red-600 p-4",children:[e.jsx(Yy,{size:48,className:"mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Error Loading Billing Details"}),e.jsx("p",{className:"text-sm text-center mb-4",children:R}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"}),e.jsx("button",{onClick:()=>t(-1),className:"mt-2 text-sm text-gray-600 hover:text-teal-700",children:"Go Back"})]});const fe=(X??p)==="paid";return e.jsxs("div",{className:"billing-page-container",children:[e.jsx("div",{className:"back-button-container",children:e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Go Back",children:[e.jsx(vt,{size:20,className:"lucide"})," Back"]})}),e.jsxs("div",{className:"billing-content-wrapper",children:[e.jsxs("h3",{className:"billing-page-title",children:[g?"Bill Details":x?"Create Lab Bill":"Create Bill"," for Patient: ",M||`ID ${n}`]}),e.jsxs("div",{className:"patient-info-bar",children:[j!==null&&e.jsxs("span",{children:[e.jsx(jc,{size:14,className:"lucide"})," Token: ",j]}),k&&e.jsxs("span",{children:[e.jsx(a0,{size:14,className:"lucide"})," Phone: ",k]}),x&&e.jsxs("span",{className:"lab-order-info",children:[e.jsx(Ga,{size:14,className:"lucide"})," Lab Order: ",x.substring(0,8),"..."]}),!k&&j===null&&!x&&e.jsx("span",{className:"placeholder-text",children:"(Token/Phone not available)"}),_&&e.jsxs("span",{className:"insurance-info",children:[e.jsx(Mw,{size:14,className:"lucide"})," Insurance: ",_.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase())]}),!k&&j===null&&!x&&!_&&e.jsx("span",{className:"placeholder-text",children:"(Token/Phone not available)"})]}),e.jsx(rR,{patientId:n,labOrderId:x,queueId:r,onBillCreated:Q,onBillUpdated:S,initialItems:E??u,billType:F??c,relatedId:G??d,initialStatus:X??p,initialDiscountPercentage:A??m,readOnlyMode:fe,doctorId:f,patientInsuranceType:_??void 0})]})]})},oR=()=>{const{patientId:t}=Qn(),s=ot(),[n,r]=y.useState([]),[o,u]=y.useState(!1),[c,d]=y.useState(null),[p,m]=y.useState("");return y.useEffect(()=>{(async()=>{if(!t){d("Patient ID not provided in URL.");return}u(!0),d(null),r([]);try{try{const j=await ae(`/api/patients/${t}`);if(j.ok){const N=await j.json();m(N.name)}}catch(j){console.warn("Could not fetch patient name:",j)}console.log(`Fetching pharmacy orders for patient ID: ${t}`);const g=await ae(`/api/pharmacy-orders/patient/${t}`);if(!g.ok){const j=await g.json().catch(()=>({}));throw new Error(j.message||`HTTP error! status: ${g.status}`)}const x=await g.json();console.log("Fetched Pharmacy Orders:",x),r(x||[])}catch(g){console.error("Error fetching pharmacy orders:",g),d(`Failed to load pharmacy orders: ${g.message}`)}finally{u(!1)}})()},[t]),e.jsxs("div",{className:"p-4 md:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b pb-3",children:[e.jsxs("button",{onClick:()=>s(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(vt,{size:16,className:"mr-1"}),"Back"]}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[e.jsx(Nr,{size:20,className:"mr-2 text-purple-600"}),"Pharmacy Order History ",p&&`for ${p}`]}),e.jsx("div",{})," "]}),o&&e.jsx("p",{className:"text-center text-gray-500",children:"Loading pharmacy orders..."}),c&&e.jsx("p",{className:"text-center text-red-500 bg-red-100 p-3 rounded border border-red-300",children:c}),!o&&n.length===0&&!c&&e.jsx("p",{className:"text-center text-gray-500",children:"No pharmacy orders found for this patient."}),!o&&n.length>0&&e.jsx("div",{className:"space-y-4",children:n.map(f=>e.jsxs("div",{className:"p-4 border rounded bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",new Date(f.date).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm font-medium capitalize",children:[e.jsx("strong",{children:"Status:"})," ",f.status]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Prescribed By:"})," ",f.prescribedBy||"N/A"]}),f.dispensedBy&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Dispensed By:"})," ",f.dispensedBy]}),e.jsx("h4",{className:"text-md font-semibold mt-3 mb-1",children:"Medications:"}),e.jsx("ul",{className:"list-disc list-inside ml-4 text-sm text-gray-700 space-y-1",children:f.medications.map((g,x)=>e.jsxs("li",{children:[g.name," - Qty: ",g.quantity,g.tabletsPerDay&&` (${g.tabletsPerDay} per day`,g.numberOfDays&&` for ${g.numberOfDays} days)`,!g.tabletsPerDay&&g.numberOfDays&&` (for ${g.numberOfDays} days)`,g.tabletsPerDay&&!g.numberOfDays&&")"]},x))})]},f.id))})]})},cR=()=>{const t=ot(),s=za(),[n,r]=y.useState(null),[o,u]=y.useState([]),[c,d]=y.useState([]),[p,m]=y.useState(""),[f,g]=y.useState([]),[x,j]=y.useState(null),[N,k]=y.useState(!1),[D,_]=y.useState(null),[T,E]=y.useState(!0),[U,X]=y.useState(""),[I,F]=y.useState([]),[B,G]=y.useState(!1),[C,A]=y.useState(null),[P,$]=y.useState(!1),[J,R]=y.useState(!1),[L,M]=y.useState([]),[Z,Q]=y.useState(!1),[S,ge]=y.useState(null),fe=/^\+?[0-9\s\-().]{7,20}$/,w=/^[a-zA-Z\s'-]{2,}$/,ue=y.useCallback(async()=>{try{const ye=await ae("/api/drugs");if(!ye.ok)throw new Error("Failed to fetch drugs");const Oe=await ye.json(),xe=Oe.drugs||Oe||[];u(xe)}catch(ye){console.error("Failed to fetch available drugs:",ye),j("Could not load drug list. "+ye.message)}},[]),Ne=y.useCallback(async ye=>{Q(!0),ge(null);try{const Oe=await ae(`/api/pharmacy-orders/patient/${ye}`);if(!Oe.ok){const he=await Oe.json().catch(()=>({}));throw new Error(he.message||`HTTP error! status: ${Oe.status}`)}const xe=await Oe.json();M(xe||[])}catch(Oe){console.error("Failed to fetch previous pharmacy orders:",Oe),ge(`Could not load previous orders: ${Oe.message}`)}finally{Q(!1)}},[]);y.useEffect(()=>{var ye;ue(),(ye=s.state)!=null&&ye.patient?V(s.state.patient):E(!0)},[ue,s.state]),y.useEffect(()=>{n!=null&&n.id?Ne(n.id):M([])},[n,Ne]),y.useEffect(()=>{if(!p){g([]);return}const ye=p.toLowerCase();g(o.filter(Oe=>{const xe=Oe.name&&Oe.name.toLowerCase().includes(ye),he=Oe.brand_name&&Oe.brand_name.toLowerCase().includes(ye);return xe||he}).slice(0,10))},[p,o]);const K=y.useMemo(()=>Ec(async ye=>{if(ye.trim().length<2){F([]),G(!1),A(null);return}G(!0),A(null);try{const Oe=new URLSearchParams({search:encodeURIComponent(ye),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),xe=await ae(`/api/patients?${Oe.toString()}`);if(!xe.ok){const W=await xe.text();throw new Error(`API Error (${xe.status}): ${W||xe.statusText}`)}const he=await xe.json();F(he.patients)}catch(Oe){console.error("Error searching patients:",Oe),A(Oe.message||"Failed to search patients."),F([])}finally{G(!1)}},300),[fe]),Y=ye=>{const Oe=ye.target.value;X(Oe),$(fe.test(Oe)),R(w.test(Oe)&&!fe.test(Oe)),G(!0),K(Oe)},V=y.useCallback(ye=>{r(ye),E(!1),X(""),F([]),A(null)},[]),oe=y.useCallback(async ye=>{if(!U||ye==="phone"&&!P||ye==="name"&&!J){A(`Invalid ${ye} to create a new patient.`);return}G(!0),A(null);try{const xe=await ae("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ye==="name"?U:"direct pharmacy",phone:ye==="phone"?U:null,age:null,gender:null,token:null})});if(!xe.ok){const W=await xe.json();throw new Error(W.message||`Failed to create patient: ${xe.statusText}`)}const he=await xe.json();alert(`New patient "${he.name}" created with ${ye==="phone"?`phone ${he.phone}`:`name ${he.name}`}.`),V(he)}catch(Oe){console.error("Error creating new patient:",Oe),A(Oe.message||"Failed to create new patient.")}finally{G(!1)}},[U,P,J,V]),Pe=()=>{r(null),E(!0),d([]),j(null),M([])},se=ye=>{if(c.some(Oe=>Oe.drug_id===ye.id)){const Oe=ye.name||ye.brand_name||"This drug";j(`${Oe} is already in the order.`),setTimeout(()=>j(null),3e3),m(""),g([]);return}d(Oe=>[...Oe,{drug_id:ye.id,name:ye.name||ye.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,tabletsPerDay:1,numberOfDays:1,mrp:Number(ye.mrp)||0,originalMrp:Number(ye.mrp)||0,stock:ye.stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(ye.mrp)||0)/(ee(ye.pack)||1),pack:ye.pack}]),m(""),g([])},Ce=()=>{const ye=p.trim();if(!ye){j("Please enter a drug name to navigate to the add drug page."),setTimeout(()=>j(null),3e3);return}t("/dashboard/inventory/add",{state:{initialDrugName:ye}}),m(""),g([])},ee=ye=>{if(!ye)return null;const Oe=ye.match(/(?:\d+x)?(\d+)/);return Oe?parseInt(Oe[1],10):null},je=ye=>{d(Oe=>Oe.filter(xe=>(xe.drug_id??xe.name)!==ye))},Ie=(ye,Oe)=>{d(xe=>xe.map(he=>{if((he.drug_id??he.name)===ye&&he.isLoose){const O=ee(he.pack),te=Math.max(0,Oe),re=te*(O??1)+(he.looseUnits??0);return{...he,loosePacks:te,looseQuantity:re,pack_quantity:te}}return he}))},$e=(ye,Oe)=>{d(xe=>xe.map(he=>{if((he.drug_id??he.name)===ye&&he.isLoose){const O=ee(he.pack),te=Math.max(0,Oe),re=(he.loosePacks??0)*(O??1)+te;return{...he,looseUnits:te,looseQuantity:re}}return he}))},Fe=ye=>{const Oe=[];ye.medications.forEach(xe=>{if(c.find(W=>W.drug_id&&xe.drug_id&&W.drug_id===xe.drug_id||W.name.toLowerCase()===xe.name.toLowerCase()))d(W=>W.map(O=>{if(O.drug_id&&xe.drug_id&&O.drug_id===xe.drug_id||O.name.toLowerCase()===xe.name.toLowerCase()){const te=(O.pack_quantity??0)+(xe.pack_quantity??0),re=(O.loose_quantity??0)+(xe.loose_quantity??0),ke=xe.tabletsPerDay??O.tabletsPerDay,Ue=xe.numberOfDays??O.numberOfDays,Qe=ee(O.pack),Ze=te*(Qe??1)+re;return{...O,pack_quantity:te,loose_quantity:re,directions_to_use:xe.directions_to_use??O.directions_to_use,tabletsPerDay:ke,numberOfDays:Ue,looseQuantity:Ze,loosePacks:Math.floor(Ze/(Qe??1)),looseUnits:Ze%(Qe??1)}}return O}));else{let W=xe.drug_id,O=xe.drug_id?o.find(te=>te.id===xe.drug_id):void 0;if(!W&&xe.name){const te=o.find(re=>re.name&&re.name.toLowerCase()===xe.name.toLowerCase());te&&(W=te.id,O=te)}Oe.push({drug_id:W,name:xe.name,pack_quantity:xe.pack_quantity??0,loose_quantity:xe.loose_quantity??0,directions_to_use:xe.directions_to_use,tabletsPerDay:xe.tabletsPerDay??1,numberOfDays:xe.numberOfDays??1,mrp:O?O.mrp:xe.pack_price,originalMrp:O?O.mrp:xe.pack_price,stock:O?O.stock:xe.stock,isLoose:!0,loosePacks:0,looseUnits:(xe.pack_quantity??0)*(ee((O==null?void 0:O.pack)||xe.pack)??1)+(xe.loose_quantity??0),looseQuantity:(xe.pack_quantity??0)*(ee((O==null?void 0:O.pack)||xe.pack)??1)+(xe.loose_quantity??0),pricePerLooseUnit:(O?Number(O.mrp):Number(xe.pack_price)||0)/(ee((O==null?void 0:O.pack)||xe.pack)||1),pack:(O==null?void 0:O.pack)||xe.pack})}}),d(xe=>[...xe,...Oe]),ye.prescriptionForUnavailableDrugs&&(!D||!D.includes(ye.prescriptionForUnavailableDrugs))&&_(xe=>xe?`${xe}

-- From Order ${ye.id.substring(0,8)} --
${ye.prescriptionForUnavailableDrugs}`:ye.prescriptionForUnavailableDrugs),j("Medications from previous order added to current order."),setTimeout(()=>j(null),3e3)},Be=async ye=>{if(ye.preventDefault(),j(null),k(!0),!n){j("No patient selected for the order."),k(!1);return}if(c.length===0&&!(D!=null&&D.trim())){j("Please add at least one medication or provide a prescription for unavailable drugs."),k(!1);return}const Oe=c.filter(he=>{const W=he.looseQuantity??0;return W<=0||he.stock!==void 0&&W>he.stock});if(Oe.length>0){j(`Invalid quantity or insufficient stock for: ${Oe.map(he=>he.name).join(", ")}`),k(!1);return}const xe={patient_id:n.id,items:c.map(he=>{const W=he.mrp??0,O=he.pricePerLooseUnit??0,te=O*(he.looseQuantity??0);return{drug_id:he.drug_id===void 0?null:he.drug_id,name:he.name,pack_quantity:he.loosePacks??0,loose_quantity:he.looseUnits??0,pack_price:W,loose_price:O,total_price:te,price:he.originalMrp??0,directions_to_use:he.directions_to_use===void 0?null:he.directions_to_use,tabletsPerDay:he.tabletsPerDay??1,numberOfDays:he.numberOfDays??1}}),order_total:qe,prescription_for_unavailable_drugs:D};try{const he=await ae("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(xe)});if(!he.ok){const W=await he.json();throw new Error(W.message||`Failed to create order: ${he.statusText}`)}alert(`Pharmacy order created successfully for ${n.name}!`),t(-1)}catch(he){console.error("Failed to create pharmacy order:",he),j(he.message||"Failed to create order. Please try again.")}finally{k(!1)}},qe=y.useMemo(()=>c.reduce((ye,Oe)=>{const xe=Oe.isLoose?Oe.pricePerLooseUnit??0:Oe.mrp??0,he=Oe.isLoose?Oe.looseQuantity??0:Oe.quantity??0;return ye+xe*he},0),[c]),et=(Number(qe)||0).toFixed(2);return e.jsxs("div",{className:"add-pharmacy-order-page p-4 md:p-6 max-w-5xl mx-auto",children:[" ",e.jsxs("div",{className:"page-header flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 pb-4",children:[" ",e.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button p-2 rounded-full mr-3",title:"Go Back",children:[e.jsx(vt,{size:20})," "]}),e.jsx("h2",{className:"text-2xl",children:"Create New Pharmacy Order"})," "]})]}),T&&e.jsxs("div",{className:"content-section",children:[" ",e.jsx("h3",{className:"section-title",children:"Select Patient"})," ",e.jsxs("div",{className:"mb-3 relative",children:[e.jsx("label",{htmlFor:"patient-search",className:"form-label",children:"Search Patient (Name, Token, or Phone)"})," ",e.jsx("input",{type:"text",id:"patient-search",placeholder:"Search by Name, Token No, or Phone No (min 2 chars)...",value:U,onChange:Y,className:"custom-text-input mt-1",autoFocus:!0}),B&&e.jsx("span",{className:"absolute right-3 top-9 text-xs text-gray-400",children:"Searching..."})]}),C&&e.jsx("div",{className:"ai-function-status error mb-3 p-3",children:C})," ",I.length>0&&e.jsxs("div",{className:"patient-search-results max-h-64 overflow-y-auto rounded-md shadow-sm mt-1 z-10",children:[" ",e.jsxs("ul",{children:[" ",I.map(ye=>e.jsxs("li",{onClick:()=>V({id:ye.id,name:ye.name,token:ye.token,age:ye.age,gender:ye.gender,phone:ye.phone}),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{className:"font-medium",children:[e.jsxs("span",{className:"patient-token mr-2",children:["#",ye.token]}),ye.name]}),e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:mt-0",children:[ye.age?`${ye.age} yrs`:"Age N/A",ye.gender?` / ${ye.gender}`:" / Gender N/A",ye.phone&&e.jsxs("span",{className:"hidden sm:inline",children:[" / ",ye.phone]})]})]}),ye.phone&&e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:hidden",children:["Phone: ",ye.phone]})]},ye.id))]})]}),U.length>=2&&!B&&I.length===0&&!C&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-400 mt-2 text-sm",children:['No patients found matching "',U,'".']}),P&&e.jsx("button",{type:"button",onClick:()=>oe("phone"),className:"create-patient-button mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",disabled:B,children:'Create "direct pharmacy" Patient with this Phone'}),J&&e.jsx("button",{type:"button",onClick:()=>oe("name"),className:"create-patient-button mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ml-2",disabled:B,children:"Create Patient with this Name"})]}),U.length<2&&!B&&e.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"Enter at least 2 characters to search."})]}),n&&!T&&e.jsxs("form",{onSubmit:Be,children:[e.jsxs("div",{className:"selected-patient-info content-section flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[" ",e.jsxs("div",{children:[e.jsxs("h3",{className:"section-title",children:[" ","Patient: ",e.jsx("span",{className:"font-normal",children:n.name})]}),e.jsxs("p",{className:"text-sm mt-1",children:["Token: ",e.jsx("span",{className:"font-medium",children:n.token??"N/A"}),n.age&&`    Age: ${n.age}`,n.gender&&`    Gender: ${n.gender}`,n.phone&&`    Phone: ${n.phone}`]}),e.jsxs("p",{className:"text-xs mt-1",title:`Patient UUID: ${n.id}`,children:["ID: ",n.id.substring(0,12),"..."]})]}),e.jsx("button",{type:"button",onClick:Pe,className:"change-patient-button mt-2 sm:mt-0 px-3 py-1.5 border rounded-md text-sm font-medium focus:outline-none focus:ring-2",children:"Change Patient"})]}),x&&e.jsx("div",{className:"ai-function-status error mb-4 p-3",children:x})," ",Z&&e.jsx("div",{className:"content-section text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Loading previous orders..."})}),S&&e.jsx("div",{className:"ai-function-status error mb-4 p-3",children:S}),!Z&&L.length>0&&e.jsxs("div",{className:"content-section mt-4",children:[e.jsx("h3",{className:"section-title",children:"Previous Orders"}),e.jsx("div",{className:"space-y-4",children:L.map(ye=>e.jsxs("div",{className:"previous-order-card p-4 border rounded-lg shadow-sm bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:["Order Date: ",new Date(ye.date).toLocaleDateString()]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ye.status==="dispensed"?"bg-green-100 text-green-800":ye.status==="pending"?"bg-yellow-100 text-yellow-800":ye.status==="cancelled"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:ye.status.charAt(0).toUpperCase()+ye.status.slice(1)})]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 mb-3",children:ye.medications.map((Oe,xe)=>e.jsxs("li",{children:[e.jsx("strong",{children:Oe.name}),": ",Oe.quantity," Qty",Oe.directions_to_use&&` - Directions: ${Oe.directions_to_use}`]},xe))}),ye.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Prescription for Unavailable:"}),e.jsxs("div",{className:"prose prose-sm max-w-none",children:[" ",e.jsx(xa,{remarkPlugins:[Ln],children:ye.prescriptionForUnavailableDrugs})]})]}),e.jsxs("button",{type:"button",onClick:()=>Fe(ye),className:"add-previous-meds-button mt-3 px-3 py-1.5 text-sm font-medium rounded-md flex items-center justify-center",children:[e.jsx(Ia,{size:16,className:"mr-1"})," Add Medications to Current Order"]})]},ye.id))})]}),!Z&&L.length===0&&n&&e.jsx("div",{className:"content-section text-center py-4 mt-4",children:e.jsx("p",{className:"text-gray-500",children:"No previous orders found for this patient."})}),e.jsxs("div",{className:"mb-4 content-section",children:[e.jsx("label",{htmlFor:"prescription-unavailable",className:"form-label",children:"Prescription for Unavailable Drugs (Optional)"}),e.jsx("textarea",{id:"prescription-unavailable",rows:3,value:D??"",onChange:ye=>_(ye.target.value||null),placeholder:"Enter prescription details for any drugs that are currently unavailable...",className:"custom-text-input mt-1 w-full"})]}),e.jsxs("div",{className:"mb-4 relative content-section",children:[" ",e.jsx("label",{htmlFor:"drug-search",className:"form-label",children:"Add Medication"})," ",e.jsx("input",{type:"text",id:"drug-search",placeholder:"Search for drug name or type to add custom...",value:p,onChange:ye=>m(ye.target.value),className:"custom-text-input mt-1"}),p&&e.jsxs("div",{className:"drug-search-dropdown mt-1 w-full max-h-60 rounded-md border shadow-lg overflow-auto focus:outline-none sm:text-sm z-20",children:[" ",f.length>0&&e.jsxs("ul",{children:[" ",f.map(ye=>e.jsxs("li",{onClick:()=>se(ye),className:"cursor-pointer select-none relative",children:[e.jsx("span",{className:"font-medium block truncate",children:ye.name||ye.brand_name}),e.jsxs("span",{className:"drug-stock-price text-xs",children:[" ","(Stock: ",ye.stock??"N/A",", MRP: ",Number(ye.mrp||0).toFixed(2),")"]})]},ye.id))]}),p.trim()&&!o.some(ye=>ye.name&&ye.name.toLowerCase()===p.trim().toLowerCase()||ye.brand_name&&ye.brand_name.toLowerCase()===p.trim().toLowerCase())&&e.jsxs("div",{onClick:Ce,className:"add-custom-drug-button cursor-pointer text-sm font-medium",role:"button",children:['Add "',p.trim(),'" as new item']}),p.trim()&&f.length===0&&o.some(ye=>ye.name&&ye.name.toLowerCase()===p.trim().toLowerCase()||ye.brand_name&&ye.brand_name.toLowerCase()===p.trim().toLowerCase())&&e.jsx("p",{className:"text-gray-400 py-2.5 px-4 text-sm",children:"Drug already selected or no new matches."})]})]}),e.jsxs("div",{className:"order-items-section content-section max-h-96 overflow-y-auto",children:[" ",e.jsx("h4",{className:"section-title",children:"Order Items"})," ",c.length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No medications added yet."}),c.length>0&&e.jsx("ul",{className:"space-y-4",children:c.map(ye=>{const Oe=ye.drug_id??ye.name,xe=!ye.drug_id;return e.jsxs("li",{className:"order-item-card text-sm",children:[" ",e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[e.jsxs("div",{className:"flex-grow mb-2 md:mb-0",children:[e.jsxs("span",{className:`item-name block text-base ${xe?"custom":""}`,children:[" ",ye.name,xe?" (custom)":""]}),!xe&&ye.pricePerLooseUnit!==void 0&&e.jsxs("span",{className:"item-details text-xs",children:[" ","@ ",(Number(ye.pricePerLooseUnit)||0).toFixed(2)," per loose unit"]}),ye.stock!==void 0&&e.jsxs("span",{className:`item-details text-xs ml-2 ${ye.stock<=10?"item-stock low":""}`,children:[" ","(Stock: ",ye.stock,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2",children:[e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`loose-packs-${Oe}`,className:"dosage-label",children:"Packs:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>Ie(Oe,(ye.loosePacks??0)-1),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`loose-packs-${Oe}`,min:"0",value:ye.loosePacks||"",onChange:he=>{const W=parseInt(he.target.value,10);Ie(Oe,isNaN(W)?0:W)},onFocus:he=>he.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>Ie(Oe,(ye.loosePacks??0)+1),className:"quantity-btn",children:"+"})]})]}),e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`loose-units-${Oe}`,className:"dosage-label",children:"Loose:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>$e(Oe,(ye.looseUnits??0)-1),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`loose-units-${Oe}`,min:"0",value:ye.looseUnits||"",onChange:he=>{const W=parseInt(he.target.value,10);$e(Oe,isNaN(W)?0:W)},onFocus:he=>he.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>$e(Oe,(ye.looseUnits??0)+1),className:"quantity-btn",children:"+"})]}),ye.pack&&e.jsxs("span",{className:"ml-2 text-sm text-gray-400",children:["(",ye.pack.split("x")[1]||ye.pack," per pack)"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3 mt-2 md:mt-0 md:flex-col md:items-end",children:[e.jsxs("div",{className:"w-28 text-right font-semibold",children:[" ","",(Number((ye.pricePerLooseUnit??0)*(ye.looseQuantity??0))||0).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>je(Oe),className:"remove-item-button p-1.5 -m-1.5 rounded-full",title:"Remove Item",children:e.jsx(on,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:`tablets-per-day-${Oe}`,className:"dosage-label",children:"Per Day:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>d(he=>he.map(W=>W.drug_id===Oe?{...W,tabletsPerDay:Math.max(1,(W.tabletsPerDay??1)-1)}:W)),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`tablets-per-day-${Oe}`,min:"1",value:ye.tabletsPerDay??1,onChange:he=>{const W=parseInt(he.target.value,10);d(O=>O.map(te=>te.drug_id===Oe?{...te,tabletsPerDay:isNaN(W)?1:Math.max(1,W)}:te))},onFocus:he=>he.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>d(he=>he.map(W=>W.drug_id===Oe?{...W,tabletsPerDay:(W.tabletsPerDay??1)+1}:W)),className:"quantity-btn",children:"+"})]})]}),e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`number-of-days-${Oe}`,className:"dosage-label",children:"No. Days:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>d(he=>he.map(W=>W.drug_id===Oe?{...W,numberOfDays:Math.max(1,(W.numberOfDays??1)-1)}:W)),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`number-of-days-${Oe}`,min:"1",value:ye.numberOfDays??1,onChange:he=>{const W=parseInt(he.target.value,10);d(O=>O.map(te=>te.drug_id===Oe?{...te,numberOfDays:isNaN(W)?1:Math.max(1,W)}:te))},onFocus:he=>he.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>d(he=>he.map(W=>W.drug_id===Oe?{...W,numberOfDays:(W.numberOfDays??1)+1}:W)),className:"quantity-btn",children:"+"})]})]})]}),e.jsx("div",{className:"flex items-center mt-2",children:ye.pack&&ee(ye.pack)&&e.jsx("span",{className:"ml-4 text-sm text-gray-400",children:(()=>{const he=ee(ye.pack),W=ye.looseQuantity??0;if(he&&he>0){const O=Math.floor(W/he),te=W%he;return`(Subtract: ${O} packs, ${te} loose)`}return""})()})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:`directions-${Oe}`,className:"dosage-label",children:"Directions:"}),e.jsx("input",{type:"text",id:`directions-${Oe}`,placeholder:"e.g., 'After food', 'Twice a day'",value:ye.directions_to_use??"",onChange:he=>{const W=he.target.value;d(O=>O.map(te=>(te.drug_id??te.name)===Oe?{...te,directions_to_use:W}:te))},className:"dosage-input text-sm w-full mt-1"})]})]},Oe)})})]}),c.length>0&&e.jsx("div",{className:"mt-6 text-right pr-4",children:e.jsxs("span",{className:"grand-total font-bold",children:[" ","Grand Total: ",et]})}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{type:"submit",disabled:N||c.length===0&&!(D!=null&&D.trim()),className:`submit-order-button inline-flex items-center justify-center text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 ${N||c.length===0&&!(D!=null&&D.trim())?"":"hover:opacity-90"}`,children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner animate-spin rounded-full h-5 w-5 border-2 mr-3"})," ","Creating Order..."]}):"Create Order"})})]})]})},F1=()=>{const{orderId:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState(null),[c,d]=y.useState([]),[p,m]=y.useState([]),[f,g]=y.useState(""),[x,j]=y.useState([]),[N,k]=y.useState(null),[D,_]=y.useState(!1),[T,E]=y.useState(null),[U,X]=y.useState(!0);Ra();const I=y.useCallback(async()=>{X(!0);try{const R=await ae(`/api/pharmacy-orders/${t}`);if(!R.ok)throw new Error("Failed to fetch order details");const L=await R.json();r(L),u({id:L.patientId,name:L.patientName||"N/A",token:L.patientTokenNumber}),E(L.prescriptionForUnavailableDrugs);const M=L.medications.map(Z=>{const Q=B(Z.pack),S=Z.pack_quantity*(Q??1)+Z.loose_quantity;return{...Z,isLoose:!0,loosePacks:Z.pack_quantity,looseUnits:Z.loose_quantity,looseQuantity:S,pack_price:Z.pack_price,loose_price:Z.loose_price,total_price:Z.total_price,pricePerLooseUnit:Z.loose_price,originalPrice:Z.pack_price,box_number:Z.box_number,pack:Z.pack,batch:Z.batch,expiry_date:Z.expiry_date,discount_percentage:Z.discount_percentage}});m(M)}catch(R){k("Could not load order details. "+R.message)}finally{X(!1)}},[t]),F=y.useCallback(async()=>{try{const R=await ae("/api/drugs");if(!R.ok)throw new Error("Failed to fetch drugs");const L=await R.json(),M=L.drugs||L||[];d(M)}catch(R){k("Could not load drug list. "+R.message)}},[]);y.useEffect(()=>{I(),F()},[I,F]),y.useEffect(()=>{if(!f){j([]);return}const R=f.toLowerCase();j(c.filter(L=>{const M=L.name&&L.name.toLowerCase().includes(R),Z=L.brand_name&&L.brand_name.toLowerCase().includes(R);return M||Z}).slice(0,10))},[f,c]);const B=R=>{if(!R)return null;const L=R.match(/(?:\d+x)?(\d+)/);return L?parseInt(L[1],10):null},G=R=>{if(p.some(L=>L.drug_id===R.id)){k(`${R.name||R.brand_name} is already in the order.`),setTimeout(()=>k(null),3e3),g(""),j([]);return}m(L=>[...L,{drug_id:R.id,name:R.name||R.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,pack_price:Number(R.mrp)||0,loose_price:(Number(R.mrp)||0)/(B(R.pack)||1),total_price:(Number(R.mrp)||0)/(B(R.pack)||1),discount_percentage:0,directions_to_use:"",tabletsPerDay:1,numberOfDays:1,stock:R.stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(R.mrp)||0)/(B(R.pack)||1),originalPrice:Number(R.mrp)||0,pack:R.pack}]),g(""),j([])},C=R=>{m(L=>L.filter(M=>(M.drug_id??M.name)!==R))},A=(R,L)=>{m(M=>M.map(Z=>{if((Z.drug_id??Z.name)===R&&Z.isLoose){const Q=B(Z.pack),S=Math.max(0,L),ge=S*(Q??1)+(Z.looseUnits??0);return{...Z,loosePacks:S,looseQuantity:ge,pack_quantity:S}}return Z}))},P=(R,L)=>{m(M=>M.map(Z=>{if((Z.drug_id??Z.name)===R&&Z.isLoose){const Q=B(Z.pack),S=Math.max(0,L),ge=(Z.loosePacks??0)*(Q??1)+S;return{...Z,looseUnits:S,looseQuantity:ge,loose_quantity:S}}return Z}))},$=async R=>{if(R.preventDefault(),k(null),_(!0),p.length===0&&!(T!=null&&T.trim())){k("Please add at least one medication or provide a prescription."),_(!1);return}const L=p.filter(Z=>{const Q=Z.looseQuantity??0;return Q<=0||Z.stock!==void 0&&Q>Z.stock});if(L.length>0){k(`Invalid quantity or insufficient stock for: ${L.map(Z=>Z.name).join(", ")}`),_(!1);return}const M={items:p.map(Z=>({drug_id:Z.drug_id??null,name:Z.name,pack_quantity:Z.loosePacks??0,loose_quantity:Z.looseUnits??0,pack_price:Z.pack_price??0,loose_price:Z.loose_price??0,total_price:(Z.loose_price??0)*(Z.looseQuantity??0),discount_percentage:Z.discount_percentage??0,directions_to_use:Z.directions_to_use??null,tabletsPerDay:Z.tabletsPerDay??1,numberOfDays:Z.numberOfDays??1})),prescription_for_unavailable_drugs:T,order_total:J};try{const Z=await ae(`/api/pharmacy-orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!Z.ok){const Q=await Z.json();throw new Error(Q.message||"Failed to update order")}alert("Pharmacy order updated successfully!"),s(-1)}catch(Z){k(Z.message||"Failed to update order. Please try again.")}finally{_(!1)}},J=y.useMemo(()=>p.reduce((R,L)=>{const M=L.loose_price??0,Z=L.looseQuantity??0;return R+M*Z},0),[p]);return U?e.jsx("div",{className:"p-6 flex justify-center items-center h-screen text-gray-500",children:"Loading order details..."}):n?e.jsxs("div",{className:"edit-pharmacy-order-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{onClick:()=>s(-1),className:"back-button",title:"Go Back",children:e.jsx(vt,{size:20})}),e.jsxs("h2",{className:"page-title",children:["EDIT ORDER ",e.jsxs("span",{className:"text-gray-500 text-lg font-normal ml-2",children:[o==null?void 0:o.name," #",n.id.substring(0,4)]})]})]}),e.jsx("div",{className:"header-right",children:e.jsx("span",{className:"status-badge",children:n.status.toUpperCase()})})]}),e.jsx("div",{className:"order-meta",children:e.jsxs("span",{className:"order-date",children:[" Order Date: ",new Date(n.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})]})}),e.jsxs("form",{onSubmit:$,className:"main-layout",children:[e.jsxs("div",{className:"left-column",children:[e.jsxs("div",{className:"card search-section",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{children:" Find & Add Medication"})}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search by name or brand...",value:f,onChange:R=>g(R.target.value),className:"search-input"}),f&&e.jsx("div",{className:"dropdown-results",children:x.length>0?e.jsx("ul",{children:x.map(R=>e.jsxs("li",{onClick:()=>G(R),className:"dropdown-item",children:[e.jsx("span",{className:"drug-name",children:R.name||R.brand_name}),e.jsxs("span",{className:"drug-meta",children:["(Stock: ",R.stock??"N/A",", MRP: ",Number(R.mrp||0).toFixed(2),")"]})]},R.id))}):e.jsxs("div",{className:"p-3 text-gray-500 text-sm",children:['No drugs found matching "',f,'"']})})]})]}),e.jsxs("div",{className:"card medications-list-section",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{children:[" Medications in Order ",e.jsxs("span",{className:"item-count",children:[p.length," items"]})]})}),p.length>0?e.jsxs("div",{className:"table-container",children:[e.jsxs("div",{className:"table-header-row",children:[e.jsx("div",{className:"col-medication",children:"MEDICATION"}),e.jsx("div",{className:"col-directions",children:"DIRECTIONS"}),e.jsx("div",{className:"col-quantity",children:"QUANTITY"}),e.jsx("div",{className:"col-subtotal",children:"SUBTOTAL"}),e.jsx("div",{className:"col-action"})]}),e.jsx("div",{className:"table-body",children:p.map(R=>{const L=R.drug_id??R.name;return e.jsxs("div",{className:"table-row",children:[e.jsxs("div",{className:"col-medication",children:[e.jsx("span",{className:"med-name",children:R.name}),R.pack&&e.jsx("span",{className:"med-unit text-xs text-gray-500 block",children:R.pack}),e.jsxs("div",{className:"stock-info",children:[" Stock: ",e.jsxs("span",{className:"stock-value",children:[" ",R.stock!==void 0?R.pack?`BOX OF ${B(R.pack)}`:R.stock:"N/A"]})]})]}),e.jsx("div",{className:"col-directions",children:e.jsx("input",{type:"text",placeholder:"1 tablet twice daily...",value:R.directions_to_use??"",onChange:M=>{const Z=M.target.value;m(Q=>Q.map(S=>(S.drug_id??S.name)===L?{...S,directions_to_use:Z}:S))},className:"directions-input"})}),e.jsx("div",{className:"col-quantity",children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"10px",fontWeight:"bold",color:"#9ca3af",display:"block",marginBottom:"2px"},children:"PACKS"}),e.jsx("input",{type:"number",min:"0",value:R.loosePacks||"",onChange:M=>A(L,M.target.value===""?0:parseInt(M.target.value)),className:"qty-input",style:{width:"100%",textAlign:"center"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"10px",fontWeight:"bold",color:"#9ca3af",display:"block",marginBottom:"2px"},children:"LOOSE"}),e.jsx("input",{type:"number",min:"0",value:R.looseUnits||"",onChange:M=>P(L,M.target.value===""?0:parseInt(M.target.value)),className:"qty-input",style:{width:"100%",textAlign:"center"}})]})]})}),e.jsxs("div",{className:"col-subtotal",children:["",(Number((R.pricePerLooseUnit??0)*(R.looseQuantity??0))||0).toFixed(2)]}),e.jsx("div",{className:"col-action",children:e.jsx("button",{type:"button",onClick:()=>C(L),className:"delete-btn",children:e.jsx(on,{size:16})})})]},L)})})]}):e.jsx("div",{className:"empty-state",children:"No medications added. Search above to add."})]})]}),e.jsxs("div",{className:"right-column",children:[e.jsxs("div",{className:"card notes-card",children:[e.jsx("div",{className:"card-header border-b-0 pb-2",children:e.jsx("h3",{children:" Prescription Notes"})}),e.jsx("textarea",{rows:3,value:T??"",onChange:R=>E(R.target.value||null),placeholder:"Add notes about unavailable drugs...",className:"notes-input"})]}),e.jsxs("button",{type:"submit",disabled:D,className:"confirm-btn",style:{width:"100%",margin:"20px 0 0 0"},children:[e.jsx("span",{className:"check-icon",children:""})," ",D?"Updating...":"Confirm Changes"]}),N&&e.jsx("div",{className:"error-alert mt-4",children:N})]})]})]}):e.jsx("div",{className:"p-6 text-red-500 flex justify-center items-center h-screen",children:"Order not found or failed to load."})},uR=(t,s,n,r="non-black")=>{if(isNaN(t)||isNaN(s)||t<=0||s<=0)return null;let o;return n==="female"?t<=.7?o=141*Math.pow(t/.7,-.329)*Math.pow(.993,s):o=141*Math.pow(t/.7,-1.209)*Math.pow(.993,s):t<=.9?o=141*Math.pow(t/.9,-.411)*Math.pow(.993,s):o=141*Math.pow(t/.9,-1.209)*Math.pow(.993,s),r==="black"&&(o*=1.018),parseFloat(o.toFixed(2))},dR=(t,s,n)=>{if(isNaN(t)||isNaN(s)||isNaN(n)||t<0||s<0||n<0||n>=400)return null;const r=t-s-n/5;return parseFloat(r.toFixed(2))},hR=(t,s)=>{if(isNaN(t)||isNaN(s)||t<0||s<0)return null;const n=t-s;return parseFloat(n.toFixed(2))},mR=(t,s)=>{if(isNaN(t)||isNaN(s)||t<0||s<0)return null;const n=t-s;return parseFloat(n.toFixed(2))},pR=(t,s,n)=>{if(isNaN(t)||isNaN(s)||isNaN(n)||t<0||s<0||n<0)return null;const r=t-(s+n);return parseFloat(r.toFixed(2))},fR=(t,s,n)=>{if(isNaN(t)||isNaN(s)||isNaN(n)||t<0||s<0||n<0)return null;const r=2*t+s/18+n/2.8;return parseFloat(r.toFixed(2))},Qj=t=>["eGFR","LDL Cholesterol","Indirect Bilirubin","Globulin","Anion Gap","Osmolality"].includes(t),Yj=()=>{var ue,Ne;const{orderId:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState({}),[c,d]=y.useState(!0),[p,m]=y.useState(!1),[f,g]=y.useState(null),[x,j]=y.useState(null),[N,k]=y.useState(null),[D,_]=y.useState({}),[T,E]=y.useState(null),[U,X]=y.useState(!1),[I,F]=y.useState(""),[B,G]=y.useState(!1),[C,A]=y.useState(""),P=y.useCallback(async K=>{var Y;try{const V=await ae(`/api/patients/${K}`);if(!V.ok)throw new Error(`Failed to fetch patient details: ${V.status}`);const oe=await V.json();j(oe.age),k(((Y=oe.sex)==null?void 0:Y.toLowerCase())==="female"?"female":"male"),oe.phone&&r(Pe=>Pe?{...Pe,Patient:{...Pe.Patient,phone:oe.phone}}:null)}catch(V){console.error("Error fetching patient details:",V),j(null),k(null)}},[]),$=y.useCallback(async()=>{if(t){d(!0),g(null);try{const K=await ae(`/api/lab/${t}`);if(!K.ok){const oe=await K.json().catch(()=>({message:`HTTP error! status: ${K.status}`}));throw new Error(oe.message||`HTTP error! status: ${K.status}`)}const Y=await K.json();if(r(Y),Y.createdAt)try{const oe=new Date(Y.createdAt),Pe=new Date(oe.getTime()-oe.getTimezoneOffset()*6e4).toISOString().slice(0,16);F(Pe)}catch(oe){console.error("Error formatting date for edit:",oe)}if(Y.report_date)try{const oe=new Date(Y.report_date),Pe=new Date(oe.getTime()-oe.getTimezoneOffset()*6e4).toISOString().slice(0,16);A(Pe)}catch(oe){console.error("Error formatting report date for edit:",oe)}else{const oe=new Date,Pe=new Date(oe.getTime()-oe.getTimezoneOffset()*6e4).toISOString().slice(0,16);A(Pe)}Y.patient_id&&P(Y.patient_id);const V={};if(Y.tests&&Y.tests.forEach(oe=>{V[oe.id]={},oe.default_parameters&&oe.default_parameters.length>0?oe.default_parameters.forEach(Pe=>{V[oe.id][Pe.name]=Pe.defaultValue}):V[oe.id].report_content=""}),Y.report_content)try{const oe=JSON.parse(Y.report_content);typeof oe=="object"&&oe!==null&&!Array.isArray(oe)?u(oe):(console.warn("Legacy or unexpected report content format detected. Initializing with defaults."),u(V))}catch{console.warn("Legacy report content detected (not JSON). Initializing with defaults."),u(V)}else u({})}catch(K){console.error("Failed to fetch lab order details:",K),g(K instanceof Error?K.message:"An unknown error occurred while fetching order details.")}finally{d(!1)}}},[t,P]);y.useEffect(()=>{t?$():(g("No Order ID provided in the URL."),d(!1))},[t,$]);const J=(K,Y,V)=>{u(oe=>{var O,te,re,ke,Ue,Qe,Ze,lt,le,pe,de,we,Ae,Re,at,tt,Je,wt,Mt;const Pe={...oe,[K]:{...oe[K],[Y]:V}},se=parseFloat((O=Pe[K])==null?void 0:O.Creatinine),Ce=x,ee=N;if(Y==="Creatinine"&&!isNaN(se)&&Ce!==null&&ee!==null){const pt=uR(se,Ce,ee);pt!==null&&((te=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&te.default_parameters.find(Xe=>Xe.name==="eGFR"))&&(Pe[K].eGFR=pt)}const je=parseFloat((re=Pe[K])==null?void 0:re["Total Cholesterol"]),Ie=parseFloat((ke=Pe[K])==null?void 0:ke["HDL Cholesterol"]),$e=parseFloat((Ue=Pe[K])==null?void 0:Ue.Triglycerides);if((Y==="Total Cholesterol"||Y==="HDL Cholesterol"||Y==="Triglycerides")&&!isNaN(je)&&!isNaN(Ie)&&!isNaN($e)){const pt=dR(je,Ie,$e);pt!==null&&((Qe=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&Qe.default_parameters.find(Xe=>Xe.name==="LDL Cholesterol"))&&(Pe[K]["LDL Cholesterol"]=pt)}const Fe=parseFloat((Ze=Pe[K])==null?void 0:Ze["Total Bilirubin"]),Be=parseFloat((lt=Pe[K])==null?void 0:lt["Direct Bilirubin"]);if((Y==="Total Bilirubin"||Y==="Direct Bilirubin")&&!isNaN(Fe)&&!isNaN(Be)){const pt=hR(Fe,Be);pt!==null&&((le=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&le.default_parameters.find(Xe=>Xe.name==="Indirect Bilirubin"))&&(Pe[K]["Indirect Bilirubin"]=pt)}const qe=parseFloat((pe=Pe[K])==null?void 0:pe["Total Protein"]),et=parseFloat((de=Pe[K])==null?void 0:de.Albumin);if((Y==="Total Protein"||Y==="Albumin")&&!isNaN(qe)&&!isNaN(et)){const pt=mR(qe,et);pt!==null&&((we=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&we.default_parameters.find(Xe=>Xe.name==="Globulin"))&&(Pe[K].Globulin=pt)}const ye=parseFloat((Ae=Pe[K])==null?void 0:Ae.Sodium),Oe=parseFloat((Re=Pe[K])==null?void 0:Re.Chloride),xe=parseFloat((at=Pe[K])==null?void 0:at.Bicarbonate);if((Y==="Sodium"||Y==="Chloride"||Y==="Bicarbonate")&&!isNaN(ye)&&!isNaN(Oe)&&!isNaN(xe)){const pt=pR(ye,Oe,xe);pt!==null&&((tt=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&tt.default_parameters.find(Xe=>Xe.name==="Anion Gap"))&&(Pe[K]["Anion Gap"]=pt)}const he=parseFloat((Je=Pe[K])==null?void 0:Je.Glucose),W=parseFloat((wt=Pe[K])==null?void 0:wt.BUN);if((Y==="Sodium"||Y==="Glucose"||Y==="BUN")&&!isNaN(ye)&&!isNaN(he)&&!isNaN(W)){const pt=fR(ye,he,W);pt!==null&&((Mt=n==null?void 0:n.tests.find(Xe=>Xe.id===K))!=null&&Mt.default_parameters.find(Xe=>Xe.name==="Osmolality"))&&(Pe[K].Osmolality=pt)}return Pe})},R=async K=>{const Y=o[K]||{},V=n==null?void 0:n.tests.find(Ce=>Ce.id===K);if(!V)return;const oe={};V.default_parameters&&V.default_parameters.forEach(Ce=>{oe[Ce.name]=Ce.defaultValue});const Pe={...oe,...Y},se={...o,[K]:Pe};u(se),m(!0),g(null);try{const Ce=await ae(`/api/lab/${t}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(se),isPartial:!0})});if(!Ce.ok)throw new Error(`Save failed: ${Ce.status}`);alert(`Report for ${V.name} saved successfully!`)}catch(Ce){console.error("Error saving test report:",Ce),alert("Failed to save test report.")}finally{m(!1)}},L=(K=null)=>{E(K),setTimeout(()=>{window.print()},100)},M=()=>{n&&zf(n)},Z=async()=>{if(!n||!n.tests){alert("Order details not loaded.");return}if(!t){alert("Cannot submit report without an Order ID.");return}const K={};if(n.tests.forEach(Y=>{const V=o[Y.id]||{},oe={};Y.default_parameters&&Y.default_parameters.forEach(Pe=>{Pe.defaultValue!==void 0&&Pe.defaultValue!==null&&(oe[Pe.name]=Pe.defaultValue)}),K[Y.id]={...oe,...V},(!Y.default_parameters||Y.default_parameters.length===0)&&!K[Y.id].report_content&&(K[Y.id].report_content="")}),Object.keys(K).length===0){alert("Report content cannot be empty.");return}u(K),m(!0),g(null);try{const Y=await ae(`/api/lab/${t}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(K)})});if(!Y.ok){const V=await Y.json().catch(()=>({message:`Submission failed: ${Y.status}`}));throw new Error(V.message||`Submission failed: ${Y.status}`)}alert("Report submitted successfully!"),s(-1)}catch(Y){console.error("Error submitting report:",Y),g(Y instanceof Error?Y.message:"An unknown error occurred during submission.")}finally{m(!1)}},Q=async()=>{if(!(!t||!I))try{const K=await ae(`/api/lab/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:new Date(I).toISOString()})});if(!K.ok)throw new Error("Failed to update date");const Y=await K.json();Y.order&&r(V=>V?{...V,createdAt:Y.order.createdAt}:null),X(!1)}catch(K){console.error("Failed to update date:",K),alert("Failed to update date")}},S=async()=>{if(!(!t||!C))try{const K=await ae(`/api/lab/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reportDate:new Date(C).toISOString()})});if(!K.ok)throw new Error("Failed to update report date");const Y=await K.json();Y.order&&r(V=>V?{...V,report_date:Y.order.report_date}:null),G(!1)}catch(K){console.error("Failed to update report date:",K),alert("Failed to update report date")}};if(c)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",style:{textAlign:"center",padding:"50px"},children:[" ",e.jsxs("div",{className:"loading-text",children:[e.jsx(Va,{className:"animate-spin h-8 w-8 inline mr-2"}),"Loading details..."]})]})});if(f&&!n)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card error-message-container",style:{textAlign:"center",padding:"30px"},children:[e.jsx(pn,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("h3",{className:"error-title",style:{borderBottom:"none"},children:"Error Loading Details"}),e.jsx("p",{className:"error-text",children:f}),e.jsxs("button",{onClick:()=>s(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"20px"},children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});if(!n)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(cs,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("p",{className:"no-data-message",style:{fontSize:"1.1em"},children:`Lab order not found for ID: ${t}.`}),e.jsxs("button",{onClick:()=>s(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"15px"},children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});const ge=(ue=n==null?void 0:n.Patient)==null?void 0:ue.name,fe=(Ne=n==null?void 0:n.Patient)==null?void 0:Ne.patient_token_number;return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"none",paddingBottom:0,marginBottom:0},children:[" ",e.jsx("h2",{style:{margin:0,fontSize:"1.5em"},children:"Enter Lab Report"})," ",e.jsxs("button",{onClick:()=>s(t?"/lab":-1),className:"lab-inventory-button lab-inventory-button-secondary",disabled:p,children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),t?"Back to Lab Panel":"Back"]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginLeft:"10px"},children:[e.jsxs("button",{onClick:()=>L(null),className:"lab-inventory-button",title:"Print Full Report",children:[e.jsx(ls,{size:16,style:{marginRight:"5px"}})," Print All"]}),e.jsxs("button",{onClick:M,className:"lab-inventory-button",style:{backgroundColor:"#25D366",borderColor:"#25D366",color:"white"},title:"Share via WhatsApp",children:[e.jsx(l0,{size:16,style:{marginRight:"5px"}})," WhatsApp"]})]})]}),n&&e.jsxs("div",{className:"lab-inventory-card no-print",style:{marginTop:"20px"},children:[e.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginBottom:"10px"},children:[e.jsx(cs,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}})," Order Summary"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"10px",fontSize:"0.95em"},children:[e.jsxs("div",{children:[e.jsx(Oa,{size:15,style:{marginRight:"5px",verticalAlign:"middle"}}),e.jsx("strong",{children:"Patient:"})," ",ge??"N/A"," (Token: ",fe??"N/A",")"]}),e.jsxs("div",{children:[e.jsx(Jy,{size:15,style:{marginRight:"5px",verticalAlign:"middle"}}),e.jsx("strong",{children:"Order Date:"})," ",U?e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px"},children:[e.jsx("input",{type:"datetime-local",value:I,onChange:K=>F(K.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",fontSize:"0.9em",width:"auto"}}),e.jsx("button",{onClick:Q,className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"2px",minWidth:"auto"},title:"Save Date",children:e.jsx(vd,{size:16,color:"green"})}),e.jsx("button",{onClick:()=>{if(X(!1),n.createdAt){const K=new Date(n.createdAt),Y=new Date(K.getTime()-K.getTimezoneOffset()*6e4).toISOString().slice(0,16);F(Y)}},className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"2px",minWidth:"auto"},title:"Cancel",children:e.jsx(Et,{size:16,color:"red"})})]}):e.jsxs(e.Fragment,{children:[jr(new Date(n.createdAt),"PPpp"),e.jsx("button",{onClick:()=>X(!0),className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"0 4px",minWidth:"auto",marginLeft:"8px",verticalAlign:"middle",border:"none"},title:"Edit Date",children:e.jsx(zm,{size:14})})]})]}),e.jsxs("div",{children:[e.jsx(Jy,{size:15,style:{marginRight:"5px",verticalAlign:"middle"}}),e.jsx("strong",{children:"Report Date:"})," ",B?e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"5px"},children:[e.jsx("input",{type:"datetime-local",value:C,onChange:K=>A(K.target.value),className:"lab-inventory-input",style:{padding:"2px 5px",fontSize:"0.9em",width:"auto"}}),e.jsx("button",{onClick:S,className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"2px",minWidth:"auto"},title:"Save Report Date",children:e.jsx(vd,{size:16,color:"green"})}),e.jsx("button",{onClick:()=>{if(G(!1),n.report_date){const K=new Date(n.report_date),Y=new Date(K.getTime()-K.getTimezoneOffset()*6e4).toISOString().slice(0,16);A(Y)}else{const K=new Date,Y=new Date(K.getTime()-K.getTimezoneOffset()*6e4).toISOString().slice(0,16);A(Y)}},className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"2px",minWidth:"auto"},title:"Cancel",children:e.jsx(Et,{size:16,color:"red"})})]}):e.jsxs(e.Fragment,{children:[n.report_date?jr(new Date(n.report_date),"PPpp"):"Not Reported",e.jsx("button",{onClick:()=>G(!0),className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"0 4px",minWidth:"auto",marginLeft:"8px",verticalAlign:"middle",border:"none"},title:"Edit Report Date",children:e.jsx(zm,{size:14})})]})]}),e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx(Bw,{size:15,style:{marginRight:"5px",verticalAlign:"middle"}}),e.jsx("strong",{children:"Tests:"})," ",(n.tests||[]).map(K=>K.name).join(", ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:xR(n.status),children:gR(n.status)})]})]})]}),e.jsxs("div",{className:"lab-inventory-form-group no-print",style:{marginTop:"20px"},children:[e.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginBottom:"10px"},children:"Report Parameters"}),n==null?void 0:n.tests.map(K=>{var Y;return e.jsxs("div",{className:"lab-inventory-card",style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"10px"},children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em",margin:0},children:K.name}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsxs("button",{type:"button",onClick:V=>{V.stopPropagation(),R(K.id)},className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"4px 8px",fontSize:"0.8em"},disabled:p,children:[e.jsx(wr,{size:14,style:{marginRight:"4px"}})," Save"]}),e.jsx("button",{type:"button",onClick:V=>{V.stopPropagation(),L(K.id)},className:"lab-inventory-button lab-inventory-button-tertiary",style:{padding:"4px 8px",fontSize:"0.8em",marginLeft:"5px"},title:"Print This Test Only",children:e.jsx(ls,{size:14})})]})]}),e.jsx("div",{className:"test-parameters-body",style:{display:"block"},children:K.default_parameters&&K.default_parameters.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{className:"lab-inventory-table",style:{marginTop:"10px",width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9fafb"},children:[e.jsx("th",{style:{width:"25%",padding:"10px",textAlign:"left",borderBottom:"1px solid #e5e7eb",color:"#6b7280",fontWeight:"600"},children:"Parameter"}),e.jsx("th",{style:{width:"35%",padding:"10px",textAlign:"left",borderBottom:"1px solid #e5e7eb",color:"#6b7280",fontWeight:"600"},children:"Result"}),e.jsx("th",{style:{width:"15%",padding:"10px",textAlign:"left",borderBottom:"1px solid #e5e7eb",color:"#6b7280",fontWeight:"600"},children:"Units"}),e.jsx("th",{style:{width:"25%",padding:"10px",textAlign:"left",borderBottom:"1px solid #e5e7eb",color:"#6b7280",fontWeight:"600"},children:"Normal Range"})]})}),e.jsx("tbody",{children:K.default_parameters.map(V=>{var oe,Pe,se,Ce,ee,je,Ie;return e.jsxs("tr",{style:{borderBottom:"1px solid #e5e7eb"},children:[e.jsx("td",{style:{padding:"10px",verticalAlign:"middle",color:"#374151",fontWeight:"500"},children:e.jsx("label",{htmlFor:`${K.id}-${V.name}`,style:{cursor:"pointer"},children:V.name})}),e.jsx("td",{style:{padding:"10px",verticalAlign:"middle"},children:V.type==="boolean"?e.jsxs("select",{id:`${K.id}-${V.name}`,value:((Pe=(oe=o[K.id])==null?void 0:oe[V.name])==null?void 0:Pe.toString())??"false",onChange:$e=>J(K.id,V.name,$e.target.value==="true"),className:"lab-inventory-input",disabled:p,style:{margin:0,width:"100%"},children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-Reactive"})]}):e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[e.jsx("input",{id:`${K.id}-${V.name}`,type:V.type==="number"?"number":"text",value:(()=>{var Fe,Be;const $e=((Fe=o[K.id])==null?void 0:Fe[V.name])!==void 0?(Be=o[K.id])==null?void 0:Be[V.name]:V.defaultValue??"";return $e===0||$e==="0"?"":$e})(),onChange:$e=>{const Fe=V.type==="number"&&$e.target.value===""?"":$e.target.value;J(K.id,V.name,Fe)},className:`lab-inventory-input ${V.type==="number"&&((se=o[K.id])==null?void 0:se[V.name])!==""&&(V.lower_limit!=null&&parseFloat((Ce=o[K.id])==null?void 0:Ce[V.name])<V.lower_limit||V.upper_limit!=null&&parseFloat((ee=o[K.id])==null?void 0:ee[V.name])>V.upper_limit)?"abnormal-result":""}`,disabled:p||Qj(V.name)&&!((je=D[K.id])!=null&&je[V.name]),style:{margin:0,width:"100%"}}),Qj(V.name)&&e.jsx("button",{type:"button",onClick:()=>_($e=>{var Fe;return{...$e,[K.id]:{...$e[K.id]||{},[V.name]:!((Fe=$e[K.id])!=null&&Fe[V.name])}}}),className:"lab-inventory-button lab-inventory-button-tertiary",style:{fontSize:"0.7em",padding:"4px 6px",height:"fit-content",whiteSpace:"nowrap"},disabled:p,title:(Ie=D[K.id])!=null&&Ie[V.name]?"Disable Manual Edit":"Edit Calculated Field",children:e.jsx(zm,{size:12})})]})}),e.jsx("td",{style:{padding:"10px",verticalAlign:"middle",color:"#6b7280"},children:V.unit||"-"}),e.jsx("td",{style:{padding:"10px",verticalAlign:"middle",color:"#6b7280",fontSize:"0.9em"},children:V.type==="number"&&(V.lower_limit!==null||V.upper_limit!==null)?e.jsxs(e.Fragment,{children:[V.lower_limit!==null&&V.lower_limit!==void 0&&`> ${V.lower_limit}`,V.lower_limit!==null&&V.lower_limit!==void 0&&V.upper_limit!==null&&V.upper_limit!==void 0&&" - ",V.upper_limit!==null&&V.upper_limit!==void 0&&`< ${V.upper_limit}`]}):"-"})]},V.name)})})]})})}):e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("label",{htmlFor:`${K.id}-report_content`,children:"Report Content"}),e.jsx("textarea",{id:`${K.id}-report_content`,value:((Y=o[K.id])==null?void 0:Y.report_content)??"",onChange:V=>J(K.id,"report_content",V.target.value),className:"lab-inventory-input",rows:5,placeholder:`Enter report for ${K.name}...`,disabled:p})]})})]},K.id)}),f&&e.jsxs("p",{className:"error-text",style:{marginTop:"10px"},children:[e.jsx(pn,{size:15,className:"inline mr-1"}),f]})]}),e.jsxs("div",{className:"no-print",style:{marginTop:"20px",display:"flex",justifyContent:"flex-end",gap:"10px"},children:[" ",e.jsx("button",{type:"button",onClick:()=>s(-1),disabled:p,className:"lab-inventory-button lab-inventory-button-secondary",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Z,disabled:p,className:"lab-inventory-button",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Va,{className:"animate-spin mr-2",size:16})," Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(wr,{size:16,style:{marginRight:"5px"}})," Submit Full Report"]})})]}),e.jsxs("div",{className:"printable-only",children:[n&&n.Patient&&e.jsxs("div",{style:{marginBottom:"20px",borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"15px"},children:"Lab Report"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",fontSize:"12px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Patient Name:"})," ",n.Patient.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Age/Sex:"})," ",x??"N/A"," / ",N??"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ref. Doctor:"})," ",n.uploaded_by||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",jr(new Date,"PPpp")]})]})]}),n==null?void 0:n.tests.filter(K=>T===null||K.id===T).map(K=>{var Y;return e.jsxs("div",{style:{marginBottom:"20px",pageBreakInside:"avoid"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #eee",paddingBottom:"5px"},children:K.name}),K.default_parameters&&K.default_parameters.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9f9f9"},children:[e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Parameter"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Result"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Units"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Normal Range"})]})}),e.jsx("tbody",{children:K.default_parameters.map(V=>{var je;const oe=(je=o[K.id])==null?void 0:je[V.name],Pe=typeof oe=="string"?parseFloat(oe):typeof oe=="number"?oe:NaN,se=V.type==="number"&&!isNaN(Pe)&&oe!==""&&(V.lower_limit!=null&&Pe<V.lower_limit||V.upper_limit!=null&&Pe>V.upper_limit),Ce=V.type==="boolean"&&(oe===!0||oe==="true"),ee=V.type==="boolean"?oe===!0||oe==="true"?"Reactive":"Non-Reactive":oe??"";return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:V.name}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee",fontWeight:se||Ce?"bold":"normal",color:se?"red":Ce?"green":"inherit"},children:ee}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:V.unit??""}),e.jsxs("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:[V.lower_limit!==null&&V.lower_limit!==void 0&&`> ${V.lower_limit}`,V.lower_limit!==null&&V.lower_limit!==void 0&&V.upper_limit!==null&&V.upper_limit!==void 0&&" - ",V.upper_limit!==null&&V.upper_limit!==void 0&&`< ${V.upper_limit}`]})]},V.name)})})]}):e.jsx("div",{style:{whiteSpace:"pre-wrap",fontSize:"12px",padding:"10px"},children:((Y=o[K.id])==null?void 0:Y.report_content)||"No report content entered."})]},K.id)})]})]})})},gR=t=>t?t.replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase()):"Unknown",xR=t=>{if(!t)return"status-badge";switch(t.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}},yR=()=>{const{orderId:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState(!0),[c,d]=y.useState(null),p=y.useCallback(async f=>{if(!f){d("No Order ID specified in the URL."),u(!1),r(null);return}u(!0),d(null),r(null);try{console.log(`Fetching order details for ID: ${f}`);const g=await ae(`/api/lab/orders/${f}/report`);if(!g.ok){let j;try{j=await g.json()}catch{j={message:`Server returned status ${g.status}`}}throw console.error("Fetch order details error response:",j),new Error(j.message||`Failed to fetch order details: ${g.status}`)}const x=await g.json();if(console.log("Received order data:",x),!x)throw console.error("Invalid order data structure:",x),new Error("Invalid order data received from server.");r(x)}catch(g){console.error("Error fetching order details:",g),d(g instanceof Error?g.message:"An unknown error occurred while fetching the order details")}finally{u(!1)}},[ae]);y.useEffect(()=>{p(t)},[t,p]);const m=()=>{n&&zf(n)};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0,paddingBottom:0,borderBottom:"none"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.5em"},children:"Lab Report Viewer"})," ",e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs(us,{to:"/lab/search-report",className:"lab-inventory-button","aria-label":"Search for other reports",children:[e.jsx(mn,{size:16,style:{marginRight:"5px"}}),"Search Reports"]}),e.jsxs("button",{onClick:()=>s(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),"Back"]}),e.jsxs("button",{onClick:()=>window.print(),className:"lab-inventory-button","aria-label":"Print report",children:[e.jsx(ls,{size:16,style:{marginRight:"5px"}}),"Print"]}),e.jsxs("button",{onClick:m,className:"lab-inventory-button","aria-label":"Share report via WhatsApp",style:{backgroundColor:"#25D366",borderColor:"#25D366",color:"white"},children:[e.jsx(l0,{size:16,style:{marginRight:"5px"}}),"WhatsApp"]})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsxs("h3",{className:"lab-inventory-header",children:["Report Details (Order ID: ",t||"None Specified",")"]}),o&&e.jsx("div",{className:"loading-text",children:"Loading report..."}),c&&!o&&e.jsxs("div",{className:"error-message-container",style:{textAlign:"center"},children:[e.jsx(pn,{size:48}),e.jsx("h3",{className:"error-title",children:"Error Loading Report"}),e.jsx("p",{children:c}),t&&e.jsx("button",{onClick:()=>p(t),className:"retry-button",children:"Retry"})]}),e.jsxs("div",{className:"printable-section",children:[!o&&!c&&(n==null?void 0:n.Patient)&&e.jsxs("div",{className:"lab-inventory-card",style:{marginBottom:"20px"},children:[e.jsxs("h3",{className:"lab-inventory-header",children:[e.jsx(Oa,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Patient Information"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",fontSize:"0.9em"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",n.Patient.name||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Age:"})," ",n.Patient.age??"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",n.Patient.gender||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Token No:"})," ",n.Patient.patient_token_number||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Patient ID:"})," ",n.Patient.id]}),n.Patient.phone&&e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",n.Patient.phone]})]})]}),!o&&!c&&(n==null?void 0:n.report_content)&&e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("h3",{className:"lab-inventory-header",children:[e.jsx(hs,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Report Findings"]}),e.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6"},children:(()=>{try{const f=JSON.parse(n.report_content||"{}");return typeof f=="object"&&f!==null&&n.tests?n.tests.map(g=>e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em"},children:g.name}),f[g.id]?e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Normal Range"})]})}),e.jsx("tbody",{children:Object.entries(f[g.id]).map(([x,j])=>{var E;const N=(E=g.default_parameters)==null?void 0:E.find(U=>U.name===x),k=typeof j=="string"?parseFloat(j):typeof j=="number"?j:NaN,D=(N==null?void 0:N.type)==="number"&&!isNaN(k)&&(N.lower_limit!=null&&k<N.lower_limit||N.upper_limit!=null&&k>N.upper_limit),_=(N==null?void 0:N.type)==="boolean"?j===!0||j==="true"?"Reactive":"Non-Reactive":String(j),T=(N==null?void 0:N.type)==="boolean"&&(j===!0||j==="true");return e.jsxs("tr",{children:[e.jsx("td",{children:x}),e.jsxs("td",{className:`${D?"abnormal-result":""} ${T?"reactive-result":""}`,children:[_," ",N==null?void 0:N.unit]}),e.jsx("td",{children:N&&N.type==="number"&&(N.lower_limit!==null||N.upper_limit!==null)?e.jsxs(e.Fragment,{children:[N.lower_limit!=null&&` > ${N.lower_limit}`,N.lower_limit!=null&&N.upper_limit!=null&&" - ",N.upper_limit!=null&&` < ${N.upper_limit}`,N.unit&&` ${N.unit}`]}):((N==null?void 0:N.type)==="boolean","N/A")})]},x)})})]}):e.jsx("p",{children:"No parameters reported for this test."})]},g.id)):e.jsx(xa,{remarkPlugins:[Ln],children:n.report_content})}catch{return e.jsx(xa,{remarkPlugins:[Ln],children:n.report_content||"*No findings recorded.*"})}})()})]})]}),!o&&!c&&!(n!=null&&n.report_content)&&!(n!=null&&n.Patient)&&t&&e.jsxs("div",{className:"no-data-message",children:["No report content or patient details found for Order ID: ",t,". The order might be processing, does not exist, or the ID is incorrect."]}),!t&&!o&&!c&&e.jsxs("div",{className:"no-data-message",children:["No order ID specified in the URL.",e.jsx(us,{to:"/lab/search-report",className:"lab-inventory-link",style:{display:"block",marginTop:"10px"},children:"Go to Search Page"})]})]})]})})},bR=()=>{const t=ot(),[s,n]=y.useState(""),[r,o]=y.useState(!1),[u,c]=y.useState([]),[d,p]=y.useState(null),[m,f]=y.useState(s);Ra(),y.useEffect(()=>{const k=setTimeout(()=>{f(s)},500);return()=>{clearTimeout(k)}},[s]),y.useEffect(()=>{g()},[m]);const g=async()=>{const k=s.trim();if(!k){c([]),p(null);return}o(!0),p(null),c([]),console.log(`Searching for: ${k}`);try{const D=await ae("/api/lab");if(!D.ok){let I;try{I=await D.json()}catch{I={message:`Server returned status ${D.status}`}}throw console.error("Search fetch error response:",I),new Error(I.message||`HTTP error! status: ${D.status}`)}const{orders:_}=await D.json();console.log("Received lab orders for search:",_);const E=_.filter(I=>!!I.report_content).map(I=>{var F,B;return{id:I.id,labTokenNumber:String(I.lab_token_number??"N/A"),patientName:((F=I.Patient)==null?void 0:F.name)||"N/A",patientId:I.patient_id,patientTokenNumber:String(((B=I.Patient)==null?void 0:B.patient_token_number)??"N/A"),tests:(I.tests||[]).map(G=>G.name||"Unknown Test"),date:jr(new Date(I.createdAt),"yyyy-MM-dd"),status:I.status}}),U=s.toLowerCase(),X=E.filter(I=>{var G,C,A,P,$;const F=String(I.labTokenNumber).toLowerCase(),B=String(I.patientTokenNumber).toLowerCase();return(((G=I.patientName)==null?void 0:G.toLowerCase())||"").includes(U)||F.includes(U)||B.includes(U)||(((A=(C=I.tests)==null?void 0:C.join(" "))==null?void 0:A.toLowerCase())||"").includes(U)||(((P=I.id)==null?void 0:P.toLowerCase())||"").includes(U)||((($=I.patientId)==null?void 0:$.toLowerCase())||"").includes(U)});console.log("Filtered search results:",X),c(X),X.length===0&&k?p(`No matching reports found for "${k}".`):p(null)}catch(D){console.error("Failed to search lab reports:",D),p(D instanceof Error?D.message:"An unknown error occurred during search")}finally{o(!1)}},x=k=>{console.log(`Result clicked, navigating to view report for order ID: ${k}`),t(`/lab/view-report/${k}`)},j=k=>{switch(k){case"pending":return{text:"Sample Pending",color:"text-red-600 bg-red-100"};case"collected":return{text:"Sample Collected",color:"text-yellow-600 bg-yellow-100"};case"processing":return{text:"Processing",color:"text-blue-600 bg-blue-100"};case"completed":return{text:"Completed",color:"text-green-600 bg-green-100"};case"cancelled":return{text:"Cancelled",color:"text-gray-600 bg-gray-100 line-through"};case"reported":return{text:"Reported",color:"text-purple-600 bg-purple-100"};default:return{text:k,color:"text-gray-600 bg-gray-100"}}},N=k=>{switch(k){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"Search Lab Reports"}),e.jsxs("button",{onClick:()=>t(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),"Back"]})]}),e.jsxs("div",{className:"lab-inventory-form-group",style:{marginTop:"20px",position:"relative"},children:[e.jsx("label",{htmlFor:"report-search",children:"Enter Search Term"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"relative"},children:[e.jsx(mn,{size:20,style:{position:"absolute",left:"10px",color:"#777"}}),e.jsx("input",{id:"report-search",type:"text",placeholder:"Patient name, ID, token, report ID, test name...",value:s,onChange:k=>n(k.target.value),className:"lab-inventory-input",style:{paddingLeft:"40px",marginBottom:"0"}})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[r&&e.jsx("div",{className:"loading-text",children:"Searching..."}),d&&!r&&e.jsxs("div",{className:"error-text",children:[e.jsx(pn,{size:20,className:"inline mr-2"})," ",d]}),u.length>0&&!r&&e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:u.map(k=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>x(k.id),style:{marginBottom:"15px",cursor:"pointer",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:[e.jsx(Uw,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),k.patientName," (Token: ",k.patientTokenNumber,")"]}),e.jsx("span",{className:N(k.status),children:j(k.status).text})]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:[e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(hs,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Order ID: ",k.id]}),e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(qw,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Tests: ",k.tests.join(", ")]}),e.jsxs("div",{children:[e.jsx(Hw,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Date: ",k.date]})]})]},k.id))}),!r&&u.length===0&&!d&&s.trim()&&e.jsxs("div",{className:"no-data-message",children:['No results found for "',s,'".']}),!r&&u.length===0&&!d&&!s.trim()&&e.jsx("div",{className:"no-data-message",style:{backgroundColor:"transparent",border:"none",textAlign:"left",padding:"5px 0"},children:"Enter a search term above to find lab reports."})]})]})})},jR=()=>{const{patientId:t}=Qn(),s=ot(),[n,r]=y.useState([]),[o,u]=y.useState(!0),[c,d]=y.useState(null),[p,m]=y.useState(null),[f,g]=y.useState(null);y.useEffect(()=>{(async()=>{if(!t){d("Patient ID is missing from the URL."),u(!1);return}u(!0),d(null),r([]),g(null);try{const N=await ae(`/api/patients/${t}`);if(N.ok){const _=await N.json();g(_.name||`Patient ID: ${t}`)}else console.warn(`Failed to fetch patient name for ID ${t}`),g(`Patient ID: ${t}`);const k=await ae(`/api/lab/patient/${t}`);if(!k.ok){const _=await k.json().catch(()=>({}));throw new Error(_.message||`HTTP error! status: ${k.status}`)}const D=await k.json();r(D||[])}catch(N){console.error("Error fetching data:",N),d(`Failed to load data: ${N.message}`)}finally{u(!1)}})()},[t]);const x=j=>{j.report_content?s(`/lab/view-report/${j.id}`):s(`/lab/enter-report/${j.id}`)};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0},children:["Lab Reports ",f?`for ${f}`:`for Patient ID: ${t}`]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("button",{onClick:async()=>{if(!t){alert("Patient ID is missing. Cannot create a new report.");return}try{const j=await ae("/api/lab/create-empty-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:t})});if(!j.ok){const k=await j.json().catch(()=>({message:`Failed to create new lab order: ${j.status}`}));throw new Error(k.message||`Failed to create new lab order: ${j.status}`)}const N=await j.json();s(`/lab/enter-report/${N.newOrderId}`)}catch(j){console.error("Error creating new lab order:",j),alert(`Error creating new lab order: ${j.message}`)}},className:"lab-inventory-button",disabled:!t,title:t?"Enter a new lab report for this patient":"Patient ID missing",children:[e.jsx(ya,{size:16,style:{marginRight:"5px"}}),"Enter New Report"]}),e.jsxs("button",{onClick:()=>s(-1),className:"lab-inventory-button lab-inventory-button-secondary",children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}}),"Back"]})]})]}),e.jsx("div",{style:{marginTop:"20px"},children:o?e.jsxs("div",{className:"loading-text",children:[e.jsx(Va,{className:"animate-spin h-8 w-8 inline mr-2"}),"Loading reports..."]}):c?e.jsxs("div",{className:"error-text",style:{textAlign:"center",padding:"20px"},children:[e.jsx(Vw,{size:40,style:{marginBottom:"10px",color:"#721c24"}}),e.jsx("h3",{style:{fontSize:"1.2em",color:"#721c24",margin:"10px 0"},children:"Error Loading Reports"}),e.jsx("p",{children:c})]}):n.length===0?e.jsxs("div",{className:"no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(hs,{size:48,className:"mb-3",style:{margin:"0 auto 15px auto",display:"block"}}),e.jsx("p",{children:"No lab reports found for this patient."}),e.jsxs("p",{children:["You can ",e.jsx(us,{to:`/lab/create-order/${t}`,className:"lab-inventory-link",children:"create a new lab order"}),"."]})]}):p?e.jsxs("div",{className:"lab-inventory-card",style:{backgroundColor:"#fdfdfd"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.3em",borderBottom:"none",margin:0},children:["Report from: ",p.report_date?jr(new Date(p.report_date),"PPP p"):"N/A"]}),e.jsxs("button",{onClick:()=>m(null),className:"lab-inventory-button lab-inventory-button-secondary",style:{fontSize:"0.9em",padding:"8px 12px"},children:[e.jsx(vt,{size:16,style:{marginRight:"5px"}})," Back to List"]})]}),e.jsxs("p",{style:{marginBottom:"15px",fontSize:"1em"},children:[e.jsx("strong",{children:"Tests Ordered:"})," ",(p.tests||[]).map(j=>j.name).join(", ")]}),e.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6",border:"1px solid #eee",padding:"15px",borderRadius:"4px",background:"#fff"},children:e.jsx(xa,{remarkPlugins:[Ln],children:p.report_content||"*No findings recorded.*"})})]}):e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:n.map(j=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>x(j),tabIndex:0,onKeyPress:N=>N.key==="Enter"&&x(j),style:{marginBottom:"15px",cursor:"pointer",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(hs,{size:24,style:{marginRight:"15px",color:"#007bff"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:["Order Date: ",jr(new Date(j.createdAt),"PPP")]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:["Tests: ",j.tests&&j.tests.length>0?j.tests.map(N=>N.name).join(", "):"N/A"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[j.status&&e.jsx("span",{className:NR(j.status),children:vR(j.status)}),e.jsx(Ul,{size:20,style:{color:"#6c757d"}})]})]},j.id))})})]})})},vR=t=>{if(!t)return"Unknown";switch(t.toLowerCase()){case"pending":return"Pending Sample";case"collected":return"Sample Collected";case"processing":return"Processing";case"report_ready":return"Report Ready";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return t.charAt(0).toUpperCase()+t.slice(1)}},NR=t=>{if(!t)return"status-badge";switch(t.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}},M1=()=>{const t=ot(),[s]=xw(),n=s.get("search")||"",[r,o]=y.useState("pharmacy");return Ra(void 0,300),e.jsxs("div",{className:"inventory-management-container",style:{padding:"20px",backgroundColor:"var(--background-color)",minHeight:"100vh"},children:[e.jsxs("div",{className:"inventory-header",style:{marginBottom:"20px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("button",{onClick:()=>t(-1),className:"action-icon-button",title:"Go Back",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-primary)"},children:e.jsx(vt,{size:24})}),e.jsx("h1",{style:{margin:0,fontSize:"1.8rem",fontWeight:"700",color:"var(--text-primary)"},children:"Inventory Management"})]}),e.jsxs("div",{className:"inventory-tabs",style:{display:"flex",gap:"5px",backgroundColor:"var(--card-bg, #f3f4f6)",padding:"5px",borderRadius:"12px",border:"1px solid var(--border-color, #e5e7eb)"},children:[e.jsxs("button",{onClick:()=>o("pharmacy"),style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 24px",border:"1px solid",borderColor:r==="pharmacy"?"var(--primary-color-20, #e0e7ff)":"transparent",borderRadius:"8px",backgroundColor:r==="pharmacy"?"var(--card-bg-active, #fff)":"transparent",boxShadow:r==="pharmacy"?"0 2px 4px rgba(0,0,0,0.05)":"none",color:r==="pharmacy"?"var(--primary-color)":"var(--text-secondary, #6b7280)",fontWeight:r==="pharmacy"?"600":"500",cursor:"pointer",transition:"all 0.2s ease",fontSize:"0.95rem"},children:[e.jsx(vr,{size:18}),"Pharmacy Stock"]}),e.jsxs("button",{onClick:()=>o("lab"),style:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 24px",border:"1px solid",borderColor:r==="lab"?"var(--primary-color-20, #e0e7ff)":"transparent",borderRadius:"8px",backgroundColor:r==="lab"?"var(--card-bg-active, #fff)":"transparent",boxShadow:r==="lab"?"0 2px 4px rgba(0,0,0,0.05)":"none",color:r==="lab"?"var(--primary-color)":"var(--text-secondary, #6b7280)",fontWeight:r==="lab"?"600":"500",cursor:"pointer",transition:"all 0.2s ease",fontSize:"0.95rem"},children:[e.jsx(Ga,{size:18}),"Lab Stock"]})]})]}),e.jsx("div",{className:"inventory-content",style:{backgroundColor:"var(--card-bg, #fff)",borderRadius:"16px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",overflow:"hidden"},children:r==="pharmacy"?e.jsx(zv,{isEmbedded:!0,initialSearch:n}):e.jsx(Of,{isEmbedded:!0})})]})},wR=({fetchWithAuth:t})=>{const s=ot(),[n,r]=y.useState(!0),[o,u]=y.useState([]),[c,d]=y.useState(null),[p,m]=y.useState(null),f=y.useCallback(async()=>{r(!0),d(null);try{const N=await(await t("/staff")).json();u(N.map(k=>({...k,id:k._id||k.id})))}catch(j){d(`Failed to load staff data: ${j.message}`),u([])}finally{r(!1)}},[t]);y.useEffect(()=>{f()},[f]),y.useEffect(()=>{if(p){const j=setTimeout(()=>m(null),5e3);return()=>clearTimeout(j)}},[p]);const g=j=>{switch(j){case"doctor":return"admin-pill-info";case"receptionist":return"admin-pill-success";case"pharmacy":return"admin-pill-primary";case"lab":return"admin-pill-warning";case"admin":return"admin-pill-neutral";default:return"admin-pill-neutral"}},x=j=>{switch(j){case"doctor":return e.jsx(o0,{size:16,className:"mr-2 text-blue-600"});case"receptionist":return e.jsx(mf,{size:16,className:"mr-2 text-green-600"});case"pharmacy":return e.jsx(vr,{size:16,className:"mr-2 text-purple-600"});case"lab":return e.jsx(Ga,{size:16,className:"mr-2 text-yellow-600"});case"admin":return e.jsx(Id,{size:16,className:"mr-2 text-teal-600"});default:return e.jsx(Bl,{size:16,className:"mr-2 text-gray-500"})}};return n?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-50",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"loading-animation-container",style:{height:"auto",margin:"20px 0"},children:[" ",e.jsx("div",{className:"breathing-ball",style:{width:"30px",height:"30px"}})," "]}),e.jsx("div",{className:"mt-4 text-teal-600 text-xl font-medium",children:"Loading Staff..."})]})}):e.jsxs("div",{className:"staff-page-container",children:[p&&e.jsxs("div",{className:`mb-4 p-3 rounded-md flex items-center ${p.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,role:"alert",children:[p.type==="success"?e.jsx(aa,{size:18,className:"mr-2"}):e.jsx(pn,{size:18,className:"mr-2"}),e.jsx("span",{children:p.message}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto text-xl font-bold",children:""})]}),c&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",role:"alert",children:[e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),c,e.jsx("button",{onClick:()=>d(null),className:"ml-auto text-red-600 hover:text-red-800 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s(-1),className:"p-2 rounded-md hover:bg-gray-200",children:e.jsx(vt,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Staff"})]}),e.jsxs("button",{onClick:()=>s("/dashboard/staff/add"),className:"bg-teal-600 text-white px-4 py-2 rounded-md hover:bg-teal-700 flex items-center",children:[e.jsx(Ia,{size:16,className:"mr-2"})," Add New Staff"]})]}),e.jsx("div",{className:"staff-table-container",children:e.jsxs("table",{className:"staff-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{className:"hidden md:table-cell",children:"OPD Fee ()"}),e.jsx("th",{className:"hidden md:table-cell",children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.length===0&&!n?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:"No staff members found."})}):o.map(j=>e.jsxs("tr",{children:[e.jsx("td",{children:j.name}),e.jsx("td",{className:"hidden md:table-cell",children:j.email}),e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g(j.role)}`,children:[x(j.role),j.role.charAt(0).toUpperCase()+j.role.slice(1)]})}),e.jsx("td",{className:"hidden md:table-cell",children:j.role==="doctor"?j.opd_fee?parseFloat(String(j.opd_fee)).toFixed(2):"Not Set":"N/A"}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${j.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.status==="active"?"Active":"Inactive"})}),e.jsx("td",{className:"actions",children:e.jsxs("button",{onClick:()=>s(`/dashboard/staff/edit/${j.id}`),className:"edit-link",disabled:j.role==="admin",title:"Edit Staff",children:[e.jsx(ds,{size:16})," Edit"]})})]},j.id))})]})})]})},SR=()=>{var k,D,_,T,E,U,X,I,F,B,G,C,A,P;const{patientId:t,billId:s}=Qn(),n=ot(),[r,o]=y.useState(null),[u,c]=y.useState(!0),[d,p]=y.useState(null),[m,f]=y.useState(""),[g,x]=y.useState("cash"),j=((k=r==null?void 0:r.patient)==null?void 0:k.insurance_type)==="no_cash_insurance";y.useEffect(()=>{x(j?"no_cash_insurance":"cash")},[j]),y.useEffect(()=>{s?(async()=>{c(!0),p(null);try{const J=await ae(`/api/bills/${s}`);if(!J.ok)throw new Error(`HTTP error! status: ${J.status}`);const R=await J.json();if(!R||!R.bill||!R.calculated)throw new Error("Incomplete data structure received from backend (missing bill or calculated fields).");if(R.bill.type!=="admission")throw console.error("Fetched bill is not an admission bill. Bill Type:",R.bill.type),new Error(`Unexpected bill type received: ${R.bill.type}. Expected 'admission'.`);console.log("Raw API data received:",JSON.stringify(R,null,2));const L=Array.isArray(R.admissionPayments)?R.admissionPayments:[];console.log("Processed admissionPaymentsData:",L);const M={...R.bill,amount:R.bill.amount,AdmissionPayments:L,calculated:R.calculated,patient:R.bill.Patient?{id:R.bill.Patient.id,name:R.bill.Patient.name,admission_date:R.bill.Patient.admission_date,discharge_date:R.bill.Patient.discharge_date}:void 0};console.log("Setting billDetails state to:",JSON.stringify(M,null,2)),o(M)}catch(J){console.error("Failed to fetch admission bill details:",J),p(J instanceof Error?J.message:"An unknown error occurred")}finally{c(!1)}})():(p("Bill ID is missing."),c(!1))},[s,t]);const N=async $=>{var J;if($.preventDefault(),!t||!m||isNaN(parseFloat(m))||parseFloat(m)<=0||parseFloat(m)>(((J=r==null?void 0:r.calculated)==null?void 0:J.balance)??0)){p("Please enter a valid payment amount within the balance due. Patient ID must be present.");return}p(null);try{const R=await ae(`/api/patients/${t}/admission-payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_paid:parseFloat(m),payment_mode:g})});if(!R.ok){const Z=await R.json();throw new Error(Z.message||`HTTP error! status: ${R.status}`)}const M=await(await ae(`/api/bills/${s}`)).json();if(M&&M.bill&&M.calculated&&M.admissionPayments)o({...M.bill,amount:parseFloat(M.bill.amount),AdmissionPayments:M.admissionPayments,calculated:M.calculated,patient:M.bill.Patient?{id:M.bill.Patient.id,name:M.bill.Patient.name,admission_date:M.bill.Patient.admission_date,discharge_date:M.bill.Patient.discharge_date}:void 0});else throw new Error("Invalid data structure received after payment submission.");f("")}catch(R){console.error("Failed to submit payment:",R),p(R instanceof Error?R.message:"Failed to record payment")}};return u?e.jsx("div",{className:"p-4",children:"Loading admission bill details..."}):d?e.jsxs("div",{className:"p-4 text-red-600",children:["Error: ",d]}):!r||!r.calculated?e.jsx("div",{className:"p-4",children:"No bill details found or data is incomplete."}):e.jsx("div",{className:"admission-page-container",children:e.jsxs("div",{className:"admission-section",children:[" ",e.jsxs("div",{className:"p-4 border-b",children:[" ",e.jsxs("h2",{className:"admission-header",children:["Admission Billing Details (Bill #",r.id,")"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Patient: ",((D=r.patient)==null?void 0:D.name)??"N/A"," (ID: ",r.patient_id,")"]})," ",e.jsxs("p",{className:"text-sm text-gray-600",children:["Admission Date: ",(_=r.patient)!=null&&_.admission_date?new Date(r.patient.admission_date).toLocaleDateString():"N/A"]}),((T=r.patient)==null?void 0:T.discharge_date)&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Discharge Date: ",new Date(r.patient.discharge_date).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm",children:["Status: ",e.jsx("span",{className:`font-semibold ${r.status==="paid"?"text-green-600":"text-orange-600"}`,children:((E=r.status)==null?void 0:E.toUpperCase())??"UNKNOWN"})]})]}),e.jsxs("div",{className:"p-4",children:[" ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"admission-card",children:[e.jsx("h3",{className:"admission-card-title",children:"Billing Summary"}),e.jsxs("div",{className:"admission-card-content",children:[e.jsxs("p",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Initial Charges:"})," ",e.jsxs("span",{children:["",(parseFloat((r==null?void 0:r.amount)||"0")||0).toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Days Stayed:"})," ",e.jsx("span",{children:((U=r==null?void 0:r.calculated)==null?void 0:U.daysStayed)??0})]}),e.jsxs("p",{className:"flex justify-between text-sm font-semibold mt-2 pt-2 border-t",children:[e.jsx("span",{children:"Total Due:"})," ",e.jsxs("span",{children:["",(Number((X=r==null?void 0:r.calculated)==null?void 0:X.totalDue)||0).toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between text-sm text-green-700",children:[e.jsx("span",{children:"Total Paid:"})," ",e.jsxs("span",{children:["",(Number((I=r==null?void 0:r.calculated)==null?void 0:I.totalPaid)||0).toFixed(2)]})]}),e.jsxs("p",{className:"flex justify-between text-lg font-bold mt-1 text-red-600",children:[e.jsx("span",{children:"Balance Due:"})," ",e.jsxs("span",{children:["",(Number((F=r==null?void 0:r.calculated)==null?void 0:F.balance)||0).toFixed(2)]})]})]})]}),(r==null?void 0:r.status)!=="paid"&&(Number((B=r==null?void 0:r.calculated)==null?void 0:B.balance)||0)>0&&e.jsxs("div",{className:"admission-card",children:[e.jsx("h3",{className:"admission-card-title text-blue-800",children:"Record New Payment"}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"admission-form-group",children:[e.jsx("label",{htmlFor:"paymentAmount",className:"admission-label",children:"Amount Paid ()"}),e.jsx("input",{id:"paymentAmount",type:"number",value:m,onChange:$=>f($.target.value),placeholder:`Max ${(Number((G=r==null?void 0:r.calculated)==null?void 0:G.balance)||0).toFixed(2)}`,required:!0,min:"0.01",step:"0.01",max:Number((C=r==null?void 0:r.calculated)==null?void 0:C.balance)||0,className:"admission-input"})]}),e.jsxs("div",{className:"admission-form-group",children:[e.jsx("label",{htmlFor:"paymentMode",className:"admission-label",children:"Payment Mode"}),e.jsxs("select",{id:"paymentMode",value:g,onChange:$=>x($.target.value),className:"admission-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"upi",children:"UPI"}),j&&e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})]}),e.jsx("button",{type:"submit",className:"admission-button",disabled:u||!m||parseFloat(m)<=0||parseFloat(m)>(Number((A=r==null?void 0:r.calculated)==null?void 0:A.balance)||0)||j&&g!=="no_cash_insurance",children:"Record Payment"})]})]})]}),e.jsx("h3",{className:"admission-section-title mt-6 border-t pt-4",children:"Admission Payment History"}),Array.isArray(r==null?void 0:r.AdmissionPayments)&&r.AdmissionPayments.length>0?e.jsxs("div",{className:"overflow-x-auto",children:[" ",e.jsxs("table",{className:"admission-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Payment ID"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Mode"})]})}),e.jsx("tbody",{children:(P=r==null?void 0:r.AdmissionPayments)==null?void 0:P.map($=>{if(!$||typeof $!="object")return null;let J="Invalid Date";try{$.payment_date&&!isNaN(new Date($.payment_date).getTime())&&(J=new Date($.payment_date).toLocaleString())}catch(R){console.error("Error formatting payment date:",$.payment_date,R)}return e.jsxs("tr",{children:[" ",e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:$.id??"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:J}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:["",(Number($.amount_paid)||0).toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 capitalize",children:$.payment_mode??"N/A"})]},$.id??Math.random())})})]})]}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No payments recorded yet."})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 text-right",children:[" ",e.jsx("button",{type:"button",onClick:()=>n(-1),className:"admission-button admission-button-secondary",children:"Back"})]})]})})};var kR=Object.defineProperty,Ed=Object.getOwnPropertySymbols,B1=Object.prototype.hasOwnProperty,U1=Object.prototype.propertyIsEnumerable,Jj=(t,s,n)=>s in t?kR(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,of=(t,s)=>{for(var n in s||(s={}))B1.call(s,n)&&Jj(t,n,s[n]);if(Ed)for(var n of Ed(s))U1.call(s,n)&&Jj(t,n,s[n]);return t},cf=(t,s)=>{var n={};for(var r in t)B1.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&Ed)for(var r of Ed(t))s.indexOf(r)<0&&U1.call(t,r)&&(n[r]=t[r]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var kr;(t=>{const s=class Dt{constructor(p,m,f,g){if(this.version=p,this.errorCorrectionLevel=m,this.modules=[],this.isFunction=[],p<Dt.MIN_VERSION||p>Dt.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=p*4+17;let x=[];for(let N=0;N<this.size;N++)x.push(!1);for(let N=0;N<this.size;N++)this.modules.push(x.slice()),this.isFunction.push(x.slice());this.drawFunctionPatterns();const j=this.addEccAndInterleave(f);if(this.drawCodewords(j),g==-1){let N=1e9;for(let k=0;k<8;k++){this.applyMask(k),this.drawFormatBits(k);const D=this.getPenaltyScore();D<N&&(g=k,N=D),this.applyMask(k)}}o(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(p,m){const f=t.QrSegment.makeSegments(p);return Dt.encodeSegments(f,m)}static encodeBinary(p,m){const f=t.QrSegment.makeBytes(p);return Dt.encodeSegments([f],m)}static encodeSegments(p,m,f=1,g=40,x=-1,j=!0){if(!(Dt.MIN_VERSION<=f&&f<=g&&g<=Dt.MAX_VERSION)||x<-1||x>7)throw new RangeError("Invalid value");let N,k;for(N=f;;N++){const E=Dt.getNumDataCodewords(N,m)*8,U=c.getTotalBits(p,N);if(U<=E){k=U;break}if(N>=g)throw new RangeError("Data too long")}for(const E of[Dt.Ecc.MEDIUM,Dt.Ecc.QUARTILE,Dt.Ecc.HIGH])j&&k<=Dt.getNumDataCodewords(N,E)*8&&(m=E);let D=[];for(const E of p){n(E.mode.modeBits,4,D),n(E.numChars,E.mode.numCharCountBits(N),D);for(const U of E.getData())D.push(U)}o(D.length==k);const _=Dt.getNumDataCodewords(N,m)*8;o(D.length<=_),n(0,Math.min(4,_-D.length),D),n(0,(8-D.length%8)%8,D),o(D.length%8==0);for(let E=236;D.length<_;E^=253)n(E,8,D);let T=[];for(;T.length*8<D.length;)T.push(0);return D.forEach((E,U)=>T[U>>>3]|=E<<7-(U&7)),new Dt(N,m,T,x)}getModule(p,m){return 0<=p&&p<this.size&&0<=m&&m<this.size&&this.modules[m][p]}getModules(){return this.modules}drawFunctionPatterns(){for(let f=0;f<this.size;f++)this.setFunctionModule(6,f,f%2==0),this.setFunctionModule(f,6,f%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const p=this.getAlignmentPatternPositions(),m=p.length;for(let f=0;f<m;f++)for(let g=0;g<m;g++)f==0&&g==0||f==0&&g==m-1||f==m-1&&g==0||this.drawAlignmentPattern(p[f],p[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(p){const m=this.errorCorrectionLevel.formatBits<<3|p;let f=m;for(let x=0;x<10;x++)f=f<<1^(f>>>9)*1335;const g=(m<<10|f)^21522;o(g>>>15==0);for(let x=0;x<=5;x++)this.setFunctionModule(8,x,r(g,x));this.setFunctionModule(8,7,r(g,6)),this.setFunctionModule(8,8,r(g,7)),this.setFunctionModule(7,8,r(g,8));for(let x=9;x<15;x++)this.setFunctionModule(14-x,8,r(g,x));for(let x=0;x<8;x++)this.setFunctionModule(this.size-1-x,8,r(g,x));for(let x=8;x<15;x++)this.setFunctionModule(8,this.size-15+x,r(g,x));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let p=this.version;for(let f=0;f<12;f++)p=p<<1^(p>>>11)*7973;const m=this.version<<12|p;o(m>>>18==0);for(let f=0;f<18;f++){const g=r(m,f),x=this.size-11+f%3,j=Math.floor(f/3);this.setFunctionModule(x,j,g),this.setFunctionModule(j,x,g)}}drawFinderPattern(p,m){for(let f=-4;f<=4;f++)for(let g=-4;g<=4;g++){const x=Math.max(Math.abs(g),Math.abs(f)),j=p+g,N=m+f;0<=j&&j<this.size&&0<=N&&N<this.size&&this.setFunctionModule(j,N,x!=2&&x!=4)}}drawAlignmentPattern(p,m){for(let f=-2;f<=2;f++)for(let g=-2;g<=2;g++)this.setFunctionModule(p+g,m+f,Math.max(Math.abs(g),Math.abs(f))!=1)}setFunctionModule(p,m,f){this.modules[m][p]=f,this.isFunction[m][p]=!0}addEccAndInterleave(p){const m=this.version,f=this.errorCorrectionLevel;if(p.length!=Dt.getNumDataCodewords(m,f))throw new RangeError("Invalid argument");const g=Dt.NUM_ERROR_CORRECTION_BLOCKS[f.ordinal][m],x=Dt.ECC_CODEWORDS_PER_BLOCK[f.ordinal][m],j=Math.floor(Dt.getNumRawDataModules(m)/8),N=g-j%g,k=Math.floor(j/g);let D=[];const _=Dt.reedSolomonComputeDivisor(x);for(let E=0,U=0;E<g;E++){let X=p.slice(U,U+k-x+(E<N?0:1));U+=X.length;const I=Dt.reedSolomonComputeRemainder(X,_);E<N&&X.push(0),D.push(X.concat(I))}let T=[];for(let E=0;E<D[0].length;E++)D.forEach((U,X)=>{(E!=k-x||X>=N)&&T.push(U[E])});return o(T.length==j),T}drawCodewords(p){if(p.length!=Math.floor(Dt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let m=0;for(let f=this.size-1;f>=1;f-=2){f==6&&(f=5);for(let g=0;g<this.size;g++)for(let x=0;x<2;x++){const j=f-x,k=(f+1&2)==0?this.size-1-g:g;!this.isFunction[k][j]&&m<p.length*8&&(this.modules[k][j]=r(p[m>>>3],7-(m&7)),m++)}}o(m==p.length*8)}applyMask(p){if(p<0||p>7)throw new RangeError("Mask value out of range");for(let m=0;m<this.size;m++)for(let f=0;f<this.size;f++){let g;switch(p){case 0:g=(f+m)%2==0;break;case 1:g=m%2==0;break;case 2:g=f%3==0;break;case 3:g=(f+m)%3==0;break;case 4:g=(Math.floor(f/3)+Math.floor(m/2))%2==0;break;case 5:g=f*m%2+f*m%3==0;break;case 6:g=(f*m%2+f*m%3)%2==0;break;case 7:g=((f+m)%2+f*m%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[m][f]&&g&&(this.modules[m][f]=!this.modules[m][f])}}getPenaltyScore(){let p=0;for(let x=0;x<this.size;x++){let j=!1,N=0,k=[0,0,0,0,0,0,0];for(let D=0;D<this.size;D++)this.modules[x][D]==j?(N++,N==5?p+=Dt.PENALTY_N1:N>5&&p++):(this.finderPenaltyAddHistory(N,k),j||(p+=this.finderPenaltyCountPatterns(k)*Dt.PENALTY_N3),j=this.modules[x][D],N=1);p+=this.finderPenaltyTerminateAndCount(j,N,k)*Dt.PENALTY_N3}for(let x=0;x<this.size;x++){let j=!1,N=0,k=[0,0,0,0,0,0,0];for(let D=0;D<this.size;D++)this.modules[D][x]==j?(N++,N==5?p+=Dt.PENALTY_N1:N>5&&p++):(this.finderPenaltyAddHistory(N,k),j||(p+=this.finderPenaltyCountPatterns(k)*Dt.PENALTY_N3),j=this.modules[D][x],N=1);p+=this.finderPenaltyTerminateAndCount(j,N,k)*Dt.PENALTY_N3}for(let x=0;x<this.size-1;x++)for(let j=0;j<this.size-1;j++){const N=this.modules[x][j];N==this.modules[x][j+1]&&N==this.modules[x+1][j]&&N==this.modules[x+1][j+1]&&(p+=Dt.PENALTY_N2)}let m=0;for(const x of this.modules)m=x.reduce((j,N)=>j+(N?1:0),m);const f=this.size*this.size,g=Math.ceil(Math.abs(m*20-f*10)/f)-1;return o(0<=g&&g<=9),p+=g*Dt.PENALTY_N4,o(0<=p&&p<=2568888),p}getAlignmentPatternPositions(){if(this.version==1)return[];{const p=Math.floor(this.version/7)+2,m=this.version==32?26:Math.ceil((this.version*4+4)/(p*2-2))*2;let f=[6];for(let g=this.size-7;f.length<p;g-=m)f.splice(1,0,g);return f}}static getNumRawDataModules(p){if(p<Dt.MIN_VERSION||p>Dt.MAX_VERSION)throw new RangeError("Version number out of range");let m=(16*p+128)*p+64;if(p>=2){const f=Math.floor(p/7)+2;m-=(25*f-10)*f-55,p>=7&&(m-=36)}return o(208<=m&&m<=29648),m}static getNumDataCodewords(p,m){return Math.floor(Dt.getNumRawDataModules(p)/8)-Dt.ECC_CODEWORDS_PER_BLOCK[m.ordinal][p]*Dt.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][p]}static reedSolomonComputeDivisor(p){if(p<1||p>255)throw new RangeError("Degree out of range");let m=[];for(let g=0;g<p-1;g++)m.push(0);m.push(1);let f=1;for(let g=0;g<p;g++){for(let x=0;x<m.length;x++)m[x]=Dt.reedSolomonMultiply(m[x],f),x+1<m.length&&(m[x]^=m[x+1]);f=Dt.reedSolomonMultiply(f,2)}return m}static reedSolomonComputeRemainder(p,m){let f=m.map(g=>0);for(const g of p){const x=g^f.shift();f.push(0),m.forEach((j,N)=>f[N]^=Dt.reedSolomonMultiply(j,x))}return f}static reedSolomonMultiply(p,m){if(p>>>8||m>>>8)throw new RangeError("Byte out of range");let f=0;for(let g=7;g>=0;g--)f=f<<1^(f>>>7)*285,f^=(m>>>g&1)*p;return o(f>>>8==0),f}finderPenaltyCountPatterns(p){const m=p[1];o(m<=this.size*3);const f=m>0&&p[2]==m&&p[3]==m*3&&p[4]==m&&p[5]==m;return(f&&p[0]>=m*4&&p[6]>=m?1:0)+(f&&p[6]>=m*4&&p[0]>=m?1:0)}finderPenaltyTerminateAndCount(p,m,f){return p&&(this.finderPenaltyAddHistory(m,f),m=0),m+=this.size,this.finderPenaltyAddHistory(m,f),this.finderPenaltyCountPatterns(f)}finderPenaltyAddHistory(p,m){m[0]==0&&(p+=this.size),m.pop(),m.unshift(p)}};s.MIN_VERSION=1,s.MAX_VERSION=40,s.PENALTY_N1=3,s.PENALTY_N2=3,s.PENALTY_N3=40,s.PENALTY_N4=10,s.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],s.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=s;function n(d,p,m){if(p<0||p>31||d>>>p)throw new RangeError("Value out of range");for(let f=p-1;f>=0;f--)m.push(d>>>f&1)}function r(d,p){return(d>>>p&1)!=0}function o(d){if(!d)throw new Error("Assertion error")}const u=class hn{constructor(p,m,f){if(this.mode=p,this.numChars=m,this.bitData=f,m<0)throw new RangeError("Invalid argument");this.bitData=f.slice()}static makeBytes(p){let m=[];for(const f of p)n(f,8,m);return new hn(hn.Mode.BYTE,p.length,m)}static makeNumeric(p){if(!hn.isNumeric(p))throw new RangeError("String contains non-numeric characters");let m=[];for(let f=0;f<p.length;){const g=Math.min(p.length-f,3);n(parseInt(p.substring(f,f+g),10),g*3+1,m),f+=g}return new hn(hn.Mode.NUMERIC,p.length,m)}static makeAlphanumeric(p){if(!hn.isAlphanumeric(p))throw new RangeError("String contains unencodable characters in alphanumeric mode");let m=[],f;for(f=0;f+2<=p.length;f+=2){let g=hn.ALPHANUMERIC_CHARSET.indexOf(p.charAt(f))*45;g+=hn.ALPHANUMERIC_CHARSET.indexOf(p.charAt(f+1)),n(g,11,m)}return f<p.length&&n(hn.ALPHANUMERIC_CHARSET.indexOf(p.charAt(f)),6,m),new hn(hn.Mode.ALPHANUMERIC,p.length,m)}static makeSegments(p){return p==""?[]:hn.isNumeric(p)?[hn.makeNumeric(p)]:hn.isAlphanumeric(p)?[hn.makeAlphanumeric(p)]:[hn.makeBytes(hn.toUtf8ByteArray(p))]}static makeEci(p){let m=[];if(p<0)throw new RangeError("ECI assignment value out of range");if(p<128)n(p,8,m);else if(p<16384)n(2,2,m),n(p,14,m);else if(p<1e6)n(6,3,m),n(p,21,m);else throw new RangeError("ECI assignment value out of range");return new hn(hn.Mode.ECI,0,m)}static isNumeric(p){return hn.NUMERIC_REGEX.test(p)}static isAlphanumeric(p){return hn.ALPHANUMERIC_REGEX.test(p)}getData(){return this.bitData.slice()}static getTotalBits(p,m){let f=0;for(const g of p){const x=g.mode.numCharCountBits(m);if(g.numChars>=1<<x)return 1/0;f+=4+x+g.bitData.length}return f}static toUtf8ByteArray(p){p=encodeURI(p);let m=[];for(let f=0;f<p.length;f++)p.charAt(f)!="%"?m.push(p.charCodeAt(f)):(m.push(parseInt(p.substring(f+1,f+3),16)),f+=2);return m}};u.NUMERIC_REGEX=/^[0-9]*$/,u.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,u.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let c=u;t.QrSegment=u})(kr||(kr={}));(t=>{(s=>{const n=class{constructor(o,u){this.ordinal=o,this.formatBits=u}};n.LOW=new n(0,1),n.MEDIUM=new n(1,0),n.QUARTILE=new n(2,3),n.HIGH=new n(3,2),s.Ecc=n})(t.QrCode||(t.QrCode={}))})(kr||(kr={}));(t=>{(s=>{const n=class{constructor(o,u){this.modeBits=o,this.numBitsCharCount=u}numCharCountBits(o){return this.numBitsCharCount[Math.floor((o+7)/17)]}};n.NUMERIC=new n(1,[10,12,14]),n.ALPHANUMERIC=new n(2,[9,11,13]),n.BYTE=new n(4,[8,16,16]),n.KANJI=new n(8,[8,10,12]),n.ECI=new n(7,[0,0,0]),s.Mode=n})(t.QrSegment||(t.QrSegment={}))})(kr||(kr={}));var Pl=kr;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var CR={L:Pl.QrCode.Ecc.LOW,M:Pl.QrCode.Ecc.MEDIUM,Q:Pl.QrCode.Ecc.QUARTILE,H:Pl.QrCode.Ecc.HIGH},q1=128,H1="L",V1="#FFFFFF",G1="#000000",Q1=!1,Y1=1,_R=4,DR=0,ER=.1;function J1(t,s=0){const n=[];return t.forEach(function(r,o){let u=null;r.forEach(function(c,d){if(!c&&u!==null){n.push(`M${u+s} ${o+s}h${d-u}v1H${u+s}z`),u=null;return}if(d===r.length-1){if(!c)return;u===null?n.push(`M${d+s},${o+s} h1v1H${d+s}z`):n.push(`M${u+s},${o+s} h${d+1-u}v1H${u+s}z`);return}c&&u===null&&(u=d)})}),n.join("")}function X1(t,s){return t.slice().map((n,r)=>r<s.y||r>=s.y+s.h?n:n.map((o,u)=>u<s.x||u>=s.x+s.w?o:!1))}function TR(t,s,n,r){if(r==null)return null;const o=t.length+n*2,u=Math.floor(s*ER),c=o/s,d=(r.width||u)*c,p=(r.height||u)*c,m=r.x==null?t.length/2-d/2:r.x*c,f=r.y==null?t.length/2-p/2:r.y*c,g=r.opacity==null?1:r.opacity;let x=null;if(r.excavate){let N=Math.floor(m),k=Math.floor(f),D=Math.ceil(d+m-N),_=Math.ceil(p+f-k);x={x:N,y:k,w:D,h:_}}const j=r.crossOrigin;return{x:m,y:f,h:p,w:d,excavation:x,opacity:g,crossOrigin:j}}function AR(t,s){return s!=null?Math.max(Math.floor(s),0):t?_R:DR}function K1({value:t,level:s,minVersion:n,includeMargin:r,marginSize:o,imageSettings:u,size:c,boostLevel:d}){let p=en.useMemo(()=>{const N=(Array.isArray(t)?t:[t]).reduce((k,D)=>(k.push(...Pl.QrSegment.makeSegments(D)),k),[]);return Pl.QrCode.encodeSegments(N,CR[s],n,void 0,void 0,d)},[t,s,n,d]);const{cells:m,margin:f,numCells:g,calculatedImageSettings:x}=en.useMemo(()=>{let j=p.getModules();const N=AR(r,o),k=j.length+N*2,D=TR(j,c,N,u);return{cells:j,margin:N,numCells:k,calculatedImageSettings:D}},[p,c,u,r,o]);return{qrcode:p,margin:f,cells:m,numCells:g,calculatedImageSettings:x}}var PR=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),Ml=en.forwardRef(function(s,n){const r=s,{value:o,size:u=q1,level:c=H1,bgColor:d=V1,fgColor:p=G1,includeMargin:m=Q1,minVersion:f=Y1,boostLevel:g,marginSize:x,imageSettings:j}=r,k=cf(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:D}=k,_=cf(k,["style"]),T=j==null?void 0:j.src,E=en.useRef(null),U=en.useRef(null),X=en.useCallback(J=>{E.current=J,typeof n=="function"?n(J):n&&(n.current=J)},[n]),[I,F]=en.useState(!1),{margin:B,cells:G,numCells:C,calculatedImageSettings:A}=K1({value:o,level:c,minVersion:f,boostLevel:g,includeMargin:m,marginSize:x,imageSettings:j,size:u});en.useEffect(()=>{if(E.current!=null){const J=E.current,R=J.getContext("2d");if(!R)return;let L=G;const M=U.current,Z=A!=null&&M!==null&&M.complete&&M.naturalHeight!==0&&M.naturalWidth!==0;Z&&A.excavation!=null&&(L=X1(G,A.excavation));const Q=window.devicePixelRatio||1;J.height=J.width=u*Q;const S=u/C*Q;R.scale(S,S),R.fillStyle=d,R.fillRect(0,0,C,C),R.fillStyle=p,PR?R.fill(new Path2D(J1(L,B))):G.forEach(function(ge,fe){ge.forEach(function(w,ue){w&&R.fillRect(ue+B,fe+B,1,1)})}),A&&(R.globalAlpha=A.opacity),Z&&R.drawImage(M,A.x+B,A.y+B,A.w,A.h)}}),en.useEffect(()=>{F(!1)},[T]);const P=of({height:u,width:u},D);let $=null;return T!=null&&($=en.createElement("img",{src:T,key:T,style:{display:"none"},onLoad:()=>{F(!0)},ref:U,crossOrigin:A==null?void 0:A.crossOrigin})),en.createElement(en.Fragment,null,en.createElement("canvas",of({style:P,height:u,width:u,ref:X,role:"img"},_)),$)});Ml.displayName="QRCodeCanvas";var IR=en.forwardRef(function(s,n){const r=s,{value:o,size:u=q1,level:c=H1,bgColor:d=V1,fgColor:p=G1,includeMargin:m=Q1,minVersion:f=Y1,boostLevel:g,title:x,marginSize:j,imageSettings:N}=r,k=cf(r,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:D,cells:_,numCells:T,calculatedImageSettings:E}=K1({value:o,level:c,minVersion:f,boostLevel:g,includeMargin:m,marginSize:j,imageSettings:N,size:u});let U=_,X=null;N!=null&&E!=null&&(E.excavation!=null&&(U=X1(_,E.excavation)),X=en.createElement("image",{href:N.src,height:E.h,width:E.w,x:E.x+D,y:E.y+D,preserveAspectRatio:"none",opacity:E.opacity,crossOrigin:E.crossOrigin}));const I=J1(U,D);return en.createElement("svg",of({height:u,width:u,viewBox:`0 0 ${T} ${T}`,ref:n,role:"img"},k),!!x&&en.createElement("title",null,x),en.createElement("path",{fill:d,d:`M0,0 h${T}v${T}H0z`,shapeRendering:"crispEdges"}),en.createElement("path",{fill:p,d:I,shapeRendering:"crispEdges"}),X)});IR.displayName="QRCodeSVG";const OR=t=>{switch(t){case"pending":return{text:"text-orange-700",bg:"bg-orange-100"};case"billed":return{text:"text-blue-700",bg:"bg-blue-100"};case"dispensed":return{text:"text-green-700",bg:"bg-green-100"};case"cancelled":return{text:"text-red-700",bg:"bg-red-100"};default:return{text:"text-gray-600",bg:"bg-gray-100"}}},zR=()=>{const{orderId:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState(!0),[c,d]=y.useState(null),[p,m]=y.useState(!1),[f,g]=y.useState({}),[x,j]=y.useState(""),[N,k]=y.useState(""),[D,_]=y.useState("cash"),T=y.useMemo(()=>(n==null?void 0:n.medications.reduce((A,P)=>{const $=P.total_price??0,J=$*(P.discount_percentage??0)/100;return A+$-J},0))??0,[n==null?void 0:n.medications]),E=5,U=y.useMemo(()=>!n||!n.medications?0:n.medications.reduce((A,P,$)=>{var Q,S;const J=P.drug_id??`index-${$}`,R=((Q=f[J])==null?void 0:Q.pack)||0,L=((S=f[J])==null?void 0:S.loose)||0,M=P.pack_price??0,Z=P.loose_price??0;return A+R*M+L*Z},0),[n,f]),X=y.useCallback(async()=>{if(!t){d("Order ID is missing."),u(!1);return}u(!0),d(null);try{const A=await ae(`/api/pharmacy-orders/${t}`);if(!A.ok)throw A.status===404?new Error(`Order with ID ${t} not found.`):new Error(`Failed to fetch order details: ${A.statusText} (${A.status})`);const P=await A.json();console.log("Fetched order data after return:",P);const J=P.medications.map(L=>L.pack_price&&L.loose_price&&L.loose_price>0?{...L,unitsPerPack:Math.round(L.pack_price/L.loose_price)}:{...L,unitsPerPack:0}).map(L=>({...L,discount_percentage:L.discount_percentage??0}));r({...P,medications:J});const R={};J.forEach((L,M)=>{const Z=L.drug_id??`index-${M}`;R[Z]={pack:0,loose:0}}),g(R)}catch(A){console.error("Failed to fetch order details:",A),d(A.message||"Failed to load order details.")}finally{u(!1)}},[t]);y.useEffect(()=>{X()},[X]),y.useEffect(()=>{(async()=>{try{const P=await ae("/api/clinics/settings");if(!P.ok)throw new Error("Failed to fetch clinic settings");const $=await P.json();console.log("Fetched clinic settings:",$),j($.upi_id||"")}catch(P){console.error("Error fetching clinic settings:",P)}})()},[]),y.useEffect(()=>{if((n==null?void 0:n.order_total)!==void 0&&n.order_total>0&&x){const A=`upi://pay?pa=${x}&pn=ClinicName&am=${n.order_total.toFixed(2)}&cu=INR`;k(A)}else k("")},[n==null?void 0:n.order_total,x]);const I=(A,P)=>{r($=>{if(!$)return null;const J=$.medications.map((L,M)=>(L.drug_id??`index-${M}`)===A?{...L,discount_percentage:isNaN(P)?0:P}:L),R=J.reduce((L,M)=>{const Z=M.total_price??0,Q=Z*(M.discount_percentage??0)/100;return L+Z-Q},0);return{...$,medications:J,order_total:R}})},F=(A,P,$)=>{g(J=>{const R=$.unitsPerPack||0,M=$.pack_quantity*R+$.loose_quantity,Z=Math.max(0,Math.min(P,M));let Q=0,S=Z;return R>0&&(Q=Math.floor(Z/R),S=Z%R),{...J,[A]:{pack:Q,loose:S}}})},B=async()=>{const A=n==null?void 0:n.medications.map((P,$)=>{var M,Z;const J=P.drug_id??`index-${$}`,R=((M=f[J])==null?void 0:M.pack)||0,L=((Z=f[J])==null?void 0:Z.loose)||0;return R>0||L>0?{drug_id:P.drug_id,name:P.name,pack_quantity:P.pack_quantity,loose_quantity:P.loose_quantity,returnPackQuantity:R,returnLooseQuantity:L}:null}).filter(P=>P!==null);if(!A||A.length===0){alert("Please select a quantity greater than 0 for at least one item to return.");return}if(!t){alert("Order ID is missing. Cannot process return.");return}if(!A){alert("Could not prepare items for return.");return}m(!0),d(null);try{const P=await ae(`/api/pharmacy-orders/${t}/return`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemsToReturn:A})}),$=await P.json();if(!P.ok)throw new Error($.message||`Failed to process return: ${P.statusText}`);alert("Return processed successfully! Stock has been updated.");const J={};n==null||n.medications.forEach((R,L)=>{const M=R.drug_id??`index-${L}`;J[M]={pack:0,loose:0}}),g(J),X()}catch(P){console.error("Failed to process return:",P),d(P.message||"An error occurred while processing the return."),alert(`Error processing return: ${P.message||"Unknown error"}`)}finally{m(!1)}};if(o)return e.jsx("div",{className:"text-center p-6 text-gray-500 animate-pulse",children:"Loading Order Details..."});if(c)return e.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>s(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(vt,{size:14,className:"mr-1.5"})," Back"]}),e.jsxs("div",{className:"bg-red-50 border border-red-300 text-red-700 rounded p-4",children:["Error: ",c]})]});if(!n)return e.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>s(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(vt,{size:14,className:"mr-1.5"})," Back"]}),e.jsx("div",{className:"text-center py-10 px-4 text-gray-500 bg-white rounded-lg shadow",children:"Order details could not be loaded."})]});const G=()=>{window.print()},C=OR(n.status);return e.jsx("div",{className:"pharmacy-order-details-page",children:e.jsxs("div",{className:"order-details-container printable-section",children:[e.jsxs("div",{className:"order-details-header no-print",children:[e.jsx("h1",{children:"Pharmacy Order Details"}),e.jsxs("div",{className:"actions",children:[e.jsxs("button",{onClick:()=>s(-1),className:"back-button",children:[e.jsx(vt,{size:18})," Back to Queue"]}),e.jsxs("button",{onClick:G,className:"print-button",children:[e.jsx(ls,{size:18})," Print Bill"]})]})]}),e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{children:"Mahajan Pharmacy"}),e.jsxs("div",{className:"clinic-details-print",children:[e.jsx("span",{className:"small-text clinic-address",children:"D.No: 3-1-289, Plot No. 101, Kabela Center, RR Nagar, Vijayawada  520012."}),e.jsx("span",{className:"small-text clinic-notes",children:"Phone: 93919 44733"}),e.jsx("span",{className:"small-text clinic-license",children:"Licence No:RLF20AP2025003328"})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Patient Name:"})," RESHMA"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Token:"})," 12"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Order Date:"})," 31/10/2025"]})]})]}),e.jsxs("div",{className:"order-info-section no-print",children:[e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Order ID:"})," ",n.id]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Patient:"})," ",n.patientName||"N/A"," (",n.patientTokenNumber||"N/A",")"]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Date:"})," ",new Date(n.date).toLocaleString()]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Prescribed By:"})," ",n.prescribedBy||"N/A"]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`status-pill ${C.text} ${C.bg}`,children:n.status})]})]}),e.jsxs("div",{className:"medications-section",children:[e.jsx("h2",{children:"Medications Ordered"}),n.medications.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"PACK QTY"}),e.jsx("th",{children:"PACK PRICE"}),e.jsx("th",{children:"LOOSE QTY"}),e.jsx("th",{children:"LOOSE PRICE"}),e.jsx("th",{children:"MRP"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"GST%"}),e.jsx("th",{children:"AMT"}),(n.status==="dispensed"||n.status==="billed")&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"no-print",children:"RETURN PACK QTY"}),e.jsx("th",{className:"no-print",children:"RETURN LOOSE QTY"})]})]})}),e.jsx("tbody",{children:n.medications.map((A,P)=>{var Q,S,ge,fe,w,ue;const $=A.drug_id??`index-${P}`,J=A.total_price??0,R=J*(A.discount_percentage??0)/100,L=J-R,M=((Q=f[$])==null?void 0:Q.pack)||0,Z=((S=f[$])==null?void 0:S.loose)||0;return e.jsxs("tr",{children:[e.jsx("td",{children:A.name}),e.jsx("td",{children:A.pack_quantity??0}),e.jsx("td",{children:((ge=A.pack_price)==null?void 0:ge.toFixed(2))??"N/A"}),e.jsx("td",{children:A.loose_quantity??0}),e.jsx("td",{children:((fe=A.loose_price)==null?void 0:fe.toFixed(2))??"N/A"}),e.jsx("td",{children:((w=A.price)==null?void 0:w.toFixed(2))??"N/A"})," ",e.jsx("td",{children:((ue=A.price)==null?void 0:ue.toFixed(2))??"N/A"})," ",e.jsxs("td",{children:[e.jsx("input",{type:"number",value:A.discount_percentage??0,onChange:Ne=>I($,parseFloat(Ne.target.value)),min:"0",max:"100",className:"discount-input-table no-print"}),e.jsxs("span",{className:"print-only",children:[A.discount_percentage??0,"%"]})]}),e.jsxs("td",{children:[E.toFixed(1),"%"]}),e.jsx("td",{children:L.toFixed(2)}),(n.status==="dispensed"||n.status==="billed")&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"no-print",children:e.jsx("input",{type:"number",min:"0",max:A.pack_quantity,value:M,onChange:Ne=>{const Y=(parseInt(Ne.target.value,10)||0)*(A.unitsPerPack||0)+Z;F($,Y,A)},className:"return-quantity-input"})}),e.jsx("td",{className:"no-print",children:e.jsx("input",{type:"number",min:"0",max:A.loose_quantity+A.pack_quantity*(A.unitsPerPack||0)-M*(A.unitsPerPack||0),value:Z,onChange:Ne=>{const K=parseInt(Ne.target.value,10)||0,Y=M*(A.unitsPerPack||0)+K;F($,Y,A)},className:"return-quantity-input"})})]})]},$)})})]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No medications listed for this order."})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",T.toFixed(2)]})}),e.jsxs("div",{className:"order-total-section no-print",children:[e.jsx("span",{className:"total-label",children:"Order Total:"}),e.jsxs("span",{className:"total-amount",children:["",T.toFixed(2)]})]}),e.jsxs("div",{className:"payment-section no-print",children:[e.jsxs("div",{className:"payment-mode-group",children:[e.jsx("label",{htmlFor:"paymentMode",children:"Payment Mode:"}),e.jsxs("select",{id:"paymentMode",value:D,onChange:A=>_(A.target.value),className:"payment-mode-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),N&&e.jsxs("div",{className:"qr-code-container",children:[e.jsx(Ml,{value:N,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]})]}),(n.status==="dispensed"||n.status==="billed")&&n.medications.length>0&&e.jsxs("div",{className:"return-action-section no-print",children:[U>0&&e.jsxs("div",{className:"total-refund-display",children:["Total Refund: ",U.toFixed(2)]}),e.jsx("button",{onClick:B,disabled:Object.values(f).every(A=>A.pack===0&&A.loose===0)||p,className:"process-return-button",children:p?e.jsxs(e.Fragment,{children:[e.jsx(Ip,{size:16,className:"mr-2 animate-spin"})," Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ip,{size:16,className:"mr-2"})," Process Return"]})})]})]})})},RR=async()=>{const t=await ae("/subscriptions");if(!t.ok)throw new Error("Failed to fetch subscription plans");return await t.json()},LR=async t=>{const s=await ae(`/subscriptions/${t}`);if(!s.ok){const n=await s.json().catch(()=>({message:"Failed to fetch subscription plan details"}));throw new Error(n.message||"Failed to fetch subscription plan details")}return await s.json()},$R=async t=>{const s=await ae("/subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const n=await s.json().catch(()=>({message:"Failed to create subscription plan"}));throw new Error(n.message||"Failed to create subscription plan")}return await s.json()},FR=async(t,s)=>{const n=await ae(`/subscriptions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){const r=await n.json().catch(()=>({message:"Failed to update subscription plan"}));throw new Error(r.message||"Failed to update subscription plan")}return await n.json()},MR=async t=>{const s=await ae(`/subscriptions/${t}`,{method:"DELETE"});if(!s.ok){const n=await s.json().catch(()=>({message:"Failed to deactivate subscription plan"}));throw new Error(n.message||"Failed to deactivate subscription plan")}return await s.json()},BR=async(t,s)=>{const n=await ae("/api/payment/razorpay-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:t,planId:s})});if(!n.ok){const r=await n.json().catch(()=>({message:"Failed to initiate Razorpay subscription"}));throw new Error(r.message||"Failed to initiate Razorpay subscription")}return await n.json()},UR=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(null),m=y.useCallback(async()=>{o(!0),c(null);try{const g=await RR();n(g)}catch(g){c(g.message||"Failed to fetch subscription plans."),p({type:"error",message:g.message||"Failed to fetch plans."})}finally{o(!1)}},[]);y.useEffect(()=>{m()},[m]),y.useEffect(()=>{if(d){const g=setTimeout(()=>p(null),5e3);return()=>clearTimeout(g)}},[d]);const f=async g=>{if(p(null),c(null),window.confirm("Are you sure you want to deactivate this plan? This action cannot be undone directly.")){o(!0),c(null),p(null);try{await MR(g),p({type:"success",message:"Plan deactivated successfully!"}),m()}catch(x){c(x.message||"Failed to deactivate plan."),p({type:"error",message:x.message||"Failed to deactivate plan."})}finally{o(!1)}}};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(aa,{size:18,className:"mr-2 text-green-500"}):e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>p(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(vt,{size:16}),"Back"]}),e.jsx("h1",{children:"Manage Subscription Plans"}),e.jsxs("button",{onClick:()=>t("/dashboard/subscriptions/add"),className:"subscription-btn",children:[e.jsx(Ia,{size:16,className:"mr-1 inline-block"})," Add New Plan"]})]}),r&&s.length===0&&e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"loading-animation-container",style:{height:"auto",margin:"20px 0"},children:e.jsx("div",{className:"breathing-ball",style:{width:"25px",height:"25px"}})}),e.jsx("div",{className:"mt-2 text-gray-600 text-md font-medium",children:"Loading plans..."})]})}),!r&&u&&s.length===0&&e.jsx("p",{className:"text-center text-red-500",children:u}),s.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:g.name}),e.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),e.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),e.jsx("td",{children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),e.jsxs("td",{className:"actions-cell text-right",children:[e.jsx("button",{onClick:()=>t(`/dashboard/subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:e.jsx(ds,{size:16,className:"inline-block"})}),g.status==="active"&&e.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:r,children:e.jsx(on,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!r&&s.length===0&&!u&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No subscription plans found. Add one to get started!"})]})]})},qR=()=>{const t=ot(),[s,n]=y.useState({name:"",description:"",price:"",period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(null);y.useEffect(()=>{if(d){const x=setTimeout(()=>p(null),5e3);return()=>clearTimeout(x)}},[d]);const m=x=>{const{name:j,value:N}=x.target;n(k=>({...k,[j]:N}))},f=async x=>{if(x.preventDefault(),o(!0),c(null),p(null),!s.name||!s.price||!s.period||s.interval===void 0||s.interval<=0){c("Please fill in all required fields (Name, Price, Period, Interval > 0)."),o(!1);return}try{await $R(s),p({type:"success",message:"Plan created successfully! Redirecting..."}),setTimeout(()=>{t("/dashboard/subscriptions")},2e3)}catch(j){const N=j.message||"Failed to create plan.";c(N),p({type:"error",message:N})}finally{o(!1)}},g=()=>{t(-1)};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(aa,{size:18,className:"mr-2 text-green-500"}):e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>p(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Add New Subscription Plan"}),u&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:u}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:s.description||"",onChange:m})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:s.price||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:s.period||"monthly",onChange:m,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:s.interval||1,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:s.razorpay_plan_id||"",onChange:m})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:r,className:"subscription-btn",children:[r?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,r?"Creating...":"Create Plan"]})]})]})]})]})},HR=()=>{const{id:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState({}),[c,d]=y.useState(!1),[p,m]=y.useState(!0),[f,g]=y.useState(null),[x,j]=y.useState(null),N=y.useCallback(async()=>{if(!t){g("Plan ID is missing."),m(!1);return}m(!0),g(null);try{const T=await LR(t);r(T),u({name:T.name,description:T.description||"",price:T.price,period:T.period,interval:T.interval,razorpay_plan_id:T.razorpay_plan_id||"",status:T.status})}catch(T){g(T.message||"Failed to fetch plan details."),j({type:"error",message:T.message||"Failed to fetch plan details."})}finally{m(!1)}},[t]);y.useEffect(()=>{N()},[N]),y.useEffect(()=>{if(x){const T=setTimeout(()=>j(null),5e3);return()=>clearTimeout(T)}},[x]);const k=T=>{const{name:E,value:U}=T.target;u(X=>({...X,[E]:U}))},D=async T=>{if(T.preventDefault(),!t){g("Plan ID is missing.");return}if(d(!0),g(null),j(null),!o.name||!o.price||!o.period||o.interval===void 0||o.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),d(!1);return}try{await FR(t,o),j({type:"success",message:"Plan updated successfully! Redirecting..."}),setTimeout(()=>{s(-1)},2e3)}catch(E){const U=E.message||"Failed to update plan.";g(U),j({type:"error",message:U})}finally{d(!1)}},_=()=>{s(-1)};return p?e.jsx("div",{className:"p-6 text-center",children:"Loading plan details..."}):f&&!n?e.jsx("div",{className:"p-6 text-center text-red-500",children:f}):n?e.jsxs("div",{className:"subscription-page-container",children:[x&&e.jsxs("div",{className:`${x.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[x.type==="success"?e.jsx(aa,{size:18,className:"mr-2"}):e.jsx(pn,{size:18,className:"mr-2"}),e.jsx("span",{children:x.message})]}),e.jsx("button",{onClick:()=>j(null),className:"ml-4",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Edit Subscription Plan"}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:o.name||"",onChange:k,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:o.description||"",onChange:k})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:o.price||"",onChange:k,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:o.period||"monthly",onChange:k,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:o.interval||1,onChange:k,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:o.razorpay_plan_id||"",onChange:k})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:o.status||"active",onChange:k,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:_,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:c,className:"subscription-btn",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,c?"Saving...":"Save Changes"]})]})]})]})]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Plan not found."})},VR=()=>{const{patientId:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState([]),[c,d]=y.useState(""),[p,m]=y.useState(!0),[f,g]=y.useState(null),[x,j]=y.useState("manual"),[N,k]=y.useState(!1),[D,_]=y.useState(null),T=y.useCallback(async()=>{m(!0),g(null);try{const X=await ae(`/api/patients/${t}`);if(!X.ok){const G=await X.json();throw new Error(G.message||"Failed to fetch patient details")}const I=await X.json();r(I);const F=await ae("/api/subscriptions");if(!F.ok){const G=await F.json();throw new Error(G.message||"Failed to fetch subscription plans")}const B=await F.json();u(B.filter(G=>G.status==="active"))}catch(X){console.error("Error fetching data:",X),g(`Failed to load data: ${X.message}`)}finally{m(!1)}},[t]);y.useEffect(()=>{t?T():(g("Patient ID is missing."),m(!1))},[t,T]);const E=(X,I)=>{const F=new Date(X),B=I.interval||1;switch(I.period){case"daily":F.setDate(X.getDate()+B);break;case"weekly":F.setDate(X.getDate()+B*7);break;case"monthly":F.setMonth(X.getMonth()+B);break;case"yearly":F.setFullYear(X.getFullYear()+B);break;default:console.warn(`Unknown subscription period: ${I.period}. Defaulting to 1 month.`),F.setMonth(X.getMonth()+1)}return F},U=async()=>{if(!t||!c){_("Please select a subscription plan.");return}const X=o.find(I=>I.id===c);if(!X){_("Selected plan details not found.");return}k(!0),_(null);try{const I=new Date,F=E(I,X);if(x==="manual"){const B={subscription_plan_id:c,subscription_status:"active",subscription_start_date:I.toISOString(),subscription_end_date:F.toISOString(),subscription_payment_method:"manual"},G=await ae(`/api/patients/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(!G.ok){const C=await G.json();throw new Error(C.message||"Failed to start subscription manually")}alert(`Subscription started successfully for ${n==null?void 0:n.name} (Manual Payment)!`),s("/all-patients")}else if(x==="razorpay"){console.log("Initiating Razorpay subscription for plan:",X);const B=await BR(t,c);if(B&&B.short_url)window.location.href=B.short_url;else throw new Error("Failed to get Razorpay subscription link from backend.")}}catch(I){console.error("Error starting subscription:",I),_(`Failed to start subscription: ${I.message}`),k(!1)}};return p?e.jsx("div",{className:"loading-state-subscription",children:"Loading patient and plans..."}):f?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:f})]}),e.jsxs("button",{onClick:()=>s(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16})," ","Back"]})]}):n?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("button",{onClick:()=>s(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16})," ","Back"]}),e.jsxs("h1",{children:[e.jsx(Oa,{size:28})," ","Start Subscription for ",n.name]}),D&&e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[" ",e.jsx("span",{children:D})]}),e.jsxs("div",{className:"subscription-form",children:[" ",e.jsx("h2",{children:"Available Subscription Plans"}),o.length===0?e.jsx("p",{className:"empty-state",children:"No active subscription plans found."}):e.jsx("div",{className:"subscription-plan-list",children:o.map(X=>e.jsxs("div",{className:`subscription-plan-card ${c===X.id?"selected-plan":""}`,onClick:()=>d(X.id),children:[e.jsx("h3",{children:X.name}),e.jsxs("p",{className:"price",children:["",X.price]}),e.jsxs("p",{className:"duration",children:["Every ",X.interval," ",X.period,X.interval>1?"s":""]}),X.description&&e.jsx("p",{children:X.description})]},X.id))})]}),e.jsxs("div",{className:"subscription-form mb-6",children:[" ",e.jsx("h2",{children:"Select Payment Method"}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"manual",checked:x==="manual",onChange:()=>j("manual"),className:"mr-2"}),e.jsx("span",{children:"Cash (Manual)"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:x==="razorpay",onChange:()=>j("razorpay"),className:"mr-2"}),e.jsx("span",{children:"Razorpay"})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:U,disabled:!c||N||o.length===0,className:"subscription-btn",children:[N&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),N?"Starting...":"Start Subscription"]})})]}):e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Warning: "}),e.jsx("span",{children:"Patient not found."})]}),e.jsxs("button",{onClick:()=>s(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16}),"Back"]})]})},Kf=async()=>{const t=await ae("/api/clinic-subscriptions/plans",{method:"GET"});if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to fetch clinic subscription plans")}return t.json()},GR=async t=>{const s=await ae(`/api/clinic-subscriptions/cancel/${t}`,{method:"PUT"});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to cancel clinic subscription")}return s.json()},QR=async t=>{const s=await ae(`/api/clinics/${t}/subscription-status`,{method:"GET"});if(!s.ok){const n=await s.json();throw new Error(n.message||`Failed to fetch subscription status for clinic ${t}`)}return s.json()},YR=async t=>{const s=await ae(`/api/clinic-subscriptions/plans/${t}`,{method:"GET"});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to fetch clinic subscription plan")}return s.json()},JR=async t=>{const s=await ae("/api/clinic-subscriptions/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to create clinic subscription plan")}return s.json()},XR=async(t,s)=>{const n=await ae(`/api/clinic-subscriptions/plans/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!n.ok){const r=await n.json();throw new Error(r.message||"Failed to update clinic subscription plan")}return n.json()},KR=async t=>{const s=await ae(`/api/clinic-subscriptions/plans/${t}`,{method:"DELETE"});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to deactivate clinic subscription plan")}return s.json()},WR=async t=>{const s=await ae("/api/clinic-subscriptions/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:t})});if(!s.ok){const n=await s.json();throw new Error(n.message||"Failed to initiate clinic subscription")}return s.json()},ZR=async()=>{try{const t=await ae("/api/clinic-subscriptions/pending",{method:"GET"});return t.ok?t.json():null}catch(t){return console.error("Error checking for pending subscription:",t),null}},eL=async()=>{const t=await ae("/api/clinics/subscription-status",{method:"GET"});if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to fetch clinic subscription status")}return t.json()},tL=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(null),m=y.useCallback(async()=>{o(!0),c(null);try{const g=await Kf();n(g)}catch(g){c(g.message||"Failed to fetch clinic subscription plans."),p({type:"error",message:g.message||"Failed to fetch plans."})}finally{o(!1)}},[]);y.useEffect(()=>{m()},[m]),y.useEffect(()=>{if(d){const g=setTimeout(()=>p(null),5e3);return()=>clearTimeout(g)}},[d]);const f=async g=>{if(p(null),c(null),window.confirm("Are you sure you want to deactivate this clinic plan? This action cannot be undone directly.")){o(!0),c(null),p(null);try{await KR(g),p({type:"success",message:"Clinic plan deactivated successfully!"}),m()}catch(x){c(x.message||"Failed to deactivate clinic plan."),p({type:"error",message:x.message||"Failed to deactivate plan."})}finally{o(!1)}}};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(aa,{size:18,className:"mr-2 text-green-500"}):e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>p(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 rounded-md hover:bg-gray-200",children:e.jsx(vt,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Clinic Subscription Plans"})]}),e.jsxs("button",{onClick:()=>t("/dashboard/clinic-subscriptions/add"),className:"subscription-btn",children:[e.jsx(Ia,{size:16,className:"mr-1 inline-block"})," Add New Clinic Plan"]})]}),r&&s.length===0&&e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"loading-animation-container",style:{height:"auto",margin:"20px 0"},children:e.jsx("div",{className:"breathing-ball",style:{width:"25px",height:"25px"}})}),e.jsx("div",{className:"mt-2 text-gray-600 text-md font-medium",children:"Loading clinic plans..."})]})}),!r&&u&&s.length===0&&e.jsx("p",{className:"text-center text-red-500",children:u}),s.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:s.map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:g.name}),e.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),e.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),e.jsx("td",{children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),e.jsxs("td",{className:"actions-cell text-right",children:[e.jsx("button",{onClick:()=>t(`/dashboard/clinic-subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:e.jsx(ds,{size:16,className:"inline-block"})}),g.status==="active"&&e.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:r,children:e.jsx(on,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!r&&s.length===0&&!u&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No clinic subscription plans found. Add one to get started!"})]})]})},nL=()=>{const t=ot(),[s,n]=y.useState({name:"",description:"",price:0,period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[r,o]=y.useState(!1),[u,c]=y.useState(null),[d,p]=y.useState(null);y.useEffect(()=>{if(d){const x=setTimeout(()=>p(null),5e3);return()=>clearTimeout(x)}},[d]);const m=x=>{const{name:j,value:N,type:k}=x.target;n(D=>({...D,[j]:k==="number"?parseFloat(N):N}))},f=async x=>{if(x.preventDefault(),o(!0),c(null),p(null),!s.name||!s.price||!s.period||s.interval===void 0||s.interval<=0){c("Please fill in all required fields (Name, Price, Period, Interval > 0)."),o(!1);return}try{await JR(s),p({type:"success",message:"Clinic plan created successfully! Redirecting..."}),setTimeout(()=>{t("/dashboard/clinic-subscriptions")},2e3)}catch(j){const N=j.message||"Failed to create clinic plan.";c(N),p({type:"error",message:N})}finally{o(!1)}},g=()=>{t(-1)};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(aa,{size:18,className:"mr-2 text-green-500"}):e.jsx(pn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>p(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Add New Clinic Subscription Plan"}),u&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:u}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:s.description||"",onChange:m})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:s.price||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:s.period||"monthly",onChange:m,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:s.interval||1,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:s.razorpay_plan_id||"",onChange:m})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:r,className:"subscription-btn",children:[r?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,r?"Creating...":"Create Plan"]})]})]})]})]})},aL=()=>{const{id:t}=Qn(),s=ot(),[n,r]=y.useState(null),[o,u]=y.useState({}),[c,d]=y.useState(!1),[p,m]=y.useState(!0),[f,g]=y.useState(null),[x,j]=y.useState(null),N=y.useCallback(async()=>{if(!t){g("Plan ID is missing."),m(!1);return}m(!0),g(null);try{const T=await YR(t);r(T),u({name:T.name,description:T.description||"",price:Number(T.price),period:T.period,interval:Number(T.interval),razorpay_plan_id:T.razorpay_plan_id||"",status:T.status})}catch(T){g(T.message||"Failed to fetch clinic plan details."),j({type:"error",message:T.message||"Failed to fetch plan details."})}finally{m(!1)}},[t]);y.useEffect(()=>{N()},[N]),y.useEffect(()=>{if(x){const T=setTimeout(()=>j(null),5e3);return()=>clearTimeout(T)}},[x]);const k=T=>{const{name:E,value:U,type:X}=T.target;u(I=>({...I,[E]:X==="number"?parseFloat(U):U}))},D=async T=>{if(T.preventDefault(),!t){g("Plan ID is missing.");return}if(d(!0),g(null),j(null),!o.name||!o.price||!o.period||o.interval===void 0||o.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),d(!1);return}try{await XR(t,o),j({type:"success",message:"Clinic plan updated successfully! Redirecting..."}),setTimeout(()=>{s(-1)},2e3)}catch(E){const U=E.message||"Failed to update clinic plan.";g(U),j({type:"error",message:U})}finally{d(!1)}},_=()=>{s(-1)};return p?e.jsx("div",{className:"p-6 text-center",children:"Loading clinic plan details..."}):f&&!n?e.jsx("div",{className:"p-6 text-center text-red-500",children:f}):n?e.jsxs("div",{className:"subscription-page-container",children:[x&&e.jsxs("div",{className:`${x.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[x.type==="success"?e.jsx(aa,{size:18,className:"mr-2"}):e.jsx(pn,{size:18,className:"mr-2"}),e.jsx("span",{children:x.message})]}),e.jsx("button",{onClick:()=>j(null),className:"ml-4",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Edit Clinic Subscription Plan"}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:o.name||"",onChange:k,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:o.description||"",onChange:k})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:o.price!==void 0?o.price:"",onChange:k,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:o.period||"monthly",onChange:k,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:o.interval!==void 0?o.interval:"",onChange:k,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:o.razorpay_plan_id||"",onChange:k})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:o.status||"active",onChange:k,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:_,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:c,className:"subscription-btn",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,c?"Saving...":"Save Changes"]})]})]})]})]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Clinic plan not found."})},sL=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(""),[u,c]=y.useState(!0),[d,p]=y.useState(null),[m,f]=y.useState(!1),[g,x]=y.useState(null),j=y.useCallback(async()=>{p(null);try{const D=(await Kf()).filter(_=>_.status==="active");n(D),D.length>0&&!r&&o(D[0].id)}catch(k){console.error("Error fetching plans:",k),p(`Failed to load subscription plans: ${k.message}`)}},[]);y.useEffect(()=>{(async()=>{c(!0);try{const D=await ZR();if(D&&D.short_url){window.location.href=D.short_url,p("You have a pending subscription. Redirecting to payment...");return}await j()}catch(D){console.error("Error during initial page load:",D),p(`An unexpected error occurred: ${D.message}`)}finally{c(!1)}})()},[j]);const N=async()=>{if(!r){x("Please select a clinic subscription plan.");return}const k=s.find(D=>D.id===r);if(!k){x("Selected plan details not found.");return}f(!0),x(null);try{console.log("Initiating Razorpay clinic subscription for plan:",k);const D=await WR(r);if(D&&D.short_url)window.location.href=D.short_url;else throw new Error("Failed to get Razorpay clinic subscription link from backend.")}catch(D){console.error("Error starting clinic subscription:",D),x(`Failed to start clinic subscription: ${D.message}`),f(!1)}};return u?e.jsx("div",{className:"loading-state-subscription",children:"Loading clinic plans..."}):d?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:d})]}),e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16}),"Back"]})]}):e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(vt,{size:16}),"Back"]}),e.jsxs("h1",{children:[e.jsx(Gw,{size:28}),"Buy Pro Plan for Clinic"]}),g&&e.jsx("div",{className:"error-alert-subscription",role:"alert",children:e.jsx("span",{children:g})}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h2",{children:"Available Pro Plans"}),s.length===0?e.jsx("p",{className:"empty-state",children:"No active clinic subscription plans found."}):e.jsx("div",{className:"subscription-plan-list",children:s.map(k=>e.jsxs("div",{className:`subscription-plan-card ${r===k.id?"selected-plan":""}`,onClick:()=>o(k.id),children:[e.jsx("h3",{children:k.name}),e.jsxs("p",{className:"price",children:["",Number(k.price).toFixed(2)]}),e.jsxs("p",{className:"duration",children:["Every ",k.interval," ",k.period,k.interval>1?"s":""]}),k.description&&e.jsx("p",{children:k.description})]},k.id))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:N,disabled:!r||m||s.length===0,className:"subscription-btn",children:[m&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),m?"Initiating Payment...":"Buy Pro Plan"]})})]})},iL=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(!0),[u,c]=y.useState(null),[d,p]=y.useState(!1),[m,f]=y.useState(!1),[g,x]=y.useState(null),[j,N]=y.useState({name:"",email:"",password:"",role:"user"}),[k,D]=y.useState({name:"",email:"",role:"",password:"",confirmPassword:""}),[_,T]=y.useState(""),[E,U]=y.useState(""),[X,I]=y.useState({}),[F,B]=y.useState(!1),[G,C]=y.useState(null),[A,P]=y.useState([]),[$,J]=y.useState(""),[R,L]=y.useState(!1),[M,Z]=y.useState(null);y.useEffect(()=>{const V=setTimeout(()=>{U(_)},500);return()=>{clearTimeout(V)}},[_]),y.useEffect(()=>{Q(E)},[E]);const Q=async(V="")=>{o(!0);try{const oe=V?`/api/users?search=${encodeURIComponent(V)}`:"/api/users",se=await(await ae(oe)).json();if(n(se),se.length>0){const Ce=[...new Set(se.map(je=>je.clinic_id).filter(je=>!!je))],ee={};await Promise.all(Ce.map(async je=>{try{const Ie=await QR(je);ee[je]=Ie}catch(Ie){console.error(`Failed to fetch subscription status for clinic ${je}`,Ie),ee[je]={hasProPlan:!1}}})),I(ee)}c(null)}catch(oe){c("Failed to fetch users."),console.error(oe)}finally{o(!1)}},S=async V=>{V.preventDefault();try{await ae("/users",{method:"POST",body:JSON.stringify(j)}),p(!1),N({name:"",email:"",password:"",role:"user"}),Q()}catch(oe){c("Failed to add user."),console.error(oe)}},ge=async V=>{if(V.preventDefault(),!g)return;const{password:oe,confirmPassword:Pe,...se}=k,Ce={...se};if(oe){if(oe.length<6){c("Password must be at least 6 characters long.");return}if(oe!==Pe){c("Passwords do not match.");return}Ce.password=oe}try{await ae(`/users/${g.id}`,{method:"PUT",body:JSON.stringify(Ce)}),f(!1),x(null),D({...k,password:"",confirmPassword:""}),Q()}catch(ee){c("Failed to update user."),console.error(ee)}},fe=async V=>{if(window.confirm("Are you sure you want to delete this user?"))try{await ae(`/users/${V}`,{method:"DELETE"}),Q()}catch(oe){c("Failed to delete user."),console.error(oe)}},w=V=>{x(V),D({name:V.name,email:V.email,role:V.role,password:"",confirmPassword:""}),f(!0)},ue=async()=>{L(!0);try{const V=await Kf();P(V),V.length>0&&J(V[0].id),Z(null)}catch(V){Z("Failed to fetch subscription plans."),console.error(V)}finally{L(!1)}},Ne=V=>{C(V),B(!0),ue()},K=async V=>{if(V.preventDefault(),!G||!$){c("Please select a clinic and a plan.");return}try{await ae("/clinic-subscriptions/manual-activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicId:G,planId:$})}),B(!1),C(null),J(""),Q(),c(null)}catch(oe){c("Failed to manually activate clinic subscription."),console.error(oe)}},Y=async V=>{if(window.confirm("Are you sure you want to cancel this clinic's subscription? This action cannot be undone."))try{await GR(V),Q(),c(null)}catch(oe){c("Failed to cancel subscription."),console.error(oe)}};return r?e.jsx("div",{children:"Loading users..."}):u?e.jsx("div",{className:"error-message",children:u}):e.jsxs("div",{className:"user-management-page",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(vt,{size:16}),"Back"]}),e.jsx("h1",{children:"User Management"})]}),e.jsxs("div",{className:"controls-container",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:_,onChange:V=>T(V.target.value),className:"search-input"}),e.jsx("button",{onClick:()=>p(!0),className:"add-user-button",children:"Add New User"})]}),d&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>p(!1),children:""}),e.jsx("h2",{children:"Add New User"}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:j.name,onChange:V=>N({...j,name:V.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:j.email,onChange:V=>N({...j,email:V.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password:"}),e.jsx("input",{type:"password",value:j.password,onChange:V=>N({...j,password:V.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:j.role,onChange:V=>N({...j,role:V.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsx("button",{type:"submit",children:"Add User"})]})]})}),m&&g&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>f(!1),children:""}),e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{onSubmit:ge,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:k.name,onChange:V=>D({...k,name:V.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:k.email,onChange:V=>D({...k,email:V.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:k.role,onChange:V=>D({...k,role:V.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password (optional):"}),e.jsx("input",{type:"password",value:k.password,onChange:V=>D({...k,password:V.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm New Password:"}),e.jsx("input",{type:"password",value:k.confirmPassword,onChange:V=>D({...k,confirmPassword:V.target.value})})]}),e.jsx("button",{type:"submit",children:"Update User"})]})]})}),F&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>B(!1),children:""}),e.jsx("h2",{children:"Select Subscription Plan for Clinic"}),R&&e.jsx("div",{children:"Loading plans..."}),M&&e.jsx("div",{className:"error-message",children:M}),!R&&!M&&A.length===0&&e.jsx("div",{children:"No active subscription plans available."}),!R&&!M&&A.length>0&&e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Plan:"}),e.jsx("select",{value:$,onChange:V=>J(V.target.value),required:!0,children:A.map(V=>e.jsxs("option",{value:V.id,children:[V.name," - $",V.price,"/",V.interval," ",V.period]},V.id))})]}),e.jsx("button",{type:"submit",children:"Activate Selected Plan"})]})]})}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Clinic ID"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(V=>{const oe=V.clinic_id||"N/A",Pe=oe!=="N/A"?X[oe]:null,se=(Pe==null?void 0:Pe.hasProPlan)??!1,Ce=se?"PRO":"Standard";return e.jsxs("tr",{children:[e.jsx("td",{children:V.name}),e.jsx("td",{children:V.email}),e.jsx("td",{children:V.role}),e.jsx("td",{children:oe}),e.jsx("td",{children:oe!=="N/A"?e.jsx("span",{className:se?"pro-badge":"standard-badge",children:Ce}):"N/A"}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>w(V),className:"edit-button",children:"Edit"}),e.jsx("button",{onClick:()=>fe(V.id),className:"delete-button",children:"Delete"}),V.clinic_id&&!se&&e.jsx("button",{onClick:()=>Ne(V.clinic_id),className:"start-subscription-button",children:"Start Subscription"}),V.clinic_id&&se&&e.jsx("button",{onClick:()=>Y(V.clinic_id),className:"cancel-subscription-button",children:"Cancel Subscription"})]})]},V.id)})})]})]})},rL="_modalOverlay_1spz3_3",lL="_modalContent_1spz3_29",oL="_modalHeader_1spz3_53",cL="_modalTitle_1spz3_71",uL="_modalCloseButton_1spz3_83",dL="_modalBody_1spz3_111",hL="_formGroup_1spz3_119",mL="_inputField_1spz3_141",pL="_errorText_1spz3_175",fL="_successText_1spz3_193",gL="_modalFooter_1spz3_211",xL="_button_1spz3_227",yL="_buttonPrimary_1spz3_247",bL="_buttonSecondary_1spz3_265",Vn={modalOverlay:rL,modalContent:lL,modalHeader:oL,modalTitle:cL,modalCloseButton:uL,modalBody:dL,formGroup:hL,inputField:mL,errorText:pL,successText:fL,modalFooter:gL,button:xL,buttonPrimary:yL,buttonSecondary:bL},jL=({isOpen:t,onClose:s})=>{const[n,r]=y.useState(""),[o,u]=y.useState(!1),[c,d]=y.useState(!1),[p,m]=y.useState(null),[f,g]=y.useState(null);Ra(void 0,t?200:99999),y.useEffect(()=>{t&&x()},[t]);const x=async()=>{u(!0),m(null);try{const N=await ae("/api/global-settings/app_gemini_api_key");if(N.ok){const k=await N.json();r(k.value||"")}else N.status}catch(N){console.warn("Could not fetch existing key:",N)}finally{u(!1)}},j=async()=>{d(!0),m(null),g(null);try{if(!(await ae("/api/global-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"app_gemini_api_key",value:n})})).ok)throw new Error("Failed to save API Key");g("API Key updated successfully!"),setTimeout(()=>{s(),g(null)},1500)}catch(N){m(N.message||"Error saving key")}finally{d(!1)}};return t?e.jsx("div",{className:Vn.modalOverlay,children:e.jsxs("div",{className:Vn.modalContent,children:[e.jsxs("div",{className:Vn.modalHeader,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(c0,{size:24}),e.jsx("h3",{className:Vn.modalTitle,children:"App Gemini API Key"})]}),e.jsx("button",{onClick:s,className:Vn.modalCloseButton,children:e.jsx(Et,{size:20})})]}),e.jsxs("div",{className:Vn.modalBody,children:[p&&e.jsx("div",{className:Vn.errorText,children:p}),f&&e.jsx("div",{className:Vn.successText,children:f}),e.jsxs("div",{className:Vn.formGroup,children:[e.jsx("label",{htmlFor:"gemini-key",children:"Gemini API Key"}),e.jsx("input",{type:"text",id:"gemini-key",value:n,onChange:N=>r(N.target.value),className:Vn.inputField,placeholder:"Enter Gemini API Key (AIza...)",disabled:o||c})]}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--secondary-text-color, #666)"},children:"This key will be used as a fallback for all clinics if their specific Gemini API key is not configured."})]}),e.jsxs("div",{className:Vn.modalFooter,children:[e.jsx("button",{onClick:s,className:`${Vn.button} ${Vn.buttonSecondary}`,disabled:c,children:"Cancel"}),e.jsx("button",{onClick:j,className:`${Vn.button} ${Vn.buttonPrimary}`,disabled:c,children:c?"Saving...":"Save Key"})]})]})}):null},vL=()=>{const[t,s]=y.useState(!1);return e.jsxs("div",{className:"admin-panel-container",children:[e.jsxs("h1",{className:"admin-panel-title",children:[e.jsx(Id,{size:32,className:"icon-margin"}),"Super Admin Dashboard"]}),e.jsxs("div",{className:"admin-panel-grid",children:[e.jsxs(us,{to:"/dashboard/clinic-subscriptions",className:"admin-panel-card",children:[e.jsx(Ll,{size:48,className:"card-icon"}),e.jsx("h2",{children:"Manage Clinic Subscription Plans"}),e.jsx("p",{children:"Add, edit, and view clinic subscription plans."})]}),e.jsxs(us,{to:"/dashboard/users",className:"admin-panel-card",children:[e.jsx(Bl,{size:48,className:"card-icon"}),e.jsx("h2",{children:"User Management"}),e.jsx("p",{children:"Add, edit, and delete users; manage user roles."})]}),e.jsxs("div",{className:"admin-panel-card",onClick:()=>s(!0),style:{cursor:"pointer"},children:[e.jsx(c0,{size:48,className:"card-icon"}),e.jsx("h2",{children:"Manage App Gemini API Key"}),e.jsx("p",{children:"Update the fallback Gemini API key used by the application."})]})]}),e.jsx(jL,{isOpen:t,onClose:()=>s(!1)})]})},Dp="tutorialCurrentStep",NL=({onActionComplete:t})=>{const[s,n]=y.useState(!1),[r,o]=y.useState(!1),[u,c]=y.useState(null),d=async()=>{var p,m;n(!0);try{const f=await ae("/api/drugs/import-defaults",{method:"POST"}),g=await f.json();if(f.ok){o(!0);const x=((p=g.details)==null?void 0:p.added)||0,j=((m=g.details)==null?void 0:m.updated)||0,N=`Added: ${x}, Updated: ${j}`;c(N),t(!0,"Default medications imported successfully!","pharmacyImport")}else t(!1,"Failed to import medications.")}catch{t(!1,"Error importing medications.")}finally{n(!1)}};return e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"One click to populate your inventory."}),r?e.jsxs("div",{className:"success-badge flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vd,{size:16})," Imported"]}),u&&e.jsx("span",{className:"text-xs opacity-80 mt-1",children:u})]}):e.jsx("button",{onClick:d,className:"tutorial-button primary",disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Va,{size:18,className:"animate-spin"})," Importing ~80 items..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hf,{size:18})," Import Drugs"]})})]})},wL=({onActionComplete:t})=>{const[s,n]=y.useState(!1),[r,o]=y.useState(!1),[u,c]=y.useState(null),d=async()=>{var p,m;n(!0);try{const f=await ae("/api/lab-tests/import-defaults",{method:"POST"}),g=await f.json();if(f.ok){o(!0);const x=((p=g.details)==null?void 0:p.added)||0,j=((m=g.details)==null?void 0:m.updated)||0,N=`Added: ${x}, Updated: ${j}`;c(N),t(!0,"Default lab tests imported successfully!","labImport")}else t(!1,"Failed to import lab tests.")}catch{t(!1,"Error importing lab tests.")}finally{n(!1)}};return e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"Setup your lab with common tests."}),r?e.jsxs("div",{className:"success-badge flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vd,{size:16})," Imported"]}),u&&e.jsx("span",{className:"text-xs opacity-80 mt-1",children:u})]}):e.jsx("button",{onClick:d,className:"tutorial-button primary",disabled:s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Va,{size:18,className:"animate-spin"})," Importing ~25 items..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ga,{size:18})," Import Tests"]})})]})},SL=({onOpenCommandBar:t})=>e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"Ready to experience the power? Open the command bar to start."}),e.jsx("button",{onClick:t,className:"tutorial-button primary large-button",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Open Command Bar ",e.jsx("span",{className:"shortcut-hint-badge",children:"Ctrl+K"})]})})]}),Ep=[{title:"Welcome to Newtons Ai HMS",description:"Your all-in-one clinic management solution. Let's get your clinic ready in less than 2 minutes.",icon:e.jsx(Qw,{size:48,className:"step-icon welcome"}),component:null,actionText:"Get Started"},{title:"Pharmacy Setup",description:"Start by populating your pharmacy. We can import a standard list of medicines for you.",icon:e.jsx(hf,{size:48,className:"step-icon pharmacy"}),component:NL,actionText:"Next",showSkip:!0},{title:"Lab Configuration",description:"Next, let's set up your lab. Import common lab tests to start generating reports immediately.",icon:e.jsx(Ga,{size:48,className:"step-icon lab"}),component:wL,actionText:"Next",showSkip:!0},{title:"Power at Your Fingertips",description:"The Command Bar is your central hub for everything. Search patients, add orders, or use AI tools instantly.",icon:e.jsx(Yw,{size:48,className:"step-icon ai"}),component:SL,actionText:null,isLast:!0}],kL=({onClose:t,onMarkAsSeen:s})=>{const{openCommandBar:n}=$l(),[r,o]=y.useState(()=>{const D=localStorage.getItem(Dp);return D?parseInt(D,10):0}),[u,c]=y.useState(!1),[d,p]=y.useState(null),[m,f]=y.useState(null);y.useEffect(()=>{localStorage.setItem(Dp,r.toString()),p(null)},[r]);const g=()=>{c(!0),setTimeout(()=>{o(D=>Math.min(D+1,Ep.length-1)),c(!1)},300)},x=(D,_,T)=>{f(D),p(_),D&&(T==="pharmacyImport"||T==="labImport")&&setTimeout(g,1e3)},j=()=>{s(),t(),localStorage.removeItem(Dp)},N=()=>{j(),setTimeout(()=>{n()},100)},k=Ep[r];return e.jsx("div",{className:"tutorial-overlay",children:e.jsxs("div",{className:`tutorial-card ${u?"fade-out":"fade-in"}`,children:[e.jsxs("div",{className:"tutorial-visual",children:[e.jsx("div",{className:"icon-circle",children:k.icon}),e.jsx("div",{className:"step-indicators",children:Ep.map((D,_)=>e.jsx("div",{className:`step-dot ${_===r?"active":""} ${_<r?"completed":""}`},_))})]}),e.jsxs("div",{className:"tutorial-content",children:[e.jsx("button",{className:"close-button",onClick:j,title:"Close Tutorial",children:e.jsx(Et,{size:20})}),e.jsxs("div",{className:"text-content",children:[e.jsx("h2",{children:k.title}),e.jsx("p",{className:"description",children:k.description})]}),e.jsxs("div",{className:"interactive-area",children:[k.component?e.jsx(k.component,{onActionComplete:x,onOpenCommandBar:N}):null,d&&e.jsx("div",{className:`status-message ${m?"success":"error"}`,children:d})]}),e.jsxs("div",{className:"action-footer",children:[k.showSkip&&e.jsx("button",{onClick:g,className:"tutorial-button text-only",children:"Skip for now"}),k.actionText&&e.jsxs("button",{onClick:g,className:"tutorial-button primary",children:[k.actionText," ",e.jsx(Ul,{size:16})]})]})]})]})})},CL=()=>{const[t,s]=y.useState([]),[n,r]=y.useState(!0),[o,u]=y.useState(null),[c,d]=y.useState(""),[p,m]=y.useState(1),[f,g]=y.useState(1),[x,j]=y.useState(0),[N,k]=y.useState(!1),[D,_]=y.useState(void 0),T=10,E=y.useRef(null);Ra();const U=y.useCallback(async(A,P)=>{r(!0),u(null);try{let $=`/api/recurring-medications?page=${A}&limit=${T}`;P&&($+=`&search=${encodeURIComponent(P)}`);const J=await ae($);if(!J.ok)throw new Error("Failed to fetch recurring medications.");const R=await J.json();s(R.medications),g(R.totalPages),j(R.total),m(R.page)}catch($){console.error($),u($.message||"An error occurred while fetching data.")}finally{r(!1)}},[]);y.useEffect(()=>(E.current&&clearTimeout(E.current),E.current=setTimeout(()=>{U(p,c)},500),()=>{E.current&&clearTimeout(E.current)}),[c,p,U]);const X=A=>{d(A.target.value),m(1)},I=A=>{A>=1&&A<=f&&m(A)},F=A=>{_(A),k(!0)},B=()=>{U(p,c),k(!1),_(void 0)},G=A=>A===30?"Every 30 Days (Monthly)":A===15?"Every 15 Days":`Every ${A} Days`,C=A=>{switch(A){case"active":return"status-pill status-pill-active";case"paused":return"status-pill status-pill-paused";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill"}};return e.jsxs("div",{className:"refill-reminders-container",children:[e.jsxs("div",{className:"refill-header",children:[e.jsx("h3",{className:"refill-title",children:"Recurring Medications"}),e.jsxs("div",{className:"refill-actions",children:[e.jsxs("button",{className:"refill-action-button btn-add",onClick:()=>{_(void 0),k(!0)},children:[e.jsx(ya,{size:16})," Add New"]}),e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search patient, phone, medication...",value:c,onChange:X}),e.jsx(mn,{size:18,className:"search-icon"})]})]})]}),o&&e.jsx("div",{className:"error-message-box",children:o}),e.jsx("div",{className:"refill-table-container",children:n?e.jsx("div",{className:"loading-pulse",children:"Loading..."}):t.length===0?e.jsx("div",{className:"empty-state",children:"No recurring medications found."}):e.jsx("div",{className:"refill-grouped-list",children:Object.values(t.reduce((A,P)=>{const $=P.patientId;return A[$]||(A[$]={patientId:P.patientId,patientName:P.patientName,patientPhone:P.patientPhone,patientToken:P.patientToken,medications:[]}),A[$].medications.push(P),A},{})).map(A=>e.jsxs("div",{className:"patient-medication-group-card",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("h4",{className:"patient-name",children:A.patientName}),e.jsxs("span",{className:"patient-meta",children:["Token: ",A.patientToken,"  Phone: ",A.patientPhone]})]}),e.jsx("div",{className:"group-actions"})]}),e.jsxs("table",{className:"refill-table group-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Medication"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Frequency"}),e.jsx("th",{children:"Next Delivery"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:A.medications.map(P=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"med-name",children:P.medicationName}),(P.tabletsPerDay||P.numberOfDays||P.directions)&&e.jsxs("div",{className:"med-usage-details",style:{fontSize:"0.8em",color:"#666"},children:[P.tabletsPerDay&&e.jsxs("span",{children:[P.tabletsPerDay," tabs/day  "]}),P.numberOfDays&&e.jsxs("span",{children:[P.numberOfDays," days "]})]}),P.notes&&e.jsxs("div",{className:"med-notes",children:["Note: ",P.notes]})]}),e.jsx("td",{children:P.quantity}),e.jsx("td",{children:e.jsx("span",{className:"frequency-badge",children:G(P.frequencyDays)})}),e.jsx("td",{children:e.jsx("div",{className:"date-display",children:new Date(P.nextDeliveryDate).toLocaleDateString()})}),e.jsx("td",{children:e.jsx("span",{className:C(P.status),children:P.status})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit",title:"Edit",onClick:()=>F(P),children:e.jsx(ds,{size:16})}),e.jsx("button",{className:"action-btn delete",title:"Delete/Cancel",children:e.jsx(on,{size:16})})]})})]},P.id))})]})]},A.patientId))})}),!n&&f>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("span",{className:"pagination-info",children:["Page ",p," of ",f," (Total ",x,")"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("button",{onClick:()=>I(p-1),disabled:p===1,className:"page-btn",children:[e.jsx(Pd,{size:16})," Prev"]}),e.jsxs("button",{onClick:()=>I(p+1),disabled:p===f,className:"page-btn",children:["Next ",e.jsx(Ul,{size:16})]})]})]}),e.jsx($1,{isOpen:N,onClose:()=>{k(!1),_(void 0)},onSuccess:B,medication:D})]})},_L=()=>{const t=ot(),s=za();return y.useEffect(()=>{const n=new URLSearchParams(s.search),r=n.get("token"),o=n.get("caseDetails");r?(async()=>{try{const c=await ae(`/api/patients?search=${r}&limit=1`);if(!c.ok)throw new Error("Failed to fetch patient by token");const p=(await c.json()).patients[0];if(!p)throw new Error("Patient with the given token not found");const m=await ae(`/api/queue/patient/${p.id}/latest`);if(m.ok){const x=await m.json();if(x!=null&&x._id){t(`/dashboard/edit-complaint/${x._id}`,{state:{initialComplaint:o}});return}}const f=await ae("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:p.id,complaint:o})});if(!f.ok)throw new Error("Failed to create queue entry");const g=await f.json();if(g!=null&&g.id)t(`/dashboard/edit-complaint/${g.id}`,{state:{initialComplaint:o}});else throw new Error("Failed to get ID from new queue entry.")}catch(c){console.error("Error handling complaint URL:",c),t("/dashboard/search-patient")}})():t("/dashboard/search-patient")},[s,t]),e.jsx("div",{children:"Loading..."})},Xj=()=>{const t=ot(),[s,n]=y.useState([]),[r,o]=y.useState(!0),[u,c]=y.useState(null),[d,p]=y.useState(!1),[m,f]=y.useState(!1),[g,x]=y.useState(!1),[j,N]=y.useState(!1),[k,D]=y.useState(!1),[_,T]=y.useState(null),[E,U]=y.useState([]),[X,I]=y.useState(null),[F,B]=y.useState(""),[G,C]=y.useState(""),[A,P]=y.useState(""),[$,J]=y.useState(""),[R,L]=y.useState(""),[M,Z]=y.useState(""),[Q,S]=y.useState(""),[ge,fe]=y.useState(""),[w,ue]=y.useState(""),[Ne,K]=y.useState(""),[Y,V]=y.useState(""),oe=y.useCallback(async()=>{o(!0),c(null);try{const W=await ae("/api/distributors");if(!W.ok)throw new Error(`Failed to fetch distributors: ${W.statusText}`);const O=await W.json();n(O)}catch(W){console.error("Failed to fetch distributors:",W),c(W.message||"Failed to load distributors.")}finally{o(!1)}},[]);y.useEffect(()=>{oe()},[oe]);const Pe=async W=>{W.preventDefault(),c(null);try{const O=await ae("/api/distributors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:F,contact_person:G,phone:A,email:$,address:R,gst_number:M,drug_license_number:Q})});if(!O.ok){const te=await O.json();throw new Error(te.message||"Failed to add distributor.")}alert("Distributor added successfully!"),$e(),oe()}catch(O){console.error("Error adding distributor:",O),c(O.message||"Failed to add distributor.")}},se=async W=>{if(W.preventDefault(),c(null),!!_)try{const O=await ae(`/api/distributors/${_.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:F,contact_person:G,phone:A,email:$,address:R,gst_number:M,drug_license_number:Q})});if(!O.ok){const te=await O.json();throw new Error(te.message||"Failed to update distributor.")}alert("Distributor updated successfully!"),Be(),oe()}catch(O){console.error("Error updating distributor:",O),c(O.message||"Failed to update distributor.")}},Ce=async()=>{if(c(null),!!_)try{const W=await ae(`/api/distributors/${_.id}`,{method:"DELETE"});if(!W.ok){const O=await W.json();throw new Error(O.message||"Failed to delete distributor.")}alert("Distributor deleted successfully!"),et(),oe()}catch(W){console.error("Error deleting distributor:",W),c(W.message||"Failed to delete distributor.")}},ee=y.useCallback(async W=>{c(null);try{const O=await ae(`/api/distributors/${W}/payments`);if(!O.ok)throw new Error(`Failed to fetch payments: ${O.statusText}`);const re=(await O.json()).map(Qe=>({...Qe,order_value:parseFloat(Qe.order_value),amount_paid:parseFloat(Qe.amount_paid),balance_remaining:parseFloat(Qe.balance_remaining)}));U(re);const ke=await ae(`/api/distributors/${W}/balance`);if(!ke.ok)throw new Error(`Failed to fetch balance: ${ke.statusText}`);const Ue=await ke.json();I({totalOrderValue:parseFloat(Ue.totalOrderValue),totalAmountPaid:parseFloat(Ue.totalAmountPaid),remainingBalance:parseFloat(Ue.remainingBalance)})}catch(O){console.error("Error fetching payments/balance:",O),c(O.message||"Failed to load payments or balance.")}},[]),je=async W=>{if(W.preventDefault(),c(null),!!_)try{const O=await ae(`/api/distributors/${_.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:ge,order_value:parseFloat(w||"0"),amount_paid:parseFloat(Ne||"0"),notes:Y})});if(!O.ok){const te=await O.json();throw new Error(te.message||"Failed to add payment.")}alert("Payment added successfully!"),he(),ee(_.id)}catch(O){console.error("Error adding payment:",O),c(O.message||"Failed to add payment.")}},Ie=()=>{B(""),C(""),P(""),J(""),L(""),Z(""),S(""),c(null),p(!0)},$e=()=>{p(!1)},Fe=W=>{T(W),B(W.name),C(W.contact_person||""),P(W.phone||""),J(W.email||""),L(W.address||""),Z(W.gst_number||""),S(W.drug_license_number||""),c(null),f(!0)},Be=()=>{f(!1),T(null)},qe=W=>{T(W),c(null),x(!0)},et=()=>{x(!1),T(null)},ye=W=>{T(W),ee(W.id),c(null),N(!0)},Oe=()=>{N(!1),T(null),U([]),I(null)},xe=W=>{T(W),fe(new Date().toISOString().split("T")[0]),ue("0"),K("0"),V(""),c(null),D(!0)},he=()=>{D(!1),T(null)};return r?e.jsx("div",{className:"loading-indicator",children:"Loading Distributors..."}):u?e.jsxs("div",{className:"error-indicator",children:["Error: ",u]}):e.jsxs("div",{className:"distributor-management-page",children:[e.jsxs("div",{className:"distributor-management-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Go Back",children:[e.jsx(vt,{size:24})," Back"]}),e.jsx("h2",{children:"Distributor Management"})]}),(()=>{const W=s.reduce((te,re)=>te+parseFloat(re.remainingBalance||"0"),0),O=W>=0?"balance-positive":"balance-negative";return e.jsxs("div",{className:`total-balance-display ${O}`,children:[e.jsx("strong",{children:"Total Combined Balance:"})," ",W.toFixed(2)]})})(),e.jsxs("button",{onClick:Ie,className:"add-distributor-button",children:[e.jsx(ya,{size:18}),"Add New Distributor"]})]}),e.jsx("div",{className:"distributor-table-container",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"GST Number"})," ",e.jsx("th",{children:"Drug License Number"})," ",e.jsx("th",{children:"Remaining Balance"})," ",e.jsx("th",{className:"actions-cell",children:"Actions"})]})}),e.jsx("tbody",{children:s.length===0?e.jsxs("tr",{children:[e.jsx("td",{colSpan:9,className:"no-results-message",children:"No distributors found."})," "]}):s.map(W=>e.jsxs("tr",{children:[e.jsx("td",{children:W.name}),e.jsx("td",{children:W.contact_person||"-"}),e.jsx("td",{children:W.phone||"-"}),e.jsx("td",{children:W.email||"-"}),e.jsx("td",{children:W.address||"-"}),e.jsx("td",{children:W.gst_number||"-"})," ",e.jsx("td",{children:W.drug_license_number||"-"})," ",e.jsxs("td",{className:parseFloat(W.remainingBalance||"0")>0?"balance-positive":"balance-negative",children:["",W.remainingBalance||"0.00"]})," ",e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsxs("button",{onClick:()=>ye(W),className:"action-text-button view-button",title:"View Payments & Balance",children:[e.jsx(Jw,{size:16})," View Payments"]}),e.jsxs("button",{onClick:()=>xe(W),className:"action-text-button add-payment-button",title:"Add Payment",children:[e.jsx(ya,{size:16})," Add Payment"]}),e.jsx("button",{onClick:()=>Fe(W),className:"action-icon-button edit-button",title:"Edit Distributor",children:e.jsx(ds,{size:16})}),e.jsx("button",{onClick:()=>qe(W),className:"action-icon-button delete-button",title:"Delete Distributor",children:e.jsx(on,{size:16})})]})})]},W.id))})]})}),d&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:$e,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Add New Distributor"}),u&&e.jsx("div",{className:"modal-error-message",children:u}),e.jsxs("form",{onSubmit:Pe,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Name:"}),e.jsx("input",{type:"text",id:"name",value:F,onChange:W=>B(W.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"contact_person",value:G,onChange:W=>C(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",value:A,onChange:W=>P(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",value:$,onChange:W=>J(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address:"}),e.jsx("textarea",{id:"address",value:R,onChange:W=>L(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"gst_number",value:M,onChange:W=>Z(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"drug_license_number",value:Q,onChange:W=>S(W.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:$e,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Distributor"})]})]})]})}),m&&_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Be,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Edit Distributor"}),u&&e.jsx("div",{className:"modal-error-message",children:u}),e.jsxs("form",{onSubmit:se,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-name",children:"Name:"}),e.jsx("input",{type:"text",id:"edit-name",value:F,onChange:W=>B(W.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"edit-contact_person",value:G,onChange:W=>C(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"edit-phone",value:A,onChange:W=>P(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-email",children:"Email:"}),e.jsx("input",{type:"email",id:"edit-email",value:$,onChange:W=>J(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-address",children:"Address:"}),e.jsx("textarea",{id:"edit-address",value:R,onChange:W=>L(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"edit-gst_number",value:M,onChange:W=>Z(W.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"edit-drug_license_number",value:Q,onChange:W=>S(W.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Be,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Save Changes"})]})]})]})}),g&&_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:et,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Confirm Delete"}),e.jsxs("p",{children:['Are you sure you want to delete distributor "',_.name,'"?']}),u&&e.jsx("div",{className:"modal-error-message",children:u}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:et,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Ce,className:"button-delete",children:"Delete"})]})]})}),j&&_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsx("button",{onClick:Oe,className:"modal-close-button",children:""}),e.jsxs("h3",{className:"modal-title",children:["Payments & Balance for ",_.name]}),u&&e.jsx("div",{className:"modal-error-message",children:u}),X&&e.jsxs("div",{className:"balance-summary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Order Value:"})," ",X.totalOrderValue.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount Paid:"})," ",X.totalAmountPaid.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Remaining Balance:"})," ",X.remainingBalance.toFixed(2)]})]}),e.jsx("h4",{children:"Payment History"}),E.length===0?e.jsx("p",{children:"No payments recorded for this distributor."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Order Value"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Balance Remaining"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:E.map(W=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(W.payment_date).toLocaleDateString()}),e.jsxs("td",{children:["",W.order_value.toFixed(2)]}),e.jsxs("td",{children:["",W.amount_paid.toFixed(2)]}),e.jsxs("td",{children:["",W.balance_remaining.toFixed(2)]}),e.jsx("td",{children:W.notes||"-"})]},W.id))})]})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:Oe,className:"button-cancel",children:"Close"})})]})}),k&&_&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:he,className:"modal-close-button",children:""}),e.jsxs("h3",{className:"modal-title",children:["Add Payment for ",_.name]}),u&&e.jsx("div",{className:"modal-error-message",children:u}),e.jsxs("form",{onSubmit:je,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_date",children:"Payment Date:"}),e.jsx("input",{type:"date",id:"payment_date",value:ge,onChange:W=>fe(W.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"order_value",children:"Order Value:"}),e.jsx("input",{type:"number",id:"order_value",value:w,onChange:W=>ue(W.target.value),step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount_paid",children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount_paid",value:Ne,onChange:W=>K(W.target.value),step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_notes",children:"Notes:"}),e.jsx("textarea",{id:"payment_notes",value:Y,onChange:W=>V(W.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:he,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Payment"})]})]})]})})]})},DL=({isOpen:t,onClose:s,excelHeaders:n,onConfirm:r,availableFields:o})=>{const[u,c]=y.useState({});if(y.useEffect(()=>{t&&p()},[t,n,o]),!t)return null;const d=(f,g)=>{c(x=>({...x,[f]:g}))},p=()=>{const f={};n.forEach(g=>{const x=o.map(N=>({name:N})),j=br(g,x);j&&(f[g]=j.name)}),c(f)},m=()=>{const f={};for(const g in u)u[g]&&u[g]!=="none"&&(f[g]=u[g]);r(f),s()};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:s,className:"modal-close-button",children:e.jsx(Et,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Match File Columns"}),e.jsx("p",{className:"modal-description",children:'Please match the columns from your uploaded file to the corresponding fields in the drug inventory. You can use the "Auto Match" button for suggestions.'}),e.jsx("div",{className:"modal-actions-top",children:e.jsx("button",{type:"button",onClick:p,className:"button-auto-match",children:"Auto Match"})}),e.jsxs("div",{className:"column-mapping-grid",children:[e.jsx("div",{className:"grid-header",children:"Excel Column"}),e.jsx("div",{className:"grid-header",children:"App Field"}),n.map((f,g)=>e.jsxs(en.Fragment,{children:[e.jsx("div",{className:"excel-header-cell",children:f}),e.jsx("div",{className:"app-field-cell",children:e.jsxs("select",{value:u[f]||"",onChange:x=>d(f,x.target.value),className:"app-field-select",children:[e.jsx("option",{value:"",children:"-- Select Field --"}),e.jsx("option",{value:"none",children:"None (Ignore Column)"}),o.map((x,j)=>e.jsxs("option",{value:x,children:[x==="name"?"Composition Name":x==="brand_name"?"Brand Name":x==="price"?"MRP":x==="buying_price"?"Rate":x==="unit"?"Pack":x==="batch"?"Batch":x==="hsn_code"?"HSN Code":x==="mfg"?"MFG":x==="loose_quantity"?"Loose":x.replace(/_/g," ").replace(/\b\w/g,N=>N.toUpperCase())," "]},j))]})})]},g))]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:s,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:m,className:"button-submit",children:"Confirm Mapping"})]})]})})},EL=({isOpen:t,onClose:s,onDrugAddedToPurchase:n})=>{const[r,o]=y.useState({name:"",composition:"",description:"",mrp:0,stock:0,pack:"",expiry_date:"",rate:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null}),[u,c]=y.useState(null),[d,p]=y.useState(!1),[m,f]=y.useState(!1),g=y.useRef(null),x=y.useRef(null),j=y.useRef(null);y.useEffect(()=>{t&&(o({name:"",composition:"",description:"",mrp:0,stock:0,pack:"",expiry_date:"",rate:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null}),c(null),p(!1),f(!1))},[t]),y.useEffect(()=>{const D=T=>{T.key==="Tab"&&x.current===document.activeElement&&(m||(f(!0),setTimeout(()=>{var E;(E=j.current)==null||E.focus()},0),T.preventDefault()))},_=T=>{g.current&&!g.current.contains(T.target)&&f(!1)};return document.addEventListener("keydown",D),document.addEventListener("mousedown",_),()=>{document.removeEventListener("keydown",D),document.removeEventListener("mousedown",_)}},[m]);const N=D=>{const{name:_,value:T,type:E}=D.target;o(U=>({...U,[_]:E==="number"?parseFloat(T)||null:T}))},k=D=>{if(D.preventDefault(),c(null),p(!0),r.mrp===void 0||r.stock===void 0){c("MRP and Stock Quantity are required."),p(!1);return}const _={...r,name:r.name===""?null:r.name,composition:r.composition===""?null:r.composition,rate:r.rate===0?null:r.rate,expiry_date:r.expiry_date===""?null:r.expiry_date,gst:r.gst===0?null:r.gst,margin:r.margin===0?null:r.margin,discount:r.discount===0?null:r.discount,brand_name:r.brand_name===""?null:r.brand_name,batch:r.batch===""?null:r.batch,hsn_code:r.hsn_code===""?null:r.hsn_code,mfg:r.mfg===""?null:r.mfg,loose:r.loose===0?null:r.loose};n(_),p(!1),s()};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content add-drug-form-container max-w-2xl mx-auto",children:[e.jsxs("div",{className:"add-drug-form-header",children:[e.jsx("h2",{children:"Add New Drug"}),e.jsx("button",{onClick:s,className:"cancel-button",title:"Close",children:e.jsx(Et,{size:24})})]}),u&&e.jsx("div",{className:"error-message",children:u}),e.jsxs("form",{onSubmit:k,className:"add-drug-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Composition Name"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"name",id:"name",value:r.name||"",onChange:N,className:"custom-text-input mt-1",placeholder:"e.g., Paracetamol",tabIndex:1})]}),e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"brand_name",className:"form-label",children:"Brand Name"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"brand_name",id:"brand_name",value:r.brand_name||"",onChange:N,className:"custom-text-input mt-1",placeholder:"e.g., Calpol",tabIndex:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"mrp",className:"form-label",children:"MRP () *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),e.jsx("input",{type:"number",name:"mrp",id:"mrp",required:!0,step:"0.01",min:"0",value:r.mrp||"",onChange:N,className:"custom-text-input mt-1",placeholder:"e.g., 500",tabIndex:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"stock",className:"form-label",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(cs,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),e.jsx("input",{type:"number",name:"stock",id:"stock",required:!0,step:"1",min:"0",value:r.stock||"",onChange:N,className:"custom-text-input mt-1",placeholder:"e.g., 5",tabIndex:4})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pack",className:"form-label",children:"Pack (e.g., strip, bottle)"}),e.jsx("input",{type:"text",name:"pack",id:"pack",value:r.pack||"",onChange:N,className:"custom-text-input mt-1",placeholder:"e.g., strip, bottle",tabIndex:5})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry_date",className:"form-label",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",id:"expiry_date",value:r.expiry_date||"",onChange:N,className:"custom-text-input mt-1",tabIndex:6})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"box_number",className:"form-label",children:"Box Number"}),e.jsx("input",{type:"text",name:"box_number",id:"box_number",value:r.box_number||"",onChange:N,className:"custom-text-input mt-1",tabIndex:7})]}),e.jsxs("div",{className:"relative sm-col-span-2",ref:g,children:[e.jsx("button",{type:"button",onClick:()=>f(!m),className:"form-button w-full text-left",tabIndex:8,ref:x,children:"Others"}),m&&e.jsxs("div",{className:"others-fields-grid",children:[" ",e.jsxs("div",{className:"sm-col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",id:"description",rows:3,value:r.description||"",onChange:N,className:"custom-text-input mt-1",tabIndex:9})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rate",className:"form-label",children:"Rate ()"}),e.jsx("input",{type:"number",name:"rate",id:"rate",step:"0.01",min:"0",value:r.rate??"",onChange:N,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:10,ref:j})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gst",className:"form-label",children:"GST (%)"}),e.jsx("input",{type:"number",name:"gst",id:"gst",step:"0.01",min:"0",max:"100",value:r.gst??"",onChange:N,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:11})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"margin",className:"form-label",children:"Margin (%)"}),e.jsx("input",{type:"number",name:"margin",id:"margin",step:"0.01",min:"0",max:"100",value:r.margin??"",onChange:N,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:12})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"discount",className:"form-label",children:"Discount (%)"}),e.jsx("input",{type:"number",name:"discount",id:"discount",step:"0.01",min:"0",max:"100",value:r.discount??"",onChange:N,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:13})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batch",className:"form-label",children:"Batch"}),e.jsx("input",{type:"text",name:"batch",id:"batch",value:r.batch||"",onChange:N,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:14})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hsn_code",className:"form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsn_code",id:"hsn_code",value:r.hsn_code||"",onChange:N,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:15})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mfg",className:"form-label",children:"MFG"}),e.jsx("input",{type:"text",name:"mfg",id:"mfg",value:r.mfg||"",onChange:N,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:16})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"loose",className:"form-label",children:"Loose Quantity"}),e.jsx("input",{type:"number",name:"loose",id:"loose",step:"1",min:"0",value:r.loose??"",onChange:N,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:17})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:s,disabled:d,className:"form-button cancel-form-button",tabIndex:18,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:d,className:"form-button submit-form-button inline-flex justify-center",tabIndex:19,children:d?"Adding...":"Add Drug"})]})]})]})}):null},TL=({purchaseRows:t,onCellChange:s,onRemoveDrug:n,onAddEmptyRow:r})=>{const o=y.useRef(new Map),u=["name","mrp","stock","pack","expiry_date","rate","brand_name","box_number","gst","discount","batch","hsn_code","mfg","loose"],c=(d,p,m)=>{if(d.key==="Tab"){d.preventDefault();const f=u.indexOf(m);if(f!==-1){const g=(f+1)%u.length,x=u[g],j=o.current.get(`${p}-${x}`);j==null||j.focus()}}};return t.length===0?e.jsxs("div",{className:"no-drugs-message",children:[e.jsx("p",{children:"No drugs added to the purchase list yet."}),e.jsxs("button",{onClick:r,className:"action-button add-drug-to-table-button",children:[e.jsx(ya,{size:18,className:"button-icon"}),"Add the first drug"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"purchase-drugs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Composition Name"}),e.jsx("th",{children:"MRP ()"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Pack"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Expiry Date"}),e.jsx("th",{children:"Rate ()"}),e.jsx("th",{children:"Brand Name"}),e.jsx("th",{children:"Box Number"}),e.jsx("th",{children:"GST (%)"}),e.jsx("th",{children:"Discount (%)"}),e.jsx("th",{children:"Margin (%)"}),e.jsx("th",{children:"Batch"}),e.jsx("th",{children:"HSN Code"}),e.jsx("th",{children:"MFG"}),e.jsx("th",{children:"Loose"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map((d,p)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:d.name||"",onChange:m=>s(m,d.id,"name"),onKeyDown:m=>c(m,d.id,"name"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-name`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.mrp||"",onChange:m=>s(m,d.id,"mrp"),onKeyDown:m=>c(m,d.id,"mrp"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-mrp`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.stock||"",onChange:m=>s(m,d.id,"stock"),onKeyDown:m=>c(m,d.id,"stock"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-stock`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.pack||"",onChange:m=>s(m,d.id,"pack"),onKeyDown:m=>c(m,d.id,"pack"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-pack`,m)}})}),e.jsx("td",{children:d.supplier||"N/A"}),e.jsx("td",{children:e.jsx("input",{type:"date",value:d.expiry_date||"",onChange:m=>s(m,d.id,"expiry_date"),onKeyDown:m=>c(m,d.id,"expiry_date"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-expiry_date`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.rate||"",onChange:m=>s(m,d.id,"rate"),onKeyDown:m=>c(m,d.id,"rate"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-rate`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.brand_name||"",onChange:m=>s(m,d.id,"brand_name"),onKeyDown:m=>c(m,d.id,"brand_name"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-brand_name`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.box_number||"",onChange:m=>s(m,d.id,"box_number"),onKeyDown:m=>c(m,d.id,"box_number"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-box_number`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.gst||"",onChange:m=>s(m,d.id,"gst"),onKeyDown:m=>c(m,d.id,"gst"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-gst`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.discount||"",onChange:m=>s(m,d.id,"discount"),onKeyDown:m=>c(m,d.id,"discount"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-discount`,m)}})}),e.jsx("td",{children:(()=>{const m=d.mrp||0,f=d.rate||0,g=d.gst!==null&&d.gst!==void 0?d.gst/100*f:0,x=d.discount!==null&&d.discount!==void 0?d.discount/100*m:0,j=m-(f+g)-x;return`${(m>0?j/m*100:0).toFixed(2)}%`})()}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.batch||"",onChange:m=>s(m,d.id,"batch"),onKeyDown:m=>c(m,d.id,"batch"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-batch`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.hsn_code||"",onChange:m=>s(m,d.id,"hsn_code"),onKeyDown:m=>c(m,d.id,"hsn_code"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-hsn_code`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.mfg||"",onChange:m=>s(m,d.id,"mfg"),onKeyDown:m=>c(m,d.id,"mfg"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-mfg`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.loose||"",onChange:m=>s(m,d.id,"loose"),onKeyDown:m=>c(m,d.id,"loose"),className:"editable-cell-input",ref:m=>{d.id&&o.current.set(`${d.id}-loose`,m)}})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>n(d.id),className:"delete-button",title:"Remove Item",children:e.jsx(on,{size:16})})})]},d.id||p))})]})})},AL="_container_4l9fw_7",PL="_header_4l9fw_159",IL="_backButton_4l9fw_173",OL="_title_4l9fw_217",zL="_stickyActionBar_4l9fw_239",RL="_actionRow_4l9fw_269",LL="_inputWrapper_4l9fw_287",$L="_inputIcon_4l9fw_297",FL="_input_4l9fw_287",ML="_quickDistributors_4l9fw_353",BL="_distributorChip_4l9fw_369",UL="_distributorChipIcon_4l9fw_415",qL="_selectedInfo_4l9fw_425",HL="_resultsDropdown_4l9fw_455",VL="_resultItem_4l9fw_489",GL="_buttonGroup_4l9fw_517",QL="_button_4l9fw_517",YL="_buttonPrimary_4l9fw_561",JL="_buttonSecondary_4l9fw_583",XL="_buttonAccent_4l9fw_605",KL="_buttonDisabled_4l9fw_627",WL="_tableSection_4l9fw_643",ZL="_cardTitle_4l9fw_659",e$="_cardIcon_4l9fw_679",t$="_footer_4l9fw_899",n$="_totalValue_4l9fw_933",a$="_footerControls_4l9fw_957",s$="_paidInputGroup_4l9fw_969",i$="_paidLabel_4l9fw_981",r$="_paidInput_4l9fw_969",l$="_errorMsg_4l9fw_1027",xt={container:AL,header:PL,backButton:IL,title:OL,stickyActionBar:zL,actionRow:RL,inputWrapper:LL,inputIcon:$L,input:FL,quickDistributors:ML,distributorChip:BL,distributorChipIcon:UL,selectedInfo:qL,resultsDropdown:HL,resultItem:VL,buttonGroup:GL,button:QL,buttonPrimary:YL,buttonSecondary:JL,buttonAccent:XL,buttonDisabled:KL,tableSection:WL,cardTitle:ZL,cardIcon:e$,footer:t$,totalValue:n$,footerControls:a$,paidInputGroup:s$,paidLabel:i$,paidInput:r$,errorMsg:l$},Kj=()=>{const t=ot(),{purchaseRows:s,setPurchaseRows:n,selectedDistributor:r,setSelectedDistributor:o,searchTerm:u,setSearchTerm:c,amountPaidToDistributor:d,setAmountPaidToDistributor:p,distributors:m,setDistributors:f}=p0(),[g,x]=y.useState(!1),j=y.useRef(null),N=y.useRef(null),[k,D]=y.useState(!1),_=y.useRef(null),[T,E]=y.useState(!1),[U,X]=y.useState([]),[I,F]=y.useState(null),[B,G]=y.useState(null),[C,A]=y.useState(!1),[P,$]=y.useState([]),J=["name","description","mrp","stock","pack","supplier","expiry_date","rate","box_number","gst","margin","discount","brand_name","batch","hsn_code","mfg","loose"];y.useEffect(()=>{(async()=>{try{const je=await ae("/api/distributors?limit=4");if(je.ok){const Ie=await je.json();$(Array.isArray(Ie)?Ie.slice(0,4):[])}}catch(je){console.error("Failed to fetch initial distributors",je)}})()},[]);const R=()=>{const je={id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:"",composition:"",description:"",mrp:0,stock:0,pack:"",supplier:r?r.name:"",expiry_date:"",rate:0,box_number:"",gst:0,margin:0,discount:0,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:0,last_updated:"",created_at:""};n(Ie=>[...Ie,je])},L=async(ee,je)=>{if(!ee){G("No file provided for import.");return}if(!r){G("Please select a distributor before importing.");return}x(!0),G(null);const Ie=new FormData;Ie.append("inventoryFile",ee),Ie.append("columnMapping",JSON.stringify(je));try{const $e=await ae("/api/drugs/parse-excel",{method:"POST",body:Ie});if(!$e.ok){const Be=await $e.json();throw new Error(Be.message||`Failed to parse Excel file: ${$e.statusText}`)}const Fe=await $e.json();n(Be=>[...Be,...Fe.map(qe=>({...qe,id:Date.now().toString()+Math.random().toString(36).substring(2,9),supplier:r?r.name:qe.supplier}))]),alert(`Successfully parsed ${Fe.length} drugs from Excel. They have been added to the purchase list.`)}catch($e){console.error("Failed to parse Excel file:",$e),G($e.message||"Failed to parse Excel file. Please check the file format and try again.")}finally{j.current&&(j.current.value=""),x(!1),F(null)}},M=async ee=>{if(ee.target.files&&ee.target.files[0]){const je=ee.target.files[0];F(je),G(null),x(!0);const Ie=new FormData;Ie.append("inventoryFile",je);try{const $e=await ae("/api/drugs/get-file-headers",{method:"POST",body:Ie});if(!$e.ok){const Be=await $e.json();throw new Error(Be.message||`Failed to get file headers: ${$e.statusText}`)}const{headers:Fe}=await $e.json();X(Fe),E(!0)}catch($e){console.error("Failed to get file headers:",$e),G($e.message||"Failed to read file headers. Please check the file format and try again."),F(null)}finally{x(!1)}}else F(null)},Z=ee=>{I?L(I,ee):G("No file selected for import after mapping."),E(!1)},Q=()=>{E(!1),X([]),F(null),j.current&&(j.current.value="")},S=()=>{var ee;(ee=j.current)==null||ee.click()},ge=async ee=>{if(ee.target.files&&ee.target.files[0]){const je=ee.target.files[0];G(null),x(!0);const Ie=new FormData;Ie.append("file",je),Ie.append("output_type","csv");const Fe={Authorization:"Bearer 00841ac4-b279-11f0-ab55-0a3a41e3fad1"};try{const Be=await fetch("https://extraction-api.nanonets.com/extract",{method:"POST",headers:Fe,body:Ie});if(!Be.ok){const O=await Be.json();throw new Error(O.message||`Failed to extract data from image/PDF: ${Be.statusText}`)}const qe=await Be.json();if(!qe.success||!qe.content)throw new Error(qe.detail||"Nanonets API did not return expected content.");let et=qe.content;et=et.split(`
`).filter(O=>!O.startsWith("#")&&O.trim()!=="").join(`
`);const Oe=new File([et],"extracted_data.csv",{type:"text/csv"}),xe=new FormData;xe.append("inventoryFile",Oe);const he=await ae("/api/drugs/get-file-headers",{method:"POST",body:xe});if(!he.ok){const O=await he.json();throw new Error(O.message||`Failed to get headers from extracted CSV: ${he.statusText}`)}const{headers:W}=await he.json();X(W),F(Oe),E(!0)}catch(Be){console.error("Failed to extract data from image/PDF:",Be),G(Be.message||"Failed to extract data from image/PDF. Please check the file and try again.")}finally{N.current&&(N.current.value=""),x(!1)}}},fe=()=>{var ee;(ee=N.current)==null||ee.click()},w=()=>{if(!r){G("Please select a distributor before adding a drug manually.");return}A(!0)},ue=()=>{A(!1),G(null)},Ne=ee=>{n(je=>[...je,{...ee,id:Date.now().toString(),supplier:r?r.name:ee.supplier}]),ue()},K=ee=>{n(je=>je.filter(Ie=>Ie.id!==ee))},Y=(ee,je,Ie)=>{const{value:$e}=ee.target;n(Fe=>Fe.map(Be=>{if(Be.id===je){let qe=$e;Ie==="expiry_date"?qe=$e.trim()===""?null:$e:["mrp","stock","rate","gst","margin","discount","loose"].includes(Ie)&&(qe=parseFloat($e),isNaN(qe)&&(qe=null));const et={...Be,[Ie]:qe};return Ie==="name"&&r&&!et.supplier&&(et.supplier=r.name),et}return Be}))},V=y.useCallback(()=>s.reduce((ee,je)=>{const Ie=je.stock||0,$e=je.rate||0,Fe=je.gst||0,Be=je.discount||0;let qe=$e*(1-Be/100),et=Ie*qe;return et+=et*(Fe/100),ee+et},0),[s]),oe=async()=>{if(!r){G("Please select a distributor before submitting the purchase.");return}const ee=s.filter(je=>Object.values(je).some(Ie=>typeof Ie=="string"&&Ie.trim()!==""||typeof Ie=="number"&&Ie!==0||Ie!=null&&typeof Ie!="string"&&typeof Ie!="number"));if(ee.length===0){G("No valid drugs to submit. Please fill in at least one field for a row, or remove empty rows."),x(!1);return}x(!0),G(null);try{for(const Fe of ee){const Be={...Fe,expiry_date:Fe.expiry_date===""?null:Fe.expiry_date,distributorId:r.id},qe=await ae("/api/drugs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Be)});if(!qe.ok){const et=await qe.json();throw new Error(et.message||`Failed to add drug ${Fe.name}: ${qe.statusText}`)}}const je=V(),Ie=new Date().toISOString().split("T")[0],$e=await ae(`/api/distributors/${r.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:Ie,order_value:je,amount_paid:d,notes:"Payment from purchase page."})});if(!$e.ok){const Fe=await $e.json();throw new Error(Fe.message||`Failed to record distributor payment: ${$e.statusText}`)}alert("All valid drugs added to inventory and distributor payment recorded successfully!"),n([]),o(null),c(""),p(0),t("/dashboard/inventory")}catch(je){console.error("Failed to submit purchase:",je),G(je.message||"Failed to submit purchase. Please try again.")}finally{x(!1)}},Pe=y.useCallback(async ee=>{if(ee.trim()===""){f([]);return}try{const je=await ae(`/api/distributors?search=${encodeURIComponent(ee)}`);if(!je.ok)throw new Error(`Failed to fetch distributors: ${je.statusText}`);const Ie=await je.json();f(Ie)}catch(je){console.error("Failed to fetch distributors:",je),G(je.message||"Failed to load distributors.")}},[]),se=ee=>{const je=ee.target.value;c(je),o(null),_.current&&clearTimeout(_.current),je.trim()!==""?_.current=setTimeout(()=>{Pe(je),D(!0)},300):(f([]),D(!1))},Ce=ee=>{o(ee),c(ee.name),D(!1),f([])};return y.useEffect(()=>{const ee=je=>{je.target instanceof HTMLElement&&!je.target.closest(`.${xt.inputWrapper}`)&&D(!1)};return document.addEventListener("mousedown",ee),()=>{document.removeEventListener("mousedown",ee),_.current&&clearTimeout(_.current)}},[]),e.jsxs("div",{className:xt.container,children:[e.jsxs("div",{className:xt.header,children:[e.jsx("button",{onClick:()=>t(-1),className:xt.backButton,title:"Go Back",children:e.jsx(vt,{size:24})}),e.jsx("h2",{className:xt.title,children:"Purchase Inventory"})]}),B&&e.jsxs("div",{className:xt.errorMsg,children:[e.jsx(pn,{size:20}),B]}),e.jsx("div",{className:xt.stickyActionBar,children:e.jsxs("div",{className:xt.actionRow,children:[e.jsxs("div",{style:{flex:1,minWidth:"300px",position:"relative"},children:[e.jsxs("div",{className:xt.inputWrapper,children:[e.jsx(mn,{className:xt.inputIcon,size:20}),e.jsx("input",{type:"text",placeholder:"Search distributor...",value:u,onChange:se,onFocus:()=>u.trim()!==""&&D(!0),className:xt.input}),k&&m.length>0&&e.jsx("ul",{className:xt.resultsDropdown,children:m.map(ee=>e.jsx("li",{onClick:()=>Ce(ee),className:xt.resultItem,children:ee.name},ee.id))})]}),P.length>0&&!r&&e.jsx("div",{className:xt.quickDistributors,children:P.map(ee=>e.jsxs("button",{className:xt.distributorChip,onClick:()=>Ce(ee),children:[e.jsx(Oa,{className:xt.distributorChipIcon}),ee.name]},ee.id))}),r&&e.jsxs("div",{className:xt.selectedInfo,style:{marginTop:"0.5rem",marginBottom:0},children:[e.jsx(aa,{size:18}),e.jsxs("span",{children:["Selected: ",e.jsx("strong",{children:r.name})]})]})]}),e.jsxs("div",{className:xt.buttonGroup,children:[e.jsx("input",{ref:j,type:"file",className:"sr-only",style:{display:"none"},accept:".xlsx, .xls, .csv",onChange:M}),e.jsx("input",{ref:N,type:"file",className:"sr-only",style:{display:"none"},accept:".pdf, .png, .jpg, .jpeg",onChange:ge}),e.jsxs("button",{onClick:S,disabled:g||!r,className:`${xt.button} ${xt.buttonPrimary} ${g||!r?xt.buttonDisabled:""}`,title:r?"":"Select a distributor to import",children:[e.jsx(Xw,{size:18}),g?"Processing...":"Import Excel/CSV"]}),e.jsxs("button",{onClick:fe,disabled:g||!r,className:`${xt.button} ${xt.buttonSecondary} ${g||!r?xt.buttonDisabled:""}`,title:r?"":"Select a distributor",children:[e.jsx(hs,{size:18}),"Scan Image/PDF"]}),e.jsxs("button",{onClick:w,disabled:!r,className:`${xt.button} ${xt.buttonAccent} ${r?"":xt.buttonDisabled}`,title:r?"":"Select a distributor",children:[e.jsx(ya,{size:18}),"Add Manually"]})]})]})}),e.jsx(DL,{isOpen:T,onClose:Q,excelHeaders:U,onConfirm:Z,availableFields:J}),C&&e.jsx(EL,{isOpen:C,onClose:ue,onDrugAddedToPurchase:Ne}),e.jsxs("div",{className:xt.tableSection,children:[e.jsxs("div",{className:xt.cardTitle,children:[e.jsx(Kw,{className:xt.cardIcon,size:24}),"Purchase Items (",s.length,")"]}),e.jsx(TL,{purchaseRows:s,onCellChange:Y,onRemoveDrug:K,onAddEmptyRow:R})]}),e.jsxs("div",{className:xt.footer,children:[e.jsxs("button",{onClick:R,className:`${xt.button} ${xt.buttonSecondary}`,children:[e.jsx(ya,{size:18}),"Add New Row"]}),e.jsxs("div",{className:xt.footerControls,children:[e.jsxs("div",{className:xt.paidInputGroup,children:[e.jsx("label",{htmlFor:"amount-paid",className:xt.paidLabel,children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount-paid",value:d,onChange:ee=>p(parseFloat(ee.target.value)||0),placeholder:"0.00",className:xt.paidInput,step:"0.01",disabled:!r})]}),e.jsxs("div",{className:xt.totalValue,children:["Total: ",e.jsxs("span",{children:["",V().toFixed(2)]})]}),e.jsx("button",{onClick:oe,disabled:g||s.length===0||!r,className:`${xt.button} ${xt.buttonPrimary} ${xt.submitButton} ${g||!r||s.length===0?xt.buttonDisabled:""}`,style:{padding:"0.8rem 1.5rem",fontSize:"1rem"},children:g?"Submitting...":"Complete Purchase"})]})]})]})},o$=t=>{if(!t)return 1;const s=t.match(/(?:\d+x)?(\d+)/);return s&&s[1]?parseInt(s[1],10):1},c$=()=>{const t=ot(),s=za(),[n,r]=y.useState(null),[o,u]=y.useState([]),[c,d]=y.useState(!0),[p,m]=y.useState(null),[f,g]=y.useState(!1),[x,j]=y.useState("cash"),[N,k]=y.useState(""),[D,_]=y.useState(""),[T,E]=y.useState(""),[U,X]=y.useState(""),[I,F]=y.useState(""),[B,G]=y.useState(0),C=y.useRef(!1),A=Q=>{const S=Math.max(0,Math.min(100,isNaN(Q)?0:Q));C.current=!0,G(S);const ge=o.map(fe=>({...fe,discount_percentage:S}));u(ge)},P=(Q,S)=>{const ge=[...o];ge[Q].discount_percentage=isNaN(S)?0:S,u(ge)};y.useEffect(()=>{if(C.current){C.current=!1;return}const Q=o.reduce((fe,w)=>fe+(w.total_price??0),0);if(Q===0){G(0);return}const ge=o.reduce((fe,w)=>{const Ne=(w.total_price??0)*((w.discount_percentage??0)/100);return fe+Ne},0)/Q*100;G(fe=>Math.abs(fe-ge)>.01?ge:fe)},[o]);const $=async()=>{if(!n)return m("No order data available to bill."),null;if(o.length===0)return m("Cannot bill an empty order."),null;g(!0),m(null);try{const Q=o.map(ue=>{const Ne=(ue.pricePerLooseUnit??0)*(ue.looseQuantity??0),K=Ne*((ue.discount_percentage??0)/100),Y=Ne-K;return{name:ue.name,pack_quantity:ue.loosePacks??0,loose_quantity:ue.looseUnits??0,price:ue.originalPrice??0,pack_price:ue.originalPrice??0,loose_price:ue.pricePerLooseUnit??0,total:Y,drug_id:ue.drug_id,discount_percentage:ue.discount_percentage??0,batch:ue.batch,expiry_date:ue.expiry_date}}),S={patientId:n.patientId,queueId:n.id,items:Q,amount:Z,paymentMode:x,type:"pharmacy",related_id:n.id,status:"paid",discountPercentage:B},ge=await ae("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),fe=await ge.json();if(!ge.ok||!fe.id)throw new Error(fe.message||"Failed to create bill.");const w=await ae(`/api/pharmacy-orders/${n.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:fe.id,medications:o})});if(!w.ok){const ue=await w.text();throw new Error(`Failed to update pharmacy order status: ${w.statusText} - ${ue}`)}return r(ue=>ue?{...ue,status:"billed",bill_id:fe.id}:null),alert(`Order ${n.patientName}'s bill created (ID: ${fe.id}) and marked as billed.`),t(`/dashboard/pharmacy-billing/${n.id}`,{replace:!0,state:{order:{...n,status:"billed",bill_id:fe.id},initialItems:o}}),fe.id}catch(Q){return console.error("Billing process failed:",Q),m(Q.message||"Failed to mark order as billed. Please try again."),null}finally{g(!1)}},J=()=>{window.print()},R=async()=>{await $()&&(window.print(),t(-1))};y.useEffect(()=>{const Q=s.pathname.split("/"),S=Q[Q.length-1];S?(async()=>{try{d(!0);const fe=await ae(`/api/pharmacy-orders/${S}`);if(!fe.ok)throw new Error("Failed to fetch pharmacy order details");const w=await fe.json();r(w);let ue=[];try{const K=await ae("/api/drugs");if(K.ok){const Y=await K.json();ue=Y.drugs||Y||[]}}catch(K){console.warn("Failed to fetch inventory for billing details",K)}const Ne=w.medications.map(K=>{const Y=o$(K.unit),V=(K.pack_quantity??0)*Y+(K.loose_quantity??0),oe=ue.find(Ie=>K.drug_id&&String(Ie.id)===String(K.drug_id)||Ie.name.toLowerCase()===K.name.toLowerCase()),Pe=K.batch||(oe==null?void 0:oe.batch)||(oe==null?void 0:oe.batch_number),se=K.expiry_date||(oe==null?void 0:oe.expiry_date),Ce=Number(K.pack_price)||Number(oe==null?void 0:oe.mrp)||0,ee=Number(oe==null?void 0:oe.rate)||0;let je=Number(K.loose_price)||0;return je===0&&(Ce>0&&Y>0?je=Ce/Y:ee>0&&(je=ee)),{...K,isLoose:!0,loosePacks:K.pack_quantity??0,looseUnits:K.loose_quantity??0,looseQuantity:V,pack_price:Ce,loose_price:je,total_price:Number(K.total_price)||je*V,pricePerLooseUnit:je,originalPrice:Ce,discount_percentage:Number(K.discount_percentage)??0,directions_to_use:K.directions_to_use,tabletsPerDay:K.tabletsPerDay,numberOfDays:K.numberOfDays,batch:Pe,expiry_date:se}});u(Ne)}catch(fe){console.error("Failed to fetch order:",fe),m(fe.message||"Failed to load order details.")}finally{d(!1)}})():(m("No pharmacy order ID provided."),d(!1))},[s.pathname]),y.useEffect(()=>{(async()=>{try{const S=await ae("/api/clinics/settings");if(!S.ok)throw new Error("Failed to fetch clinic settings");const ge=await S.json();_(ge.upi_id||""),E(ge.name||""),X(ge.address||""),F(ge.notes||"")}catch(S){console.error("Error fetching clinic settings:",S)}})()},[]);const L=y.useMemo(()=>o.reduce((Q,S)=>Q+(S.total_price??0),0),[o]),M=y.useMemo(()=>o.reduce((Q,S)=>{const fe=(S.total_price??0)*(S.discount_percentage??0)/100;return Q+fe},0),[o]),Z=y.useMemo(()=>L-M,[L,M]);return y.useEffect(()=>{if(Z>0&&D){const Q=`upi://pay?pa=${D}&pn=ClinicName&am=${Z.toFixed(2)}&cu=INR`;k(Q)}else k("")},[Z,D]),c?e.jsx("div",{className:"loading-pulse",children:"Loading Bill..."}):p?e.jsxs("div",{className:"error-message-box",children:["Error: ",p]}):n?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"TAX INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:T?`${T} Pharmacy`:"Pharmacy Bill"}),(U||I)&&e.jsxs("div",{className:"clinic-details-print",children:[U&&e.jsx("span",{className:"small-text clinic-address",children:U}),I&&e.jsx("span",{className:"small-text clinic-notes",children:I})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Oa,{size:16})," Patient Name"]})," ",n.patientName]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(jc,{size:16})," Token"]})," ",n.patientTokenNumber??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Li,{size:16})," Order Date"]})," ",new Date(n.date).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(vt,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Pharmacy Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Oa,{size:16})," Patient Name"]})," ",n.patientName]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(jc,{size:16})," Token"]})," ",n.patientTokenNumber??"N/A"]}),e.jsxs("div",{className:"info-item no-print",children:[e.jsxs("strong",{children:[e.jsx(vr,{size:16})," Order ID"]})," ",n.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Li,{size:16})," Order Date"]})," ",new Date(n.date).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Medications"})}),o.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"BATCH"}),e.jsx("th",{children:"EXPIRY"}),e.jsx("th",{children:"QUANTITY"}),e.jsx("th",{children:"MRP"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"GST%"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:o.map((Q,S)=>{var Ne;const ge=Q.total_price??0,fe=ge*(Q.discount_percentage??0)/100,w=ge-fe;return e.jsxs("tr",{children:[e.jsx("td",{children:S+1}),e.jsx("td",{children:Q.name}),e.jsx("td",{children:Q.batch||"N/A"}),e.jsx("td",{children:Q.expiry_date?new Date(Q.expiry_date).toLocaleDateString():"N/A"}),e.jsxs("td",{children:[e.jsxs("div",{children:["Packs: ",Q.loosePacks??0]}),e.jsxs("div",{children:["Loose: ",Q.looseUnits??0]})]}),e.jsx("td",{children:((Ne=Q.originalPrice)==null?void 0:Ne.toFixed(2))??"N/A"}),e.jsx("td",{children:((Q.pricePerLooseUnit??0)*(1-(Q.discount_percentage??0)/100)).toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:Q.discount_percentage===0?"":Q.discount_percentage,onChange:K=>P(S,parseFloat(K.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsxs("td",{children:[5 .toFixed(1),"%"]}),e.jsx("td",{children:w.toFixed(2)})]},S)})})]}):e.jsx("p",{children:"No medications in this order."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[N&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${x!=="upi"?"hide-on-screen":""}`,children:[e.jsx(Ml,{value:N,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]}),e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",L.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Total Discount (",B.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ",M.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"GST (Included)"}),e.jsxs("span",{children:["",(Z*.05).toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",Z.toFixed(2)]})})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",L.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ",M.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:B===0?"":B,onChange:Q=>A(parseFloat(Q.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:f||n.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",Z.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:N?e.jsxs(e.Fragment,{children:[e.jsx(Ml,{value:N,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:x,onChange:Q=>j(Q.target.value),className:"payment-mode-select",disabled:f||n.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),e.jsxs("div",{className:"bill-actions",children:[n.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:J,className:"secondary-button print-preview-button no-print",disabled:f||o.length===0,children:"Print Preview"}),e.jsx("button",{onClick:R,className:"primary-button",disabled:f||o.length===0,children:f?"Processing...":"Finalise and Bill"})]}),n.status==="billed"&&e.jsx("button",{onClick:()=>t(`/dashboard/bills/${n.bill_id}`),className:"secondary-button",children:"View Bill"})]})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})}):e.jsx("div",{className:"error-message-box",children:"No order data available."})},u$=()=>{const t=ot(),s=za(),[n,r]=y.useState(null),[o,u]=y.useState(""),[c,d]=y.useState(""),[p,m]=y.useState([]),[f,g]=y.useState(!0),[x,j]=y.useState(null),[N,k]=y.useState(!1),[D,_]=y.useState("cash"),[T,E]=y.useState(""),[U,X]=y.useState(""),[I,F]=y.useState(""),[B,G]=y.useState(""),[C,A]=y.useState(""),[P,$]=y.useState(0),J=y.useRef(!1),R=w=>{const ue=Math.max(0,Math.min(100,isNaN(w)?0:w));J.current=!0,$(ue);const Ne=p.map(K=>({...K,discount_percentage:ue}));m(Ne)},L=(w,ue)=>{const Ne=[...p];Ne[w].discount_percentage=isNaN(ue)?0:ue,m(Ne)};y.useEffect(()=>{if(J.current){J.current=!1;return}const w=p.reduce((K,Y)=>K+(Y.price??0),0);if(w===0){$(0);return}const Ne=p.reduce((K,Y)=>{const oe=(Y.price??0)*((Y.discount_percentage??0)/100);return K+oe},0)/w*100;$(K=>Math.abs(K-Ne)>.01?Ne:K)},[p]);const M=async()=>{if(!n)return j("No order data available to bill."),null;if(p.length===0)return j("Cannot bill an empty order."),null;k(!0),j(null);try{const w=p.map(V=>{const oe=V.price,Pe=oe*((V.discount_percentage??0)/100),se=oe-Pe;return{name:V.name,price:V.price,quantity:1,total:se,item_id:V.id,type:"lab_test",discount_percentage:V.discount_percentage??0}}),ue={patientId:n.patient_id,items:w,amount:fe,paymentMode:D,type:"lab",related_id:n.id,status:"paid",discountPercentage:P},Ne=await ae("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ue)}),K=await Ne.json();if(!Ne.ok||!K.id)throw new Error(K.message||"Failed to create bill.");const Y=await ae(`/api/lab/${n.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:K.id})});if(!Y.ok){const V=await Y.text();throw new Error(`Failed to update lab order status: ${Y.statusText} - ${V}`)}return r(V=>V?{...V,status:"billed",bill_id:K.id}:null),alert(`Lab Order bill created (ID: ${K.id}) and marked as billed.`),t(`/dashboard/lab-billing/${n.id}`,{replace:!0,state:{...s.state,order:{...n,status:"billed",bill_id:K.id}}}),K.id}catch(w){return console.error("Billing process failed:",w),j(w.message||"Failed to mark order as billed. Please try again."),null}finally{k(!1)}},Z=()=>{window.print()},Q=async()=>{await M()&&(window.print(),t(-1))};y.useEffect(()=>{const w=s.pathname.split("/"),ue=w[w.length-1];ue?(async()=>{try{const K=await ae(`/api/lab/${ue}`);if(!K.ok)throw new Error("Failed to fetch lab order details");const Y=await K.json();if(r(Y),Y.patient_id){const oe=await ae(`/api/patients/${Y.patient_id}`);if(oe.ok){const Pe=await oe.json();u(Pe.name),d(Pe.patient_token_number)}}const V=Y.tests.map(oe=>({...oe,price:typeof oe.price=="string"?parseFloat(oe.price):Number(oe.price)||0,discount_percentage:0,total_price:typeof oe.price=="string"?parseFloat(oe.price):Number(oe.price)||0}));m(V)}catch(K){console.error("Failed to fetch order:",K),j(K.message||"Failed to load order details.")}finally{g(!1)}})():(j("No lab order ID provided."),g(!1))},[s.pathname]),y.useEffect(()=>{(async()=>{try{const ue=await ae("/api/clinics/settings");if(!ue.ok)throw new Error("Failed to fetch clinic settings");const Ne=await ue.json();X(Ne.upi_id||""),F(Ne.name||""),G(Ne.address||""),A(Ne.notes||"")}catch(ue){console.error("Error fetching clinic settings:",ue)}})()},[]);const S=y.useMemo(()=>p.reduce((w,ue)=>w+(ue.price??0),0),[p]),ge=y.useMemo(()=>p.reduce((w,ue)=>{const K=(ue.price??0)*(ue.discount_percentage??0)/100;return w+K},0),[p]),fe=y.useMemo(()=>S-ge,[S,ge]);return y.useEffect(()=>{if(fe>0&&U){const w=`upi://pay?pa=${U}&pn=ClinicName&am=${fe.toFixed(2)}&cu=INR`;E(w)}else E("")},[fe,U]),f?e.jsx("div",{className:"loading-pulse",children:"Loading Lab Bill..."}):x?e.jsxs("div",{className:"error-message-box",children:["Error: ",x]}):n?e.jsxs("div",{className:"pharmacy-billing-page",children:[" ",e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"LAB INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:I?`${I} Lab`:"Lab Bill"}),(B||C)&&e.jsxs("div",{className:"clinic-details-print",children:[B&&e.jsx("span",{className:"small-text clinic-address",children:B}),C&&e.jsx("span",{className:"small-text clinic-notes",children:C})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Oa,{size:16})," Patient Name"]})," ",o]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(jc,{size:16})," Token"]})," ",c??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Li,{size:16})," Order Date"]})," ",new Date(n.createdAt).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(vt,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Lab Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Oa,{size:16})," Patient Name"]})," ",o]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(jc,{size:16})," Token"]})," ",c??"N/A"]}),e.jsxs("div",{className:"info-item no-print",children:[e.jsxs("strong",{children:[e.jsx(Ga,{size:16})," Order ID"]})," ",n.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Li,{size:16})," Order Date"]})," ",new Date(n.createdAt).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Lab Tests"})}),p.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"TEST DESCRIPTION"}),e.jsx("th",{children:"PRICE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:p.map((w,ue)=>{const Ne=w.price??0,K=Ne*(w.discount_percentage??0)/100,Y=Ne-K;return e.jsxs("tr",{children:[e.jsx("td",{children:ue+1}),e.jsx("td",{children:w.name}),e.jsx("td",{children:typeof w.price=="number"?w.price.toFixed(2):Number(w.price||0).toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:w.discount_percentage||"",onChange:V=>L(ue,parseFloat(V.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsx("td",{children:Y.toFixed(2)})]},ue)})})]}):e.jsx("p",{children:"No tests in this order."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[T&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${D!=="upi"?"hide-on-screen":""}`,children:[e.jsx(Ml,{value:T,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]}),e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",S.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Total Discount (",P.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ",ge.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",fe.toFixed(2)]})})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",S.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ",ge.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:P===0?"":P,onChange:w=>R(parseFloat(w.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:N||n.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",fe.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:T?e.jsxs(e.Fragment,{children:[e.jsx(Ml,{value:T,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:D,onChange:w=>_(w.target.value),className:"payment-mode-select",disabled:N||n.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),e.jsxs("div",{className:"bill-actions",children:[n.status!=="billed"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:Z,className:"secondary-button print-preview-button no-print",disabled:N||p.length===0,children:"Print Preview"}),e.jsx("button",{onClick:Q,className:"primary-button",disabled:N||p.length===0,children:N?"Processing...":"Finalise and Bill"})]}),n.status==="billed"&&e.jsx("button",{onClick:()=>t("/billing",{state:{billId:n.bill_id}}),className:"secondary-button",children:"View Bill"})]})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})]}):e.jsx("div",{className:"error-message-box",children:"No order data available."})},d$=()=>{const t=ot(),[s,n]=y.useState(!0),[r,o]=y.useState([]),[u,c]=y.useState(""),[d,p]=y.useState(!0),[m,f]=y.useState(!1),[g,x]=y.useState({admissionCharge:"0.00",perDayCharge:"0.00",otherCharges:"0.00",aiMemory:"",clinicWideSystemPrompt:"",gemini_api_key:"",low_stock_threshold:"10",name:"",logoUrl:"",upi_id:"",address:"",notes:"",voice_ai_language:"en-US"}),[j,N]=y.useState(null),[k,D]=y.useState(!1),_=(C,A)=>{N({type:C,message:A}),setTimeout(()=>N(null),3e3)},T=C=>{switch(C){case"doctor":return e.jsx(o0,{size:14,className:"text-blue-600"});case"receptionist":return e.jsx(mf,{size:14,className:"text-green-600"});case"pharmacy":return e.jsx(vr,{size:14,className:"text-purple-600"});case"lab":return e.jsx(Ga,{size:14,className:"text-yellow-600"});default:return e.jsx(Id,{size:14,className:"text-gray-500"})}},E=C=>{switch(C){case"doctor":return"avatar-blue";case"receptionist":return"avatar-green";case"pharmacy":return"avatar-purple";case"lab":return"avatar-yellow";default:return"avatar-gray"}},U=y.useCallback(async()=>{n(!0);try{const C=await ae("/staff");if(C.ok){const A=await C.json();o(A.map(P=>({...P,id:P._id||P.id})))}}catch(C){console.error("Error fetching staff:",C),_("error","Failed to load staff list")}finally{n(!1)}},[]),X=y.useCallback(async()=>{p(!0);try{const C=await ae("/api/clinics/settings");if(C.ok){const A=await C.json();x({admissionCharge:parseFloat(A.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(A.perDayCharge||0).toFixed(2),otherCharges:parseFloat(A.otherCharges||0).toFixed(2),aiMemory:A.aiMemory||"",clinicWideSystemPrompt:A.clinicWideSystemPrompt||"",gemini_api_key:A.gemini_api_key||"",low_stock_threshold:A.low_stock_threshold!==void 0&&A.low_stock_threshold!==null?String(A.low_stock_threshold):"10",name:A.name||"",logoUrl:A.logoUrl||"",upi_id:A.upi_id||"",address:A.address||"",notes:A.notes||"",clinic_id:A.clinic_id,voice_ai_language:A.voice_ai_language||"en-US"})}}catch(C){console.error("Error fetching settings:",C),_("error","Failed to load settings")}finally{p(!1)}},[]);y.useEffect(()=>{U(),X()},[U,X]);const I=C=>{const{name:A,value:P}=C.target;x($=>({...$,[A]:P}))},F=async()=>{f(!0);try{const C=parseFloat(g.admissionCharge),A=parseFloat(g.perDayCharge),P=parseFloat(g.otherCharges),$=parseInt(g.low_stock_threshold);if((await ae("/api/clinics/settings",{method:"PUT",body:JSON.stringify({name:g.name,admissionCharge:C,perDayCharge:A,otherCharges:P,aiMemory:g.aiMemory,clinicWideSystemPrompt:g.clinicWideSystemPrompt,gemini_api_key:g.gemini_api_key,low_stock_threshold:$,logoUrl:g.logoUrl,upi_id:g.upi_id,address:g.address,notes:g.notes,voice_ai_language:g.voice_ai_language})})).ok)_("success","Changes saved successfully");else throw new Error("Failed to save")}catch(C){console.error("Error saving settings:",C),_("error","Failed to save settings")}finally{f(!1)}},B=r.filter(C=>C.name.toLowerCase().includes(u.toLowerCase())||C.role.toLowerCase().includes(u.toLowerCase())),G=async C=>{for(const A of C){const P=document.getElementById(A);P&&(P.scrollIntoView({behavior:"smooth",block:"center"}),P.classList.add("ai-feedback-glow"),await new Promise($=>setTimeout($,1500)),P.classList.remove("ai-feedback-glow"))}};return e.jsxs("div",{className:"clinic-hub-container",children:[e.jsxs("header",{className:"clinic-hub-header",children:[e.jsxs("div",{className:"clinic-hub-title",children:[e.jsx("h1",{children:"Clinic Hub"}),e.jsx("p",{className:"clinic-hub-subtitle",children:"Manage your ecosystem"})]}),e.jsxs("div",{className:"clinic-hub-actions",children:[j&&e.jsx("div",{className:`px-4 py-2 rounded-md text-sm font-medium ${j.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:j.message}),e.jsxs("button",{className:"btn-add-staff",onClick:()=>t("/dashboard/staff/add"),children:[e.jsx(Ia,{size:16})," Add Staff"]}),e.jsxs("button",{className:"btn-save-changes",onClick:F,disabled:m,children:[e.jsx(wr,{size:16})," ",m?"Saving...":"Save Changes"]})]})]}),e.jsxs("main",{className:"clinic-hub-content",children:[e.jsxs("div",{className:"team-directory-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(Bl,{size:18,className:"text-gray-500"}),e.jsxs("span",{className:"panel-title",children:["Team Directory (",r.length,")"]})]}),e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(mn,{size:16,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Find member...",className:"search-input",value:u,onChange:C=>c(C.target.value)})]})}),e.jsx("div",{className:"team-list",children:s?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"Loading staff..."}):B.length===0?e.jsx("div",{className:"empty-state",children:"No staff found."}):B.map(C=>e.jsxs("div",{id:`staff-member-${C.id}`,className:"team-member-item",children:[e.jsx("div",{className:`member-avatar ${E(C.role)}`,children:C.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-name",children:C.name}),e.jsxs("div",{className:"member-role",children:[T(C.role),C.role]})]}),e.jsx("span",{className:`member-status ${C.active?"status-active":"status-inactive"}`,children:C.active?"Active":"Inactive"}),e.jsx("button",{className:"btn-edit-member",onClick:()=>t(`/dashboard/staff/edit/${C.id}`),children:e.jsx(ds,{size:16})})]},C.id))})]}),e.jsxs("div",{className:"config-console-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(n0,{size:18,className:"text-gray-500"}),e.jsx("span",{className:"panel-title",children:"Configuration Console"})]}),d?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading settings..."}):e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(s0,{size:16})," CLINIC IDENTITY & LOCATION"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Clinic Name"}),e.jsx("input",{type:"text",className:"form-input",name:"name",id:"setting-name",value:g.name,onChange:I})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Logo URL"}),e.jsx("input",{type:"url",className:"form-input",placeholder:"https://",name:"logoUrl",id:"setting-logoUrl",value:g.logoUrl,onChange:I})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{className:"form-textarea",placeholder:"Full physical address",name:"address",id:"setting-address",value:g.address,onChange:I})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(Ll,{size:16})," FINANCIAL OPERATIONS"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Admission Charge ()"}),e.jsx("input",{type:"number",className:"form-input",name:"admissionCharge",id:"setting-admissionCharge",value:g.admissionCharge,onChange:I})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Per Day Charge ()"}),e.jsx("input",{type:"number",className:"form-input",name:"perDayCharge",id:"setting-perDayCharge",value:g.perDayCharge,onChange:I})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Other Charges ()"}),e.jsx("input",{type:"number",className:"form-input",name:"otherCharges",id:"setting-otherCharges",value:g.otherCharges,onChange:I})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"UPI ID"}),e.jsx("input",{type:"text",className:"form-input",name:"upi_id",id:"setting-upi_id",value:g.upi_id,onChange:I})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(i0,{size:16})," INVENTORY & AI"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",className:"form-input",name:"low_stock_threshold",id:"setting-low_stock_threshold",value:g.low_stock_threshold,onChange:I})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Voice AI Language"}),e.jsxs("select",{className:"form-input",name:"voice_ai_language",id:"setting-voice_ai_language",value:g.voice_ai_language,onChange:C=>x(A=>({...A,voice_ai_language:C.target.value})),children:[e.jsx("option",{value:"en-US",children:"English"}),e.jsx("option",{value:"hi-IN",children:"Hindi"}),e.jsx("option",{value:"te-IN",children:"Telugu"}),e.jsx("option",{value:"bn-IN",children:"Bengali"}),e.jsx("option",{value:"mr-IN",children:"Marathi"}),e.jsx("option",{value:"ta-IN",children:"Tamil"}),e.jsx("option",{value:"gu-IN",children:"Gujarati"}),e.jsx("option",{value:"kn-IN",children:"Kannada"}),e.jsx("option",{value:"ml-IN",children:"Malayalam"}),e.jsx("option",{value:"pa-IN",children:"Punjabi"}),e.jsx("option",{value:"es-ES",children:"Spanish"}),e.jsx("option",{value:"fr-FR",children:"French"}),e.jsx("option",{value:"de-DE",children:"German"}),e.jsx("option",{value:"it-IT",children:"Italian"}),e.jsx("option",{value:"pt-PT",children:"Portuguese"}),e.jsx("option",{value:"ru-RU",children:"Russian"}),e.jsx("option",{value:"ja-JP",children:"Japanese"}),e.jsx("option",{value:"ko-KR",children:"Korean"}),e.jsx("option",{value:"zh-CN",children:"Chinese (Simplified)"}),e.jsx("option",{value:"ar-SA",children:"Arabic"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Gemini API Key"}),e.jsx("input",{type:"password",className:"form-input",name:"gemini_api_key",id:"setting-gemini_api_key",value:g.gemini_api_key,onChange:I,placeholder:"******************"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"Clinic-Wide System Prompt"}),e.jsx("textarea",{className:"form-textarea",name:"clinicWideSystemPrompt",id:"setting-clinicWideSystemPrompt",value:g.clinicWideSystemPrompt,onChange:I,placeholder:"Instructions for the AI..."})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"AI Memory (Context)"}),e.jsx("textarea",{className:"form-textarea",name:"aiMemory",id:"setting-aiMemory",value:g.aiMemory,onChange:I,placeholder:"Shared context for the AI..."})]})]})]})]})]})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex justify-end",children:e.jsx("div",{className:"w-96 bg-white h-full shadow-2xl animate-slide-in-right",children:e.jsx(Nv,{onClose:()=>D(!1),settings:g,staffList:r,onSettingsUpdate:X,onStaffUpdate:U,onHighlight:G})})})]})},h$="_container_1sjqk_1",m$="_header_1sjqk_15",p$="_title_1sjqk_37",f$="_controls_1sjqk_51",g$="_dateInputGroup_1sjqk_63",x$="_dateInputLabel_1sjqk_75",y$="_dateInput_1sjqk_63",b$="_section_1sjqk_121",j$="_sectionTitle_1sjqk_137",v$="_statsGrid_1sjqk_157",N$="_statCard_1sjqk_171",w$="_statTitle_1sjqk_197",S$="_statValue_1sjqk_213",k$="_statSubtitle_1sjqk_225",C$="_revenueGrid_1sjqk_239",_$="_revenueCard_1sjqk_253",D$="_revenueCardTitle_1sjqk_267",E$="_revenueCardList_1sjqk_281",T$="_revenueCardListItem_1sjqk_293",A$="_tableContainer_1sjqk_321",P$="_table_1sjqk_321",I$="_textGreen_1sjqk_395",O$="_textRed_1sjqk_403",z$="_loadingContainer_1sjqk_421",R$="_errorAlert_1sjqk_439",bt={container:h$,header:m$,title:p$,controls:f$,dateInputGroup:g$,dateInputLabel:x$,dateInput:y$,section:b$,sectionTitle:j$,statsGrid:v$,statCard:N$,statTitle:w$,statValue:S$,statSubtitle:k$,revenueGrid:C$,revenueCard:_$,revenueCardTitle:D$,revenueCardList:E$,revenueCardListItem:T$,tableContainer:A$,table:P$,textGreen:I$,textRed:O$,loadingContainer:z$,errorAlert:R$},L$=()=>{const t=ot(),s=za(),n=new URLSearchParams(s.search),r=n.get("startDate"),o=n.get("endDate"),u=new Date().toISOString().split("T")[0],[c,d]=y.useState(r||u),[p,m]=y.useState(o||u),[f,g]=y.useState(!1),[x,j]=y.useState(null),{setAnalysisDateRange:N,analysisDateRange:k,setAnalysisData:D,registerAnalysisNavigator:_,registerAnalysisRefresher:T}=Od(),[E,U]=y.useState(0),[X,I]=y.useState(0),[F,B]=y.useState(null),[G,C]=y.useState(null),[A,P]=y.useState({reception:{},pharmacy:{},lab:{}}),[$,J]=y.useState(null),R=y.useCallback(async(M,Z)=>{g(!0),j(null);const Q=M||c,S=Z||p;if(U(0),I(0),B(null),C(null),P({reception:{},pharmacy:{},lab:{}}),J(null),!Q||!S){j("Please select both start and end dates."),g(!1);return}try{const ge=jS(),[fe,w,ue,Ne]=await Promise.all([ae(`/api/bills?startDate=${c}&endDate=${p}`),ae(`/api/payment/admission?startDate=${c}&endDate=${p}`),ae(`/api/subscriptions/transactions/manual?startDate=${c}&endDate=${p}`),ge?ae(`/api/inventory/comprehensive-analysis?startDate=${c}&endDate=${p}&clinicId=${ge}`):Promise.resolve(null)]);if(fe.ok&&w.ok&&ue.ok){const K=await fe.json(),Y=await w.json(),V=await ue.json(),oe=K.bills||[],Pe=Y.admissionPayments||[],se=V||[];let Ce=0,ee=0;const je={},Ie={consultation:0,pharmacy:0,lab:0,other:0},$e={reception:{},pharmacy:{},lab:{}};oe.forEach(Fe=>{if(Fe.status==="paid"||Fe.type==="pharmacy_return"){const Be=parseFloat(Fe.amount.toString()),qe=Fe.payment_mode||"Unknown";let et=Fe.type||"other";et==="pharmacy_return"&&(ee+=Be,et="pharmacy"),Ce+=Be,je[qe]=(je[qe]||0)+Be,Ie.hasOwnProperty(et)?Ie[et]=(Ie[et]||0)+Be:Ie.other=(Ie.other||0)+Be,et==="pharmacy"?$e.pharmacy[qe]=($e.pharmacy[qe]||0)+Be:et==="lab"?$e.lab[qe]=($e.lab[qe]||0)+Be:$e.reception[qe]=($e.reception[qe]||0)+Be}}),Pe.forEach(Fe=>{const Be=parseFloat(Fe.amount_paid.toString()),qe=Fe.payment_mode||"Unknown";Ce+=Be,je[qe]=(je[qe]||0)+Be,$e.reception[qe]=($e.reception[qe]||0)+Be}),se.forEach(Fe=>{var et,ye;const Be=parseFloat(((ye=(et=Fe.subscriptionPlan)==null?void 0:et.price)==null?void 0:ye.toString())??"0"),qe=Fe.subscription_payment_method||"manual";Ce+=Be,je[qe]=(je[qe]||0)+Be,$e.reception[qe]=($e.reception[qe]||0)+Be}),U(Ce),I(ee),B(je),C(Ie),P($e)}if(Ne&&Ne.ok){const K=await Ne.json();J(K)}}catch(ge){console.error("Analysis Fetch Error:",ge),j("Failed to fetch analysis data. Please try again.")}finally{g(!1)}},[c,p]);y.useEffect(()=>{_(M=>{const Z=`analysis-${M}`,Q=document.getElementById(Z);Q&&(Q.scrollIntoView({behavior:"smooth",block:"center"}),Q.classList.add("ai-highlight-glow"),setTimeout(()=>Q.classList.remove("ai-highlight-glow"),2e3))})},[_]),y.useEffect(()=>{T(async()=>(await R(),null))},[T,R]),y.useEffect(()=>{if(k.startDate&&k.endDate){const M=k.startDate.toISOString().split("T")[0],Z=k.endDate.toISOString().split("T")[0];(M!==c||Z!==p)&&(d(M),m(Z))}},[k]),y.useEffect(()=>{const M=new URLSearchParams(s.search),Z=M.get("section"),Q=M.get("startDate"),S=M.get("endDate");if(Q&&S){d(Q),m(S);const ge=k.startDate?k.startDate.toISOString().split("T")[0]:null,fe=k.endDate?k.endDate.toISOString().split("T")[0]:null;(ge!==Q||fe!==S)&&N({startDate:new Date(Q),endDate:new Date(S)})}if(Z){const ge=`analysis-${Z}`;setTimeout(()=>{const fe=document.getElementById(ge);fe&&(fe.scrollIntoView({behavior:"smooth",block:"center"}),fe.classList.add("ai-highlight-glow"),setTimeout(()=>fe.classList.remove("ai-highlight-glow"),2e3))},500)}},[s.search]),y.useEffect(()=>{R()},[c,p,R]),y.useEffect(()=>{!f&&(E>0||$)&&D({totalRevenue:E,inventoryValue:0,pharmacyRevenue:(G==null?void 0:G.pharmacy)||0,labRevenue:(G==null?void 0:G.lab)||0,receptionRevenue:((G==null?void 0:G.consultation)||0)+((G==null?void 0:G.other)||0),inventorySummary:$?{totalItemsAnalyzed:$.pharmacyAnalysis.length,netPositiveItems:$.pharmacyAnalysis.filter(M=>M.net_change>0).length}:null})},[E,$,G,f,D]);const L=M=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(M);return e.jsxs("div",{className:bt.container,children:[e.jsxs("div",{className:bt.header,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(vt,{size:20,className:"text-gray-600"})}),e.jsx("h1",{className:bt.title,children:"Analysis Dashboard"})]}),e.jsxs("div",{className:bt.controls,children:[e.jsxs("div",{className:bt.dateInputGroup,children:[e.jsx("label",{className:bt.dateInputLabel,children:"From:"}),e.jsx("input",{type:"date",className:bt.dateInput,value:c,onChange:M=>{d(M.target.value),p&&N({startDate:new Date(M.target.value),endDate:new Date(p)})}})]}),e.jsxs("div",{className:bt.dateInputGroup,children:[e.jsx("label",{className:bt.dateInputLabel,children:"To:"}),e.jsx("input",{type:"date",className:bt.dateInput,value:p,onChange:M=>{m(M.target.value),c&&N({startDate:new Date(c),endDate:new Date(M.target.value)})}})]})]})]}),x&&e.jsxs("div",{className:bt.errorAlert,children:[e.jsx(pn,{size:20}),e.jsx("span",{children:x})]}),!f&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:bt.section,id:"analysis-financial",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ll,{className:"text-blue-600"}),e.jsx("h2",{className:bt.sectionTitle,children:"Financial Performance"})]}),e.jsxs("div",{className:bt.statsGrid,children:[e.jsxs("div",{className:bt.statCard,children:[e.jsx("div",{className:bt.statTitle,children:"Total Revenue Collected"}),e.jsx("div",{className:`${bt.statValue} text-blue-600`,children:L(E)}),e.jsx("div",{className:bt.statSubtitle,children:"All payment modes"})]}),F&&Object.entries(F).map(([M,Z])=>e.jsxs("div",{className:bt.statCard,children:[e.jsxs("div",{className:bt.statTitle,children:[M," Collections"]}),e.jsx("div",{className:bt.statValue,children:L(Z)})]},M))]}),A&&e.jsxs("div",{className:bt.revenueGrid,children:[e.jsxs("div",{className:bt.revenueCard,children:[e.jsx("h3",{className:bt.revenueCardTitle,children:"Reception / Clinic"}),e.jsx("div",{className:"text-2xl font-bold mb-2",children:L(((G==null?void 0:G.consultation)||0)+((G==null?void 0:G.other)||0))}),e.jsx("ul",{className:bt.revenueCardList,children:Object.entries(A.reception).map(([M,Z])=>e.jsxs("li",{className:bt.revenueCardListItem,children:[e.jsx("span",{children:M}),e.jsx("span",{className:"font-medium text-gray-900",children:L(Z)})]},M))})]}),e.jsxs("div",{className:bt.revenueCard,children:[e.jsx("h3",{className:bt.revenueCardTitle,children:"Pharmacy"}),e.jsx("div",{className:"text-2xl font-bold mb-2",children:L((G==null?void 0:G.pharmacy)||0)}),X<0&&e.jsxs("div",{className:"text-sm text-red-500 mb-2",children:["Returns: ",L(X)]}),e.jsx("ul",{className:bt.revenueCardList,children:Object.entries(A.pharmacy).map(([M,Z])=>e.jsxs("li",{className:bt.revenueCardListItem,children:[e.jsx("span",{children:M}),e.jsx("span",{className:"font-medium text-gray-900",children:L(Z)})]},M))})]}),e.jsxs("div",{className:bt.revenueCard,children:[e.jsx("h3",{className:bt.revenueCardTitle,children:"Laboratory"}),e.jsx("div",{className:"text-2xl font-bold mb-2",children:L((G==null?void 0:G.lab)||0)}),e.jsx("ul",{className:bt.revenueCardList,children:Object.entries(A.lab).map(([M,Z])=>e.jsxs("li",{className:bt.revenueCardListItem,children:[e.jsx("span",{children:M}),e.jsx("span",{className:"font-medium text-gray-900",children:L(Z)})]},M))})]})]})]}),e.jsxs("section",{className:bt.section,id:"analysis-inventory",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Nr,{className:"text-emerald-600"}),e.jsx("h2",{className:bt.sectionTitle,children:"Inventory Movement"})]}),$&&$.pharmacyAnalysis.length>0?e.jsx("div",{className:bt.tableContainer,children:e.jsxs("table",{className:bt.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Stock In"}),e.jsx("th",{children:"Stock Out"}),e.jsx("th",{children:"Net Change"}),e.jsx("th",{className:"text-right",children:"Est. Revenue"}),e.jsx("th",{className:"text-right",children:"Est. Profit"})]})}),e.jsx("tbody",{children:$.pharmacyAnalysis.map(M=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:M.name}),e.jsx("div",{className:"text-xs text-gray-500",children:M.supplier})]}),e.jsxs("td",{className:bt.textGreen,children:["+",M.quantity_in,Object.entries(M.quantity_in_by_reason).map(([Z,Q])=>e.jsxs("div",{className:"text-xs opacity-75",children:[Z,": ",Q]},Z))]}),e.jsxs("td",{className:bt.textRed,children:["-",M.quantity_out,Object.entries(M.quantity_out_by_reason).map(([Z,Q])=>e.jsxs("div",{className:"text-xs opacity-75",children:[Z,": ",Q]},Z))]}),e.jsx("td",{children:e.jsxs("span",{className:`font-semibold ${M.net_change>=0?"text-green-600":"text-red-600"}`,children:[M.net_change>0?"+":"",M.net_change]})}),e.jsx("td",{className:"text-right font-medium",children:L(M.revenue)}),e.jsx("td",{className:`text-right font-medium ${M.profit>=0?"text-green-600":"text-red-600"}`,children:L(M.profit)})]},M.drug_id))})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500 mb-4 bg-gray-50 rounded-lg border border-dashed border-gray-300",children:"No inventory movement recorded for this period."})]})]}),f&&e.jsxs("div",{className:bt.loadingContainer,children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("div",{children:"Analyzing Financial & Inventory Data..."})]})]})};function $$(){const[t,s]=y.useState(!1),[n,r]=y.useState(null),[o,u]=y.useState(!0),[c,d]=y.useState(null),[p,m]=y.useState(!1),f=E=>{r(E),s(!0),E.role==="admin"&&!E.has_seen_tutorial&&m(!0)},g=()=>{s(!1),r(null),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")};y.useEffect(()=>{const E=localStorage.getItem("authToken"),U=localStorage.getItem("currentUser");if(E&&U)try{const X=JSON.parse(U);r(X),s(!0),X.role==="admin"&&!X.has_seen_tutorial&&m(!0)}catch(X){console.error("Error parsing stored user data:",X),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")}u(!1)},[]),y.useEffect(()=>{(async()=>{if(t&&n)try{const U=await eL();d(U)}catch(U){console.error("Error fetching clinic pro plan status:",U),d({hasProPlan:!1})}else d(null)})()},[t,n]);const[x,j]=y.useState(null),[N,k]=y.useState(!1);y.useEffect(()=>{const E=U=>{U.preventDefault(),j(U),k(!0),console.log("beforeinstallprompt event fired")};return window.addEventListener("beforeinstallprompt",E),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&(console.log("App is already installed (standalone)."),k(!1)),()=>{window.removeEventListener("beforeinstallprompt",E)}},[]),y.useEffect(()=>{const E=window.matchMedia("(prefers-color-scheme: dark)"),U=()=>{E.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")};return U(),E.addEventListener("change",U),()=>{E.removeEventListener("change",U),document.body.classList.remove("dark-mode")}},[]);const D=y.useCallback(async()=>{if(!x){console.log("Install prompt event not available.");return}const E=x;E.prompt();const{outcome:U}=await E.userChoice;console.log(`User response to the install prompt: ${U}`),j(null),k(!1)},[x]),_=async()=>{if(n)try{(await ae(`/api/users/${n.id}/tutorial-seen`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({has_seen_tutorial:!0})})).ok?(r(U=>U?{...U,has_seen_tutorial:!0}:null),localStorage.setItem("currentUser",JSON.stringify({...n,has_seen_tutorial:!0})),m(!1)):console.error("Failed to update tutorial status on backend.")}catch(E){console.error("Error marking tutorial as seen:",E)}};return o?e.jsx(cS,{}):e.jsx(dS,{clientId:"277898779560-33obduhn8r758rini4qagetdrupvisri.apps.googleusercontent.com",children:e.jsx(bS,{children:e.jsx(xS,{children:e.jsx(yS,{children:e.jsxs(yw,{children:[e.jsx(gS,{children:e.jsxs(Dl,{children:[e.jsx(Ye,{path:"/login",element:t?e.jsx(Pt,{to:"/dashboard"}):e.jsx(UA,{onLoginSuccess:f})}),e.jsx(Ye,{path:"/register",element:t?e.jsx(Pt,{to:"/dashboard"}):e.jsx(qA,{})}),e.jsx(Ye,{path:"/handle-complaint-url",element:t?e.jsx(_L,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/live-api",element:t?e.jsx(BT,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/create-lab-order",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Ov,{currentUser:n})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/manage-admission",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Pv,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/lab/report/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Yj,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/lab/enter-report/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Yj,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/add-patient",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Qp,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/billing",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(lR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/edit-complaint/:recordId",element:t&&n?e.jsx(Vj,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/edit-complaint/patient/:patientId",element:t&&n?e.jsx(Vj,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/edit-pharmacy-order/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(F1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/*",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:F$(n.role,n,ae)}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/lab/view-report/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(yR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/lab/search-report",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(bR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/patient/:patientId/lab-reports",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(jR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/patient/:patientId/pharmacy-orders",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(oR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/inventory",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(M1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/inventory/add",element:t&&n?e.jsx(Pt,{to:"/dashboard/purchase",replace:!0}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/inventory/edit/:id",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Rv,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/lab-inventory",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Of,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/patient/:patientId/complaints",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(iR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/patient/:patientId/admission-bill/:billId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(SR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/start-subscription/:patientId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(VR,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/start-clinic-subscription",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(sL,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/refill-reminders",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(CL,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/create-custom-bill",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(Iv,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/pharmacy-billing/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(c$,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/lab-billing/:orderId",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(u$,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/analysis",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(L$,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"/dashboard/clinic-hub",element:t&&n?e.jsx(nn,{user:n,onLogout:g,showInstallPrompt:N,onInstallClick:D,clinicProPlanStatus:c,children:e.jsx(d$,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(Ye,{path:"*",element:e.jsx(Pt,{to:t?"/dashboard":"/login"})})]})}),p&&(n==null?void 0:n.role)==="admin"&&e.jsx(kL,{onClose:()=>m(!1),onMarkAsSeen:_}),t&&n&&e.jsx(M$,{user:n}),t&&n&&e.jsx(BA,{})]})})})})})}const F$=(t,s,n)=>{switch(t){case"superadmin":return e.jsxs(Dl,{children:[e.jsx(Ye,{index:!0,element:e.jsx(vL,{})}),e.jsx(Ye,{path:"clinic-subscriptions",element:e.jsx(tL,{})}),e.jsx(Ye,{path:"clinic-subscriptions/add",element:e.jsx(nL,{})}),e.jsx(Ye,{path:"clinic-subscriptions/edit/:id",element:e.jsx(aL,{})}),e.jsx(Ye,{path:"users",element:e.jsx(iL,{})})," ",e.jsx(Ye,{path:"*",element:e.jsx("div",{children:"Unknown Super Admin Section"})})]});case"admin":return e.jsxs(Dl,{children:[e.jsxs(Ye,{path:"/",element:e.jsx(QA,{fetchWithAuth:n}),children:[e.jsx(Ye,{index:!0,element:e.jsx(fP,{})}),e.jsx(Ye,{path:"search-patient",element:e.jsx(mc,{})}),e.jsx(Ye,{path:"patients",element:e.jsx(Gp,{})})]}),e.jsx(Ye,{path:"staff",element:e.jsx(wR,{fetchWithAuth:n})}),e.jsx(Ye,{path:"staff/add",element:e.jsx(CP,{clinicId:s==null?void 0:s.clinic_id})}),e.jsx(Ye,{path:"staff/edit/:id",element:e.jsx(_P,{})}),e.jsx(Ye,{path:"patients/add",element:e.jsx(Qp,{})}),e.jsx(Ye,{path:"inventory",element:e.jsx(zv,{})}),e.jsx(Ye,{path:"inventory/edit/:id",element:e.jsx(Rv,{})}),e.jsx(Ye,{path:"distributors",element:e.jsx(Xj,{})}),e.jsx(Ye,{path:"purchase",element:e.jsx(Kj,{})})," ",e.jsx(Ye,{path:"queue",element:e.jsx(op,{})}),e.jsx(Ye,{path:"subscriptions",element:e.jsx(UR,{})}),e.jsx(Ye,{path:"subscriptions/add",element:e.jsx(qR,{})}),e.jsx(Ye,{path:"subscriptions/edit/:id",element:e.jsx(HR,{})}),e.jsx(Ye,{path:"*",element:e.jsx("div",{children:"Unknown Admin Section"})})," "]});case"doctor":return e.jsxs(Dl,{children:[e.jsx(Ye,{index:!0,element:e.jsx(Pt,{to:"search-patient",replace:!0})}),e.jsx(Ye,{path:"search-patient",element:e.jsx(mc,{})}),e.jsx(Ye,{path:"queue",element:e.jsx(op,{})}),e.jsx(Ye,{path:":patientId",element:e.jsx(op,{})}),e.jsx(Ye,{path:"add-patient",element:e.jsx(Qp,{})}),e.jsx(Ye,{path:"*",element:e.jsx("div",{children:"Unknown Doctor Section"})})]});case"receptionist":return e.jsxs(Dl,{children:[e.jsx(Ye,{index:!0,element:e.jsx(bP,{currentUser:s})}),e.jsx(Ye,{path:"all-patients",element:e.jsx(Gp,{})}),e.jsx(Ye,{path:"search-patient",element:e.jsx(mc,{})}),e.jsx(Ye,{path:"*",element:e.jsx("div",{children:"Unknown Reception Section"})})," "]});case"lab":return e.jsx(NP,{});case"pharmacy":return e.jsxs(Dl,{children:[e.jsx(Ye,{index:!0,element:e.jsx(wP,{})}),e.jsx(Ye,{path:"inventory",element:e.jsx(M1,{})}),e.jsx(Ye,{path:"settings",element:e.jsx(kP,{})}),e.jsx(Ye,{path:"add-order",element:e.jsx(cR,{})}),e.jsx(Ye,{path:"edit-pharmacy-order/:orderId",element:e.jsx(F1,{})}),e.jsx(Ye,{path:"orders/:orderId",element:e.jsx(zR,{})}),e.jsx(Ye,{path:"search-patient-records",element:e.jsx(mc,{})}),e.jsx(Ye,{path:"distributors",element:e.jsx(Xj,{})}),e.jsx(Ye,{path:"purchase",element:e.jsx(Kj,{})})," ",e.jsx(Ye,{path:"*",element:e.jsx(Pt,{to:"/dashboard",replace:!0})})]});default:return e.jsxs("div",{children:["Unknown role (",t,") or dashboard not implemented."]},t)}},nn=({user:t,onLogout:s,children:n,showInstallPrompt:r,onInstallClick:o,clinicProPlanStatus:u})=>{const c=ot(),[d,p]=y.useState(!1),[m,f]=y.useState(window.innerWidth<=768),[g,x]=y.useState(null),[j,N]=y.useState(!1);y.useEffect(()=>Op.subscribe(T=>{N(T)}),[]),y.useEffect(()=>{const T=()=>{f(window.innerWidth<=768)};return window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]),y.useEffect(()=>{(async()=>{if(t!=null&&t.clinic_id)try{const E=await ae("/api/clinics/settings");if(E.ok){const U=await E.json();x(U.logoUrl)}else console.error("Failed to fetch clinic details for display:",E.statusText),x(null)}catch(E){console.error("Error fetching clinic details for display:",E),x(null)}else x(null)})()},[t==null?void 0:t.clinic_id]);const k=()=>{p(!d)},{toggleCommandBar:D,isOpen:_}=$l();return e.jsxs("div",{className:"dashboard-layout",children:[" ",e.jsxs("nav",{className:"app-header no-print",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("a",{href:"#",onClick:T=>{T.preventDefault(),c("/dashboard")},className:"logo-container",children:e.jsx("img",{src:g||"/logo.png",alt:"App Logo",className:"logo-image"})}),e.jsxs("div",{className:"title-section",children:[e.jsx("span",{className:"app-title-link",children:"Newtons Ai"}),e.jsxs("span",{className:"user-role-panel",children:["(",t.role.charAt(0).toUpperCase()+t.role.slice(1)," Panel)"]})]})]}),e.jsxs("div",{className:"header-right",children:[r&&e.jsxs("button",{onClick:o,className:"install-button",title:"Install App",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),e.jsx("span",{children:"Install"})]}),u&&(u.hasProPlan?e.jsx("span",{className:"pro-badge",children:"PRO"}):e.jsx("button",{onClick:()=>c("/start-clinic-subscription"),className:"go-pro-button",children:"GoPro"})),!_&&e.jsx("button",{onClick:D,className:"p-2 mr-2 text-slate-500 rounded-full hover:bg-slate-100 hover:text-slate-900 transition-colors",title:"Search & Commands (Ctrl+K)",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})}),e.jsx("button",{className:"hamburger-icon",onClick:k,"aria-label":"Open navigation",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),j&&e.jsx("div",{className:"global-loading-bar"})]}),e.jsx("main",{className:"main-content",children:n}),m?e.jsx(GA,{user:t,onLogout:s,userRole:t.role,isOpen:d,onClose:k,roleNavigation:Tv}):e.jsx(VA,{user:t,onLogout:s,userRole:t.role,isOpen:d,onClose:k}),!m&&d&&e.jsx("div",{className:"side-panel-overlay",onClick:k}),!m&&d&&e.jsx("div",{className:"side-panel-overlay",onClick:k})]})},M$=({user:t})=>{const{isOpen:s,closeAssistant:n}=Od(),r=ot(),[o,u]=y.useState(null),[c,d]=y.useState([]);return y.useEffect(()=>{(async()=>{if(t!=null&&t.clinic_id)try{const[m,f]=await Promise.all([ae("/api/clinics/settings"),ae("/api/staff")]);m.ok&&u(await m.json()),f.ok&&d(await f.json())}catch(m){console.error("Failed to fetch initial AI context",m)}})()},[t.clinic_id]),s?e.jsx("div",{className:"ai-assistant-wrapper",children:e.jsx(Nv,{onClose:n,settings:o,staffList:c,onSettingsUpdate:()=>{},onStaffUpdate:()=>{},onHighlight:p=>{p.forEach(m=>{if(m.startsWith("navigate_")){const f=m.replace("navigate_","");r(`/dashboard/analysis?section=${f}`)}else{const f=document.getElementById(m);f&&(f.scrollIntoView({behavior:"smooth",block:"center"}),f.classList.add("ai-highlight-glow"),setTimeout(()=>f.classList.remove("ai-highlight-glow"),2e3))}})}})}):null};oS.createRoot(document.getElementById("root")).render(e.jsx(y.StrictMode,{children:e.jsx($$,{})}));
