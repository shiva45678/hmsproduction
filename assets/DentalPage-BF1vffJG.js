import{j as e,f as z,S,t as ke}from"./index-DE8wu5Ou.js";import{r as t,b as Pe,u as Te}from"./react-vendor-Cc0P4_ZX.js";import{X as Y,f as be,ar as Ne,aa as Ie,e as we,i as Ce,a7 as me,af as ge,u as fe,v as Se,aq as De}from"./ui-vendor-SmiJk_kJ.js";import{Q as ve}from"./index-CZ6CIOFr.js";/* empty css                            */import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Fe=({patient:w,onClose:h,onSave:D})=>{const[b,i]=t.useState({name:w.name,age:w.age,gender:w.gender,phone:w.phone||""}),[T,d]=t.useState(!1),r=async x=>{x.preventDefault(),d(!0);try{await D({...b,phone:b.phone||void 0}),h()}catch(P){console.error(P),alert("Failed to update patient")}finally{d(!1)}};return e.jsx("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{className:"modal-content",style:{backgroundColor:"white",padding:"24px",borderRadius:"12px",width:"400px",maxWidth:"90%",boxShadow:"0 4px 20px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",color:"#333"},children:"Edit Patient Details"}),e.jsx("button",{onClick:h,style:{border:"none",background:"none",cursor:"pointer",color:"#666"},children:e.jsx(Y,{size:20})})]}),e.jsxs("form",{onSubmit:r,style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Name"}),e.jsx("input",{type:"text",value:b.name,onChange:x=>i({...b,name:x.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},required:!0})]}),e.jsxs("div",{style:{display:"flex",gap:"16px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Age"}),e.jsx("input",{type:"number",value:b.age||"",onChange:x=>i({...b,age:parseInt(x.target.value)||0}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Gender"}),e.jsxs("select",{value:b.gender||"",onChange:x=>i({...b,gender:x.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem",width:"100%"},children:[e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"6px",fontSize:"0.9rem",color:"#555"},children:"Phone"}),e.jsx("input",{type:"tel",value:b.phone,onChange:x=>i({...b,phone:x.target.value}),className:"dental-search-input",style:{padding:"10px",fontSize:"0.95rem"},placeholder:"Optional"})]}),e.jsx("button",{type:"submit",className:"save-btn",style:{marginTop:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},disabled:T,children:T?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(be,{size:18})," Save Changes"]})})]})]})})},Le=w=>[1,2,3,14,15,16,17,18,19,30,31,32].includes(w)?{type:"molar",roots:2}:[4,5,12,13,20,21,28,29].includes(w)?{type:"premolar",roots:1}:[6,11,22,27].includes(w)?{type:"canine",roots:1}:{type:"incisor",roots:1},Me=({toothNumber:w,conditions:h=[],className:D,style:b,isSelected:i,bridgeConnectPrevious:T})=>{const{type:d}=Le(w),r=w<=16,x="M5,20 Q5,5 18,5 Q31,5 31,20 L29,25 Q18,28 7,25 Z",P="M7,25 Q5,40 10,44 Q14,40 14,26",o="M29,25 Q31,40 26,44 Q22,40 22,26",u="M8,20 Q8,8 18,8 Q28,8 28,20 L26,24 Q18,27 10,24 Z",y="M10,24 Q16,44 18,45 Q20,44 26,24",j="M8,22 Q18,2 28,22 L26,25 Q18,28 10,25 Z",v="M10,25 Q18,48 26,25",_="M10,22 L10,12 Q18,12 26,12 L26,22 L24,25 Q18,27 12,25 Z",F="M12,25 Q18,46 24,25";let k=x,L=[P,o];d==="incisor"?(k=_,L=[F]):d==="canine"?(k=j,L=[v]):d==="premolar"&&(k=u,L=[y]);const n=h.includes("condition-rct"),N=h.includes("condition-filling"),Z=h.includes("condition-crown"),O=h.includes("condition-bridge"),X=h.includes("condition-extraction"),A=h.includes("condition-implant"),K=n?"#e9d5ff":"#f3f4f6",J=X?"#fee2e2":"#ffffff",B=X?"#ef4444":O?"#0891b2":A?"#475569":Z?"#b45309":i?"#3b82f6":"#6b7280",H=i||O||Z||A?2:1.5,$=r?"M20,15 L56,15 L56,22 L20,22 Z":"M16,15 L-20,15 L-20,22 L16,22 Z";return e.jsxs("svg",{viewBox:"0 0 36 50",className:D,style:{width:"100%",height:"100%",overflow:"visible",...b},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"goldGradient",x1:"0",x2:"1",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#fcd34d"}),e.jsx("stop",{offset:"100%",stopColor:"#d97706"})]}),e.jsxs("linearGradient",{id:"bridgeGradient",x1:"0",x2:"1",y1:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#22d3ee"}),e.jsx("stop",{offset:"100%",stopColor:"#0891b2"})]}),e.jsxs("linearGradient",{id:"titaniumGradient",x1:"0",x2:"1",y1:"0",y2:"0",children:[e.jsx("stop",{offset:"0%",stopColor:"#475569"}),e.jsx("stop",{offset:"30%",stopColor:"#94a3b8"}),e.jsx("stop",{offset:"50%",stopColor:"#f8fafc"}),e.jsx("stop",{offset:"70%",stopColor:"#94a3b8"}),e.jsx("stop",{offset:"100%",stopColor:"#475569"})]})]}),T&&e.jsx("path",{d:$,fill:"url(#bridgeGradient)",stroke:"#0891b2",strokeWidth:"1.5"}),A?e.jsxs("g",{children:[e.jsx("path",{d:"M13,25 L23,25 L22,28 L23,29 L22,30 L22,33 L23,34 L22,35 L22,38 L23,39 L22,40 L19,46 Q18,48 17,46 L14,40 L13,39 L14,38 L14,35 L13,34 L14,33 L14,30 L13,29 L14,28 Z",fill:"url(#titaniumGradient)",stroke:B,strokeWidth:"1"}),e.jsxs("g",{stroke:"rgba(255,255,255,0.4)",strokeWidth:"0.5",children:[e.jsx("line",{x1:"14",y1:"29",x2:"22",y2:"29"}),e.jsx("line",{x1:"14",y1:"34",x2:"22",y2:"34"}),e.jsx("line",{x1:"14",y1:"39",x2:"22",y2:"39"})]}),e.jsx("rect",{x:"15",y:"22",width:"6",height:"4",fill:"#64748b",stroke:B,strokeWidth:"1",rx:"1"})]}):e.jsx("g",{fill:K,stroke:B,strokeWidth:H,strokeLinejoin:"round",children:L.map((ee,ae)=>e.jsx("path",{d:ee},ae))}),n&&!A&&e.jsx("g",{fill:"none",stroke:"#9333ea",strokeWidth:"2",strokeLinecap:"round",children:d==="molar"?e.jsxs(e.Fragment,{children:[" ",e.jsx("path",{d:"M11,26 L10,40"})," ",e.jsx("path",{d:"M25,26 L26,40"})," "]}):e.jsx("path",{d:"M18,25 L18,42"})}),e.jsx("path",{d:k,fill:O?"url(#bridgeGradient)":Z?"url(#goldGradient)":J,stroke:B,strokeWidth:H,strokeLinejoin:"round"}),N&&!Z&&!O&&!A&&e.jsx("path",{d:d==="molar"?"M12,12 Q18,18 24,12 Z":"M14,15 Q18,18 22,15 Z",fill:"#3b82f6",stroke:"none",style:{mixBlendMode:"multiply"}}),X&&e.jsxs("g",{stroke:"#ef4444",strokeWidth:"3",strokeLinecap:"round",children:[e.jsx("line",{x1:"8",y1:"8",x2:"28",y2:"42"}),e.jsx("line",{x1:"28",y1:"8",x2:"8",y2:"42"})]})]})},ze=({selectedTeeth:w,toothConditions:h={},toothDetails:D={},onToothClick:b})=>{const i=Array.from({length:16},(o,u)=>u+1),T=Array.from({length:16},(o,u)=>32-u),[d,r]=Pe.useState(null),x=o=>{const u=h[o]||[],y=w.includes(o);let j=[],v="#9ca3af",_;const F=u.includes("condition-extraction");return y&&(v="#3b82f6"),u.includes("condition-filling")&&j.push("#60a5fa"),u.includes("condition-rct")&&j.push("#c084fc"),u.includes("condition-crown")&&(j.push("#fcd34d"),v="#d97706"),u.includes("condition-bridge")&&(j.push("#22d3ee"),v="#0891b2"),u.includes("condition-implant")&&(j.push("#94a3b8"),v="#475569"),u.includes("condition-extraction")&&(j.push("#fee2e2"),v="#ef4444"),j.length===0&&y&&j.push("#eff6ff"),j.length===0&&j.push("#ffffff"),{fillColors:j,borderColor:v,overlayColor:_,isSelected:y,hasExtraction:F}},P=o=>{const{isSelected:u}=x(o),y=h[o]||[],j=D[o],v=o<=16,_=y.includes("condition-bridge");let F=!1;if(_){let k=null;v?o>1&&(k=o-1):o<32&&(k=o+1),k!==null&&(h[k]||[]).includes("condition-bridge")&&(F=!0)}return e.jsxs("div",{onClick:()=>b(o),onMouseEnter:()=>r(o),onMouseLeave:()=>r(null),className:`tooth-item-container ${u?"selected":""}`,title:"",children:[e.jsx("div",{className:"tooth-number-label",children:o}),e.jsx("div",{className:"tooth-svg-wrapper",style:{transform:v?"rotate(180deg)":"none"},children:e.jsx(Me,{toothNumber:o,conditions:y,isSelected:u,bridgeConnectPrevious:F})}),d===o&&j&&j.length>0&&e.jsxs("div",{className:"tooth-tooltip-window",children:[e.jsxs("div",{className:"tooltip-header",children:["Tooth ",o]}),e.jsx("ul",{className:"tooltip-list",children:j.map((k,L)=>e.jsx("li",{children:k},L))})]})]},o)};return e.jsxs("div",{className:"chart-container-inner",children:[e.jsx("div",{className:"arch-label",children:"Maxillary (Upper)"}),e.jsxs("div",{className:"arch-row",children:[e.jsx("div",{className:"quadrant",children:i.slice(0,8).map(o=>P(o))}),e.jsx("div",{className:"quadrant",children:i.slice(8).map(o=>P(o))})]}),e.jsxs("div",{className:"midline-divider",children:[e.jsx("div",{className:"divider-line"}),e.jsx("span",{className:"chart-label",children:"Midline"}),e.jsx("div",{className:"divider-line"})]}),e.jsxs("div",{className:"arch-row",children:[e.jsx("div",{className:"quadrant",children:T.slice(0,8).map(o=>P(o))}),e.jsx("div",{className:"quadrant",children:T.slice(8).map(o=>P(o))})]}),e.jsx("div",{className:"arch-label",children:"Mandibular (Lower)"}),e.jsxs("div",{className:"chart-legend",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box normal"}),e.jsx("span",{children:"Healthy"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box filling"}),e.jsx("span",{children:"Filling"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box rct"}),e.jsx("span",{children:"RCT"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box crown"}),e.jsx("span",{children:"Crown"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box bridge"}),e.jsx("span",{children:"Bridge"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box implant"}),e.jsx("span",{children:"Implant"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("div",{className:"legend-box extraction"}),e.jsx("span",{children:"Extraction"})]})]})]})},Ee=({onClose:w,onUpdate:h})=>{const[D,b]=t.useState([]),[i,T]=t.useState(!0),[d,r]=t.useState(null),[x,P]=t.useState({}),[o,u]=t.useState(!1),[y,j]=t.useState({name:"",cost:0,type:"general"});t.useEffect(()=>{v()},[]);const v=async()=>{T(!0);try{const n=await z("/api/dental/procedures");if(n.ok){const N=await n.json();b(N)}}catch(n){console.error(n)}finally{T(!1)}},_=async()=>{if(!(!y.name||!y.cost))try{(await z("/api/dental/procedures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)})).ok&&(u(!1),j({name:"",cost:0,type:"general"}),v(),h())}catch(n){console.error(n)}},F=async n=>{try{(await z(`/api/dental/procedures/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)})).ok&&(r(null),P({}),v(),h())}catch(N){console.error(N)}},k=async n=>{if(window.confirm("Are you sure you want to delete this procedure?"))try{(await z(`/api/dental/procedures/${n}`,{method:"DELETE"})).ok&&(v(),h())}catch(N){console.error(N)}},L=n=>{r(n.id),P({name:n.name,cost:n.cost,type:n.type})};return e.jsx("div",{className:"manage-procedures-modal-overlay",children:e.jsxs("div",{className:"manage-procedures-modal-content",children:[e.jsxs("div",{className:"manage-procedures-modal-header",children:[e.jsx("h2",{className:"manage-procedures-modal-title",children:"Manage Procedures"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:async()=>{if(window.confirm("Import missing default procedures?"))try{await z("/api/dental/procedures/import-defaults",{method:"POST"}),v(),h()}catch(n){console.error(n)}},className:"btn-secondary",style:{padding:"6px 12px",fontSize:"0.8rem"},children:"Import Defaults"}),e.jsx("button",{onClick:w,className:"manage-procedures-close-btn",children:e.jsx(Y,{size:20})})]})]}),e.jsx("div",{className:"manage-procedures-list-container",children:i?e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:"Loading procedures..."}):e.jsxs("table",{className:"manage-procedures-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"40%"},children:"Name"}),e.jsx("th",{style:{width:"20%"},children:"Type"}),e.jsx("th",{style:{width:"20%"},children:"Cost (₹)"}),e.jsx("th",{style:{width:"20%"},children:"Actions"})]})}),e.jsx("tbody",{children:D.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center",padding:"20px",color:"#888"},children:"No procedures found. Add one below."})}):D.map(n=>e.jsx("tr",{children:d===n.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:e.jsx("input",{type:"text",className:"edit-input",value:x.name||"",onChange:N=>P({...x,name:N.target.value}),placeholder:"Procedure Name"})}),e.jsx("td",{children:e.jsxs("select",{className:"edit-select",value:x.type||"general",onChange:N=>P({...x,type:N.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"}),e.jsx("option",{value:"bridge",children:"Bridge"}),e.jsx("option",{value:"implant",children:"Implant"})]})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"edit-input",value:x.cost||0,onChange:N=>P({...x,cost:parseFloat(N.target.value)}),placeholder:"Cost"})}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>F(n.id),className:"action-btn btn-save",title:"Save",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:()=>r(null),className:"action-btn btn-cancel",title:"Cancel",children:e.jsx(Y,{size:18})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{children:n.name}),e.jsx("td",{children:e.jsx("span",{className:`procedure-badge badge-${n.type}`,children:n.type})}),e.jsxs("td",{style:{fontWeight:500},children:["₹",n.cost]}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>L(n),className:"action-btn btn-edit",title:"Edit",children:e.jsx(Ne,{size:18})}),e.jsx("button",{onClick:()=>k(n.id),className:"action-btn btn-delete",title:"Delete",children:e.jsx(Ie,{size:18})})]})]})},n.id))})]})}),e.jsx("div",{className:"add-procedure-section",children:o?e.jsxs("div",{className:"add-procedure-card",children:[e.jsx("h4",{className:"add-procedure-title",children:"Add New Procedure"}),e.jsxs("div",{className:"add-form-grid",children:[e.jsx("input",{type:"text",className:"form-input",placeholder:"Procedure Name",value:y.name||"",onChange:n=>j({...y,name:n.target.value})}),e.jsxs("select",{className:"form-select",value:y.type||"general",onChange:n=>j({...y,type:n.target.value}),children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"filling",children:"Filling"}),e.jsx("option",{value:"rct",children:"RCT"}),e.jsx("option",{value:"extraction",children:"Extraction"}),e.jsx("option",{value:"crown",children:"Crown"}),e.jsx("option",{value:"bridge",children:"Bridge"}),e.jsx("option",{value:"implant",children:"Implant"})]}),e.jsx("input",{type:"number",className:"form-input",placeholder:"Cost",value:y.cost||"",onChange:n=>j({...y,cost:parseFloat(n.target.value)})}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{onClick:_,className:"btn-primary",children:"Save"}),e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary",children:"Cancel"})]})]})]}):e.jsxs("button",{onClick:()=>u(!0),className:"add-trigger-btn",children:[e.jsx(we,{size:18})," Add New Procedure"]})})]})})},Be=({toothNumber:w,procedures:h,onSelect:D,onClose:b})=>{const[i,T]=t.useState(""),d=t.useMemo(()=>h.filter(r=>r.name.toLowerCase().includes(i.toLowerCase())),[h,i]);return e.jsxs("div",{className:"modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(2px)"},children:[e.jsxs("div",{className:"modal-content",style:{backgroundColor:"var(--dp-card-bg)",borderRadius:"12px",width:"100%",maxWidth:"400px",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",overflow:"hidden",animation:"scaleUp 0.2s ease-out"},children:[e.jsxs("div",{style:{padding:"16px",borderBottom:"1px solid var(--dp-border)",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"var(--dp-bg)"},children:[e.jsxs("h3",{style:{margin:0,color:"var(--dp-text)",fontSize:"1.1rem"},children:["Tooth ",w," Procedures"]}),e.jsx("button",{onClick:b,style:{background:"none",border:"none",color:"var(--dp-text-sec)",cursor:"pointer",padding:"4px"},children:e.jsx(Y,{size:20})})]}),e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid var(--dp-border)"},children:e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center"},children:[e.jsx(Ce,{size:16,style:{position:"absolute",left:"12px",color:"var(--dp-text-sec)"}}),e.jsx("input",{type:"text",placeholder:"Search procedures...",value:i,onChange:r=>T(r.target.value),style:{width:"100%",padding:"8px 12px 8px 36px",borderRadius:"8px",border:"1px solid var(--dp-border)",backgroundColor:"var(--dp-bg)",color:"var(--dp-text)",fontSize:"0.9rem",outline:"none"},autoFocus:!0})]})}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto"},children:d.length===0?e.jsx("div",{style:{padding:"24px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.9rem"},children:"No procedures found."}):e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:d.map(r=>e.jsxs("button",{onClick:()=>D(r),style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",border:"none",background:"transparent",borderBottom:"1px solid var(--dp-border)",cursor:"pointer",textAlign:"left",transition:"background-color 0.1s"},className:"procedure-modal-item",onMouseOver:x=>x.currentTarget.style.backgroundColor="var(--dp-bg)",onMouseOut:x=>x.currentTarget.style.backgroundColor="transparent",children:[e.jsxs("div",{children:[e.jsx("div",{style:{color:"var(--dp-text)",fontWeight:500,fontSize:"0.95rem"},children:r.name}),e.jsx("div",{style:{color:"var(--dp-text-sec)",fontSize:"0.8rem",textTransform:"capitalize"},children:r.type})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",color:"var(--dp-primary)",fontWeight:600,fontSize:"0.9rem"},children:[e.jsxs("span",{children:["₹",r.cost]}),e.jsx(we,{size:16})]})]},r.id))})})]}),e.jsx("style",{children:`
                @keyframes scaleUp {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
            `})]})},Re=({isOpen:w,onClose:h,recordId:D,onBillingComplete:b})=>{var le,re,de,W,ne;const[i,T]=t.useState(null),[d,r]=t.useState([]),[x,P]=t.useState(!0),[o,u]=t.useState(null),[y,j]=t.useState(!1),[v,_]=t.useState("cash"),[F,k]=t.useState(""),[L,n]=t.useState(""),[N,Z]=t.useState(""),[O,X]=t.useState(""),[A,K]=t.useState(""),[J,B]=t.useState(0),H=t.useRef(!1),[$,ee]=t.useState(null),[ae,ie]=t.useState(!1),he=c=>{const g=Math.max(0,Math.min(100,isNaN(c)?0:c));H.current=!0,B(g);const C=d.map(m=>({...m,discount_percentage:g}));r(C)},oe=(c,g)=>{const C=[...d];C[c].discount_percentage=isNaN(g)?0:g,r(C)};t.useEffect(()=>{if(H.current){H.current=!1;return}const c=d.reduce((m,R)=>m+(R.price??0),0);if(c===0){B(0);return}const C=d.reduce((m,R)=>{const V=(R.price??0)*((R.discount_percentage??0)/100);return m+V},0)/c*100;B(m=>Math.abs(m-C)>.01?C:m)},[d]);const xe=async()=>{if(!i)return u("No record data available to bill."),null;if(d.length===0)return u("Cannot bill an empty procedure list."),null;j(!0),u(null);try{const c=d.map(I=>{const V=I.price,U=V*((I.discount_percentage??0)/100),s=V-U;return{name:I.name,price:I.price,quantity:1,total:s,item_id:I.id||`proc_${Date.now()}`,type:"service",discount_percentage:I.discount_percentage??0}}),g={patientId:i.patientId.id,items:c,amount:Q,paymentMode:v,type:"dental",related_id:i.id,status:"paid",discountPercentage:J},C=await z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}),m=await C.json();if(!C.ok||!m.id)throw new Error(m.message||"Failed to create bill.");if((await z(`/api/dental/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",billId:m.id})})).ok||console.error("Failed to update dental record status"),T(I=>I?{...I,status:"billed",billId:m.id}:null),v==="credit")try{await z(`/api/patient-debts/${i.patientId.id}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:Q,related_bill_id:m.id,notes:`Dental Bill #${m.id}`})})}catch(I){console.error("Failed to create debt entry:",I)}return alert(`Dental bill created (ID: ${m.id}).`),b&&b(),m.id}catch(c){return console.error("Billing process failed:",c),u(c.message||"Failed to create bill."),null}finally{j(!1)}},pe=()=>{window.print()},ce=async()=>{await xe()&&setTimeout(()=>window.print(),500)};t.useEffect(()=>{w&&D&&(async()=>{P(!0);try{const[g,C]=await Promise.all([z(`/api/dental/${D}`),z("/api/clinics/settings").catch(()=>({ok:!1,json:async()=>({})}))]);if(!g.ok)throw new Error("Failed to fetch dental record");const m=await g.json(),R={...m,patientId:m.Patient||m.patientId};if(T(R),C.ok){const U=await C.json();n(U.upi_id||""),Z(U.name||""),X(U.address||""),K(U.notes||"")}const V=(R.selected_procedures||R.selectedProcedures||[]).map(U=>({...U,price:U.cost,discount_percentage:0}));r(V)}catch(g){console.error("Failed to fetch data:",g),u(g.message)}finally{P(!1)}})()},[w,D]);const se=t.useMemo(()=>d.reduce((c,g)=>c+(g.price??0),0),[d]),te=t.useMemo(()=>d.reduce((c,g)=>{const m=(g.price??0)*(g.discount_percentage??0)/100;return c+m},0),[d]),Q=t.useMemo(()=>se-te,[se,te]);return t.useEffect(()=>{if(Q>0&&L){const c=`upi://pay?pa=${L}&pn=${encodeURIComponent(N)}&am=${Q.toFixed(2)}&cu=INR`;k(c)}else k("")},[Q,L,N]),t.useEffect(()=>{(async()=>{var g;if(v==="credit"&&((g=i==null?void 0:i.patientId)!=null&&g.id)){ie(!0);try{const C=await z(`/api/patient-debts/${i.patientId.id}/balance`);if(C.ok){const m=await C.json();ee(m.netDebt||0)}else ee(0)}catch{ee(0)}finally{ie(!1)}}})()},[v,(le=i==null?void 0:i.patientId)==null?void 0:le.id]),w?e.jsx("div",{className:"dental-billing-modal-overlay",children:e.jsxs("div",{className:"dental-billing-modal-content",children:[e.jsxs("header",{className:"dental-billing-modal-header no-print",children:[e.jsx("h2",{children:"Dental Invoice"}),e.jsx("button",{onClick:h,className:"close-modal-btn",children:e.jsx(Y,{size:20})})]}),e.jsx("div",{className:"dental-billing-modal-body",children:x?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsx("div",{className:"billing-container",children:e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(S,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx("div",{className:"info-item",children:e.jsx(S,{width:200,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(S,{width:150,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(S,{width:180,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(S,{width:150,height:20})})]})]}),e.jsxs("div",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(S,{width:120,height:24})})}),e.jsx("div",{className:"p-4",children:e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(S,{width:30,height:20})}),e.jsx("th",{children:e.jsx(S,{width:150,height:20})}),e.jsx("th",{children:e.jsx(S,{width:80,height:20})}),e.jsx("th",{children:e.jsx(S,{width:80,height:20})}),e.jsx("th",{children:e.jsx(S,{width:100,height:20})})]})}),e.jsx("tbody",{children:[1,2,3].map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(S,{width:20,height:20})}),e.jsx("td",{children:e.jsx(S,{width:180,height:20})}),e.jsx("td",{children:e.jsx(S,{width:70,height:20})}),e.jsx("td",{children:e.jsx(S,{width:70,height:20})}),e.jsx("td",{children:e.jsx(S,{width:90,height:20})})]},c))})]})})]})]}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(S,{width:160,height:24})})}),e.jsxs("div",{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(S,{width:100,height:20}),e.jsx(S,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(S,{width:100,height:20}),e.jsx(S,{width:80,height:20})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(S,{width:120,height:28}),e.jsx(S,{width:100,height:28})]})]})]})})]})})}):o?e.jsxs("div",{className:"error-message-box",children:["Error: ",o]}):i?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"DENTAL INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:N||"Clinic Name"}),(O||A)&&e.jsxs("div",{className:"clinic-details-print",children:[O&&e.jsx("span",{className:"small-text clinic-address",children:O}),A&&e.jsx("span",{className:"small-text clinic-notes",children:A})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(me,{size:16})," Patient Name"]})," ",((re=i.patientId)==null?void 0:re.name)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ge,{size:16})," Token"]})," ",((de=i.patientId)==null?void 0:de.patient_token_number)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(fe,{size:16})," Date"]})," ",new Date(i.date||i.createdAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(me,{size:16})," Patient Name"]})," ",((W=i.patientId)==null?void 0:W.name)||"N/A"," "]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ge,{size:16})," Token"]})," ",((ne=i.patientId)==null?void 0:ne.patient_token_number)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Se,{size:16})," Record ID"]})," ",i.id.substring(i.id.length-6)]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(fe,{size:16})," Date"]})," ",new Date(i.createdAt).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Procedures"})}),d.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"PROCEDURE"}),e.jsx("th",{children:"PRICE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:d.map((c,g)=>{const C=c.price??0,m=C*(c.discount_percentage??0)/100,R=C-m;return e.jsxs("tr",{children:[e.jsx("td",{children:g+1}),e.jsx("td",{children:c.name}),e.jsx("td",{children:c.price.toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:c.discount_percentage===0?"":c.discount_percentage,onChange:I=>oe(g,parseFloat(I.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsx("td",{children:R.toFixed(2)})]},g)})})]}):e.jsx("p",{className:"p-4 text-gray-500",children:"No procedures selected."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",se.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Discount (",J.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ₹",te.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ₹",Q.toFixed(2)]})})]}),F&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${v!=="upi"?"hide-on-screen":""}`,children:[e.jsx(ve,{value:F,size:80}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["₹",se.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ₹",te.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:J===0?"":J,onChange:c=>he(parseFloat(c.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:y||i.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["₹",Q.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:F?e.jsxs(e.Fragment,{children:[e.jsx(ve,{value:F,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"UPI QR code not available."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{value:v,onChange:c=>_(c.target.value),className:"payment-mode-select",disabled:y||i.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt)"})]})]}),v==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:"⚠️ Debt to Patient"}),ae?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:$&&$>0?"#dc3545":"#28a745"},children:["₹",($||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ₹",Q.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["₹",(($||0)+Q).toFixed(2)]})]})]})]}),e.jsx("div",{className:"bill-actions mt-6 flex flex-col gap-3",children:i.status!=="billed"?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:pe,className:"secondary-button print-preview-button no-print",disabled:y,children:"Print Preview"}),e.jsx("button",{onClick:ce,className:"primary-button",disabled:y,children:y?"Processing...":"Finalise and Bill"})]}):e.jsxs("div",{className:"p-3 bg-green-50 text-green-700 text-center rounded-lg font-medium border border-green-100 flex items-center justify-center gap-2",children:[e.jsx(De,{size:20})," Bill Generated"]})})]})})]}),e.jsx("footer",{className:"billing-footer print-only",children:e.jsx("p",{children:"Computer generated invoice."})})]})}):e.jsx("div",{className:"error-message-box",children:"No record found."})})]})}):null},ye=/^\+?[0-9\s\-().]{7,20}$/,Ae=/^[a-zA-Z\s'-]{2,}$/,Ze=()=>{const w=Te(),[h,D]=t.useState(""),[b,i]=t.useState([]),[T,d]=t.useState(!1),[r,x]=t.useState(null),[P,o]=t.useState(!1),[u,y]=t.useState(!1),[j,v]=t.useState(!1),[_,F]=t.useState([]),[k,L]=t.useState([]),[n,N]=t.useState({}),[Z,O]=t.useState(""),[X,A]=t.useState(!1),[K,J]=t.useState("plan"),[B,H]=t.useState([]),[$,ee]=t.useState([]),[ae,ie]=t.useState(!1),[he,oe]=t.useState(!1),[xe,pe]=t.useState(null);t.useEffect(()=>{ce()},[]);const ce=async()=>{try{const s=await z("/api/dental/procedures");if(s.ok){const a=await s.json();ee(a)}}catch(s){console.error("Error fetching procedures",s)}};t.useEffect(()=>{(async()=>{if(!r){H([]);return}try{const a=await z(`/api/dental/patient/${r.id}`);if(a.ok){const l=await a.json();H(l)}}catch(a){console.error("Error fetching history",a)}})()},[r]);const se=t.useMemo(()=>ke(async s=>{if(!s.trim()||s.length<2){i([]),d(!1);return}d(!0);try{const a=await z(`/api/patients?search=${encodeURIComponent(s)}&limit=10`);if(a.ok){const l=await a.json();i(l.patients||[])}}catch(a){console.error("Search error:",a)}finally{d(!1)}},300),[]);t.useEffect(()=>{se(h)},[h,se]);const te=s=>{const a=s.target.value;D(a),y(ye.test(a)),v(Ae.test(a)&&!ye.test(a))},Q=async s=>{if(!(!h||s==="phone"&&!u||s==="name"&&!j)){d(!0);try{const l=await z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s==="name"?h:"direct dental",phone:s==="phone"?h:null,age:null,gender:null,token:null})});if(l.ok){const p=await l.json();le({id:p.id,name:p.name,token:p.token??null,age:p.age??null,gender:p.gender??null,phone:p.phone})}else alert("Failed to create patient")}catch(a){console.error("Error creating patient:",a),alert("Error creating patient")}finally{d(!1)}}},le=s=>{x(s),D(""),i([])},re=()=>{x(null),F([]),L([]),N({}),O("")},de=async s=>{if(!r)return;const a=await z(`/api/patients/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(a.ok)await a.json(),x(l=>l?{...l,...s}:null);else throw new Error("Failed to update")},[W,ne]=t.useState(null),c=s=>{ne(s)},g=s=>{if(!W)return;const a={instanceId:crypto.randomUUID(),procedureId:s.id,name:s.name,price:s.cost,type:s.type};N(l=>{const p=l[W]||[];return{...l,[W]:[...p,a]}}),F(l=>l.includes(W)?l:[...l,W]),ne(null)},C=()=>{const s={},a={},l=(f,E)=>{s[f]||(s[f]=[]);const G=`condition-${E}`;s[f].includes(G)||s[f].push(G)},p=(f,E)=>{a[f]||(a[f]=[]),a[f].push(E)};return[...B].sort((f,E)=>new Date(f.date).getTime()-new Date(E.date).getTime()).forEach(f=>{f.teeth&&Array.isArray(f.teeth)&&f.teeth.forEach(E=>{E.procedures.forEach(G=>{var je;let q=(je=f.selected_procedures)==null?void 0:je.find(ue=>ue.id===G);q||(q=$.find(ue=>ue.id===G)),q&&q.type!=="general"?(l(E.toothNumber,q.type),p(E.toothNumber,`${q.name} (${new Date(f.date).toLocaleDateString()})`)):G&&p(E.toothNumber,`Procedure: ${G}`)})})}),Object.keys(n).forEach(f=>{const E=parseInt(f),G=n[E];G&&G.length>0&&G.forEach(q=>{q.type!=="general"&&(l(E,q.type),p(E,`${q.name} (Current)`))})}),{conditions:s,details:a}},{conditions:m,details:R}=t.useMemo(()=>C(),[B,n,$]),I=(s,a)=>{a?(N(l=>{const p={...l};return p[a]=(l[a]||[]).filter(M=>M.instanceId!==s),p[a].length===0&&delete p[a],p}),F(l=>l)):L(l=>l.filter(p=>p.instanceId!==s))},V=(s,a,l)=>{l?N(p=>({...p,[l]:(p[l]||[]).map(M=>M.instanceId===s?{...M,price:a}:M)})):L(p=>p.map(M=>M.instanceId===s?{...M,price:a}:M))},U=async()=>{if(r){A(!0);try{const a=[...k,...Object.values(n).flat()].map(f=>({id:f.procedureId,name:f.name,cost:f.price,type:f.type})),p=Object.keys(n).map(Number).map(f=>({toothNumber:f,procedures:(n[f]||[]).map(E=>E.procedureId),notes:""})),M=await z("/api/dental",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:r.id,teeth:p,selectedProcedures:a,notes:Z})});if(M.ok){const f=await M.json();pe(f.id),oe(!0)}else alert("Failed to save dental record.")}catch(s){console.error(s),alert("Error saving record.")}finally{A(!1)}}};return e.jsxs("div",{className:"dental-page-container",children:[e.jsxs("header",{className:"dental-header",children:[e.jsxs("div",{className:"dental-title-group",children:[e.jsx(Se,{className:"dental-title-icon"}),e.jsxs("div",{children:[e.jsx("h1",{className:"dental-title",children:"Dental Procedure"}),e.jsx("p",{className:"dental-subtitle",children:"Create new dental records and bills"})]})]}),e.jsx("button",{onClick:()=>w(-1),className:"dental-back-btn",children:"Back"})]}),r?e.jsxs("div",{className:"dental-workspace",children:[e.jsxs("div",{className:"patient-header-card",children:[e.jsxs("div",{className:"patient-info-group",children:[e.jsx("div",{className:"patient-avatar",children:r.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"patient-details",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("h3",{children:r.name}),e.jsx("button",{onClick:()=>o(!0),className:"icon-button text-gray-500 hover:text-blue-600",style:{padding:0,border:"none",background:"transparent",cursor:"pointer"},children:e.jsx(Ne,{size:14})})]}),e.jsxs("p",{children:[r.gender," / ",r.age," yrs • ",r.phone]})]})]}),e.jsx("button",{onClick:re,className:"close-patient-btn",title:"Change Patient",children:e.jsx(Y,{size:20})})]}),e.jsxs("div",{className:"dental-grid",children:[e.jsxs("div",{className:"chart-section",children:[e.jsx("div",{className:"dental-card chart-card-scroll",children:e.jsx(ze,{selectedTeeth:_,toothConditions:m,toothDetails:R,onToothClick:c})}),e.jsxs("div",{className:"dental-card notes-container",children:[e.jsx("h4",{className:"section-title-sm",children:"Clinical Notes"}),e.jsx("textarea",{className:"notes-area",placeholder:"Enter clinical findings...",value:Z,onChange:s=>O(s.target.value)})]})]}),e.jsx("div",{className:"dental-card procedures-section",children:e.jsxs("div",{className:"treatment-plan-container",style:{borderTop:"none"},children:[e.jsxs("div",{className:"sidebar-tabs",children:[e.jsx("button",{onClick:()=>J("plan"),className:K==="plan"?"active":"",children:"Treatment Plan"}),e.jsx("button",{onClick:()=>J("history"),className:K==="history"?"active":"",children:"Visit History"})]}),e.jsx("div",{className:"treatment-plan-list custom-scrollbar",children:K==="plan"?e.jsx(e.Fragment,{children:k.length===0&&Object.keys(n).length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"Select a tooth to add procedures."}):e.jsxs(e.Fragment,{children:[k.length>0&&e.jsxs("div",{className:"plan-group",children:[e.jsx("h4",{children:"General"}),k.map(s=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:s.name,children:s.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:s.price,onChange:a=>V(s.instanceId,parseFloat(a.target.value)||0),className:"cost-input"}),e.jsx("button",{onClick:()=>I(s.instanceId),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(Y,{size:14})})]})]},s.instanceId))]}),Object.entries(n).map(([s,a])=>a.length===0?null:e.jsxs("div",{className:"plan-group",children:[e.jsxs("h4",{children:["Tooth ",s]}),a.map(l=>e.jsxs("div",{className:"plan-item",children:[e.jsx("span",{className:"plan-item-name",title:l.name,children:l.name}),e.jsxs("div",{style:{display:"flex",gap:"6px",alignItems:"center"},children:[e.jsx("input",{type:"number",value:l.price,onChange:p=>V(l.instanceId,parseFloat(p.target.value)||0,parseInt(s)),className:"cost-input"}),e.jsx("button",{onClick:()=>I(l.instanceId,parseInt(s)),style:{background:"none",border:"none",color:"var(--dp-danger)",cursor:"pointer",padding:0},children:e.jsx(Y,{size:14})})]})]},l.instanceId))]},s))]})}):e.jsx("div",{className:"history-list",children:B.length===0?e.jsx("div",{style:{padding:"20px",textAlign:"center",color:"var(--dp-text-sec)",fontSize:"0.85rem"},children:"No past visits found."}):B.map(s=>e.jsxs("div",{className:"history-record-card",children:[e.jsxs("div",{className:"history-record-header",children:[e.jsx("span",{className:"record-date",children:new Date(s.date).toLocaleDateString()}),e.jsx("span",{className:"record-status",children:s.status})]}),e.jsxs("div",{className:"history-record-body",children:[s.teeth.map(a=>e.jsxs("div",{className:"history-tooth-group",children:[e.jsxs("strong",{children:["Tooth ",a.toothNumber,":"]})," ",a.procedures.map(l=>{const p=s.selected_procedures.find(M=>M.id===l)||$.find(M=>M.id===l);return p?p.name:l}).join(", ")]},a.toothNumber)),s.notes&&e.jsx("p",{className:"history-notes",children:e.jsxs("em",{children:["Notes: ",s.notes]})})]})]},s.id))})}),e.jsx("div",{className:"action-footer",children:e.jsx("button",{onClick:U,className:"save-btn",disabled:X||k.length===0&&Object.keys(n).length===0,children:X?"Saving...":"Save & Bill"})})]})})]})]}):e.jsxs("div",{className:"patient-search-container",children:[e.jsx("h2",{style:{fontSize:"1.5rem",fontWeight:700,marginBottom:"24px",color:"var(--dp-text)"},children:"Who is this for?"}),e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(Ce,{className:"search-icon-overlay",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name or phone...",className:"dental-search-input",value:h,onChange:te,autoFocus:!0}),T&&e.jsx("div",{className:"search-spinner"})]}),b.length>0&&e.jsx("div",{className:"search-results-dropdown",children:b.map(s=>e.jsxs("div",{onClick:()=>le(s),className:"search-result-item",children:[e.jsxs("div",{children:[e.jsx("span",{className:"patient-name-highlight",children:s.name}),e.jsxs("div",{className:"patient-meta",children:[s.age," yrs / ",s.gender," • ",s.phone]})]}),e.jsx(me,{size:18,color:"var(--dp-text-sec)"})]},s.id))}),h.length>=2&&!T&&b.length===0&&e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsxs("p",{style:{color:"var(--dp-text-sec)",marginBottom:"15px"},children:['No patients found matching "',h,'".']}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"15px"},children:(u||j)&&e.jsxs("button",{type:"button",onClick:()=>Q(u?"phone":"name"),className:"register-new-btn",style:{backgroundColor:"var(--dp-card-bg)",border:"1px solid var(--dp-primary)",padding:"8px 16px",borderRadius:"8px"},children:['Create "',h,'"']})})]}),e.jsx("div",{style:{marginTop:"32px"},children:e.jsx("button",{onClick:()=>ie(!0),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:"Manage Procedures"})})]}),P&&r&&e.jsx(Fe,{patient:r,onClose:()=>o(!1),onSave:de}),ae&&e.jsx(Ee,{onClose:()=>ie(!1),onUpdate:ce}),W!==null&&e.jsx(Be,{toothNumber:W,procedures:$,onSelect:g,onClose:()=>ne(null)}),e.jsx(Re,{isOpen:he,recordId:xe,onClose:()=>{oe(!1),re()},onBillingComplete:()=>{}})]})};export{Ze as default};
