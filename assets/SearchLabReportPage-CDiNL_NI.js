import{f as R,p as A,j as e}from"./index-D_kqlrGT.js";import{u as C,r as n}from"./react-vendor-Cc0P4_ZX.js";/* empty css                        *//* empty css                           */import{u as E}from"./useAutoFocusSingleInput-6a_v4dYJ.js";import{W as D,i as I,E as z,as as P,v as B,at as F,au as _}from"./ui-vendor-SmiJk_kJ.js";import{f as $}from"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Q=()=>{const u=C(),[r,y]=n.useState(""),[o,g]=n.useState(!1),[l,d]=n.useState([]),[c,i]=n.useState(null),[f,v]=n.useState(r);E(),n.useEffect(()=>{const t=setTimeout(()=>{v(r)},500);return()=>{clearTimeout(t)}},[r]),n.useEffect(()=>{j()},[f]);const j=async()=>{const t=r.trim();if(!t){d([]),i(null);return}g(!0),i(null),d([]),console.log(`Searching for: ${t}`);try{const a=await R("/api/lab");if(!a.ok){let s;try{s=await a.json()}catch{s={message:`Server returned status ${a.status}`}}throw console.error("Search fetch error response:",s),new Error(s.message||`HTTP error! status: ${a.status}`)}const{orders:h}=await a.json();console.log("Received lab orders for search:",h);const x=h.filter(s=>!!s.report_content).map(s=>{var p,b;return{id:s.id,labTokenNumber:String(s.lab_token_number??"N/A"),patientName:((p=s.Patient)==null?void 0:p.name)||"N/A",patientId:s.patient_id,patientTokenNumber:String(((b=s.Patient)==null?void 0:b.patient_token_number)??"N/A"),tests:(s.tests||[]).map(w=>w.name||"Unknown Test"),date:$(new Date(s.createdAt),"yyyy-MM-dd"),status:s.status}}),k=new A(x,{keys:["patientName","labTokenNumber","patientTokenNumber","tests","id","patientId"],threshold:.3,ignoreLocation:!0}),m=r.trim()?k.search(r).map(s=>s.item):x;console.log("Filtered search results:",m),d(m),m.length===0&&t?i(`No matching reports found for "${t}".`):i(null)}catch(a){console.error("Failed to search lab reports:",a),i(a instanceof Error?a.message:"An unknown error occurred during search")}finally{g(!1)}},S=t=>{console.log(`Result clicked, navigating to view report for order ID: ${t}`),u(`/lab/view-report/${t}`)},N=t=>{switch(t){case"pending":return{text:"Sample Pending",color:"text-red-600 bg-red-100"};case"collected":return{text:"Sample Collected",color:"text-yellow-600 bg-yellow-100"};case"processing":return{text:"Processing",color:"text-blue-600 bg-blue-100"};case"completed":return{text:"Completed",color:"text-green-600 bg-green-100"};case"cancelled":return{text:"Cancelled",color:"text-gray-600 bg-gray-100 line-through"};case"reported":return{text:"Reported",color:"text-purple-600 bg-purple-100"};default:return{text:t,color:"text-gray-600 bg-gray-100"}}},T=t=>{switch(t){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"Search Lab Reports"}),e.jsxs("button",{onClick:()=>u(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[e.jsx(D,{size:16,style:{marginRight:"5px"}}),"Back"]})]}),e.jsxs("div",{className:"lab-inventory-form-group",style:{marginTop:"20px",position:"relative"},children:[e.jsx("label",{htmlFor:"report-search",children:"Enter Search Term"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"relative"},children:[e.jsx(I,{size:20,style:{position:"absolute",left:"10px",color:"#777"}}),e.jsx("input",{id:"report-search",type:"text",placeholder:"Patient name, ID, token, report ID, test name...",value:r,onChange:t=>y(t.target.value),className:"lab-inventory-input",style:{paddingLeft:"40px",marginBottom:"0"}})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[o&&e.jsx("div",{className:"loading-text",children:"Searching..."}),c&&!o&&e.jsxs("div",{className:"error-text",children:[e.jsx(z,{size:20,className:"inline mr-2"})," ",c]}),l.length>0&&!o&&e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:l.map(t=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>S(t.id),style:{marginBottom:"15px",cursor:"pointer",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:[e.jsx(P,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),t.patientName," (Token: ",t.patientTokenNumber,")"]}),e.jsx("span",{className:T(t.status),children:N(t.status).text})]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:[e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(B,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Order ID: ",t.id]}),e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(F,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Tests: ",t.tests.join(", ")]}),e.jsxs("div",{children:[e.jsx(_,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Date: ",t.date]})]})]},t.id))}),!o&&l.length===0&&!c&&r.trim()&&e.jsxs("div",{className:"no-data-message",children:['No results found for "',r,'".']}),!o&&l.length===0&&!c&&!r.trim()&&e.jsx("div",{className:"no-data-message",style:{backgroundColor:"transparent",border:"none",textAlign:"left",padding:"5px 0"},children:"Enter a search term above to find lab reports."})]})]})})};export{Q as default};
