import{j as e,S as u,f as y}from"./index-B0SGsixC.js";import{j as Fe,u as De,r as c}from"./react-vendor-Cc0P4_ZX.js";/* empty css                            */import{Q as xe}from"./index-CZ6CIOFr.js";import{W as pe,_ as ue,af as je,u as ye,U as Ae,aD as Re,aE as Ce,aF as ke,aG as Te}from"./ui-vendor-CZgqa0n4.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Me=()=>{var Q,G,J,Y,K,V,X,Z,ee,se,ae,ie,te,ne,de,le,re,ce,oe;const{patientId:m,billId:f}=Fe(),w=De(),[s,D]=c.useState(null),[ge,_]=c.useState(!0),[I,g]=c.useState(null),[N,z]=c.useState(""),[E,A]=c.useState("cash"),[P,b]=c.useState(!1),[R,Ne]=c.useState(""),[C,fe]=c.useState(""),[k,be]=c.useState(""),[T,ve]=c.useState(""),[$,we]=c.useState([]),[S,L]=c.useState(""),[F,U]=c.useState([]),[x,_e]=c.useState(0),B=((Q=s==null?void 0:s.patient)==null?void 0:Q.insurance_type)==="no_cash_insurance";c.useEffect(()=>{A(B?"no_cash_insurance":"cash")},[B]),c.useEffect(()=>{f&&(async()=>{_(!0),g(null);try{const[n,l,p]=await Promise.all([y(`/api/bills/${f}`),y("/api/clinics/settings").catch(()=>null),y(`/api/bills?patientId=${m}`).catch(()=>null)]);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json();if(!t||!t.bill||!t.calculated)throw new Error("Incomplete data structure received from backend.");if(t.bill.type!=="admission")throw new Error(`Unexpected bill type: ${t.bill.type}. Expected 'admission'.`);const h=Array.isArray(t.admissionPayments)?t.admissionPayments:[];if(D({...t.bill,amount:t.bill.amount,created_at:t.bill.createdAt||t.bill.created_at,items:(t.bill.items||[]).map(d=>({...d,price:parseFloat(d.price)||0,quantity:parseInt(d.quantity)||1})),AdmissionPayments:h,calculated:t.calculated,admissionRecord:t.admissionRecord,patient:t.bill.Patient?{id:t.bill.Patient.id,name:t.bill.Patient.name,admission_date:t.bill.Patient.admission_date,discharge_date:t.bill.Patient.discharge_date,token:t.bill.Patient.patient_token_number||t.bill.Patient.token,insurance_type:t.bill.Patient.insurance_type}:void 0}),l&&l.ok){const d=await l.json();Ne(d.name||""),fe(d.address||""),be(d.notes||""),ve(d.upi_id||"")}try{const d=await y(`/api/patients/${m}/admission-payments`);if(d.ok){const i=await d.json();we(i)}}catch(d){console.error("Failed to fetch payment history:",d)}if(p&&p.ok){const i=((await p.json()).bills||[]).filter(r=>r.type==="admission"&&r.id!==f).map(r=>{var me,he;const o=r.AdmissionRecord;return{id:r.id,amount:o?parseFloat(o.total_amount):parseFloat(r.amount)||0,status:o?o.balance<=0||o.status==="discharged"&&o.balance<=0?"paid":"pending":r.status,created_at:r.createdAt||r.created_at,admission_date:o?o.admission_date:((me=r.Patient)==null?void 0:me.admission_date)||r.admission_date,discharge_date:o?o.discharge_date:((he=r.Patient)==null?void 0:he.discharge_date)||r.discharge_date,admissionRecord:o}});U(i);const v=i.filter(r=>r.admissionRecord?r.admissionRecord.balance>0:r.status!=="paid").reduce((r,o)=>o.admissionRecord?r+(typeof o.admissionRecord.balance=="string"?parseFloat(o.admissionRecord.balance):o.admissionRecord.balance):r+o.amount,0);_e(v)}}catch(n){console.error("Failed to fetch admission bill details:",n),g(n instanceof Error?n.message:"An unknown error occurred")}finally{_(!1)}})()},[f,m]),c.useEffect(()=>{(async()=>{if(!f){if(!m){g("Patient ID is missing."),_(!1);return}try{_(!0);const n=await y(`/api/patients/${m}`);if(n.ok){const l=await n.json();if(l){if(l.admission_date&&!l.discharge_date){const t=await y(`/api/patients/${m}/active-bill?type=admission`);if(t.ok){const h=await t.json();if(h&&h.id){w(`/patient/${m}/admission-bill/${h.id}`,{replace:!0});return}}}D({id:0,patient_id:l.id,type:"admission",amount:"0",status:"pending",created_at:new Date().toISOString(),AdmissionPayments:[],calculated:{totalPaid:0,totalDue:0,balance:0,daysStayed:0,perDayCharge:0},patient:{id:l.id,name:l.name,admission_date:l.admission_date,discharge_date:l.discharge_date,token:l.token,insurance_type:l.insurance_type}});const p=await y(`/api/bills?patientId=${m}`);if(p.ok){const h=((await p.json()).bills||[]).filter(d=>d.type==="admission").map(d=>{var v,r;const i=d.AdmissionRecord;return{id:d.id,amount:i?parseFloat(i.total_amount):parseFloat(d.amount)||0,status:i?i.balance<=0||i.status==="discharged"&&i.balance<=0?"paid":"pending":d.status,created_at:d.createdAt||d.created_at,admission_date:i?i.admission_date:((v=d.Patient)==null?void 0:v.admission_date)||d.admission_date,discharge_date:i?i.discharge_date:((r=d.Patient)==null?void 0:r.discharge_date)||d.discharge_date,admissionRecord:i}});U(h)}}else g("Patient not found")}}catch(n){console.error("Error fetching patient status:",n),g("Failed to load patient details")}finally{_(!1)}}})()},[m,f,w]);const O=async()=>{if(m){b(!0);try{const a=await y(`/api/patients/${m}/admit`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const l=await a.json();throw new Error(l.message||"Failed to admit patient")}const n=await a.json();n.bill&&n.bill.id?w(`/patient/${m}/admission-bill/${n.bill.id}`):window.location.reload()}catch(a){g(a instanceof Error?a.message:"Failed to admit patient"),b(!1)}}},Pe=async()=>{if(m&&window.confirm("Are you sure you want to discharge this patient? This will finalize the bill.")){b(!0);try{const a=await y(`/api/patients/${m}/discharge`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to discharge patient")}window.location.reload()}catch(a){g(a instanceof Error?a.message:"Failed to discharge patient"),b(!1)}}},M=((G=s==null?void 0:s.patient)==null?void 0:G.admission_date)&&!((J=s==null?void 0:s.patient)!=null&&J.discharge_date),q=!!((Y=s==null?void 0:s.patient)!=null&&Y.discharge_date);c.useEffect(()=>{var l,p;const n=Number(((l=s==null?void 0:s.calculated)==null?void 0:l.balance)??((p=s==null?void 0:s.admissionRecord)==null?void 0:p.balance)??0)+x;if(n>0&&T){const t=`upi://pay?pa=${T}&pn=${encodeURIComponent(R||"Clinic")}&am=${n.toFixed(2)}&cu=INR`;L(t)}else L("")},[s,x,T,R]);const Se=async a=>{var p,t;a.preventDefault();const l=Number(((p=s==null?void 0:s.calculated)==null?void 0:p.balance)??((t=s==null?void 0:s.admissionRecord)==null?void 0:t.balance)??0)+x;if(!m||!N||isNaN(parseFloat(N))||parseFloat(N)<=0||parseFloat(N)>l){g("Please enter a valid payment amount within the total outstanding.");return}g(null),b(!0);try{const h=await y(`/api/patients/${m}/admission-payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_paid:parseFloat(N),payment_mode:E})});if(!h.ok){const v=await h.json();throw new Error(v.message||`HTTP error! status: ${h.status}`)}const i=await(await y(`/api/bills/${f}`)).json();if(i&&i.bill&&i.calculated&&i.admissionPayments)D({...i.bill,amount:parseFloat(i.bill.amount),AdmissionPayments:i.admissionPayments,calculated:i.calculated,patient:i.bill.Patient?{id:i.bill.Patient.id,name:i.bill.Patient.name,admission_date:i.bill.Patient.admission_date,discharge_date:i.bill.Patient.discharge_date,token:i.bill.Patient.token,insurance_type:i.bill.Patient.insurance_type}:void 0});else throw new Error("Invalid data structure received after payment submission.");z(""),setTimeout(()=>{window.print()},100)}catch(h){console.error("Failed to submit payment:",h),g(h instanceof Error?h.message:"Failed to record payment")}finally{b(!1)}},H=()=>{window.print()};if(ge)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("div",{className:"billing-header no-print",children:[e.jsx("div",{className:"back-button",children:e.jsx(u,{width:100,height:40,style:{borderRadius:"8px"}})}),e.jsx(u,{width:300,height:40})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsx("main",{className:"order-content",children:e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(u,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx("div",{className:"info-item",children:e.jsx(u,{width:200,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(u,{width:150,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(u,{width:180,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(u,{width:150,height:20})})]})]})}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(u,{width:160,height:24})})}),e.jsxs("div",{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{width:100,height:20}),e.jsx(u,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(u,{width:100,height:20}),e.jsx(u,{width:80,height:20})]})]})]})})]})]})});if(I)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("header",{className:"billing-header no-print",children:[e.jsx("button",{onClick:()=>w(-1),className:"back-button",children:e.jsx(pe,{size:20})}),e.jsx("h1",{children:"Admission Bill"})]}),e.jsxs("div",{className:"error-message-box",children:["Error: ",I]})]})});if(!s||!s.calculated)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsx("div",{className:"error-message-box",children:"No bill details found or data is incomplete."})});const j=Number(s.calculated&&s.calculated.balance!==void 0?s.calculated.balance:s.admissionRecord?s.admissionRecord.balance:0),W=s.status==="paid"||j<=0;return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"ADMISSION BILL"}),e.jsx("h2",{className:"clinic-name-print",children:R||"Hospital"}),(C||k)&&e.jsxs("div",{className:"clinic-details-print",children:[C&&e.jsx("span",{className:"small-text clinic-address",children:C}),k&&e.jsx("span",{className:"small-text clinic-notes",children:k})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ue,{size:16})," Patient"]})," ",((K=s.patient)==null?void 0:K.name)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(je,{size:16})," Token"]})," ",((V=s.patient)==null?void 0:V.token)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ye,{size:16})," Date"]})," ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>w(-1),className:"back-button",children:[e.jsx(pe,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Admission Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"Patient Information"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[!M&&!q&&e.jsxs("button",{onClick:O,disabled:P,className:"primary-button",style:{fontSize:"0.85em",padding:"6px 12px"},children:[e.jsx(Ae,{size:16})," Admit Patient"]}),M&&e.jsxs("button",{onClick:Pe,disabled:P,className:"secondary-button",style:{fontSize:"0.85em",padding:"6px 12px",background:"#dc3545",color:"white"},children:[e.jsx(Re,{size:16})," Discharge"]}),q&&e.jsxs("button",{onClick:O,disabled:P,className:"primary-button",style:{fontSize:"0.85em",padding:"6px 12px"},children:[e.jsx(Ce,{size:16})," Re-Admit"]})]})]}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ue,{size:16})," Patient Name"]})," ",((X=s.patient)==null?void 0:X.name)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(je,{size:16})," Token"]})," ",((Z=s.patient)==null?void 0:Z.token)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ke,{size:16})," Bill ID"]})," ",s.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ye,{size:16})," Created"]})," ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Admission Charges Breakdown"})}),e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"AMOUNT"})]})}),e.jsxs("tbody",{children:[s.admissionRecord?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"1"}),e.jsx("td",{children:"Admission Charge"}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["₹",Number(s.admissionRecord.admission_charge).toFixed(2)]}),e.jsxs("td",{children:["₹",Number(s.admissionRecord.admission_charge).toFixed(2)]})]}),s.admissionRecord.days_stayed?e.jsxs("tr",{children:[e.jsx("td",{children:"2"}),e.jsxs("td",{children:["Per Day Charges",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",new Date(s.admissionRecord.admission_date).toLocaleDateString(),s.admissionRecord.discharge_date?` - ${new Date(s.admissionRecord.discharge_date).toLocaleDateString()}`:" - Ongoing",")"]})]}),e.jsxs("td",{children:[s.admissionRecord.days_stayed," days"]}),e.jsxs("td",{children:["₹",Number(s.admissionRecord.per_day_charge).toFixed(2)]}),e.jsxs("td",{children:["₹",(Number(s.admissionRecord.days_stayed)*Number(s.admissionRecord.per_day_charge)).toFixed(2)]})]}):s.calculated.daysStayed&&s.calculated.perDayCharge&&s.calculated.perDayCharge>0?e.jsxs("tr",{children:[e.jsx("td",{children:"2"}),e.jsxs("td",{children:["Per Day Charges (Ongoing)",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",new Date(s.admissionRecord.admission_date).toLocaleDateString()," - Today)"]})]}),e.jsxs("td",{children:[s.calculated.daysStayed," days"]}),e.jsxs("td",{children:["₹",s.calculated.perDayCharge.toFixed(2)]}),e.jsxs("td",{children:["₹",(s.calculated.daysStayed*s.calculated.perDayCharge).toFixed(2)]})]}):null]}):e.jsxs(e.Fragment,{children:[s.items&&s.items.length>0?s.items.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsx("td",{children:a.name}),e.jsx("td",{children:a.quantity}),e.jsxs("td",{children:["₹",a.price.toFixed(2)]}),e.jsxs("td",{children:["₹",(a.price*a.quantity).toFixed(2)]})]},`item-${n}`)):e.jsxs("tr",{children:[e.jsx("td",{children:"1"}),e.jsx("td",{children:"Initial Admission Charge"}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["₹",parseFloat(s.amount).toFixed(2)]}),e.jsxs("td",{children:["₹",parseFloat(s.amount).toFixed(2)]})]}),s.calculated.daysStayed&&s.calculated.perDayCharge&&s.calculated.perDayCharge>0&&e.jsxs("tr",{children:[e.jsx("td",{children:(((ee=s.items)==null?void 0:ee.length)||1)+1}),e.jsxs("td",{children:["Per Day Charges",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",(se=s.patient)!=null&&se.admission_date?new Date(s.patient.admission_date).toLocaleDateString():"",(ae=s.patient)!=null&&ae.discharge_date?` - ${new Date(s.patient.discharge_date).toLocaleDateString()}`:" - Ongoing",")"]})]}),e.jsxs("td",{children:[s.calculated.daysStayed," days"]}),e.jsxs("td",{children:["₹",s.calculated.perDayCharge.toFixed(2)]}),e.jsxs("td",{children:["₹",(s.calculated.daysStayed*s.calculated.perDayCharge).toFixed(2)]})]})]}),e.jsxs("tr",{className:"subtotal-row current-admission-row",children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"Current Admission Total"}),e.jsxs("td",{children:["₹",Number(((ie=s.calculated)==null?void 0:ie.totalDue)??((te=s.admissionRecord)==null?void 0:te.total_amount)??0).toFixed(2)]})]}),F.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:"section-header-row previous-admissions-header",children:e.jsx("td",{colSpan:5,style:{fontWeight:600,textAlign:"center"},children:"Previous Admissions"})}),F.map((a,n)=>e.jsxs("tr",{className:a.status!=="paid"?"bill-row-unpaid":"bill-row-paid",children:[e.jsx("td",{children:n+1}),e.jsxs("td",{children:["Admission - ",a.admission_date?new Date(a.admission_date).toLocaleDateString():"N/A",a.discharge_date&&e.jsxs("small",{style:{display:"block",color:"inherit",opacity:.8,fontSize:"0.75em"},children:["Discharged: ",new Date(a.discharge_date).toLocaleDateString()]})]}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["₹",a.amount.toFixed(2)]}),e.jsxs("td",{className:a.status!=="paid"?"text-danger":"text-success",children:["₹",a.amount.toFixed(2),a.status==="paid"&&e.jsx("small",{style:{marginLeft:"4px"},children:"(Paid)"})]})]},a.id)),x>0&&e.jsxs("tr",{className:"subtotal-row unpaid-balance-row",children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"Previous Unpaid Balance"}),e.jsxs("td",{children:["₹",x.toFixed(2)]})]})]}),e.jsxs("tr",{className:`grand-total-row-dynamic ${x>0?"grand-total-unpaid":"grand-total-paid"}`,children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"GRAND TOTAL"}),e.jsxs("td",{style:{fontSize:"1.1em"},children:["₹",(Number(((ne=s.calculated)==null?void 0:ne.totalDue)??((de=s.admissionRecord)==null?void 0:de.total_amount)??0)+x).toFixed(2)]})]})]})]})]}),$.length>0&&e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Payment History"})}),e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DATE"}),e.jsx("th",{children:"MODE"}),e.jsx("th",{children:"AMOUNT"})]})}),e.jsx("tbody",{children:$.map((a,n)=>{var l;return e.jsxs("tr",{children:[e.jsx("td",{children:n+1}),e.jsx("td",{children:a.payment_date?new Date(a.payment_date).toLocaleDateString():"N/A"}),e.jsx("td",{style:{textTransform:"capitalize"},children:((l=a.payment_mode)==null?void 0:l.replace(/_/g," "))||"N/A"}),e.jsxs("td",{children:["₹",(Number(a.amount_paid)||0).toFixed(2)]})]},a.id)})})]})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{children:["₹",Number(((le=s.calculated)==null?void 0:le.totalDue)??((re=s.admissionRecord)==null?void 0:re.total_amount)??0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{children:["₹",Number(((ce=s.calculated)==null?void 0:ce.totalPaid)??((oe=s.admissionRecord)==null?void 0:oe.total_paid)??0).toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Balance Due: ₹",j.toFixed(2)]})})]}),S&&j>0&&e.jsxs("div",{className:"qr-code-container qr-code-printable-section",children:[e.jsx(xe,{value:S,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{children:["₹",(s.calculated.totalDue||0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Days Stayed"}),e.jsx("span",{children:s.calculated.daysStayed??0})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{style:{color:"#28a745"},children:["₹",(s.calculated.totalPaid||0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Balance Due"}),e.jsxs("strong",{style:{color:j>0?"#dc3545":"#28a745"},children:["₹",j.toFixed(2)]})]}),F.length>0&&e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px dashed #dee2e6"},children:[e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem",color:"#495057"},children:"Previous Admissions"}),F.map(a=>e.jsxs("div",{className:"summary-row",style:{fontSize:"0.8rem"},children:[e.jsxs("span",{style:{color:"#6c757d"},children:[a.admission_date?new Date(a.admission_date).toLocaleDateString():"N/A",a.status!=="paid"&&e.jsx("span",{style:{color:"#dc3545",marginLeft:"4px"},children:"(Unpaid)"})]}),e.jsxs("span",{style:{color:a.status!=="paid"?"#dc3545":"#28a745"},children:["₹",a.amount.toFixed(2)]})]},a.id)),x>0&&e.jsxs("div",{className:"summary-row",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #e9ecef"},children:[e.jsx("strong",{style:{color:"#dc3545",fontSize:"0.875rem"},children:"Previous Balance"}),e.jsxs("strong",{style:{color:"#dc3545"},children:["₹",x.toFixed(2)]})]})]}),x>0&&e.jsxs("div",{className:"summary-row grand-total-row",style:{marginTop:"0.75rem",background:"#fff3cd"},children:[e.jsx("strong",{style:{color:"#856404"},children:"Total Outstanding"}),e.jsxs("strong",{style:{color:"#856404"},children:["₹",(j+x).toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:S&&j>0?e.jsxs(e.Fragment,{children:[e.jsx(xe,{value:S,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):j<=0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#28a745"},children:[e.jsx(Te,{size:48}),e.jsx("p",{style:{marginTop:"10px",fontWeight:600},children:"Fully Paid"})]}):e.jsx("p",{children:"UPI QR code not available."})}),!W&&e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentAmount",className:"info-item",children:e.jsx("strong",{children:"Payment Amount (₹)"})}),e.jsx("input",{type:"number",id:"paymentAmount",value:N,onChange:a=>z(a.target.value),placeholder:`Max ₹${j.toFixed(2)}`,min:"0.01",step:"0.01",max:j,className:"payment-mode-select",required:!0})]}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:E,onChange:a=>A(a.target.value),className:"payment-mode-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),B&&e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})]}),e.jsxs("div",{className:"bill-actions",children:[e.jsx("button",{type:"button",onClick:H,className:"secondary-button print-preview-button",children:"Print Preview"}),e.jsx("button",{type:"submit",className:"primary-button",disabled:P||!N||parseFloat(N)<=0||parseFloat(N)>j+x,children:P?"Processing...":"Record Payment & Print"})]})]}),W&&e.jsx("div",{className:"bill-actions",children:e.jsx("button",{onClick:H,className:"secondary-button",children:"Print Bill"})})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for choosing our hospital!"}),e.jsx("p",{children:"This is a computer-generated bill and does not require a signature."})]})]})})};export{Me as default};
