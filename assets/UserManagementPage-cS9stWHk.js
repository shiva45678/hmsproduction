import{f as j,J as ne,j as e,S as l,K as re,z as ie}from"./index-CRA8Xzko.js";import{u as le,r as a}from"./react-vendor-Cc0P4_ZX.js";import{W as ce}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const pe=()=>{const R=le(),[_,q]=a.useState([]),[O,A]=a.useState(!0),[E,$]=a.useState(!0),[D,n]=a.useState(null),[J,f]=a.useState(!1),[W,g]=a.useState(!1),[v,k]=a.useState(null),[c,x]=a.useState({name:"",email:"",password:"",role:"user"}),[r,d]=a.useState({name:"",email:"",role:"",password:"",confirmPassword:""}),[S,z]=a.useState(""),[I,B]=a.useState(""),[K,G]=a.useState({}),[H,w]=a.useState(!1),[T,F]=a.useState(null),[N,V]=a.useState([]),[y,C]=a.useState(""),[P,M]=a.useState(!1),[b,L]=a.useState(null);a.useEffect(()=>{const s=setTimeout(()=>{B(S)},500);return()=>{clearTimeout(s)}},[S]),a.useEffect(()=>{h(I)},[I]);const h=async(s="")=>{A(!0);try{const t=s?`/api/users?search=${encodeURIComponent(s)}`:"/api/users",i=await(await j(t)).json();if(q(i),i.length>0){const m=[...new Set(i.map(o=>o.clinic_id).filter(o=>!!o))],p={};await Promise.all(m.map(async o=>{try{const U=await ne(o);p[o]=U}catch(U){console.error(`Failed to fetch subscription status for clinic ${o}`,U),p[o]={hasProPlan:!1}}})),G(p)}n(null)}catch(t){n("Failed to fetch users."),console.error(t)}finally{A(!1),$(!1)}},X=async s=>{s.preventDefault();try{await j("/users",{method:"POST",body:JSON.stringify(c)}),f(!1),x({name:"",email:"",password:"",role:"user"}),h()}catch(t){n("Failed to add user."),console.error(t)}},Y=async s=>{if(s.preventDefault(),!v)return;const{password:t,confirmPassword:u,...i}=r,m={...i};if(t){if(t.length<6){n("Password must be at least 6 characters long.");return}if(t!==u){n("Passwords do not match.");return}m.password=t}try{await j(`/users/${v.id}`,{method:"PUT",body:JSON.stringify(m)}),g(!1),k(null),d({...r,password:"",confirmPassword:""}),h()}catch(p){n("Failed to update user."),console.error(p)}},Z=async s=>{if(window.confirm("Are you sure you want to delete this user?"))try{await j(`/users/${s}`,{method:"DELETE"}),h()}catch(t){n("Failed to delete user."),console.error(t)}},Q=s=>{k(s),d({name:s.name,email:s.email,role:s.role,password:"",confirmPassword:""}),g(!0)},ee=async()=>{M(!0);try{const s=await ie();V(s),s.length>0&&C(s[0].id),L(null)}catch(s){L("Failed to fetch subscription plans."),console.error(s)}finally{M(!1)}},se=s=>{F(s),w(!0),ee()},te=async s=>{if(s.preventDefault(),!T||!y){n("Please select a clinic and a plan.");return}try{await j("/clinic-subscriptions/manual-activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicId:T,planId:y})}),w(!1),F(null),C(""),h(),n(null)}catch(t){n("Failed to manually activate clinic subscription."),console.error(t)}},ae=async s=>{if(window.confirm("Are you sure you want to cancel this clinic's subscription? This action cannot be undone."))try{await re(s),h(),n(null)}catch(t){n("Failed to cancel subscription."),console.error(t)}};return O&&E?e.jsxs("div",{className:"user-management-page",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsx("div",{className:"back-button",style:{width:80,height:32},children:e.jsx(l,{width:80,height:32})}),e.jsx("h1",{children:e.jsx(l,{width:200,height:32})})]}),e.jsxs("div",{className:"controls-container",children:[e.jsx(l,{width:"100%",height:40,style:{maxWidth:"300px"}}),e.jsx(l,{width:150,height:40})]}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Clinic ID"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(l,{width:120,height:20})}),e.jsx("td",{children:e.jsx(l,{width:180,height:20})}),e.jsx("td",{children:e.jsx(l,{width:80,height:20})}),e.jsx("td",{children:e.jsx(l,{width:100,height:20})}),e.jsx("td",{children:e.jsx(l,{width:100,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{children:e.jsx(l,{width:150,height:32})})]},s))})]})]}):D&&E?e.jsx("div",{className:"error-message",children:D}):e.jsxs("div",{className:"user-management-page",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsx("button",{onClick:()=>R(-1),className:"back-button",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("h1",{children:"User Management"})]}),e.jsxs("div",{className:"controls-container",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:S,onChange:s=>z(s.target.value),className:"search-input"}),e.jsx("button",{onClick:()=>f(!0),className:"add-user-button",children:"Add New User"})]}),J&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>f(!1),children:"×"}),e.jsx("h2",{children:"Add New User"}),e.jsxs("form",{onSubmit:X,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:c.name,onChange:s=>x({...c,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:c.email,onChange:s=>x({...c,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password:"}),e.jsx("input",{type:"password",value:c.password,onChange:s=>x({...c,password:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:c.role,onChange:s=>x({...c,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsx("button",{type:"submit",children:"Add User"})]})]})}),W&&v&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>g(!1),children:"×"}),e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>d({...r,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:r.email,onChange:s=>d({...r,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:r.role,onChange:s=>d({...r,role:s.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password (optional):"}),e.jsx("input",{type:"password",value:r.password,onChange:s=>d({...r,password:s.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm New Password:"}),e.jsx("input",{type:"password",value:r.confirmPassword,onChange:s=>d({...r,confirmPassword:s.target.value})})]}),e.jsx("button",{type:"submit",children:"Update User"})]})]})}),H&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>w(!1),children:"×"}),e.jsx("h2",{children:"Select Subscription Plan for Clinic"}),P&&e.jsx("div",{children:"Loading plans..."}),b&&e.jsx("div",{className:"error-message",children:b}),!P&&!b&&N.length===0&&e.jsx("div",{children:"No active subscription plans available."}),!P&&!b&&N.length>0&&e.jsxs("form",{onSubmit:te,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Plan:"}),e.jsx("select",{value:y,onChange:s=>C(s.target.value),required:!0,children:N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - $",s.price,"/",s.interval," ",s.period]},s.id))})]}),e.jsx("button",{type:"submit",children:"Activate Selected Plan"})]})]})}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Clinic ID"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:_.map(s=>{const t=s.clinic_id||"N/A",u=t!=="N/A"?K[t]:null,i=(u==null?void 0:u.hasProPlan)??!1,m=i?"PRO":"Standard";return e.jsxs("tr",{children:[e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.role}),e.jsx("td",{children:t}),e.jsx("td",{children:t!=="N/A"?e.jsx("span",{className:i?"pro-badge":"standard-badge",children:m}):"N/A"}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>Q(s),className:"edit-button",children:"Edit"}),e.jsx("button",{onClick:()=>Z(s.id),className:"delete-button",children:"Delete"}),s.clinic_id&&!i&&e.jsx("button",{onClick:()=>se(s.clinic_id),className:"start-subscription-button",children:"Start Subscription"}),s.clinic_id&&i&&e.jsx("button",{onClick:()=>ae(s.clinic_id),className:"cancel-subscription-button",children:"Cancel Subscription"})]})]},s.id)})})]})]})};export{pe as default};
