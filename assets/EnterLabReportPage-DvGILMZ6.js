import{f as y,j as e,S as x}from"./index-B0SGsixC.js";import{j as Ye,u as Ze,r as u}from"./react-vendor-Cc0P4_ZX.js";/* empty css                        *//* empty css                           */import{h as Ie}from"./whatsappUtils-DTYJAZi5.js";import{E as Ee,W as G,a7 as Te,ae as ke,ao as et,_ as Ae,ap as Oe,aq as M,X as V,ar as T,f as ze,n as tt}from"./ui-vendor-CZgqa0n4.js";import{f as J}from"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const at=(l,o,r,b="non-black")=>{if(isNaN(l)||isNaN(o)||l<=0||o<=0)return null;let m;return r==="female"?l<=.7?m=141*Math.pow(l/.7,-.329)*Math.pow(.993,o):m=141*Math.pow(l/.7,-1.209)*Math.pow(.993,o):l<=.9?m=141*Math.pow(l/.9,-.411)*Math.pow(.993,o):m=141*Math.pow(l/.9,-1.209)*Math.pow(.993,o),b==="black"&&(m*=1.018),parseFloat(m.toFixed(2))},nt=(l,o,r)=>{if(isNaN(l)||isNaN(o)||isNaN(r)||l<0||o<0||r<0||r>=400)return null;const b=l-o-r/5;return parseFloat(b.toFixed(2))},rt=(l,o)=>{if(isNaN(l)||isNaN(o)||l<0||o<0)return null;const r=l-o;return parseFloat(r.toFixed(2))},st=(l,o)=>{if(isNaN(l)||isNaN(o)||l<0||o<0)return null;const r=l-o;return parseFloat(r.toFixed(2))},it=(l,o,r)=>{if(isNaN(l)||isNaN(o)||isNaN(r)||l<0||o<0||r<0)return null;const b=l-(o+r);return parseFloat(b.toFixed(2))},lt=(l,o,r)=>{if(isNaN(l)||isNaN(o)||isNaN(r)||l<0||o<0||r<0)return null;const b=2*l+o/18+r/2.8;return parseFloat(b.toFixed(2))},ot=l=>["eGFR","LDL Cholesterol","Indirect Bilirubin","Globulin","Anion Gap","Osmolality"].includes(l),jt=()=>{var ee,te;const{orderId:l}=Ye(),o=Ze(),[r,b]=u.useState(null),[m,g]=u.useState({}),[Re,k]=u.useState(!0),[v,w]=u.useState(!1),[C,S]=u.useState(null),[U,H]=u.useState(null),[W,q]=u.useState(null),[Be,$e]=u.useState({}),[X,Le]=u.useState(null),[De,A]=u.useState(!1),[O,K]=u.useState(""),[Ge,z]=u.useState(!1),[R,B]=u.useState(""),[Q,Me]=u.useState(""),[Ve,$]=u.useState(!1),[F,L]=u.useState(""),Y=u.useCallback(async t=>{var n;try{const a=await y(`/api/patients/${t}`);if(!a.ok)throw new Error(`Failed to fetch patient details: ${a.status}`);const i=await a.json();H(i.age),q(((n=i.sex)==null?void 0:n.toLowerCase())==="female"?"female":"male"),i.phone&&b(s=>s?{...s,Patient:{...s.Patient,phone:i.phone}}:null)}catch(a){console.error("Error fetching patient details:",a),H(null),q(null)}},[]),Z=u.useCallback(async()=>{if(l){k(!0),S(null);try{const t=await y(`/api/lab/${l}`);if(!t.ok){const i=await t.json().catch(()=>({message:`HTTP error! status: ${t.status}`}));throw new Error(i.message||`HTTP error! status: ${t.status}`)}const n=await t.json();if(b(n),n.createdAt)try{const i=new Date(n.createdAt),s=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16);K(s)}catch(i){console.error("Error formatting date for edit:",i)}if(n.report_date)try{const i=new Date(n.report_date),s=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16);B(s)}catch(i){console.error("Error formatting report date for edit:",i)}else{const i=new Date,s=new Date(i.getTime()-i.getTimezoneOffset()*6e4).toISOString().slice(0,16);B(s)}n.referral_doctor&&L(n.referral_doctor),n.patient_id&&Y(n.patient_id);const a={};if(n.tests&&n.tests.forEach(i=>{a[i.id]={},i.default_parameters&&i.default_parameters.length>0?i.default_parameters.forEach(s=>{a[i.id][s.name]=s.defaultValue}):a[i.id].report_content=""}),n.report_content)try{const i=JSON.parse(n.report_content);typeof i=="object"&&i!==null&&!Array.isArray(i)?g(i):(console.warn("Legacy or unexpected report content format detected. Initializing with defaults."),g(a))}catch{console.warn("Legacy report content detected (not JSON). Initializing with defaults."),g(a)}else g({})}catch(t){console.error("Failed to fetch lab order details:",t),S(t instanceof Error?t.message:"An unknown error occurred while fetching order details.")}finally{k(!1)}}},[l,Y]);u.useEffect(()=>{l?Z():(S("No Order ID provided in the URL."),k(!1))},[l,Z]),u.useEffect(()=>{(async()=>{try{const n=await y("/api/clinics/settings");if(n.ok){const a=await n.json();Me(a.labLetterheadUrl||"")}}catch(n){console.error("Error fetching clinic settings:",n)}})()},[]);const D=(t,n,a)=>{g(i=>{var de,ue,pe,me,he,fe,xe,be,ge,je,ye,Ne,ve,we,Se,_e,Pe,Ce,Fe;const s={...i,[t]:{...i[t],[n]:a}},f=parseFloat((de=s[t])==null?void 0:de.Creatinine),c=U,p=W;if(n==="Creatinine"&&!isNaN(f)&&c!==null&&p!==null){const h=at(f,c,p);h!==null&&((ue=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&ue.default_parameters.find(d=>d.name==="eGFR"))&&(s[t].eGFR=h)}const N=parseFloat((pe=s[t])==null?void 0:pe["Total Cholesterol"]),_=parseFloat((me=s[t])==null?void 0:me["HDL Cholesterol"]),j=parseFloat((he=s[t])==null?void 0:he.Triglycerides);if((n==="Total Cholesterol"||n==="HDL Cholesterol"||n==="Triglycerides")&&!isNaN(N)&&!isNaN(_)&&!isNaN(j)){const h=nt(N,_,j);h!==null&&((fe=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&fe.default_parameters.find(d=>d.name==="LDL Cholesterol"))&&(s[t]["LDL Cholesterol"]=h)}const ae=parseFloat((xe=s[t])==null?void 0:xe["Total Bilirubin"]),ne=parseFloat((be=s[t])==null?void 0:be["Direct Bilirubin"]);if((n==="Total Bilirubin"||n==="Direct Bilirubin")&&!isNaN(ae)&&!isNaN(ne)){const h=rt(ae,ne);h!==null&&((ge=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&ge.default_parameters.find(d=>d.name==="Indirect Bilirubin"))&&(s[t]["Indirect Bilirubin"]=h)}const re=parseFloat((je=s[t])==null?void 0:je["Total Protein"]),se=parseFloat((ye=s[t])==null?void 0:ye.Albumin);if((n==="Total Protein"||n==="Albumin")&&!isNaN(re)&&!isNaN(se)){const h=st(re,se);h!==null&&((Ne=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&Ne.default_parameters.find(d=>d.name==="Globulin"))&&(s[t].Globulin=h)}const E=parseFloat((ve=s[t])==null?void 0:ve.Sodium),ie=parseFloat((we=s[t])==null?void 0:we.Chloride),le=parseFloat((Se=s[t])==null?void 0:Se.Bicarbonate);if((n==="Sodium"||n==="Chloride"||n==="Bicarbonate")&&!isNaN(E)&&!isNaN(ie)&&!isNaN(le)){const h=it(E,ie,le);h!==null&&((_e=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&_e.default_parameters.find(d=>d.name==="Anion Gap"))&&(s[t]["Anion Gap"]=h)}const oe=parseFloat((Pe=s[t])==null?void 0:Pe.Glucose),ce=parseFloat((Ce=s[t])==null?void 0:Ce.BUN);if((n==="Sodium"||n==="Glucose"||n==="BUN")&&!isNaN(E)&&!isNaN(oe)&&!isNaN(ce)){const h=lt(E,oe,ce);h!==null&&((Fe=r==null?void 0:r.tests.find(d=>d.id===t))!=null&&Fe.default_parameters.find(d=>d.name==="Osmolality"))&&(s[t].Osmolality=h)}return s})},Je=async t=>{const n=m[t]||{},a=r==null?void 0:r.tests.find(c=>c.id===t);if(!a)return;const i={};a.default_parameters&&a.default_parameters.forEach(c=>{i[c.name]=c.defaultValue});const s={...i,...n},f={...m,[t]:s};g(f),w(!0),S(null);try{const c=await y(`/api/lab/${l}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(f),isPartial:!0})});if(!c.ok)throw new Error(`Save failed: ${c.status}`)}catch(c){console.error("Error saving test report:",c),alert("Failed to save test report.")}finally{w(!1)}},I=async(t=null)=>{if(!r||!r.tests||!l){alert("Order details not loaded.");return}w(!0),S(null);try{let n;if(t===null){const i={};r.tests.forEach(s=>{const f=m[s.id]||{},c={};s.default_parameters&&s.default_parameters.forEach(p=>{p.defaultValue!==void 0&&p.defaultValue!==null&&(c[p.name]=p.defaultValue)}),i[s.id]={...c,...f},(!s.default_parameters||s.default_parameters.length===0)&&!i[s.id].report_content&&(i[s.id].report_content="")}),n=i,g(i)}else{const i=m[t]||{},s=r.tests.find(p=>p.id===t);if(!s){w(!1);return}const f={};s.default_parameters&&s.default_parameters.forEach(p=>{f[p.name]=p.defaultValue});const c={...f,...i};n={...m,[t]:c},g(n)}const a=await y(`/api/lab/${l}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(n),isPartial:t!==null})});if(!a.ok)throw new Error(`Save failed: ${a.status}`);Le(t),setTimeout(()=>{window.print()},100)}catch(n){console.error("Error saving before print:",n),alert("Failed to save report before printing.")}finally{w(!1)}},Ue=()=>{r&&Ie(r)},He=async()=>{if(!r||!r.tests){alert("Order details not loaded.");return}if(!l){alert("Cannot submit report without an Order ID.");return}const t={};if(r.tests.forEach(n=>{const a=m[n.id]||{},i={};n.default_parameters&&n.default_parameters.forEach(s=>{s.defaultValue!==void 0&&s.defaultValue!==null&&(i[s.name]=s.defaultValue)}),t[n.id]={...i,...a},(!n.default_parameters||n.default_parameters.length===0)&&!t[n.id].report_content&&(t[n.id].report_content="")}),Object.keys(t).length===0){alert("Report content cannot be empty.");return}g(t),w(!0),S(null);try{const n=await y(`/api/lab/${l}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(t)})});if(!n.ok){const a=await n.json().catch(()=>({message:`Submission failed: ${n.status}`}));throw new Error(a.message||`Submission failed: ${n.status}`)}o(-1)}catch(n){console.error("Error submitting report:",n),S(n instanceof Error?n.message:"An unknown error occurred during submission.")}finally{w(!1)}},We=async()=>{if(!(!l||!O))try{const t=await y(`/api/lab/orders/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:new Date(O).toISOString()})});if(!t.ok)throw new Error("Failed to update date");const n=await t.json();n.order&&b(a=>a?{...a,createdAt:n.order.createdAt}:null),A(!1)}catch(t){console.error("Failed to update date:",t),alert("Failed to update date")}},qe=async()=>{if(!(!l||!R))try{const t=await y(`/api/lab/orders/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reportDate:new Date(R).toISOString()})});if(!t.ok)throw new Error("Failed to update report date");const n=await t.json();n.order&&b(a=>a?{...a,report_date:n.order.report_date}:null),z(!1)}catch(t){console.error("Failed to update report date:",t),alert("Failed to update report date")}},Xe=async()=>{if(l)try{const t=await y(`/api/lab/orders/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralDoctor:F})});if(!t.ok)throw new Error("Failed to update referral doctor");const n=await t.json();n.order&&(L(n.order.referral_doctor||""),b(a=>a?{...a,referral_doctor:n.order.referral_doctor}:null)),$(!1)}catch(t){console.error("Failed to update referral doctor:",t),alert("Failed to update referral doctor")}};if(Re)return e.jsx("div",{className:"lab-inventory-container enter-lab-report-page",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem"},children:[e.jsx(x,{width:200,height:28}),e.jsxs("div",{className:"header-actions",style:{display:"flex",gap:"8px"},children:[e.jsx(x,{width:80,height:32}),e.jsx(x,{width:80,height:32}),e.jsx(x,{width:80,height:32})]})]}),e.jsxs("div",{className:"lab-inventory-card no-print summary-card",style:{margin:"1rem",padding:"0"},children:[e.jsx("div",{className:"lab-inventory-header summary-header",style:{padding:"0.75rem 1rem",borderBottom:"1px solid #eee"},children:e.jsx(x,{width:120,height:20})}),e.jsxs("div",{className:"summary-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",padding:"1rem"},children:[e.jsx(x,{height:24}),e.jsx(x,{height:24}),e.jsx(x,{height:24}),e.jsx(x,{height:24})]})]}),e.jsx("div",{className:"lab-tests-container no-print",style:{padding:"1rem"},children:[1,2].map(t=>e.jsxs("div",{className:"test-card",style:{marginBottom:"1.5rem",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1rem",background:"white"},children:[e.jsxs("div",{className:"test-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsx(x,{width:250,height:24}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx(x,{width:70,height:30}),e.jsx(x,{width:36,height:30})]})]}),e.jsx("div",{className:"parameter-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[1,2,3,4].map(n=>e.jsxs("div",{className:"parameter-item",children:[e.jsx(x,{width:"30%",height:16,style:{marginBottom:"0.5rem"}}),e.jsx(x,{height:40})]},n))})]},t))})]})});if(C&&!r)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card error-message-container",style:{textAlign:"center",padding:"30px"},children:[e.jsx(Ee,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("h3",{className:"error-title",style:{borderBottom:"none"},children:"Error Loading Details"}),e.jsx("p",{className:"error-text",children:C}),e.jsx("button",{onClick:()=>o(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"20px"},children:e.jsx(G,{size:16})})]})});if(!r)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(Te,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("p",{className:"no-data-message",style:{fontSize:"1.1em"},children:`Lab order not found for ID: ${l}.`}),e.jsx("button",{onClick:()=>o(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"15px"},children:e.jsx(G,{size:16})})]})});const Ke=(ee=r==null?void 0:r.Patient)==null?void 0:ee.name,Qe=(te=r==null?void 0:r.Patient)==null?void 0:te.patient_token_number;return e.jsx("div",{className:"lab-inventory-container enter-lab-report-page",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",children:[e.jsx("h2",{children:"Enter Lab Report"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{onClick:()=>o(-1),className:"lab-inventory-button lab-inventory-button-secondary compact-btn",disabled:v,children:e.jsx(G,{size:16})}),e.jsxs("button",{onClick:()=>I(null),className:"lab-inventory-button compact-btn",title:"Print Full Report",children:[e.jsx(ke,{size:16}),e.jsx("span",{className:"btn-text",children:"Print"})]}),e.jsxs("button",{onClick:Ue,className:"lab-inventory-button whatsapp-btn compact-btn",title:"Share via WhatsApp",children:[e.jsx(et,{size:16}),e.jsx("span",{className:"btn-text",children:"Share"})]})]})]}),r&&e.jsxs("div",{className:"lab-inventory-card no-print summary-card",children:[e.jsxs("h3",{className:"lab-inventory-header summary-header",children:[e.jsx(Te,{size:14})," Summary"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(Ae,{size:13,className:"icon"}),e.jsx("strong",{children:"Patient:"})," ",Ke??"N/A"," (",Qe??"N/A",")"]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Oe,{size:13,className:"icon"}),e.jsx("strong",{children:"Ordered:"})," ",De?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"datetime-local",value:O,onChange:t=>K(t.target.value),className:"lab-inventory-input date-input"}),e.jsx("button",{onClick:We,className:"icon-btn save",children:e.jsx(M,{size:12})}),e.jsx("button",{onClick:()=>A(!1),className:"icon-btn cancel",children:e.jsx(V,{size:12})})]}):e.jsxs(e.Fragment,{children:[J(new Date(r.createdAt),"dd MMM, HH:mm"),e.jsx("button",{onClick:()=>A(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(T,{size:11})})]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Oe,{size:13,className:"icon"}),e.jsx("strong",{children:"Reported:"})," ",Ge?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"datetime-local",value:R,onChange:t=>B(t.target.value),className:"lab-inventory-input date-input"}),e.jsx("button",{onClick:qe,className:"icon-btn save",children:e.jsx(M,{size:12})}),e.jsx("button",{onClick:()=>z(!1),className:"icon-btn cancel",children:e.jsx(V,{size:12})})]}):e.jsxs(e.Fragment,{children:[r.report_date?J(new Date(r.report_date),"dd MMM, HH:mm"):"Not Set",e.jsx("button",{onClick:()=>z(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(T,{size:11})})]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Ae,{size:13,className:"icon"}),e.jsx("strong",{children:"Ref. Doctor:"})," ",Ve?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"text",value:F,onChange:t=>L(t.target.value),className:"lab-inventory-input date-input",placeholder:"Enter referral doctor name"}),e.jsx("button",{onClick:Xe,className:"icon-btn save",children:e.jsx(M,{size:12})}),e.jsx("button",{onClick:()=>$(!1),className:"icon-btn cancel",children:e.jsx(V,{size:12})})]}):e.jsxs(e.Fragment,{children:[F||"Not Set",e.jsx("button",{onClick:()=>$(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(T,{size:11})})]})]})]})]}),e.jsxs("div",{className:"lab-tests-container no-print",children:[r==null?void 0:r.tests.map(t=>{var n;return e.jsxs("div",{className:"test-card",children:[e.jsxs("div",{className:"test-header",children:[e.jsx("h4",{children:t.name}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsxs("button",{type:"button",onClick:a=>{a.stopPropagation(),Je(t.id)},className:"lab-inventory-button lab-inventory-button-secondary compact-btn",disabled:v,children:[e.jsx(ze,{size:14}),e.jsx("span",{className:"btn-text",children:"Save"})]}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),I(t.id)},className:"lab-inventory-button compact-btn",title:"Print",children:e.jsx(ke,{size:14})})]})]}),e.jsx("div",{className:"test-parameters-body",children:t.default_parameters&&t.default_parameters.length>0?e.jsx("div",{className:"parameter-grid",children:t.default_parameters.map(a=>{var N,_;const i=(N=m[t.id])==null?void 0:N[a.name],s=i!==void 0?i:a.defaultValue??"",f=a.type==="number"&&s!==""&&(a.lower_limit!=null&&parseFloat(String(s))<a.lower_limit||a.upper_limit!=null&&parseFloat(String(s))>a.upper_limit),c=ot(a.name),p=(_=Be[t.id])==null?void 0:_[a.name];return e.jsxs("div",{className:"parameter-item",children:[e.jsxs("label",{className:"parameter-label",htmlFor:`${t.id}-${a.name}`,children:[a.name," ",a.unit&&e.jsxs("span",{className:"parameter-unit",children:["(",a.unit,")"]})]}),e.jsxs("div",{className:"input-wrapper",children:[a.type==="boolean"?e.jsxs("select",{id:`${t.id}-${a.name}`,value:(s==null?void 0:s.toString())??"false",onChange:j=>D(t.id,a.name,j.target.value==="true"),className:"lab-inventory-input parameter-input",disabled:v,children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-Reactive"})]}):e.jsx("input",{id:`${t.id}-${a.name}`,type:a.type==="number"?"number":"text",value:s,onChange:j=>D(t.id,a.name,j.target.value),className:`lab-inventory-input parameter-input ${f?"abnormal-result":""} ${c?"calculated-input":""}`,disabled:v||c&&!p,placeholder:a.lower_limit!=null&&a.upper_limit!=null?`${a.lower_limit}-${a.upper_limit}`:""}),c&&e.jsx("button",{type:"button",onClick:()=>$e(j=>({...j,[t.id]:{...j[t.id]||{},[a.name]:!p}})),className:"edit-calculated-btn",title:p?"Lock":"Edit",children:e.jsx(T,{size:11})})]})]},a.name)})}):e.jsxs("div",{className:"parameter-item",style:{width:"100%"},children:[e.jsx("label",{className:"parameter-label",htmlFor:`${t.id}-report_content`,children:"Results / Observations"}),e.jsx("textarea",{id:`${t.id}-report_content`,value:((n=m[t.id])==null?void 0:n.report_content)??"",onChange:a=>D(t.id,"report_content",a.target.value),className:"lab-inventory-input parameter-textarea",rows:3,placeholder:`Enter results for ${t.name}...`,disabled:v})]})})]},t.id)}),C&&e.jsxs("p",{className:"error-text",style:{marginTop:"10px"},children:[e.jsx(Ee,{size:15,className:"inline mr-1"}),C]})]}),e.jsx("div",{className:"form-actions-footer no-print",children:e.jsx("button",{type:"button",onClick:He,disabled:v,className:"lab-inventory-button lab-inventory-button-primary submit-btn",children:v?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"animate-spin",size:16})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ze,{size:16})," Save All"]})})}),e.jsxs("div",{className:"printable-only",children:[Q&&e.jsx("div",{className:"print-letterhead-container",children:e.jsx("img",{src:Q,alt:"Lab Letterhead",className:"print-letterhead-image"})}),r&&r.Patient&&e.jsxs("div",{style:{marginBottom:"20px",borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"15px"},children:"Lab Report"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",fontSize:"12px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Patient Name:"})," ",r.Patient.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Age/Sex:"})," ",U??"N/A"," / ",W??"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ref. Doctor:"})," ",F||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",J(new Date(r.createdAt),"PPpp")]})]})]}),r==null?void 0:r.tests.filter(t=>X===null||t.id===X).map(t=>{var n;return e.jsxs("div",{style:{marginBottom:"20px",pageBreakInside:"avoid"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #eee",paddingBottom:"5px"},children:t.name}),t.default_parameters&&t.default_parameters.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9f9f9"},children:[e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Parameter"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Result"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Units"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Normal Range"})]})}),e.jsx("tbody",{children:t.default_parameters.map(a=>{var N;const i=(N=m[t.id])==null?void 0:N[a.name],s=typeof i=="string"?parseFloat(i):typeof i=="number"?i:NaN,f=a.type==="number"&&!isNaN(s)&&i!==""&&(a.lower_limit!=null&&s<a.lower_limit||a.upper_limit!=null&&s>a.upper_limit),c=a.type==="boolean"&&(i===!0||i==="true"),p=a.type==="boolean"?i===!0||i==="true"?"Reactive":"Non-Reactive":i??"";return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:a.name}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee",fontWeight:f||c?"bold":"normal",color:f?"red":c?"green":"inherit"},children:p}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:a.unit??""}),e.jsxs("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:[a.lower_limit!==null&&a.lower_limit!==void 0&&`> ${a.lower_limit}`,a.lower_limit!==null&&a.lower_limit!==void 0&&a.upper_limit!==null&&a.upper_limit!==void 0&&" - ",a.upper_limit!==null&&a.upper_limit!==void 0&&`< ${a.upper_limit}`]})]},a.name)})})]}):e.jsx("div",{style:{whiteSpace:"pre-wrap",fontSize:"12px",padding:"10px"},children:((n=m[t.id])==null?void 0:n.report_content)||"No report content entered."})]},t.id)})]})]})})};export{jt as default};
