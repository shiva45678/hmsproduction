import{y as Ve,f as p,p as We,j as e,S as i,E as Xe}from"./index-jGjkutd2.js";import{u as Je,r as l,b as Ke}from"./react-vendor-Cc0P4_ZX.js";import{M as Ye}from"./ManageCustomColumnsModal-DwhioBvT.js";import{c as Ze,p as pe,i as je,d as J}from"./utils-vendor-azd6ta8e.js";import{Z as $,af as Qe,Y as es,aw as ss,a7 as O,i as ts,m as ye,ax as ve,ay as be,X as N}from"./ui-vendor-B5keALZQ.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const K=10,as=3,ms=({isEmbedded:f=!1,initialSearch:S=""})=>{const g=Je(),{customColumnsConfig:Y,refetch:Ne}=Ve(),D=Y.drugs||[],[fe,Z]=l.useState(!1),[T,Q]=l.useState(!1),[A,z]=l.useState([]),[x,ee]=l.useState([]),[k,se]=l.useState(S),[ge,m]=l.useState(!0),[d,o]=l.useState(null),[P,te]=l.useState(new Set),[y,ke]=l.useState("all"),Ce=async()=>{try{const s=await p("/api/inventory/download-csv");if(!s.ok)throw new Error(`Failed to download CSV: ${s.statusText}`);const t=await s.blob(),n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download="pharmacy_inventory.csv",document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}catch(s){console.error("Failed to download CSV:",s),o(s.message||"Failed to download inventory CSV. Please try again.")}},[we,I]=l.useState(!1),[Se,ae]=l.useState(!1),[v,ne]=l.useState(null),[De,le]=l.useState(!1),[h,C]=l.useState(new Set),[E,L]=l.useState(1),_=8,[b,R]=l.useState(null),[F,Te]=l.useState(0),[Ae,oe]=l.useState(!1),[c,ie]=l.useState(null),[u,B]=l.useState(1),[Pe,ce]=l.useState(!1),re=E*_,Ee=re-_,de=x.slice(Ee,re),M=Math.ceil(x.length/_);l.useEffect(()=>{L(1)},[k,y]);const j=l.useCallback(async()=>{m(!0),o(null);try{const s=await p("/api/drugs");if(!s.ok)throw new Error(`Failed to fetch drugs: ${s.statusText} (${s.status})`);const t=await s.json();let n=Array.isArray(t)?t:t.drugs||[];n=n.map(a=>({...a,mrp:parseFloat(String(a.mrp))||0,rate:a.rate!==null&&a.rate!==void 0?parseFloat(String(a.rate)):null,stock:parseInt(String(a.stock),10)||0,gst:a.gst!==null&&a.gst!==void 0?parseFloat(String(a.gst)):null,margin:a.margin!==null&&a.margin!==void 0?parseFloat(String(a.margin)):null,discount:a.discount!==null&&a.discount!==void 0?parseFloat(String(a.discount)):null})),z(n),ee(n)}catch(s){console.error("Failed to fetch drugs:",s),o(s.message||"Failed to load inventory. Please try again.")}finally{m(!1)}},[]);l.useEffect(()=>{j()},[j]),l.useEffect(()=>{S&&se(S)},[S]);const he=l.useMemo(()=>new We(A,{keys:["name","brand_name","description","supplier","box_number"],threshold:.3,ignoreLocation:!0}),[A]);l.useEffect(()=>{let s=A;k&&(s=he.search(k).map(a=>a.item));const t=new Date,n=Ze(t,as);y==="low-stock"?s=s.filter(a=>a.stock<=K):y==="near-expiry"?s=s.filter(a=>{if(!a.expiry_date)return!1;const r=pe(a.expiry_date);return je(r)&&J(r,n)&&!J(r,t)}):y==="expired"&&(s=s.filter(a=>{if(!a.expiry_date)return!1;const r=pe(a.expiry_date);return je(r)&&J(r,t)})),ee(s)},[k,A,y,he]);const U=()=>{I(!1),R(null)},Fe=s=>{Te(parseInt(s.target.value,10)||0)},Me=async s=>{if(s.preventDefault(),o(null),!b||!b.id||F===0){o("No drug selected or adjustment amount is zero.");return}try{const t=await p(`/api/drugs/${b.id}/adjust-stock`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantityChange:F})});if(!t.ok){const a=await t.json();throw new Error(a.message||`Failed to adjust stock: ${t.statusText}`)}const n=await t.json();z(a=>a.map(r=>r.id===n.id?n:r)),U(),alert(`Stock for "${n.name}" adjusted successfully. New stock: ${n.stock}`)}catch(t){console.error("Failed to adjust stock:",t),o(t.message||"Failed to adjust stock. Please try again.")}},me=s=>{ne(s),ae(!0)},G=()=>{ae(!1),ne(null)},$e=async()=>{if(!v||!v.id){o("No drug selected for deletion.");return}m(!0),o(null);try{const s=await p(`/api/drugs/${v.id}`,{method:"DELETE"});if(!s.ok){const t=await s.json();throw new Error(t.message||`Failed to delete drug: ${s.statusText}`)}alert(`Drug "${v.name}" deleted successfully.`),j(),G()}catch(s){console.error("Failed to delete drug:",s),o(s.message||"Failed to delete drug. Please try again.")}finally{m(!1)}},Oe=()=>{le(!0)},H=()=>{le(!1)},[ze,xe]=l.useState(!1),Ie=()=>{h.size>0&&xe(!0)},q=()=>{xe(!1)},Le=async()=>{if(h.size===0){o("No drugs selected for deletion.");return}m(!0),o(null);try{const s=await p("/api/drugs/batch-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({drugIds:Array.from(h)})});if(!s.ok){const t=await s.json();throw new Error(t.message||`Failed to delete selected drugs: ${s.statusText}`)}alert(`${h.size} drug(s) deleted successfully.`),j(),C(new Set),q()}catch(s){console.error("Failed to delete selected drugs:",s),o(s.message||"Failed to delete selected drugs. Please try again.")}finally{m(!1)}},_e=async()=>{m(!0),o(null);try{const s=await p("/api/drugs/all",{method:"DELETE"});if(!s.ok){const t=await s.json();throw new Error(t.message||`Failed to delete all drugs: ${s.statusText}`)}alert("All drugs deleted successfully."),j(),H()}catch(s){console.error("Failed to delete all drugs:",s),o(s.message||"Failed to delete all drugs. Please try again.")}finally{m(!1)}},w=s=>{if(!s)return null;const t=s.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return t?parseInt(t[1],10):null},ue=s=>{ie(s),B(1),oe(!0)},V=()=>{oe(!1),ie(null),B(1)},Re=s=>{B(parseInt(s.target.value,10)||0)},Be=async s=>{if(s.preventDefault(),o(null),!c||!c.id||u<=0){o("No drug selected or invalid number of packs to convert.");return}const t=w(c.pack);if(!t||t<=0){o(`Cannot convert "${c.name}" to loose. Invalid pack unit: ${c.pack||"N/A"}.`);return}if(u>(c.stock??0)){o(`Cannot convert ${u} packs. Only ${c.stock??0} packs are in stock.`);return}try{const n=await p(`/api/drugs/${c.id}/convert-to-loose`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({packsToConvert:u,packSize:t})});if(!n.ok){const r=await n.json();throw new Error(r.message||`Failed to convert to loose: ${n.statusText}`)}const a=await n.json();z(r=>r.map(X=>X.id===a.id?a:X)),V(),alert(`Converted ${u} pack(s) of "${a.name}" to loose. New stock: ${a.stock} packs, ${a.loose??0} loose units.`)}catch(n){console.error("Failed to convert to loose:",n),o(n.message||"Failed to convert to loose. Please try again.")}finally{m(!1)}},Ue=()=>{ce(!0)},W=()=>{ce(!1)},Ge=async()=>{m(!0),o(null);try{const s=await p("/api/drugs/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!s.ok){const t=await s.json();throw new Error(t.message||`Failed to add default medications: ${s.statusText}`)}alert("Default medications added successfully."),j(),W()}catch(s){console.error("Failed to add default medications:",s),o(s.message||"Failed to add default medications. Please try again.")}finally{m(!1)}};return ge?e.jsxs("div",{className:`pharmacy-inventory-page ${f?"embedded":""}`,style:f?{minHeight:"auto",padding:"0",background:"transparent"}:{},children:[e.jsx("div",{className:"inventory-header-controls",style:{padding:"20px 20px 0 20px"},children:e.jsxs("div",{className:"inventory-actions-group",children:[e.jsx("div",{className:"action-group-left",style:{display:"flex",gap:"12px"},children:[1,2,3,4].map(s=>e.jsx(i,{width:120,height:36},s))}),e.jsxs("div",{className:"action-group-right",style:{display:"flex",gap:"12px"},children:[e.jsx(i,{width:100,height:36}),[1,2,3,4].map(s=>e.jsx(i,{width:120,height:36},s))]})]})}),e.jsxs("div",{className:"search-bar-container",style:{padding:"0 20px 20px 20px",borderBottom:"1px solid var(--border-color)",marginBottom:"0"},children:[e.jsx(i,{width:"100%",height:40,style:{maxWidth:"600px"}}),e.jsx(i,{width:150,height:40})]}),e.jsx("div",{className:"inventory-table-container",children:e.jsxs("table",{className:"inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-column",children:e.jsx(i,{width:20,height:20})}),e.jsx("th",{children:"DRUG DETAILS"}),e.jsx("th",{children:"PACK"}),e.jsx("th",{children:"EXPIRY"}),e.jsx("th",{className:"qty-header",children:"STOCK"}),e.jsx("th",{className:"mrp-header",children:"MRP"}),e.jsx("th",{className:"rate-header",children:"RATE"}),e.jsx("th",{children:"BOX"}),e.jsx("th",{children:"DISC %"}),e.jsx("th",{children:"MARGIN"}),e.jsx("th",{className:"actions-cell",children:"ACTIONS"})]})}),e.jsx("tbody",{children:[1,2,3,4,5,6,7,8].map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"checkbox-cell",children:e.jsx(i,{width:20,height:20})}),e.jsxs("td",{children:[e.jsx(i,{width:"80%",height:20}),e.jsx(i,{width:"40%",height:14,style:{marginTop:"4px"}})]}),e.jsx("td",{children:e.jsx(i,{width:60,height:20})}),e.jsx("td",{children:e.jsx(i,{width:100,height:20})}),e.jsxs("td",{children:[e.jsx(i,{width:40,height:20}),e.jsx(i,{width:60,height:14,style:{marginTop:"4px"}})]}),e.jsx("td",{children:e.jsx(i,{width:80,height:20})}),e.jsx("td",{children:e.jsx(i,{width:80,height:20})}),e.jsx("td",{children:e.jsx(i,{width:40,height:20})}),e.jsx("td",{children:e.jsx(i,{width:60,height:20})}),e.jsx("td",{children:e.jsx(i,{width:60,height:20})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{width:20,height:20}),e.jsx(i,{width:20,height:20}),e.jsx(i,{width:20,height:20})]})})]},s))})]})})]}):d?e.jsxs("div",{className:"error-indicator",children:["Error: ",d]}):e.jsxs("div",{className:`pharmacy-inventory-page ${f?"embedded":""}`,style:f?{minHeight:"auto",padding:"0",background:"transparent"}:{},children:[e.jsx("div",{className:"inventory-header-controls",style:{padding:"20px 20px 0 20px"},children:e.jsxs("div",{className:"inventory-actions-group",children:[e.jsxs("div",{className:"action-group-left",style:{display:"flex",gap:"12px"},children:[e.jsxs("button",{onClick:()=>g("/dashboard/purchase"),className:"action-button-outline add-drug-button",children:[e.jsx($,{size:18}),"Add New Drug"]}),e.jsxs("button",{onClick:()=>g("/dashboard/purchase"),className:"action-button-outline",children:[e.jsx($,{size:18}),"Purchase Page"]}),e.jsxs("button",{onClick:()=>g("/dashboard/distributors"),className:"action-button-outline",children:[e.jsx($,{size:18}),"Distributors"]}),e.jsxs("button",{onClick:()=>Z(!0),className:"action-button-outline",title:"Manage Custom Columns",children:[e.jsx(Qe,{size:18}),"Columns"]})]}),e.jsxs("div",{className:"action-group-right",style:{display:"flex",gap:"12px"},children:[e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>Q(!1),className:`view-mode-btn ${T?"":"active"}`,title:"List View",children:[e.jsx(es,{size:18})," List"]}),e.jsxs("button",{onClick:()=>Q(!0),className:`view-mode-btn ${T?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(ss,{size:18})," Excel"]})]}),e.jsx("button",{onClick:Ce,className:"action-button-outline",children:"Download CSV"}),e.jsxs("button",{onClick:Ue,className:"action-button-outline",children:[e.jsx($,{size:18}),"Import Defaults"]}),e.jsxs("button",{onClick:Ie,className:"action-button-outline delete-button-outline",disabled:h.size===0,children:[e.jsx(O,{size:18}),"Delete (",h.size,")"]}),e.jsxs("button",{onClick:Oe,className:"action-button-outline delete-all-button-outline",children:[e.jsx(O,{size:18}),"Delete All"]})]})]})}),e.jsxs("div",{className:"search-bar-container",style:{padding:"0 20px 20px 20px",borderBottom:"1px solid var(--border-color)",marginBottom:"0"},children:[e.jsxs("div",{className:"search-input-wrapper",style:{maxWidth:"600px"},children:[e.jsx(ts,{size:20,className:"search-input-icon"}),e.jsx("input",{type:"text",placeholder:"Search drugs...",value:k,onChange:s=>se(s.target.value),className:"inventory-search-input"})]}),e.jsx("div",{className:"filter-dropdown-wrapper",children:e.jsxs("select",{value:y,onChange:s=>ke(s.target.value),className:"inventory-filter-select",children:[e.jsx("option",{value:"all",children:"All Drugs"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"near-expiry",children:"Near Expiry"}),e.jsx("option",{value:"expired",children:"Expired"})]})})]}),T?e.jsx("div",{className:"inventory-table-container",style:{padding:"1rem"},children:e.jsx(Xe,{title:"Pharmacy Inventory",columns:[{key:"name",label:"Drug Name",type:"text",editable:!0},{key:"brand_name",label:"Brand Name",type:"text",editable:!0},{key:"pack",label:"Pack",type:"text",editable:!0},{key:"expiry_date",label:"Expiry",type:"date",editable:!0},{key:"stock",label:"Stock",type:"number",editable:!0},{key:"mrp",label:"MRP",type:"number",editable:!0},{key:"rate",label:"Rate",type:"number",editable:!0},{key:"box_number",label:"Box",type:"text",editable:!0},{key:"discount",label:"Discount %",type:"number",editable:!0},{key:"gst",label:"GST %",type:"number",editable:!0},{key:"supplier",label:"Supplier",type:"text",editable:!0}],data:x,onSave:async s=>{try{for(const t of s)t.id&&await p(`/api/drugs/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});alert("Changes saved successfully!"),j()}catch(t){console.error("Failed to save:",t),o(t.message||"Failed to save changes")}},editable:!0,showRowNumbers:!0})}):e.jsx("div",{className:"inventory-table-container",children:e.jsxs("table",{className:"inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-column",children:e.jsx("input",{type:"checkbox",onChange:s=>{if(s.target.checked){const t=new Set(x.map(n=>n.id));C(t)}else C(new Set)},checked:h.size===x.length&&x.length>0,disabled:x.length===0})}),e.jsx("th",{className:"drug-name-header",children:"DRUG DETAILS"}),e.jsx("th",{className:"pack-header",children:"PACK"}),e.jsx("th",{className:"expiry-header",children:"EXPIRY"}),e.jsx("th",{className:"text-stock qty-header",children:"STOCK"}),e.jsx("th",{className:"text-price mrp-header",children:"MRP"}),e.jsx("th",{className:"text-cost rate-header",children:"RATE"}),e.jsx("th",{className:"box-number-header",children:"BOX"}),e.jsx("th",{className:"discount-header",children:"DISC %"}),e.jsx("th",{className:"margin-header",children:"MARGIN"}),e.jsx("th",{className:"actions-cell",children:"ACTIONS"})]})}),e.jsxs("tbody",{children:[x.length===0&&e.jsx("tr",{className:"no-results-message",children:e.jsx("td",{colSpan:11,children:"No drugs found matching your search."})}),de.map(s=>e.jsxs(Ke.Fragment,{children:[e.jsxs("tr",{className:"drug-row",onClick:()=>{const t=new Set(P);t.has(s.id)&&s.id!==void 0?t.delete(s.id):s.id!==void 0&&t.add(s.id),te(t)},children:[e.jsx("td",{className:"checkbox-cell",children:e.jsx("input",{type:"checkbox",onClick:t=>t.stopPropagation(),checked:h.has(s.id),onChange:()=>{const t=new Set(h);t.has(s.id)?t.delete(s.id):t.add(s.id),C(t)}})}),e.jsx("td",{className:"drug-name-cell",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:s.brand_name||s.name||"-"}),s.brand_name&&s.name&&s.brand_name!==s.name&&e.jsx("span",{className:"text-xs text-muted-foreground",style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:s.name})]})}),e.jsx("td",{className:"text-muted pack-cell",children:s.pack||"-"}),e.jsx("td",{className:"text-muted",children:s.expiry_date?new Date(s.expiry_date).toLocaleDateString("en-GB"):"-"}),e.jsxs("td",{className:`text-stock ${s.stock<=K?"low-stock":""}`,children:[e.jsx("div",{style:{fontWeight:"bold"},children:s.stock}),e.jsx("div",{className:"loose-quantity",children:s.loose!==null&&s.loose!==void 0?`${s.loose} loose`:"0 loose"})]}),e.jsxs("td",{className:"text-muted text-price",children:["₹",typeof s.mrp=="number"?s.mrp.toFixed(2):"N/A"]}),e.jsx("td",{className:"text-muted text-cost",children:s.rate!==null&&s.rate!==void 0?`₹${s.rate.toFixed(2)}`:"-"}),e.jsx("td",{className:"text-muted",children:s.box_number||"-"}),e.jsx("td",{className:"text-muted",children:s.discount!==null&&s.discount!==void 0?`${s.discount.toFixed(2)}%`:"0.00%"}),e.jsx("td",{className:"text-muted",children:(()=>{const t=s.mrp||0,n=s.rate||0,a=s.discount||0,r=s.gst||0,He=n*(1-a/100)*(1+r/100),qe=t-He;return`${(t>0?qe/t*100:0).toFixed(2)}%`})()}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),g(`/dashboard/inventory/edit/${s.id}`)},className:"action-icon-button",title:"Edit Drug",children:e.jsx(ye,{size:16})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),me(s)},className:"action-icon-button delete-button",title:"Delete Drug",children:e.jsx(O,{size:16})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),R(s),I(!0)},className:"action-icon-button adjust-stock-button",title:"Adjust Stock",children:e.jsx(ve,{size:16})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),ue(s)},className:"action-icon-button convert-to-loose-button",title:"Convert to Loose",disabled:!s.pack||w(s.pack)===null,children:e.jsx(be,{size:16})})]})})]}),P.has(s.id)&&e.jsx("tr",{className:"collapsible-row",children:e.jsx("td",{colSpan:11,children:e.jsxs("div",{className:"collapsible-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.description||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supplier:"})," ",s.supplier||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Batch:"})," ",s.batch||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"HSN Code:"})," ",s.hsn_code||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"MFG:"})," ",s.mfg||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Loose Price:"}),(()=>{const t=w(s.pack);return t&&t>0&&typeof s.mrp=="number"?`₹${(s.mrp/t).toFixed(2)}`:"N/A"})()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"GST:"})," ",s.gst!==null&&s.gst!==void 0?`${s.gst.toFixed(2)}%`:"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(s.last_updated).toLocaleString()]}),D.length>0&&e.jsx("div",{className:"custom-fields-display",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px dashed var(--border-color)"},children:D.map(t=>{var n;return e.jsxs("p",{children:[e.jsxs("strong",{children:[t.label,":"]})," ",(n=s.custom_fields)!=null&&n[t.key]?String(s.custom_fields[t.key]):"-"]},t.key)})})]})})})]},s.id))]})]})}),e.jsx("div",{className:`inventory-grid-mobile ${f?"embedded":""}`,style:{display:T?"none":void 0},children:x.length===0?e.jsx("div",{className:"inventory-card-empty",children:"No drugs found matching your search."}):de.map(s=>e.jsxs("div",{className:"inventory-card",onClick:()=>{const t=new Set(P);t.has(s.id)&&s.id!==void 0?t.delete(s.id):s.id!==void 0&&t.add(s.id),te(t)},children:[e.jsxs("div",{className:"inventory-card-header",children:[e.jsxs("div",{className:"inventory-card-drug-info",children:[e.jsx("h4",{className:"inventory-card-drug-name",children:s.brand_name||s.name||"-"}),s.brand_name&&s.name&&s.brand_name!==s.name&&e.jsx("div",{className:"inventory-card-brand-name",children:s.name})]}),e.jsx("div",{className:"inventory-card-checkbox",onClick:t=>t.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:h.has(s.id),onChange:()=>{const t=new Set(h);t.has(s.id)?t.delete(s.id):t.add(s.id),C(t)}})})]}),e.jsxs("div",{className:"inventory-card-body",children:[e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Stock"}),e.jsxs("span",{className:`inventory-card-field-value stock-value ${s.stock<=K?"stock-low":""}`,children:[s.stock,e.jsxs("span",{className:"inventory-card-loose",children:[" (",s.loose??0," loose)"]})]})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"MRP"}),e.jsxs("span",{className:"inventory-card-field-value price-value",children:["₹",typeof s.mrp=="number"?s.mrp.toFixed(2):"N/A"]})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Pack"}),e.jsx("span",{className:"inventory-card-field-value",children:s.pack||"-"})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Expiry"}),e.jsx("span",{className:"inventory-card-field-value",children:s.expiry_date?new Date(s.expiry_date).toLocaleDateString("en-GB"):"-"})]})]}),P.has(s.id)&&e.jsxs("div",{className:"inventory-card-expanded",children:[e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Rate"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.rate!==null&&s.rate!==void 0?`₹${s.rate.toFixed(2)}`:"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Box"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.box_number||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Supplier"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.supplier||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Batch"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.batch||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"HSN Code"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.hsn_code||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Discount"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.discount!==null&&s.discount!==void 0?`${s.discount.toFixed(2)}%`:"0.00%"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"GST"}),e.jsx("span",{className:"inventory-card-expanded-value",children:s.gst!==null&&s.gst!==void 0?`${s.gst.toFixed(2)}%`:"-"})]}),D.length>0&&D.map(t=>{var n;return e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:t.label}),e.jsx("span",{className:"inventory-card-expanded-value",children:(n=s.custom_fields)!=null&&n[t.key]?String(s.custom_fields[t.key]):"-"})]},t.key)})]}),e.jsxs("div",{className:"inventory-card-actions",onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{className:"inventory-card-action-btn btn-edit",onClick:()=>g(`/dashboard/inventory/edit/${s.id}`),title:"Edit Drug",children:[e.jsx(ye,{size:14}),"Edit"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-delete",onClick:()=>me(s),title:"Delete Drug",children:[e.jsx(O,{size:14}),"Delete"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-adjust",onClick:()=>{R(s),I(!0)},title:"Adjust Stock",children:[e.jsx(ve,{size:14}),"Adjust"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-convert",onClick:()=>ue(s),title:"Convert to Loose",disabled:!s.pack||w(s.pack)===null,children:[e.jsx(be,{size:14}),"Loose"]})]})]},s.id))}),M>1&&e.jsxs("div",{className:"pagination-controls",style:{padding:"20px",display:"flex",justifyContent:"center",alignItems:"center",gap:"20px",backgroundColor:"var(--card-bg, #fff)",borderTop:"1px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>L(s=>Math.max(s-1,1)),disabled:E===1,className:"pagination-button",children:"Previous"}),e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Page ",E," of ",M]}),e.jsx("button",{onClick:()=>L(s=>Math.min(s+1,M)),disabled:E===M,className:"pagination-button",children:"Next"})]}),Se&&v&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:G,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion"}),e.jsxs("p",{className:"modal-description",children:['Are you sure you want to delete "',e.jsx("span",{className:"drug-name",children:v.name||"Unnamed Drug"}),'"? This action cannot be undone.']}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:G,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:$e,className:"button-delete",children:"Delete"})]})]})}),we&&b&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:U,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Adjust Stock"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:b.name||"Unnamed Drug"}),e.jsx("br",{}),"Current Stock: ",b.stock]}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("form",{onSubmit:Me,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adjustment",className:"form-label",children:"Adjustment Amount"}),e.jsx("input",{type:"number",name:"adjustment",id:"adjustment",required:!0,step:"1",value:F===0?"":F,onChange:Fe,placeholder:"e.g., 10 or -5",className:"form-input"}),e.jsx("p",{className:"form-help-text",children:"Enter a positive number to add stock, negative to remove."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:U,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Adjust Stock"})]})]})]})}),De&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:H,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of All Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:"ALL"})," drugs from the inventory? This action cannot be undone."]}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:H,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:_e,className:"button-delete",children:"Delete All"})]})]})}),ze&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:q,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of Selected Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:h.size})," selected drug(s)? This action cannot be undone."]}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:q,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Le,className:"button-delete",children:"Delete Selected"})]})]})}),Ae&&c&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:V,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Convert to Loose"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:c.name||"Unnamed Drug"}),e.jsx("br",{}),"Pack Size: ",c.pack,e.jsx("br",{}),"Current Stock: ",c.stock," packs, ",c.loose??0," loose units."]}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("form",{onSubmit:Be,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"packsToConvert",className:"form-label",children:"Packs to Convert"}),e.jsx("input",{type:"number",name:"packsToConvert",id:"packsToConvert",required:!0,step:"1",min:"1",max:c.stock,value:u===0?"":u,onChange:Re,className:"form-input"}),e.jsxs("p",{className:"form-help-text",children:["Converting ",u," pack(s) will add ",u*(w(c.pack)||0)," loose units."]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:V,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Convert"})]})]})]})}),Pe&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:W,className:"modal-close-button",children:e.jsx(N,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Add Default Medications"}),e.jsx("p",{className:"modal-description",children:"Are you sure you want to add default medications to the inventory? This will add a predefined set of common medications."}),d&&e.jsx("div",{className:"modal-error-message",children:d}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:W,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Ge,className:"button-submit",children:"Add Defaults"})]})]})}),e.jsx(Ye,{isOpen:fe,onClose:()=>Z(!1),entityType:"drugs",entityLabel:"Pharmacy Drugs",currentConfig:Y,onConfigUpdated:()=>{Ne()}})]})};export{ms as default};
