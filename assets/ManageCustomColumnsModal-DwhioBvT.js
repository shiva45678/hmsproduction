import{j as e,f as k}from"./index-jGjkutd2.js";import{r as o}from"./react-vendor-Cc0P4_ZX.js";import{X as q,a7 as S,e as w,f as A}from"./ui-vendor-B5keALZQ.js";const b=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"boolean",label:"Yes/No"},{value:"computed",label:"Computed (Formula)"}],z=({isOpen:c,onClose:i,entityType:u,entityLabel:v,currentConfig:d,onConfigUpdated:f})=>{const[n,m]=o.useState([]),[h,j]=o.useState(!1),[p,t]=o.useState(null),[s,r]=o.useState({key:"",label:"",type:"text",required:!1,formula:""});o.useEffect(()=>{c&&(m(d[u]||[]),t(null),r({key:"",label:"",type:"text",required:!1,formula:""}))},[c,d,u]);const y=l=>l.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_"),C=()=>{var a;if(!s.label.trim()){t("Column label is required");return}if(s.type==="computed"&&!((a=s.formula)!=null&&a.trim())){t("Formula is required for computed columns");return}const l=y(s.label);if(n.some(x=>x.key===l)){t("A column with this name already exists");return}m([...n,{...s,key:l}]),r({key:"",label:"",type:"text",required:!1,formula:""}),t(null)},g=l=>{m(n.filter(a=>a.key!==l))},N=async()=>{j(!0),t(null);try{const l={...d,[u]:n};if(!(await k("/api/clinics/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({custom_columns_config:l})})).ok)throw new Error("Failed to save custom columns");f(l),i()}catch(l){t(l.message||"Failed to save")}finally{j(!1)}};return c?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content manage-columns-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Manage Custom Columns - ",v]}),e.jsx("button",{onClick:i,className:"close-button",title:"Close",children:e.jsx(q,{size:24})})]}),p&&e.jsx("div",{className:"error-message",children:p}),e.jsxs("div",{className:"columns-list",children:[e.jsx("h4",{children:"Current Custom Columns"}),n.length===0?e.jsx("p",{className:"no-columns",children:"No custom columns defined yet."}):e.jsxs("table",{className:"columns-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Label"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(l=>{var a;return e.jsxs("tr",{children:[e.jsx("td",{children:l.label}),e.jsx("td",{children:((a=b.find(x=>x.value===l.type))==null?void 0:a.label)||l.type}),e.jsx("td",{children:l.type==="computed"?e.jsx("code",{className:"computed-formula",children:l.formula}):l.required?"Required":"Optional"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>g(l.key),className:"remove-column-btn",title:"Remove Column",children:e.jsx(S,{size:16})})})]},l.key)})})]})]}),e.jsxs("div",{className:"add-column-section",children:[e.jsx("h4",{children:"Add New Column"}),e.jsxs("div",{className:"add-column-form",children:[e.jsx("input",{type:"text",placeholder:"Column Label (e.g., BMI)",value:s.label,onChange:l=>r({...s,label:l.target.value}),className:"column-input"}),e.jsx("select",{value:s.type,onChange:l=>r({...s,type:l.target.value}),className:"column-select",children:b.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))}),s.type==="computed"?e.jsx("input",{type:"text",placeholder:"Formula (e.g. weight / (height * height))",value:s.formula||"",onChange:l=>r({...s,formula:l.target.value}),className:"column-input",style:{flex:2}}):e.jsxs("label",{className:"required-checkbox",children:[e.jsx("input",{type:"checkbox",checked:s.required,onChange:l=>r({...s,required:l.target.checked})}),"Required"]}),e.jsxs("button",{onClick:C,className:"add-column-btn",children:[e.jsx(w,{size:16})," Add"]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:i,className:"cancel-btn",disabled:h,children:"Cancel"}),e.jsxs("button",{onClick:N,className:"save-btn",disabled:h,children:[e.jsx(A,{size:16})," ",h?"Saving...":"Save Changes"]})]})]})}):null};export{z as M};
