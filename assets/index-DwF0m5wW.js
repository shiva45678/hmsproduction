var tC=Object.defineProperty;var $j=t=>{throw TypeError(t)};var nC=(t,a,n)=>a in t?tC(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;var ln=(t,a,n)=>nC(t,typeof a!="symbol"?a+"":a,n),of=(t,a,n)=>a.has(t)||$j("Cannot "+n);var Ge=(t,a,n)=>(of(t,a,"read from private field"),n?n.call(t):a.get(t)),qt=(t,a,n)=>a.has(t)?$j("Cannot add the same private member more than once"):a instanceof WeakSet?a.add(t):a.set(t,n),Tt=(t,a,n,i)=>(of(t,a,"write to private field"),i?i.call(t,n):a.set(t,n),n),Kn=(t,a,n)=>(of(t,a,"access private method"),n);var oh=(t,a,n,i)=>({set _(l){Tt(t,a,l,n)},get _(){return Ge(t,a,i)}});import{d as aC,e as sC,r as x,b as on,u as ft,g as Pu,f as Qa,L as Ss,O as iC,h as Fn,i as v1,B as rC,j as So,k as at,N as Pt}from"./react-vendor-Bn2uLbq_.js";import{G as ex,T as Th,M as Ah}from"./ai-vendor-CB5T-uN5.js";import{B as Ph,R as N1,X as St,L as Ci,P as Kh,S as lC,a as Wh,r as oC,b as w1,M as cC,c as Ru,d as uC,V as dC,e as hC,f as mC,g as bn,D as pC,h as ks,C as lg,i as og,j as S1,k as fC,l as fn,m as wu,n as k1,o as gC,p as ma,A as Mj,U as Vo,q as Xh,s as xC,t as kr,u as cg,v as pa,T as C1,F as Cs,w as _s,x as Rh,y as Oh,G as Ca,z as jl,H as Ih,E as ka,I as Nn,J as _1,K as ug,N as tx,O as yC,Q as xl,W as Et,Y as Jt,Z as Rn,_ as bC,$ as vl,a0 as dg,a1 as Bj,a2 as Zh,a3 as nx,a4 as D1,a5 as jC,a6 as Ou,a7 as wa,a8 as Iu,a9 as vC,aa as E1,ab as Cr,ac as Uj,ad as qj,ae as Ks,af as ax,ag as ys,ah as T1,ai as Ys,aj as sx,ak as NC,al as em,am as Ns,an as hg,ao as wC,ap as Hj,aq as SC,ar as A1,as as Vj,at as Eo,au as _o,av as kC,aw as CC,ax as _C,ay as DC,az as ix,aA as EC,aB as TC,aC as AC,aD as PC,aE as RC,aF as P1,aG as OC,aH as R1,aI as IC,aJ as tm,aK as zC,aL as O1,aM as FC}from"./ui-vendor-Cv3_-oOg.js";import{r as LC,E as I1,a as $C,b as MC,f as gl,c as BC,p as Gj,i as Qj,d as cf}from"./utils-vendor-Bgqozsj_.js";import{R as _h,L as UC,C as zh,X as Fh,Y as Lh,T as To,a as mg,b as qC,P as z1,c as F1,d as L1,B as $1,e as M1,A as HC,f as VC}from"./chart-vendor-B1j0W-Px.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const o of c.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(l){if(l.ep)return;l.ep=!0;const c=n(l);fetch(l.href,c)}})();var uf={exports:{}},lu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yj;function GC(){if(Yj)return lu;Yj=1;var t=Symbol.for("react.transitional.element"),a=Symbol.for("react.fragment");function n(i,l,c){var o=null;if(c!==void 0&&(o=""+c),l.key!==void 0&&(o=""+l.key),"key"in l){c={};for(var d in l)d!=="key"&&(c[d]=l[d])}else c=l;return l=c.ref,{$$typeof:t,type:i,key:o,ref:l!==void 0?l:null,props:c}}return lu.Fragment=a,lu.jsx=n,lu.jsxs=n,lu}var Jj;function QC(){return Jj||(Jj=1,uf.exports=GC()),uf.exports}var e=QC(),df={exports:{}},ou={},hf={exports:{}},mf={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Kj;function YC(){return Kj||(Kj=1,function(t){function a(I,V){var re=I.length;I.push(V);e:for(;0<re;){var B=re-1>>>1,k=I[B];if(0<l(k,V))I[B]=V,I[re]=k,re=B;else break e}}function n(I){return I.length===0?null:I[0]}function i(I){if(I.length===0)return null;var V=I[0],re=I.pop();if(re!==V){I[0]=re;e:for(var B=0,k=I.length,Ne=k>>>1;B<Ne;){var Ae=2*(B+1)-1,T=I[Ae],Ce=Ae+1,Ue=I[Ce];if(0>l(T,re))Ce<k&&0>l(Ue,T)?(I[B]=Ue,I[Ce]=re,B=Ce):(I[B]=T,I[Ae]=re,B=Ae);else if(Ce<k&&0>l(Ue,re))I[B]=Ue,I[Ce]=re,B=Ce;else break e}}return V}function l(I,V){var re=I.sortIndex-V.sortIndex;return re!==0?re:I.id-V.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var o=Date,d=o.now();t.unstable_now=function(){return o.now()-d}}var h=[],m=[],f=1,g=null,y=3,b=!1,v=!1,w=!1,S=!1,_=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,D=typeof setImmediate<"u"?setImmediate:null;function O(I){for(var V=n(m);V!==null;){if(V.callback===null)i(m);else if(V.startTime<=I)i(m),V.sortIndex=V.expirationTime,a(h,V);else break;V=n(m)}}function M(I){if(w=!1,O(I),!v)if(n(h)!==null)v=!0,A||(A=!0,z());else{var V=n(m);V!==null&&H(M,V.startTime-I)}}var A=!1,P=-1,Q=5,G=-1;function C(){return S?!0:!(t.unstable_now()-G<Q)}function R(){if(S=!1,A){var I=t.unstable_now();G=I;var V=!0;try{e:{v=!1,w&&(w=!1,E(P),P=-1),b=!0;var re=y;try{t:{for(O(I),g=n(h);g!==null&&!(g.expirationTime>I&&C());){var B=g.callback;if(typeof B=="function"){g.callback=null,y=g.priorityLevel;var k=B(g.expirationTime<=I);if(I=t.unstable_now(),typeof k=="function"){g.callback=k,O(I),V=!0;break t}g===n(h)&&i(h),O(I)}else i(h);g=n(h)}if(g!==null)V=!0;else{var Ne=n(m);Ne!==null&&H(M,Ne.startTime-I),V=!1}}break e}finally{g=null,y=re,b=!1}V=void 0}}finally{V?z():A=!1}}}var z;if(typeof D=="function")z=function(){D(R)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,J=F.port2;F.port1.onmessage=R,z=function(){J.postMessage(null)}}else z=function(){_(R,0)};function H(I,V){P=_(function(){I(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(I){I.callback=null},t.unstable_forceFrameRate=function(I){0>I||125<I?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<I?Math.floor(1e3/I):5},t.unstable_getCurrentPriorityLevel=function(){return y},t.unstable_next=function(I){switch(y){case 1:case 2:case 3:var V=3;break;default:V=y}var re=y;y=V;try{return I()}finally{y=re}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(I,V){switch(I){case 1:case 2:case 3:case 4:case 5:break;default:I=3}var re=y;y=I;try{return V()}finally{y=re}},t.unstable_scheduleCallback=function(I,V,re){var B=t.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?B+re:B):re=B,I){case 1:var k=-1;break;case 2:k=250;break;case 5:k=1073741823;break;case 4:k=1e4;break;default:k=5e3}return k=re+k,I={id:f++,callback:V,priorityLevel:I,startTime:re,expirationTime:k,sortIndex:-1},re>B?(I.sortIndex=re,a(m,I),n(h)===null&&I===n(m)&&(w?(E(P),P=-1):w=!0,H(M,re-B))):(I.sortIndex=k,a(h,I),v||b||(v=!0,A||(A=!0,z()))),I},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(I){var V=y;return function(){var re=y;y=V;try{return I.apply(this,arguments)}finally{y=re}}}}(mf)),mf}var Wj;function JC(){return Wj||(Wj=1,hf.exports=YC()),hf.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xj;function KC(){if(Xj)return ou;Xj=1;var t=JC(),a=aC(),n=sC();function i(s){var r="https://react.dev/errors/"+s;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)r+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+s+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function l(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function c(s){var r=s,u=s;if(s.alternate)for(;r.return;)r=r.return;else{s=r;do r=s,(r.flags&4098)!==0&&(u=r.return),s=r.return;while(s)}return r.tag===3?u:null}function o(s){if(s.tag===13){var r=s.memoizedState;if(r===null&&(s=s.alternate,s!==null&&(r=s.memoizedState)),r!==null)return r.dehydrated}return null}function d(s){if(c(s)!==s)throw Error(i(188))}function h(s){var r=s.alternate;if(!r){if(r=c(s),r===null)throw Error(i(188));return r!==s?null:s}for(var u=s,p=r;;){var j=u.return;if(j===null)break;var N=j.alternate;if(N===null){if(p=j.return,p!==null){u=p;continue}break}if(j.child===N.child){for(N=j.child;N;){if(N===u)return d(j),s;if(N===p)return d(j),r;N=N.sibling}throw Error(i(188))}if(u.return!==p.return)u=j,p=N;else{for(var $=!1,X=j.child;X;){if(X===u){$=!0,u=j,p=N;break}if(X===p){$=!0,p=j,u=N;break}X=X.sibling}if(!$){for(X=N.child;X;){if(X===u){$=!0,u=N,p=j;break}if(X===p){$=!0,p=N,u=j;break}X=X.sibling}if(!$)throw Error(i(189))}}if(u.alternate!==p)throw Error(i(190))}if(u.tag!==3)throw Error(i(188));return u.stateNode.current===u?s:r}function m(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s;for(s=s.child;s!==null;){if(r=m(s),r!==null)return r;s=s.sibling}return null}var f=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),v=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),E=Symbol.for("react.consumer"),D=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),M=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),G=Symbol.for("react.activity"),C=Symbol.for("react.memo_cache_sentinel"),R=Symbol.iterator;function z(s){return s===null||typeof s!="object"?null:(s=R&&s[R]||s["@@iterator"],typeof s=="function"?s:null)}var F=Symbol.for("react.client.reference");function J(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===F?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case v:return"Fragment";case S:return"Profiler";case w:return"StrictMode";case M:return"Suspense";case A:return"SuspenseList";case G:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case b:return"Portal";case D:return(s.displayName||"Context")+".Provider";case E:return(s._context.displayName||"Context")+".Consumer";case O:var r=s.render;return s=s.displayName,s||(s=r.displayName||r.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case P:return r=s.displayName||null,r!==null?r:J(s.type)||"Memo";case Q:r=s._payload,s=s._init;try{return J(s(r))}catch{}}return null}var H=Array.isArray,I=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,V=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,re={pending:!1,data:null,method:null,action:null},B=[],k=-1;function Ne(s){return{current:s}}function Ae(s){0>k||(s.current=B[k],B[k]=null,k--)}function T(s,r){k++,B[k]=s.current,s.current=r}var Ce=Ne(null),Ue=Ne(null),Pe=Ne(null),de=Ne(null);function Se(s,r){switch(T(Pe,r),T(Ue,s),T(Ce,null),r.nodeType){case 9:case 11:s=(s=r.documentElement)&&(s=s.namespaceURI)?mj(s):0;break;default:if(s=r.tagName,r=r.namespaceURI)r=mj(r),s=pj(r,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Ae(Ce),T(Ce,s)}function ee(){Ae(Ce),Ae(Ue),Ae(Pe)}function oe(s){s.memoizedState!==null&&T(de,s);var r=Ce.current,u=pj(r,s.type);r!==u&&(T(Ue,s),T(Ce,u))}function fe(s){Ue.current===s&&(Ae(Ce),Ae(Ue)),de.current===s&&(Ae(de),nu._currentValue=re)}var ge=Object.prototype.hasOwnProperty,q=t.unstable_scheduleCallback,W=t.unstable_cancelCallback,Y=t.unstable_shouldYield,ie=t.unstable_requestPaint,ce=t.unstable_now,pe=t.unstable_getCurrentPriorityLevel,He=t.unstable_ImmediatePriority,We=t.unstable_UserBlockingPriority,st=t.unstable_NormalPriority,me=t.unstable_LowPriority,ve=t.unstable_IdlePriority,Fe=t.log,Ee=t.unstable_setDisableYieldValue,L=null,ne=null;function xe(s){if(typeof Fe=="function"&&Ee(s),ne&&typeof ne.setStrictMode=="function")try{ne.setStrictMode(L,s)}catch{}}var ae=Math.clz32?Math.clz32:Je,we=Math.log,Le=Math.LN2;function Je(s){return s>>>=0,s===0?32:31-(we(s)/Le|0)|0}var ot=256,xt=4194304;function be(s){var r=s&42;if(r!==0)return r;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function ue(s,r,u){var p=s.pendingLanes;if(p===0)return 0;var j=0,N=s.suspendedLanes,$=s.pingedLanes;s=s.warmLanes;var X=p&134217727;return X!==0?(p=X&~N,p!==0?j=be(p):($&=X,$!==0?j=be($):u||(u=X&~s,u!==0&&(j=be(u))))):(X=p&~N,X!==0?j=be(X):$!==0?j=be($):u||(u=p&~s,u!==0&&(j=be(u)))),j===0?0:r!==0&&r!==j&&(r&N)===0&&(N=j&-j,u=r&-r,N>=u||N===32&&(u&4194048)!==0)?r:j}function je(s,r){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&r)===0}function ke(s,r){switch(s){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Me(){var s=ot;return ot<<=1,(ot&4194048)===0&&(ot=256),s}function De(){var s=xt;return xt<<=1,(xt&62914560)===0&&(xt=4194304),s}function qe(s){for(var r=[],u=0;31>u;u++)r.push(s);return r}function te(s,r){s.pendingLanes|=r,r!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function Re(s,r,u,p,j,N){var $=s.pendingLanes;s.pendingLanes=u,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=u,s.entangledLanes&=u,s.errorRecoveryDisabledLanes&=u,s.shellSuspendCounter=0;var X=s.entanglements,he=s.expirationTimes,ze=s.hiddenUpdates;for(u=$&~u;0<u;){var Ve=31-ae(u),Ke=1<<Ve;X[Ve]=0,he[Ve]=-1;var $e=ze[Ve];if($e!==null)for(ze[Ve]=null,Ve=0;Ve<$e.length;Ve++){var Be=$e[Ve];Be!==null&&(Be.lane&=-536870913)}u&=~Ke}p!==0&&lt(s,p,0),N!==0&&j===0&&s.tag!==0&&(s.suspendedLanes|=N&~($&~r))}function lt(s,r,u){s.pendingLanes|=r,s.suspendedLanes&=~r;var p=31-ae(r);s.entangledLanes|=r,s.entanglements[p]=s.entanglements[p]|1073741824|u&4194090}function Xe(s,r){var u=s.entangledLanes|=r;for(s=s.entanglements;u;){var p=31-ae(u),j=1<<p;j&r|s[p]&r&&(s[p]|=r),u&=~j}}function dt(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function jt(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function At(){var s=V.p;return s!==0?s:(s=window.event,s===void 0?32:Rj(s.type))}function Ye(s,r){var u=V.p;try{return V.p=s,r()}finally{V.p=u}}var it=Math.random().toString(36).slice(2),Ze="__reactFiber$"+it,ht="__reactProps$"+it,ct="__reactContainer$"+it,ut="__reactEvents$"+it,Kt="__reactListeners$"+it,ea="__reactHandles$"+it,ta="__reactResources$"+it,On="__reactMarker$"+it;function Ds(s){delete s[Ze],delete s[ht],delete s[ut],delete s[Kt],delete s[ea]}function gn(s){var r=s[Ze];if(r)return r;for(var u=s.parentNode;u;){if(r=u[ct]||u[Ze]){if(u=r.alternate,r.child!==null||u!==null&&u.child!==null)for(s=yj(s);s!==null;){if(u=s[Ze])return u;s=yj(s)}return r}s=u,u=s.parentNode}return null}function Aa(s){if(s=s[Ze]||s[ct]){var r=s.tag;if(r===5||r===6||r===13||r===26||r===27||r===3)return s}return null}function Ya(s){var r=s.tag;if(r===5||r===26||r===27||r===6)return s.stateNode;throw Error(i(33))}function Ja(s){var r=s[ta];return r||(r=s[ta]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function jn(s){s[On]=!0}var Hu=new Set,Vu={};function ei(s,r){Ei(s,r),Ei(s+"Capture",r)}function Ei(s,r){for(Vu[s]=r,s=0;s<r.length;s++)Hu.add(r[s])}var gm=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Gu={},Qu={};function xm(s){return ge.call(Qu,s)?!0:ge.call(Gu,s)?!1:gm.test(s)?Qu[s]=!0:(Gu[s]=!0,!1)}function Sl(s,r,u){if(xm(r))if(u===null)s.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":s.removeAttribute(r);return;case"boolean":var p=r.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){s.removeAttribute(r);return}}s.setAttribute(r,""+u)}}function Ti(s,r,u){if(u===null)s.removeAttribute(r);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(r);return}s.setAttribute(r,""+u)}}function Dn(s,r,u,p){if(p===null)s.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(u);return}s.setAttributeNS(r,u,""+p)}}var ti,Ko;function ni(s){if(ti===void 0)try{throw Error()}catch(u){var r=u.stack.trim().match(/\n( *(at )?)/);ti=r&&r[1]||"",Ko=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ti+s+Ko}var kl=!1;function Pr(s,r){if(!s||kl)return"";kl=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(r){var Ke=function(){throw Error()};if(Object.defineProperty(Ke.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ke,[])}catch(Be){var $e=Be}Reflect.construct(s,[],Ke)}else{try{Ke.call()}catch(Be){$e=Be}s.call(Ke.prototype)}}else{try{throw Error()}catch(Be){$e=Be}(Ke=s())&&typeof Ke.catch=="function"&&Ke.catch(function(){})}}catch(Be){if(Be&&$e&&typeof Be.stack=="string")return[Be.stack,$e.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var j=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");j&&j.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var N=p.DetermineComponentFrameRoot(),$=N[0],X=N[1];if($&&X){var he=$.split(`
`),ze=X.split(`
`);for(j=p=0;p<he.length&&!he[p].includes("DetermineComponentFrameRoot");)p++;for(;j<ze.length&&!ze[j].includes("DetermineComponentFrameRoot");)j++;if(p===he.length||j===ze.length)for(p=he.length-1,j=ze.length-1;1<=p&&0<=j&&he[p]!==ze[j];)j--;for(;1<=p&&0<=j;p--,j--)if(he[p]!==ze[j]){if(p!==1||j!==1)do if(p--,j--,0>j||he[p]!==ze[j]){var Ve=`
`+he[p].replace(" at new "," at ");return s.displayName&&Ve.includes("<anonymous>")&&(Ve=Ve.replace("<anonymous>",s.displayName)),Ve}while(1<=p&&0<=j);break}}}finally{kl=!1,Error.prepareStackTrace=u}return(u=s?s.displayName||s.name:"")?ni(u):""}function Wo(s){switch(s.tag){case 26:case 27:case 5:return ni(s.type);case 16:return ni("Lazy");case 13:return ni("Suspense");case 19:return ni("SuspenseList");case 0:case 15:return Pr(s.type,!1);case 11:return Pr(s.type.render,!1);case 1:return Pr(s.type,!0);case 31:return ni("Activity");default:return""}}function Xo(s){try{var r="";do r+=Wo(s),s=s.return;while(s);return r}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function na(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Rr(s){var r=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ym(s){var r=Rr(s)?"checked":"value",u=Object.getOwnPropertyDescriptor(s.constructor.prototype,r),p=""+s[r];if(!s.hasOwnProperty(r)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var j=u.get,N=u.set;return Object.defineProperty(s,r,{configurable:!0,get:function(){return j.call(this)},set:function($){p=""+$,N.call(this,$)}}),Object.defineProperty(s,r,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function($){p=""+$},stopTracking:function(){s._valueTracker=null,delete s[r]}}}}function Cl(s){s._valueTracker||(s._valueTracker=ym(s))}function Zo(s){if(!s)return!1;var r=s._valueTracker;if(!r)return!0;var u=r.getValue(),p="";return s&&(p=Rr(s)?s.checked?"true":"false":s.value),s=p,s!==u?(r.setValue(s),!0):!1}function Or(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var Yu=/[\n"\\]/g;function aa(s){return s.replace(Yu,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function _l(s,r,u,p,j,N,$,X){s.name="",$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"?s.type=$:s.removeAttribute("type"),r!=null?$==="number"?(r===0&&s.value===""||s.value!=r)&&(s.value=""+na(r)):s.value!==""+na(r)&&(s.value=""+na(r)):$!=="submit"&&$!=="reset"||s.removeAttribute("value"),r!=null?Ai(s,$,na(r)):u!=null?Ai(s,$,na(u)):p!=null&&s.removeAttribute("value"),j==null&&N!=null&&(s.defaultChecked=!!N),j!=null&&(s.checked=j&&typeof j!="function"&&typeof j!="symbol"),X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?s.name=""+na(X):s.removeAttribute("name")}function ec(s,r,u,p,j,N,$,X){if(N!=null&&typeof N!="function"&&typeof N!="symbol"&&typeof N!="boolean"&&(s.type=N),r!=null||u!=null){if(!(N!=="submit"&&N!=="reset"||r!=null))return;u=u!=null?""+na(u):"",r=r!=null?""+na(r):u,X||r===s.value||(s.value=r),s.defaultValue=r}p=p??j,p=typeof p!="function"&&typeof p!="symbol"&&!!p,s.checked=X?s.checked:!!p,s.defaultChecked=!!p,$!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(s.name=$)}function Ai(s,r,u){r==="number"&&Or(s.ownerDocument)===s||s.defaultValue===""+u||(s.defaultValue=""+u)}function ai(s,r,u,p){if(s=s.options,r){r={};for(var j=0;j<u.length;j++)r["$"+u[j]]=!0;for(u=0;u<s.length;u++)j=r.hasOwnProperty("$"+s[u].value),s[u].selected!==j&&(s[u].selected=j),j&&p&&(s[u].defaultSelected=!0)}else{for(u=""+na(u),r=null,j=0;j<s.length;j++){if(s[j].value===u){s[j].selected=!0,p&&(s[j].defaultSelected=!0);return}r!==null||s[j].disabled||(r=s[j])}r!==null&&(r.selected=!0)}}function Dl(s,r,u){if(r!=null&&(r=""+na(r),r!==s.value&&(s.value=r),u==null)){s.defaultValue!==r&&(s.defaultValue=r);return}s.defaultValue=u!=null?""+na(u):""}function tc(s,r,u,p){if(r==null){if(p!=null){if(u!=null)throw Error(i(92));if(H(p)){if(1<p.length)throw Error(i(93));p=p[0]}u=p}u==null&&(u=""),r=u}u=na(r),s.defaultValue=u,p=s.textContent,p===u&&p!==""&&p!==null&&(s.value=p)}function Ka(s,r){if(r){var u=s.firstChild;if(u&&u===s.lastChild&&u.nodeType===3){u.nodeValue=r;return}}s.textContent=r}var nc=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ir(s,r,u){var p=r.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?s.setProperty(r,""):r==="float"?s.cssFloat="":s[r]="":p?s.setProperty(r,u):typeof u!="number"||u===0||nc.has(r)?r==="float"?s.cssFloat=u:s[r]=(""+u).trim():s[r]=u+"px"}function Wa(s,r,u){if(r!=null&&typeof r!="object")throw Error(i(62));if(s=s.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||r!=null&&r.hasOwnProperty(p)||(p.indexOf("--")===0?s.setProperty(p,""):p==="float"?s.cssFloat="":s[p]="");for(var j in r)p=r[j],r.hasOwnProperty(j)&&u[j]!==p&&Ir(s,j,p)}else for(var N in r)r.hasOwnProperty(N)&&Ir(s,N,r[N])}function El(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ac=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ju=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Pi(s){return Ju.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var Tl=null;function zr(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var si=null,Es=null;function sc(s){var r=Aa(s);if(r&&(s=r.stateNode)){var u=s[ht]||null;e:switch(s=r.stateNode,r.type){case"input":if(_l(s,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),r=u.name,u.type==="radio"&&r!=null){for(u=s;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+aa(""+r)+'"][type="radio"]'),r=0;r<u.length;r++){var p=u[r];if(p!==s&&p.form===s.form){var j=p[ht]||null;if(!j)throw Error(i(90));_l(p,j.value,j.defaultValue,j.defaultValue,j.checked,j.defaultChecked,j.type,j.name)}}for(r=0;r<u.length;r++)p=u[r],p.form===s.form&&Zo(p)}break e;case"textarea":Dl(s,u.value,u.defaultValue);break e;case"select":r=u.value,r!=null&&ai(s,!!u.multiple,r,!1)}}}var Ri=!1;function Oi(s,r,u){if(Ri)return s(r,u);Ri=!0;try{var p=s(r);return p}finally{if(Ri=!1,(si!==null||Es!==null)&&(Bd(),si&&(r=si,s=Es,Es=si=null,sc(r),s)))for(r=0;r<s.length;r++)sc(s[r])}}function Ts(s,r){var u=s.stateNode;if(u===null)return null;var p=u[ht]||null;if(p===null)return null;u=p[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(s=s.type,p=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!p;break e;default:s=!1}if(s)return null;if(u&&typeof u!="function")throw Error(i(231,r,typeof u));return u}var Xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ii=!1;if(Xa)try{var Fr={};Object.defineProperty(Fr,"passive",{get:function(){Ii=!0}}),window.addEventListener("test",Fr,Fr),window.removeEventListener("test",Fr,Fr)}catch{Ii=!1}var Za=null,Lr=null,zi=null;function Al(){if(zi)return zi;var s,r=Lr,u=r.length,p,j="value"in Za?Za.value:Za.textContent,N=j.length;for(s=0;s<u&&r[s]===j[s];s++);var $=u-s;for(p=1;p<=$&&r[u-p]===j[N-p];p++);return zi=j.slice(s,1<p?1-p:void 0)}function Fi(s){var r=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&r===13&&(s=13)):s=r,s===10&&(s=13),32<=s||s===13?s:0}function Li(){return!0}function Pl(){return!1}function $n(s){function r(u,p,j,N,$){this._reactName=u,this._targetInst=j,this.type=p,this.nativeEvent=N,this.target=$,this.currentTarget=null;for(var X in s)s.hasOwnProperty(X)&&(u=s[X],this[X]=u?u(N):N[X]);return this.isDefaultPrevented=(N.defaultPrevented!=null?N.defaultPrevented:N.returnValue===!1)?Li:Pl,this.isPropagationStopped=Pl,this}return f(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Li)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Li)},persist:function(){},isPersistent:Li}),r}var ds={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fa=$n(ds),ii=f({},ds,{view:0,detail:0}),Ku=$n(ii),hs,ic,ri,Rl=f({},ii,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ur,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==ri&&(ri&&s.type==="mousemove"?(hs=s.screenX-ri.screenX,ic=s.screenY-ri.screenY):ic=hs=0,ri=s),hs)},movementY:function(s){return"movementY"in s?s.movementY:ic}}),Ol=$n(Rl),bm=f({},Rl,{dataTransfer:0}),$r=$n(bm),As=f({},ii,{relatedTarget:0}),Ps=$n(As),Il=f({},ds,{animationName:0,elapsedTime:0,pseudoElement:0}),zl=$n(Il),Mr=f({},ds,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),jm=$n(Mr),Fl=f({},ds,{data:0}),rc=$n(Fl),lc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Wu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Br={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xu(s){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(s):(s=Br[s])?!!r[s]:!1}function Ur(){return Xu}var Zu=f({},ii,{key:function(s){if(s.key){var r=lc[s.key]||s.key;if(r!=="Unidentified")return r}return s.type==="keypress"?(s=Fi(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Wu[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ur,charCode:function(s){return s.type==="keypress"?Fi(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Fi(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ll=$n(Zu),$l=f({},Rl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ed=$n($l),oc=f({},ii,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ur}),cc=$n(oc),td=f({},ds,{propertyName:0,elapsedTime:0,pseudoElement:0}),uc=$n(td),dc=f({},Rl,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Xt=$n(dc),hc=f({},ds,{newState:0,oldState:0}),Ml=$n(hc),mc=[9,13,27,32],li=Xa&&"CompositionEvent"in window,ms=null;Xa&&"documentMode"in document&&(ms=document.documentMode);var nd=Xa&&"TextEvent"in window&&!ms,pc=Xa&&(!li||ms&&8<ms&&11>=ms),oi=" ",fc=!1;function Bl(s,r){switch(s){case"keyup":return mc.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qr(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Pa=!1;function ad(s,r){switch(s){case"compositionend":return qr(r);case"keypress":return r.which!==32?null:(fc=!0,oi);case"textInput":return s=r.data,s===oi&&fc?null:s;default:return null}}function vm(s,r){if(Pa)return s==="compositionend"||!li&&Bl(s,r)?(s=Al(),zi=Lr=Za=null,Pa=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return pc&&r.locale!=="ko"?null:r.data;default:return null}}var sd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function $i(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r==="input"?!!sd[s.type]:r==="textarea"}function id(s,r,u,p){si?Es?Es.push(p):Es=[p]:si=p,r=Qd(r,"onChange"),0<r.length&&(u=new fa("onChange","change",null,u,p),s.push({event:u,listeners:r}))}var es=null,Hr=null;function rd(s){oj(s,0)}function ps(s){var r=Ya(s);if(Zo(r))return s}function ci(s,r){if(s==="change")return r}var Mi=!1;if(Xa){var ui;if(Xa){var Vr="oninput"in document;if(!Vr){var gc=document.createElement("div");gc.setAttribute("oninput","return;"),Vr=typeof gc.oninput=="function"}ui=Vr}else ui=!1;Mi=ui&&(!document.documentMode||9<document.documentMode)}function Gr(){es&&(es.detachEvent("onpropertychange",xc),Hr=es=null)}function xc(s){if(s.propertyName==="value"&&ps(Hr)){var r=[];id(r,Hr,s,zr(s)),Oi(rd,r)}}function Nm(s,r,u){s==="focusin"?(Gr(),es=r,Hr=u,es.attachEvent("onpropertychange",xc)):s==="focusout"&&Gr()}function wm(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ps(Hr)}function Sm(s,r){if(s==="click")return ps(r)}function ld(s,r){if(s==="input"||s==="change")return ps(r)}function km(s,r){return s===r&&(s!==0||1/s===1/r)||s!==s&&r!==r}var sa=typeof Object.is=="function"?Object.is:km;function Qr(s,r){if(sa(s,r))return!0;if(typeof s!="object"||s===null||typeof r!="object"||r===null)return!1;var u=Object.keys(s),p=Object.keys(r);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var j=u[p];if(!ge.call(r,j)||!sa(s[j],r[j]))return!1}return!0}function od(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function cd(s,r){var u=od(s);s=0;for(var p;u;){if(u.nodeType===3){if(p=s+u.textContent.length,s<=r&&p>=r)return{node:u,offset:r-s};s=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=od(u)}}function Ul(s,r){return s&&r?s===r?!0:s&&s.nodeType===3?!1:r&&r.nodeType===3?Ul(s,r.parentNode):"contains"in s?s.contains(r):s.compareDocumentPosition?!!(s.compareDocumentPosition(r)&16):!1:!1}function ud(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var r=Or(s.document);r instanceof s.HTMLIFrameElement;){try{var u=typeof r.contentWindow.location.href=="string"}catch{u=!1}if(u)s=r.contentWindow;else break;r=Or(s.document)}return r}function di(s){var r=s&&s.nodeName&&s.nodeName.toLowerCase();return r&&(r==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||r==="textarea"||s.contentEditable==="true")}var Cm=Xa&&"documentMode"in document&&11>=document.documentMode,ia=null,ts=null,ra=null,ql=!1;function yc(s,r,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ql||ia==null||ia!==Or(p)||(p=ia,"selectionStart"in p&&di(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),ra&&Qr(ra,p)||(ra=p,p=Qd(ts,"onSelect"),0<p.length&&(r=new fa("onSelect","select",null,r,u),s.push({event:r,listeners:p}),r.target=ia)))}function Rs(s,r){var u={};return u[s.toLowerCase()]=r.toLowerCase(),u["Webkit"+s]="webkit"+r,u["Moz"+s]="moz"+r,u}var hi={animationend:Rs("Animation","AnimationEnd"),animationiteration:Rs("Animation","AnimationIteration"),animationstart:Rs("Animation","AnimationStart"),transitionrun:Rs("Transition","TransitionRun"),transitionstart:Rs("Transition","TransitionStart"),transitioncancel:Rs("Transition","TransitionCancel"),transitionend:Rs("Transition","TransitionEnd")},mi={},bc={};Xa&&(bc=document.createElement("div").style,"AnimationEvent"in window||(delete hi.animationend.animation,delete hi.animationiteration.animation,delete hi.animationstart.animation),"TransitionEvent"in window||delete hi.transitionend.transition);function Os(s){if(mi[s])return mi[s];if(!hi[s])return s;var r=hi[s],u;for(u in r)if(r.hasOwnProperty(u)&&u in bc)return mi[s]=r[u];return s}var dd=Os("animationend"),jc=Os("animationiteration"),vc=Os("animationstart"),_m=Os("transitionrun"),Dm=Os("transitionstart"),Em=Os("transitioncancel"),Nc=Os("transitionend"),hd=new Map,Is="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Is.push("scrollEnd");function Ra(s,r){hd.set(s,r),ei(r,[s])}var Hl=new WeakMap;function ga(s,r){if(typeof s=="object"&&s!==null){var u=Hl.get(s);return u!==void 0?u:(r={value:s,source:r,stack:Xo(r)},Hl.set(s,r),r)}return{value:s,source:r,stack:Xo(r)}}var Qn=[],Bi=0,xa=0;function Vl(){for(var s=Bi,r=xa=Bi=0;r<s;){var u=Qn[r];Qn[r++]=null;var p=Qn[r];Qn[r++]=null;var j=Qn[r];Qn[r++]=null;var N=Qn[r];if(Qn[r++]=null,p!==null&&j!==null){var $=p.pending;$===null?j.next=j:(j.next=$.next,$.next=j),p.pending=j}N!==0&&md(u,j,N)}}function Gl(s,r,u,p){Qn[Bi++]=s,Qn[Bi++]=r,Qn[Bi++]=u,Qn[Bi++]=p,xa|=p,s.lanes|=p,s=s.alternate,s!==null&&(s.lanes|=p)}function Ql(s,r,u,p){return Gl(s,r,u,p),Yl(s)}function Ui(s,r){return Gl(s,null,null,r),Yl(s)}function md(s,r,u){s.lanes|=u;var p=s.alternate;p!==null&&(p.lanes|=u);for(var j=!1,N=s.return;N!==null;)N.childLanes|=u,p=N.alternate,p!==null&&(p.childLanes|=u),N.tag===22&&(s=N.stateNode,s===null||s._visibility&1||(j=!0)),s=N,N=N.return;return s.tag===3?(N=s.stateNode,j&&r!==null&&(j=31-ae(u),s=N.hiddenUpdates,p=s[j],p===null?s[j]=[r]:p.push(r),r.lane=u|536870912),N):null}function Yl(s){if(50<Yc)throw Yc=0,Ap=null,Error(i(185));for(var r=s.return;r!==null;)s=r,r=s.return;return s.tag===3?s.stateNode:null}var qi={};function Tm(s,r,u,p){this.tag=s,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function la(s,r,u,p){return new Tm(s,r,u,p)}function wc(s){return s=s.prototype,!(!s||!s.isReactComponent)}function fs(s,r){var u=s.alternate;return u===null?(u=la(s.tag,r,s.key,s.mode),u.elementType=s.elementType,u.type=s.type,u.stateNode=s.stateNode,u.alternate=s,s.alternate=u):(u.pendingProps=r,u.type=s.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=s.flags&65011712,u.childLanes=s.childLanes,u.lanes=s.lanes,u.child=s.child,u.memoizedProps=s.memoizedProps,u.memoizedState=s.memoizedState,u.updateQueue=s.updateQueue,r=s.dependencies,u.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},u.sibling=s.sibling,u.index=s.index,u.ref=s.ref,u.refCleanup=s.refCleanup,u}function pd(s,r){s.flags&=65011714;var u=s.alternate;return u===null?(s.childLanes=0,s.lanes=r,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,r=u.dependencies,s.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),s}function Hi(s,r,u,p,j,N){var $=0;if(p=s,typeof s=="function")wc(s)&&($=1);else if(typeof s=="string")$=Uk(s,u,Ce.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case G:return s=la(31,u,r,j),s.elementType=G,s.lanes=N,s;case v:return Oa(u.children,j,N,r);case w:$=8,j|=24;break;case S:return s=la(12,u,r,j|2),s.elementType=S,s.lanes=N,s;case M:return s=la(13,u,r,j),s.elementType=M,s.lanes=N,s;case A:return s=la(19,u,r,j),s.elementType=A,s.lanes=N,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case _:case D:$=10;break e;case E:$=9;break e;case O:$=11;break e;case P:$=14;break e;case Q:$=16,p=null;break e}$=29,u=Error(i(130,s===null?"null":typeof s,"")),p=null}return r=la($,u,r,j),r.elementType=s,r.type=p,r.lanes=N,r}function Oa(s,r,u,p){return s=la(7,s,p,r),s.lanes=u,s}function zs(s,r,u){return s=la(6,s,null,r),s.lanes=u,s}function Yn(s,r,u){return r=la(4,s.children!==null?s.children:[],s.key,r),r.lanes=u,r.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},r}var ns=[],Ia=0,Fs=null,Yr=0,oa=[],K=0,le=null,se=1,_e="";function Oe(s,r){ns[Ia++]=Yr,ns[Ia++]=Fs,Fs=s,Yr=r}function rt(s,r,u){oa[K++]=se,oa[K++]=_e,oa[K++]=le,le=s;var p=se;s=_e;var j=32-ae(p)-1;p&=~(1<<j),u+=1;var N=32-ae(r)+j;if(30<N){var $=j-j%5;N=(p&(1<<$)-1).toString(32),p>>=$,j-=$,se=1<<32-ae(r)+j|u<<j|p,_e=N+s}else se=1<<N|u<<j|p,_e=s}function gt(s){s.return!==null&&(Oe(s,1),rt(s,1,0))}function Ht(s){for(;s===Fs;)Fs=ns[--Ia],ns[Ia]=null,Yr=ns[--Ia],ns[Ia]=null;for(;s===le;)le=oa[--K],oa[K]=null,_e=oa[--K],oa[K]=null,se=oa[--K],oa[K]=null}var _t=null,nn=null,zt=!1,Jr=null,Ls=!1,Am=Error(i(519));function Kr(s){var r=Error(i(418,""));throw Cc(ga(r,s)),Am}function Jx(s){var r=s.stateNode,u=s.type,p=s.memoizedProps;switch(r[Ze]=s,r[ht]=p,u){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(u=0;u<Kc.length;u++)Mt(Kc[u],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":Mt("invalid",r),ec(r,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),Cl(r);break;case"select":Mt("invalid",r);break;case"textarea":Mt("invalid",r),tc(r,p.value,p.defaultValue,p.children),Cl(r)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||r.textContent===""+u||p.suppressHydrationWarning===!0||hj(r.textContent,u)?(p.popover!=null&&(Mt("beforetoggle",r),Mt("toggle",r)),p.onScroll!=null&&Mt("scroll",r),p.onScrollEnd!=null&&Mt("scrollend",r),p.onClick!=null&&(r.onclick=Yd),r=!0):r=!1,r||Kr(s)}function Kx(s){for(_t=s.return;_t;)switch(_t.tag){case 5:case 13:Ls=!1;return;case 27:case 3:Ls=!0;return;default:_t=_t.return}}function Sc(s){if(s!==_t)return!1;if(!zt)return Kx(s),zt=!0,!1;var r=s.tag,u;if((u=r!==3&&r!==27)&&((u=r===5)&&(u=s.type,u=!(u!=="form"&&u!=="button")||Qp(s.type,s.memoizedProps)),u=!u),u&&nn&&Kr(s),Kx(s),r===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(i(317));e:{for(s=s.nextSibling,r=0;s;){if(s.nodeType===8)if(u=s.data,u==="/$"){if(r===0){nn=xs(s.nextSibling);break e}r--}else u!=="$"&&u!=="$!"&&u!=="$?"||r++;s=s.nextSibling}nn=null}}else r===27?(r=nn,rr(s.type)?(s=Wp,Wp=null,nn=s):nn=r):nn=_t?xs(s.stateNode.nextSibling):null;return!0}function kc(){nn=_t=null,zt=!1}function Wx(){var s=Jr;return s!==null&&(ja===null?ja=s:ja.push.apply(ja,s),Jr=null),s}function Cc(s){Jr===null?Jr=[s]:Jr.push(s)}var Pm=Ne(null),Wr=null,pi=null;function Vi(s,r,u){T(Pm,r._currentValue),r._currentValue=u}function fi(s){s._currentValue=Pm.current,Ae(Pm)}function Rm(s,r,u){for(;s!==null;){var p=s.alternate;if((s.childLanes&r)!==r?(s.childLanes|=r,p!==null&&(p.childLanes|=r)):p!==null&&(p.childLanes&r)!==r&&(p.childLanes|=r),s===u)break;s=s.return}}function Om(s,r,u,p){var j=s.child;for(j!==null&&(j.return=s);j!==null;){var N=j.dependencies;if(N!==null){var $=j.child;N=N.firstContext;e:for(;N!==null;){var X=N;N=j;for(var he=0;he<r.length;he++)if(X.context===r[he]){N.lanes|=u,X=N.alternate,X!==null&&(X.lanes|=u),Rm(N.return,u,s),p||($=null);break e}N=X.next}}else if(j.tag===18){if($=j.return,$===null)throw Error(i(341));$.lanes|=u,N=$.alternate,N!==null&&(N.lanes|=u),Rm($,u,s),$=null}else $=j.child;if($!==null)$.return=j;else for($=j;$!==null;){if($===s){$=null;break}if(j=$.sibling,j!==null){j.return=$.return,$=j;break}$=$.return}j=$}}function _c(s,r,u,p){s=null;for(var j=r,N=!1;j!==null;){if(!N){if((j.flags&524288)!==0)N=!0;else if((j.flags&262144)!==0)break}if(j.tag===10){var $=j.alternate;if($===null)throw Error(i(387));if($=$.memoizedProps,$!==null){var X=j.type;sa(j.pendingProps.value,$.value)||(s!==null?s.push(X):s=[X])}}else if(j===de.current){if($=j.alternate,$===null)throw Error(i(387));$.memoizedState.memoizedState!==j.memoizedState.memoizedState&&(s!==null?s.push(nu):s=[nu])}j=j.return}s!==null&&Om(r,s,u,p),r.flags|=262144}function fd(s){for(s=s.firstContext;s!==null;){if(!sa(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Xr(s){Wr=s,pi=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Jn(s){return Xx(Wr,s)}function gd(s,r){return Wr===null&&Xr(s),Xx(s,r)}function Xx(s,r){var u=r._currentValue;if(r={context:r,memoizedValue:u,next:null},pi===null){if(s===null)throw Error(i(308));pi=r,s.dependencies={lanes:0,firstContext:r},s.flags|=524288}else pi=pi.next=r;return u}var BS=typeof AbortController<"u"?AbortController:function(){var s=[],r=this.signal={aborted:!1,addEventListener:function(u,p){s.push(p)}};this.abort=function(){r.aborted=!0,s.forEach(function(u){return u()})}},US=t.unstable_scheduleCallback,qS=t.unstable_NormalPriority,In={$$typeof:D,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Im(){return{controller:new BS,data:new Map,refCount:0}}function Dc(s){s.refCount--,s.refCount===0&&US(qS,function(){s.controller.abort()})}var Ec=null,zm=0,Jl=0,Kl=null;function HS(s,r){if(Ec===null){var u=Ec=[];zm=0,Jl=Lp(),Kl={status:"pending",value:void 0,then:function(p){u.push(p)}}}return zm++,r.then(Zx,Zx),r}function Zx(){if(--zm===0&&Ec!==null){Kl!==null&&(Kl.status="fulfilled");var s=Ec;Ec=null,Jl=0,Kl=null;for(var r=0;r<s.length;r++)(0,s[r])()}}function VS(s,r){var u=[],p={status:"pending",value:null,reason:null,then:function(j){u.push(j)}};return s.then(function(){p.status="fulfilled",p.value=r;for(var j=0;j<u.length;j++)(0,u[j])(r)},function(j){for(p.status="rejected",p.reason=j,j=0;j<u.length;j++)(0,u[j])(void 0)}),p}var ey=I.S;I.S=function(s,r){typeof r=="object"&&r!==null&&typeof r.then=="function"&&HS(s,r),ey!==null&&ey(s,r)};var Zr=Ne(null);function Fm(){var s=Zr.current;return s!==null?s:dn.pooledCache}function xd(s,r){r===null?T(Zr,Zr.current):T(Zr,r.pool)}function ty(){var s=Fm();return s===null?null:{parent:In._currentValue,pool:s}}var Tc=Error(i(460)),ny=Error(i(474)),yd=Error(i(542)),Lm={then:function(){}};function ay(s){return s=s.status,s==="fulfilled"||s==="rejected"}function bd(){}function sy(s,r,u){switch(u=s[u],u===void 0?s.push(r):u!==r&&(r.then(bd,bd),r=u),r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,ry(s),s;default:if(typeof r.status=="string")r.then(bd,bd);else{if(s=dn,s!==null&&100<s.shellSuspendCounter)throw Error(i(482));s=r,s.status="pending",s.then(function(p){if(r.status==="pending"){var j=r;j.status="fulfilled",j.value=p}},function(p){if(r.status==="pending"){var j=r;j.status="rejected",j.reason=p}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw s=r.reason,ry(s),s}throw Ac=r,Tc}}var Ac=null;function iy(){if(Ac===null)throw Error(i(459));var s=Ac;return Ac=null,s}function ry(s){if(s===Tc||s===yd)throw Error(i(483))}var Gi=!1;function $m(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mm(s,r){s=s.updateQueue,r.updateQueue===s&&(r.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Qi(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Yi(s,r,u){var p=s.updateQueue;if(p===null)return null;if(p=p.shared,(en&2)!==0){var j=p.pending;return j===null?r.next=r:(r.next=j.next,j.next=r),p.pending=r,r=Yl(s),md(s,null,u),r}return Gl(s,p,r,u),Yl(s)}function Pc(s,r,u){if(r=r.updateQueue,r!==null&&(r=r.shared,(u&4194048)!==0)){var p=r.lanes;p&=s.pendingLanes,u|=p,r.lanes=u,Xe(s,u)}}function Bm(s,r){var u=s.updateQueue,p=s.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var j=null,N=null;if(u=u.firstBaseUpdate,u!==null){do{var $={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};N===null?j=N=$:N=N.next=$,u=u.next}while(u!==null);N===null?j=N=r:N=N.next=r}else j=N=r;u={baseState:p.baseState,firstBaseUpdate:j,lastBaseUpdate:N,shared:p.shared,callbacks:p.callbacks},s.updateQueue=u;return}s=u.lastBaseUpdate,s===null?u.firstBaseUpdate=r:s.next=r,u.lastBaseUpdate=r}var Um=!1;function Rc(){if(Um){var s=Kl;if(s!==null)throw s}}function Oc(s,r,u,p){Um=!1;var j=s.updateQueue;Gi=!1;var N=j.firstBaseUpdate,$=j.lastBaseUpdate,X=j.shared.pending;if(X!==null){j.shared.pending=null;var he=X,ze=he.next;he.next=null,$===null?N=ze:$.next=ze,$=he;var Ve=s.alternate;Ve!==null&&(Ve=Ve.updateQueue,X=Ve.lastBaseUpdate,X!==$&&(X===null?Ve.firstBaseUpdate=ze:X.next=ze,Ve.lastBaseUpdate=he))}if(N!==null){var Ke=j.baseState;$=0,Ve=ze=he=null,X=N;do{var $e=X.lane&-536870913,Be=$e!==X.lane;if(Be?(Vt&$e)===$e:(p&$e)===$e){$e!==0&&$e===Jl&&(Um=!0),Ve!==null&&(Ve=Ve.next={lane:0,tag:X.tag,payload:X.payload,callback:null,next:null});e:{var kt=s,Nt=X;$e=r;var rn=u;switch(Nt.tag){case 1:if(kt=Nt.payload,typeof kt=="function"){Ke=kt.call(rn,Ke,$e);break e}Ke=kt;break e;case 3:kt.flags=kt.flags&-65537|128;case 0:if(kt=Nt.payload,$e=typeof kt=="function"?kt.call(rn,Ke,$e):kt,$e==null)break e;Ke=f({},Ke,$e);break e;case 2:Gi=!0}}$e=X.callback,$e!==null&&(s.flags|=64,Be&&(s.flags|=8192),Be=j.callbacks,Be===null?j.callbacks=[$e]:Be.push($e))}else Be={lane:$e,tag:X.tag,payload:X.payload,callback:X.callback,next:null},Ve===null?(ze=Ve=Be,he=Ke):Ve=Ve.next=Be,$|=$e;if(X=X.next,X===null){if(X=j.shared.pending,X===null)break;Be=X,X=Be.next,Be.next=null,j.lastBaseUpdate=Be,j.shared.pending=null}}while(!0);Ve===null&&(he=Ke),j.baseState=he,j.firstBaseUpdate=ze,j.lastBaseUpdate=Ve,N===null&&(j.shared.lanes=0),nr|=$,s.lanes=$,s.memoizedState=Ke}}function ly(s,r){if(typeof s!="function")throw Error(i(191,s));s.call(r)}function oy(s,r){var u=s.callbacks;if(u!==null)for(s.callbacks=null,s=0;s<u.length;s++)ly(u[s],r)}var Wl=Ne(null),jd=Ne(0);function cy(s,r){s=Ni,T(jd,s),T(Wl,r),Ni=s|r.baseLanes}function qm(){T(jd,Ni),T(Wl,Wl.current)}function Hm(){Ni=jd.current,Ae(Wl),Ae(jd)}var Ji=0,Ft=null,an=null,En=null,vd=!1,Xl=!1,el=!1,Nd=0,Ic=0,Zl=null,GS=0;function Cn(){throw Error(i(321))}function Vm(s,r){if(r===null)return!1;for(var u=0;u<r.length&&u<s.length;u++)if(!sa(s[u],r[u]))return!1;return!0}function Gm(s,r,u,p,j,N){return Ji=N,Ft=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,I.H=s===null||s.memoizedState===null?Gy:Qy,el=!1,N=u(p,j),el=!1,Xl&&(N=dy(r,u,p,j)),uy(s),N}function uy(s){I.H=Dd;var r=an!==null&&an.next!==null;if(Ji=0,En=an=Ft=null,vd=!1,Ic=0,Zl=null,r)throw Error(i(300));s===null||Mn||(s=s.dependencies,s!==null&&fd(s)&&(Mn=!0))}function dy(s,r,u,p){Ft=s;var j=0;do{if(Xl&&(Zl=null),Ic=0,Xl=!1,25<=j)throw Error(i(301));if(j+=1,En=an=null,s.updateQueue!=null){var N=s.updateQueue;N.lastEffect=null,N.events=null,N.stores=null,N.memoCache!=null&&(N.memoCache.index=0)}I.H=ZS,N=r(u,p)}while(Xl);return N}function QS(){var s=I.H,r=s.useState()[0];return r=typeof r.then=="function"?zc(r):r,s=s.useState()[0],(an!==null?an.memoizedState:null)!==s&&(Ft.flags|=1024),r}function Qm(){var s=Nd!==0;return Nd=0,s}function Ym(s,r,u){r.updateQueue=s.updateQueue,r.flags&=-2053,s.lanes&=~u}function Jm(s){if(vd){for(s=s.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}vd=!1}Ji=0,En=an=Ft=null,Xl=!1,Ic=Nd=0,Zl=null}function ya(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return En===null?Ft.memoizedState=En=s:En=En.next=s,En}function Tn(){if(an===null){var s=Ft.alternate;s=s!==null?s.memoizedState:null}else s=an.next;var r=En===null?Ft.memoizedState:En.next;if(r!==null)En=r,an=s;else{if(s===null)throw Ft.alternate===null?Error(i(467)):Error(i(310));an=s,s={memoizedState:an.memoizedState,baseState:an.baseState,baseQueue:an.baseQueue,queue:an.queue,next:null},En===null?Ft.memoizedState=En=s:En=En.next=s}return En}function Km(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zc(s){var r=Ic;return Ic+=1,Zl===null&&(Zl=[]),s=sy(Zl,s,r),r=Ft,(En===null?r.memoizedState:En.next)===null&&(r=r.alternate,I.H=r===null||r.memoizedState===null?Gy:Qy),s}function wd(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return zc(s);if(s.$$typeof===D)return Jn(s)}throw Error(i(438,String(s)))}function Wm(s){var r=null,u=Ft.updateQueue;if(u!==null&&(r=u.memoCache),r==null){var p=Ft.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(r={data:p.data.map(function(j){return j.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),u===null&&(u=Km(),Ft.updateQueue=u),u.memoCache=r,u=r.data[r.index],u===void 0)for(u=r.data[r.index]=Array(s),p=0;p<s;p++)u[p]=C;return r.index++,u}function gi(s,r){return typeof r=="function"?r(s):r}function Sd(s){var r=Tn();return Xm(r,an,s)}function Xm(s,r,u){var p=s.queue;if(p===null)throw Error(i(311));p.lastRenderedReducer=u;var j=s.baseQueue,N=p.pending;if(N!==null){if(j!==null){var $=j.next;j.next=N.next,N.next=$}r.baseQueue=j=N,p.pending=null}if(N=s.baseState,j===null)s.memoizedState=N;else{r=j.next;var X=$=null,he=null,ze=r,Ve=!1;do{var Ke=ze.lane&-536870913;if(Ke!==ze.lane?(Vt&Ke)===Ke:(Ji&Ke)===Ke){var $e=ze.revertLane;if($e===0)he!==null&&(he=he.next={lane:0,revertLane:0,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null}),Ke===Jl&&(Ve=!0);else if((Ji&$e)===$e){ze=ze.next,$e===Jl&&(Ve=!0);continue}else Ke={lane:0,revertLane:ze.revertLane,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},he===null?(X=he=Ke,$=N):he=he.next=Ke,Ft.lanes|=$e,nr|=$e;Ke=ze.action,el&&u(N,Ke),N=ze.hasEagerState?ze.eagerState:u(N,Ke)}else $e={lane:Ke,revertLane:ze.revertLane,action:ze.action,hasEagerState:ze.hasEagerState,eagerState:ze.eagerState,next:null},he===null?(X=he=$e,$=N):he=he.next=$e,Ft.lanes|=Ke,nr|=Ke;ze=ze.next}while(ze!==null&&ze!==r);if(he===null?$=N:he.next=X,!sa(N,s.memoizedState)&&(Mn=!0,Ve&&(u=Kl,u!==null)))throw u;s.memoizedState=N,s.baseState=$,s.baseQueue=he,p.lastRenderedState=N}return j===null&&(p.lanes=0),[s.memoizedState,p.dispatch]}function Zm(s){var r=Tn(),u=r.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=s;var p=u.dispatch,j=u.pending,N=r.memoizedState;if(j!==null){u.pending=null;var $=j=j.next;do N=s(N,$.action),$=$.next;while($!==j);sa(N,r.memoizedState)||(Mn=!0),r.memoizedState=N,r.baseQueue===null&&(r.baseState=N),u.lastRenderedState=N}return[N,p]}function hy(s,r,u){var p=Ft,j=Tn(),N=zt;if(N){if(u===void 0)throw Error(i(407));u=u()}else u=r();var $=!sa((an||j).memoizedState,u);$&&(j.memoizedState=u,Mn=!0),j=j.queue;var X=fy.bind(null,p,j,s);if(Fc(2048,8,X,[s]),j.getSnapshot!==r||$||En!==null&&En.memoizedState.tag&1){if(p.flags|=2048,eo(9,kd(),py.bind(null,p,j,u,r),null),dn===null)throw Error(i(349));N||(Ji&124)!==0||my(p,r,u)}return u}function my(s,r,u){s.flags|=16384,s={getSnapshot:r,value:u},r=Ft.updateQueue,r===null?(r=Km(),Ft.updateQueue=r,r.stores=[s]):(u=r.stores,u===null?r.stores=[s]:u.push(s))}function py(s,r,u,p){r.value=u,r.getSnapshot=p,gy(r)&&xy(s)}function fy(s,r,u){return u(function(){gy(r)&&xy(s)})}function gy(s){var r=s.getSnapshot;s=s.value;try{var u=r();return!sa(s,u)}catch{return!0}}function xy(s){var r=Ui(s,2);r!==null&&Ma(r,s,2)}function ep(s){var r=ya();if(typeof s=="function"){var u=s;if(s=u(),el){xe(!0);try{u()}finally{xe(!1)}}}return r.memoizedState=r.baseState=s,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:s},r}function yy(s,r,u,p){return s.baseState=u,Xm(s,an,typeof p=="function"?p:gi)}function YS(s,r,u,p,j){if(_d(s))throw Error(i(485));if(s=r.action,s!==null){var N={payload:j,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function($){N.listeners.push($)}};I.T!==null?u(!0):N.isTransition=!1,p(N),u=r.pending,u===null?(N.next=r.pending=N,by(r,N)):(N.next=u.next,r.pending=u.next=N)}}function by(s,r){var u=r.action,p=r.payload,j=s.state;if(r.isTransition){var N=I.T,$={};I.T=$;try{var X=u(j,p),he=I.S;he!==null&&he($,X),jy(s,r,X)}catch(ze){tp(s,r,ze)}finally{I.T=N}}else try{N=u(j,p),jy(s,r,N)}catch(ze){tp(s,r,ze)}}function jy(s,r,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){vy(s,r,p)},function(p){return tp(s,r,p)}):vy(s,r,u)}function vy(s,r,u){r.status="fulfilled",r.value=u,Ny(r),s.state=u,r=s.pending,r!==null&&(u=r.next,u===r?s.pending=null:(u=u.next,r.next=u,by(s,u)))}function tp(s,r,u){var p=s.pending;if(s.pending=null,p!==null){p=p.next;do r.status="rejected",r.reason=u,Ny(r),r=r.next;while(r!==p)}s.action=null}function Ny(s){s=s.listeners;for(var r=0;r<s.length;r++)(0,s[r])()}function wy(s,r){return r}function Sy(s,r){if(zt){var u=dn.formState;if(u!==null){e:{var p=Ft;if(zt){if(nn){t:{for(var j=nn,N=Ls;j.nodeType!==8;){if(!N){j=null;break t}if(j=xs(j.nextSibling),j===null){j=null;break t}}N=j.data,j=N==="F!"||N==="F"?j:null}if(j){nn=xs(j.nextSibling),p=j.data==="F!";break e}}Kr(p)}p=!1}p&&(r=u[0])}}return u=ya(),u.memoizedState=u.baseState=r,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:wy,lastRenderedState:r},u.queue=p,u=qy.bind(null,Ft,p),p.dispatch=u,p=ep(!1),N=rp.bind(null,Ft,!1,p.queue),p=ya(),j={state:r,dispatch:null,action:s,pending:null},p.queue=j,u=YS.bind(null,Ft,j,N,u),j.dispatch=u,p.memoizedState=s,[r,u,!1]}function ky(s){var r=Tn();return Cy(r,an,s)}function Cy(s,r,u){if(r=Xm(s,r,wy)[0],s=Sd(gi)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var p=zc(r)}catch($){throw $===Tc?yd:$}else p=r;r=Tn();var j=r.queue,N=j.dispatch;return u!==r.memoizedState&&(Ft.flags|=2048,eo(9,kd(),JS.bind(null,j,u),null)),[p,N,s]}function JS(s,r){s.action=r}function _y(s){var r=Tn(),u=an;if(u!==null)return Cy(r,u,s);Tn(),r=r.memoizedState,u=Tn();var p=u.queue.dispatch;return u.memoizedState=s,[r,p,!1]}function eo(s,r,u,p){return s={tag:s,create:u,deps:p,inst:r,next:null},r=Ft.updateQueue,r===null&&(r=Km(),Ft.updateQueue=r),u=r.lastEffect,u===null?r.lastEffect=s.next=s:(p=u.next,u.next=s,s.next=p,r.lastEffect=s),s}function kd(){return{destroy:void 0,resource:void 0}}function Dy(){return Tn().memoizedState}function Cd(s,r,u,p){var j=ya();p=p===void 0?null:p,Ft.flags|=s,j.memoizedState=eo(1|r,kd(),u,p)}function Fc(s,r,u,p){var j=Tn();p=p===void 0?null:p;var N=j.memoizedState.inst;an!==null&&p!==null&&Vm(p,an.memoizedState.deps)?j.memoizedState=eo(r,N,u,p):(Ft.flags|=s,j.memoizedState=eo(1|r,N,u,p))}function Ey(s,r){Cd(8390656,8,s,r)}function Ty(s,r){Fc(2048,8,s,r)}function Ay(s,r){return Fc(4,2,s,r)}function Py(s,r){return Fc(4,4,s,r)}function Ry(s,r){if(typeof r=="function"){s=s();var u=r(s);return function(){typeof u=="function"?u():r(null)}}if(r!=null)return s=s(),r.current=s,function(){r.current=null}}function Oy(s,r,u){u=u!=null?u.concat([s]):null,Fc(4,4,Ry.bind(null,r,s),u)}function np(){}function Iy(s,r){var u=Tn();r=r===void 0?null:r;var p=u.memoizedState;return r!==null&&Vm(r,p[1])?p[0]:(u.memoizedState=[s,r],s)}function zy(s,r){var u=Tn();r=r===void 0?null:r;var p=u.memoizedState;if(r!==null&&Vm(r,p[1]))return p[0];if(p=s(),el){xe(!0);try{s()}finally{xe(!1)}}return u.memoizedState=[p,r],p}function ap(s,r,u){return u===void 0||(Ji&1073741824)!==0?s.memoizedState=r:(s.memoizedState=u,s=$b(),Ft.lanes|=s,nr|=s,u)}function Fy(s,r,u,p){return sa(u,r)?u:Wl.current!==null?(s=ap(s,u,p),sa(s,r)||(Mn=!0),s):(Ji&42)===0?(Mn=!0,s.memoizedState=u):(s=$b(),Ft.lanes|=s,nr|=s,r)}function Ly(s,r,u,p,j){var N=V.p;V.p=N!==0&&8>N?N:8;var $=I.T,X={};I.T=X,rp(s,!1,r,u);try{var he=j(),ze=I.S;if(ze!==null&&ze(X,he),he!==null&&typeof he=="object"&&typeof he.then=="function"){var Ve=VS(he,p);Lc(s,r,Ve,$a(s))}else Lc(s,r,p,$a(s))}catch(Ke){Lc(s,r,{then:function(){},status:"rejected",reason:Ke},$a())}finally{V.p=N,I.T=$}}function KS(){}function sp(s,r,u,p){if(s.tag!==5)throw Error(i(476));var j=$y(s).queue;Ly(s,j,r,re,u===null?KS:function(){return My(s),u(p)})}function $y(s){var r=s.memoizedState;if(r!==null)return r;r={memoizedState:re,baseState:re,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:re},next:null};var u={};return r.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gi,lastRenderedState:u},next:null},s.memoizedState=r,s=s.alternate,s!==null&&(s.memoizedState=r),r}function My(s){var r=$y(s).next.queue;Lc(s,r,{},$a())}function ip(){return Jn(nu)}function By(){return Tn().memoizedState}function Uy(){return Tn().memoizedState}function WS(s){for(var r=s.return;r!==null;){switch(r.tag){case 24:case 3:var u=$a();s=Qi(u);var p=Yi(r,s,u);p!==null&&(Ma(p,r,u),Pc(p,r,u)),r={cache:Im()},s.payload=r;return}r=r.return}}function XS(s,r,u){var p=$a();u={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},_d(s)?Hy(r,u):(u=Ql(s,r,u,p),u!==null&&(Ma(u,s,p),Vy(u,r,p)))}function qy(s,r,u){var p=$a();Lc(s,r,u,p)}function Lc(s,r,u,p){var j={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(_d(s))Hy(r,j);else{var N=s.alternate;if(s.lanes===0&&(N===null||N.lanes===0)&&(N=r.lastRenderedReducer,N!==null))try{var $=r.lastRenderedState,X=N($,u);if(j.hasEagerState=!0,j.eagerState=X,sa(X,$))return Gl(s,r,j,0),dn===null&&Vl(),!1}catch{}finally{}if(u=Ql(s,r,j,p),u!==null)return Ma(u,s,p),Vy(u,r,p),!0}return!1}function rp(s,r,u,p){if(p={lane:2,revertLane:Lp(),action:p,hasEagerState:!1,eagerState:null,next:null},_d(s)){if(r)throw Error(i(479))}else r=Ql(s,u,p,2),r!==null&&Ma(r,s,2)}function _d(s){var r=s.alternate;return s===Ft||r!==null&&r===Ft}function Hy(s,r){Xl=vd=!0;var u=s.pending;u===null?r.next=r:(r.next=u.next,u.next=r),s.pending=r}function Vy(s,r,u){if((u&4194048)!==0){var p=r.lanes;p&=s.pendingLanes,u|=p,r.lanes=u,Xe(s,u)}}var Dd={readContext:Jn,use:wd,useCallback:Cn,useContext:Cn,useEffect:Cn,useImperativeHandle:Cn,useLayoutEffect:Cn,useInsertionEffect:Cn,useMemo:Cn,useReducer:Cn,useRef:Cn,useState:Cn,useDebugValue:Cn,useDeferredValue:Cn,useTransition:Cn,useSyncExternalStore:Cn,useId:Cn,useHostTransitionStatus:Cn,useFormState:Cn,useActionState:Cn,useOptimistic:Cn,useMemoCache:Cn,useCacheRefresh:Cn},Gy={readContext:Jn,use:wd,useCallback:function(s,r){return ya().memoizedState=[s,r===void 0?null:r],s},useContext:Jn,useEffect:Ey,useImperativeHandle:function(s,r,u){u=u!=null?u.concat([s]):null,Cd(4194308,4,Ry.bind(null,r,s),u)},useLayoutEffect:function(s,r){return Cd(4194308,4,s,r)},useInsertionEffect:function(s,r){Cd(4,2,s,r)},useMemo:function(s,r){var u=ya();r=r===void 0?null:r;var p=s();if(el){xe(!0);try{s()}finally{xe(!1)}}return u.memoizedState=[p,r],p},useReducer:function(s,r,u){var p=ya();if(u!==void 0){var j=u(r);if(el){xe(!0);try{u(r)}finally{xe(!1)}}}else j=r;return p.memoizedState=p.baseState=j,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:j},p.queue=s,s=s.dispatch=XS.bind(null,Ft,s),[p.memoizedState,s]},useRef:function(s){var r=ya();return s={current:s},r.memoizedState=s},useState:function(s){s=ep(s);var r=s.queue,u=qy.bind(null,Ft,r);return r.dispatch=u,[s.memoizedState,u]},useDebugValue:np,useDeferredValue:function(s,r){var u=ya();return ap(u,s,r)},useTransition:function(){var s=ep(!1);return s=Ly.bind(null,Ft,s.queue,!0,!1),ya().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,r,u){var p=Ft,j=ya();if(zt){if(u===void 0)throw Error(i(407));u=u()}else{if(u=r(),dn===null)throw Error(i(349));(Vt&124)!==0||my(p,r,u)}j.memoizedState=u;var N={value:u,getSnapshot:r};return j.queue=N,Ey(fy.bind(null,p,N,s),[s]),p.flags|=2048,eo(9,kd(),py.bind(null,p,N,u,r),null),u},useId:function(){var s=ya(),r=dn.identifierPrefix;if(zt){var u=_e,p=se;u=(p&~(1<<32-ae(p)-1)).toString(32)+u,r=""+r+"R"+u,u=Nd++,0<u&&(r+="H"+u.toString(32)),r+=""}else u=GS++,r=""+r+"r"+u.toString(32)+"";return s.memoizedState=r},useHostTransitionStatus:ip,useFormState:Sy,useActionState:Sy,useOptimistic:function(s){var r=ya();r.memoizedState=r.baseState=s;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=u,r=rp.bind(null,Ft,!0,u),u.dispatch=r,[s,r]},useMemoCache:Wm,useCacheRefresh:function(){return ya().memoizedState=WS.bind(null,Ft)}},Qy={readContext:Jn,use:wd,useCallback:Iy,useContext:Jn,useEffect:Ty,useImperativeHandle:Oy,useInsertionEffect:Ay,useLayoutEffect:Py,useMemo:zy,useReducer:Sd,useRef:Dy,useState:function(){return Sd(gi)},useDebugValue:np,useDeferredValue:function(s,r){var u=Tn();return Fy(u,an.memoizedState,s,r)},useTransition:function(){var s=Sd(gi)[0],r=Tn().memoizedState;return[typeof s=="boolean"?s:zc(s),r]},useSyncExternalStore:hy,useId:By,useHostTransitionStatus:ip,useFormState:ky,useActionState:ky,useOptimistic:function(s,r){var u=Tn();return yy(u,an,s,r)},useMemoCache:Wm,useCacheRefresh:Uy},ZS={readContext:Jn,use:wd,useCallback:Iy,useContext:Jn,useEffect:Ty,useImperativeHandle:Oy,useInsertionEffect:Ay,useLayoutEffect:Py,useMemo:zy,useReducer:Zm,useRef:Dy,useState:function(){return Zm(gi)},useDebugValue:np,useDeferredValue:function(s,r){var u=Tn();return an===null?ap(u,s,r):Fy(u,an.memoizedState,s,r)},useTransition:function(){var s=Zm(gi)[0],r=Tn().memoizedState;return[typeof s=="boolean"?s:zc(s),r]},useSyncExternalStore:hy,useId:By,useHostTransitionStatus:ip,useFormState:_y,useActionState:_y,useOptimistic:function(s,r){var u=Tn();return an!==null?yy(u,an,s,r):(u.baseState=s,[s,u.queue.dispatch])},useMemoCache:Wm,useCacheRefresh:Uy},to=null,$c=0;function Ed(s){var r=$c;return $c+=1,to===null&&(to=[]),sy(to,s,r)}function Mc(s,r){r=r.props.ref,s.ref=r!==void 0?r:null}function Td(s,r){throw r.$$typeof===g?Error(i(525)):(s=Object.prototype.toString.call(r),Error(i(31,s==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":s)))}function Yy(s){var r=s._init;return r(s._payload)}function Jy(s){function r(Te,ye){if(s){var Ie=Te.deletions;Ie===null?(Te.deletions=[ye],Te.flags|=16):Ie.push(ye)}}function u(Te,ye){if(!s)return null;for(;ye!==null;)r(Te,ye),ye=ye.sibling;return null}function p(Te){for(var ye=new Map;Te!==null;)Te.key!==null?ye.set(Te.key,Te):ye.set(Te.index,Te),Te=Te.sibling;return ye}function j(Te,ye){return Te=fs(Te,ye),Te.index=0,Te.sibling=null,Te}function N(Te,ye,Ie){return Te.index=Ie,s?(Ie=Te.alternate,Ie!==null?(Ie=Ie.index,Ie<ye?(Te.flags|=67108866,ye):Ie):(Te.flags|=67108866,ye)):(Te.flags|=1048576,ye)}function $(Te){return s&&Te.alternate===null&&(Te.flags|=67108866),Te}function X(Te,ye,Ie,Qe){return ye===null||ye.tag!==6?(ye=zs(Ie,Te.mode,Qe),ye.return=Te,ye):(ye=j(ye,Ie),ye.return=Te,ye)}function he(Te,ye,Ie,Qe){var pt=Ie.type;return pt===v?Ve(Te,ye,Ie.props.children,Qe,Ie.key):ye!==null&&(ye.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===Q&&Yy(pt)===ye.type)?(ye=j(ye,Ie.props),Mc(ye,Ie),ye.return=Te,ye):(ye=Hi(Ie.type,Ie.key,Ie.props,null,Te.mode,Qe),Mc(ye,Ie),ye.return=Te,ye)}function ze(Te,ye,Ie,Qe){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==Ie.containerInfo||ye.stateNode.implementation!==Ie.implementation?(ye=Yn(Ie,Te.mode,Qe),ye.return=Te,ye):(ye=j(ye,Ie.children||[]),ye.return=Te,ye)}function Ve(Te,ye,Ie,Qe,pt){return ye===null||ye.tag!==7?(ye=Oa(Ie,Te.mode,Qe,pt),ye.return=Te,ye):(ye=j(ye,Ie),ye.return=Te,ye)}function Ke(Te,ye,Ie){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ye=zs(""+ye,Te.mode,Ie),ye.return=Te,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case y:return Ie=Hi(ye.type,ye.key,ye.props,null,Te.mode,Ie),Mc(Ie,ye),Ie.return=Te,Ie;case b:return ye=Yn(ye,Te.mode,Ie),ye.return=Te,ye;case Q:var Qe=ye._init;return ye=Qe(ye._payload),Ke(Te,ye,Ie)}if(H(ye)||z(ye))return ye=Oa(ye,Te.mode,Ie,null),ye.return=Te,ye;if(typeof ye.then=="function")return Ke(Te,Ed(ye),Ie);if(ye.$$typeof===D)return Ke(Te,gd(Te,ye),Ie);Td(Te,ye)}return null}function $e(Te,ye,Ie,Qe){var pt=ye!==null?ye.key:null;if(typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint")return pt!==null?null:X(Te,ye,""+Ie,Qe);if(typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case y:return Ie.key===pt?he(Te,ye,Ie,Qe):null;case b:return Ie.key===pt?ze(Te,ye,Ie,Qe):null;case Q:return pt=Ie._init,Ie=pt(Ie._payload),$e(Te,ye,Ie,Qe)}if(H(Ie)||z(Ie))return pt!==null?null:Ve(Te,ye,Ie,Qe,null);if(typeof Ie.then=="function")return $e(Te,ye,Ed(Ie),Qe);if(Ie.$$typeof===D)return $e(Te,ye,gd(Te,Ie),Qe);Td(Te,Ie)}return null}function Be(Te,ye,Ie,Qe,pt){if(typeof Qe=="string"&&Qe!==""||typeof Qe=="number"||typeof Qe=="bigint")return Te=Te.get(Ie)||null,X(ye,Te,""+Qe,pt);if(typeof Qe=="object"&&Qe!==null){switch(Qe.$$typeof){case y:return Te=Te.get(Qe.key===null?Ie:Qe.key)||null,he(ye,Te,Qe,pt);case b:return Te=Te.get(Qe.key===null?Ie:Qe.key)||null,ze(ye,Te,Qe,pt);case Q:var Lt=Qe._init;return Qe=Lt(Qe._payload),Be(Te,ye,Ie,Qe,pt)}if(H(Qe)||z(Qe))return Te=Te.get(Ie)||null,Ve(ye,Te,Qe,pt,null);if(typeof Qe.then=="function")return Be(Te,ye,Ie,Ed(Qe),pt);if(Qe.$$typeof===D)return Be(Te,ye,Ie,gd(ye,Qe),pt);Td(ye,Qe)}return null}function kt(Te,ye,Ie,Qe){for(var pt=null,Lt=null,yt=ye,wt=ye=0,Un=null;yt!==null&&wt<Ie.length;wt++){yt.index>wt?(Un=yt,yt=null):Un=yt.sibling;var Yt=$e(Te,yt,Ie[wt],Qe);if(Yt===null){yt===null&&(yt=Un);break}s&&yt&&Yt.alternate===null&&r(Te,yt),ye=N(Yt,ye,wt),Lt===null?pt=Yt:Lt.sibling=Yt,Lt=Yt,yt=Un}if(wt===Ie.length)return u(Te,yt),zt&&Oe(Te,wt),pt;if(yt===null){for(;wt<Ie.length;wt++)yt=Ke(Te,Ie[wt],Qe),yt!==null&&(ye=N(yt,ye,wt),Lt===null?pt=yt:Lt.sibling=yt,Lt=yt);return zt&&Oe(Te,wt),pt}for(yt=p(yt);wt<Ie.length;wt++)Un=Be(yt,Te,wt,Ie[wt],Qe),Un!==null&&(s&&Un.alternate!==null&&yt.delete(Un.key===null?wt:Un.key),ye=N(Un,ye,wt),Lt===null?pt=Un:Lt.sibling=Un,Lt=Un);return s&&yt.forEach(function(dr){return r(Te,dr)}),zt&&Oe(Te,wt),pt}function Nt(Te,ye,Ie,Qe){if(Ie==null)throw Error(i(151));for(var pt=null,Lt=null,yt=ye,wt=ye=0,Un=null,Yt=Ie.next();yt!==null&&!Yt.done;wt++,Yt=Ie.next()){yt.index>wt?(Un=yt,yt=null):Un=yt.sibling;var dr=$e(Te,yt,Yt.value,Qe);if(dr===null){yt===null&&(yt=Un);break}s&&yt&&dr.alternate===null&&r(Te,yt),ye=N(dr,ye,wt),Lt===null?pt=dr:Lt.sibling=dr,Lt=dr,yt=Un}if(Yt.done)return u(Te,yt),zt&&Oe(Te,wt),pt;if(yt===null){for(;!Yt.done;wt++,Yt=Ie.next())Yt=Ke(Te,Yt.value,Qe),Yt!==null&&(ye=N(Yt,ye,wt),Lt===null?pt=Yt:Lt.sibling=Yt,Lt=Yt);return zt&&Oe(Te,wt),pt}for(yt=p(yt);!Yt.done;wt++,Yt=Ie.next())Yt=Be(yt,Te,wt,Yt.value,Qe),Yt!==null&&(s&&Yt.alternate!==null&&yt.delete(Yt.key===null?wt:Yt.key),ye=N(Yt,ye,wt),Lt===null?pt=Yt:Lt.sibling=Yt,Lt=Yt);return s&&yt.forEach(function(eC){return r(Te,eC)}),zt&&Oe(Te,wt),pt}function rn(Te,ye,Ie,Qe){if(typeof Ie=="object"&&Ie!==null&&Ie.type===v&&Ie.key===null&&(Ie=Ie.props.children),typeof Ie=="object"&&Ie!==null){switch(Ie.$$typeof){case y:e:{for(var pt=Ie.key;ye!==null;){if(ye.key===pt){if(pt=Ie.type,pt===v){if(ye.tag===7){u(Te,ye.sibling),Qe=j(ye,Ie.props.children),Qe.return=Te,Te=Qe;break e}}else if(ye.elementType===pt||typeof pt=="object"&&pt!==null&&pt.$$typeof===Q&&Yy(pt)===ye.type){u(Te,ye.sibling),Qe=j(ye,Ie.props),Mc(Qe,Ie),Qe.return=Te,Te=Qe;break e}u(Te,ye);break}else r(Te,ye);ye=ye.sibling}Ie.type===v?(Qe=Oa(Ie.props.children,Te.mode,Qe,Ie.key),Qe.return=Te,Te=Qe):(Qe=Hi(Ie.type,Ie.key,Ie.props,null,Te.mode,Qe),Mc(Qe,Ie),Qe.return=Te,Te=Qe)}return $(Te);case b:e:{for(pt=Ie.key;ye!==null;){if(ye.key===pt)if(ye.tag===4&&ye.stateNode.containerInfo===Ie.containerInfo&&ye.stateNode.implementation===Ie.implementation){u(Te,ye.sibling),Qe=j(ye,Ie.children||[]),Qe.return=Te,Te=Qe;break e}else{u(Te,ye);break}else r(Te,ye);ye=ye.sibling}Qe=Yn(Ie,Te.mode,Qe),Qe.return=Te,Te=Qe}return $(Te);case Q:return pt=Ie._init,Ie=pt(Ie._payload),rn(Te,ye,Ie,Qe)}if(H(Ie))return kt(Te,ye,Ie,Qe);if(z(Ie)){if(pt=z(Ie),typeof pt!="function")throw Error(i(150));return Ie=pt.call(Ie),Nt(Te,ye,Ie,Qe)}if(typeof Ie.then=="function")return rn(Te,ye,Ed(Ie),Qe);if(Ie.$$typeof===D)return rn(Te,ye,gd(Te,Ie),Qe);Td(Te,Ie)}return typeof Ie=="string"&&Ie!==""||typeof Ie=="number"||typeof Ie=="bigint"?(Ie=""+Ie,ye!==null&&ye.tag===6?(u(Te,ye.sibling),Qe=j(ye,Ie),Qe.return=Te,Te=Qe):(u(Te,ye),Qe=zs(Ie,Te.mode,Qe),Qe.return=Te,Te=Qe),$(Te)):u(Te,ye)}return function(Te,ye,Ie,Qe){try{$c=0;var pt=rn(Te,ye,Ie,Qe);return to=null,pt}catch(yt){if(yt===Tc||yt===yd)throw yt;var Lt=la(29,yt,null,Te.mode);return Lt.lanes=Qe,Lt.return=Te,Lt}finally{}}}var no=Jy(!0),Ky=Jy(!1),as=Ne(null),$s=null;function Ki(s){var r=s.alternate;T(zn,zn.current&1),T(as,s),$s===null&&(r===null||Wl.current!==null||r.memoizedState!==null)&&($s=s)}function Wy(s){if(s.tag===22){if(T(zn,zn.current),T(as,s),$s===null){var r=s.alternate;r!==null&&r.memoizedState!==null&&($s=s)}}else Wi()}function Wi(){T(zn,zn.current),T(as,as.current)}function xi(s){Ae(as),$s===s&&($s=null),Ae(zn)}var zn=Ne(0);function Ad(s){for(var r=s;r!==null;){if(r.tag===13){var u=r.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Kp(u)))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}function lp(s,r,u,p){r=s.memoizedState,u=u(p,r),u=u==null?r:f({},r,u),s.memoizedState=u,s.lanes===0&&(s.updateQueue.baseState=u)}var op={enqueueSetState:function(s,r,u){s=s._reactInternals;var p=$a(),j=Qi(p);j.payload=r,u!=null&&(j.callback=u),r=Yi(s,j,p),r!==null&&(Ma(r,s,p),Pc(r,s,p))},enqueueReplaceState:function(s,r,u){s=s._reactInternals;var p=$a(),j=Qi(p);j.tag=1,j.payload=r,u!=null&&(j.callback=u),r=Yi(s,j,p),r!==null&&(Ma(r,s,p),Pc(r,s,p))},enqueueForceUpdate:function(s,r){s=s._reactInternals;var u=$a(),p=Qi(u);p.tag=2,r!=null&&(p.callback=r),r=Yi(s,p,u),r!==null&&(Ma(r,s,u),Pc(r,s,u))}};function Xy(s,r,u,p,j,N,$){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(p,N,$):r.prototype&&r.prototype.isPureReactComponent?!Qr(u,p)||!Qr(j,N):!0}function Zy(s,r,u,p){s=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(u,p),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(u,p),r.state!==s&&op.enqueueReplaceState(r,r.state,null)}function tl(s,r){var u=r;if("ref"in r){u={};for(var p in r)p!=="ref"&&(u[p]=r[p])}if(s=s.defaultProps){u===r&&(u=f({},u));for(var j in s)u[j]===void 0&&(u[j]=s[j])}return u}var Pd=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function eb(s){Pd(s)}function tb(s){console.error(s)}function nb(s){Pd(s)}function Rd(s,r){try{var u=s.onUncaughtError;u(r.value,{componentStack:r.stack})}catch(p){setTimeout(function(){throw p})}}function ab(s,r,u){try{var p=s.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(j){setTimeout(function(){throw j})}}function cp(s,r,u){return u=Qi(u),u.tag=3,u.payload={element:null},u.callback=function(){Rd(s,r)},u}function sb(s){return s=Qi(s),s.tag=3,s}function ib(s,r,u,p){var j=u.type.getDerivedStateFromError;if(typeof j=="function"){var N=p.value;s.payload=function(){return j(N)},s.callback=function(){ab(r,u,p)}}var $=u.stateNode;$!==null&&typeof $.componentDidCatch=="function"&&(s.callback=function(){ab(r,u,p),typeof j!="function"&&(ar===null?ar=new Set([this]):ar.add(this));var X=p.stack;this.componentDidCatch(p.value,{componentStack:X!==null?X:""})})}function ek(s,r,u,p,j){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(r=u.alternate,r!==null&&_c(r,u,j,!0),u=as.current,u!==null){switch(u.tag){case 13:return $s===null?Rp():u.alternate===null&&wn===0&&(wn=3),u.flags&=-257,u.flags|=65536,u.lanes=j,p===Lm?u.flags|=16384:(r=u.updateQueue,r===null?u.updateQueue=new Set([p]):r.add(p),Ip(s,p,j)),!1;case 22:return u.flags|=65536,p===Lm?u.flags|=16384:(r=u.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=r):(u=r.retryQueue,u===null?r.retryQueue=new Set([p]):u.add(p)),Ip(s,p,j)),!1}throw Error(i(435,u.tag))}return Ip(s,p,j),Rp(),!1}if(zt)return r=as.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=j,p!==Am&&(s=Error(i(422),{cause:p}),Cc(ga(s,u)))):(p!==Am&&(r=Error(i(423),{cause:p}),Cc(ga(r,u))),s=s.current.alternate,s.flags|=65536,j&=-j,s.lanes|=j,p=ga(p,u),j=cp(s.stateNode,p,j),Bm(s,j),wn!==4&&(wn=2)),!1;var N=Error(i(520),{cause:p});if(N=ga(N,u),Qc===null?Qc=[N]:Qc.push(N),wn!==4&&(wn=2),r===null)return!0;p=ga(p,u),u=r;do{switch(u.tag){case 3:return u.flags|=65536,s=j&-j,u.lanes|=s,s=cp(u.stateNode,p,s),Bm(u,s),!1;case 1:if(r=u.type,N=u.stateNode,(u.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(ar===null||!ar.has(N))))return u.flags|=65536,j&=-j,u.lanes|=j,j=sb(j),ib(j,s,u,p),Bm(u,j),!1}u=u.return}while(u!==null);return!1}var rb=Error(i(461)),Mn=!1;function Hn(s,r,u,p){r.child=s===null?Ky(r,null,u,p):no(r,s.child,u,p)}function lb(s,r,u,p,j){u=u.render;var N=r.ref;if("ref"in p){var $={};for(var X in p)X!=="ref"&&($[X]=p[X])}else $=p;return Xr(r),p=Gm(s,r,u,$,N,j),X=Qm(),s!==null&&!Mn?(Ym(s,r,j),yi(s,r,j)):(zt&&X&&gt(r),r.flags|=1,Hn(s,r,p,j),r.child)}function ob(s,r,u,p,j){if(s===null){var N=u.type;return typeof N=="function"&&!wc(N)&&N.defaultProps===void 0&&u.compare===null?(r.tag=15,r.type=N,cb(s,r,N,p,j)):(s=Hi(u.type,null,p,r,r.mode,j),s.ref=r.ref,s.return=r,r.child=s)}if(N=s.child,!xp(s,j)){var $=N.memoizedProps;if(u=u.compare,u=u!==null?u:Qr,u($,p)&&s.ref===r.ref)return yi(s,r,j)}return r.flags|=1,s=fs(N,p),s.ref=r.ref,s.return=r,r.child=s}function cb(s,r,u,p,j){if(s!==null){var N=s.memoizedProps;if(Qr(N,p)&&s.ref===r.ref)if(Mn=!1,r.pendingProps=p=N,xp(s,j))(s.flags&131072)!==0&&(Mn=!0);else return r.lanes=s.lanes,yi(s,r,j)}return up(s,r,u,p,j)}function ub(s,r,u){var p=r.pendingProps,j=p.children,N=s!==null?s.memoizedState:null;if(p.mode==="hidden"){if((r.flags&128)!==0){if(p=N!==null?N.baseLanes|u:u,s!==null){for(j=r.child=s.child,N=0;j!==null;)N=N|j.lanes|j.childLanes,j=j.sibling;r.childLanes=N&~p}else r.childLanes=0,r.child=null;return db(s,r,p,u)}if((u&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},s!==null&&xd(r,N!==null?N.cachePool:null),N!==null?cy(r,N):qm(),Wy(r);else return r.lanes=r.childLanes=536870912,db(s,r,N!==null?N.baseLanes|u:u,u)}else N!==null?(xd(r,N.cachePool),cy(r,N),Wi(),r.memoizedState=null):(s!==null&&xd(r,null),qm(),Wi());return Hn(s,r,j,u),r.child}function db(s,r,u,p){var j=Fm();return j=j===null?null:{parent:In._currentValue,pool:j},r.memoizedState={baseLanes:u,cachePool:j},s!==null&&xd(r,null),qm(),Wy(r),s!==null&&_c(s,r,p,!0),null}function Od(s,r){var u=r.ref;if(u===null)s!==null&&s.ref!==null&&(r.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(i(284));(s===null||s.ref!==u)&&(r.flags|=4194816)}}function up(s,r,u,p,j){return Xr(r),u=Gm(s,r,u,p,void 0,j),p=Qm(),s!==null&&!Mn?(Ym(s,r,j),yi(s,r,j)):(zt&&p&&gt(r),r.flags|=1,Hn(s,r,u,j),r.child)}function hb(s,r,u,p,j,N){return Xr(r),r.updateQueue=null,u=dy(r,p,u,j),uy(s),p=Qm(),s!==null&&!Mn?(Ym(s,r,N),yi(s,r,N)):(zt&&p&&gt(r),r.flags|=1,Hn(s,r,u,N),r.child)}function mb(s,r,u,p,j){if(Xr(r),r.stateNode===null){var N=qi,$=u.contextType;typeof $=="object"&&$!==null&&(N=Jn($)),N=new u(p,N),r.memoizedState=N.state!==null&&N.state!==void 0?N.state:null,N.updater=op,r.stateNode=N,N._reactInternals=r,N=r.stateNode,N.props=p,N.state=r.memoizedState,N.refs={},$m(r),$=u.contextType,N.context=typeof $=="object"&&$!==null?Jn($):qi,N.state=r.memoizedState,$=u.getDerivedStateFromProps,typeof $=="function"&&(lp(r,u,$,p),N.state=r.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof N.getSnapshotBeforeUpdate=="function"||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||($=N.state,typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount(),$!==N.state&&op.enqueueReplaceState(N,N.state,null),Oc(r,p,N,j),Rc(),N.state=r.memoizedState),typeof N.componentDidMount=="function"&&(r.flags|=4194308),p=!0}else if(s===null){N=r.stateNode;var X=r.memoizedProps,he=tl(u,X);N.props=he;var ze=N.context,Ve=u.contextType;$=qi,typeof Ve=="object"&&Ve!==null&&($=Jn(Ve));var Ke=u.getDerivedStateFromProps;Ve=typeof Ke=="function"||typeof N.getSnapshotBeforeUpdate=="function",X=r.pendingProps!==X,Ve||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||(X||ze!==$)&&Zy(r,N,p,$),Gi=!1;var $e=r.memoizedState;N.state=$e,Oc(r,p,N,j),Rc(),ze=r.memoizedState,X||$e!==ze||Gi?(typeof Ke=="function"&&(lp(r,u,Ke,p),ze=r.memoizedState),(he=Gi||Xy(r,u,he,p,$e,ze,$))?(Ve||typeof N.UNSAFE_componentWillMount!="function"&&typeof N.componentWillMount!="function"||(typeof N.componentWillMount=="function"&&N.componentWillMount(),typeof N.UNSAFE_componentWillMount=="function"&&N.UNSAFE_componentWillMount()),typeof N.componentDidMount=="function"&&(r.flags|=4194308)):(typeof N.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=p,r.memoizedState=ze),N.props=p,N.state=ze,N.context=$,p=he):(typeof N.componentDidMount=="function"&&(r.flags|=4194308),p=!1)}else{N=r.stateNode,Mm(s,r),$=r.memoizedProps,Ve=tl(u,$),N.props=Ve,Ke=r.pendingProps,$e=N.context,ze=u.contextType,he=qi,typeof ze=="object"&&ze!==null&&(he=Jn(ze)),X=u.getDerivedStateFromProps,(ze=typeof X=="function"||typeof N.getSnapshotBeforeUpdate=="function")||typeof N.UNSAFE_componentWillReceiveProps!="function"&&typeof N.componentWillReceiveProps!="function"||($!==Ke||$e!==he)&&Zy(r,N,p,he),Gi=!1,$e=r.memoizedState,N.state=$e,Oc(r,p,N,j),Rc();var Be=r.memoizedState;$!==Ke||$e!==Be||Gi||s!==null&&s.dependencies!==null&&fd(s.dependencies)?(typeof X=="function"&&(lp(r,u,X,p),Be=r.memoizedState),(Ve=Gi||Xy(r,u,Ve,p,$e,Be,he)||s!==null&&s.dependencies!==null&&fd(s.dependencies))?(ze||typeof N.UNSAFE_componentWillUpdate!="function"&&typeof N.componentWillUpdate!="function"||(typeof N.componentWillUpdate=="function"&&N.componentWillUpdate(p,Be,he),typeof N.UNSAFE_componentWillUpdate=="function"&&N.UNSAFE_componentWillUpdate(p,Be,he)),typeof N.componentDidUpdate=="function"&&(r.flags|=4),typeof N.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof N.componentDidUpdate!="function"||$===s.memoizedProps&&$e===s.memoizedState||(r.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||$===s.memoizedProps&&$e===s.memoizedState||(r.flags|=1024),r.memoizedProps=p,r.memoizedState=Be),N.props=p,N.state=Be,N.context=he,p=Ve):(typeof N.componentDidUpdate!="function"||$===s.memoizedProps&&$e===s.memoizedState||(r.flags|=4),typeof N.getSnapshotBeforeUpdate!="function"||$===s.memoizedProps&&$e===s.memoizedState||(r.flags|=1024),p=!1)}return N=p,Od(s,r),p=(r.flags&128)!==0,N||p?(N=r.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:N.render(),r.flags|=1,s!==null&&p?(r.child=no(r,s.child,null,j),r.child=no(r,null,u,j)):Hn(s,r,u,j),r.memoizedState=N.state,s=r.child):s=yi(s,r,j),s}function pb(s,r,u,p){return kc(),r.flags|=256,Hn(s,r,u,p),r.child}var dp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function hp(s){return{baseLanes:s,cachePool:ty()}}function mp(s,r,u){return s=s!==null?s.childLanes&~u:0,r&&(s|=ss),s}function fb(s,r,u){var p=r.pendingProps,j=!1,N=(r.flags&128)!==0,$;if(($=N)||($=s!==null&&s.memoizedState===null?!1:(zn.current&2)!==0),$&&(j=!0,r.flags&=-129),$=(r.flags&32)!==0,r.flags&=-33,s===null){if(zt){if(j?Ki(r):Wi(),zt){var X=nn,he;if(he=X){e:{for(he=X,X=Ls;he.nodeType!==8;){if(!X){X=null;break e}if(he=xs(he.nextSibling),he===null){X=null;break e}}X=he}X!==null?(r.memoizedState={dehydrated:X,treeContext:le!==null?{id:se,overflow:_e}:null,retryLane:536870912,hydrationErrors:null},he=la(18,null,null,0),he.stateNode=X,he.return=r,r.child=he,_t=r,nn=null,he=!0):he=!1}he||Kr(r)}if(X=r.memoizedState,X!==null&&(X=X.dehydrated,X!==null))return Kp(X)?r.lanes=32:r.lanes=536870912,null;xi(r)}return X=p.children,p=p.fallback,j?(Wi(),j=r.mode,X=Id({mode:"hidden",children:X},j),p=Oa(p,j,u,null),X.return=r,p.return=r,X.sibling=p,r.child=X,j=r.child,j.memoizedState=hp(u),j.childLanes=mp(s,$,u),r.memoizedState=dp,p):(Ki(r),pp(r,X))}if(he=s.memoizedState,he!==null&&(X=he.dehydrated,X!==null)){if(N)r.flags&256?(Ki(r),r.flags&=-257,r=fp(s,r,u)):r.memoizedState!==null?(Wi(),r.child=s.child,r.flags|=128,r=null):(Wi(),j=p.fallback,X=r.mode,p=Id({mode:"visible",children:p.children},X),j=Oa(j,X,u,null),j.flags|=2,p.return=r,j.return=r,p.sibling=j,r.child=p,no(r,s.child,null,u),p=r.child,p.memoizedState=hp(u),p.childLanes=mp(s,$,u),r.memoizedState=dp,r=j);else if(Ki(r),Kp(X)){if($=X.nextSibling&&X.nextSibling.dataset,$)var ze=$.dgst;$=ze,p=Error(i(419)),p.stack="",p.digest=$,Cc({value:p,source:null,stack:null}),r=fp(s,r,u)}else if(Mn||_c(s,r,u,!1),$=(u&s.childLanes)!==0,Mn||$){if($=dn,$!==null&&(p=u&-u,p=(p&42)!==0?1:dt(p),p=(p&($.suspendedLanes|u))!==0?0:p,p!==0&&p!==he.retryLane))throw he.retryLane=p,Ui(s,p),Ma($,s,p),rb;X.data==="$?"||Rp(),r=fp(s,r,u)}else X.data==="$?"?(r.flags|=192,r.child=s.child,r=null):(s=he.treeContext,nn=xs(X.nextSibling),_t=r,zt=!0,Jr=null,Ls=!1,s!==null&&(oa[K++]=se,oa[K++]=_e,oa[K++]=le,se=s.id,_e=s.overflow,le=r),r=pp(r,p.children),r.flags|=4096);return r}return j?(Wi(),j=p.fallback,X=r.mode,he=s.child,ze=he.sibling,p=fs(he,{mode:"hidden",children:p.children}),p.subtreeFlags=he.subtreeFlags&65011712,ze!==null?j=fs(ze,j):(j=Oa(j,X,u,null),j.flags|=2),j.return=r,p.return=r,p.sibling=j,r.child=p,p=j,j=r.child,X=s.child.memoizedState,X===null?X=hp(u):(he=X.cachePool,he!==null?(ze=In._currentValue,he=he.parent!==ze?{parent:ze,pool:ze}:he):he=ty(),X={baseLanes:X.baseLanes|u,cachePool:he}),j.memoizedState=X,j.childLanes=mp(s,$,u),r.memoizedState=dp,p):(Ki(r),u=s.child,s=u.sibling,u=fs(u,{mode:"visible",children:p.children}),u.return=r,u.sibling=null,s!==null&&($=r.deletions,$===null?(r.deletions=[s],r.flags|=16):$.push(s)),r.child=u,r.memoizedState=null,u)}function pp(s,r){return r=Id({mode:"visible",children:r},s.mode),r.return=s,s.child=r}function Id(s,r){return s=la(22,s,null,r),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function fp(s,r,u){return no(r,s.child,null,u),s=pp(r,r.pendingProps.children),s.flags|=2,r.memoizedState=null,s}function gb(s,r,u){s.lanes|=r;var p=s.alternate;p!==null&&(p.lanes|=r),Rm(s.return,r,u)}function gp(s,r,u,p,j){var N=s.memoizedState;N===null?s.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:j}:(N.isBackwards=r,N.rendering=null,N.renderingStartTime=0,N.last=p,N.tail=u,N.tailMode=j)}function xb(s,r,u){var p=r.pendingProps,j=p.revealOrder,N=p.tail;if(Hn(s,r,p.children,u),p=zn.current,(p&2)!==0)p=p&1|2,r.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=r.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&gb(s,u,r);else if(s.tag===19)gb(s,u,r);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}p&=1}switch(T(zn,p),j){case"forwards":for(u=r.child,j=null;u!==null;)s=u.alternate,s!==null&&Ad(s)===null&&(j=u),u=u.sibling;u=j,u===null?(j=r.child,r.child=null):(j=u.sibling,u.sibling=null),gp(r,!1,j,u,N);break;case"backwards":for(u=null,j=r.child,r.child=null;j!==null;){if(s=j.alternate,s!==null&&Ad(s)===null){r.child=j;break}s=j.sibling,j.sibling=u,u=j,j=s}gp(r,!0,u,null,N);break;case"together":gp(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function yi(s,r,u){if(s!==null&&(r.dependencies=s.dependencies),nr|=r.lanes,(u&r.childLanes)===0)if(s!==null){if(_c(s,r,u,!1),(u&r.childLanes)===0)return null}else return null;if(s!==null&&r.child!==s.child)throw Error(i(153));if(r.child!==null){for(s=r.child,u=fs(s,s.pendingProps),r.child=u,u.return=r;s.sibling!==null;)s=s.sibling,u=u.sibling=fs(s,s.pendingProps),u.return=r;u.sibling=null}return r.child}function xp(s,r){return(s.lanes&r)!==0?!0:(s=s.dependencies,!!(s!==null&&fd(s)))}function tk(s,r,u){switch(r.tag){case 3:Se(r,r.stateNode.containerInfo),Vi(r,In,s.memoizedState.cache),kc();break;case 27:case 5:oe(r);break;case 4:Se(r,r.stateNode.containerInfo);break;case 10:Vi(r,r.type,r.memoizedProps.value);break;case 13:var p=r.memoizedState;if(p!==null)return p.dehydrated!==null?(Ki(r),r.flags|=128,null):(u&r.child.childLanes)!==0?fb(s,r,u):(Ki(r),s=yi(s,r,u),s!==null?s.sibling:null);Ki(r);break;case 19:var j=(s.flags&128)!==0;if(p=(u&r.childLanes)!==0,p||(_c(s,r,u,!1),p=(u&r.childLanes)!==0),j){if(p)return xb(s,r,u);r.flags|=128}if(j=r.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),T(zn,zn.current),p)break;return null;case 22:case 23:return r.lanes=0,ub(s,r,u);case 24:Vi(r,In,s.memoizedState.cache)}return yi(s,r,u)}function yb(s,r,u){if(s!==null)if(s.memoizedProps!==r.pendingProps)Mn=!0;else{if(!xp(s,u)&&(r.flags&128)===0)return Mn=!1,tk(s,r,u);Mn=(s.flags&131072)!==0}else Mn=!1,zt&&(r.flags&1048576)!==0&&rt(r,Yr,r.index);switch(r.lanes=0,r.tag){case 16:e:{s=r.pendingProps;var p=r.elementType,j=p._init;if(p=j(p._payload),r.type=p,typeof p=="function")wc(p)?(s=tl(p,s),r.tag=1,r=mb(null,r,p,s,u)):(r.tag=0,r=up(null,r,p,s,u));else{if(p!=null){if(j=p.$$typeof,j===O){r.tag=11,r=lb(null,r,p,s,u);break e}else if(j===P){r.tag=14,r=ob(null,r,p,s,u);break e}}throw r=J(p)||p,Error(i(306,r,""))}}return r;case 0:return up(s,r,r.type,r.pendingProps,u);case 1:return p=r.type,j=tl(p,r.pendingProps),mb(s,r,p,j,u);case 3:e:{if(Se(r,r.stateNode.containerInfo),s===null)throw Error(i(387));p=r.pendingProps;var N=r.memoizedState;j=N.element,Mm(s,r),Oc(r,p,null,u);var $=r.memoizedState;if(p=$.cache,Vi(r,In,p),p!==N.cache&&Om(r,[In],u,!0),Rc(),p=$.element,N.isDehydrated)if(N={element:p,isDehydrated:!1,cache:$.cache},r.updateQueue.baseState=N,r.memoizedState=N,r.flags&256){r=pb(s,r,p,u);break e}else if(p!==j){j=ga(Error(i(424)),r),Cc(j),r=pb(s,r,p,u);break e}else{switch(s=r.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(nn=xs(s.firstChild),_t=r,zt=!0,Jr=null,Ls=!0,u=Ky(r,null,p,u),r.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(kc(),p===j){r=yi(s,r,u);break e}Hn(s,r,p,u)}r=r.child}return r;case 26:return Od(s,r),s===null?(u=Nj(r.type,null,r.pendingProps,null))?r.memoizedState=u:zt||(u=r.type,s=r.pendingProps,p=Jd(Pe.current).createElement(u),p[Ze]=r,p[ht]=s,Gn(p,u,s),jn(p),r.stateNode=p):r.memoizedState=Nj(r.type,s.memoizedProps,r.pendingProps,s.memoizedState),null;case 27:return oe(r),s===null&&zt&&(p=r.stateNode=bj(r.type,r.pendingProps,Pe.current),_t=r,Ls=!0,j=nn,rr(r.type)?(Wp=j,nn=xs(p.firstChild)):nn=j),Hn(s,r,r.pendingProps.children,u),Od(s,r),s===null&&(r.flags|=4194304),r.child;case 5:return s===null&&zt&&((j=p=nn)&&(p=Ek(p,r.type,r.pendingProps,Ls),p!==null?(r.stateNode=p,_t=r,nn=xs(p.firstChild),Ls=!1,j=!0):j=!1),j||Kr(r)),oe(r),j=r.type,N=r.pendingProps,$=s!==null?s.memoizedProps:null,p=N.children,Qp(j,N)?p=null:$!==null&&Qp(j,$)&&(r.flags|=32),r.memoizedState!==null&&(j=Gm(s,r,QS,null,null,u),nu._currentValue=j),Od(s,r),Hn(s,r,p,u),r.child;case 6:return s===null&&zt&&((s=u=nn)&&(u=Tk(u,r.pendingProps,Ls),u!==null?(r.stateNode=u,_t=r,nn=null,s=!0):s=!1),s||Kr(r)),null;case 13:return fb(s,r,u);case 4:return Se(r,r.stateNode.containerInfo),p=r.pendingProps,s===null?r.child=no(r,null,p,u):Hn(s,r,p,u),r.child;case 11:return lb(s,r,r.type,r.pendingProps,u);case 7:return Hn(s,r,r.pendingProps,u),r.child;case 8:return Hn(s,r,r.pendingProps.children,u),r.child;case 12:return Hn(s,r,r.pendingProps.children,u),r.child;case 10:return p=r.pendingProps,Vi(r,r.type,p.value),Hn(s,r,p.children,u),r.child;case 9:return j=r.type._context,p=r.pendingProps.children,Xr(r),j=Jn(j),p=p(j),r.flags|=1,Hn(s,r,p,u),r.child;case 14:return ob(s,r,r.type,r.pendingProps,u);case 15:return cb(s,r,r.type,r.pendingProps,u);case 19:return xb(s,r,u);case 31:return p=r.pendingProps,u=r.mode,p={mode:p.mode,children:p.children},s===null?(u=Id(p,u),u.ref=r.ref,r.child=u,u.return=r,r=u):(u=fs(s.child,p),u.ref=r.ref,r.child=u,u.return=r,r=u),r;case 22:return ub(s,r,u);case 24:return Xr(r),p=Jn(In),s===null?(j=Fm(),j===null&&(j=dn,N=Im(),j.pooledCache=N,N.refCount++,N!==null&&(j.pooledCacheLanes|=u),j=N),r.memoizedState={parent:p,cache:j},$m(r),Vi(r,In,j)):((s.lanes&u)!==0&&(Mm(s,r),Oc(r,null,null,u),Rc()),j=s.memoizedState,N=r.memoizedState,j.parent!==p?(j={parent:p,cache:p},r.memoizedState=j,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=j),Vi(r,In,p)):(p=N.cache,Vi(r,In,p),p!==j.cache&&Om(r,[In],u,!0))),Hn(s,r,r.pendingProps.children,u),r.child;case 29:throw r.pendingProps}throw Error(i(156,r.tag))}function bi(s){s.flags|=4}function bb(s,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!_j(r)){if(r=as.current,r!==null&&((Vt&4194048)===Vt?$s!==null:(Vt&62914560)!==Vt&&(Vt&536870912)===0||r!==$s))throw Ac=Lm,ny;s.flags|=8192}}function zd(s,r){r!==null&&(s.flags|=4),s.flags&16384&&(r=s.tag!==22?De():536870912,s.lanes|=r,ro|=r)}function Bc(s,r){if(!zt)switch(s.tailMode){case"hidden":r=s.tail;for(var u=null;r!==null;)r.alternate!==null&&(u=r),r=r.sibling;u===null?s.tail=null:u.sibling=null;break;case"collapsed":u=s.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?r||s.tail===null?s.tail=null:s.tail.sibling=null:p.sibling=null}}function vn(s){var r=s.alternate!==null&&s.alternate.child===s.child,u=0,p=0;if(r)for(var j=s.child;j!==null;)u|=j.lanes|j.childLanes,p|=j.subtreeFlags&65011712,p|=j.flags&65011712,j.return=s,j=j.sibling;else for(j=s.child;j!==null;)u|=j.lanes|j.childLanes,p|=j.subtreeFlags,p|=j.flags,j.return=s,j=j.sibling;return s.subtreeFlags|=p,s.childLanes=u,r}function nk(s,r,u){var p=r.pendingProps;switch(Ht(r),r.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return vn(r),null;case 1:return vn(r),null;case 3:return u=r.stateNode,p=null,s!==null&&(p=s.memoizedState.cache),r.memoizedState.cache!==p&&(r.flags|=2048),fi(In),ee(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(s===null||s.child===null)&&(Sc(r)?bi(r):s===null||s.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Wx())),vn(r),null;case 26:return u=r.memoizedState,s===null?(bi(r),u!==null?(vn(r),bb(r,u)):(vn(r),r.flags&=-16777217)):u?u!==s.memoizedState?(bi(r),vn(r),bb(r,u)):(vn(r),r.flags&=-16777217):(s.memoizedProps!==p&&bi(r),vn(r),r.flags&=-16777217),null;case 27:fe(r),u=Pe.current;var j=r.type;if(s!==null&&r.stateNode!=null)s.memoizedProps!==p&&bi(r);else{if(!p){if(r.stateNode===null)throw Error(i(166));return vn(r),null}s=Ce.current,Sc(r)?Jx(r):(s=bj(j,p,u),r.stateNode=s,bi(r))}return vn(r),null;case 5:if(fe(r),u=r.type,s!==null&&r.stateNode!=null)s.memoizedProps!==p&&bi(r);else{if(!p){if(r.stateNode===null)throw Error(i(166));return vn(r),null}if(s=Ce.current,Sc(r))Jx(r);else{switch(j=Jd(Pe.current),s){case 1:s=j.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:s=j.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":s=j.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":s=j.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":s=j.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof p.is=="string"?j.createElement("select",{is:p.is}):j.createElement("select"),p.multiple?s.multiple=!0:p.size&&(s.size=p.size);break;default:s=typeof p.is=="string"?j.createElement(u,{is:p.is}):j.createElement(u)}}s[Ze]=r,s[ht]=p;e:for(j=r.child;j!==null;){if(j.tag===5||j.tag===6)s.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===r)break e;for(;j.sibling===null;){if(j.return===null||j.return===r)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}r.stateNode=s;e:switch(Gn(s,u,p),u){case"button":case"input":case"select":case"textarea":s=!!p.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&bi(r)}}return vn(r),r.flags&=-16777217,null;case 6:if(s&&r.stateNode!=null)s.memoizedProps!==p&&bi(r);else{if(typeof p!="string"&&r.stateNode===null)throw Error(i(166));if(s=Pe.current,Sc(r)){if(s=r.stateNode,u=r.memoizedProps,p=null,j=_t,j!==null)switch(j.tag){case 27:case 5:p=j.memoizedProps}s[Ze]=r,s=!!(s.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||hj(s.nodeValue,u)),s||Kr(r)}else s=Jd(s).createTextNode(p),s[Ze]=r,r.stateNode=s}return vn(r),null;case 13:if(p=r.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(j=Sc(r),p!==null&&p.dehydrated!==null){if(s===null){if(!j)throw Error(i(318));if(j=r.memoizedState,j=j!==null?j.dehydrated:null,!j)throw Error(i(317));j[Ze]=r}else kc(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;vn(r),j=!1}else j=Wx(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=j),j=!0;if(!j)return r.flags&256?(xi(r),r):(xi(r),null)}if(xi(r),(r.flags&128)!==0)return r.lanes=u,r;if(u=p!==null,s=s!==null&&s.memoizedState!==null,u){p=r.child,j=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(j=p.alternate.memoizedState.cachePool.pool);var N=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(N=p.memoizedState.cachePool.pool),N!==j&&(p.flags|=2048)}return u!==s&&u&&(r.child.flags|=8192),zd(r,r.updateQueue),vn(r),null;case 4:return ee(),s===null&&Up(r.stateNode.containerInfo),vn(r),null;case 10:return fi(r.type),vn(r),null;case 19:if(Ae(zn),j=r.memoizedState,j===null)return vn(r),null;if(p=(r.flags&128)!==0,N=j.rendering,N===null)if(p)Bc(j,!1);else{if(wn!==0||s!==null&&(s.flags&128)!==0)for(s=r.child;s!==null;){if(N=Ad(s),N!==null){for(r.flags|=128,Bc(j,!1),s=N.updateQueue,r.updateQueue=s,zd(r,s),r.subtreeFlags=0,s=u,u=r.child;u!==null;)pd(u,s),u=u.sibling;return T(zn,zn.current&1|2),r.child}s=s.sibling}j.tail!==null&&ce()>$d&&(r.flags|=128,p=!0,Bc(j,!1),r.lanes=4194304)}else{if(!p)if(s=Ad(N),s!==null){if(r.flags|=128,p=!0,s=s.updateQueue,r.updateQueue=s,zd(r,s),Bc(j,!0),j.tail===null&&j.tailMode==="hidden"&&!N.alternate&&!zt)return vn(r),null}else 2*ce()-j.renderingStartTime>$d&&u!==536870912&&(r.flags|=128,p=!0,Bc(j,!1),r.lanes=4194304);j.isBackwards?(N.sibling=r.child,r.child=N):(s=j.last,s!==null?s.sibling=N:r.child=N,j.last=N)}return j.tail!==null?(r=j.tail,j.rendering=r,j.tail=r.sibling,j.renderingStartTime=ce(),r.sibling=null,s=zn.current,T(zn,p?s&1|2:s&1),r):(vn(r),null);case 22:case 23:return xi(r),Hm(),p=r.memoizedState!==null,s!==null?s.memoizedState!==null!==p&&(r.flags|=8192):p&&(r.flags|=8192),p?(u&536870912)!==0&&(r.flags&128)===0&&(vn(r),r.subtreeFlags&6&&(r.flags|=8192)):vn(r),u=r.updateQueue,u!==null&&zd(r,u.retryQueue),u=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),p=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(p=r.memoizedState.cachePool.pool),p!==u&&(r.flags|=2048),s!==null&&Ae(Zr),null;case 24:return u=null,s!==null&&(u=s.memoizedState.cache),r.memoizedState.cache!==u&&(r.flags|=2048),fi(In),vn(r),null;case 25:return null;case 30:return null}throw Error(i(156,r.tag))}function ak(s,r){switch(Ht(r),r.tag){case 1:return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 3:return fi(In),ee(),s=r.flags,(s&65536)!==0&&(s&128)===0?(r.flags=s&-65537|128,r):null;case 26:case 27:case 5:return fe(r),null;case 13:if(xi(r),s=r.memoizedState,s!==null&&s.dehydrated!==null){if(r.alternate===null)throw Error(i(340));kc()}return s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 19:return Ae(zn),null;case 4:return ee(),null;case 10:return fi(r.type),null;case 22:case 23:return xi(r),Hm(),s!==null&&Ae(Zr),s=r.flags,s&65536?(r.flags=s&-65537|128,r):null;case 24:return fi(In),null;case 25:return null;default:return null}}function jb(s,r){switch(Ht(r),r.tag){case 3:fi(In),ee();break;case 26:case 27:case 5:fe(r);break;case 4:ee();break;case 13:xi(r);break;case 19:Ae(zn);break;case 10:fi(r.type);break;case 22:case 23:xi(r),Hm(),s!==null&&Ae(Zr);break;case 24:fi(In)}}function Uc(s,r){try{var u=r.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var j=p.next;u=j;do{if((u.tag&s)===s){p=void 0;var N=u.create,$=u.inst;p=N(),$.destroy=p}u=u.next}while(u!==j)}}catch(X){cn(r,r.return,X)}}function Xi(s,r,u){try{var p=r.updateQueue,j=p!==null?p.lastEffect:null;if(j!==null){var N=j.next;p=N;do{if((p.tag&s)===s){var $=p.inst,X=$.destroy;if(X!==void 0){$.destroy=void 0,j=r;var he=u,ze=X;try{ze()}catch(Ve){cn(j,he,Ve)}}}p=p.next}while(p!==N)}}catch(Ve){cn(r,r.return,Ve)}}function vb(s){var r=s.updateQueue;if(r!==null){var u=s.stateNode;try{oy(r,u)}catch(p){cn(s,s.return,p)}}}function Nb(s,r,u){u.props=tl(s.type,s.memoizedProps),u.state=s.memoizedState;try{u.componentWillUnmount()}catch(p){cn(s,r,p)}}function qc(s,r){try{var u=s.ref;if(u!==null){switch(s.tag){case 26:case 27:case 5:var p=s.stateNode;break;case 30:p=s.stateNode;break;default:p=s.stateNode}typeof u=="function"?s.refCleanup=u(p):u.current=p}}catch(j){cn(s,r,j)}}function Ms(s,r){var u=s.ref,p=s.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(j){cn(s,r,j)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(j){cn(s,r,j)}else u.current=null}function wb(s){var r=s.type,u=s.memoizedProps,p=s.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(j){cn(s,s.return,j)}}function yp(s,r,u){try{var p=s.stateNode;Sk(p,s.type,u,r),p[ht]=r}catch(j){cn(s,s.return,j)}}function Sb(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&rr(s.type)||s.tag===4}function bp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Sb(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&rr(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function jp(s,r,u){var p=s.tag;if(p===5||p===6)s=s.stateNode,r?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(s,r):(r=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,r.appendChild(s),u=u._reactRootContainer,u!=null||r.onclick!==null||(r.onclick=Yd));else if(p!==4&&(p===27&&rr(s.type)&&(u=s.stateNode,r=null),s=s.child,s!==null))for(jp(s,r,u),s=s.sibling;s!==null;)jp(s,r,u),s=s.sibling}function Fd(s,r,u){var p=s.tag;if(p===5||p===6)s=s.stateNode,r?u.insertBefore(s,r):u.appendChild(s);else if(p!==4&&(p===27&&rr(s.type)&&(u=s.stateNode),s=s.child,s!==null))for(Fd(s,r,u),s=s.sibling;s!==null;)Fd(s,r,u),s=s.sibling}function kb(s){var r=s.stateNode,u=s.memoizedProps;try{for(var p=s.type,j=r.attributes;j.length;)r.removeAttributeNode(j[0]);Gn(r,p,u),r[Ze]=s,r[ht]=u}catch(N){cn(s,s.return,N)}}var ji=!1,_n=!1,vp=!1,Cb=typeof WeakSet=="function"?WeakSet:Set,Bn=null;function sk(s,r){if(s=s.containerInfo,Vp=th,s=ud(s),di(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{u=(u=s.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var j=p.anchorOffset,N=p.focusNode;p=p.focusOffset;try{u.nodeType,N.nodeType}catch{u=null;break e}var $=0,X=-1,he=-1,ze=0,Ve=0,Ke=s,$e=null;t:for(;;){for(var Be;Ke!==u||j!==0&&Ke.nodeType!==3||(X=$+j),Ke!==N||p!==0&&Ke.nodeType!==3||(he=$+p),Ke.nodeType===3&&($+=Ke.nodeValue.length),(Be=Ke.firstChild)!==null;)$e=Ke,Ke=Be;for(;;){if(Ke===s)break t;if($e===u&&++ze===j&&(X=$),$e===N&&++Ve===p&&(he=$),(Be=Ke.nextSibling)!==null)break;Ke=$e,$e=Ke.parentNode}Ke=Be}u=X===-1||he===-1?null:{start:X,end:he}}else u=null}u=u||{start:0,end:0}}else u=null;for(Gp={focusedElem:s,selectionRange:u},th=!1,Bn=r;Bn!==null;)if(r=Bn,s=r.child,(r.subtreeFlags&1024)!==0&&s!==null)s.return=r,Bn=s;else for(;Bn!==null;){switch(r=Bn,N=r.alternate,s=r.flags,r.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&N!==null){s=void 0,u=r,j=N.memoizedProps,N=N.memoizedState,p=u.stateNode;try{var kt=tl(u.type,j,u.elementType===u.type);s=p.getSnapshotBeforeUpdate(kt,N),p.__reactInternalSnapshotBeforeUpdate=s}catch(Nt){cn(u,u.return,Nt)}}break;case 3:if((s&1024)!==0){if(s=r.stateNode.containerInfo,u=s.nodeType,u===9)Jp(s);else if(u===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Jp(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(i(163))}if(s=r.sibling,s!==null){s.return=r.return,Bn=s;break}Bn=r.return}}function _b(s,r,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:Zi(s,u),p&4&&Uc(5,u);break;case 1:if(Zi(s,u),p&4)if(s=u.stateNode,r===null)try{s.componentDidMount()}catch($){cn(u,u.return,$)}else{var j=tl(u.type,r.memoizedProps);r=r.memoizedState;try{s.componentDidUpdate(j,r,s.__reactInternalSnapshotBeforeUpdate)}catch($){cn(u,u.return,$)}}p&64&&vb(u),p&512&&qc(u,u.return);break;case 3:if(Zi(s,u),p&64&&(s=u.updateQueue,s!==null)){if(r=null,u.child!==null)switch(u.child.tag){case 27:case 5:r=u.child.stateNode;break;case 1:r=u.child.stateNode}try{oy(s,r)}catch($){cn(u,u.return,$)}}break;case 27:r===null&&p&4&&kb(u);case 26:case 5:Zi(s,u),r===null&&p&4&&wb(u),p&512&&qc(u,u.return);break;case 12:Zi(s,u);break;case 13:Zi(s,u),p&4&&Tb(s,u),p&64&&(s=u.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(u=mk.bind(null,u),Ak(s,u))));break;case 22:if(p=u.memoizedState!==null||ji,!p){r=r!==null&&r.memoizedState!==null||_n,j=ji;var N=_n;ji=p,(_n=r)&&!N?er(s,u,(u.subtreeFlags&8772)!==0):Zi(s,u),ji=j,_n=N}break;case 30:break;default:Zi(s,u)}}function Db(s){var r=s.alternate;r!==null&&(s.alternate=null,Db(r)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(r=s.stateNode,r!==null&&Ds(r)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var xn=null,ba=!1;function vi(s,r,u){for(u=u.child;u!==null;)Eb(s,r,u),u=u.sibling}function Eb(s,r,u){if(ne&&typeof ne.onCommitFiberUnmount=="function")try{ne.onCommitFiberUnmount(L,u)}catch{}switch(u.tag){case 26:_n||Ms(u,r),vi(s,r,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:_n||Ms(u,r);var p=xn,j=ba;rr(u.type)&&(xn=u.stateNode,ba=!1),vi(s,r,u),Xc(u.stateNode),xn=p,ba=j;break;case 5:_n||Ms(u,r);case 6:if(p=xn,j=ba,xn=null,vi(s,r,u),xn=p,ba=j,xn!==null)if(ba)try{(xn.nodeType===9?xn.body:xn.nodeName==="HTML"?xn.ownerDocument.body:xn).removeChild(u.stateNode)}catch(N){cn(u,r,N)}else try{xn.removeChild(u.stateNode)}catch(N){cn(u,r,N)}break;case 18:xn!==null&&(ba?(s=xn,xj(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,u.stateNode),ru(s)):xj(xn,u.stateNode));break;case 4:p=xn,j=ba,xn=u.stateNode.containerInfo,ba=!0,vi(s,r,u),xn=p,ba=j;break;case 0:case 11:case 14:case 15:_n||Xi(2,u,r),_n||Xi(4,u,r),vi(s,r,u);break;case 1:_n||(Ms(u,r),p=u.stateNode,typeof p.componentWillUnmount=="function"&&Nb(u,r,p)),vi(s,r,u);break;case 21:vi(s,r,u);break;case 22:_n=(p=_n)||u.memoizedState!==null,vi(s,r,u),_n=p;break;default:vi(s,r,u)}}function Tb(s,r){if(r.memoizedState===null&&(s=r.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{ru(s)}catch(u){cn(r,r.return,u)}}function ik(s){switch(s.tag){case 13:case 19:var r=s.stateNode;return r===null&&(r=s.stateNode=new Cb),r;case 22:return s=s.stateNode,r=s._retryCache,r===null&&(r=s._retryCache=new Cb),r;default:throw Error(i(435,s.tag))}}function Np(s,r){var u=ik(s);r.forEach(function(p){var j=pk.bind(null,s,p);u.has(p)||(u.add(p),p.then(j,j))})}function za(s,r){var u=r.deletions;if(u!==null)for(var p=0;p<u.length;p++){var j=u[p],N=s,$=r,X=$;e:for(;X!==null;){switch(X.tag){case 27:if(rr(X.type)){xn=X.stateNode,ba=!1;break e}break;case 5:xn=X.stateNode,ba=!1;break e;case 3:case 4:xn=X.stateNode.containerInfo,ba=!0;break e}X=X.return}if(xn===null)throw Error(i(160));Eb(N,$,j),xn=null,ba=!1,N=j.alternate,N!==null&&(N.return=null),j.return=null}if(r.subtreeFlags&13878)for(r=r.child;r!==null;)Ab(r,s),r=r.sibling}var gs=null;function Ab(s,r){var u=s.alternate,p=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:za(r,s),Fa(s),p&4&&(Xi(3,s,s.return),Uc(3,s),Xi(5,s,s.return));break;case 1:za(r,s),Fa(s),p&512&&(_n||u===null||Ms(u,u.return)),p&64&&ji&&(s=s.updateQueue,s!==null&&(p=s.callbacks,p!==null&&(u=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var j=gs;if(za(r,s),Fa(s),p&512&&(_n||u===null||Ms(u,u.return)),p&4){var N=u!==null?u.memoizedState:null;if(p=s.memoizedState,u===null)if(p===null)if(s.stateNode===null){e:{p=s.type,u=s.memoizedProps,j=j.ownerDocument||j;t:switch(p){case"title":N=j.getElementsByTagName("title")[0],(!N||N[On]||N[Ze]||N.namespaceURI==="http://www.w3.org/2000/svg"||N.hasAttribute("itemprop"))&&(N=j.createElement(p),j.head.insertBefore(N,j.querySelector("head > title"))),Gn(N,p,u),N[Ze]=s,jn(N),p=N;break e;case"link":var $=kj("link","href",j).get(p+(u.href||""));if($){for(var X=0;X<$.length;X++)if(N=$[X],N.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&N.getAttribute("rel")===(u.rel==null?null:u.rel)&&N.getAttribute("title")===(u.title==null?null:u.title)&&N.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){$.splice(X,1);break t}}N=j.createElement(p),Gn(N,p,u),j.head.appendChild(N);break;case"meta":if($=kj("meta","content",j).get(p+(u.content||""))){for(X=0;X<$.length;X++)if(N=$[X],N.getAttribute("content")===(u.content==null?null:""+u.content)&&N.getAttribute("name")===(u.name==null?null:u.name)&&N.getAttribute("property")===(u.property==null?null:u.property)&&N.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&N.getAttribute("charset")===(u.charSet==null?null:u.charSet)){$.splice(X,1);break t}}N=j.createElement(p),Gn(N,p,u),j.head.appendChild(N);break;default:throw Error(i(468,p))}N[Ze]=s,jn(N),p=N}s.stateNode=p}else Cj(j,s.type,s.stateNode);else s.stateNode=Sj(j,p,s.memoizedProps);else N!==p?(N===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):N.count--,p===null?Cj(j,s.type,s.stateNode):Sj(j,p,s.memoizedProps)):p===null&&s.stateNode!==null&&yp(s,s.memoizedProps,u.memoizedProps)}break;case 27:za(r,s),Fa(s),p&512&&(_n||u===null||Ms(u,u.return)),u!==null&&p&4&&yp(s,s.memoizedProps,u.memoizedProps);break;case 5:if(za(r,s),Fa(s),p&512&&(_n||u===null||Ms(u,u.return)),s.flags&32){j=s.stateNode;try{Ka(j,"")}catch(Be){cn(s,s.return,Be)}}p&4&&s.stateNode!=null&&(j=s.memoizedProps,yp(s,j,u!==null?u.memoizedProps:j)),p&1024&&(vp=!0);break;case 6:if(za(r,s),Fa(s),p&4){if(s.stateNode===null)throw Error(i(162));p=s.memoizedProps,u=s.stateNode;try{u.nodeValue=p}catch(Be){cn(s,s.return,Be)}}break;case 3:if(Xd=null,j=gs,gs=Kd(r.containerInfo),za(r,s),gs=j,Fa(s),p&4&&u!==null&&u.memoizedState.isDehydrated)try{ru(r.containerInfo)}catch(Be){cn(s,s.return,Be)}vp&&(vp=!1,Pb(s));break;case 4:p=gs,gs=Kd(s.stateNode.containerInfo),za(r,s),Fa(s),gs=p;break;case 12:za(r,s),Fa(s);break;case 13:za(r,s),Fa(s),s.child.flags&8192&&s.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(Dp=ce()),p&4&&(p=s.updateQueue,p!==null&&(s.updateQueue=null,Np(s,p)));break;case 22:j=s.memoizedState!==null;var he=u!==null&&u.memoizedState!==null,ze=ji,Ve=_n;if(ji=ze||j,_n=Ve||he,za(r,s),_n=Ve,ji=ze,Fa(s),p&8192)e:for(r=s.stateNode,r._visibility=j?r._visibility&-2:r._visibility|1,j&&(u===null||he||ji||_n||nl(s)),u=null,r=s;;){if(r.tag===5||r.tag===26){if(u===null){he=u=r;try{if(N=he.stateNode,j)$=N.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none";else{X=he.stateNode;var Ke=he.memoizedProps.style,$e=Ke!=null&&Ke.hasOwnProperty("display")?Ke.display:null;X.style.display=$e==null||typeof $e=="boolean"?"":(""+$e).trim()}}catch(Be){cn(he,he.return,Be)}}}else if(r.tag===6){if(u===null){he=r;try{he.stateNode.nodeValue=j?"":he.memoizedProps}catch(Be){cn(he,he.return,Be)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===s)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;u===r&&(u=null),r=r.return}u===r&&(u=null),r.sibling.return=r.return,r=r.sibling}p&4&&(p=s.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Np(s,u))));break;case 19:za(r,s),Fa(s),p&4&&(p=s.updateQueue,p!==null&&(s.updateQueue=null,Np(s,p)));break;case 30:break;case 21:break;default:za(r,s),Fa(s)}}function Fa(s){var r=s.flags;if(r&2){try{for(var u,p=s.return;p!==null;){if(Sb(p)){u=p;break}p=p.return}if(u==null)throw Error(i(160));switch(u.tag){case 27:var j=u.stateNode,N=bp(s);Fd(s,N,j);break;case 5:var $=u.stateNode;u.flags&32&&(Ka($,""),u.flags&=-33);var X=bp(s);Fd(s,X,$);break;case 3:case 4:var he=u.stateNode.containerInfo,ze=bp(s);jp(s,ze,he);break;default:throw Error(i(161))}}catch(Ve){cn(s,s.return,Ve)}s.flags&=-3}r&4096&&(s.flags&=-4097)}function Pb(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var r=s;Pb(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),s=s.sibling}}function Zi(s,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)_b(s,r.alternate,r),r=r.sibling}function nl(s){for(s=s.child;s!==null;){var r=s;switch(r.tag){case 0:case 11:case 14:case 15:Xi(4,r,r.return),nl(r);break;case 1:Ms(r,r.return);var u=r.stateNode;typeof u.componentWillUnmount=="function"&&Nb(r,r.return,u),nl(r);break;case 27:Xc(r.stateNode);case 26:case 5:Ms(r,r.return),nl(r);break;case 22:r.memoizedState===null&&nl(r);break;case 30:nl(r);break;default:nl(r)}s=s.sibling}}function er(s,r,u){for(u=u&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var p=r.alternate,j=s,N=r,$=N.flags;switch(N.tag){case 0:case 11:case 15:er(j,N,u),Uc(4,N);break;case 1:if(er(j,N,u),p=N,j=p.stateNode,typeof j.componentDidMount=="function")try{j.componentDidMount()}catch(ze){cn(p,p.return,ze)}if(p=N,j=p.updateQueue,j!==null){var X=p.stateNode;try{var he=j.shared.hiddenCallbacks;if(he!==null)for(j.shared.hiddenCallbacks=null,j=0;j<he.length;j++)ly(he[j],X)}catch(ze){cn(p,p.return,ze)}}u&&$&64&&vb(N),qc(N,N.return);break;case 27:kb(N);case 26:case 5:er(j,N,u),u&&p===null&&$&4&&wb(N),qc(N,N.return);break;case 12:er(j,N,u);break;case 13:er(j,N,u),u&&$&4&&Tb(j,N);break;case 22:N.memoizedState===null&&er(j,N,u),qc(N,N.return);break;case 30:break;default:er(j,N,u)}r=r.sibling}}function wp(s,r){var u=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),s=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(s=r.memoizedState.cachePool.pool),s!==u&&(s!=null&&s.refCount++,u!=null&&Dc(u))}function Sp(s,r){s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Dc(s))}function Bs(s,r,u,p){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Rb(s,r,u,p),r=r.sibling}function Rb(s,r,u,p){var j=r.flags;switch(r.tag){case 0:case 11:case 15:Bs(s,r,u,p),j&2048&&Uc(9,r);break;case 1:Bs(s,r,u,p);break;case 3:Bs(s,r,u,p),j&2048&&(s=null,r.alternate!==null&&(s=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==s&&(r.refCount++,s!=null&&Dc(s)));break;case 12:if(j&2048){Bs(s,r,u,p),s=r.stateNode;try{var N=r.memoizedProps,$=N.id,X=N.onPostCommit;typeof X=="function"&&X($,r.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(he){cn(r,r.return,he)}}else Bs(s,r,u,p);break;case 13:Bs(s,r,u,p);break;case 23:break;case 22:N=r.stateNode,$=r.alternate,r.memoizedState!==null?N._visibility&2?Bs(s,r,u,p):Hc(s,r):N._visibility&2?Bs(s,r,u,p):(N._visibility|=2,ao(s,r,u,p,(r.subtreeFlags&10256)!==0)),j&2048&&wp($,r);break;case 24:Bs(s,r,u,p),j&2048&&Sp(r.alternate,r);break;default:Bs(s,r,u,p)}}function ao(s,r,u,p,j){for(j=j&&(r.subtreeFlags&10256)!==0,r=r.child;r!==null;){var N=s,$=r,X=u,he=p,ze=$.flags;switch($.tag){case 0:case 11:case 15:ao(N,$,X,he,j),Uc(8,$);break;case 23:break;case 22:var Ve=$.stateNode;$.memoizedState!==null?Ve._visibility&2?ao(N,$,X,he,j):Hc(N,$):(Ve._visibility|=2,ao(N,$,X,he,j)),j&&ze&2048&&wp($.alternate,$);break;case 24:ao(N,$,X,he,j),j&&ze&2048&&Sp($.alternate,$);break;default:ao(N,$,X,he,j)}r=r.sibling}}function Hc(s,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var u=s,p=r,j=p.flags;switch(p.tag){case 22:Hc(u,p),j&2048&&wp(p.alternate,p);break;case 24:Hc(u,p),j&2048&&Sp(p.alternate,p);break;default:Hc(u,p)}r=r.sibling}}var Vc=8192;function so(s){if(s.subtreeFlags&Vc)for(s=s.child;s!==null;)Ob(s),s=s.sibling}function Ob(s){switch(s.tag){case 26:so(s),s.flags&Vc&&s.memoizedState!==null&&Hk(gs,s.memoizedState,s.memoizedProps);break;case 5:so(s);break;case 3:case 4:var r=gs;gs=Kd(s.stateNode.containerInfo),so(s),gs=r;break;case 22:s.memoizedState===null&&(r=s.alternate,r!==null&&r.memoizedState!==null?(r=Vc,Vc=16777216,so(s),Vc=r):so(s));break;default:so(s)}}function Ib(s){var r=s.alternate;if(r!==null&&(s=r.child,s!==null)){r.child=null;do r=s.sibling,s.sibling=null,s=r;while(s!==null)}}function Gc(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var p=r[u];Bn=p,Fb(p,s)}Ib(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)zb(s),s=s.sibling}function zb(s){switch(s.tag){case 0:case 11:case 15:Gc(s),s.flags&2048&&Xi(9,s,s.return);break;case 3:Gc(s);break;case 12:Gc(s);break;case 22:var r=s.stateNode;s.memoizedState!==null&&r._visibility&2&&(s.return===null||s.return.tag!==13)?(r._visibility&=-3,Ld(s)):Gc(s);break;default:Gc(s)}}function Ld(s){var r=s.deletions;if((s.flags&16)!==0){if(r!==null)for(var u=0;u<r.length;u++){var p=r[u];Bn=p,Fb(p,s)}Ib(s)}for(s=s.child;s!==null;){switch(r=s,r.tag){case 0:case 11:case 15:Xi(8,r,r.return),Ld(r);break;case 22:u=r.stateNode,u._visibility&2&&(u._visibility&=-3,Ld(r));break;default:Ld(r)}s=s.sibling}}function Fb(s,r){for(;Bn!==null;){var u=Bn;switch(u.tag){case 0:case 11:case 15:Xi(8,u,r);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Dc(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,Bn=p;else e:for(u=s;Bn!==null;){p=Bn;var j=p.sibling,N=p.return;if(Db(p),p===u){Bn=null;break e}if(j!==null){j.return=N,Bn=j;break e}Bn=N}}}var rk={getCacheForType:function(s){var r=Jn(In),u=r.data.get(s);return u===void 0&&(u=s(),r.data.set(s,u)),u}},lk=typeof WeakMap=="function"?WeakMap:Map,en=0,dn=null,$t=null,Vt=0,tn=0,La=null,tr=!1,io=!1,kp=!1,Ni=0,wn=0,nr=0,al=0,Cp=0,ss=0,ro=0,Qc=null,ja=null,_p=!1,Dp=0,$d=1/0,Md=null,ar=null,Vn=0,sr=null,lo=null,oo=0,Ep=0,Tp=null,Lb=null,Yc=0,Ap=null;function $a(){if((en&2)!==0&&Vt!==0)return Vt&-Vt;if(I.T!==null){var s=Jl;return s!==0?s:Lp()}return At()}function $b(){ss===0&&(ss=(Vt&536870912)===0||zt?Me():536870912);var s=as.current;return s!==null&&(s.flags|=32),ss}function Ma(s,r,u){(s===dn&&(tn===2||tn===9)||s.cancelPendingCommit!==null)&&(co(s,0),ir(s,Vt,ss,!1)),te(s,u),((en&2)===0||s!==dn)&&(s===dn&&((en&2)===0&&(al|=u),wn===4&&ir(s,Vt,ss,!1)),Us(s))}function Mb(s,r,u){if((en&6)!==0)throw Error(i(327));var p=!u&&(r&124)===0&&(r&s.expiredLanes)===0||je(s,r),j=p?uk(s,r):Op(s,r,!0),N=p;do{if(j===0){io&&!p&&ir(s,r,0,!1);break}else{if(u=s.current.alternate,N&&!ok(u)){j=Op(s,r,!1),N=!1;continue}if(j===2){if(N=r,s.errorRecoveryDisabledLanes&N)var $=0;else $=s.pendingLanes&-536870913,$=$!==0?$:$&536870912?536870912:0;if($!==0){r=$;e:{var X=s;j=Qc;var he=X.current.memoizedState.isDehydrated;if(he&&(co(X,$).flags|=256),$=Op(X,$,!1),$!==2){if(kp&&!he){X.errorRecoveryDisabledLanes|=N,al|=N,j=4;break e}N=ja,ja=j,N!==null&&(ja===null?ja=N:ja.push.apply(ja,N))}j=$}if(N=!1,j!==2)continue}}if(j===1){co(s,0),ir(s,r,0,!0);break}e:{switch(p=s,N=j,N){case 0:case 1:throw Error(i(345));case 4:if((r&4194048)!==r)break;case 6:ir(p,r,ss,!tr);break e;case 2:ja=null;break;case 3:case 5:break;default:throw Error(i(329))}if((r&62914560)===r&&(j=Dp+300-ce(),10<j)){if(ir(p,r,ss,!tr),ue(p,0,!0)!==0)break e;p.timeoutHandle=fj(Bb.bind(null,p,u,ja,Md,_p,r,ss,al,ro,tr,N,2,-0,0),j);break e}Bb(p,u,ja,Md,_p,r,ss,al,ro,tr,N,0,-0,0)}}break}while(!0);Us(s)}function Bb(s,r,u,p,j,N,$,X,he,ze,Ve,Ke,$e,Be){if(s.timeoutHandle=-1,Ke=r.subtreeFlags,(Ke&8192||(Ke&16785408)===16785408)&&(tu={stylesheets:null,count:0,unsuspend:qk},Ob(r),Ke=Vk(),Ke!==null)){s.cancelPendingCommit=Ke(Yb.bind(null,s,r,N,u,p,j,$,X,he,Ve,1,$e,Be)),ir(s,N,$,!ze);return}Yb(s,r,N,u,p,j,$,X,he)}function ok(s){for(var r=s;;){var u=r.tag;if((u===0||u===11||u===15)&&r.flags&16384&&(u=r.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var j=u[p],N=j.getSnapshot;j=j.value;try{if(!sa(N(),j))return!1}catch{return!1}}if(u=r.child,r.subtreeFlags&16384&&u!==null)u.return=r,r=u;else{if(r===s)break;for(;r.sibling===null;){if(r.return===null||r.return===s)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function ir(s,r,u,p){r&=~Cp,r&=~al,s.suspendedLanes|=r,s.pingedLanes&=~r,p&&(s.warmLanes|=r),p=s.expirationTimes;for(var j=r;0<j;){var N=31-ae(j),$=1<<N;p[N]=-1,j&=~$}u!==0&&lt(s,u,r)}function Bd(){return(en&6)===0?(Jc(0),!1):!0}function Pp(){if($t!==null){if(tn===0)var s=$t.return;else s=$t,pi=Wr=null,Jm(s),to=null,$c=0,s=$t;for(;s!==null;)jb(s.alternate,s),s=s.return;$t=null}}function co(s,r){var u=s.timeoutHandle;u!==-1&&(s.timeoutHandle=-1,Ck(u)),u=s.cancelPendingCommit,u!==null&&(s.cancelPendingCommit=null,u()),Pp(),dn=s,$t=u=fs(s.current,null),Vt=r,tn=0,La=null,tr=!1,io=je(s,r),kp=!1,ro=ss=Cp=al=nr=wn=0,ja=Qc=null,_p=!1,(r&8)!==0&&(r|=r&32);var p=s.entangledLanes;if(p!==0)for(s=s.entanglements,p&=r;0<p;){var j=31-ae(p),N=1<<j;r|=s[j],p&=~N}return Ni=r,Vl(),u}function Ub(s,r){Ft=null,I.H=Dd,r===Tc||r===yd?(r=iy(),tn=3):r===ny?(r=iy(),tn=4):tn=r===rb?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,La=r,$t===null&&(wn=1,Rd(s,ga(r,s.current)))}function qb(){var s=I.H;return I.H=Dd,s===null?Dd:s}function Hb(){var s=I.A;return I.A=rk,s}function Rp(){wn=4,tr||(Vt&4194048)!==Vt&&as.current!==null||(io=!0),(nr&134217727)===0&&(al&134217727)===0||dn===null||ir(dn,Vt,ss,!1)}function Op(s,r,u){var p=en;en|=2;var j=qb(),N=Hb();(dn!==s||Vt!==r)&&(Md=null,co(s,r)),r=!1;var $=wn;e:do try{if(tn!==0&&$t!==null){var X=$t,he=La;switch(tn){case 8:Pp(),$=6;break e;case 3:case 2:case 9:case 6:as.current===null&&(r=!0);var ze=tn;if(tn=0,La=null,uo(s,X,he,ze),u&&io){$=0;break e}break;default:ze=tn,tn=0,La=null,uo(s,X,he,ze)}}ck(),$=wn;break}catch(Ve){Ub(s,Ve)}while(!0);return r&&s.shellSuspendCounter++,pi=Wr=null,en=p,I.H=j,I.A=N,$t===null&&(dn=null,Vt=0,Vl()),$}function ck(){for(;$t!==null;)Vb($t)}function uk(s,r){var u=en;en|=2;var p=qb(),j=Hb();dn!==s||Vt!==r?(Md=null,$d=ce()+500,co(s,r)):io=je(s,r);e:do try{if(tn!==0&&$t!==null){r=$t;var N=La;t:switch(tn){case 1:tn=0,La=null,uo(s,r,N,1);break;case 2:case 9:if(ay(N)){tn=0,La=null,Gb(r);break}r=function(){tn!==2&&tn!==9||dn!==s||(tn=7),Us(s)},N.then(r,r);break e;case 3:tn=7;break e;case 4:tn=5;break e;case 7:ay(N)?(tn=0,La=null,Gb(r)):(tn=0,La=null,uo(s,r,N,7));break;case 5:var $=null;switch($t.tag){case 26:$=$t.memoizedState;case 5:case 27:var X=$t;if(!$||_j($)){tn=0,La=null;var he=X.sibling;if(he!==null)$t=he;else{var ze=X.return;ze!==null?($t=ze,Ud(ze)):$t=null}break t}}tn=0,La=null,uo(s,r,N,5);break;case 6:tn=0,La=null,uo(s,r,N,6);break;case 8:Pp(),wn=6;break e;default:throw Error(i(462))}}dk();break}catch(Ve){Ub(s,Ve)}while(!0);return pi=Wr=null,I.H=p,I.A=j,en=u,$t!==null?0:(dn=null,Vt=0,Vl(),wn)}function dk(){for(;$t!==null&&!Y();)Vb($t)}function Vb(s){var r=yb(s.alternate,s,Ni);s.memoizedProps=s.pendingProps,r===null?Ud(s):$t=r}function Gb(s){var r=s,u=r.alternate;switch(r.tag){case 15:case 0:r=hb(u,r,r.pendingProps,r.type,void 0,Vt);break;case 11:r=hb(u,r,r.pendingProps,r.type.render,r.ref,Vt);break;case 5:Jm(r);default:jb(u,r),r=$t=pd(r,Ni),r=yb(u,r,Ni)}s.memoizedProps=s.pendingProps,r===null?Ud(s):$t=r}function uo(s,r,u,p){pi=Wr=null,Jm(r),to=null,$c=0;var j=r.return;try{if(ek(s,j,r,u,Vt)){wn=1,Rd(s,ga(u,s.current)),$t=null;return}}catch(N){if(j!==null)throw $t=j,N;wn=1,Rd(s,ga(u,s.current)),$t=null;return}r.flags&32768?(zt||p===1?s=!0:io||(Vt&536870912)!==0?s=!1:(tr=s=!0,(p===2||p===9||p===3||p===6)&&(p=as.current,p!==null&&p.tag===13&&(p.flags|=16384))),Qb(r,s)):Ud(r)}function Ud(s){var r=s;do{if((r.flags&32768)!==0){Qb(r,tr);return}s=r.return;var u=nk(r.alternate,r,Ni);if(u!==null){$t=u;return}if(r=r.sibling,r!==null){$t=r;return}$t=r=s}while(r!==null);wn===0&&(wn=5)}function Qb(s,r){do{var u=ak(s.alternate,s);if(u!==null){u.flags&=32767,$t=u;return}if(u=s.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!r&&(s=s.sibling,s!==null)){$t=s;return}$t=s=u}while(s!==null);wn=6,$t=null}function Yb(s,r,u,p,j,N,$,X,he){s.cancelPendingCommit=null;do qd();while(Vn!==0);if((en&6)!==0)throw Error(i(327));if(r!==null){if(r===s.current)throw Error(i(177));if(N=r.lanes|r.childLanes,N|=xa,Re(s,u,N,$,X,he),s===dn&&($t=dn=null,Vt=0),lo=r,sr=s,oo=u,Ep=N,Tp=j,Lb=p,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,fk(st,function(){return Zb(),null})):(s.callbackNode=null,s.callbackPriority=0),p=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||p){p=I.T,I.T=null,j=V.p,V.p=2,$=en,en|=4;try{sk(s,r,u)}finally{en=$,V.p=j,I.T=p}}Vn=1,Jb(),Kb(),Wb()}}function Jb(){if(Vn===1){Vn=0;var s=sr,r=lo,u=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||u){u=I.T,I.T=null;var p=V.p;V.p=2;var j=en;en|=4;try{Ab(r,s);var N=Gp,$=ud(s.containerInfo),X=N.focusedElem,he=N.selectionRange;if($!==X&&X&&X.ownerDocument&&Ul(X.ownerDocument.documentElement,X)){if(he!==null&&di(X)){var ze=he.start,Ve=he.end;if(Ve===void 0&&(Ve=ze),"selectionStart"in X)X.selectionStart=ze,X.selectionEnd=Math.min(Ve,X.value.length);else{var Ke=X.ownerDocument||document,$e=Ke&&Ke.defaultView||window;if($e.getSelection){var Be=$e.getSelection(),kt=X.textContent.length,Nt=Math.min(he.start,kt),rn=he.end===void 0?Nt:Math.min(he.end,kt);!Be.extend&&Nt>rn&&($=rn,rn=Nt,Nt=$);var Te=cd(X,Nt),ye=cd(X,rn);if(Te&&ye&&(Be.rangeCount!==1||Be.anchorNode!==Te.node||Be.anchorOffset!==Te.offset||Be.focusNode!==ye.node||Be.focusOffset!==ye.offset)){var Ie=Ke.createRange();Ie.setStart(Te.node,Te.offset),Be.removeAllRanges(),Nt>rn?(Be.addRange(Ie),Be.extend(ye.node,ye.offset)):(Ie.setEnd(ye.node,ye.offset),Be.addRange(Ie))}}}}for(Ke=[],Be=X;Be=Be.parentNode;)Be.nodeType===1&&Ke.push({element:Be,left:Be.scrollLeft,top:Be.scrollTop});for(typeof X.focus=="function"&&X.focus(),X=0;X<Ke.length;X++){var Qe=Ke[X];Qe.element.scrollLeft=Qe.left,Qe.element.scrollTop=Qe.top}}th=!!Vp,Gp=Vp=null}finally{en=j,V.p=p,I.T=u}}s.current=r,Vn=2}}function Kb(){if(Vn===2){Vn=0;var s=sr,r=lo,u=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||u){u=I.T,I.T=null;var p=V.p;V.p=2;var j=en;en|=4;try{_b(s,r.alternate,r)}finally{en=j,V.p=p,I.T=u}}Vn=3}}function Wb(){if(Vn===4||Vn===3){Vn=0,ie();var s=sr,r=lo,u=oo,p=Lb;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?Vn=5:(Vn=0,lo=sr=null,Xb(s,s.pendingLanes));var j=s.pendingLanes;if(j===0&&(ar=null),jt(u),r=r.stateNode,ne&&typeof ne.onCommitFiberRoot=="function")try{ne.onCommitFiberRoot(L,r,void 0,(r.current.flags&128)===128)}catch{}if(p!==null){r=I.T,j=V.p,V.p=2,I.T=null;try{for(var N=s.onRecoverableError,$=0;$<p.length;$++){var X=p[$];N(X.value,{componentStack:X.stack})}}finally{I.T=r,V.p=j}}(oo&3)!==0&&qd(),Us(s),j=s.pendingLanes,(u&4194090)!==0&&(j&42)!==0?s===Ap?Yc++:(Yc=0,Ap=s):Yc=0,Jc(0)}}function Xb(s,r){(s.pooledCacheLanes&=r)===0&&(r=s.pooledCache,r!=null&&(s.pooledCache=null,Dc(r)))}function qd(s){return Jb(),Kb(),Wb(),Zb()}function Zb(){if(Vn!==5)return!1;var s=sr,r=Ep;Ep=0;var u=jt(oo),p=I.T,j=V.p;try{V.p=32>u?32:u,I.T=null,u=Tp,Tp=null;var N=sr,$=oo;if(Vn=0,lo=sr=null,oo=0,(en&6)!==0)throw Error(i(331));var X=en;if(en|=4,zb(N.current),Rb(N,N.current,$,u),en=X,Jc(0,!1),ne&&typeof ne.onPostCommitFiberRoot=="function")try{ne.onPostCommitFiberRoot(L,N)}catch{}return!0}finally{V.p=j,I.T=p,Xb(s,r)}}function ej(s,r,u){r=ga(u,r),r=cp(s.stateNode,r,2),s=Yi(s,r,2),s!==null&&(te(s,2),Us(s))}function cn(s,r,u){if(s.tag===3)ej(s,s,u);else for(;r!==null;){if(r.tag===3){ej(r,s,u);break}else if(r.tag===1){var p=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ar===null||!ar.has(p))){s=ga(u,s),u=sb(2),p=Yi(r,u,2),p!==null&&(ib(u,p,r,s),te(p,2),Us(p));break}}r=r.return}}function Ip(s,r,u){var p=s.pingCache;if(p===null){p=s.pingCache=new lk;var j=new Set;p.set(r,j)}else j=p.get(r),j===void 0&&(j=new Set,p.set(r,j));j.has(u)||(kp=!0,j.add(u),s=hk.bind(null,s,r,u),r.then(s,s))}function hk(s,r,u){var p=s.pingCache;p!==null&&p.delete(r),s.pingedLanes|=s.suspendedLanes&u,s.warmLanes&=~u,dn===s&&(Vt&u)===u&&(wn===4||wn===3&&(Vt&62914560)===Vt&&300>ce()-Dp?(en&2)===0&&co(s,0):Cp|=u,ro===Vt&&(ro=0)),Us(s)}function tj(s,r){r===0&&(r=De()),s=Ui(s,r),s!==null&&(te(s,r),Us(s))}function mk(s){var r=s.memoizedState,u=0;r!==null&&(u=r.retryLane),tj(s,u)}function pk(s,r){var u=0;switch(s.tag){case 13:var p=s.stateNode,j=s.memoizedState;j!==null&&(u=j.retryLane);break;case 19:p=s.stateNode;break;case 22:p=s.stateNode._retryCache;break;default:throw Error(i(314))}p!==null&&p.delete(r),tj(s,u)}function fk(s,r){return q(s,r)}var Hd=null,ho=null,zp=!1,Vd=!1,Fp=!1,sl=0;function Us(s){s!==ho&&s.next===null&&(ho===null?Hd=ho=s:ho=ho.next=s),Vd=!0,zp||(zp=!0,xk())}function Jc(s,r){if(!Fp&&Vd){Fp=!0;do for(var u=!1,p=Hd;p!==null;){if(s!==0){var j=p.pendingLanes;if(j===0)var N=0;else{var $=p.suspendedLanes,X=p.pingedLanes;N=(1<<31-ae(42|s)+1)-1,N&=j&~($&~X),N=N&201326741?N&201326741|1:N?N|2:0}N!==0&&(u=!0,ij(p,N))}else N=Vt,N=ue(p,p===dn?N:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(N&3)===0||je(p,N)||(u=!0,ij(p,N));p=p.next}while(u);Fp=!1}}function gk(){nj()}function nj(){Vd=zp=!1;var s=0;sl!==0&&(kk()&&(s=sl),sl=0);for(var r=ce(),u=null,p=Hd;p!==null;){var j=p.next,N=aj(p,r);N===0?(p.next=null,u===null?Hd=j:u.next=j,j===null&&(ho=u)):(u=p,(s!==0||(N&3)!==0)&&(Vd=!0)),p=j}Jc(s)}function aj(s,r){for(var u=s.suspendedLanes,p=s.pingedLanes,j=s.expirationTimes,N=s.pendingLanes&-62914561;0<N;){var $=31-ae(N),X=1<<$,he=j[$];he===-1?((X&u)===0||(X&p)!==0)&&(j[$]=ke(X,r)):he<=r&&(s.expiredLanes|=X),N&=~X}if(r=dn,u=Vt,u=ue(s,s===r?u:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),p=s.callbackNode,u===0||s===r&&(tn===2||tn===9)||s.cancelPendingCommit!==null)return p!==null&&p!==null&&W(p),s.callbackNode=null,s.callbackPriority=0;if((u&3)===0||je(s,u)){if(r=u&-u,r===s.callbackPriority)return r;switch(p!==null&&W(p),jt(u)){case 2:case 8:u=We;break;case 32:u=st;break;case 268435456:u=ve;break;default:u=st}return p=sj.bind(null,s),u=q(u,p),s.callbackPriority=r,s.callbackNode=u,r}return p!==null&&p!==null&&W(p),s.callbackPriority=2,s.callbackNode=null,2}function sj(s,r){if(Vn!==0&&Vn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var u=s.callbackNode;if(qd()&&s.callbackNode!==u)return null;var p=Vt;return p=ue(s,s===dn?p:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),p===0?null:(Mb(s,p,r),aj(s,ce()),s.callbackNode!=null&&s.callbackNode===u?sj.bind(null,s):null)}function ij(s,r){if(qd())return null;Mb(s,r,!0)}function xk(){_k(function(){(en&6)!==0?q(He,gk):nj()})}function Lp(){return sl===0&&(sl=Me()),sl}function rj(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Pi(""+s)}function lj(s,r){var u=r.ownerDocument.createElement("input");return u.name=r.name,u.value=r.value,s.id&&u.setAttribute("form",s.id),r.parentNode.insertBefore(u,r),s=new FormData(s),u.parentNode.removeChild(u),s}function yk(s,r,u,p,j){if(r==="submit"&&u&&u.stateNode===j){var N=rj((j[ht]||null).action),$=p.submitter;$&&(r=(r=$[ht]||null)?rj(r.formAction):$.getAttribute("formAction"),r!==null&&(N=r,$=null));var X=new fa("action","action",null,p,j);s.push({event:X,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(sl!==0){var he=$?lj(j,$):new FormData(j);sp(u,{pending:!0,data:he,method:j.method,action:N},null,he)}}else typeof N=="function"&&(X.preventDefault(),he=$?lj(j,$):new FormData(j),sp(u,{pending:!0,data:he,method:j.method,action:N},N,he))},currentTarget:j}]})}}for(var $p=0;$p<Is.length;$p++){var Mp=Is[$p],bk=Mp.toLowerCase(),jk=Mp[0].toUpperCase()+Mp.slice(1);Ra(bk,"on"+jk)}Ra(dd,"onAnimationEnd"),Ra(jc,"onAnimationIteration"),Ra(vc,"onAnimationStart"),Ra("dblclick","onDoubleClick"),Ra("focusin","onFocus"),Ra("focusout","onBlur"),Ra(_m,"onTransitionRun"),Ra(Dm,"onTransitionStart"),Ra(Em,"onTransitionCancel"),Ra(Nc,"onTransitionEnd"),Ei("onMouseEnter",["mouseout","mouseover"]),Ei("onMouseLeave",["mouseout","mouseover"]),Ei("onPointerEnter",["pointerout","pointerover"]),Ei("onPointerLeave",["pointerout","pointerover"]),ei("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ei("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ei("onBeforeInput",["compositionend","keypress","textInput","paste"]),ei("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ei("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ei("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Kc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vk=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Kc));function oj(s,r){r=(r&4)!==0;for(var u=0;u<s.length;u++){var p=s[u],j=p.event;p=p.listeners;e:{var N=void 0;if(r)for(var $=p.length-1;0<=$;$--){var X=p[$],he=X.instance,ze=X.currentTarget;if(X=X.listener,he!==N&&j.isPropagationStopped())break e;N=X,j.currentTarget=ze;try{N(j)}catch(Ve){Pd(Ve)}j.currentTarget=null,N=he}else for($=0;$<p.length;$++){if(X=p[$],he=X.instance,ze=X.currentTarget,X=X.listener,he!==N&&j.isPropagationStopped())break e;N=X,j.currentTarget=ze;try{N(j)}catch(Ve){Pd(Ve)}j.currentTarget=null,N=he}}}}function Mt(s,r){var u=r[ut];u===void 0&&(u=r[ut]=new Set);var p=s+"__bubble";u.has(p)||(cj(r,s,2,!1),u.add(p))}function Bp(s,r,u){var p=0;r&&(p|=4),cj(u,s,p,r)}var Gd="_reactListening"+Math.random().toString(36).slice(2);function Up(s){if(!s[Gd]){s[Gd]=!0,Hu.forEach(function(u){u!=="selectionchange"&&(vk.has(u)||Bp(u,!1,s),Bp(u,!0,s))});var r=s.nodeType===9?s:s.ownerDocument;r===null||r[Gd]||(r[Gd]=!0,Bp("selectionchange",!1,r))}}function cj(s,r,u,p){switch(Rj(r)){case 2:var j=Yk;break;case 8:j=Jk;break;default:j=nf}u=j.bind(null,r,u,s),j=void 0,!Ii||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(j=!0),p?j!==void 0?s.addEventListener(r,u,{capture:!0,passive:j}):s.addEventListener(r,u,!0):j!==void 0?s.addEventListener(r,u,{passive:j}):s.addEventListener(r,u,!1)}function qp(s,r,u,p,j){var N=p;if((r&1)===0&&(r&2)===0&&p!==null)e:for(;;){if(p===null)return;var $=p.tag;if($===3||$===4){var X=p.stateNode.containerInfo;if(X===j)break;if($===4)for($=p.return;$!==null;){var he=$.tag;if((he===3||he===4)&&$.stateNode.containerInfo===j)return;$=$.return}for(;X!==null;){if($=gn(X),$===null)return;if(he=$.tag,he===5||he===6||he===26||he===27){p=N=$;continue e}X=X.parentNode}}p=p.return}Oi(function(){var ze=N,Ve=zr(u),Ke=[];e:{var $e=hd.get(s);if($e!==void 0){var Be=fa,kt=s;switch(s){case"keypress":if(Fi(u)===0)break e;case"keydown":case"keyup":Be=Ll;break;case"focusin":kt="focus",Be=Ps;break;case"focusout":kt="blur",Be=Ps;break;case"beforeblur":case"afterblur":Be=Ps;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Be=Ol;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Be=$r;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Be=cc;break;case dd:case jc:case vc:Be=zl;break;case Nc:Be=uc;break;case"scroll":case"scrollend":Be=Ku;break;case"wheel":Be=Xt;break;case"copy":case"cut":case"paste":Be=jm;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Be=ed;break;case"toggle":case"beforetoggle":Be=Ml}var Nt=(r&4)!==0,rn=!Nt&&(s==="scroll"||s==="scrollend"),Te=Nt?$e!==null?$e+"Capture":null:$e;Nt=[];for(var ye=ze,Ie;ye!==null;){var Qe=ye;if(Ie=Qe.stateNode,Qe=Qe.tag,Qe!==5&&Qe!==26&&Qe!==27||Ie===null||Te===null||(Qe=Ts(ye,Te),Qe!=null&&Nt.push(Wc(ye,Qe,Ie))),rn)break;ye=ye.return}0<Nt.length&&($e=new Be($e,kt,null,u,Ve),Ke.push({event:$e,listeners:Nt}))}}if((r&7)===0){e:{if($e=s==="mouseover"||s==="pointerover",Be=s==="mouseout"||s==="pointerout",$e&&u!==Tl&&(kt=u.relatedTarget||u.fromElement)&&(gn(kt)||kt[ct]))break e;if((Be||$e)&&($e=Ve.window===Ve?Ve:($e=Ve.ownerDocument)?$e.defaultView||$e.parentWindow:window,Be?(kt=u.relatedTarget||u.toElement,Be=ze,kt=kt?gn(kt):null,kt!==null&&(rn=c(kt),Nt=kt.tag,kt!==rn||Nt!==5&&Nt!==27&&Nt!==6)&&(kt=null)):(Be=null,kt=ze),Be!==kt)){if(Nt=Ol,Qe="onMouseLeave",Te="onMouseEnter",ye="mouse",(s==="pointerout"||s==="pointerover")&&(Nt=ed,Qe="onPointerLeave",Te="onPointerEnter",ye="pointer"),rn=Be==null?$e:Ya(Be),Ie=kt==null?$e:Ya(kt),$e=new Nt(Qe,ye+"leave",Be,u,Ve),$e.target=rn,$e.relatedTarget=Ie,Qe=null,gn(Ve)===ze&&(Nt=new Nt(Te,ye+"enter",kt,u,Ve),Nt.target=Ie,Nt.relatedTarget=rn,Qe=Nt),rn=Qe,Be&&kt)t:{for(Nt=Be,Te=kt,ye=0,Ie=Nt;Ie;Ie=mo(Ie))ye++;for(Ie=0,Qe=Te;Qe;Qe=mo(Qe))Ie++;for(;0<ye-Ie;)Nt=mo(Nt),ye--;for(;0<Ie-ye;)Te=mo(Te),Ie--;for(;ye--;){if(Nt===Te||Te!==null&&Nt===Te.alternate)break t;Nt=mo(Nt),Te=mo(Te)}Nt=null}else Nt=null;Be!==null&&uj(Ke,$e,Be,Nt,!1),kt!==null&&rn!==null&&uj(Ke,rn,kt,Nt,!0)}}e:{if($e=ze?Ya(ze):window,Be=$e.nodeName&&$e.nodeName.toLowerCase(),Be==="select"||Be==="input"&&$e.type==="file")var pt=ci;else if($i($e))if(Mi)pt=ld;else{pt=wm;var Lt=Nm}else Be=$e.nodeName,!Be||Be.toLowerCase()!=="input"||$e.type!=="checkbox"&&$e.type!=="radio"?ze&&El(ze.elementType)&&(pt=ci):pt=Sm;if(pt&&(pt=pt(s,ze))){id(Ke,pt,u,Ve);break e}Lt&&Lt(s,$e,ze),s==="focusout"&&ze&&$e.type==="number"&&ze.memoizedProps.value!=null&&Ai($e,"number",$e.value)}switch(Lt=ze?Ya(ze):window,s){case"focusin":($i(Lt)||Lt.contentEditable==="true")&&(ia=Lt,ts=ze,ra=null);break;case"focusout":ra=ts=ia=null;break;case"mousedown":ql=!0;break;case"contextmenu":case"mouseup":case"dragend":ql=!1,yc(Ke,u,Ve);break;case"selectionchange":if(Cm)break;case"keydown":case"keyup":yc(Ke,u,Ve)}var yt;if(li)e:{switch(s){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else Pa?Bl(s,u)&&(wt="onCompositionEnd"):s==="keydown"&&u.keyCode===229&&(wt="onCompositionStart");wt&&(pc&&u.locale!=="ko"&&(Pa||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&Pa&&(yt=Al()):(Za=Ve,Lr="value"in Za?Za.value:Za.textContent,Pa=!0)),Lt=Qd(ze,wt),0<Lt.length&&(wt=new rc(wt,s,null,u,Ve),Ke.push({event:wt,listeners:Lt}),yt?wt.data=yt:(yt=qr(u),yt!==null&&(wt.data=yt)))),(yt=nd?ad(s,u):vm(s,u))&&(wt=Qd(ze,"onBeforeInput"),0<wt.length&&(Lt=new rc("onBeforeInput","beforeinput",null,u,Ve),Ke.push({event:Lt,listeners:wt}),Lt.data=yt)),yk(Ke,s,ze,u,Ve)}oj(Ke,r)})}function Wc(s,r,u){return{instance:s,listener:r,currentTarget:u}}function Qd(s,r){for(var u=r+"Capture",p=[];s!==null;){var j=s,N=j.stateNode;if(j=j.tag,j!==5&&j!==26&&j!==27||N===null||(j=Ts(s,u),j!=null&&p.unshift(Wc(s,j,N)),j=Ts(s,r),j!=null&&p.push(Wc(s,j,N))),s.tag===3)return p;s=s.return}return[]}function mo(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function uj(s,r,u,p,j){for(var N=r._reactName,$=[];u!==null&&u!==p;){var X=u,he=X.alternate,ze=X.stateNode;if(X=X.tag,he!==null&&he===p)break;X!==5&&X!==26&&X!==27||ze===null||(he=ze,j?(ze=Ts(u,N),ze!=null&&$.unshift(Wc(u,ze,he))):j||(ze=Ts(u,N),ze!=null&&$.push(Wc(u,ze,he)))),u=u.return}$.length!==0&&s.push({event:r,listeners:$})}var Nk=/\r\n?/g,wk=/\u0000|\uFFFD/g;function dj(s){return(typeof s=="string"?s:""+s).replace(Nk,`
`).replace(wk,"")}function hj(s,r){return r=dj(r),dj(s)===r}function Yd(){}function sn(s,r,u,p,j,N){switch(u){case"children":typeof p=="string"?r==="body"||r==="textarea"&&p===""||Ka(s,p):(typeof p=="number"||typeof p=="bigint")&&r!=="body"&&Ka(s,""+p);break;case"className":Ti(s,"class",p);break;case"tabIndex":Ti(s,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":Ti(s,u,p);break;case"style":Wa(s,p,N);break;case"data":if(r!=="object"){Ti(s,"data",p);break}case"src":case"href":if(p===""&&(r!=="a"||u!=="href")){s.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){s.removeAttribute(u);break}p=Pi(""+p),s.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){s.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof N=="function"&&(u==="formAction"?(r!=="input"&&sn(s,r,"name",j.name,j,null),sn(s,r,"formEncType",j.formEncType,j,null),sn(s,r,"formMethod",j.formMethod,j,null),sn(s,r,"formTarget",j.formTarget,j,null)):(sn(s,r,"encType",j.encType,j,null),sn(s,r,"method",j.method,j,null),sn(s,r,"target",j.target,j,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){s.removeAttribute(u);break}p=Pi(""+p),s.setAttribute(u,p);break;case"onClick":p!=null&&(s.onclick=Yd);break;case"onScroll":p!=null&&Mt("scroll",s);break;case"onScrollEnd":p!=null&&Mt("scrollend",s);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(i(61));if(u=p.__html,u!=null){if(j.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"multiple":s.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":s.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){s.removeAttribute("xlink:href");break}u=Pi(""+p),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?s.setAttribute(u,""+p):s.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?s.setAttribute(u,""):s.removeAttribute(u);break;case"capture":case"download":p===!0?s.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?s.setAttribute(u,p):s.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?s.setAttribute(u,p):s.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?s.removeAttribute(u):s.setAttribute(u,p);break;case"popover":Mt("beforetoggle",s),Mt("toggle",s),Sl(s,"popover",p);break;case"xlinkActuate":Dn(s,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Dn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Dn(s,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Dn(s,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Dn(s,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Dn(s,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Dn(s,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Dn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Dn(s,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Sl(s,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=ac.get(u)||u,Sl(s,u,p))}}function Hp(s,r,u,p,j,N){switch(u){case"style":Wa(s,p,N);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(i(61));if(u=p.__html,u!=null){if(j.children!=null)throw Error(i(60));s.innerHTML=u}}break;case"children":typeof p=="string"?Ka(s,p):(typeof p=="number"||typeof p=="bigint")&&Ka(s,""+p);break;case"onScroll":p!=null&&Mt("scroll",s);break;case"onScrollEnd":p!=null&&Mt("scrollend",s);break;case"onClick":p!=null&&(s.onclick=Yd);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Vu.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(j=u.endsWith("Capture"),r=u.slice(2,j?u.length-7:void 0),N=s[ht]||null,N=N!=null?N[u]:null,typeof N=="function"&&s.removeEventListener(r,N,j),typeof p=="function")){typeof N!="function"&&N!==null&&(u in s?s[u]=null:s.hasAttribute(u)&&s.removeAttribute(u)),s.addEventListener(r,p,j);break e}u in s?s[u]=p:p===!0?s.setAttribute(u,""):Sl(s,u,p)}}}function Gn(s,r,u){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Mt("error",s),Mt("load",s);var p=!1,j=!1,N;for(N in u)if(u.hasOwnProperty(N)){var $=u[N];if($!=null)switch(N){case"src":p=!0;break;case"srcSet":j=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:sn(s,r,N,$,u,null)}}j&&sn(s,r,"srcSet",u.srcSet,u,null),p&&sn(s,r,"src",u.src,u,null);return;case"input":Mt("invalid",s);var X=N=$=j=null,he=null,ze=null;for(p in u)if(u.hasOwnProperty(p)){var Ve=u[p];if(Ve!=null)switch(p){case"name":j=Ve;break;case"type":$=Ve;break;case"checked":he=Ve;break;case"defaultChecked":ze=Ve;break;case"value":N=Ve;break;case"defaultValue":X=Ve;break;case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(i(137,r));break;default:sn(s,r,p,Ve,u,null)}}ec(s,N,X,he,ze,$,j,!1),Cl(s);return;case"select":Mt("invalid",s),p=$=N=null;for(j in u)if(u.hasOwnProperty(j)&&(X=u[j],X!=null))switch(j){case"value":N=X;break;case"defaultValue":$=X;break;case"multiple":p=X;default:sn(s,r,j,X,u,null)}r=N,u=$,s.multiple=!!p,r!=null?ai(s,!!p,r,!1):u!=null&&ai(s,!!p,u,!0);return;case"textarea":Mt("invalid",s),N=j=p=null;for($ in u)if(u.hasOwnProperty($)&&(X=u[$],X!=null))switch($){case"value":p=X;break;case"defaultValue":j=X;break;case"children":N=X;break;case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(91));break;default:sn(s,r,$,X,u,null)}tc(s,p,j,N),Cl(s);return;case"option":for(he in u)if(u.hasOwnProperty(he)&&(p=u[he],p!=null))switch(he){case"selected":s.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:sn(s,r,he,p,u,null)}return;case"dialog":Mt("beforetoggle",s),Mt("toggle",s),Mt("cancel",s),Mt("close",s);break;case"iframe":case"object":Mt("load",s);break;case"video":case"audio":for(p=0;p<Kc.length;p++)Mt(Kc[p],s);break;case"image":Mt("error",s),Mt("load",s);break;case"details":Mt("toggle",s);break;case"embed":case"source":case"link":Mt("error",s),Mt("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(ze in u)if(u.hasOwnProperty(ze)&&(p=u[ze],p!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,r));default:sn(s,r,ze,p,u,null)}return;default:if(El(r)){for(Ve in u)u.hasOwnProperty(Ve)&&(p=u[Ve],p!==void 0&&Hp(s,r,Ve,p,u,void 0));return}}for(X in u)u.hasOwnProperty(X)&&(p=u[X],p!=null&&sn(s,r,X,p,u,null))}function Sk(s,r,u,p){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var j=null,N=null,$=null,X=null,he=null,ze=null,Ve=null;for(Be in u){var Ke=u[Be];if(u.hasOwnProperty(Be)&&Ke!=null)switch(Be){case"checked":break;case"value":break;case"defaultValue":he=Ke;default:p.hasOwnProperty(Be)||sn(s,r,Be,null,p,Ke)}}for(var $e in p){var Be=p[$e];if(Ke=u[$e],p.hasOwnProperty($e)&&(Be!=null||Ke!=null))switch($e){case"type":N=Be;break;case"name":j=Be;break;case"checked":ze=Be;break;case"defaultChecked":Ve=Be;break;case"value":$=Be;break;case"defaultValue":X=Be;break;case"children":case"dangerouslySetInnerHTML":if(Be!=null)throw Error(i(137,r));break;default:Be!==Ke&&sn(s,r,$e,Be,p,Ke)}}_l(s,$,X,he,ze,Ve,N,j);return;case"select":Be=$=X=$e=null;for(N in u)if(he=u[N],u.hasOwnProperty(N)&&he!=null)switch(N){case"value":break;case"multiple":Be=he;default:p.hasOwnProperty(N)||sn(s,r,N,null,p,he)}for(j in p)if(N=p[j],he=u[j],p.hasOwnProperty(j)&&(N!=null||he!=null))switch(j){case"value":$e=N;break;case"defaultValue":X=N;break;case"multiple":$=N;default:N!==he&&sn(s,r,j,N,p,he)}r=X,u=$,p=Be,$e!=null?ai(s,!!u,$e,!1):!!p!=!!u&&(r!=null?ai(s,!!u,r,!0):ai(s,!!u,u?[]:"",!1));return;case"textarea":Be=$e=null;for(X in u)if(j=u[X],u.hasOwnProperty(X)&&j!=null&&!p.hasOwnProperty(X))switch(X){case"value":break;case"children":break;default:sn(s,r,X,null,p,j)}for($ in p)if(j=p[$],N=u[$],p.hasOwnProperty($)&&(j!=null||N!=null))switch($){case"value":$e=j;break;case"defaultValue":Be=j;break;case"children":break;case"dangerouslySetInnerHTML":if(j!=null)throw Error(i(91));break;default:j!==N&&sn(s,r,$,j,p,N)}Dl(s,$e,Be);return;case"option":for(var kt in u)if($e=u[kt],u.hasOwnProperty(kt)&&$e!=null&&!p.hasOwnProperty(kt))switch(kt){case"selected":s.selected=!1;break;default:sn(s,r,kt,null,p,$e)}for(he in p)if($e=p[he],Be=u[he],p.hasOwnProperty(he)&&$e!==Be&&($e!=null||Be!=null))switch(he){case"selected":s.selected=$e&&typeof $e!="function"&&typeof $e!="symbol";break;default:sn(s,r,he,$e,p,Be)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Nt in u)$e=u[Nt],u.hasOwnProperty(Nt)&&$e!=null&&!p.hasOwnProperty(Nt)&&sn(s,r,Nt,null,p,$e);for(ze in p)if($e=p[ze],Be=u[ze],p.hasOwnProperty(ze)&&$e!==Be&&($e!=null||Be!=null))switch(ze){case"children":case"dangerouslySetInnerHTML":if($e!=null)throw Error(i(137,r));break;default:sn(s,r,ze,$e,p,Be)}return;default:if(El(r)){for(var rn in u)$e=u[rn],u.hasOwnProperty(rn)&&$e!==void 0&&!p.hasOwnProperty(rn)&&Hp(s,r,rn,void 0,p,$e);for(Ve in p)$e=p[Ve],Be=u[Ve],!p.hasOwnProperty(Ve)||$e===Be||$e===void 0&&Be===void 0||Hp(s,r,Ve,$e,p,Be);return}}for(var Te in u)$e=u[Te],u.hasOwnProperty(Te)&&$e!=null&&!p.hasOwnProperty(Te)&&sn(s,r,Te,null,p,$e);for(Ke in p)$e=p[Ke],Be=u[Ke],!p.hasOwnProperty(Ke)||$e===Be||$e==null&&Be==null||sn(s,r,Ke,$e,p,Be)}var Vp=null,Gp=null;function Jd(s){return s.nodeType===9?s:s.ownerDocument}function mj(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function pj(s,r){if(s===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&r==="foreignObject"?0:s}function Qp(s,r){return s==="textarea"||s==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Yp=null;function kk(){var s=window.event;return s&&s.type==="popstate"?s===Yp?!1:(Yp=s,!0):(Yp=null,!1)}var fj=typeof setTimeout=="function"?setTimeout:void 0,Ck=typeof clearTimeout=="function"?clearTimeout:void 0,gj=typeof Promise=="function"?Promise:void 0,_k=typeof queueMicrotask=="function"?queueMicrotask:typeof gj<"u"?function(s){return gj.resolve(null).then(s).catch(Dk)}:fj;function Dk(s){setTimeout(function(){throw s})}function rr(s){return s==="head"}function xj(s,r){var u=r,p=0,j=0;do{var N=u.nextSibling;if(s.removeChild(u),N&&N.nodeType===8)if(u=N.data,u==="/$"){if(0<p&&8>p){u=p;var $=s.ownerDocument;if(u&1&&Xc($.documentElement),u&2&&Xc($.body),u&4)for(u=$.head,Xc(u),$=u.firstChild;$;){var X=$.nextSibling,he=$.nodeName;$[On]||he==="SCRIPT"||he==="STYLE"||he==="LINK"&&$.rel.toLowerCase()==="stylesheet"||u.removeChild($),$=X}}if(j===0){s.removeChild(N),ru(r);return}j--}else u==="$"||u==="$?"||u==="$!"?j++:p=u.charCodeAt(0)-48;else p=0;u=N}while(u);ru(r)}function Jp(s){var r=s.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var u=r;switch(r=r.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Jp(u),Ds(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}s.removeChild(u)}}function Ek(s,r,u,p){for(;s.nodeType===1;){var j=u;if(s.nodeName.toLowerCase()!==r.toLowerCase()){if(!p&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(p){if(!s[On])switch(r){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(N=s.getAttribute("rel"),N==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(N!==j.rel||s.getAttribute("href")!==(j.href==null||j.href===""?null:j.href)||s.getAttribute("crossorigin")!==(j.crossOrigin==null?null:j.crossOrigin)||s.getAttribute("title")!==(j.title==null?null:j.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(N=s.getAttribute("src"),(N!==(j.src==null?null:j.src)||s.getAttribute("type")!==(j.type==null?null:j.type)||s.getAttribute("crossorigin")!==(j.crossOrigin==null?null:j.crossOrigin))&&N&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(r==="input"&&s.type==="hidden"){var N=j.name==null?null:""+j.name;if(j.type==="hidden"&&s.getAttribute("name")===N)return s}else return s;if(s=xs(s.nextSibling),s===null)break}return null}function Tk(s,r,u){if(r==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!u||(s=xs(s.nextSibling),s===null))return null;return s}function Kp(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function Ak(s,r){var u=s.ownerDocument;if(s.data!=="$?"||u.readyState==="complete")r();else{var p=function(){r(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),s._reactRetry=p}}function xs(s){for(;s!=null;s=s.nextSibling){var r=s.nodeType;if(r===1||r===3)break;if(r===8){if(r=s.data,r==="$"||r==="$!"||r==="$?"||r==="F!"||r==="F")break;if(r==="/$")return null}}return s}var Wp=null;function yj(s){s=s.previousSibling;for(var r=0;s;){if(s.nodeType===8){var u=s.data;if(u==="$"||u==="$!"||u==="$?"){if(r===0)return s;r--}else u==="/$"&&r++}s=s.previousSibling}return null}function bj(s,r,u){switch(r=Jd(u),s){case"html":if(s=r.documentElement,!s)throw Error(i(452));return s;case"head":if(s=r.head,!s)throw Error(i(453));return s;case"body":if(s=r.body,!s)throw Error(i(454));return s;default:throw Error(i(451))}}function Xc(s){for(var r=s.attributes;r.length;)s.removeAttributeNode(r[0]);Ds(s)}var is=new Map,jj=new Set;function Kd(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var wi=V.d;V.d={f:Pk,r:Rk,D:Ok,C:Ik,L:zk,m:Fk,X:$k,S:Lk,M:Mk};function Pk(){var s=wi.f(),r=Bd();return s||r}function Rk(s){var r=Aa(s);r!==null&&r.tag===5&&r.type==="form"?My(r):wi.r(s)}var po=typeof document>"u"?null:document;function vj(s,r,u){var p=po;if(p&&typeof r=="string"&&r){var j=aa(r);j='link[rel="'+s+'"][href="'+j+'"]',typeof u=="string"&&(j+='[crossorigin="'+u+'"]'),jj.has(j)||(jj.add(j),s={rel:s,crossOrigin:u,href:r},p.querySelector(j)===null&&(r=p.createElement("link"),Gn(r,"link",s),jn(r),p.head.appendChild(r)))}}function Ok(s){wi.D(s),vj("dns-prefetch",s,null)}function Ik(s,r){wi.C(s,r),vj("preconnect",s,r)}function zk(s,r,u){wi.L(s,r,u);var p=po;if(p&&s&&r){var j='link[rel="preload"][as="'+aa(r)+'"]';r==="image"&&u&&u.imageSrcSet?(j+='[imagesrcset="'+aa(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(j+='[imagesizes="'+aa(u.imageSizes)+'"]')):j+='[href="'+aa(s)+'"]';var N=j;switch(r){case"style":N=fo(s);break;case"script":N=go(s)}is.has(N)||(s=f({rel:"preload",href:r==="image"&&u&&u.imageSrcSet?void 0:s,as:r},u),is.set(N,s),p.querySelector(j)!==null||r==="style"&&p.querySelector(Zc(N))||r==="script"&&p.querySelector(eu(N))||(r=p.createElement("link"),Gn(r,"link",s),jn(r),p.head.appendChild(r)))}}function Fk(s,r){wi.m(s,r);var u=po;if(u&&s){var p=r&&typeof r.as=="string"?r.as:"script",j='link[rel="modulepreload"][as="'+aa(p)+'"][href="'+aa(s)+'"]',N=j;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":N=go(s)}if(!is.has(N)&&(s=f({rel:"modulepreload",href:s},r),is.set(N,s),u.querySelector(j)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(eu(N)))return}p=u.createElement("link"),Gn(p,"link",s),jn(p),u.head.appendChild(p)}}}function Lk(s,r,u){wi.S(s,r,u);var p=po;if(p&&s){var j=Ja(p).hoistableStyles,N=fo(s);r=r||"default";var $=j.get(N);if(!$){var X={loading:0,preload:null};if($=p.querySelector(Zc(N)))X.loading=5;else{s=f({rel:"stylesheet",href:s,"data-precedence":r},u),(u=is.get(N))&&Xp(s,u);var he=$=p.createElement("link");jn(he),Gn(he,"link",s),he._p=new Promise(function(ze,Ve){he.onload=ze,he.onerror=Ve}),he.addEventListener("load",function(){X.loading|=1}),he.addEventListener("error",function(){X.loading|=2}),X.loading|=4,Wd($,r,p)}$={type:"stylesheet",instance:$,count:1,state:X},j.set(N,$)}}}function $k(s,r){wi.X(s,r);var u=po;if(u&&s){var p=Ja(u).hoistableScripts,j=go(s),N=p.get(j);N||(N=u.querySelector(eu(j)),N||(s=f({src:s,async:!0},r),(r=is.get(j))&&Zp(s,r),N=u.createElement("script"),jn(N),Gn(N,"link",s),u.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},p.set(j,N))}}function Mk(s,r){wi.M(s,r);var u=po;if(u&&s){var p=Ja(u).hoistableScripts,j=go(s),N=p.get(j);N||(N=u.querySelector(eu(j)),N||(s=f({src:s,async:!0,type:"module"},r),(r=is.get(j))&&Zp(s,r),N=u.createElement("script"),jn(N),Gn(N,"link",s),u.head.appendChild(N)),N={type:"script",instance:N,count:1,state:null},p.set(j,N))}}function Nj(s,r,u,p){var j=(j=Pe.current)?Kd(j):null;if(!j)throw Error(i(446));switch(s){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(r=fo(u.href),u=Ja(j).hoistableStyles,p=u.get(r),p||(p={type:"style",instance:null,count:0,state:null},u.set(r,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){s=fo(u.href);var N=Ja(j).hoistableStyles,$=N.get(s);if($||(j=j.ownerDocument||j,$={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},N.set(s,$),(N=j.querySelector(Zc(s)))&&!N._p&&($.instance=N,$.state.loading=5),is.has(s)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},is.set(s,u),N||Bk(j,s,u,$.state))),r&&p===null)throw Error(i(528,""));return $}if(r&&p!==null)throw Error(i(529,""));return null;case"script":return r=u.async,u=u.src,typeof u=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=go(u),u=Ja(j).hoistableScripts,p=u.get(r),p||(p={type:"script",instance:null,count:0,state:null},u.set(r,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,s))}}function fo(s){return'href="'+aa(s)+'"'}function Zc(s){return'link[rel="stylesheet"]['+s+"]"}function wj(s){return f({},s,{"data-precedence":s.precedence,precedence:null})}function Bk(s,r,u,p){s.querySelector('link[rel="preload"][as="style"]['+r+"]")?p.loading=1:(r=s.createElement("link"),p.preload=r,r.addEventListener("load",function(){return p.loading|=1}),r.addEventListener("error",function(){return p.loading|=2}),Gn(r,"link",u),jn(r),s.head.appendChild(r))}function go(s){return'[src="'+aa(s)+'"]'}function eu(s){return"script[async]"+s}function Sj(s,r,u){if(r.count++,r.instance===null)switch(r.type){case"style":var p=s.querySelector('style[data-href~="'+aa(u.href)+'"]');if(p)return r.instance=p,jn(p),p;var j=f({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(s.ownerDocument||s).createElement("style"),jn(p),Gn(p,"style",j),Wd(p,u.precedence,s),r.instance=p;case"stylesheet":j=fo(u.href);var N=s.querySelector(Zc(j));if(N)return r.state.loading|=4,r.instance=N,jn(N),N;p=wj(u),(j=is.get(j))&&Xp(p,j),N=(s.ownerDocument||s).createElement("link"),jn(N);var $=N;return $._p=new Promise(function(X,he){$.onload=X,$.onerror=he}),Gn(N,"link",p),r.state.loading|=4,Wd(N,u.precedence,s),r.instance=N;case"script":return N=go(u.src),(j=s.querySelector(eu(N)))?(r.instance=j,jn(j),j):(p=u,(j=is.get(N))&&(p=f({},u),Zp(p,j)),s=s.ownerDocument||s,j=s.createElement("script"),jn(j),Gn(j,"link",p),s.head.appendChild(j),r.instance=j);case"void":return null;default:throw Error(i(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(p=r.instance,r.state.loading|=4,Wd(p,u.precedence,s));return r.instance}function Wd(s,r,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),j=p.length?p[p.length-1]:null,N=j,$=0;$<p.length;$++){var X=p[$];if(X.dataset.precedence===r)N=X;else if(N!==j)break}N?N.parentNode.insertBefore(s,N.nextSibling):(r=u.nodeType===9?u.head:u,r.insertBefore(s,r.firstChild))}function Xp(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.title==null&&(s.title=r.title)}function Zp(s,r){s.crossOrigin==null&&(s.crossOrigin=r.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=r.referrerPolicy),s.integrity==null&&(s.integrity=r.integrity)}var Xd=null;function kj(s,r,u){if(Xd===null){var p=new Map,j=Xd=new Map;j.set(u,p)}else j=Xd,p=j.get(u),p||(p=new Map,j.set(u,p));if(p.has(s))return p;for(p.set(s,null),u=u.getElementsByTagName(s),j=0;j<u.length;j++){var N=u[j];if(!(N[On]||N[Ze]||s==="link"&&N.getAttribute("rel")==="stylesheet")&&N.namespaceURI!=="http://www.w3.org/2000/svg"){var $=N.getAttribute(r)||"";$=s+$;var X=p.get($);X?X.push(N):p.set($,[N])}}return p}function Cj(s,r,u){s=s.ownerDocument||s,s.head.insertBefore(u,r==="title"?s.querySelector("head > title"):null)}function Uk(s,r,u){if(u===1||r.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;switch(r.rel){case"stylesheet":return s=r.disabled,typeof r.precedence=="string"&&s==null;default:return!0}case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function _j(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var tu=null;function qk(){}function Hk(s,r,u){if(tu===null)throw Error(i(475));var p=tu;if(r.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(r.state.loading&4)===0){if(r.instance===null){var j=fo(u.href),N=s.querySelector(Zc(j));if(N){s=N._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(p.count++,p=Zd.bind(p),s.then(p,p)),r.state.loading|=4,r.instance=N,jn(N);return}N=s.ownerDocument||s,u=wj(u),(j=is.get(j))&&Xp(u,j),N=N.createElement("link"),jn(N);var $=N;$._p=new Promise(function(X,he){$.onload=X,$.onerror=he}),Gn(N,"link",u),r.instance=N}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(r,s),(s=r.state.preload)&&(r.state.loading&3)===0&&(p.count++,r=Zd.bind(p),s.addEventListener("load",r),s.addEventListener("error",r))}}function Vk(){if(tu===null)throw Error(i(475));var s=tu;return s.stylesheets&&s.count===0&&ef(s,s.stylesheets),0<s.count?function(r){var u=setTimeout(function(){if(s.stylesheets&&ef(s,s.stylesheets),s.unsuspend){var p=s.unsuspend;s.unsuspend=null,p()}},6e4);return s.unsuspend=r,function(){s.unsuspend=null,clearTimeout(u)}}:null}function Zd(){if(this.count--,this.count===0){if(this.stylesheets)ef(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var eh=null;function ef(s,r){s.stylesheets=null,s.unsuspend!==null&&(s.count++,eh=new Map,r.forEach(Gk,s),eh=null,Zd.call(s))}function Gk(s,r){if(!(r.state.loading&4)){var u=eh.get(s);if(u)var p=u.get(null);else{u=new Map,eh.set(s,u);for(var j=s.querySelectorAll("link[data-precedence],style[data-precedence]"),N=0;N<j.length;N++){var $=j[N];($.nodeName==="LINK"||$.getAttribute("media")!=="not all")&&(u.set($.dataset.precedence,$),p=$)}p&&u.set(null,p)}j=r.instance,$=j.getAttribute("data-precedence"),N=u.get($)||p,N===p&&u.set(null,j),u.set($,j),this.count++,p=Zd.bind(this),j.addEventListener("load",p),j.addEventListener("error",p),N?N.parentNode.insertBefore(j,N.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(j,s.firstChild)),r.state.loading|=4}}var nu={$$typeof:D,Provider:null,Consumer:null,_currentValue:re,_currentValue2:re,_threadCount:0};function Qk(s,r,u,p,j,N,$,X){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qe(0),this.hiddenUpdates=qe(null),this.identifierPrefix=p,this.onUncaughtError=j,this.onCaughtError=N,this.onRecoverableError=$,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=X,this.incompleteTransitions=new Map}function Dj(s,r,u,p,j,N,$,X,he,ze,Ve,Ke){return s=new Qk(s,r,u,$,X,he,ze,Ke),r=1,N===!0&&(r|=24),N=la(3,null,null,r),s.current=N,N.stateNode=s,r=Im(),r.refCount++,s.pooledCache=r,r.refCount++,N.memoizedState={element:p,isDehydrated:u,cache:r},$m(N),s}function Ej(s){return s?(s=qi,s):qi}function Tj(s,r,u,p,j,N){j=Ej(j),p.context===null?p.context=j:p.pendingContext=j,p=Qi(r),p.payload={element:u},N=N===void 0?null:N,N!==null&&(p.callback=N),u=Yi(s,p,r),u!==null&&(Ma(u,s,r),Pc(u,s,r))}function Aj(s,r){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var u=s.retryLane;s.retryLane=u!==0&&u<r?u:r}}function tf(s,r){Aj(s,r),(s=s.alternate)&&Aj(s,r)}function Pj(s){if(s.tag===13){var r=Ui(s,67108864);r!==null&&Ma(r,s,67108864),tf(s,67108864)}}var th=!0;function Yk(s,r,u,p){var j=I.T;I.T=null;var N=V.p;try{V.p=2,nf(s,r,u,p)}finally{V.p=N,I.T=j}}function Jk(s,r,u,p){var j=I.T;I.T=null;var N=V.p;try{V.p=8,nf(s,r,u,p)}finally{V.p=N,I.T=j}}function nf(s,r,u,p){if(th){var j=af(p);if(j===null)qp(s,r,p,nh,u),Oj(s,p);else if(Wk(j,s,r,u,p))p.stopPropagation();else if(Oj(s,p),r&4&&-1<Kk.indexOf(s)){for(;j!==null;){var N=Aa(j);if(N!==null)switch(N.tag){case 3:if(N=N.stateNode,N.current.memoizedState.isDehydrated){var $=be(N.pendingLanes);if($!==0){var X=N;for(X.pendingLanes|=2,X.entangledLanes|=2;$;){var he=1<<31-ae($);X.entanglements[1]|=he,$&=~he}Us(N),(en&6)===0&&($d=ce()+500,Jc(0))}}break;case 13:X=Ui(N,2),X!==null&&Ma(X,N,2),Bd(),tf(N,2)}if(N=af(p),N===null&&qp(s,r,p,nh,u),N===j)break;j=N}j!==null&&p.stopPropagation()}else qp(s,r,p,null,u)}}function af(s){return s=zr(s),sf(s)}var nh=null;function sf(s){if(nh=null,s=gn(s),s!==null){var r=c(s);if(r===null)s=null;else{var u=r.tag;if(u===13){if(s=o(r),s!==null)return s;s=null}else if(u===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return nh=s,null}function Rj(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pe()){case He:return 2;case We:return 8;case st:case me:return 32;case ve:return 268435456;default:return 32}default:return 32}}var rf=!1,lr=null,or=null,cr=null,au=new Map,su=new Map,ur=[],Kk="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Oj(s,r){switch(s){case"focusin":case"focusout":lr=null;break;case"dragenter":case"dragleave":or=null;break;case"mouseover":case"mouseout":cr=null;break;case"pointerover":case"pointerout":au.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":su.delete(r.pointerId)}}function iu(s,r,u,p,j,N){return s===null||s.nativeEvent!==N?(s={blockedOn:r,domEventName:u,eventSystemFlags:p,nativeEvent:N,targetContainers:[j]},r!==null&&(r=Aa(r),r!==null&&Pj(r)),s):(s.eventSystemFlags|=p,r=s.targetContainers,j!==null&&r.indexOf(j)===-1&&r.push(j),s)}function Wk(s,r,u,p,j){switch(r){case"focusin":return lr=iu(lr,s,r,u,p,j),!0;case"dragenter":return or=iu(or,s,r,u,p,j),!0;case"mouseover":return cr=iu(cr,s,r,u,p,j),!0;case"pointerover":var N=j.pointerId;return au.set(N,iu(au.get(N)||null,s,r,u,p,j)),!0;case"gotpointercapture":return N=j.pointerId,su.set(N,iu(su.get(N)||null,s,r,u,p,j)),!0}return!1}function Ij(s){var r=gn(s.target);if(r!==null){var u=c(r);if(u!==null){if(r=u.tag,r===13){if(r=o(u),r!==null){s.blockedOn=r,Ye(s.priority,function(){if(u.tag===13){var p=$a();p=dt(p);var j=Ui(u,p);j!==null&&Ma(j,u,p),tf(u,p)}});return}}else if(r===3&&u.stateNode.current.memoizedState.isDehydrated){s.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}s.blockedOn=null}function ah(s){if(s.blockedOn!==null)return!1;for(var r=s.targetContainers;0<r.length;){var u=af(s.nativeEvent);if(u===null){u=s.nativeEvent;var p=new u.constructor(u.type,u);Tl=p,u.target.dispatchEvent(p),Tl=null}else return r=Aa(u),r!==null&&Pj(r),s.blockedOn=u,!1;r.shift()}return!0}function zj(s,r,u){ah(s)&&u.delete(r)}function Xk(){rf=!1,lr!==null&&ah(lr)&&(lr=null),or!==null&&ah(or)&&(or=null),cr!==null&&ah(cr)&&(cr=null),au.forEach(zj),su.forEach(zj)}function sh(s,r){s.blockedOn===r&&(s.blockedOn=null,rf||(rf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,Xk)))}var ih=null;function Fj(s){ih!==s&&(ih=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ih===s&&(ih=null);for(var r=0;r<s.length;r+=3){var u=s[r],p=s[r+1],j=s[r+2];if(typeof p!="function"){if(sf(p||u)===null)continue;break}var N=Aa(u);N!==null&&(s.splice(r,3),r-=3,sp(N,{pending:!0,data:j,method:u.method,action:p},p,j))}}))}function ru(s){function r(he){return sh(he,s)}lr!==null&&sh(lr,s),or!==null&&sh(or,s),cr!==null&&sh(cr,s),au.forEach(r),su.forEach(r);for(var u=0;u<ur.length;u++){var p=ur[u];p.blockedOn===s&&(p.blockedOn=null)}for(;0<ur.length&&(u=ur[0],u.blockedOn===null);)Ij(u),u.blockedOn===null&&ur.shift();if(u=(s.ownerDocument||s).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var j=u[p],N=u[p+1],$=j[ht]||null;if(typeof N=="function")$||Fj(u);else if($){var X=null;if(N&&N.hasAttribute("formAction")){if(j=N,$=N[ht]||null)X=$.formAction;else if(sf(j)!==null)continue}else X=$.action;typeof X=="function"?u[p+1]=X:(u.splice(p,3),p-=3),Fj(u)}}}function lf(s){this._internalRoot=s}rh.prototype.render=lf.prototype.render=function(s){var r=this._internalRoot;if(r===null)throw Error(i(409));var u=r.current,p=$a();Tj(u,p,s,r,null,null)},rh.prototype.unmount=lf.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var r=s.containerInfo;Tj(s.current,2,null,s,null,null),Bd(),r[ct]=null}};function rh(s){this._internalRoot=s}rh.prototype.unstable_scheduleHydration=function(s){if(s){var r=At();s={blockedOn:null,target:s,priority:r};for(var u=0;u<ur.length&&r!==0&&r<ur[u].priority;u++);ur.splice(u,0,s),u===0&&Ij(s)}};var Lj=a.version;if(Lj!=="19.1.0")throw Error(i(527,Lj,"19.1.0"));V.findDOMNode=function(s){var r=s._reactInternals;if(r===void 0)throw typeof s.render=="function"?Error(i(188)):(s=Object.keys(s).join(","),Error(i(268,s)));return s=h(r),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var Zk={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:I,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lh.isDisabled&&lh.supportsFiber)try{L=lh.inject(Zk),ne=lh}catch{}}return ou.createRoot=function(s,r){if(!l(s))throw Error(i(299));var u=!1,p="",j=eb,N=tb,$=nb,X=null;return r!=null&&(r.unstable_strictMode===!0&&(u=!0),r.identifierPrefix!==void 0&&(p=r.identifierPrefix),r.onUncaughtError!==void 0&&(j=r.onUncaughtError),r.onCaughtError!==void 0&&(N=r.onCaughtError),r.onRecoverableError!==void 0&&($=r.onRecoverableError),r.unstable_transitionCallbacks!==void 0&&(X=r.unstable_transitionCallbacks)),r=Dj(s,1,!1,null,null,u,p,j,N,$,X,null),s[ct]=r.current,Up(s),new lf(r)},ou.hydrateRoot=function(s,r,u){if(!l(s))throw Error(i(299));var p=!1,j="",N=eb,$=tb,X=nb,he=null,ze=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(j=u.identifierPrefix),u.onUncaughtError!==void 0&&(N=u.onUncaughtError),u.onCaughtError!==void 0&&($=u.onCaughtError),u.onRecoverableError!==void 0&&(X=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(he=u.unstable_transitionCallbacks),u.formState!==void 0&&(ze=u.formState)),r=Dj(s,1,!0,r,u??null,p,j,N,$,X,he,ze),r.context=Ej(null),u=r.current,p=$a(),p=dt(p),j=Qi(p),j.callback=null,Yi(u,j,p),u=p,r.current.lanes=u,te(r,u),Us(r),s[ct]=r.current,Up(s),new rh(r)},ou.version="19.1.0",ou}var Zj;function WC(){if(Zj)return df.exports;Zj=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(a){console.error(a)}}return t(),df.exports=KC(),df.exports}var XC=WC(),nm=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},ZC={setTimeout:(t,a)=>setTimeout(t,a),clearTimeout:t=>clearTimeout(t),setInterval:(t,a)=>setInterval(t,a),clearInterval:t=>clearInterval(t)},yr,Zg,h1,e_=(h1=class{constructor(){qt(this,yr,ZC);qt(this,Zg,!1)}setTimeoutProvider(t){Tt(this,yr,t)}setTimeout(t,a){return Ge(this,yr).setTimeout(t,a)}clearTimeout(t){Ge(this,yr).clearTimeout(t)}setInterval(t,a){return Ge(this,yr).setInterval(t,a)}clearInterval(t){Ge(this,yr).clearInterval(t)}},yr=new WeakMap,Zg=new WeakMap,h1),pg=new e_;function t_(t){setTimeout(t,0)}var am=typeof window>"u"||"Deno"in globalThis;function bs(){}function n_(t,a){return typeof t=="function"?t(a):t}function a_(t){return typeof t=="number"&&t>=0&&t!==1/0}function s_(t,a){return Math.max(t+(a||0)-Date.now(),0)}function fg(t,a){return typeof t=="function"?t(a):t}function i_(t,a){return typeof t=="function"?t(a):t}function ev(t,a){const{type:n="all",exact:i,fetchStatus:l,predicate:c,queryKey:o,stale:d}=t;if(o){if(i){if(a.queryHash!==rx(o,a.options))return!1}else if(!ku(a.queryKey,o))return!1}if(n!=="all"){const h=a.isActive();if(n==="active"&&!h||n==="inactive"&&h)return!1}return!(typeof d=="boolean"&&a.isStale()!==d||l&&l!==a.state.fetchStatus||c&&!c(a))}function tv(t,a){const{exact:n,status:i,predicate:l,mutationKey:c}=t;if(c){if(!a.options.mutationKey)return!1;if(n){if(Su(a.options.mutationKey)!==Su(c))return!1}else if(!ku(a.options.mutationKey,c))return!1}return!(i&&a.state.status!==i||l&&!l(a))}function rx(t,a){return((a==null?void 0:a.queryKeyHashFn)||Su)(t)}function Su(t){return JSON.stringify(t,(a,n)=>gg(n)?Object.keys(n).sort().reduce((i,l)=>(i[l]=n[l],i),{}):n)}function ku(t,a){return t===a?!0:typeof t!=typeof a?!1:t&&a&&typeof t=="object"&&typeof a=="object"?Object.keys(a).every(n=>ku(t[n],a[n])):!1}var r_=Object.prototype.hasOwnProperty;function B1(t,a,n=0){if(t===a)return t;if(n>500)return a;const i=nv(t)&&nv(a);if(!i&&!(gg(t)&&gg(a)))return a;const c=(i?t:Object.keys(t)).length,o=i?a:Object.keys(a),d=o.length,h=i?new Array(d):{};let m=0;for(let f=0;f<d;f++){const g=i?f:o[f],y=t[g],b=a[g];if(y===b){h[g]=y,(i?f<c:r_.call(t,g))&&m++;continue}if(y===null||b===null||typeof y!="object"||typeof b!="object"){h[g]=b;continue}const v=B1(y,b,n+1);h[g]=v,v===y&&m++}return c===d&&m===c?t:h}function nv(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function gg(t){if(!av(t))return!1;const a=t.constructor;if(a===void 0)return!0;const n=a.prototype;return!(!av(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function av(t){return Object.prototype.toString.call(t)==="[object Object]"}function l_(t){return new Promise(a=>{pg.setTimeout(a,t)})}function o_(t,a,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,a):n.structuralSharing!==!1?B1(t,a):a}function c_(t,a,n=0){const i=[...t,a];return n&&i.length>n?i.slice(1):i}function u_(t,a,n=0){const i=[a,...t];return n&&i.length>n?i.slice(0,-1):i}var lx=Symbol();function U1(t,a){return!t.queryFn&&(a!=null&&a.initialPromise)?()=>a.initialPromise:!t.queryFn||t.queryFn===lx?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function d_(t,a,n){let i=!1,l;return Object.defineProperty(t,"signal",{enumerable:!0,get:()=>(l??(l=a()),i||(i=!0,l.aborted?n():l.addEventListener("abort",n,{once:!0})),l)}),t}var ul,br,Io,m1,h_=(m1=class extends nm{constructor(){super();qt(this,ul);qt(this,br);qt(this,Io);Tt(this,Io,a=>{if(!am&&window.addEventListener){const n=()=>a();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){Ge(this,br)||this.setEventListener(Ge(this,Io))}onUnsubscribe(){var a;this.hasListeners()||((a=Ge(this,br))==null||a.call(this),Tt(this,br,void 0))}setEventListener(a){var n;Tt(this,Io,a),(n=Ge(this,br))==null||n.call(this),Tt(this,br,a(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(a){Ge(this,ul)!==a&&(Tt(this,ul,a),this.onFocus())}onFocus(){const a=this.isFocused();this.listeners.forEach(n=>{n(a)})}isFocused(){var a;return typeof Ge(this,ul)=="boolean"?Ge(this,ul):((a=globalThis.document)==null?void 0:a.visibilityState)!=="hidden"}},ul=new WeakMap,br=new WeakMap,Io=new WeakMap,m1),q1=new h_;function m_(){let t,a;const n=new Promise((l,c)=>{t=l,a=c});n.status="pending",n.catch(()=>{});function i(l){Object.assign(n,l),delete n.resolve,delete n.reject}return n.resolve=l=>{i({status:"fulfilled",value:l}),t(l)},n.reject=l=>{i({status:"rejected",reason:l}),a(l)},n}var p_=t_;function f_(){let t=[],a=0,n=d=>{d()},i=d=>{d()},l=p_;const c=d=>{a?t.push(d):l(()=>{n(d)})},o=()=>{const d=t;t=[],d.length&&l(()=>{i(()=>{d.forEach(h=>{n(h)})})})};return{batch:d=>{let h;a++;try{h=d()}finally{a--,a||o()}return h},batchCalls:d=>(...h)=>{c(()=>{d(...h)})},schedule:c,setNotifyFunction:d=>{n=d},setBatchNotifyFunction:d=>{i=d},setScheduler:d=>{l=d}}}var da=f_(),zo,jr,Fo,p1,g_=(p1=class extends nm{constructor(){super();qt(this,zo,!0);qt(this,jr);qt(this,Fo);Tt(this,Fo,a=>{if(!am&&window.addEventListener){const n=()=>a(!0),i=()=>a(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",i)}}})}onSubscribe(){Ge(this,jr)||this.setEventListener(Ge(this,Fo))}onUnsubscribe(){var a;this.hasListeners()||((a=Ge(this,jr))==null||a.call(this),Tt(this,jr,void 0))}setEventListener(a){var n;Tt(this,Fo,a),(n=Ge(this,jr))==null||n.call(this),Tt(this,jr,a(this.setOnline.bind(this)))}setOnline(a){Ge(this,zo)!==a&&(Tt(this,zo,a),this.listeners.forEach(i=>{i(a)}))}isOnline(){return Ge(this,zo)}},zo=new WeakMap,jr=new WeakMap,Fo=new WeakMap,p1),$h=new g_;function x_(t){return Math.min(1e3*2**t,3e4)}function H1(t){return(t??"online")==="online"?$h.isOnline():!0}var xg=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function V1(t){let a=!1,n=0,i;const l=m_(),c=()=>l.status!=="pending",o=w=>{var S;if(!c()){const _=new xg(w);y(_),(S=t.onCancel)==null||S.call(t,_)}},d=()=>{a=!0},h=()=>{a=!1},m=()=>q1.isFocused()&&(t.networkMode==="always"||$h.isOnline())&&t.canRun(),f=()=>H1(t.networkMode)&&t.canRun(),g=w=>{c()||(i==null||i(),l.resolve(w))},y=w=>{c()||(i==null||i(),l.reject(w))},b=()=>new Promise(w=>{var S;i=_=>{(c()||m())&&w(_)},(S=t.onPause)==null||S.call(t)}).then(()=>{var w;i=void 0,c()||(w=t.onContinue)==null||w.call(t)}),v=()=>{if(c())return;let w;const S=n===0?t.initialPromise:void 0;try{w=S??t.fn()}catch(_){w=Promise.reject(_)}Promise.resolve(w).then(g).catch(_=>{var A;if(c())return;const E=t.retry??(am?0:3),D=t.retryDelay??x_,O=typeof D=="function"?D(n,_):D,M=E===!0||typeof E=="number"&&n<E||typeof E=="function"&&E(n,_);if(a||!M){y(_);return}n++,(A=t.onFail)==null||A.call(t,n,_),l_(O).then(()=>m()?void 0:b()).then(()=>{a?y(_):v()})})};return{promise:l,status:()=>l.status,cancel:o,continue:()=>(i==null||i(),l),cancelRetry:d,continueRetry:h,canStart:f,start:()=>(f()?v():b().then(v),l)}}var dl,f1,G1=(f1=class{constructor(){qt(this,dl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),a_(this.gcTime)&&Tt(this,dl,pg.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(am?1/0:5*60*1e3))}clearGcTimeout(){Ge(this,dl)&&(pg.clearTimeout(Ge(this,dl)),Tt(this,dl,void 0))}},dl=new WeakMap,f1),hl,Lo,rs,ml,qn,Eu,pl,js,Si,g1,y_=(g1=class extends G1{constructor(a){super();qt(this,js);qt(this,hl);qt(this,Lo);qt(this,rs);qt(this,ml);qt(this,qn);qt(this,Eu);qt(this,pl);Tt(this,pl,!1),Tt(this,Eu,a.defaultOptions),this.setOptions(a.options),this.observers=[],Tt(this,ml,a.client),Tt(this,rs,Ge(this,ml).getQueryCache()),this.queryKey=a.queryKey,this.queryHash=a.queryHash,Tt(this,hl,iv(this.options)),this.state=a.state??Ge(this,hl),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var a;return(a=Ge(this,qn))==null?void 0:a.promise}setOptions(a){if(this.options={...Ge(this,Eu),...a},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=iv(this.options);n.data!==void 0&&(this.setState(sv(n.data,n.dataUpdatedAt)),Tt(this,hl,n))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Ge(this,rs).remove(this)}setData(a,n){const i=o_(this.state.data,a,this.options);return Kn(this,js,Si).call(this,{data:i,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),i}setState(a,n){Kn(this,js,Si).call(this,{type:"setState",state:a,setStateOptions:n})}cancel(a){var i,l;const n=(i=Ge(this,qn))==null?void 0:i.promise;return(l=Ge(this,qn))==null||l.cancel(a),n?n.then(bs).catch(bs):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Ge(this,hl))}isActive(){return this.observers.some(a=>i_(a.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===lx||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(a=>fg(a.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(a=>a.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(a=0){return this.state.data===void 0?!0:a==="static"?!1:this.state.isInvalidated?!0:!s_(this.state.dataUpdatedAt,a)}onFocus(){var n;const a=this.observers.find(i=>i.shouldFetchOnWindowFocus());a==null||a.refetch({cancelRefetch:!1}),(n=Ge(this,qn))==null||n.continue()}onOnline(){var n;const a=this.observers.find(i=>i.shouldFetchOnReconnect());a==null||a.refetch({cancelRefetch:!1}),(n=Ge(this,qn))==null||n.continue()}addObserver(a){this.observers.includes(a)||(this.observers.push(a),this.clearGcTimeout(),Ge(this,rs).notify({type:"observerAdded",query:this,observer:a}))}removeObserver(a){this.observers.includes(a)&&(this.observers=this.observers.filter(n=>n!==a),this.observers.length||(Ge(this,qn)&&(Ge(this,pl)?Ge(this,qn).cancel({revert:!0}):Ge(this,qn).cancelRetry()),this.scheduleGc()),Ge(this,rs).notify({type:"observerRemoved",query:this,observer:a}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Kn(this,js,Si).call(this,{type:"invalidate"})}async fetch(a,n){var h,m,f,g,y,b,v,w,S,_,E,D;if(this.state.fetchStatus!=="idle"&&((h=Ge(this,qn))==null?void 0:h.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(Ge(this,qn))return Ge(this,qn).continueRetry(),Ge(this,qn).promise}if(a&&this.setOptions(a),!this.options.queryFn){const O=this.observers.find(M=>M.options.queryFn);O&&this.setOptions(O.options)}const i=new AbortController,l=O=>{Object.defineProperty(O,"signal",{enumerable:!0,get:()=>(Tt(this,pl,!0),i.signal)})},c=()=>{const O=U1(this.options,n),A=(()=>{const P={client:Ge(this,ml),queryKey:this.queryKey,meta:this.meta};return l(P),P})();return Tt(this,pl,!1),this.options.persister?this.options.persister(O,A,this):O(A)},d=(()=>{const O={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:Ge(this,ml),state:this.state,fetchFn:c};return l(O),O})();(m=this.options.behavior)==null||m.onFetch(d,this),Tt(this,Lo,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((f=d.fetchOptions)==null?void 0:f.meta))&&Kn(this,js,Si).call(this,{type:"fetch",meta:(g=d.fetchOptions)==null?void 0:g.meta}),Tt(this,qn,V1({initialPromise:n==null?void 0:n.initialPromise,fn:d.fetchFn,onCancel:O=>{O instanceof xg&&O.revert&&this.setState({...Ge(this,Lo),fetchStatus:"idle"}),i.abort()},onFail:(O,M)=>{Kn(this,js,Si).call(this,{type:"failed",failureCount:O,error:M})},onPause:()=>{Kn(this,js,Si).call(this,{type:"pause"})},onContinue:()=>{Kn(this,js,Si).call(this,{type:"continue"})},retry:d.options.retry,retryDelay:d.options.retryDelay,networkMode:d.options.networkMode,canRun:()=>!0}));try{const O=await Ge(this,qn).start();if(O===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(O),(b=(y=Ge(this,rs).config).onSuccess)==null||b.call(y,O,this),(w=(v=Ge(this,rs).config).onSettled)==null||w.call(v,O,this.state.error,this),O}catch(O){if(O instanceof xg){if(O.silent)return Ge(this,qn).promise;if(O.revert){if(this.state.data===void 0)throw O;return this.state.data}}throw Kn(this,js,Si).call(this,{type:"error",error:O}),(_=(S=Ge(this,rs).config).onError)==null||_.call(S,O,this),(D=(E=Ge(this,rs).config).onSettled)==null||D.call(E,this.state.data,O,this),O}finally{this.scheduleGc()}}},hl=new WeakMap,Lo=new WeakMap,rs=new WeakMap,ml=new WeakMap,qn=new WeakMap,Eu=new WeakMap,pl=new WeakMap,js=new WeakSet,Si=function(a){const n=i=>{switch(a.type){case"failed":return{...i,fetchFailureCount:a.failureCount,fetchFailureReason:a.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...b_(i.data,this.options),fetchMeta:a.meta??null};case"success":const l={...i,...sv(a.data,a.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!a.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return Tt(this,Lo,a.manual?l:void 0),l;case"error":const c=a.error;return{...i,error:c,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:c,fetchStatus:"idle",status:"error",isInvalidated:!0};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...a.state}}};this.state=n(this.state),da.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),Ge(this,rs).notify({query:this,type:"updated",action:a})})},g1);function b_(t,a){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:H1(a.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function sv(t,a){return{data:t,dataUpdatedAt:a??Date.now(),error:null,isInvalidated:!1,status:"success"}}function iv(t){const a=typeof t.initialData=="function"?t.initialData():t.initialData,n=a!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:a,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}function rv(t){return{onFetch:(a,n)=>{var f,g,y,b,v;const i=a.options,l=(y=(g=(f=a.fetchOptions)==null?void 0:f.meta)==null?void 0:g.fetchMore)==null?void 0:y.direction,c=((b=a.state.data)==null?void 0:b.pages)||[],o=((v=a.state.data)==null?void 0:v.pageParams)||[];let d={pages:[],pageParams:[]},h=0;const m=async()=>{let w=!1;const S=D=>{d_(D,()=>a.signal,()=>w=!0)},_=U1(a.options,a.fetchOptions),E=async(D,O,M)=>{if(w)return Promise.reject();if(O==null&&D.pages.length)return Promise.resolve(D);const P=(()=>{const R={client:a.client,queryKey:a.queryKey,pageParam:O,direction:M?"backward":"forward",meta:a.options.meta};return S(R),R})(),Q=await _(P),{maxPages:G}=a.options,C=M?u_:c_;return{pages:C(D.pages,Q,G),pageParams:C(D.pageParams,O,G)}};if(l&&c.length){const D=l==="backward",O=D?j_:lv,M={pages:c,pageParams:o},A=O(i,M);d=await E(M,A,D)}else{const D=t??c.length;do{const O=h===0?o[0]??i.initialPageParam:lv(i,d);if(h>0&&O==null)break;d=await E(d,O),h++}while(h<D)}return d};a.options.persister?a.fetchFn=()=>{var w,S;return(S=(w=a.options).persister)==null?void 0:S.call(w,m,{client:a.client,queryKey:a.queryKey,meta:a.options.meta,signal:a.signal},n)}:a.fetchFn=m}}}function lv(t,{pages:a,pageParams:n}){const i=a.length-1;return a.length>0?t.getNextPageParam(a[i],a,n[i],n):void 0}function j_(t,{pages:a,pageParams:n}){var i;return a.length>0?(i=t.getPreviousPageParam)==null?void 0:i.call(t,a[0],a,n[0],n):void 0}var Tu,Vs,ua,fl,Gs,fr,x1,v_=(x1=class extends G1{constructor(a){super();qt(this,Gs);qt(this,Tu);qt(this,Vs);qt(this,ua);qt(this,fl);Tt(this,Tu,a.client),this.mutationId=a.mutationId,Tt(this,ua,a.mutationCache),Tt(this,Vs,[]),this.state=a.state||N_(),this.setOptions(a.options),this.scheduleGc()}setOptions(a){this.options=a,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(a){Ge(this,Vs).includes(a)||(Ge(this,Vs).push(a),this.clearGcTimeout(),Ge(this,ua).notify({type:"observerAdded",mutation:this,observer:a}))}removeObserver(a){Tt(this,Vs,Ge(this,Vs).filter(n=>n!==a)),this.scheduleGc(),Ge(this,ua).notify({type:"observerRemoved",mutation:this,observer:a})}optionalRemove(){Ge(this,Vs).length||(this.state.status==="pending"?this.scheduleGc():Ge(this,ua).remove(this))}continue(){var a;return((a=Ge(this,fl))==null?void 0:a.continue())??this.execute(this.state.variables)}async execute(a){var o,d,h,m,f,g,y,b,v,w,S,_,E,D,O,M,A,P,Q,G;const n=()=>{Kn(this,Gs,fr).call(this,{type:"continue"})},i={client:Ge(this,Tu),meta:this.options.meta,mutationKey:this.options.mutationKey};Tt(this,fl,V1({fn:()=>this.options.mutationFn?this.options.mutationFn(a,i):Promise.reject(new Error("No mutationFn found")),onFail:(C,R)=>{Kn(this,Gs,fr).call(this,{type:"failed",failureCount:C,error:R})},onPause:()=>{Kn(this,Gs,fr).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Ge(this,ua).canRun(this)}));const l=this.state.status==="pending",c=!Ge(this,fl).canStart();try{if(l)n();else{Kn(this,Gs,fr).call(this,{type:"pending",variables:a,isPaused:c}),await((d=(o=Ge(this,ua).config).onMutate)==null?void 0:d.call(o,a,this,i));const R=await((m=(h=this.options).onMutate)==null?void 0:m.call(h,a,i));R!==this.state.context&&Kn(this,Gs,fr).call(this,{type:"pending",context:R,variables:a,isPaused:c})}const C=await Ge(this,fl).start();return await((g=(f=Ge(this,ua).config).onSuccess)==null?void 0:g.call(f,C,a,this.state.context,this,i)),await((b=(y=this.options).onSuccess)==null?void 0:b.call(y,C,a,this.state.context,i)),await((w=(v=Ge(this,ua).config).onSettled)==null?void 0:w.call(v,C,null,this.state.variables,this.state.context,this,i)),await((_=(S=this.options).onSettled)==null?void 0:_.call(S,C,null,a,this.state.context,i)),Kn(this,Gs,fr).call(this,{type:"success",data:C}),C}catch(C){try{await((D=(E=Ge(this,ua).config).onError)==null?void 0:D.call(E,C,a,this.state.context,this,i))}catch(R){Promise.reject(R)}try{await((M=(O=this.options).onError)==null?void 0:M.call(O,C,a,this.state.context,i))}catch(R){Promise.reject(R)}try{await((P=(A=Ge(this,ua).config).onSettled)==null?void 0:P.call(A,void 0,C,this.state.variables,this.state.context,this,i))}catch(R){Promise.reject(R)}try{await((G=(Q=this.options).onSettled)==null?void 0:G.call(Q,void 0,C,a,this.state.context,i))}catch(R){Promise.reject(R)}throw Kn(this,Gs,fr).call(this,{type:"error",error:C}),C}finally{Ge(this,ua).runNext(this)}}},Tu=new WeakMap,Vs=new WeakMap,ua=new WeakMap,fl=new WeakMap,Gs=new WeakSet,fr=function(a){const n=i=>{switch(a.type){case"failed":return{...i,failureCount:a.failureCount,failureReason:a.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:a.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:a.isPaused,status:"pending",variables:a.variables,submittedAt:Date.now()};case"success":return{...i,data:a.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:a.error,failureCount:i.failureCount+1,failureReason:a.error,isPaused:!1,status:"error"}}};this.state=n(this.state),da.batch(()=>{Ge(this,Vs).forEach(i=>{i.onMutationUpdate(a)}),Ge(this,ua).notify({mutation:this,type:"updated",action:a})})},x1);function N_(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ki,vs,Au,y1,w_=(y1=class extends nm{constructor(a={}){super();qt(this,ki);qt(this,vs);qt(this,Au);this.config=a,Tt(this,ki,new Set),Tt(this,vs,new Map),Tt(this,Au,0)}build(a,n,i){const l=new v_({client:a,mutationCache:this,mutationId:++oh(this,Au)._,options:a.defaultMutationOptions(n),state:i});return this.add(l),l}add(a){Ge(this,ki).add(a);const n=ch(a);if(typeof n=="string"){const i=Ge(this,vs).get(n);i?i.push(a):Ge(this,vs).set(n,[a])}this.notify({type:"added",mutation:a})}remove(a){if(Ge(this,ki).delete(a)){const n=ch(a);if(typeof n=="string"){const i=Ge(this,vs).get(n);if(i)if(i.length>1){const l=i.indexOf(a);l!==-1&&i.splice(l,1)}else i[0]===a&&Ge(this,vs).delete(n)}}this.notify({type:"removed",mutation:a})}canRun(a){const n=ch(a);if(typeof n=="string"){const i=Ge(this,vs).get(n),l=i==null?void 0:i.find(c=>c.state.status==="pending");return!l||l===a}else return!0}runNext(a){var i;const n=ch(a);if(typeof n=="string"){const l=(i=Ge(this,vs).get(n))==null?void 0:i.find(c=>c!==a&&c.state.isPaused);return(l==null?void 0:l.continue())??Promise.resolve()}else return Promise.resolve()}clear(){da.batch(()=>{Ge(this,ki).forEach(a=>{this.notify({type:"removed",mutation:a})}),Ge(this,ki).clear(),Ge(this,vs).clear()})}getAll(){return Array.from(Ge(this,ki))}find(a){const n={exact:!0,...a};return this.getAll().find(i=>tv(n,i))}findAll(a={}){return this.getAll().filter(n=>tv(a,n))}notify(a){da.batch(()=>{this.listeners.forEach(n=>{n(a)})})}resumePausedMutations(){const a=this.getAll().filter(n=>n.state.isPaused);return da.batch(()=>Promise.all(a.map(n=>n.continue().catch(bs))))}},ki=new WeakMap,vs=new WeakMap,Au=new WeakMap,y1);function ch(t){var a;return(a=t.options.scope)==null?void 0:a.id}var Qs,b1,S_=(b1=class extends nm{constructor(a={}){super();qt(this,Qs);this.config=a,Tt(this,Qs,new Map)}build(a,n,i){const l=n.queryKey,c=n.queryHash??rx(l,n);let o=this.get(c);return o||(o=new y_({client:a,queryKey:l,queryHash:c,options:a.defaultQueryOptions(n),state:i,defaultOptions:a.getQueryDefaults(l)}),this.add(o)),o}add(a){Ge(this,Qs).has(a.queryHash)||(Ge(this,Qs).set(a.queryHash,a),this.notify({type:"added",query:a}))}remove(a){const n=Ge(this,Qs).get(a.queryHash);n&&(a.destroy(),n===a&&Ge(this,Qs).delete(a.queryHash),this.notify({type:"removed",query:a}))}clear(){da.batch(()=>{this.getAll().forEach(a=>{this.remove(a)})})}get(a){return Ge(this,Qs).get(a)}getAll(){return[...Ge(this,Qs).values()]}find(a){const n={exact:!0,...a};return this.getAll().find(i=>ev(n,i))}findAll(a={}){const n=this.getAll();return Object.keys(a).length>0?n.filter(i=>ev(a,i)):n}notify(a){da.batch(()=>{this.listeners.forEach(n=>{n(a)})})}onFocus(){da.batch(()=>{this.getAll().forEach(a=>{a.onFocus()})})}onOnline(){da.batch(()=>{this.getAll().forEach(a=>{a.onOnline()})})}},Qs=new WeakMap,b1),kn,vr,Nr,$o,Mo,wr,Bo,Uo,j1,k_=(j1=class{constructor(t={}){qt(this,kn);qt(this,vr);qt(this,Nr);qt(this,$o);qt(this,Mo);qt(this,wr);qt(this,Bo);qt(this,Uo);Tt(this,kn,t.queryCache||new S_),Tt(this,vr,t.mutationCache||new w_),Tt(this,Nr,t.defaultOptions||{}),Tt(this,$o,new Map),Tt(this,Mo,new Map),Tt(this,wr,0)}mount(){oh(this,wr)._++,Ge(this,wr)===1&&(Tt(this,Bo,q1.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ge(this,kn).onFocus())})),Tt(this,Uo,$h.subscribe(async t=>{t&&(await this.resumePausedMutations(),Ge(this,kn).onOnline())})))}unmount(){var t,a;oh(this,wr)._--,Ge(this,wr)===0&&((t=Ge(this,Bo))==null||t.call(this),Tt(this,Bo,void 0),(a=Ge(this,Uo))==null||a.call(this),Tt(this,Uo,void 0))}isFetching(t){return Ge(this,kn).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return Ge(this,vr).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const a=this.defaultQueryOptions({queryKey:t});return(n=Ge(this,kn).get(a.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const a=this.defaultQueryOptions(t),n=Ge(this,kn).build(this,a),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(fg(a.staleTime,n))&&this.prefetchQuery(a),Promise.resolve(i))}getQueriesData(t){return Ge(this,kn).findAll(t).map(({queryKey:a,state:n})=>{const i=n.data;return[a,i]})}setQueryData(t,a,n){const i=this.defaultQueryOptions({queryKey:t}),l=Ge(this,kn).get(i.queryHash),c=l==null?void 0:l.state.data,o=n_(a,c);if(o!==void 0)return Ge(this,kn).build(this,i).setData(o,{...n,manual:!0})}setQueriesData(t,a,n){return da.batch(()=>Ge(this,kn).findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,a,n)]))}getQueryState(t){var n;const a=this.defaultQueryOptions({queryKey:t});return(n=Ge(this,kn).get(a.queryHash))==null?void 0:n.state}removeQueries(t){const a=Ge(this,kn);da.batch(()=>{a.findAll(t).forEach(n=>{a.remove(n)})})}resetQueries(t,a){const n=Ge(this,kn);return da.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},a)))}cancelQueries(t,a={}){const n={revert:!0,...a},i=da.batch(()=>Ge(this,kn).findAll(t).map(l=>l.cancel(n)));return Promise.all(i).then(bs).catch(bs)}invalidateQueries(t,a={}){return da.batch(()=>(Ge(this,kn).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},a)))}refetchQueries(t,a={}){const n={...a,cancelRefetch:a.cancelRefetch??!0},i=da.batch(()=>Ge(this,kn).findAll(t).filter(l=>!l.isDisabled()&&!l.isStatic()).map(l=>{let c=l.fetch(void 0,n);return n.throwOnError||(c=c.catch(bs)),l.state.fetchStatus==="paused"?Promise.resolve():c}));return Promise.all(i).then(bs)}fetchQuery(t){const a=this.defaultQueryOptions(t);a.retry===void 0&&(a.retry=!1);const n=Ge(this,kn).build(this,a);return n.isStaleByTime(fg(a.staleTime,n))?n.fetch(a):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(bs).catch(bs)}fetchInfiniteQuery(t){return t.behavior=rv(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(bs).catch(bs)}ensureInfiniteQueryData(t){return t.behavior=rv(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return $h.isOnline()?Ge(this,vr).resumePausedMutations():Promise.resolve()}getQueryCache(){return Ge(this,kn)}getMutationCache(){return Ge(this,vr)}getDefaultOptions(){return Ge(this,Nr)}setDefaultOptions(t){Tt(this,Nr,t)}setQueryDefaults(t,a){Ge(this,$o).set(Su(t),{queryKey:t,defaultOptions:a})}getQueryDefaults(t){const a=[...Ge(this,$o).values()],n={};return a.forEach(i=>{ku(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,a){Ge(this,Mo).set(Su(t),{mutationKey:t,defaultOptions:a})}getMutationDefaults(t){const a=[...Ge(this,Mo).values()],n={};return a.forEach(i=>{ku(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const a={...Ge(this,Nr).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return a.queryHash||(a.queryHash=rx(a.queryKey,a)),a.refetchOnReconnect===void 0&&(a.refetchOnReconnect=a.networkMode!=="always"),a.throwOnError===void 0&&(a.throwOnError=!!a.suspense),!a.networkMode&&a.persister&&(a.networkMode="offlineFirst"),a.queryFn===lx&&(a.enabled=!1),a}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...Ge(this,Nr).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){Ge(this,kn).clear(),Ge(this,vr).clear()}},kn=new WeakMap,vr=new WeakMap,Nr=new WeakMap,$o=new WeakMap,Mo=new WeakMap,wr=new WeakMap,Bo=new WeakMap,Uo=new WeakMap,j1),C_=x.createContext(void 0),__=({client:t,children:a})=>(x.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),e.jsx(C_.Provider,{value:t,children:a}));const D_=new k_({defaultOptions:{queries:{staleTime:5*60*1e3,gcTime:30*60*1e3,retry:2,refetchOnWindowFocus:!0,refetchOnMount:!1}}}),E_=({message:t="Newtons Ai HMS"})=>e.jsx("div",{className:"loading-container",children:e.jsxs("div",{className:"loading-content",children:[e.jsxs("div",{className:"spinner-ring",children:[e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{}),e.jsx("div",{})]}),e.jsx("div",{className:"loading-title",children:t}),e.jsx("div",{className:"loading-subtitle",children:"Loading your workspace..."})]})});function T_(t={}){const{nonce:a,locale:n,onScriptLoadSuccess:i,onScriptLoadError:l}=t,[c,o]=x.useState(!1),d=x.useRef(i);d.current=i;const h=x.useRef(l);return h.current=l,x.useEffect(()=>{const m=document.createElement("script");return m.src="https://accounts.google.com/gsi/client",n&&(m.src+=`?hl=${n}`),m.async=!0,m.defer=!0,m.nonce=a,m.onload=()=>{var f;o(!0),(f=d.current)===null||f===void 0||f.call(d)},m.onerror=()=>{var f;o(!1),(f=h.current)===null||f===void 0||f.call(h)},document.body.appendChild(m),()=>{document.body.removeChild(m)}},[a]),c}const Q1=x.createContext(null);function A_({clientId:t,nonce:a,locale:n,onScriptLoadSuccess:i,onScriptLoadError:l,children:c}){const o=T_({nonce:a,onScriptLoadSuccess:i,onScriptLoadError:l,locale:n}),d=x.useMemo(()=>({locale:n,clientId:t,scriptLoadedSuccessfully:o}),[t,o]);return on.createElement(Q1.Provider,{value:d},c)}function P_(){const t=x.useContext(Q1);if(!t)throw new Error("Google OAuth components must be used within GoogleOAuthProvider");return t}function R_(t){var a;return(a=t==null?void 0:t.clientId)!==null&&a!==void 0?a:t==null?void 0:t.client_id}const O_={large:40,medium:32,small:20};function I_({onSuccess:t,onError:a,useOneTap:n,promptMomentNotification:i,type:l="standard",theme:c="outline",size:o="large",text:d,shape:h,logo_alignment:m,width:f,click_listener:g,state:y,containerProps:b,...v}){const w=x.useRef(null),{clientId:S,locale:_,scriptLoadedSuccessfully:E}=P_(),D=x.useRef(t);D.current=t;const O=x.useRef(a);O.current=a;const M=x.useRef(i);return M.current=i,x.useEffect(()=>{var A,P,Q,G,C,R,z,F,J;if(E)return(Q=(P=(A=window==null?void 0:window.google)===null||A===void 0?void 0:A.accounts)===null||P===void 0?void 0:P.id)===null||Q===void 0||Q.initialize({client_id:S,callback:H=>{var I;if(!(H!=null&&H.credential))return(I=O.current)===null||I===void 0?void 0:I.call(O);const{credential:V,select_by:re}=H;D.current({credential:V,clientId:R_(H),select_by:re})},...v}),(R=(C=(G=window==null?void 0:window.google)===null||G===void 0?void 0:G.accounts)===null||C===void 0?void 0:C.id)===null||R===void 0||R.renderButton(w.current,{type:l,theme:c,size:o,text:d,shape:h,logo_alignment:m,width:f,locale:_,click_listener:g,state:y}),n&&((J=(F=(z=window==null?void 0:window.google)===null||z===void 0?void 0:z.accounts)===null||F===void 0?void 0:F.id)===null||J===void 0||J.prompt(M.current)),()=>{var H,I,V;n&&((V=(I=(H=window==null?void 0:window.google)===null||H===void 0?void 0:H.accounts)===null||I===void 0?void 0:I.id)===null||V===void 0||V.cancel())}},[S,E,n,l,c,o,d,h,m,f,_]),on.createElement("div",{...b,ref:w,style:{height:O_[o],...b==null?void 0:b.style}})}class z_ extends x.Component{constructor(){super(...arguments);ln(this,"state",{hasError:!1})}static getDerivedStateFromError(n){return{hasError:!0}}componentDidCatch(n,i){console.error("Uncaught error:",n,i)}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"red",border:"1px solid red",borderRadius:"5px"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsx("p",{children:"We are sorry for the inconvenience. Please try again later."})]}):this.props.children}}const Y1=x.createContext(void 0),F_=({children:t})=>{const[a,n]=x.useState(!1),[i,l]=x.useState({startDate:null,endDate:null}),[c,o]=x.useState(null),[d,h]=x.useState(null),[m,f]=x.useState(null),g=x.useCallback(()=>n(!0),[]),y=x.useCallback(()=>n(!1),[]),b=x.useCallback(()=>n(O=>!O),[]),v=x.useCallback(O=>{f(()=>O)},[]),w=x.useCallback(O=>{m?m(O):console.warn("Analysis navigator not registered")},[m]),[S,_]=x.useState(null),E=x.useCallback(O=>{_(()=>O)},[]),D=x.useCallback(async()=>S?await S():(console.warn("Analysis refresher not registered"),null),[S]);return e.jsx(Y1.Provider,{value:{isOpen:a,openAssistant:g,closeAssistant:y,toggleAssistant:b,analysisDateRange:i,setAnalysisDateRange:l,analysisData:c,setAnalysisData:o,analysisNavigate:w,registerAnalysisNavigator:v,refreshAnalysis:D,registerAnalysisRefresher:E,pageContext:d,setPageContext:h},children:t})},sm=()=>{const t=x.useContext(Y1);if(t===void 0)throw new Error("useClinicAssistantContext must be used within a ClinicAssistantProvider");return t},J1=x.createContext(void 0),L_=({children:t})=>{const[a,n]=x.useState([]),[i,l]=x.useState(null),[c,o]=x.useState(""),[d,h]=x.useState(0),[m,f]=x.useState([]),g=x.useCallback(w=>{n(S=>[...S,w])},[]),y=x.useCallback((w,S)=>{n(_=>_.map(E=>E.id===w?{...E,...S}:E))},[]),b=x.useCallback(w=>{n(S=>S.filter(_=>_.id!==w))},[]),v=x.useCallback(()=>{n([]),l(null),o(""),h(0),f([])},[]);return e.jsx(J1.Provider,{value:{purchaseRows:a,setPurchaseRows:n,selectedDistributor:i,setSelectedDistributor:l,searchTerm:c,setSearchTerm:o,amountPaidToDistributor:d,setAmountPaidToDistributor:h,distributors:m,setDistributors:f,addPurchaseRow:g,updatePurchaseRow:y,removePurchaseRow:b,resetPurchase:v},children:t})},K1=()=>{const t=x.useContext(J1);if(!t)throw new Error("usePurchaseContext must be used within a PurchaseProvider");return t},W1=x.createContext(void 0),$_=({children:t})=>{const[a,n]=x.useState(!1),[i,l]=x.useState(""),c=x.useCallback(()=>n(!0),[]),o=x.useCallback(()=>n(!1),[]),d=x.useCallback(()=>n(h=>!h),[]);return x.useEffect(()=>{const h=m=>{(m.ctrlKey||m.metaKey)&&m.key==="k"&&(m.preventDefault(),d()),m.key==="Escape"&&a&&o()};return window.addEventListener("keydown",h),()=>window.removeEventListener("keydown",h)},[a,d,o]),e.jsx(W1.Provider,{value:{isOpen:a,openCommandBar:c,closeCommandBar:o,toggleCommandBar:d,preFilledQuery:i,setPreFilledQuery:l},children:t})},qo=()=>{const t=x.useContext(W1);if(t===void 0)throw new Error("useCommandBar must be used within a CommandBarProvider");return t},M_=()=>{const t=localStorage.getItem("currentClinicId");return t||(console.warn("getCurrentClinicId: Clinic ID not found. Returning null. Ensure this is implemented correctly."),null)},ox=()=>localStorage.getItem("authToken");class B_{constructor(){ln(this,"listeners",[]);ln(this,"activeRequests",0)}subscribe(a){return this.listeners.push(a),a(this.activeRequests>0),()=>this.unsubscribe(a)}unsubscribe(a){this.listeners=this.listeners.filter(n=>n!==a)}notify(a){a?this.activeRequests++:this.activeRequests=Math.max(0,this.activeRequests-1);const n=this.activeRequests>0;this.listeners.forEach(i=>i(n))}}const yg=new B_,U_="https://backend.newtons.in",q_=()=>localStorage.getItem("authToken"),Z=async(t,a={})=>{const n=q_(),i={...a.headers};n&&(i.Authorization=`Bearer ${n}`),!(a.body instanceof FormData)&&!i["Content-Type"]&&(i["Content-Type"]="application/json");const l=i;let c=t.startsWith("/")?t:`/${t}`;c.startsWith("/api/")||(c=`/api${c}`);const o=`${U_}${c}`;yg.notify(!0);try{console.log(`Making API call to: ${o}`);const d=await fetch(o,{...a,headers:l});if(d.status===401)throw console.error("Unauthorized access - Token might be invalid or expired. Logging out."),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),window.location.href="/login",new Error("Unauthorized");if(!d.ok){let h=`HTTP error! status: ${d.status}`;try{const m=await d.json();h=(m==null?void 0:m.message)||(m==null?void 0:m.error)||h}catch{}throw console.error(`API Error: ${d.status} ${d.statusText} - ${h}`),new Error(h)}return d}catch(d){throw d instanceof TypeError&&d.message==="Failed to fetch"?console.error("API Fetch Error: Network error or CORS issue. Check backend CORS configuration.",d):console.error("API Fetch Error:",d),d}finally{yg.notify(!1)}},pf="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",H_="models/gemini-3-flash-preview",V_=`You are an intelligent Clinic Hub Assistant for a Clinic Management System. Your role is to help the Clinic Administrator or Doctor manage their clinic ecosystem efficiently.

You have access to the current state of the clinic settings and the staff list. You can perform actions to update these settings or manage staff members.

**Capabilities:**
1.  **View Settings & Staff:** User can ask about current charges, clinic details, or staff members. Answer based on the provided context.
2.  **Update Settings:** Change fees, clinic name, address, etc.
3.  **Manage Staff:** Add new staff members or update existing ones.
4.  **Voice AI Settings:** Update the \`voice_ai_language\` for the Live API Assistant. Available codes:
    -   India: \`en-US\` (English), \`hi-IN\` (Hindi), \`te-IN\` (Telugu), \`bn-IN\` (Bengali), \`mr-IN\` (Marathi), \`ta-IN\` (Tamil), \`gu-IN\` (Gujarati), \`kn-IN\` (Kannada), \`ml-IN\` (Malayalam), \`pa-IN\` (Punjabi)
    -   Global: \`es-ES\` (Spanish), \`fr-FR\` (French), \`de-DE\` (German), \`it-IT\` (Italian), \`pt-PT\` (Portuguese), \`ru-RU\` (Russian), \`ja-JP\` (Japanese), \`ko-KR\` (Korean), \`zh-CN\` (Chinese), \`ar-SA\` (Arabic).
5.  **Analyze Financials & Inventory:** Access the Analysis Dashboard to view revenue, expenses, and inventory movement. Set date ranges to filter data.
6.  **Manage Inventory:** Update pharmacy tokens (drugs) and lab tests. You will reference items by their **Serial Number** as provided in the context.
7.  **Purchase Management:** Search for distributors, select one, and build a purchase order by adding items. You can add multiple items at once. Editing items uses Serial Numbers.
8.  **Looping & Reasoning:** You should think step-by-step. If a user request involves multiple steps or if you need to check something after an action, you can continue the loop.
9.  **Follow-up:** If critical information is missing, ask the user.
10.  **Manage Custom Columns:** You can add or remove custom columns/fields for various entities (patients, drugs, lab_tests). Use the \`manage_custom_columns\` action.
11.  **Custom Fields Data:** When searching or updating items (like drugs or patients), pay attention to their \`custom_fields\`. You can update these fields using the \`update_drug\` (or similar) action by passing a \`custom_fields\` object with key-value pairs. Keys must match the \`key\` defined in the Clinic Settings.
12.  **Custom Tables:** You can create entirely new tables to track anything (e.g., "Gym Members", "Diet Plans"). Use \`create_custom_table\`. You can then add rows to these tables using \`add_table_row\` (requires Table ID) and update them with \`update_table_row\`. meaningful descriptions are helpful.
13.  **Dashboards:** You can create persistent custom dashboards using \`create_custom_dashboard\` or show a specialized temporary view using \`render_temporary_dashboard\`.
     - Use \`render_temporary_dashboard\` when the user asks to "show", "view", or "see" data (e.g., "Show me John's meds").
     - Use \`create_custom_dashboard\` when the user explicitly asks to "create a dashboard" or "save a view".
     - **Data Sources:** Use the provided "Dashboard Data Sources" context to know valid keys (e.g., \`api:patients\`, \`table:123\`).
       - **Advanced Features:** You can add **Charts** (bar, line, pie) and **Filters** to widgets.
       - **Filters (SERVER-SIDE):** Use the \`filters\` array in config. Filters are applied on the server for efficiency.
         - **Supported Operators:**
           - \`equals\` or \`eq\`: Exact match
           - \`neq\` or \`not_equals\`: Not equal
           - \`contains\` or \`like\`: Case-insensitive substring match
           - \`starts_with\`: Value starts with
           - \`ends_with\`: Value ends with
           - \`gt\` or \`greater_than\`: Greater than
           - \`gte\`: Greater than or equal
           - \`lt\` or \`less_than\`: Less than
           - \`lte\`: Less than or equal
           - \`in\`: Value in array (value should be array)
           - \`not_in\`: Value not in array
           - \`is_null\`: Field is null
           - \`is_not_null\`: Field is not null
           - \`between\`: Value between two values (value should be [min, max])
         - **Filterable Fields:** The "Dashboard Data Sources" in context includes a \`filterableFields\` list for each source. You **MUST** use these fields.
           - **Mixed Tables:** Sources like \`api:pharmacy-orders\` or \`api:lab-orders\` support filtering by associated **Patient** data using \`patient_name\`, \`patient_phone\`, and \`token\`.
         - **Example 1:** User: "Show pharmacy orders for John" -> Action: \`render_temporary_dashboard\` with widget config: \`filters: [{ field: 'patient_name', operator: 'contains', value: 'John' }]\`
         - **Example 2:** User: "Show orders for Token 123" -> \`filters: [{ field: 'token', operator: 'equals', value: 123 }]\`
         - **Example 3:** \`filters: [{ field: 'expiry_date', operator: 'lt', value: '2024-01-01' }, { field: 'stock', operator: 'gt', value: 0 }]\`
         - Smartly infer dates for "expired" (lt today), "expiring this week" (between today and next week), etc.
       - **Charts:** Set \`type: 'chart'\`. Config requires \`chartType\`, \`xAxisKey\` (category), \`dataKey\` (value).

**Interpretation Rules:**
- **Analysis Dates:** When the user asks for analysis (financial or inventory) for a specific time range (e.g., "last month", "yesterday"), you **MUST** include \`startDate\` and \`endDate\` in the \`navigate_to\` action for \`/dashboard/analysis\`.
- If the user says "add drug", "buy medicine", or "new stock", they **usually mean "Add Item to Purchase Order"** (use \`add_purchase_items\` or navigate to \`/dashboard/purchase\`).
- **Prerequisite:** If you are using ANY purchase tools (\`add_purchase_items\`, \`search_distributor_purchase\`, \`set_distributor_purchase\`, \`edit_purchase_items\`), you **MUST** include a \`navigate_to\` action with \`page: "/dashboard/purchase"\` as the **FIRST** action in your list, unless you are already on that page.
- **ONLY** use \`update_drug\` (create) if the user explicitly says "create new drug definition" or "add to master inventory".
- The correct route for purchasing is \`/dashboard/purchase\`.

- **Drug Name & Brand Handling (CRITICAL):**
  - "Name" refers to the **Composition Name** (or Generic Name).
  - "Brand Name" refers to the **Brand Name**.
  - **Auto-Computation:** If the user provides a *Brand Name* (e.g., "Tab Dolo 650"), you **MUST** automatically:
    1.  Infer the **Composition** (e.g., "Tab Paracetamol 650mg") and use it for the "name" field.
    2.  Use the provided brand for the "brand_name" field (e.g., "Dolo 650").
    3.  Infer the **pack size** if implied (e.g., "1x10") and use it for the "pack" field.
  - If the user provides only a Brand Name and you cannot confidently infer the Composition, you **MUST** use \`ask_followup_question\` to ask the user for the composition.
  - Apply this logic to both \`add_purchase_items\` and \`update_drug\` actions.

- **Inventory Navigation:** If you execute "update_drug" or "search_pharmacy_inventory", you **MUST** include a "navigate_to" action for "/dashboard/inventory". If you searched for or updated a specific term, append it as "?search=Term" (e.g. "/dashboard/inventory?search=Paracetamol").
- **Lab Navigation:** If you execute "update_lab_test", you **MUST** include a "navigate_to" action for "/lab-inventory", unless you are already on that page.

**Action Tools:**
You can perform the following actions. Return a JSON array of actions.

\`\`\`json
[
    {
        "action": "update_clinic_settings",
        "updates": {
            "admissionCharge": "number string",
            "perDayCharge": "number string",
            "otherCharges": "number string",
            "name": "string",
            "address": "string",
            "notes": "string",
            "logoUrl": "string",
            "upi_id": "string",
            "low_stock_threshold": number,
            "clinicWideSystemPrompt": "string",
            "aiMemory": "string",
            "clinicWideSystemPrompt": "string",
            "aiMemory": "string",
            "gemini_api_key": "string",
            "voice_ai_language": "string (e.g. 'en-US', 'te-IN')"
        }
    },
    {
        "action": "create_staff_member",
        "staff": {
            "name": "string",
            "email": "string",
            "role": "doctor" | "receptionist" | "pharmacy" | "lab",
            "password": "string",
            "opd_fee": number | null
        }
    },
    {
        "action": "update_staff_member",
        "id": "string | number",
        "updates": {
            "name": "string",
            "email": "string",
            "role": "doctor" | "receptionist" | "pharmacy" | "lab",
            "password": "string",
            "opd_fee": number | null,
            "active": boolean
        }
    },
    {
        "action": "set_analysis_dates",
        "startDate": "YYYY-MM-DD",
        "endDate": "YYYY-MM-DD"
    },
    {
        "action": "navigate_to",
        "page": "/dashboard/inventory" | "/lab-inventory" | "/dashboard/queue" | "/dashboard/staff" | "/dashboard/purchase" | "/dashboard/analysis" | "/dashboard/clinic-hub" | "/billing" | "/dashboard/patients",
        "section": "financial" | "inventory" | "string (optional)",
        "startDate": "YYYY-MM-DD (optional, for analysis page)",
        "endDate": "YYYY-MM-DD (optional, for analysis page)"
    },
    {
        "action": "highlight_section",
        "elementId": "string"
    },
    {
        "action": "refresh_analysis"
    },
    {
        "action": "ask_followup_question",
        "question": "string"
    },
    {
        "action": "search_pharmacy_inventory",
        "query": "string (name, brand, or composition)"
    },
    {
        "action": "update_drug",
        "id": "number",
        "updates": {
            "name": "string",
            "brand_name": "string",
            "description": "string",
            "mrp": "number (MRP)",
            "stock": "number",
            "pack": "string (e.g. strip, bottle)",
            "supplier": "string",
            "expiry_date": "YYYY-MM-DD",
            "rate": "number",
            "box_number": "string",
            "gst": "number",
            "margin": "number",
            "discount": "number",
            "batch": "string",
            "hsn_code": "string",
            "mfg": "string",
            "mfg": "string",
            "loose": "number",
            "custom_fields": "object { key: value } (Optional: Update custom field values)"
        }
    },
    {
        "action": "update_lab_test",
        "serial_number": 1,
        "updates": {
            "name": "string",
            "price": "number",
            "description": "string",
            "default_parameters": "array of objects { name, type, defaultValue, unit, lower_limit, upper_limit }"
        }
    },
    {
        "action": "search_lab_inventory",
        "query": "string (test name or description)"
    },
    {
        "action": "create_lab_test",
        "test": {
            "name": "string",
            "price": "number",
            "description": "string (optional)",
            "default_parameters": "array of objects { name, type, defaultValue, unit, lower_limit, upper_limit } (optional)"
        }
    },
    {
        "action": "search_distributor_purchase",
        "query": "string"
    },
    {
        "action": "set_distributor_purchase",
        "distributorId": "string"
    },
    {
        "action": "add_purchase_items",
        "items": [
            {
                "name": "string (Composition Name)",
                "brand_name": "string",
                "stock": "number (quantity)",
                "rate": "number (buying price)",
                "mrp": "number",
                "pack": "string",
                "expiry_date": "YYYY-MM-DD",
                "batch": "string",
                "discount": "number",
                "gst": "number"
            }
        ]
    },
    {
        "action": "edit_purchase_items",
        "updates": [
            {
                "serial_number": "number (The Row # from context)",
                "field": "string (name, stock, rate, etc.)",
                "value": "string | number"
            }
        ]
    },
    {
        "action": "end_task",
        "summary": "string"
    },
    {
        "action": "open_new_case",
        "name": "string (Patient Name)",
        "age": "number (optional)",
        "gender": "M | F | O (optional)",
        "phone": "string (optional)",
        "complaint": "string (The medical complaint/reason)"
    },
    {
        "action": "manage_custom_columns",
        "entity": "patients" | "drugs" | "lab_tests",
        "operation": "add" | "remove",
        "column": {
            "label": "string",
            "type": "text" | "number" | "date" | "boolean",
            "required": boolean
        }
    },
    {
        "action": "create_custom_table",
        "name": "string",
        "description": "string (optional)",
        "columns": [
            {
                "label": "string",
                "type": "text" | "number" | "date" | "boolean",
                "required": boolean
            }
        ]
    },
    {
        "action": "add_table_row",
        "tableId": "string (The ID of the custom table)",
        "data": "object { key: value } (Keys must match column keys derived from labels)"
    },
    {
        "tableId": "string",
        "recordId": "string (The ID of the row/record to update)",
        "data": "object { key: value } (Updates to apply)"
    },
    {
        "action": "create_custom_dashboard",
        "name": "string",
        "description": "string (optional)",
        "widgets": [
            {
                "type": "stat" | "table" | "chart",
                "title": "string",
                "dataSource": "string (one of the keys from Dashboard Data Sources, e.g. api:patients, table:xyz)",
                "config": "object { columns?: string[], label?: string, chartType?: 'bar'|'line'|'pie', xAxisKey?: string, dataKey?: string, filters?: Array<{field, operator, value}> }"
            }
        ]
    },
    {
        "action": "render_temporary_dashboard",
        "title": "string",
        "widgets": [
            {
                "type": "stat" | "table" | "chart",
                "title": "string",
                "dataSource": "string",
                "config": "object { columns?: [], label?, chartType?, xAxisKey?, dataKey?, filters?: [] }"
            }
        ]
    }
]
\`\`\`

**Navigation Reference:**
- **Pharmacy Inventory:** \`/dashboard/inventory\`
- **Lab Inventory:** \`/lab-inventory\`
- **Doctor Queue:** \`/dashboard/queue\`
- **Staff Management:** \`/dashboard/staff\`
- **All Patients:** \`/dashboard/patients\`
- **Billing:** \`/billing\`
- **Purchase Page:** \`/dashboard/purchase\`
- **Analysis:** \`/dashboard/analysis\`
- **Clinic Hub:** \`/dashboard/clinic-hub\`
\`\`\`

**Rules:**
-   **Always** return a JSON array as the last part of your response.
-   If the user's request is satisfied, use the \`end_task\` action with a summary of what was done.
-   If you need more info, use \`ask_followup_question\`.
-   If you perform an action (like updating settings), and there's nothing else to do *immediately* but you want to confirm it's done, you can return the action. The system will execute it and call you back with the result. Then you can \`end_task\`.
-   For \`create_staff_member\`, if password is not provided by user, generate a secure random password and mention it in the summary.
-   Update numeric strings as strings (e.g., "500.00").
-   **CRITICAL DO's and DON'Ts:**
    -   **DO NOT** fill in empty fields (like \`gemini_api_key\`, \`logoUrl\`, \`upi_id\`, etc.) with fake, placeholder, or example data.
    -   **ONLY** update fields that the user *intentionally* asked to change.
    -   **PRESERVE** existing values for any fields not explicitly mentioned in the user's request.
    -   If a field is empty and the user didn't ask to set it, **leave it empty**.
    -   Do not invent values.
`;async function G_(){var n;if(!ox()&&pf)return pf;let a=null;try{const i=await Z("/api/clinics/settings");if(i.ok){const l=await i.json();(n=l.gemini_api_key)!=null&&n.trim()&&(a=l.gemini_api_key.trim())}}catch(i){console.warn("Error fetching updated key",i)}if(a)return a;try{const i=await Z("/api/global-settings/app_gemini_api_key");if(i.ok){const c=(await i.json()).value;if(c&&c.trim()!=="")return c.trim()}}catch(i){console.warn("Could not fetch global API key.",i)}return pf}let ff=null;async function Q_(){if(!ff){const t=await G_();ff=new ex({apiKey:t})}return ff}async function Y_(t,a,n=[],i){var m,f,g,y,b;const l=await Q_(),c=[];c.push({role:"user",parts:[{text:V_}]}),c.push({role:"model",parts:[{text:"Understood. I am ready to assist with Clinic Hub management."}]}),n.forEach(v=>{c.push({role:v.role,parts:[{text:v.text}]})});const h=[{text:`
    Context:
    ${`
    --- Current Clinic Context ---
    Settings: ${JSON.stringify(a.settings,null,2)}
    
    Custom Columns Configuration: ${JSON.stringify(a.settings.custom_columns_config||{},null,2)}

    Custom Tables (Available for adding/editing rows): ${JSON.stringify(a.customTables||[],null,2)}
    
    Dashboard Data Sources (Use these keys for widgets): ${JSON.stringify(a.dashboardDataSources||[],null,2)}

    --- DYNAMIC CONTEXT DATA (Configured tables with <200 rows) ---
    ${Object.entries(a.dynamicContextData||{}).map(([v,w])=>{const S=(w.data||[]).slice(0,50).map((_,E)=>({_sn:E+1,..._}));return`${w.label||v} (${w.count||0} records): ${JSON.stringify(S,null,2)}`}).join(`

`)}
    --- END DYNAMIC CONTEXT ---

    Staff List: ${JSON.stringify(a.staffList.map(v=>({id:v.id||v._id,name:v.name,role:v.role,email:v.email,active:v.active,opd_fee:v.opd_fee})),null,2)}
    
    Previous Action Results (if any): ${JSON.stringify(a.actionResults||[],null,2)}

    Analysis Data (if active): ${JSON.stringify(a.analysisData||{},null,2)}

    Pharmacy Inventory: ${a.pharmacyInventory?JSON.stringify(a.pharmacyInventory,null,2):"Not loaded. Use 'search_pharmacy_inventory' to find items."}

    Distributors List: ${JSON.stringify((a.distributors||[]).map(v=>({serial_number:v.serial_number,name:v.name,contact_person:v.contact_person,phone:v.phone,remainingBalance:v.remainingBalance})),null,2)}

    Lab Tests Inventory: ${JSON.stringify((a.labInventory||[]).map(v=>({serial:v.serial_number,name:v.name,price:v.price,description:v.description,default_parameters:v.default_parameters})),null,2)}

    Current Purchase Page Rows: ${JSON.stringify((a.purchaseRows||[]).map((v,w)=>({serial_number:w+1,name:v.name,stock:v.stock,rate:v.rate,mrp:v.mrp,net_value:(v.stock*v.rate).toFixed(2)})),null,2)}

    Current Application Page Context: ${a.pageContext?JSON.stringify(a.pageContext,null,2):"Unknown/General Dashboard"}
    `}

    User Query/Input:
    ${t}
    `}];if(i){const v=i.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,"");h.push({inlineData:{data:v,mimeType:"image/jpeg"}})}c.push({role:"user",parts:h});try{const v={model:H_,contents:c,generationConfig:{temperature:.7,maxOutputTokens:2048,responseMimeType:"text/plain"}},w=await l.models.generateContentStream(v);let S="";for await(const _ of w){const E=_;E.text&&typeof E.text=="function"?S+=E.text():(b=(y=(g=(f=(m=E.candidates)==null?void 0:m[0])==null?void 0:f.content)==null?void 0:g.parts)==null?void 0:y[0])!=null&&b.text&&(S+=E.candidates[0].content.parts[0].text)}if(!S)throw new Error("Empty response from AI");return S}catch(v){throw console.error("Gemini Interaction Error:",v),new Error("Failed to communicate with AI Assistant.")}}const cx=({settings:t,staffList:a,onSettingsUpdate:n,onStaffUpdate:i,onHighlight:l,enableDynamicContext:c=!1})=>{const o=ft(),{setAnalysisDateRange:d,analysisData:h,analysisNavigate:m,refreshAnalysis:f,pageContext:g}=sm(),{setDistributors:y,setSelectedDistributor:b,setSearchTerm:v,addPurchaseRow:w,updatePurchaseRow:S,distributors:_,purchaseRows:E}=K1(),[D,O]=x.useState(""),M=x.useRef(h),A=x.useRef(E);x.useEffect(()=>{M.current=h},[h]),x.useEffect(()=>{A.current=E},[E]);const[P,Q]=x.useState([]),[G,C]=x.useState([]),[R,z]=x.useState([]),[F,J]=x.useState(!1),[H,I]=x.useState(null),V=x.useRef(!1),re=x.useRef(0),B=5,k=()=>{V.current=!1,J(!1),z(oe=>[...oe,{role:"system",text:" Task stopped by user."}])},Ne=oe=>{const fe=new FileReader;fe.onloadend=()=>{I(fe.result)},fe.readAsDataURL(oe)},Ae=()=>{I(null)},[T,Ce]=x.useState(null),Ue=()=>Ce(null),Pe=async(oe,fe)=>{if(!T)return;const ge={name:oe,description:fe,widgets:T.widgets};if(!(await Z("/api/dashboards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ge)})).ok)throw new Error("Failed to save dashboard");Ce(null)},de=async(oe,fe,ge=[],q)=>{var W,Y,ie;if(V.current){if(re.current+=1,re.current>B){z(ce=>[...ce,{role:"system",text:" Task limit reached. Stopping automatically."}]),J(!1),V.current=!1;return}try{let ce=t,pe=a,He=[],We=[],st=[],me=[],ve=[];try{const[be,ue]=await Promise.all([Z("/api/clinics/settings"),Z("/staff")]);if(be.ok&&ue.ok){const je=await be.json(),ke=await ue.json(),[Me,De,qe,te]=await Promise.all([Z("/api/drugs"),Z("/api/lab-tests"),Z("/api/distributors"),Z("/api/custom-tables"),Z("/api/dashboards/data-sources")]);if(Me.ok){const Re=await Me.json();He=Re.drugs||Re||[]}if(De.ok){const lt=(await De.json()).map((Xe,dt)=>({...Xe,serial_number:dt+1}));We=lt,Q(lt)}if(qe.ok&&(st=(await qe.json()||[]).map((lt,Xe)=>({...lt,serial_number:Xe+1}))),te.ok){const Re=await te.json();me=Re,C(Re)}try{const Re=await Z("/api/dashboards/data-sources");Re.ok&&(ve=await Re.json())}catch(Re){console.warn("Failed to fetch dashboard sources",Re)}ce={...je,admissionCharge:parseFloat(je.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(je.perDayCharge||0).toFixed(2),otherCharges:parseFloat(je.otherCharges||0).toFixed(2),aiMemory:je.aiMemory||"",clinicWideSystemPrompt:je.clinicWideSystemPrompt||"",gemini_api_key:je.gemini_api_key||"",low_stock_threshold:je.low_stock_threshold!==void 0&&je.low_stock_threshold!==null?String(je.low_stock_threshold):"10",name:je.name||"",logoUrl:je.logoUrl||"",upi_id:je.upi_id||"",address:je.address||"",notes:je.notes||"",clinic_id:je.clinic_id},pe=ke.map(Re=>({...Re,id:Re._id||Re.id}))}}catch(be){console.warn("Failed to fetch fresh context for AI loop, falling back to props",be)}let Fe={};if(c)try{const be=await Z("/api/ai-context/data");be.ok&&(Fe=await be.json())}catch(be){console.warn("Failed to fetch dynamic AI context",be)}const Ee={settings:ce,staffList:pe,analysisData:M.current,pharmacyInventory:He.length>50?void 0:He,labInventory:We,distributors:st,purchaseRows:A.current,actionResults:ge,pageContext:g||void 0,customTables:me,dashboardDataSources:ve,dynamicContextData:Fe},L=fe.filter(be=>be.role!=="system"),ne=await Y_(oe,Ee,L,q);if(!V.current)return;let xe=[];try{const be=ne.match(/\[[\s\S]*\]/);if(be)xe=JSON.parse(be[0]);else{z(ue=>[...ue,{role:"model",text:ne}]),J(!1),V.current=!1;return}}catch(be){console.error("Failed to parse AI response",be),z(ue=>[...ue,{role:"model",text:"I'm having trouble processing that. Please try again."}]),J(!1),V.current=!1;return}const ae=[];let we=[],Le=[];for(const be of xe){if(!V.current)break;if(be.action==="end_task"){z(ue=>[...ue,{role:"model",text:be.summary}]),J(!1),V.current=!1;return}if(be.action==="ask_followup_question"){z(ue=>[...ue,{role:"model",text:be.question}]),J(!1),V.current=!1;return}try{if(be.action==="update_clinic_settings"){const ue=be.updates;Object.keys(ue).forEach(Me=>we.push(`setting-${Me}`));const je={...ce,...ue},ke={...je,admissionCharge:parseFloat(je.admissionCharge),perDayCharge:parseFloat(je.perDayCharge),otherCharges:parseFloat(je.otherCharges),low_stock_threshold:parseInt(je.low_stock_threshold)};await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify(ke)}),n&&n(),ae.push({action:"update_clinic_settings",status:"success"}),Le.push({role:"system",text:" Updated clinic settings"})}if(be.action==="create_staff_member"&&(await Z("/api/staff",{method:"POST",body:JSON.stringify({...be.staff,clinic_id:ce.clinic_id})}),i&&i(),ae.push({action:"create_staff_member",status:"success",name:be.staff.name}),Le.push({role:"system",text:` Created staff member: ${be.staff.name}`})),be.action==="update_staff_member"){const ue=be.id;await Z(`/api/staff/${ue}`,{method:"PUT",body:JSON.stringify(be.updates)}),i&&i(),we.push(`staff-member-${ue}`),ae.push({action:"update_staff_member",status:"success",id:ue}),Le.push({role:"system",text:" Updated staff member details"})}if(be.action==="set_analysis_dates"){const{startDate:ue,endDate:je}=be;d({startDate:new Date(ue),endDate:new Date(je)}),ae.push({action:"set_analysis_dates",status:"success",startDate:ue,endDate:je}),Le.push({role:"system",text:` Set analysis dates: ${ue} to ${je}`})}if(be.action==="navigate_to"){let ue=be.page;if(be.page&&be.page.includes("analysis")&&be.startDate&&be.endDate){const je=ue.includes("?")?"&":"?";ue=`${ue}${je}startDate=${be.startDate}&endDate=${be.endDate}`}else be.page&&be.page.includes("analysis")&&((W=M.current)!=null&&W.startDate)&&((Y=M.current)!=null&&Y.endDate);o(ue),be.section&&setTimeout(()=>m(be.section),500),ae.push({action:"navigate_to",status:"success",page:ue}),Le.push({role:"system",text:` Navigated to ${ue}`})}if(be.action==="highlight_section"&&(we.push(be.elementId),ae.push({action:"highlight_section",status:"success",id:be.elementId})),be.action==="refresh_analysis"){Le.push({role:"system",text:" Refreshing analysis data..."});const ue=await f();ue?(M.current=ue,ae.push({action:"refresh_analysis",status:"success",summary:"Data refreshed successfully"}),Le.push({role:"system",text:" Analysis data refreshed"})):(ae.push({action:"refresh_analysis",status:"error",error:"No data returned"}),Le.push({role:"system",text:" Failed to refresh analysis data"}))}if(be.action==="search_pharmacy_inventory"){const ue=be.query.toLowerCase(),je=He.filter(Me=>Me.name&&Me.name.toLowerCase().includes(ue)||Me.brand_name&&Me.brand_name.toLowerCase().includes(ue)||Me.description&&Me.description.toLowerCase().includes(ue)),ke=je.slice(0,10);ae.push({action:"search_pharmacy_inventory",status:"success",count:je.length,results:ke}),je.length>0?Le.push({role:"system",text:` Found ${je.length} matches for "${be.query}". Showing top ${ke.length}.`}):Le.push({role:"system",text:` No matches found for "${be.query}"`})}if(be.action==="update_drug"){const ue=be.id;try{const je=He.find(De=>De.id===ue);if(!je)throw new Error(`Drug with ID ${ue} not found.`);const ke={...be.updates};ke.custom_fields&&(ke.custom_fields={...je.custom_fields||{},...ke.custom_fields});const Me={...je,...ke};await Z(`/api/drugs/${ue}`,{method:"PUT",body:JSON.stringify(Me)}),ae.push({action:"update_drug",status:"success",id:ue,updates:be.updates}),Le.push({role:"system",text:` Updated drug: ${je.name}`}),Ce({title:`Updated: ${je.name}`,widgets:[{id:"edited-drug",type:"table",title:`Drug Updated: ${je.name}`,dataSource:"api:drugs",config:{filters:[{field:"id",operator:"equals",value:ue}],columns:["name","brand_name","stock","mrp","expiry_date","pack"]},position:{x:0,y:0,w:12,h:4}}]})}catch(je){ae.push({action:"update_drug",status:"error",error:je.message}),Le.push({role:"system",text:` Failed to update drug: ${je.message}`})}}if(be.action==="update_lab_test"){const ue=We.find(je=>je.serial_number===be.serial_number);if(ue){const je={...ue,...be.updates};await Z(`/api/lab-tests/${ue.id}`,{method:"PUT",body:JSON.stringify(je)}),ae.push({action:"update_lab_test",status:"success",item:ue.name}),Le.push({role:"system",text:` Updated lab test: ${ue.name}`}),Ce({title:`Updated: ${ue.name}`,widgets:[{id:"edited-lab-test",type:"table",title:`Lab Test Updated: ${ue.name}`,dataSource:"api:lab-tests",config:{filters:[{field:"id",operator:"equals",value:ue.id}],columns:["name","price","description","default_parameters"]},position:{x:0,y:0,w:12,h:4}}]})}else ae.push({action:"update_lab_test",status:"error",error:`Test with serial ${be.serial_number} not found`}),Le.push({role:"system",text:` Lab test with serial ${be.serial_number} not found`})}if(be.action==="search_lab_inventory"){const ue=be.query.toLowerCase(),je=We.filter(Me=>Me.name&&Me.name.toLowerCase().includes(ue)||Me.description&&Me.description.toLowerCase().includes(ue)),ke=je.slice(0,10);ae.push({action:"search_lab_inventory",status:"success",count:je.length,results:ke.map(Me=>({serial_number:Me.serial_number,id:Me.id,name:Me.name,price:Me.price,description:Me.description}))}),je.length>0?Le.push({role:"system",text:` Found ${je.length} lab tests for "${be.query}". Showing top ${ke.length}.`}):Le.push({role:"system",text:` No lab tests found for "${be.query}"`})}if(be.action==="create_lab_test")try{const ue=be.test,je={name:ue.name,price:parseFloat(ue.price)||0,description:ue.description||"",default_parameters:ue.default_parameters||[]},ke=await Z("/api/lab-tests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(je)});if(!ke.ok){const De=await ke.json();throw new Error(De.message||"Failed to create lab test")}const Me=await ke.json();ae.push({action:"create_lab_test",status:"success",id:Me.id,name:ue.name}),Le.push({role:"system",text:` Created lab test: ${ue.name}`}),Ce({title:`Created: ${ue.name}`,widgets:[{id:"created-lab-test",type:"table",title:`New Lab Test: ${ue.name}`,dataSource:"api:lab-tests",config:{filters:[{field:"id",operator:"equals",value:Me.id}],columns:["name","price","description","default_parameters"]},position:{x:0,y:0,w:12,h:4}}]})}catch(ue){ae.push({action:"create_lab_test",status:"error",error:ue.message}),Le.push({role:"system",text:` Failed to create lab test: ${ue.message}`})}if(be.action==="search_distributor_purchase"){const ue=be.query,je=await Z(`/api/distributors?search=${encodeURIComponent(ue)}`);if(je.ok){const ke=await je.json();y(ke),v(ue),ae.push({action:"search_distributor_purchase",status:"success",count:ke.length,results:ke}),Le.push({role:"system",text:` Found ${ke.length} distributors for "${ue}"`})}else ae.push({action:"search_distributor_purchase",status:"error",error:je.statusText}),Le.push({role:"system",text:" Failed to search distributors"})}if(be.action==="set_distributor_purchase"){const ue=be.distributorId;let je=_.find(ke=>ke.id===ue);je?(b(je),v(je.name),ae.push({action:"set_distributor_purchase",status:"success",distributor:je.name}),Le.push({role:"system",text:` Selected distributor: ${je.name}`})):(ae.push({action:"set_distributor_purchase",status:"error",error:"Distributor not found in current search results. Please search first."}),Le.push({role:"system",text:" Distributor not found. Please search first."}))}if(be.action==="add_purchase_items"){const ue=be.items;let je=0;ue.forEach(ke=>{const De={id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:ke.name||"",composition:ke.composition||"",description:ke.description||"",mrp:ke.mrp||0,stock:ke.stock||0,pack:ke.pack||"",supplier:"",expiry_date:ke.expiry_date||"",rate:ke.rate||0,box_number:ke.box_number||"",gst:ke.gst||0,margin:ke.margin||0,discount:ke.discount||0,brand_name:ke.brand_name||"",batch:ke.batch||"",hsn_code:ke.hsn_code||"",mfg:ke.mfg||"",loose:ke.loose||0,last_updated:"",created_at:""};w(De),je++}),ae.push({action:"add_purchase_items",status:"success",count:je}),Le.push({role:"system",text:` Added ${je} items to purchase list`})}if(be.action==="edit_purchase_items"){const ue=be.updates;let je=0;const ke=A.current||[];ue.forEach(Me=>{if(Me.serial_number){const De=Me.serial_number-1,qe=ke[De];qe&&qe.id?(S(qe.id,{[Me.field]:Me.value}),je++):(console.warn(`Row with serial number ${Me.serial_number} not found.`),Le.push({role:"system",text:` Row #${Me.serial_number} not found.`}))}}),ae.push({action:"edit_purchase_items",status:"success",count:je}),Le.push({role:"system",text:` Updated ${je} items`})}if(be.action==="open_new_case"){const{name:ue,age:je,gender:ke,complaint:Me,phone:De}=be;try{const qe=await Z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ue||"New Patient",age:je||null,gender:ke||null,phone:De||null,address:null})});if(!qe.ok){const Xe=await qe.json().catch(()=>({}));throw qe.status===403&&((ie=Xe.message)!=null&&ie.includes("Patient limit"))?new Error(`Patient limit reached: ${Xe.message}`):new Error(Xe.message||"Failed to create patient")}const te=await qe.json();if(!te||!te.id)throw new Error("Created patient has no ID");const Re=await Z("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:te.id,complaint:Me||"New Case"})});if(!Re.ok)throw new Error("Failed to create queue entry");const lt=await Re.json();o(`/dashboard/edit-complaint/${lt.id}`,{state:{initialComplaint:Me}}),ae.push({action:"open_new_case",status:"success",patientId:te.id,queueId:lt.id}),Le.push({role:"system",text:` Opened new case for ${ue}`}),J(!1),V.current=!1;return}catch(qe){qe.message.includes("Patient limit")&&(o("/start-clinic-subscription"),Le.push({role:"system",text:" Patient limit reached. Redirecting to subscription."})),ae.push({action:"open_new_case",status:"error",error:qe.message}),Le.push({role:"system",text:` Failed to open new case: ${qe.message}`})}}if(be.action==="manage_custom_columns"){const{entity:ue,operation:je,column:ke}=be,Me=ce.custom_columns_config||{drugs:[],patients:[],lab_tests:[]};let qe=[...Me[ue]||[]];if(je==="add"){const Re=ke.label.toLowerCase().replace(/[^a-z0-9]/g,"_");qe.some(lt=>lt.key===Re)||qe.push({...ke,key:Re})}else if(je==="remove"){const Re=ke.label.toLowerCase().replace(/[^a-z0-9]/g,"_");qe=qe.filter(lt=>lt.key!==Re&&lt.label!==ke.label)}const te={...Me,[ue]:qe};await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify({...ce,custom_columns_config:te})}),n&&n(),ae.push({action:"manage_custom_columns",status:"success",entity:ue,operation:je,column:ke.label}),Le.push({role:"system",text:` ${je==="add"?"Added":"Removed"} custom column '${ke.label}' for ${ue}`})}if(be.action==="create_custom_table"){const{name:ue,description:je,columns:ke}=be,Me=ke.map(te=>({...te,key:te.label.toLowerCase().replace(/[^a-z0-9]/g,"_")})),De=await Z("/api/custom-tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ue,description:je,columns:Me})});if(!De.ok)throw new Error("Failed to create table");const qe=await De.json();C(te=>[...te,qe]),ae.push({action:"create_custom_table",status:"success",tableId:qe.id}),Le.push({role:"system",text:` Created custom table: ${ue}`})}if(be.action==="add_table_row"){const{tableId:ue,data:je}=be;if(!(await Z(`/api/custom-tables/${ue}/records`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:je})})).ok)throw new Error("Failed to add row");ae.push({action:"add_table_row",status:"success"}),Le.push({role:"system",text:" Added row to table"})}if(be.action==="update_table_row"){const{recordId:ue,data:je}=be;if(!(await Z(`/api/custom-tables/records/${ue}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:je})})).ok)throw new Error("Failed to update row");ae.push({action:"update_table_row",status:"success"}),Le.push({role:"system",text:" Updated row"})}if(be.action==="create_custom_dashboard"){const{name:ue,description:je,widgets:ke}=be,Me=await Z("/api/dashboards",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ue,description:je,widgets:ke})});if(!Me.ok)throw new Error("Failed to create dashboard");const De=await Me.json();ae.push({action:"create_custom_dashboard",status:"success",id:De.id}),Le.push({role:"system",text:` Created dashboard: ${ue}`})}be.action==="render_temporary_dashboard"&&(Ce({title:be.title,widgets:be.widgets}),ae.push({action:"render_temporary_dashboard",status:"success"}),Le.push({role:"system",text:` Showing temporary dashboard: ${be.title}`}))}catch(ue){console.error("Action execution failed",be,ue),ae.push({action:be.action,status:"error",error:ue.message}),Le.push({role:"system",text:` Failed to execute action: ${be.action}`})}}we.length>0&&l&&setTimeout(()=>l(we),500),Le.length>0&&z(be=>[...be,...Le]);const Je=[...ge,...ae],ot=`Reflecting on previous actions: ${JSON.stringify(ae)}. What is the next step? If done, call end_task.`,xt=[...fe,...Le,{role:"model",text:ne},{role:"user",text:ot}];await de(ot,xt,Je,void 0)}catch(ce){console.error(ce),z(pe=>[...pe,{role:"model",text:"Something went wrong."}]),J(!1),V.current=!1}}};return{chatQuery:D,setChatQuery:O,chatHistory:R,isProcessing:F,handleSendMessage:oe=>{const fe=oe!==void 0?oe:D;if(!fe.trim()&&!H)return;V.current=!0,J(!0),re.current=0;const ge={role:"user",text:fe};H&&(ge.text+=" [Image Attached]"),z(W=>[...W,ge]);const q=H||void 0;O(""),I(null),de(fe,R,[],q)},refreshChat:()=>{z([]),O(""),J(!1),V.current=!1,re.current=0,I(null)},stopGeneration:k,selectedImage:H,handleImageSelect:Ne,clearImage:Ae,temporaryDashboard:T,closeTemporaryDashboard:Ue,saveTemporaryDashboard:Pe}};function J_(t,a){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const K_=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,W_=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,X_={};function ov(t,a){return(X_.jsx?W_:K_).test(t)}const Z_=/[ \t\n\f\r]/g;function e2(t){return typeof t=="object"?t.type==="text"?cv(t.value):!1:cv(t)}function cv(t){return t.replace(Z_,"")===""}let zu=class{constructor(a,n,i){this.normal=n,this.property=a,i&&(this.space=i)}};zu.prototype.normal={};zu.prototype.property={};zu.prototype.space=void 0;function X1(t,a){const n={},i={};for(const l of t)Object.assign(n,l.property),Object.assign(i,l.normal);return new zu(n,i,a)}function bg(t){return t.toLowerCase()}let _a=class{constructor(a,n){this.attribute=n,this.property=a}};_a.prototype.attribute="";_a.prototype.booleanish=!1;_a.prototype.boolean=!1;_a.prototype.commaOrSpaceSeparated=!1;_a.prototype.commaSeparated=!1;_a.prototype.defined=!1;_a.prototype.mustUseProperty=!1;_a.prototype.number=!1;_a.prototype.overloadedBoolean=!1;_a.prototype.property="";_a.prototype.spaceSeparated=!1;_a.prototype.space=void 0;let t2=0;const Ot=Nl(),An=Nl(),Z1=Nl(),tt=Nl(),hn=Nl(),Ao=Nl(),Ba=Nl();function Nl(){return 2**++t2}const jg=Object.freeze(Object.defineProperty({__proto__:null,boolean:Ot,booleanish:An,commaOrSpaceSeparated:Ba,commaSeparated:Ao,number:tt,overloadedBoolean:Z1,spaceSeparated:hn},Symbol.toStringTag,{value:"Module"})),gf=Object.keys(jg);let ux=class extends _a{constructor(a,n,i,l){let c=-1;if(super(a,n),uv(this,"space",l),typeof i=="number")for(;++c<gf.length;){const o=gf[c];uv(this,gf[c],(i&jg[o])===jg[o])}}};ux.prototype.defined=!0;function uv(t,a,n){n&&(t[a]=n)}function Go(t){const a={},n={};for(const[i,l]of Object.entries(t.properties)){const c=new ux(i,t.transform(t.attributes||{},i),l,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(c.mustUseProperty=!0),a[i]=c,n[bg(i)]=i,n[bg(c.attribute)]=i}return new zu(a,n,t.space)}const eN=Go({properties:{ariaActiveDescendant:null,ariaAtomic:An,ariaAutoComplete:null,ariaBusy:An,ariaChecked:An,ariaColCount:tt,ariaColIndex:tt,ariaColSpan:tt,ariaControls:hn,ariaCurrent:null,ariaDescribedBy:hn,ariaDetails:null,ariaDisabled:An,ariaDropEffect:hn,ariaErrorMessage:null,ariaExpanded:An,ariaFlowTo:hn,ariaGrabbed:An,ariaHasPopup:null,ariaHidden:An,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:hn,ariaLevel:tt,ariaLive:null,ariaModal:An,ariaMultiLine:An,ariaMultiSelectable:An,ariaOrientation:null,ariaOwns:hn,ariaPlaceholder:null,ariaPosInSet:tt,ariaPressed:An,ariaReadOnly:An,ariaRelevant:null,ariaRequired:An,ariaRoleDescription:hn,ariaRowCount:tt,ariaRowIndex:tt,ariaRowSpan:tt,ariaSelected:An,ariaSetSize:tt,ariaSort:null,ariaValueMax:tt,ariaValueMin:tt,ariaValueNow:tt,ariaValueText:null,role:null},transform(t,a){return a==="role"?a:"aria-"+a.slice(4).toLowerCase()}});function tN(t,a){return a in t?t[a]:a}function nN(t,a){return tN(t,a.toLowerCase())}const n2=Go({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ao,acceptCharset:hn,accessKey:hn,action:null,allow:null,allowFullScreen:Ot,allowPaymentRequest:Ot,allowUserMedia:Ot,alt:null,as:null,async:Ot,autoCapitalize:null,autoComplete:hn,autoFocus:Ot,autoPlay:Ot,blocking:hn,capture:null,charSet:null,checked:Ot,cite:null,className:hn,cols:tt,colSpan:null,content:null,contentEditable:An,controls:Ot,controlsList:hn,coords:tt|Ao,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Ot,defer:Ot,dir:null,dirName:null,disabled:Ot,download:Z1,draggable:An,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Ot,formTarget:null,headers:hn,height:tt,hidden:Ot,high:tt,href:null,hrefLang:null,htmlFor:hn,httpEquiv:hn,id:null,imageSizes:null,imageSrcSet:null,inert:Ot,inputMode:null,integrity:null,is:null,isMap:Ot,itemId:null,itemProp:hn,itemRef:hn,itemScope:Ot,itemType:hn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Ot,low:tt,manifest:null,max:null,maxLength:tt,media:null,method:null,min:null,minLength:tt,multiple:Ot,muted:Ot,name:null,nonce:null,noModule:Ot,noValidate:Ot,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Ot,optimum:tt,pattern:null,ping:hn,placeholder:null,playsInline:Ot,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Ot,referrerPolicy:null,rel:hn,required:Ot,reversed:Ot,rows:tt,rowSpan:tt,sandbox:hn,scope:null,scoped:Ot,seamless:Ot,selected:Ot,shadowRootClonable:Ot,shadowRootDelegatesFocus:Ot,shadowRootMode:null,shape:null,size:tt,sizes:null,slot:null,span:tt,spellCheck:An,src:null,srcDoc:null,srcLang:null,srcSet:null,start:tt,step:null,style:null,tabIndex:tt,target:null,title:null,translate:null,type:null,typeMustMatch:Ot,useMap:null,value:An,width:tt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:hn,axis:null,background:null,bgColor:null,border:tt,borderColor:null,bottomMargin:tt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Ot,declare:Ot,event:null,face:null,frame:null,frameBorder:null,hSpace:tt,leftMargin:tt,link:null,longDesc:null,lowSrc:null,marginHeight:tt,marginWidth:tt,noResize:Ot,noHref:Ot,noShade:Ot,noWrap:Ot,object:null,profile:null,prompt:null,rev:null,rightMargin:tt,rules:null,scheme:null,scrolling:An,standby:null,summary:null,text:null,topMargin:tt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:tt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Ot,disableRemotePlayback:Ot,prefix:null,property:null,results:tt,security:null,unselectable:null},space:"html",transform:nN}),a2=Go({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ba,accentHeight:tt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:tt,amplitude:tt,arabicForm:null,ascent:tt,attributeName:null,attributeType:null,azimuth:tt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:tt,by:null,calcMode:null,capHeight:tt,className:hn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:tt,diffuseConstant:tt,direction:null,display:null,dur:null,divisor:tt,dominantBaseline:null,download:Ot,dx:null,dy:null,edgeMode:null,editable:null,elevation:tt,enableBackground:null,end:null,event:null,exponent:tt,externalResourcesRequired:null,fill:null,fillOpacity:tt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ao,g2:Ao,glyphName:Ao,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:tt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:tt,horizOriginX:tt,horizOriginY:tt,id:null,ideographic:tt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:tt,k:tt,k1:tt,k2:tt,k3:tt,k4:tt,kernelMatrix:Ba,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:tt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:tt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:tt,overlineThickness:tt,paintOrder:null,panose1:null,path:null,pathLength:tt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:hn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:tt,pointsAtY:tt,pointsAtZ:tt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ba,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ba,rev:Ba,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ba,requiredFeatures:Ba,requiredFonts:Ba,requiredFormats:Ba,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:tt,specularExponent:tt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:tt,strikethroughThickness:tt,string:null,stroke:null,strokeDashArray:Ba,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:tt,strokeOpacity:tt,strokeWidth:null,style:null,surfaceScale:tt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ba,tabIndex:tt,tableValues:null,target:null,targetX:tt,targetY:tt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ba,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:tt,underlineThickness:tt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:tt,values:null,vAlphabetic:tt,vMathematical:tt,vectorEffect:null,vHanging:tt,vIdeographic:tt,version:null,vertAdvY:tt,vertOriginX:tt,vertOriginY:tt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:tt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:tN}),aN=Go({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,a){return"xlink:"+a.slice(5).toLowerCase()}}),sN=Go({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:nN}),iN=Go({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,a){return"xml:"+a.slice(3).toLowerCase()}}),s2={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},i2=/[A-Z]/g,dv=/-[a-z]/g,r2=/^data[-\w.:]+$/i;function l2(t,a){const n=bg(a);let i=a,l=_a;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&r2.test(a)){if(a.charAt(4)==="-"){const c=a.slice(5).replace(dv,c2);i="data"+c.charAt(0).toUpperCase()+c.slice(1)}else{const c=a.slice(4);if(!dv.test(c)){let o=c.replace(i2,o2);o.charAt(0)!=="-"&&(o="-"+o),a="data"+o}}l=ux}return new l(i,a)}function o2(t){return"-"+t.toLowerCase()}function c2(t){return t.charAt(1).toUpperCase()}const u2=X1([eN,n2,aN,sN,iN],"html"),dx=X1([eN,a2,aN,sN,iN],"svg");function d2(t){return t.join(" ").trim()}var xo={},xf,hv;function h2(){if(hv)return xf;hv=1;var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,a=/\n/g,n=/^\s*/,i=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,l=/^:\s*/,c=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,o=/^[;\s]*/,d=/^\s+|\s+$/g,h=`
`,m="/",f="*",g="",y="comment",b="declaration";xf=function(w,S){if(typeof w!="string")throw new TypeError("First argument must be a string");if(!w)return[];S=S||{};var _=1,E=1;function D(F){var J=F.match(a);J&&(_+=J.length);var H=F.lastIndexOf(h);E=~H?F.length-H:E+F.length}function O(){var F={line:_,column:E};return function(J){return J.position=new M(F),Q(),J}}function M(F){this.start=F,this.end={line:_,column:E},this.source=S.source}M.prototype.content=w;function A(F){var J=new Error(S.source+":"+_+":"+E+": "+F);if(J.reason=F,J.filename=S.source,J.line=_,J.column=E,J.source=w,!S.silent)throw J}function P(F){var J=F.exec(w);if(J){var H=J[0];return D(H),w=w.slice(H.length),J}}function Q(){P(n)}function G(F){var J;for(F=F||[];J=C();)J!==!1&&F.push(J);return F}function C(){var F=O();if(!(m!=w.charAt(0)||f!=w.charAt(1))){for(var J=2;g!=w.charAt(J)&&(f!=w.charAt(J)||m!=w.charAt(J+1));)++J;if(J+=2,g===w.charAt(J-1))return A("End of comment missing");var H=w.slice(2,J-2);return E+=2,D(H),w=w.slice(J),E+=2,F({type:y,comment:H})}}function R(){var F=O(),J=P(i);if(J){if(C(),!P(l))return A("property missing ':'");var H=P(c),I=F({type:b,property:v(J[0].replace(t,g)),value:H?v(H[0].replace(t,g)):g});return P(o),I}}function z(){var F=[];G(F);for(var J;J=R();)J!==!1&&(F.push(J),G(F));return F}return Q(),z()};function v(w){return w?w.replace(d,g):g}return xf}var mv;function m2(){if(mv)return xo;mv=1;var t=xo&&xo.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(xo,"__esModule",{value:!0}),xo.default=n;var a=t(h2());function n(i,l){var c=null;if(!i||typeof i!="string")return c;var o=(0,a.default)(i),d=typeof l=="function";return o.forEach(function(h){if(h.type==="declaration"){var m=h.property,f=h.value;d?l(m,f,h):f&&(c=c||{},c[m]=f)}}),c}return xo}var cu={},pv;function p2(){if(pv)return cu;pv=1,Object.defineProperty(cu,"__esModule",{value:!0}),cu.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,a=/-([a-z])/g,n=/^[^-]+$/,i=/^-(webkit|moz|ms|o|khtml)-/,l=/^-(ms)-/,c=function(m){return!m||n.test(m)||t.test(m)},o=function(m,f){return f.toUpperCase()},d=function(m,f){return"".concat(f,"-")},h=function(m,f){return f===void 0&&(f={}),c(m)?m:(m=m.toLowerCase(),f.reactCompat?m=m.replace(l,d):m=m.replace(i,d),m.replace(a,o))};return cu.camelCase=h,cu}var uu,fv;function f2(){if(fv)return uu;fv=1;var t=uu&&uu.__importDefault||function(l){return l&&l.__esModule?l:{default:l}},a=t(m2()),n=p2();function i(l,c){var o={};return!l||typeof l!="string"||(0,a.default)(l,function(d,h){d&&h&&(o[(0,n.camelCase)(d,c)]=h)}),o}return i.default=i,uu=i,uu}var g2=f2();const x2=Pu(g2),rN=lN("end"),hx=lN("start");function lN(t){return a;function a(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function y2(t){const a=hx(t),n=rN(t);if(a&&n)return{start:a,end:n}}function xu(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?gv(t.position):"start"in t||"end"in t?gv(t):"line"in t||"column"in t?vg(t):""}function vg(t){return xv(t&&t.line)+":"+xv(t&&t.column)}function gv(t){return vg(t&&t.start)+"-"+vg(t&&t.end)}function xv(t){return t&&typeof t=="number"?t:1}let Zn=class extends Error{constructor(a,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let l="",c={},o=!1;if(n&&("line"in n&&"column"in n?c={place:n}:"start"in n&&"end"in n?c={place:n}:"type"in n?c={ancestors:[n],place:n.position}:c={...n}),typeof a=="string"?l=a:!c.cause&&a&&(o=!0,l=a.message,c.cause=a),!c.ruleId&&!c.source&&typeof i=="string"){const h=i.indexOf(":");h===-1?c.ruleId=i:(c.source=i.slice(0,h),c.ruleId=i.slice(h+1))}if(!c.place&&c.ancestors&&c.ancestors){const h=c.ancestors[c.ancestors.length-1];h&&(c.place=h.position)}const d=c.place&&"start"in c.place?c.place.start:c.place;this.ancestors=c.ancestors||void 0,this.cause=c.cause||void 0,this.column=d?d.column:void 0,this.fatal=void 0,this.file,this.message=l,this.line=d?d.line:void 0,this.name=xu(c.place)||"1:1",this.place=c.place||void 0,this.reason=this.message,this.ruleId=c.ruleId||void 0,this.source=c.source||void 0,this.stack=o&&c.cause&&typeof c.cause.stack=="string"?c.cause.stack:"",this.actual,this.expected,this.note,this.url}};Zn.prototype.file="";Zn.prototype.name="";Zn.prototype.reason="";Zn.prototype.message="";Zn.prototype.stack="";Zn.prototype.column=void 0;Zn.prototype.line=void 0;Zn.prototype.ancestors=void 0;Zn.prototype.cause=void 0;Zn.prototype.fatal=void 0;Zn.prototype.place=void 0;Zn.prototype.ruleId=void 0;Zn.prototype.source=void 0;const mx={}.hasOwnProperty,b2=new Map,j2=/[A-Z]/g,v2=new Set(["table","tbody","thead","tfoot","tr"]),N2=new Set(["td","th"]),oN="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function w2(t,a){if(!a||a.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=a.filePath||void 0;let i;if(a.development){if(typeof a.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");i=A2(n,a.jsxDEV)}else{if(typeof a.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof a.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");i=T2(n,a.jsx,a.jsxs)}const l={Fragment:a.Fragment,ancestors:[],components:a.components||{},create:i,elementAttributeNameCase:a.elementAttributeNameCase||"react",evaluater:a.createEvaluater?a.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:a.ignoreInvalidStyle||!1,passKeys:a.passKeys!==!1,passNode:a.passNode||!1,schema:a.space==="svg"?dx:u2,stylePropertyNameCase:a.stylePropertyNameCase||"dom",tableCellAlignToStyle:a.tableCellAlignToStyle!==!1},c=cN(l,t,void 0);return c&&typeof c!="string"?c:l.create(t,l.Fragment,{children:c||void 0},void 0)}function cN(t,a,n){if(a.type==="element")return S2(t,a,n);if(a.type==="mdxFlowExpression"||a.type==="mdxTextExpression")return k2(t,a);if(a.type==="mdxJsxFlowElement"||a.type==="mdxJsxTextElement")return _2(t,a,n);if(a.type==="mdxjsEsm")return C2(t,a);if(a.type==="root")return D2(t,a,n);if(a.type==="text")return E2(t,a)}function S2(t,a,n){const i=t.schema;let l=i;a.tagName.toLowerCase()==="svg"&&i.space==="html"&&(l=dx,t.schema=l),t.ancestors.push(a);const c=dN(t,a.tagName,!1),o=P2(t,a);let d=fx(t,a);return v2.has(a.tagName)&&(d=d.filter(function(h){return typeof h=="string"?!e2(h):!0})),uN(t,o,c,a),px(o,d),t.ancestors.pop(),t.schema=i,t.create(a,c,o,n)}function k2(t,a){if(a.data&&a.data.estree&&t.evaluater){const i=a.data.estree.body[0];return i.type,t.evaluater.evaluateExpression(i.expression)}Cu(t,a.position)}function C2(t,a){if(a.data&&a.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(a.data.estree);Cu(t,a.position)}function _2(t,a,n){const i=t.schema;let l=i;a.name==="svg"&&i.space==="html"&&(l=dx,t.schema=l),t.ancestors.push(a);const c=a.name===null?t.Fragment:dN(t,a.name,!0),o=R2(t,a),d=fx(t,a);return uN(t,o,c,a),px(o,d),t.ancestors.pop(),t.schema=i,t.create(a,c,o,n)}function D2(t,a,n){const i={};return px(i,fx(t,a)),t.create(a,t.Fragment,i,n)}function E2(t,a){return a.value}function uN(t,a,n,i){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(a.node=i)}function px(t,a){if(a.length>0){const n=a.length>1?a:a[0];n&&(t.children=n)}}function T2(t,a,n){return i;function i(l,c,o,d){const m=Array.isArray(o.children)?n:a;return d?m(c,o,d):m(c,o)}}function A2(t,a){return n;function n(i,l,c,o){const d=Array.isArray(c.children),h=hx(i);return a(l,c,o,d,{columnNumber:h?h.column-1:void 0,fileName:t,lineNumber:h?h.line:void 0},void 0)}}function P2(t,a){const n={};let i,l;for(l in a.properties)if(l!=="children"&&mx.call(a.properties,l)){const c=O2(t,l,a.properties[l]);if(c){const[o,d]=c;t.tableCellAlignToStyle&&o==="align"&&typeof d=="string"&&N2.has(a.tagName)?i=d:n[o]=d}}if(i){const c=n.style||(n.style={});c[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=i}return n}function R2(t,a){const n={};for(const i of a.attributes)if(i.type==="mdxJsxExpressionAttribute")if(i.data&&i.data.estree&&t.evaluater){const c=i.data.estree.body[0];c.type;const o=c.expression;o.type;const d=o.properties[0];d.type,Object.assign(n,t.evaluater.evaluateExpression(d.argument))}else Cu(t,a.position);else{const l=i.name;let c;if(i.value&&typeof i.value=="object")if(i.value.data&&i.value.data.estree&&t.evaluater){const d=i.value.data.estree.body[0];d.type,c=t.evaluater.evaluateExpression(d.expression)}else Cu(t,a.position);else c=i.value===null?!0:i.value;n[l]=c}return n}function fx(t,a){const n=[];let i=-1;const l=t.passKeys?new Map:b2;for(;++i<a.children.length;){const c=a.children[i];let o;if(t.passKeys){const h=c.type==="element"?c.tagName:c.type==="mdxJsxFlowElement"||c.type==="mdxJsxTextElement"?c.name:void 0;if(h){const m=l.get(h)||0;o=h+"-"+m,l.set(h,m+1)}}const d=cN(t,c,o);d!==void 0&&n.push(d)}return n}function O2(t,a,n){const i=l2(t.schema,a);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=i.commaSeparated?J_(n):d2(n)),i.property==="style"){let l=typeof n=="object"?n:I2(t,String(n));return t.stylePropertyNameCase==="css"&&(l=z2(l)),["style",l]}return[t.elementAttributeNameCase==="react"&&i.space?s2[i.property]||i.property:i.attribute,n]}}function I2(t,a){try{return x2(a,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const i=n,l=new Zn("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw l.file=t.filePath||void 0,l.url=oN+"#cannot-parse-style-attribute",l}}function dN(t,a,n){let i;if(!n)i={type:"Literal",value:a};else if(a.includes(".")){const l=a.split(".");let c=-1,o;for(;++c<l.length;){const d=ov(l[c])?{type:"Identifier",name:l[c]}:{type:"Literal",value:l[c]};o=o?{type:"MemberExpression",object:o,property:d,computed:!!(c&&d.type==="Literal"),optional:!1}:d}i=o}else i=ov(a)&&!/^[a-z]/.test(a)?{type:"Identifier",name:a}:{type:"Literal",value:a};if(i.type==="Literal"){const l=i.value;return mx.call(t.components,l)?t.components[l]:l}if(t.evaluater)return t.evaluater.evaluateExpression(i);Cu(t)}function Cu(t,a){const n=new Zn("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:a,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=oN+"#cannot-handle-mdx-estrees-without-createevaluater",n}function z2(t){const a={};let n;for(n in t)mx.call(t,n)&&(a[F2(n)]=t[n]);return a}function F2(t){let a=t.replace(j2,L2);return a.slice(0,3)==="ms-"&&(a="-"+a),a}function L2(t){return"-"+t.toLowerCase()}const yf={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},$2={};function gx(t,a){const n=$2,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,l=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return hN(t,i,l)}function hN(t,a,n){if(M2(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(a&&"alt"in t&&t.alt)return t.alt;if("children"in t)return yv(t.children,a,n)}return Array.isArray(t)?yv(t,a,n):""}function yv(t,a,n){const i=[];let l=-1;for(;++l<t.length;)i[l]=hN(t[l],a,n);return i.join("")}function M2(t){return!!(t&&typeof t=="object")}const bv=document.createElement("i");function xx(t){const a="&"+t+";";bv.innerHTML=a;const n=bv.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===a?!1:n}function Ga(t,a,n,i){const l=t.length;let c=0,o;if(a<0?a=-a>l?0:l+a:a=a>l?l:a,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(a,n),t.splice(...o);else for(n&&t.splice(a,n);c<i.length;)o=i.slice(c,c+1e4),o.unshift(a,0),t.splice(...o),c+=1e4,a+=1e4}function ls(t,a){return t.length>0?(Ga(t,t.length,0,a),t):a}const jv={}.hasOwnProperty;function mN(t){const a={};let n=-1;for(;++n<t.length;)B2(a,t[n]);return a}function B2(t,a){let n;for(n in a){const l=(jv.call(t,n)?t[n]:void 0)||(t[n]={}),c=a[n];let o;if(c)for(o in c){jv.call(l,o)||(l[o]=[]);const d=c[o];U2(l[o],Array.isArray(d)?d:d?[d]:[])}}}function U2(t,a){let n=-1;const i=[];for(;++n<a.length;)(a[n].add==="after"?t:i).push(a[n]);Ga(t,0,0,i)}function pN(t,a){const n=Number.parseInt(t,a);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function ws(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ha=Dr(/[A-Za-z]/),Xn=Dr(/[\dA-Za-z]/),q2=Dr(/[#-'*+\--9=?A-Z^-~]/);function Mh(t){return t!==null&&(t<32||t===127)}const Ng=Dr(/\d/),H2=Dr(/[\dA-Fa-f]/),V2=Dr(/[!-/:-@[-`{-~]/);function vt(t){return t!==null&&t<-2}function un(t){return t!==null&&(t<0||t===32)}function Ut(t){return t===-2||t===-1||t===32}const im=Dr(new RegExp("\\p{P}|\\p{S}","u")),yl=Dr(/\s/);function Dr(t){return a;function a(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Qo(t){const a=[];let n=-1,i=0,l=0;for(;++n<t.length;){const c=t.charCodeAt(n);let o="";if(c===37&&Xn(t.charCodeAt(n+1))&&Xn(t.charCodeAt(n+2)))l=2;else if(c<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(c))||(o=String.fromCharCode(c));else if(c>55295&&c<57344){const d=t.charCodeAt(n+1);c<56320&&d>56319&&d<57344?(o=String.fromCharCode(c,d),l=1):o=""}else o=String.fromCharCode(c);o&&(a.push(t.slice(i,n),encodeURIComponent(o)),i=n+l+1,o=""),l&&(n+=l,l=0)}return a.join("")+t.slice(i)}function Gt(t,a,n,i){const l=i?i-1:Number.POSITIVE_INFINITY;let c=0;return o;function o(h){return Ut(h)?(t.enter(n),d(h)):a(h)}function d(h){return Ut(h)&&c++<l?(t.consume(h),d):(t.exit(n),a(h))}}const G2={tokenize:Q2};function Q2(t){const a=t.attempt(this.parser.constructs.contentInitial,i,l);let n;return a;function i(d){if(d===null){t.consume(d);return}return t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),Gt(t,a,"linePrefix")}function l(d){return t.enter("paragraph"),c(d)}function c(d){const h=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=h),n=h,o(d)}function o(d){if(d===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(d);return}return vt(d)?(t.consume(d),t.exit("chunkText"),c):(t.consume(d),o)}}const Y2={tokenize:J2},vv={tokenize:K2};function J2(t){const a=this,n=[];let i=0,l,c,o;return d;function d(D){if(i<n.length){const O=n[i];return a.containerState=O[1],t.attempt(O[0].continuation,h,m)(D)}return m(D)}function h(D){if(i++,a.containerState._closeFlow){a.containerState._closeFlow=void 0,l&&E();const O=a.events.length;let M=O,A;for(;M--;)if(a.events[M][0]==="exit"&&a.events[M][1].type==="chunkFlow"){A=a.events[M][1].end;break}_(i);let P=O;for(;P<a.events.length;)a.events[P][1].end={...A},P++;return Ga(a.events,M+1,0,a.events.slice(O)),a.events.length=P,m(D)}return d(D)}function m(D){if(i===n.length){if(!l)return y(D);if(l.currentConstruct&&l.currentConstruct.concrete)return v(D);a.interrupt=!!(l.currentConstruct&&!l._gfmTableDynamicInterruptHack)}return a.containerState={},t.check(vv,f,g)(D)}function f(D){return l&&E(),_(i),y(D)}function g(D){return a.parser.lazy[a.now().line]=i!==n.length,o=a.now().offset,v(D)}function y(D){return a.containerState={},t.attempt(vv,b,v)(D)}function b(D){return i++,n.push([a.currentConstruct,a.containerState]),y(D)}function v(D){if(D===null){l&&E(),_(0),t.consume(D);return}return l=l||a.parser.flow(a.now()),t.enter("chunkFlow",{_tokenizer:l,contentType:"flow",previous:c}),w(D)}function w(D){if(D===null){S(t.exit("chunkFlow"),!0),_(0),t.consume(D);return}return vt(D)?(t.consume(D),S(t.exit("chunkFlow")),i=0,a.interrupt=void 0,d):(t.consume(D),w)}function S(D,O){const M=a.sliceStream(D);if(O&&M.push(null),D.previous=c,c&&(c.next=D),c=D,l.defineSkip(D.start),l.write(M),a.parser.lazy[D.start.line]){let A=l.events.length;for(;A--;)if(l.events[A][1].start.offset<o&&(!l.events[A][1].end||l.events[A][1].end.offset>o))return;const P=a.events.length;let Q=P,G,C;for(;Q--;)if(a.events[Q][0]==="exit"&&a.events[Q][1].type==="chunkFlow"){if(G){C=a.events[Q][1].end;break}G=!0}for(_(i),A=P;A<a.events.length;)a.events[A][1].end={...C},A++;Ga(a.events,Q+1,0,a.events.slice(P)),a.events.length=A}}function _(D){let O=n.length;for(;O-- >D;){const M=n[O];a.containerState=M[1],M[0].exit.call(a,t)}n.length=D}function E(){l.write([null]),c=void 0,l=void 0,a.containerState._closeFlow=void 0}}function K2(t,a,n){return Gt(t,t.attempt(this.parser.constructs.document,a,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Ho(t){if(t===null||un(t)||yl(t))return 1;if(im(t))return 2}function rm(t,a,n){const i=[];let l=-1;for(;++l<t.length;){const c=t[l].resolveAll;c&&!i.includes(c)&&(a=c(a,n),i.push(c))}return a}const wg={name:"attention",resolveAll:W2,tokenize:X2};function W2(t,a){let n=-1,i,l,c,o,d,h,m,f;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&a.sliceSerialize(t[i][1]).charCodeAt(0)===a.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;h=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const g={...t[i][1].end},y={...t[n][1].start};Nv(g,-h),Nv(y,h),o={type:h>1?"strongSequence":"emphasisSequence",start:g,end:{...t[i][1].end}},d={type:h>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:y},c={type:h>1?"strongText":"emphasisText",start:{...t[i][1].end},end:{...t[n][1].start}},l={type:h>1?"strong":"emphasis",start:{...o.start},end:{...d.end}},t[i][1].end={...o.start},t[n][1].start={...d.end},m=[],t[i][1].end.offset-t[i][1].start.offset&&(m=ls(m,[["enter",t[i][1],a],["exit",t[i][1],a]])),m=ls(m,[["enter",l,a],["enter",o,a],["exit",o,a],["enter",c,a]]),m=ls(m,rm(a.parser.constructs.insideSpan.null,t.slice(i+1,n),a)),m=ls(m,[["exit",c,a],["enter",d,a],["exit",d,a],["exit",l,a]]),t[n][1].end.offset-t[n][1].start.offset?(f=2,m=ls(m,[["enter",t[n][1],a],["exit",t[n][1],a]])):f=0,Ga(t,i-1,n-i+3,m),n=i+m.length-f-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function X2(t,a){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,l=Ho(i);let c;return o;function o(h){return c=h,t.enter("attentionSequence"),d(h)}function d(h){if(h===c)return t.consume(h),d;const m=t.exit("attentionSequence"),f=Ho(h),g=!f||f===2&&l||n.includes(h),y=!l||l===2&&f||n.includes(i);return m._open=!!(c===42?g:g&&(l||!y)),m._close=!!(c===42?y:y&&(f||!g)),a(h)}}function Nv(t,a){t.column+=a,t.offset+=a,t._bufferIndex+=a}const Z2={name:"autolink",tokenize:eD};function eD(t,a,n){let i=0;return l;function l(b){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),c}function c(b){return ha(b)?(t.consume(b),o):b===64?n(b):m(b)}function o(b){return b===43||b===45||b===46||Xn(b)?(i=1,d(b)):m(b)}function d(b){return b===58?(t.consume(b),i=0,h):(b===43||b===45||b===46||Xn(b))&&i++<32?(t.consume(b),d):(i=0,m(b))}function h(b){return b===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.exit("autolink"),a):b===null||b===32||b===60||Mh(b)?n(b):(t.consume(b),h)}function m(b){return b===64?(t.consume(b),f):q2(b)?(t.consume(b),m):n(b)}function f(b){return Xn(b)?g(b):n(b)}function g(b){return b===46?(t.consume(b),i=0,f):b===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.exit("autolink"),a):y(b)}function y(b){if((b===45||Xn(b))&&i++<63){const v=b===45?y:g;return t.consume(b),v}return n(b)}}const Fu={partial:!0,tokenize:tD};function tD(t,a,n){return i;function i(c){return Ut(c)?Gt(t,l,"linePrefix")(c):l(c)}function l(c){return c===null||vt(c)?a(c):n(c)}}const fN={continuation:{tokenize:aD},exit:sD,name:"blockQuote",tokenize:nD};function nD(t,a,n){const i=this;return l;function l(o){if(o===62){const d=i.containerState;return d.open||(t.enter("blockQuote",{_container:!0}),d.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),c}return n(o)}function c(o){return Ut(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),a):(t.exit("blockQuotePrefix"),a(o))}}function aD(t,a,n){const i=this;return l;function l(o){return Ut(o)?Gt(t,c,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):c(o)}function c(o){return t.attempt(fN,a,n)(o)}}function sD(t){t.exit("blockQuote")}const gN={name:"characterEscape",tokenize:iD};function iD(t,a,n){return i;function i(c){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(c),t.exit("escapeMarker"),l}function l(c){return V2(c)?(t.enter("characterEscapeValue"),t.consume(c),t.exit("characterEscapeValue"),t.exit("characterEscape"),a):n(c)}}const xN={name:"characterReference",tokenize:rD};function rD(t,a,n){const i=this;let l=0,c,o;return d;function d(g){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),h}function h(g){return g===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(g),t.exit("characterReferenceMarkerNumeric"),m):(t.enter("characterReferenceValue"),c=31,o=Xn,f(g))}function m(g){return g===88||g===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(g),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),c=6,o=H2,f):(t.enter("characterReferenceValue"),c=7,o=Ng,f(g))}function f(g){if(g===59&&l){const y=t.exit("characterReferenceValue");return o===Xn&&!xx(i.sliceSerialize(y))?n(g):(t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),t.exit("characterReference"),a)}return o(g)&&l++<c?(t.consume(g),f):n(g)}}const wv={partial:!0,tokenize:oD},Sv={concrete:!0,name:"codeFenced",tokenize:lD};function lD(t,a,n){const i=this,l={partial:!0,tokenize:M};let c=0,o=0,d;return h;function h(A){return m(A)}function m(A){const P=i.events[i.events.length-1];return c=P&&P[1].type==="linePrefix"?P[2].sliceSerialize(P[1],!0).length:0,d=A,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),f(A)}function f(A){return A===d?(o++,t.consume(A),f):o<3?n(A):(t.exit("codeFencedFenceSequence"),Ut(A)?Gt(t,g,"whitespace")(A):g(A))}function g(A){return A===null||vt(A)?(t.exit("codeFencedFence"),i.interrupt?a(A):t.check(wv,w,O)(A)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),y(A))}function y(A){return A===null||vt(A)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),g(A)):Ut(A)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Gt(t,b,"whitespace")(A)):A===96&&A===d?n(A):(t.consume(A),y)}function b(A){return A===null||vt(A)?g(A):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),v(A))}function v(A){return A===null||vt(A)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),g(A)):A===96&&A===d?n(A):(t.consume(A),v)}function w(A){return t.attempt(l,O,S)(A)}function S(A){return t.enter("lineEnding"),t.consume(A),t.exit("lineEnding"),_}function _(A){return c>0&&Ut(A)?Gt(t,E,"linePrefix",c+1)(A):E(A)}function E(A){return A===null||vt(A)?t.check(wv,w,O)(A):(t.enter("codeFlowValue"),D(A))}function D(A){return A===null||vt(A)?(t.exit("codeFlowValue"),E(A)):(t.consume(A),D)}function O(A){return t.exit("codeFenced"),a(A)}function M(A,P,Q){let G=0;return C;function C(H){return A.enter("lineEnding"),A.consume(H),A.exit("lineEnding"),R}function R(H){return A.enter("codeFencedFence"),Ut(H)?Gt(A,z,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):z(H)}function z(H){return H===d?(A.enter("codeFencedFenceSequence"),F(H)):Q(H)}function F(H){return H===d?(G++,A.consume(H),F):G>=o?(A.exit("codeFencedFenceSequence"),Ut(H)?Gt(A,J,"whitespace")(H):J(H)):Q(H)}function J(H){return H===null||vt(H)?(A.exit("codeFencedFence"),P(H)):Q(H)}}}function oD(t,a,n){const i=this;return l;function l(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),c)}function c(o){return i.parser.lazy[i.now().line]?n(o):a(o)}}const bf={name:"codeIndented",tokenize:uD},cD={partial:!0,tokenize:dD};function uD(t,a,n){const i=this;return l;function l(m){return t.enter("codeIndented"),Gt(t,c,"linePrefix",5)(m)}function c(m){const f=i.events[i.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?o(m):n(m)}function o(m){return m===null?h(m):vt(m)?t.attempt(cD,o,h)(m):(t.enter("codeFlowValue"),d(m))}function d(m){return m===null||vt(m)?(t.exit("codeFlowValue"),o(m)):(t.consume(m),d)}function h(m){return t.exit("codeIndented"),a(m)}}function dD(t,a,n){const i=this;return l;function l(o){return i.parser.lazy[i.now().line]?n(o):vt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),l):Gt(t,c,"linePrefix",5)(o)}function c(o){const d=i.events[i.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?a(o):vt(o)?l(o):n(o)}}const hD={name:"codeText",previous:pD,resolve:mD,tokenize:fD};function mD(t){let a=t.length-4,n=3,i,l;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[a][1].type==="lineEnding"||t[a][1].type==="space")){for(i=n;++i<a;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[a][1].type="codeTextPadding",n+=2,a-=2;break}}for(i=n-1,a++;++i<=a;)l===void 0?i!==a&&t[i][1].type!=="lineEnding"&&(l=i):(i===a||t[i][1].type==="lineEnding")&&(t[l][1].type="codeTextData",i!==l+2&&(t[l][1].end=t[i-1][1].end,t.splice(l+2,i-l-2),a-=i-l-2,i=l+2),l=void 0);return t}function pD(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function fD(t,a,n){let i=0,l,c;return o;function o(g){return t.enter("codeText"),t.enter("codeTextSequence"),d(g)}function d(g){return g===96?(t.consume(g),i++,d):(t.exit("codeTextSequence"),h(g))}function h(g){return g===null?n(g):g===32?(t.enter("space"),t.consume(g),t.exit("space"),h):g===96?(c=t.enter("codeTextSequence"),l=0,f(g)):vt(g)?(t.enter("lineEnding"),t.consume(g),t.exit("lineEnding"),h):(t.enter("codeTextData"),m(g))}function m(g){return g===null||g===32||g===96||vt(g)?(t.exit("codeTextData"),h(g)):(t.consume(g),m)}function f(g){return g===96?(t.consume(g),l++,f):l===i?(t.exit("codeTextSequence"),t.exit("codeText"),a(g)):(c.type="codeTextData",m(g))}}let gD=class{constructor(a){this.left=a?[...a]:[],this.right=[]}get(a){if(a<0||a>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+a+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return a<this.left.length?this.left[a]:this.right[this.right.length-a+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(a,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(a,i):a>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-a+this.left.length).reverse():this.left.slice(a).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(a,n,i){const l=n||0;this.setCursor(Math.trunc(a));const c=this.right.splice(this.right.length-l,Number.POSITIVE_INFINITY);return i&&du(this.left,i),c.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(a){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(a)}pushMany(a){this.setCursor(Number.POSITIVE_INFINITY),du(this.left,a)}unshift(a){this.setCursor(0),this.right.push(a)}unshiftMany(a){this.setCursor(0),du(this.right,a.reverse())}setCursor(a){if(!(a===this.left.length||a>this.left.length&&this.right.length===0||a<0&&this.left.length===0))if(a<this.left.length){const n=this.left.splice(a,Number.POSITIVE_INFINITY);du(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-a,Number.POSITIVE_INFINITY);du(this.left,n.reverse())}}};function du(t,a){let n=0;if(a.length<1e4)t.push(...a);else for(;n<a.length;)t.push(...a.slice(n,n+1e4)),n+=1e4}function yN(t){const a={};let n=-1,i,l,c,o,d,h,m;const f=new gD(t);for(;++n<f.length;){for(;n in a;)n=a[n];if(i=f.get(n),n&&i[1].type==="chunkFlow"&&f.get(n-1)[1].type==="listItemPrefix"&&(h=i[1]._tokenizer.events,c=0,c<h.length&&h[c][1].type==="lineEndingBlank"&&(c+=2),c<h.length&&h[c][1].type==="content"))for(;++c<h.length&&h[c][1].type!=="content";)h[c][1].type==="chunkText"&&(h[c][1]._isInFirstContentOfListItem=!0,c++);if(i[0]==="enter")i[1].contentType&&(Object.assign(a,xD(f,n)),n=a[n],m=!0);else if(i[1]._container){for(c=n,l=void 0;c--;)if(o=f.get(c),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(l&&(f.get(l)[1].type="lineEndingBlank"),o[1].type="lineEnding",l=c);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;l&&(i[1].end={...f.get(l)[1].start},d=f.slice(l,n),d.unshift(i),f.splice(l,n-l+1,d))}}return Ga(t,0,Number.POSITIVE_INFINITY,f.slice(0)),!m}function xD(t,a){const n=t.get(a)[1],i=t.get(a)[2];let l=a-1;const c=[];let o=n._tokenizer;o||(o=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const d=o.events,h=[],m={};let f,g,y=-1,b=n,v=0,w=0;const S=[w];for(;b;){for(;t.get(++l)[1]!==b;);c.push(l),b._tokenizer||(f=i.sliceStream(b),b.next||f.push(null),g&&o.defineSkip(b.start),b._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(f),b._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),g=b,b=b.next}for(b=n;++y<d.length;)d[y][0]==="exit"&&d[y-1][0]==="enter"&&d[y][1].type===d[y-1][1].type&&d[y][1].start.line!==d[y][1].end.line&&(w=y+1,S.push(w),b._tokenizer=void 0,b.previous=void 0,b=b.next);for(o.events=[],b?(b._tokenizer=void 0,b.previous=void 0):S.pop(),y=S.length;y--;){const _=d.slice(S[y],S[y+1]),E=c.pop();h.push([E,E+_.length-1]),t.splice(E,2,_)}for(h.reverse(),y=-1;++y<h.length;)m[v+h[y][0]]=v+h[y][1],v+=h[y][1]-h[y][0]-1;return m}const yD={resolve:jD,tokenize:vD},bD={partial:!0,tokenize:ND};function jD(t){return yN(t),t}function vD(t,a){let n;return i;function i(d){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),l(d)}function l(d){return d===null?c(d):vt(d)?t.check(bD,o,c)(d):(t.consume(d),l)}function c(d){return t.exit("chunkContent"),t.exit("content"),a(d)}function o(d){return t.consume(d),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,l}}function ND(t,a,n){const i=this;return l;function l(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Gt(t,c,"linePrefix")}function c(o){if(o===null||vt(o))return n(o);const d=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?a(o):t.interrupt(i.parser.constructs.flow,n,a)(o)}}function bN(t,a,n,i,l,c,o,d,h){const m=h||Number.POSITIVE_INFINITY;let f=0;return g;function g(_){return _===60?(t.enter(i),t.enter(l),t.enter(c),t.consume(_),t.exit(c),y):_===null||_===32||_===41||Mh(_)?n(_):(t.enter(i),t.enter(o),t.enter(d),t.enter("chunkString",{contentType:"string"}),w(_))}function y(_){return _===62?(t.enter(c),t.consume(_),t.exit(c),t.exit(l),t.exit(i),a):(t.enter(d),t.enter("chunkString",{contentType:"string"}),b(_))}function b(_){return _===62?(t.exit("chunkString"),t.exit(d),y(_)):_===null||_===60||vt(_)?n(_):(t.consume(_),_===92?v:b)}function v(_){return _===60||_===62||_===92?(t.consume(_),b):b(_)}function w(_){return!f&&(_===null||_===41||un(_))?(t.exit("chunkString"),t.exit(d),t.exit(o),t.exit(i),a(_)):f<m&&_===40?(t.consume(_),f++,w):_===41?(t.consume(_),f--,w):_===null||_===32||_===40||Mh(_)?n(_):(t.consume(_),_===92?S:w)}function S(_){return _===40||_===41||_===92?(t.consume(_),w):w(_)}}function jN(t,a,n,i,l,c){const o=this;let d=0,h;return m;function m(b){return t.enter(i),t.enter(l),t.consume(b),t.exit(l),t.enter(c),f}function f(b){return d>999||b===null||b===91||b===93&&!h||b===94&&!d&&"_hiddenFootnoteSupport"in o.parser.constructs?n(b):b===93?(t.exit(c),t.enter(l),t.consume(b),t.exit(l),t.exit(i),a):vt(b)?(t.enter("lineEnding"),t.consume(b),t.exit("lineEnding"),f):(t.enter("chunkString",{contentType:"string"}),g(b))}function g(b){return b===null||b===91||b===93||vt(b)||d++>999?(t.exit("chunkString"),f(b)):(t.consume(b),h||(h=!Ut(b)),b===92?y:g)}function y(b){return b===91||b===92||b===93?(t.consume(b),d++,g):g(b)}}function vN(t,a,n,i,l,c){let o;return d;function d(y){return y===34||y===39||y===40?(t.enter(i),t.enter(l),t.consume(y),t.exit(l),o=y===40?41:y,h):n(y)}function h(y){return y===o?(t.enter(l),t.consume(y),t.exit(l),t.exit(i),a):(t.enter(c),m(y))}function m(y){return y===o?(t.exit(c),h(o)):y===null?n(y):vt(y)?(t.enter("lineEnding"),t.consume(y),t.exit("lineEnding"),Gt(t,m,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),f(y))}function f(y){return y===o||y===null||vt(y)?(t.exit("chunkString"),m(y)):(t.consume(y),y===92?g:f)}function g(y){return y===o||y===92?(t.consume(y),f):f(y)}}function yu(t,a){let n;return i;function i(l){return vt(l)?(t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),n=!0,i):Ut(l)?Gt(t,i,n?"linePrefix":"lineSuffix")(l):a(l)}}const wD={name:"definition",tokenize:kD},SD={partial:!0,tokenize:CD};function kD(t,a,n){const i=this;let l;return c;function c(b){return t.enter("definition"),o(b)}function o(b){return jN.call(i,t,d,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(b)}function d(b){return l=ws(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),b===58?(t.enter("definitionMarker"),t.consume(b),t.exit("definitionMarker"),h):n(b)}function h(b){return un(b)?yu(t,m)(b):m(b)}function m(b){return bN(t,f,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(b)}function f(b){return t.attempt(SD,g,g)(b)}function g(b){return Ut(b)?Gt(t,y,"whitespace")(b):y(b)}function y(b){return b===null||vt(b)?(t.exit("definition"),i.parser.defined.push(l),a(b)):n(b)}}function CD(t,a,n){return i;function i(d){return un(d)?yu(t,l)(d):n(d)}function l(d){return vN(t,c,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(d)}function c(d){return Ut(d)?Gt(t,o,"whitespace")(d):o(d)}function o(d){return d===null||vt(d)?a(d):n(d)}}const _D={name:"hardBreakEscape",tokenize:DD};function DD(t,a,n){return i;function i(c){return t.enter("hardBreakEscape"),t.consume(c),l}function l(c){return vt(c)?(t.exit("hardBreakEscape"),a(c)):n(c)}}const ED={name:"headingAtx",resolve:TD,tokenize:AD};function TD(t,a){let n=t.length-2,i=3,l,c;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(l={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},c={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Ga(t,i,n-i+1,[["enter",l,a],["enter",c,a],["exit",c,a],["exit",l,a]])),t}function AD(t,a,n){let i=0;return l;function l(f){return t.enter("atxHeading"),c(f)}function c(f){return t.enter("atxHeadingSequence"),o(f)}function o(f){return f===35&&i++<6?(t.consume(f),o):f===null||un(f)?(t.exit("atxHeadingSequence"),d(f)):n(f)}function d(f){return f===35?(t.enter("atxHeadingSequence"),h(f)):f===null||vt(f)?(t.exit("atxHeading"),a(f)):Ut(f)?Gt(t,d,"whitespace")(f):(t.enter("atxHeadingText"),m(f))}function h(f){return f===35?(t.consume(f),h):(t.exit("atxHeadingSequence"),d(f))}function m(f){return f===null||f===35||un(f)?(t.exit("atxHeadingText"),d(f)):(t.consume(f),m)}}const PD=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],kv=["pre","script","style","textarea"],RD={concrete:!0,name:"htmlFlow",resolveTo:zD,tokenize:FD},OD={partial:!0,tokenize:$D},ID={partial:!0,tokenize:LD};function zD(t){let a=t.length;for(;a--&&!(t[a][0]==="enter"&&t[a][1].type==="htmlFlow"););return a>1&&t[a-2][1].type==="linePrefix"&&(t[a][1].start=t[a-2][1].start,t[a+1][1].start=t[a-2][1].start,t.splice(a-2,2)),t}function FD(t,a,n){const i=this;let l,c,o,d,h;return m;function m(T){return f(T)}function f(T){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(T),g}function g(T){return T===33?(t.consume(T),y):T===47?(t.consume(T),c=!0,w):T===63?(t.consume(T),l=3,i.interrupt?a:k):ha(T)?(t.consume(T),o=String.fromCharCode(T),S):n(T)}function y(T){return T===45?(t.consume(T),l=2,b):T===91?(t.consume(T),l=5,d=0,v):ha(T)?(t.consume(T),l=4,i.interrupt?a:k):n(T)}function b(T){return T===45?(t.consume(T),i.interrupt?a:k):n(T)}function v(T){const Ce="CDATA[";return T===Ce.charCodeAt(d++)?(t.consume(T),d===Ce.length?i.interrupt?a:z:v):n(T)}function w(T){return ha(T)?(t.consume(T),o=String.fromCharCode(T),S):n(T)}function S(T){if(T===null||T===47||T===62||un(T)){const Ce=T===47,Ue=o.toLowerCase();return!Ce&&!c&&kv.includes(Ue)?(l=1,i.interrupt?a(T):z(T)):PD.includes(o.toLowerCase())?(l=6,Ce?(t.consume(T),_):i.interrupt?a(T):z(T)):(l=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(T):c?E(T):D(T))}return T===45||Xn(T)?(t.consume(T),o+=String.fromCharCode(T),S):n(T)}function _(T){return T===62?(t.consume(T),i.interrupt?a:z):n(T)}function E(T){return Ut(T)?(t.consume(T),E):C(T)}function D(T){return T===47?(t.consume(T),C):T===58||T===95||ha(T)?(t.consume(T),O):Ut(T)?(t.consume(T),D):C(T)}function O(T){return T===45||T===46||T===58||T===95||Xn(T)?(t.consume(T),O):M(T)}function M(T){return T===61?(t.consume(T),A):Ut(T)?(t.consume(T),M):D(T)}function A(T){return T===null||T===60||T===61||T===62||T===96?n(T):T===34||T===39?(t.consume(T),h=T,P):Ut(T)?(t.consume(T),A):Q(T)}function P(T){return T===h?(t.consume(T),h=null,G):T===null||vt(T)?n(T):(t.consume(T),P)}function Q(T){return T===null||T===34||T===39||T===47||T===60||T===61||T===62||T===96||un(T)?M(T):(t.consume(T),Q)}function G(T){return T===47||T===62||Ut(T)?D(T):n(T)}function C(T){return T===62?(t.consume(T),R):n(T)}function R(T){return T===null||vt(T)?z(T):Ut(T)?(t.consume(T),R):n(T)}function z(T){return T===45&&l===2?(t.consume(T),I):T===60&&l===1?(t.consume(T),V):T===62&&l===4?(t.consume(T),Ne):T===63&&l===3?(t.consume(T),k):T===93&&l===5?(t.consume(T),B):vt(T)&&(l===6||l===7)?(t.exit("htmlFlowData"),t.check(OD,Ae,F)(T)):T===null||vt(T)?(t.exit("htmlFlowData"),F(T)):(t.consume(T),z)}function F(T){return t.check(ID,J,Ae)(T)}function J(T){return t.enter("lineEnding"),t.consume(T),t.exit("lineEnding"),H}function H(T){return T===null||vt(T)?F(T):(t.enter("htmlFlowData"),z(T))}function I(T){return T===45?(t.consume(T),k):z(T)}function V(T){return T===47?(t.consume(T),o="",re):z(T)}function re(T){if(T===62){const Ce=o.toLowerCase();return kv.includes(Ce)?(t.consume(T),Ne):z(T)}return ha(T)&&o.length<8?(t.consume(T),o+=String.fromCharCode(T),re):z(T)}function B(T){return T===93?(t.consume(T),k):z(T)}function k(T){return T===62?(t.consume(T),Ne):T===45&&l===2?(t.consume(T),k):z(T)}function Ne(T){return T===null||vt(T)?(t.exit("htmlFlowData"),Ae(T)):(t.consume(T),Ne)}function Ae(T){return t.exit("htmlFlow"),a(T)}}function LD(t,a,n){const i=this;return l;function l(o){return vt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),c):n(o)}function c(o){return i.parser.lazy[i.now().line]?n(o):a(o)}}function $D(t,a,n){return i;function i(l){return t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),t.attempt(Fu,a,n)}}const MD={name:"htmlText",tokenize:BD};function BD(t,a,n){const i=this;let l,c,o;return d;function d(k){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(k),h}function h(k){return k===33?(t.consume(k),m):k===47?(t.consume(k),M):k===63?(t.consume(k),D):ha(k)?(t.consume(k),Q):n(k)}function m(k){return k===45?(t.consume(k),f):k===91?(t.consume(k),c=0,v):ha(k)?(t.consume(k),E):n(k)}function f(k){return k===45?(t.consume(k),b):n(k)}function g(k){return k===null?n(k):k===45?(t.consume(k),y):vt(k)?(o=g,V(k)):(t.consume(k),g)}function y(k){return k===45?(t.consume(k),b):g(k)}function b(k){return k===62?I(k):k===45?y(k):g(k)}function v(k){const Ne="CDATA[";return k===Ne.charCodeAt(c++)?(t.consume(k),c===Ne.length?w:v):n(k)}function w(k){return k===null?n(k):k===93?(t.consume(k),S):vt(k)?(o=w,V(k)):(t.consume(k),w)}function S(k){return k===93?(t.consume(k),_):w(k)}function _(k){return k===62?I(k):k===93?(t.consume(k),_):w(k)}function E(k){return k===null||k===62?I(k):vt(k)?(o=E,V(k)):(t.consume(k),E)}function D(k){return k===null?n(k):k===63?(t.consume(k),O):vt(k)?(o=D,V(k)):(t.consume(k),D)}function O(k){return k===62?I(k):D(k)}function M(k){return ha(k)?(t.consume(k),A):n(k)}function A(k){return k===45||Xn(k)?(t.consume(k),A):P(k)}function P(k){return vt(k)?(o=P,V(k)):Ut(k)?(t.consume(k),P):I(k)}function Q(k){return k===45||Xn(k)?(t.consume(k),Q):k===47||k===62||un(k)?G(k):n(k)}function G(k){return k===47?(t.consume(k),I):k===58||k===95||ha(k)?(t.consume(k),C):vt(k)?(o=G,V(k)):Ut(k)?(t.consume(k),G):I(k)}function C(k){return k===45||k===46||k===58||k===95||Xn(k)?(t.consume(k),C):R(k)}function R(k){return k===61?(t.consume(k),z):vt(k)?(o=R,V(k)):Ut(k)?(t.consume(k),R):G(k)}function z(k){return k===null||k===60||k===61||k===62||k===96?n(k):k===34||k===39?(t.consume(k),l=k,F):vt(k)?(o=z,V(k)):Ut(k)?(t.consume(k),z):(t.consume(k),J)}function F(k){return k===l?(t.consume(k),l=void 0,H):k===null?n(k):vt(k)?(o=F,V(k)):(t.consume(k),F)}function J(k){return k===null||k===34||k===39||k===60||k===61||k===96?n(k):k===47||k===62||un(k)?G(k):(t.consume(k),J)}function H(k){return k===47||k===62||un(k)?G(k):n(k)}function I(k){return k===62?(t.consume(k),t.exit("htmlTextData"),t.exit("htmlText"),a):n(k)}function V(k){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),re}function re(k){return Ut(k)?Gt(t,B,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(k):B(k)}function B(k){return t.enter("htmlTextData"),o(k)}}const yx={name:"labelEnd",resolveAll:VD,resolveTo:GD,tokenize:QD},UD={tokenize:YD},qD={tokenize:JD},HD={tokenize:KD};function VD(t){let a=-1;const n=[];for(;++a<t.length;){const i=t[a][1];if(n.push(t[a]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const l=i.type==="labelImage"?4:2;i.type="data",a+=l}}return t.length!==n.length&&Ga(t,0,t.length,n),t}function GD(t,a){let n=t.length,i=0,l,c,o,d;for(;n--;)if(l=t[n][1],c){if(l.type==="link"||l.type==="labelLink"&&l._inactive)break;t[n][0]==="enter"&&l.type==="labelLink"&&(l._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(l.type==="labelImage"||l.type==="labelLink")&&!l._balanced&&(c=n,l.type!=="labelLink")){i=2;break}}else l.type==="labelEnd"&&(o=n);const h={type:t[c][1].type==="labelLink"?"link":"image",start:{...t[c][1].start},end:{...t[t.length-1][1].end}},m={type:"label",start:{...t[c][1].start},end:{...t[o][1].end}},f={type:"labelText",start:{...t[c+i+2][1].end},end:{...t[o-2][1].start}};return d=[["enter",h,a],["enter",m,a]],d=ls(d,t.slice(c+1,c+i+3)),d=ls(d,[["enter",f,a]]),d=ls(d,rm(a.parser.constructs.insideSpan.null,t.slice(c+i+4,o-3),a)),d=ls(d,[["exit",f,a],t[o-2],t[o-1],["exit",m,a]]),d=ls(d,t.slice(o+1)),d=ls(d,[["exit",h,a]]),Ga(t,c,t.length,d),t}function QD(t,a,n){const i=this;let l=i.events.length,c,o;for(;l--;)if((i.events[l][1].type==="labelImage"||i.events[l][1].type==="labelLink")&&!i.events[l][1]._balanced){c=i.events[l][1];break}return d;function d(y){return c?c._inactive?g(y):(o=i.parser.defined.includes(ws(i.sliceSerialize({start:c.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(y),t.exit("labelMarker"),t.exit("labelEnd"),h):n(y)}function h(y){return y===40?t.attempt(UD,f,o?f:g)(y):y===91?t.attempt(qD,f,o?m:g)(y):o?f(y):g(y)}function m(y){return t.attempt(HD,f,g)(y)}function f(y){return a(y)}function g(y){return c._balanced=!0,n(y)}}function YD(t,a,n){return i;function i(g){return t.enter("resource"),t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),l}function l(g){return un(g)?yu(t,c)(g):c(g)}function c(g){return g===41?f(g):bN(t,o,d,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function o(g){return un(g)?yu(t,h)(g):f(g)}function d(g){return n(g)}function h(g){return g===34||g===39||g===40?vN(t,m,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function m(g){return un(g)?yu(t,f)(g):f(g)}function f(g){return g===41?(t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),t.exit("resource"),a):n(g)}}function JD(t,a,n){const i=this;return l;function l(d){return jN.call(i,t,c,o,"reference","referenceMarker","referenceString")(d)}function c(d){return i.parser.defined.includes(ws(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?a(d):n(d)}function o(d){return n(d)}}function KD(t,a,n){return i;function i(c){return t.enter("reference"),t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),l}function l(c){return c===93?(t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),t.exit("reference"),a):n(c)}}const WD={name:"labelStartImage",resolveAll:yx.resolveAll,tokenize:XD};function XD(t,a,n){const i=this;return l;function l(d){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(d),t.exit("labelImageMarker"),c}function c(d){return d===91?(t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelImage"),o):n(d)}function o(d){return d===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(d):a(d)}}const ZD={name:"labelStartLink",resolveAll:yx.resolveAll,tokenize:eE};function eE(t,a,n){const i=this;return l;function l(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),c}function c(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):a(o)}}const jf={name:"lineEnding",tokenize:tE};function tE(t,a){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),Gt(t,a,"linePrefix")}}const Dh={name:"thematicBreak",tokenize:nE};function nE(t,a,n){let i=0,l;return c;function c(m){return t.enter("thematicBreak"),o(m)}function o(m){return l=m,d(m)}function d(m){return m===l?(t.enter("thematicBreakSequence"),h(m)):i>=3&&(m===null||vt(m))?(t.exit("thematicBreak"),a(m)):n(m)}function h(m){return m===l?(t.consume(m),i++,h):(t.exit("thematicBreakSequence"),Ut(m)?Gt(t,d,"whitespace")(m):d(m))}}const va={continuation:{tokenize:rE},exit:oE,name:"list",tokenize:iE},aE={partial:!0,tokenize:cE},sE={partial:!0,tokenize:lE};function iE(t,a,n){const i=this,l=i.events[i.events.length-1];let c=l&&l[1].type==="linePrefix"?l[2].sliceSerialize(l[1],!0).length:0,o=0;return d;function d(b){const v=i.containerState.type||(b===42||b===43||b===45?"listUnordered":"listOrdered");if(v==="listUnordered"?!i.containerState.marker||b===i.containerState.marker:Ng(b)){if(i.containerState.type||(i.containerState.type=v,t.enter(v,{_container:!0})),v==="listUnordered")return t.enter("listItemPrefix"),b===42||b===45?t.check(Dh,n,m)(b):m(b);if(!i.interrupt||b===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),h(b)}return n(b)}function h(b){return Ng(b)&&++o<10?(t.consume(b),h):(!i.interrupt||o<2)&&(i.containerState.marker?b===i.containerState.marker:b===41||b===46)?(t.exit("listItemValue"),m(b)):n(b)}function m(b){return t.enter("listItemMarker"),t.consume(b),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||b,t.check(Fu,i.interrupt?n:f,t.attempt(aE,y,g))}function f(b){return i.containerState.initialBlankLine=!0,c++,y(b)}function g(b){return Ut(b)?(t.enter("listItemPrefixWhitespace"),t.consume(b),t.exit("listItemPrefixWhitespace"),y):n(b)}function y(b){return i.containerState.size=c+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,a(b)}}function rE(t,a,n){const i=this;return i.containerState._closeFlow=void 0,t.check(Fu,l,c);function l(d){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,Gt(t,a,"listItemIndent",i.containerState.size+1)(d)}function c(d){return i.containerState.furtherBlankLines||!Ut(d)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(d)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(sE,a,o)(d))}function o(d){return i.containerState._closeFlow=!0,i.interrupt=void 0,Gt(t,t.attempt(va,a,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(d)}}function lE(t,a,n){const i=this;return Gt(t,l,"listItemIndent",i.containerState.size+1);function l(c){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?a(c):n(c)}}function oE(t){t.exit(this.containerState.type)}function cE(t,a,n){const i=this;return Gt(t,l,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function l(c){const o=i.events[i.events.length-1];return!Ut(c)&&o&&o[1].type==="listItemPrefixWhitespace"?a(c):n(c)}}const Cv={name:"setextUnderline",resolveTo:uE,tokenize:dE};function uE(t,a){let n=t.length,i,l,c;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(l=n)}else t[n][1].type==="content"&&t.splice(n,1),!c&&t[n][1].type==="definition"&&(c=n);const o={type:"setextHeading",start:{...t[i][1].start},end:{...t[t.length-1][1].end}};return t[l][1].type="setextHeadingText",c?(t.splice(l,0,["enter",o,a]),t.splice(c+1,0,["exit",t[i][1],a]),t[i][1].end={...t[c][1].end}):t[i][1]=o,t.push(["exit",o,a]),t}function dE(t,a,n){const i=this;let l;return c;function c(m){let f=i.events.length,g;for(;f--;)if(i.events[f][1].type!=="lineEnding"&&i.events[f][1].type!=="linePrefix"&&i.events[f][1].type!=="content"){g=i.events[f][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||g)?(t.enter("setextHeadingLine"),l=m,o(m)):n(m)}function o(m){return t.enter("setextHeadingLineSequence"),d(m)}function d(m){return m===l?(t.consume(m),d):(t.exit("setextHeadingLineSequence"),Ut(m)?Gt(t,h,"lineSuffix")(m):h(m))}function h(m){return m===null||vt(m)?(t.exit("setextHeadingLine"),a(m)):n(m)}}const hE={tokenize:mE};function mE(t){const a=this,n=t.attempt(Fu,i,t.attempt(this.parser.constructs.flowInitial,l,Gt(t,t.attempt(this.parser.constructs.flow,l,t.attempt(yD,l)),"linePrefix")));return n;function i(c){if(c===null){t.consume(c);return}return t.enter("lineEndingBlank"),t.consume(c),t.exit("lineEndingBlank"),a.currentConstruct=void 0,n}function l(c){if(c===null){t.consume(c);return}return t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),a.currentConstruct=void 0,n}}const pE={resolveAll:wN()},fE=NN("string"),gE=NN("text");function NN(t){return{resolveAll:wN(t==="text"?xE:void 0),tokenize:a};function a(n){const i=this,l=this.parser.constructs[t],c=n.attempt(l,o,d);return o;function o(f){return m(f)?c(f):d(f)}function d(f){if(f===null){n.consume(f);return}return n.enter("data"),n.consume(f),h}function h(f){return m(f)?(n.exit("data"),c(f)):(n.consume(f),h)}function m(f){if(f===null)return!0;const g=l[f];let y=-1;if(g)for(;++y<g.length;){const b=g[y];if(!b.previous||b.previous.call(i,i.previous))return!0}return!1}}}function wN(t){return a;function a(n,i){let l=-1,c;for(;++l<=n.length;)c===void 0?n[l]&&n[l][1].type==="data"&&(c=l,l++):(!n[l]||n[l][1].type!=="data")&&(l!==c+2&&(n[c][1].end=n[l-1][1].end,n.splice(c+2,l-c-2),l=c+2),c=void 0);return t?t(n,i):n}}function xE(t,a){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],l=a.sliceStream(i);let c=l.length,o=-1,d=0,h;for(;c--;){const m=l[c];if(typeof m=="string"){for(o=m.length;m.charCodeAt(o-1)===32;)d++,o--;if(o)break;o=-1}else if(m===-2)h=!0,d++;else if(m!==-1){c++;break}}if(a._contentTypeTextTrailing&&n===t.length&&(d=0),d){const m={type:n===t.length||h||d<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:c?o:i.start._bufferIndex+o,_index:i.start._index+c,line:i.end.line,column:i.end.column-d,offset:i.end.offset-d},end:{...i.end}};i.end={...m.start},i.start.offset===i.end.offset?Object.assign(i,m):(t.splice(n,0,["enter",m,a],["exit",m,a]),n+=2)}n++}return t}const yE={42:va,43:va,45:va,48:va,49:va,50:va,51:va,52:va,53:va,54:va,55:va,56:va,57:va,62:fN},bE={91:wD},jE={[-2]:bf,[-1]:bf,32:bf},vE={35:ED,42:Dh,45:[Cv,Dh],60:RD,61:Cv,95:Dh,96:Sv,126:Sv},NE={38:xN,92:gN},wE={[-5]:jf,[-4]:jf,[-3]:jf,33:WD,38:xN,42:wg,60:[Z2,MD],91:ZD,92:[_D,gN],93:yx,95:wg,96:hD},SE={null:[wg,pE]},kE={null:[42,95]},CE={null:[]},_E=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:kE,contentInitial:bE,disable:CE,document:yE,flow:vE,flowInitial:jE,insideSpan:SE,string:NE,text:wE},Symbol.toStringTag,{value:"Module"}));function DE(t,a,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const l={},c=[];let o=[],d=[];const h={attempt:P(M),check:P(A),consume:E,enter:D,exit:O,interrupt:P(A,{interrupt:!0})},m={code:null,containerState:{},defineSkip:w,events:[],now:v,parser:t,previous:null,sliceSerialize:y,sliceStream:b,write:g};let f=a.tokenize.call(m,h);return a.resolveAll&&c.push(a),m;function g(R){return o=ls(o,R),S(),o[o.length-1]!==null?[]:(Q(a,0),m.events=rm(c,m.events,m),m.events)}function y(R,z){return TE(b(R),z)}function b(R){return EE(o,R)}function v(){const{_bufferIndex:R,_index:z,line:F,column:J,offset:H}=i;return{_bufferIndex:R,_index:z,line:F,column:J,offset:H}}function w(R){l[R.line]=R.column,C()}function S(){let R;for(;i._index<o.length;){const z=o[i._index];if(typeof z=="string")for(R=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===R&&i._bufferIndex<z.length;)_(z.charCodeAt(i._bufferIndex));else _(z)}}function _(R){f=f(R)}function E(R){vt(R)?(i.line++,i.column=1,i.offset+=R===-3?2:1,C()):R!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),m.previous=R}function D(R,z){const F=z||{};return F.type=R,F.start=v(),m.events.push(["enter",F,m]),d.push(F),F}function O(R){const z=d.pop();return z.end=v(),m.events.push(["exit",z,m]),z}function M(R,z){Q(R,z.from)}function A(R,z){z.restore()}function P(R,z){return F;function F(J,H,I){let V,re,B,k;return Array.isArray(J)?Ae(J):"tokenize"in J?Ae([J]):Ne(J);function Ne(Pe){return de;function de(Se){const ee=Se!==null&&Pe[Se],oe=Se!==null&&Pe.null,fe=[...Array.isArray(ee)?ee:ee?[ee]:[],...Array.isArray(oe)?oe:oe?[oe]:[]];return Ae(fe)(Se)}}function Ae(Pe){return V=Pe,re=0,Pe.length===0?I:T(Pe[re])}function T(Pe){return de;function de(Se){return k=G(),B=Pe,Pe.partial||(m.currentConstruct=Pe),Pe.name&&m.parser.constructs.disable.null.includes(Pe.name)?Ue():Pe.tokenize.call(z?Object.assign(Object.create(m),z):m,h,Ce,Ue)(Se)}}function Ce(Pe){return R(B,k),H}function Ue(Pe){return k.restore(),++re<V.length?T(V[re]):I}}}function Q(R,z){R.resolveAll&&!c.includes(R)&&c.push(R),R.resolve&&Ga(m.events,z,m.events.length-z,R.resolve(m.events.slice(z),m)),R.resolveTo&&(m.events=R.resolveTo(m.events,m))}function G(){const R=v(),z=m.previous,F=m.currentConstruct,J=m.events.length,H=Array.from(d);return{from:J,restore:I};function I(){i=R,m.previous=z,m.currentConstruct=F,m.events.length=J,d=H,C()}}function C(){i.line in l&&i.column<2&&(i.column=l[i.line],i.offset+=l[i.line]-1)}}function EE(t,a){const n=a.start._index,i=a.start._bufferIndex,l=a.end._index,c=a.end._bufferIndex;let o;if(n===l)o=[t[n].slice(i,c)];else{if(o=t.slice(n,l),i>-1){const d=o[0];typeof d=="string"?o[0]=d.slice(i):o.shift()}c>0&&o.push(t[l].slice(0,c))}return o}function TE(t,a){let n=-1;const i=[];let l;for(;++n<t.length;){const c=t[n];let o;if(typeof c=="string")o=c;else switch(c){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=a?" ":"	";break}case-1:{if(!a&&l)continue;o=" ";break}default:o=String.fromCharCode(c)}l=c===-2,i.push(o)}return i.join("")}function AE(t){const i={constructs:mN([_E,...(t||{}).extensions||[]]),content:l(G2),defined:[],document:l(Y2),flow:l(hE),lazy:{},string:l(fE),text:l(gE)};return i;function l(c){return o;function o(d){return DE(i,c,d)}}}function PE(t){for(;!yN(t););return t}const _v=/[\0\t\n\r]/g;function RE(){let t=1,a="",n=!0,i;return l;function l(c,o,d){const h=[];let m,f,g,y,b;for(c=a+(typeof c=="string"?c.toString():new TextDecoder(o||void 0).decode(c)),g=0,a="",n&&(c.charCodeAt(0)===65279&&g++,n=void 0);g<c.length;){if(_v.lastIndex=g,m=_v.exec(c),y=m&&m.index!==void 0?m.index:c.length,b=c.charCodeAt(y),!m){a=c.slice(g);break}if(b===10&&g===y&&i)h.push(-3),i=void 0;else switch(i&&(h.push(-5),i=void 0),g<y&&(h.push(c.slice(g,y)),t+=y-g),b){case 0:{h.push(65533),t++;break}case 9:{for(f=Math.ceil(t/4)*4,h.push(-2);t++<f;)h.push(-1);break}case 10:{h.push(-4),t=1;break}default:i=!0,t=1}g=y+1}return d&&(i&&h.push(-5),a&&h.push(a),h.push(null)),h}}const OE=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function IE(t){return t.replace(OE,zE)}function zE(t,a,n){if(a)return a;if(n.charCodeAt(0)===35){const l=n.charCodeAt(1),c=l===120||l===88;return pN(n.slice(c?2:1),c?16:10)}return xx(n)||t}const SN={}.hasOwnProperty;function FE(t,a,n){return typeof a!="string"&&(n=a,a=void 0),LE(n)(PE(AE(n).document().write(RE()(t,a,!0))))}function LE(t){const a={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:c(He),autolinkProtocol:G,autolinkEmail:G,atxHeading:c(Y),blockQuote:c(oe),characterEscape:G,characterReference:G,codeFenced:c(fe),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:c(fe,o),codeText:c(ge,o),codeTextData:G,data:G,codeFlowValue:G,definition:c(q),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:c(W),hardBreakEscape:c(ie),hardBreakTrailing:c(ie),htmlFlow:c(ce,o),htmlFlowData:G,htmlText:c(ce,o),htmlTextData:G,image:c(pe),label:o,link:c(He),listItem:c(st),listItemValue:y,listOrdered:c(We,g),listUnordered:c(We),paragraph:c(me),reference:T,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:c(Y),strong:c(ve),thematicBreak:c(Ee)},exit:{atxHeading:h(),atxHeadingSequence:M,autolink:h(),autolinkEmail:ee,autolinkProtocol:Se,blockQuote:h(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:Ue,characterReferenceMarkerNumeric:Ue,characterReferenceValue:Pe,characterReference:de,codeFenced:h(S),codeFencedFence:w,codeFencedFenceInfo:b,codeFencedFenceMeta:v,codeFlowValue:C,codeIndented:h(_),codeText:h(H),codeTextData:C,data:C,definition:h(),definitionDestinationString:O,definitionLabelString:E,definitionTitleString:D,emphasis:h(),hardBreakEscape:h(z),hardBreakTrailing:h(z),htmlFlow:h(F),htmlFlowData:C,htmlText:h(J),htmlTextData:C,image:h(V),label:B,labelText:re,lineEnding:R,link:h(I),listItem:h(),listOrdered:h(),listUnordered:h(),paragraph:h(),referenceString:Ce,resourceDestinationString:k,resourceTitleString:Ne,resource:Ae,setextHeading:h(Q),setextHeadingLineSequence:P,setextHeadingText:A,strong:h(),thematicBreak:h()}};kN(a,(t||{}).mdastExtensions||[]);const n={};return i;function i(L){let ne={type:"root",children:[]};const xe={stack:[ne],tokenStack:[],config:a,enter:d,exit:m,buffer:o,resume:f,data:n},ae=[];let we=-1;for(;++we<L.length;)if(L[we][1].type==="listOrdered"||L[we][1].type==="listUnordered")if(L[we][0]==="enter")ae.push(we);else{const Le=ae.pop();we=l(L,Le,we)}for(we=-1;++we<L.length;){const Le=a[L[we][0]];SN.call(Le,L[we][1].type)&&Le[L[we][1].type].call(Object.assign({sliceSerialize:L[we][2].sliceSerialize},xe),L[we][1])}if(xe.tokenStack.length>0){const Le=xe.tokenStack[xe.tokenStack.length-1];(Le[1]||Dv).call(xe,void 0,Le[0])}for(ne.position={start:hr(L.length>0?L[0][1].start:{line:1,column:1,offset:0}),end:hr(L.length>0?L[L.length-2][1].end:{line:1,column:1,offset:0})},we=-1;++we<a.transforms.length;)ne=a.transforms[we](ne)||ne;return ne}function l(L,ne,xe){let ae=ne-1,we=-1,Le=!1,Je,ot,xt,be;for(;++ae<=xe;){const ue=L[ae];switch(ue[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ue[0]==="enter"?we++:we--,be=void 0;break}case"lineEndingBlank":{ue[0]==="enter"&&(Je&&!be&&!we&&!xt&&(xt=ae),be=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:be=void 0}if(!we&&ue[0]==="enter"&&ue[1].type==="listItemPrefix"||we===-1&&ue[0]==="exit"&&(ue[1].type==="listUnordered"||ue[1].type==="listOrdered")){if(Je){let je=ae;for(ot=void 0;je--;){const ke=L[je];if(ke[1].type==="lineEnding"||ke[1].type==="lineEndingBlank"){if(ke[0]==="exit")continue;ot&&(L[ot][1].type="lineEndingBlank",Le=!0),ke[1].type="lineEnding",ot=je}else if(!(ke[1].type==="linePrefix"||ke[1].type==="blockQuotePrefix"||ke[1].type==="blockQuotePrefixWhitespace"||ke[1].type==="blockQuoteMarker"||ke[1].type==="listItemIndent"))break}xt&&(!ot||xt<ot)&&(Je._spread=!0),Je.end=Object.assign({},ot?L[ot][1].start:ue[1].end),L.splice(ot||ae,0,["exit",Je,ue[2]]),ae++,xe++}if(ue[1].type==="listItemPrefix"){const je={type:"listItem",_spread:!1,start:Object.assign({},ue[1].start),end:void 0};Je=je,L.splice(ae,0,["enter",je,ue[2]]),ae++,xe++,xt=void 0,be=!0}}}return L[ne][1]._spread=Le,xe}function c(L,ne){return xe;function xe(ae){d.call(this,L(ae),ae),ne&&ne.call(this,ae)}}function o(){this.stack.push({type:"fragment",children:[]})}function d(L,ne,xe){this.stack[this.stack.length-1].children.push(L),this.stack.push(L),this.tokenStack.push([ne,xe||void 0]),L.position={start:hr(ne.start),end:void 0}}function h(L){return ne;function ne(xe){L&&L.call(this,xe),m.call(this,xe)}}function m(L,ne){const xe=this.stack.pop(),ae=this.tokenStack.pop();if(ae)ae[0].type!==L.type&&(ne?ne.call(this,L,ae[0]):(ae[1]||Dv).call(this,L,ae[0]));else throw new Error("Cannot close `"+L.type+"` ("+xu({start:L.start,end:L.end})+"): its not open");xe.position.end=hr(L.end)}function f(){return gx(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function y(L){if(this.data.expectingFirstListItemValue){const ne=this.stack[this.stack.length-2];ne.start=Number.parseInt(this.sliceSerialize(L),10),this.data.expectingFirstListItemValue=void 0}}function b(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.lang=L}function v(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.meta=L}function w(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function S(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L.replace(/(\r?\n|\r)$/g,"")}function E(L){const ne=this.resume(),xe=this.stack[this.stack.length-1];xe.label=ne,xe.identifier=ws(this.sliceSerialize(L)).toLowerCase()}function D(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.title=L}function O(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.url=L}function M(L){const ne=this.stack[this.stack.length-1];if(!ne.depth){const xe=this.sliceSerialize(L).length;ne.depth=xe}}function A(){this.data.setextHeadingSlurpLineEnding=!0}function P(L){const ne=this.stack[this.stack.length-1];ne.depth=this.sliceSerialize(L).codePointAt(0)===61?1:2}function Q(){this.data.setextHeadingSlurpLineEnding=void 0}function G(L){const xe=this.stack[this.stack.length-1].children;let ae=xe[xe.length-1];(!ae||ae.type!=="text")&&(ae=Fe(),ae.position={start:hr(L.start),end:void 0},xe.push(ae)),this.stack.push(ae)}function C(L){const ne=this.stack.pop();ne.value+=this.sliceSerialize(L),ne.position.end=hr(L.end)}function R(L){const ne=this.stack[this.stack.length-1];if(this.data.atHardBreak){const xe=ne.children[ne.children.length-1];xe.position.end=hr(L.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&a.canContainEols.includes(ne.type)&&(G.call(this,L),C.call(this,L))}function z(){this.data.atHardBreak=!0}function F(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function J(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function H(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function I(){const L=this.stack[this.stack.length-1];if(this.data.inReference){const ne=this.data.referenceType||"shortcut";L.type+="Reference",L.referenceType=ne,delete L.url,delete L.title}else delete L.identifier,delete L.label;this.data.referenceType=void 0}function V(){const L=this.stack[this.stack.length-1];if(this.data.inReference){const ne=this.data.referenceType||"shortcut";L.type+="Reference",L.referenceType=ne,delete L.url,delete L.title}else delete L.identifier,delete L.label;this.data.referenceType=void 0}function re(L){const ne=this.sliceSerialize(L),xe=this.stack[this.stack.length-2];xe.label=IE(ne),xe.identifier=ws(ne).toLowerCase()}function B(){const L=this.stack[this.stack.length-1],ne=this.resume(),xe=this.stack[this.stack.length-1];if(this.data.inReference=!0,xe.type==="link"){const ae=L.children;xe.children=ae}else xe.alt=ne}function k(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.url=L}function Ne(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.title=L}function Ae(){this.data.inReference=void 0}function T(){this.data.referenceType="collapsed"}function Ce(L){const ne=this.resume(),xe=this.stack[this.stack.length-1];xe.label=ne,xe.identifier=ws(this.sliceSerialize(L)).toLowerCase(),this.data.referenceType="full"}function Ue(L){this.data.characterReferenceType=L.type}function Pe(L){const ne=this.sliceSerialize(L),xe=this.data.characterReferenceType;let ae;xe?(ae=pN(ne,xe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ae=xx(ne);const we=this.stack[this.stack.length-1];we.value+=ae}function de(L){const ne=this.stack.pop();ne.position.end=hr(L.end)}function Se(L){C.call(this,L);const ne=this.stack[this.stack.length-1];ne.url=this.sliceSerialize(L)}function ee(L){C.call(this,L);const ne=this.stack[this.stack.length-1];ne.url="mailto:"+this.sliceSerialize(L)}function oe(){return{type:"blockquote",children:[]}}function fe(){return{type:"code",lang:null,meta:null,value:""}}function ge(){return{type:"inlineCode",value:""}}function q(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function W(){return{type:"emphasis",children:[]}}function Y(){return{type:"heading",depth:0,children:[]}}function ie(){return{type:"break"}}function ce(){return{type:"html",value:""}}function pe(){return{type:"image",title:null,url:"",alt:null}}function He(){return{type:"link",title:null,url:"",children:[]}}function We(L){return{type:"list",ordered:L.type==="listOrdered",start:null,spread:L._spread,children:[]}}function st(L){return{type:"listItem",spread:L._spread,checked:null,children:[]}}function me(){return{type:"paragraph",children:[]}}function ve(){return{type:"strong",children:[]}}function Fe(){return{type:"text",value:""}}function Ee(){return{type:"thematicBreak"}}}function hr(t){return{line:t.line,column:t.column,offset:t.offset}}function kN(t,a){let n=-1;for(;++n<a.length;){const i=a[n];Array.isArray(i)?kN(t,i):$E(t,i)}}function $E(t,a){let n;for(n in a)if(SN.call(a,n))switch(n){case"canContainEols":{const i=a[n];i&&t[n].push(...i);break}case"transforms":{const i=a[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=a[n];i&&Object.assign(t[n],i);break}}}function Dv(t,a){throw t?new Error("Cannot close `"+t.type+"` ("+xu({start:t.start,end:t.end})+"): a different token (`"+a.type+"`, "+xu({start:a.start,end:a.end})+") is open"):new Error("Cannot close document, a token (`"+a.type+"`, "+xu({start:a.start,end:a.end})+") is still open")}function ME(t){const a=this;a.parser=n;function n(i){return FE(i,{...a.data("settings"),...t,extensions:a.data("micromarkExtensions")||[],mdastExtensions:a.data("fromMarkdownExtensions")||[]})}}function BE(t,a){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(a),!0)};return t.patch(a,n),t.applyData(a,n)}function UE(t,a){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(a,n),[t.applyData(a,n),{type:"text",value:`
`}]}function qE(t,a){const n=a.value?a.value+`
`:"",i={};a.lang&&(i.className=["language-"+a.lang]);let l={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return a.meta&&(l.data={meta:a.meta}),t.patch(a,l),l=t.applyData(a,l),l={type:"element",tagName:"pre",properties:{},children:[l]},t.patch(a,l),l}function HE(t,a){const n={type:"element",tagName:"del",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function VE(t,a){const n={type:"element",tagName:"em",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function GE(t,a){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(a.identifier).toUpperCase(),l=Qo(i.toLowerCase()),c=t.footnoteOrder.indexOf(i);let o,d=t.footnoteCounts.get(i);d===void 0?(d=0,t.footnoteOrder.push(i),o=t.footnoteOrder.length):o=c+1,d+=1,t.footnoteCounts.set(i,d);const h={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+l,id:n+"fnref-"+l+(d>1?"-"+d:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(a,h);const m={type:"element",tagName:"sup",properties:{},children:[h]};return t.patch(a,m),t.applyData(a,m)}function QE(t,a){const n={type:"element",tagName:"h"+a.depth,properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function YE(t,a){if(t.options.allowDangerousHtml){const n={type:"raw",value:a.value};return t.patch(a,n),t.applyData(a,n)}}function CN(t,a){const n=a.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(a.label||a.identifier)+"]"),a.type==="imageReference")return[{type:"text",value:"!["+a.alt+i}];const l=t.all(a),c=l[0];c&&c.type==="text"?c.value="["+c.value:l.unshift({type:"text",value:"["});const o=l[l.length-1];return o&&o.type==="text"?o.value+=i:l.push({type:"text",value:i}),l}function JE(t,a){const n=String(a.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return CN(t,a);const l={src:Qo(i.url||""),alt:a.alt};i.title!==null&&i.title!==void 0&&(l.title=i.title);const c={type:"element",tagName:"img",properties:l,children:[]};return t.patch(a,c),t.applyData(a,c)}function KE(t,a){const n={src:Qo(a.url)};a.alt!==null&&a.alt!==void 0&&(n.alt=a.alt),a.title!==null&&a.title!==void 0&&(n.title=a.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(a,i),t.applyData(a,i)}function WE(t,a){const n={type:"text",value:a.value.replace(/\r?\n|\r/g," ")};t.patch(a,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(a,i),t.applyData(a,i)}function XE(t,a){const n=String(a.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return CN(t,a);const l={href:Qo(i.url||"")};i.title!==null&&i.title!==void 0&&(l.title=i.title);const c={type:"element",tagName:"a",properties:l,children:t.all(a)};return t.patch(a,c),t.applyData(a,c)}function ZE(t,a){const n={href:Qo(a.url)};a.title!==null&&a.title!==void 0&&(n.title=a.title);const i={type:"element",tagName:"a",properties:n,children:t.all(a)};return t.patch(a,i),t.applyData(a,i)}function eT(t,a,n){const i=t.all(a),l=n?tT(n):_N(a),c={},o=[];if(typeof a.checked=="boolean"){const f=i[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},i.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:a.checked,disabled:!0},children:[]}),c.className=["task-list-item"]}let d=-1;for(;++d<i.length;){const f=i[d];(l||d!==0||f.type!=="element"||f.tagName!=="p")&&o.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!l?o.push(...f.children):o.push(f)}const h=i[i.length-1];h&&(l||h.type!=="element"||h.tagName!=="p")&&o.push({type:"text",value:`
`});const m={type:"element",tagName:"li",properties:c,children:o};return t.patch(a,m),t.applyData(a,m)}function tT(t){let a=!1;if(t.type==="list"){a=t.spread||!1;const n=t.children;let i=-1;for(;!a&&++i<n.length;)a=_N(n[i])}return a}function _N(t){const a=t.spread;return a??t.children.length>1}function nT(t,a){const n={},i=t.all(a);let l=-1;for(typeof a.start=="number"&&a.start!==1&&(n.start=a.start);++l<i.length;){const o=i[l];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const c={type:"element",tagName:a.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(a,c),t.applyData(a,c)}function aT(t,a){const n={type:"element",tagName:"p",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function sT(t,a){const n={type:"root",children:t.wrap(t.all(a))};return t.patch(a,n),t.applyData(a,n)}function iT(t,a){const n={type:"element",tagName:"strong",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function rT(t,a){const n=t.all(a),i=n.shift(),l=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(a.children[0],o),l.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},d=hx(a.children[1]),h=rN(a.children[a.children.length-1]);d&&h&&(o.position={start:d,end:h}),l.push(o)}const c={type:"element",tagName:"table",properties:{},children:t.wrap(l,!0)};return t.patch(a,c),t.applyData(a,c)}function lT(t,a,n){const i=n?n.children:void 0,c=(i?i.indexOf(a):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,d=o?o.length:a.children.length;let h=-1;const m=[];for(;++h<d;){const g=a.children[h],y={},b=o?o[h]:void 0;b&&(y.align=b);let v={type:"element",tagName:c,properties:y,children:[]};g&&(v.children=t.all(g),t.patch(g,v),v=t.applyData(g,v)),m.push(v)}const f={type:"element",tagName:"tr",properties:{},children:t.wrap(m,!0)};return t.patch(a,f),t.applyData(a,f)}function oT(t,a){const n={type:"element",tagName:"td",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}const Ev=9,Tv=32;function cT(t){const a=String(t),n=/\r?\n|\r/g;let i=n.exec(a),l=0;const c=[];for(;i;)c.push(Av(a.slice(l,i.index),l>0,!0),i[0]),l=i.index+i[0].length,i=n.exec(a);return c.push(Av(a.slice(l),l>0,!1)),c.join("")}function Av(t,a,n){let i=0,l=t.length;if(a){let c=t.codePointAt(i);for(;c===Ev||c===Tv;)i++,c=t.codePointAt(i)}if(n){let c=t.codePointAt(l-1);for(;c===Ev||c===Tv;)l--,c=t.codePointAt(l-1)}return l>i?t.slice(i,l):""}function uT(t,a){const n={type:"text",value:cT(String(a.value))};return t.patch(a,n),t.applyData(a,n)}function dT(t,a){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(a,n),t.applyData(a,n)}const hT={blockquote:BE,break:UE,code:qE,delete:HE,emphasis:VE,footnoteReference:GE,heading:QE,html:YE,imageReference:JE,image:KE,inlineCode:WE,linkReference:XE,link:ZE,listItem:eT,list:nT,paragraph:aT,root:sT,strong:iT,table:rT,tableCell:oT,tableRow:lT,text:uT,thematicBreak:dT,toml:uh,yaml:uh,definition:uh,footnoteDefinition:uh};function uh(){}const DN=-1,lm=0,bu=1,Bh=2,bx=3,jx=4,vx=5,Nx=6,EN=7,TN=8,Pv=typeof self=="object"?self:globalThis,mT=(t,a)=>{const n=(l,c)=>(t.set(c,l),l),i=l=>{if(t.has(l))return t.get(l);const[c,o]=a[l];switch(c){case lm:case DN:return n(o,l);case bu:{const d=n([],l);for(const h of o)d.push(i(h));return d}case Bh:{const d=n({},l);for(const[h,m]of o)d[i(h)]=i(m);return d}case bx:return n(new Date(o),l);case jx:{const{source:d,flags:h}=o;return n(new RegExp(d,h),l)}case vx:{const d=n(new Map,l);for(const[h,m]of o)d.set(i(h),i(m));return d}case Nx:{const d=n(new Set,l);for(const h of o)d.add(i(h));return d}case EN:{const{name:d,message:h}=o;return n(new Pv[d](h),l)}case TN:return n(BigInt(o),l);case"BigInt":return n(Object(BigInt(o)),l);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:d}=new Uint8Array(o);return n(new DataView(d),o)}}return n(new Pv[c](o),l)};return i},Rv=t=>mT(new Map,t)(0),yo="",{toString:pT}={},{keys:fT}=Object,hu=t=>{const a=typeof t;if(a!=="object"||!t)return[lm,a];const n=pT.call(t).slice(8,-1);switch(n){case"Array":return[bu,yo];case"Object":return[Bh,yo];case"Date":return[bx,yo];case"RegExp":return[jx,yo];case"Map":return[vx,yo];case"Set":return[Nx,yo];case"DataView":return[bu,n]}return n.includes("Array")?[bu,n]:n.includes("Error")?[EN,n]:[Bh,n]},dh=([t,a])=>t===lm&&(a==="function"||a==="symbol"),gT=(t,a,n,i)=>{const l=(o,d)=>{const h=i.push(o)-1;return n.set(d,h),h},c=o=>{if(n.has(o))return n.get(o);let[d,h]=hu(o);switch(d){case lm:{let f=o;switch(h){case"bigint":d=TN,f=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+h);f=null;break;case"undefined":return l([DN],o)}return l([d,f],o)}case bu:{if(h){let y=o;return h==="DataView"?y=new Uint8Array(o.buffer):h==="ArrayBuffer"&&(y=new Uint8Array(o)),l([h,[...y]],o)}const f=[],g=l([d,f],o);for(const y of o)f.push(c(y));return g}case Bh:{if(h)switch(h){case"BigInt":return l([h,o.toString()],o);case"Boolean":case"Number":case"String":return l([h,o.valueOf()],o)}if(a&&"toJSON"in o)return c(o.toJSON());const f=[],g=l([d,f],o);for(const y of fT(o))(t||!dh(hu(o[y])))&&f.push([c(y),c(o[y])]);return g}case bx:return l([d,o.toISOString()],o);case jx:{const{source:f,flags:g}=o;return l([d,{source:f,flags:g}],o)}case vx:{const f=[],g=l([d,f],o);for(const[y,b]of o)(t||!(dh(hu(y))||dh(hu(b))))&&f.push([c(y),c(b)]);return g}case Nx:{const f=[],g=l([d,f],o);for(const y of o)(t||!dh(hu(y)))&&f.push(c(y));return g}}const{message:m}=o;return l([d,{name:h,message:m}],o)};return c},Ov=(t,{json:a,lossy:n}={})=>{const i=[];return gT(!(a||n),!!a,new Map,i)(t),i},Uh=typeof structuredClone=="function"?(t,a)=>a&&("json"in a||"lossy"in a)?Rv(Ov(t,a)):structuredClone(t):(t,a)=>Rv(Ov(t,a));function xT(t,a){const n=[{type:"text",value:""}];return a>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(a)}]}),n}function yT(t,a){return"Back to reference "+(t+1)+(a>1?"-"+a:"")}function bT(t){const a=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||xT,i=t.options.footnoteBackLabel||yT,l=t.options.footnoteLabel||"Footnotes",c=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},d=[];let h=-1;for(;++h<t.footnoteOrder.length;){const m=t.footnoteById.get(t.footnoteOrder[h]);if(!m)continue;const f=t.all(m),g=String(m.identifier).toUpperCase(),y=Qo(g.toLowerCase());let b=0;const v=[],w=t.footnoteCounts.get(g);for(;w!==void 0&&++b<=w;){v.length>0&&v.push({type:"text",value:" "});let E=typeof n=="string"?n:n(h,b);typeof E=="string"&&(E={type:"text",value:E}),v.push({type:"element",tagName:"a",properties:{href:"#"+a+"fnref-"+y+(b>1?"-"+b:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(h,b),className:["data-footnote-backref"]},children:Array.isArray(E)?E:[E]})}const S=f[f.length-1];if(S&&S.type==="element"&&S.tagName==="p"){const E=S.children[S.children.length-1];E&&E.type==="text"?E.value+=" ":S.children.push({type:"text",value:" "}),S.children.push(...v)}else f.push(...v);const _={type:"element",tagName:"li",properties:{id:a+"fn-"+y},children:t.wrap(f,!0)};t.patch(m,_),d.push(_)}if(d.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:c,properties:{...Uh(o),id:"footnote-label"},children:[{type:"text",value:l}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(d,!0)},{type:"text",value:`
`}]}}const om=function(t){if(t==null)return wT;if(typeof t=="function")return cm(t);if(typeof t=="object")return Array.isArray(t)?jT(t):vT(t);if(typeof t=="string")return NT(t);throw new Error("Expected function, string, or object as test")};function jT(t){const a=[];let n=-1;for(;++n<t.length;)a[n]=om(t[n]);return cm(i);function i(...l){let c=-1;for(;++c<a.length;)if(a[c].apply(this,l))return!0;return!1}}function vT(t){const a=t;return cm(n);function n(i){const l=i;let c;for(c in t)if(l[c]!==a[c])return!1;return!0}}function NT(t){return cm(a);function a(n){return n&&n.type===t}}function cm(t){return a;function a(n,i,l){return!!(ST(n)&&t.call(this,n,typeof i=="number"?i:void 0,l||void 0))}}function wT(){return!0}function ST(t){return t!==null&&typeof t=="object"&&"type"in t}const AN=[],kT=!0,Sg=!1,CT="skip";function PN(t,a,n,i){let l;typeof a=="function"&&typeof n!="function"?(i=n,n=a):l=a;const c=om(l),o=i?-1:1;d(t,void 0,[])();function d(h,m,f){const g=h&&typeof h=="object"?h:{};if(typeof g.type=="string"){const b=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(y,"name",{value:"node ("+(h.type+(b?"<"+b+">":""))+")"})}return y;function y(){let b=AN,v,w,S;if((!a||c(h,m,f[f.length-1]||void 0))&&(b=_T(n(h,f)),b[0]===Sg))return b;if("children"in h&&h.children){const _=h;if(_.children&&b[0]!==CT)for(w=(i?_.children.length:-1)+o,S=f.concat(_);w>-1&&w<_.children.length;){const E=_.children[w];if(v=d(E,w,S)(),v[0]===Sg)return v;w=typeof v[1]=="number"?v[1]:w+o}}return b}}}function _T(t){return Array.isArray(t)?t:typeof t=="number"?[kT,t]:t==null?AN:[t]}function wx(t,a,n,i){let l,c,o;typeof a=="function"?(c=void 0,o=a,l=n):(c=a,o=n,l=i),PN(t,c,d,l);function d(h,m){const f=m[m.length-1],g=f?f.children.indexOf(h):void 0;return o(h,g,f)}}const kg={}.hasOwnProperty,DT={};function ET(t,a){const n=a||DT,i=new Map,l=new Map,c=new Map,o={...hT,...n.handlers},d={all:m,applyData:AT,definitionById:i,footnoteById:l,footnoteCounts:c,footnoteOrder:[],handlers:o,one:h,options:n,patch:TT,wrap:RT};return wx(t,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?i:l,y=String(f.identifier).toUpperCase();g.has(y)||g.set(y,f)}}),d;function h(f,g){const y=f.type,b=d.handlers[y];if(kg.call(d.handlers,y)&&b)return b(d,f,g);if(d.options.passThrough&&d.options.passThrough.includes(y)){if("children"in f){const{children:w,...S}=f,_=Uh(S);return _.children=d.all(f),_}return Uh(f)}return(d.options.unknownHandler||PT)(d,f,g)}function m(f){const g=[];if("children"in f){const y=f.children;let b=-1;for(;++b<y.length;){const v=d.one(y[b],f);if(v){if(b&&y[b-1].type==="break"&&(!Array.isArray(v)&&v.type==="text"&&(v.value=Iv(v.value)),!Array.isArray(v)&&v.type==="element")){const w=v.children[0];w&&w.type==="text"&&(w.value=Iv(w.value))}Array.isArray(v)?g.push(...v):g.push(v)}}}return g}}function TT(t,a){t.position&&(a.position=y2(t))}function AT(t,a){let n=a;if(t&&t.data){const i=t.data.hName,l=t.data.hChildren,c=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&c&&Object.assign(n.properties,Uh(c)),"children"in n&&n.children&&l!==null&&l!==void 0&&(n.children=l)}return n}function PT(t,a){const n=a.data||{},i="value"in a&&!(kg.call(n,"hProperties")||kg.call(n,"hChildren"))?{type:"text",value:a.value}:{type:"element",tagName:"div",properties:{},children:t.all(a)};return t.patch(a,i),t.applyData(a,i)}function RT(t,a){const n=[];let i=-1;for(a&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return a&&t.length>0&&n.push({type:"text",value:`
`}),n}function Iv(t){let a=0,n=t.charCodeAt(a);for(;n===9||n===32;)a++,n=t.charCodeAt(a);return t.slice(a)}function zv(t,a){const n=ET(t,a),i=n.one(t,void 0),l=bT(n),c=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return l&&c.children.push({type:"text",value:`
`},l),c}function OT(t,a){return t&&"run"in t?async function(n,i){const l=zv(n,{file:i,...a});await t.run(l,i)}:function(n,i){return zv(n,{file:i,...t||a})}}function Fv(t){if(t)throw t}var vf,Lv;function IT(){if(Lv)return vf;Lv=1;var t=Object.prototype.hasOwnProperty,a=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=function(m){return typeof Array.isArray=="function"?Array.isArray(m):a.call(m)==="[object Array]"},c=function(m){if(!m||a.call(m)!=="[object Object]")return!1;var f=t.call(m,"constructor"),g=m.constructor&&m.constructor.prototype&&t.call(m.constructor.prototype,"isPrototypeOf");if(m.constructor&&!f&&!g)return!1;var y;for(y in m);return typeof y>"u"||t.call(m,y)},o=function(m,f){n&&f.name==="__proto__"?n(m,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):m[f.name]=f.newValue},d=function(m,f){if(f==="__proto__")if(t.call(m,f)){if(i)return i(m,f).value}else return;return m[f]};return vf=function h(){var m,f,g,y,b,v,w=arguments[0],S=1,_=arguments.length,E=!1;for(typeof w=="boolean"&&(E=w,w=arguments[1]||{},S=2),(w==null||typeof w!="object"&&typeof w!="function")&&(w={});S<_;++S)if(m=arguments[S],m!=null)for(f in m)g=d(w,f),y=d(m,f),w!==y&&(E&&y&&(c(y)||(b=l(y)))?(b?(b=!1,v=g&&l(g)?g:[]):v=g&&c(g)?g:{},o(w,{name:f,newValue:h(E,v,y)})):typeof y<"u"&&o(w,{name:f,newValue:y}));return w},vf}var zT=IT();const Nf=Pu(zT);function Cg(t){if(typeof t!="object"||t===null)return!1;const a=Object.getPrototypeOf(t);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function FT(){const t=[],a={run:n,use:i};return a;function n(...l){let c=-1;const o=l.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);d(null,...l);function d(h,...m){const f=t[++c];let g=-1;if(h){o(h);return}for(;++g<l.length;)(m[g]===null||m[g]===void 0)&&(m[g]=l[g]);l=m,f?LT(f,d)(...m):o(null,...m)}}function i(l){if(typeof l!="function")throw new TypeError("Expected `middelware` to be a function, not "+l);return t.push(l),a}}function LT(t,a){let n;return i;function i(...o){const d=t.length>o.length;let h;d&&o.push(l);try{h=t.apply(this,o)}catch(m){const f=m;if(d&&n)throw f;return l(f)}d||(h&&h.then&&typeof h.then=="function"?h.then(c,l):h instanceof Error?l(h):c(h))}function l(o,...d){n||(n=!0,a(o,...d))}function c(o){l(null,o)}}const qs={basename:$T,dirname:MT,extname:BT,join:UT,sep:"/"};function $T(t,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');Lu(t);let n=0,i=-1,l=t.length,c;if(a===void 0||a.length===0||a.length>t.length){for(;l--;)if(t.codePointAt(l)===47){if(c){n=l+1;break}}else i<0&&(c=!0,i=l+1);return i<0?"":t.slice(n,i)}if(a===t)return"";let o=-1,d=a.length-1;for(;l--;)if(t.codePointAt(l)===47){if(c){n=l+1;break}}else o<0&&(c=!0,o=l+1),d>-1&&(t.codePointAt(l)===a.codePointAt(d--)?d<0&&(i=l):(d=-1,i=o));return n===i?i=o:i<0&&(i=t.length),t.slice(n,i)}function MT(t){if(Lu(t),t.length===0)return".";let a=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){a=n;break}}else i||(i=!0);return a<0?t.codePointAt(0)===47?"/":".":a===1&&t.codePointAt(0)===47?"//":t.slice(0,a)}function BT(t){Lu(t);let a=t.length,n=-1,i=0,l=-1,c=0,o;for(;a--;){const d=t.codePointAt(a);if(d===47){if(o){i=a+1;break}continue}n<0&&(o=!0,n=a+1),d===46?l<0?l=a:c!==1&&(c=1):l>-1&&(c=-1)}return l<0||n<0||c===0||c===1&&l===n-1&&l===i+1?"":t.slice(l,n)}function UT(...t){let a=-1,n;for(;++a<t.length;)Lu(t[a]),t[a]&&(n=n===void 0?t[a]:n+"/"+t[a]);return n===void 0?".":qT(n)}function qT(t){Lu(t);const a=t.codePointAt(0)===47;let n=HT(t,!a);return n.length===0&&!a&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),a?"/"+n:n}function HT(t,a){let n="",i=0,l=-1,c=0,o=-1,d,h;for(;++o<=t.length;){if(o<t.length)d=t.codePointAt(o);else{if(d===47)break;d=47}if(d===47){if(!(l===o-1||c===1))if(l!==o-1&&c===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(h=n.lastIndexOf("/"),h!==n.length-1){h<0?(n="",i=0):(n=n.slice(0,h),i=n.length-1-n.lastIndexOf("/")),l=o,c=0;continue}}else if(n.length>0){n="",i=0,l=o,c=0;continue}}a&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(l+1,o):n=t.slice(l+1,o),i=o-l-1;l=o,c=0}else d===46&&c>-1?c++:c=-1}return n}function Lu(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const VT={cwd:GT};function GT(){return"/"}function _g(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function QT(t){if(typeof t=="string")t=new URL(t);else if(!_g(t)){const a=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw a.code="ERR_INVALID_ARG_TYPE",a}if(t.protocol!=="file:"){const a=new TypeError("The URL must be of scheme file");throw a.code="ERR_INVALID_URL_SCHEME",a}return YT(t)}function YT(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const a=t.pathname;let n=-1;for(;++n<a.length;)if(a.codePointAt(n)===37&&a.codePointAt(n+1)===50){const i=a.codePointAt(n+2);if(i===70||i===102){const l=new TypeError("File URL path must not include encoded / characters");throw l.code="ERR_INVALID_FILE_URL_PATH",l}}return decodeURIComponent(a)}const wf=["history","path","basename","stem","extname","dirname"];let RN=class{constructor(a){let n;a?_g(a)?n={path:a}:typeof a=="string"||JT(a)?n={value:a}:n=a:n={},this.cwd="cwd"in n?"":VT.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<wf.length;){const c=wf[i];c in n&&n[c]!==void 0&&n[c]!==null&&(this[c]=c==="history"?[...n[c]]:n[c])}let l;for(l in n)wf.includes(l)||(this[l]=n[l])}get basename(){return typeof this.path=="string"?qs.basename(this.path):void 0}set basename(a){kf(a,"basename"),Sf(a,"basename"),this.path=qs.join(this.dirname||"",a)}get dirname(){return typeof this.path=="string"?qs.dirname(this.path):void 0}set dirname(a){$v(this.basename,"dirname"),this.path=qs.join(a||"",this.basename)}get extname(){return typeof this.path=="string"?qs.extname(this.path):void 0}set extname(a){if(Sf(a,"extname"),$v(this.dirname,"extname"),a){if(a.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(a.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=qs.join(this.dirname,this.stem+(a||""))}get path(){return this.history[this.history.length-1]}set path(a){_g(a)&&(a=QT(a)),kf(a,"path"),this.path!==a&&this.history.push(a)}get stem(){return typeof this.path=="string"?qs.basename(this.path,this.extname):void 0}set stem(a){kf(a,"stem"),Sf(a,"stem"),this.path=qs.join(this.dirname||"",a+(this.extname||""))}fail(a,n,i){const l=this.message(a,n,i);throw l.fatal=!0,l}info(a,n,i){const l=this.message(a,n,i);return l.fatal=void 0,l}message(a,n,i){const l=new Zn(a,n,i);return this.path&&(l.name=this.path+":"+l.name,l.file=this.path),l.fatal=!1,this.messages.push(l),l}toString(a){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(a||void 0).decode(this.value)}};function Sf(t,a){if(t&&t.includes(qs.sep))throw new Error("`"+a+"` cannot be a path: did not expect `"+qs.sep+"`")}function kf(t,a){if(!t)throw new Error("`"+a+"` cannot be empty")}function $v(t,a){if(!t)throw new Error("Setting `"+a+"` requires `path` to be set too")}function JT(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const KT=function(t){const i=this.constructor.prototype,l=i[t],c=function(){return l.apply(c,arguments)};return Object.setPrototypeOf(c,i),c},WT={}.hasOwnProperty;let XT=class ON extends KT{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=FT()}copy(){const a=new ON;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];a.use(...i)}return a.data(Nf(!0,{},this.namespace)),a}data(a,n){return typeof a=="string"?arguments.length===2?(Df("data",this.frozen),this.namespace[a]=n,this):WT.call(this.namespace,a)&&this.namespace[a]||void 0:a?(Df("data",this.frozen),this.namespace=a,this):this.namespace}freeze(){if(this.frozen)return this;const a=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const l=n.call(a,...i);typeof l=="function"&&this.transformers.use(l)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(a){this.freeze();const n=hh(a),i=this.parser||this.Parser;return Cf("parse",i),i(String(n),n)}process(a,n){const i=this;return this.freeze(),Cf("process",this.parser||this.Parser),_f("process",this.compiler||this.Compiler),n?l(void 0,n):new Promise(l);function l(c,o){const d=hh(a),h=i.parse(d);i.run(h,d,function(f,g,y){if(f||!g||!y)return m(f);const b=g,v=i.stringify(b,y);tA(v)?y.value=v:y.result=v,m(f,y)});function m(f,g){f||!g?o(f):c?c(g):n(void 0,g)}}}processSync(a){let n=!1,i;return this.freeze(),Cf("processSync",this.parser||this.Parser),_f("processSync",this.compiler||this.Compiler),this.process(a,l),Bv("processSync","process",n),i;function l(c,o){n=!0,Fv(c),i=o}}run(a,n,i){Mv(a),this.freeze();const l=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?c(void 0,i):new Promise(c);function c(o,d){const h=hh(n);l.run(a,h,m);function m(f,g,y){const b=g||a;f?d(f):o?o(b):i(void 0,b,y)}}}runSync(a,n){let i=!1,l;return this.run(a,n,c),Bv("runSync","run",i),l;function c(o,d){Fv(o),l=d,i=!0}}stringify(a,n){this.freeze();const i=hh(n),l=this.compiler||this.Compiler;return _f("stringify",l),Mv(a),l(a,i)}use(a,...n){const i=this.attachers,l=this.namespace;if(Df("use",this.frozen),a!=null)if(typeof a=="function")h(a,n);else if(typeof a=="object")Array.isArray(a)?d(a):o(a);else throw new TypeError("Expected usable value, not `"+a+"`");return this;function c(m){if(typeof m=="function")h(m,[]);else if(typeof m=="object")if(Array.isArray(m)){const[f,...g]=m;h(f,g)}else o(m);else throw new TypeError("Expected usable value, not `"+m+"`")}function o(m){if(!("plugins"in m)&&!("settings"in m))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");d(m.plugins),m.settings&&(l.settings=Nf(!0,l.settings,m.settings))}function d(m){let f=-1;if(m!=null)if(Array.isArray(m))for(;++f<m.length;){const g=m[f];c(g)}else throw new TypeError("Expected a list of plugins, not `"+m+"`")}function h(m,f){let g=-1,y=-1;for(;++g<i.length;)if(i[g][0]===m){y=g;break}if(y===-1)i.push([m,...f]);else if(f.length>0){let[b,...v]=f;const w=i[y][1];Cg(w)&&Cg(b)&&(b=Nf(!0,w,b)),i[y]=[m,b,...v]}}}};const ZT=new XT().freeze();function Cf(t,a){if(typeof a!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function _f(t,a){if(typeof a!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Df(t,a){if(a)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Mv(t){if(!Cg(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function Bv(t,a,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+a+"` instead")}function hh(t){return eA(t)?t:new RN(t)}function eA(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function tA(t){return typeof t=="string"||nA(t)}function nA(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const aA="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Uv=[],qv={allowDangerousHtml:!0},sA=/^(https?|ircs?|mailto|xmpp)$/i,iA=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function qa(t){const a=rA(t),n=lA(t);return oA(a.runSync(a.parse(n),n),t)}function rA(t){const a=t.rehypePlugins||Uv,n=t.remarkPlugins||Uv,i=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...qv}:qv;return ZT().use(ME).use(n).use(OT,i).use(a)}function lA(t){const a=t.children||"",n=new RN;return typeof a=="string"&&(n.value=a),n}function oA(t,a){const n=a.allowedElements,i=a.allowElement,l=a.components,c=a.disallowedElements,o=a.skipHtml,d=a.unwrapDisallowed,h=a.urlTransform||cA;for(const f of iA)Object.hasOwn(a,f.from)&&(""+f.from+(f.to?"use `"+f.to+"` instead":"remove it")+aA+f.id,void 0);return wx(t,m),w2(t,{Fragment:e.Fragment,components:l,ignoreInvalidStyle:!0,jsx:e.jsx,jsxs:e.jsxs,passKeys:!0,passNode:!0});function m(f,g,y){if(f.type==="raw"&&y&&typeof g=="number")return o?y.children.splice(g,1):y.children[g]={type:"text",value:f.value},g;if(f.type==="element"){let b;for(b in yf)if(Object.hasOwn(yf,b)&&Object.hasOwn(f.properties,b)){const v=f.properties[b],w=yf[b];(w===null||w.includes(f.tagName))&&(f.properties[b]=h(String(v||""),b,f))}}if(f.type==="element"){let b=n?!n.includes(f.tagName):c?c.includes(f.tagName):!1;if(!b&&i&&typeof g=="number"&&(b=!i(f,g,y)),b&&y&&typeof g=="number")return d&&f.children?y.children.splice(g,1,...f.children):y.children.splice(g,1),g}}}function cA(t){const a=t.indexOf(":"),n=t.indexOf("?"),i=t.indexOf("#"),l=t.indexOf("/");return a===-1||l!==-1&&a>l||n!==-1&&a>n||i!==-1&&a>i||sA.test(t.slice(0,a))?t:""}function Hv(t,a){const n=String(t);if(typeof a!="string")throw new TypeError("Expected character");let i=0,l=n.indexOf(a);for(;l!==-1;)i++,l=n.indexOf(a,l+a.length);return i}function uA(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function dA(t,a,n){const l=om((n||{}).ignore||[]),c=hA(a);let o=-1;for(;++o<c.length;)PN(t,"text",d);function d(m,f){let g=-1,y;for(;++g<f.length;){const b=f[g],v=y?y.children:void 0;if(l(b,v?v.indexOf(b):void 0,y))return;y=b}if(y)return h(m,f)}function h(m,f){const g=f[f.length-1],y=c[o][0],b=c[o][1];let v=0;const S=g.children.indexOf(m);let _=!1,E=[];y.lastIndex=0;let D=y.exec(m.value);for(;D;){const O=D.index,M={index:D.index,input:D.input,stack:[...f,m]};let A=b(...D,M);if(typeof A=="string"&&(A=A.length>0?{type:"text",value:A}:void 0),A===!1?y.lastIndex=O+1:(v!==O&&E.push({type:"text",value:m.value.slice(v,O)}),Array.isArray(A)?E.push(...A):A&&E.push(A),v=O+D[0].length,_=!0),!y.global)break;D=y.exec(m.value)}return _?(v<m.value.length&&E.push({type:"text",value:m.value.slice(v)}),g.children.splice(S,1,...E)):E=[m],S+E.length}}function hA(t){const a=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let i=-1;for(;++i<n.length;){const l=n[i];a.push([mA(l[0]),pA(l[1])])}return a}function mA(t){return typeof t=="string"?new RegExp(uA(t),"g"):t}function pA(t){return typeof t=="function"?t:function(){return t}}const Ef="phrasing",Tf=["autolink","link","image","label"];function fA(){return{transforms:[NA],enter:{literalAutolink:xA,literalAutolinkEmail:Af,literalAutolinkHttp:Af,literalAutolinkWww:Af},exit:{literalAutolink:vA,literalAutolinkEmail:jA,literalAutolinkHttp:yA,literalAutolinkWww:bA}}}function gA(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Ef,notInConstruct:Tf},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Ef,notInConstruct:Tf},{character:":",before:"[ps]",after:"\\/",inConstruct:Ef,notInConstruct:Tf}]}}function xA(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Af(t){this.config.enter.autolinkProtocol.call(this,t)}function yA(t){this.config.exit.autolinkProtocol.call(this,t)}function bA(t){this.config.exit.data.call(this,t);const a=this.stack[this.stack.length-1];a.type,a.url="http://"+this.sliceSerialize(t)}function jA(t){this.config.exit.autolinkEmail.call(this,t)}function vA(t){this.exit(t)}function NA(t){dA(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,wA],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),SA]],{ignore:["link","linkReference"]})}function wA(t,a,n,i,l){let c="";if(!IN(l)||(/^w/i.test(a)&&(n=a+n,a="",c="http://"),!kA(n)))return!1;const o=CA(n+i);if(!o[0])return!1;const d={type:"link",title:null,url:c+a+o[0],children:[{type:"text",value:a+o[0]}]};return o[1]?[d,{type:"text",value:o[1]}]:d}function SA(t,a,n,i){return!IN(i,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+a+"@"+n,children:[{type:"text",value:a+"@"+n}]}}function kA(t){const a=t.split(".");return!(a.length<2||a[a.length-1]&&(/_/.test(a[a.length-1])||!/[a-zA-Z\d]/.test(a[a.length-1]))||a[a.length-2]&&(/_/.test(a[a.length-2])||!/[a-zA-Z\d]/.test(a[a.length-2])))}function CA(t){const a=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!a)return[t,void 0];t=t.slice(0,a.index);let n=a[0],i=n.indexOf(")");const l=Hv(t,"(");let c=Hv(t,")");for(;i!==-1&&l>c;)t+=n.slice(0,i+1),n=n.slice(i+1),i=n.indexOf(")"),c++;return[t,n]}function IN(t,a){const n=t.input.charCodeAt(t.index-1);return(t.index===0||yl(n)||im(n))&&(!a||n!==47)}zN.peek=IA;function _A(){this.buffer()}function DA(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function EA(){this.buffer()}function TA(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function AA(t){const a=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=ws(this.sliceSerialize(t)).toLowerCase(),n.label=a}function PA(t){this.exit(t)}function RA(t){const a=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=ws(this.sliceSerialize(t)).toLowerCase(),n.label=a}function OA(t){this.exit(t)}function IA(){return"["}function zN(t,a,n,i){const l=n.createTracker(i);let c=l.move("[^");const o=n.enter("footnoteReference"),d=n.enter("reference");return c+=l.move(n.safe(n.associationId(t),{after:"]",before:c})),d(),o(),c+=l.move("]"),c}function zA(){return{enter:{gfmFootnoteCallString:_A,gfmFootnoteCall:DA,gfmFootnoteDefinitionLabelString:EA,gfmFootnoteDefinition:TA},exit:{gfmFootnoteCallString:AA,gfmFootnoteCall:PA,gfmFootnoteDefinitionLabelString:RA,gfmFootnoteDefinition:OA}}}function FA(t){let a=!1;return t&&t.firstLineBlank&&(a=!0),{handlers:{footnoteDefinition:n,footnoteReference:zN},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(i,l,c,o){const d=c.createTracker(o);let h=d.move("[^");const m=c.enter("footnoteDefinition"),f=c.enter("label");return h+=d.move(c.safe(c.associationId(i),{before:h,after:"]"})),f(),h+=d.move("]:"),i.children&&i.children.length>0&&(d.shift(4),h+=d.move((a?`
`:" ")+c.indentLines(c.containerFlow(i,d.current()),a?FN:LA))),m(),h}}function LA(t,a,n){return a===0?t:FN(t,a,n)}function FN(t,a,n){return(n?"":"    ")+t}const $A=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];LN.peek=HA;function MA(){return{canContainEols:["delete"],enter:{strikethrough:UA},exit:{strikethrough:qA}}}function BA(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:$A}],handlers:{delete:LN}}}function UA(t){this.enter({type:"delete",children:[]},t)}function qA(t){this.exit(t)}function LN(t,a,n,i){const l=n.createTracker(i),c=n.enter("strikethrough");let o=l.move("~~");return o+=n.containerPhrasing(t,{...l.current(),before:o,after:"~"}),o+=l.move("~~"),c(),o}function HA(){return"~"}function VA(t){return t.length}function GA(t,a){const n=a||{},i=(n.align||[]).concat(),l=n.stringLength||VA,c=[],o=[],d=[],h=[];let m=0,f=-1;for(;++f<t.length;){const w=[],S=[];let _=-1;for(t[f].length>m&&(m=t[f].length);++_<t[f].length;){const E=QA(t[f][_]);if(n.alignDelimiters!==!1){const D=l(E);S[_]=D,(h[_]===void 0||D>h[_])&&(h[_]=D)}w.push(E)}o[f]=w,d[f]=S}let g=-1;if(typeof i=="object"&&"length"in i)for(;++g<m;)c[g]=Vv(i[g]);else{const w=Vv(i);for(;++g<m;)c[g]=w}g=-1;const y=[],b=[];for(;++g<m;){const w=c[g];let S="",_="";w===99?(S=":",_=":"):w===108?S=":":w===114&&(_=":");let E=n.alignDelimiters===!1?1:Math.max(1,h[g]-S.length-_.length);const D=S+"-".repeat(E)+_;n.alignDelimiters!==!1&&(E=S.length+E+_.length,E>h[g]&&(h[g]=E),b[g]=E),y[g]=D}o.splice(1,0,y),d.splice(1,0,b),f=-1;const v=[];for(;++f<o.length;){const w=o[f],S=d[f];g=-1;const _=[];for(;++g<m;){const E=w[g]||"";let D="",O="";if(n.alignDelimiters!==!1){const M=h[g]-(S[g]||0),A=c[g];A===114?D=" ".repeat(M):A===99?M%2?(D=" ".repeat(M/2+.5),O=" ".repeat(M/2-.5)):(D=" ".repeat(M/2),O=D):O=" ".repeat(M)}n.delimiterStart!==!1&&!g&&_.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&E==="")&&(n.delimiterStart!==!1||g)&&_.push(" "),n.alignDelimiters!==!1&&_.push(D),_.push(E),n.alignDelimiters!==!1&&_.push(O),n.padding!==!1&&_.push(" "),(n.delimiterEnd!==!1||g!==m-1)&&_.push("|")}v.push(n.delimiterEnd===!1?_.join("").replace(/ +$/,""):_.join(""))}return v.join(`
`)}function QA(t){return t==null?"":String(t)}function Vv(t){const a=typeof t=="string"?t.codePointAt(0):0;return a===67||a===99?99:a===76||a===108?108:a===82||a===114?114:0}function YA(t,a,n,i){const l=n.enter("blockquote"),c=n.createTracker(i);c.move("> "),c.shift(2);const o=n.indentLines(n.containerFlow(t,c.current()),JA);return l(),o}function JA(t,a,n){return">"+(n?"":" ")+t}function KA(t,a){return Gv(t,a.inConstruct,!0)&&!Gv(t,a.notInConstruct,!1)}function Gv(t,a,n){if(typeof a=="string"&&(a=[a]),!a||a.length===0)return n;let i=-1;for(;++i<a.length;)if(t.includes(a[i]))return!0;return!1}function Qv(t,a,n,i){let l=-1;for(;++l<n.unsafe.length;)if(n.unsafe[l].character===`
`&&KA(n.stack,n.unsafe[l]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function WA(t,a){const n=String(t);let i=n.indexOf(a),l=i,c=0,o=0;if(typeof a!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===l?++c>o&&(o=c):c=1,l=i+a.length,i=n.indexOf(a,l);return o}function XA(t,a){return!!(a.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function ZA(t){const a=t.options.fence||"`";if(a!=="`"&&a!=="~")throw new Error("Cannot serialize code with `"+a+"` for `options.fence`, expected `` ` `` or `~`");return a}function eP(t,a,n,i){const l=ZA(n),c=t.value||"",o=l==="`"?"GraveAccent":"Tilde";if(XA(t,n)){const g=n.enter("codeIndented"),y=n.indentLines(c,tP);return g(),y}const d=n.createTracker(i),h=l.repeat(Math.max(WA(c,l)+1,3)),m=n.enter("codeFenced");let f=d.move(h);if(t.lang){const g=n.enter(`codeFencedLang${o}`);f+=d.move(n.safe(t.lang,{before:f,after:" ",encode:["`"],...d.current()})),g()}if(t.lang&&t.meta){const g=n.enter(`codeFencedMeta${o}`);f+=d.move(" "),f+=d.move(n.safe(t.meta,{before:f,after:`
`,encode:["`"],...d.current()})),g()}return f+=d.move(`
`),c&&(f+=d.move(c+`
`)),f+=d.move(h),m(),f}function tP(t,a,n){return(n?"":"    ")+t}function Sx(t){const a=t.options.quote||'"';if(a!=='"'&&a!=="'")throw new Error("Cannot serialize title with `"+a+"` for `options.quote`, expected `\"`, or `'`");return a}function nP(t,a,n,i){const l=Sx(n),c=l==='"'?"Quote":"Apostrophe",o=n.enter("definition");let d=n.enter("label");const h=n.createTracker(i);let m=h.move("[");return m+=h.move(n.safe(n.associationId(t),{before:m,after:"]",...h.current()})),m+=h.move("]: "),d(),!t.url||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=h.move("<"),m+=h.move(n.safe(t.url,{before:m,after:">",...h.current()})),m+=h.move(">")):(d=n.enter("destinationRaw"),m+=h.move(n.safe(t.url,{before:m,after:t.title?" ":`
`,...h.current()}))),d(),t.title&&(d=n.enter(`title${c}`),m+=h.move(" "+l),m+=h.move(n.safe(t.title,{before:m,after:l,...h.current()})),m+=h.move(l),d()),o(),m}function aP(t){const a=t.options.emphasis||"*";if(a!=="*"&&a!=="_")throw new Error("Cannot serialize emphasis with `"+a+"` for `options.emphasis`, expected `*`, or `_`");return a}function _u(t){return"&#x"+t.toString(16).toUpperCase()+";"}function qh(t,a,n){const i=Ho(t),l=Ho(a);return i===void 0?l===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:l===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?l===void 0?{inside:!1,outside:!1}:l===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:l===void 0?{inside:!1,outside:!1}:l===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}$N.peek=sP;function $N(t,a,n,i){const l=aP(n),c=n.enter("emphasis"),o=n.createTracker(i),d=o.move(l);let h=o.move(n.containerPhrasing(t,{after:l,before:d,...o.current()}));const m=h.charCodeAt(0),f=qh(i.before.charCodeAt(i.before.length-1),m,l);f.inside&&(h=_u(m)+h.slice(1));const g=h.charCodeAt(h.length-1),y=qh(i.after.charCodeAt(0),g,l);y.inside&&(h=h.slice(0,-1)+_u(g));const b=o.move(l);return c(),n.attentionEncodeSurroundingInfo={after:y.outside,before:f.outside},d+h+b}function sP(t,a,n){return n.options.emphasis||"*"}function iP(t,a){let n=!1;return wx(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,Sg}),!!((!t.depth||t.depth<3)&&gx(t)&&(a.options.setext||n))}function rP(t,a,n,i){const l=Math.max(Math.min(6,t.depth||1),1),c=n.createTracker(i);if(iP(t,n)){const f=n.enter("headingSetext"),g=n.enter("phrasing"),y=n.containerPhrasing(t,{...c.current(),before:`
`,after:`
`});return g(),f(),y+`
`+(l===1?"=":"-").repeat(y.length-(Math.max(y.lastIndexOf("\r"),y.lastIndexOf(`
`))+1))}const o="#".repeat(l),d=n.enter("headingAtx"),h=n.enter("phrasing");c.move(o+" ");let m=n.containerPhrasing(t,{before:"# ",after:`
`,...c.current()});return/^[\t ]/.test(m)&&(m=_u(m.charCodeAt(0))+m.slice(1)),m=m?o+" "+m:o,n.options.closeAtx&&(m+=" "+o),h(),d(),m}MN.peek=lP;function MN(t){return t.value||""}function lP(){return"<"}BN.peek=oP;function BN(t,a,n,i){const l=Sx(n),c=l==='"'?"Quote":"Apostrophe",o=n.enter("image");let d=n.enter("label");const h=n.createTracker(i);let m=h.move("![");return m+=h.move(n.safe(t.alt,{before:m,after:"]",...h.current()})),m+=h.move("]("),d(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=h.move("<"),m+=h.move(n.safe(t.url,{before:m,after:">",...h.current()})),m+=h.move(">")):(d=n.enter("destinationRaw"),m+=h.move(n.safe(t.url,{before:m,after:t.title?" ":")",...h.current()}))),d(),t.title&&(d=n.enter(`title${c}`),m+=h.move(" "+l),m+=h.move(n.safe(t.title,{before:m,after:l,...h.current()})),m+=h.move(l),d()),m+=h.move(")"),o(),m}function oP(){return"!"}UN.peek=cP;function UN(t,a,n,i){const l=t.referenceType,c=n.enter("imageReference");let o=n.enter("label");const d=n.createTracker(i);let h=d.move("![");const m=n.safe(t.alt,{before:h,after:"]",...d.current()});h+=d.move(m+"]["),o();const f=n.stack;n.stack=[],o=n.enter("reference");const g=n.safe(n.associationId(t),{before:h,after:"]",...d.current()});return o(),n.stack=f,c(),l==="full"||!m||m!==g?h+=d.move(g+"]"):l==="shortcut"?h=h.slice(0,-1):h+=d.move("]"),h}function cP(){return"!"}qN.peek=uP;function qN(t,a,n){let i=t.value||"",l="`",c=-1;for(;new RegExp("(^|[^`])"+l+"([^`]|$)").test(i);)l+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++c<n.unsafe.length;){const o=n.unsafe[c],d=n.compilePattern(o);let h;if(o.atBreak)for(;h=d.exec(i);){let m=h.index;i.charCodeAt(m)===10&&i.charCodeAt(m-1)===13&&m--,i=i.slice(0,m)+" "+i.slice(h.index+1)}}return l+i+l}function uP(){return"`"}function HN(t,a){const n=gx(t);return!!(!a.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}VN.peek=dP;function VN(t,a,n,i){const l=Sx(n),c=l==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let d,h;if(HN(t,n)){const f=n.stack;n.stack=[],d=n.enter("autolink");let g=o.move("<");return g+=o.move(n.containerPhrasing(t,{before:g,after:">",...o.current()})),g+=o.move(">"),d(),n.stack=f,g}d=n.enter("link"),h=n.enter("label");let m=o.move("[");return m+=o.move(n.containerPhrasing(t,{before:m,after:"](",...o.current()})),m+=o.move("]("),h(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(h=n.enter("destinationLiteral"),m+=o.move("<"),m+=o.move(n.safe(t.url,{before:m,after:">",...o.current()})),m+=o.move(">")):(h=n.enter("destinationRaw"),m+=o.move(n.safe(t.url,{before:m,after:t.title?" ":")",...o.current()}))),h(),t.title&&(h=n.enter(`title${c}`),m+=o.move(" "+l),m+=o.move(n.safe(t.title,{before:m,after:l,...o.current()})),m+=o.move(l),h()),m+=o.move(")"),d(),m}function dP(t,a,n){return HN(t,n)?"<":"["}GN.peek=hP;function GN(t,a,n,i){const l=t.referenceType,c=n.enter("linkReference");let o=n.enter("label");const d=n.createTracker(i);let h=d.move("[");const m=n.containerPhrasing(t,{before:h,after:"]",...d.current()});h+=d.move(m+"]["),o();const f=n.stack;n.stack=[],o=n.enter("reference");const g=n.safe(n.associationId(t),{before:h,after:"]",...d.current()});return o(),n.stack=f,c(),l==="full"||!m||m!==g?h+=d.move(g+"]"):l==="shortcut"?h=h.slice(0,-1):h+=d.move("]"),h}function hP(){return"["}function kx(t){const a=t.options.bullet||"*";if(a!=="*"&&a!=="+"&&a!=="-")throw new Error("Cannot serialize items with `"+a+"` for `options.bullet`, expected `*`, `+`, or `-`");return a}function mP(t){const a=kx(t),n=t.options.bulletOther;if(!n)return a==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===a)throw new Error("Expected `bullet` (`"+a+"`) and `bulletOther` (`"+n+"`) to be different");return n}function pP(t){const a=t.options.bulletOrdered||".";if(a!=="."&&a!==")")throw new Error("Cannot serialize items with `"+a+"` for `options.bulletOrdered`, expected `.` or `)`");return a}function QN(t){const a=t.options.rule||"*";if(a!=="*"&&a!=="-"&&a!=="_")throw new Error("Cannot serialize rules with `"+a+"` for `options.rule`, expected `*`, `-`, or `_`");return a}function fP(t,a,n,i){const l=n.enter("list"),c=n.bulletCurrent;let o=t.ordered?pP(n):kx(n);const d=t.ordered?o==="."?")":".":mP(n);let h=a&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const f=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&f&&(!f.children||!f.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(h=!0),QN(n)===o&&f){let g=-1;for(;++g<t.children.length;){const y=t.children[g];if(y&&y.type==="listItem"&&y.children&&y.children[0]&&y.children[0].type==="thematicBreak"){h=!0;break}}}}h&&(o=d),n.bulletCurrent=o;const m=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=c,l(),m}function gP(t){const a=t.options.listItemIndent||"one";if(a!=="tab"&&a!=="one"&&a!=="mixed")throw new Error("Cannot serialize items with `"+a+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return a}function xP(t,a,n,i){const l=gP(n);let c=n.bulletCurrent||kx(n);a&&a.type==="list"&&a.ordered&&(c=(typeof a.start=="number"&&a.start>-1?a.start:1)+(n.options.incrementListMarker===!1?0:a.children.indexOf(t))+c);let o=c.length+1;(l==="tab"||l==="mixed"&&(a&&a.type==="list"&&a.spread||t.spread))&&(o=Math.ceil(o/4)*4);const d=n.createTracker(i);d.move(c+" ".repeat(o-c.length)),d.shift(o);const h=n.enter("listItem"),m=n.indentLines(n.containerFlow(t,d.current()),f);return h(),m;function f(g,y,b){return y?(b?"":" ".repeat(o))+g:(b?c:c+" ".repeat(o-c.length))+g}}function yP(t,a,n,i){const l=n.enter("paragraph"),c=n.enter("phrasing"),o=n.containerPhrasing(t,i);return c(),l(),o}const bP=om(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function jP(t,a,n,i){return(t.children.some(function(o){return bP(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function vP(t){const a=t.options.strong||"*";if(a!=="*"&&a!=="_")throw new Error("Cannot serialize strong with `"+a+"` for `options.strong`, expected `*`, or `_`");return a}YN.peek=NP;function YN(t,a,n,i){const l=vP(n),c=n.enter("strong"),o=n.createTracker(i),d=o.move(l+l);let h=o.move(n.containerPhrasing(t,{after:l,before:d,...o.current()}));const m=h.charCodeAt(0),f=qh(i.before.charCodeAt(i.before.length-1),m,l);f.inside&&(h=_u(m)+h.slice(1));const g=h.charCodeAt(h.length-1),y=qh(i.after.charCodeAt(0),g,l);y.inside&&(h=h.slice(0,-1)+_u(g));const b=o.move(l+l);return c(),n.attentionEncodeSurroundingInfo={after:y.outside,before:f.outside},d+h+b}function NP(t,a,n){return n.options.strong||"*"}function wP(t,a,n,i){return n.safe(t.value,i)}function SP(t){const a=t.options.ruleRepetition||3;if(a<3)throw new Error("Cannot serialize rules with repetition `"+a+"` for `options.ruleRepetition`, expected `3` or more");return a}function kP(t,a,n){const i=(QN(n)+(n.options.ruleSpaces?" ":"")).repeat(SP(n));return n.options.ruleSpaces?i.slice(0,-1):i}const JN={blockquote:YA,break:Qv,code:eP,definition:nP,emphasis:$N,hardBreak:Qv,heading:rP,html:MN,image:BN,imageReference:UN,inlineCode:qN,link:VN,linkReference:GN,list:fP,listItem:xP,paragraph:yP,root:jP,strong:YN,text:wP,thematicBreak:kP};function CP(){return{enter:{table:_P,tableData:Yv,tableHeader:Yv,tableRow:EP},exit:{codeText:TP,table:DP,tableData:Pf,tableHeader:Pf,tableRow:Pf}}}function _P(t){const a=t._align;this.enter({type:"table",align:a.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function DP(t){this.exit(t),this.data.inTable=void 0}function EP(t){this.enter({type:"tableRow",children:[]},t)}function Pf(t){this.exit(t)}function Yv(t){this.enter({type:"tableCell",children:[]},t)}function TP(t){let a=this.resume();this.data.inTable&&(a=a.replace(/\\([\\|])/g,AP));const n=this.stack[this.stack.length-1];n.type,n.value=a,this.exit(t)}function AP(t,a){return a==="|"?a:t}function PP(t){const a=t||{},n=a.tableCellPadding,i=a.tablePipeAlign,l=a.stringLength,c=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:y,table:o,tableCell:h,tableRow:d}};function o(b,v,w,S){return m(f(b,w,S),b.align)}function d(b,v,w,S){const _=g(b,w,S),E=m([_]);return E.slice(0,E.indexOf(`
`))}function h(b,v,w,S){const _=w.enter("tableCell"),E=w.enter("phrasing"),D=w.containerPhrasing(b,{...S,before:c,after:c});return E(),_(),D}function m(b,v){return GA(b,{align:v,alignDelimiters:i,padding:n,stringLength:l})}function f(b,v,w){const S=b.children;let _=-1;const E=[],D=v.enter("table");for(;++_<S.length;)E[_]=g(S[_],v,w);return D(),E}function g(b,v,w){const S=b.children;let _=-1;const E=[],D=v.enter("tableRow");for(;++_<S.length;)E[_]=h(S[_],b,v,w);return D(),E}function y(b,v,w){let S=JN.inlineCode(b,v,w);return w.stack.includes("tableCell")&&(S=S.replace(/\|/g,"\\$&")),S}}function RP(){return{exit:{taskListCheckValueChecked:Jv,taskListCheckValueUnchecked:Jv,paragraph:IP}}}function OP(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:zP}}}function Jv(t){const a=this.stack[this.stack.length-2];a.type,a.checked=t.type==="taskListCheckValueChecked"}function IP(t){const a=this.stack[this.stack.length-2];if(a&&a.type==="listItem"&&typeof a.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const i=n.children[0];if(i&&i.type==="text"){const l=a.children;let c=-1,o;for(;++c<l.length;){const d=l[c];if(d.type==="paragraph"){o=d;break}}o===n&&(i.value=i.value.slice(1),i.value.length===0?n.children.shift():n.position&&i.position&&typeof i.position.start.offset=="number"&&(i.position.start.column++,i.position.start.offset++,n.position.start=Object.assign({},i.position.start)))}}this.exit(t)}function zP(t,a,n,i){const l=t.children[0],c=typeof t.checked=="boolean"&&l&&l.type==="paragraph",o="["+(t.checked?"x":" ")+"] ",d=n.createTracker(i);c&&d.move(o);let h=JN.listItem(t,a,n,{...i,...d.current()});return c&&(h=h.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,m)),h;function m(f){return f+o}}function FP(){return[fA(),zA(),MA(),CP(),RP()]}function LP(t){return{extensions:[gA(),FA(t),BA(),PP(t),OP()]}}const $P={tokenize:VP,partial:!0},KN={tokenize:GP,partial:!0},WN={tokenize:QP,partial:!0},XN={tokenize:YP,partial:!0},MP={tokenize:JP,partial:!0},ZN={name:"wwwAutolink",tokenize:qP,previous:tw},ew={name:"protocolAutolink",tokenize:HP,previous:nw},Di={name:"emailAutolink",tokenize:UP,previous:aw},Zs={};function BP(){return{text:Zs}}let il=48;for(;il<123;)Zs[il]=Di,il++,il===58?il=65:il===91&&(il=97);Zs[43]=Di;Zs[45]=Di;Zs[46]=Di;Zs[95]=Di;Zs[72]=[Di,ew];Zs[104]=[Di,ew];Zs[87]=[Di,ZN];Zs[119]=[Di,ZN];function UP(t,a,n){const i=this;let l,c;return o;function o(g){return!Dg(g)||!aw.call(i,i.previous)||Cx(i.events)?n(g):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),d(g))}function d(g){return Dg(g)?(t.consume(g),d):g===64?(t.consume(g),h):n(g)}function h(g){return g===46?t.check(MP,f,m)(g):g===45||g===95||Xn(g)?(c=!0,t.consume(g),h):f(g)}function m(g){return t.consume(g),l=!0,h}function f(g){return c&&l&&ha(i.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),a(g)):n(g)}}function qP(t,a,n){const i=this;return l;function l(o){return o!==87&&o!==119||!tw.call(i,i.previous)||Cx(i.events)?n(o):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check($P,t.attempt(KN,t.attempt(WN,c),n),n)(o))}function c(o){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),a(o)}}function HP(t,a,n){const i=this;let l="",c=!1;return o;function o(g){return(g===72||g===104)&&nw.call(i,i.previous)&&!Cx(i.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),l+=String.fromCodePoint(g),t.consume(g),d):n(g)}function d(g){if(ha(g)&&l.length<5)return l+=String.fromCodePoint(g),t.consume(g),d;if(g===58){const y=l.toLowerCase();if(y==="http"||y==="https")return t.consume(g),h}return n(g)}function h(g){return g===47?(t.consume(g),c?m:(c=!0,h)):n(g)}function m(g){return g===null||Mh(g)||un(g)||yl(g)||im(g)?n(g):t.attempt(KN,t.attempt(WN,f),n)(g)}function f(g){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),a(g)}}function VP(t,a,n){let i=0;return l;function l(o){return(o===87||o===119)&&i<3?(i++,t.consume(o),l):o===46&&i===3?(t.consume(o),c):n(o)}function c(o){return o===null?n(o):a(o)}}function GP(t,a,n){let i,l,c;return o;function o(m){return m===46||m===95?t.check(XN,h,d)(m):m===null||un(m)||yl(m)||m!==45&&im(m)?h(m):(c=!0,t.consume(m),o)}function d(m){return m===95?i=!0:(l=i,i=void 0),t.consume(m),o}function h(m){return l||i||!c?n(m):a(m)}}function QP(t,a){let n=0,i=0;return l;function l(o){return o===40?(n++,t.consume(o),l):o===41&&i<n?c(o):o===33||o===34||o===38||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===60||o===63||o===93||o===95||o===126?t.check(XN,a,c)(o):o===null||un(o)||yl(o)?a(o):(t.consume(o),l)}function c(o){return o===41&&i++,t.consume(o),l}}function YP(t,a,n){return i;function i(d){return d===33||d===34||d===39||d===41||d===42||d===44||d===46||d===58||d===59||d===63||d===95||d===126?(t.consume(d),i):d===38?(t.consume(d),c):d===93?(t.consume(d),l):d===60||d===null||un(d)||yl(d)?a(d):n(d)}function l(d){return d===null||d===40||d===91||un(d)||yl(d)?a(d):i(d)}function c(d){return ha(d)?o(d):n(d)}function o(d){return d===59?(t.consume(d),i):ha(d)?(t.consume(d),o):n(d)}}function JP(t,a,n){return i;function i(c){return t.consume(c),l}function l(c){return Xn(c)?n(c):a(c)}}function tw(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||un(t)}function nw(t){return!ha(t)}function aw(t){return!(t===47||Dg(t))}function Dg(t){return t===43||t===45||t===46||t===95||Xn(t)}function Cx(t){let a=t.length,n=!1;for(;a--;){const i=t[a][1];if((i.type==="labelLink"||i.type==="labelImage")&&!i._balanced){n=!0;break}if(i._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const KP={tokenize:s4,partial:!0};function WP(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:t4,continuation:{tokenize:n4},exit:a4}},text:{91:{name:"gfmFootnoteCall",tokenize:e4},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:XP,resolveTo:ZP}}}}function XP(t,a,n){const i=this;let l=i.events.length;const c=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let o;for(;l--;){const h=i.events[l][1];if(h.type==="labelImage"){o=h;break}if(h.type==="gfmFootnoteCall"||h.type==="labelLink"||h.type==="label"||h.type==="image"||h.type==="link")break}return d;function d(h){if(!o||!o._balanced)return n(h);const m=ws(i.sliceSerialize({start:o.end,end:i.now()}));return m.codePointAt(0)!==94||!c.includes(m.slice(1))?n(h):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(h),t.exit("gfmFootnoteCallLabelMarker"),a(h))}}function ZP(t,a){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const i={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},l={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};l.end.column++,l.end.offset++,l.end._bufferIndex++;const c={type:"gfmFootnoteCallString",start:Object.assign({},l.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},c.start),end:Object.assign({},c.end)},d=[t[n+1],t[n+2],["enter",i,a],t[n+3],t[n+4],["enter",l,a],["exit",l,a],["enter",c,a],["enter",o,a],["exit",o,a],["exit",c,a],t[t.length-2],t[t.length-1],["exit",i,a]];return t.splice(n,t.length-n+1,...d),t}function e4(t,a,n){const i=this,l=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let c=0,o;return d;function d(g){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(g),t.exit("gfmFootnoteCallLabelMarker"),h}function h(g){return g!==94?n(g):(t.enter("gfmFootnoteCallMarker"),t.consume(g),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",m)}function m(g){if(c>999||g===93&&!o||g===null||g===91||un(g))return n(g);if(g===93){t.exit("chunkString");const y=t.exit("gfmFootnoteCallString");return l.includes(ws(i.sliceSerialize(y)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(g),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),a):n(g)}return un(g)||(o=!0),c++,t.consume(g),g===92?f:m}function f(g){return g===91||g===92||g===93?(t.consume(g),c++,m):m(g)}}function t4(t,a,n){const i=this,l=i.parser.gfmFootnotes||(i.parser.gfmFootnotes=[]);let c,o=0,d;return h;function h(v){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(v),t.exit("gfmFootnoteDefinitionLabelMarker"),m}function m(v){return v===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(v),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",f):n(v)}function f(v){if(o>999||v===93&&!d||v===null||v===91||un(v))return n(v);if(v===93){t.exit("chunkString");const w=t.exit("gfmFootnoteDefinitionLabelString");return c=ws(i.sliceSerialize(w)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(v),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),y}return un(v)||(d=!0),o++,t.consume(v),v===92?g:f}function g(v){return v===91||v===92||v===93?(t.consume(v),o++,f):f(v)}function y(v){return v===58?(t.enter("definitionMarker"),t.consume(v),t.exit("definitionMarker"),l.includes(c)||l.push(c),Gt(t,b,"gfmFootnoteDefinitionWhitespace")):n(v)}function b(v){return a(v)}}function n4(t,a,n){return t.check(Fu,a,t.attempt(KP,a,n))}function a4(t){t.exit("gfmFootnoteDefinition")}function s4(t,a,n){const i=this;return Gt(t,l,"gfmFootnoteDefinitionIndent",5);function l(c){const o=i.events[i.events.length-1];return o&&o[1].type==="gfmFootnoteDefinitionIndent"&&o[2].sliceSerialize(o[1],!0).length===4?a(c):n(c)}}function i4(t){let n=(t||{}).singleTilde;const i={name:"strikethrough",tokenize:c,resolveAll:l};return n==null&&(n=!0),{text:{126:i},insideSpan:{null:[i]},attentionMarkers:{null:[126]}};function l(o,d){let h=-1;for(;++h<o.length;)if(o[h][0]==="enter"&&o[h][1].type==="strikethroughSequenceTemporary"&&o[h][1]._close){let m=h;for(;m--;)if(o[m][0]==="exit"&&o[m][1].type==="strikethroughSequenceTemporary"&&o[m][1]._open&&o[h][1].end.offset-o[h][1].start.offset===o[m][1].end.offset-o[m][1].start.offset){o[h][1].type="strikethroughSequence",o[m][1].type="strikethroughSequence";const f={type:"strikethrough",start:Object.assign({},o[m][1].start),end:Object.assign({},o[h][1].end)},g={type:"strikethroughText",start:Object.assign({},o[m][1].end),end:Object.assign({},o[h][1].start)},y=[["enter",f,d],["enter",o[m][1],d],["exit",o[m][1],d],["enter",g,d]],b=d.parser.constructs.insideSpan.null;b&&Ga(y,y.length,0,rm(b,o.slice(m+1,h),d)),Ga(y,y.length,0,[["exit",g,d],["enter",o[h][1],d],["exit",o[h][1],d],["exit",f,d]]),Ga(o,m-1,h-m+3,y),h=m+y.length-2;break}}for(h=-1;++h<o.length;)o[h][1].type==="strikethroughSequenceTemporary"&&(o[h][1].type="data");return o}function c(o,d,h){const m=this.previous,f=this.events;let g=0;return y;function y(v){return m===126&&f[f.length-1][1].type!=="characterEscape"?h(v):(o.enter("strikethroughSequenceTemporary"),b(v))}function b(v){const w=Ho(m);if(v===126)return g>1?h(v):(o.consume(v),g++,b);if(g<2&&!n)return h(v);const S=o.exit("strikethroughSequenceTemporary"),_=Ho(v);return S._open=!_||_===2&&!!w,S._close=!w||w===2&&!!_,d(v)}}}class r4{constructor(){this.map=[]}add(a,n,i){l4(this,a,n,i)}consume(a){if(this.map.sort(function(c,o){return c[0]-o[0]}),this.map.length===0)return;let n=this.map.length;const i=[];for(;n>0;)n-=1,i.push(a.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),a.length=this.map[n][0];i.push(a.slice()),a.length=0;let l=i.pop();for(;l;){for(const c of l)a.push(c);l=i.pop()}this.map.length=0}}function l4(t,a,n,i){let l=0;if(!(n===0&&i.length===0)){for(;l<t.map.length;){if(t.map[l][0]===a){t.map[l][1]+=n,t.map[l][2].push(...i);return}l+=1}t.map.push([a,n,i])}}function o4(t,a){let n=!1;const i=[];for(;a<t.length;){const l=t[a];if(n){if(l[0]==="enter")l[1].type==="tableContent"&&i.push(t[a+1][1].type==="tableDelimiterMarker"?"left":"none");else if(l[1].type==="tableContent"){if(t[a-1][1].type==="tableDelimiterMarker"){const c=i.length-1;i[c]=i[c]==="left"?"center":"right"}}else if(l[1].type==="tableDelimiterRow")break}else l[0]==="enter"&&l[1].type==="tableDelimiterRow"&&(n=!0);a+=1}return i}function c4(){return{flow:{null:{name:"table",tokenize:u4,resolveAll:d4}}}}function u4(t,a,n){const i=this;let l=0,c=0,o;return d;function d(C){let R=i.events.length-1;for(;R>-1;){const J=i.events[R][1].type;if(J==="lineEnding"||J==="linePrefix")R--;else break}const z=R>-1?i.events[R][1].type:null,F=z==="tableHead"||z==="tableRow"?A:h;return F===A&&i.parser.lazy[i.now().line]?n(C):F(C)}function h(C){return t.enter("tableHead"),t.enter("tableRow"),m(C)}function m(C){return C===124||(o=!0,c+=1),f(C)}function f(C){return C===null?n(C):vt(C)?c>1?(c=0,i.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(C),t.exit("lineEnding"),b):n(C):Ut(C)?Gt(t,f,"whitespace")(C):(c+=1,o&&(o=!1,l+=1),C===124?(t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),o=!0,f):(t.enter("data"),g(C)))}function g(C){return C===null||C===124||un(C)?(t.exit("data"),f(C)):(t.consume(C),C===92?y:g)}function y(C){return C===92||C===124?(t.consume(C),g):g(C)}function b(C){return i.interrupt=!1,i.parser.lazy[i.now().line]?n(C):(t.enter("tableDelimiterRow"),o=!1,Ut(C)?Gt(t,v,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(C):v(C))}function v(C){return C===45||C===58?S(C):C===124?(o=!0,t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),w):M(C)}function w(C){return Ut(C)?Gt(t,S,"whitespace")(C):S(C)}function S(C){return C===58?(c+=1,o=!0,t.enter("tableDelimiterMarker"),t.consume(C),t.exit("tableDelimiterMarker"),_):C===45?(c+=1,_(C)):C===null||vt(C)?O(C):M(C)}function _(C){return C===45?(t.enter("tableDelimiterFiller"),E(C)):M(C)}function E(C){return C===45?(t.consume(C),E):C===58?(o=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(C),t.exit("tableDelimiterMarker"),D):(t.exit("tableDelimiterFiller"),D(C))}function D(C){return Ut(C)?Gt(t,O,"whitespace")(C):O(C)}function O(C){return C===124?v(C):C===null||vt(C)?!o||l!==c?M(C):(t.exit("tableDelimiterRow"),t.exit("tableHead"),a(C)):M(C)}function M(C){return n(C)}function A(C){return t.enter("tableRow"),P(C)}function P(C){return C===124?(t.enter("tableCellDivider"),t.consume(C),t.exit("tableCellDivider"),P):C===null||vt(C)?(t.exit("tableRow"),a(C)):Ut(C)?Gt(t,P,"whitespace")(C):(t.enter("data"),Q(C))}function Q(C){return C===null||C===124||un(C)?(t.exit("data"),P(C)):(t.consume(C),C===92?G:Q)}function G(C){return C===92||C===124?(t.consume(C),Q):Q(C)}}function d4(t,a){let n=-1,i=!0,l=0,c=[0,0,0,0],o=[0,0,0,0],d=!1,h=0,m,f,g;const y=new r4;for(;++n<t.length;){const b=t[n],v=b[1];b[0]==="enter"?v.type==="tableHead"?(d=!1,h!==0&&(Kv(y,a,h,m,f),f=void 0,h=0),m={type:"table",start:Object.assign({},v.start),end:Object.assign({},v.end)},y.add(n,0,[["enter",m,a]])):v.type==="tableRow"||v.type==="tableDelimiterRow"?(i=!0,g=void 0,c=[0,0,0,0],o=[0,n+1,0,0],d&&(d=!1,f={type:"tableBody",start:Object.assign({},v.start),end:Object.assign({},v.end)},y.add(n,0,[["enter",f,a]])),l=v.type==="tableDelimiterRow"?2:f?3:1):l&&(v.type==="data"||v.type==="tableDelimiterMarker"||v.type==="tableDelimiterFiller")?(i=!1,o[2]===0&&(c[1]!==0&&(o[0]=o[1],g=mh(y,a,c,l,void 0,g),c=[0,0,0,0]),o[2]=n)):v.type==="tableCellDivider"&&(i?i=!1:(c[1]!==0&&(o[0]=o[1],g=mh(y,a,c,l,void 0,g)),c=o,o=[c[1],n,0,0])):v.type==="tableHead"?(d=!0,h=n):v.type==="tableRow"||v.type==="tableDelimiterRow"?(h=n,c[1]!==0?(o[0]=o[1],g=mh(y,a,c,l,n,g)):o[1]!==0&&(g=mh(y,a,o,l,n,g)),l=0):l&&(v.type==="data"||v.type==="tableDelimiterMarker"||v.type==="tableDelimiterFiller")&&(o[3]=n)}for(h!==0&&Kv(y,a,h,m,f),y.consume(a.events),n=-1;++n<a.events.length;){const b=a.events[n];b[0]==="enter"&&b[1].type==="table"&&(b[1]._align=o4(a.events,n))}return t}function mh(t,a,n,i,l,c){const o=i===1?"tableHeader":i===2?"tableDelimiter":"tableData",d="tableContent";n[0]!==0&&(c.end=Object.assign({},ko(a.events,n[0])),t.add(n[0],0,[["exit",c,a]]));const h=ko(a.events,n[1]);if(c={type:o,start:Object.assign({},h),end:Object.assign({},h)},t.add(n[1],0,[["enter",c,a]]),n[2]!==0){const m=ko(a.events,n[2]),f=ko(a.events,n[3]),g={type:d,start:Object.assign({},m),end:Object.assign({},f)};if(t.add(n[2],0,[["enter",g,a]]),i!==2){const y=a.events[n[2]],b=a.events[n[3]];if(y[1].end=Object.assign({},b[1].end),y[1].type="chunkText",y[1].contentType="text",n[3]>n[2]+1){const v=n[2]+1,w=n[3]-n[2]-1;t.add(v,w,[])}}t.add(n[3]+1,0,[["exit",g,a]])}return l!==void 0&&(c.end=Object.assign({},ko(a.events,l)),t.add(l,0,[["exit",c,a]]),c=void 0),c}function Kv(t,a,n,i,l){const c=[],o=ko(a.events,n);l&&(l.end=Object.assign({},o),c.push(["exit",l,a])),i.end=Object.assign({},o),c.push(["exit",i,a]),t.add(n+1,0,c)}function ko(t,a){const n=t[a],i=n[0]==="enter"?"start":"end";return n[1][i]}const h4={name:"tasklistCheck",tokenize:p4};function m4(){return{text:{91:h4}}}function p4(t,a,n){const i=this;return l;function l(h){return i.previous!==null||!i._gfmTasklistFirstContentOfListItem?n(h):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(h),t.exit("taskListCheckMarker"),c)}function c(h){return un(h)?(t.enter("taskListCheckValueUnchecked"),t.consume(h),t.exit("taskListCheckValueUnchecked"),o):h===88||h===120?(t.enter("taskListCheckValueChecked"),t.consume(h),t.exit("taskListCheckValueChecked"),o):n(h)}function o(h){return h===93?(t.enter("taskListCheckMarker"),t.consume(h),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),d):n(h)}function d(h){return vt(h)?a(h):Ut(h)?t.check({tokenize:f4},a,n)(h):n(h)}}function f4(t,a,n){return Gt(t,i,"whitespace");function i(l){return l===null?n(l):a(l)}}function g4(t){return mN([BP(),WP(),i4(t),c4(),m4()])}const x4={};function Wn(t){const a=this,n=t||x4,i=a.data(),l=i.micromarkExtensions||(i.micromarkExtensions=[]),c=i.fromMarkdownExtensions||(i.fromMarkdownExtensions=[]),o=i.toMarkdownExtensions||(i.toMarkdownExtensions=[]);l.push(g4(n)),c.push(FP()),o.push(LP(n))}const y4="_container_c9bhr_3",b4="_header_c9bhr_21",j4="_titleGroup_c9bhr_41",v4="_title_c9bhr_41",N4="_closeButton_c9bhr_59",w4="_messageList_c9bhr_79",S4="_emptyState_c9bhr_108",k4="_emptyStateIcon_c9bhr_119",C4="_exampleContainer_c9bhr_145",_4="_exampleChip_c9bhr_153",D4="_messageRow_c9bhr_176",E4="_messageRowUser_c9bhr_194",T4="_messageRowModel_c9bhr_198",A4="_messageRowSystem_c9bhr_202",P4="_bubble_c9bhr_208",R4="_bubbleUser_c9bhr_224",O4="_bubbleModel_c9bhr_234",I4="_bubbleSystem_c9bhr_247",z4="_processingIndicator_c9bhr_330",F4="_spin_c9bhr_343",L4="_inputArea_c9bhr_358",$4="_imagePreviewContainer_c9bhr_365",M4="_inputContainer_c9bhr_376",B4="_inputField_c9bhr_393",U4="_sendButton_c9bhr_407",Zt={container:y4,header:b4,titleGroup:j4,title:v4,closeButton:N4,messageList:w4,emptyState:S4,emptyStateIcon:k4,exampleContainer:C4,exampleChip:_4,messageRow:D4,messageRowUser:E4,messageRowModel:T4,messageRowSystem:A4,bubble:P4,bubbleUser:R4,bubbleModel:O4,bubbleSystem:I4,processingIndicator:z4,spin:F4,inputArea:L4,imagePreviewContainer:$4,inputContainer:M4,inputField:B4,sendButton:U4},sw=({onClose:t,settings:a,staffList:n,onSettingsUpdate:i,onStaffUpdate:l,onHighlight:c})=>{const{chatQuery:o,setChatQuery:d,chatHistory:h,isProcessing:m,handleSendMessage:f,refreshChat:g,stopGeneration:y,selectedImage:b,handleImageSelect:v,clearImage:w}=cx({settings:a,staffList:n,onSettingsUpdate:i,onStaffUpdate:l,onHighlight:c}),S=x.useRef(null),_=x.useRef(null),E=()=>{var A;(A=S.current)==null||A.scrollIntoView({behavior:"smooth"})};x.useEffect(()=>{E()},[h,m]);const D=A=>{var Q;const P=(Q=A.target.files)==null?void 0:Q[0];P&&v(P)},O=["Check Paracetamol stock","Go to Pharmacy","Analysis for last month","Add nurse Sarah"],M=A=>{d(A)};return e.jsxs("div",{className:Zt.container,children:[e.jsxs("header",{className:Zt.header,children:[e.jsxs("div",{className:Zt.titleGroup,children:[e.jsx(Ph,{size:20,className:"text-violet-600"}),e.jsx("h3",{className:Zt.title,children:"Clinic Assistant"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{onClick:g,className:Zt.closeButton,title:"Refresh Chat",children:e.jsx(N1,{size:18})}),e.jsx("button",{onClick:t,className:Zt.closeButton,title:"Close",children:e.jsx(St,{size:20})})]})]}),e.jsxs("div",{className:Zt.messageList,children:[h.length===0&&e.jsxs("div",{className:Zt.emptyState,children:[e.jsx(Ph,{size:48,className:Zt.emptyStateIcon}),e.jsx("p",{children:"How can I help you manage the clinic today?"}),e.jsx("div",{className:Zt.exampleContainer,children:O.map((A,P)=>e.jsx("button",{className:Zt.exampleChip,onClick:()=>M(A),children:A},P))})]}),h.map((A,P)=>e.jsx("div",{className:`${Zt.messageRow} ${A.role==="user"?Zt.messageRowUser:A.role==="model"?Zt.messageRowModel:Zt.messageRowSystem}`,children:e.jsx("div",{className:`${Zt.bubble} ${A.role==="user"?Zt.bubbleUser:A.role==="model"?Zt.bubbleModel:Zt.bubbleSystem}`,children:A.role==="user"||A.role==="system"?A.text:e.jsx(qa,{remarkPlugins:[Wn],children:A.text})})},P)),m&&e.jsx("div",{className:`${Zt.messageRow} ${Zt.messageRowModel}`,children:e.jsxs("div",{className:Zt.processingIndicator,children:[e.jsx(Ci,{size:14,className:Zt.spin}),"Thinking..."]})}),e.jsx("div",{ref:S})]}),e.jsxs("div",{className:Zt.inputArea,children:[b&&e.jsxs("div",{className:Zt.imagePreviewContainer,style:{marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("div",{style:{position:"relative",width:"60px",height:"60px",border:"1px solid #e5e7eb",borderRadius:"4px",overflow:"hidden"},children:[e.jsx("img",{src:b,alt:"Selected",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("button",{onClick:w,style:{position:"absolute",top:0,right:0,background:"rgba(0,0,0,0.5)",color:"white",border:"none",cursor:"pointer",padding:"1px"},children:e.jsx(St,{size:12})})]}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#6b7280"},children:"Image attached"})]}),e.jsxs("div",{className:Zt.inputContainer,children:[e.jsx("input",{type:"file",ref:_,onChange:D,accept:"image/*",style:{display:"none"}}),e.jsx("button",{className:Zt.sendButton,onClick:()=>{var A;return(A=_.current)==null?void 0:A.click()},disabled:m,title:"Attach Image",style:{marginRight:"0.5rem",color:"#6b7280"},children:e.jsx(Kh,{size:18})}),e.jsx("input",{type:"text",className:Zt.inputField,placeholder:"Type your request...",value:o,onChange:A=>d(A.target.value),onKeyDown:A=>A.key==="Enter"&&!m&&f(),disabled:m,autoFocus:!0}),m?e.jsx("button",{className:Zt.sendButton,onClick:y,title:"Stop Generating",style:{color:"#ef4444"},children:e.jsx(lC,{size:18,fill:"currentColor"})}):e.jsx("button",{className:Zt.sendButton,onClick:()=>f(),disabled:!o.trim()&&!b,children:e.jsx(Wh,{size:18})})]})]})]})};function _i(t){return Array.isArray?Array.isArray(t):lw(t)==="[object Array]"}function q4(t){if(typeof t=="string")return t;let a=t+"";return a=="0"&&1/t==-1/0?"-0":a}function H4(t){return t==null?"":q4(t)}function Ws(t){return typeof t=="string"}function iw(t){return typeof t=="number"}function V4(t){return t===!0||t===!1||G4(t)&&lw(t)=="[object Boolean]"}function rw(t){return typeof t=="object"}function G4(t){return rw(t)&&t!==null}function Ha(t){return t!=null}function Rf(t){return!t.trim().length}function lw(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Q4="Incorrect 'index' type",Y4=t=>`Invalid value for key ${t}`,J4=t=>`Pattern length exceeds max of ${t}.`,K4=t=>`Missing ${t} property in key`,W4=t=>`Property 'weight' in key '${t}' must be a positive integer`,Wv=Object.prototype.hasOwnProperty;class X4{constructor(a){this._keys=[],this._keyMap={};let n=0;a.forEach(i=>{let l=ow(i);this._keys.push(l),this._keyMap[l.id]=l,n+=l.weight}),this._keys.forEach(i=>{i.weight/=n})}get(a){return this._keyMap[a]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function ow(t){let a=null,n=null,i=null,l=1,c=null;if(Ws(t)||_i(t))i=t,a=Xv(t),n=Eg(t);else{if(!Wv.call(t,"name"))throw new Error(K4("name"));const o=t.name;if(i=o,Wv.call(t,"weight")&&(l=t.weight,l<=0))throw new Error(W4(o));a=Xv(o),n=Eg(o),c=t.getFn}return{path:a,id:n,weight:l,src:i,getFn:c}}function Xv(t){return _i(t)?t:t.split(".")}function Eg(t){return _i(t)?t.join("."):t}function Z4(t,a){let n=[],i=!1;const l=(c,o,d)=>{if(Ha(c))if(!o[d])n.push(c);else{let h=o[d];const m=c[h];if(!Ha(m))return;if(d===o.length-1&&(Ws(m)||iw(m)||V4(m)))n.push(H4(m));else if(_i(m)){i=!0;for(let f=0,g=m.length;f<g;f+=1)l(m[f],o,d+1)}else o.length&&l(m,o,d+1)}};return l(t,Ws(a)?a.split("."):a,0),i?n:n[0]}const e3={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},t3={isCaseSensitive:!1,ignoreDiacritics:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,a)=>t.score===a.score?t.idx<a.idx?-1:1:t.score<a.score?-1:1},n3={location:0,threshold:.6,distance:100},a3={useExtendedSearch:!1,getFn:Z4,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var Ct={...t3,...e3,...n3,...a3};const s3=/[^ ]+/g;function i3(t=1,a=3){const n=new Map,i=Math.pow(10,a);return{get(l){const c=l.match(s3).length;if(n.has(c))return n.get(c);const o=1/Math.pow(c,.5*t),d=parseFloat(Math.round(o*i)/i);return n.set(c,d),d},clear(){n.clear()}}}class _x{constructor({getFn:a=Ct.getFn,fieldNormWeight:n=Ct.fieldNormWeight}={}){this.norm=i3(n,3),this.getFn=a,this.isCreated=!1,this.setIndexRecords()}setSources(a=[]){this.docs=a}setIndexRecords(a=[]){this.records=a}setKeys(a=[]){this.keys=a,this._keysMap={},a.forEach((n,i)=>{this._keysMap[n.id]=i})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ws(this.docs[0])?this.docs.forEach((a,n)=>{this._addString(a,n)}):this.docs.forEach((a,n)=>{this._addObject(a,n)}),this.norm.clear())}add(a){const n=this.size();Ws(a)?this._addString(a,n):this._addObject(a,n)}removeAt(a){this.records.splice(a,1);for(let n=a,i=this.size();n<i;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(a,n){return a[this._keysMap[n]]}size(){return this.records.length}_addString(a,n){if(!Ha(a)||Rf(a))return;let i={v:a,i:n,n:this.norm.get(a)};this.records.push(i)}_addObject(a,n){let i={i:n,$:{}};this.keys.forEach((l,c)=>{let o=l.getFn?l.getFn(a):this.getFn(a,l.path);if(Ha(o)){if(_i(o)){let d=[];const h=[{nestedArrIndex:-1,value:o}];for(;h.length;){const{nestedArrIndex:m,value:f}=h.pop();if(Ha(f))if(Ws(f)&&!Rf(f)){let g={v:f,i:m,n:this.norm.get(f)};d.push(g)}else _i(f)&&f.forEach((g,y)=>{h.push({nestedArrIndex:y,value:g})})}i.$[c]=d}else if(Ws(o)&&!Rf(o)){let d={v:o,n:this.norm.get(o)};i.$[c]=d}}}),this.records.push(i)}toJSON(){return{keys:this.keys,records:this.records}}}function cw(t,a,{getFn:n=Ct.getFn,fieldNormWeight:i=Ct.fieldNormWeight}={}){const l=new _x({getFn:n,fieldNormWeight:i});return l.setKeys(t.map(ow)),l.setSources(a),l.create(),l}function r3(t,{getFn:a=Ct.getFn,fieldNormWeight:n=Ct.fieldNormWeight}={}){const{keys:i,records:l}=t,c=new _x({getFn:a,fieldNormWeight:n});return c.setKeys(i),c.setIndexRecords(l),c}function ph(t,{errors:a=0,currentLocation:n=0,expectedLocation:i=0,distance:l=Ct.distance,ignoreLocation:c=Ct.ignoreLocation}={}){const o=a/t.length;if(c)return o;const d=Math.abs(i-n);return l?o+d/l:d?1:o}function l3(t=[],a=Ct.minMatchCharLength){let n=[],i=-1,l=-1,c=0;for(let o=t.length;c<o;c+=1){let d=t[c];d&&i===-1?i=c:!d&&i!==-1&&(l=c-1,l-i+1>=a&&n.push([i,l]),i=-1)}return t[c-1]&&c-i>=a&&n.push([i,c-1]),n}const cl=32;function o3(t,a,n,{location:i=Ct.location,distance:l=Ct.distance,threshold:c=Ct.threshold,findAllMatches:o=Ct.findAllMatches,minMatchCharLength:d=Ct.minMatchCharLength,includeMatches:h=Ct.includeMatches,ignoreLocation:m=Ct.ignoreLocation}={}){if(a.length>cl)throw new Error(J4(cl));const f=a.length,g=t.length,y=Math.max(0,Math.min(i,g));let b=c,v=y;const w=d>1||h,S=w?Array(g):[];let _;for(;(_=t.indexOf(a,v))>-1;){let P=ph(a,{currentLocation:_,expectedLocation:y,distance:l,ignoreLocation:m});if(b=Math.min(P,b),v=_+f,w){let Q=0;for(;Q<f;)S[_+Q]=1,Q+=1}}v=-1;let E=[],D=1,O=f+g;const M=1<<f-1;for(let P=0;P<f;P+=1){let Q=0,G=O;for(;Q<G;)ph(a,{errors:P,currentLocation:y+G,expectedLocation:y,distance:l,ignoreLocation:m})<=b?Q=G:O=G,G=Math.floor((O-Q)/2+Q);O=G;let C=Math.max(1,y-G+1),R=o?g:Math.min(y+G,g)+f,z=Array(R+2);z[R+1]=(1<<P)-1;for(let J=R;J>=C;J-=1){let H=J-1,I=n[t.charAt(H)];if(w&&(S[H]=+!!I),z[J]=(z[J+1]<<1|1)&I,P&&(z[J]|=(E[J+1]|E[J])<<1|1|E[J+1]),z[J]&M&&(D=ph(a,{errors:P,currentLocation:H,expectedLocation:y,distance:l,ignoreLocation:m}),D<=b)){if(b=D,v=H,v<=y)break;C=Math.max(1,2*y-v)}}if(ph(a,{errors:P+1,currentLocation:y,expectedLocation:y,distance:l,ignoreLocation:m})>b)break;E=z}const A={isMatch:v>=0,score:Math.max(.001,D)};if(w){const P=l3(S,d);P.length?h&&(A.indices=P):A.isMatch=!1}return A}function c3(t){let a={};for(let n=0,i=t.length;n<i;n+=1){const l=t.charAt(n);a[l]=(a[l]||0)|1<<i-n-1}return a}const Hh=String.prototype.normalize?t=>t.normalize("NFD").replace(/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u1885\u1886\u18A9\u1920-\u192B\u1930-\u193B\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C5\uA8E0-\uA8F1\uA8FF\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/g,""):t=>t;class uw{constructor(a,{location:n=Ct.location,threshold:i=Ct.threshold,distance:l=Ct.distance,includeMatches:c=Ct.includeMatches,findAllMatches:o=Ct.findAllMatches,minMatchCharLength:d=Ct.minMatchCharLength,isCaseSensitive:h=Ct.isCaseSensitive,ignoreDiacritics:m=Ct.ignoreDiacritics,ignoreLocation:f=Ct.ignoreLocation}={}){if(this.options={location:n,threshold:i,distance:l,includeMatches:c,findAllMatches:o,minMatchCharLength:d,isCaseSensitive:h,ignoreDiacritics:m,ignoreLocation:f},a=h?a:a.toLowerCase(),a=m?Hh(a):a,this.pattern=a,this.chunks=[],!this.pattern.length)return;const g=(b,v)=>{this.chunks.push({pattern:b,alphabet:c3(b),startIndex:v})},y=this.pattern.length;if(y>cl){let b=0;const v=y%cl,w=y-v;for(;b<w;)g(this.pattern.substr(b,cl),b),b+=cl;if(v){const S=y-cl;g(this.pattern.substr(S),S)}}else g(this.pattern,0)}searchIn(a){const{isCaseSensitive:n,ignoreDiacritics:i,includeMatches:l}=this.options;if(a=n?a:a.toLowerCase(),a=i?Hh(a):a,this.pattern===a){let w={isMatch:!0,score:0};return l&&(w.indices=[[0,a.length-1]]),w}const{location:c,distance:o,threshold:d,findAllMatches:h,minMatchCharLength:m,ignoreLocation:f}=this.options;let g=[],y=0,b=!1;this.chunks.forEach(({pattern:w,alphabet:S,startIndex:_})=>{const{isMatch:E,score:D,indices:O}=o3(a,w,S,{location:c+_,distance:o,threshold:d,findAllMatches:h,minMatchCharLength:m,includeMatches:l,ignoreLocation:f});E&&(b=!0),y+=D,E&&O&&(g=[...g,...O])});let v={isMatch:b,score:b?y/this.chunks.length:1};return b&&l&&(v.indices=g),v}}class Er{constructor(a){this.pattern=a}static isMultiMatch(a){return Zv(a,this.multiRegex)}static isSingleMatch(a){return Zv(a,this.singleRegex)}search(){}}function Zv(t,a){const n=t.match(a);return n?n[1]:null}class u3 extends Er{constructor(a){super(a)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(a){const n=a===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class d3 extends Er{constructor(a){super(a)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(a){const i=a.indexOf(this.pattern)===-1;return{isMatch:i,score:i?0:1,indices:[0,a.length-1]}}}class h3 extends Er{constructor(a){super(a)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(a){const n=a.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}}class m3 extends Er{constructor(a){super(a)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(a){const n=!a.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,a.length-1]}}}class p3 extends Er{constructor(a){super(a)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(a){const n=a.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[a.length-this.pattern.length,a.length-1]}}}class f3 extends Er{constructor(a){super(a)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(a){const n=!a.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,a.length-1]}}}class dw extends Er{constructor(a,{location:n=Ct.location,threshold:i=Ct.threshold,distance:l=Ct.distance,includeMatches:c=Ct.includeMatches,findAllMatches:o=Ct.findAllMatches,minMatchCharLength:d=Ct.minMatchCharLength,isCaseSensitive:h=Ct.isCaseSensitive,ignoreDiacritics:m=Ct.ignoreDiacritics,ignoreLocation:f=Ct.ignoreLocation}={}){super(a),this._bitapSearch=new uw(a,{location:n,threshold:i,distance:l,includeMatches:c,findAllMatches:o,minMatchCharLength:d,isCaseSensitive:h,ignoreDiacritics:m,ignoreLocation:f})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(a){return this._bitapSearch.searchIn(a)}}class hw extends Er{constructor(a){super(a)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(a){let n=0,i;const l=[],c=this.pattern.length;for(;(i=a.indexOf(this.pattern,n))>-1;)n=i+c,l.push([i,n-1]);const o=!!l.length;return{isMatch:o,score:o?0:1,indices:l}}}const Tg=[u3,hw,h3,m3,f3,p3,d3,dw],e0=Tg.length,g3=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,x3="|";function y3(t,a={}){return t.split(x3).map(n=>{let i=n.trim().split(g3).filter(c=>c&&!!c.trim()),l=[];for(let c=0,o=i.length;c<o;c+=1){const d=i[c];let h=!1,m=-1;for(;!h&&++m<e0;){const f=Tg[m];let g=f.isMultiMatch(d);g&&(l.push(new f(g,a)),h=!0)}if(!h)for(m=-1;++m<e0;){const f=Tg[m];let g=f.isSingleMatch(d);if(g){l.push(new f(g,a));break}}}return l})}const b3=new Set([dw.type,hw.type]);class j3{constructor(a,{isCaseSensitive:n=Ct.isCaseSensitive,ignoreDiacritics:i=Ct.ignoreDiacritics,includeMatches:l=Ct.includeMatches,minMatchCharLength:c=Ct.minMatchCharLength,ignoreLocation:o=Ct.ignoreLocation,findAllMatches:d=Ct.findAllMatches,location:h=Ct.location,threshold:m=Ct.threshold,distance:f=Ct.distance}={}){this.query=null,this.options={isCaseSensitive:n,ignoreDiacritics:i,includeMatches:l,minMatchCharLength:c,findAllMatches:d,ignoreLocation:o,location:h,threshold:m,distance:f},a=n?a:a.toLowerCase(),a=i?Hh(a):a,this.pattern=a,this.query=y3(this.pattern,this.options)}static condition(a,n){return n.useExtendedSearch}searchIn(a){const n=this.query;if(!n)return{isMatch:!1,score:1};const{includeMatches:i,isCaseSensitive:l,ignoreDiacritics:c}=this.options;a=l?a:a.toLowerCase(),a=c?Hh(a):a;let o=0,d=[],h=0;for(let m=0,f=n.length;m<f;m+=1){const g=n[m];d.length=0,o=0;for(let y=0,b=g.length;y<b;y+=1){const v=g[y],{isMatch:w,indices:S,score:_}=v.search(a);if(w){if(o+=1,h+=_,i){const E=v.constructor.type;b3.has(E)?d=[...d,...S]:d.push(S)}}else{h=0,o=0,d.length=0;break}}if(o){let y={isMatch:!0,score:h/o};return i&&(y.indices=d),y}}return{isMatch:!1,score:1}}}const Ag=[];function v3(...t){Ag.push(...t)}function Pg(t,a){for(let n=0,i=Ag.length;n<i;n+=1){let l=Ag[n];if(l.condition(t,a))return new l(t,a)}return new uw(t,a)}const Vh={AND:"$and",OR:"$or"},Rg={PATH:"$path",PATTERN:"$val"},Og=t=>!!(t[Vh.AND]||t[Vh.OR]),N3=t=>!!t[Rg.PATH],w3=t=>!_i(t)&&rw(t)&&!Og(t),t0=t=>({[Vh.AND]:Object.keys(t).map(a=>({[a]:t[a]}))});function mw(t,a,{auto:n=!0}={}){const i=l=>{let c=Object.keys(l);const o=N3(l);if(!o&&c.length>1&&!Og(l))return i(t0(l));if(w3(l)){const h=o?l[Rg.PATH]:c[0],m=o?l[Rg.PATTERN]:l[h];if(!Ws(m))throw new Error(Y4(h));const f={keyId:Eg(h),pattern:m};return n&&(f.searcher=Pg(m,a)),f}let d={children:[],operator:c[0]};return c.forEach(h=>{const m=l[h];_i(m)&&m.forEach(f=>{d.children.push(i(f))})}),d};return Og(t)||(t=t0(t)),i(t)}function S3(t,{ignoreFieldNorm:a=Ct.ignoreFieldNorm}){t.forEach(n=>{let i=1;n.matches.forEach(({key:l,norm:c,score:o})=>{const d=l?l.weight:null;i*=Math.pow(o===0&&d?Number.EPSILON:o,(d||1)*(a?1:c))}),n.score=i})}function k3(t,a){const n=t.matches;a.matches=[],Ha(n)&&n.forEach(i=>{if(!Ha(i.indices)||!i.indices.length)return;const{indices:l,value:c}=i;let o={indices:l,value:c};i.key&&(o.key=i.key.src),i.idx>-1&&(o.refIndex=i.idx),a.matches.push(o)})}function C3(t,a){a.score=t.score}function _3(t,a,{includeMatches:n=Ct.includeMatches,includeScore:i=Ct.includeScore}={}){const l=[];return n&&l.push(k3),i&&l.push(C3),t.map(c=>{const{idx:o}=c,d={item:a[o],refIndex:o};return l.length&&l.forEach(h=>{h(c,d)}),d})}class Da{constructor(a,n={},i){this.options={...Ct,...n},this.options.useExtendedSearch,this._keyStore=new X4(this.options.keys),this.setCollection(a,i)}setCollection(a,n){if(this._docs=a,n&&!(n instanceof _x))throw new Error(Q4);this._myIndex=n||cw(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(a){Ha(a)&&(this._docs.push(a),this._myIndex.add(a))}remove(a=()=>!1){const n=[];for(let i=0,l=this._docs.length;i<l;i+=1){const c=this._docs[i];a(c,i)&&(this.removeAt(i),i-=1,l-=1,n.push(c))}return n}removeAt(a){this._docs.splice(a,1),this._myIndex.removeAt(a)}getIndex(){return this._myIndex}search(a,{limit:n=-1}={}){const{includeMatches:i,includeScore:l,shouldSort:c,sortFn:o,ignoreFieldNorm:d}=this.options;let h=Ws(a)?Ws(this._docs[0])?this._searchStringList(a):this._searchObjectList(a):this._searchLogical(a);return S3(h,{ignoreFieldNorm:d}),c&&h.sort(o),iw(n)&&n>-1&&(h=h.slice(0,n)),_3(h,this._docs,{includeMatches:i,includeScore:l})}_searchStringList(a){const n=Pg(a,this.options),{records:i}=this._myIndex,l=[];return i.forEach(({v:c,i:o,n:d})=>{if(!Ha(c))return;const{isMatch:h,score:m,indices:f}=n.searchIn(c);h&&l.push({item:c,idx:o,matches:[{score:m,value:c,norm:d,indices:f}]})}),l}_searchLogical(a){const n=mw(a,this.options),i=(d,h,m)=>{if(!d.children){const{keyId:g,searcher:y}=d,b=this._findMatches({key:this._keyStore.get(g),value:this._myIndex.getValueForItemAtKeyId(h,g),searcher:y});return b&&b.length?[{idx:m,item:h,matches:b}]:[]}const f=[];for(let g=0,y=d.children.length;g<y;g+=1){const b=d.children[g],v=i(b,h,m);if(v.length)f.push(...v);else if(d.operator===Vh.AND)return[]}return f},l=this._myIndex.records,c={},o=[];return l.forEach(({$:d,i:h})=>{if(Ha(d)){let m=i(n,d,h);m.length&&(c[h]||(c[h]={idx:h,item:d,matches:[]},o.push(c[h])),m.forEach(({matches:f})=>{c[h].matches.push(...f)}))}}),o}_searchObjectList(a){const n=Pg(a,this.options),{keys:i,records:l}=this._myIndex,c=[];return l.forEach(({$:o,i:d})=>{if(!Ha(o))return;let h=[];i.forEach((m,f)=>{h.push(...this._findMatches({key:m,value:o[f],searcher:n}))}),h.length&&c.push({idx:d,item:o,matches:h})}),c}_findMatches({key:a,value:n,searcher:i}){if(!Ha(n))return[];let l=[];if(_i(n))n.forEach(({v:c,i:o,n:d})=>{if(!Ha(c))return;const{isMatch:h,score:m,indices:f}=i.searchIn(c);h&&l.push({score:m,key:a,value:c,idx:o,norm:d,indices:f})});else{const{v:c,n:o}=n,{isMatch:d,score:h,indices:m}=i.searchIn(c);d&&l.push({score:h,key:a,value:c,norm:o,indices:m})}return l}}Da.version="7.1.0";Da.createIndex=cw;Da.parseIndex=r3;Da.config=Ct;Da.parseQuery=mw;v3(j3);var D3=LC();const $u=Pu(D3),U=({className:t="",width:a,height:n,variant:i="rectangular",animate:l=!0,style:c={}})=>{const o={width:a,height:n,...c};return e.jsx("div",{className:`skeleton skeleton-${i} ${l?"skeleton-animate":""} ${t}`,style:o})};var E3=oC();const Sr=Pu(E3),bo=new Map,pw=(()=>{const t=new Promise(a=>{window.addEventListener("pointerdown",a,{once:!0}),window.addEventListener("keydown",a,{once:!0})});return async a=>{try{const n=new Audio;if(n.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA",await n.play(),a!=null&&a.id&&bo.has(a.id)){const l=bo.get(a.id);if(l)return l}const i=new AudioContext(a);return a!=null&&a.id&&bo.set(a.id,i),i}catch{if(await t,a!=null&&a.id&&bo.has(a.id)){const l=bo.get(a.id);if(l)return l}const i=new AudioContext(a);return a!=null&&a.id&&bo.set(a.id,i),i}}})();function T3(t){var a=atob(t),n=new Uint8Array(a.length);for(let i=0;i<a.length;i++)n[i]=a.charCodeAt(i);return n.buffer}const A3=`
class AudioProcessingWorklet extends AudioWorkletProcessor {

  // send and clear buffer every 2048 samples, 
  // which at 16khz is about 8 times a second
  buffer = new Int16Array(2048);

  // current write index
  bufferWriteIndex = 0;

  constructor() {
    super();
    this.hasAudio = false;
  }

  /**
   * @param inputs Float32Array[][] [input#][channel#][sample#] so to access first inputs 1st channel inputs[0][0]
   * @param outputs Float32Array[][]
   */
  process(inputs) {
    if (inputs[0].length) {
      const channel0 = inputs[0][0];
      this.processChunk(channel0);
    }
    return true;
  }

  sendAndClearBuffer(){
    this.port.postMessage({
      event: "chunk",
      data: {
        int16arrayBuffer: this.buffer.slice(0, this.bufferWriteIndex).buffer,
      },
    });
    this.bufferWriteIndex = 0;
  }

  processChunk(float32Array) {
    const l = float32Array.length;
    
    for (let i = 0; i < l; i++) {
      // convert float32 -1 to 1 to int16 -32768 to 32767
      const int16Value = float32Array[i] * 32768;
      this.buffer[this.bufferWriteIndex++] = int16Value;
      if(this.bufferWriteIndex >= this.buffer.length) {
        this.sendAndClearBuffer();
      }
    }

    if(this.bufferWriteIndex >= this.buffer.length) {
      this.sendAndClearBuffer();
    }
  }
}
`,fw=`
  class VolMeter extends AudioWorkletProcessor {
    volume
    updateIntervalInMS
    nextUpdateFrame

    constructor() {
      super()
      this.volume = 0
      this.updateIntervalInMS = 25
      this.nextUpdateFrame = this.updateIntervalInMS
      this.port.onmessage = event => {
        if (event.data.updateIntervalInMS) {
          this.updateIntervalInMS = event.data.updateIntervalInMS
        }
      }
    }

    get intervalInFrames() {
      return (this.updateIntervalInMS / 1000) * sampleRate
    }

    process(inputs) {
      const input = inputs[0]

      if (input.length > 0) {
        const samples = input[0]
        let sum = 0
        let rms = 0

        for (let i = 0; i < samples.length; ++i) {
          sum += samples[i] * samples[i]
        }

        rms = Math.sqrt(sum / samples.length)
        this.volume = Math.max(rms, this.volume * 0.7)

        this.nextUpdateFrame -= samples.length
        if (this.nextUpdateFrame < 0) {
          this.nextUpdateFrame += this.intervalInFrames
          this.port.postMessage({volume: this.volume})
        }
      }

      return true
    }
  }`,fh=new Map,Ig=(t,a)=>{const n=new Blob([`registerProcessor("${t}", ${a})`],{type:"application/javascript"});return URL.createObjectURL(n)};function P3(t){for(var a="",n=new Uint8Array(t),i=n.byteLength,l=0;l<i;l++)a+=String.fromCharCode(n[l]);return window.btoa(a)}class gw extends I1{constructor(n=16e3){super();ln(this,"stream");ln(this,"audioContext");ln(this,"source");ln(this,"recording",!1);ln(this,"recordingWorklet");ln(this,"vuWorklet");ln(this,"starting",null);this.sampleRate=n}async start(){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Could not request user media");this.starting=new Promise(async n=>{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioContext=await pw({sampleRate:this.sampleRate}),this.source=this.audioContext.createMediaStreamSource(this.stream);const i="audio-recorder-worklet",l=Ig(i,A3);await this.audioContext.audioWorklet.addModule(l),this.recordingWorklet=new AudioWorkletNode(this.audioContext,i),this.recordingWorklet.port.onmessage=async o=>{const d=o.data.data.int16arrayBuffer;if(d){const h=P3(d);this.emit("data",h)}},this.source.connect(this.recordingWorklet);const c="vu-meter";await this.audioContext.audioWorklet.addModule(Ig(c,fw)),this.vuWorklet=new AudioWorkletNode(this.audioContext,c),this.vuWorklet.port.onmessage=o=>{this.emit("volume",o.data.volume)},this.source.connect(this.vuWorklet),this.recording=!0,n(),this.starting=null})}stop(){const n=()=>{var i,l;(i=this.source)==null||i.disconnect(),(l=this.stream)==null||l.getTracks().forEach(c=>c.stop()),this.stream=void 0,this.recordingWorklet=void 0,this.vuWorklet=void 0,this.audioContext&&(this.audioContext.close(),this.audioContext=void 0)};if(this.starting){this.starting.then(n);return}n()}}const R3=3,O3=({active:t,volume:a,hover:n})=>{const i=x.useRef([]);return x.useEffect(()=>{let l=null;const c=()=>{i.current.forEach((o,d)=>{o&&(o.style.height=`${Math.min(24,4+a*(d===1?400:60))}px`)}),l=window.setTimeout(c,100)};return c(),()=>clearTimeout(l)},[a]),e.jsx("div",{className:Sr("audioPulse",{active:t,hover:n}),children:Array(R3).fill(null).map((l,c)=>e.jsx("div",{ref:o=>{i.current[c]=o},style:{animationDelay:`${c*133}ms`}},c))})};var xw=$C();class I3{constructor(a){ln(this,"sampleRate",24e3);ln(this,"bufferSize",7680);ln(this,"audioQueue",[]);ln(this,"isPlaying",!1);ln(this,"isStreamComplete",!1);ln(this,"checkInterval",null);ln(this,"scheduledTime",0);ln(this,"initialBufferTime",.1);ln(this,"gainNode");ln(this,"source");ln(this,"endOfQueueAudioSource",null);ln(this,"onComplete",()=>{});this.context=a,this.gainNode=this.context.createGain(),this.source=this.context.createBufferSource(),this.gainNode.connect(this.context.destination),this.addPCM16=this.addPCM16.bind(this)}async addWorklet(a,n,i){let l=fh.get(this.context);if(l&&l[a])return l[a].handlers.push(i),Promise.resolve(this);l||(fh.set(this.context,{}),l=fh.get(this.context)),l[a]={handlers:[i]};const c=Ig(a,n);await this.context.audioWorklet.addModule(c);const o=new AudioWorkletNode(this.context,a);return l[a].node=o,this}_processPCM16Chunk(a){const n=new Float32Array(a.length/2),i=new DataView(a.buffer);for(let l=0;l<a.length/2;l++)try{const c=i.getInt16(l*2,!0);n[l]=c/32768}catch(c){console.error(c)}return n}addPCM16(a){this.isStreamComplete=!1;let n=this._processPCM16Chunk(a);for(;n.length>=this.bufferSize;){const i=n.slice(0,this.bufferSize);this.audioQueue.push(i),n=n.slice(this.bufferSize)}n.length>0&&this.audioQueue.push(n),this.isPlaying||(this.isPlaying=!0,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.scheduleNextBuffer())}createAudioBuffer(a){const n=this.context.createBuffer(1,a.length,this.sampleRate);return n.getChannelData(0).set(a),n}scheduleNextBuffer(){for(;this.audioQueue.length>0&&this.scheduledTime<this.context.currentTime+.2;){const n=this.audioQueue.shift(),i=this.createAudioBuffer(n),l=this.context.createBufferSource();this.audioQueue.length===0&&(this.endOfQueueAudioSource&&(this.endOfQueueAudioSource.onended=null),this.endOfQueueAudioSource=l,l.onended=()=>{!this.audioQueue.length&&this.endOfQueueAudioSource===l&&(this.endOfQueueAudioSource=null,this.onComplete())}),l.buffer=i,l.connect(this.gainNode);const c=fh.get(this.context);c&&Object.entries(c).forEach(([,d])=>{const{node:h,handlers:m}=d;h&&(l.connect(h),h.port.onmessage=function(f){m.forEach(g=>{g.call(h.port,f)})},h.connect(this.context.destination))});const o=Math.max(this.scheduledTime,this.context.currentTime);l.start(o),this.scheduledTime=o+i.duration}if(this.audioQueue.length===0)this.isStreamComplete?(this.isPlaying=!1,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)):this.checkInterval||(this.checkInterval=window.setInterval(()=>{this.audioQueue.length>0&&this.scheduleNextBuffer()},100));else{const n=(this.scheduledTime-this.context.currentTime)*1e3;setTimeout(()=>this.scheduleNextBuffer(),Math.max(0,n-50))}}stop(){this.isPlaying=!1,this.isStreamComplete=!0,this.audioQueue=[],this.scheduledTime=this.context.currentTime,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.gainNode.gain.linearRampToValueAtTime(0,this.context.currentTime+.1),setTimeout(()=>{this.gainNode.disconnect(),this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination)},200)}async resume(){this.context.state==="suspended"&&await this.context.resume(),this.isStreamComplete=!1,this.scheduledTime=this.context.currentTime+this.initialBufferTime,this.gainNode.gain.setValueAtTime(1,this.context.currentTime)}complete(){this.isStreamComplete=!0,this.onComplete()}}function z3(){const[t,a]=x.useState(null),[n,i]=x.useState(!1);return x.useEffect(()=>{const d=()=>{i(!1),a(null)};if(t)return t.getTracks().forEach(h=>h.addEventListener("ended",d)),()=>{t.getTracks().forEach(h=>h.removeEventListener("ended",d))}},[t]),{type:"screen",start:async()=>{const d=await navigator.mediaDevices.getDisplayMedia({video:!0});return a(d),i(!0),d},stop:()=>{t&&(t.getTracks().forEach(d=>d.stop()),a(null),i(!1))},isStreaming:n,stream:t}}function F3(){const[t,a]=x.useState(null),[n,i]=x.useState(!1);return x.useEffect(()=>{const d=()=>{i(!1),a(null)};if(t)return t.getTracks().forEach(h=>h.addEventListener("ended",d)),()=>{t.getTracks().forEach(h=>h.removeEventListener("ended",d))}},[t]),{type:"webcam",start:async()=>{const d=await navigator.mediaDevices.getUserMedia({video:!0});return a(d),i(!0),d},stop:()=>{t&&(t.getTracks().forEach(d=>d.stop()),a(null),i(!1))},isStreaming:n,stream:t}}class L3 extends I1{constructor(n){super();ln(this,"client");ln(this,"_status","disconnected");ln(this,"_session",null);ln(this,"_model",null);ln(this,"config",null);this.client=new ex(n),this.send=this.send.bind(this),this.onopen=this.onopen.bind(this),this.onerror=this.onerror.bind(this),this.onclose=this.onclose.bind(this),this.onmessage=this.onmessage.bind(this)}get status(){return this._status}get session(){return this._session}get model(){return this._model}getConfig(){return{...this.config}}log(n,i){const l={date:new Date,type:n,message:i};this.emit("log",l)}async connect(n,i){if(this._status==="connected"||this._status==="connecting")return!1;this._status="connecting",this.config=i,this._model=n;const l={onopen:this.onopen,onmessage:this.onmessage,onerror:this.onerror,onclose:this.onclose};try{this._session=await this.client.live.connect({model:n,config:i,callbacks:l})}catch(c){return console.error("Error connecting to GenAI Live:",c),this._status="disconnected",!1}return this._status="connected",!0}disconnect(){var n;return this.session?((n=this.session)==null||n.close(),this._session=null,this._status="disconnected",this.log("client.close","Disconnected"),!0):!1}onopen(){this.log("client.open","Connected"),this.emit("open")}onerror(n){this.log("server.error",n.message),this.emit("error",n)}onclose(n){this.log("server.close",`disconnected ${n.reason?`with reason: ${n.reason}`:""}`),this.emit("close",n)}async onmessage(n){var i;if(n.setupComplete){this.log("server.send","setupComplete"),this.emit("setupcomplete");return}if(n.toolCall){this.log("server.toolCall",n),this.emit("toolcall",n.toolCall);return}if(n.toolCallCancellation){this.log("server.toolCallCancellation",n),this.emit("toolcallcancellation",n.toolCallCancellation);return}if(n.serverContent){const{serverContent:l}=n;if("interrupted"in l){this.log("server.content","interrupted"),this.emit("interrupted");return}if("turnComplete"in l&&(this.log("server.content","turnComplete"),this.emit("turncomplete")),"modelTurn"in l){let c=((i=l.modelTurn)==null?void 0:i.parts)||[];const o=c.filter(f=>{var g;return f.inlineData&&((g=f.inlineData.mimeType)==null?void 0:g.startsWith("audio/pcm"))}),d=o.map(f=>{var g;return(g=f.inlineData)==null?void 0:g.data}),h=xw.difference(c,o);if(d.forEach(f=>{if(f){const g=T3(f);this.emit("audio",g),this.log("server.audio",`buffer (${g.byteLength})`)}}),!h.length)return;c=h;const m={modelTurn:{parts:c}};this.emit("content",m),this.log("server.content",n)}}else console.log("received unmatched message",n)}sendRealtimeInput(n){var o;let i=!1,l=!1;for(const d of n)if((o=this.session)==null||o.sendRealtimeInput({media:d}),d.mimeType.includes("audio")&&(i=!0),d.mimeType.includes("image")&&(l=!0),i&&l)break;const c=i&&l?"audio + video":i?"audio":l?"video":"unknown";this.log("client.realtimeInput",c)}sendToolResponse(n){var i;n.functionResponses&&n.functionResponses.length&&((i=this.session)==null||i.sendToolResponse({functionResponses:n.functionResponses}),this.log("client.toolResponse",n))}send(n,i=!0){var l;(l=this.session)==null||l.sendClientContent({turns:n,turnComplete:i}),this.log("client.send",{turns:Array.isArray(n)?n:[n],turnComplete:i})}}function $3(t){const a=x.useMemo(()=>new L3(t),[t]),n=x.useRef(null),[i,l]=x.useState("models/gemini-2.5-flash-live-preview"),[c,o]=x.useState({}),[d,h]=x.useState(!1),[m,f]=x.useState(0),[g,y]=x.useState(null);x.useEffect(()=>{n.current||pw({id:"audio-out"}).then(w=>{n.current=new I3(w),n.current.addWorklet("vumeter-out",fw,S=>{f(S.data.volume)}).then(()=>{})})},[n]),x.useEffect(()=>{const w=()=>{h(!0)},S=()=>{h(!1)},_=M=>{console.error("error",M)},E=()=>{var M;return(M=n.current)==null?void 0:M.stop()},D=M=>{var A;return(A=n.current)==null?void 0:A.addPCM16(new Uint8Array(M))},O=M=>{if(console.log("Received content event:",M),M.modelTurn&&M.modelTurn.parts){const A=M.modelTurn.parts.filter(P=>"text"in P&&P.text);if(A.length>0){const P=A.map(Q=>Q.text).join(" ");y(P),console.log("AI Summary received:",P)}}};return a.on("error",_).on("open",w).on("close",S).on("interrupted",E).on("audio",D).on("content",O),()=>{a.off("error",_).off("open",w).off("close",S).off("interrupted",E).off("audio",D).off("content",O).disconnect()}},[a]);const b=x.useCallback(async()=>{if(!c)throw new Error("config has not been set");a.disconnect(),await a.connect(i,c)},[a,c,i]),v=x.useCallback(async()=>{a.disconnect(),h(!1)},[h,a]);return{client:a,config:c,setConfig:o,model:i,setModel:l,connected:d,connect:b,disconnect:v,volume:m,aiSummary:g}}const yw=x.createContext(void 0),um=({options:t,children:a})=>{const n=$3(t);return e.jsx(yw.Provider,{value:n,children:a})},Tr=()=>{const t=x.useContext(yw);if(!t)throw new Error("useLiveAPIContext must be used wihin a LiveAPIProvider");return t};function M3(){const{config:t,setConfig:a}=Tr(),[n,i]=x.useState({value:"audio",label:"audio"}),l=x.useCallback(c=>{a({...t,responseModalities:[c==="audio"?Ah.AUDIO:Ah.TEXT]})},[t,a]);return e.jsxs("div",{className:"select-group",children:[e.jsx("label",{htmlFor:"response-modality-selector",children:"Response modality"}),e.jsx(w1,{id:"response-modality-selector",className:"react-select",classNamePrefix:"react-select",styles:{},defaultValue:n,options:[{value:"audio",label:"audio"},{value:"text",label:"text"}],onChange:c=>{i(c),c&&(c.value==="audio"||c.value==="text")&&l(c.value)}})]})}const n0=[{value:"Puck",label:"Puck"},{value:"Charon",label:"Charon"},{value:"Kore",label:"Kore"},{value:"Fenrir",label:"Fenrir"},{value:"Aoede",label:"Aoede"}];function B3(){const{config:t,setConfig:a}=Tr();x.useEffect(()=>{var d,h,m;const c=((m=(h=(d=t.speechConfig)==null?void 0:d.voiceConfig)==null?void 0:h.prebuiltVoiceConfig)==null?void 0:m.voiceName)||"Atari02";i({value:c,label:c})},[t]);const[n,i]=x.useState(n0[5]),l=x.useCallback(c=>{a({...t,speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:c}}}})},[t,a]);return e.jsxs("div",{className:"select-group",children:[e.jsx("label",{htmlFor:"voice-selector",children:"Voice"}),e.jsx(w1,{id:"voice-selector",className:"react-select",classNamePrefix:"react-select",styles:{},value:n,defaultValue:n,options:n0,onChange:c=>{i(c),c&&l(c.value)}})]})}function U3(){const[t,a]=x.useState(!1),{config:n,setConfig:i,connected:l}=Tr(),c=x.useMemo(()=>Array.isArray(n.tools)?n.tools.filter(m=>Array.isArray(m.functionDeclarations)).map(m=>m.functionDeclarations).filter(m=>!!m).flat():[],[n]),o=x.useMemo(()=>{var m;return n.systemInstruction?typeof n.systemInstruction=="string"?n.systemInstruction:Array.isArray(n.systemInstruction)?n.systemInstruction.map(f=>typeof f=="string"?f:f.text).join(`
`):typeof n.systemInstruction=="object"&&"parts"in n.systemInstruction&&((m=n.systemInstruction.parts)==null?void 0:m.map(f=>f.text).join(`
`))||"":""},[n]),d=x.useCallback(m=>{const f={...n,systemInstruction:m.target.value};i(f)},[n,i]),h=x.useCallback((m,f)=>{var y;const g={...n,tools:((y=n.tools)==null?void 0:y.map(b=>{const v=b;return Array.isArray(v.functionDeclarations)?{...b,functionDeclarations:v.functionDeclarations.map(w=>w.name===m?{...w,description:f}:w)}:b}))||[]};i(g)},[n,i]);return e.jsxs("div",{className:"settings-dialog",children:[e.jsx("button",{className:"action-button material-symbols-outlined",onClick:()=>a(!t),children:"settings"}),e.jsx("dialog",{className:"dialog",style:{display:t?"block":"none"},children:e.jsxs("div",{className:`dialog-container ${l?"disabled":""}`,children:[l&&e.jsx("div",{className:"connected-indicator",children:e.jsx("p",{children:"These settings can only be applied before connecting and will override other settings."})}),e.jsxs("div",{className:"mode-selectors",children:[e.jsx(M3,{}),e.jsx(B3,{})]}),e.jsx("h3",{children:"System Instructions"}),e.jsx("textarea",{className:"system",onChange:d,value:o}),e.jsx("h4",{children:"Function declarations"}),e.jsx("div",{className:"function-declarations",children:e.jsx("div",{className:"fd-rows",children:c.map((m,f)=>{var g;return e.jsxs("div",{className:"fd-row",children:[e.jsx("span",{className:"fd-row-name",children:m.name}),e.jsx("span",{className:"fd-row-args",children:Object.keys(((g=m.parameters)==null?void 0:g.properties)||{}).map((y,b)=>e.jsx("span",{children:y},b))}),e.jsx("input",{className:"fd-row-description",type:"text",defaultValue:m.description,onBlur:y=>h(m.name,y.target.value)},`fd-${m.description}`)]},`function-${f}`)})})})]})})]})}const a0=x.memo(({isStreaming:t,onIcon:a,offIcon:n,start:i,stop:l})=>t?e.jsx("button",{className:"action-button",onClick:l,children:e.jsx("span",{className:"material-symbols-outlined",children:a})}):e.jsx("button",{className:"action-button",onClick:i,children:e.jsx("span",{className:"material-symbols-outlined",children:n})}));function q3({videoRef:t,children:a,onVideoStreamChange:n=()=>{},supportsVideo:i,enableEditingSettings:l}){const c=[F3(),z3()],[o,d]=x.useState(null),[h,m]=c,[f,g]=x.useState(0),[y]=x.useState(()=>new gw),[b,v]=x.useState(!1),w=x.useRef(null),S=x.useRef(null),{client:_,connected:E,connect:D,disconnect:O,volume:M}=Tr();x.useEffect(()=>{!E&&S.current&&S.current.focus()},[E]),x.useEffect(()=>{document.documentElement.style.setProperty("--volume",`${Math.max(5,Math.min(f*200,8))}px`)},[f]),x.useEffect(()=>{const P=Q=>{_.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:Q}])};return E&&!b&&y?y.on("data",P).on("volume",g).start():y.stop(),()=>{y.off("data",P).off("volume",g)}},[E,_,b,y]),x.useEffect(()=>{t.current&&(t.current.srcObject=o);let P=-1;function Q(){const G=t.current,C=w.current;if(!G||!C)return;const R=C.getContext("2d");if(C.width=G.videoWidth*.25,C.height=G.videoHeight*.25,C.width+C.height>0){R.drawImage(G,0,0,C.width,C.height);const z=C.toDataURL("image/jpeg",1),F=z.slice(z.indexOf(",")+1,1/0);_.sendRealtimeInput([{mimeType:"image/jpeg",data:F}])}E&&(P=window.setTimeout(Q,1e3/.5))}return E&&o!==null&&requestAnimationFrame(Q),()=>{clearTimeout(P)}},[E,o,_,t]);const A=P=>async()=>{if(P){const Q=await P.start();d(Q),n(Q)}else d(null),n(null);c.filter(Q=>Q!==P).forEach(Q=>Q.stop())};return e.jsxs("section",{className:"control-tray",children:[e.jsx("canvas",{style:{display:"none"},ref:w}),e.jsxs("nav",{className:Sr("actions-nav",{disabled:!E}),children:[e.jsx("button",{className:Sr("action-button mic-button",{recording:!b&&E}),onClick:()=>v(!b),children:b?e.jsx("span",{className:"material-symbols-outlined filled",children:"mic_off"}):e.jsx("span",{className:"material-symbols-outlined filled",children:"mic"})}),e.jsx("div",{className:"action-button no-action outlined",children:e.jsx(O3,{volume:M,active:E,hover:!1})}),i&&e.jsxs(e.Fragment,{children:[e.jsx(a0,{isStreaming:m.isStreaming,start:A(m),stop:A(),onIcon:"cancel_presentation",offIcon:"present_to_all"}),e.jsx(a0,{isStreaming:h.isStreaming,start:A(h),stop:A(),onIcon:"videocam_off",offIcon:"videocam"})]}),a]}),e.jsxs("div",{className:Sr("connection-container",{connected:E}),children:[e.jsx("div",{className:"connection-button-container",children:e.jsx("button",{ref:S,className:Sr("action-button connect-toggle",{connected:E}),onClick:E?O:D,children:e.jsx("span",{className:"material-symbols-outlined filled",children:E?"pause":"play_arrow"})})}),e.jsx("span",{className:"text-indicator",children:"Streaming"})]}),l?e.jsx(U3,{}):""]})}const s0={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:Th.OBJECT,properties:{summary:{type:Th.STRING,description:"The summary of the patient's case."}},required:["summary"]}},H3=({patientData:t,tokenNumber:a})=>{const[n,i]=x.useState(""),{client:l,setConfig:c,setModel:o}=Tr();return x.useEffect(()=>{o("models/gemini-2.5-flash-live-preview"),c({responseModalities:[Ah.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},systemInstruction:{parts:[{text:`Your job is to:

If patient details like name, age, sex, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details (e.g., phone number) are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's name, age, sex, and phone number.

When pronouncing a phone number, always state each digit individually (e.g., "six three" instead of "sixty-three" or "six billion three").

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception. You should always speak in Telugu.dont write the telugu words in english`}]},tools:[{functionDeclarations:[s0]}]})},[c,o]),x.useEffect(()=>{const d=h=>{if(!h.functionCalls)return;const m=h.functionCalls.find(f=>f.name===s0.name);if(m){const f=m.args.summary;i(f)}h.functionCalls.length&&setTimeout(()=>{var f;return l.sendToolResponse({functionResponses:(f=h.functionCalls)==null?void 0:f.map(g=>({response:{output:{success:!0}},id:g.id,name:g.name}))})},200)};return l.on("toolcall",d),()=>{l.off("toolcall",d)}},[l]),x.useEffect(()=>{if(n){const d=encodeURIComponent(n);a?window.location.href=`https://hms.newtons.in/handle-complaint-url?token=${a}&caseDetails=${d}`:window.location.href=`https://hms.newtons.in/dashboard/search-patient?caseDetails=${d}`}},[n,a]),e.jsxs("div",{className:"hospital-reception",children:[e.jsx("h1",{children:"Newtons Ai"}),e.jsx("p",{children:"Newtons Ai"}),a&&e.jsxs("h2",{children:["Token Number: ",a]}),t&&e.jsxs("div",{children:[e.jsx("h2",{children:"Patient Details"}),e.jsx("pre",{children:JSON.stringify(t,null,2)})]}),n&&e.jsxs("div",{children:[e.jsx("h2",{children:"Case Summary (from Tool Call)"}),e.jsx("p",{children:n})]})]})},i0="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes";async function V3(){const t=ox();if(!t)return console.warn("No auth token found, using default Live API key."),i0;try{const n=(await MC.get("/api/clinics/gemini-api-key",{headers:{Authorization:`Bearer ${t}`}})).data.geminiApiKey;if(n)return n}catch(a){console.error("Failed to fetch clinic-specific Live API key:",a)}return console.warn("Clinic-specific Live API key not found or failed to fetch, using default."),i0}function G3(){const t=x.useRef(null),[a,n]=x.useState(null),[i,l]=x.useState(null);return x.useEffect(()=>{(async()=>{try{const o=await V3();l({apiKey:o})}catch(o){console.error("Error setting Live API options:",o)}})()},[]),i?e.jsx("div",{className:"App",children:e.jsx(um,{options:i,children:e.jsx(Q3,{videoRef:t,setVideoStream:n,videoStream:a})})}):e.jsx("div",{children:"Loading Live API settings..."})}const Q3=({videoRef:t,setVideoStream:a,videoStream:n})=>{const[i,l]=x.useState(null),[c,o]=x.useState(null),{connected:d,client:h,connect:m,config:f,model:g}=Tr(),[y,b]=x.useState(""),v=x.useRef(null),[w,S]=x.useState(!1);x.useEffect(()=>{const E=window.matchMedia("(prefers-color-scheme: dark)"),D=O=>{document.documentElement.setAttribute("data-theme",O.matches?"dark":"light")};return D(E),E.addEventListener("change",D),()=>E.removeEventListener("change",D)},[]),x.useEffect(()=>{const E=new URLSearchParams(window.location.search),D={};for(const[O,M]of E.entries())O==="token_number"?o(M):D[O]=M;l(D)},[]),x.useEffect(()=>{Object.keys(f).length>0&&g&&m()},[m,f,g]),x.useEffect(()=>{if(d&&i&&!w){const E=JSON.stringify(i,null,2);h.send([{text:E}]),b(""),S(!0)}},[d,i,h,w]),x.useEffect(()=>{i&&b(JSON.stringify(i,null,2))},[i]);const _=()=>{h.send([{text:y}]),b(""),v.current&&(v.current.innerText="")};return e.jsx("div",{className:"streaming-console",children:e.jsxs("main",{children:[e.jsxs("div",{className:"main-app-area",children:[e.jsx(H3,{patientData:i,tokenNumber:c}),e.jsx("video",{className:Sr("stream",{hidden:!t.current||!n}),ref:t,autoPlay:!0,playsInline:!0})]}),e.jsx("div",{className:Sr("input-container",{disabled:!d}),children:e.jsxs("div",{className:"input-content",children:[e.jsx("textarea",{className:"input-area",ref:v,onKeyDown:E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),E.stopPropagation(),_())},onChange:E=>b(E.target.value),value:y}),e.jsx("span",{className:Sr("input-content-placeholder",{hidden:y.length}),children:"Typesomething..."}),e.jsx("button",{className:"send-button material-symbols-outlined filled",onClick:_,children:"send"})]})}),e.jsx(q3,{videoRef:t,supportsVideo:!0,onVideoStreamChange:a,enableEditingSettings:!0})]})})},r0="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",Y3=({volume:t,active:a})=>{const n=Array.from({length:5},(i,l)=>e.jsx("div",{className:`audio-bar ${a?"active":""}`,style:{height:a?`${Math.min(24,20+t*40*(1+Math.sin(l)*.3))}px`:"8px",animationDelay:`${l*.1}s`}},l));return e.jsx("div",{className:"audio-pulse",children:n})},J3=x.forwardRef(({videoRef:t,supportsVideo:a,onVideoStreamChange:n,textInput:i,onSubmitTextInput:l},c)=>{var A;const{connected:o,connect:d,disconnect:h,client:m,volume:f}=Tr(),[g,y]=x.useState(!1),[b,v]=x.useState(!1),[w,S]=x.useState(!1),[_]=x.useState(()=>new gw),E=async()=>{o?await h():(await d(),i.trim()&&l())};x.useEffect(()=>{const P=Q=>{m.sendRealtimeInput([{mimeType:"audio/pcm;rate=16000",data:Q}])};return o&&!g?_.on("data",P).start():_.stop(),()=>{_.off("data",P),_.stop()}},[o,m,g,_]);const D=x.useCallback(async()=>{if(b)M==null||M.getTracks().forEach(P=>P.stop()),n(null),v(!1);else try{const P=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});t.current&&(t.current.srcObject=P),n(P),v(!0)}catch(P){console.error("Error accessing webcam:",P),v(!1)}},[b,n,t]),O=x.useCallback(async()=>{if(w)M==null||M.getTracks().forEach(P=>P.stop()),n(null),S(!1);else try{const P=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});t.current&&(t.current.srcObject=P),n(P),S(!0)}catch(P){console.error("Error accessing screen share:",P),S(!1)}},[w,n,t]),M=(A=t.current)==null?void 0:A.srcObject;return x.useEffect(()=>()=>{M&&M.getTracks().forEach(P=>P.stop())},[M]),x.useImperativeHandle(c,()=>({handleConnect:E})),e.jsx("div",{className:"live-api-control-tray",children:e.jsxs("div",{className:"live-api-control-tray-inner",children:[e.jsxs("div",{className:"live-api-control-group",children:[e.jsx("button",{onClick:()=>y(!g),disabled:!o,className:`live-api-control-button ${o&&!g?"mic-active":"mic-inactive"}`,"aria-label":g?"Unmute microphone":"Mute microphone",children:g?e.jsx(cC,{className:"w-5 h-5"}):e.jsx(Ru,{className:"w-5 h-5"})}),e.jsx("div",{className:"live-api-audio-pulse-container",children:e.jsx(Y3,{volume:f,active:o})}),a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:O,disabled:!o,className:`live-api-control-button ${w?"video-active":"video-inactive"}`,"aria-label":w?"Stop screen share":"Start screen share",children:e.jsx(uC,{className:"w-5 h-5"})}),e.jsx("button",{onClick:D,disabled:!o,className:`live-api-control-button ${b?"video-active":"video-inactive"}`,"aria-label":b?"Turn off webcam":"Turn on webcam",children:e.jsx(dC,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"live-api-control-group",children:[e.jsxs("div",{className:"live-api-status-indicator",children:[e.jsx("div",{className:`live-api-status-dot ${o?"connected":"disconnected"}`}),e.jsx("span",{className:"live-api-status-text",children:o?"Streaming":"Disconnected"})]}),e.jsx("button",{onClick:E,className:`live-api-connect-button ${o?"connected":"disconnected"}`,children:o?e.jsxs(e.Fragment,{children:[e.jsx(hC,{className:"w-5 h-5"}),e.jsx("span",{children:"Pause"})]}):e.jsxs(e.Fragment,{children:[e.jsx(mC,{className:"w-5 h-5"}),e.jsx("span",{children:"Start"})]})})]})]})})}),K3=({tokenNumber:t,aiSummary:a,clinicName:n})=>e.jsxs("div",{className:"hospital-reception-container",children:[e.jsxs("div",{className:"hospital-reception-logo-section",children:[e.jsx("div",{className:"hospital-reception-logo",children:e.jsx("span",{children:n.charAt(0)})}),e.jsxs("h1",{className:"hospital-reception-title",children:[n," AI"]}),e.jsxs("p",{className:"hospital-reception-subtitle",children:["Intelligent ",n," Reception Assistant"]})]}),t&&e.jsxs("div",{className:"hospital-reception-token-card",children:[e.jsx("h2",{className:"hospital-reception-token-title",children:"Token Number"}),e.jsx("p",{className:"hospital-reception-token-number",children:t})]}),a&&e.jsxs("div",{className:"hospital-reception-summary-card",children:[e.jsx("h3",{className:"hospital-reception-summary-title",children:"Case Summary"}),e.jsx("p",{className:"hospital-reception-summary-text",children:a})]})]}),l0={name:"case_summary",description:"Writes a summary of the patient's case in English.",parameters:{type:Th.OBJECT,properties:{summary:{type:Th.STRING,description:"The summary of the patient's case."}},required:["summary"]}},W3=({onClose:t,patientData:a,tokenNumber:n,onAiSummaryChange:i,clinicName:l,voiceAiLanguage:c})=>{const o=x.useRef(null),d=x.useRef(null),[h,m]=x.useState(null),[f,g]=x.useState("hi"),{client:y,connected:b,setConfig:v,setModel:w,disconnect:S,connect:_}=Tr(),E=x.useMemo(()=>{let Q=`Your job is to:

If patient details like name, age, and case information are already provided, automatically understand that it's a repeat visit.

    If it's a repeat visit, warmly receive the patient by asking if their previous problems have resolved or how they are feeling now.

    If any required details (Name, Age) are missing even in a repeat visit, collect those missing details.

    If these details are not available (for a new visit), collect the patient's Name and Age only. Do not ask for their phone number.

    You should guess the patient's sex based on their voice or appearance.

For every visit, collect the patient's history by asking questions. Once you are confident about the history, you should use the 'case_summary' tool to write the summary of the case in English. After collecting all the information and summarizing the case, you should ask the patient to wait in the reception.`;a&&(Q+=`

Patient Data: ${JSON.stringify(a,null,2)}`);const C={"en-US":"English","hi-IN":"Hindi","te-IN":"Telugu","bn-IN":"Bengali","mr-IN":"Marathi","ta-IN":"Tamil","gu-IN":"Gujarati","kn-IN":"Kannada","ml-IN":"Malayalam","pa-IN":"Punjabi","es-ES":"Spanish","fr-FR":"French","de-DE":"German","it-IT":"Italian","pt-PT":"Portuguese","ru-RU":"Russian","ja-JP":"Japanese","ko-KR":"Korean","zh-CN":"Chinese","ar-SA":"Arabic"}[c]||"English";return Q+=` You should always speak in ${C}.`,c==="te-IN"&&(Q+=" Dont write the telugu words in english."),{responseModalities:[Ah.AUDIO],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Aoede"}}},systemInstruction:{parts:[{text:Q}]},tools:[{functionDeclarations:[l0]}]}},[a,c]);x.useEffect(()=>{w("models/gemini-2.5-flash-native-audio-preview-12-2025"),v(E);const Q=setTimeout(()=>{d.current&&!b&&d.current.handleConnect()},2e3);return()=>clearTimeout(Q)},[v,w,E,b]),x.useEffect(()=>()=>{b&&S()},[b,S]);const[D,O]=x.useState(null);x.useEffect(()=>{const Q=G=>{if(!G.functionCalls)return;const C=G.functionCalls.find(R=>R.name===l0.name);if(C){const R=C.args.summary;O(R),i(R)}G.functionCalls.length&&setTimeout(()=>{var R;return y.sendToolResponse({functionResponses:(R=G.functionCalls)==null?void 0:R.map(z=>({response:{output:{success:!0}},id:z.id,name:z.name}))})},200)};return y.on("toolcall",Q),()=>{y.off("toolcall",Q)}},[y,i]);const M=()=>{f.trim()&&(y.send([{text:f}]),g(""))},A=Q=>{Q.key==="Enter"&&!Q.shiftKey&&(Q.preventDefault(),M())},P=async()=>{O(null),i(null),g("hi"),b?(S(),setTimeout(()=>{_()},500)):_()};return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsxs("div",{className:"live-api-modal-content",children:[e.jsxs("div",{className:"live-api-modal-header",children:[e.jsxs("div",{className:"live-api-modal-header-left",children:[e.jsx("div",{className:"live-api-modal-logo",children:e.jsx("span",{children:l.charAt(0)})}),e.jsxs("div",{children:[e.jsx("h1",{className:"live-api-modal-title",children:l}),e.jsxs("p",{className:"live-api-modal-subtitle",children:[l," Hospital Assistant"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:P,className:"live-api-modal-close-button",title:"Refresh Session","aria-label":"Refresh session",children:e.jsx(N1,{className:"w-6 h-6"})}),e.jsx("button",{onClick:t,className:"live-api-modal-close-button","aria-label":"Close modal",children:e.jsx(St,{className:"w-6 h-6"})})]})]}),e.jsx("div",{className:"live-api-modal-main-content",children:e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"live-api-reception-area",children:[e.jsx(K3,{patientData:a,tokenNumber:n,aiSummary:D,clinicName:l}),h&&e.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,className:"live-api-video-stream"})]}),e.jsx("div",{className:"live-api-input-area",children:e.jsxs("div",{className:"live-api-input-container",children:[e.jsx("textarea",{value:f,onChange:Q=>g(Q.target.value),onKeyDown:A,placeholder:"Type your message here...",disabled:!b,rows:1,className:"live-api-textarea"}),e.jsx("button",{onClick:M,disabled:!b||!f.trim(),className:"live-api-send-button","aria-label":"Send message",children:e.jsx(Wh,{className:"w-5 h-5"})})]})}),e.jsx(J3,{ref:d,videoRef:o,supportsVideo:!0,onVideoStreamChange:m,textInput:f,onSubmitTextInput:M})]})})]})})},dm=({onClose:t,patientData:a,tokenNumber:n,onAiSummaryChange:i})=>{const[l,c]=x.useState(null),[o,d]=x.useState("Newtons Ai"),[h,m]=x.useState("en-US"),[f,g]=x.useState(!0);if(x.useEffect(()=>{(async()=>{try{let v=null,w="Newtons Ai",S="en-US";try{const _=await Z("/api/clinics/settings");if(_.ok){const E=await _.json();E.name&&E.name!==""&&(w=E.name),E.gemini_api_key&&E.gemini_api_key.trim()!==""&&(v=E.gemini_api_key.trim()),E.voice_ai_language&&(S=E.voice_ai_language)}}catch(_){console.warn("Failed to fetch clinic settings",_)}if(d(w),m(S),v)c(v);else{try{const _=await Z("/api/global-settings/app_gemini_api_key");if(_.ok){const E=await _.json();if(E.value&&E.value.trim()!==""){c(E.value.trim());return}}}catch(_){console.warn("Failed to fetch global key fallback",_)}c(r0)}}catch(v){console.error("Unexpected error in getSettings:",v),c(r0)}finally{g(!1)}})()},[]),f)return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsxs("div",{className:"live-api-modal-content",children:[e.jsx("div",{className:"live-api-modal-header",style:{borderBottom:"none"},children:e.jsxs("div",{className:"live-api-modal-header-left",children:[e.jsx(U,{variant:"circular",width:40,height:40}),e.jsxs("div",{style:{marginLeft:"12px"},children:[e.jsx(U,{width:120,height:24}),e.jsx(U,{width:180,height:14,style:{marginTop:"4px"}})]})]})}),e.jsx("div",{className:"live-api-modal-main-content",children:e.jsxs("div",{className:"hospital-reception-container",children:[e.jsxs("div",{className:"hospital-reception-logo-section",children:[e.jsx(U,{variant:"circular",width:64,height:64,style:{margin:"0 auto"}}),e.jsx(U,{width:200,height:32,style:{margin:"16px auto 8px"}}),e.jsx(U,{width:250,height:16,style:{margin:"0 auto"}})]}),e.jsxs("div",{className:"hospital-reception-token-card",style:{background:"transparent",boxShadow:"none"},children:[e.jsx(U,{width:140,height:20,style:{margin:"0 auto 8px"}}),e.jsx(U,{width:100,height:48,style:{margin:"0 auto"}})]})]})}),e.jsx("div",{className:"live-api-control-tray",style:{position:"relative"},children:e.jsx("div",{className:"live-api-control-tray-inner",style:{justifyContent:"center"},children:e.jsx("div",{className:"live-api-loading-text",children:"Initializing AI Assistant..."})})})]})});if(!l)return e.jsx("div",{className:"live-api-modal-overlay",children:e.jsx("div",{className:"live-api-modal-content",children:e.jsx("div",{children:"Error: API Key not available."})})});const y={apiKey:l};return e.jsx(um,{options:y,children:e.jsx(W3,{onClose:t,patientData:a,tokenNumber:n,onAiSummaryChange:i,clinicName:o,voiceAiLanguage:h})})},hm=()=>{const[t,a]=x.useState(null),[n,i]=x.useState(!0),[l,c]=x.useState(null),o=x.useCallback(async()=>{i(!0),c(null);try{const h=await Z("/api/clinics/settings");if(!h.ok)throw new Error("Failed to fetch clinic settings");const m=await h.json();a(m)}catch(h){c(h instanceof Error?h.message:"An error occurred")}finally{i(!1)}},[]);x.useEffect(()=>{o()},[o]);const d=(t==null?void 0:t.custom_columns_config)||{};return{settings:t,customColumnsConfig:d,loading:n,error:l,refetch:o}},X3="_overlay_79cew_5",Z3="_overlayMinimized_79cew_55",eR="_modal_79cew_65",tR="_minimized_79cew_97",nR="_contentWrapper_79cew_113",aR="_exiting_79cew_161",sR="_header_79cew_183",iR="_inputWrapper_79cew_197",rR="_inputContainer_79cew_215",lR="_minimizedSearchIcon_79cew_273",oR="_input_79cew_197",cR="_controlsGroup_79cew_347",uR="_iconButton_79cew_373",dR="_sendButton_79cew_413",hR="_dragBar_79cew_459",mR="_dragBarTitle_79cew_489",pR="_dragBarControls_79cew_519",fR="_dragBarControlsRight_79cew_537",gR="_newChatBtn_79cew_553",xR="_windowControlBtn_79cew_589",yR="_content_79cew_113",bR="_overlayContent_79cew_687",jR="_section_79cew_711",vR="_sectionTitle_79cew_723",NR="_recentList_79cew_743",wR="_recentPill_79cew_767",SR="_recentName_79cew_807",kR="_recentToken_79cew_819",CR="_recentInfo_79cew_837",_R="_examplesGrid_79cew_849",DR="_exampleCard_79cew_861",ER="_exampleIcon_79cew_897",TR="_exampleText_79cew_905",AR="_chatSectionFill_79cew_919",PR="_chatMessagesFill_79cew_935",RR="_chatBubble_79cew_955",OR="_chatBubbleUser_79cew_975",IR="_chatBubbleModel_79cew_991",zR="_chatBubbleSystem_79cew_1009",FR="_processing_79cew_1025",LR="_spinner_79cew_1043",$R="_resultItem_79cew_1065",MR="_resultName_79cew_1093",BR="_resultToken_79cew_1103",UR="_resultDetails_79cew_1115",qR="_noResults_79cew_1125",mt={overlay:X3,overlayMinimized:Z3,modal:eR,minimized:tR,contentWrapper:nR,exiting:aR,header:sR,inputWrapper:iR,inputContainer:rR,minimizedSearchIcon:lR,input:oR,controlsGroup:cR,iconButton:uR,sendButton:dR,dragBar:hR,dragBarTitle:mR,dragBarControls:pR,dragBarControlsRight:fR,newChatBtn:gR,windowControlBtn:xR,content:yR,overlayContent:bR,section:jR,sectionTitle:vR,recentList:NR,recentPill:wR,recentName:SR,recentToken:kR,recentInfo:CR,examplesGrid:_R,exampleCard:DR,exampleIcon:ER,exampleText:TR,chatSectionFill:AR,chatMessagesFill:PR,chatBubble:RR,chatBubbleUser:OR,chatBubbleModel:IR,chatBubbleSystem:zR,processing:FR,spinner:LR,resultItem:$R,resultName:MR,resultToken:BR,resultDetails:UR,noResults:qR},Mu=({columns:t,data:a,onSave:n,onRowAdd:i,onRowDelete:l,onRowClick:c,editable:o=!0,showRowNumbers:d=!0,title:h})=>{const[m,f]=x.useState(a),[g,y]=x.useState(null),[b,v]=x.useState(""),[w,S]=x.useState(""),[_,E]=x.useState(null),[D,O]=x.useState(!1),[M,A]=x.useState(new Set);on.useEffect(()=>{f(a),O(!1)},[a]);const P=x.useMemo(()=>{let H=[...m];if(w.trim()){const I=w.toLowerCase();H=H.filter(V=>Object.values(V).some(re=>re!=null&&String(re).toLowerCase().includes(I)))}return _&&H.sort((I,V)=>{const re=I[_.key],B=V[_.key];return re==null?1:B==null?-1:re<B?_.direction==="asc"?-1:1:re>B?_.direction==="asc"?1:-1:0}),H},[m,w,_]),Q=(H,I)=>{var re;if(!o)return;const V=t.find(B=>B.key===I);(V==null?void 0:V.editable)!==!1&&(y({row:H,col:I}),v(String(((re=m[H])==null?void 0:re[I])??"")))},G=()=>{var H;if(g){const I=[...m],V=t.find(B=>B.key===g.col);let re=b;(V==null?void 0:V.type)==="number"&&(re=parseFloat(re)||0),(V==null?void 0:V.type)==="boolean"&&(re=re.toLowerCase()==="true"||re==="1"),((H=I[g.row])==null?void 0:H[g.col])!==re&&(I[g.row]={...I[g.row],[g.col]:re},f(I),O(!0))}y(null)},C=H=>{if(H.key==="Enter")G();else if(H.key==="Escape")y(null);else if(H.key==="Tab"&&(H.preventDefault(),G(),g)){const I=t.findIndex(re=>re.key===g.col),V=t[I+1];V?setTimeout(()=>Q(g.row,V.key),0):g.row<m.length-1&&setTimeout(()=>Q(g.row+1,t[0].key),0)}},R=H=>{E(I=>(I==null?void 0:I.key)===H?I.direction==="asc"?{key:H,direction:"desc"}:null:{key:H,direction:"asc"})},z=()=>{n&&(n(m),O(!1))},F=()=>{const H=t.map(Ne=>Ne.label).join(","),I=m.map(Ne=>t.map(Ae=>{const T=Ne[Ae.key];return typeof T=="string"&&T.includes(",")?`"${T}"`:T}).join(",")),V=[H,...I].join(`
`),re=new Blob([V],{type:"text/csv"}),B=URL.createObjectURL(re),k=document.createElement("a");k.href=B,k.download=`${h||"data"}.csv`,k.click()},J=H=>{const I=new Set(M);I.has(H)?I.delete(H):I.add(H),A(I)};return e.jsxs("div",{className:"excel-grid",children:[e.jsxs("div",{className:"excel-toolbar",children:[e.jsxs("div",{className:"excel-search",children:[e.jsx("input",{type:"text",placeholder:" Search...",value:w,onChange:H=>S(H.target.value)}),w&&e.jsx("button",{className:"clear-search",onClick:()=>S(""),children:e.jsx(St,{size:14})})]}),e.jsxs("div",{className:"excel-actions",children:[i&&e.jsxs("button",{onClick:i,className:"excel-btn",title:"Add Row",children:[e.jsx(bn,{size:16})," Add"]}),e.jsxs("button",{onClick:F,className:"excel-btn",title:"Export CSV",children:[e.jsx(pC,{size:16})," Export"]}),o&&n&&e.jsxs("button",{onClick:z,className:`excel-btn save-btn ${D?"has-changes":""}`,disabled:!D,title:"Save Changes",children:[e.jsx(ks,{size:16})," Save"]})]})]}),e.jsxs("div",{className:"excel-status",children:[w&&e.jsxs("span",{children:["Showing ",P.length," of ",m.length]}),D&&e.jsx("span",{className:"unsaved-indicator",children:" Unsaved changes"})]}),e.jsx("div",{className:"excel-table-wrapper",children:e.jsxs("table",{className:"excel-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[d&&e.jsx("th",{className:"row-num-header",children:"#"}),t.map(H=>e.jsx("th",{onClick:()=>R(H.key),style:{width:H.width,cursor:"pointer"},children:e.jsxs("div",{className:"th-content",children:[H.label,(_==null?void 0:_.key)===H.key&&(_.direction==="asc"?e.jsx(lg,{size:14}):e.jsx(og,{size:14}))]})},H.key)),l&&e.jsx("th",{className:"action-col",children:""})]})}),e.jsx("tbody",{children:P.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:t.length+(d?1:0)+(l?1:0),className:"no-data",children:"No data found"})}):P.map((H,I)=>e.jsxs("tr",{className:`${M.has(I)?"selected":""} ${c?"clickable-row":""}`,onClick:()=>c&&c(H,I),style:c?{cursor:"pointer"}:void 0,children:[d&&e.jsx("td",{className:"row-num",onClick:()=>J(I),children:I+1}),t.map(V=>e.jsx("td",{onClick:()=>Q(I,V.key),className:`
                                                ${(g==null?void 0:g.row)===I&&(g==null?void 0:g.col)===V.key?"editing":""}
                                                ${V.editable===!1?"read-only":""}
                                            `,children:(g==null?void 0:g.row)===I&&(g==null?void 0:g.col)===V.key?e.jsx("input",{type:V.type==="number"?"number":"text",value:b,onChange:re=>v(re.target.value),onBlur:G,onKeyDown:C,autoFocus:!0}):e.jsx("span",{children:H[V.key]??""})},V.key)),l&&e.jsx("td",{className:"action-col",children:e.jsx("button",{className:"delete-row",onClick:()=>l(I),children:e.jsx(St,{size:14})})})]},H.id||I))})]})}),e.jsxs("div",{className:"excel-footer",children:[e.jsxs("span",{children:[m.length," rows"]}),M.size>0&&e.jsxs("span",{children:[M.size," selected"]})]})]})},Dx=({widget:t,className:a="",autoHideEmptyColumns:n=!1})=>{const i=ft(),[l,c]=x.useState(null),[o,d]=x.useState(null),[h,m]=x.useState([]),[f,g]=x.useState(!1),[y,b]=x.useState(null),[v,w]=x.useState(""),[S,_]=x.useState(!1);x.useEffect(()=>{const O=async()=>{var M,A,P,Q,G,C;g(!0),b(null);try{const R=t.dataSource,z=((M=t.config)==null?void 0:M.filters)&&Array.isArray(t.config.filters)&&t.config.filters.length>0;let F=[];if(z&&(R.startsWith("api:")||R.startsWith("table:"))){const J=await Z("/api/dashboards/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({source:R,filters:t.config.filters})});if(J.ok){const H=await J.json();F=Array.isArray(H)?H:H.data||[],c(F)}else throw new Error("Failed to fetch filtered data")}else{let J="";const H={"api:patients":{url:"/api/patients?limit=50",dataKey:"patients"},"api:drugs":{url:"/api/drugs?limit=50",dataKey:"drugs"},"api:recurring-medications":{url:"/api/recurring-medications?limit=50"},"api:pharmacy-orders":{url:"/api/pharmacy/orders?limit=50",dataKey:"orders"},"api:lab-orders":{url:"/api/lab/orders?limit=50",dataKey:"orders"},"api:lab-tests":{url:"/api/lab/tests?limit=50",dataKey:"tests"},"api:queue":{url:"/api/queue?limit=50",dataKey:"queue"},"api:bills":{url:"/api/bills?limit=100",dataKey:"bills"}};if(H[R])J=H[R].url;else if(R.startsWith("join:"))J=`/api/dashboards/joined-data?join=${R.split(":")[1]}&limit=50`;else if(R.startsWith("dynamic:")){const V=R.split(":"),re=V[1],B=V[2],k=((P=(A=t.config)==null?void 0:A.primaryColumns)==null?void 0:P.join(","))||"",Ne=((G=(Q=t.config)==null?void 0:Q.relatedColumns)==null?void 0:G.join(","))||"";J=`/api/dashboards/dynamic-join?primary=${re}&related=${B}&primaryCols=${k}&relatedCols=${Ne}&limit=50`}else R.startsWith("table:")?J=`/api/custom-tables/${R.split(":")[1]}/records?limit=50`:J=`/api/${R.replace("api:","")}?limit=50`;const I=await Z(J);if(I.ok){const V=await I.json();Array.isArray(V)?F=V:(C=H[R])!=null&&C.dataKey&&V[H[R].dataKey]?F=V[H[R].dataKey]:V.data?F=V.data:F=Object.values(V).find(B=>Array.isArray(B))||[],c(F)}else throw new Error(`Failed to fetch data from ${R}`)}if(t.type==="table"&&n&&F.length>0){const H=(t.config.columns||[...new Set(F.flatMap(I=>Object.keys(I)))]).filter(I=>F.some(V=>{const re=V[I];return re!=null&&re!==""&&(Array.isArray(re)?re.length>0:!0)}));m(H)}else m(t.config.columns||[])}catch(R){b(R.message)}finally{g(!1)}};t.dataSource&&O()},[t.dataSource,t.config]),x.useEffect(()=>{var M;if(!l||!Array.isArray(l)){d(l);return}let O=[...l];if((M=t.config)!=null&&M.filters&&Array.isArray(t.config.filters)&&(O=O.filter(A=>t.config.filters.every(P=>{const Q=A[P.field],G=P.value;switch(P.operator){case"equals":return Q==G;case"neq":return Q!=G;case"contains":return String(Q).toLowerCase().includes(String(G).toLowerCase());case"gt":return Q>G;case"lt":return Q<G;case"gte":return Q>=G;case"lte":return Q<=G;default:return!0}}))),v){const A=v.toLowerCase();O=O.filter(P=>Object.values(P).some(Q=>String(Q).toLowerCase().includes(A)))}d(O)},[l,t.config,v]);const E=()=>{var M,A,P;if(f)return e.jsxs("div",{className:"widget-loading",children:[e.jsx(fC,{className:"spin"})," Loading..."]});if(y)return e.jsxs("div",{className:"widget-error",children:["Error: ",y]});const O=o||[];if(t.type==="stat"){const Q=Array.isArray(O)?O.length:0;return e.jsxs("div",{className:"widget-stat",children:[e.jsx("div",{className:"stat-value",children:Q}),e.jsx("div",{className:"stat-label",children:((M=t.config)==null?void 0:M.label)||"Total Records"})]})}if(t.type==="chart"){if(!Array.isArray(O)||O.length===0)return e.jsx("div",{className:"no-data",children:"No data"});const{chartType:Q="bar",xAxisKey:G="name",dataKey:C="value"}=t.config,R=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8"];return e.jsx("div",{style:{width:"100%",height:350,minHeight:200},children:e.jsx(_h,{width:"100%",height:"100%",children:Q==="line"?e.jsxs(UC,{data:O,children:[e.jsx(zh,{strokeDasharray:"3 3"}),e.jsx(Fh,{dataKey:G}),e.jsx(Lh,{}),e.jsx(To,{}),e.jsx(mg,{}),e.jsx(qC,{type:"monotone",dataKey:C,stroke:"#8884d8",activeDot:{r:8}})]}):Q==="pie"?e.jsxs(z1,{children:[e.jsx(F1,{data:O,cx:"50%",cy:"50%",labelLine:!1,label:({name:z,percent:F})=>`${z} ${(F*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:C,nameKey:G,children:O.map((z,F)=>e.jsx(L1,{fill:R[F%R.length]},`cell-${F}`))}),e.jsx(To,{})]}):e.jsxs($1,{data:O,children:[e.jsx(zh,{strokeDasharray:"3 3"}),e.jsx(Fh,{dataKey:G}),e.jsx(Lh,{}),e.jsx(To,{}),e.jsx(mg,{}),e.jsx(M1,{dataKey:C,fill:"#82ca9d"})]})})})}if(t.type==="table"){if(!Array.isArray(O)||O.length===0)return e.jsx("div",{className:"no-data",children:"No data"});const G=(h.length>0?h:((A=t.config)==null?void 0:A.columns)||(O[0]?Object.keys(O[0]).slice(0,5):[])).map(z=>({key:z,label:z.replace(/_/g," ").replace(/\b\w/g,F=>F.toUpperCase()),editable:!1})),C=async z=>{try{const F=t.dataSource;if(F.startsWith("table:")){const J=F.split(":")[1];for(const H of z)H.id&&await Z(`/api/custom-tables/${J}/records/${H.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:H})});alert("Changes saved successfully!")}else alert("Changes saved locally. Built-in table edits require specific API integration.")}catch(F){console.error("Error saving data:",F),alert("Failed to save changes")}};if(O.length<=10){const z=((P=t.config)==null?void 0:P.columns)||Object.keys(O[0]).filter(J=>!J.startsWith("_")&&J!=="id"),F=J=>{const H=J.patient_id||J.patientId;H&&i(`/dashboard/edit-complaint/patient/${H}`)};return e.jsx("div",{className:"widget-detail-cards",children:O.map((J,H)=>{const V=!!(J.patient_id||J.patientId);return e.jsxs("div",{className:`detail-card ${V?"clickable":""}`,onClick:V?()=>F(J):void 0,style:V?{cursor:"pointer"}:void 0,children:[e.jsxs("div",{className:"detail-card-header",children:[e.jsx("span",{className:"detail-card-title",children:J.name||J.patient_name||J.title||J.brand_name||`Record ${H+1}`}),J.token&&e.jsxs("span",{className:"detail-card-badge",children:["Token #",J.token]}),J.status&&e.jsx("span",{className:`detail-card-status status-${J.status.toLowerCase()}`,children:J.status})]}),e.jsx("div",{className:"detail-card-fields",children:z.map(re=>{const B=J[re];if(B==null||B===""||re==="name"||re==="title")return null;const k=re.replace(/_/g," ").replace(/\b\w/g,Ae=>Ae.toUpperCase()),Ne=typeof B=="object"?JSON.stringify(B):String(B);return e.jsxs("div",{className:"detail-field",children:[e.jsx("span",{className:"detail-field-label",children:k}),e.jsx("span",{className:"detail-field-value",children:Ne})]},re)})})]},J.id||H)})})}const R=z=>{const F=z.patient_id||z.patientId;F&&i(`/dashboard/edit-complaint/patient/${F}`)};return e.jsxs("div",{className:"widget-table-container",children:[e.jsxs("div",{className:"widget-table-search",children:[e.jsx(fn,{size:14}),e.jsx("input",{type:"text",placeholder:"Search...",value:v,onChange:z=>w(z.target.value)})]}),e.jsx(Mu,{columns:G,data:O,editable:!0,showRowNumbers:!0,title:"",onSave:C,onRowClick:R})]})}return e.jsx("div",{children:"Unsupported widget type"})},D=e.jsxs("div",{className:`dashboard-widget ${a}`,children:[e.jsxs("div",{className:"widget-header",children:[e.jsx("h3",{children:t.title}),e.jsx("button",{className:"widget-expand-btn",onClick:()=>_(!0),title:"Expand",children:e.jsx(S1,{size:14})})]}),e.jsx("div",{className:"widget-content",children:E()})]});return e.jsxs(e.Fragment,{children:[D,S&&e.jsx("div",{className:"widget-modal-overlay",onClick:()=>_(!1),children:e.jsxs("div",{className:"widget-modal-content",onClick:O=>O.stopPropagation(),children:[e.jsxs("div",{className:"widget-modal-header",children:[e.jsx("h2",{children:t.title}),e.jsx("button",{onClick:()=>_(!1),className:"widget-modal-close",children:e.jsx(St,{size:20})})]}),e.jsx("div",{className:"widget-modal-body",children:E()})]})})]})},HR=({isOpen:t,onClose:a,title:n,widgets:i,onSave:l})=>{const[c,o]=x.useState(!1),[d,h]=x.useState(n),[m,f]=x.useState(""),[g,y]=x.useState(!1);if(!t)return null;const b=async()=>{if(!(!l||!d.trim())){y(!0);try{await l(d,m),o(!1),a()}catch(v){console.error("Failed to save dashboard:",v),alert("Failed to save dashboard")}finally{y(!1)}}};return e.jsx("div",{className:"temp-dash-overlay",onClick:a,children:e.jsxs("div",{className:"temp-dash-modal",onClick:v=>v.stopPropagation(),children:[e.jsxs("div",{className:"temp-dash-header",children:[e.jsxs("div",{className:"temp-dash-title-group",children:[e.jsx("div",{className:"temp-dash-icon",children:e.jsx(wu,{size:16})}),e.jsxs("div",{className:"temp-dash-title-text",children:[e.jsx("h2",{children:n}),e.jsxs("span",{className:"temp-dash-ai-badge",children:[e.jsx(k1,{size:8})," AI Generated"]})]})]}),e.jsxs("div",{className:"temp-dash-actions",children:[l&&!c&&e.jsxs("button",{onClick:()=>o(!0),className:"temp-dash-save-btn",children:[e.jsx(ks,{size:12})," Save"]}),e.jsx("button",{onClick:a,className:"temp-dash-close-btn",children:e.jsx(St,{size:16})})]})]}),c&&e.jsxs("div",{className:"temp-dash-save-form",children:[e.jsx("input",{type:"text",placeholder:"Dashboard Name",value:d,onChange:v=>h(v.target.value),autoFocus:!0}),e.jsx("input",{type:"text",placeholder:"Description (optional)",value:m,onChange:v=>f(v.target.value)}),e.jsxs("div",{className:"temp-dash-save-actions",children:[e.jsx("button",{onClick:()=>o(!1),className:"temp-dash-cancel-btn",children:"Cancel"}),e.jsx("button",{onClick:b,className:"temp-dash-confirm-btn",disabled:g||!d.trim(),children:g?"Saving...":"Confirm"})]})]}),e.jsx("div",{className:"temp-dash-body",children:i.length===0?e.jsx("div",{className:"temp-dash-empty",children:"No widgets to display."}):e.jsx("div",{className:"temp-dash-grid",children:i.map((v,w)=>e.jsx(Dx,{widget:v,isEditing:!1,autoHideEmptyColumns:!0},v.id||`widget-${w}`))})})]})})},gh=[{name:"Dashboard",path:"/dashboard",icon:e.jsx(wu,{size:16}),keywords:["home","main","analytics","stats"],roles:["all"]},{name:"Clinic Hub",path:"/dashboard/clinic-hub",icon:e.jsx(Mj,{size:16}),keywords:["central","hub","overview"],roles:["admin","superadmin"]},{name:"Analysis Dashboard",path:"/dashboard/analysis",icon:e.jsx(Mj,{size:16}),keywords:["reports","stats","finance","money"],roles:["admin","superadmin"]},{name:"Live AI Assistant",path:"/live-api",icon:e.jsx(Ph,{size:16}),keywords:["ai","chat","voice","assistant"],roles:["all"]},{name:"Patient Search",path:"/dashboard/search-patient",icon:e.jsx(fn,{size:16}),keywords:["find","lookup","patient"],roles:["all"]},{name:"All Patients",path:"/dashboard/all-patients",icon:e.jsx(Vo,{size:16}),keywords:["list","records","database"],roles:["admin","receptionist","doctor"]},{name:"Add New Patient",path:"/dashboard/add-patient",icon:e.jsx(Xh,{size:16}),keywords:["register","new","create","onboard"],roles:["admin","receptionist","doctor"]},{name:"Admissions",path:"/manage-admission",icon:e.jsx(xC,{size:16}),keywords:["ipd","admit","discharge","rooms"],roles:["admin","doctor","receptionist"]},{name:"Pharmacy Inventory",path:"/dashboard/inventory",icon:e.jsx(kr,{size:16}),keywords:["drugs","medicine","stock","pharmacy"],roles:["admin","pharmacy"]},{name:"Add New Drug",path:"/dashboard/inventory/add",icon:e.jsx(kr,{size:16}),keywords:["create","medicine","stock"],roles:["admin","pharmacy"]},{name:"Add Pharmacy Order",path:"/dashboard/add-order",icon:e.jsx(cg,{size:16}),keywords:["sell","bill","dispense"],roles:["admin","pharmacy"]},{name:"Refill Reminders",path:"/refill-reminders",icon:e.jsx(pa,{size:16}),keywords:["recurring","sms","alert"],roles:["admin","pharmacy"]},{name:"Distributors",path:"/dashboard/distributors",icon:e.jsx(C1,{size:16}),keywords:["suppliers","vendors","stock"],roles:["admin","pharmacy"]},{name:"Purchase",path:"/dashboard/purchase",icon:e.jsx(cg,{size:16}),keywords:["buy","procurement","stock"],roles:["admin","pharmacy"]},{name:"Create Lab Order",path:"/create-lab-order",icon:e.jsx(Cs,{size:16}),keywords:["test","pathology","diagnostics"],roles:["admin","doctor","lab"]},{name:"Search Lab Reports",path:"/lab/search-report",icon:e.jsx(fn,{size:16}),keywords:["results","history","find"],roles:["admin","doctor","lab"]},{name:"Lab Inventory",path:"/lab-inventory",icon:e.jsx(Cs,{size:16}),keywords:["reagents","tests","stock"],roles:["admin","lab"]},{name:"Create Custom Bill",path:"/create-custom-bill",icon:e.jsx(_s,{size:16}),keywords:["invoice","custom","charge"],roles:["admin","receptionist"]},{name:"Billing History",path:"/billing",icon:e.jsx(Rh,{size:16}),keywords:["transactions","payments","history"],roles:["admin"]},{name:"Staff Management",path:"/dashboard/staff",icon:e.jsx(Oh,{size:16}),keywords:["users","employees","roles","admin"],roles:["admin","superadmin"]},{name:"Role Management",path:"/dashboard/roles",icon:e.jsx(Oh,{size:16}),keywords:["roles","permissions","access","custom roles"],roles:["admin","superadmin"]}],VR=[{icon:"",text:"Update Paracetamol stock to 100"},{icon:"",text:"Change CBC Test price to 350"},{icon:"",text:"Set Voice AI language to Hindi"},{icon:"",text:"Show revenue for last month"},{icon:"",text:"Purchase 50 strips of Aspirin"},{icon:"",text:"Update consultation fee to 500"},{icon:"",text:"Add new staff member"},{icon:"",text:"Register: John Doe, 25M, Fever"},{icon:"",text:"Check Metformin availability"}],GR=({user:t})=>{const{isOpen:a,closeCommandBar:n}=qo(),i=ft(),l=Qa(),c=x.useRef(null),[o,d]=x.useState(""),[h,m]=x.useState([]),[f,g]=x.useState([]),[y,b]=x.useState([]),[v,w]=x.useState(!1),[S,_]=x.useState(!0),[E,D]=x.useState(!0),{customColumnsConfig:O}=hm(),M=(O==null?void 0:O.patients)||[],[A,P]=x.useState(null),[Q,G]=x.useState(!1),C=x.useMemo(()=>t?gh.filter(De=>De.roles.includes("all")||t.role&&De.roles.includes(t.role)):gh,[t]),R=x.useMemo(()=>new Da(C,{keys:["name","keywords"],threshold:.3}),[C]),[z,F]=x.useState(!1),[J,H]=x.useState(!1),[I,V]=x.useState(!1);x.useEffect(()=>{if(a)F(!0),V(!1);else{V(!0);const De=setTimeout(()=>{F(!1),V(!1)},200);return()=>clearTimeout(De)}},[a]);const{setPageContext:re}=sm();x.useEffect(()=>{if(a){const De=l.pathname,qe=gh.find(te=>te.path===De)||gh.find(te=>De.startsWith(te.path)&&te.path!=="/dashboard");re(qe?{name:qe.name,path:De,data:{role:qe.roles}}:{name:"Current Page",path:De})}},[a,l.pathname,re]);const{chatHistory:B,isProcessing:k,handleSendMessage:Ne,setChatQuery:Ae,refreshChat:T,selectedImage:Ce,handleImageSelect:Ue,clearImage:Pe,temporaryDashboard:de,closeTemporaryDashboard:Se,saveTemporaryDashboard:ee}=cx({settings:{},staffList:[],enableDynamicContext:!1}),oe=x.useRef(null),fe=De=>{var te;const qe=(te=De.target.files)==null?void 0:te[0];qe&&Ue(qe)},[ge,q]=x.useState({x:0,y:0}),[W,Y]=x.useState(!1),ie=x.useRef({x:0,y:0}),ce=x.useRef({x:0,y:0}),pe=x.useRef(!1),He=x.useRef(null);x.useEffect(()=>{const De=te=>{if(!W)return;pe.current=!0;const Re=te.clientX-ie.current.x,lt=te.clientY-ie.current.y;let Xe=ce.current.x+Re,dt=ce.current.y+lt;if(He.current){const jt=He.current.offsetWidth,At=He.current.offsetHeight,Ye=(window.innerWidth-jt)/2,it=(window.innerHeight-At)/2,Ze=Math.max(0,Ye),ht=Math.max(0,it);Xe=Math.max(-Ze,Math.min(Ze,Xe)),dt=Math.max(-ht,Math.min(ht,dt))}q({x:Xe,y:dt})},qe=()=>{Y(!1)};return W&&(window.addEventListener("mousemove",De),window.addEventListener("mouseup",qe)),()=>{window.removeEventListener("mousemove",De),window.removeEventListener("mouseup",qe)}},[W]),x.useEffect(()=>{a&&G(!0)},[l.pathname]),x.useEffect(()=>{(f.length>0||y.length>0)&&Q&&G(!1)},[f,y]),x.useEffect(()=>{if(a&&window.innerWidth<=768){window.history.pushState({commandBarOpen:!0},"");const De=qe=>{qe.preventDefault(),G(!0)};return window.addEventListener("popstate",De),()=>{window.removeEventListener("popstate",De)}}},[a]),x.useEffect(()=>{Q||q({x:0,y:0})},[Q]),x.useEffect(()=>{Ae(o)},[o]),x.useEffect(()=>{a&&c.current&&c.current.focus()},[a]),x.useEffect(()=>{if(!a||Q||!(window.innerWidth<=768))return;const qe=window.scrollY,te=document.body.style.overflow,Re=document.documentElement.style.overflow,lt=document.body.style.position,Xe=document.body.style.top,dt=document.body.style.width;return document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${qe}px`,document.body.style.width="100%",()=>{document.documentElement.style.overflow=Re,document.body.style.overflow=te,document.body.style.position=lt,document.body.style.top=Xe,document.body.style.width=dt,window.scrollTo(0,qe)}},[a,Q]);const We=De=>{!De.trim()&&!Ce||(G(!1),Ne(De),d(""),g([]),b([]))},{preFilledQuery:st,setPreFilledQuery:me}=qo();x.useEffect(()=>{a&&st&&(d(st),setTimeout(()=>{We(st),me("")},300))},[a,st,me]),x.useEffect(()=>{A&&(d(A),H(!1),setTimeout(()=>We(A),50),P(null))},[A]);const ve=()=>{H(!0)},Fe=()=>{d(""),g([]),b([]),T(),c.current&&c.current.focus()};x.useEffect(()=>{a&&(async()=>{_(!0);try{const qe=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),te=await Z(`/api/patients?${qe.toString()}`);if(te.ok){const Re=await te.json();m(Re.patients||[])}}catch(qe){console.error("Error fetching recent patients:",qe)}finally{_(!1)}})()},[a]);const Ee=x.useMemo(()=>$u(async De=>{const qe=De.trim(),te=/^\d+$/.test(qe),Re=qe.split(/\s+/).length;if(qe.length>1){const lt=R.search(qe);b(lt.map(Xe=>Xe.item))}else b([]);if(qe.length<2||te&&qe.length>10||!te&&Re>3){g([]),w(!1);return}w(!0);try{const lt=new URLSearchParams({search:encodeURIComponent(De),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),Xe=await Z(`/api/patients?${lt.toString()}`);if(Xe.ok){const dt=await Xe.json();g(dt.patients||[])}}catch(lt){console.error("Search error:",lt)}finally{w(!1)}},300),[t]),L=De=>{const qe=De.target.value;d(qe),Ee(qe)},ne=De=>{De.id&&i(`/dashboard/edit-complaint/patient/${De.id}`)},xe=De=>{i(De.path)},ae=De=>{d(De),setTimeout(()=>We(De),50)},we=De=>{o.trim()&&We(o)},Le=De=>{De.key==="Enter"&&!De.shiftKey&&(De.preventDefault(),we())},Je=De=>{De.target===De.currentTarget&&n()};if(!a&&!z)return null;const ot=(f.length>0||y.length>0)&&!v,xt=o.length===0&&f.length===0&&y.length===0,be=o.length>=3&&f.length===0&&y.length===0&&!v,ue=B.length>0||k,je=!ue||ot,ke=ue&&ot,Me=ue&&!E&&!Q&&!ot;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`${mt.overlay} ${Q?mt.overlayMinimized:""} ${I?mt.exiting:""}`,onClick:Je,children:e.jsxs("div",{ref:He,className:`${mt.modal} ${Q?mt.minimized:""} ${Me?mt.collapsed:""} ${I?mt.exiting:""}`,style:{transform:`translate(${ge.x}px, ${ge.y}px)`,height:Me?"auto":void 0},onClick:()=>{pe.current||(Q?G(!1):Me&&D(!0))},children:[e.jsxs("div",{className:mt.dragBar,onMouseDown:De=>{De.target.closest("button")||(Y(!0),pe.current=!1,ie.current={x:De.clientX,y:De.clientY},ce.current={x:ge.x,y:ge.y})},children:[e.jsxs("div",{className:mt.dragBarControls,children:[e.jsx("button",{className:mt.windowControlBtn,onClick:n,title:"Close",children:e.jsx(St,{size:24,color:"#64748b"})}),e.jsx("button",{className:mt.windowControlBtn,onClick:()=>G(!Q),title:Q?"Maximize":"Minimize",children:Q?e.jsx(S1,{size:24,color:"#64748b"}):e.jsx(gC,{size:24,color:"#64748b"})})]}),e.jsx("div",{className:mt.dragBarTitle,children:ue?e.jsxs(e.Fragment,{children:[e.jsx(Ph,{size:14,className:"text-violet-600"}),e.jsx("span",{children:"AI Assistant"})]}):ot?e.jsxs(e.Fragment,{children:[e.jsx(fn,{size:14,className:"text-blue-500"}),e.jsx("span",{children:"Search Results"})]}):e.jsx("span",{style:{opacity:.5,fontWeight:500},children:"Clinic Manager AI"})}),e.jsx("div",{className:mt.dragBarControlsRight,children:e.jsx("button",{className:mt.newChatBtn,onClick:Fe,title:"New Chat",children:e.jsx(ma,{size:20})})})]}),e.jsxs("div",{className:mt.contentWrapper,children:[ue&&e.jsx("div",{className:mt.chatSectionFill,children:e.jsxs("div",{className:mt.chatMessagesFill,children:[B.map((De,qe)=>e.jsx("div",{className:`${mt.chatBubble} ${De.role==="user"?mt.chatBubbleUser:De.role==="model"?mt.chatBubbleModel:mt.chatBubbleSystem}`,children:De.role==="model"?e.jsx(qa,{remarkPlugins:[Wn],children:De.text}):De.text},qe)),k&&e.jsxs("div",{className:mt.processing,children:[e.jsx(Ci,{size:14,className:mt.spinner}),"Thinking..."]})]})}),je&&e.jsxs("div",{className:ke?mt.overlayContent:mt.content,children:[xt&&!ue&&e.jsxs("div",{className:mt.section,children:[e.jsx("div",{className:mt.sectionTitle,children:"Newly Registered"}),e.jsx("div",{className:mt.recentList,children:S?[1,2,3,4,5].map(De=>e.jsx(U,{width:100,height:32,style:{borderRadius:"16px"}},De)):h.length>0?h.map(De=>e.jsxs("div",{className:mt.recentPill,onClick:()=>ne(De),children:[e.jsx("span",{className:mt.recentName,children:De.name||"Patient"}),e.jsxs("span",{className:mt.recentToken,children:["#",De.token]}),e.jsxs("span",{className:mt.recentInfo,children:[De.age?`${De.age}y`:""," ",De.gender||""]})]},De.id)):e.jsx("div",{className:mt.recentInfo,style:{opacity:.5},children:"No recent patients found."})})]}),xt&&!ue&&e.jsxs("div",{className:mt.section,children:[e.jsx("div",{className:mt.sectionTitle,children:"Try Asking AI..."}),e.jsx("div",{className:mt.examplesGrid,children:VR.map((De,qe)=>e.jsxs("div",{className:mt.exampleCard,onClick:()=>ae(De.text),children:[e.jsx("span",{className:mt.exampleIcon,children:De.icon}),e.jsx("span",{className:mt.exampleText,children:De.text})]},qe))})]}),v&&e.jsx("div",{className:mt.section,children:e.jsxs("div",{className:mt.processing,children:[e.jsx(Ci,{size:16,className:mt.spinner}),"Searching..."]})}),y.length>0&&!v&&e.jsxs("div",{className:mt.section,children:[e.jsx("div",{className:mt.sectionTitle,children:"Pages Found"}),e.jsx("div",{className:mt.resultsList,children:y.map((De,qe)=>e.jsxs("div",{className:mt.resultItem,onClick:()=>xe(De),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{color:"#7c3aed"},children:De.icon}),e.jsx("span",{className:mt.resultName,children:De.name})]}),e.jsx("span",{className:mt.resultDetails,style:{fontSize:"0.7rem"},children:"Jump to page"})]},qe))})]}),ot&&f.length>0&&e.jsxs("div",{className:mt.section,children:[e.jsx("div",{className:mt.sectionTitle,children:"Patients Found"}),e.jsx("div",{className:mt.resultsList,children:f.map(De=>e.jsxs("div",{className:mt.resultItem,onClick:()=>ne(De),children:[e.jsxs("div",{children:[e.jsxs("span",{className:mt.resultToken,children:["[#",De.token,"]"]}),e.jsx("span",{className:mt.resultName,children:De.name})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-slate-500 mt-1",children:[De.age&&e.jsxs("span",{children:[De.age," Yrs"]}),De.gender&&e.jsx("span",{children:De.gender}),e.jsxs("span",{children:["ID: ",De.id.slice(-6).toUpperCase()]}),M.map(qe=>{var Re;const te=(Re=De.custom_fields)==null?void 0:Re[qe.key];return te?e.jsxs("span",{className:"bg-slate-100 px-1.5 py-0.5 rounded text-slate-600 border border-slate-200",children:[qe.label,": ",String(te)]},qe.key):null})]})]},De.id))})]}),be&&!ue&&e.jsx("div",{className:mt.section,children:e.jsxs("div",{className:mt.noResults,children:["Press ",e.jsx("strong",{children:"Enter"}),' to send "',o,'" to AI Assistant']})})]})]}),e.jsxs("div",{className:mt.header,children:[e.jsx("div",{className:mt.inputWrapper,children:e.jsxs("div",{className:mt.inputContainer,children:[e.jsx("div",{className:mt.minimizedSearchIcon,children:e.jsx(fn,{size:24})}),e.jsx("textarea",{ref:De=>{c.current=De,De&&(De.style.height="auto",De.style.height=Math.min(De.scrollHeight,150)+"px")},className:mt.input,placeholder:Q?"Type here...":"Search (Name/Token/Phone), Ask AI, or Enter New Case (Name Age Sex Complaint)...",value:o,onChange:De=>{L(De),De.target.style.height="auto",De.target.style.height=Math.min(De.target.scrollHeight,150)+"px"},onKeyDown:Le,onFocus:De=>{De.target.scrollIntoView=()=>{},setTimeout(()=>{He.current&&(He.current.scrollTop=He.current.scrollHeight)},100)},rows:1,disabled:k}),Ce&&e.jsxs("div",{style:{position:"relative",marginRight:"0.5rem"},children:[e.jsx("img",{src:Ce,alt:"Selected",style:{width:"24px",height:"24px",objectFit:"cover",borderRadius:"4px",border:"1px solid #e2e8f0"}}),e.jsx("button",{onClick:Pe,style:{position:"absolute",top:-4,right:-4,background:"rgba(0,0,0,0.6)",color:"white",border:"none",borderRadius:"50%",padding:"1px",cursor:"pointer",display:"flex"},children:e.jsx(St,{size:8})})]}),e.jsxs("div",{className:mt.controlsGroup,children:[e.jsx("button",{className:mt.iconButton,onClick:()=>{var De;return(De=oe.current)==null?void 0:De.click()},title:"Attach Image",children:e.jsx(Kh,{size:16})}),(o.trim().length>0||Ce)&&e.jsx("button",{className:`${mt.iconButton} ${mt.sendButton}`,onClick:()=>We(o),title:"Send to AI",children:e.jsx(Wh,{size:16})}),e.jsx("button",{className:mt.iconButton,onClick:ve,title:"Voice Input",children:e.jsx(Ru,{size:16})})]})]})}),e.jsx("input",{type:"file",ref:oe,onChange:fe,accept:"image/*",style:{display:"none"}})]})]})}),J&&e.jsx(dm,{onClose:()=>H(!1),patientData:null,tokenNumber:null,onAiSummaryChange:De=>{console.log("AI Summary:",De),P(De)}}),de&&e.jsx(HR,{isOpen:!!de,onClose:Se,title:de.title,widgets:de.widgets,onSave:ee})]})};function us(t,a=100){const n=x.useRef(!1);x.useEffect(()=>{if(n.current)return;const i=setTimeout(()=>{const l=document,c=['input[type="text"]:not([disabled]):not([readonly])','input[type="search"]:not([disabled]):not([readonly])','input[type="email"]:not([disabled]):not([readonly])','input[type="tel"]:not([disabled]):not([readonly])','input[type="url"]:not([disabled]):not([readonly])',"input:not([type]):not([disabled]):not([readonly])"].join(", "),o=l.querySelectorAll(c),d=Array.from(o).filter(h=>{const m=window.getComputedStyle(h),f=h.getBoundingClientRect();return m.display!=="none"&&m.visibility!=="hidden"&&m.opacity!=="0"&&f.width>0&&f.height>0});if(d.length>0){const h=d[0];h.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{h.focus()},50),n.current=!0}},a);return()=>clearTimeout(i)},[t,a])}const QR=({onLoginSuccess:t})=>{const[a,n]=x.useState(""),[i,l]=x.useState(""),[c,o]=x.useState(null),[d,h]=x.useState(!1),m=ft();us();const f=async b=>{b.preventDefault(),h(!0),o(null);try{const v=await Z("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:i})});if(!v.ok){let S=`Login failed with status: ${v.status}`;try{S=(await v.json()).message||S}catch{try{const E=await v.text();E&&(S=`${S} - ${E}`)}catch{}}throw new Error(S)}const w=await v.json();console.log("Login successful:",w),localStorage.setItem("authToken",w.token),localStorage.setItem("currentUser",JSON.stringify(w.user)),w.user.clinic_id&&localStorage.setItem("currentClinicId",w.user.clinic_id),t(w.user),w.user.role==="doctor"?m("/dashboard/queue"):m("/dashboard")}catch(v){console.error("Login failed:",v),o(v.message||"Login failed. Please check your credentials.")}finally{h(!1)}},g=async b=>{h(!0),o(null);try{const v=await Z("/api/auth/google",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:b.credential})});if(!v.ok)throw new Error("Google Sign-In failed");const w=await v.json();localStorage.setItem("authToken",w.token),localStorage.setItem("currentUser",JSON.stringify(w.user)),w.user.clinic_id&&localStorage.setItem("currentClinicId",w.user.clinic_id),t(w.user),w.user.role==="doctor"?m("/dashboard/queue"):m("/dashboard")}catch(v){console.error("Google Login Error:",v),o("Google Sign-In failed. Please try again.")}finally{h(!1)}},y=()=>{console.error("Google Login Failed"),o("Google Sign-In was unsuccessful. Please try again.")};return e.jsx("div",{className:"auth-page-container",children:e.jsxs("div",{className:"auth-form-card",children:[e.jsx("h2",{className:"auth-title",children:"Newtons AI HMS"}),e.jsx("p",{className:"auth-subtitle",children:"Sign in to continue"}),e.jsxs("form",{onSubmit:f,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:a,onChange:b=>n(b.target.value),className:"auth-text-input",placeholder:" "}),e.jsx("label",{htmlFor:"email",children:"Email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:i,onChange:b=>l(b.target.value),className:"auth-text-input",placeholder:" "}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),c&&e.jsx("div",{className:"auth-error-message",children:e.jsx("p",{children:c})}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",disabled:d,className:"auth-submit-button",children:d?"Signing in...":"Sign In"})})]}),e.jsx("div",{className:"google-login-container",children:e.jsx(I_,{onSuccess:g,onError:y,useOneTap:!0})}),e.jsxs("div",{className:"auth-navigation-link-container",children:["Don't have an account?"," ",e.jsx(Ss,{to:"/register",className:"auth-navigation-link",children:"Create account"})]}),e.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})},YR=()=>{const[t,a]=x.useState(""),[n,i]=x.useState(""),[l,c]=x.useState(""),[o,d]=x.useState(""),[h,m]=x.useState(null),[f,g]=x.useState(!1),y=ft(),b=async v=>{v.preventDefault(),g(!0),m(null);try{const w=await Z("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicName:t,userName:n,userEmail:l,userPassword:o})}),S=await w.json();if(!w.ok)throw new Error(S.message||`HTTP error! status: ${w.status}`);console.log("Registration successful:",S),alert("Registration successful! Please log in."),y("/login")}catch(w){console.error("Registration failed:",w),m(w.message||"Registration failed. Please try again.")}finally{g(!1)}};return e.jsx("div",{className:"auth-page-container",children:e.jsxs("div",{className:"auth-form-card",children:[e.jsx("h2",{className:"auth-title",children:"Register Clinic & Admin"}),e.jsxs("form",{onSubmit:b,className:"auth-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"clinicName",children:"Clinic Name"}),e.jsx("input",{id:"clinicName",name:"clinicName",type:"text",required:!0,value:t,onChange:v=>a(v.target.value),className:"auth-text-input",placeholder:"Your Clinic's Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userName",children:"Your Name (Admin)"}),e.jsx("input",{id:"userName",name:"userName",type:"text",required:!0,value:n,onChange:v=>i(v.target.value),className:"auth-text-input",placeholder:"Your Full Name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userEmail",children:"Your Email (Admin Login)"}),e.jsx("input",{id:"userEmail",name:"userEmail",type:"email",autoComplete:"email",required:!0,value:l,onChange:v=>c(v.target.value),className:"auth-text-input",placeholder:"you@example.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"userPassword",children:"Password"}),e.jsx("input",{id:"userPassword",name:"userPassword",type:"password",required:!0,minLength:6,value:o,onChange:v=>d(v.target.value),className:"auth-text-input",placeholder:"Min. 6 characters"})]}),h&&e.jsx("div",{className:"auth-error-message",children:e.jsx("p",{children:h})}),e.jsx("div",{className:"form-group",children:e.jsx("button",{type:"submit",disabled:f,className:"auth-submit-button",children:f?"Registering...":"Register Clinic & Admin"})})]}),e.jsxs("div",{className:"auth-navigation-link-container",children:["Already have an account?"," ",e.jsx(Ss,{to:"/login",className:"auth-navigation-link",children:"Sign in"})]}),e.jsx("p",{className:"auth-attribution",children:"from Newtons AI"})]})})};function o0(t){return Ca({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M332.8 320h38.4c6.4 0 12.8-6.4 12.8-12.8V172.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v134.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V76.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v230.4c0 6.4 6.4 12.8 12.8 12.8zm-288 0h38.4c6.4 0 12.8-6.4 12.8-12.8v-70.4c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v70.4c0 6.4 6.4 12.8 12.8 12.8zm96 0h38.4c6.4 0 12.8-6.4 12.8-12.8V108.8c0-6.4-6.4-12.8-12.8-12.8h-38.4c-6.4 0-12.8 6.4-12.8 12.8v198.4c0 6.4 6.4 12.8 12.8 12.8zM496 384H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v336c0 17.67 14.33 32 32 32h464c8.84 0 16-7.16 16-16v-32c0-8.84-7.16-16-16-16z"},child:[]}]})(t)}function xh(t){return Ca({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM96 424c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm96-192c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zm128 368c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16zm0-96c0 4.4-3.6 8-8 8H168c-4.4 0-8-3.6-8-8v-16c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16z"},child:[]}]})(t)}function c0(t){return Ca({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"},child:[]}]})(t)}function Of(t){return Ca({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M437.2 403.5L320 215V64h8c13.3 0 24-10.7 24-24V24c0-13.3-10.7-24-24-24H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h8v151L10.8 403.5C-18.5 450.6 15.3 512 70.9 512h306.2c55.7 0 89.4-61.5 60.1-108.5zM137.9 320l48.2-77.6c3.7-5.2 5.8-11.6 5.8-18.4V64h64v160c0 6.9 2.2 13.2 5.8 18.4l48.2 77.6h-172z"},child:[]}]})(t)}function ol(t){return Ca({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"},child:[]}]})(t)}function yh(t){return Ca({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M480 320a96 96 0 1 0-96-96 96 96 0 0 0 96 96zm48 32a22.88 22.88 0 0 0-7.06 1.09 124.76 124.76 0 0 1-81.89 0A22.82 22.82 0 0 0 432 352a112 112 0 0 0-112 112.62c.14 26.26 21.73 47.38 48 47.38h224c26.27 0 47.86-21.12 48-47.38A112 112 0 0 0 528 352zm-198.09 10.45A145.19 145.19 0 0 1 352 344.62V128a32 32 0 0 0-32-32h-32V32a32 32 0 0 0-32-32H96a32 32 0 0 0-32 32v64H32a32 32 0 0 0-32 32v368a16 16 0 0 0 16 16h288.31A78.62 78.62 0 0 1 288 464.79a143.06 143.06 0 0 1 41.91-102.34zM144 404a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12H92a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm48-122a6 6 0 0 1-6 6h-20a6 6 0 0 1-6-6v-26h-26a6 6 0 0 1-6-6v-20a6 6 0 0 1 6-6h26V70a6 6 0 0 1 6-6h20a6 6 0 0 1 6 6v26h26a6 6 0 0 1 6 6v20a6 6 0 0 1-6 6h-26zm80 250a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12zm0-128a12 12 0 0 1-12 12h-40a12 12 0 0 1-12-12v-40a12 12 0 0 1 12-12h40a12 12 0 0 1 12 12z"},child:[]}]})(t)}function jo(t){return Ca({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M352 288h-16v-88c0-4.42-3.58-8-8-8h-13.58c-4.74 0-9.37 1.4-13.31 4.03l-15.33 10.22a7.994 7.994 0 0 0-2.22 11.09l8.88 13.31a7.994 7.994 0 0 0 11.09 2.22l.47-.31V288h-16c-4.42 0-8 3.58-8 8v16c0 4.42 3.58 8 8 8h64c4.42 0 8-3.58 8-8v-16c0-4.42-3.58-8-8-8zM608 64H32C14.33 64 0 78.33 0 96v320c0 17.67 14.33 32 32 32h576c17.67 0 32-14.33 32-32V96c0-17.67-14.33-32-32-32zM48 400v-64c35.35 0 64 28.65 64 64H48zm0-224v-64h64c0 35.35-28.65 64-64 64zm272 192c-53.02 0-96-50.15-96-112 0-61.86 42.98-112 96-112s96 50.14 96 112c0 61.87-43 112-96 112zm272 32h-64c0-35.35 28.65-64 64-64v64zm0-224c-35.35 0-64-28.65-64-64h64v64z"},child:[]}]})(t)}function mu(t){return Ca({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M112 32C50.1 32 0 82.1 0 144v224c0 61.9 50.1 112 112 112s112-50.1 112-112V144c0-61.9-50.1-112-112-112zm48 224H64V144c0-26.5 21.5-48 48-48s48 21.5 48 48v112zm139.7-29.7c-3.5-3.5-9.4-3.1-12.3.8-45.3 62.5-40.4 150.1 15.9 206.4 56.3 56.3 143.9 61.2 206.4 15.9 4-2.9 4.3-8.8.8-12.3L299.7 226.3zm229.8-19c-56.3-56.3-143.9-61.2-206.4-15.9-4 2.9-4.3 8.8-.8 12.3l210.8 210.8c3.5 3.5 9.4 3.1 12.3-.8 45.3-62.6 40.5-150.1-15.9-206.4z"},child:[]}]})(t)}function Co(t){return Ca({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"},child:[]}]})(t)}function bw(t){return Ca({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"},child:[]}]})(t)}function u0(t){return Ca({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M447.1 112c-34.2.5-62.3 28.4-63 62.6-.5 24.3 12.5 45.6 32 56.8V344c0 57.3-50.2 104-112 104-60 0-109.2-44.1-111.9-99.2C265 333.8 320 269.2 320 192V36.6c0-11.4-8.1-21.3-19.3-23.5L237.8.5c-13-2.6-25.6 5.8-28.2 18.8L206.4 35c-2.6 13 5.8 25.6 18.8 28.2l30.7 6.1v121.4c0 52.9-42.2 96.7-95.1 97.2-53.4.5-96.9-42.7-96.9-96V69.4l30.7-6.1c13-2.6 21.4-15.2 18.8-28.2l-3.1-15.7C107.7 6.4 95.1-2 82.1.6L19.3 13C8.1 15.3 0 25.1 0 36.6V192c0 77.3 55.1 142 128.1 156.8C130.7 439.2 208.6 512 304 512c97 0 176-75.4 176-168V231.4c19.1-11.1 32-31.7 32-55.4 0-35.7-29.2-64.5-64.9-64zm.9 80c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16z"},child:[]}]})(t)}function JR(t){return Ca({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(t)}function bh(t){return Ca({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zM104 424c0 13.3 10.7 24 24 24s24-10.7 24-24-10.7-24-24-24-24 10.7-24 24zm216-135.4v49c36.5 7.4 64 39.8 64 78.4v41.7c0 7.6-5.4 14.2-12.9 15.7l-32.2 6.4c-4.3.9-8.5-1.9-9.4-6.3l-3.1-15.7c-.9-4.3 1.9-8.6 6.3-9.4l19.3-3.9V416c0-62.8-96-65.1-96 1.9v26.7l19.3 3.9c4.3.9 7.1 5.1 6.3 9.4l-3.1 15.7c-.9 4.3-5.1 7.1-9.4 6.3l-31.2-4.2c-7.9-1.1-13.8-7.8-13.8-15.9V416c0-38.6 27.5-70.9 64-78.4v-45.2c-2.2.7-4.4 1.1-6.6 1.9-18 6.3-37.3 9.8-57.4 9.8s-39.4-3.5-57.4-9.8c-7.4-2.6-14.9-4.2-22.6-5.2v81.6c23.1 6.9 40 28.1 40 53.4 0 30.9-25.1 56-56 56s-56-25.1-56-56c0-25.3 16.9-46.5 40-53.4v-80.4C48.5 301 0 355.8 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-72-56.8-130.3-128-133.8z"},child:[]}]})(t)}function vo(t){return Ca({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"},child:[]}]})(t)}const jw={superadmin:[{title:"Admin Pages",links:[{path:"/dashboard",name:"Super Admin Dashboard",icon:ol},{path:"/dashboard/clinic-subscriptions",name:"Clinic Subscriptions",icon:yh},{path:"/dashboard/users",name:"User Management",icon:vo}]}],admin:[{title:"Dashboard",links:[{path:"/dashboard",name:"Admin Dashboard",icon:ol}]},{title:"Clinic Management",links:[{path:"/dashboard/clinic-hub",name:"Clinic Hub",icon:c0},{path:"/dashboard/staff",name:"Staff Management",icon:vo},{path:"/dashboard/roles",name:"Role Management",icon:bh},{path:"/custom-tables",name:"Custom Tables",icon:xh},{path:"/dashboards",name:"Custom Dashboards",icon:o0}]},{title:"Patient Management",links:[{path:"/dashboard/patients/add",name:"Add Patient",icon:yh},{path:"/dashboard/patients",name:"All Patients",icon:vo},{path:"/dashboard/patients/search",name:"Search Patient",icon:Co}]},{title:"Inventory & Pharmacy",links:[{path:"/dashboard/analysis",name:"Analysis Dashboard",icon:xh},{path:"/dashboard/inventory",name:"Inventory Management",icon:mu},{path:"/dashboard/inventory/add",name:"Add Drug",icon:mu},{path:"/dashboard/distributors",name:"Distributor Management",icon:vo}]},{title:"Queue & Subscriptions",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:u0},{path:"/dashboard/subscriptions",name:"Manage Subscriptions",icon:jo},{path:"/dashboard/subscriptions/add",name:"Add Subscription Plan",icon:jo}]},{title:"Role Operations",links:[{path:"/manage-admission",name:"Admission Desk",icon:bh},{path:"/reception",name:"Reception View",icon:ol},{path:"/pharmacy-queue",name:"Pharmacy Queue",icon:mu},{path:"/lab",name:"Lab Panel",icon:Of},{path:"/billing",name:"Billing",icon:jo},{path:"/create-custom-bill",name:"Custom Bill",icon:jo}]}],doctor:[{title:"Patient & Admissions",links:[{path:"/dashboard/search",name:"Patient Search",icon:Co},{path:"/dashboard/add-patient",name:"Add Patient",icon:yh},{path:"/manage-admission",name:"Manage Admission",icon:bh}]},{title:"Lab & Billing",links:[{path:"/create-lab-order",name:"Create Lab Order",icon:Of},{path:"/billing",name:"Billing",icon:jo}]},{title:"Queue",links:[{path:"/dashboard/queue",name:"Doctor Queue",icon:u0}]},{title:"Analytics",links:[{path:"/dashboards",name:"Custom Dashboards",icon:o0}]}],receptionist:[{title:"Reception",links:[{path:"/dashboard",name:"Reception Dashboard",icon:ol}]},{title:"Patient Management",links:[{path:"/dashboard/all-patients",name:"All Patients",icon:vo},{path:"/dashboard/patients/add",name:"Add Patient",icon:yh},{path:"/dashboard/patients/search",name:"Search Patient",icon:Co}]},{title:"Billing & Admissions",links:[{path:"/billing",name:"Billing",icon:jo},{path:"/manage-admission",name:"Manage Admission",icon:bh}]}],lab:[{title:"Lab Operations",links:[{path:"/dashboard",name:"Lab Dashboard",icon:ol},{path:"/lab-inventory",name:"Lab Test Inventory",icon:Of},{path:"/lab/search-report",name:"Search Lab Report",icon:Co}]}],pharmacy:[{title:"Pharmacy Operations",links:[{path:"/dashboard",name:"Pharmacy Queue",icon:ol},{path:"/dashboard/inventory",name:"Pharmacy Inventory",icon:mu},{path:"/dashboard/inventory/add",name:"Add Drug",icon:mu},{path:"/dashboard/add-order",name:"Add Pharmacy Order",icon:xh},{path:"/dashboard/distributors",name:"Distributor Management",icon:vo}]},{title:"Analysis & Settings",links:[{path:"/dashboard/analysis",name:"Analysis Dashboard",icon:xh},{path:"/dashboard/settings",name:"Pharmacy Settings",icon:c0},{path:"/dashboard/search-patient-records",name:"Search Patient Records",icon:Co}]}]},KR=({user:t,onLogout:a,userRole:n,isOpen:i,onClose:l})=>{const c=Qa(),[o,d]=x.useState(""),h=jw[n]||[],[m,f]=x.useState(500),g=x.useRef(!1),y=x.useCallback(S=>{g.current=!0,S.preventDefault()},[]),b=x.useCallback(()=>{g.current=!1},[]),v=x.useCallback(S=>{if(g.current){const _=window.innerWidth-S.clientX;_>250&&_<window.innerWidth*.8&&f(_)}},[]);x.useEffect(()=>(window.addEventListener("mousemove",v),window.addEventListener("mouseup",b),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",b)}),[v,b]);const w=h.map(S=>({...S,links:S.links.filter(_=>_.name.toLowerCase().includes(o.toLowerCase()))})).filter(S=>S.links.length>0);return e.jsxs("div",{className:`side-panel ${i?"open":""}`,style:{width:`${m}px`,right:i?"0":`-${m}px`},children:[e.jsx("div",{className:"resizer",onMouseDown:y}),e.jsxs("div",{className:"side-panel-header",children:[e.jsx(Ss,{to:"/dashboard",className:"home-button",onClick:l,children:e.jsx(ol,{})}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx(Co,{style:{position:"absolute",left:"16px",top:"50%",transform:"translateY(-50%)",color:"#94a3b8"}}),e.jsx("input",{type:"text",placeholder:"Search pages...",className:"search-bar",value:o,onChange:S=>d(S.target.value)})]}),e.jsx("button",{className:"close-button",onClick:l,children:""})]}),e.jsx("nav",{children:w.map((S,_)=>e.jsxs("div",{className:"page-section",children:[e.jsx("div",{className:"page-title",children:S.title}),e.jsx("ul",{className:"sub-page-list",children:S.links.map(E=>{const D=E.icon;return e.jsx("li",{children:e.jsxs(Ss,{to:E.path,className:c.pathname===E.path?"active":"",onClick:l,children:[D&&e.jsx(D,{})," ",E.name]})},E.path)})})]},_))}),e.jsxs("div",{className:"user-info-section",children:[e.jsxs("span",{className:"user-name",children:["Welcome, ",t.name]}),e.jsxs("button",{onClick:a,className:"logout-button-sidebar",children:[e.jsx(bw,{})," Logout"]})]})]})},WR=({user:t,onLogout:a,userRole:n,isOpen:i,onClose:l,roleNavigation:c})=>{const o=Qa(),d=c[n]||[];return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`mobile-side-panel-overlay ${i?"open":""}`,onClick:l}),e.jsxs("div",{className:`mobile-side-panel ${i?"open":""}`,children:[e.jsxs("div",{className:"mobile-side-panel-header",children:[e.jsx("h3",{children:"Menu"}),e.jsx("button",{className:"close-button",onClick:l,children:e.jsx(JR,{})})]}),e.jsx("nav",{children:d.map((h,m)=>e.jsxs("div",{className:"page-section",children:[e.jsx("div",{className:"page-title",children:h.title}),e.jsx("ul",{className:"sub-page-list",children:h.links.map(f=>{const g=f.icon;return e.jsx("li",{children:e.jsxs(Ss,{to:f.path,className:o.pathname===f.path?"active":"",onClick:l,children:[g&&e.jsx(g,{})," ",f.name]})},f.path)})})]},m))}),e.jsxs("div",{className:"user-info-section",children:[e.jsxs("span",{className:"user-name",children:["Welcome, ",t.name]}),e.jsxs("button",{onClick:a,className:"logout-button-sidebar",children:[e.jsx(bw,{})," Logout"]})]})]})]})},jh={"/dashboard":{label:"Dashboard"},"/dashboard/staff":{label:"Staff Management",parent:"/dashboard"},"/dashboard/staff/add":{label:"Add Staff",parent:"/dashboard/staff"},"/dashboard/staff/edit":{label:"Edit Staff",parent:"/dashboard/staff"},"/dashboard/roles":{label:"Role Management",parent:"/dashboard"},"/dashboard/patients":{label:"All Patients",parent:"/dashboard"},"/dashboard/patients/add":{label:"Add Patient",parent:"/dashboard"},"/dashboard/search-patient":{label:"Search Patient",parent:"/dashboard"},"/dashboard/clinic-hub":{label:"Clinic Hub",parent:"/dashboard"},"/dashboard/inventory":{label:"Inventory",parent:"/dashboard"},"/dashboard/inventory/add":{label:"Add Drug",parent:"/dashboard/inventory"},"/dashboard/inventory/edit":{label:"Edit Drug",parent:"/dashboard/inventory"},"/dashboard/purchase":{label:"Purchase",parent:"/dashboard"},"/dashboard/distributors":{label:"Distributors",parent:"/dashboard"},"/dashboard/patient-debts":{label:"Patient Debts",parent:"/dashboard"},"/dashboard/add-order":{label:"Add Pharmacy Order",parent:"/dashboard"},"/dashboard/edit-pharmacy-order":{label:"Edit Pharmacy Order",parent:"/dashboard"},"/dashboard/pharmacy-billing":{label:"Pharmacy Billing",parent:"/dashboard"},"/dashboard/analysis":{label:"Analysis",parent:"/dashboard"},"/dashboard/settings":{label:"Settings",parent:"/dashboard"},"/dashboard/search-patient-records":{label:"Search Records",parent:"/dashboard"},"/dashboard/queue":{label:"Queue",parent:"/dashboard"},"/dashboard/add-patient":{label:"Add Patient",parent:"/dashboard"},"/dashboard/subscriptions":{label:"Subscriptions",parent:"/dashboard"},"/dashboard/subscriptions/add":{label:"Add Plan",parent:"/dashboard/subscriptions"},"/dashboard/subscriptions/edit":{label:"Edit Plan",parent:"/dashboard/subscriptions"},"/dashboard/clinic-subscriptions":{label:"Clinic Subscriptions",parent:"/dashboard"},"/dashboard/clinic-subscriptions/add":{label:"Add Plan",parent:"/dashboard/clinic-subscriptions"},"/dashboard/clinic-subscriptions/edit":{label:"Edit Plan",parent:"/dashboard/clinic-subscriptions"},"/dashboard/users":{label:"User Management",parent:"/dashboard"},"/dashboard/lab-billing":{label:"Lab Billing",parent:"/dashboard"},"/lab-inventory":{label:"Lab Inventory",parent:"/dashboard"},"/lab/search-report":{label:"Search Lab Report",parent:"/dashboard"},"/create-lab-order":{label:"Create Lab Order",parent:"/dashboard"},"/enter-lab-report":{label:"Enter Lab Report",parent:"/dashboard"},"/view-lab-report":{label:"View Lab Report",parent:"/dashboard"},"/billing":{label:"Billing",parent:"/dashboard"},"/dashboard/doctor-billing":{label:"Doctor Billing",parent:"/dashboard"},"/create-custom-bill":{label:"Create Custom Bill",parent:"/dashboard"},"/patient":{label:"Patient",parent:"/dashboard"},"/edit-complaint":{label:"Edit Complaint",parent:"/dashboard"},"/start-subscription":{label:"Start Subscription",parent:"/dashboard"},"/manage-admission":{label:"Manage Admission",parent:"/dashboard"},"/custom-tables":{label:"Custom Tables",parent:"/dashboard"},"/dashboards":{label:"Dashboards",parent:"/dashboard"},"/dashboards/new":{label:"New Dashboard",parent:"/dashboards"},"/refill-reminders":{label:"Refill Reminders",parent:"/dashboard"},"/start-clinic-subscription":{label:"Start Clinic Subscription",parent:"/dashboard"},"/dashboard/all-patients":{label:"All Patients",parent:"/dashboard"}},XR=t=>{if(jh[t])return jh[t].label;const a=t.split("/"),n=a[a.length-1],i=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(n),l=/^\d+$/.test(n);if(i||l){const c=a.slice(0,-1).join("/");if(jh[c])return jh[c].label}return n.split("-").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" ")},ZR=()=>{const t=Qa(),a=x.useMemo(()=>{const n=t.pathname.split("/").filter(c=>c!=="");if(n.length===0||n[0]==="login"||n[0]==="registration")return[];const i=[];let l="";return n.forEach((c,o)=>{if(l+=`/${c}`,o===0&&c==="dashboard")i.push({label:"Home",path:"/dashboard",isLast:o===n.length-1});else if(c!=="dashboard"){const d=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(c),h=/^\d+$/.test(c);let m=XR(l);d?m=`#${c.substring(0,8)}`:h&&(m=`#${c}`),i.push({label:m,path:l,isLast:o===n.length-1})}}),n[0]!=="dashboard"&&i.length>0&&i.unshift({label:"Home",path:"/dashboard",isLast:!1}),i},[t.pathname]);return a.length===0?null:e.jsx("nav",{className:"breadcrumb-nav","aria-label":"Breadcrumb",children:e.jsx("ol",{className:"breadcrumb-list",children:a.map((n,i)=>e.jsxs("li",{className:"breadcrumb-item",children:[i>0&&e.jsx(jl,{className:"breadcrumb-separator",size:14}),n.isLast?e.jsxs("span",{className:"breadcrumb-current","aria-current":"page",children:[i===0&&e.jsx(Ih,{size:14,className:"breadcrumb-home-icon"}),n.label]}):e.jsxs(Ss,{to:n.path,className:"breadcrumb-link",children:[i===0&&e.jsx(Ih,{size:14,className:"breadcrumb-home-icon"}),n.label]})]},n.path))})})},eO=({})=>{const t=ft(),[a]=x.useState(!1),[n,i]=x.useState(null),[l,c]=x.useState(null);return x.useEffect(()=>{if(l){const o=setTimeout(()=>c(null),5e3);return()=>clearTimeout(o)}},[l]),a?e.jsxs("div",{className:"admin-panel-container",children:[e.jsx("div",{className:"admin-nav-bar",children:[1,2,3,4,5,6].map(o=>e.jsx(U,{width:100,height:40,style:{borderRadius:"8px",margin:"0 8px"}},o))}),e.jsx("div",{className:"admin-content-section",style:{padding:"20px"},children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(U,{width:300,height:32}),e.jsx(U,{width:150,height:40,style:{borderRadius:"8px"}})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[1,2,3].map(o=>e.jsxs("div",{className:"glass-card",style:{height:"200px",display:"flex",flexDirection:"column",gap:"15px",padding:"20px"},children:[e.jsx(U,{width:"60%",height:24}),e.jsx(U,{width:"100%",height:100})]},o))})]})})]}):e.jsxs("div",{className:"admin-panel-container",children:[" ",l&&e.jsxs("div",{className:`alert-box ${l.type==="success"?"alert-box-success":"alert-box-error"} fixed top-4 right-4 z-[100]`,role:"alert",children:[e.jsx("div",{className:"alert-box-icon",children:l.type==="success"?e.jsx(ka,{size:18}):e.jsx(Nn,{size:18})}),e.jsx("div",{className:"alert-box-content",children:e.jsx("span",{children:l.message})}),e.jsx("button",{onClick:()=>c(null),className:"alert-box-close",children:e.jsx(St,{size:16})})]}),n&&e.jsxs("div",{className:"alert-box alert-box-error mb-4",role:"alert",children:[" ",e.jsx("div",{className:"alert-box-icon",children:e.jsx(Nn,{size:18})}),e.jsx("div",{className:"alert-box-content",children:e.jsx("span",{className:"block sm:inline flex-1",children:n})}),e.jsx("button",{onClick:()=>i(null),className:"alert-box-close",children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"admin-nav-bar",children:[" ",e.jsxs("button",{onClick:()=>t("."),className:"admin-nav-button",title:"Home",children:[e.jsx(Ih,{})," "]}),e.jsxs("button",{onClick:()=>t("/dashboard/clinic-hub"),className:"admin-nav-button",children:[e.jsx(_1,{})," Clinic"]}),e.jsxs("button",{onClick:()=>t("/dashboard/inventory"),className:"admin-nav-button",children:[e.jsx(kr,{})," Inventory"]}),e.jsxs("button",{onClick:()=>t("/dashboard/analysis"),className:"admin-nav-button",children:[e.jsx(ug,{})," Analysis"]}),e.jsx("button",{onClick:()=>t("/lab-inventory"),className:"admin-nav-button hidden-button",children:"Lab Inventory"}),e.jsxs("button",{onClick:()=>t("/dashboard/subscriptions"),className:"admin-nav-button hidden-button",children:[e.jsx(Rh,{})," Subscriptions"]}),e.jsxs("button",{onClick:()=>t("/dashboard/distributors"),className:"admin-nav-button",children:[e.jsx(C1,{})," Distributors"]}),e.jsx("button",{onClick:()=>t("/refill-reminders"),className:"admin-nav-button",children:"Refills"}),e.jsxs("button",{onClick:()=>t("/create-lab-order"),className:"admin-nav-button",children:[e.jsx(ug,{})," Labs"]}),e.jsxs("button",{onClick:()=>t("/create-custom-bill"),className:"admin-nav-button",children:[e.jsx(_s,{})," Custom Bill"]}),e.jsxs("button",{onClick:()=>t("patients"),className:"admin-nav-button",children:[e.jsx(Vo,{})," Patients"]}),e.jsxs("button",{onClick:()=>t("patient-debts"),className:"admin-nav-button",children:[e.jsx(Rh,{})," Debts"]}),e.jsxs("button",{onClick:()=>t("search-patient"),className:"admin-nav-button",children:[e.jsx(fn,{})," Search"]})]}),e.jsx("div",{className:"admin-content-section",children:e.jsx(iC,{})})]})},tO="_container_15l0t_5",nO="_visualContainer_15l0t_31",aO="_brandTitle_15l0t_49",sO="_searchBar_15l0t_105",iO="_searchIconWrapper_15l0t_153",rO="_searchIcon_15l0t_153",lO="_placeholderText_15l0t_177",oO="_shortcutHint_15l0t_197",cO="_key_15l0t_213",uO="_plus_15l0t_237",dO="_micButtonWrapper_15l0t_247",hO="_micIcon_15l0t_295",mO="_newlyRegisteredSection_15l0t_491",pO="_recentList_15l0t_509",fO="_recentPatientPill_15l0t_523",gO="_recentNameContainer_15l0t_549",xO="_recentInfo_15l0t_561",yO="_newlyRegisteredLabel_15l0t_599",bO="_recentName_15l0t_549",jO="_recentToken_15l0t_763",yn={container:tO,visualContainer:nO,brandTitle:aO,searchBar:sO,searchIconWrapper:iO,searchIcon:rO,placeholderText:lO,shortcutHint:oO,key:cO,plus:uO,micButtonWrapper:dO,micIcon:hO,newlyRegisteredSection:mO,recentList:pO,recentPatientPill:fO,recentNameContainer:gO,recentInfo:xO,newlyRegisteredLabel:yO,recentName:bO,recentToken:jO},vw="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",vO={apiKey:vw},NO=()=>{const{openCommandBar:t,isOpen:a,setPreFilledQuery:n}=qo(),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState([]),[m,f]=x.useState(!0),g=ft(),y=b=>{b.stopPropagation(),l(!0)};return x.useEffect(()=>{c&&(l(!1),n&&n(c),t(),o(null))},[c,t,n]),x.useEffect(()=>{(async()=>{try{const v=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),w=await Z(`/api/patients?${v.toString()}`);if(w.ok){const S=await w.json();h(S.patients||[])}}catch(v){console.error("Error fetching recent patients:",v)}finally{f(!1)}})()},[]),e.jsxs("div",{className:yn.container,children:[e.jsxs("div",{className:yn.visualContainer,children:[e.jsx("h1",{className:yn.brandTitle,children:"Newtons Ai"}),!a&&e.jsxs("div",{className:yn.searchBar,onClick:()=>t(),children:[e.jsx("div",{className:yn.searchIconWrapper,children:e.jsx(fn,{className:yn.searchIcon})}),e.jsx("span",{className:yn.placeholderText,children:"Search or Ask AI..."}),e.jsx("div",{className:yn.micButtonWrapper,onClick:y,children:e.jsx(Ru,{className:yn.micIcon})}),e.jsxs("div",{className:yn.shortcutHint,children:[e.jsx("span",{className:yn.key,children:"Ctrl"}),e.jsx("span",{className:yn.plus,children:"+"}),e.jsx("span",{className:yn.key,children:"K"})]})]}),!a&&(m||d.length>0)&&e.jsxs("div",{className:yn.newlyRegisteredSection,children:[e.jsx("div",{className:yn.newlyRegisteredLabel,children:"Newly Registered"}),e.jsx("div",{className:yn.recentList,children:m?[1,2,3,4,5].map(b=>e.jsxs("div",{className:yn.recentPatientPill,style:{cursor:"default"},children:[e.jsxs("div",{className:yn.recentNameContainer,children:[e.jsx(U,{width:100,height:18}),e.jsx(U,{width:30,height:20})]}),e.jsx("div",{className:yn.recentInfo,children:e.jsx(U,{width:80,height:14})})]},b)):d.map(b=>e.jsxs("div",{className:yn.recentPatientPill,onClick:()=>g(`/dashboard/edit-complaint/patient/${b.id}`),children:[e.jsxs("div",{className:yn.recentNameContainer,children:[e.jsx("span",{className:yn.recentName,children:b.name||"New Patient"}),e.jsxs("span",{className:yn.recentToken,children:["#",b.token]})]}),e.jsxs("div",{className:yn.recentInfo,children:[b.age?`${b.age} yrs`:"",b.age&&b.gender?" / ":"",b.gender||""]})]},b.id))})]})]}),i&&vw&&e.jsx(um,{options:vO,children:e.jsx(dm,{onClose:()=>l(!1),patientData:{id:null,token:null,name:"New Case",age:null,gender:null},tokenNumber:null,onAiSummaryChange:o})})]})},mr=t=>{if(!t)return"N/A";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},wO=t=>{if(!t)return"Unknown Date";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},No=({title:t,icon:a,items:n,renderItemContent:i,isLoading:l,noDataText:c})=>{const o=x.useMemo(()=>{const d={};n.forEach(m=>{if(isNaN(m.date.getTime())){d["Unknown Date"]||(d["Unknown Date"]=[]),d["Unknown Date"].push(m);return}const f=wO(m.originalDateString);d[f]||(d[f]=[]),d[f].push(m)});const h=Object.keys(d);return h.sort((m,f)=>{if(m==="Unknown Date")return 1;if(f==="Unknown Date")return-1;try{const g=v=>{const w=v.split(" ");if(w.length===3){const _=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].indexOf(w[1]);if(_!==-1)return new Date(parseInt(w[2]),_,parseInt(w[0]))}return new Date(v)},y=g(m),b=g(f);if(!isNaN(y.getTime())&&!isNaN(b.getTime()))return b.getTime()-y.getTime()}catch(g){console.error("Error parsing date for sorting:",g)}return f.localeCompare(m)}),h.map(m=>({date:m,items:d[m]}))},[n]);return e.jsxs("div",{className:"dcp-group-card",children:[e.jsxs("h4",{className:"dcp-group-header",children:[a&&e.jsx(a,{size:14,className:"dcp-group-icon"}),t]}),e.jsxs("div",{className:"dcp-group-content",children:[l&&e.jsx("div",{className:"dcp-history-items",children:[1,2].map(d=>e.jsxs("div",{className:"dcp-history-item",style:{border:"none"},children:[e.jsx(U,{width:"60%",height:16,style:{marginBottom:"8px"}}),e.jsx(U,{width:"30%",height:12})]},d))}),!l&&n.length===0&&e.jsx("p",{className:"dcp-history-empty",children:c}),!l&&n.length>0&&e.jsx("div",{children:o.map(({date:d,items:h})=>e.jsxs("div",{className:"dcp-date-group",children:[e.jsx("h5",{className:"dcp-date-label",children:d}),e.jsx("div",{className:"dcp-date-items",children:h.map((m,f)=>e.jsx("div",{className:"dcp-history-item",children:i(m)},`${m.type}-${m.originalDateString}-${f}`))})]},d))})]})]})},If=()=>{var V,re;const[t,a]=x.useState({currentPatient:null,nextPatient:null,waitingCount:0}),[n,i]=x.useState(!0),[l,c]=x.useState(null),[o,d]=x.useState(null),[h,m]=x.useState(null),[f,g]=x.useState(null),[y,b]=x.useState({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),[v,w]=x.useState(!1),[S,_]=x.useState(null),{patientId:E}=Fn(),D=ft(),O=x.useCallback(async B=>{g(null),d(null),m(null),w(!0),_(null),b({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]});try{const k=await Z(`/api/patients/${B}`);if(!k.ok)throw new Error(`Patient details fetch failed (${k.status})`);const Ne=await k.json();d(Ne);const Ae=await Z(`/api/queue/patient/${B}/latest`);if(!Ae.ok&&Ae.status!==404)throw new Error(`Queue entry fetch failed (${Ae.status})`);if(Ae.ok){const T=await Ae.json();m(T)}await M(B)}catch(k){console.error("Error fetching specific patient data:",k),g(k.message||"Failed to load patient data."),_(k.message||"Failed to load patient history.")}finally{w(!1)}},[]),M=x.useCallback(async B=>{w(!0),_(null);try{const[k,Ne,Ae,T]=await Promise.all([Z(`/api/queue/patient/${B}/complaints`),Z(`/api/lab/patient/${B}`),Z(`/api/lab/orders/patient/${B}?status=pending`),Z(`/api/pharmacy-orders/patient/${B}`)]),Ce=k.ok?await k.json():[],Ue=Ne.ok?await Ne.json():[],Pe=Ae.ok?await Ae.json():[],de=T.ok?await T.json():[];b({pastComplaints:Ce||[],labReports:Ue||[],pendingLabOrders:Pe||[],pharmacyOrders:de||[]})}catch(k){console.error("Error fetching patient history:",k),_(k.message||"Failed to load patient history."),b({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]})}finally{w(!1)}},[]),A=x.useCallback(async()=>{i(!0),c(null);try{const B=await Z("/api/queue/doctor");if(!B.ok){const Ne=await B.text();throw new Error(`API Error (${B.status}): ${Ne||B.statusText}`)}const k=await B.json();if(k===null||typeof k!="object"||typeof k.waitingCount!="number")throw console.error("Invalid queue data format:",k),new Error("Invalid queue data format received");a({currentPatient:k.currentPatient||null,nextPatient:k.nextPatient||null,waitingCount:k.waitingCount})}catch(B){console.error("Error fetching queue data:",B),c(B.message||"Failed to fetch queue data.")}finally{i(!1)}},[]);x.useEffect(()=>{let B=null;return E?(O(E),a({currentPatient:null,nextPatient:null,waitingCount:0})):(A(),B=setInterval(A,1e4),d(null),m(null)),()=>{B&&clearInterval(B)}},[E,O,A]),x.useEffect(()=>{var B;!E&&((B=t.currentPatient)!=null&&B.patientId)?M(t.currentPatient.patientId):!E&&!t.currentPatient&&(b({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),w(!1),_(null))},[E,(V=t.currentPatient)==null?void 0:V.patientId,M]);const P=((re=t.currentPatient)==null?void 0:re.patientId)||(E?parseInt(E,10):null),Q=x.useMemo(()=>{if(!P||!y.pastComplaints)return[];const B=y.pastComplaints.map(k=>({date:new Date(k.createdAt),type:"Complaint",data:k,originalDateString:k.createdAt})).filter(k=>!isNaN(k.date.getTime()));return B.sort((k,Ne)=>Ne.date.getTime()-k.date.getTime()),B},[P,y.pastComplaints]),G=x.useMemo(()=>{if(!P)return[];const B=[];return(y.pendingLabOrders??[]).forEach(k=>{const Ne=new Date(k.createdAt);isNaN(Ne.getTime())||B.push({date:Ne,type:"Lab Order (Pending)",data:k,originalDateString:k.createdAt})}),(y.labReports??[]).forEach(k=>{const Ne=k.reportCreatedAt?new Date(k.reportCreatedAt):null;Ne&&!isNaN(Ne.getTime())&&B.push({date:Ne,type:"Lab Report",data:k,originalDateString:k.reportCreatedAt})}),B.sort((k,Ne)=>Ne.date.getTime()-k.date.getTime()),B},[P,y.pendingLabOrders,y.labReports]),C=x.useMemo(()=>{if(!P||!y.pharmacyOrders)return[];const B=y.pharmacyOrders.map(k=>({date:new Date(k.date),type:"Pharmacy Order",data:k,originalDateString:k.date})).filter(k=>!isNaN(k.date.getTime()));return B.sort((k,Ne)=>Ne.date.getTime()-k.date.getTime()),B},[P,y.pharmacyOrders]),R=async()=>{i(!0),c(null);try{await Z("/api/queue/doctor/next",{method:"POST"}),await A()}catch(B){console.error("Error calling next patient:",B),c(B.message||"Failed to call next patient.")}finally{i(!1)}},z=async()=>{if(!(!t.currentPatient||E)){i(!0),c(null);try{await Z(`/api/queue/doctor/complete/${t.currentPatient._id}`,{method:"POST"}),await A(),b({pastComplaints:[],labReports:[],pendingLabOrders:[],pharmacyOrders:[]}),w(!1),_(null)}catch(B){console.error("Error completing consultation:",B),c(B.message||"Failed to complete consultation.")}finally{i(!1)}}},F=B=>{switch(B){case"waiting":return"Waiting";case"consulting":return"Consulting";case"seen":return"Seen";case"cancelled":return"Cancelled";default:return B}},[J,H]=x.useState("info");let I=null;if(t.currentPatient){const B=k=>{switch(k){case"consulting":return"dcp-status-consulting";case"waiting":return"dcp-status-waiting";case"seen":return"dcp-status-seen";case"cancelled":return"dcp-status-cancelled";default:return""}};I=e.jsx("div",{className:"dcp-card dcp-card-teal",children:e.jsxs("div",{className:"dcp-card-content",children:[e.jsxs("div",{className:"dcp-mobile-tabs",children:[e.jsx("button",{className:`dcp-mobile-tab ${J==="info"?"active":""}`,onClick:()=>H("info"),children:"Patient Details"}),e.jsx("button",{className:`dcp-mobile-tab ${J==="history"?"active":""}`,onClick:()=>H("history"),children:"History"})]}),e.jsxs("div",{className:"dcp-flex-split",children:[e.jsxs("div",{className:`dcp-flex-half dcp-tab-info ${J==="info"?"":"hidden"}`,children:[e.jsxs("div",{className:"dcp-section-header dcp-section-header-teal",children:["NOW SEEING",e.jsxs("span",{className:"dcp-live-badge",children:[e.jsx("span",{className:"dcp-live-dot"}),"Live"]})]}),e.jsxs("div",{className:"dcp-patient-main",children:[e.jsxs("div",{children:[e.jsx("div",{className:"dcp-patient-name",children:t.currentPatient.name}),e.jsxs("div",{className:"dcp-patient-meta",children:[e.jsxs("span",{className:"dcp-patient-badge",children:[t.currentPatient.age," Yrs"]}),e.jsx("span",{className:"dcp-patient-badge",children:t.currentPatient.gender})]})]}),e.jsxs("div",{className:"dcp-patient-token",children:[e.jsxs("div",{className:"dcp-token-number",children:["#",t.currentPatient.token]}),e.jsx("span",{className:`dcp-status ${B(t.currentPatient.status)}`,children:F(t.currentPatient.status)})]})]}),t.currentPatient.case_summary&&e.jsxs("div",{className:"dcp-ai-summary",children:[e.jsx("div",{className:"dcp-ai-label",children:" AI Brief"}),e.jsx("p",{className:"dcp-ai-text",children:t.currentPatient.case_summary})]}),e.jsxs("div",{className:"dcp-actions",children:[e.jsxs("button",{onClick:()=>{var Ne;const k=(Ne=t.currentPatient)==null?void 0:Ne._id;k&&D(`/dashboard/edit-complaint/${k}`)},disabled:n||!t.currentPatient||t.currentPatient.status!=="consulting",className:"dcp-btn dcp-btn-primary",children:[e.jsx(tx,{size:16})," Open Consultation"]}),e.jsxs("button",{onClick:z,disabled:n||!t.currentPatient||t.currentPatient.status!=="consulting",className:"dcp-btn dcp-btn-green",children:[e.jsx(yC,{size:16})," Complete"]})]})]}),e.jsxs("div",{className:`dcp-flex-half dcp-history-section dcp-tab-history ${J==="history"?"":"hidden"} dcp-desktop-only`,children:[e.jsxs("div",{className:"dcp-history-header",children:[e.jsx("span",{className:"dcp-history-title",children:"History & Context"}),v&&e.jsx(U,{width:60,height:14})]}),S&&e.jsx("div",{className:"dcp-error",children:S}),e.jsxs("div",{className:"dcp-history-scroll dcp-scrollbar",children:[e.jsx(No,{title:"Past Complaints",icon:_s,items:Q,isLoading:v,noDataText:"No past complaints.",renderItemContent:k=>e.jsxs("div",{children:[k.data.complaint,e.jsx("div",{className:"dcp-history-timestamp",children:mr(k.originalDateString)})]})}),e.jsx(No,{title:"Lab Reports & Orders",icon:Cs,items:G,isLoading:v,noDataText:"No lab history.",renderItemContent:k=>k.type==="Lab Order (Pending)"?e.jsxs("div",{children:[e.jsx("span",{className:"dcp-type-pending",children:"Pending Order"}),e.jsx("div",{children:k.data.tests.map(Ne=>Ne.name).join(", ")}),e.jsx("div",{className:"dcp-history-timestamp",children:mr(k.originalDateString)})]}):e.jsxs("div",{children:[e.jsxs("span",{className:"dcp-type-report",children:["Report: ",k.data.testName]}),e.jsxs("div",{style:{fontStyle:"italic"},children:['"',k.data.reportFindings.substring(0,50),k.data.reportFindings.length>50?"...":"",'"']}),e.jsx("div",{className:"dcp-history-timestamp",children:mr(k.originalDateString)})]})}),e.jsx(No,{title:"Medications",icon:xl,items:C,isLoading:v,noDataText:"No medication history.",renderItemContent:k=>e.jsxs("div",{children:[k.data.medications.map(Ne=>`${Ne.name} (${Ne.quantity})`).join(", "),e.jsxs("div",{className:"dcp-history-timestamp",children:[mr(k.originalDateString),"  ",e.jsx("span",{style:{textTransform:"capitalize"},children:k.data.status})]})]})}),Q.length===0&&G.length===0&&C.length===0&&!v&&e.jsx("div",{className:"dcp-empty-state",children:"No history records found for this patient."})]})]})]})]})})}return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"dcp-container",children:[e.jsxs("div",{className:"dcp-header-row",children:[e.jsx("button",{onClick:()=>D(-1),className:"dcp-back-btn",children:e.jsx(Et,{size:20})}),e.jsx("h1",{className:"dcp-title",children:"Doctor Consultation Panel"})]}),E?e.jsxs(e.Fragment,{children:[f&&e.jsx("div",{className:"dcp-error",children:f}),o&&e.jsx("div",{className:"dcp-card dcp-card-violet",children:e.jsxs("div",{className:"dcp-card-content",children:[e.jsxs("div",{className:"dcp-mobile-tabs",children:[e.jsx("button",{className:`dcp-mobile-tab ${J==="info"?"active":""}`,onClick:()=>H("info"),children:"Patient Record"}),e.jsx("button",{className:`dcp-mobile-tab ${J==="history"?"active":""}`,onClick:()=>H("history"),children:"History"})]}),e.jsxs("div",{className:"dcp-flex-split",children:[e.jsxs("div",{className:`dcp-flex-half dcp-tab-info ${J==="info"?"":"hidden"}`,children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("div",{className:"dcp-section-header dcp-section-header-violet",children:"Patient Record"}),e.jsxs("button",{onClick:()=>D("/dashboard/doctor"),className:"dcp-btn dcp-btn-outline",style:{padding:"4px 10px",fontSize:"0.75rem"},children:[e.jsx(Et,{size:12})," Back to Queue"]})]}),e.jsx("div",{className:"dcp-patient-name dcp-patient-name-gradient",children:o.name}),e.jsxs("div",{className:"dcp-patient-meta",style:{marginBottom:"12px"},children:[e.jsxs("span",{className:"dcp-patient-badge",children:[o.age||"N/A"," Yrs"]}),e.jsx("span",{className:"dcp-patient-badge",children:o.gender||"N/A"})]}),e.jsxs("div",{className:"dcp-activity-box",children:[e.jsx("div",{className:"dcp-activity-label",children:"Latest Activity"}),h?e.jsxs("div",{children:[e.jsxs("div",{className:"dcp-activity-content",children:[e.jsx("strong",{children:"Complaint:"})," ",h.complaint||e.jsx("span",{style:{color:"var(--dcp-text-muted)",fontStyle:"italic"},children:"None"})]}),e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("span",{className:`dcp-status ${h.status==="consulting"?"dcp-status-consulting":h.status==="seen"?"dcp-status-seen":h.status==="waiting"?"dcp-status-waiting":""}`,children:F(h.status)}),h.status==="consulting"&&h._id&&e.jsx("button",{onClick:()=>D(`/dashboard/edit-complaint/${h._id}`),className:"dcp-btn dcp-btn-primary",style:{marginLeft:"10px",padding:"4px 12px"},children:"Resume"})]}),h.case_summary&&e.jsxs("div",{className:"dcp-ai-summary",style:{marginTop:"10px"},children:[e.jsx("div",{className:"dcp-ai-label",children:" AI Summary"}),e.jsx("p",{className:"dcp-ai-text",children:h.case_summary})]})]}):e.jsx("p",{style:{color:"var(--dcp-text-muted)",fontStyle:"italic"},children:"No queue entry found for this patient today."})]})]}),e.jsxs("div",{className:`dcp-flex-half dcp-history-section dcp-tab-history ${J==="history"?"":"hidden"} dcp-desktop-only`,children:[e.jsxs("div",{className:"dcp-history-header",children:[e.jsx("span",{className:"dcp-history-title",children:"Patient History"}),v&&e.jsx(U,{width:60,height:14})]}),S&&e.jsx("div",{className:"dcp-error",children:S}),e.jsxs("div",{className:"dcp-history-scroll dcp-scrollbar",children:[e.jsx(No,{title:"Past Complaints",icon:_s,items:Q,isLoading:v,noDataText:"No past complaints.",renderItemContent:B=>e.jsxs("div",{children:[B.data.complaint,e.jsx("div",{className:"dcp-history-timestamp",children:mr(B.originalDateString)})]})}),e.jsx(No,{title:"Lab Reports",icon:Cs,items:G,isLoading:v,noDataText:"No lab history.",renderItemContent:B=>B.type==="Lab Order (Pending)"?e.jsxs("div",{children:[e.jsx("span",{className:"dcp-type-pending",children:"Pending Order"}),e.jsx("div",{children:B.data.tests.map(k=>k.name).join(", ")}),e.jsx("div",{className:"dcp-history-timestamp",children:mr(B.originalDateString)})]}):e.jsxs("div",{children:[e.jsxs("span",{className:"dcp-type-report",children:["Report: ",B.data.testName]}),e.jsxs("div",{style:{fontStyle:"italic"},children:['"',B.data.reportFindings.substring(0,50),B.data.reportFindings.length>50?"...":"",'"']}),e.jsx("div",{className:"dcp-history-timestamp",children:mr(B.originalDateString)})]})}),e.jsx(No,{title:"Medications",icon:xl,items:C,isLoading:v,noDataText:"No pharmacy history.",renderItemContent:B=>e.jsxs("div",{children:[B.data.medications.map(k=>`${k.name} (${k.quantity})`).join(", "),e.jsxs("div",{className:"dcp-history-timestamp",children:[mr(B.originalDateString),"  ",e.jsx("span",{style:{textTransform:"capitalize"},children:B.data.status})]})]})}),Q.length===0&&G.length===0&&C.length===0&&!v&&e.jsx("div",{className:"dcp-empty-state",children:"No history records found."})]})]})]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"dcp-action-bar",children:[e.jsxs("button",{onClick:()=>D("/dashboard/add-patient"),className:"dcp-btn dcp-btn-green",children:[e.jsx(Xh,{size:16})," Add Patient"]}),e.jsx("button",{onClick:()=>D("/search-patient"),className:"dcp-btn dcp-btn-primary",children:"Search Patient"})]}),l&&e.jsx("div",{className:"dcp-error",children:l}),n&&!t.currentPatient&&e.jsxs("div",{className:"dcp-card",style:{padding:"2rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(U,{width:"40%",height:32}),e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})]}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx(U,{width:"60%",height:24}),e.jsx(U,{width:"40%",height:16,style:{marginTop:"8px"}})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsx(U,{width:"100%",height:80,style:{borderRadius:"12px"}})}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"2rem"},children:[e.jsx(U,{width:180,height:40}),e.jsx(U,{width:120,height:40})]})]}),e.jsx("div",{style:{marginBottom:"16px"},children:I||e.jsx("div",{className:"dcp-empty-state",children:"No patient currently being seen. Use 'Call Next' or search for a patient record."})}),e.jsxs("div",{className:"dcp-next-section",children:[e.jsx("div",{className:"dcp-next-title",children:"NEXT IN QUEUE"}),t.nextPatient?e.jsxs("div",{className:"dcp-next-card",children:[e.jsxs("div",{className:"dcp-next-info",children:[e.jsxs("span",{className:"dcp-next-token",children:["Token #",t.nextPatient.token]}),e.jsx("span",{className:`dcp-status ${t.nextPatient.status==="waiting"?"dcp-status-waiting":""}`,children:F(t.nextPatient.status)})]}),e.jsx("div",{className:"dcp-next-name",children:t.nextPatient.name}),e.jsxs("div",{className:"dcp-next-meta",children:["Age: ",t.nextPatient.age," | ",t.nextPatient.gender]}),(t.nextPatient.complaint||t.nextPatient.case_summary)&&e.jsxs("div",{className:"dcp-next-complaint",children:[t.nextPatient.complaint&&e.jsxs("div",{children:[e.jsx("strong",{children:"Complaint:"})," ",t.nextPatient.complaint]}),t.nextPatient.case_summary&&e.jsxs("div",{className:"dcp-ai-summary",style:{marginTop:"8px"},children:[e.jsx("div",{className:"dcp-ai-label",children:" AI Summary"}),e.jsx("p",{className:"dcp-ai-text",children:t.nextPatient.case_summary})]})]})]}):e.jsx("div",{className:"dcp-empty-state",children:"No patient waiting next in the queue."})]}),e.jsxs("div",{className:"dcp-bottom-bar",children:[e.jsx("button",{onClick:R,disabled:n||!t.nextPatient||!!t.currentPatient,className:"dcp-btn dcp-btn-teal",children:"Call Next Patient"}),e.jsxs("div",{className:"dcp-waiting-count",children:[t.waitingCount," patients waiting"]})]})]})]})})},SO="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",kO={apiKey:SO},gu=()=>{const[t,a]=x.useState(""),[n,i]=x.useState([]),[l,c]=x.useState(!1),[o,d]=x.useState(null),[h,m]=x.useState(!1),[f,g]=x.useState(null),y=x.useRef(null),[b,v]=x.useState(!1),[w,S]=x.useState(!1),[_,E]=x.useState(null),[D,O]=x.useState(null),[M,A]=x.useState([]),[P,Q]=x.useState(!0),[G,C]=x.useState(!1);us();const R=ft(),z=Qa(),F=cx({settings:{},staffList:[]}),{selectedImage:J,handleImageSelect:H,clearImage:I}=F,V=x.useRef(null),re=ee=>{var fe;const oe=(fe=ee.target.files)==null?void 0:fe[0];oe&&H(oe)};x.useEffect(()=>{F.chatHistory.length>0&&G&&F.isProcessing},[F.chatHistory.length]),x.useEffect(()=>{(async()=>{Q(!0);try{const oe=new URLSearchParams({page:"1",limit:"5",sortBy:"createdAt",sortOrder:"desc"}),fe=await Z(`/api/patients?${oe.toString()}`);if(fe.ok){const ge=await fe.json();A(ge.patients||[])}}catch(oe){console.error("Error fetching recent patients:",oe)}finally{Q(!1)}})()},[]),x.useEffect(()=>{F.setChatQuery(t)},[t]);const B=x.useCallback(async ee=>{if(!(ee||t).trim()){g("Please enter complaint details.");return}m(!0),g(null),ee&&ee!==F.chatQuery&&F.setChatQuery(ee);try{F.handleSendMessage(),a("")}catch(fe){console.error("AI Error:",fe),g("AI failed to process. Try again."),m(!1)}},[t,F]);x.useEffect(()=>{!F.isProcessing&&h&&m(!1)},[F.isProcessing,h]),x.useEffect(()=>{const ee=y.current;ee&&(ee.style.height="auto",ee.style.height=`${ee.scrollHeight}px`);const fe=new URLSearchParams(z.search).get("caseDetails");if(fe){const ge=decodeURIComponent(fe);ge!==t&&(a(ge),v(!0))}},[z.search,t]),x.useEffect(()=>{b&&t.trim()&&(R(z.pathname,{replace:!0}),B(t),v(!1))},[b,t,B,R,z.pathname]),x.useEffect(()=>{const ee=y.current;ee&&(ee.style.height="auto",ee.style.height=`${ee.scrollHeight}px`)},[t]),x.useEffect(()=>{_&&(a(_),S(!1),F.setChatQuery(_),setTimeout(()=>F.handleSendMessage(),0),E(null))},[_,F]);const k=()=>{O({id:null,token:null,name:"New Case",age:null,gender:null}),S(!0)},Ne=x.useMemo(()=>$u(async ee=>{const oe=ee.trim(),fe=/^\d+$/.test(oe),ge=oe.split(/\s+/).length;if(oe.length<2||fe&&oe.length>10||!fe&&ge>2){i([]),c(!1),d(null);return}c(!0),d(null);try{const q=new URLSearchParams({search:encodeURIComponent(ee),page:"1",limit:"20",sortBy:"name",sortOrder:"asc"}),W=await Z(`/api/patients?${q.toString()}`);if(!W.ok){const ie=await W.text();throw new Error(`API Error (${W.status}): ${ie||W.statusText}`)}const Y=await W.json();i(Y.patients)}catch(q){console.error("Error searching patients:",q),d(q.message||"Failed to search patients."),i([])}finally{c(!1)}},300),[]),Ae=ee=>{const oe=ee.target.value;a(oe);const fe=oe.trim(),ge=/^\d+$/.test(fe),q=fe.split(/\s+/).length;fe.length>=2&&!(ge&&fe.length>10||!ge&&q>2)?c(!0):(c(!1),i([])),Ne(oe)},T=ee=>{ee.key==="Enter"&&!ee.shiftKey&&(ee.preventDefault(),t.trim()&&!l&&Se())},Ce=async ee=>{ee&&ee.id&&R(`/dashboard/edit-complaint/patient/${ee.id}`)},Ue=[{icon:"",title:"Example: Fever & Cold",description:"Rajesh Kumar, 35 year old male, fever since 2 days, cold, body pain, no cough",text:"Rajesh Kumar, 35 year old male, fever since 2 days, cold, body pain, no cough"},{icon:"",title:"Example: Stomach Ache",description:"Priya Sharma, 28 year old female, stomach pain after eating, acidity, bloating since 3 days",text:"Priya Sharma, 28 year old female, stomach pain after eating, acidity, bloating since 3 days"}],Pe=ee=>{a(ee),setTimeout(()=>{F.handleSendMessage(ee),a(""),i([])},50)},de=()=>{a(""),i([]),F.refreshChat()},Se=()=>{!t.trim()&&!J||(Ne.cancel(),F.handleSendMessage(t),a(""),i([]))};return e.jsxs("div",{className:"patient-search-page-container",children:[e.jsxs("div",{className:"patient-search-header",children:[e.jsx("button",{onClick:()=>R("/dashboard/queue"),className:"patient-search-button patient-search-button-primary",children:"OPD Queue"}),e.jsx("button",{onClick:()=>R(-1),className:"patient-search-button patient-search-button-back",children:e.jsx(Et,{size:16})})]}),e.jsxs("div",{className:"patient-search-content-box",children:[o&&e.jsx("p",{className:"patient-search-error",children:o}),f&&e.jsx("p",{className:"patient-search-error",children:f}),P?e.jsxs("div",{className:"newly-registered-section",children:[e.jsx("div",{className:"recent-list",children:[1,2,3,4,5].map(ee=>e.jsxs("div",{className:"recent-patient-pill",style:{cursor:"default"},children:[e.jsxs("div",{className:"recent-name-container",children:[e.jsx(U,{width:100,height:18}),e.jsx(U,{width:30,height:14})]}),e.jsx("div",{className:"recent-info",children:e.jsx(U,{width:60,height:12})})]},ee))}),e.jsx("div",{className:"newly-registered-label",children:"NEWLY REGISTERED"})]}):M.length>0&&e.jsxs("div",{className:"newly-registered-section",children:[e.jsx("div",{className:"recent-list",children:M.map(ee=>e.jsxs("div",{className:"recent-patient-pill",onClick:()=>Ce(ee),children:[e.jsxs("div",{className:"recent-name-container",children:[e.jsx("span",{className:"recent-name",children:ee.name||"New Patient"}),e.jsxs("span",{className:"recent-token",children:["#",ee.token]})]}),e.jsxs("div",{className:"recent-info",children:[ee.age," yrs / ",ee.gender]})]},ee.id))}),e.jsx("div",{className:"newly-registered-label",children:"NEWLY REGISTERED"})]}),F.chatHistory.length===0&&n.length===0&&e.jsxs("div",{className:"example-cases-section",children:[e.jsxs("div",{className:"example-cases-header",children:[e.jsx("span",{className:"sparkles-icon",children:""}),e.jsx("h3",{children:"Try AI with Example Cases"})]}),e.jsx("div",{className:"example-cards-container",children:Ue.map((ee,oe)=>e.jsxs("div",{className:"example-case-card",onClick:()=>Pe(ee.text),children:[e.jsx("div",{className:"example-icon",children:ee.icon}),e.jsxs("div",{className:"example-content",children:[e.jsx("div",{className:"example-title",children:ee.title}),e.jsx("div",{className:"example-description",children:ee.description})]})]},oe))})]})]}),F.chatHistory.length>0&&!h&&e.jsxs("div",{className:`ai-chat-overlay ${G?"minimized":""}`,children:[e.jsxs("div",{className:"ai-chat-header",children:[e.jsx("span",{children:"AI Assistant"}),e.jsx("div",{className:"ai-chat-controls",children:e.jsx("button",{className:"icon-btn",onClick:()=>de(),title:"Clear Chat",children:e.jsx(St,{size:16})})})]}),e.jsxs("div",{className:"ai-chat-messages",children:[F.chatHistory.map((ee,oe)=>e.jsx("div",{className:`chat-bubble ${ee.role==="model"?"model":"user"}`,children:ee.role==="system"?e.jsx("i",{children:ee.text}):ee.text},oe)),F.isProcessing&&e.jsx("div",{className:"chat-bubble model",children:"Typing..."})]})]}),n.length>0&&!h&&e.jsxs("div",{className:"patient-search-results-overlay",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",paddingBottom:"0.5rem"},children:[e.jsx("div",{style:{fontWeight:600,color:"#64748b"},children:"Found Patients"}),e.jsx("button",{onClick:()=>i([]),style:{border:"none",background:"transparent",color:"#94a3b8",cursor:"pointer"},children:e.jsx(St,{size:14})})]}),n.map(ee=>e.jsxs("div",{onClick:()=>Ce(ee),className:"patient-search-result-item",children:[e.jsxs("div",{className:"patient-search-result-item-name-container",children:[e.jsxs("span",{className:"patient-search-result-item-token",children:["[#",ee.token,"]"]}),e.jsx("span",{className:"patient-search-result-item-name",children:ee.name})]}),e.jsxs("div",{className:"patient-search-result-item-details",children:[ee.age?`${ee.age} yrs`:"",ee.age&&ee.gender?" / ":"",ee.gender||"N/A"]})]},ee.id))]}),e.jsxs("div",{className:"sticky-chat-input-box",children:[e.jsxs("div",{className:"cmd-input-container",children:[J&&e.jsxs("div",{className:"cmd-image-preview",children:[e.jsx("img",{src:J,alt:"Selected"}),e.jsx("button",{className:"cmd-image-delete",onClick:I,children:e.jsx(St,{size:12})})]}),e.jsx("textarea",{ref:y,placeholder:"Search (Name/Token/Phone), Ask AI, or Enter New Case...",value:t,onChange:Ae,onKeyDown:T,className:"cmd-input",disabled:h||F.isProcessing,rows:1}),e.jsxs("div",{className:"cmd-controls-group",children:[e.jsx("input",{type:"file",ref:V,onChange:re,accept:"image/*",style:{display:"none"}}),e.jsx("button",{className:"cmd-icon-btn",onClick:()=>{var ee;return(ee=V.current)==null?void 0:ee.click()},title:"Attach Image",children:e.jsx(Kh,{})}),e.jsx("button",{className:"cmd-icon-btn",onClick:k,title:"Voice Input",children:e.jsx(Ru,{})}),(t.length>0||J)&&e.jsx("button",{className:"cmd-icon-btn send-btn",onClick:Se,title:"Send",children:e.jsx(Wh,{})})]})]}),w&&e.jsx(um,{options:kO,children:e.jsx(dm,{onClose:()=>S(!1),patientData:D,tokenNumber:null,onAiSummaryChange:E})})]})]})},Ex=()=>{const[t,a]=x.useState(""),[n,i]=x.useState([]),[l,c]=x.useState(!1),[o,d]=x.useState(!1),h=ft(),m=x.useRef(null);x.useEffect(()=>{const v=w=>{m.current&&!m.current.contains(w.target)&&d(!1)};return document.addEventListener("mousedown",v),()=>document.removeEventListener("mousedown",v)},[]);const f=x.useCallback(xw.debounce(async v=>{if(v.trim().length<2){i([]),c(!1);return}c(!0);try{const w=new URLSearchParams({search:encodeURIComponent(v),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),S=await Z(`/api/patients?${w.toString()}`);if(!S.ok)throw new Error("Failed to fetch patients");const _=await S.json();i(_.patients)}catch{i([])}finally{c(!1)}},400),[]);x.useEffect(()=>(t?(c(!0),f(t)):(i([]),f.cancel(),c(!1)),()=>f.cancel()),[t,f]);const g=v=>{h(`/patient/${encodeURIComponent(v.id)}/admission-billing`)},y=()=>{a(""),i([]),d(!1)},b=v=>v.slice(0,1).toUpperCase();return e.jsxs("div",{className:"ma-container",children:[e.jsxs("div",{className:"ma-header-section",children:[e.jsx("h1",{className:"ma-title",children:"Manage Admission"}),e.jsx("p",{className:"ma-subtitle",children:"Search for a patient to admit, discharge, or view billing details"})]}),e.jsxs("div",{className:"ma-search-wrapper",ref:m,children:[l?e.jsxs("div",{className:"ma-loading-spinner",children:[e.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid #e2e8f0",borderTopColor:"#3b82f6",borderRadius:"50%",animation:"spin 1s linear infinite"}}),e.jsx("style",{children:"@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }"})]}):e.jsx(fn,{className:"ma-search-icon",size:20}),e.jsx("input",{type:"text",value:t,onChange:v=>{a(v.target.value),d(!0)},onFocus:()=>d(!0),placeholder:"Search by Name, Phone, or Token...",className:"ma-search-input",autoFocus:!0}),t&&e.jsx("div",{className:"ma-clear-icon",onClick:y,children:e.jsx(St,{size:18})}),e.jsxs("div",{className:`ma-results-dropdown ${o&&(n.length>0||l)?"open":""}`,children:[n.map(v=>{const w=v.admission_date&&!v.discharge_date;return e.jsxs("div",{onClick:()=>g(v),className:"ma-result-item",children:[e.jsxs("div",{className:"ma-patient-info",children:[e.jsx("div",{className:"ma-avatar",children:b(v.name)}),e.jsxs("div",{className:"ma-patient-text",children:[e.jsxs("h4",{children:[v.name,e.jsxs("span",{className:"ma-patient-token",children:["#",v.token]})]}),e.jsxs("p",{className:"ma-patient-subtext",children:[v.phone||"No phone","  ",v.age?`${v.age} Y`:"","  ",v.gender||""]})]})]}),e.jsx("div",{className:`ma-badge ${w?"ma-badge-admitted":"ma-badge-discharged"}`,children:w?"ADMITTED":"NOT ADMITTED"})]},v.id)}),t.length>2&&!l&&n.length===0&&e.jsxs("div",{style:{padding:"2rem",textAlign:"center",color:"#64748b"},children:['No patients found matching "',t,'"']})]})]})]})},d0=[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"boolean",label:"Yes/No"},{value:"computed",label:"Computed (Formula)"}],Tx=({isOpen:t,onClose:a,entityType:n,entityLabel:i,currentConfig:l,onConfigUpdated:c})=>{const[o,d]=x.useState([]),[h,m]=x.useState(!1),[f,g]=x.useState(null),[y,b]=x.useState({key:"",label:"",type:"text",required:!1,formula:""});x.useEffect(()=>{t&&(d(l[n]||[]),g(null),b({key:"",label:"",type:"text",required:!1,formula:""}))},[t,l,n]);const v=E=>E.toLowerCase().replace(/[^a-z0-9]/g,"_").replace(/_+/g,"_"),w=()=>{var D;if(!y.label.trim()){g("Column label is required");return}if(y.type==="computed"&&!((D=y.formula)!=null&&D.trim())){g("Formula is required for computed columns");return}const E=v(y.label);if(o.some(O=>O.key===E)){g("A column with this name already exists");return}d([...o,{...y,key:E}]),b({key:"",label:"",type:"text",required:!1,formula:""}),g(null)},S=E=>{d(o.filter(D=>D.key!==E))},_=async()=>{m(!0),g(null);try{const E={...l,[n]:o};if(!(await Z("/api/clinics/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({custom_columns_config:E})})).ok)throw new Error("Failed to save custom columns");c(E),a()}catch(E){g(E.message||"Failed to save")}finally{m(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content manage-columns-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{children:["Manage Custom Columns - ",i]}),e.jsx("button",{onClick:a,className:"close-button",title:"Close",children:e.jsx(St,{size:24})})]}),f&&e.jsx("div",{className:"error-message",children:f}),e.jsxs("div",{className:"columns-list",children:[e.jsx("h4",{children:"Current Custom Columns"}),o.length===0?e.jsx("p",{className:"no-columns",children:"No custom columns defined yet."}):e.jsxs("table",{className:"columns-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Label"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Details"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.map(E=>{var D;return e.jsxs("tr",{children:[e.jsx("td",{children:E.label}),e.jsx("td",{children:((D=d0.find(O=>O.value===E.type))==null?void 0:D.label)||E.type}),e.jsx("td",{children:E.type==="computed"?e.jsx("code",{className:"computed-formula",children:E.formula}):E.required?"Required":"Optional"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>S(E.key),className:"remove-column-btn",title:"Remove Column",children:e.jsx(Jt,{size:16})})})]},E.key)})})]})]}),e.jsxs("div",{className:"add-column-section",children:[e.jsx("h4",{children:"Add New Column"}),e.jsxs("div",{className:"add-column-form",children:[e.jsx("input",{type:"text",placeholder:"Column Label (e.g., BMI)",value:y.label,onChange:E=>b({...y,label:E.target.value}),className:"column-input"}),e.jsx("select",{value:y.type,onChange:E=>b({...y,type:E.target.value}),className:"column-select",children:d0.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value))}),y.type==="computed"?e.jsx("input",{type:"text",placeholder:"Formula (e.g. weight / (height * height))",value:y.formula||"",onChange:E=>b({...y,formula:E.target.value}),className:"column-input",style:{flex:2}}):e.jsxs("label",{className:"required-checkbox",children:[e.jsx("input",{type:"checkbox",checked:y.required,onChange:E=>b({...y,required:E.target.checked})}),"Required"]}),e.jsxs("button",{onClick:w,className:"add-column-btn",children:[e.jsx(bn,{size:16})," Add"]})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:a,className:"cancel-btn",disabled:h,children:"Cancel"}),e.jsxs("button",{onClick:_,className:"save-btn",disabled:h,children:[e.jsx(ks,{size:16})," ",h?"Saving...":"Save Changes"]})]})]})}):null},zf=15,zg=()=>{const t=ft(),{customColumnsConfig:a,refetch:n}=hm(),[i,l]=x.useState(!1),[c,o]=x.useState([]),[d,h]=x.useState(!0),[m,f]=x.useState(null),[g,y]=x.useState(""),[b,v]=x.useState(1),[w,S]=x.useState(1),[_,E]=x.useState(0),[D,O]=x.useState("created_at"),[M,A]=x.useState("desc"),[P,Q]=x.useState(""),[G,C]=x.useState(!1),[R,z]=x.useState(null),[F,J]=x.useState([]),[H,I]=x.useState(""),[V,re]=x.useState(!1),[B,k]=x.useState(null),[Ne,Ae]=x.useState(!0),[T,Ce]=x.useState(null),[Ue,Pe]=x.useState(g);us(),x.useEffect(()=>{const Y=setTimeout(()=>{Pe(g),v(1)},500);return()=>{clearTimeout(Y)}},[g]);const de=x.useCallback(async()=>{Ae(!0),Ce(null);try{const Y=await Z("/api/subscriptions");if(!Y.ok){let ce=`Failed to fetch subscription plans (${Y.status})`;try{ce=(await Y.json()).message||ce}catch{}throw new Error(ce)}const ie=await Y.json();J(ie)}catch(Y){console.error("Error fetching subscription plans:",Y),Ce(Y.message||"An unknown error occurred while fetching plans."),J([])}finally{Ae(!1)}},[]),Se=x.useCallback(async(Y,ie,ce,pe,He)=>{h(!0),f(null);try{const We=new URLSearchParams({page:Y.toString(),limit:zf.toString(),sortBy:ce,sortOrder:pe});ie&&We.append("search",ie),He&&We.append("gender",He);const st=await Z(`/api/patients?${We.toString()}`);if(!st.ok){const ve=await st.json();throw new Error(ve.message||"Failed to fetch patients")}const me=await st.json();o(me.patients),E(me.totalCount),v(me.currentPage),S(me.totalPages)}catch(We){console.error("Error fetching patients:",We),f(`Failed to load patients: ${We.message}`),o([]),E(0),v(1),S(1)}finally{h(!1)}},[]);x.useEffect(()=>{Se(b,Ue,D,M,P),de()},[b,Ue,D,M,P,Se,de]);const ee=Y=>{const ie=D===Y&&M==="asc"?"desc":"asc";O(Y),A(ie),v(1)},oe=Y=>{try{return new Date(Y).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},fe=()=>{C(!1),z(null),I(""),k(null),re(!1)},ge=async(Y,ie)=>{o(ce=>ce.map(pe=>pe.id===Y?{...pe,insurance_type:ie}:pe));try{const ce=await Z(`/api/patients/${Y}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:ie})});if(!ce.ok){const pe=await ce.json();throw new Error(pe.message||"Failed to update insurance type")}}catch(ce){console.error("Error updating insurance type:",ce),Se(b,Ue,D,M,P)}},q=(Y,ie)=>{const ce=new Date(Y),pe=ie.interval||1;switch(ie.period){case"daily":ce.setDate(Y.getDate()+pe);break;case"weekly":ce.setDate(Y.getDate()+pe*7);break;case"monthly":ce.setMonth(Y.getMonth()+pe);break;case"yearly":ce.setFullYear(Y.getFullYear()+pe);break;default:console.warn(`Unknown subscription period: ${ie.period}. Defaulting to 1 month.`),ce.setMonth(Y.getMonth()+1)}return ce},W=async()=>{if(!R||!H){k("Please select a subscription plan.");return}const Y=F.find(ie=>ie.id===H);if(!Y){k("Selected plan details not found.");return}re(!0),k(null);try{const ie=new Date,ce=q(ie,Y),pe={subscription_plan_id:H,subscription_status:"active",subscription_start_date:ie.toISOString(),subscription_end_date:ce.toISOString(),subscription_payment_method:"manual"},He=await Z(`/api/patients/${R.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)});if(!He.ok){const We=await He.json();throw new Error(We.message||"Failed to update patient subscription")}fe(),Se(b,Ue,D,M,P)}catch(ie){console.error("Error starting subscription:",ie),k(`Failed to start subscription: ${ie.message}`)}finally{re(!1)}};return e.jsxs("div",{className:"all-patients-container",children:[e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16}),"Back"]}),e.jsxs("h1",{className:"all-patients-title",children:[e.jsx(Rn,{size:28}),"All Registered Patients"]}),m&&e.jsxs("div",{className:"error-alert",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:m})]}),e.jsxs("div",{className:"subscription-plans-card",children:[e.jsx("h2",{className:"subscription-plans-title",children:"Available Subscription Plans"}),e.jsx("div",{children:Ne?e.jsx("p",{className:"loading-state",children:"Loading plans..."}):T?e.jsxs("p",{className:"error-message",children:["Error loading plans: ",T]}):F.length===0?e.jsx("p",{className:"empty-state",children:"No active subscription plans found."}):e.jsx("ul",{className:"subscription-plans-list",children:F.map(Y=>e.jsxs("li",{children:[e.jsx("strong",{children:Y.name}),": ",Y.price," / ",Y.interval," ",Y.period,Y.interval>1?"s":"",Y.description&&e.jsx("span",{className:"plan-description",children:Y.description})]},Y.id))})})]}),e.jsxs("div",{className:"controls-container",children:[e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search by name or phone...",className:"search-input",value:g,onChange:Y=>y(Y.target.value)}),e.jsx(fn,{className:"search-input-icon",size:20})]}),e.jsxs("div",{className:"filter-dropdown-wrapper",children:[e.jsx("label",{htmlFor:"genderFilter",className:"sr-only",children:"Filter by Gender"}),e.jsxs("div",{className:"filter-select-container",children:[e.jsx(bC,{size:16,className:"filter-select-icon"}),e.jsxs("select",{id:"genderFilter",value:P,onChange:Y=>Q(Y.target.value),className:"filter-select",children:[e.jsx("option",{value:"",children:"All Genders"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("button",{onClick:()=>l(!0),className:"action-button",title:"Manage Custom Columns",children:[e.jsx(vl,{size:16})," Columns"]})]}),d?e.jsx("div",{className:"patients-table-wrapper",children:e.jsxs("table",{className:"patients-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(U,{width:50,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:40,height:20})}),e.jsx("th",{children:e.jsx(U,{width:60,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:120,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:80,height:20})})]})}),e.jsx("tbody",{children:[1,2,3,4,5,6,7,8].map(Y=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:40,height:20})}),e.jsx("td",{className:"patient-name",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(U,{variant:"circular",width:24,height:24}),e.jsx(U,{width:120,height:20})]})}),e.jsx("td",{children:e.jsx(U,{width:30,height:20})}),e.jsx("td",{children:e.jsx(U,{width:30,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})}),e.jsx("td",{children:e.jsx(U,{width:100,height:32})}),e.jsx("td",{children:e.jsx(U,{width:80,height:32,style:{borderRadius:"4px"}})})]},Y))})]})}):c.length===0?e.jsx("div",{className:"empty-state",children:Ue?"No patients found matching your search.":"No patients registered yet."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"patients-table-wrapper",children:e.jsxs("table",{className:"patients-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Token"}),e.jsxs("th",{className:"sortable-header",onClick:()=>ee("name"),children:["Name",D==="name"&&(M==="asc"?e.jsx(dg,{size:14,className:"sort-icon"}):e.jsx(Bj,{size:14,className:"sort-icon"}))]}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Gender"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Address"}),e.jsxs("th",{className:"sortable-header",onClick:()=>ee("created_at"),children:["Registered On",D==="created_at"&&(M==="asc"?e.jsx(dg,{size:14,className:"sort-icon"}):e.jsx(Bj,{size:14,className:"sort-icon"}))]}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Insurance Type"})," ",e.jsx("th",{children:"Action"})," "]})}),e.jsx("tbody",{children:c.map(Y=>e.jsxs(on.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:Y.token??"-"}),e.jsx("td",{className:"patient-name",children:Y.name}),e.jsx("td",{children:Y.age??"-"}),e.jsx("td",{children:Y.gender??"-"}),e.jsx("td",{children:Y.phone??"-"}),e.jsx("td",{children:Y.address??"-"}),e.jsx("td",{children:oe(Y.created_at)}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${Y.subscription_status==="active"?"active":Y.subscription_status==="cancelled"||Y.subscription_status==="expired"?"inactive":"none"}`,children:Y.subscription_status??"None"})}),e.jsx("td",{children:e.jsxs("select",{value:Y.insurance_type,onChange:ie=>ge(Y.id,ie.target.value),className:"form-select insurance-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>t(`/start-subscription/${Y.id}`),className:"action-button",children:"Start Sub"})})]}),a.patients&&a.patients.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{padding:"0 15px 15px 15px",borderTop:"none"},children:e.jsx("div",{style:{padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"4px",display:"flex",flexWrap:"wrap",gap:"15px"},children:a.patients.map(ie=>{var ce;return e.jsxs("div",{style:{fontSize:"0.9em"},children:[e.jsxs("strong",{style:{color:"#555"},children:[ie.label,":"]})," ",(ce=Y.custom_fields)!=null&&ce[ie.key]?String(Y.custom_fields[ie.key]):"-"]},ie.key)})})})})]},Y.id))})]})}),w>1&&e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("div",{className:"pagination-info",children:["Showing"," ",e.jsx("span",{className:"font-medium",children:(b-1)*zf+1})," ","to"," ",e.jsx("span",{className:"font-medium",children:Math.min(b*zf,_)})," ","of"," ",e.jsx("span",{className:"font-medium",children:_})," results"]}),e.jsxs("div",{className:"pagination-buttons",children:[e.jsxs("button",{onClick:()=>v(Y=>Math.max(Y-1,1)),disabled:b===1||d,className:"pagination-button",children:[e.jsx(Zh,{size:16,className:"prev-icon"}),"Previous"]}),e.jsxs("span",{className:"pagination-current-page",children:["Page ",e.jsx("span",{className:"font-medium",children:b})," of ",e.jsx("span",{className:"font-medium",children:w})]}),e.jsxs("button",{onClick:()=>v(Y=>Math.min(Y+1,w)),disabled:b===w||d,className:"pagination-button",children:["Next",e.jsx(jl,{size:16,className:"next-icon"})]})]})]})]}),G&&R&&e.jsx("div",{className:"subscription-modal-overlay",children:e.jsxs("div",{className:"subscription-modal-content",children:[e.jsxs("div",{className:"subscription-modal-header",children:[e.jsxs("h2",{className:"subscription-modal-title",children:["Start Subscription for ",R.name]}),e.jsx("button",{onClick:fe,className:"subscription-modal-close-button",children:e.jsx(St,{size:24})})]}),B&&e.jsx("div",{className:"error-alert",role:"alert",children:e.jsx("span",{children:B})}),e.jsxs("div",{className:"subscription-modal-body",children:[e.jsx("label",{htmlFor:"subscriptionPlan",className:"form-label",children:"Select Plan:"}),e.jsxs("select",{id:"subscriptionPlan",value:H,onChange:Y=>I(Y.target.value),className:"form-select",disabled:V||Ne||T!==null||F.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:"-- Select a Plan --"}),Ne?e.jsx("option",{value:"",disabled:!0,children:"Loading plans..."}):T?e.jsx("option",{value:"",disabled:!0,children:"Error loading plans"}):F.length>0?F.map(Y=>e.jsxs("option",{value:Y.id,children:[Y.name," - ",Y.price," (",Y.interval," ",Y.period,Y.interval>1?"s":"",")"]},Y.id)):e.jsx("option",{value:"",disabled:!0,children:"No active plans found"})]}),T&&e.jsx("p",{className:"error-message",children:T}),F.length===0&&!Ne&&!T&&e.jsx("p",{className:"empty-state",children:"No active subscription plans available."})]}),e.jsxs("div",{className:"subscription-modal-footer",children:[e.jsx("button",{onClick:fe,disabled:V,className:"subscription-modal-button cancel",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:!H||V,className:"subscription-modal-button submit",children:V?"Starting...":"Start Subscription"})]})]})}),e.jsx(Tx,{isOpen:i,onClose:()=>l(!1),entityType:"patients",entityLabel:"Patients",currentConfig:a,onConfigUpdated:()=>{n()}})]})},Nw=()=>{const t=ft(),[a,n]=x.useState(""),[i,l]=x.useState([]),[c,o]=x.useState(!1),[d,h]=x.useState(!1),[m,f]=x.useState(!1),g=/^\+?[0-9\s\-().]{7,20}$/,y=x.useMemo(()=>$u(async _=>{if(_.trim().length<2){l([]),o(!1);return}o(!0);try{const E=new URLSearchParams({search:encodeURIComponent(_),page:"1",limit:"8",sortBy:"name",sortOrder:"asc"}),D=await Z(`/api/patients?${E.toString()}`);if(!D.ok)throw new Error("Failed to search");const O=await D.json();l(O.patients)}catch{l([])}finally{o(!1)}},300),[]),b=_=>{const E=_.target.value;n(E),h(g.test(E)),o(!0),f(!0),y(E)},v=x.useCallback(_=>{t("/billing",{state:{patientId:_.id,patientName:_.name}})},[t]),w=x.useCallback(async()=>{if(!(!a||!d)){o(!0);try{const E=await Z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"Direct Patient",phone:a,age:null,gender:null,token:null})});if(!E.ok)throw new Error("Failed to create patient");const D=await E.json();v(D)}catch(_){alert(`Error: ${_.message}`)}finally{o(!1)}}},[a,d,v]),S=_=>_.slice(0,1).toUpperCase();return e.jsxs("div",{className:"ccb-container",children:[e.jsxs("div",{className:"ccb-header-section",children:[e.jsx("button",{onClick:()=>t(-1),className:"ccb-back-button",title:"Go Back",children:e.jsx(Et,{size:24})}),e.jsx("h1",{className:"ccb-title",children:"Create Custom Bill"}),e.jsx("p",{className:"ccb-subtitle",children:"Search for a patient to bill manually, or create a new one instantly."})]}),e.jsxs("div",{className:"ccb-search-wrapper",children:[e.jsx(fn,{className:"ccb-search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Search by Name, Phone, or Token...",value:a,onChange:b,onFocus:()=>f(!0),className:"ccb-search-input",autoFocus:!0}),a&&e.jsx("div",{className:"ccb-clear-icon",onClick:()=>{n(""),l([]),f(!1)},children:e.jsx(St,{size:18})}),e.jsxs("div",{className:`ccb-results-dropdown ${m&&(i.length>0||c||a.length>2&&i.length===0)?"open":""}`,children:[c&&e.jsx("div",{className:"p-4 flex justify-center items-center",children:e.jsx("div",{className:"ccb-spinner"})}),!c&&i.map(_=>e.jsxs("div",{onClick:()=>v(_),className:"ccb-result-item",children:[e.jsxs("div",{className:"ccb-patient-info",children:[e.jsx("div",{className:"ccb-avatar",children:S(_.name)}),e.jsxs("div",{className:"ccb-patient-details",children:[e.jsx("h4",{children:_.name}),e.jsxs("p",{className:"ccb-patient-meta",children:[_.phone||"No phone","  ",_.gender||"-","  ",_.age?`${_.age}y`:"-"]})]})]}),e.jsxs("span",{className:"ccb-token-badge",children:["#",_.token]})]},_.id)),!c&&i.length===0&&a.length>2&&e.jsxs("div",{className:"ccb-create-action",children:[e.jsx("p",{className:"text-gray-500 mb-3 text-sm",children:"No patients found."}),d&&e.jsxs("button",{onClick:w,className:"ccb-create-btn w-full",children:["Create Patient with Phone ",a]})]})]})]})]})},ww=({currentUser:t})=>{const a=ft(),[n,i]=x.useState("select_patient"),[l,c]=x.useState({name:"",age:void 0,gender:null,phone:"",address:""}),[o,d]=x.useState(null),[h,m]=x.useState([]),[f,g]=x.useState([]),[y,b]=x.useState(""),[v,w]=x.useState([]),[S,_]=x.useState(""),[E,D]=x.useState([]),[O,M]=x.useState(!1),[A,P]=x.useState(null),[Q,G]=x.useState(null),[C,R]=x.useState(null),[z,F]=x.useState(!1),[J,H]=x.useState(!1),[I,V]=x.useState(!1),re=/^\+?[0-9\s\-().]{7,20}$/,B=/^[a-zA-Z\s'-]{2,}$/,k=x.useCallback(async()=>{if(!(h.length>0)){F(!0),R(null);try{const ge=await Z("/api/lab-tests");if(!ge.ok)throw new Error("Failed to fetch lab tests");const q=await ge.json();m(q)}catch(ge){console.error("Failed to fetch available lab tests:",ge),R("Could not load lab test list: "+ge.message),m([])}finally{F(!1)}}},[h.length]),Ne=x.useMemo(()=>new Da(h,{keys:["name","description"],threshold:.3,ignoreLocation:!0}),[h]);x.useEffect(()=>{if(!y){w([]);return}const ge=Ne.search(y).map(q=>q.item);w(ge.slice(0,10))},[y,Ne]);const Ae=x.useCallback(ge=>{const q={id:ge.id,name:ge.name,token:ge.token,age:ge.age,gender:ge.gender,phone:ge.phone};d(q),i("create_order"),g([]),b(""),w([]),R(null),k()},[k]),T=x.useMemo(()=>$u(async ge=>{if(ge.trim().length<2){D([]),M(!1),P(null);return}M(!0),P(null);try{const q=new URLSearchParams({search:encodeURIComponent(ge),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),W=await Z(`/api/patients?${q.toString()}`);if(!W.ok){const ie=await W.text();throw new Error(`API Error (${W.status}): ${ie||W.statusText}`)}const Y=await W.json();D(Y.patients)}catch(q){console.error("Error searching lab patients:",q),P(q.message||"Failed to search lab patients."),D([])}finally{M(!1)}},300),[re,B]),Ce=ge=>{const q=ge.target.value;_(q),H(re.test(q)),V(B.test(q)&&!re.test(q)),M(!0),T(q)},Ue=x.useCallback(async ge=>{if(!S||ge==="phone"&&!J||ge==="name"&&!I){P(`Invalid ${ge} to create a new patient.`);return}M(!0),P(null);try{const W=await Z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:ge==="name"?S:"direct lab",phone:ge==="phone"?S:null,age:null,gender:null,token:null})});if(!W.ok){const ie=await W.json();throw new Error(ie.message||`Failed to create patient: ${W.statusText}`)}const Y=await W.json();alert(`New patient "${Y.name}" created with ${ge==="phone"?`phone ${Y.phone}`:`name ${Y.name}`}.`),Ae({id:Y.id,name:Y.name,token:Y.token??null,age:Y.age??null,gender:Y.gender??null,phone:Y.phone})}catch(q){console.error("Error creating new patient:",q),P(q.message||"Failed to create new patient.")}finally{M(!1)}},[S,J,I,Ae]),Pe=()=>{i("select_patient"),d(null),_(""),D([]),P(null)},de=ge=>{const{name:q,value:W}=ge.target;c(Y=>({...Y,[q]:q==="age"?W?parseInt(W,10):void 0:W}))},Se=async ge=>{if(ge.preventDefault(),G(null),!l.name){G("Patient Name is required.");return}const q={name:l.name,age:l.age,gender:l.gender,phone:l.phone,address:l.address};try{const W=await Z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!W.ok){const ie=await W.json();throw new Error(ie.message||`Failed to create patient: ${W.statusText}`)}const Y=await W.json();alert(`Patient "${Y.name}" created successfully!`),Ae({id:Y.id,name:Y.name,token:Y.token??null,age:Y.age??null,gender:Y.gender??null,phone:Y.phone})}catch(W){console.error("Failed to create patient:",W),G(W.message||"Failed to create patient. Please try again.")}},ee=ge=>{if(f.some(q=>q.id===ge.id)){R(`${ge.name} is already in the order.`),setTimeout(()=>R(null),3e3),b(""),w([]);return}g(q=>[...q,{...ge}]),b(""),w([])},oe=ge=>{g(q=>q.filter(W=>W.id!==ge))},fe=async ge=>{if(ge.preventDefault(),R(null),!o){R("No patient selected.");return}if(f.length===0){R("No lab tests selected.");return}const q={patient_id:o.id,tests:f.map(W=>({id:W.id,name:W.name,price:W.price}))};console.log("Submitting Lab Order:",q);try{const W=await Z("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!W.ok){const ce=await W.json();throw console.error("API Error Data:",ce),new Error(ce.message||`Failed to create lab order: ${W.statusText}`)}const Y=await W.json();console.log("Lab Order Creation Result:",Y);let ie=o.queueId;if(!ie){const ce=await Z(`/api/queue/patient/${o.id}/latest`);if(ce.ok){const pe=await ce.json();pe!=null&&pe._id&&(ie=pe._id)}}if(!ie){const ce=await Z("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:o.id})});if(!ce.ok){const He=await ce.text();throw new Error(`Failed to create queue entry for redirection: ${He||ce.statusText}`)}const pe=await ce.json();if(pe!=null&&pe.id)ie=pe.id;else throw new Error("Failed to get ID from new queue entry for redirection.")}alert(`Lab order created successfully for ${o.name}!`),(t==null?void 0:t.role)==="lab"?a("/dashboard"):a(`/dashboard/edit-complaint/${ie}`)}catch(W){console.error("Failed to create lab order:",W),R(W.message||"Failed to create lab order.")}};return x.useEffect(()=>{k()},[k]),e.jsxs("div",{className:"create-lab-order-container",children:[e.jsxs("div",{className:"create-lab-order-header",children:[e.jsxs("button",{onClick:()=>a(-1),className:"back-button","aria-label":"Go back",children:[e.jsx(Et,{size:20,style:{marginRight:"8px"}}),"Back"]}),e.jsx("h1",{className:"create-lab-order-title",children:"Create New Lab Order"}),e.jsx("div",{style:{width:"64px"}})," "]}),(n==="select_patient"||n==="create_patient")&&e.jsxs("div",{className:"glass-card",children:[n==="select_patient"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"header-with-action",children:e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"Select Patient"})}),e.jsxs("div",{className:"search-container",children:[e.jsx(fn,{className:"search-icon",size:20}),e.jsx("input",{type:"text",id:"lab-patient-search",placeholder:"Search by Name, Token No, or Phone No...",value:S,onChange:Ce,className:"modern-input",autoFocus:!0,autoComplete:"off"}),O&&e.jsx("div",{style:{position:"absolute",right:"15px",top:"50%",transform:"translateY(-50%)"},children:e.jsx(U,{width:80,height:14})})]}),O&&e.jsx("ul",{className:"patient-list",children:[1,2,3].map(ge=>e.jsxs("li",{className:"patient-list-item",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx(U,{width:120,height:20}),e.jsx(U,{width:50,height:24,style:{borderRadius:"12px"}})]}),e.jsx("div",{className:"patient-details",children:e.jsx(U,{width:200,height:16})})]},ge))}),A&&e.jsxs("div",{className:"error-message",children:[e.jsx(Nn,{size:18}),A]}),E.length>0&&e.jsx("ul",{className:"patient-list",children:E.map(ge=>e.jsxs("li",{onClick:()=>Ae(ge),className:"patient-list-item",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("strong",{children:ge.name}),e.jsxs("span",{className:"token-badge",children:["#",ge.token||"N/A"]})]}),e.jsxs("div",{className:"patient-details",children:[ge.age?`${ge.age} yrs`:"",ge.gender?` / ${ge.gender}`:"",ge.phone?`  ${ge.phone}`:""]})]},ge.id))}),S.length>=2&&!O&&E.length===0&&!A&&e.jsxs("div",{style:{textAlign:"center",marginTop:"20px"},children:[e.jsxs("p",{className:"no-data-message",style:{background:"none",border:"none",padding:0},children:['No patients found matching "',S,'".']}),e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:"15px",marginTop:"15px"},children:[J&&e.jsxs("button",{type:"button",onClick:()=>Ue("phone"),className:"secondary-button",children:['Create "Direct Lab" Patient (Phone: ',S,")"]}),I&&e.jsxs("button",{type:"button",onClick:()=>Ue("name"),className:"secondary-button",children:["Create Patient (Name: ",S,")"]})]})]}),S.length<2&&!O&&e.jsx("div",{className:"info-message",children:"Start typing to search for a patient..."})]}),n==="create_patient"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header-with-action",children:[e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"New Patient Registration"}),e.jsx("button",{onClick:Pe,className:"text-button",children:" Back to Search "})]}),Q&&e.jsxs("div",{className:"error-message",children:[e.jsx(Nn,{size:18}),Q]}),e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-name",className:"form-label",children:"Patient Name *"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(Rn,{className:"search-icon",size:18}),e.jsx("input",{type:"text",name:"name",id:"lab-patient-name",required:!0,value:l.name,onChange:de,className:"modern-input",placeholder:"Enter full name"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lab-patient-age",className:"form-label",children:"Age"}),e.jsx("input",{type:"number",name:"age",id:"lab-patient-age",value:l.age??"",onChange:de,className:"modern-input",style:{paddingLeft:"16px"},placeholder:"e.g. 30"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"lab-patient-gender",className:"form-label",children:"Gender"}),e.jsxs("select",{name:"gender",id:"lab-patient-gender",value:l.gender??"",onChange:de,className:"modern-input",style:{paddingLeft:"16px"},children:[e.jsx("option",{value:"",children:"Select Gender..."}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-phone",className:"form-label",children:"Phone Number"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(nx,{className:"search-icon",size:18}),e.jsx("input",{type:"tel",name:"phone",id:"lab-patient-phone",value:l.phone||"",onChange:de,className:"modern-input",placeholder:"e.g. 9876543210"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"lab-patient-address",className:"form-label",children:"Address"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[e.jsx(D1,{className:"search-icon",size:18,style:{top:"20px"}}),e.jsx("textarea",{name:"address",id:"lab-patient-address",rows:2,value:l.address||"",onChange:de,className:"modern-input",style:{resize:"none"},placeholder:"Enter address (optional)"})]})]})]}),e.jsxs("div",{className:"flex-end",children:[e.jsx("button",{type:"button",onClick:Pe,className:"secondary-button",children:" Cancel "}),e.jsxs("button",{type:"submit",className:"primary-button",children:[e.jsx(bn,{size:18}),"Create & Proceed"]})]})]})]})]}),n==="create_order"&&o&&e.jsxs("div",{className:"glass-card",children:[e.jsxs("div",{className:"header-with-action",children:[e.jsx("h2",{className:"card-title",style:{borderBottom:"none",marginBottom:0},children:"Create Lab Order"}),e.jsx("button",{onClick:Pe,className:"text-button",children:" Change Patient "})]}),e.jsxs("div",{className:"patient-summary",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(Rn,{size:20,className:"highlight-primary"}),e.jsx("span",{style:{fontSize:"1.1rem",fontWeight:"600"},children:o.name})]}),e.jsxs("div",{className:"patient-details",style:{marginLeft:"30px",marginTop:"4px"},children:[o.age?`${o.age} yrs`:"Age N/A",o.gender&&`  ${o.gender}`,o.phone&&`  ${o.phone}`]})]}),C&&e.jsxs("div",{className:"error-message",children:[e.jsx(Nn,{size:18}),C]}),e.jsxs("form",{onSubmit:fe,children:[e.jsxs("div",{className:"form-group",style:{position:"relative"},children:[e.jsx("label",{htmlFor:"lab-test-search",className:"form-label",children:"Add Lab Test"}),e.jsxs("div",{className:"search-container",style:{margin:0},children:[z?e.jsx("div",{style:{position:"absolute",right:"45px",top:"50%",transform:"translateY(-50%)"},children:e.jsx(U,{width:24,height:24,variant:"circular"})}):e.jsx(fn,{className:"search-icon",size:18}),e.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search tests (e.g. CBC, Lipid Profile)...",value:y,onChange:ge=>b(ge.target.value),className:"modern-input",disabled:z,autoComplete:"off"})]}),z&&y&&e.jsx("div",{className:"search-results-dropdown",children:[1,2,3].map(ge=>e.jsxs("div",{className:"search-result-item",children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"20%",height:20})]},ge))}),y&&v.length>0&&e.jsx("div",{className:"search-results-dropdown",children:v.map(ge=>e.jsxs("div",{onClick:()=>ee(ge),className:"search-result-item",children:[e.jsx("span",{style:{fontWeight:500},children:ge.name}),e.jsxs("span",{className:"highlight-primary",style:{fontWeight:600},children:["",parseFloat(ge.price).toFixed(2)]})]},ge.id))}),y&&v.length===0&&!z&&e.jsxs("div",{className:"no-data-message",style:{marginTop:"5px",padding:"10px",fontSize:"0.9rem"},children:['No tests found matching "',y,'".']})]}),e.jsxs("div",{style:{marginTop:"30px"},children:[e.jsxs("h4",{className:"card-title",style:{fontSize:"1.1rem"},children:["Selected Tests (",f.length,")"]}),f.length===0?e.jsx("div",{className:"info-message",children:"No tests added yet. Search above to add tests."}):e.jsx("div",{className:"selected-tests-list",children:f.map(ge=>e.jsxs("div",{className:"selected-test-item",children:[e.jsx("div",{style:{flex:1},children:e.jsx("div",{style:{fontWeight:500},children:ge.name})}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("span",{className:"highlight-primary",style:{fontWeight:600},children:["",parseFloat(ge.price).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>oe(ge.id),className:"remove-button",title:"Remove Test",children:e.jsx(Jt,{size:18})})]})]},ge.id))})]}),f.length>0&&e.jsxs("div",{className:"total-price",children:["Total: ",f.reduce((ge,q)=>ge+parseFloat(q.price),0).toFixed(2)]}),e.jsxs("div",{className:"flex-end",children:[e.jsx("button",{type:"button",onClick:Pe,className:"secondary-button",children:" Cancel Order "}),e.jsxs("button",{type:"submit",disabled:f.length===0,className:"primary-button",children:[e.jsx(cg,{size:18}),"Create Lab Order"]})]})]})]})]})},h0=({currentUser:t})=>{const[a,n]=x.useState("newtons-ai"),[i,l]=x.useState(""),[c,o]=x.useState([]),[d,h]=x.useState(!0),[m,f]=x.useState([]),[g,y]=x.useState(!1),[b,v]=x.useState(null),[w,S]=x.useState(null),_=ft(),E=Qa(),D=async()=>{h(!0),S(null);let C=[];try{const R=await Z("/api/queue");if(!R.ok){const J=await R.json();throw new Error(J.message||"Failed to fetch queue")}C=await R.json(),console.log("Fetched Initial Queue Data:",JSON.stringify(C,null,2));const z=C.map(async J=>{if(!J.patient_id)return console.warn(`Queue entry ${J.id} has no patient_id.`),J;try{const H=await Z(`/api/patients/${J.patient_id}`);if(!H.ok)return console.error(`Failed to fetch patient details for ${J.patient_id}: ${H.status}`),J;const I=await H.json();return{...J,Patient:{...J.Patient??{},...I}}}catch(H){return console.error(`Error fetching patient details for ${J.patient_id}:`,H),J}}),F=await Promise.all(z);console.log("Enriched Queue Data (Before Sort):",JSON.stringify(F,null,2)),F.sort((J,H)=>{var k,Ne;const I=((k=J.Patient)==null?void 0:k.subscription_status)==="active",V=((Ne=H.Patient)==null?void 0:Ne.subscription_status)==="active";if(I&&!V)return-1;if(!I&&V)return 1;const re=J.created_at?new Date(J.created_at).getTime():0,B=H.created_at?new Date(H.created_at).getTime():0;return re-B}),console.log("Sorted Queue Data:",JSON.stringify(F,null,2)),o(F)}catch(R){console.error("Error in fetchQueue process:",R),S(`Failed to load queue: ${R.message}`),o(C)}finally{h(!1)}},O=async()=>{y(!0),S(null);try{const C=await Z("/api/staff?role=doctor");if(!C.ok){const z=await C.json();throw new Error(z.message||"Failed to fetch doctors")}const R=await C.json();f(R.filter(z=>z.active))}catch(C){console.error("Error fetching doctors:",C),S(`Failed to fetch doctors: ${C.message}`)}finally{y(!1)}};x.useEffect(()=>{const R=new URLSearchParams(E.search).get("tab");R&&P.find(F=>F.id===R)&&n(R)},[E.search]),x.useEffect(()=>{a==="queue"&&(D(),O()),v(null)},[a]);const M=x.useCallback(async(C,R)=>{if(console.log(`Attempting to assign doctor ${R} to queue ${C}`),S(null),v(null),!R){console.log("No doctor ID provided, skipping assignment.");return}const z=c.find(H=>H.id===C);if(!z){console.error(`Queue entry ${C} not found in local state.`),S("Queue entry not found.");return}if(z.doctor_id===R){console.log(`Queue ${C} already assigned to doctor ${R}. Skipping.`);return}const F=async H=>{if(!H||!H.id||!H.name){S("Cannot proceed: Patient ID or Name is missing."),console.error("assignAndNavigate called with invalid patientInfo",H);return}const I=async()=>{try{const V={status:"waiting",doctorId:R},re=await Z(`/api/queue/${C}/status`,{method:"PATCH",body:JSON.stringify(V)}),B=await re.json();if(!re.ok)throw new Error(B.message||`HTTP error! status: ${re.status}`);const k=m.find(Ne=>Ne.id===R);return console.log(`Successfully assigned doctor ${k==null?void 0:k.name} to queue ${C}.`),o(Ne=>Ne.map(Ae=>Ae.id===C?{...Ae,doctor_id:R,status:B.status||Ae.status,User:k?{name:k.name}:null,Patient:H}:Ae)),!0}catch(V){return console.error(`Error assigning doctor for queue ${C}:`,V),S(`Failed to assign doctor: ${V.message}`),!1}};H.subscription_status==="active"?(console.log(`Patient ${H.name} (ID: ${H.id}) has active subscription. Assigning doctor directly.`),await I()):(console.log(`Patient ${H.name} (ID: ${H.id}) does not have active subscription. Navigating to billing WITHOUT assigning doctor yet.`),_(`/dashboard/doctor-billing/${C}?doctorId=${R}`))},J=z.Patient;if(J&&J.id&&J.name)console.log("Patient details found in state. Proceeding with assignment."),await F(J);else{console.warn(`Patient details missing for queue entry ${C}. Fetching patient ${z.patient_id}...`);try{const H=await Z(`/api/patients/${z.patient_id}`);if(!H.ok){const V=await H.json().catch(()=>({}));throw new Error(V.message||`Failed to fetch patient details (status ${H.status})`)}const I=await H.json();console.log("Successfully fetched patient details:",I),await F(I)}catch(H){console.error(`Failed to fetch patient details for patient ID ${z.patient_id}:`,H),S(`Failed to fetch required patient details: ${H.message}`)}}},[m,c,_]),A=async(C,R)=>{S(null);const z=R==="consulting"?"start consultation":"complete visit";try{const F=c.find(V=>V.id===C);if(!F&&R==="consulting")throw new Error("Queue entry not found to start consultation.");let J={status:R};if(R==="consulting"){if(!(F!=null&&F.doctor_id))throw new Error("Cannot start consultation without an assigned doctor.");J.doctorId=F.doctor_id}const H=await Z(`/api/queue/${C}/status`,{method:"PATCH",body:JSON.stringify(J)}),I=await H.json();if(!H.ok)throw new Error(I.message||`HTTP error! status: ${H.status}`);o(V=>V.map(re=>re.id===C?{...re,status:R}:re))}catch(F){console.error(`Error trying to ${z}:`,F),S(`Failed to ${z}: ${F.message}`)}},P=[{id:"queue",label:"Queue",icon:e.jsx(Vo,{size:20})},{id:"newtons-ai",label:"Newtons AI",icon:e.jsx(fn,{size:20})},{id:"manage-admission",label:"Manage Admission",icon:e.jsx(jC,{size:20})},{id:"all-patients",label:"All Patients",icon:e.jsx(Ou,{size:20})},{id:"lab",label:"Lab Tests",icon:e.jsx(ug,{size:20})},{id:"custom-bill",label:"Custom Bill",icon:e.jsx(wa,{size:20})}],Q=C=>{try{return new Date(C).toLocaleTimeString("en-IN",{hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Invalid Date"}},G=c.filter(C=>{var R,z;return(z=(R=C.Patient)==null?void 0:R.name)==null?void 0:z.toLowerCase().includes(i.toLowerCase())});return e.jsxs("div",{className:"admin-panel-container",children:[w&&e.jsxs("div",{className:"error-message-reception",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:w})]}),e.jsx("div",{className:"admin-nav-bar",children:P.map(C=>e.jsxs("button",{className:`admin-nav-button ${a===C.id?"active":""}`,onClick:()=>n(C.id),children:[e.jsx("span",{children:C.icon}),C.label]},C.id))}),e.jsx("div",{className:"admin-content-section",children:e.jsxs("main",{className:"flex-1 overflow-y-auto",style:{padding:"15px"},children:[a==="queue"&&e.jsxs("div",{className:"space-y-6",children:[" ",e.jsxs("div",{className:"queue-header",children:[" ",e.jsxs("div",{className:"queue-actions",children:[" ",e.jsxs("div",{className:"search-bar-container",children:[" ",e.jsx("input",{type:"text",placeholder:"Search patients in queue...",className:"search-input",value:i,onChange:C=>l(C.target.value)}),e.jsx(fn,{className:"search-icon",size:18})]})]}),e.jsxs("div",{className:"summary-cards-grid",children:[" ",e.jsxs("div",{className:"summary-card card-waiting",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Waiting"})," ",e.jsx("div",{className:"summary-card-value",children:c.filter(C=>C.status==="waiting").length})," "]}),e.jsxs("div",{className:"summary-card card-consulting",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Consulting"})," ",e.jsx("div",{className:"summary-card-value",children:c.filter(C=>C.status==="consulting").length})," "]}),e.jsxs("div",{className:"summary-card card-completed",children:[" ",e.jsx("div",{className:"summary-card-title",children:"Completed"})," ",e.jsx("div",{className:"summary-card-value",children:c.filter(C=>C.status==="seen").length})," "]})]})]}),d?e.jsx("div",{className:"queue-table-wrapper",children:e.jsxs("table",{className:"queue-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(U,{width:50,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{className:"hidden md:table-cell",children:e.jsx(U,{width:80,height:20})}),e.jsx("th",{children:e.jsx(U,{width:120,height:20})})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(C=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:40,height:20})}),e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:24,style:{borderRadius:"12px"}})}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:60,height:20})}),e.jsx("td",{children:e.jsx(U,{width:120,height:32})})]},C))})]})}):G.length===0?e.jsx("div",{className:"empty-queue-message",children:i?"No patients found matching your search.":"Queue is empty."}):e.jsxs("div",{className:"queue-table-wrapper",children:[" ",e.jsxs("table",{className:"queue-table",children:[" ",e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Queue"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Phone Number"}),e.jsx("th",{children:"Complaint"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{className:"hidden md:table-cell",children:"Time Added"})," ",e.jsx("th",{className:"text-center",children:"Action / Doctor"})," "]})}),e.jsx("tbody",{children:G.map(C=>{var R,z,F,J,H,I,V,re,B,k,Ne;return e.jsxs("tr",{onClick:()=>_(`/dashboard/edit-complaint/${C.id}`),className:"queue-row-clickable",children:[e.jsxs("td",{children:[" ",e.jsxs("span",{className:"queue-token",children:["#",C.token_no]})," "]}),e.jsxs("td",{children:[" ",e.jsx("div",{className:"patient-name",children:((R=C.Patient)==null?void 0:R.name)||"N/A"})," ",e.jsxs("div",{className:"patient-details",children:[(z=C.Patient)!=null&&z.age?`${C.Patient.age} yrs, `:"",((F=C.Patient)==null?void 0:F.gender)||""]})," "]}),e.jsxs("td",{children:[" ",e.jsx("div",{className:"patient-phone",children:((J=C.Patient)==null?void 0:J.phone)||"N/A"})," "]}),e.jsx("td",{className:"complaint-text",children:C.complaint||"-"}),e.jsxs("td",{children:[e.jsx("span",{className:`subscription-status-badge ${((H=C.Patient)==null?void 0:H.subscription_status)==="active"?"status-active":((I=C.Patient)==null?void 0:I.subscription_status)==="cancelled"||((V=C.Patient)==null?void 0:V.subscription_status)==="expired"?"status-inactive":"status-none"}`,children:((re=C.Patient)==null?void 0:re.subscription_status)??"None"}),C.Patient&&C.Patient.id&&C.Patient.subscription_status!=="active"&&e.jsx("button",{onClick:Ae=>{Ae.stopPropagation(),C.Patient&&_(`/start-subscription/${C.Patient.id}`)},className:"action-button btn-start-sub-queue mt-2",children:"Start Sub"})]}),e.jsx("td",{className:"hidden md:table-cell time-added",children:Q(C.created_at)}),e.jsx("td",{className:"action-doctor-cell",children:b===C.id?e.jsx("div",{className:"relative inline-block text-left w-full",onClick:Ae=>Ae.stopPropagation(),children:e.jsxs("select",{value:"",onChange:Ae=>M(C.id,Ae.target.value),onBlur:()=>v(null),className:"doctor-select-dropdown",autoFocus:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select Doctor..."}),g?e.jsx("option",{disabled:!0,children:"Loading..."}):m.length>0?m.map(Ae=>e.jsx("option",{value:Ae.id,children:Ae.name},Ae.id)):e.jsx("option",{disabled:!0,children:"No doctors available"})]})}):e.jsxs("div",{className:"action-doctor-content",onClick:Ae=>Ae.stopPropagation(),children:[" ",C.status==="waiting"&&e.jsx(e.Fragment,{children:(B=C.User)!=null&&B.name?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("button",{onClick:()=>A(C.id,"consulting"),className:"action-button btn-start",children:"Start"})]}):g?e.jsx(U,{width:80,height:20}):m.length===0?e.jsx("span",{className:"status-text-red",children:"No doctors"}):m.length===1?e.jsxs("button",{onClick:()=>M(C.id,m[0].id),className:"action-button btn-assign",children:["Assign ",m[0].name]}):e.jsx("button",{onClick:()=>v(C.id),className:"action-button btn-assign",children:"Assign"})}),C.status==="consulting"&&e.jsxs(e.Fragment,{children:[((k=C.User)==null?void 0:k.name)&&e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("button",{onClick:()=>A(C.id,"seen"),className:"action-button btn-complete",children:"Complete"})]}),C.status==="seen"&&e.jsxs(e.Fragment,{children:[((Ne=C.User)==null?void 0:Ne.name)&&e.jsx("span",{className:"doctor-name-display",children:C.User.name}),e.jsx("span",{className:"status-text-italic",children:"Completed"})]}),C.status==="cancelled"&&e.jsx("span",{className:"status-text-red",children:"Cancelled"})]})})]},C.id)})})]})]})]}),a==="lab"&&e.jsxs("div",{className:"lab-tab-content",children:[" ",e.jsx(ww,{currentUser:t}),e.jsxs("button",{onClick:()=>_("/lab/search-report"),className:"lab-action-button btn-search-lab-reports",children:[e.jsx(fn,{size:16}),"Search Lab Reports"]})]}),a==="newtons-ai"&&e.jsx("div",{className:"newtons-ai-tab-content",children:e.jsx(gu,{})}),a==="manage-admission"&&e.jsx("div",{className:"manage-admission-tab-content",children:e.jsx(Ex,{})}),a==="all-patients"&&e.jsx("div",{className:"all-patients-tab-content",children:e.jsx(zg,{})}),a==="custom-bill"&&e.jsx("div",{className:"custom-bill-tab-content",children:e.jsx(Nw,{})})]})})," "]})},Ax=({isEmbedded:t=!1})=>{const{customColumnsConfig:a,refetch:n}=hm(),i=a.lab_tests||[],[l,c]=x.useState(!1),[o,d]=x.useState(!1),[h,m]=x.useState([]),[f,g]=x.useState(""),[y,b]=x.useState(!1),[v,w]=x.useState(null),[S,_]=x.useState(!1),[E,D]=x.useState(null),O=x.useRef(null),[M,A]=x.useState(!1),[P,Q]=x.useState(null),[G,C]=x.useState(!1),[R,z]=x.useState(!1),[F,J]=x.useState(null),[H,I]=x.useState({name:"",description:"",price:"",default_parameters:[]}),V=x.useCallback(async()=>{b(!0),w(null),D(null),Q(null);try{const W=await Z("/api/lab-tests");if(!W.ok)throw new Error(`HTTP error! status: ${W.status}`);const Y=await W.json();m(Y)}catch(W){console.error("Error fetching lab tests:",W),w(W.message||"Failed to fetch lab tests.")}finally{b(!1)}},[]);x.useEffect(()=>{V()},[V]);const re=W=>{const{name:Y,value:ie}=W.target;I(ce=>({...ce,[Y]:ie}))},B=(W,Y,ie)=>{const ce=[...H.default_parameters],pe=ce[W];if(Y==="type")switch(pe.type=ie,ie){case"number":pe.defaultValue=0,pe.lower_limit=null,pe.upper_limit=null,pe.unit="";break;case"boolean":pe.defaultValue=!1,pe.lower_limit=void 0,pe.upper_limit=void 0,pe.unit=void 0;break;case"string":default:pe.defaultValue="",pe.lower_limit=void 0,pe.upper_limit=void 0,pe.unit=void 0;break}else Y==="defaultValue"?pe.type==="number"?pe.defaultValue=parseFloat(ie)||0:(pe.type,pe.defaultValue=ie):Y==="lower_limit"||Y==="upper_limit"?pe[Y]=ie===""?null:parseFloat(ie):pe[Y]=ie;I(He=>({...He,default_parameters:ce}))},k=()=>{I(W=>({...W,default_parameters:[...W.default_parameters,{name:"",type:"string",defaultValue:"",unit:"",lower_limit:null,upper_limit:null}]}))},Ne=W=>{I(Y=>({...Y,default_parameters:Y.default_parameters.filter((ie,ce)=>ce!==W)}))},Ae=async W=>{W.preventDefault(),b(!0),w(null);const Y=F!==null,ie=Y?`/api/lab-tests/${F}`:"/api/lab-tests",ce=Y?"PUT":"POST";try{const pe=await Z(ie,{method:ce,headers:{"Content-Type":"application/json"},body:JSON.stringify({name:H.name,description:H.description,price:parseFloat(H.price),default_parameters:H.default_parameters})});if(!pe.ok){const He=await pe.json();throw new Error(He.message||`HTTP error! status: ${pe.status}`)}z(!1),J(null),I({name:"",description:"",price:"",default_parameters:[]}),V()}catch(pe){console.error(`Error ${Y?"updating":"adding"} lab test:`,pe),w(pe.message||`Failed to ${Y?"update":"add"} lab test.`)}finally{b(!1)}},T=()=>{J(null),I({name:"",description:"",price:"",default_parameters:[]}),z(!0)},Ce=W=>{if(F===W.id)J(null);else{J(W.id);const Y=(W.default_parameters||[]).map(ie=>({...ie,unit:ie.unit||"",lower_limit:ie.lower_limit===void 0?null:ie.lower_limit,upper_limit:ie.upper_limit===void 0?null:ie.upper_limit}));I({name:W.name,description:W.description||"",price:W.price,default_parameters:Y}),z(!1)}},Ue=async W=>{if(window.confirm("Are you sure you want to delete this lab test?")){b(!0),w(null);try{const Y=await Z(`/api/lab-tests/${W}`,{method:"DELETE"});if(!Y.ok){const ie=await Y.json();throw new Error(ie.message||`HTTP error! status: ${Y.status}`)}V()}catch(Y){console.error("Error deleting lab test:",Y),w(Y.message||"Failed to delete lab test.")}finally{b(!1)}}},Pe=()=>{z(!1),J(null),w(null),I({name:"",description:"",price:"",default_parameters:[]})},de=async W=>{if(!W){D("No file selected.");return}_(!0),D(null),w(null);const Y=new FormData;Y.append("file",W);try{const ie=await Z("/api/lab-tests/import",{method:"POST",body:Y});if(!ie.ok){const ce=await ie.json();throw new Error(ce.message||`Import failed: ${ie.statusText}`)}V()}catch(ie){console.error("Error importing lab tests from Excel:",ie),D(ie.message||"Failed to import lab tests from Excel.")}finally{_(!1)}},Se=async W=>{if(W.target.files&&W.target.files[0]){const Y=W.target.files[0];await de(Y),W.target&&(W.target.value="")}},ee=async()=>{if(window.confirm("Are you sure you want to import default biochemistry and pathology tests? This will add new tests and may duplicate existing ones if names match.")){A(!0),Q(null),w(null);try{const W=await Z("/api/lab-tests/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"}});if(!W.ok){const Y=await W.json();throw new Error(Y.message||`Default import failed: ${W.statusText}`)}V()}catch(W){console.error("Error importing default lab tests:",W),Q(W.message||"Failed to import default lab tests.")}finally{A(!1)}}},oe=async()=>{if(window.confirm("Are you sure you want to delete ALL lab tests? This action cannot be undone.")){C(!0),w(null),D(null),Q(null);try{const W=await Z("/api/lab-tests/all",{method:"DELETE"});if(!W.ok){const Y=await W.json();throw new Error(Y.message||`Delete all failed: ${W.statusText}`)}V()}catch(W){console.error("Error deleting all lab tests:",W),w(W.message||"Failed to delete all lab tests.")}finally{C(!1)}}},fe=y||S||M||G,ge=x.useMemo(()=>new Da(h,{keys:["name","description","default_parameters.name"],threshold:.3,ignoreLocation:!0}),[h]),q=x.useMemo(()=>f?ge.search(f).map(W=>W.item):h,[h,f,ge]);return e.jsxs("div",{className:`lab-inventory-card ${t?"embedded":""}`,style:t?{border:"none",boxShadow:"none",padding:0}:{},children:[!t&&e.jsx("h2",{className:"lab-inventory-header",children:"Available Lab Tests"}),e.jsx("div",{className:"mb-4",style:{display:"flex",alignItems:"center",marginBottom:"15px"},children:e.jsx("input",{type:"text",placeholder:"Search by test name...",value:f,onChange:W=>g(W.target.value),className:"lab-inventory-input",style:{maxWidth:"300px",marginRight:"10px"}})}),e.jsxs("div",{className:"mb-4",style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:T,className:"lab-inventory-button",disabled:fe,children:"Add New Test"}),e.jsx("button",{onClick:()=>{var W;return(W=O.current)==null?void 0:W.click()},className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:S?"Importing...":"Import from Excel"}),e.jsx("input",{type:"file",ref:O,onChange:Se,accept:".xlsx, .xls",style:{display:"none"},disabled:S}),e.jsx("button",{onClick:ee,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:M?"Importing Defaults...":"Import Default Tests"}),e.jsx("button",{onClick:oe,className:"lab-inventory-button lab-inventory-button-danger",disabled:fe,style:{backgroundColor:"#dc3545",borderColor:"#dc3545",color:"white"},children:G?"Deleting All...":"Delete All Tests"}),e.jsxs("button",{onClick:()=>c(!0),className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,title:"Manage Custom Columns",children:[e.jsx(vl,{size:16,style:{marginRight:"4px"}})," Columns"]}),e.jsxs("div",{className:"view-mode-toggle",style:{marginLeft:"auto"},children:[e.jsxs("button",{onClick:()=>d(!1),className:`view-mode-btn ${o?"":"active"}`,title:"List View",children:[e.jsx(Ou,{size:18})," List"]}),e.jsxs("button",{onClick:()=>d(!0),className:`view-mode-btn ${o?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(Iu,{size:18})," Excel"]})]})]}),v&&e.jsx("div",{className:"error-text mb-4",children:v}),E&&e.jsxs("div",{className:"error-text mb-4",children:["Import Excel Error: ",E]}),P&&e.jsxs("div",{className:"error-text mb-4",children:["Import Default Error: ",P]}),R&&e.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"20px",marginBottom:"20px"},children:[" ",e.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.5em",borderBottom:"1px solid #eee",marginBottom:"15px"},children:"Add New Lab Test"}),e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:H.name,onChange:re,className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:H.description,onChange:re,rows:3,className:"lab-inventory-input",disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",value:H.price,onChange:re,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.2em",marginTop:"20px",marginBottom:"10px"},children:"Default Parameters"}),H.default_parameters.map((W,Y)=>{var ie,ce;return e.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Parameter Name",value:W.name,onChange:pe=>B(Y,"name",pe.target.value),className:"lab-inventory-input"}),e.jsxs("select",{value:W.type,onChange:pe=>B(Y,"type",pe.target.value),className:"lab-inventory-input",children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),W.type==="boolean"?e.jsxs("select",{value:W.defaultValue.toString(),onChange:pe=>B(Y,"defaultValue",pe.target.value==="true"),className:"lab-inventory-input",children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-reactive"})]}):e.jsx("input",{type:W.type==="number"?"number":"text",placeholder:"Default Value",value:W.defaultValue.toString(),onChange:pe=>B(Y,"defaultValue",pe.target.value),className:"lab-inventory-input"}),W.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",placeholder:"Lower Limit",value:W.lower_limit===null?"":((ie=W.lower_limit)==null?void 0:ie.toString())??"",onChange:pe=>B(Y,"lower_limit",pe.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"number",placeholder:"Upper Limit",value:W.upper_limit===null?"":((ce=W.upper_limit)==null?void 0:ce.toString())??"",onChange:pe=>B(Y,"upper_limit",pe.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:W.unit||"",onChange:pe=>B(Y,"unit",pe.target.value),className:"lab-inventory-input"})]}),e.jsx("button",{type:"button",onClick:()=>Ne(Y),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},Y)}),e.jsx("button",{type:"button",onClick:k,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{type:"button",onClick:Pe,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:fe,children:y?"Saving...":"Add Test"})]})]})]}),fe&&!R?e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx("div",{className:"mb-4 flex gap-2",children:[1,2,3,4,5].map(W=>e.jsx(U,{width:100,height:36},W))}),e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Description"}),e.jsx("th",{children:"Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(W=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:"60%",height:20})}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:"90%",height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{style:{textAlign:"right"},children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(U,{width:40,height:20}),e.jsx(U,{width:50,height:20})]})})]},W))})]}),e.jsx("p",{className:"loading-text mt-2 text-sm italic text-gray-500",children:S?"Importing Excel data...":M?"Importing default data...":"Loading tests..."})]}):null,!fe&&q.length===0&&!v&&!E&&!P&&e.jsx("p",{className:"no-data-message",children:f?`No lab tests found matching "${f}".`:"No lab tests found. Add one or import from Excel to get started."}),o&&q.length>0?e.jsx(Mu,{columns:[{key:"name",label:"Test Name",editable:!0,type:"text"},{key:"description",label:"Description",editable:!0,type:"text"},{key:"price",label:"Price",editable:!0,type:"number"}],data:q,editable:!0,showRowNumbers:!0,title:"Lab Test Inventory",onSave:async W=>{const Y=W.map(async ie=>{const ce=h.find(pe=>pe.id===ie.id);if(ce&&(ce.name!==ie.name||ce.price!==ie.price||ce.description!==ie.description))return Z(`/api/lab-tests/${ie.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)})});try{await Promise.all(Y),alert("Changes saved successfully"),V()}catch(ie){alert("Error saving changes"),console.error(ie)}}}):!fe&&q.length>0&&e.jsxs("div",{className:"overflow-x-auto",children:[" ",e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Description"})," ",e.jsx("th",{children:"Price"}),e.jsx("th",{style:{textAlign:"right"},children:"Actions"})]})}),e.jsx("tbody",{children:q.map(W=>{const Y=F===W.id,ie=W.price&&typeof W.price=="string"?parseFloat(W.price):NaN,ce=isNaN(ie)?"0.00":ie.toFixed(2);return e.jsxs(on.Fragment,{children:[e.jsxs("tr",{onClick:()=>Ce(W),style:{cursor:"pointer"},children:[e.jsx("td",{children:W.name}),e.jsx("td",{className:"hidden md:table-cell",style:{whiteSpace:"pre-wrap"},children:W.description||"-"}),e.jsxs("td",{children:["",ce]}),e.jsx("td",{style:{textAlign:"right"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px"},children:[e.jsx("button",{onClick:pe=>{pe.stopPropagation(),Ce(W)},className:"lab-inventory-link",disabled:fe,style:{background:"none",border:"none",padding:"0",cursor:"pointer"},children:"Edit"}),e.jsx("button",{onClick:pe=>{pe.stopPropagation(),Ue(W.id)},className:"lab-inventory-link",disabled:fe,style:{background:"none",border:"none",padding:"0",cursor:"pointer",color:"#dc3545"},children:"Delete"})]})})]}),i.length>0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{padding:"0 15px 15px 15px",borderTop:"none"},children:e.jsx("div",{style:{padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"4px",display:"flex",flexWrap:"wrap",gap:"15px"},children:i.map(pe=>{var He;return e.jsxs("div",{style:{fontSize:"0.9em"},children:[e.jsxs("strong",{style:{color:"#555"},children:[pe.label,":"]})," ",(He=W.custom_fields)!=null&&He[pe.key]?String(W.custom_fields[pe.key]):"-"]},pe.key)})})})}),Y&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,children:e.jsxs("div",{className:"lab-inventory-card",style:{marginTop:"10px",marginBottom:"10px",border:"1px solid #ddd",padding:"15px"},children:[e.jsx("h3",{className:"lab-inventory-header",style:{fontSize:"1.2em"},children:"Edit Lab Test"}),e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Test Name ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:H.name,onChange:re,className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",value:H.description,onChange:re,rows:3,className:"lab-inventory-input",disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price ",e.jsx("span",{style:{color:"red"},children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",value:H.price,onChange:re,min:"0",step:"0.01",className:"lab-inventory-input",required:!0,disabled:fe})]}),e.jsxs("div",{className:"lab-inventory-form-group",children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em",marginTop:"15px"},children:"Default Parameters"}),H.default_parameters.map((pe,He)=>{var We,st;return e.jsxs("div",{className:"parameter-item",style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr 1fr 1fr 1fr auto",gap:"10px",alignItems:"center",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Parameter Name",value:pe.name,onChange:me=>B(He,"name",me.target.value),className:"lab-inventory-input"}),e.jsxs("select",{value:pe.type,onChange:me=>B(He,"type",me.target.value),className:"lab-inventory-input",children:[e.jsx("option",{value:"string",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),pe.type==="boolean"?e.jsxs("select",{value:pe.defaultValue.toString(),onChange:me=>B(He,"defaultValue",me.target.value==="true"),className:"lab-inventory-input",children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-reactive"})]}):e.jsx("input",{type:pe.type==="number"?"number":"text",placeholder:"Default Value",value:pe.defaultValue.toString(),onChange:me=>B(He,"defaultValue",me.target.value),className:"lab-inventory-input"}),pe.type==="number"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",placeholder:"Lower Limit",value:pe.lower_limit===null?"":((We=pe.lower_limit)==null?void 0:We.toString())??"",onChange:me=>B(He,"lower_limit",me.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"number",placeholder:"Upper Limit",value:pe.upper_limit===null?"":((st=pe.upper_limit)==null?void 0:st.toString())??"",onChange:me=>B(He,"upper_limit",me.target.value),className:"lab-inventory-input"}),e.jsx("input",{type:"text",placeholder:"Unit (e.g., mg/dL)",value:pe.unit||"",onChange:me=>B(He,"unit",me.target.value),className:"lab-inventory-input"})]}),e.jsx("button",{type:"button",onClick:()=>Ne(He),className:"lab-inventory-button lab-inventory-button-danger",children:"Remove"})]},He)}),e.jsx("button",{type:"button",onClick:k,className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"10px"},children:"Add Parameter"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{type:"button",onClick:Pe,className:"lab-inventory-button lab-inventory-button-secondary",disabled:fe,children:"Cancel"}),e.jsx("button",{type:"submit",className:"lab-inventory-button",disabled:fe,children:y?"Saving...":"Update Test"})]})]})]})})})]},W.id)})})]})]}),e.jsx(Tx,{isOpen:l,onClose:()=>c(!1),entityType:"lab_tests",entityLabel:"Lab Tests",currentConfig:a,onConfigUpdated:()=>{n()}})]})},CO=t=>{let a="";if(!t.report_content)return"No report content available.";a+=`*Report Date:* ${t.report_date?new Date(t.report_date).toLocaleDateString():"N/A"}

`;try{const n=JSON.parse(t.report_content);typeof n=="object"&&n!==null&&t.tests?t.tests.forEach((i,l)=>{a+=`*Test: ${i.name}*
`,n[i.id]?Object.entries(n[i.id]).forEach(([c,o])=>{var f;const d=(f=i.default_parameters)==null?void 0:f.find(g=>g.name===c);let h=String(o),m="";if(d){const g=d.unit?` _${d.unit}_`:"";if(d.type==="boolean"){const y=o===!0||o==="true";h=y?"*Reactive*":"Non-Reactive",y||(m="`Normal: Non-Reactive`")}else if(d.type==="number"){const y=typeof o=="string"?parseFloat(o):typeof o=="number"?o:NaN;if(d.lower_limit!=null||d.upper_limit!=null){let b=[];d.lower_limit!=null&&b.push(`${d.lower_limit}`),d.upper_limit!=null&&b.push(`${d.upper_limit}`),m=`\`Normal: ${b.join(" - ")}\`${g}`,!isNaN(y)&&(d.lower_limit!=null&&y<d.lower_limit||d.upper_limit!=null&&y>d.upper_limit)&&(h=`*${h}*`)}}d.unit&&(h+=g)}a+=`${c}: ${h}
`,m&&((d==null?void 0:d.type)==="boolean"&&(o===!0||o==="true")||(a+=`${m}
`))}):a+=`_No parameters reported for this test._
`,l<t.tests.length-1&&(a+=`
`)}):a+=t.report_content}catch{a+=t.report_content}return a},Px=t=>{var o;if(!((o=t==null?void 0:t.Patient)!=null&&o.phone)){alert("Cannot share report via WhatsApp: Patient phone number is not available.");return}if(!(t!=null&&t.report_content)){alert("Cannot share report: No report content is available to share.");return}const a=t.Patient.name||"Patient",n=CO(t),i=`Hello ${a},

Your lab report is ready.

${n}`,c=`https://wa.me/${_O(t.Patient.phone)}?text=${encodeURIComponent(i)}`;window.open(c,"_blank")},_O=t=>{let a=t.replace(/\D/g,"");const n=/^(?:\\+?91)?[\\s-]*?(\\d{10})$/,i=a.match(n);return i?a="91"+i[1]:a.startsWith("91")||(a="91"+a),a},m0=()=>{const[t,a]=x.useState([]),[n,i]=x.useState(""),[l,c]=x.useState(!0),[o,d]=x.useState(!0),[h,m]=x.useState(null),[f,g]=x.useState("orders"),[y,b]=x.useState(1),[v]=x.useState(20),[w,S]=x.useState(0),_=x.useMemo(()=>Math.ceil(w/v),[w,v]),E=x.useCallback(async(C=1,R="")=>{c(!0),m(null);try{const z=new URLSearchParams({page:String(C),limit:String(v)});R&&z.append("search",R);const F=await Z(`/api/lab?${z.toString()}`);if(!F.ok)throw new Error(`HTTP error! status: ${F.status}`);const J=await F.json(),H=J.orders.map(I=>{var V,re;return{id:I.id,labTokenNumber:String(I.lab_token_number??"N/A"),patientName:((V=I.Patient)==null?void 0:V.name)||"N/A",patientId:I.patient_id,patientTokenNumber:String(((re=I.Patient)==null?void 0:re.patient_token_number)??"N/A"),tests:(I.tests||[]).map(B=>B.name||"Unknown Test"),date:gl(new Date(I.createdAt),"yyyy-MM-dd"),status:I.status,reportId:I.reportId,billId:I.billId}});a(H),S(J.totalCount),b(C)}catch(z){console.error("Failed to fetch lab orders:",z),m(z instanceof Error?z.message:"An unknown error occurred"),a([]),S(0)}finally{c(!1),d(!1)}},[v]);x.useEffect(()=>{console.log(`Fetch effect triggered. Current page: ${y}, Search term: "${n}"`),n.length===0||n.length>=2?(console.log(`Condition met (length ${n.length}). Fetching orders...`),E(y,n)):console.log(`Condition not met (length ${n.length}). Not fetching.`)},[E,y,n]),x.useEffect(()=>{const C=setTimeout(()=>{n.length>=2?y!==1&&b(1):n.length<2&&y!==1&&b(1)},1e3);return()=>{clearTimeout(C)}},[n]);const D=async(C,R)=>{console.log(`Updating order ${C} to status ${R}`);try{const z=await Z(`/api/lab/${C}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:R})});if(!z.ok){const F=await z.json();throw new Error(F.message||`Failed to update status: ${z.status}`)}if(R==="completed"){const F=await Z(`/api/lab/orders/${C}/report`);if(F.ok){const J=await F.json();Px(J)}}await E(y,n),console.log(`Order ${C} status updated to ${R}, refetching page ${y}`)}catch(z){console.error("Error updating status:",z),alert(`Failed to update status: ${z instanceof Error?z.message:"Unknown error"}`)}},O=ft(),M=C=>{if(!C){console.error("Cannot navigate to billing: Order data is missing."),alert("Could not open billing page: Order information is missing.");return}C.billId?(console.log(`Navigating to existing bill for Bill ID: ${C.billId}, Patient: ${C.patientName}`),O("/billing",{state:{billId:C.billId,patientId:C.patientId,patientName:C.patientName,billType:"lab"}})):(console.log(`Navigating to LabBillingPage for Order ID: ${C.id}`),O(`/dashboard/lab-billing/${C.id}`))},A=C=>{C&&C.id?O(`/lab/report/${C.id}`):(console.error("Cannot navigate: Order or Order ID is missing."),alert("Could not open the report entry page: Order information is missing."))},P=C=>{switch(C){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:C,className:"status-badge"}}};if(l&&o)return e.jsxs("div",{className:"admin-panel-container",children:[e.jsx("div",{className:"admin-nav-bar",children:[1,2,3,4].map(C=>e.jsx(U,{width:100,height:40,style:{borderRadius:"8px",margin:"0 8px"}},C))}),e.jsxs("div",{className:"admin-content-section",style:{padding:"20px"},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx(U,{width:200,height:32}),e.jsx(U,{width:300,height:40})]}),e.jsx("div",{className:"lab-orders-table-container",children:e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(C=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})}),e.jsx("td",{children:e.jsx(U,{width:150,height:32})})]},C))})]})})]})]});if(h)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-red-50 text-red-700",children:[e.jsx(Nn,{size:48,className:"mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"Error Loading Lab Data"}),e.jsx("p",{className:"mb-4",children:h}),e.jsx("button",{onClick:()=>E(1,""),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry Fetch"})]});const Q=()=>{y>1&&b(C=>C-1)},G=()=>{y<_&&b(C=>C+1)};return e.jsxs("div",{className:"admin-panel-container",children:[e.jsxs("div",{className:"admin-nav-bar",children:[e.jsxs("button",{onClick:()=>O(-1),className:"admin-nav-button",title:"Back",children:[e.jsx(Et,{})," Back"]}),e.jsxs("button",{onClick:()=>g("orders"),className:`admin-nav-button ${f==="orders"?"active":""}`,children:[e.jsx(Ih,{})," Orders"]}),e.jsx("button",{onClick:()=>O("/create-lab-order"),className:"admin-nav-button",children:"Create New Lab Order"}),e.jsxs("button",{onClick:()=>g("inventory"),className:`admin-nav-button ${f==="inventory"?"active":""}`,children:[e.jsx(vC,{})," Inventory"]})]}),e.jsx("div",{className:"admin-content-section",children:e.jsxs("main",{className:"flex-1 overflow-y-auto",style:{padding:"15px"},children:[f==="orders"&&e.jsxs("div",{className:"lab-orders-view",children:[" ",e.jsxs("div",{className:"lab-orders-header-controls",children:[e.jsx("h3",{className:"lab-orders-title",children:"Current Lab Orders"}),e.jsxs("div",{className:"lab-orders-search-container",children:[e.jsx("input",{type:"text",placeholder:"Search name, token, tests...",value:n,onChange:C=>i(C.target.value),className:"lab-inventory-input lab-orders-search-input"}),e.jsx(fn,{size:18,className:"lab-orders-search-icon"})]})]}),e.jsx("div",{className:"lab-orders-table-container",children:e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient (Token)"}),e.jsx("th",{children:"Tests"}),e.jsx("th",{className:"hidden md:table-cell",children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"lab-table-actions-header",children:"Actions"})]})}),e.jsxs("tbody",{children:[l&&!h&&t.length===0&&[1,2,3,4,5].map(C=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})}),e.jsx("td",{children:e.jsx(U,{width:150,height:32})})]},C)),!l&&!h&&t.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-10",children:n?`No lab orders found matching "${n}".`:"No lab orders available."})}),!l&&!h&&t.map(C=>{const R=P(C.status);return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{children:C.patientName}),e.jsxs("div",{className:"lab-table-patient-token",children:["Token: ",C.patientTokenNumber]})]}),e.jsx("td",{children:C.tests.map((z,F)=>e.jsx("div",{children:z},F))}),e.jsx("td",{className:"hidden md:table-cell",children:C.date}),e.jsx("td",{children:e.jsx("span",{className:R.className,children:R.text})}),e.jsx("td",{children:e.jsxs("div",{className:"lab-table-actions",children:[C.status==="pending"&&e.jsx("button",{onClick:()=>M(C),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),C.status==="billed"&&e.jsx("button",{onClick:()=>D(C.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),C.status==="collected"&&e.jsx("button",{onClick:()=>D(C.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),(C.status==="processing"||C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>A(C),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>D(C.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),(C.status==="completed"||C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>{C.id?O(`/lab/view-report/${C.id}`):(console.error("Attempted to view report for an order with no ID:",C),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})})]},C.id)})]})]})}),e.jsxs("div",{className:"lab-orders-card-container",children:[l&&!h&&t.length===0&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(C=>e.jsx("div",{className:"lab-order-card",children:e.jsx(U,{width:"100%",height:150})},C))}),!l&&!h&&t.length===0&&e.jsx("div",{className:"text-center py-10",children:n?`No lab orders found matching "${n}".`:"No lab orders available."}),!l&&!h&&t.map(C=>{const R=P(C.status);return e.jsxs("div",{className:"lab-order-card",children:[e.jsxs("div",{className:"lab-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"lab-card-patient-name",children:C.patientName}),e.jsxs("div",{className:"lab-card-patient-token",children:["Token: ",C.patientTokenNumber]}),e.jsx("div",{className:"lab-card-date",children:C.date})]}),e.jsx("span",{className:`${R.className} lab-card-status-pill`,children:R.text})]}),e.jsxs("div",{className:"lab-card-section",children:[e.jsx("p",{className:"lab-card-section-title",children:"Tests:"}),C.tests.map((z,F)=>e.jsx("div",{className:"lab-card-test-item",children:z},F)),C.tests.length===0&&e.jsx("div",{className:"lab-card-no-tests",children:"No tests listed."})]}),e.jsxs("div",{className:"lab-card-actions",children:[C.status==="pending"&&e.jsx("button",{onClick:()=>M(C),className:"lab-action-button btn-bill",title:"Generate Bill",children:"Bill"}),C.status==="billed"&&e.jsx("button",{onClick:()=>D(C.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),C.status==="collected"&&e.jsx("button",{onClick:()=>D(C.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),(C.status==="processing"||C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>A(C),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>D(C.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"}),(C.status==="completed"||C.status==="report_ready"||C.status==="reported")&&e.jsx("button",{onClick:()=>{C.id?O(`/lab/view-report/${C.id}`):(console.error("Attempted to view report for an order with no ID:",C),alert("Cannot view report: Order ID is missing."))},className:"lab-action-button btn-view-report",title:"View Report",children:"View"})]})]},C.id)})]}),!l&&w>0&&e.jsxs("div",{className:"lab-pagination-controls",children:[e.jsxs("div",{className:"lab-pagination-info",children:["Showing"," ",e.jsx("strong",{children:(y-1)*v+1})," ","to"," ",e.jsx("strong",{children:Math.min(y*v,w)})," ","of"," ",e.jsx("strong",{children:w})," ","results"]}),e.jsxs("div",{className:"lab-pagination-buttons",children:[e.jsx("button",{onClick:Q,disabled:y===1,className:"lab-pagination-button","aria-label":"Previous page",children:e.jsx(Zh,{size:18})}),e.jsxs("span",{children:["Page ",y," of ",_]}),e.jsx("button",{onClick:G,disabled:y===_,className:"lab-pagination-button","aria-label":"Next page",children:e.jsx(jl,{size:18})})]})]})]}),f==="inventory"&&e.jsxs("div",{className:"lab-inventory-content-wrapper",children:[" ",e.jsx(Ax,{})]})]})})," "]})},p0=()=>{const[t,a]=x.useState([]),[n,i]=x.useState(""),[l,c]=x.useState(!0),[o,d]=x.useState(null),h=ft(),m=x.useRef(null),[f,g]=x.useState(1),[y,b]=x.useState(1),[v,w]=x.useState(0),S=10,_=x.useCallback(async(P,Q,G)=>{c(!0),d(null);try{let C=`/api/pharmacy-orders?page=${P}&limit=${Q}`;G&&G.trim()!==""&&(C+=`&search=${encodeURIComponent(G.trim())}`);const R=await Z(C);if(!R.ok)throw new Error(`Failed to fetch orders: ${R.statusText} (${R.status})`);const z=await R.json();if(z&&Array.isArray(z.orders)&&typeof z.totalOrders=="number"&&typeof z.totalPages=="number")a(z.orders),w(z.totalOrders),b(z.totalPages),g(z.currentPage||P);else throw new Error("Invalid data format received from API")}catch(C){console.error("Failed to fetch pharmacy orders:",C),d(C.message||"Failed to fetch orders. Please try again."),a([]),b(1),w(0)}finally{c(!1)}},[]);x.useEffect(()=>(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{const P=n===""?f:1;n!==""&&f!==1&&g(1),_(P,S,n)},500),()=>{m.current&&clearTimeout(m.current)}),[n,f,_,S]);const E=P=>{h(`/dashboard/edit-pharmacy-order/${P}`)},D=P=>{d(null);const Q=t.find(G=>G.id===P);if(Q){const G=Q.medications.map(C=>({name:C.name,pack_quantity:C.pack_quantity,loose_quantity:C.loose_quantity,price:C.price??0,pack_price:C.pack_price,loose_price:C.loose_price,total_price:C.total_price,isLoose:C.isLoose,unit:C.unit,drug_id:C.drug_id?String(C.drug_id):null,tabletsPerDay:C.tabletsPerDay,numberOfDays:C.numberOfDays,directions_to_use:C.directions_to_use,discount_percentage:0,batch:C.batch,expiry_date:C.expiry_date}));h(`/dashboard/pharmacy-billing/${P}`,{state:{initialItems:G}})}else d(`Order with ID ${P} not found.`),alert(`Error: Could not find order ${P} to bill.`)},O=async(P,Q)=>{d(null);const G=t.find(R=>R.id===P);if(!G){d(`Order with ID ${P} not found.`);return}const C={status:Q,medications:G.medications};try{const R=await Z(`/api/pharmacy-orders/${P}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)});if(!R.ok){const F=await R.text();throw new Error(`Failed to update status: ${R.statusText} (${R.status}) - ${F}`)}const z=await R.json();a(F=>F.map(J=>J.id===z.id?{...J,status:z.status}:J))}catch(R){console.error("Failed to update order status:",R),d(R.message||`Failed to update status for order ${P}.`),alert(`Error updating status for order ${P}: ${R.message||"Please try again."}`)}},M=P=>{switch(P){case"pending":return"status-pill status-pill-pending";case"billed":return"status-pill status-pill-billed";case"dispensed":return"status-pill status-pill-dispensed";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill status-pill-default"}},A=P=>{h(`/dashboard/edit-complaint/patient/${P.patientId}`)};return l&&t.length===0&&!o?e.jsxs("div",{className:"admin-panel-container",children:[e.jsx("div",{className:"admin-nav-bar",children:[1,2,3,4].map(P=>e.jsx(U,{width:100,height:40,style:{borderRadius:"8px",margin:"0 8px"}},P))}),e.jsxs("div",{className:"admin-content-section",style:{padding:"20px"},children:[e.jsx("div",{className:"pharmacy-search-input-container",style:{marginTop:"0",marginBottom:"10px"},children:e.jsx(U,{width:"100%",height:40,style:{borderRadius:"20px"}})}),e.jsx("div",{className:"pharmacy-table-container",children:e.jsxs("table",{className:"pharmacy-queue-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:200,height:20})}),e.jsx("th",{className:"hidden md:table-cell",children:e.jsx(U,{width:80,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:80,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(P=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx(U,{width:120,height:20}),e.jsx(U,{width:80,height:14,style:{marginTop:"4px"}})]}),e.jsxs("td",{children:[e.jsx(U,{width:"90%",height:20}),e.jsx(U,{width:"70%",height:14,style:{marginTop:"4px"}})]}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})}),e.jsx("td",{children:e.jsx(U,{width:150,height:32})})]},P))})]})})]})]}):o&&t.length===0?e.jsxs("div",{className:"error-message-box",children:["Error loading orders: ",o]}):e.jsxs("div",{className:"admin-panel-container",children:[e.jsxs("div",{className:"admin-nav-bar",children:[e.jsxs("button",{onClick:()=>h("/dashboard/add-order"),className:"admin-nav-button",children:[e.jsx(wa,{})," Add Order"]}),e.jsxs("button",{onClick:()=>h("/dashboard/inventory"),className:"admin-nav-button",title:"View Pharmacy Inventory",children:[e.jsx(xl,{})," Inventory"]}),e.jsxs("button",{onClick:()=>h("/dashboard/search-patient-records"),className:"admin-nav-button",title:"Search Patient Records with Newton's AI",children:[e.jsx(E1,{})," Newton's AI"]}),e.jsxs("button",{onClick:()=>h("/dashboard/distributors"),className:"admin-nav-button",title:"Manage Distributors",children:[e.jsx(xl,{})," Distributors"]})]}),e.jsxs("div",{className:"pharmacy-search-input-container",style:{marginTop:"10px",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"Search orders by patient name, token, or medication...",value:n,onChange:P=>i(P.target.value),className:"pharmacy-search-input"}),e.jsx(fn,{size:18,className:"pharmacy-search-icon"})]}),e.jsxs("div",{className:"admin-content-section",children:[o&&t.length>0&&e.jsxs("div",{className:"error-message-box",children:["Error: ",o]}),l&&t.length>0&&e.jsx("div",{className:"loading-status-overlay",children:e.jsx(U,{width:150,height:20})}),!l&&t.length===0&&!o&&e.jsx("div",{className:"empty-state-message",children:n?`No pharmacy orders found matching "${n}".`:"There are currently no pharmacy orders."}),t.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pharmacy-table-container",children:e.jsxs("table",{className:"pharmacy-queue-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Medications"}),e.jsx("th",{className:"hidden md:table-cell",children:"Date"}),e.jsx("th",{children:"Order Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map(P=>e.jsxs("tr",{onClick:()=>A(P),style:{cursor:"pointer"},children:[e.jsxs("td",{children:[e.jsx("div",{className:"patient-name",children:P.patientName}),e.jsx("div",{className:"patient-token",title:`Patient Token: ${P.patientTokenNumber}`,children:P.patientTokenNumber})]}),e.jsxs("td",{className:"medication-info",children:[P.medications.map((Q,G)=>e.jsxs("div",{className:"medication-item",children:[e.jsxs("span",{children:[Q.name," (Packs: ",Q.pack_quantity,", Loose: ",Q.loose_quantity,", ",Q.tabletsPerDay??"N/A","x",Q.numberOfDays??"N/A","d)",Q.box_number&&e.jsxs("span",{className:"medication-box-number",children:[" (Box: ",Q.box_number,")"]})]}),Q.directions_to_use&&e.jsxs("span",{className:"medication-directions",children:["Directions: ",Q.directions_to_use]}),e.jsxs("div",{className:"medication-prices text-xs text-gray-500",children:[Q.pack_price!==void 0&&`Pack Price: ${Number(Q.pack_price).toFixed(2)}`,Q.loose_price!==void 0&&` | Loose Price: ${Number(Q.loose_price).toFixed(2)}`,Q.total_price!==void 0&&` | Item Total: ${Number(Q.total_price).toFixed(2)}`]})]},G)),P.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"unavailable-drugs-note",children:[e.jsx("strong",{children:"Unavailable Drugs Note:"})," ",P.prescriptionForUnavailableDrugs]})]}),e.jsx("td",{className:"hidden md:table-cell date-info",children:new Date(P.date).toLocaleDateString()}),e.jsxs("td",{className:"order-total-cell font-semibold",children:["",Number(P.order_total??0).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:M(P.status),children:P.status})}),e.jsx("td",{children:e.jsxs("div",{className:"pharmacy-table-actions",children:[P.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:Q=>{Q.stopPropagation(),E(P.id)},className:"pharmacy-table-action-button btn-edit-order",children:[e.jsx(ma,{size:14})," Edit"]}),e.jsxs("button",{onClick:Q=>{Q.stopPropagation(),D(P.id)},className:"pharmacy-table-action-button btn-bill-order",children:[e.jsx(Cr,{size:14})," Bill"]})]}),P.status==="billed"&&e.jsxs("button",{onClick:Q=>{Q.stopPropagation(),O(P.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[e.jsx(ka,{size:14})," Dispense"]}),(P.status==="pending"||P.status==="billed")&&e.jsx("button",{onClick:Q=>{Q.stopPropagation(),O(P.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),e.jsx("button",{onClick:Q=>{Q.stopPropagation(),A(P)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})})]},P.id))})]})}),e.jsx("div",{className:"pharmacy-card-view-container",children:t.map(P=>{const Q=M(P.status);return e.jsxs("div",{className:"pharmacy-order-card",onClick:()=>A(P),children:[e.jsxs("div",{className:"pharmacy-card-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"pharmacy-card-patient-name",children:P.patientName||"N/A"}),e.jsxs("div",{className:"pharmacy-card-patient-token",title:`Patient Token: ${P.patientTokenNumber}`,children:["Token: ",P.patientTokenNumber||"N/A"]}),e.jsx("div",{className:"pharmacy-card-date",children:new Date(P.date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:Q,children:P.status}),P.order_total!==void 0&&e.jsxs("span",{className:"pharmacy-card-order-total font-semibold",children:["",Number(P.order_total).toFixed(2)]})]})]}),e.jsxs("div",{className:"pharmacy-card-medications",children:[e.jsx("p",{className:"pharmacy-card-medications-title",children:"Medications:"}),e.jsxs("div",{className:"space-y-0_5",children:[P.medications.slice(0,2).map((G,C)=>e.jsx("div",{className:"pharmacy-card-medication-item",children:e.jsxs("span",{title:`${G.name} (Packs: ${G.pack_quantity}, Loose: ${G.loose_quantity}, ${G.tabletsPerDay??"N/A"}x${G.numberOfDays??"N/A"}d)`,children:[G.name," (Packs: ",G.pack_quantity,", Loose: ",G.loose_quantity,", ",G.tabletsPerDay??"N/A","x",G.numberOfDays??"N/A","d)",G.box_number&&e.jsxs("span",{className:"medication-box-number",children:[" (Box: ",G.box_number,")"]})]})},C)),P.medications.length>2&&e.jsxs("div",{className:"pharmacy-card-medications-more",children:["...and ",P.medications.length-2," more"]}),P.medications.length===0&&e.jsx("div",{className:"pharmacy-card-no-medications",children:"No medications listed."})]})]}),e.jsxs("div",{className:"pharmacy-card-actions",children:[P.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:G=>{G.stopPropagation(),E(P.id)},className:"pharmacy-table-action-button btn-edit-order",children:[e.jsx(ma,{size:14})," Edit"]}),e.jsxs("button",{onClick:G=>{G.stopPropagation(),D(P.id)},className:"pharmacy-table-action-button btn-bill-order",children:[e.jsx(Cr,{size:14})," Bill"]})]}),P.status==="billed"&&e.jsxs("button",{onClick:G=>{G.stopPropagation(),O(P.id,"dispensed")},className:"pharmacy-table-action-button btn-dispense-order",children:[e.jsx(ka,{size:14})," Dispense"]}),(P.status==="pending"||P.status==="billed")&&e.jsx("button",{onClick:G=>{G.stopPropagation(),O(P.id,"cancelled")},className:"pharmacy-table-action-button btn-cancel-order",children:"Cancel"}),e.jsx("button",{onClick:G=>{G.stopPropagation(),A(P)},className:"pharmacy-table-action-button btn-details-order",children:"Details"})]})]},P.id)})})]}),!l&&y>1&&e.jsxs("div",{className:"pharmacy-pagination-container",children:[e.jsxs("div",{className:"pagination-mobile-controls",children:[e.jsx("button",{onClick:()=>g(P=>Math.max(P-1,1)),disabled:f===1,className:"pagination-button prev",children:"Previous"}),e.jsx("button",{onClick:()=>g(P=>Math.min(P+1,y)),disabled:f===y,className:"pagination-button next",children:"Next"})]}),e.jsxs("div",{className:"pagination-desktop-controls",children:[e.jsx("div",{className:"pagination-info",children:e.jsxs("p",{children:["Showing ",e.jsx("span",{className:"font-medium",children:(f-1)*S+1})," ","to ",e.jsx("span",{className:"font-medium",children:Math.min(f*S,v)})," ","of ",e.jsx("span",{className:"font-medium",children:v})," results"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"pagination-nav","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>g(P=>Math.max(P-1,1)),disabled:f===1,className:"pagination-nav-button prev",children:[e.jsx("span",{className:"sr-only",children:"Previous"}),e.jsx(Zh,{"aria-hidden":"true"})]}),e.jsxs("span",{"aria-current":"page",className:"pagination-current-page",children:["Page ",f," of ",y]}),e.jsxs("button",{onClick:()=>g(P=>Math.min(P+1,y)),disabled:f===y,className:"pagination-nav-button next",children:[e.jsx("span",{className:"sr-only",children:"Next"}),e.jsx(jl,{"aria-hidden":"true"})]})]})})]})]})]})," "]})},Ff=10,DO=3,Sw=({isEmbedded:t=!1,initialSearch:a=""})=>{const n=ft(),{customColumnsConfig:i,refetch:l}=hm(),c=i.drugs||[],[o,d]=x.useState(!1),[h,m]=x.useState(!1),[f,g]=x.useState([]),[y,b]=x.useState([]),[v,w]=x.useState(a),[S,_]=x.useState(!0),[E,D]=x.useState(null),[O,M]=x.useState(new Set),[A,P]=x.useState("all"),Q=async()=>{try{const te=await Z("/api/inventory/download-csv");if(!te.ok)throw new Error(`Failed to download CSV: ${te.statusText}`);const Re=await te.blob(),lt=window.URL.createObjectURL(Re),Xe=document.createElement("a");Xe.href=lt,Xe.download="pharmacy_inventory.csv",document.body.appendChild(Xe),Xe.click(),Xe.remove(),window.URL.revokeObjectURL(lt)}catch(te){console.error("Failed to download CSV:",te),D(te.message||"Failed to download inventory CSV. Please try again.")}},[G,C]=x.useState(!1),[R,z]=x.useState(!1),[F,J]=x.useState(null),[H,I]=x.useState(!1),[V,re]=x.useState(new Set),[B,k]=x.useState(1),Ne=8,[Ae,T]=x.useState(null),[Ce,Ue]=x.useState(0),[Pe,de]=x.useState(!1),[Se,ee]=x.useState(null),[oe,fe]=x.useState(1),[ge,q]=x.useState(!1),W=B*Ne,Y=W-Ne,ie=y.slice(Y,W),ce=Math.ceil(y.length/Ne);x.useEffect(()=>{k(1)},[v,A]);const pe=x.useCallback(async()=>{_(!0),D(null);try{const te=await Z("/api/drugs");if(!te.ok)throw new Error(`Failed to fetch drugs: ${te.statusText} (${te.status})`);const Re=await te.json();let lt=Array.isArray(Re)?Re:Re.drugs||[];lt=lt.map(Xe=>({...Xe,mrp:parseFloat(String(Xe.mrp))||0,rate:Xe.rate!==null&&Xe.rate!==void 0?parseFloat(String(Xe.rate)):null,stock:parseInt(String(Xe.stock),10)||0,gst:Xe.gst!==null&&Xe.gst!==void 0?parseFloat(String(Xe.gst)):null,margin:Xe.margin!==null&&Xe.margin!==void 0?parseFloat(String(Xe.margin)):null,discount:Xe.discount!==null&&Xe.discount!==void 0?parseFloat(String(Xe.discount)):null})),g(lt),b(lt)}catch(te){console.error("Failed to fetch drugs:",te),D(te.message||"Failed to load inventory. Please try again.")}finally{_(!1)}},[]);x.useEffect(()=>{pe()},[pe]),x.useEffect(()=>{a&&w(a)},[a]);const He=x.useMemo(()=>new Da(f,{keys:["name","brand_name","description","supplier","box_number"],threshold:.3,ignoreLocation:!0}),[f]);x.useEffect(()=>{let te=f;v&&(te=He.search(v).map(Xe=>Xe.item));const Re=new Date,lt=BC(Re,DO);A==="low-stock"?te=te.filter(Xe=>Xe.stock<=Ff):A==="near-expiry"?te=te.filter(Xe=>{if(!Xe.expiry_date)return!1;const dt=Gj(Xe.expiry_date);return Qj(dt)&&cf(dt,lt)&&!cf(dt,Re)}):A==="expired"&&(te=te.filter(Xe=>{if(!Xe.expiry_date)return!1;const dt=Gj(Xe.expiry_date);return Qj(dt)&&cf(dt,Re)})),b(te)},[v,f,A,He]);const We=()=>{C(!1),T(null)},st=te=>{Ue(parseInt(te.target.value,10)||0)},me=async te=>{if(te.preventDefault(),D(null),!Ae||!Ae.id||Ce===0){D("No drug selected or adjustment amount is zero.");return}try{const Re=await Z(`/api/drugs/${Ae.id}/adjust-stock`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantityChange:Ce})});if(!Re.ok){const Xe=await Re.json();throw new Error(Xe.message||`Failed to adjust stock: ${Re.statusText}`)}const lt=await Re.json();g(Xe=>Xe.map(dt=>dt.id===lt.id?lt:dt)),We(),alert(`Stock for "${lt.name}" adjusted successfully. New stock: ${lt.stock}`)}catch(Re){console.error("Failed to adjust stock:",Re),D(Re.message||"Failed to adjust stock. Please try again.")}},ve=te=>{J(te),z(!0)},Fe=()=>{z(!1),J(null)},Ee=async()=>{if(!F||!F.id){D("No drug selected for deletion.");return}_(!0),D(null);try{const te=await Z(`/api/drugs/${F.id}`,{method:"DELETE"});if(!te.ok){const Re=await te.json();throw new Error(Re.message||`Failed to delete drug: ${te.statusText}`)}alert(`Drug "${F.name}" deleted successfully.`),pe(),Fe()}catch(te){console.error("Failed to delete drug:",te),D(te.message||"Failed to delete drug. Please try again.")}finally{_(!1)}},L=()=>{I(!0)},ne=()=>{I(!1)},[xe,ae]=x.useState(!1),we=()=>{V.size>0&&ae(!0)},Le=()=>{ae(!1)},Je=async()=>{if(V.size===0){D("No drugs selected for deletion.");return}_(!0),D(null);try{const te=await Z("/api/drugs/batch-delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({drugIds:Array.from(V)})});if(!te.ok){const Re=await te.json();throw new Error(Re.message||`Failed to delete selected drugs: ${te.statusText}`)}alert(`${V.size} drug(s) deleted successfully.`),pe(),re(new Set),Le()}catch(te){console.error("Failed to delete selected drugs:",te),D(te.message||"Failed to delete selected drugs. Please try again.")}finally{_(!1)}},ot=async()=>{_(!0),D(null);try{const te=await Z("/api/drugs/all",{method:"DELETE"});if(!te.ok){const Re=await te.json();throw new Error(Re.message||`Failed to delete all drugs: ${te.statusText}`)}alert("All drugs deleted successfully."),pe(),ne()}catch(te){console.error("Failed to delete all drugs:",te),D(te.message||"Failed to delete all drugs. Please try again.")}finally{_(!1)}},xt=te=>{if(!te)return null;const Re=te.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return Re?parseInt(Re[1],10):null},be=te=>{ee(te),fe(1),de(!0)},ue=()=>{de(!1),ee(null),fe(1)},je=te=>{fe(parseInt(te.target.value,10)||0)},ke=async te=>{if(te.preventDefault(),D(null),!Se||!Se.id||oe<=0){D("No drug selected or invalid number of packs to convert.");return}const Re=xt(Se.pack);if(!Re||Re<=0){D(`Cannot convert "${Se.name}" to loose. Invalid pack unit: ${Se.pack||"N/A"}.`);return}if(oe>(Se.stock??0)){D(`Cannot convert ${oe} packs. Only ${Se.stock??0} packs are in stock.`);return}try{const lt=await Z(`/api/drugs/${Se.id}/convert-to-loose`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({packsToConvert:oe,packSize:Re})});if(!lt.ok){const dt=await lt.json();throw new Error(dt.message||`Failed to convert to loose: ${lt.statusText}`)}const Xe=await lt.json();g(dt=>dt.map(jt=>jt.id===Xe.id?Xe:jt)),ue(),alert(`Converted ${oe} pack(s) of "${Xe.name}" to loose. New stock: ${Xe.stock} packs, ${Xe.loose??0} loose units.`)}catch(lt){console.error("Failed to convert to loose:",lt),D(lt.message||"Failed to convert to loose. Please try again.")}finally{_(!1)}},Me=()=>{q(!0)},De=()=>{q(!1)},qe=async()=>{_(!0),D(null);try{const te=await Z("/api/drugs/import-defaults",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})});if(!te.ok){const Re=await te.json();throw new Error(Re.message||`Failed to add default medications: ${te.statusText}`)}alert("Default medications added successfully."),pe(),De()}catch(te){console.error("Failed to add default medications:",te),D(te.message||"Failed to add default medications. Please try again.")}finally{_(!1)}};return S?e.jsxs("div",{className:`pharmacy-inventory-page ${t?"embedded":""}`,style:t?{minHeight:"auto",padding:"0",background:"transparent"}:{},children:[e.jsx("div",{className:"inventory-header-controls",style:{padding:"20px 20px 0 20px"},children:e.jsxs("div",{className:"inventory-actions-group",children:[e.jsx("div",{className:"action-group-left",style:{display:"flex",gap:"12px"},children:[1,2,3,4].map(te=>e.jsx(U,{width:120,height:36},te))}),e.jsxs("div",{className:"action-group-right",style:{display:"flex",gap:"12px"},children:[e.jsx(U,{width:100,height:36}),[1,2,3,4].map(te=>e.jsx(U,{width:120,height:36},te))]})]})}),e.jsxs("div",{className:"search-bar-container",style:{padding:"0 20px 20px 20px",borderBottom:"1px solid var(--border-color)",marginBottom:"0"},children:[e.jsx(U,{width:"100%",height:40,style:{maxWidth:"600px"}}),e.jsx(U,{width:150,height:40})]}),e.jsx("div",{className:"inventory-table-container",children:e.jsxs("table",{className:"inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-column",children:e.jsx(U,{width:20,height:20})}),e.jsx("th",{children:"DRUG DETAILS"}),e.jsx("th",{children:"PACK"}),e.jsx("th",{children:"EXPIRY"}),e.jsx("th",{className:"qty-header",children:"STOCK"}),e.jsx("th",{className:"mrp-header",children:"MRP"}),e.jsx("th",{className:"rate-header",children:"RATE"}),e.jsx("th",{children:"BOX"}),e.jsx("th",{children:"DISC %"}),e.jsx("th",{children:"MARGIN"}),e.jsx("th",{className:"actions-cell",children:"ACTIONS"})]})}),e.jsx("tbody",{children:[1,2,3,4,5,6,7,8].map(te=>e.jsxs("tr",{children:[e.jsx("td",{className:"checkbox-cell",children:e.jsx(U,{width:20,height:20})}),e.jsxs("td",{children:[e.jsx(U,{width:"80%",height:20}),e.jsx(U,{width:"40%",height:14,style:{marginTop:"4px"}})]}),e.jsx("td",{children:e.jsx(U,{width:60,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsxs("td",{children:[e.jsx(U,{width:40,height:20}),e.jsx(U,{width:60,height:14,style:{marginTop:"4px"}})]}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:40,height:20})}),e.jsx("td",{children:e.jsx(U,{width:60,height:20})}),e.jsx("td",{children:e.jsx(U,{width:60,height:20})}),e.jsx("td",{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(U,{width:20,height:20}),e.jsx(U,{width:20,height:20}),e.jsx(U,{width:20,height:20})]})})]},te))})]})})]}):E?e.jsxs("div",{className:"error-indicator",children:["Error: ",E]}):e.jsxs("div",{className:`pharmacy-inventory-page ${t?"embedded":""}`,style:t?{minHeight:"auto",padding:"0",background:"transparent"}:{},children:[e.jsx("div",{className:"inventory-header-controls",style:{padding:"20px 20px 0 20px"},children:e.jsxs("div",{className:"inventory-actions-group",children:[e.jsxs("div",{className:"action-group-left",style:{display:"flex",gap:"12px"},children:[e.jsxs("button",{onClick:()=>n("/dashboard/purchase"),className:"action-button-outline add-drug-button",children:[e.jsx(wa,{size:18}),"Add New Drug"]}),e.jsxs("button",{onClick:()=>n("/dashboard/purchase"),className:"action-button-outline",children:[e.jsx(wa,{size:18}),"Purchase Page"]}),e.jsxs("button",{onClick:()=>n("/dashboard/distributors"),className:"action-button-outline",children:[e.jsx(wa,{size:18}),"Distributors"]}),e.jsxs("button",{onClick:()=>d(!0),className:"action-button-outline",title:"Manage Custom Columns",children:[e.jsx(vl,{size:18}),"Columns"]})]}),e.jsxs("div",{className:"action-group-right",style:{display:"flex",gap:"12px"},children:[e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>m(!1),className:`view-mode-btn ${h?"":"active"}`,title:"List View",children:[e.jsx(Ou,{size:18})," List"]}),e.jsxs("button",{onClick:()=>m(!0),className:`view-mode-btn ${h?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(Iu,{size:18})," Excel"]})]}),e.jsx("button",{onClick:Q,className:"action-button-outline",children:"Download CSV"}),e.jsxs("button",{onClick:Me,className:"action-button-outline",children:[e.jsx(wa,{size:18}),"Import Defaults"]}),e.jsxs("button",{onClick:we,className:"action-button-outline delete-button-outline",disabled:V.size===0,children:[e.jsx(Jt,{size:18}),"Delete (",V.size,")"]}),e.jsxs("button",{onClick:L,className:"action-button-outline delete-all-button-outline",children:[e.jsx(Jt,{size:18}),"Delete All"]})]})]})}),e.jsxs("div",{className:"search-bar-container",style:{padding:"0 20px 20px 20px",borderBottom:"1px solid var(--border-color)",marginBottom:"0"},children:[e.jsxs("div",{className:"search-input-wrapper",style:{maxWidth:"600px"},children:[e.jsx(fn,{size:20,className:"search-input-icon"}),e.jsx("input",{type:"text",placeholder:"Search drugs...",value:v,onChange:te=>w(te.target.value),className:"inventory-search-input"})]}),e.jsx("div",{className:"filter-dropdown-wrapper",children:e.jsxs("select",{value:A,onChange:te=>P(te.target.value),className:"inventory-filter-select",children:[e.jsx("option",{value:"all",children:"All Drugs"}),e.jsx("option",{value:"low-stock",children:"Low Stock"}),e.jsx("option",{value:"near-expiry",children:"Near Expiry"}),e.jsx("option",{value:"expired",children:"Expired"})]})})]}),h?e.jsx("div",{className:"inventory-table-container",style:{padding:"1rem"},children:e.jsx(Mu,{title:"Pharmacy Inventory",columns:[{key:"name",label:"Drug Name",type:"text",editable:!0},{key:"brand_name",label:"Brand Name",type:"text",editable:!0},{key:"pack",label:"Pack",type:"text",editable:!0},{key:"expiry_date",label:"Expiry",type:"date",editable:!0},{key:"stock",label:"Stock",type:"number",editable:!0},{key:"mrp",label:"MRP",type:"number",editable:!0},{key:"rate",label:"Rate",type:"number",editable:!0},{key:"box_number",label:"Box",type:"text",editable:!0},{key:"discount",label:"Discount %",type:"number",editable:!0},{key:"gst",label:"GST %",type:"number",editable:!0},{key:"supplier",label:"Supplier",type:"text",editable:!0}],data:y,onSave:async te=>{try{for(const Re of te)Re.id&&await Z(`/api/drugs/${Re.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Re)});alert("Changes saved successfully!"),pe()}catch(Re){console.error("Failed to save:",Re),D(Re.message||"Failed to save changes")}},editable:!0,showRowNumbers:!0})}):e.jsx("div",{className:"inventory-table-container",children:e.jsxs("table",{className:"inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-column",children:e.jsx("input",{type:"checkbox",onChange:te=>{if(te.target.checked){const Re=new Set(y.map(lt=>lt.id));re(Re)}else re(new Set)},checked:V.size===y.length&&y.length>0,disabled:y.length===0})}),e.jsx("th",{className:"drug-name-header",children:"DRUG DETAILS"}),e.jsx("th",{className:"pack-header",children:"PACK"}),e.jsx("th",{className:"expiry-header",children:"EXPIRY"}),e.jsx("th",{className:"text-stock qty-header",children:"STOCK"}),e.jsx("th",{className:"text-price mrp-header",children:"MRP"}),e.jsx("th",{className:"text-cost rate-header",children:"RATE"}),e.jsx("th",{className:"box-number-header",children:"BOX"}),e.jsx("th",{className:"discount-header",children:"DISC %"}),e.jsx("th",{className:"margin-header",children:"MARGIN"}),e.jsx("th",{className:"actions-cell",children:"ACTIONS"})]})}),e.jsxs("tbody",{children:[y.length===0&&e.jsx("tr",{className:"no-results-message",children:e.jsx("td",{colSpan:11,children:"No drugs found matching your search."})}),ie.map(te=>e.jsxs(on.Fragment,{children:[e.jsxs("tr",{className:"drug-row",onClick:()=>{const Re=new Set(O);Re.has(te.id)&&te.id!==void 0?Re.delete(te.id):te.id!==void 0&&Re.add(te.id),M(Re)},children:[e.jsx("td",{className:"checkbox-cell",children:e.jsx("input",{type:"checkbox",onClick:Re=>Re.stopPropagation(),checked:V.has(te.id),onChange:()=>{const Re=new Set(V);Re.has(te.id)?Re.delete(te.id):Re.add(te.id),re(Re)}})}),e.jsx("td",{className:"drug-name-cell",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:te.brand_name||te.name||"-"}),te.brand_name&&te.name&&te.brand_name!==te.name&&e.jsx("span",{className:"text-xs text-muted-foreground",style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:te.name})]})}),e.jsx("td",{className:"text-muted pack-cell",children:te.pack||"-"}),e.jsx("td",{className:"text-muted",children:te.expiry_date?new Date(te.expiry_date).toLocaleDateString("en-GB"):"-"}),e.jsxs("td",{className:`text-stock ${te.stock<=Ff?"low-stock":""}`,children:[e.jsx("div",{style:{fontWeight:"bold"},children:te.stock}),e.jsx("div",{className:"loose-quantity",children:te.loose!==null&&te.loose!==void 0?`${te.loose} loose`:"0 loose"})]}),e.jsxs("td",{className:"text-muted text-price",children:["",typeof te.mrp=="number"?te.mrp.toFixed(2):"N/A"]}),e.jsx("td",{className:"text-muted text-cost",children:te.rate!==null&&te.rate!==void 0?`${te.rate.toFixed(2)}`:"-"}),e.jsx("td",{className:"text-muted",children:te.box_number||"-"}),e.jsx("td",{className:"text-muted",children:te.discount!==null&&te.discount!==void 0?`${te.discount.toFixed(2)}%`:"0.00%"}),e.jsx("td",{className:"text-muted",children:(()=>{const Re=te.mrp||0,lt=te.rate||0,Xe=te.discount||0,dt=te.gst||0,At=lt*(1-Xe/100)*(1+dt/100),Ye=Re-At;return`${(Re>0?Ye/Re*100:0).toFixed(2)}%`})()}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsx("button",{onClick:Re=>{Re.stopPropagation(),n(`/dashboard/inventory/edit/${te.id}`)},className:"action-icon-button",title:"Edit Drug",children:e.jsx(ma,{size:16})}),e.jsx("button",{onClick:Re=>{Re.stopPropagation(),ve(te)},className:"action-icon-button delete-button",title:"Delete Drug",children:e.jsx(Jt,{size:16})}),e.jsx("button",{onClick:Re=>{Re.stopPropagation(),T(te),C(!0)},className:"action-icon-button adjust-stock-button",title:"Adjust Stock",children:e.jsx(Uj,{size:16})}),e.jsx("button",{onClick:Re=>{Re.stopPropagation(),be(te)},className:"action-icon-button convert-to-loose-button",title:"Convert to Loose",disabled:!te.pack||xt(te.pack)===null,children:e.jsx(qj,{size:16})})]})})]}),O.has(te.id)&&e.jsx("tr",{className:"collapsible-row",children:e.jsx("td",{colSpan:11,children:e.jsxs("div",{className:"collapsible-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",te.description||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Supplier:"})," ",te.supplier||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Batch:"})," ",te.batch||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"HSN Code:"})," ",te.hsn_code||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"MFG:"})," ",te.mfg||"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Loose Price:"}),(()=>{const Re=xt(te.pack);return Re&&Re>0&&typeof te.mrp=="number"?`${(te.mrp/Re).toFixed(2)}`:"N/A"})()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"GST:"})," ",te.gst!==null&&te.gst!==void 0?`${te.gst.toFixed(2)}%`:"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(te.last_updated).toLocaleString()]}),c.length>0&&e.jsx("div",{className:"custom-fields-display",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px dashed var(--border-color)"},children:c.map(Re=>{var lt;return e.jsxs("p",{children:[e.jsxs("strong",{children:[Re.label,":"]})," ",(lt=te.custom_fields)!=null&&lt[Re.key]?String(te.custom_fields[Re.key]):"-"]},Re.key)})})]})})})]},te.id))]})]})}),e.jsx("div",{className:`inventory-grid-mobile ${t?"embedded":""}`,style:{display:h?"none":void 0},children:y.length===0?e.jsx("div",{className:"inventory-card-empty",children:"No drugs found matching your search."}):ie.map(te=>e.jsxs("div",{className:"inventory-card",onClick:()=>{const Re=new Set(O);Re.has(te.id)&&te.id!==void 0?Re.delete(te.id):te.id!==void 0&&Re.add(te.id),M(Re)},children:[e.jsxs("div",{className:"inventory-card-header",children:[e.jsxs("div",{className:"inventory-card-drug-info",children:[e.jsx("h4",{className:"inventory-card-drug-name",children:te.brand_name||te.name||"-"}),te.brand_name&&te.name&&te.brand_name!==te.name&&e.jsx("div",{className:"inventory-card-brand-name",children:te.name})]}),e.jsx("div",{className:"inventory-card-checkbox",onClick:Re=>Re.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:V.has(te.id),onChange:()=>{const Re=new Set(V);Re.has(te.id)?Re.delete(te.id):Re.add(te.id),re(Re)}})})]}),e.jsxs("div",{className:"inventory-card-body",children:[e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Stock"}),e.jsxs("span",{className:`inventory-card-field-value stock-value ${te.stock<=Ff?"stock-low":""}`,children:[te.stock,e.jsxs("span",{className:"inventory-card-loose",children:[" (",te.loose??0," loose)"]})]})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"MRP"}),e.jsxs("span",{className:"inventory-card-field-value price-value",children:["",typeof te.mrp=="number"?te.mrp.toFixed(2):"N/A"]})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Pack"}),e.jsx("span",{className:"inventory-card-field-value",children:te.pack||"-"})]}),e.jsxs("div",{className:"inventory-card-field",children:[e.jsx("span",{className:"inventory-card-field-label",children:"Expiry"}),e.jsx("span",{className:"inventory-card-field-value",children:te.expiry_date?new Date(te.expiry_date).toLocaleDateString("en-GB"):"-"})]})]}),O.has(te.id)&&e.jsxs("div",{className:"inventory-card-expanded",children:[e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Rate"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.rate!==null&&te.rate!==void 0?`${te.rate.toFixed(2)}`:"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Box"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.box_number||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Supplier"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.supplier||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Batch"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.batch||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"HSN Code"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.hsn_code||"-"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"Discount"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.discount!==null&&te.discount!==void 0?`${te.discount.toFixed(2)}%`:"0.00%"})]}),e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:"GST"}),e.jsx("span",{className:"inventory-card-expanded-value",children:te.gst!==null&&te.gst!==void 0?`${te.gst.toFixed(2)}%`:"-"})]}),c.length>0&&c.map(Re=>{var lt;return e.jsxs("div",{className:"inventory-card-expanded-row",children:[e.jsx("span",{className:"inventory-card-expanded-label",children:Re.label}),e.jsx("span",{className:"inventory-card-expanded-value",children:(lt=te.custom_fields)!=null&&lt[Re.key]?String(te.custom_fields[Re.key]):"-"})]},Re.key)})]}),e.jsxs("div",{className:"inventory-card-actions",onClick:Re=>Re.stopPropagation(),children:[e.jsxs("button",{className:"inventory-card-action-btn btn-edit",onClick:()=>n(`/dashboard/inventory/edit/${te.id}`),title:"Edit Drug",children:[e.jsx(ma,{size:14}),"Edit"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-delete",onClick:()=>ve(te),title:"Delete Drug",children:[e.jsx(Jt,{size:14}),"Delete"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-adjust",onClick:()=>{T(te),C(!0)},title:"Adjust Stock",children:[e.jsx(Uj,{size:14}),"Adjust"]}),e.jsxs("button",{className:"inventory-card-action-btn btn-convert",onClick:()=>be(te),title:"Convert to Loose",disabled:!te.pack||xt(te.pack)===null,children:[e.jsx(qj,{size:14}),"Loose"]})]})]},te.id))}),ce>1&&e.jsxs("div",{className:"pagination-controls",style:{padding:"20px",display:"flex",justifyContent:"center",alignItems:"center",gap:"20px",backgroundColor:"var(--card-bg, #fff)",borderTop:"1px solid var(--border-color)"},children:[e.jsx("button",{onClick:()=>k(te=>Math.max(te-1,1)),disabled:B===1,className:"pagination-button",children:"Previous"}),e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:["Page ",B," of ",ce]}),e.jsx("button",{onClick:()=>k(te=>Math.min(te+1,ce)),disabled:B===ce,className:"pagination-button",children:"Next"})]}),R&&F&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Fe,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion"}),e.jsxs("p",{className:"modal-description",children:['Are you sure you want to delete "',e.jsx("span",{className:"drug-name",children:F.name||"Unnamed Drug"}),'"? This action cannot be undone.']}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Fe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Ee,className:"button-delete",children:"Delete"})]})]})}),G&&Ae&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:We,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Adjust Stock"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:Ae.name||"Unnamed Drug"}),e.jsx("br",{}),"Current Stock: ",Ae.stock]}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("form",{onSubmit:me,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adjustment",className:"form-label",children:"Adjustment Amount"}),e.jsx("input",{type:"number",name:"adjustment",id:"adjustment",required:!0,step:"1",value:Ce===0?"":Ce,onChange:st,placeholder:"e.g., 10 or -5",className:"form-input"}),e.jsx("p",{className:"form-help-text",children:"Enter a positive number to add stock, negative to remove."})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:We,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Adjust Stock"})]})]})]})}),H&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:ne,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of All Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:"ALL"})," drugs from the inventory? This action cannot be undone."]}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:ne,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:ot,className:"button-delete",children:"Delete All"})]})]})}),xe&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Le,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Deletion of Selected Drugs"}),e.jsxs("p",{className:"modal-description",children:["Are you sure you want to delete ",e.jsx("span",{className:"drug-name",children:V.size})," selected drug(s)? This action cannot be undone."]}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Le,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:Je,className:"button-delete",children:"Delete Selected"})]})]})}),Pe&&Se&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:ue,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Convert to Loose"}),e.jsxs("p",{className:"modal-description",children:["Drug: ",e.jsx("span",{className:"drug-name",children:Se.name||"Unnamed Drug"}),e.jsx("br",{}),"Pack Size: ",Se.pack,e.jsx("br",{}),"Current Stock: ",Se.stock," packs, ",Se.loose??0," loose units."]}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("form",{onSubmit:ke,children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"packsToConvert",className:"form-label",children:"Packs to Convert"}),e.jsx("input",{type:"number",name:"packsToConvert",id:"packsToConvert",required:!0,step:"1",min:"1",max:Se.stock,value:oe===0?"":oe,onChange:je,className:"form-input"}),e.jsxs("p",{className:"form-help-text",children:["Converting ",oe," pack(s) will add ",oe*(xt(Se.pack)||0)," loose units."]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:ue,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Convert"})]})]})]})}),ge&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:De,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Confirm Add Default Medications"}),e.jsx("p",{className:"modal-description",children:"Are you sure you want to add default medications to the inventory? This will add a predefined set of common medications."}),E&&e.jsx("div",{className:"modal-error-message",children:E}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:De,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:qe,className:"button-submit",children:"Add Defaults"})]})]})}),e.jsx(Tx,{isOpen:o,onClose:()=>d(!1),entityType:"drugs",entityLabel:"Pharmacy Drugs",currentConfig:i,onConfigUpdated:()=>{l()}})]})},EO=()=>{const t=ft();return e.jsxs("div",{className:"bg-white p-3 md:p-6 rounded-lg shadow",children:[e.jsx("button",{onClick:()=>t(-1),className:"mb-4 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:"Back"}),e.jsx("h3",{className:"text-lg font-medium text-gray-800",children:"Settings"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Pharmacy settings will be configured here."})]})},kw=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState(!0),[o,d]=x.useState(null),[h,m]=x.useState(!1),[f,g]=x.useState(!1),y=x.useRef(null),b=x.useRef(null),v=x.useRef(null),w=x.useCallback(async()=>{if(!t){d("Drug ID is missing."),c(!1);return}c(!0),d(null);try{const D=await Z(`/api/drugs/${t}`);if(!D.ok){const M=await D.json();throw new Error(M.message||`Failed to fetch drug: ${D.statusText}`)}let O=await D.json();O={...O,name:O.name||"",brand_name:O.brand_name||"",mrp:parseFloat(String(O.mrp))||0,rate:O.rate!==null&&O.rate!==void 0?parseFloat(String(O.rate)):null,stock:parseInt(String(O.stock),10)||0,gst:O.gst!==null&&O.gst!==void 0?parseFloat(String(O.gst)):null,margin:O.margin!==null&&O.margin!==void 0?parseFloat(String(O.margin)):null,discount:O.discount!==null&&O.discount!==void 0?parseFloat(String(O.discount)):null,batch:O.batch||"",hsn_code:O.hsn_code||"",mfg:O.mfg||"",loose:O.loose!==null&&O.loose!==void 0?parseInt(String(O.loose),10):null},i(O)}catch(D){console.error("Failed to fetch drug:",D),d(D.message||"Failed to load drug data. Please try again.")}finally{c(!1)}},[t]);x.useEffect(()=>{w()},[w]),x.useEffect(()=>{const D=M=>{M.key==="Tab"&&b.current===document.activeElement&&(f||(g(!0),setTimeout(()=>{var A;(A=v.current)==null||A.focus()},0),M.preventDefault()))},O=M=>{y.current&&!y.current.contains(M.target)&&g(!1)};return document.addEventListener("keydown",D),document.addEventListener("mousedown",O),()=>{document.removeEventListener("keydown",D),document.removeEventListener("mousedown",O)}},[f]);const S=D=>{const{name:O,value:M,type:A}=D.target;i(P=>P?{...P,[O]:A==="number"?parseFloat(M)||null:M}:null)},_=()=>{a(-1)},E=async D=>{if(D.preventDefault(),d(null),m(!0),!n||!n.id){d("Cannot edit drug: No drug data available."),m(!1);return}if(n.mrp===void 0||n.stock===void 0){d("MRP and Stock Quantity are required."),m(!1);return}const O={...n,name:n.name===""?null:n.name,brand_name:n.brand_name===""?null:n.brand_name,rate:n.rate===0?null:n.rate,expiry_date:n.expiry_date===""?null:n.expiry_date,gst:n.gst===0?null:n.gst,margin:n.margin===0?null:n.margin,discount:n.discount===0?null:n.discount,batch:n.batch===""?null:n.batch,hsn_code:n.hsn_code===""?null:n.hsn_code,mfg:n.mfg===""?null:n.mfg,loose:n.loose===0?null:n.loose};try{const M=await Z(`/api/drugs/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!M.ok){const P=await M.json();throw new Error(P.message||`Failed to update drug: ${M.statusText}`)}const A=await M.json();alert(`Drug "${A.name}" updated successfully!`),a(-1)}catch(M){console.error("Failed to update drug:",M),d(M.message||"Failed to update drug. Please try again.")}finally{m(!1)}};return l?e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"loading-message",children:"Loading drug data..."})}):o&&!n?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"error-message-load",children:["Error: ",o]})}):n?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"edit-drug-form-container",children:[e.jsxs("div",{className:"edit-drug-form-header",children:[e.jsxs("h2",{children:["Edit Drug: ",n.name]}),e.jsx("button",{onClick:_,className:"cancel-button",title:"Go Back",children:e.jsx(St,{size:24})})]}),o&&e.jsx("div",{className:"error-message-submit",children:o}),e.jsxs("form",{onSubmit:E,className:"edit-drug-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-name",className:"form-label",children:"Composition Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"name",id:"edit-name",value:n.name||"",onChange:S,className:"custom-text-input",placeholder:"e.g., Paracetamol",tabIndex:1})," "]}),e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-brand_name",className:"form-label",children:"Brand Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"brand_name",id:"edit-brand_name",value:n.brand_name||"",onChange:S,className:"custom-text-input",placeholder:"e.g., Calpol",tabIndex:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-mrp",className:"form-label",children:"MRP () *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),e.jsx("input",{type:"number",name:"mrp",id:"edit-mrp",required:!0,step:"0.01",min:"0",value:n.mrp||"",onChange:S,className:"custom-text-input",placeholder:"e.g., 500",tabIndex:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-stock",className:"form-label",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),e.jsx("input",{type:"number",name:"stock",id:"edit-stock",required:!0,step:"1",min:"0",value:n.stock||"",onChange:S,className:"custom-text-input",placeholder:"e.g., 5",tabIndex:4})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-pack",className:"form-label",children:"Pack (e.g., strip, bottle)"}),e.jsx("input",{type:"text",name:"pack",id:"edit-pack",value:n.pack||"",onChange:S,className:"custom-text-input",placeholder:"e.g., strip, bottle",tabIndex:5})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-expiry_date",className:"form-label",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",id:"edit-expiry_date",value:n.expiry_date||"",onChange:S,className:"custom-text-input",tabIndex:6})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-box_number",className:"form-label",children:"Box Number"}),e.jsx("input",{type:"text",name:"box_number",id:"edit-box_number",value:n.box_number||"",onChange:S,className:"custom-text-input",tabIndex:7})]}),e.jsxs("div",{className:"relative sm-col-span-2",ref:y,children:[e.jsx("button",{type:"button",onClick:()=>g(!f),className:"form-button w-full text-left",tabIndex:8,ref:b,children:"Others"}),f&&e.jsxs("div",{className:"others-fields-grid",children:[" ",e.jsxs("div",{className:"sm-col-span-2",children:[e.jsx("label",{htmlFor:"edit-description",className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",id:"edit-description",rows:3,value:n.description||"",onChange:S,className:"custom-text-input",tabIndex:9})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-supplier",className:"form-label",children:"Supplier"}),e.jsx("input",{type:"text",name:"supplier",id:"edit-supplier",value:n.supplier||"",onChange:S,className:"custom-text-input",placeholder:"Optional",tabIndex:10})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-rate",className:"form-label",children:"Rate ()"}),e.jsx("input",{type:"number",name:"rate",id:"edit-rate",step:"0.01",min:"0",value:n.rate??"",onChange:S,placeholder:"Optional",className:"custom-text-input",tabIndex:11,ref:v})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-gst",className:"form-label",children:"GST (%)"}),e.jsx("input",{type:"number",name:"gst",id:"edit-gst",step:"0.01",min:"0",max:"100",value:n.gst??"",onChange:S,placeholder:"Optional",className:"custom-text-input",tabIndex:12})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-margin",className:"form-label",children:"Margin (%)"}),e.jsx("input",{type:"number",name:"margin",id:"edit-margin",step:"0.01",min:"0",max:"100",value:n.margin??"",onChange:S,placeholder:"Optional",className:"custom-text-input",tabIndex:13})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-discount",className:"form-label",children:"Discount (%)"}),e.jsx("input",{type:"number",name:"discount",id:"edit-discount",step:"0.01",min:"0",max:"100",value:n.discount??"",onChange:S,placeholder:"Optional",className:"custom-text-input",tabIndex:14})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-batch",className:"form-label",children:"Batch"}),e.jsx("input",{type:"text",name:"batch",id:"edit-batch",value:n.batch||"",onChange:S,className:"custom-text-input",placeholder:"Optional",tabIndex:15})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-hsn_code",className:"form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsn_code",id:"edit-hsn_code",value:n.hsn_code||"",onChange:S,className:"custom-text-input",placeholder:"Optional",tabIndex:16})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-mfg",className:"form-label",children:"MFG"}),e.jsx("input",{type:"text",name:"mfg",id:"edit-mfg",value:n.mfg||"",onChange:S,className:"custom-text-input",placeholder:"Optional",tabIndex:17})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-loose",className:"form-label",children:"Loose"}),e.jsx("input",{type:"number",name:"loose",id:"edit-loose",step:"1",min:"0",value:n.loose??"",onChange:S,placeholder:"Optional",className:"custom-text-input",tabIndex:18})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:_,disabled:h,className:"form-button cancel-form-button",tabIndex:19,children:"Back"}),e.jsx("button",{type:"submit",disabled:h,className:"form-button submit-form-button",tabIndex:20,children:h?"Saving...":"Save Changes"})]})]})]})}):e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"not-found-message",children:"Drug not found."})})},Fg=()=>{const t=ft(),[a,n]=x.useState({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState(null),[m,f]=x.useState([]),[g,y]=x.useState(!0);us(),x.useEffect(()=>{(async()=>{y(!0);try{const S=await Z("/api/staff?role=doctor");if(!S.ok)throw new Error("Failed to fetch doctors");const _=await S.json();f(_),_.length>0&&n(E=>({...E,doctorId:""}))}catch(S){console.error("Error fetching doctors:",S),o(`Failed to load doctors: ${S.message}`)}finally{y(!1)}})()},[]);const b=w=>{const{name:S,value:_}=w.target;n(E=>({...E,[S]:_}))},v=async w=>{var S;w.preventDefault(),o(null),h(null),l(!0);try{let _,E;console.log("Registering new patient...");const D=await Z("/api/patients",{method:"POST",body:JSON.stringify({name:a.name,age:a.age?parseInt(a.age,10):null,gender:a.gender||null,phone:a.phone||null})});if(!D.ok){const Q=await D.json();if(D.status===403&&Q.message.includes("Patient limit")){t("/start-clinic-subscription",{state:{errorMessage:Q.message}});return}throw new Error(Q.message||"Failed to register patient")}const O=await D.json();_=O.id,E=O.name,console.log(`New patient ${_} registered.`);const M=a.doctorId||null;console.log(`Adding patient ${_} to queue for doctor ${M||"Unassigned"}`);const A=await Z("/api/queue",{method:"POST",body:JSON.stringify({patientId:_,complaint:a.complaint||null,doctorId:M})});if(!A.ok){const Q=await A.json();throw new Error(Q.message||"Failed to add patient to queue")}const P=await A.json();if(console.log(`Patient added to queue, entry ID: ${P.id}`),n({name:"",age:"",gender:"",phone:"",complaint:"",doctorId:""}),M){const Q=((S=m.find(C=>C.id===M))==null?void 0:S.name)||"Selected Doctor",G=`Patient "${E}" registered and added to queue for Dr. ${Q}. Redirecting to billing...`;h(G),t("/billing",{state:{patientId:_,queueId:P.id,patientName:E,doctorId:M,billType:"consultation"}})}else{const Q=`Patient "${E}" registered and added to the general queue.`;h(Q)}}catch(_){console.error("Error in add/queue process:",_),_.message.includes("Patient limit")?(o(`Operation failed: ${_.message}. Please upgrade your plan.`),t("/start-clinic-subscription")):o(`Operation failed: ${_.message}`)}finally{l(!1)}};return e.jsxs("div",{className:"add-patient-page-container flex flex-col items-center justify-start",children:[e.jsxs("div",{className:"w-full max-w-3xl mb-2 flex justify-start",children:[" ",e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Back to Previous Page",children:[e.jsx(Et,{size:20,className:"btn-icon"})," Back"]})]}),e.jsxs("div",{className:"add-patient-card",children:[e.jsxs("h3",{className:"add-patient-title",children:[e.jsx(Xh,{size:28})," ","Register New Patient & Add to Queue"]}),c&&e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:c})]}),d&&e.jsxs("div",{className:"alert alert-success",role:"alert",children:[e.jsx("strong",{children:"Success: "}),e.jsx("span",{children:d})]}),e.jsxs("form",{onSubmit:v,className:"space-y-5",children:[" ",e.jsxs("fieldset",{className:"form-fieldset",children:[e.jsx("legend",{children:"New Patient Details"}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",value:a.name,onChange:b,className:"form-input",required:!0,disabled:i})]}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Age"}),e.jsx("input",{type:"number",name:"age",value:a.age,onChange:b,className:"form-input",min:"0",disabled:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Gender"}),e.jsxs("select",{name:"gender",value:a.gender,onChange:b,className:"form-select",disabled:i,children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{type:"tel",name:"phone",value:a.phone,onChange:b,className:"form-input",disabled:i})]})]})]}),e.jsxs("fieldset",{className:"form-fieldset",children:[e.jsx("legend",{children:"Visit Details"}),e.jsxs("div",{className:"form-grid form-grid-cols-2",children:[" ",e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Assign Doctor (Optional)"}),g?e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}}):e.jsxs("select",{name:"doctorId",value:a.doctorId,onChange:b,className:"form-select",disabled:i,children:[e.jsx("option",{value:"",children:m.length===0?"No doctors available":"-- No Doctor (Add to General Queue) --"}),m.map(w=>e.jsx("option",{value:w.id,children:w.name},w.id))]}),m.length===0&&!g&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Please add doctors via the Admin Panel."})]}),e.jsxs("div",{className:"form-grid-col-span-2",children:[" ",e.jsx("label",{className:"form-label",children:"Patient Data / Reason"}),e.jsx("textarea",{name:"complaint",value:a.complaint,onChange:b,rows:2,className:"form-textarea",disabled:i})]})]})]}),e.jsxs("div",{className:"flex justify-end pt-2",children:[" ",e.jsxs("button",{type:"submit",className:`btn btn-primary ${i||g?"disabled":""}`,disabled:i||g,children:[e.jsx(ax,{size:18,className:"btn-icon"}),i?"Processing...":"Register & Add to Queue"]})]})]})]})]})},TO=({clinicId:t})=>{const a=ft(),[n,i]=x.useState({name:"",email:"",role:"receptionist",password:"",opd_fee:""}),[l,c]=x.useState(null),[o,d]=x.useState(!1),[h,m]=x.useState([]),[f,g]=x.useState(!0),y=async()=>{try{const S=await Z("/api/clinic-roles");if(S.ok){const _=await S.json();m(_)}}catch(S){console.error("Failed to fetch roles:",S)}finally{g(!1)}};x.useEffect(()=>{c(t?null:"Clinic information is missing. Cannot add staff. Please ensure you are logged in correctly."),y()},[t]);const b=S=>{const{name:_,value:E}=S.target;i(D=>{const O={...D,[_]:E};return _==="role"&&E!=="doctor"&&(O.opd_fee=""),O})},v=async S=>{if(S.preventDefault(),c(null),!n.name||!n.email||!n.role||!n.password){c("Name, Email, Role, and Password are required.");return}if(!t){c("Clinic information is missing. Cannot add staff.");return}const _={...n,clinic_id:t,opd_fee:n.role==="doctor"&&n.opd_fee?parseFloat(String(n.opd_fee)):null};if(_.role==="doctor"&&n.opd_fee&&isNaN(_.opd_fee)){c("Invalid OPD Fee format. Please enter a number.");return}d(!0);try{const E=await Z("/api/staff",{method:"POST",body:JSON.stringify(_)});if(!E.ok){const D=await E.json();throw new Error(D.message||"Server responded with an error")}a(-1)}catch(E){c(`Failed to add staff: ${E.message}`)}finally{d(!1)}},w=()=>{a(-1)};return e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:w,className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(Et,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{children:"Add New Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),l&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),l]}),e.jsxs("form",{onSubmit:v,className:`staff-form ${t?"":"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{id:"name",type:"text",name:"name",value:n.name||"",onChange:b,required:!0,disabled:o||!t,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",name:"email",value:n.email||"",onChange:b,required:!0,disabled:o||!t,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Assign Role"}),e.jsx("select",{id:"role",name:"role",value:n.role||"receptionist",onChange:b,required:!0,disabled:o||!t||f,children:f?e.jsx("option",{value:"",children:"Loading roles..."}):h.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"}),e.jsx("option",{value:"lab",children:"Lab Technician"})]}):h.map(S=>e.jsx("option",{value:S.key,children:S.name},S.key))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Set Initial Password"}),e.jsx("input",{id:"password",type:"password",name:"password",value:n.password||"",onChange:b,required:!0,disabled:o||!t,placeholder:"Create a password"})]}),n.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Consultation Fee () (Optional)"}),e.jsx("input",{id:"opd_fee",type:"number",name:"opd_fee",value:n.opd_fee||"",onChange:b,step:"0.01",min:"0",placeholder:"e.g., 150.00",disabled:o||!t}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank if no specific fee is set for this doctor."})]}),e.jsxs("button",{type:"submit",disabled:o||!t,children:[o?e.jsx(Ci,{size:18,className:"animate-spin mr-2"}):e.jsx(bn,{size:18,className:"mr-2"}),o?"Adding...":"Add Staff Member"]})]})]})},AO=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState({name:"",email:"",role:"receptionist",opd_fee:"",active:!0}),[l,c]=x.useState(""),[o,d]=x.useState(!0),[h,m]=x.useState(!1),[f,g]=x.useState(null),[y,b]=x.useState(null),[v,w]=x.useState([]),[S,_]=x.useState(!0),E=async()=>{try{const P=await Z("/api/clinic-roles");if(P.ok){const Q=await P.json();w(Q)}}catch(P){console.error("Failed to fetch roles:",P)}finally{_(!1)}},D=x.useCallback(async()=>{if(!t){g("Staff ID is missing."),d(!1);return}d(!0),g(null),b(null);try{const P=await Z(`/staff/${t}`);if(!P.ok){const G=await P.json();throw new Error(G.message||`HTTP error! status: ${P.status}`)}const Q=await P.json();i({name:Q.name,email:Q.email,role:Q.role,opd_fee:Q.opd_fee??"",active:Q.active})}catch(P){g(`Failed to load staff details: ${P.message}`)}finally{d(!1)}},[t]);x.useEffect(()=>{D(),E()},[D]);const O=P=>{const{name:Q,value:G,type:C}=P.target;if(C==="checkbox"){const{checked:R}=P.target;i(z=>({...z,[Q]:R}))}else i(R=>({...R,[Q]:G}))},M=P=>{c(P.target.value)},A=async P=>{if(P.preventDefault(),!t){g("Staff ID is missing.");return}m(!0),g(null),b(null);const Q={name:n.name,email:n.email,role:n.role,active:n.active};if(n.role==="doctor"){const G=n.opd_fee?parseFloat(String(n.opd_fee)):null;if(G!==null&&isNaN(G)){g("OPD Fee must be a valid number."),m(!1);return}Q.opd_fee=G}else Q.opd_fee=null;l.trim()!==""&&(Q.password=l.trim());try{const G=await Z(`/staff/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!G.ok){const C=await G.json();throw new Error(C.message||`HTTP error! status: ${G.status}`)}b("Staff details updated successfully!"),c(""),setTimeout(()=>a(-1),1500)}catch(G){g(`Failed to update staff: ${G.message}`)}finally{m(!1)}};return o?e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx(Ci,{className:"h-12 w-12 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-4 text-xl text-gray-700",children:"Loading Staff Details..."})]}):e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>a(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(Et,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),f&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),f,e.jsx("button",{onClick:()=>g(null),className:"ml-auto text-red-600 hover:text-red-800 text-xl font-bold",children:""})]}),y&&e.jsxs("div",{className:"success-message mb-4 p-3 bg-green-100 border border-green-400 rounded-md flex items-center",children:[e.jsx(ka,{size:18,className:"mr-2 text-green-500"}),y,e.jsx("button",{onClick:()=>b(null),className:"ml-auto text-green-600 hover:text-green-800 text-xl font-bold",children:""})]}),e.jsxs("form",{onSubmit:A,className:"staff-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name||"",onChange:O,required:!0,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:n.email||"",onChange:O,required:!0,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"role",name:"role",value:n.role||"receptionist",onChange:O,required:!0,disabled:S,children:S?e.jsx("option",{value:"",children:"Loading roles..."}):v.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"lab",children:"Lab Technician"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"})]}):v.map(P=>e.jsx("option",{value:P.key,children:P.name},P.key))})]}),n.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Fee ()"}),e.jsx("input",{type:"number",id:"opd_fee",name:"opd_fee",value:n.opd_fee||"",onChange:O,min:"0",step:"0.01",placeholder:"Enter OPD consultation fee (optional)"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{id:"active",name:"active",type:"checkbox",checked:n.active??!0,onChange:O}),e.jsxs("label",{htmlFor:"active",className:"mb-0",children:[" ","Account Active"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"New Password (optional)"}),e.jsx("input",{type:"password",id:"password",name:"password",value:l,onChange:M,placeholder:"Leave blank to keep current password",autoComplete:"new-password"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter a new password only if you want to change it. Minimum 6 characters."})]}),e.jsx("button",{type:"submit",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ci,{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{size:16,className:"mr-2"}),"Save Changes"]})})]})]})},PO={};function Rx(t,a){const n=PO,i=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,l=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Cw(t,i,l)}function Cw(t,a,n){if(RO(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(a&&"alt"in t&&t.alt)return t.alt;if("children"in t)return f0(t.children,a,n)}return Array.isArray(t)?f0(t,a,n):""}function f0(t,a,n){const i=[];let l=-1;for(;++l<t.length;)i[l]=Cw(t[l],a,n);return i.join("")}function RO(t){return!!(t&&typeof t=="object")}const g0=document.createElement("i");function Ox(t){const a="&"+t+";";g0.innerHTML=a;const n=g0.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===a?!1:n}function Xs(t,a,n,i){const l=t.length;let c=0,o;if(a<0?a=-a>l?0:l+a:a=a>l?l:a,n=n>0?n:0,i.length<1e4)o=Array.from(i),o.unshift(a,n),t.splice(...o);else for(n&&t.splice(a,n);c<i.length;)o=i.slice(c,c+1e4),o.unshift(a,0),t.splice(...o),c+=1e4,a+=1e4}function os(t,a){return t.length>0?(Xs(t,t.length,0,a),t):a}const x0={}.hasOwnProperty;function OO(t){const a={};let n=-1;for(;++n<t.length;)IO(a,t[n]);return a}function IO(t,a){let n;for(n in a){const l=(x0.call(t,n)?t[n]:void 0)||(t[n]={}),c=a[n];let o;if(c)for(o in c){x0.call(l,o)||(l[o]=[]);const d=c[o];zO(l[o],Array.isArray(d)?d:d?[d]:[])}}}function zO(t,a){let n=-1;const i=[];for(;++n<a.length;)(a[n].add==="after"?t:i).push(a[n]);Xs(t,0,0,i)}function _w(t,a){const n=Number.parseInt(t,a);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function Po(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Js=Ar(/[A-Za-z]/),Va=Ar(/[\dA-Za-z]/),FO=Ar(/[#-'*+\--9=?A-Z^-~]/);function Lg(t){return t!==null&&(t<32||t===127)}const $g=Ar(/\d/),LO=Ar(/[\dA-Fa-f]/),$O=Ar(/[!-/:-@[-`{-~]/);function Dt(t){return t!==null&&t<-2}function Sa(t){return t!==null&&(t<0||t===32)}function Wt(t){return t===-2||t===-1||t===32}const MO=Ar(new RegExp("\\p{P}|\\p{S}","u")),BO=Ar(/\s/);function Ar(t){return a;function a(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Yo(t){const a=[];let n=-1,i=0,l=0;for(;++n<t.length;){const c=t.charCodeAt(n);let o="";if(c===37&&Va(t.charCodeAt(n+1))&&Va(t.charCodeAt(n+2)))l=2;else if(c<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(c))||(o=String.fromCharCode(c));else if(c>55295&&c<57344){const d=t.charCodeAt(n+1);c<56320&&d>56319&&d<57344?(o=String.fromCharCode(c,d),l=1):o=""}else o=String.fromCharCode(c);o&&(a.push(t.slice(i,n),encodeURIComponent(o)),i=n+l+1,o=""),l&&(n+=l,l=0)}return a.join("")+t.slice(i)}function pn(t,a,n,i){const l=i?i-1:Number.POSITIVE_INFINITY;let c=0;return o;function o(h){return Wt(h)?(t.enter(n),d(h)):a(h)}function d(h){return Wt(h)&&c++<l?(t.consume(h),d):(t.exit(n),a(h))}}const UO={tokenize:qO};function qO(t){const a=t.attempt(this.parser.constructs.contentInitial,i,l);let n;return a;function i(d){if(d===null){t.consume(d);return}return t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),pn(t,a,"linePrefix")}function l(d){return t.enter("paragraph"),c(d)}function c(d){const h=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=h),n=h,o(d)}function o(d){if(d===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(d);return}return Dt(d)?(t.consume(d),t.exit("chunkText"),c):(t.consume(d),o)}}const HO={tokenize:VO},y0={tokenize:GO};function VO(t){const a=this,n=[];let i=0,l,c,o;return d;function d(D){if(i<n.length){const O=n[i];return a.containerState=O[1],t.attempt(O[0].continuation,h,m)(D)}return m(D)}function h(D){if(i++,a.containerState._closeFlow){a.containerState._closeFlow=void 0,l&&E();const O=a.events.length;let M=O,A;for(;M--;)if(a.events[M][0]==="exit"&&a.events[M][1].type==="chunkFlow"){A=a.events[M][1].end;break}_(i);let P=O;for(;P<a.events.length;)a.events[P][1].end={...A},P++;return Xs(a.events,M+1,0,a.events.slice(O)),a.events.length=P,m(D)}return d(D)}function m(D){if(i===n.length){if(!l)return y(D);if(l.currentConstruct&&l.currentConstruct.concrete)return v(D);a.interrupt=!!(l.currentConstruct&&!l._gfmTableDynamicInterruptHack)}return a.containerState={},t.check(y0,f,g)(D)}function f(D){return l&&E(),_(i),y(D)}function g(D){return a.parser.lazy[a.now().line]=i!==n.length,o=a.now().offset,v(D)}function y(D){return a.containerState={},t.attempt(y0,b,v)(D)}function b(D){return i++,n.push([a.currentConstruct,a.containerState]),y(D)}function v(D){if(D===null){l&&E(),_(0),t.consume(D);return}return l=l||a.parser.flow(a.now()),t.enter("chunkFlow",{_tokenizer:l,contentType:"flow",previous:c}),w(D)}function w(D){if(D===null){S(t.exit("chunkFlow"),!0),_(0),t.consume(D);return}return Dt(D)?(t.consume(D),S(t.exit("chunkFlow")),i=0,a.interrupt=void 0,d):(t.consume(D),w)}function S(D,O){const M=a.sliceStream(D);if(O&&M.push(null),D.previous=c,c&&(c.next=D),c=D,l.defineSkip(D.start),l.write(M),a.parser.lazy[D.start.line]){let A=l.events.length;for(;A--;)if(l.events[A][1].start.offset<o&&(!l.events[A][1].end||l.events[A][1].end.offset>o))return;const P=a.events.length;let Q=P,G,C;for(;Q--;)if(a.events[Q][0]==="exit"&&a.events[Q][1].type==="chunkFlow"){if(G){C=a.events[Q][1].end;break}G=!0}for(_(i),A=P;A<a.events.length;)a.events[A][1].end={...C},A++;Xs(a.events,Q+1,0,a.events.slice(P)),a.events.length=A}}function _(D){let O=n.length;for(;O-- >D;){const M=n[O];a.containerState=M[1],M[0].exit.call(a,t)}n.length=D}function E(){l.write([null]),c=void 0,l=void 0,a.containerState._closeFlow=void 0}}function GO(t,a,n){return pn(t,t.attempt(this.parser.constructs.document,a,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Gh(t){if(t===null||Sa(t)||BO(t))return 1;if(MO(t))return 2}function Ix(t,a,n){const i=[];let l=-1;for(;++l<t.length;){const c=t[l].resolveAll;c&&!i.includes(c)&&(a=c(a,n),i.push(c))}return a}const Mg={name:"attention",resolveAll:QO,tokenize:YO};function QO(t,a){let n=-1,i,l,c,o,d,h,m,f;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(i=n;i--;)if(t[i][0]==="exit"&&t[i][1].type==="attentionSequence"&&t[i][1]._open&&a.sliceSerialize(t[i][1]).charCodeAt(0)===a.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[i][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[i][1].end.offset-t[i][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;h=t[i][1].end.offset-t[i][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const g={...t[i][1].end},y={...t[n][1].start};b0(g,-h),b0(y,h),o={type:h>1?"strongSequence":"emphasisSequence",start:g,end:{...t[i][1].end}},d={type:h>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:y},c={type:h>1?"strongText":"emphasisText",start:{...t[i][1].end},end:{...t[n][1].start}},l={type:h>1?"strong":"emphasis",start:{...o.start},end:{...d.end}},t[i][1].end={...o.start},t[n][1].start={...d.end},m=[],t[i][1].end.offset-t[i][1].start.offset&&(m=os(m,[["enter",t[i][1],a],["exit",t[i][1],a]])),m=os(m,[["enter",l,a],["enter",o,a],["exit",o,a],["enter",c,a]]),m=os(m,Ix(a.parser.constructs.insideSpan.null,t.slice(i+1,n),a)),m=os(m,[["exit",c,a],["enter",d,a],["exit",d,a],["exit",l,a]]),t[n][1].end.offset-t[n][1].start.offset?(f=2,m=os(m,[["enter",t[n][1],a],["exit",t[n][1],a]])):f=0,Xs(t,i-1,n-i+3,m),n=i+m.length-f-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function YO(t,a){const n=this.parser.constructs.attentionMarkers.null,i=this.previous,l=Gh(i);let c;return o;function o(h){return c=h,t.enter("attentionSequence"),d(h)}function d(h){if(h===c)return t.consume(h),d;const m=t.exit("attentionSequence"),f=Gh(h),g=!f||f===2&&l||n.includes(h),y=!l||l===2&&f||n.includes(i);return m._open=!!(c===42?g:g&&(l||!y)),m._close=!!(c===42?y:y&&(f||!g)),a(h)}}function b0(t,a){t.column+=a,t.offset+=a,t._bufferIndex+=a}const JO={name:"autolink",tokenize:KO};function KO(t,a,n){let i=0;return l;function l(b){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),c}function c(b){return Js(b)?(t.consume(b),o):b===64?n(b):m(b)}function o(b){return b===43||b===45||b===46||Va(b)?(i=1,d(b)):m(b)}function d(b){return b===58?(t.consume(b),i=0,h):(b===43||b===45||b===46||Va(b))&&i++<32?(t.consume(b),d):(i=0,m(b))}function h(b){return b===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.exit("autolink"),a):b===null||b===32||b===60||Lg(b)?n(b):(t.consume(b),h)}function m(b){return b===64?(t.consume(b),f):FO(b)?(t.consume(b),m):n(b)}function f(b){return Va(b)?g(b):n(b)}function g(b){return b===46?(t.consume(b),i=0,f):b===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(b),t.exit("autolinkMarker"),t.exit("autolink"),a):y(b)}function y(b){if((b===45||Va(b))&&i++<63){const v=b===45?y:g;return t.consume(b),v}return n(b)}}const mm={partial:!0,tokenize:WO};function WO(t,a,n){return i;function i(c){return Wt(c)?pn(t,l,"linePrefix")(c):l(c)}function l(c){return c===null||Dt(c)?a(c):n(c)}}const Dw={continuation:{tokenize:ZO},exit:eI,name:"blockQuote",tokenize:XO};function XO(t,a,n){const i=this;return l;function l(o){if(o===62){const d=i.containerState;return d.open||(t.enter("blockQuote",{_container:!0}),d.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(o),t.exit("blockQuoteMarker"),c}return n(o)}function c(o){return Wt(o)?(t.enter("blockQuotePrefixWhitespace"),t.consume(o),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),a):(t.exit("blockQuotePrefix"),a(o))}}function ZO(t,a,n){const i=this;return l;function l(o){return Wt(o)?pn(t,c,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):c(o)}function c(o){return t.attempt(Dw,a,n)(o)}}function eI(t){t.exit("blockQuote")}const Ew={name:"characterEscape",tokenize:tI};function tI(t,a,n){return i;function i(c){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(c),t.exit("escapeMarker"),l}function l(c){return $O(c)?(t.enter("characterEscapeValue"),t.consume(c),t.exit("characterEscapeValue"),t.exit("characterEscape"),a):n(c)}}const Tw={name:"characterReference",tokenize:nI};function nI(t,a,n){const i=this;let l=0,c,o;return d;function d(g){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),h}function h(g){return g===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(g),t.exit("characterReferenceMarkerNumeric"),m):(t.enter("characterReferenceValue"),c=31,o=Va,f(g))}function m(g){return g===88||g===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(g),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),c=6,o=LO,f):(t.enter("characterReferenceValue"),c=7,o=$g,f(g))}function f(g){if(g===59&&l){const y=t.exit("characterReferenceValue");return o===Va&&!Ox(i.sliceSerialize(y))?n(g):(t.enter("characterReferenceMarker"),t.consume(g),t.exit("characterReferenceMarker"),t.exit("characterReference"),a)}return o(g)&&l++<c?(t.consume(g),f):n(g)}}const j0={partial:!0,tokenize:sI},v0={concrete:!0,name:"codeFenced",tokenize:aI};function aI(t,a,n){const i=this,l={partial:!0,tokenize:M};let c=0,o=0,d;return h;function h(A){return m(A)}function m(A){const P=i.events[i.events.length-1];return c=P&&P[1].type==="linePrefix"?P[2].sliceSerialize(P[1],!0).length:0,d=A,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),f(A)}function f(A){return A===d?(o++,t.consume(A),f):o<3?n(A):(t.exit("codeFencedFenceSequence"),Wt(A)?pn(t,g,"whitespace")(A):g(A))}function g(A){return A===null||Dt(A)?(t.exit("codeFencedFence"),i.interrupt?a(A):t.check(j0,w,O)(A)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),y(A))}function y(A){return A===null||Dt(A)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),g(A)):Wt(A)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),pn(t,b,"whitespace")(A)):A===96&&A===d?n(A):(t.consume(A),y)}function b(A){return A===null||Dt(A)?g(A):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),v(A))}function v(A){return A===null||Dt(A)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),g(A)):A===96&&A===d?n(A):(t.consume(A),v)}function w(A){return t.attempt(l,O,S)(A)}function S(A){return t.enter("lineEnding"),t.consume(A),t.exit("lineEnding"),_}function _(A){return c>0&&Wt(A)?pn(t,E,"linePrefix",c+1)(A):E(A)}function E(A){return A===null||Dt(A)?t.check(j0,w,O)(A):(t.enter("codeFlowValue"),D(A))}function D(A){return A===null||Dt(A)?(t.exit("codeFlowValue"),E(A)):(t.consume(A),D)}function O(A){return t.exit("codeFenced"),a(A)}function M(A,P,Q){let G=0;return C;function C(H){return A.enter("lineEnding"),A.consume(H),A.exit("lineEnding"),R}function R(H){return A.enter("codeFencedFence"),Wt(H)?pn(A,z,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):z(H)}function z(H){return H===d?(A.enter("codeFencedFenceSequence"),F(H)):Q(H)}function F(H){return H===d?(G++,A.consume(H),F):G>=o?(A.exit("codeFencedFenceSequence"),Wt(H)?pn(A,J,"whitespace")(H):J(H)):Q(H)}function J(H){return H===null||Dt(H)?(A.exit("codeFencedFence"),P(H)):Q(H)}}}function sI(t,a,n){const i=this;return l;function l(o){return o===null?n(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),c)}function c(o){return i.parser.lazy[i.now().line]?n(o):a(o)}}const Lf={name:"codeIndented",tokenize:rI},iI={partial:!0,tokenize:lI};function rI(t,a,n){const i=this;return l;function l(m){return t.enter("codeIndented"),pn(t,c,"linePrefix",5)(m)}function c(m){const f=i.events[i.events.length-1];return f&&f[1].type==="linePrefix"&&f[2].sliceSerialize(f[1],!0).length>=4?o(m):n(m)}function o(m){return m===null?h(m):Dt(m)?t.attempt(iI,o,h)(m):(t.enter("codeFlowValue"),d(m))}function d(m){return m===null||Dt(m)?(t.exit("codeFlowValue"),o(m)):(t.consume(m),d)}function h(m){return t.exit("codeIndented"),a(m)}}function lI(t,a,n){const i=this;return l;function l(o){return i.parser.lazy[i.now().line]?n(o):Dt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),l):pn(t,c,"linePrefix",5)(o)}function c(o){const d=i.events[i.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?a(o):Dt(o)?l(o):n(o)}}const oI={name:"codeText",previous:uI,resolve:cI,tokenize:dI};function cI(t){let a=t.length-4,n=3,i,l;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[a][1].type==="lineEnding"||t[a][1].type==="space")){for(i=n;++i<a;)if(t[i][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[a][1].type="codeTextPadding",n+=2,a-=2;break}}for(i=n-1,a++;++i<=a;)l===void 0?i!==a&&t[i][1].type!=="lineEnding"&&(l=i):(i===a||t[i][1].type==="lineEnding")&&(t[l][1].type="codeTextData",i!==l+2&&(t[l][1].end=t[i-1][1].end,t.splice(l+2,i-l-2),a-=i-l-2,i=l+2),l=void 0);return t}function uI(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function dI(t,a,n){let i=0,l,c;return o;function o(g){return t.enter("codeText"),t.enter("codeTextSequence"),d(g)}function d(g){return g===96?(t.consume(g),i++,d):(t.exit("codeTextSequence"),h(g))}function h(g){return g===null?n(g):g===32?(t.enter("space"),t.consume(g),t.exit("space"),h):g===96?(c=t.enter("codeTextSequence"),l=0,f(g)):Dt(g)?(t.enter("lineEnding"),t.consume(g),t.exit("lineEnding"),h):(t.enter("codeTextData"),m(g))}function m(g){return g===null||g===32||g===96||Dt(g)?(t.exit("codeTextData"),h(g)):(t.consume(g),m)}function f(g){return g===96?(t.consume(g),l++,f):l===i?(t.exit("codeTextSequence"),t.exit("codeText"),a(g)):(c.type="codeTextData",m(g))}}class hI{constructor(a){this.left=a?[...a]:[],this.right=[]}get(a){if(a<0||a>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+a+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return a<this.left.length?this.left[a]:this.right[this.right.length-a+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(a,n){const i=n??Number.POSITIVE_INFINITY;return i<this.left.length?this.left.slice(a,i):a>this.left.length?this.right.slice(this.right.length-i+this.left.length,this.right.length-a+this.left.length).reverse():this.left.slice(a).concat(this.right.slice(this.right.length-i+this.left.length).reverse())}splice(a,n,i){const l=n||0;this.setCursor(Math.trunc(a));const c=this.right.splice(this.right.length-l,Number.POSITIVE_INFINITY);return i&&pu(this.left,i),c.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(a){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(a)}pushMany(a){this.setCursor(Number.POSITIVE_INFINITY),pu(this.left,a)}unshift(a){this.setCursor(0),this.right.push(a)}unshiftMany(a){this.setCursor(0),pu(this.right,a.reverse())}setCursor(a){if(!(a===this.left.length||a>this.left.length&&this.right.length===0||a<0&&this.left.length===0))if(a<this.left.length){const n=this.left.splice(a,Number.POSITIVE_INFINITY);pu(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-a,Number.POSITIVE_INFINITY);pu(this.left,n.reverse())}}}function pu(t,a){let n=0;if(a.length<1e4)t.push(...a);else for(;n<a.length;)t.push(...a.slice(n,n+1e4)),n+=1e4}function Aw(t){const a={};let n=-1,i,l,c,o,d,h,m;const f=new hI(t);for(;++n<f.length;){for(;n in a;)n=a[n];if(i=f.get(n),n&&i[1].type==="chunkFlow"&&f.get(n-1)[1].type==="listItemPrefix"&&(h=i[1]._tokenizer.events,c=0,c<h.length&&h[c][1].type==="lineEndingBlank"&&(c+=2),c<h.length&&h[c][1].type==="content"))for(;++c<h.length&&h[c][1].type!=="content";)h[c][1].type==="chunkText"&&(h[c][1]._isInFirstContentOfListItem=!0,c++);if(i[0]==="enter")i[1].contentType&&(Object.assign(a,mI(f,n)),n=a[n],m=!0);else if(i[1]._container){for(c=n,l=void 0;c--;)if(o=f.get(c),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(l&&(f.get(l)[1].type="lineEndingBlank"),o[1].type="lineEnding",l=c);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;l&&(i[1].end={...f.get(l)[1].start},d=f.slice(l,n),d.unshift(i),f.splice(l,n-l+1,d))}}return Xs(t,0,Number.POSITIVE_INFINITY,f.slice(0)),!m}function mI(t,a){const n=t.get(a)[1],i=t.get(a)[2];let l=a-1;const c=[];let o=n._tokenizer;o||(o=i.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const d=o.events,h=[],m={};let f,g,y=-1,b=n,v=0,w=0;const S=[w];for(;b;){for(;t.get(++l)[1]!==b;);c.push(l),b._tokenizer||(f=i.sliceStream(b),b.next||f.push(null),g&&o.defineSkip(b.start),b._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(f),b._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),g=b,b=b.next}for(b=n;++y<d.length;)d[y][0]==="exit"&&d[y-1][0]==="enter"&&d[y][1].type===d[y-1][1].type&&d[y][1].start.line!==d[y][1].end.line&&(w=y+1,S.push(w),b._tokenizer=void 0,b.previous=void 0,b=b.next);for(o.events=[],b?(b._tokenizer=void 0,b.previous=void 0):S.pop(),y=S.length;y--;){const _=d.slice(S[y],S[y+1]),E=c.pop();h.push([E,E+_.length-1]),t.splice(E,2,_)}for(h.reverse(),y=-1;++y<h.length;)m[v+h[y][0]]=v+h[y][1],v+=h[y][1]-h[y][0]-1;return m}const pI={resolve:gI,tokenize:xI},fI={partial:!0,tokenize:yI};function gI(t){return Aw(t),t}function xI(t,a){let n;return i;function i(d){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),l(d)}function l(d){return d===null?c(d):Dt(d)?t.check(fI,o,c)(d):(t.consume(d),l)}function c(d){return t.exit("chunkContent"),t.exit("content"),a(d)}function o(d){return t.consume(d),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,l}}function yI(t,a,n){const i=this;return l;function l(o){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),pn(t,c,"linePrefix")}function c(o){if(o===null||Dt(o))return n(o);const d=i.events[i.events.length-1];return!i.parser.constructs.disable.null.includes("codeIndented")&&d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?a(o):t.interrupt(i.parser.constructs.flow,n,a)(o)}}function Pw(t,a,n,i,l,c,o,d,h){const m=h||Number.POSITIVE_INFINITY;let f=0;return g;function g(_){return _===60?(t.enter(i),t.enter(l),t.enter(c),t.consume(_),t.exit(c),y):_===null||_===32||_===41||Lg(_)?n(_):(t.enter(i),t.enter(o),t.enter(d),t.enter("chunkString",{contentType:"string"}),w(_))}function y(_){return _===62?(t.enter(c),t.consume(_),t.exit(c),t.exit(l),t.exit(i),a):(t.enter(d),t.enter("chunkString",{contentType:"string"}),b(_))}function b(_){return _===62?(t.exit("chunkString"),t.exit(d),y(_)):_===null||_===60||Dt(_)?n(_):(t.consume(_),_===92?v:b)}function v(_){return _===60||_===62||_===92?(t.consume(_),b):b(_)}function w(_){return!f&&(_===null||_===41||Sa(_))?(t.exit("chunkString"),t.exit(d),t.exit(o),t.exit(i),a(_)):f<m&&_===40?(t.consume(_),f++,w):_===41?(t.consume(_),f--,w):_===null||_===32||_===40||Lg(_)?n(_):(t.consume(_),_===92?S:w)}function S(_){return _===40||_===41||_===92?(t.consume(_),w):w(_)}}function Rw(t,a,n,i,l,c){const o=this;let d=0,h;return m;function m(b){return t.enter(i),t.enter(l),t.consume(b),t.exit(l),t.enter(c),f}function f(b){return d>999||b===null||b===91||b===93&&!h||b===94&&!d&&"_hiddenFootnoteSupport"in o.parser.constructs?n(b):b===93?(t.exit(c),t.enter(l),t.consume(b),t.exit(l),t.exit(i),a):Dt(b)?(t.enter("lineEnding"),t.consume(b),t.exit("lineEnding"),f):(t.enter("chunkString",{contentType:"string"}),g(b))}function g(b){return b===null||b===91||b===93||Dt(b)||d++>999?(t.exit("chunkString"),f(b)):(t.consume(b),h||(h=!Wt(b)),b===92?y:g)}function y(b){return b===91||b===92||b===93?(t.consume(b),d++,g):g(b)}}function Ow(t,a,n,i,l,c){let o;return d;function d(y){return y===34||y===39||y===40?(t.enter(i),t.enter(l),t.consume(y),t.exit(l),o=y===40?41:y,h):n(y)}function h(y){return y===o?(t.enter(l),t.consume(y),t.exit(l),t.exit(i),a):(t.enter(c),m(y))}function m(y){return y===o?(t.exit(c),h(o)):y===null?n(y):Dt(y)?(t.enter("lineEnding"),t.consume(y),t.exit("lineEnding"),pn(t,m,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),f(y))}function f(y){return y===o||y===null||Dt(y)?(t.exit("chunkString"),m(y)):(t.consume(y),y===92?g:f)}function g(y){return y===o||y===92?(t.consume(y),f):f(y)}}function ju(t,a){let n;return i;function i(l){return Dt(l)?(t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),n=!0,i):Wt(l)?pn(t,i,n?"linePrefix":"lineSuffix")(l):a(l)}}const bI={name:"definition",tokenize:vI},jI={partial:!0,tokenize:NI};function vI(t,a,n){const i=this;let l;return c;function c(b){return t.enter("definition"),o(b)}function o(b){return Rw.call(i,t,d,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(b)}function d(b){return l=Po(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)),b===58?(t.enter("definitionMarker"),t.consume(b),t.exit("definitionMarker"),h):n(b)}function h(b){return Sa(b)?ju(t,m)(b):m(b)}function m(b){return Pw(t,f,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(b)}function f(b){return t.attempt(jI,g,g)(b)}function g(b){return Wt(b)?pn(t,y,"whitespace")(b):y(b)}function y(b){return b===null||Dt(b)?(t.exit("definition"),i.parser.defined.push(l),a(b)):n(b)}}function NI(t,a,n){return i;function i(d){return Sa(d)?ju(t,l)(d):n(d)}function l(d){return Ow(t,c,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(d)}function c(d){return Wt(d)?pn(t,o,"whitespace")(d):o(d)}function o(d){return d===null||Dt(d)?a(d):n(d)}}const wI={name:"hardBreakEscape",tokenize:SI};function SI(t,a,n){return i;function i(c){return t.enter("hardBreakEscape"),t.consume(c),l}function l(c){return Dt(c)?(t.exit("hardBreakEscape"),a(c)):n(c)}}const kI={name:"headingAtx",resolve:CI,tokenize:_I};function CI(t,a){let n=t.length-2,i=3,l,c;return t[i][1].type==="whitespace"&&(i+=2),n-2>i&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(i===n-1||n-4>i&&t[n-2][1].type==="whitespace")&&(n-=i+1===n?2:4),n>i&&(l={type:"atxHeadingText",start:t[i][1].start,end:t[n][1].end},c={type:"chunkText",start:t[i][1].start,end:t[n][1].end,contentType:"text"},Xs(t,i,n-i+1,[["enter",l,a],["enter",c,a],["exit",c,a],["exit",l,a]])),t}function _I(t,a,n){let i=0;return l;function l(f){return t.enter("atxHeading"),c(f)}function c(f){return t.enter("atxHeadingSequence"),o(f)}function o(f){return f===35&&i++<6?(t.consume(f),o):f===null||Sa(f)?(t.exit("atxHeadingSequence"),d(f)):n(f)}function d(f){return f===35?(t.enter("atxHeadingSequence"),h(f)):f===null||Dt(f)?(t.exit("atxHeading"),a(f)):Wt(f)?pn(t,d,"whitespace")(f):(t.enter("atxHeadingText"),m(f))}function h(f){return f===35?(t.consume(f),h):(t.exit("atxHeadingSequence"),d(f))}function m(f){return f===null||f===35||Sa(f)?(t.exit("atxHeadingText"),d(f)):(t.consume(f),m)}}const DI=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],N0=["pre","script","style","textarea"],EI={concrete:!0,name:"htmlFlow",resolveTo:PI,tokenize:RI},TI={partial:!0,tokenize:II},AI={partial:!0,tokenize:OI};function PI(t){let a=t.length;for(;a--&&!(t[a][0]==="enter"&&t[a][1].type==="htmlFlow"););return a>1&&t[a-2][1].type==="linePrefix"&&(t[a][1].start=t[a-2][1].start,t[a+1][1].start=t[a-2][1].start,t.splice(a-2,2)),t}function RI(t,a,n){const i=this;let l,c,o,d,h;return m;function m(T){return f(T)}function f(T){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(T),g}function g(T){return T===33?(t.consume(T),y):T===47?(t.consume(T),c=!0,w):T===63?(t.consume(T),l=3,i.interrupt?a:k):Js(T)?(t.consume(T),o=String.fromCharCode(T),S):n(T)}function y(T){return T===45?(t.consume(T),l=2,b):T===91?(t.consume(T),l=5,d=0,v):Js(T)?(t.consume(T),l=4,i.interrupt?a:k):n(T)}function b(T){return T===45?(t.consume(T),i.interrupt?a:k):n(T)}function v(T){const Ce="CDATA[";return T===Ce.charCodeAt(d++)?(t.consume(T),d===Ce.length?i.interrupt?a:z:v):n(T)}function w(T){return Js(T)?(t.consume(T),o=String.fromCharCode(T),S):n(T)}function S(T){if(T===null||T===47||T===62||Sa(T)){const Ce=T===47,Ue=o.toLowerCase();return!Ce&&!c&&N0.includes(Ue)?(l=1,i.interrupt?a(T):z(T)):DI.includes(o.toLowerCase())?(l=6,Ce?(t.consume(T),_):i.interrupt?a(T):z(T)):(l=7,i.interrupt&&!i.parser.lazy[i.now().line]?n(T):c?E(T):D(T))}return T===45||Va(T)?(t.consume(T),o+=String.fromCharCode(T),S):n(T)}function _(T){return T===62?(t.consume(T),i.interrupt?a:z):n(T)}function E(T){return Wt(T)?(t.consume(T),E):C(T)}function D(T){return T===47?(t.consume(T),C):T===58||T===95||Js(T)?(t.consume(T),O):Wt(T)?(t.consume(T),D):C(T)}function O(T){return T===45||T===46||T===58||T===95||Va(T)?(t.consume(T),O):M(T)}function M(T){return T===61?(t.consume(T),A):Wt(T)?(t.consume(T),M):D(T)}function A(T){return T===null||T===60||T===61||T===62||T===96?n(T):T===34||T===39?(t.consume(T),h=T,P):Wt(T)?(t.consume(T),A):Q(T)}function P(T){return T===h?(t.consume(T),h=null,G):T===null||Dt(T)?n(T):(t.consume(T),P)}function Q(T){return T===null||T===34||T===39||T===47||T===60||T===61||T===62||T===96||Sa(T)?M(T):(t.consume(T),Q)}function G(T){return T===47||T===62||Wt(T)?D(T):n(T)}function C(T){return T===62?(t.consume(T),R):n(T)}function R(T){return T===null||Dt(T)?z(T):Wt(T)?(t.consume(T),R):n(T)}function z(T){return T===45&&l===2?(t.consume(T),I):T===60&&l===1?(t.consume(T),V):T===62&&l===4?(t.consume(T),Ne):T===63&&l===3?(t.consume(T),k):T===93&&l===5?(t.consume(T),B):Dt(T)&&(l===6||l===7)?(t.exit("htmlFlowData"),t.check(TI,Ae,F)(T)):T===null||Dt(T)?(t.exit("htmlFlowData"),F(T)):(t.consume(T),z)}function F(T){return t.check(AI,J,Ae)(T)}function J(T){return t.enter("lineEnding"),t.consume(T),t.exit("lineEnding"),H}function H(T){return T===null||Dt(T)?F(T):(t.enter("htmlFlowData"),z(T))}function I(T){return T===45?(t.consume(T),k):z(T)}function V(T){return T===47?(t.consume(T),o="",re):z(T)}function re(T){if(T===62){const Ce=o.toLowerCase();return N0.includes(Ce)?(t.consume(T),Ne):z(T)}return Js(T)&&o.length<8?(t.consume(T),o+=String.fromCharCode(T),re):z(T)}function B(T){return T===93?(t.consume(T),k):z(T)}function k(T){return T===62?(t.consume(T),Ne):T===45&&l===2?(t.consume(T),k):z(T)}function Ne(T){return T===null||Dt(T)?(t.exit("htmlFlowData"),Ae(T)):(t.consume(T),Ne)}function Ae(T){return t.exit("htmlFlow"),a(T)}}function OI(t,a,n){const i=this;return l;function l(o){return Dt(o)?(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),c):n(o)}function c(o){return i.parser.lazy[i.now().line]?n(o):a(o)}}function II(t,a,n){return i;function i(l){return t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),t.attempt(mm,a,n)}}const zI={name:"htmlText",tokenize:FI};function FI(t,a,n){const i=this;let l,c,o;return d;function d(k){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(k),h}function h(k){return k===33?(t.consume(k),m):k===47?(t.consume(k),M):k===63?(t.consume(k),D):Js(k)?(t.consume(k),Q):n(k)}function m(k){return k===45?(t.consume(k),f):k===91?(t.consume(k),c=0,v):Js(k)?(t.consume(k),E):n(k)}function f(k){return k===45?(t.consume(k),b):n(k)}function g(k){return k===null?n(k):k===45?(t.consume(k),y):Dt(k)?(o=g,V(k)):(t.consume(k),g)}function y(k){return k===45?(t.consume(k),b):g(k)}function b(k){return k===62?I(k):k===45?y(k):g(k)}function v(k){const Ne="CDATA[";return k===Ne.charCodeAt(c++)?(t.consume(k),c===Ne.length?w:v):n(k)}function w(k){return k===null?n(k):k===93?(t.consume(k),S):Dt(k)?(o=w,V(k)):(t.consume(k),w)}function S(k){return k===93?(t.consume(k),_):w(k)}function _(k){return k===62?I(k):k===93?(t.consume(k),_):w(k)}function E(k){return k===null||k===62?I(k):Dt(k)?(o=E,V(k)):(t.consume(k),E)}function D(k){return k===null?n(k):k===63?(t.consume(k),O):Dt(k)?(o=D,V(k)):(t.consume(k),D)}function O(k){return k===62?I(k):D(k)}function M(k){return Js(k)?(t.consume(k),A):n(k)}function A(k){return k===45||Va(k)?(t.consume(k),A):P(k)}function P(k){return Dt(k)?(o=P,V(k)):Wt(k)?(t.consume(k),P):I(k)}function Q(k){return k===45||Va(k)?(t.consume(k),Q):k===47||k===62||Sa(k)?G(k):n(k)}function G(k){return k===47?(t.consume(k),I):k===58||k===95||Js(k)?(t.consume(k),C):Dt(k)?(o=G,V(k)):Wt(k)?(t.consume(k),G):I(k)}function C(k){return k===45||k===46||k===58||k===95||Va(k)?(t.consume(k),C):R(k)}function R(k){return k===61?(t.consume(k),z):Dt(k)?(o=R,V(k)):Wt(k)?(t.consume(k),R):G(k)}function z(k){return k===null||k===60||k===61||k===62||k===96?n(k):k===34||k===39?(t.consume(k),l=k,F):Dt(k)?(o=z,V(k)):Wt(k)?(t.consume(k),z):(t.consume(k),J)}function F(k){return k===l?(t.consume(k),l=void 0,H):k===null?n(k):Dt(k)?(o=F,V(k)):(t.consume(k),F)}function J(k){return k===null||k===34||k===39||k===60||k===61||k===96?n(k):k===47||k===62||Sa(k)?G(k):(t.consume(k),J)}function H(k){return k===47||k===62||Sa(k)?G(k):n(k)}function I(k){return k===62?(t.consume(k),t.exit("htmlTextData"),t.exit("htmlText"),a):n(k)}function V(k){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(k),t.exit("lineEnding"),re}function re(k){return Wt(k)?pn(t,B,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(k):B(k)}function B(k){return t.enter("htmlTextData"),o(k)}}const zx={name:"labelEnd",resolveAll:BI,resolveTo:UI,tokenize:qI},LI={tokenize:HI},$I={tokenize:VI},MI={tokenize:GI};function BI(t){let a=-1;const n=[];for(;++a<t.length;){const i=t[a][1];if(n.push(t[a]),i.type==="labelImage"||i.type==="labelLink"||i.type==="labelEnd"){const l=i.type==="labelImage"?4:2;i.type="data",a+=l}}return t.length!==n.length&&Xs(t,0,t.length,n),t}function UI(t,a){let n=t.length,i=0,l,c,o,d;for(;n--;)if(l=t[n][1],c){if(l.type==="link"||l.type==="labelLink"&&l._inactive)break;t[n][0]==="enter"&&l.type==="labelLink"&&(l._inactive=!0)}else if(o){if(t[n][0]==="enter"&&(l.type==="labelImage"||l.type==="labelLink")&&!l._balanced&&(c=n,l.type!=="labelLink")){i=2;break}}else l.type==="labelEnd"&&(o=n);const h={type:t[c][1].type==="labelLink"?"link":"image",start:{...t[c][1].start},end:{...t[t.length-1][1].end}},m={type:"label",start:{...t[c][1].start},end:{...t[o][1].end}},f={type:"labelText",start:{...t[c+i+2][1].end},end:{...t[o-2][1].start}};return d=[["enter",h,a],["enter",m,a]],d=os(d,t.slice(c+1,c+i+3)),d=os(d,[["enter",f,a]]),d=os(d,Ix(a.parser.constructs.insideSpan.null,t.slice(c+i+4,o-3),a)),d=os(d,[["exit",f,a],t[o-2],t[o-1],["exit",m,a]]),d=os(d,t.slice(o+1)),d=os(d,[["exit",h,a]]),Xs(t,c,t.length,d),t}function qI(t,a,n){const i=this;let l=i.events.length,c,o;for(;l--;)if((i.events[l][1].type==="labelImage"||i.events[l][1].type==="labelLink")&&!i.events[l][1]._balanced){c=i.events[l][1];break}return d;function d(y){return c?c._inactive?g(y):(o=i.parser.defined.includes(Po(i.sliceSerialize({start:c.end,end:i.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(y),t.exit("labelMarker"),t.exit("labelEnd"),h):n(y)}function h(y){return y===40?t.attempt(LI,f,o?f:g)(y):y===91?t.attempt($I,f,o?m:g)(y):o?f(y):g(y)}function m(y){return t.attempt(MI,f,g)(y)}function f(y){return a(y)}function g(y){return c._balanced=!0,n(y)}}function HI(t,a,n){return i;function i(g){return t.enter("resource"),t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),l}function l(g){return Sa(g)?ju(t,c)(g):c(g)}function c(g){return g===41?f(g):Pw(t,o,d,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(g)}function o(g){return Sa(g)?ju(t,h)(g):f(g)}function d(g){return n(g)}function h(g){return g===34||g===39||g===40?Ow(t,m,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(g):f(g)}function m(g){return Sa(g)?ju(t,f)(g):f(g)}function f(g){return g===41?(t.enter("resourceMarker"),t.consume(g),t.exit("resourceMarker"),t.exit("resource"),a):n(g)}}function VI(t,a,n){const i=this;return l;function l(d){return Rw.call(i,t,c,o,"reference","referenceMarker","referenceString")(d)}function c(d){return i.parser.defined.includes(Po(i.sliceSerialize(i.events[i.events.length-1][1]).slice(1,-1)))?a(d):n(d)}function o(d){return n(d)}}function GI(t,a,n){return i;function i(c){return t.enter("reference"),t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),l}function l(c){return c===93?(t.enter("referenceMarker"),t.consume(c),t.exit("referenceMarker"),t.exit("reference"),a):n(c)}}const QI={name:"labelStartImage",resolveAll:zx.resolveAll,tokenize:YI};function YI(t,a,n){const i=this;return l;function l(d){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(d),t.exit("labelImageMarker"),c}function c(d){return d===91?(t.enter("labelMarker"),t.consume(d),t.exit("labelMarker"),t.exit("labelImage"),o):n(d)}function o(d){return d===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(d):a(d)}}const JI={name:"labelStartLink",resolveAll:zx.resolveAll,tokenize:KI};function KI(t,a,n){const i=this;return l;function l(o){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelLink"),c}function c(o){return o===94&&"_hiddenFootnoteSupport"in i.parser.constructs?n(o):a(o)}}const $f={name:"lineEnding",tokenize:WI};function WI(t,a){return n;function n(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),pn(t,a,"linePrefix")}}const Eh={name:"thematicBreak",tokenize:XI};function XI(t,a,n){let i=0,l;return c;function c(m){return t.enter("thematicBreak"),o(m)}function o(m){return l=m,d(m)}function d(m){return m===l?(t.enter("thematicBreakSequence"),h(m)):i>=3&&(m===null||Dt(m))?(t.exit("thematicBreak"),a(m)):n(m)}function h(m){return m===l?(t.consume(m),i++,h):(t.exit("thematicBreakSequence"),Wt(m)?pn(t,d,"whitespace")(m):d(m))}}const Na={continuation:{tokenize:n6},exit:s6,name:"list",tokenize:t6},ZI={partial:!0,tokenize:i6},e6={partial:!0,tokenize:a6};function t6(t,a,n){const i=this,l=i.events[i.events.length-1];let c=l&&l[1].type==="linePrefix"?l[2].sliceSerialize(l[1],!0).length:0,o=0;return d;function d(b){const v=i.containerState.type||(b===42||b===43||b===45?"listUnordered":"listOrdered");if(v==="listUnordered"?!i.containerState.marker||b===i.containerState.marker:$g(b)){if(i.containerState.type||(i.containerState.type=v,t.enter(v,{_container:!0})),v==="listUnordered")return t.enter("listItemPrefix"),b===42||b===45?t.check(Eh,n,m)(b):m(b);if(!i.interrupt||b===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),h(b)}return n(b)}function h(b){return $g(b)&&++o<10?(t.consume(b),h):(!i.interrupt||o<2)&&(i.containerState.marker?b===i.containerState.marker:b===41||b===46)?(t.exit("listItemValue"),m(b)):n(b)}function m(b){return t.enter("listItemMarker"),t.consume(b),t.exit("listItemMarker"),i.containerState.marker=i.containerState.marker||b,t.check(mm,i.interrupt?n:f,t.attempt(ZI,y,g))}function f(b){return i.containerState.initialBlankLine=!0,c++,y(b)}function g(b){return Wt(b)?(t.enter("listItemPrefixWhitespace"),t.consume(b),t.exit("listItemPrefixWhitespace"),y):n(b)}function y(b){return i.containerState.size=c+i.sliceSerialize(t.exit("listItemPrefix"),!0).length,a(b)}}function n6(t,a,n){const i=this;return i.containerState._closeFlow=void 0,t.check(mm,l,c);function l(d){return i.containerState.furtherBlankLines=i.containerState.furtherBlankLines||i.containerState.initialBlankLine,pn(t,a,"listItemIndent",i.containerState.size+1)(d)}function c(d){return i.containerState.furtherBlankLines||!Wt(d)?(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,o(d)):(i.containerState.furtherBlankLines=void 0,i.containerState.initialBlankLine=void 0,t.attempt(e6,a,o)(d))}function o(d){return i.containerState._closeFlow=!0,i.interrupt=void 0,pn(t,t.attempt(Na,a,n),"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(d)}}function a6(t,a,n){const i=this;return pn(t,l,"listItemIndent",i.containerState.size+1);function l(c){const o=i.events[i.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===i.containerState.size?a(c):n(c)}}function s6(t){t.exit(this.containerState.type)}function i6(t,a,n){const i=this;return pn(t,l,"listItemPrefixWhitespace",i.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function l(c){const o=i.events[i.events.length-1];return!Wt(c)&&o&&o[1].type==="listItemPrefixWhitespace"?a(c):n(c)}}const w0={name:"setextUnderline",resolveTo:r6,tokenize:l6};function r6(t,a){let n=t.length,i,l,c;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){i=n;break}t[n][1].type==="paragraph"&&(l=n)}else t[n][1].type==="content"&&t.splice(n,1),!c&&t[n][1].type==="definition"&&(c=n);const o={type:"setextHeading",start:{...t[i][1].start},end:{...t[t.length-1][1].end}};return t[l][1].type="setextHeadingText",c?(t.splice(l,0,["enter",o,a]),t.splice(c+1,0,["exit",t[i][1],a]),t[i][1].end={...t[c][1].end}):t[i][1]=o,t.push(["exit",o,a]),t}function l6(t,a,n){const i=this;let l;return c;function c(m){let f=i.events.length,g;for(;f--;)if(i.events[f][1].type!=="lineEnding"&&i.events[f][1].type!=="linePrefix"&&i.events[f][1].type!=="content"){g=i.events[f][1].type==="paragraph";break}return!i.parser.lazy[i.now().line]&&(i.interrupt||g)?(t.enter("setextHeadingLine"),l=m,o(m)):n(m)}function o(m){return t.enter("setextHeadingLineSequence"),d(m)}function d(m){return m===l?(t.consume(m),d):(t.exit("setextHeadingLineSequence"),Wt(m)?pn(t,h,"lineSuffix")(m):h(m))}function h(m){return m===null||Dt(m)?(t.exit("setextHeadingLine"),a(m)):n(m)}}const o6={tokenize:c6};function c6(t){const a=this,n=t.attempt(mm,i,t.attempt(this.parser.constructs.flowInitial,l,pn(t,t.attempt(this.parser.constructs.flow,l,t.attempt(pI,l)),"linePrefix")));return n;function i(c){if(c===null){t.consume(c);return}return t.enter("lineEndingBlank"),t.consume(c),t.exit("lineEndingBlank"),a.currentConstruct=void 0,n}function l(c){if(c===null){t.consume(c);return}return t.enter("lineEnding"),t.consume(c),t.exit("lineEnding"),a.currentConstruct=void 0,n}}const u6={resolveAll:zw()},d6=Iw("string"),h6=Iw("text");function Iw(t){return{resolveAll:zw(t==="text"?m6:void 0),tokenize:a};function a(n){const i=this,l=this.parser.constructs[t],c=n.attempt(l,o,d);return o;function o(f){return m(f)?c(f):d(f)}function d(f){if(f===null){n.consume(f);return}return n.enter("data"),n.consume(f),h}function h(f){return m(f)?(n.exit("data"),c(f)):(n.consume(f),h)}function m(f){if(f===null)return!0;const g=l[f];let y=-1;if(g)for(;++y<g.length;){const b=g[y];if(!b.previous||b.previous.call(i,i.previous))return!0}return!1}}}function zw(t){return a;function a(n,i){let l=-1,c;for(;++l<=n.length;)c===void 0?n[l]&&n[l][1].type==="data"&&(c=l,l++):(!n[l]||n[l][1].type!=="data")&&(l!==c+2&&(n[c][1].end=n[l-1][1].end,n.splice(c+2,l-c-2),l=c+2),c=void 0);return t?t(n,i):n}}function m6(t,a){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const i=t[n-1][1],l=a.sliceStream(i);let c=l.length,o=-1,d=0,h;for(;c--;){const m=l[c];if(typeof m=="string"){for(o=m.length;m.charCodeAt(o-1)===32;)d++,o--;if(o)break;o=-1}else if(m===-2)h=!0,d++;else if(m!==-1){c++;break}}if(a._contentTypeTextTrailing&&n===t.length&&(d=0),d){const m={type:n===t.length||h||d<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:c?o:i.start._bufferIndex+o,_index:i.start._index+c,line:i.end.line,column:i.end.column-d,offset:i.end.offset-d},end:{...i.end}};i.end={...m.start},i.start.offset===i.end.offset?Object.assign(i,m):(t.splice(n,0,["enter",m,a],["exit",m,a]),n+=2)}n++}return t}const p6={42:Na,43:Na,45:Na,48:Na,49:Na,50:Na,51:Na,52:Na,53:Na,54:Na,55:Na,56:Na,57:Na,62:Dw},f6={91:bI},g6={[-2]:Lf,[-1]:Lf,32:Lf},x6={35:kI,42:Eh,45:[w0,Eh],60:EI,61:w0,95:Eh,96:v0,126:v0},y6={38:Tw,92:Ew},b6={[-5]:$f,[-4]:$f,[-3]:$f,33:QI,38:Tw,42:Mg,60:[JO,zI],91:JI,92:[wI,Ew],93:zx,95:Mg,96:oI},j6={null:[Mg,u6]},v6={null:[42,95]},N6={null:[]},w6=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:v6,contentInitial:f6,disable:N6,document:p6,flow:x6,flowInitial:g6,insideSpan:j6,string:y6,text:b6},Symbol.toStringTag,{value:"Module"}));function S6(t,a,n){let i={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const l={},c=[];let o=[],d=[];const h={attempt:P(M),check:P(A),consume:E,enter:D,exit:O,interrupt:P(A,{interrupt:!0})},m={code:null,containerState:{},defineSkip:w,events:[],now:v,parser:t,previous:null,sliceSerialize:y,sliceStream:b,write:g};let f=a.tokenize.call(m,h);return a.resolveAll&&c.push(a),m;function g(R){return o=os(o,R),S(),o[o.length-1]!==null?[]:(Q(a,0),m.events=Ix(c,m.events,m),m.events)}function y(R,z){return C6(b(R),z)}function b(R){return k6(o,R)}function v(){const{_bufferIndex:R,_index:z,line:F,column:J,offset:H}=i;return{_bufferIndex:R,_index:z,line:F,column:J,offset:H}}function w(R){l[R.line]=R.column,C()}function S(){let R;for(;i._index<o.length;){const z=o[i._index];if(typeof z=="string")for(R=i._index,i._bufferIndex<0&&(i._bufferIndex=0);i._index===R&&i._bufferIndex<z.length;)_(z.charCodeAt(i._bufferIndex));else _(z)}}function _(R){f=f(R)}function E(R){Dt(R)?(i.line++,i.column=1,i.offset+=R===-3?2:1,C()):R!==-1&&(i.column++,i.offset++),i._bufferIndex<0?i._index++:(i._bufferIndex++,i._bufferIndex===o[i._index].length&&(i._bufferIndex=-1,i._index++)),m.previous=R}function D(R,z){const F=z||{};return F.type=R,F.start=v(),m.events.push(["enter",F,m]),d.push(F),F}function O(R){const z=d.pop();return z.end=v(),m.events.push(["exit",z,m]),z}function M(R,z){Q(R,z.from)}function A(R,z){z.restore()}function P(R,z){return F;function F(J,H,I){let V,re,B,k;return Array.isArray(J)?Ae(J):"tokenize"in J?Ae([J]):Ne(J);function Ne(Pe){return de;function de(Se){const ee=Se!==null&&Pe[Se],oe=Se!==null&&Pe.null,fe=[...Array.isArray(ee)?ee:ee?[ee]:[],...Array.isArray(oe)?oe:oe?[oe]:[]];return Ae(fe)(Se)}}function Ae(Pe){return V=Pe,re=0,Pe.length===0?I:T(Pe[re])}function T(Pe){return de;function de(Se){return k=G(),B=Pe,Pe.partial||(m.currentConstruct=Pe),Pe.name&&m.parser.constructs.disable.null.includes(Pe.name)?Ue():Pe.tokenize.call(z?Object.assign(Object.create(m),z):m,h,Ce,Ue)(Se)}}function Ce(Pe){return R(B,k),H}function Ue(Pe){return k.restore(),++re<V.length?T(V[re]):I}}}function Q(R,z){R.resolveAll&&!c.includes(R)&&c.push(R),R.resolve&&Xs(m.events,z,m.events.length-z,R.resolve(m.events.slice(z),m)),R.resolveTo&&(m.events=R.resolveTo(m.events,m))}function G(){const R=v(),z=m.previous,F=m.currentConstruct,J=m.events.length,H=Array.from(d);return{from:J,restore:I};function I(){i=R,m.previous=z,m.currentConstruct=F,m.events.length=J,d=H,C()}}function C(){i.line in l&&i.column<2&&(i.column=l[i.line],i.offset+=l[i.line]-1)}}function k6(t,a){const n=a.start._index,i=a.start._bufferIndex,l=a.end._index,c=a.end._bufferIndex;let o;if(n===l)o=[t[n].slice(i,c)];else{if(o=t.slice(n,l),i>-1){const d=o[0];typeof d=="string"?o[0]=d.slice(i):o.shift()}c>0&&o.push(t[l].slice(0,c))}return o}function C6(t,a){let n=-1;const i=[];let l;for(;++n<t.length;){const c=t[n];let o;if(typeof c=="string")o=c;else switch(c){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=a?" ":"	";break}case-1:{if(!a&&l)continue;o=" ";break}default:o=String.fromCharCode(c)}l=c===-2,i.push(o)}return i.join("")}function _6(t){const i={constructs:OO([w6,...(t||{}).extensions||[]]),content:l(UO),defined:[],document:l(HO),flow:l(o6),lazy:{},string:l(d6),text:l(h6)};return i;function l(c){return o;function o(d){return S6(i,c,d)}}}function D6(t){for(;!Aw(t););return t}const S0=/[\0\t\n\r]/g;function E6(){let t=1,a="",n=!0,i;return l;function l(c,o,d){const h=[];let m,f,g,y,b;for(c=a+(typeof c=="string"?c.toString():new TextDecoder(o||void 0).decode(c)),g=0,a="",n&&(c.charCodeAt(0)===65279&&g++,n=void 0);g<c.length;){if(S0.lastIndex=g,m=S0.exec(c),y=m&&m.index!==void 0?m.index:c.length,b=c.charCodeAt(y),!m){a=c.slice(g);break}if(b===10&&g===y&&i)h.push(-3),i=void 0;else switch(i&&(h.push(-5),i=void 0),g<y&&(h.push(c.slice(g,y)),t+=y-g),b){case 0:{h.push(65533),t++;break}case 9:{for(f=Math.ceil(t/4)*4,h.push(-2);t++<f;)h.push(-1);break}case 10:{h.push(-4),t=1;break}default:i=!0,t=1}g=y+1}return d&&(i&&h.push(-5),a&&h.push(a),h.push(null)),h}}const T6=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Fw(t){return t.replace(T6,A6)}function A6(t,a,n){if(a)return a;if(n.charCodeAt(0)===35){const l=n.charCodeAt(1),c=l===120||l===88;return _w(n.slice(c?2:1),c?16:10)}return Ox(n)||t}function vu(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?k0(t.position):"start"in t||"end"in t?k0(t):"line"in t||"column"in t?Bg(t):""}function Bg(t){return C0(t&&t.line)+":"+C0(t&&t.column)}function k0(t){return Bg(t&&t.start)+"-"+Bg(t&&t.end)}function C0(t){return t&&typeof t=="number"?t:1}const Lw={}.hasOwnProperty;function P6(t,a,n){return typeof a!="string"&&(n=a,a=void 0),R6(n)(D6(_6(n).document().write(E6()(t,a,!0))))}function R6(t){const a={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:c(He),autolinkProtocol:G,autolinkEmail:G,atxHeading:c(Y),blockQuote:c(oe),characterEscape:G,characterReference:G,codeFenced:c(fe),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:c(fe,o),codeText:c(ge,o),codeTextData:G,data:G,codeFlowValue:G,definition:c(q),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:c(W),hardBreakEscape:c(ie),hardBreakTrailing:c(ie),htmlFlow:c(ce,o),htmlFlowData:G,htmlText:c(ce,o),htmlTextData:G,image:c(pe),label:o,link:c(He),listItem:c(st),listItemValue:y,listOrdered:c(We,g),listUnordered:c(We),paragraph:c(me),reference:T,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:c(Y),strong:c(ve),thematicBreak:c(Ee)},exit:{atxHeading:h(),atxHeadingSequence:M,autolink:h(),autolinkEmail:ee,autolinkProtocol:Se,blockQuote:h(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:Ue,characterReferenceMarkerNumeric:Ue,characterReferenceValue:Pe,characterReference:de,codeFenced:h(S),codeFencedFence:w,codeFencedFenceInfo:b,codeFencedFenceMeta:v,codeFlowValue:C,codeIndented:h(_),codeText:h(H),codeTextData:C,data:C,definition:h(),definitionDestinationString:O,definitionLabelString:E,definitionTitleString:D,emphasis:h(),hardBreakEscape:h(z),hardBreakTrailing:h(z),htmlFlow:h(F),htmlFlowData:C,htmlText:h(J),htmlTextData:C,image:h(V),label:B,labelText:re,lineEnding:R,link:h(I),listItem:h(),listOrdered:h(),listUnordered:h(),paragraph:h(),referenceString:Ce,resourceDestinationString:k,resourceTitleString:Ne,resource:Ae,setextHeading:h(Q),setextHeadingLineSequence:P,setextHeadingText:A,strong:h(),thematicBreak:h()}};$w(a,(t||{}).mdastExtensions||[]);const n={};return i;function i(L){let ne={type:"root",children:[]};const xe={stack:[ne],tokenStack:[],config:a,enter:d,exit:m,buffer:o,resume:f,data:n},ae=[];let we=-1;for(;++we<L.length;)if(L[we][1].type==="listOrdered"||L[we][1].type==="listUnordered")if(L[we][0]==="enter")ae.push(we);else{const Le=ae.pop();we=l(L,Le,we)}for(we=-1;++we<L.length;){const Le=a[L[we][0]];Lw.call(Le,L[we][1].type)&&Le[L[we][1].type].call(Object.assign({sliceSerialize:L[we][2].sliceSerialize},xe),L[we][1])}if(xe.tokenStack.length>0){const Le=xe.tokenStack[xe.tokenStack.length-1];(Le[1]||_0).call(xe,void 0,Le[0])}for(ne.position={start:pr(L.length>0?L[0][1].start:{line:1,column:1,offset:0}),end:pr(L.length>0?L[L.length-2][1].end:{line:1,column:1,offset:0})},we=-1;++we<a.transforms.length;)ne=a.transforms[we](ne)||ne;return ne}function l(L,ne,xe){let ae=ne-1,we=-1,Le=!1,Je,ot,xt,be;for(;++ae<=xe;){const ue=L[ae];switch(ue[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ue[0]==="enter"?we++:we--,be=void 0;break}case"lineEndingBlank":{ue[0]==="enter"&&(Je&&!be&&!we&&!xt&&(xt=ae),be=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:be=void 0}if(!we&&ue[0]==="enter"&&ue[1].type==="listItemPrefix"||we===-1&&ue[0]==="exit"&&(ue[1].type==="listUnordered"||ue[1].type==="listOrdered")){if(Je){let je=ae;for(ot=void 0;je--;){const ke=L[je];if(ke[1].type==="lineEnding"||ke[1].type==="lineEndingBlank"){if(ke[0]==="exit")continue;ot&&(L[ot][1].type="lineEndingBlank",Le=!0),ke[1].type="lineEnding",ot=je}else if(!(ke[1].type==="linePrefix"||ke[1].type==="blockQuotePrefix"||ke[1].type==="blockQuotePrefixWhitespace"||ke[1].type==="blockQuoteMarker"||ke[1].type==="listItemIndent"))break}xt&&(!ot||xt<ot)&&(Je._spread=!0),Je.end=Object.assign({},ot?L[ot][1].start:ue[1].end),L.splice(ot||ae,0,["exit",Je,ue[2]]),ae++,xe++}if(ue[1].type==="listItemPrefix"){const je={type:"listItem",_spread:!1,start:Object.assign({},ue[1].start),end:void 0};Je=je,L.splice(ae,0,["enter",je,ue[2]]),ae++,xe++,xt=void 0,be=!0}}}return L[ne][1]._spread=Le,xe}function c(L,ne){return xe;function xe(ae){d.call(this,L(ae),ae),ne&&ne.call(this,ae)}}function o(){this.stack.push({type:"fragment",children:[]})}function d(L,ne,xe){this.stack[this.stack.length-1].children.push(L),this.stack.push(L),this.tokenStack.push([ne,xe||void 0]),L.position={start:pr(ne.start),end:void 0}}function h(L){return ne;function ne(xe){L&&L.call(this,xe),m.call(this,xe)}}function m(L,ne){const xe=this.stack.pop(),ae=this.tokenStack.pop();if(ae)ae[0].type!==L.type&&(ne?ne.call(this,L,ae[0]):(ae[1]||_0).call(this,L,ae[0]));else throw new Error("Cannot close `"+L.type+"` ("+vu({start:L.start,end:L.end})+"): its not open");xe.position.end=pr(L.end)}function f(){return Rx(this.stack.pop())}function g(){this.data.expectingFirstListItemValue=!0}function y(L){if(this.data.expectingFirstListItemValue){const ne=this.stack[this.stack.length-2];ne.start=Number.parseInt(this.sliceSerialize(L),10),this.data.expectingFirstListItemValue=void 0}}function b(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.lang=L}function v(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.meta=L}function w(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function S(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L.replace(/(\r?\n|\r)$/g,"")}function E(L){const ne=this.resume(),xe=this.stack[this.stack.length-1];xe.label=ne,xe.identifier=Po(this.sliceSerialize(L)).toLowerCase()}function D(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.title=L}function O(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.url=L}function M(L){const ne=this.stack[this.stack.length-1];if(!ne.depth){const xe=this.sliceSerialize(L).length;ne.depth=xe}}function A(){this.data.setextHeadingSlurpLineEnding=!0}function P(L){const ne=this.stack[this.stack.length-1];ne.depth=this.sliceSerialize(L).codePointAt(0)===61?1:2}function Q(){this.data.setextHeadingSlurpLineEnding=void 0}function G(L){const xe=this.stack[this.stack.length-1].children;let ae=xe[xe.length-1];(!ae||ae.type!=="text")&&(ae=Fe(),ae.position={start:pr(L.start),end:void 0},xe.push(ae)),this.stack.push(ae)}function C(L){const ne=this.stack.pop();ne.value+=this.sliceSerialize(L),ne.position.end=pr(L.end)}function R(L){const ne=this.stack[this.stack.length-1];if(this.data.atHardBreak){const xe=ne.children[ne.children.length-1];xe.position.end=pr(L.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&a.canContainEols.includes(ne.type)&&(G.call(this,L),C.call(this,L))}function z(){this.data.atHardBreak=!0}function F(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function J(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function H(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.value=L}function I(){const L=this.stack[this.stack.length-1];if(this.data.inReference){const ne=this.data.referenceType||"shortcut";L.type+="Reference",L.referenceType=ne,delete L.url,delete L.title}else delete L.identifier,delete L.label;this.data.referenceType=void 0}function V(){const L=this.stack[this.stack.length-1];if(this.data.inReference){const ne=this.data.referenceType||"shortcut";L.type+="Reference",L.referenceType=ne,delete L.url,delete L.title}else delete L.identifier,delete L.label;this.data.referenceType=void 0}function re(L){const ne=this.sliceSerialize(L),xe=this.stack[this.stack.length-2];xe.label=Fw(ne),xe.identifier=Po(ne).toLowerCase()}function B(){const L=this.stack[this.stack.length-1],ne=this.resume(),xe=this.stack[this.stack.length-1];if(this.data.inReference=!0,xe.type==="link"){const ae=L.children;xe.children=ae}else xe.alt=ne}function k(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.url=L}function Ne(){const L=this.resume(),ne=this.stack[this.stack.length-1];ne.title=L}function Ae(){this.data.inReference=void 0}function T(){this.data.referenceType="collapsed"}function Ce(L){const ne=this.resume(),xe=this.stack[this.stack.length-1];xe.label=ne,xe.identifier=Po(this.sliceSerialize(L)).toLowerCase(),this.data.referenceType="full"}function Ue(L){this.data.characterReferenceType=L.type}function Pe(L){const ne=this.sliceSerialize(L),xe=this.data.characterReferenceType;let ae;xe?(ae=_w(ne,xe==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):ae=Ox(ne);const we=this.stack[this.stack.length-1];we.value+=ae}function de(L){const ne=this.stack.pop();ne.position.end=pr(L.end)}function Se(L){C.call(this,L);const ne=this.stack[this.stack.length-1];ne.url=this.sliceSerialize(L)}function ee(L){C.call(this,L);const ne=this.stack[this.stack.length-1];ne.url="mailto:"+this.sliceSerialize(L)}function oe(){return{type:"blockquote",children:[]}}function fe(){return{type:"code",lang:null,meta:null,value:""}}function ge(){return{type:"inlineCode",value:""}}function q(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function W(){return{type:"emphasis",children:[]}}function Y(){return{type:"heading",depth:0,children:[]}}function ie(){return{type:"break"}}function ce(){return{type:"html",value:""}}function pe(){return{type:"image",title:null,url:"",alt:null}}function He(){return{type:"link",title:null,url:"",children:[]}}function We(L){return{type:"list",ordered:L.type==="listOrdered",start:null,spread:L._spread,children:[]}}function st(L){return{type:"listItem",spread:L._spread,checked:null,children:[]}}function me(){return{type:"paragraph",children:[]}}function ve(){return{type:"strong",children:[]}}function Fe(){return{type:"text",value:""}}function Ee(){return{type:"thematicBreak"}}}function pr(t){return{line:t.line,column:t.column,offset:t.offset}}function $w(t,a){let n=-1;for(;++n<a.length;){const i=a[n];Array.isArray(i)?$w(t,i):O6(t,i)}}function O6(t,a){let n;for(n in a)if(Lw.call(a,n))switch(n){case"canContainEols":{const i=a[n];i&&t[n].push(...i);break}case"transforms":{const i=a[n];i&&t[n].push(...i);break}case"enter":case"exit":{const i=a[n];i&&Object.assign(t[n],i);break}}}function _0(t,a){throw t?new Error("Cannot close `"+t.type+"` ("+vu({start:t.start,end:t.end})+"): a different token (`"+a.type+"`, "+vu({start:a.start,end:a.end})+") is open"):new Error("Cannot close document, a token (`"+a.type+"`, "+vu({start:a.start,end:a.end})+") is still open")}function I6(t){const a=this;a.parser=n;function n(i){return P6(i,{...a.data("settings"),...t,extensions:a.data("micromarkExtensions")||[],mdastExtensions:a.data("fromMarkdownExtensions")||[]})}}const D0={}.hasOwnProperty;function Mw(t,a){const n=a||{};function i(l,...c){let o=i.invalid;const d=i.handlers;if(l&&D0.call(l,t)){const h=String(l[t]);o=D0.call(d,h)?d[h]:i.unknown}if(o)return o.call(this,l,...c)}return i.handlers=n.handlers||{},i.invalid=n.invalid,i.unknown=n.unknown,i}const z6={}.hasOwnProperty;function Bw(t,a){let n=-1,i;if(a.extensions)for(;++n<a.extensions.length;)Bw(t,a.extensions[n]);for(i in a)if(z6.call(a,i))switch(i){case"extensions":break;case"unsafe":{E0(t[i],a[i]);break}case"join":{E0(t[i],a[i]);break}case"handlers":{F6(t[i],a[i]);break}default:t.options[i]=a[i]}return t}function E0(t,a){a&&t.push(...a)}function F6(t,a){a&&Object.assign(t,a)}function L6(t,a,n,i){const l=n.enter("blockquote"),c=n.createTracker(i);c.move("> "),c.shift(2);const o=n.indentLines(n.containerFlow(t,c.current()),$6);return l(),o}function $6(t,a,n){return">"+(n?"":" ")+t}function Uw(t,a){return T0(t,a.inConstruct,!0)&&!T0(t,a.notInConstruct,!1)}function T0(t,a,n){if(typeof a=="string"&&(a=[a]),!a||a.length===0)return n;let i=-1;for(;++i<a.length;)if(t.includes(a[i]))return!0;return!1}function A0(t,a,n,i){let l=-1;for(;++l<n.unsafe.length;)if(n.unsafe[l].character===`
`&&Uw(n.stack,n.unsafe[l]))return/[ \t]/.test(i.before)?"":" ";return`\\
`}function M6(t,a){const n=String(t);let i=n.indexOf(a),l=i,c=0,o=0;if(typeof a!="string")throw new TypeError("Expected substring");for(;i!==-1;)i===l?++c>o&&(o=c):c=1,l=i+a.length,i=n.indexOf(a,l);return o}function Ug(t,a){return!!(a.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function B6(t){const a=t.options.fence||"`";if(a!=="`"&&a!=="~")throw new Error("Cannot serialize code with `"+a+"` for `options.fence`, expected `` ` `` or `~`");return a}function U6(t,a,n,i){const l=B6(n),c=t.value||"",o=l==="`"?"GraveAccent":"Tilde";if(Ug(t,n)){const g=n.enter("codeIndented"),y=n.indentLines(c,q6);return g(),y}const d=n.createTracker(i),h=l.repeat(Math.max(M6(c,l)+1,3)),m=n.enter("codeFenced");let f=d.move(h);if(t.lang){const g=n.enter(`codeFencedLang${o}`);f+=d.move(n.safe(t.lang,{before:f,after:" ",encode:["`"],...d.current()})),g()}if(t.lang&&t.meta){const g=n.enter(`codeFencedMeta${o}`);f+=d.move(" "),f+=d.move(n.safe(t.meta,{before:f,after:`
`,encode:["`"],...d.current()})),g()}return f+=d.move(`
`),c&&(f+=d.move(c+`
`)),f+=d.move(h),m(),f}function q6(t,a,n){return(n?"":"    ")+t}function Fx(t){const a=t.options.quote||'"';if(a!=='"'&&a!=="'")throw new Error("Cannot serialize title with `"+a+"` for `options.quote`, expected `\"`, or `'`");return a}function H6(t,a,n,i){const l=Fx(n),c=l==='"'?"Quote":"Apostrophe",o=n.enter("definition");let d=n.enter("label");const h=n.createTracker(i);let m=h.move("[");return m+=h.move(n.safe(n.associationId(t),{before:m,after:"]",...h.current()})),m+=h.move("]: "),d(),!t.url||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=h.move("<"),m+=h.move(n.safe(t.url,{before:m,after:">",...h.current()})),m+=h.move(">")):(d=n.enter("destinationRaw"),m+=h.move(n.safe(t.url,{before:m,after:t.title?" ":`
`,...h.current()}))),d(),t.title&&(d=n.enter(`title${c}`),m+=h.move(" "+l),m+=h.move(n.safe(t.title,{before:m,after:l,...h.current()})),m+=h.move(l),d()),o(),m}function V6(t){const a=t.options.emphasis||"*";if(a!=="*"&&a!=="_")throw new Error("Cannot serialize emphasis with `"+a+"` for `options.emphasis`, expected `*`, or `_`");return a}function _r(t){return"&#x"+t.toString(16).toUpperCase()+";"}function Qh(t,a,n){const i=Gh(t),l=Gh(a);return i===void 0?l===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:l===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:i===1?l===void 0?{inside:!1,outside:!1}:l===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:l===void 0?{inside:!1,outside:!1}:l===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}qw.peek=G6;function qw(t,a,n,i){const l=V6(n),c=n.enter("emphasis"),o=n.createTracker(i),d=o.move(l);let h=o.move(n.containerPhrasing(t,{after:l,before:d,...o.current()}));const m=h.charCodeAt(0),f=Qh(i.before.charCodeAt(i.before.length-1),m,l);f.inside&&(h=_r(m)+h.slice(1));const g=h.charCodeAt(h.length-1),y=Qh(i.after.charCodeAt(0),g,l);y.inside&&(h=h.slice(0,-1)+_r(g));const b=o.move(l);return c(),n.attentionEncodeSurroundingInfo={after:y.outside,before:f.outside},d+h+b}function G6(t,a,n){return n.options.emphasis||"*"}const Lx=function(t){if(t==null)return K6;if(typeof t=="function")return pm(t);if(typeof t=="object")return Array.isArray(t)?Q6(t):Y6(t);if(typeof t=="string")return J6(t);throw new Error("Expected function, string, or object as test")};function Q6(t){const a=[];let n=-1;for(;++n<t.length;)a[n]=Lx(t[n]);return pm(i);function i(...l){let c=-1;for(;++c<a.length;)if(a[c].apply(this,l))return!0;return!1}}function Y6(t){const a=t;return pm(n);function n(i){const l=i;let c;for(c in t)if(l[c]!==a[c])return!1;return!0}}function J6(t){return pm(a);function a(n){return n&&n.type===t}}function pm(t){return a;function a(n,i,l){return!!(W6(n)&&t.call(this,n,typeof i=="number"?i:void 0,l||void 0))}}function K6(){return!0}function W6(t){return t!==null&&typeof t=="object"&&"type"in t}const Hw=[],X6=!0,qg=!1,Z6="skip";function ez(t,a,n,i){let l;typeof a=="function"&&typeof n!="function"?(i=n,n=a):l=a;const c=Lx(l),o=i?-1:1;d(t,void 0,[])();function d(h,m,f){const g=h&&typeof h=="object"?h:{};if(typeof g.type=="string"){const b=typeof g.tagName=="string"?g.tagName:typeof g.name=="string"?g.name:void 0;Object.defineProperty(y,"name",{value:"node ("+(h.type+(b?"<"+b+">":""))+")"})}return y;function y(){let b=Hw,v,w,S;if((!a||c(h,m,f[f.length-1]||void 0))&&(b=tz(n(h,f)),b[0]===qg))return b;if("children"in h&&h.children){const _=h;if(_.children&&b[0]!==Z6)for(w=(i?_.children.length:-1)+o,S=f.concat(_);w>-1&&w<_.children.length;){const E=_.children[w];if(v=d(E,w,S)(),v[0]===qg)return v;w=typeof v[1]=="number"?v[1]:w+o}}return b}}}function tz(t){return Array.isArray(t)?t:typeof t=="number"?[X6,t]:t==null?Hw:[t]}function Vw(t,a,n,i){let l,c,o;typeof a=="function"?(c=void 0,o=a,l=n):(c=a,o=n,l=i),ez(t,c,d,l);function d(h,m){const f=m[m.length-1],g=f?f.children.indexOf(h):void 0;return o(h,g,f)}}function Gw(t,a){let n=!1;return Vw(t,function(i){if("value"in i&&/\r?\n|\r/.test(i.value)||i.type==="break")return n=!0,qg}),!!((!t.depth||t.depth<3)&&Rx(t)&&(a.options.setext||n))}function nz(t,a,n,i){const l=Math.max(Math.min(6,t.depth||1),1),c=n.createTracker(i);if(Gw(t,n)){const f=n.enter("headingSetext"),g=n.enter("phrasing"),y=n.containerPhrasing(t,{...c.current(),before:`
`,after:`
`});return g(),f(),y+`
`+(l===1?"=":"-").repeat(y.length-(Math.max(y.lastIndexOf("\r"),y.lastIndexOf(`
`))+1))}const o="#".repeat(l),d=n.enter("headingAtx"),h=n.enter("phrasing");c.move(o+" ");let m=n.containerPhrasing(t,{before:"# ",after:`
`,...c.current()});return/^[\t ]/.test(m)&&(m=_r(m.charCodeAt(0))+m.slice(1)),m=m?o+" "+m:o,n.options.closeAtx&&(m+=" "+o),h(),d(),m}Qw.peek=az;function Qw(t){return t.value||""}function az(){return"<"}Yw.peek=sz;function Yw(t,a,n,i){const l=Fx(n),c=l==='"'?"Quote":"Apostrophe",o=n.enter("image");let d=n.enter("label");const h=n.createTracker(i);let m=h.move("![");return m+=h.move(n.safe(t.alt,{before:m,after:"]",...h.current()})),m+=h.move("]("),d(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(d=n.enter("destinationLiteral"),m+=h.move("<"),m+=h.move(n.safe(t.url,{before:m,after:">",...h.current()})),m+=h.move(">")):(d=n.enter("destinationRaw"),m+=h.move(n.safe(t.url,{before:m,after:t.title?" ":")",...h.current()}))),d(),t.title&&(d=n.enter(`title${c}`),m+=h.move(" "+l),m+=h.move(n.safe(t.title,{before:m,after:l,...h.current()})),m+=h.move(l),d()),m+=h.move(")"),o(),m}function sz(){return"!"}Jw.peek=iz;function Jw(t,a,n,i){const l=t.referenceType,c=n.enter("imageReference");let o=n.enter("label");const d=n.createTracker(i);let h=d.move("![");const m=n.safe(t.alt,{before:h,after:"]",...d.current()});h+=d.move(m+"]["),o();const f=n.stack;n.stack=[],o=n.enter("reference");const g=n.safe(n.associationId(t),{before:h,after:"]",...d.current()});return o(),n.stack=f,c(),l==="full"||!m||m!==g?h+=d.move(g+"]"):l==="shortcut"?h=h.slice(0,-1):h+=d.move("]"),h}function iz(){return"!"}Kw.peek=rz;function Kw(t,a,n){let i=t.value||"",l="`",c=-1;for(;new RegExp("(^|[^`])"+l+"([^`]|$)").test(i);)l+="`";for(/[^ \r\n]/.test(i)&&(/^[ \r\n]/.test(i)&&/[ \r\n]$/.test(i)||/^`|`$/.test(i))&&(i=" "+i+" ");++c<n.unsafe.length;){const o=n.unsafe[c],d=n.compilePattern(o);let h;if(o.atBreak)for(;h=d.exec(i);){let m=h.index;i.charCodeAt(m)===10&&i.charCodeAt(m-1)===13&&m--,i=i.slice(0,m)+" "+i.slice(h.index+1)}}return l+i+l}function rz(){return"`"}function Ww(t,a){const n=Rx(t);return!!(!a.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}Xw.peek=lz;function Xw(t,a,n,i){const l=Fx(n),c=l==='"'?"Quote":"Apostrophe",o=n.createTracker(i);let d,h;if(Ww(t,n)){const f=n.stack;n.stack=[],d=n.enter("autolink");let g=o.move("<");return g+=o.move(n.containerPhrasing(t,{before:g,after:">",...o.current()})),g+=o.move(">"),d(),n.stack=f,g}d=n.enter("link"),h=n.enter("label");let m=o.move("[");return m+=o.move(n.containerPhrasing(t,{before:m,after:"](",...o.current()})),m+=o.move("]("),h(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(h=n.enter("destinationLiteral"),m+=o.move("<"),m+=o.move(n.safe(t.url,{before:m,after:">",...o.current()})),m+=o.move(">")):(h=n.enter("destinationRaw"),m+=o.move(n.safe(t.url,{before:m,after:t.title?" ":")",...o.current()}))),h(),t.title&&(h=n.enter(`title${c}`),m+=o.move(" "+l),m+=o.move(n.safe(t.title,{before:m,after:l,...o.current()})),m+=o.move(l),h()),m+=o.move(")"),d(),m}function lz(t,a,n){return Ww(t,n)?"<":"["}Zw.peek=oz;function Zw(t,a,n,i){const l=t.referenceType,c=n.enter("linkReference");let o=n.enter("label");const d=n.createTracker(i);let h=d.move("[");const m=n.containerPhrasing(t,{before:h,after:"]",...d.current()});h+=d.move(m+"]["),o();const f=n.stack;n.stack=[],o=n.enter("reference");const g=n.safe(n.associationId(t),{before:h,after:"]",...d.current()});return o(),n.stack=f,c(),l==="full"||!m||m!==g?h+=d.move(g+"]"):l==="shortcut"?h=h.slice(0,-1):h+=d.move("]"),h}function oz(){return"["}function $x(t){const a=t.options.bullet||"*";if(a!=="*"&&a!=="+"&&a!=="-")throw new Error("Cannot serialize items with `"+a+"` for `options.bullet`, expected `*`, `+`, or `-`");return a}function cz(t){const a=$x(t),n=t.options.bulletOther;if(!n)return a==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===a)throw new Error("Expected `bullet` (`"+a+"`) and `bulletOther` (`"+n+"`) to be different");return n}function uz(t){const a=t.options.bulletOrdered||".";if(a!=="."&&a!==")")throw new Error("Cannot serialize items with `"+a+"` for `options.bulletOrdered`, expected `.` or `)`");return a}function eS(t){const a=t.options.rule||"*";if(a!=="*"&&a!=="-"&&a!=="_")throw new Error("Cannot serialize rules with `"+a+"` for `options.rule`, expected `*`, `-`, or `_`");return a}function dz(t,a,n,i){const l=n.enter("list"),c=n.bulletCurrent;let o=t.ordered?uz(n):$x(n);const d=t.ordered?o==="."?")":".":cz(n);let h=a&&n.bulletLastUsed?o===n.bulletLastUsed:!1;if(!t.ordered){const f=t.children?t.children[0]:void 0;if((o==="*"||o==="-")&&f&&(!f.children||!f.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(h=!0),eS(n)===o&&f){let g=-1;for(;++g<t.children.length;){const y=t.children[g];if(y&&y.type==="listItem"&&y.children&&y.children[0]&&y.children[0].type==="thematicBreak"){h=!0;break}}}}h&&(o=d),n.bulletCurrent=o;const m=n.containerFlow(t,i);return n.bulletLastUsed=o,n.bulletCurrent=c,l(),m}function hz(t){const a=t.options.listItemIndent||"one";if(a!=="tab"&&a!=="one"&&a!=="mixed")throw new Error("Cannot serialize items with `"+a+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return a}function mz(t,a,n,i){const l=hz(n);let c=n.bulletCurrent||$x(n);a&&a.type==="list"&&a.ordered&&(c=(typeof a.start=="number"&&a.start>-1?a.start:1)+(n.options.incrementListMarker===!1?0:a.children.indexOf(t))+c);let o=c.length+1;(l==="tab"||l==="mixed"&&(a&&a.type==="list"&&a.spread||t.spread))&&(o=Math.ceil(o/4)*4);const d=n.createTracker(i);d.move(c+" ".repeat(o-c.length)),d.shift(o);const h=n.enter("listItem"),m=n.indentLines(n.containerFlow(t,d.current()),f);return h(),m;function f(g,y,b){return y?(b?"":" ".repeat(o))+g:(b?c:c+" ".repeat(o-c.length))+g}}function pz(t,a,n,i){const l=n.enter("paragraph"),c=n.enter("phrasing"),o=n.containerPhrasing(t,i);return c(),l(),o}const fz=Lx(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function gz(t,a,n,i){return(t.children.some(function(o){return fz(o)})?n.containerPhrasing:n.containerFlow).call(n,t,i)}function xz(t){const a=t.options.strong||"*";if(a!=="*"&&a!=="_")throw new Error("Cannot serialize strong with `"+a+"` for `options.strong`, expected `*`, or `_`");return a}tS.peek=yz;function tS(t,a,n,i){const l=xz(n),c=n.enter("strong"),o=n.createTracker(i),d=o.move(l+l);let h=o.move(n.containerPhrasing(t,{after:l,before:d,...o.current()}));const m=h.charCodeAt(0),f=Qh(i.before.charCodeAt(i.before.length-1),m,l);f.inside&&(h=_r(m)+h.slice(1));const g=h.charCodeAt(h.length-1),y=Qh(i.after.charCodeAt(0),g,l);y.inside&&(h=h.slice(0,-1)+_r(g));const b=o.move(l+l);return c(),n.attentionEncodeSurroundingInfo={after:y.outside,before:f.outside},d+h+b}function yz(t,a,n){return n.options.strong||"*"}function bz(t,a,n,i){return n.safe(t.value,i)}function jz(t){const a=t.options.ruleRepetition||3;if(a<3)throw new Error("Cannot serialize rules with repetition `"+a+"` for `options.ruleRepetition`, expected `3` or more");return a}function vz(t,a,n){const i=(eS(n)+(n.options.ruleSpaces?" ":"")).repeat(jz(n));return n.options.ruleSpaces?i.slice(0,-1):i}const Nz={blockquote:L6,break:A0,code:U6,definition:H6,emphasis:qw,hardBreak:A0,heading:nz,html:Qw,image:Yw,imageReference:Jw,inlineCode:Kw,link:Xw,linkReference:Zw,list:dz,listItem:mz,paragraph:pz,root:gz,strong:tS,text:bz,thematicBreak:vz},wz=[Sz];function Sz(t,a,n,i){if(a.type==="code"&&Ug(a,i)&&(t.type==="list"||t.type===a.type&&Ug(t,i)))return!1;if("spread"in n&&typeof n.spread=="boolean")return t.type==="paragraph"&&(t.type===a.type||a.type==="definition"||a.type==="heading"&&Gw(a,i))?void 0:n.spread?1:0}const rl=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],kz=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:rl},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:rl},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:rl},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:rl},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:rl},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:rl},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:rl},{atBreak:!0,character:"~"}];function Cz(t){return t.label||!t.identifier?t.label||"":Fw(t.identifier)}function _z(t){if(!t._compiled){const a=(t.atBreak?"[\\r\\n][\\t ]*":"")+(t.before?"(?:"+t.before+")":"");t._compiled=new RegExp((a?"("+a+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(t.character)?"\\":"")+t.character+(t.after?"(?:"+t.after+")":""),"g")}return t._compiled}function Dz(t,a,n){const i=a.indexStack,l=t.children||[],c=[];let o=-1,d=n.before,h;i.push(-1);let m=a.createTracker(n);for(;++o<l.length;){const f=l[o];let g;if(i[i.length-1]=o,o+1<l.length){let v=a.handle.handlers[l[o+1].type];v&&v.peek&&(v=v.peek),g=v?v(l[o+1],t,a,{before:"",after:"",...m.current()}).charAt(0):""}else g=n.after;c.length>0&&(d==="\r"||d===`
`)&&f.type==="html"&&(c[c.length-1]=c[c.length-1].replace(/(\r?\n|\r)$/," "),d=" ",m=a.createTracker(n),m.move(c.join("")));let y=a.handle(f,t,a,{...m.current(),after:g,before:d});h&&h===y.slice(0,1)&&(y=_r(h.charCodeAt(0))+y.slice(1));const b=a.attentionEncodeSurroundingInfo;a.attentionEncodeSurroundingInfo=void 0,h=void 0,b&&(c.length>0&&b.before&&d===c[c.length-1].slice(-1)&&(c[c.length-1]=c[c.length-1].slice(0,-1)+_r(d.charCodeAt(0))),b.after&&(h=g)),m.move(y),c.push(y),d=y.slice(-1)}return i.pop(),c.join("")}function Ez(t,a,n){const i=a.indexStack,l=t.children||[],c=a.createTracker(n),o=[];let d=-1;for(i.push(-1);++d<l.length;){const h=l[d];i[i.length-1]=d,o.push(c.move(a.handle(h,t,a,{before:`
`,after:`
`,...c.current()}))),h.type!=="list"&&(a.bulletLastUsed=void 0),d<l.length-1&&o.push(c.move(Tz(h,l[d+1],t,a)))}return i.pop(),o.join("")}function Tz(t,a,n,i){let l=i.join.length;for(;l--;){const c=i.join[l](t,a,n,i);if(c===!0||c===1)break;if(typeof c=="number")return`
`.repeat(1+c);if(c===!1)return`

<!---->

`}return`

`}const Az=/\r?\n|\r/g;function Pz(t,a){const n=[];let i=0,l=0,c;for(;c=Az.exec(t);)o(t.slice(i,c.index)),n.push(c[0]),i=c.index+c[0].length,l++;return o(t.slice(i)),n.join("");function o(d){n.push(a(d,l,!d))}}function Rz(t,a,n){const i=(n.before||"")+(a||"")+(n.after||""),l=[],c=[],o={};let d=-1;for(;++d<t.unsafe.length;){const f=t.unsafe[d];if(!Uw(t.stack,f))continue;const g=t.compilePattern(f);let y;for(;y=g.exec(i);){const b="before"in f||!!f.atBreak,v="after"in f,w=y.index+(b?y[1].length:0);l.includes(w)?(o[w].before&&!b&&(o[w].before=!1),o[w].after&&!v&&(o[w].after=!1)):(l.push(w),o[w]={before:b,after:v})}}l.sort(Oz);let h=n.before?n.before.length:0;const m=i.length-(n.after?n.after.length:0);for(d=-1;++d<l.length;){const f=l[d];f<h||f>=m||f+1<m&&l[d+1]===f+1&&o[f].after&&!o[f+1].before&&!o[f+1].after||l[d-1]===f-1&&o[f].before&&!o[f-1].before&&!o[f-1].after||(h!==f&&c.push(P0(i.slice(h,f),"\\")),h=f,/[!-/:-@[-`{-~]/.test(i.charAt(f))&&(!n.encode||!n.encode.includes(i.charAt(f)))?c.push("\\"):(c.push(_r(i.charCodeAt(f))),h++))}return c.push(P0(i.slice(h,m),n.after)),c.join("")}function Oz(t,a){return t-a}function P0(t,a){const n=/\\(?=[!-/:-@[-`{-~])/g,i=[],l=[],c=t+a;let o=-1,d=0,h;for(;h=n.exec(c);)i.push(h.index);for(;++o<i.length;)d!==i[o]&&l.push(t.slice(d,i[o])),l.push("\\"),d=i[o];return l.push(t.slice(d)),l.join("")}function Iz(t){const a=t||{},n=a.now||{};let i=a.lineShift||0,l=n.line||1,c=n.column||1;return{move:h,current:o,shift:d};function o(){return{now:{line:l,column:c},lineShift:i}}function d(m){i+=m}function h(m){const f=m||"",g=f.split(/\r?\n|\r/g),y=g[g.length-1];return l+=g.length-1,c=g.length===1?c+y.length:1+y.length+i,f}}function zz(t,a){const n=a||{},i={associationId:Cz,containerPhrasing:Mz,containerFlow:Bz,createTracker:Iz,compilePattern:_z,enter:c,handlers:{...Nz},handle:void 0,indentLines:Pz,indexStack:[],join:[...wz],options:{},safe:Uz,stack:[],unsafe:[...kz]};Bw(i,n),i.options.tightDefinitions&&i.join.push($z),i.handle=Mw("type",{invalid:Fz,unknown:Lz,handlers:i.handlers});let l=i.handle(t,void 0,i,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return l&&l.charCodeAt(l.length-1)!==10&&l.charCodeAt(l.length-1)!==13&&(l+=`
`),l;function c(o){return i.stack.push(o),d;function d(){i.stack.pop()}}}function Fz(t){throw new Error("Cannot handle value `"+t+"`, expected node")}function Lz(t){const a=t;throw new Error("Cannot handle unknown node `"+a.type+"`")}function $z(t,a){if(t.type==="definition"&&t.type===a.type)return 0}function Mz(t,a){return Dz(t,this,a)}function Bz(t,a){return Ez(t,this,a)}function Uz(t,a){return Rz(this,t,a)}function qz(t){const a=this;a.compiler=n;function n(i){return zz(i,{...a.data("settings"),...t,extensions:a.data("toMarkdownExtensions")||[]})}}function R0(t){if(t)throw t}var Mf,O0;function Hz(){if(O0)return Mf;O0=1;var t=Object.prototype.hasOwnProperty,a=Object.prototype.toString,n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,l=function(m){return typeof Array.isArray=="function"?Array.isArray(m):a.call(m)==="[object Array]"},c=function(m){if(!m||a.call(m)!=="[object Object]")return!1;var f=t.call(m,"constructor"),g=m.constructor&&m.constructor.prototype&&t.call(m.constructor.prototype,"isPrototypeOf");if(m.constructor&&!f&&!g)return!1;var y;for(y in m);return typeof y>"u"||t.call(m,y)},o=function(m,f){n&&f.name==="__proto__"?n(m,f.name,{enumerable:!0,configurable:!0,value:f.newValue,writable:!0}):m[f.name]=f.newValue},d=function(m,f){if(f==="__proto__")if(t.call(m,f)){if(i)return i(m,f).value}else return;return m[f]};return Mf=function h(){var m,f,g,y,b,v,w=arguments[0],S=1,_=arguments.length,E=!1;for(typeof w=="boolean"&&(E=w,w=arguments[1]||{},S=2),(w==null||typeof w!="object"&&typeof w!="function")&&(w={});S<_;++S)if(m=arguments[S],m!=null)for(f in m)g=d(w,f),y=d(m,f),w!==y&&(E&&y&&(c(y)||(b=l(y)))?(b?(b=!1,v=g&&l(g)?g:[]):v=g&&c(g)?g:{},o(w,{name:f,newValue:h(E,v,y)})):typeof y<"u"&&o(w,{name:f,newValue:y}));return w},Mf}var Vz=Hz();const Bf=Pu(Vz);function Hg(t){if(typeof t!="object"||t===null)return!1;const a=Object.getPrototypeOf(t);return(a===null||a===Object.prototype||Object.getPrototypeOf(a)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function Gz(){const t=[],a={run:n,use:i};return a;function n(...l){let c=-1;const o=l.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);d(null,...l);function d(h,...m){const f=t[++c];let g=-1;if(h){o(h);return}for(;++g<l.length;)(m[g]===null||m[g]===void 0)&&(m[g]=l[g]);l=m,f?Qz(f,d)(...m):o(null,...m)}}function i(l){if(typeof l!="function")throw new TypeError("Expected `middelware` to be a function, not "+l);return t.push(l),a}}function Qz(t,a){let n;return i;function i(...o){const d=t.length>o.length;let h;d&&o.push(l);try{h=t.apply(this,o)}catch(m){const f=m;if(d&&n)throw f;return l(f)}d||(h&&h.then&&typeof h.then=="function"?h.then(c,l):h instanceof Error?l(h):c(h))}function l(o,...d){n||(n=!0,a(o,...d))}function c(o){l(null,o)}}class Ea extends Error{constructor(a,n,i){super(),typeof n=="string"&&(i=n,n=void 0);let l="",c={},o=!1;if(n&&("line"in n&&"column"in n?c={place:n}:"start"in n&&"end"in n?c={place:n}:"type"in n?c={ancestors:[n],place:n.position}:c={...n}),typeof a=="string"?l=a:!c.cause&&a&&(o=!0,l=a.message,c.cause=a),!c.ruleId&&!c.source&&typeof i=="string"){const h=i.indexOf(":");h===-1?c.ruleId=i:(c.source=i.slice(0,h),c.ruleId=i.slice(h+1))}if(!c.place&&c.ancestors&&c.ancestors){const h=c.ancestors[c.ancestors.length-1];h&&(c.place=h.position)}const d=c.place&&"start"in c.place?c.place.start:c.place;this.ancestors=c.ancestors||void 0,this.cause=c.cause||void 0,this.column=d?d.column:void 0,this.fatal=void 0,this.file="",this.message=l,this.line=d?d.line:void 0,this.name=vu(c.place)||"1:1",this.place=c.place||void 0,this.reason=this.message,this.ruleId=c.ruleId||void 0,this.source=c.source||void 0,this.stack=o&&c.cause&&typeof c.cause.stack=="string"?c.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ea.prototype.file="";Ea.prototype.name="";Ea.prototype.reason="";Ea.prototype.message="";Ea.prototype.stack="";Ea.prototype.column=void 0;Ea.prototype.line=void 0;Ea.prototype.ancestors=void 0;Ea.prototype.cause=void 0;Ea.prototype.fatal=void 0;Ea.prototype.place=void 0;Ea.prototype.ruleId=void 0;Ea.prototype.source=void 0;const Hs={basename:Yz,dirname:Jz,extname:Kz,join:Wz,sep:"/"};function Yz(t,a){if(a!==void 0&&typeof a!="string")throw new TypeError('"ext" argument must be a string');Bu(t);let n=0,i=-1,l=t.length,c;if(a===void 0||a.length===0||a.length>t.length){for(;l--;)if(t.codePointAt(l)===47){if(c){n=l+1;break}}else i<0&&(c=!0,i=l+1);return i<0?"":t.slice(n,i)}if(a===t)return"";let o=-1,d=a.length-1;for(;l--;)if(t.codePointAt(l)===47){if(c){n=l+1;break}}else o<0&&(c=!0,o=l+1),d>-1&&(t.codePointAt(l)===a.codePointAt(d--)?d<0&&(i=l):(d=-1,i=o));return n===i?i=o:i<0&&(i=t.length),t.slice(n,i)}function Jz(t){if(Bu(t),t.length===0)return".";let a=-1,n=t.length,i;for(;--n;)if(t.codePointAt(n)===47){if(i){a=n;break}}else i||(i=!0);return a<0?t.codePointAt(0)===47?"/":".":a===1&&t.codePointAt(0)===47?"//":t.slice(0,a)}function Kz(t){Bu(t);let a=t.length,n=-1,i=0,l=-1,c=0,o;for(;a--;){const d=t.codePointAt(a);if(d===47){if(o){i=a+1;break}continue}n<0&&(o=!0,n=a+1),d===46?l<0?l=a:c!==1&&(c=1):l>-1&&(c=-1)}return l<0||n<0||c===0||c===1&&l===n-1&&l===i+1?"":t.slice(l,n)}function Wz(...t){let a=-1,n;for(;++a<t.length;)Bu(t[a]),t[a]&&(n=n===void 0?t[a]:n+"/"+t[a]);return n===void 0?".":Xz(n)}function Xz(t){Bu(t);const a=t.codePointAt(0)===47;let n=Zz(t,!a);return n.length===0&&!a&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),a?"/"+n:n}function Zz(t,a){let n="",i=0,l=-1,c=0,o=-1,d,h;for(;++o<=t.length;){if(o<t.length)d=t.codePointAt(o);else{if(d===47)break;d=47}if(d===47){if(!(l===o-1||c===1))if(l!==o-1&&c===2){if(n.length<2||i!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(h=n.lastIndexOf("/"),h!==n.length-1){h<0?(n="",i=0):(n=n.slice(0,h),i=n.length-1-n.lastIndexOf("/")),l=o,c=0;continue}}else if(n.length>0){n="",i=0,l=o,c=0;continue}}a&&(n=n.length>0?n+"/..":"..",i=2)}else n.length>0?n+="/"+t.slice(l+1,o):n=t.slice(l+1,o),i=o-l-1;l=o,c=0}else d===46&&c>-1?c++:c=-1}return n}function Bu(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const eF={cwd:tF};function tF(){return"/"}function Vg(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function nF(t){if(typeof t=="string")t=new URL(t);else if(!Vg(t)){const a=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw a.code="ERR_INVALID_ARG_TYPE",a}if(t.protocol!=="file:"){const a=new TypeError("The URL must be of scheme file");throw a.code="ERR_INVALID_URL_SCHEME",a}return aF(t)}function aF(t){if(t.hostname!==""){const i=new TypeError('File URL host must be "localhost" or empty on darwin');throw i.code="ERR_INVALID_FILE_URL_HOST",i}const a=t.pathname;let n=-1;for(;++n<a.length;)if(a.codePointAt(n)===37&&a.codePointAt(n+1)===50){const i=a.codePointAt(n+2);if(i===70||i===102){const l=new TypeError("File URL path must not include encoded / characters");throw l.code="ERR_INVALID_FILE_URL_PATH",l}}return decodeURIComponent(a)}const Uf=["history","path","basename","stem","extname","dirname"];class sF{constructor(a){let n;a?Vg(a)?n={path:a}:typeof a=="string"||iF(a)?n={value:a}:n=a:n={},this.cwd="cwd"in n?"":eF.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let i=-1;for(;++i<Uf.length;){const c=Uf[i];c in n&&n[c]!==void 0&&n[c]!==null&&(this[c]=c==="history"?[...n[c]]:n[c])}let l;for(l in n)Uf.includes(l)||(this[l]=n[l])}get basename(){return typeof this.path=="string"?Hs.basename(this.path):void 0}set basename(a){Hf(a,"basename"),qf(a,"basename"),this.path=Hs.join(this.dirname||"",a)}get dirname(){return typeof this.path=="string"?Hs.dirname(this.path):void 0}set dirname(a){I0(this.basename,"dirname"),this.path=Hs.join(a||"",this.basename)}get extname(){return typeof this.path=="string"?Hs.extname(this.path):void 0}set extname(a){if(qf(a,"extname"),I0(this.dirname,"extname"),a){if(a.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(a.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Hs.join(this.dirname,this.stem+(a||""))}get path(){return this.history[this.history.length-1]}set path(a){Vg(a)&&(a=nF(a)),Hf(a,"path"),this.path!==a&&this.history.push(a)}get stem(){return typeof this.path=="string"?Hs.basename(this.path,this.extname):void 0}set stem(a){Hf(a,"stem"),qf(a,"stem"),this.path=Hs.join(this.dirname||"",a+(this.extname||""))}fail(a,n,i){const l=this.message(a,n,i);throw l.fatal=!0,l}info(a,n,i){const l=this.message(a,n,i);return l.fatal=void 0,l}message(a,n,i){const l=new Ea(a,n,i);return this.path&&(l.name=this.path+":"+l.name,l.file=this.path),l.fatal=!1,this.messages.push(l),l}toString(a){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(a||void 0).decode(this.value)}}function qf(t,a){if(t&&t.includes(Hs.sep))throw new Error("`"+a+"` cannot be a path: did not expect `"+Hs.sep+"`")}function Hf(t,a){if(!t)throw new Error("`"+a+"` cannot be empty")}function I0(t,a){if(!t)throw new Error("Setting `"+a+"` requires `path` to be set too")}function iF(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const rF=function(t){const i=this.constructor.prototype,l=i[t],c=function(){return l.apply(c,arguments)};return Object.setPrototypeOf(c,i),c},lF={}.hasOwnProperty;class Mx extends rF{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Gz()}copy(){const a=new Mx;let n=-1;for(;++n<this.attachers.length;){const i=this.attachers[n];a.use(...i)}return a.data(Bf(!0,{},this.namespace)),a}data(a,n){return typeof a=="string"?arguments.length===2?(Qf("data",this.frozen),this.namespace[a]=n,this):lF.call(this.namespace,a)&&this.namespace[a]||void 0:a?(Qf("data",this.frozen),this.namespace=a,this):this.namespace}freeze(){if(this.frozen)return this;const a=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...i]=this.attachers[this.freezeIndex];if(i[0]===!1)continue;i[0]===!0&&(i[0]=void 0);const l=n.call(a,...i);typeof l=="function"&&this.transformers.use(l)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(a){this.freeze();const n=vh(a),i=this.parser||this.Parser;return Vf("parse",i),i(String(n),n)}process(a,n){const i=this;return this.freeze(),Vf("process",this.parser||this.Parser),Gf("process",this.compiler||this.Compiler),n?l(void 0,n):new Promise(l);function l(c,o){const d=vh(a),h=i.parse(d);i.run(h,d,function(f,g,y){if(f||!g||!y)return m(f);const b=g,v=i.stringify(b,y);uF(v)?y.value=v:y.result=v,m(f,y)});function m(f,g){f||!g?o(f):c?c(g):n(void 0,g)}}}processSync(a){let n=!1,i;return this.freeze(),Vf("processSync",this.parser||this.Parser),Gf("processSync",this.compiler||this.Compiler),this.process(a,l),F0("processSync","process",n),i;function l(c,o){n=!0,R0(c),i=o}}run(a,n,i){z0(a),this.freeze();const l=this.transformers;return!i&&typeof n=="function"&&(i=n,n=void 0),i?c(void 0,i):new Promise(c);function c(o,d){const h=vh(n);l.run(a,h,m);function m(f,g,y){const b=g||a;f?d(f):o?o(b):i(void 0,b,y)}}}runSync(a,n){let i=!1,l;return this.run(a,n,c),F0("runSync","run",i),l;function c(o,d){R0(o),l=d,i=!0}}stringify(a,n){this.freeze();const i=vh(n),l=this.compiler||this.Compiler;return Gf("stringify",l),z0(a),l(a,i)}use(a,...n){const i=this.attachers,l=this.namespace;if(Qf("use",this.frozen),a!=null)if(typeof a=="function")h(a,n);else if(typeof a=="object")Array.isArray(a)?d(a):o(a);else throw new TypeError("Expected usable value, not `"+a+"`");return this;function c(m){if(typeof m=="function")h(m,[]);else if(typeof m=="object")if(Array.isArray(m)){const[f,...g]=m;h(f,g)}else o(m);else throw new TypeError("Expected usable value, not `"+m+"`")}function o(m){if(!("plugins"in m)&&!("settings"in m))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");d(m.plugins),m.settings&&(l.settings=Bf(!0,l.settings,m.settings))}function d(m){let f=-1;if(m!=null)if(Array.isArray(m))for(;++f<m.length;){const g=m[f];c(g)}else throw new TypeError("Expected a list of plugins, not `"+m+"`")}function h(m,f){let g=-1,y=-1;for(;++g<i.length;)if(i[g][0]===m){y=g;break}if(y===-1)i.push([m,...f]);else if(f.length>0){let[b,...v]=f;const w=i[y][1];Hg(w)&&Hg(b)&&(b=Bf(!0,w,b)),i[y]=[m,b,...v]}}}}const oF=new Mx().freeze();function Vf(t,a){if(typeof a!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function Gf(t,a){if(typeof a!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Qf(t,a){if(a)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function z0(t){if(!Hg(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function F0(t,a,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+a+"` instead")}function vh(t){return cF(t)?t:new sF(t)}function cF(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function uF(t){return typeof t=="string"||dF(t)}function dF(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const Yf=oF().use(I6).use(qz).freeze(),hF=t=>{if(!t)return"Unknown Date";try{return new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},mF=t=>{switch(t){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:t,className:"status-badge"}}},Jf=({title:t,items:a,renderItemContent:n,headerAction:i,isLoading:l,loadingText:c,noDataText:o,onDeleteItem:d,onEditLabOrder:h,onSaveLabOrder:m,onCancelEditLabOrder:f,onLabOrderTestChange:g,onLabOrderStatusChange:y,onEditPharmacyOrder:b,onPrintUnavailablePrescription:v,onBillLabOrder:w,onUpdateLabOrderStatus:S,onEnterLabReport:_,labInventory:E=[],isSavingLabOrder:D=!1,expandedLabReports:O={},toggleLabReport:M=()=>{},selectionEnabled:A=!1,selectedIds:P=new Set,onSelectionChange:Q})=>{const G=x.useMemo(()=>{const R={};a.forEach(F=>{if(isNaN(F.date.getTime())){R["Unknown Date"]||(R["Unknown Date"]=[]),R["Unknown Date"].push(F);return}const J=hF(F.originalDateString);R[J]||(R[J]=[]),R[J].push(F)});const z=Object.keys(R);return z.sort((F,J)=>{if(F==="Unknown Date")return 1;if(J==="Unknown Date")return-1;try{const H=new Date(F.split(" ").reverse().join(" ")),I=new Date(J.split(" ").reverse().join(" "));if(!isNaN(H.getTime())&&!isNaN(I.getTime()))return I.getTime()-H.getTime()}catch{}return J.localeCompare(F)}),z.map(F=>({date:F,items:R[F]}))},[a]),C=["pending","billed","collected","processing","report_ready","completed","cancelled","reported"];return e.jsxs("div",{className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"ai-context-section-title mb-2 pb-1",children:t}),i]}),l&&e.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(R=>e.jsxs("div",{style:{padding:"10px",background:"var(--glass-light)",borderRadius:"8px",marginBottom:"8px"},children:[e.jsx(U,{width:"80px",height:"14px",style:{marginBottom:"10px"}}),e.jsx(U,{width:"100%",height:"16px",style:{marginBottom:"6px"}}),e.jsx(U,{width:"70%",height:"14px"})]},R))}),!l&&a.length===0&&e.jsx("p",{className:"ai-context-text italic",children:o}),!l&&a.length>0&&e.jsx("div",{className:"space-y-3",children:G.map(({date:R,items:z})=>e.jsxs("div",{children:[e.jsx("h5",{className:"grouped-history-date",children:R}),e.jsx("div",{className:"space-y-1 grouped-history-item-container",children:z.map((F,J)=>e.jsxs("div",{className:"grouped-history-item ai-context-item flex flex-col",children:[!(F.type==="Lab Order"&&F.data.isEditing)&&e.jsxs("div",{className:"flex justify-between items-center w-full",children:[A&&Q&&F.type==="Pharmacy Order"&&e.jsx("div",{className:"mr-2",children:e.jsx("input",{type:"checkbox",checked:P.has(F.data.id),onChange:H=>Q(F.data.id,H.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),e.jsx("div",{className:"flex-grow mr-2 ai-context-text",children:n(F,J,O,M)}),e.jsxs("div",{className:"flex items-center space-x-1",children:[F.type==="Lab Order"&&!F.data.isEditing&&h&&e.jsx("button",{onClick:()=>h(F.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this lab order",disabled:D,children:e.jsx(ys,{size:14})}),F.type==="Lab Order"&&F.data.isEditing&&e.jsx(e.Fragment,{}),F.type==="Lab Order"&&e.jsxs("div",{className:"lab-table-actions",children:[F.data.status==="pending"&&w&&(()=>{const H=F.data.tests.reduce((I,V)=>I+(Number(V.price)||0),0).toFixed(2);return e.jsx("button",{onClick:()=>w(F.data),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400",title:`Pay total of ${H}`,disabled:D,children:e.jsx(T1,{size:14})})})(),F.data.status==="billed"&&S&&e.jsx("button",{onClick:()=>S(F.data.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),F.data.status==="collected"&&S&&e.jsx("button",{onClick:()=>S(F.data.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),["pending","billed","collected","processing","report_ready","reported","completed"].includes(F.data.status)&&_&&e.jsx("button",{onClick:()=>_(F.data),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(F.data.status==="report_ready"||F.data.status==="reported")&&S&&e.jsx("button",{onClick:()=>S(F.data.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"})]}),F.type==="Pharmacy Order"&&F.data.status==="pending"&&b&&e.jsx("button",{onClick:()=>b(F.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this pharmacy order",disabled:D,children:e.jsx(ys,{size:14})}),F.type==="Pharmacy Order"&&F.data.prescriptionForUnavailableDrugs&&v&&e.jsx("button",{onClick:()=>v(F.data.prescriptionForUnavailableDrugs,`Prescription for Order ${F.data.id}`),className:"text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-100 focus:outline-none focus:ring-1 focus:ring-purple-400",title:"Print Prescription for Unavailable Drugs",disabled:D,children:e.jsx(Ys,{size:14})}),F.type==="Pharmacy Order"&&F.data.status==="pending"&&d&&e.jsx("button",{onClick:()=>d({type:F.type,data:F.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:"Delete this pending pharmacy order",disabled:D,children:e.jsx(Jt,{size:14})}),d&&["Complaint","Lab Order","Lab Report"].includes(F.type)&&e.jsx("button",{onClick:()=>d({type:F.type,data:F.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:`Delete this ${F.type.toLowerCase()}`,disabled:D,children:e.jsx(Jt,{size:14})})]})]}),F.type==="Lab Order"&&F.data.isEditing&&e.jsxs("div",{className:"lab-order-edit-form w-full bg-gray-50 border rounded-md p-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h6",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Edit Order"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Status:"}),e.jsx("select",{value:F.data.editedStatus||F.data.status,onChange:H=>y&&y(F.data.id,H.target.value),className:"form-select text-xs py-1 pl-2 pr-6 rounded border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:D,children:C.map(H=>e.jsx("option",{value:H,children:H.replace(/_/g," ")},H))})]})]}),e.jsx("div",{className:"overflow-hidden border rounded-md bg-white mb-3",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-3 font-medium text-gray-600",children:"Test Name"}),e.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-600 w-20",children:"Price"}),e.jsx("th",{className:"py-2 px-3 w-10"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[F.data.editedTests.map((H,I)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 px-3",children:e.jsxs("select",{value:H.id,onChange:V=>{const re=E.find(B=>String(B.id)===V.target.value);re&&(g&&g(F.data.id,I,"id",re.id),g&&g(F.data.id,I,"name",re.name),g&&g(F.data.id,I,"price",re.price))},className:"form-select w-full text-xs border-0 bg-transparent focus:ring-0 p-0",disabled:D,children:[e.jsx("option",{value:"",children:"Select Test"}),E.map(V=>e.jsx("option",{value:V.id,children:V.name},V.id))]})}),e.jsxs("td",{className:"py-1 px-3 text-right text-gray-700",children:["",H.price]}),e.jsx("td",{className:"py-1 px-3 text-center",children:e.jsx("button",{onClick:()=>{const V=F.data.editedTests.filter((re,B)=>B!==I);g&&g(F.data.id,-1,"remove",V)},className:"text-red-400 hover:text-red-600 focus:outline-none",title:"Remove test",disabled:D,children:e.jsx(Jt,{size:12})})})]},I)),F.data.editedTests.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 px-3 text-center italic text-gray-400",children:"No tests selected"})})]}),e.jsx("tfoot",{className:"bg-gray-50 border-t",children:e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-1 px-3",children:e.jsx("button",{onClick:()=>{g&&g(F.data.id,-1,"add",{id:"",name:"",price:0})},className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center py-1",disabled:D,children:"+ Add Test"})})})})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 border-t border-gray-200 pt-3 mt-1",children:[e.jsx("button",{onClick:()=>f&&f(F.data.id),className:"px-3 py-1.5 rounded text-xs text-gray-600 hover:bg-white hover:text-gray-800 border border-transparent hover:border-gray-200 transition-colors",disabled:D,children:"Cancel"}),e.jsx("button",{onClick:()=>m&&m(F.data.id,F.data.editedTests,F.data.editedStatus),className:"px-3 py-1.5 rounded text-xs bg-blue-600 text-white hover:bg-blue-700 shadow-sm flex items-center space-x-1 transition-colors",disabled:D,children:D?e.jsx("span",{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{size:12}),e.jsx("span",{children:"Save Changes"})]})})]})]})]},`${F.type}-${F.originalDateString}-${J}`))})]},R))})]})},pF="_modalOverlay_eh310_3",fF="_modalContent_eh310_29",gF="_modalHeader_eh310_61",xF="_modalTitle_eh310_79",yF="_modalCloseButton_eh310_91",bF="_modalBody_eh310_119",jF="_errorText_eh310_137",vF="_formGroup_eh310_155",NF="_inputField_eh310_179",wF="_searchResultsCard_eh310_221",SF="_searchResultsList_eh310_249",kF="_searchResultItem_eh310_261",CF="_searchResultPrice_eh310_297",_F="_selectedTestsCard_eh310_307",DF="_selectedTestsHeader_eh310_327",EF="_noTestsMessage_eh310_343",TF="_selectedTestsList_eh310_359",AF="_selectedTestItem_eh310_371",PF="_selectedTestName_eh310_395",RF="_selectedTestPrice_eh310_407",OF="_removeTestButton_eh310_419",IF="_totalAmount_eh310_445",zF="_modalFooter_eh310_463",FF="_button_eh310_489",LF="_buttonPrimary_eh310_507",$F="_buttonSecondary_eh310_529",bt={modalOverlay:pF,modalContent:fF,modalHeader:gF,modalTitle:xF,modalCloseButton:yF,modalBody:bF,errorText:jF,formGroup:vF,inputField:NF,searchResultsCard:wF,searchResultsList:SF,searchResultItem:kF,searchResultPrice:CF,selectedTestsCard:_F,selectedTestsHeader:DF,noTestsMessage:EF,selectedTestsList:TF,selectedTestItem:AF,selectedTestName:PF,selectedTestPrice:RF,removeTestButton:OF,totalAmount:IF,modalFooter:zF,button:FF,buttonPrimary:LF,buttonSecondary:$F},MF=({isOpen:t,onClose:a,patientId:n,labInventory:i,fetchPendingLabOrdersData:l,isLoadingInventory:c=!1})=>{const[o,d]=x.useState([]),[h,m]=x.useState(""),[f,g]=x.useState([]),[y,b]=x.useState(null),[v,w]=x.useState(!1);us(void 0,t?200:99999);const S=x.useMemo(()=>new Da(i,{keys:["name","description"],threshold:.3}),[i]);x.useEffect(()=>{if(!h){g([]);return}const O=S.search(h).map(M=>M.item);g(O.slice(0,10))},[h,S]);const _=async()=>{if(!n){b("Patient ID is missing.");return}if(o.length===0){b("Please select at least one lab test.");return}w(!0),b(null);try{const O={patient_id:n,tests:o.map(A=>({id:A.id,name:A.name,price:A.price}))},M=await Z("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(O)});if(!M.ok){const A=await M.json().catch(()=>({}));throw new Error(A.message||`Failed to create lab order: ${M.statusText}`)}await M.json(),l(n),a(),d([]),m("")}catch(O){b(`Lab Order Creation Error: ${O.message}`)}finally{w(!1)}},E=O=>{if(o.some(M=>M.id===O.id)){b(`${O.name} is already in the order.`),setTimeout(()=>b(null),3e3),m(""),g([]);return}d(M=>[...M,{...O}]),m(""),g([])},D=O=>{d(M=>M.filter(A=>A.id!==O))};return t?e.jsx("div",{className:bt.modalOverlay,children:e.jsxs("div",{className:bt.modalContent,children:[e.jsxs("div",{className:bt.modalHeader,children:[e.jsx("h3",{className:bt.modalTitle,children:"Create New Lab Order"}),e.jsx("button",{onClick:a,className:bt.modalCloseButton,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:bt.modalBody,children:[y&&e.jsx("div",{className:bt.errorText,children:y}),e.jsxs("div",{className:bt.formGroup,style:{position:"relative"},children:[e.jsx("label",{htmlFor:"lab-test-search",children:"Add Lab Test"}),e.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search available lab tests...",value:h,onChange:O=>m(O.target.value),className:bt.inputField}),h&&e.jsx("div",{className:bt.searchResultsCard,children:c?e.jsx("div",{className:"p-2 space-y-2",children:[1,2,3].map(O=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"20%",height:20})]},O))}):f.length>0?e.jsx("ul",{className:bt.searchResultsList,children:f.map(O=>e.jsxs("li",{onClick:()=>E(O),className:bt.searchResultItem,children:[e.jsx("span",{children:O.name}),e.jsxs("span",{className:bt.searchResultPrice,children:["(",parseFloat(String(O.price)).toFixed(2),")"]})]},O.id))}):e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No tests found."})})]}),e.jsxs("div",{className:bt.selectedTestsCard,children:[e.jsx("h4",{className:bt.selectedTestsHeader,children:"Selected Tests"}),o.length===0?e.jsx("p",{className:bt.noTestsMessage,children:"No tests added yet."}):e.jsx("ul",{className:bt.selectedTestsList,children:o.map(O=>e.jsxs("li",{className:bt.selectedTestItem,children:[e.jsx("span",{className:bt.selectedTestName,children:O.name}),e.jsxs("span",{className:bt.selectedTestPrice,children:["",parseFloat(String(O.price)).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>D(String(O.id)),className:bt.removeTestButton,title:"Remove Test",children:e.jsx(Jt,{size:16})})]},O.id))})]}),o.length>0&&e.jsxs("div",{className:bt.totalAmount,children:["Total: ",o.reduce((O,M)=>O+parseFloat(String(M.price)),0).toFixed(2)]})]}),e.jsxs("div",{className:bt.modalFooter,children:[e.jsx("button",{type:"button",onClick:a,className:`${bt.button} ${bt.buttonSecondary}`,children:" Cancel "}),e.jsxs("button",{type:"button",onClick:_,disabled:o.length===0||v,className:`${bt.button} ${bt.buttonPrimary} ${o.length===0||v?bt.buttonDisabled:""}`,children:[" ",v?"Saving...":"Create Lab Order"," "]})]})]})}):null},Nh=t=>{if(!t)return"";let a=t.toLowerCase();return a=a.replace(/\b(mg|g|ml|iu|unit|tabs|tablet|tablets|capsule|capsules|injection|injections|syrup|solution|cream|ointment|lotion|spray|drops|patch|suppository|vial|ampoule|bottle|pack|kit)\b/g,""),a=a.replace(/\b(test|panel|profile|assay|screen|analysis|level|count|culture)\b/g,""),a=a.replace(/[^a-z0-9\s]/g,"").replace(/\s+/g," ").trim(),a},gr=(t,a)=>{if(!t||!a||a.length===0)return;const n=Nh(t);let i=a.find(o=>Nh(o.name)===n);if(i)return i;let l=a.find(o=>Nh(o.name).includes(n));if(l)return l;let c=a.find(o=>n.includes(Nh(o.name)));if(c)return c},BF=`You are an expert OPD (Outpatient Department) medical assistant for a Doctor in a clinic in India. You will receive all the medical data of the patient including complaints (history), labs, pharmacy orders, etc., along with their date and time. Your primary goal is to assist the doctor and analyze patient chief complaints (Co), provide a structured clinical assessment including lab test suggestions (Lx), differential diagnoses (Dx), and a treatment plan (Tx). You have access to tools (actions) to order lab tests and pharmacy items, and update patient details.



**1. Definitions:**
   - Co: Chief complaints
   - Pt: Patient (assume living in India)
   - Lx: Laboratory tests
   - Dx: Differential Diagnosis
   - Tx: Treatment Plan

**2. Workflow:**
   - Analyze Co, generate Lx, Dx, and Tx sections as described below.
   - **Prioritization for Orders:** Always prioritize using \`edit_pharmacy_order\` or \`edit_lab_order\` if there are existing pending orders for the patient, before considering \`create_pharmacy_order\` or \`create_lab_order\`.
   - using edit_lab_order edits the lab order with the given serial numnber use to add new tests to the existing order or remove the tests from existing order, marking the status affects all tests in the order not only the test,always use this tool if there are pending lab orders instead of creating new orders.
   - using edit_pharmacy_order edits the pharmacy order with the given serial numnber to add new items to the existing order, update existing items, or remove items (either by \`items_to_remove\` or by setting \`quantity\` to 0). Always use this tool if there are pending pharmacy orders instead of creating new orders.
   - If your Lx section suggests tests from the inventory, use the \`create_lab_order\` action, but only for tests that are both clinically required and have not already been ordered or are still pending. Skip tests that are already ordered and in pending.
   - If your Tx section prescribes medications, use the \`create_pharmacy_order\` action  but only for medications that are clinically required and have not already been prescribed or are still pending. Skip medications that are already dispensed or already ordered.
   - If your Tx section prescribes medications that are *not* available in the inventory, use the \`prescription_for_unavailable_drugs\` parameter within the \`create_pharmacy_order\` action to specify the prescription details. **IMPORTANT:** This string MUST be a **Markdown table** with columns: 'Drug Name', 'Quantity', 'Dosage', 'Directions'. Do not use plain text.
   - When ordering pharmacy items, specify both \`pack_quantity\` (number of full packs) and \`loose_quantity\` (number of individual units). The system will handle the conversion based on the drug's pack size.
   - **Patient Details Management:** Always store or update patient name, age, sex, and phone number using the \`update_patient_details\` action. If patient name, age, or sex is received as 'New Patient - Direct Entry', 'N/A', or blank, treat it as missing data; if the user input provides anything resembling a name, age, or sex (e.g., shiva 25m, robin 50m, priya 19f), update them using the \`update_patient_details\` action. If details are missing, you can ask the user for the missing details using the \`ask_followup_question\` action.
   - Always update new complaints of the patient using the \`add_complaint_history\` action.
   - If you generate a concise summary of the patient's current situation based on the interaction and history, use the \`update_case_summary\` action to save it.
   - Remember, when you use \`update_case_summary\`, the previous case summary will be replaced by the new one, so you can use it like a short-term memory to store other stuff that **keeps changing**, like the current treatment plan, plan of action, active problems, or current vitals, etc.
   - When you use \`add_complaint_history\`, it will add the complaint to the previous ones. You will be given all the previous complaints back in every query, so you can use it to store other long-term facts that do **not change**, like the history of a chronic illness, surgical history, allergies, or social history, etc.
   - while placing or editing a pharmacy order make sure to set the \`pack_quantity\` and \`loose_quantity\` right.
   - Use the \`update_clinic_ai_memory\` action to store or update **various types of clinic-wide persistent information in a concise way**. This can include 'summaries of common patient encounters'+'summeries of previous **Clinic-wide AI Memory**'(e.g., 'Patient X, 50m, chronic gastritis, last visit YYYY-MM-DD, prescribed Z, follow-up in N days'+'**Clinic-wide AI Memory** summary'), notes on local health trends, common diagnostic patterns observed in the clinic, specific operational protocols. This memory is shared across all interactions for the clinic and helps tailor responses to its specific context over time.
    -   **Recurring Medications:**
        -   Use \`create_recurring_medication_order\` to add a new recurring medication.
        -   Use \`edit_recurring_medication_order\` to edit an existing recurring medication (using its serial number).
        -   Recurring medications are long-term prescriptions (e.g., for chronic conditions) that automatically re-order or remind.
    -   **Important: Preventing Loops** If you determine that no further actions are needed (e.g., you have already performed necessary actions, or the user's input does not require any specific action), you **MUST** use the \`end_task\` action. This explicitly signals that your task is complete and prevents the system from re-prompting you unnecessarily.
**3.**Multiple Actions:** You can perform multiple actions (like ordering labs AND meds, adding complaints, updating patient information, and asking a follow-up question) in a single response by including multiple action objects within the main JSON array.


**4. Chief Complaints (Co):**
   - Analyze the provided chief complaints.
   - Present them in a table with two columns: 'Relevant Complaint (Score 8-10)' and 'Irrelevant Complaint (Score 0-7)', based on clinical relevance.

**5. Lab Tests (Lx):**
   - Suggest the most probable basic lab tests based on the clinical picture, ordered by likelihood.
   - If a basic test is positive/abnormal, suggest relevant advanced tests.
   - **Inventory Check:** Compare suggested tests against the provided inventory list.
   - **Table 1: Available Lab Tests:** Present tests *available* in the inventory in a table with columns: '**Clinical Importance (High/Medium/Low)**', 'Lab Test'. If suggesting tests from this table, prepare to use the \`create_lab_order\` tool in your response.
   - **Table 2: Unavailable Lab Tests:** Present tests *not available* in the inventory in a separate table with columns: '**Clinical Importance (High/Medium/Low)**', 'Unavailable Basic Test'. Clearly state these are not orderable via the tool (generate Table 2 only when required tests are unavailable).

**6. Differential Diagnosis (Dx):**
   - List potential differential diagnoses.
   - Provide a confidence score (0-10) for each.
   - Present in a table with columns: 'Differential Diagnosis' and 'Confidence Score (0-10)'.

**7. Treatment Plan (Tx):**
   - Create a structured treatment plan including ideal medications based on the diagnosis.
   - **Inventory Check:** Compare prescribed medications against the provided inventory list.
   - **Table 1: Available Medications:** Present medications *available* in the inventory in a table with columns: 'Time Frame' (from and to dates), 'Treatment Goal', 'Intervention', 'Medication Type', 'Drug Form', 'Drug Name', 'Regimen (Dose, Freq)', 'Duration'. Before using the \`create_pharmacy_order\` tool, check if an order for the same drug has already been placed for this patient today. If an order already exists for today, do *not* create a duplicate order. If no order exists for today, prepare to use the \`create_pharmacy_order\` tool in your response.
   - **Table 2: Unavailable Medications:** Present medications *not available* in the inventory in a separate table with columns: 'Unavailable Drug Name', 'Ideal Regimen', 'Reasoning/Indication', '**Clinical Importance (High/Medium/Low)**', 'Suggested Available Substitute (from inventory, if possible)'. Clearly state these are not orderable via the tool (generate Table 2 only when required medications are unavailable in the inventory).

**8. Tools / Actions:**
   When you need to perform actions like ordering tests/meds, updating patient info, or adding history, use the following JSON array format. The response should ONLY contain this JSON array, nothing else.

   ****STRICT JSON****>>>>>>\`\`\`json
[
  { "action": "create_pharmacy_order", "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "prescription_for_unavailable_drugs": "string | null" },
  { "action": "edit_pharmacy_order", "serialNumber": number, "items": [ { "name": "Drug Name", "pack_quantity": number, "loose_quantity": number, "tabletsPerDay": number | null, "numberOfDays": number | null, "directions_to_use": "string | null" } ], "items_to_remove": [ { "drug_id": number | null, "name": "Drug Name" } ], "status": "pending" | "billed" | "dispensed" | "cancelled", "prescription_for_unavailable_drugs": "string | null" },
  { "action": "create_lab_order", "tests": [ { "name": "Test Name" } ] },
  { "action": "edit_lab_order", "serialNumber": number, "tests": [ { "name": "Test Name" } ], "items_to_remove": [ { "id": number | string | null, "name": "Test Name" } ], "status": "pending" | "billed" | "collected" | "processing" | "report_ready" | "completed" | "cancelled" | "reported" },
  { "action": "create_lab_report", "tests": [ { "name": "Test Name", "parameters": [{ "name": "Parameter Name", "value": "Value" }] } ] },
  { "action": "edit_lab_report", "serialNumber": number, "tests": [ { "name": "Test Name", "parameters": [{ "name": "Parameter Name", "value": "Value" }] } ] },
  { "action": "edit_lab_order_and_create_report", "serialNumber": number, "tests": [ { "name": "Test Name", "parameters": [{ "name": "Parameter Name", "value": "Value" }] } ], "items_to_remove": [ { "id": number | string | null, "name": "Test Name" } ] },
  { "action": "add_complaint_history", "complaint": "Specific past complaint text..." },
  { "action": "update_patient_details", "name": "New Name (optional)", "age": number (optional), "gender": "M" | "F" | "O" | null (optional), "phone_number": "string (optional)" },
  { "action": "update_case_summary", "summary": "Concise summary text..." },
  { "action": "update_clinic_ai_memory", "memory_content": "New clinic-wide AI memory content..." },
  { "action": "create_recurring_medication_order", "items": [ { "medication_name": "Drug Name", "drug_id": "string | null", "quantity": number, "frequency_days": number, "next_delivery_date": "YYYY-MM-DD", "tablets_per_day": number | null, "number_of_days": number | null, "directions": "string | null", "notes": "string | null" } ] },
  { "action": "edit_recurring_medication_order", "serialNumber": number, "updates": { "medication_name": "string (opt)", "quantity": number, "frequency_days": number, "status": "active" | "paused" | "stopped", "next_delivery_date": "YYYY-MM-DD", "number_of_days": number, "tablets_per_day": number, "directions": "string" } },
  { "action": "end_task" }
]
\`\`\`

   - **Multiple Actions in One Response:** You can include multiple action objects within this single JSON array if several actions are required based on your analysis (e.g., adding history AND ordering labs).
   - **Prioritization Within the Array:** If including multiple actions, order them within the array according to this priority:
     1. \`add_complaint_history\`
     2. \`update_patient_details\`
     3. \`update_case_summary\`
     4. \`update_clinic_ai_memory\`
     5. \`create_lab_order\`
     6. \`edit_lab_order\`
     7. \`create_pharmacy_order\`
     8. \`edit_pharmacy_order\`
   - **Structure:**
     The AI response can be a flat array of actions OR a list of "function call" objects containing grouped actions.
     **Option 1: Flat Array (Simple)**
     \`\`\`json
     [
       { "action": "add_complaint_history", ... },
       { "action": "create_lab_order", ... }
     ]
     \`\`\`
     **Option 2: Grouped Function Calls (Complex)**
     You can group actions under logical "function calls" if needed.
     \`\`\`json
     [
       {
         "function_call": "assess_patient",
         "actions": [
           { "action": "ask_followup_question", "question": "..." }
         ]
       },
       {
         "function_call": "prescribe_treatment",
         "actions": [
            { "action": "create_pharmacy_order", "items": [...] },
            { "action": "create_lab_order", "tests": [...] }
         ]
       }
     ]
     \`\`\`

   - **Example (Multiple Actions):**
     \`\`\`json
     [
       { "action": "add_complaint_history", "complaint": "Patient also reports mild fever since yesterday." },
       { "action": "create_lab_order", "tests": [ { "name": "CBC" } ] }
     ]
     \`\`\`

   - **\`ask_followup_question\`**: Use this action (either standalone or inside a group) only when you need clarification.
     \`\`\`json
     {
       "action": "ask_followup_question",
       "question": "Your clear, specific question here.",
       "options": ["Optional Answer 1", "Optional Answer 2"]
     }
     \`\`\`
     *Description:* Ask the user a question to gather additional information needed to complete the task. This tool should be used when you encounter ambiguities, need clarification, or require more details to proceed effectively. It allows for interactive problem-solving by enabling direct communication with the user. Use this tool judiciously to maintain a balance between gathering necessary information and avoiding excessive back-and-forth.
     *Parameters:*
       - question: (required) The question to ask the user. This should be a clear, specific question that addresses the information you need.
       - options: (optional) An array of 2-5 options for the user to choose from. Each option should be a string describing a possible answer. You may not always need to provide options, but it may be helpful in many cases where it can save the user from having to type out a response manually.


**Important:**
- Ensure all tables are clearly formatted using Markdown.
- Strictly adhere to the inventory constraints for labs and medications when deciding whether to use \`create_lab_order\` or \`create_pharmacy_order\`.
- When using actions, provide ONLY the JSON array (or the single JSON object for \`ask_followup_question\`) as the *very last* part of your response, after all other content including tables. Do not include any other text after the JSON.

**Plan Mode:**
When the user asks a question about a patient's condition or general medical topics (not entering new medical data), respond in PLAN MODE. In this mode, focus on answering the user's inquiry, clarifying their request, brainstorming ideas, or architecting a solution (like exploring treatment options). Ask clarifying questions if needed. Present detailed plans or explanations **using clear table formats and markdown (like bolding) for easy readability**. Engage in back-and-back discussion to finalize details. Do not use action tools (\`create_lab_order\`, \`create_pharmacy_order\`, \`add_complaint_history\`, \`update_patient_details\`) while in PLAN MODE).`,L0="AIzaSyBEt7v-LxBxAKwpTCtkI-3IshYxdnEqbes",UF="models/gemini-3-flash-preview";async function qF(){if(!ox())return console.warn("No auth token found, using default Gemini API key."),L0;let a=null;try{const n=await Z("/api/clinics/settings");if(n.ok){const i=await n.json();i.gemini_api_key&&i.gemini_api_key.trim()!==""&&(a=i.gemini_api_key.trim())}}catch(n){console.warn("Could not fetch clinic settings (or key missing), proceeding to global fallback.",n)}if(a)return a;try{const n=await Z("/api/global-settings/app_gemini_api_key");if(n.ok){const l=(await n.json()).value;if(l&&l.trim()!=="")return l.trim()}}catch(n){console.warn("Could not fetch global API key.",n)}return console.warn("Clinic-specific and global Gemini API keys not found, using default env var."),L0}let Kf=null;async function HF(){if(!Kf){const t=await qF();Kf=new ex({apiKey:t})}return Kf}async function VF(t,a){const{query:n,currentDateTime:i,patientName:l,patientAge:c,patientGender:o,case_summary:d,case_summary_last_updated:h,clinic_ai_memory:m,clinic_ai_memory_last_updated:f,clinic_wide_system_prompt:g,labHistory:y,pharmacyOrders:b,pastComplaints:v,pharmacyInventory:w,labInventory:S,recurringMedications:_}=t;let E=`Patient Complaint: ${n}`;if(d&&(E+=`

--- Case Summary (Provided by Doctor) ---
${d}`,h))try{const z=new Date(h).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});E+=`
(Last Updated: ${z})`}catch{console.warn(`Could not format case_summary_last_updated: ${h}`),E+=`
(Last Updated: ${h})`}if(l&&(E+=`

Patient Name: ${l}`),c!=null&&(E+=`
Patient Age: ${c}`),o&&(E+=`
Patient Gender: ${o}`),i)try{const z=new Date(i).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});E+=`

Current Interaction Time: ${z}`}catch{console.warn(`Could not format currentDateTime: ${i}`),E+=`

Current Interaction Time: ${i}`}if(m&&(E+=`

--- Clinic-wide AI Memory/Context ---
${m}`,f))try{const z=new Date(f).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0,timeZoneName:"short"});E+=`
(Last Updated: ${z})`}catch{console.warn(`Could not format clinic_ai_memory_last_updated: ${f}`),E+=`
(Last Updated: ${f})`}let D="";y&&Array.isArray(y)&&y.length>0&&(D=`

--- Lab History (Orders & Reports) ---
`,y.forEach(z=>{let F="Unknown Date";try{F=new Date(z.orderDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab order: ${z.orderDate}`)}if(D+=`
Order #${z.serialNumber} Date: ${F} (Status: ${z.status})
`,D+=`Tests: ${z.tests.map(J=>J.name).join(", ")}
`,z.report){let J="Unknown Date";try{J=new Date(z.report.reportDate).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date for lab report: ${z.report.reportDate}`)}D+=`  -> Report Date: ${J}
`,z.report.tests&&Array.isArray(z.report.tests)?(D+=`     Findings:
`,z.report.tests.forEach(H=>{D+=`       - Test: ${H.testName}
`,H.parameters&&Array.isArray(H.parameters)&&H.parameters.forEach(I=>{D+=`         - ${I.name}: ${I.value} (Normal: ${I.normal_range})
`})})):(D+=`     Findings: ${z.report.reportContent||"N/A"}
`,z.report.error&&(D+=`     Note: ${z.report.error}
`))}D+=`---
`}),E+=D);let O="";b&&Array.isArray(b)&&b.length>0&&(O=`

--- Recent Pharmacy Orders ---
`,b.forEach(z=>{let F="Unknown Date/Time";try{F=new Date(z.date).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for pharmacy order: ${z.date}`)}O+=`
Order #${z.serialNumber} Date/Time: ${F} (Status: ${z.status})
`,O+=`Prescribed By: ${z.prescribedBy||"N/A"}
`,z.dispensedBy&&(O+=`Dispensed By: ${z.dispensedBy}
`),O+=`Medications:
`,z.medications.forEach(J=>{O+=`  - ${J.name} (Qty: ${J.quantity}`,J.tabletsPerDay&&(O+=`, ${J.tabletsPerDay}/day`),J.numberOfDays&&(O+=` for ${J.numberOfDays} days`),O+=`)
`}),z.prescriptionForUnavailableDrugs&&(O+=`  Prescription for Unavailable Drugs: ${z.prescriptionForUnavailableDrugs}
`),O+=`---
`}),E+=O);let M="";_&&Array.isArray(_)&&_.length>0&&(M=`

--- Recurring Medications (Active) ---
`,_.forEach((z,F)=>{let J=`${F+1}. ${z.medicationName} (${z.frequencyDays} days)`;if(z.tabletsPerDay&&(J+=` - ${z.tabletsPerDay} tabs/day`),z.numberOfDays&&(J+=` for ${z.numberOfDays} days`),J+=` [Status: ${z.status}]`,z.nextDeliveryDate)try{const H=new Date(z.nextDeliveryDate).toLocaleDateString();J+=` (Next: ${H})`}catch{}M+=`${J}
`}),E+=M);let A="";v&&Array.isArray(v)&&v.length>0&&(A=`

--- Past Complaints History ---
`,v.forEach(z=>{let F="Unknown Date/Time";try{F=new Date(z.createdAt).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{console.warn(`Could not format date/time for past complaint: ${z.createdAt}`)}A+=`
Date/Time: ${F}
Complaint: ${z.complaint||"N/A"}
---
`}),E+=A);let P="";w&&Array.isArray(w)&&w.length>0&&(P=`

--- Current Pharmacy Inventory (Stock Levels) ---
`,w.forEach(z=>{let F=`${z.stock??0} packs`;z.loose!==void 0&&z.loose!==null&&z.loose>0&&(F+=`, ${z.loose} loose`);let J=`- ${z.name} (Pack: ${z.pack??"N/A"}): ${F}`;const H=[];z.brand_name&&H.push(`Brand: ${z.brand_name}`),z.batch&&H.push(`Batch: ${z.batch}`),z.expiry_date&&H.push(`Exp: ${z.expiry_date}`),H.length>0&&(J+=` [${H.join(", ")}]`),P+=`${J}
`}),E+=P);let Q="";S&&Array.isArray(S)&&S.length>0&&(Q=`

--- Available Lab Tests (with Parameters) ---
`,S.forEach(z=>{Q+=`- ${z.name} (Price: ${z.price??"N/A"})
`,z.default_parameters&&Array.isArray(z.default_parameters)&&z.default_parameters.length>0&&z.default_parameters.forEach(F=>{let J=`    * ${F.name}`;F.unit&&(J+=` (${F.unit})`),F.normal_range?J+=` [Normal: ${F.normal_range}]`:F.lower_limit!==void 0&&F.upper_limit!==void 0&&F.lower_limit!==null&&F.upper_limit!==null&&(J+=` [Normal: ${F.lower_limit} - ${F.upper_limit}]`),Q+=`${J}
`})}),E+=Q);const G=[{text:BF}];g&&g.trim()!==""&&G.push({text:`--- Additional Clinic-Specific Instructions ---
${g}`});const C=[{text:E}];if(a){const z=new FileReader,F=await new Promise((J,H)=>{z.onloadend=()=>{typeof z.result=="string"?J(z.result.split(",")[1]):H(new Error("Failed to read image file as base64."))},z.onerror=H,z.readAsDataURL(a)});C.push({inlineData:{mimeType:a.type,data:F}})}const R=[];G.length>0&&R.push({role:"user",parts:G}),R.push({role:"user",parts:C});try{const z={model:UF,contents:R,generationConfig:{temperature:.7,maxOutputTokens:1024,responseMimeType:"text/plain"}},J=await(await HF()).models.generateContentStream(z);let H="";for await(const I of J)if(I&&typeof I.text=="function"){const V=I.text;V&&(H+=V)}else I&&I.candidates&&I.candidates[0]&&I.candidates[0].content&&I.candidates[0].content.parts&&I.candidates[0].content.parts[0]&&I.candidates[0].content.parts[0].text&&(H+=I.candidates[0].content.parts[0].text);if(H&&H.trim()!=="")return H.trim();throw console.error("Empty or invalid response received from Gemini API stream."),new Error("Failed to get suggestion from AI (Gemini). Empty or invalid stream response.")}catch(z){console.error("Error calling Gemini API:",z);let F="Failed to get suggestion from Gemini.";throw z.message&&(F=`Error processing Gemini request: ${z.message}`),new Error(F)}}const GF=t=>{if(!t)return 1;const a=t.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return a?parseInt(a[1],10):1},QF=x.forwardRef(({recordId:t,patientId:a,patientDetails:n,caseSummary:i,caseSummaryUpdatedAt:l,clinicSettings:c,userMessages:o,selectedImageFile:d,pendingLabOrders:h,labReports:m,pastComplaints:f,pharmacyOrders:g,pharmacyInventory:y,labInventory:b,recurringMedications:v,currentComplaint:w,setCurrentComplaint:S,setAiResponse:_,setAiResponseText:E,setAiResponseJsonString:D,setShowAiJsonDetails:O,setIsLoadingAi:M,setAiError:A,setIsSubmittingAiOrder:P,setAiOrderSubmissionStatus:Q,setIsSubmittingAiLabOrder:G,setAiLabOrderSubmissionStatus:C,setIsSubmittingAiComplaint:R,setAiComplaintSubmissionStatus:z,setIsUpdatingCaseSummary:F,setAiCaseSummaryUpdateStatus:J,setCaseSummary:H,setIsUpdatingAiMemoryByAI:I,setAiMemoryUpdateByAIStatus:V,setFollowUpQuestion:re,setFollowUpOptions:B,setError:k,setIsSavingAiResponse:Ne,setSaveAiResponseError:Ae,fetchPharmacyOrdersData:T,fetchPendingLabOrdersData:Ce,fetchLabReportsData:Ue,fetchRecurringMedicationsData:Pe,fetchPastComplaintsData:de,fetchPatientDetails:Se,setClinicSettings:ee,setEditedAiMemory:oe,setCanUndo:fe,onAiActionSuccess:ge,addMessage:q},W)=>{const[Y,ie]=on.useState(null);on.useEffect(()=>{fe(!!Y)},[Y,fe]);let ce;const pe=async(ve,Fe,Ee,L=0)=>{let ne;const ae=["AI response did not contain a recognized function call","AI response did not result in a recognized or performed function call"].some(we=>{var Le;return(Le=Fe.message)==null?void 0:Le.includes(we)});Ee&&ae?ne=`AI Error: ${Fe.message}

${Ee}`:(ne=`I encountered a frontend error while trying to execute the '${ve}' function. The error message is: "${Fe.message}". Based on this error, please analyze what went wrong and either correct the function call and try again, or explain the problem.`,(ve==="create_pharmacy_order"||ve==="edit_pharmacy_order")&&(ne+=`

IMPORTANT: When ordering medication, please first check if the medication ordered matches the exact name given in the inventory. If the name itself is not given in the inventory, you can use 'prescription_for_unavailable_drugs' to write a prescription. **NOTE:** This field MUST be formatted as a Markdown table (columns: Drug Name, Quantity, Dosage, Directions).`),Ee&&(ne+=`

The original AI response that caused the error was:
\`\`\`
${Ee}
\`\`\``)),q==null||q({role:"system",type:"error",content:`AI Error: ${Fe.message}. Retrying...`}),await ce(ne,L+1)},He=async ve=>{console.log("Executing Rollback for actions:",ve);for(const Fe of ve){const{actionType:Ee,undoData:L}=Fe;if(console.log(`Attempting to rollback ${Ee}`,L),!L){console.warn(`No undoData found for action ${Ee}, skipping.`);continue}try{if(Ee==="create_pharmacy_order")L!=null&&L.orderId?(console.log(`Deleting pharmacy order ${L.orderId}`),await Z(`/api/pharmacy-orders/${L.orderId}`,{method:"DELETE"}),T(a)):console.error("Missing orderId for create_pharmacy_order rollback");else if(Ee==="create_lab_order")L!=null&&L.orderId?(console.log(`Deleting lab order ${L.orderId}`),await Z(`/api/lab/orders/${L.orderId}`,{method:"DELETE"}),Ce(a)):console.error("Missing orderId for create_lab_order rollback");else if(Ee==="update_patient_details")if(L!=null&&L.patientId&&(L!=null&&L.originalDetails)){console.log(`Reverting patient details for ${L.patientId}`);const ne=L.originalDetails,xe={name:ne.name,age:ne.age,gender:ne.gender,phone:ne.phone,ai_response:ne.ai_response};await Z(`/api/patients/${L.patientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(xe)}),Se(L.patientId)}else console.error("Missing patientId or originalDetails for update_patient_details rollback");else if(Ee==="add_complaint_history")L!=null&&L.recordId?(console.log(`Reverting complaint history for ${L.recordId}`),await Z(`/api/queue/doctor/complaint/${L.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:L.originalComplaint||""})}),S(L.originalComplaint||"")):console.error("Missing recordId for add_complaint_history rollback");else if(Ee==="update_case_summary")L!=null&&L.recordId?(console.log(`Reverting case summary for ${L.recordId}`),await Z(`/api/queue/doctor/complaint/${L.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:L.originalSummary||""})}),H(L.originalSummary||"")):console.error("Missing recordId for update_case_summary rollback");else if(Ee==="update_clinic_ai_memory")(L==null?void 0:L.originalMemory)!==void 0?(console.log("Reverting AI memory"),await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify({...c,aiMemory:L.originalMemory})}),oe(L.originalMemory)):console.error("Missing originalMemory for update_clinic_ai_memory rollback");else if(Ee==="edit_pharmacy_order")if(L!=null&&L.orderId&&(L!=null&&L.originalState)){console.log(`Reverting pharmacy order ${L.orderId}`);const ne={items:L.originalState.medications||[],status:L.originalState.status,prescription_for_unavailable_drugs:L.originalState.prescription_for_unavailable_drugs,order_total:L.originalState.order_total};await Z(`/api/pharmacy-orders/${L.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)}),T(a)}else console.error("Missing orderId or originalState for edit_pharmacy_order rollback");else if(Ee==="edit_lab_order")if(L!=null&&L.orderId&&(L!=null&&L.originalState)){console.log(`Reverting lab order ${L.orderId}`);const ne={tests:L.originalState.tests,status:L.originalState.status};await Z(`/api/lab/orders/${L.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ne)}),Ce(a)}else console.error("Missing orderId or originalState for edit_lab_order rollback");else if(Ee==="create_recurring_medication_order")if(L!=null&&L.createdIds&&L.createdIds.length>0){console.log(`Deleting recurring medications: ${L.createdIds.join(", ")}`);for(const ne of L.createdIds)await Z(`/api/recurring-medications/${ne}`,{method:"DELETE"});a&&Pe&&Pe(a)}else console.error("Missing createdIds for create_recurring_medication_order rollback");else Ee==="edit_recurring_medication_order"?L!=null&&L.medicationId&&(L!=null&&L.originalState)?(console.log(`Reverting recurring medication ${L.medicationId}`),await Z(`/api/recurring-medications/${L.medicationId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(L.originalState)}),a&&Pe&&Pe(a)):console.error("Missing medicationId or originalState for edit_recurring_medication_order rollback"):console.warn(`Unknown action type for rollback: ${Ee}`)}catch(ne){console.error(`Failed to rollback ${Ee}:`,ne)}}},We=async()=>{!Y||!window.confirm("Are you sure you want to undo the last AI actions?")||(M(!0),await He([...Y].reverse()),ie(null),M(!1),A("Last actions undone successfully."))},st=async(ve,Fe)=>{ie(null),Q(null),C(null),z(null),J(null),V(null),re(null),B([]),k(null);let Ee=null;const L=/```json\s*([\s\S]*?)\s*```/,ne=ve.match(L);if(ne&&ne[1])Ee=ne[1];else{const xe=ve.trim();if(xe.startsWith("{")&&xe.endsWith("}"))Ee=xe;else if(xe.startsWith("[")&&xe.endsWith("]"))Ee=xe;else throw new Error("AI response did not contain a recognized function call.")}if(Ee)try{const xe=JSON.parse(Ee),ae=ue=>{const je=[],ke=Array.isArray(ue)?ue:[ue];for(const Me of ke)Me&&(Me.actions&&Array.isArray(Me.actions)?je.push(...ae(Me.actions)):Me.sub_actions&&Array.isArray(Me.sub_actions)?je.push(...ae(Me.sub_actions)):Me.function_calls&&Array.isArray(Me.function_calls)?je.push(...ae(Me.function_calls)):typeof Me.action=="string"&&je.push(Me));return je},we=ae(xe),Le=[];let Je=null,ot=!1;for(const ue of we){if(ue.action==="ask_followup_question"){Je=ue,ot=!0;continue}ot=!0;const je=ue.action;je==="update_clinic_ai_memory"&&typeof ue.memory_content=="string"?Le.push((async()=>{I(!0),V("Processing AI mem..."),q==null||q({role:"system",type:"loading",content:"Processing AI memory..."});const ke=(c==null?void 0:c.aiMemory)||"";try{if(!c)throw new Error("Clinic settings not loaded.");const Me={...c,aiMemory:ue.memory_content.trim(),admissionCharge:c.admissionCharge,perDayCharge:c.perDayCharge,otherCharges:c.otherCharges,clinicWideSystemPrompt:c.clinicWideSystemPrompt},De=await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify(Me)});if(!De.ok){const te=await De.json().catch(()=>({}));throw new Error(te.message||`AI-triggered clinic memory update failed: ${De.statusText}`)}const qe=await De.json();return ee(te=>te?{...te,aiMemory:qe.settings.aiMemory}:null),oe(qe.settings.aiMemory||""),V("AI mem updated!"),q==null||q({role:"system",type:"success",content:"AI memory updated successfully."}),{success:!0,actionType:je,undoData:{originalMemory:ke}}}catch(Me){return V("Failed"),{success:!1,actionType:je,error:Me,originalActionPayload:ue}}finally{I(!1)}})()):je==="create_pharmacy_order"?Le.push((async()=>{var ke,Me;P(!0),Q("Processing order..."),q==null||q({role:"system",type:"loading",content:"Processing pharmacy order..."});try{if(!a)throw new Error("Missing patient ID.");const De=[];let qe=null;if(Array.isArray(ue.items))for(const dt of ue.items){let jt;if(dt.drug_id?jt=y.find(Kt=>Kt.id===dt.drug_id):dt.name&&(jt=gr(dt.name,y)),!jt){qe=`Drug "${dt.name||dt.drug_id}" not found.`;break}const At=GF(jt.pack),Ye=Number(jt.mrp),it=Ye,Ze=At>0?Ye/At:0,ht=Number(dt.pack_quantity)||0,ct=Number(dt.loose_quantity)||0,ut=ht*it+ct*Ze;De.push({drug_id:String(jt.id),name:jt.name,pack_quantity:ht,loose_quantity:ct,tabletsPerDay:dt.tabletsPerDay,numberOfDays:dt.numberOfDays,directions_to_use:dt.directions_to_use,group_id:dt.group_id,pack_price:it,loose_price:Ze,total_price:ut,price:Ye,isLoose:dt.isLoose,unit:jt.pack})}if(qe)throw new Error(qe);const te=De.reduce((dt,jt)=>dt+jt.total_price,0),Re={patient_id:a,items:De,prescription_for_unavailable_drugs:ue.prescription_for_unavailable_drugs,order_total:parseFloat(te.toFixed(2))},lt=await Z("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Re)});if(!lt.ok){const dt=await lt.json().catch(()=>({}));throw new Error(dt.message||"Order creation failed.")}const Xe=await lt.json();return Q("Order created!"),T(a),q==null||q({role:"system",type:"success",content:"Pharmacy order created successfully."}),{success:!0,actionType:je,data:Xe,undoData:{orderId:((Me=(ke=Xe.orders)==null?void 0:ke[0])==null?void 0:Me.id)||Xe.id}}}catch(De){return q==null||q({role:"system",type:"error",content:`Pharmacy order failed: ${De.message}`}),{success:!1,actionType:je,error:De,originalActionPayload:ue}}finally{P(!1)}})()):je==="update_patient_details"?Le.push((async()=>{M(!0),q==null||q({role:"system",type:"loading",content:"Updating patient details..."});const ke={...n};try{if(!a)throw new Error("Missing patient ID.");const Me={};if(ue.name&&(Me.name=ue.name),ue.age&&(Me.age=ue.age),ue.gender&&(Me.gender=ue.gender),ue.phone_number!==void 0&&(Me.phone_number=ue.phone_number),!(await Z(`/api/patients/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Me)})).ok)throw new Error("Patient update failed.");return Se(a),q==null||q({role:"system",type:"success",content:"Patient details updated."}),{success:!0,actionType:je,undoData:{patientId:a,originalDetails:ke}}}catch(Me){return{success:!1,actionType:je,error:Me,originalActionPayload:ue}}finally{M(!1)}})()):je==="create_lab_order"?Le.push((async()=>{G(!0),C("Processing lab..."),q==null||q({role:"system",type:"loading",content:"Processing lab order..."});try{if(!a)throw new Error("Missing patient ID.");const ke=[];for(const qe of ue.tests||[]){let te;if(qe.id?te=b.find(Re=>String(Re.id)===String(qe.id)):qe.name&&(te=gr(qe.name,b)),!te)throw new Error(`Lab test "${qe.name}" not found.`);ke.push({id:te.id,name:te.name,price:Number(te.price)})}const Me=await Z("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:a,tests:ke})});if(!Me.ok)throw new Error("Lab order creation failed.");const De=await Me.json();return C("Success!"),Ce(a),q==null||q({role:"system",type:"success",content:"Lab order created."}),{success:!0,actionType:je,data:De.labOrder,undoData:{orderId:De.labOrder.id}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Lab order failed: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{G(!1)}})()):je==="create_lab_report"?Le.push((async()=>{G(!0),C("Creating Report..."),q==null||q({role:"system",type:"loading",content:"Creating lab report..."});try{if(!a)throw new Error("Missing patient ID.");const ke=[],Me=ue.tests||[];for(const Xe of Me){let dt;if(Xe.id?dt=b.find(jt=>String(jt.id)===String(Xe.id)):Xe.name&&(dt=gr(Xe.name,b)),!dt)throw new Error(`Lab test "${Xe.name}" not found.`);Xe._matchedTest=dt,ke.push({id:dt.id,name:dt.name,price:Number(dt.price)})}const De=await Z("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:a,tests:ke,status:"reported"})});if(!De.ok)throw new Error("Lab order creation failed during report generation.");const qe=await De.json(),te=qe.labOrder.id,Re={};if(Me.forEach(Xe=>{const dt=Xe._matchedTest,jt=dt.id,At=Xe.parameters||[],Ye={},it=dt.default_parameters||[];for(const Ze of it){const ht=At.find(ct=>{if(!ct.name)return!1;if(ct.name.toLowerCase()===Ze.name.toLowerCase())return!0;const ut=ct.name.toLowerCase(),Kt=Ze.name.toLowerCase();return ut.includes(Kt)||Kt.includes(ut)});ht&&ht.value!==void 0?Ye[Ze.name]=ht.value:Ze.defaultValue!==void 0&&Ze.defaultValue!==null&&(Ye[Ze.name]=Ze.defaultValue)}Re[jt]=Ye}),!(await Z(`/api/lab/${te}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(Re)})})).ok)throw new Error("Report submission failed.");return C("Report Created!"),Ce(a),Ue(a),q==null||q({role:"system",type:"success",content:"Lab report created successfully."}),{success:!0,actionType:je,data:qe.labOrder,undoData:{orderId:te}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Lab report failed: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{G(!1)}})()):je==="edit_lab_report"?Le.push((async()=>{G(!0),C("Updating Report...");try{const ke=ue.serialNumber;if(!ke)throw new Error("Missing serial number for lab report edit.");const Me=new Map;(h??[]).forEach(At=>Me.set(At.id,{...At})),(m??[]).forEach(At=>{if(Me.has(At.id)){const Ye=Me.get(At.id);Ye.report=At,Ye.status=At.status}else Me.set(At.id,{...At,createdAt:At.createdAt})});const De=Array.from(Me.values());De.sort((At,Ye)=>new Date(Ye.createdAt).getTime()-new Date(At.createdAt).getTime());const qe=De.length-ke,te=De[qe];if(!te)throw new Error(`Lab report #${ke} not found.`);const Re=te.id;let lt={};if(te.report&&te.report.report_content)try{lt=typeof te.report.report_content=="string"?JSON.parse(te.report.report_content):te.report.report_content}catch{}const Xe={...lt};if((ue.tests||[]).forEach(At=>{let it=(te.tests||[]).find(Kt=>Kt.name.toLowerCase()===At.name.toLowerCase());if(!it)return;const Ze=it.id,ht=At.parameters||[],ct=b.find(Kt=>String(Kt.id)===String(Ze)),ut=(ct==null?void 0:ct.default_parameters)||[];Xe[Ze]||(Xe[Ze]={});for(const Kt of ut){const ea=ht.find(ta=>{if(!ta.name)return!1;if(ta.name.toLowerCase()===Kt.name.toLowerCase())return!0;const On=ta.name.toLowerCase(),Ds=Kt.name.toLowerCase();return On.includes(Ds)||Ds.includes(On)});ea&&ea.value!==void 0&&(Xe[Ze][Kt.name]=ea.value)}}),!(await Z(`/api/lab/${Re}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(Xe)})})).ok)throw new Error("Report update failed.");return C("Report Updated!"),Ce(a),Ue(a),q==null||q({role:"system",type:"success",content:"Lab report updated successfully."}),{success:!0,actionType:je,data:{orderId:Re},undoData:{orderId:Re}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Update report failed: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{G(!1)}})()):je==="edit_lab_order_and_create_report"?Le.push((async()=>{G(!0),C("Updating Order & Report..."),q==null||q({role:"system",type:"loading",content:"Updating lab order and report..."});try{const ke=ue.serialNumber;if(!ke)throw new Error("Missing serial number.");const Me=new Map;(h??[]).forEach(ct=>Me.set(ct.id,{...ct})),(m??[]).forEach(ct=>{if(Me.has(ct.id)){const ut=Me.get(ct.id);ut.report=ct,ut.status=ct.status}else Me.set(ct.id,{...ct,createdAt:ct.createdAt})});const De=Array.from(Me.values());De.sort((ct,ut)=>new Date(ut.createdAt).getTime()-new Date(ct.createdAt).getTime());const qe=De.length-ke,te=De[qe];if(!te)throw new Error(`Lab order #${ke} not found.`);const Re=te.id,lt=JSON.parse(JSON.stringify(te));let Xe=[];for(const ct of te.tests||[]){const ut=b.find(Kt=>String(Kt.id)===String(ct.id));ut?Xe.push({id:ut.id,name:ut.name,price:Number(ut.price)}):Xe.push({id:ct.id,name:ct.name,price:Number(ct.price)||0})}if(ue.items_to_remove&&Array.isArray(ue.items_to_remove)){const ct=ue.items_to_remove;Xe=Xe.filter(ut=>!ct.some(Kt=>Kt.id&&String(Kt.id)===String(ut.id)||Kt.name&&ut.name.toLowerCase()===Kt.name.toLowerCase()))}const dt=ue.tests||[],jt={};for(const ct of dt){let ut;if(ct.id?ut=b.find(gn=>String(gn.id)===String(ct.id)):ct.name&&(ut=gr(ct.name,b)),!ut)throw new Error(`Lab test "${ct.name}" not found.`);Xe.findIndex(gn=>String(gn.id)===String(ut.id))===-1&&Xe.push({id:ut.id,name:ut.name,price:Number(ut.price)});const ea=ut.id,ta=ct.parameters||[],On={},Ds=ut.default_parameters||[];for(const gn of Ds){const Aa=ta.find(Ya=>{if(!Ya.name)return!1;if(Ya.name.toLowerCase()===gn.name.toLowerCase())return!0;const Ja=Ya.name.toLowerCase(),jn=gn.name.toLowerCase();return Ja.includes(jn)||jn.includes(Ja)});Aa&&Aa.value!==void 0?On[gn.name]=Aa.value:gn.defaultValue!==void 0&&(On[gn.name]=gn.defaultValue)}jt[ea]=On}const At={tests:Xe};console.log("[DEBUG] edit_lab_order_and_create_report - Order Update Payload:",JSON.stringify(At,null,2)),console.log("[DEBUG] Items to remove:",ue.items_to_remove),console.log("[DEBUG] Original tests:",te.tests);const Ye=await Z(`/api/lab/orders/${Re}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(At)});if(console.log("[DEBUG] Order update response status:",Ye.status),!Ye.ok){const ct=await Ye.json().catch(()=>({}));throw console.error("[DEBUG] Order update failed:",ct),new Error(`Failed to update lab order tests: ${ct.message||Ye.statusText}`)}let it={};if(te.report&&te.report.report_content)try{it=typeof te.report.report_content=="string"?JSON.parse(te.report.report_content):te.report.report_content}catch{}const Ze={...it,...jt};if(!(await Z(`/api/lab/${Re}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(Ze)})})).ok)throw new Error("Failed to create/update lab report.");return C("Order & Report Updated!"),Ce(a),Ue(a),q==null||q({role:"system",type:"success",content:"Lab order and report updated successfully."}),{success:!0,actionType:je,undoData:{orderId:Re,originalState:lt}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Failed to edit order and report: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{G(!1)}})()):je==="edit_pharmacy_order"?Le.push((async()=>{P(!0);try{const ke=ue.serialNumber;let Me;if(ke?Me=[...g].sort((jt,At)=>new Date(jt.date).getTime()-new Date(At.date).getTime())[ke-1]:Me=g.find(dt=>dt.status==="pending"),!Me)throw new Error("Order to edit not found.");const De=JSON.parse(JSON.stringify(Me));let qe=[...Me.medications];const te=ue.items_to_remove,Re=ue.items;if(Array.isArray(te)&&(qe=qe.filter(dt=>!te.some(jt=>jt.drug_id&&String(dt.drug_id)===String(jt.drug_id)||jt.name&&dt.name.toLowerCase()===jt.name.toLowerCase()))),Array.isArray(Re))for(const dt of Re){let jt;if(dt.drug_id?jt=y.find(it=>String(it.id)===String(dt.drug_id)):dt.name&&(jt=gr(dt.name,y)),!jt)throw new Error(`Drug ${dt.name} not found.`);const At=qe.findIndex(it=>it.drug_id===String(jt==null?void 0:jt.id)),Ye={drug_id:String(jt.id),name:jt.name,pack_quantity:dt.pack_quantity||0,loose_quantity:dt.loose_quantity||0,pack_price:Number(jt.mrp),loose_price:0,total_price:0,price:Number(jt.mrp)};At>=0?qe[At]={...qe[At],...Ye}:qe.push(Ye)}const lt={items:qe,status:ue.status,prescription_for_unavailable_drugs:ue.prescription_for_unavailable_drugs,order_total:0};if(!(await Z(`/api/pharmacy-orders/${Me.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(lt)})).ok)throw new Error("Order edit failed.");return T(a),{success:!0,actionType:je,undoData:{orderId:Me.id,originalState:De}}}catch(ke){return{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{P(!1)}})()):je==="edit_lab_order"?Le.push((async()=>{G(!0);try{const ke=h.sort((te,Re)=>new Date(Re.createdAt).getTime()-new Date(te.createdAt).getTime()).find(te=>te.status==="pending");if(!ke)throw new Error("No pending lab order to edit.");const Me=JSON.parse(JSON.stringify(ke)),De={tests:[],status:ue.status};if(!(await Z(`/api/lab/orders/${ke.id}`,{method:"PUT",body:JSON.stringify(De),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Lab edit failed.");return Ce(a),{success:!0,actionType:je,undoData:{orderId:ke.id,originalState:Me}}}catch(ke){return{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{G(!1)}})()):je==="add_complaint_history"?Le.push((async()=>{R(!0),q==null||q({role:"system",type:"loading",content:"Updating complaint history..."});const ke=w;try{if(!t)throw new Error("No record ID.");if(!(await Z(`/api/queue/doctor/complaint/${t}`,{method:"PUT",body:JSON.stringify({complaint:ue.complaint}),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Complaint update failed.");return S(ue.complaint),a&&de(a),q==null||q({role:"system",type:"success",content:"Complaint history updated."}),{success:!0,actionType:je,undoData:{recordId:t,originalComplaint:ke}}}catch(Me){return q==null||q({role:"system",type:"error",content:`Complaint history update failed: ${Me.message}`}),{success:!1,actionType:je,error:Me,originalActionPayload:ue}}finally{R(!1)}})()):je==="update_case_summary"?Le.push((async()=>{F(!0),q==null||q({role:"system",type:"loading",content:"Updating case summary..."});const ke=i;try{if(!t)throw new Error("No record ID.");const Me=await Z(`/api/queue/doctor/complaint/${t}`,{method:"PUT",body:JSON.stringify({case_summary:ue.summary}),headers:{"Content-Type":"application/json"}});if(!Me.ok)throw new Error("Summary update failed.");const De=await Me.json();return H(De.case_summary),q==null||q({role:"system",type:"success",content:"Case summary updated."}),{success:!0,actionType:je,undoData:{recordId:t,originalSummary:ke}}}catch(Me){return q==null||q({role:"system",type:"error",content:`Case summary update failed: ${Me.message}`}),{success:!1,actionType:je,error:Me,originalActionPayload:ue}}finally{F(!1)}})()):je==="create_recurring_medication_order"?Le.push((async()=>{P(!0),Q("Creating recurring medication(s)..."),q==null||q({role:"system",type:"loading",content:"Creating recurring medication(s)..."});try{if(!a)throw new Error("Missing patient ID.");if(!ue.items||!Array.isArray(ue.items))throw new Error("No items provided for recurring medication order.");const ke=await Promise.all(ue.items.map(async te=>{let Re=te.drug_id;if(!Re){const lt=gr(te.medication_name,y);Re=lt?lt.id:null}if(!Re)throw new Error(`Drug "${te.medication_name}" not found in inventory for recurring medication.`);return{...te,drug_id:Re}})),Me=await Z("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:a,items:ke})});if(!Me.ok){const te=await Me.json().catch(()=>({}));throw new Error(te.message||"Failed to create recurring medication order")}const De=await Me.json(),qe=De.map(te=>te.id);return a&&Pe&&Pe(a),Q("Recurring medication(s) created."),q==null||q({role:"system",type:"success",content:`Successfully created ${qe.length} recurring medication(s).`}),{success:!0,actionType:je,data:De,undoData:{createdIds:qe}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Error creating recurring medication: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{P(!1)}})()):je==="edit_recurring_medication_order"?Le.push((async()=>{P(!0),Q("Updating recurring medication..."),q==null||q({role:"system",type:"loading",content:"Updating recurring medication..."});try{if(!a)throw new Error("Missing patient ID.");if(!ue.serialNumber||!ue.updates)throw new Error("Missing serialNumber or updates for recurring medication edit.");if(!v||v.length===0)throw new Error("No recurring medications found to edit.");const ke=ue.serialNumber-1;if(ke<0||ke>=v.length)throw new Error(`Recurring medication with serial number ${ue.serialNumber} not found.`);const Me=v[ke],De=JSON.parse(JSON.stringify(Me));if(ue.updates.drug_id===null||ue.updates.medication_name){let te=ue.updates.drug_id;if(!te&&ue.updates.medication_name){const Re=gr(ue.updates.medication_name,y);te=Re?Re.id:null}if(!te&&ue.updates.medication_name)throw new Error(`Drug "${ue.updates.medication_name}" not found in inventory for update.`);ue.updates.drug_id=te}const qe=await Z(`/api/recurring-medications/${Me.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(ue.updates)});if(!qe.ok){const te=await qe.json().catch(()=>({}));throw new Error(te.message||"Failed to update recurring medication")}return a&&Pe&&Pe(a),Q("Recurring medication updated."),q==null||q({role:"system",type:"success",content:`Successfully updated recurring medication #${ue.serialNumber}.`}),{success:!0,actionType:je,data:{id:Me.id,...ue.updates},undoData:{medicationId:Me.id,originalState:De}}}catch(ke){return q==null||q({role:"system",type:"error",content:`Error updating recurring medication: ${ke.message}`}),{success:!1,actionType:je,error:ke,originalActionPayload:ue}}finally{P(!1)}})()):je==="end_task"?Le.push((async()=>(q==null||q({role:"system",type:"success",content:"Task completed."}),{success:!0,actionType:je}))()):(console.warn(`Unknown action ${je}`),Le.push(Promise.resolve({success:!1,actionType:je,error:new Error(`Unknown action: ${je}`),originalActionPayload:ue})))}const xt=await Promise.all(Le),be=xt.filter(ue=>!ue.success);if(be.length>0){console.log("AI Actions Failed. Initiating Rollback...",be);const ue=xt.filter(qe=>qe.success),je=[...ue].reverse();await He(je);const ke=be.map(qe=>{var te;return`${qe.actionType}: ${(te=qe.error)==null?void 0:te.message}`}).join("; "),Me=ue.length>0?` I successfully rolled back ${ue.length} other actions that succeeded.`:"",De=`One or more actions failed: [${ke}].${Me} Please analyze the failure and try again.`;await pe("multiple_actions",{message:De},ve,Fe)}else{const ue=xt.filter(je=>je.success);if(ue.length>0&&(ie(ue),ge&&ue.forEach(je=>ge(je.actionType))),Je&&typeof Je.question=="string")re(Je.question),B(Array.isArray(Je.options)?Je.options:[]);else if(!ot)throw new Error("AI response did not result in a recognized or performed function call.")}}catch(xe){await pe("parse_json_actions",xe,ve,Fe)}else throw new Error("AI response did not contain a recognized function call.")};ce=async(ve,Fe=0)=>{if(Fe>1){A("AI call failed after multiple retries. Please try a different prompt."),M(!1);return}M(!0),A(null);let Ee;const ne=[...o,ve].join(`

`);try{const xe=new Map;(h??[]).forEach(be=>{xe.set(be.id,{...be})}),(m??[]).forEach(be=>{if(!xe.has(be.id))xe.set(be.id,{id:be.id,patient_id:be.patient_id,tests:be.tests,status:be.status,createdAt:be.createdAt,report:be});else{const ue=xe.get(be.id);ue&&(ue.report=be,ue.status=be.status)}});const ae=Array.from(xe.values());ae.sort((be,ue)=>new Date(ue.createdAt).getTime()-new Date(be.createdAt).getTime());const we=ae.map((be,ue)=>{let je=null;if(be.report)try{const ke=typeof be.report.report_content=="string"?be.report.report_content:JSON.stringify(be.report.report_content||{}),Me=JSON.parse(ke||"{}"),De=qe=>{const te=Me[qe.id]||{},Re=lt=>({name:lt.name,value:te[lt.name]!==void 0?String(te[lt.name]):String(lt.defaultValue),normal_range:lt.normal_range||"N/A"});return{testId:qe.id,testName:qe.name,parameters:(qe.default_parameters||[]).map(Re)}};je={reportId:be.report.reportId,reportDate:be.report.report_date,tests:(be.tests||[]).map(De)}}catch{je={reportId:be.report.reportId,reportDate:be.report.report_date,reportContent:typeof be.report.report_content=="string"?be.report.report_content:JSON.stringify(be.report.report_content),error:"Failed to parse report content JSON."}}return{serialNumber:ae.length-ue,orderId:be.id,orderDate:isNaN(new Date(be.createdAt).getTime())?be.createdAt:new Date(be.createdAt).toISOString(),tests:be.tests.map(ke=>({id:ke.id,name:ke.name,price:ke.price})),status:be.status,report:je}}),Le=f.map(be=>{try{return{...be,createdAt:isNaN(new Date(be.createdAt).getTime())?be.createdAt:new Date(be.createdAt).toISOString()}}catch{return be}}),ot=[...g].sort((be,ue)=>{const je=new Date(be.date).getTime(),ke=new Date(ue.date).getTime();return je-ke}).map((be,ue)=>{try{return{serialNumber:ue+1,...be,date:be.date&&!isNaN(new Date(be.date).getTime())?new Date(be.date).toISOString():be.date}}catch{return{serialNumber:ue+1,...be}}}),xt={query:ne,currentDateTime:new Date().toISOString(),patientName:(n==null?void 0:n.name)||"",patientAge:(n==null?void 0:n.age)||void 0,patientGender:(n==null?void 0:n.gender)||void 0,case_summary:i||"",case_summary_last_updated:l?new Date(l).toISOString():void 0,clinic_ai_memory:(c==null?void 0:c.aiMemory)||"",clinic_ai_memory_last_updated:c!=null&&c.aiMemoryUpdatedAt?new Date(c.aiMemoryUpdatedAt).toISOString():void 0,clinic_wide_system_prompt:(c==null?void 0:c.clinicWideSystemPrompt)||"",labHistory:we,pharmacyOrders:ot,pastComplaints:Le,pharmacyInventory:y,labInventory:b,recurringMedications:v};if(console.log("DEBUG: Payload before sending to Gemini API:",JSON.stringify(xt,null,2)),Ee=await VF(xt,d),Ee){_(Ee),q==null||q({role:"ai",content:Ee});const be=/```json\s*([\s\S]*?)\s*```/,ue=Ee.match(be);if(ue&&ue[1])E(Ee.replace(be,"").trim()),D(ue[1].trim());else{const je=Ee.trim();if(je.startsWith("{")&&je.endsWith("}"))try{JSON.parse(je),E(""),D(je)}catch{E(je),D(null)}else if(je.startsWith("[")&&je.endsWith("]"))try{JSON.parse(je),E(""),D(je)}catch{E(je),D(null)}else E(je),D(null)}O(!1),a&&Ee&&await me(a,Ee),await st(Ee,Fe),S("")}else throw new Error("Invalid AI response format.")}catch(xe){await pe("call_generative_api",xe,Ee,Fe)}finally{M(!1)}};const me=async(ve,Fe)=>{Ne(!0),Ae(null);try{const Ee={ai_response:Fe},L=await Z(`/api/patients/${ve}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ee)});if(!L.ok){const ne=await L.json().catch(()=>({}));throw new Error(ne.message||`Failed to save AI response to patient: ${L.statusText}`)}}catch(Ee){Ae(`AI Response Save Error: ${Ee.message}`),q==null||q({role:"system",type:"error",content:`AI Response Save Error: ${Ee.message}`})}finally{Ne(!1)}};return x.useImperativeHandle(W,()=>({callGenerativeApi:ce,undoLastAction:We})),null}),nS=-1,fm=0,Nu=1,Yh=2,Bx=3,Ux=4,qx=5,Hx=6,aS=7,sS=8,$0=typeof self=="object"?self:globalThis,YF=(t,a)=>{const n=(l,c)=>(t.set(c,l),l),i=l=>{if(t.has(l))return t.get(l);const[c,o]=a[l];switch(c){case fm:case nS:return n(o,l);case Nu:{const d=n([],l);for(const h of o)d.push(i(h));return d}case Yh:{const d=n({},l);for(const[h,m]of o)d[i(h)]=i(m);return d}case Bx:return n(new Date(o),l);case Ux:{const{source:d,flags:h}=o;return n(new RegExp(d,h),l)}case qx:{const d=n(new Map,l);for(const[h,m]of o)d.set(i(h),i(m));return d}case Hx:{const d=n(new Set,l);for(const h of o)d.add(i(h));return d}case aS:{const{name:d,message:h}=o;return n(new $0[d](h),l)}case sS:return n(BigInt(o),l);case"BigInt":return n(Object(BigInt(o)),l);case"ArrayBuffer":return n(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:d}=new Uint8Array(o);return n(new DataView(d),o)}}return n(new $0[c](o),l)};return i},M0=t=>YF(new Map,t)(0),wo="",{toString:JF}={},{keys:KF}=Object,fu=t=>{const a=typeof t;if(a!=="object"||!t)return[fm,a];const n=JF.call(t).slice(8,-1);switch(n){case"Array":return[Nu,wo];case"Object":return[Yh,wo];case"Date":return[Bx,wo];case"RegExp":return[Ux,wo];case"Map":return[qx,wo];case"Set":return[Hx,wo];case"DataView":return[Nu,n]}return n.includes("Array")?[Nu,n]:n.includes("Error")?[aS,n]:[Yh,n]},wh=([t,a])=>t===fm&&(a==="function"||a==="symbol"),WF=(t,a,n,i)=>{const l=(o,d)=>{const h=i.push(o)-1;return n.set(d,h),h},c=o=>{if(n.has(o))return n.get(o);let[d,h]=fu(o);switch(d){case fm:{let f=o;switch(h){case"bigint":d=sS,f=o.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+h);f=null;break;case"undefined":return l([nS],o)}return l([d,f],o)}case Nu:{if(h){let y=o;return h==="DataView"?y=new Uint8Array(o.buffer):h==="ArrayBuffer"&&(y=new Uint8Array(o)),l([h,[...y]],o)}const f=[],g=l([d,f],o);for(const y of o)f.push(c(y));return g}case Yh:{if(h)switch(h){case"BigInt":return l([h,o.toString()],o);case"Boolean":case"Number":case"String":return l([h,o.valueOf()],o)}if(a&&"toJSON"in o)return c(o.toJSON());const f=[],g=l([d,f],o);for(const y of KF(o))(t||!wh(fu(o[y])))&&f.push([c(y),c(o[y])]);return g}case Bx:return l([d,o.toISOString()],o);case Ux:{const{source:f,flags:g}=o;return l([d,{source:f,flags:g}],o)}case qx:{const f=[],g=l([d,f],o);for(const[y,b]of o)(t||!(wh(fu(y))||wh(fu(b))))&&f.push([c(y),c(b)]);return g}case Hx:{const f=[],g=l([d,f],o);for(const y of o)(t||!wh(fu(y)))&&f.push(c(y));return g}}const{message:m}=o;return l([d,{name:h,message:m}],o)};return c},B0=(t,{json:a,lossy:n}={})=>{const i=[];return WF(!(a||n),!!a,new Map,i)(t),i},Du=typeof structuredClone=="function"?(t,a)=>a&&("json"in a||"lossy"in a)?M0(B0(t,a)):structuredClone(t):(t,a)=>M0(B0(t,a)),iS=lS("end"),rS=lS("start");function lS(t){return a;function a(n){const i=n&&n.position&&n.position[t]||{};if(typeof i.line=="number"&&i.line>0&&typeof i.column=="number"&&i.column>0)return{line:i.line,column:i.column,offset:typeof i.offset=="number"&&i.offset>-1?i.offset:void 0}}}function oS(t){const a=rS(t),n=iS(t);if(a&&n)return{start:a,end:n}}const ll=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],U0={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...ll,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...ll],h2:[["className","sr-only"]],img:[...ll,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...ll,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...ll],table:[...ll],ul:[...ll,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},xr={}.hasOwnProperty;function XF(t,a){let n={type:"root",children:[]};const i={schema:a?{...U0,...a}:U0,stack:[]},l=cS(i,t);return l&&(Array.isArray(l)?l.length===1?n=l[0]:n.children=l:n=l),n}function cS(t,a){if(a&&typeof a=="object"){const n=a;switch(typeof n.type=="string"?n.type:""){case"comment":return ZF(t,n);case"doctype":return eL(t,n);case"element":return tL(t,n);case"root":return nL(t,n);case"text":return aL(t,n)}}}function ZF(t,a){if(t.schema.allowComments){const n=typeof a.value=="string"?a.value:"",i=n.indexOf("-->"),c={type:"comment",value:i<0?n:n.slice(0,i)};return Uu(c,a),c}}function eL(t,a){if(t.schema.allowDoctypes){const n={type:"doctype"};return Uu(n,a),n}}function tL(t,a){const n=typeof a.tagName=="string"?a.tagName:"";t.stack.push(n);const i=uS(t,a.children),l=sL(t,a.properties);t.stack.pop();let c=!1;if(n&&n!=="*"&&(!t.schema.tagNames||t.schema.tagNames.includes(n))&&(c=!0,t.schema.ancestors&&xr.call(t.schema.ancestors,n))){const d=t.schema.ancestors[n];let h=-1;for(c=!1;++h<d.length;)t.stack.includes(d[h])&&(c=!0)}if(!c)return t.schema.strip&&!t.schema.strip.includes(n)?i:void 0;const o={type:"element",tagName:n,properties:l,children:i};return Uu(o,a),o}function nL(t,a){const i={type:"root",children:uS(t,a.children)};return Uu(i,a),i}function aL(t,a){const i={type:"text",value:typeof a.value=="string"?a.value:""};return Uu(i,a),i}function uS(t,a){const n=[];if(Array.isArray(a)){const i=a;let l=-1;for(;++l<i.length;){const c=cS(t,i[l]);c&&(Array.isArray(c)?n.push(...c):n.push(c))}}return n}function sL(t,a){const n=t.stack[t.stack.length-1],i=t.schema.attributes,l=t.schema.required,c=i&&xr.call(i,n)?i[n]:void 0,o=i&&xr.call(i,"*")?i["*"]:void 0,d=a&&typeof a=="object"?a:{},h={};let m;for(m in d)if(xr.call(d,m)){const f=d[m];let g=q0(t,H0(c,m),m,f);g==null&&(g=q0(t,H0(o,m),m,f)),g!=null&&(h[m]=g)}if(l&&xr.call(l,n)){const f=l[n];for(m in f)xr.call(f,m)&&!xr.call(h,m)&&(h[m]=f[m])}return h}function q0(t,a,n,i){return a?Array.isArray(i)?iL(t,a,n,i):dS(t,a,n,i):void 0}function iL(t,a,n,i){let l=-1;const c=[];for(;++l<i.length;){const o=dS(t,a,n,i[l]);(typeof o=="number"||typeof o=="string")&&c.push(o)}return c}function dS(t,a,n,i){if(!(typeof i!="boolean"&&typeof i!="number"&&typeof i!="string")&&rL(t,n,i)){if(typeof a=="object"&&a.length>1){let l=!1,c=0;for(;++c<a.length;){const o=a[c];if(o&&typeof o=="object"&&"flags"in o){if(o.test(String(i))){l=!0;break}}else if(o===i){l=!0;break}}if(!l)return}return t.schema.clobber&&t.schema.clobberPrefix&&t.schema.clobber.includes(n)?t.schema.clobberPrefix+i:i}}function rL(t,a,n){const i=t.schema.protocols&&xr.call(t.schema.protocols,a)?t.schema.protocols[a]:void 0;if(!i||i.length===0)return!0;const l=String(n),c=l.indexOf(":"),o=l.indexOf("?"),d=l.indexOf("#"),h=l.indexOf("/");if(c<0||h>-1&&c>h||o>-1&&c>o||d>-1&&c>d)return!0;let m=-1;for(;++m<i.length;){const f=i[m];if(c===f.length&&l.slice(0,f.length)===f)return!0}return!1}function Uu(t,a){const n=oS(a);a.data&&(t.data=Du(a.data)),n&&(t.position=n)}function H0(t,a){let n,i=-1;if(t)for(;++i<t.length;){const l=t[i],c=typeof l=="string"?l:l[0];if(c===a)return l;c==="data*"&&(n=l)}if(a.length>4&&a.slice(0,4).toLowerCase()==="data")return n}function lL(t,a){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(a),!0)};return t.patch(a,n),t.applyData(a,n)}function oL(t,a){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(a,n),[t.applyData(a,n),{type:"text",value:`
`}]}function cL(t,a){const n=a.value?a.value+`
`:"",i={};a.lang&&(i.className=["language-"+a.lang]);let l={type:"element",tagName:"code",properties:i,children:[{type:"text",value:n}]};return a.meta&&(l.data={meta:a.meta}),t.patch(a,l),l=t.applyData(a,l),l={type:"element",tagName:"pre",properties:{},children:[l]},t.patch(a,l),l}function uL(t,a){const n={type:"element",tagName:"del",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function dL(t,a){const n={type:"element",tagName:"em",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function hL(t,a){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",i=String(a.identifier).toUpperCase(),l=Yo(i.toLowerCase()),c=t.footnoteOrder.indexOf(i);let o,d=t.footnoteCounts.get(i);d===void 0?(d=0,t.footnoteOrder.push(i),o=t.footnoteOrder.length):o=c+1,d+=1,t.footnoteCounts.set(i,d);const h={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+l,id:n+"fnref-"+l+(d>1?"-"+d:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};t.patch(a,h);const m={type:"element",tagName:"sup",properties:{},children:[h]};return t.patch(a,m),t.applyData(a,m)}function mL(t,a){const n={type:"element",tagName:"h"+a.depth,properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function pL(t,a){if(t.options.allowDangerousHtml){const n={type:"raw",value:a.value};return t.patch(a,n),t.applyData(a,n)}}function hS(t,a){const n=a.referenceType;let i="]";if(n==="collapsed"?i+="[]":n==="full"&&(i+="["+(a.label||a.identifier)+"]"),a.type==="imageReference")return[{type:"text",value:"!["+a.alt+i}];const l=t.all(a),c=l[0];c&&c.type==="text"?c.value="["+c.value:l.unshift({type:"text",value:"["});const o=l[l.length-1];return o&&o.type==="text"?o.value+=i:l.push({type:"text",value:i}),l}function fL(t,a){const n=String(a.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return hS(t,a);const l={src:Yo(i.url||""),alt:a.alt};i.title!==null&&i.title!==void 0&&(l.title=i.title);const c={type:"element",tagName:"img",properties:l,children:[]};return t.patch(a,c),t.applyData(a,c)}function gL(t,a){const n={src:Yo(a.url)};a.alt!==null&&a.alt!==void 0&&(n.alt=a.alt),a.title!==null&&a.title!==void 0&&(n.title=a.title);const i={type:"element",tagName:"img",properties:n,children:[]};return t.patch(a,i),t.applyData(a,i)}function xL(t,a){const n={type:"text",value:a.value.replace(/\r?\n|\r/g," ")};t.patch(a,n);const i={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(a,i),t.applyData(a,i)}function yL(t,a){const n=String(a.identifier).toUpperCase(),i=t.definitionById.get(n);if(!i)return hS(t,a);const l={href:Yo(i.url||"")};i.title!==null&&i.title!==void 0&&(l.title=i.title);const c={type:"element",tagName:"a",properties:l,children:t.all(a)};return t.patch(a,c),t.applyData(a,c)}function bL(t,a){const n={href:Yo(a.url)};a.title!==null&&a.title!==void 0&&(n.title=a.title);const i={type:"element",tagName:"a",properties:n,children:t.all(a)};return t.patch(a,i),t.applyData(a,i)}function jL(t,a,n){const i=t.all(a),l=n?vL(n):mS(a),c={},o=[];if(typeof a.checked=="boolean"){const f=i[0];let g;f&&f.type==="element"&&f.tagName==="p"?g=f:(g={type:"element",tagName:"p",properties:{},children:[]},i.unshift(g)),g.children.length>0&&g.children.unshift({type:"text",value:" "}),g.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:a.checked,disabled:!0},children:[]}),c.className=["task-list-item"]}let d=-1;for(;++d<i.length;){const f=i[d];(l||d!==0||f.type!=="element"||f.tagName!=="p")&&o.push({type:"text",value:`
`}),f.type==="element"&&f.tagName==="p"&&!l?o.push(...f.children):o.push(f)}const h=i[i.length-1];h&&(l||h.type!=="element"||h.tagName!=="p")&&o.push({type:"text",value:`
`});const m={type:"element",tagName:"li",properties:c,children:o};return t.patch(a,m),t.applyData(a,m)}function vL(t){let a=!1;if(t.type==="list"){a=t.spread||!1;const n=t.children;let i=-1;for(;!a&&++i<n.length;)a=mS(n[i])}return a}function mS(t){const a=t.spread;return a??t.children.length>1}function NL(t,a){const n={},i=t.all(a);let l=-1;for(typeof a.start=="number"&&a.start!==1&&(n.start=a.start);++l<i.length;){const o=i[l];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const c={type:"element",tagName:a.ordered?"ol":"ul",properties:n,children:t.wrap(i,!0)};return t.patch(a,c),t.applyData(a,c)}function wL(t,a){const n={type:"element",tagName:"p",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function SL(t,a){const n={type:"root",children:t.wrap(t.all(a))};return t.patch(a,n),t.applyData(a,n)}function kL(t,a){const n={type:"element",tagName:"strong",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}function CL(t,a){const n=t.all(a),i=n.shift(),l=[];if(i){const o={type:"element",tagName:"thead",properties:{},children:t.wrap([i],!0)};t.patch(a.children[0],o),l.push(o)}if(n.length>0){const o={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},d=rS(a.children[1]),h=iS(a.children[a.children.length-1]);d&&h&&(o.position={start:d,end:h}),l.push(o)}const c={type:"element",tagName:"table",properties:{},children:t.wrap(l,!0)};return t.patch(a,c),t.applyData(a,c)}function _L(t,a,n){const i=n?n.children:void 0,c=(i?i.indexOf(a):1)===0?"th":"td",o=n&&n.type==="table"?n.align:void 0,d=o?o.length:a.children.length;let h=-1;const m=[];for(;++h<d;){const g=a.children[h],y={},b=o?o[h]:void 0;b&&(y.align=b);let v={type:"element",tagName:c,properties:y,children:[]};g&&(v.children=t.all(g),t.patch(g,v),v=t.applyData(g,v)),m.push(v)}const f={type:"element",tagName:"tr",properties:{},children:t.wrap(m,!0)};return t.patch(a,f),t.applyData(a,f)}function DL(t,a){const n={type:"element",tagName:"td",properties:{},children:t.all(a)};return t.patch(a,n),t.applyData(a,n)}const V0=9,G0=32;function EL(t){const a=String(t),n=/\r?\n|\r/g;let i=n.exec(a),l=0;const c=[];for(;i;)c.push(Q0(a.slice(l,i.index),l>0,!0),i[0]),l=i.index+i[0].length,i=n.exec(a);return c.push(Q0(a.slice(l),l>0,!1)),c.join("")}function Q0(t,a,n){let i=0,l=t.length;if(a){let c=t.codePointAt(i);for(;c===V0||c===G0;)i++,c=t.codePointAt(i)}if(n){let c=t.codePointAt(l-1);for(;c===V0||c===G0;)l--,c=t.codePointAt(l-1)}return l>i?t.slice(i,l):""}function TL(t,a){const n={type:"text",value:EL(String(a.value))};return t.patch(a,n),t.applyData(a,n)}function AL(t,a){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(a,n),t.applyData(a,n)}const PL={blockquote:lL,break:oL,code:cL,delete:uL,emphasis:dL,footnoteReference:hL,heading:mL,html:pL,imageReference:fL,image:gL,inlineCode:xL,linkReference:yL,link:bL,listItem:jL,list:NL,paragraph:wL,root:SL,strong:kL,table:CL,tableCell:DL,tableRow:_L,text:TL,thematicBreak:AL,toml:Sh,yaml:Sh,definition:Sh,footnoteDefinition:Sh};function Sh(){}function RL(t,a){const n=[{type:"text",value:""}];return a>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(a)}]}),n}function OL(t,a){return"Back to reference "+(t+1)+(a>1?"-"+a:"")}function IL(t){const a=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||RL,i=t.options.footnoteBackLabel||OL,l=t.options.footnoteLabel||"Footnotes",c=t.options.footnoteLabelTagName||"h2",o=t.options.footnoteLabelProperties||{className:["sr-only"]},d=[];let h=-1;for(;++h<t.footnoteOrder.length;){const m=t.footnoteById.get(t.footnoteOrder[h]);if(!m)continue;const f=t.all(m),g=String(m.identifier).toUpperCase(),y=Yo(g.toLowerCase());let b=0;const v=[],w=t.footnoteCounts.get(g);for(;w!==void 0&&++b<=w;){v.length>0&&v.push({type:"text",value:" "});let E=typeof n=="string"?n:n(h,b);typeof E=="string"&&(E={type:"text",value:E}),v.push({type:"element",tagName:"a",properties:{href:"#"+a+"fnref-"+y+(b>1?"-"+b:""),dataFootnoteBackref:"",ariaLabel:typeof i=="string"?i:i(h,b),className:["data-footnote-backref"]},children:Array.isArray(E)?E:[E]})}const S=f[f.length-1];if(S&&S.type==="element"&&S.tagName==="p"){const E=S.children[S.children.length-1];E&&E.type==="text"?E.value+=" ":S.children.push({type:"text",value:" "}),S.children.push(...v)}else f.push(...v);const _={type:"element",tagName:"li",properties:{id:a+"fn-"+y},children:t.wrap(f,!0)};t.patch(m,_),d.push(_)}if(d.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:c,properties:{...Du(o),id:"footnote-label"},children:[{type:"text",value:l}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(d,!0)},{type:"text",value:`
`}]}}const Gg={}.hasOwnProperty,zL={};function FL(t,a){const n=a||zL,i=new Map,l=new Map,c=new Map,o={...PL,...n.handlers},d={all:m,applyData:$L,definitionById:i,footnoteById:l,footnoteCounts:c,footnoteOrder:[],handlers:o,one:h,options:n,patch:LL,wrap:BL};return Vw(t,function(f){if(f.type==="definition"||f.type==="footnoteDefinition"){const g=f.type==="definition"?i:l,y=String(f.identifier).toUpperCase();g.has(y)||g.set(y,f)}}),d;function h(f,g){const y=f.type,b=d.handlers[y];if(Gg.call(d.handlers,y)&&b)return b(d,f,g);if(d.options.passThrough&&d.options.passThrough.includes(y)){if("children"in f){const{children:w,...S}=f,_=Du(S);return _.children=d.all(f),_}return Du(f)}return(d.options.unknownHandler||ML)(d,f,g)}function m(f){const g=[];if("children"in f){const y=f.children;let b=-1;for(;++b<y.length;){const v=d.one(y[b],f);if(v){if(b&&y[b-1].type==="break"&&(!Array.isArray(v)&&v.type==="text"&&(v.value=Y0(v.value)),!Array.isArray(v)&&v.type==="element")){const w=v.children[0];w&&w.type==="text"&&(w.value=Y0(w.value))}Array.isArray(v)?g.push(...v):g.push(v)}}}return g}}function LL(t,a){t.position&&(a.position=oS(t))}function $L(t,a){let n=a;if(t&&t.data){const i=t.data.hName,l=t.data.hChildren,c=t.data.hProperties;if(typeof i=="string")if(n.type==="element")n.tagName=i;else{const o="children"in n?n.children:[n];n={type:"element",tagName:i,properties:{},children:o}}n.type==="element"&&c&&Object.assign(n.properties,Du(c)),"children"in n&&n.children&&l!==null&&l!==void 0&&(n.children=l)}return n}function ML(t,a){const n=a.data||{},i="value"in a&&!(Gg.call(n,"hProperties")||Gg.call(n,"hChildren"))?{type:"text",value:a.value}:{type:"element",tagName:"div",properties:{},children:t.all(a)};return t.patch(a,i),t.applyData(a,i)}function BL(t,a){const n=[];let i=-1;for(a&&n.push({type:"text",value:`
`});++i<t.length;)i&&n.push({type:"text",value:`
`}),n.push(t[i]);return a&&t.length>0&&n.push({type:"text",value:`
`}),n}function Y0(t){let a=0,n=t.charCodeAt(a);for(;n===9||n===32;)a++,n=t.charCodeAt(a);return t.slice(a)}function UL(t,a){const n=FL(t,a),i=n.one(t,void 0),l=IL(n),c=Array.isArray(i)?{type:"root",children:i}:i||{type:"root",children:[]};return l&&c.children.push({type:"text",value:`
`},l),c}const qL=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"];class qu{constructor(a,n,i){this.normal=n,this.property=a,i&&(this.space=i)}}qu.prototype.normal={};qu.prototype.property={};qu.prototype.space=void 0;function pS(t,a){const n={},i={};for(const l of t)Object.assign(n,l.property),Object.assign(i,l.normal);return new qu(n,i,a)}function Qg(t){return t.toLowerCase()}class Ta{constructor(a,n){this.attribute=n,this.property=a}}Ta.prototype.attribute="";Ta.prototype.booleanish=!1;Ta.prototype.boolean=!1;Ta.prototype.commaOrSpaceSeparated=!1;Ta.prototype.commaSeparated=!1;Ta.prototype.defined=!1;Ta.prototype.mustUseProperty=!1;Ta.prototype.number=!1;Ta.prototype.overloadedBoolean=!1;Ta.prototype.property="";Ta.prototype.spaceSeparated=!1;Ta.prototype.space=void 0;let HL=0;const It=wl(),Pn=wl(),Yg=wl(),nt=wl(),mn=wl(),Ro=wl(),Ua=wl();function wl(){return 2**++HL}const Jg=Object.freeze(Object.defineProperty({__proto__:null,boolean:It,booleanish:Pn,commaOrSpaceSeparated:Ua,commaSeparated:Ro,number:nt,overloadedBoolean:Yg,spaceSeparated:mn},Symbol.toStringTag,{value:"Module"})),Wf=Object.keys(Jg);class Vx extends Ta{constructor(a,n,i,l){let c=-1;if(super(a,n),J0(this,"space",l),typeof i=="number")for(;++c<Wf.length;){const o=Wf[c];J0(this,Wf[c],(i&Jg[o])===Jg[o])}}}Vx.prototype.defined=!0;function J0(t,a,n){n&&(t[a]=n)}function Jo(t){const a={},n={};for(const[i,l]of Object.entries(t.properties)){const c=new Vx(i,t.transform(t.attributes||{},i),l,t.space);t.mustUseProperty&&t.mustUseProperty.includes(i)&&(c.mustUseProperty=!0),a[i]=c,n[Qg(i)]=i,n[Qg(c.attribute)]=i}return new qu(a,n,t.space)}const fS=Jo({properties:{ariaActiveDescendant:null,ariaAtomic:Pn,ariaAutoComplete:null,ariaBusy:Pn,ariaChecked:Pn,ariaColCount:nt,ariaColIndex:nt,ariaColSpan:nt,ariaControls:mn,ariaCurrent:null,ariaDescribedBy:mn,ariaDetails:null,ariaDisabled:Pn,ariaDropEffect:mn,ariaErrorMessage:null,ariaExpanded:Pn,ariaFlowTo:mn,ariaGrabbed:Pn,ariaHasPopup:null,ariaHidden:Pn,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:mn,ariaLevel:nt,ariaLive:null,ariaModal:Pn,ariaMultiLine:Pn,ariaMultiSelectable:Pn,ariaOrientation:null,ariaOwns:mn,ariaPlaceholder:null,ariaPosInSet:nt,ariaPressed:Pn,ariaReadOnly:Pn,ariaRelevant:null,ariaRequired:Pn,ariaRoleDescription:mn,ariaRowCount:nt,ariaRowIndex:nt,ariaRowSpan:nt,ariaSelected:Pn,ariaSetSize:nt,ariaSort:null,ariaValueMax:nt,ariaValueMin:nt,ariaValueNow:nt,ariaValueText:null,role:null},transform(t,a){return a==="role"?a:"aria-"+a.slice(4).toLowerCase()}});function gS(t,a){return a in t?t[a]:a}function xS(t,a){return gS(t,a.toLowerCase())}const VL=Jo({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:Ro,acceptCharset:mn,accessKey:mn,action:null,allow:null,allowFullScreen:It,allowPaymentRequest:It,allowUserMedia:It,alt:null,as:null,async:It,autoCapitalize:null,autoComplete:mn,autoFocus:It,autoPlay:It,blocking:mn,capture:null,charSet:null,checked:It,cite:null,className:mn,cols:nt,colSpan:null,content:null,contentEditable:Pn,controls:It,controlsList:mn,coords:nt|Ro,crossOrigin:null,data:null,dateTime:null,decoding:null,default:It,defer:It,dir:null,dirName:null,disabled:It,download:Yg,draggable:Pn,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:It,formTarget:null,headers:mn,height:nt,hidden:Yg,high:nt,href:null,hrefLang:null,htmlFor:mn,httpEquiv:mn,id:null,imageSizes:null,imageSrcSet:null,inert:It,inputMode:null,integrity:null,is:null,isMap:It,itemId:null,itemProp:mn,itemRef:mn,itemScope:It,itemType:mn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:It,low:nt,manifest:null,max:null,maxLength:nt,media:null,method:null,min:null,minLength:nt,multiple:It,muted:It,name:null,nonce:null,noModule:It,noValidate:It,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:It,optimum:nt,pattern:null,ping:mn,placeholder:null,playsInline:It,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:It,referrerPolicy:null,rel:mn,required:It,reversed:It,rows:nt,rowSpan:nt,sandbox:mn,scope:null,scoped:It,seamless:It,selected:It,shadowRootClonable:It,shadowRootDelegatesFocus:It,shadowRootMode:null,shape:null,size:nt,sizes:null,slot:null,span:nt,spellCheck:Pn,src:null,srcDoc:null,srcLang:null,srcSet:null,start:nt,step:null,style:null,tabIndex:nt,target:null,title:null,translate:null,type:null,typeMustMatch:It,useMap:null,value:Pn,width:nt,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:mn,axis:null,background:null,bgColor:null,border:nt,borderColor:null,bottomMargin:nt,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:It,declare:It,event:null,face:null,frame:null,frameBorder:null,hSpace:nt,leftMargin:nt,link:null,longDesc:null,lowSrc:null,marginHeight:nt,marginWidth:nt,noResize:It,noHref:It,noShade:It,noWrap:It,object:null,profile:null,prompt:null,rev:null,rightMargin:nt,rules:null,scheme:null,scrolling:Pn,standby:null,summary:null,text:null,topMargin:nt,valueType:null,version:null,vAlign:null,vLink:null,vSpace:nt,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:It,disableRemotePlayback:It,prefix:null,property:null,results:nt,security:null,unselectable:null},space:"html",transform:xS}),GL=Jo({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Ua,accentHeight:nt,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:nt,amplitude:nt,arabicForm:null,ascent:nt,attributeName:null,attributeType:null,azimuth:nt,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:nt,by:null,calcMode:null,capHeight:nt,className:mn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:nt,diffuseConstant:nt,direction:null,display:null,dur:null,divisor:nt,dominantBaseline:null,download:It,dx:null,dy:null,edgeMode:null,editable:null,elevation:nt,enableBackground:null,end:null,event:null,exponent:nt,externalResourcesRequired:null,fill:null,fillOpacity:nt,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:Ro,g2:Ro,glyphName:Ro,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:nt,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:nt,horizOriginX:nt,horizOriginY:nt,id:null,ideographic:nt,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:nt,k:nt,k1:nt,k2:nt,k3:nt,k4:nt,kernelMatrix:Ua,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:nt,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:nt,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:nt,overlineThickness:nt,paintOrder:null,panose1:null,path:null,pathLength:nt,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:mn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:nt,pointsAtY:nt,pointsAtZ:nt,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Ua,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Ua,rev:Ua,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Ua,requiredFeatures:Ua,requiredFonts:Ua,requiredFormats:Ua,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:nt,specularExponent:nt,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:nt,strikethroughThickness:nt,string:null,stroke:null,strokeDashArray:Ua,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:nt,strokeOpacity:nt,strokeWidth:null,style:null,surfaceScale:nt,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Ua,tabIndex:nt,tableValues:null,target:null,targetX:nt,targetY:nt,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Ua,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:nt,underlineThickness:nt,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:nt,values:null,vAlphabetic:nt,vMathematical:nt,vectorEffect:null,vHanging:nt,vIdeographic:nt,version:null,vertAdvY:nt,vertOriginX:nt,vertOriginY:nt,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:nt,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:gS}),yS=Jo({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,a){return"xlink:"+a.slice(5).toLowerCase()}}),bS=Jo({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:xS}),jS=Jo({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,a){return"xml:"+a.slice(3).toLowerCase()}}),QL=/[A-Z]/g,K0=/-[a-z]/g,YL=/^data[-\w.:]+$/i;function JL(t,a){const n=Qg(a);let i=a,l=Ta;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&YL.test(a)){if(a.charAt(4)==="-"){const c=a.slice(5).replace(K0,WL);i="data"+c.charAt(0).toUpperCase()+c.slice(1)}else{const c=a.slice(4);if(!K0.test(c)){let o=c.replace(QL,KL);o.charAt(0)!=="-"&&(o="-"+o),a="data"+o}}l=Vx}return new l(i,a)}function KL(t){return"-"+t.toLowerCase()}function WL(t){return t.charAt(1).toUpperCase()}const XL=pS([fS,VL,yS,bS,jS],"html"),vS=pS([fS,GL,yS,bS,jS],"svg"),ZL=/["&'<>`]/g,e$=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,t$=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,n$=/[|\\{}()[\]^$+*?.]/g,W0=new WeakMap;function a$(t,a){if(t=t.replace(a.subset?s$(a.subset):ZL,i),a.subset||a.escapeOnly)return t;return t.replace(e$,n).replace(t$,i);function n(l,c,o){return a.format((l.charCodeAt(0)-55296)*1024+l.charCodeAt(1)-56320+65536,o.charCodeAt(c+2),a)}function i(l,c,o){return a.format(l.charCodeAt(0),o.charCodeAt(c+1),a)}}function s$(t){let a=W0.get(t);return a||(a=i$(t),W0.set(t,a)),a}function i$(t){const a=[];let n=-1;for(;++n<t.length;)a.push(t[n].replace(n$,"\\$&"));return new RegExp("(?:"+a.join("|")+")","g")}const r$=/[\dA-Fa-f]/;function l$(t,a,n){const i="&#x"+t.toString(16).toUpperCase();return n&&a&&!r$.test(String.fromCharCode(a))?i:i+";"}const o$=/\d/;function c$(t,a,n){const i="&#"+String(t);return n&&a&&!o$.test(String.fromCharCode(a))?i:i+";"}const u$=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],Xf={nbsp:"",iexcl:"",cent:"",pound:"",curren:"",yen:"",brvbar:"",sect:"",uml:"",copy:"",ordf:"",laquo:"",not:"",shy:"",reg:"",macr:"",deg:"",plusmn:"",sup2:"",sup3:"",acute:"",micro:"",para:"",middot:"",cedil:"",sup1:"",ordm:"",raquo:"",frac14:"",frac12:"",frac34:"",iquest:"",Agrave:"",Aacute:"",Acirc:"",Atilde:"",Auml:"",Aring:"",AElig:"",Ccedil:"",Egrave:"",Eacute:"",Ecirc:"",Euml:"",Igrave:"",Iacute:"",Icirc:"",Iuml:"",ETH:"",Ntilde:"",Ograve:"",Oacute:"",Ocirc:"",Otilde:"",Ouml:"",times:"",Oslash:"",Ugrave:"",Uacute:"",Ucirc:"",Uuml:"",Yacute:"",THORN:"",szlig:"",agrave:"",aacute:"",acirc:"",atilde:"",auml:"",aring:"",aelig:"",ccedil:"",egrave:"",eacute:"",ecirc:"",euml:"",igrave:"",iacute:"",icirc:"",iuml:"",eth:"",ntilde:"",ograve:"",oacute:"",ocirc:"",otilde:"",ouml:"",divide:"",oslash:"",ugrave:"",uacute:"",ucirc:"",uuml:"",yacute:"",thorn:"",yuml:"",fnof:"",Alpha:"",Beta:"",Gamma:"",Delta:"",Epsilon:"",Zeta:"",Eta:"",Theta:"",Iota:"",Kappa:"",Lambda:"",Mu:"",Nu:"",Xi:"",Omicron:"",Pi:"",Rho:"",Sigma:"",Tau:"",Upsilon:"",Phi:"",Chi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",omicron:"",pi:"",rho:"",sigmaf:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",thetasym:"",upsih:"",piv:"",bull:"",hellip:"",prime:"",Prime:"",oline:"",frasl:"",weierp:"",image:"",real:"",trade:"",alefsym:"",larr:"",uarr:"",rarr:"",darr:"",harr:"",crarr:"",lArr:"",uArr:"",rArr:"",dArr:"",hArr:"",forall:"",part:"",exist:"",empty:"",nabla:"",isin:"",notin:"",ni:"",prod:"",sum:"",minus:"",lowast:"",radic:"",prop:"",infin:"",ang:"",and:"",or:"",cap:"",cup:"",int:"",there4:"",sim:"",cong:"",asymp:"",ne:"",equiv:"",le:"",ge:"",sub:"",sup:"",nsub:"",sube:"",supe:"",oplus:"",otimes:"",perp:"",sdot:"",lceil:"",rceil:"",lfloor:"",rfloor:"",lang:"",rang:"",loz:"",spades:"",clubs:"",hearts:"",diams:"",quot:'"',amp:"&",lt:"<",gt:">",OElig:"",oelig:"",Scaron:"",scaron:"",Yuml:"",circ:"",tilde:"",ensp:"",emsp:"",thinsp:"",zwnj:"",zwj:"",lrm:"",rlm:"",ndash:"",mdash:"",lsquo:"",rsquo:"",sbquo:"",ldquo:"",rdquo:"",bdquo:"",dagger:"",Dagger:"",permil:"",lsaquo:"",rsaquo:"",euro:""},d$=["cent","copy","divide","gt","lt","not","para","times"],NS={}.hasOwnProperty,Kg={};let kh;for(kh in Xf)NS.call(Xf,kh)&&(Kg[Xf[kh]]=kh);const h$=/[^\dA-Za-z]/;function m$(t,a,n,i){const l=String.fromCharCode(t);if(NS.call(Kg,l)){const c=Kg[l],o="&"+c;return n&&u$.includes(c)&&!d$.includes(c)&&(!i||a&&a!==61&&h$.test(String.fromCharCode(a)))?o:o+";"}return""}function p$(t,a,n){let i=l$(t,a,n.omitOptionalSemicolons),l;if((n.useNamedReferences||n.useShortestReferences)&&(l=m$(t,a,n.omitOptionalSemicolons,n.attribute)),(n.useShortestReferences||!l)&&n.useShortestReferences){const c=c$(t,a,n.omitOptionalSemicolons);c.length<i.length&&(i=c)}return l&&(!n.useShortestReferences||l.length<i.length)?l:i}function Oo(t,a){return a$(t,Object.assign({format:p$},a))}const f$=/^>|^->|<!--|-->|--!>|<!-$/g,g$=[">"],x$=["<",">"];function y$(t,a,n,i){return i.settings.bogusComments?"<?"+Oo(t.value,Object.assign({},i.settings.characterReferences,{subset:g$}))+">":"<!--"+t.value.replace(f$,l)+"-->";function l(c){return Oo(c,Object.assign({},i.settings.characterReferences,{subset:x$}))}}function b$(t,a,n,i){return"<!"+(i.settings.upperDoctype?"DOCTYPE":"doctype")+(i.settings.tightDoctype?"":" ")+"html>"}function X0(t,a){const n=String(t);if(typeof a!="string")throw new TypeError("Expected character");let i=0,l=n.indexOf(a);for(;l!==-1;)i++,l=n.indexOf(a,l+a.length);return i}function j$(t,a){const n=a||{};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}function v$(t){return t.join(" ").trim()}const N$=/[ \t\n\f\r]/g;function Gx(t){return typeof t=="object"?t.type==="text"?Z0(t.value):!1:Z0(t)}function Z0(t){return t.replace(N$,"")===""}const Ln=SS(1),wS=SS(-1),w$=[];function SS(t){return a;function a(n,i,l){const c=n?n.children:w$;let o=(i||0)+t,d=c[o];if(!l)for(;d&&Gx(d);)o+=t,d=c[o];return d}}const S$={}.hasOwnProperty;function kS(t){return a;function a(n,i,l){return S$.call(t,n.tagName)&&t[n.tagName](n,i,l)}}const Qx=kS({body:C$,caption:Zf,colgroup:Zf,dd:T$,dt:E$,head:Zf,html:k$,li:D$,optgroup:A$,option:P$,p:_$,rp:e1,rt:e1,tbody:O$,td:t1,tfoot:I$,th:t1,thead:R$,tr:z$});function Zf(t,a,n){const i=Ln(n,a,!0);return!i||i.type!=="comment"&&!(i.type==="text"&&Gx(i.value.charAt(0)))}function k$(t,a,n){const i=Ln(n,a);return!i||i.type!=="comment"}function C$(t,a,n){const i=Ln(n,a);return!i||i.type!=="comment"}function _$(t,a,n){const i=Ln(n,a);return i?i.type==="element"&&(i.tagName==="address"||i.tagName==="article"||i.tagName==="aside"||i.tagName==="blockquote"||i.tagName==="details"||i.tagName==="div"||i.tagName==="dl"||i.tagName==="fieldset"||i.tagName==="figcaption"||i.tagName==="figure"||i.tagName==="footer"||i.tagName==="form"||i.tagName==="h1"||i.tagName==="h2"||i.tagName==="h3"||i.tagName==="h4"||i.tagName==="h5"||i.tagName==="h6"||i.tagName==="header"||i.tagName==="hgroup"||i.tagName==="hr"||i.tagName==="main"||i.tagName==="menu"||i.tagName==="nav"||i.tagName==="ol"||i.tagName==="p"||i.tagName==="pre"||i.tagName==="section"||i.tagName==="table"||i.tagName==="ul"):!n||!(n.type==="element"&&(n.tagName==="a"||n.tagName==="audio"||n.tagName==="del"||n.tagName==="ins"||n.tagName==="map"||n.tagName==="noscript"||n.tagName==="video"))}function D$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&i.tagName==="li"}function E$(t,a,n){const i=Ln(n,a);return!!(i&&i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd"))}function T$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&(i.tagName==="dt"||i.tagName==="dd")}function e1(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&(i.tagName==="rp"||i.tagName==="rt")}function A$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&i.tagName==="optgroup"}function P$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&(i.tagName==="option"||i.tagName==="optgroup")}function R$(t,a,n){const i=Ln(n,a);return!!(i&&i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot"))}function O$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&(i.tagName==="tbody"||i.tagName==="tfoot")}function I$(t,a,n){return!Ln(n,a)}function z$(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&i.tagName==="tr"}function t1(t,a,n){const i=Ln(n,a);return!i||i.type==="element"&&(i.tagName==="td"||i.tagName==="th")}const F$=kS({body:M$,colgroup:B$,head:$$,html:L$,tbody:U$});function L$(t){const a=Ln(t,-1);return!a||a.type!=="comment"}function $$(t){const a=new Set;for(const i of t.children)if(i.type==="element"&&(i.tagName==="base"||i.tagName==="title")){if(a.has(i.tagName))return!1;a.add(i.tagName)}const n=t.children[0];return!n||n.type==="element"}function M$(t){const a=Ln(t,-1,!0);return!a||a.type!=="comment"&&!(a.type==="text"&&Gx(a.value.charAt(0)))&&!(a.type==="element"&&(a.tagName==="meta"||a.tagName==="link"||a.tagName==="script"||a.tagName==="style"||a.tagName==="template"))}function B$(t,a,n){const i=wS(n,a),l=Ln(t,-1,!0);return n&&i&&i.type==="element"&&i.tagName==="colgroup"&&Qx(i,n.children.indexOf(i),n)?!1:!!(l&&l.type==="element"&&l.tagName==="col")}function U$(t,a,n){const i=wS(n,a),l=Ln(t,-1);return n&&i&&i.type==="element"&&(i.tagName==="thead"||i.tagName==="tbody")&&Qx(i,n.children.indexOf(i),n)?!1:!!(l&&l.type==="element"&&l.tagName==="tr")}const Ch={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function q$(t,a,n,i){const l=i.schema,c=l.space==="svg"?!1:i.settings.omitOptionalTags;let o=l.space==="svg"?i.settings.closeEmptyElements:i.settings.voids.includes(t.tagName.toLowerCase());const d=[];let h;l.space==="html"&&t.tagName==="svg"&&(i.schema=vS);const m=H$(i,t.properties),f=i.all(l.space==="html"&&t.tagName==="template"?t.content:t);return i.schema=l,f&&(o=!1),(m||!c||!F$(t,a,n))&&(d.push("<",t.tagName,m?" "+m:""),o&&(l.space==="svg"||i.settings.closeSelfClosing)&&(h=m.charAt(m.length-1),(!i.settings.tightSelfClosing||h==="/"||h&&h!=='"'&&h!=="'")&&d.push(" "),d.push("/")),d.push(">")),d.push(f),!o&&(!c||!Qx(t,a,n))&&d.push("</"+t.tagName+">"),d.join("")}function H$(t,a){const n=[];let i=-1,l;if(a){for(l in a)if(a[l]!==null&&a[l]!==void 0){const c=V$(t,l,a[l]);c&&n.push(c)}}for(;++i<n.length;){const c=t.settings.tightAttributes?n[i].charAt(n[i].length-1):void 0;i!==n.length-1&&c!=='"'&&c!=="'"&&(n[i]+=" ")}return n.join("")}function V$(t,a,n){const i=JL(t.schema,a),l=t.settings.allowParseErrors&&t.schema.space==="html"?0:1,c=t.settings.allowDangerousCharacters?0:1;let o=t.quote,d;if(i.overloadedBoolean&&(n===i.attribute||n==="")?n=!0:(i.boolean||i.overloadedBoolean)&&(typeof n!="string"||n===i.attribute||n==="")&&(n=!!n),n==null||n===!1||typeof n=="number"&&Number.isNaN(n))return"";const h=Oo(i.attribute,Object.assign({},t.settings.characterReferences,{subset:Ch.name[l][c]}));return n===!0||(n=Array.isArray(n)?(i.commaSeparated?j$:v$)(n,{padLeft:!t.settings.tightCommaSeparatedLists}):String(n),t.settings.collapseEmptyAttributes&&!n)?h:(t.settings.preferUnquoted&&(d=Oo(n,Object.assign({},t.settings.characterReferences,{attribute:!0,subset:Ch.unquoted[l][c]}))),d!==n&&(t.settings.quoteSmart&&X0(n,o)>X0(n,t.alternative)&&(o=t.alternative),d=o+Oo(n,Object.assign({},t.settings.characterReferences,{subset:(o==="'"?Ch.single:Ch.double)[l][c],attribute:!0}))+o),h+(d&&"="+d))}const G$=["<","&"];function CS(t,a,n,i){return n&&n.type==="element"&&(n.tagName==="script"||n.tagName==="style")?t.value:Oo(t.value,Object.assign({},i.settings.characterReferences,{subset:G$}))}function Q$(t,a,n,i){return i.settings.allowDangerousHtml?t.value:CS(t,a,n,i)}function Y$(t,a,n,i){return i.all(t)}const J$=Mw("type",{invalid:K$,unknown:W$,handlers:{comment:y$,doctype:b$,element:q$,raw:Q$,root:Y$,text:CS}});function K$(t){throw new Error("Expected node, not `"+t+"`")}function W$(t){const a=t;throw new Error("Cannot compile unknown node `"+a.type+"`")}const X$={},Z$={},e5=[];function t5(t,a){const n=a||X$,i=n.quote||'"',l=i==='"'?"'":'"';if(i!=='"'&&i!=="'")throw new Error("Invalid quote `"+i+"`, expected `'` or `\"`");return{one:n5,all:a5,settings:{omitOptionalTags:n.omitOptionalTags||!1,allowParseErrors:n.allowParseErrors||!1,allowDangerousCharacters:n.allowDangerousCharacters||!1,quoteSmart:n.quoteSmart||!1,preferUnquoted:n.preferUnquoted||!1,tightAttributes:n.tightAttributes||!1,upperDoctype:n.upperDoctype||!1,tightDoctype:n.tightDoctype||!1,bogusComments:n.bogusComments||!1,tightCommaSeparatedLists:n.tightCommaSeparatedLists||!1,tightSelfClosing:n.tightSelfClosing||!1,collapseEmptyAttributes:n.collapseEmptyAttributes||!1,allowDangerousHtml:n.allowDangerousHtml||!1,voids:n.voids||qL,characterReferences:n.characterReferences||Z$,closeSelfClosing:n.closeSelfClosing||!1,closeEmptyElements:n.closeEmptyElements||!1},schema:n.space==="svg"?vS:XL,quote:i,alternative:l}.one(Array.isArray(t)?{type:"root",children:t}:t,void 0,void 0)}function n5(t,a,n){return J$(t,a,n,this)}function a5(t){const a=[],n=t&&t.children||e5;let i=-1;for(;++i<n.length;)a[i]=this.one(n[i],i,t);return a.join("")}const s5={};function eg(t){const a=this,{handlers:n,sanitize:i,...l}=t||s5;let c=!1,o;typeof i=="boolean"?c=!i:i&&(o=i),a.compiler=d;function d(h,m){const f=UL(h,{handlers:n,allowDangerousHtml:c}),g=c?f:XF(f,o),y=t5(g,{...l,allowDangerousHtml:c});return m.extname&&(m.extname=".html"),h&&h.type==="root"&&y&&/[^\r\n]/.test(y.charAt(y.length-1))?y+`
`:y}}const i5=({isOpen:t,onClose:a,patientId:n,pharmacyInventory:i,fetchPharmacyOrdersData:l,isLoadingInventory:c=!1})=>{const[o,d]=x.useState([]),[h,m]=x.useState(""),[f,g]=x.useState([]),[y,b]=x.useState(null),[v,w]=x.useState(!1);us(void 0,t?200:99999);const S=x.useMemo(()=>new Da(i,{keys:["name"],threshold:.3}),[i]);x.useEffect(()=>{if(!h){g([]);return}const M=S.search(h).map(A=>A.item);g(M.slice(0,10))},[h,S]);const _=async()=>{if(!n){b("Patient ID is missing.");return}if(o.length===0){b("Please select at least one drug.");return}for(const M of o)if(M.selected_pack_quantity===0&&M.selected_loose_quantity===0){b(`Please specify a quantity for ${M.name}.`);return}w(!0),b(null);try{const M={patient_id:n,items:o.map(P=>({drug_id:P.id,name:P.name,pack_quantity:P.selected_pack_quantity,loose_quantity:P.selected_loose_quantity,pack_price:0,loose_price:0,total_price:0,tabletsPerDay:1,numberOfDays:1,directions_to_use:"As directed"})),order_total:0,prescription_for_unavailable_drugs:""},A=await Z("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(M)});if(!A.ok){const P=await A.json().catch(()=>({}));throw new Error(P.message||`Failed to create pharmacy order: ${A.statusText} `)}await A.json(),l(n),a(),d([]),m("")}catch(M){b(`Order Creation Error: ${M.message} `)}finally{w(!1)}},E=M=>{if(o.some(A=>A.id===M.id)){b(`${M.name} is already in the order.`),setTimeout(()=>b(null),3e3),m(""),g([]);return}d(A=>[...A,{...M,selected_pack_quantity:0,selected_loose_quantity:0}]),m(""),g([])},D=M=>{d(A=>A.filter(P=>P.id!==M))},O=(M,A,P)=>{const Q=parseInt(P)||0;d(G=>G.map(C=>C.id===M?{...C,[A==="pack"?"selected_pack_quantity":"selected_loose_quantity"]:Q}:C))};return t?e.jsx("div",{className:bt.modalOverlay,children:e.jsxs("div",{className:bt.modalContent,children:[e.jsxs("div",{className:bt.modalHeader,children:[e.jsx("h3",{className:bt.modalTitle,children:"Create Pharmacy Order"}),e.jsx("button",{onClick:a,className:bt.modalCloseButton,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:bt.modalBody,children:[y&&e.jsx("div",{className:bt.errorText,children:y}),e.jsxs("div",{className:bt.formGroup,style:{position:"relative"},children:[e.jsx("label",{htmlFor:"drug-search",children:"Add Drug"}),e.jsx("input",{type:"text",id:"drug-search",placeholder:"Search available drugs...",value:h,onChange:M=>m(M.target.value),className:bt.inputField,autoComplete:"off"}),h&&e.jsx("div",{className:bt.searchResultsCard,children:c?e.jsx("div",{className:"p-2 space-y-2",children:[1,2,3].map(M=>e.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"30%",height:20})]},M))}):f.length>0?e.jsx("ul",{className:bt.searchResultsList,children:f.map(M=>e.jsx("li",{onClick:()=>E(M),className:bt.searchResultItem,children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:M.name}),e.jsxs("span",{className:bt.searchResultPrice,children:["Stock: ",M.stock," (Box) / ",M.loose||0," (Loose)"]})]})},M.id))}):e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No drugs found."})})]}),e.jsxs("div",{className:bt.selectedTestsCard,children:[" ",e.jsx("h4",{className:bt.selectedTestsHeader,children:"Selected Drugs"}),o.length===0?e.jsx("p",{className:bt.noTestsMessage,children:"No drugs added yet."}):e.jsx("ul",{className:bt.selectedTestsList,children:o.map(M=>e.jsxs("li",{className:bt.selectedTestItem,style:{flexDirection:"column",alignItems:"flex-start",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[e.jsx("span",{className:bt.selectedTestName,style:{fontWeight:"bold"},children:M.name}),e.jsx("button",{type:"button",onClick:()=>D(String(M.id)),className:bt.removeTestButton,title:"Remove Drug",children:e.jsx(Jt,{size:16})})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",width:"100%"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.75rem",color:"#666"},children:"Packs"}),e.jsx("input",{type:"number",min:"0",className:bt.inputField,style:{padding:"4px 8px"},value:M.selected_pack_quantity||"",onChange:A=>O(M.id,"pack",A.target.value),placeholder:"0"})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"0.75rem",color:"#666"},children:"Loose"}),e.jsx("input",{type:"number",min:"0",className:bt.inputField,style:{padding:"4px 8px"},value:M.selected_loose_quantity||"",onChange:A=>O(M.id,"loose",A.target.value),placeholder:"0"})]})]})]},M.id))})]})]}),e.jsxs("div",{className:bt.modalFooter,children:[e.jsx("button",{type:"button",onClick:a,className:`${bt.button} ${bt.buttonSecondary} `,children:" Cancel "}),e.jsxs("button",{type:"button",onClick:_,disabled:o.length===0||v,className:`${bt.button} ${bt.buttonPrimary} ${o.length===0||v?bt.buttonDisabled:""} `,children:[" ",v?"Creating...":"Create Order"," "]})]})]})}):null},_S=({isOpen:t,onClose:a,onSuccess:n,medication:i,initialPatient:l,initialItems:c})=>{const[o,d]=x.useState(""),[h,m]=x.useState([]),[f,g]=x.useState(null),[y,b]=x.useState(!1);us(void 0,t?200:99999),x.useEffect(()=>{if(t&&i){w([{id:Date.now(),medication_name:i.medicationName,drug_id:null,quantity:i.quantity,tablets_per_day:i.tabletsPerDay||1,number_of_days:i.numberOfDays||30,directions:i.directions||"",notes:i.notes||""}]),_(i.frequencyDays);try{const de=new Date(i.nextDeliveryDate);isNaN(de.getTime())||D(de.toISOString().split("T")[0])}catch(de){console.error("Error parsing date",de)}g({id:i.patientId,name:i.patientName,phone:i.patientPhone,patient_token_number:i.patientToken})}else t&&(l||c)?(c&&c.length>0&&w(c),l&&g(l)):t&&!i&&!c&&(w([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),_(30),D(""),g(null),d(""))},[t,i,l,c]);const[v,w]=x.useState([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),[S,_]=x.useState(30),[E,D]=x.useState(""),[O,M]=x.useState(null),[A,P]=x.useState(""),[Q,G]=x.useState([]),[C,R]=x.useState(!1),[z,F]=x.useState(!1),[J,H]=x.useState(null),I=x.useRef(null),V=x.useRef(null);x.useEffect(()=>{if(t){const de=new Date;de.setDate(de.getDate()+30),D(de.toISOString().split("T")[0])}},[t]);const re=x.useCallback(async de=>{if(!de.trim()){m([]);return}b(!0);try{const Se=await Z(`/api/patients?search=${encodeURIComponent(de)}&limit=10`);if(Se.ok){const ee=await Se.json();m(ee.patients||[])}}catch(Se){console.error("Error searching patients:",Se)}finally{b(!1)}},[]);x.useEffect(()=>{I.current&&clearTimeout(I.current),o&&!f?I.current=setTimeout(()=>re(o),300):m([])},[o,f,re]);const B=x.useCallback(async de=>{if(!de.trim()){G([]);return}R(!0);try{const Se=await Z(`/api/drugs?search=${encodeURIComponent(de)}&limit=10`);if(Se.ok){const ee=await Se.json();G(ee.drugs||[])}}catch(Se){console.error("Error searching drugs:",Se)}finally{R(!1)}},[]);x.useEffect(()=>{V.current&&clearTimeout(V.current),A&&O!==null?V.current=setTimeout(()=>B(A),300):G([])},[A,O,B]);const k=de=>{if(!de)return 1;const Se=de.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return Se?parseInt(Se[1],10):1},Ne=de=>{g(de),d(`${de.name} (${de.patient_token_number})`),m([])},Ae=(de,Se)=>{const ee=[...v];ee[Se]={...ee[Se],medication_name:de.name,drug_id:de.id,pack_size:k(de.pack),packs:0,loose:0,quantity:0},w(ee),M(null),P(""),G([])},T=(de,Se,ee)=>{const oe=[...v],fe={...oe[de]},ge=fe.pack_size||1;if(Se==="packs"||Se==="loose"){const q=parseInt(ee)||0;Se==="packs"&&(fe.packs=q),Se==="loose"&&(fe.loose=q);const W=fe.packs||0,Y=fe.loose||0;fe.quantity=W*ge+Y}else if(Se==="tablets_per_day"||Se==="number_of_days"){Se==="tablets_per_day"&&(fe.tablets_per_day=ee),Se==="number_of_days"&&(fe.number_of_days=ee);const q=parseFloat(fe.tablets_per_day.toString())||0,W=parseInt(fe.number_of_days.toString())||0,Y=Math.ceil(q*W);fe.quantity=Y,fe.packs=Math.floor(Y/ge),fe.loose=Y%ge}else fe[Se]=ee;oe[de]=fe,w(oe)},Ce=()=>{w([...v,{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:S,directions:"",notes:"",packs:0,loose:0,pack_size:1}])},Ue=de=>{v.length>1&&w(v.filter((Se,ee)=>ee!==de))},Pe=async de=>{if(de.preventDefault(),H(null),!f){H("Please select a patient.");return}if(v.some(ee=>!ee.medication_name||ee.quantity<=0)){H("Please ensure all items have a medication name and valid quantity.");return}F(!0);try{const ee={patient_id:f.id,items:v.map(fe=>({medication_name:fe.medication_name,drug_id:fe.drug_id,quantity:fe.quantity,tablets_per_day:fe.tablets_per_day,number_of_days:fe.number_of_days,directions:fe.directions,notes:fe.notes,frequency_days:S,next_delivery_date:E}))},oe=await Z("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ee)});if(!oe.ok){const fe=await oe.json();throw new Error(fe.message+(fe.error?": "+fe.error:"")||"Failed to create recurring medication.")}n(),a(),g(null),d(""),w([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:""}]),_(30)}catch(ee){H(ee.message)}finally{F(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"800px",width:"95%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Recurring Medication Order"}),e.jsx("button",{className:"close-btn",onClick:a,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[J&&e.jsx("div",{className:"error-message",children:J}),e.jsxs("form",{onSubmit:Pe,className:"recurring-form",children:[e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:2},children:[e.jsxs("label",{children:[e.jsx(Rn,{size:16})," Patient"]}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search patient...",value:o,onChange:de=>{d(de.target.value),g(null)},className:f?"selected":"unselected"}),y&&e.jsx("span",{className:"spinner",children:"..."}),o&&!f&&h.length>0&&e.jsx("ul",{className:"suggestions-list",children:h.map(de=>e.jsxs("li",{onClick:()=>Ne(de),children:[e.jsx("div",{className:"suggestion-name",children:de.name}),e.jsxs("div",{className:"suggestion-details",children:[de.phone,"  ",de.patient_token_number]})]},de.id))})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(sx,{size:16})," Frequency"]}),e.jsxs("select",{value:S,onChange:de=>{const Se=parseInt(de.target.value);_(Se);const ee=new Date;ee.setDate(ee.getDate()+Se),D(ee.toISOString().split("T")[0]);const oe=v.map(fe=>({...fe,number_of_days:Se}));w(oe)},children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pa,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:E,onChange:de=>D(de.target.value)})]})]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"items-header",children:[e.jsx("h4",{children:"Medications"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:Ce,children:[e.jsx(bn,{size:14})," Add Drug"]})]}),e.jsx("div",{className:"items-list",children:v.map((de,Se)=>e.jsxs("div",{className:"medication-item-row",children:[e.jsxs("div",{className:"row-top",children:[e.jsxs("div",{className:"form-group med-search-group",children:[e.jsx("label",{children:"Drug Name"}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search drug...",value:O===Se?A:de.medication_name,onFocus:()=>{M(Se),P(de.medication_name)},onChange:ee=>{P(ee.target.value),T(Se,"medication_name",ee.target.value)}}),O===Se&&C&&e.jsx("span",{className:"spinner",children:"..."}),O===Se&&A&&Q.length>0&&e.jsx("ul",{className:"suggestions-list",children:Q.map(ee=>e.jsxs("li",{onClick:()=>Ae(ee,Se),children:[e.jsx("div",{className:"suggestion-name",children:ee.name}),e.jsxs("div",{className:"suggestion-details",children:["Stock: ",ee.stock]})]},ee.id))})]})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:de.tablets_per_day,onChange:ee=>T(Se,"tablets_per_day",ee.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:de.number_of_days,onChange:ee=>T(Se,"number_of_days",ee.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Packs"}),e.jsx("input",{type:"number",min:"0",value:de.packs||"",onChange:ee=>T(Se,"packs",ee.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Loose"}),e.jsx("input",{type:"number",min:"0",value:de.loose||"",onChange:ee=>T(Se,"loose",ee.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Total"}),e.jsx("input",{type:"number",value:de.quantity,disabled:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>Ue(Se),disabled:v.length===1,children:e.jsx(Jt,{size:16})})]}),e.jsxs("div",{className:"row-bottom",children:[e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Directions (e.g. 1-0-1 after food)",value:de.directions,onChange:ee=>T(Se,"directions",ee.target.value)})}),e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Notes",value:de.notes,onChange:ee=>T(Se,"notes",ee.target.value)})})]})]},de.id))}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:z,children:z?"Creating...":"Create Recurring Order"})]})]})]})]})}):null},r5=({isOpen:t,onClose:a,onSuccess:n,patientId:i,initialItems:l})=>{const[c,o]=x.useState([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]),[d,h]=x.useState(30),[m,f]=x.useState(""),[g,y]=x.useState(null),[b,v]=x.useState(""),[w,S]=x.useState([]),[_,E]=x.useState(!1),[D,O]=x.useState(!1),[M,A]=x.useState(null),P=x.useRef(null);x.useEffect(()=>{if(t){l&&l.length>0?o(l):o([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]);const H=new Date;H.setDate(H.getDate()+30),f(H.toISOString().split("T")[0]),h(30)}},[t,l]);const Q=x.useCallback(async H=>{if(!H.trim()){S([]);return}E(!0);try{const I=await Z(`/api/drugs?search=${encodeURIComponent(H)}&limit=10`);if(I.ok){const V=await I.json();S(V.drugs||[])}}catch(I){console.error("Error searching drugs:",I)}finally{E(!1)}},[]);x.useEffect(()=>{P.current&&clearTimeout(P.current),b&&g!==null?P.current=setTimeout(()=>Q(b),300):S([])},[b,g,Q]);const G=H=>{if(!H)return 1;const I=H.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return I?parseInt(I[1],10):1},C=(H,I)=>{const V=[...c];V[I]={...V[I],medication_name:H.name,drug_id:H.id,pack_size:G(H.pack),packs:0,loose:0,quantity:0},o(V),y(null),v(""),S([])},R=(H,I,V)=>{const re=[...c],B={...re[H]},k=B.pack_size||1;if(I==="packs"||I==="loose"){const Ne=parseInt(V)||0;I==="packs"&&(B.packs=Ne),I==="loose"&&(B.loose=Ne);const Ae=B.packs||0,T=B.loose||0;B.quantity=Ae*k+T}else if(I==="tablets_per_day"||I==="number_of_days"){I==="tablets_per_day"&&(B.tablets_per_day=V),I==="number_of_days"&&(B.number_of_days=V);const Ne=parseFloat(B.tablets_per_day.toString())||0,Ae=parseInt(B.number_of_days.toString())||0,T=Math.ceil(Ne*Ae);B.quantity=T,B.packs=Math.floor(T/k),B.loose=T%k}else B[I]=V;re[H]=B,o(re)},z=()=>{o([...c,{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:d,directions:"",notes:"",packs:0,loose:0,pack_size:1}])},F=H=>{c.length>1&&o(c.filter((I,V)=>V!==H))},J=async H=>{if(H.preventDefault(),A(null),!i){A("Patient ID is missing.");return}if(c.some(V=>!V.medication_name||V.quantity<=0)){A("Please ensure all items have a medication name and valid quantity.");return}O(!0);try{const V={patient_id:i,items:c.map(B=>({medication_name:B.medication_name,drug_id:B.drug_id,quantity:B.quantity,tablets_per_day:B.tablets_per_day,number_of_days:B.number_of_days,directions:B.directions,notes:B.notes,frequency_days:d,next_delivery_date:m}))},re=await Z("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(V)});if(!re.ok){const B=await re.json();throw new Error(B.message+(B.error?": "+B.error:"")||"Failed to create recurring medication.")}n(),a()}catch(V){A(V.message)}finally{O(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"800px",width:"95%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Add Recurring Medications"}),e.jsx("button",{className:"close-btn",onClick:a,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[M&&e.jsx("div",{className:"error-message",children:M}),e.jsxs("form",{onSubmit:J,className:"recurring-form",children:[e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(sx,{size:16})," Frequency"]}),e.jsxs("select",{value:d,onChange:H=>{const I=parseInt(H.target.value);h(I);const V=new Date;V.setDate(V.getDate()+I),f(V.toISOString().split("T")[0]);const re=c.map(B=>({...B,number_of_days:I}));o(re)},children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pa,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:m,onChange:H=>f(H.target.value)})]})]}),e.jsx("hr",{className:"divider"}),e.jsxs("div",{className:"items-header",children:[e.jsx("h4",{children:"Medications"}),e.jsxs("button",{type:"button",className:"add-item-btn",onClick:z,children:[e.jsx(bn,{size:14})," Add Drug"]})]}),e.jsx("div",{className:"items-list",children:c.map((H,I)=>e.jsxs("div",{className:"medication-item-row",children:[e.jsxs("div",{className:"row-top",children:[e.jsxs("div",{className:"form-group med-search-group",children:[e.jsx("label",{children:"Drug Name"}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search drug...",value:g===I?b:H.medication_name,onFocus:()=>{y(I),v(H.medication_name)},onChange:V=>{v(V.target.value),R(I,"medication_name",V.target.value)}}),g===I&&_&&e.jsx("span",{className:"spinner",children:"..."}),g===I&&b&&w.length>0&&e.jsx("ul",{className:"suggestions-list",children:w.map(V=>e.jsxs("li",{onClick:()=>C(V,I),children:[e.jsx("div",{className:"suggestion-name",children:V.name}),e.jsxs("div",{className:"suggestion-details",children:["Stock: ",V.stock]})]},V.id))})]})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:H.tablets_per_day,onChange:V=>R(I,"tablets_per_day",V.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:H.number_of_days,onChange:V=>R(I,"number_of_days",V.target.value)})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Packs"}),e.jsx("input",{type:"number",min:"0",value:H.packs||"",onChange:V=>R(I,"packs",V.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Loose"}),e.jsx("input",{type:"number",min:"0",value:H.loose||"",onChange:V=>R(I,"loose",V.target.value),placeholder:"0"})]}),e.jsxs("div",{className:"form-group small-input",children:[e.jsx("label",{children:"Total"}),e.jsx("input",{type:"number",value:H.quantity,disabled:!0,style:{backgroundColor:"#f5f5f5",cursor:"not-allowed"}})]}),e.jsx("button",{type:"button",className:"remove-btn",onClick:()=>F(I),disabled:c.length===1,children:e.jsx(Jt,{size:16})})]}),e.jsxs("div",{className:"row-bottom",children:[e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Directions (e.g. 1-0-1 after food)",value:H.directions,onChange:V=>R(I,"directions",V.target.value)})}),e.jsx("div",{className:"form-group",style:{flex:1},children:e.jsx("input",{type:"text",placeholder:"Notes",value:H.notes,onChange:V=>R(I,"notes",V.target.value)})})]})]},H.id))}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:D,children:D?"Creating...":"Create Recurring Order"})]})]})]})]})}):null},l5=({isOpen:t,onClose:a,onSuccess:n,medication:i})=>{const[l,c]=x.useState(""),[o,d]=x.useState(0),[h,m]=x.useState(1),[f,g]=x.useState(30),[y,b]=x.useState(""),[v,w]=x.useState(""),[S,_]=x.useState(30),[E,D]=x.useState(""),[O,M]=x.useState("active"),[A,P]=x.useState(!1),[Q,G]=x.useState(null);x.useEffect(()=>{if(t&&i){c(i.medicationName),d(i.quantity),m(i.tabletsPerDay||1),g(i.numberOfDays||30),b(i.directions||""),w(i.notes||""),_(i.frequencyDays),M(i.status);try{const z=new Date(i.nextDeliveryDate);isNaN(z.getTime())||D(z.toISOString().split("T")[0])}catch(z){console.error("Error parsing date",z)}}},[t,i]);const C=async z=>{if(z.preventDefault(),G(null),!l||o<=0){G("Please provide a valid medication name and quantity.");return}P(!0);try{const F={medication_name:l,quantity:o,tablets_per_day:h,number_of_days:f,directions:y,notes:v,frequency_days:S,next_delivery_date:E,status:O},J=await Z(`/api/recurring-medications/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(F)});if(!J.ok){const H=await J.json();throw new Error(H.message||"Failed to update recurring medication.")}n(),a()}catch(F){G(F.message)}finally{P(!1)}},R=async()=>{if(window.confirm("Are you sure you want to delete this recurring medication?")){P(!0);try{if(!(await Z(`/api/recurring-medications/${i.id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete recurring medication.");n(),a()}catch(z){G(z.message)}finally{P(!1)}}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"add-recurring-modal",style:{maxWidth:"600px",width:"90%"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h3",{children:"Edit Recurring Medication"}),e.jsx("button",{className:"close-btn",onClick:a,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[Q&&e.jsx("div",{className:"error-message",children:Q}),e.jsxs("form",{onSubmit:C,className:"recurring-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Medication Name"}),e.jsx("input",{type:"text",value:l,onChange:z=>c(z.target.value)})]}),e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(sx,{size:16})," Frequency"]}),e.jsxs("select",{value:S,onChange:z=>_(parseInt(z.target.value)),children:[e.jsx("option",{value:15,children:"Every 15 Days"}),e.jsx("option",{value:30,children:"Every 30 Days"}),e.jsx("option",{value:60,children:"Every 60 Days"}),e.jsx("option",{value:90,children:"Every 90 Days"})]})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsxs("label",{children:[e.jsx(pa,{size:16})," Next Delivery"]}),e.jsx("input",{type:"date",value:E,onChange:z=>D(z.target.value)})]})]}),e.jsxs("div",{className:"order-settings-row",children:[e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Tabs/Day"}),e.jsx("input",{type:"number",min:"0.5",step:"0.5",value:h,onChange:z=>m(parseFloat(z.target.value))})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"number",min:"1",value:f,onChange:z=>g(parseInt(z.target.value))})]}),e.jsxs("div",{className:"form-group",style:{flex:1},children:[e.jsx("label",{children:"Total Qty"}),e.jsx("input",{type:"number",min:"1",value:o,onChange:z=>d(parseInt(z.target.value))})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Directions"}),e.jsx("input",{type:"text",value:y,onChange:z=>b(z.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Notes"}),e.jsx("input",{type:"text",value:v,onChange:z=>w(z.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{value:O,onChange:z=>M(z.target.value),children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"paused",children:"Paused"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"modal-actions",style:{justifyContent:"space-between"},children:[e.jsxs("button",{type:"button",className:"btn-cancel text-red-600 hover:bg-red-50",onClick:R,style:{color:"#dc3545"},children:[e.jsx(Jt,{size:16,style:{marginRight:"5px"}})," Delete"]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{type:"button",className:"btn-cancel",onClick:a,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:A,children:A?"Saving...":"Save Changes"})]})]})]})]})]})}):null},o5=({messages:t})=>{const a=x.useRef(null);return x.useEffect(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[t]),e.jsxs("div",{className:"conversation-panel",children:[e.jsxs("div",{className:"conversation-header",children:[e.jsx("div",{className:"conversation-title",children:e.jsx("h3",{children:"Conversation"})}),e.jsxs("span",{className:"conversation-count",children:[t.length," messages"]})]}),e.jsxs("div",{ref:a,className:"message-list custom-scrollbar",children:[t.length===0&&e.jsx("div",{className:"empty-state",children:"Start talking to the AI..."}),t.map(n=>e.jsxs("div",{className:`message-wrapper ${n.role}`,children:[e.jsx("div",{className:`message-bubble ${n.role} ${n.role==="system"?n.type||"info":""}`,children:n.role==="ai"||n.role==="system"&&n.type==="loading"?e.jsx("div",{className:"prose prose-sm max-w-none",children:n.role==="system"&&n.type==="loading"?e.jsxs("div",{className:"typing-indicator",children:[e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"}),e.jsx("span",{className:"dot"})]}):e.jsx(qa,{remarkPlugins:[Wn],children:n.content})}):e.jsx("div",{className:"whitespace-pre-wrap",children:n.content})}),n.role!=="system"&&e.jsx("span",{className:"message-timestamp",children:n.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},n.id))]})]})},tg=t=>{if(!t)return"";const a=new Date(t);if(isNaN(a.getTime()))return"";const n=a.getTimezoneOffset()*6e4;return new Date(a.getTime()-n).toISOString().slice(0,16)},n1=()=>{var Yr,oa;const{openCommandBar:t}=qo(),{recordId:a,patientId:n}=Fn(),[i,l]=x.useState(a||void 0),c=ft(),o=Qa(),[d,h]=x.useState(""),[m]=x.useState([]),[f,g]=x.useState(null),[y,b]=x.useState(null),[v,w]=x.useState(void 0),[S,_]=x.useState(void 0),[E,D]=x.useState(null),[O,M]=x.useState(!1),[A,P]=x.useState(""),[Q,G]=x.useState(!1),[C,R]=x.useState(null),[z,F]=x.useState(null),[J,H]=x.useState(!1),[I,V]=x.useState(!1),[re,B]=x.useState(null),[k,Ne]=x.useState(""),[Ae,T]=x.useState(""),[Ce,Ue]=x.useState(null),[Pe,de]=x.useState(!1),[Se,ee]=x.useState(!1),[oe,fe]=x.useState(!1),[ge,q]=x.useState(!1),[W,Y]=x.useState(window.innerHeight),[ie,ce]=x.useState([]),[pe,He]=x.useState(!1),[We,st]=x.useState(null),[me,ve]=x.useState([]),[Fe,Ee]=x.useState([]),[L,ne]=x.useState([]),[xe,ae]=x.useState(!1),[we,Le]=x.useState(null),Je=x.useRef(null),ot=x.useRef(null),xt=x.useRef(!1),be=x.useRef(null),ue=x.useRef(null),je=x.useRef(null),ke=x.useRef(null),Me=x.useRef(null),De=x.useRef(null),qe=x.useRef(null),[te,Re]=x.useState([]),[lt,Xe]=x.useState(!1);x.useEffect(()=>{(async()=>{if(te.length>0&&!lt){Xe(!0);const le=te[0];le.current&&(le.current.scrollIntoView({behavior:"smooth",block:"center"}),le.current.classList.add("ai-glow"),await new Promise(se=>setTimeout(se,2e3)),le.current&&le.current.classList.remove("ai-glow")),Re(se=>se.slice(1)),Xe(!1)}})()},[te,lt]);const dt=K=>{let le=null;switch(K){case"update_patient_details":le=je;break;case"create_pharmacy_order":case"edit_pharmacy_order":le=ke;break;case"create_lab_order":case"edit_lab_order":le=Me;break;case"add_complaint_history":le=De;break;case"update_case_summary":le=qe;break}le&&Re(se=>[...se,le])},[jt,At]=x.useState(55),[Ye,it]=x.useState(!1),Ze=x.useRef(null),ht=x.useRef(null),ct=x.useRef(null),ut=x.useRef(null),Kt=150,[ea,ta]=x.useState([]),[On,Ds]=x.useState([]),[gn,Aa]=x.useState(!0),[Ya,Ja]=x.useState(null),[jn,Hu]=x.useState(!1),[Vu,ei]=x.useState(!1),[Ei,gm]=x.useState(!1),[Gu,Qu]=x.useState(!1),[xm,Sl]=x.useState(!1),[Ti,Dn]=x.useState([]),[ti,Ko]=x.useState(!1),[ni,kl]=x.useState(null),[Pr,Wo]=x.useState(!1),[Xo,na]=x.useState(null),[Rr,ym]=x.useState({}),[Cl,Zo]=x.useState(!1),[Or,Yu]=x.useState(!1),[aa,_l]=x.useState(!1),[ec,Ai]=x.useState(!1),[ai,Dl]=x.useState(!1),[tc,Ka]=x.useState([]),[nc,Ir]=x.useState(void 0),[Wa,El]=x.useState(!1),[ac,Ju]=x.useState(!1),[Pi,Tl]=x.useState(!1),[zr,si]=x.useState(!1),[Es,sc]=x.useState(!1),[Ri,Oi]=x.useState(!1),Ts=x.useMemo(()=>(y==null?void 0:y.admission_date)&&!(y!=null&&y.discharge_date),[y]),[Xa,Ii]=x.useState(!1),[Fr,Za]=x.useState(null),[Lr,zi]=x.useState(""),[Al,Fi]=x.useState(void 0),[Li,Pl]=x.useState(void 0),[$n,ds]=x.useState(void 0),[fa,ii]=x.useState(!1),[Ku,hs]=x.useState(null),[ic,ri]=x.useState(null),[Rl,Ol]=x.useState(null),[bm,$r]=x.useState(null),[As,Ps]=x.useState(""),[Il,zl]=x.useState(!1),[Mr,jm]=x.useState(!1),Fl=x.useRef(null),[rc,lc]=x.useState(null),[Wu,Br]=x.useState([]),Xu=x.useCallback(K=>{Br(le=>[...le,{id:Math.random().toString(36).substr(2,9),timestamp:new Date,role:"system",content:"",...K}])},[]),[Ur,Zu]=x.useState(null),Ll=x.useRef(null),$l=x.useRef(null),[ed,oc]=x.useState(!1),[cc,td]=x.useState(!1),[uc,dc]=x.useState(null),[Xt,hc]=x.useState(null),[Ml,mc]=x.useState(""),[li,ms]=x.useState(""),[nd,pc]=x.useState(!0),[oi,fc]=x.useState(!1),[Bl,qr]=x.useState(!1),[Pa,ad]=x.useState(!1),[vm,sd]=x.useState(!1),$i=x.useRef(null),id=async()=>{$i.current&&(await $i.current.undoLastAction(),sd(!1))},es=async K=>{try{const le=await Z(`/api/patients/${K}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`Failed to fetch patient details: ${le.status}`)}const se=await le.json();if(b(se),w(se.age),_(se.gender),Ne(se.ai_response||""),b(_e=>_e?{..._e,current_status:se.current_status,admission_date:se.admission_date,discharge_date:se.discharge_date}:{...se,current_status:se.current_status,admission_date:se.admission_date,discharge_date:se.discharge_date}),se.insurance_type&&b(_e=>_e?{..._e,insurance_type:se.insurance_type}:{...se}),Vr(K),se.ai_response){const _e=/```json\s*([\s\S]*?)\s*```/,Oe=se.ai_response.match(_e);if(Oe&&Oe[1])T(se.ai_response.replace(_e,"").trim()),Ue(Oe[1].trim());else{const rt=se.ai_response.trim();if(rt.startsWith("{")&&rt.endsWith("}"))try{JSON.parse(rt),T(""),Ue(rt)}catch{T(rt),Ue(null)}else if(rt.startsWith("[")&&rt.endsWith("]"))try{JSON.parse(rt),T(""),Ue(rt)}catch{T(rt),Ue(null)}else T(rt),Ue(null)}}else T(""),Ue(null)}catch{b(null),Ne(""),T(""),Ue(null)}},Hr=async(K,le)=>{b(se=>se?{...se,insurance_type:le}:null);try{const se=await Z(`/api/patients/${K}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:le})});if(!se.ok){const _e=await se.json();throw new Error(_e.message||"Failed to update insurance type")}}catch(se){console.error("Error updating insurance type:",se),K&&es(K)}},rd=async K=>{ae(!0),Le(null),ne([]);try{const le=await Z(`/api/queue/patient/${K}/complaints`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();ne(se||[])}catch(le){Le(`Past complaints error: ${le.message}`)}finally{ae(!1)}},ps=async K=>{ve([]);try{const le=await Z(`/api/pharmacy-orders/patient/${K}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();ve(se||[])}catch{}},ci=async K=>{Ko(!0),kl(null),Dn([]);try{const le=await Z(`/api/lab/orders/patient/${K}`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`HTTP error! status: ${le.status}`)}const se=await le.json();Dn(se||[])}catch(le){kl(`Pending labs error: ${le.message}`)}finally{Ko(!1)}},Mi=async K=>{He(!0),st(null),ce([]);try{const le=await Z(`/api/lab/patient/${K}`);if(!le.ok){const Oe=await le.json().catch(()=>({}));throw new Error(Oe.message||`HTTP error! status: ${le.status}`)}const _e=(await le.json()||[]).map(Oe=>({...Oe.report,id:Oe.id,patient_id:Oe.patient_id,createdAt:Oe.createdAt,tests:Oe.tests,status:Oe.status}));ce(_e)}catch(le){st(`Lab reports error: ${le.message}`)}finally{He(!1)}},ui=async K=>{fe(!0);try{const le=await Z(`/api/patients/${K}/context`);if(!le.ok){console.error("Failed to fetch patient context");return}const se=await le.json();if(b(se.patient),w(se.patient.age),_(se.patient.gender),Ne(se.patient.ai_response||""),se.patient.ai_response){const _e=/```json\s*([\s\S]*?)\s*```/,Oe=se.patient.ai_response.match(_e);if(Oe&&Oe[1])T(se.patient.ai_response.replace(_e,"").trim()),Ue(Oe[1].trim());else{const rt=se.patient.ai_response.trim();if(rt.startsWith("{")&&rt.endsWith("}"))try{JSON.parse(rt),T(""),Ue(rt)}catch{T(rt),Ue(null)}else if(rt.startsWith("[")&&rt.endsWith("]"))try{JSON.parse(rt),T(""),Ue(rt)}catch{T(rt),Ue(null)}else T(rt),Ue(null)}}else T(""),Ue(null);if(Oi(se.patient.current_status==="In Doctor Queue"||se.patient.current_status==="In Consultation"),ne(Array.isArray(se.history)?se.history:[]),ve(Array.isArray(se.pharmacyOrders)?se.pharmacyOrders:[]),Array.isArray(se.labOrders)){const _e=se.labOrders,Oe=_e.filter(gt=>!gt.report);Dn(Oe);const rt=_e.filter(gt=>gt.report).map(gt=>({...gt.report,id:gt.id,patient_id:gt.patient_id,createdAt:gt.createdAt,tests:gt.tests}));ce(rt),ce(rt)}else Dn([]),ce([]);Array.isArray(se.recurringMedications)?Ee(se.recurringMedications):Ee([])}catch(le){console.error("Error fetching patient context:",le)}finally{fe(!1)}};x.useEffect(()=>{(async()=>{if(f)try{const le=await Z(`/api/patient-debts/${f}/balance`);if(le.ok){const se=await le.json();dc(se.netDebt||0)}else dc(0)}catch(le){console.error("Error fetching patient debt:",le),dc(0)}})()},[f]);const Vr=async K=>{try{const le=await Z(`/api/queue/patient/${K}/latest`);if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||`Failed to fetch queue status: ${le.status}`)}const se=await le.json();if(se){const _e=new Date(se.createdAt),Oe=new Date,rt=_e.getDate()===Oe.getDate()&&_e.getMonth()===Oe.getMonth()&&_e.getFullYear()===Oe.getFullYear(),gt=["waiting","consulting"].includes(se.status);Oi(rt&&gt)}else Oi(!1)}catch(le){console.error("Error checking patient queue status:",le),Oi(!1)}},gc=async(K,le)=>{try{if(!(await Z(`/api/pharmacy-orders/${K}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:le})})).ok)throw new Error("Failed to update pharmacy order date");f&&ps(f)}catch(se){console.error("Error updating pharmacy order date:",se),B("Failed to update pharmacy order date")}},Gr=async(K,le,se)=>{try{const _e={};if(le==="order"?_e.date=se:le==="report"&&(_e.reportDate=se),!(await Z(`/api/lab/orders/${K}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)})).ok)throw new Error("Failed to update lab date");f&&(ci(f),Mi(f))}catch(_e){console.error("Error updating lab order date:",_e),B("Failed to update lab order date")}},xc=K=>{c(`/dashboard/edit-pharmacy-order/${K}`)},Nm=K=>{const le=K.medications.map((se,_e)=>({id:Date.now()+_e,medication_name:se.name,drug_id:se.drug_id?String(se.drug_id):null,quantity:(se.pack_quantity||0)*(se.pack_size||1)+(se.loose_quantity||0),tablets_per_day:se.tabletsPerDay||1,number_of_days:se.numberOfDays||30,directions:se.directions_to_use||"",notes:"",packs:se.pack_quantity,loose:se.loose_quantity,pack_size:se.pack_size}));Ka(le),Ai(!0)},wm=K=>{B(null),console.log(`Preparing billing navigation for order: ${K}`);const le=me.find(se=>se.id===K);if(le){const se=le.medications.map(_e=>{const Oe=_e.price??0;return(_e.price===void 0||_e.price===null)&&console.warn(`Medication "${_e.name}" in order ${K} is missing a price. Defaulting to 0.`),{name:_e.name,pack_quantity:_e.pack_quantity,loose_quantity:_e.loose_quantity,price:Oe,pack_price:_e.pack_price,loose_price:_e.loose_price,total_price:Number(_e.total_price)||0,isLoose:_e.isLoose,unit:_e.unit,drug_id:_e.drug_id?String(_e.drug_id):null,tabletsPerDay:_e.tabletsPerDay,numberOfDays:_e.numberOfDays,directions_to_use:_e.directions_to_use,discount_percentage:_e.discount_percentage??0,batch:_e.batch,expiry_date:_e.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:se}),c(`/dashboard/pharmacy-billing/${K}`,{state:{initialItems:se}})}else console.error(`Order with ID ${K} not found.`),B(`Order with ID ${K} not found.`),alert(`Error: Could not find order ${K} to bill.`)},Sm=async(K,le)=>{B(null);const se=me.find(Oe=>Oe.id===K);if(!se){B(`Order with ID ${K} not found.`);return}const _e={status:le,medications:se.medications};try{const Oe=await Z(`/api/pharmacy-orders/${K}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!Oe.ok){const gt=await Oe.text();throw new Error(`Failed to update status: ${Oe.statusText} (${Oe.status}) - ${gt}`)}const rt=await Oe.json();ve(gt=>gt.map(Ht=>Ht.id===rt.id?{...Ht,status:rt.status}:Ht)),f&&ps(f)}catch(Oe){console.error("Failed to update order status:",Oe),B(Oe.message||`Failed to update status for order ${K}.`),alert(`Error updating status for order ${K}: ${Oe.message||"Please try again."}`)}},ld=K=>{Dn(le=>le.map(se=>se.id===K?{...se,isEditing:!0,editedTests:[...se.tests],editedStatus:se.status}:{...se,isEditing:!1}))},km=K=>{Dn(le=>le.map(se=>se.id===K?{...se,isEditing:!1,editedTests:void 0,editedStatus:void 0}:se))},sa=(K,le,se,_e)=>{Dn(Oe=>Oe.map(rt=>{if(rt.id===K){const gt=rt.editedTests?[...rt.editedTests]:[...rt.tests];if(se==="add")return{...rt,editedTests:[...gt,{id:"",name:"",price:0}]};if(se==="remove")return{...rt,editedTests:_e};if(le!==-1){const Ht={...gt[le],[se]:_e};return gt[le]=Ht,{...rt,editedTests:gt}}}return rt}))},Qr=(K,le)=>{Dn(se=>se.map(_e=>_e.id===K?{..._e,editedStatus:le}:_e))},od=async K=>{if(!K){console.error("Cannot navigate to billing: Lab Order data is missing."),alert("Could not open billing page: Lab Order information is missing.");return}c(`/dashboard/lab-billing/${K.id}`)},cd=async(K,le)=>{console.log(`Updating lab order ${K} to status ${le}`);try{const se=await Z(`/api/lab/${K}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:le})});if(!se.ok){const _e=await se.json();throw new Error(_e.message||`Failed to update lab order status: ${se.status}`)}f&&(ci(f),Mi(f)),console.log(`Lab Order ${K} status updated to ${le}, refetching data.`)}catch(se){console.error("Error updating lab order status:",se),alert(`Failed to update lab order status: ${se instanceof Error?se.message:"Unknown error"}`)}},Ul=K=>{K&&K.id?c(`/lab/report/${K.id}`):(console.error("Cannot navigate: Lab Order or Lab Order ID is missing."),alert("Could not open the report entry page: Lab Order information is missing."))},ud=async(K,le,se)=>{El(!0),B(null);try{if(!le||le.length===0)throw new Error("Lab order must have at least one test.");for(const rt of le)if(!rt.id||!rt.name||isNaN(rt.price)||rt.price<0)throw new Error(`Invalid test data: ${JSON.stringify(rt)}. Each test must have id, name, and a valid price.`);const _e={tests:le,status:se},Oe=await Z(`/api/lab/orders/${K}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(_e)});if(!Oe.ok){const rt=await Oe.json().catch(()=>({}));throw new Error(rt.message||`Failed to update lab order: ${Oe.statusText}`)}f&&ci(f),Dn(rt=>rt.map(gt=>gt.id===K?{...gt,isEditing:!1,editedTests:void 0,editedStatus:void 0}:gt))}catch(_e){B(`Lab Order Save Error: ${_e.message}`)}finally{El(!1)}},di=async K=>{if(!window.confirm(`Are you sure you want to delete this ${K.type.toLowerCase()} record? This action cannot be undone.`))return;Wo(!0),na(null);let se=null,_e;const Oe=K.type;try{switch(Oe){case"Complaint":if(_e=K.data.id,!_e)throw new Error("Complaint ID is missing.");se=`/api/patients/complaints/${_e}`;break;case"Lab Order":if(_e=K.data.id,!_e)throw new Error("Lab Order ID is missing.");se=`/api/lab/orders/${_e}`;break;case"Lab Report":if(_e=K.data.reportId,!_e)throw new Error("Lab Report ID is missing.");se=`/api/lab/reports/${_e}`;break;case"Pharmacy Order":if(_e=K.data.id,!_e)throw new Error("Pharmacy Order ID is missing.");se=`/api/pharmacy-orders/${_e}`;break;default:throw new Error(`Deletion not supported for item type: ${Oe}`)}if(!se)throw new Error(`Could not determine delete URL for type: ${Oe}`);const rt=await Z(se,{method:"DELETE"});if(!rt.ok){const gt=await rt.json().catch(()=>({}));throw new Error(gt.message||`Failed to delete ${Oe}: ${rt.statusText}`)}f&&(Oe==="Complaint"?rd(f):Oe==="Lab Order"?(ci(f),Mi(f)):Oe==="Lab Report"?Mi(f):Oe==="Pharmacy Order"&&ps(f))}catch(rt){na(`Delete Error (${Oe}): ${rt.message}`),Pr&&Wo(!1)}finally{Wo(!1)}},Cm=async()=>{if(!f)return;if(me.filter(le=>le.status==="pending").length<2){alert("You need at least two pending orders to merge.");return}td(!0);try{const le=await Z(`/api/pharmacy-orders/patient/${f}/merge-pending`,{method:"POST"});if(!le.ok){const se=await le.json().catch(()=>({}));throw new Error(se.message||"Failed to merge orders")}ps(f)}catch(le){B(`Merge Error: ${le.message}`)}finally{td(!1)}},ia=x.useMemo(()=>{if(!f||!L)return[];const K=L.map(le=>({date:new Date(le.createdAt),type:"Complaint",data:le,originalDateString:le.createdAt})).filter(le=>!isNaN(le.date.getTime()));return K.sort((le,se)=>se.date.getTime()-le.date.getTime()),K},[f,L]),ts=x.useMemo(()=>{if(!f)return[];const K=new Map;(Ti??[]).forEach(se=>{K.set(se.id,{...se})}),(ie??[]).forEach(se=>{if(!K.has(se.id))K.set(se.id,{id:se.id,patient_id:se.patient_id,tests:se.tests,status:se.status,createdAt:se.createdAt,report:se});else{const _e=K.get(se.id);_e&&(_e.report=se,_e.status=se.status)}});let le=Array.from(K.values());return le.sort((se,_e)=>new Date(se.createdAt).getTime()-new Date(_e.createdAt).getTime()),le=le.map((se,_e)=>({...se,serialNumber:_e+1})),le.map(se=>({date:new Date(se.createdAt),type:"Lab Order",data:se,originalDateString:se.createdAt}))},[f,Ti,ie]),ra=x.useMemo(()=>{if(!f||!me)return[];const K=me.map(le=>({date:new Date(le.date),type:"Pharmacy Order",data:le,originalDateString:le.date})).filter(le=>!isNaN(le.date.getTime()));return K.sort((le,se)=>se.date.getTime()-le.date.getTime()),K},[f,me]),[ql,yc]=x.useState(null),[Rs,hi]=x.useState([]),[mi,bc]=x.useState(""),Os=(K,le)=>{if(!K||!K.report_content||!le)return"";try{const se=JSON.parse(K.report_content||"{}");if(typeof se!="object"||se===null)return`<p class="italic text-gray-500 text-xs">Report content is not structured data.</p><pre>${K.report_content}</pre>`;let _e="";return le.forEach(Oe=>{se[Oe.id]?(_e+=`<h5 class="font-semibold text-sm mt-2 mb-1">${Oe.name}</h5>`,_e+='<table class="lab-report-print-table"><thead><tr><th>Parameter</th><th>Value</th><th>Normal Range</th></tr></thead><tbody>',Object.entries(se[Oe.id]).map(([rt,gt])=>{var nn;const Ht=(nn=Oe.default_parameters)==null?void 0:nn.find(zt=>zt.name===rt);let _t="N/A";Ht&&Ht.type==="number"&&(Ht.lower_limit!=null||Ht.upper_limit!=null)?(_t="",Ht.lower_limit!=null&&(_t+=` > ${Ht.lower_limit}`),Ht.lower_limit!=null&&Ht.upper_limit!=null&&(_t+=" - "),Ht.upper_limit!=null&&(_t+=` < ${Ht.upper_limit}`),_t=_t.trim()||"N/A"):(Ht==null?void 0:Ht.type)==="boolean"?_t="N/A":Ht!=null&&Ht.normal_range&&(_t=Ht.normal_range),_e+=`<tr><td>${rt}</td><td>${String(gt)} ${(Ht==null?void 0:Ht.unit)||""}</td><td>${_t}</td></tr>`}),_e+="</tbody></table>"):_e+=`<p class="italic text-gray-500 text-xs">No parameters reported for ${Oe.name}.</p>`}),_e}catch{return`<p class="italic text-gray-500 text-xs">Error parsing report content.</p><pre>${K.report_content}</pre>`}};x.useEffect(()=>{const K=()=>{Y(window.innerHeight)};return window.addEventListener("resize",K),K(),()=>window.removeEventListener("resize",K)},[]),x.useEffect(()=>{const K=se=>{if(!Ye||!ut.current||!ct.current)return;const _e=ct.current.getBoundingClientRect(),rt=se.clientX-ut.current.x;let gt=ut.current.initialWidth+rt;const Ht=_e.width-Kt-10;gt=Math.max(Kt,gt),gt=Math.min(gt,Ht);const _t=gt/_e.width*100;At(_t)},le=()=>{it(!1),ut.current=null,document.body.style.cursor="",document.body.style.userSelect=""};return Ye&&(window.addEventListener("mousemove",K),window.addEventListener("mouseup",le),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{window.removeEventListener("mousemove",K),window.removeEventListener("mouseup",le),document.body.style.cursor="",document.body.style.userSelect=""}},[Ye]);const dd=K=>{if(!ct.current)return;K.preventDefault();const le=ct.current.querySelector(".edit-complaint-context-column");le&&(ut.current={x:K.clientX,initialWidth:le.offsetWidth},it(!0))},jc=x.useCallback(async()=>{V(!0),B(null);try{const K=await Z("/api/queue/doctor/new",{method:"POST"});if(!K.ok){const se=await K.json().catch(()=>({}));throw new Error(se.message||`Failed to create record: ${K.statusText}`)}const le=await K.json();if(!le.recordId)throw new Error("New record ID not received from server.");c(`/edit-complaint/${le.recordId}`,{replace:!0})}catch(K){B(`Failed to create new complaint record: ${K.message}`)}finally{V(!1)}},[c]);x.useEffect(()=>{(async()=>{pc(!0);try{const le=await Z("/api/clinics/settings");if(!le.ok){const _e=await le.json().catch(()=>({}));throw new Error(_e.message||"Failed to fetch clinic settings.")}const se=await le.json();hc({admissionCharge:parseFloat(se.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(se.perDayCharge||0).toFixed(2),otherCharges:parseFloat(se.otherCharges||0).toFixed(2),aiMemory:se.aiMemory||"",aiMemoryUpdatedAt:se.aiMemoryUpdatedAt||null,clinicWideSystemPrompt:se.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:se.clinicWideSystemPromptUpdatedAt||null,gemini_api_key:se.gemini_api_key||""}),mc(se.aiMemory||""),ms(se.clinicWideSystemPrompt||"")}catch{}finally{pc(!1)}})()},[]),x.useEffect(()=>{var le;(le=o.state)!=null&&le.initialComplaint&&h(o.state.initialComplaint);const K=async se=>{H(!0),B(null);try{const _e=await Z(`/api/queue/doctor/complaint/${se}`);if(!_e.ok){const rt=await _e.json().catch(()=>({}));throw new Error(rt.message||`HTTP error! status: ${_e.status}`)}const Oe=await _e.json();g(Oe.patientId),w(Oe.age),_(Oe.gender),D(Oe.case_summary||null),F(Oe.updatedAt||null)}catch{B("Failed to load current complaint details."),g(null),w(void 0),_(void 0),D(null),F(null)}finally{H(!1)}};if(i)K(i);else if(n){const se=n;se&&(g(se),(async()=>{try{const Oe=await Z(`/api/queue/patient/${se}/latest`);if(Oe.ok){const gt=await Oe.json();if(gt!=null&&gt._id){l(gt._id),K(gt._id);return}}const rt=await Z("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:se,complaint:"Visit Initiated"})});if(rt.ok){const gt=await rt.json();if(gt!=null&&gt.id){l(gt.id),K(gt.id);return}}}catch(Oe){console.error("Background queue resolution failed",Oe),B("Failed to initialize visit record.")}})())}else jc()},[i,jc,(Yr=o.state)==null?void 0:Yr.initialComplaint,n]),x.useEffect(()=>{f?ui(f):(b(null),ne([]),ve([]),Dn([]),ce([]),F(null),Oi(!1))},[f]),x.useEffect(()=>{var se;const K=(se=o.state)==null?void 0:se.initialComplaint;K&&i&&(!J&&!xe&&!ti&&!pe&&!gn)&&!xt.current&&d===K&&(xt.current=!0,Is(),c(o.pathname,{replace:!0,state:{}}))},[(oa=o.state)==null?void 0:oa.initialComplaint,i,d,J,xe,ti,pe,gn,c]);const vc=()=>{P(E||""),M(!0),R(null)},_m=()=>{M(!1),P(""),R(null)},Dm=async()=>{if(!i){R("Missing Record ID.");return}G(!0),R(null);try{const K=await Z(`/api/queue/doctor/complaint/${i}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:A.trim()})});if(!K.ok){const se=await K.json().catch(()=>({}));throw new Error(se.message||`Failed to save case summary: ${K.statusText}`)}const le=await K.json();D(le.case_summary||A.trim()),F(le.updatedAt||null),M(!1)}catch(K){R(`Save Error: ${K.message}`)}finally{G(!1)}};x.useEffect(()=>{(async()=>{Aa(!0),Ja(null);try{const[le,se]=await Promise.all([Z("/api/drugs"),Z("/api/lab-tests")]);if(!le.ok)throw new Error(`Pharmacy inventory error! status: ${le.status}`);const _e=await le.json(),Oe=_e.drugs||_e||[];if(ta(Oe),!se.ok)throw new Error(`Lab inventory error! status: ${se.status}`);const rt=await se.json();Ds(rt||[])}catch(le){Ja(le.message)}finally{Aa(!1)}})()},[]);const Em=async()=>{if(!Xt)return;if(Ml===Xt.aiMemory&&li===Xt.clinicWideSystemPrompt){qr(!1);return}const K=Ml!==Xt.aiMemory,le=li!==Xt.clinicWideSystemPrompt;K&&fc(!0),le&&ad(!0);try{const se={...Xt};K&&(se.aiMemory=Ml),le&&(se.clinicWideSystemPrompt=li);const _e=await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify(se)});if(!_e.ok){const rt=await _e.json().catch(()=>({}));throw new Error(rt.message||"Failed to update clinic settings.")}const Oe=await _e.json();hc({admissionCharge:parseFloat(Oe.settings.admissionCharge).toFixed(2),perDayCharge:parseFloat(Oe.settings.perDayCharge).toFixed(2),otherCharges:parseFloat(Oe.settings.otherCharges).toFixed(2),aiMemory:Oe.settings.aiMemory||"",aiMemoryUpdatedAt:Oe.settings.aiMemoryUpdatedAt||(Xt==null?void 0:Xt.aiMemoryUpdatedAt)||null,clinicWideSystemPrompt:Oe.settings.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:Oe.settings.clinicWideSystemPromptUpdatedAt||(Xt==null?void 0:Xt.clinicWideSystemPromptUpdatedAt)||null}),K&&mc(Oe.settings.aiMemory||""),le&&(ms(Oe.settings.clinicWideSystemPrompt||""),qr(!1))}catch{}finally{K&&fc(!1),le&&ad(!1)}},Nc=()=>{Xt&&(ms(Xt.clinicWideSystemPrompt||""),qr(!0))},hd=()=>{qr(!1),Xt&&ms(Xt.clinicWideSystemPrompt||"")},Is=async K=>{const le=K??d;if(!le.trim())return;$l.current&&(clearTimeout($l.current),$l.current=null),Xu({role:"user",content:le});const se=Math.random().toString(36).substr(2,9);Br(_e=>[..._e,{id:se,role:"system",type:"loading",content:"",timestamp:new Date}]),$i.current?(await $i.current.callGenerativeApi(le),Br(_e=>_e.filter(Oe=>Oe.id!==se)),$l.current=setTimeout(()=>{Br([])},1e4)):Br(_e=>_e.filter(Oe=>Oe.id!==se))},Ra=K=>{navigator.clipboard.writeText(K).then(()=>{}).catch(le=>{console.error("Failed to copy text: ",le)})},Hl=(K,le)=>{const se=window.open("","_blank");se&&(se.document.write(`
        <html>
          <head>
            <title>${le}</title>
            <style>
              body { font-family: sans-serif; margin: 20px; }
              h2 { text-align: center; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              pre { white-space: pre-wrap; word-wrap: break-word; }
              .ai-context-section { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 5px; }
              .ai-context-section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #333; }
              .ai-context-text { margin-bottom: 5px; }
              .text-gray-400 { color: #999; }
              .font-semibold { font-weight: 600; }
              .italic { font-style: italic; }
              .mt-2 { margin-top: 8px; }
              .ml-1 { margin-left: 4px; }
              .ml-2 { margin-left: 8px; }
              .flex { display: flex; }
              .flex-col { flex-direction: column; }
              .w-full { width: 100%; }
              .text-xs { font-size: 0.75rem; }
              .text-sm { font-size: 0.875rem; }
              .prose { max-width: 65ch; }
              .prose table { display: table; } /* Ensure tables in markdown render correctly */
            </style>
          </head>
          <body>
            <h2>${le}</h2>
            <div id="print-content">${K}</div>
          </body>
        </html>
      `),se.document.close(),se.print())},ga=()=>{if(k){const K=Yf().use(Wn).use(eg).processSync(Ae).toString();Hl(`<div class="prose">${K}</div>`,"Summary")}};x.useEffect(()=>{if(y){let K=`
        <div class="print-section">
          <h3>Patient Details</h3>
          <p><strong>Name:</strong> ${y.name||"N/A"}</p>
          <p><strong>Token:</strong> ${y.patient_token_number||"N/A"}</p>
          <p><strong>Age:</strong> ${y.age||"N/A"}</p>
          <p><strong>Gender:</strong> ${y.gender||"N/A"}</p>
          <p><strong>Phone:</strong> ${y.phone||"N/A"}</p>
          <p><strong>Insurance:</strong> ${y.insurance_type||"N/A"}</p>
          <p><strong>Status:</strong> ${y.current_status||"N/A"}</p>
          <p><strong>Admitted:</strong> ${y.admission_date?new Date(y.admission_date).toLocaleDateString():"N/A"}</p>
          <p><strong>Discharged:</strong> ${y.discharge_date?new Date(y.discharge_date).toLocaleDateString():"N/A"}</p>
        </div>
        <div class="print-section">
          <h3>Case Summary</h3>
          <p>${E||"No summary available."}</p>
        </div>
        <div class="print-section">
          <h3>Complaints History</h3>
          ${ia.length>0?`
            <ul>
              ${ia.map(le=>`<li>${new Date(le.originalDateString).toLocaleDateString()}: ${le.data.complaint}</li>`).join("")}
            </ul>
          `:"<p>No past complaints.</p>"}
        </div>
        <div class="print-section">
          <h3>Pharmacy Orders</h3>
          ${ra.length>0?`
            <table class="print-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Drug Name</th>
                  <th>Quantity</th>
                  <th>Dosage</th>
                  <th>Directions</th>
                </tr>
              </thead>
              <tbody>
                ${ra.map(le=>{const se=le.data.medications.map((Oe,rt)=>`
                    <tr>
                      ${rt===0?`<td rowspan="${le.data.medications.length+(le.data.prescriptionForUnavailableDrugs?1:0)}">${new Date(le.originalDateString).toLocaleDateString()}</td>`:""}
                      ${rt===0?`<td rowspan="${le.data.medications.length+(le.data.prescriptionForUnavailableDrugs?1:0)}">${le.data.status}</td>`:""}
                      <td><strong>${Oe.name}</strong></td>
                      <td>
                        ${Oe.pack_quantity!==void 0&&Oe.pack_quantity>0?`Packs: ${Oe.pack_quantity}`:""}
                        ${Oe.pack_quantity!==void 0&&Oe.pack_quantity>0&&Oe.loose_quantity!==void 0&&Oe.loose_quantity>0?", ":""}
                        ${Oe.loose_quantity!==void 0&&Oe.loose_quantity>0?`Loose: ${Oe.loose_quantity}`:""}
                      </td>
                      <td>${Oe.tabletsPerDay&&Oe.numberOfDays?`${Oe.tabletsPerDay} tab/day for ${Oe.numberOfDays} days`:"N/A"}</td>
                      <td>${Oe.directions_to_use||"N/A"}</td>
                    </tr>
                  `).join("");let _e="";return le.data.prescriptionForUnavailableDrugs&&(_e=`
                      <tr>
                        <td colspan="4" style="background-color: #f9f9f9; padding: 10px;">
                          <div style="font-style: italic; margin-bottom: 5px; font-weight: 600;">Prescription for Unavailable Drugs:</div>
                          <div class="prose" style="font-size: 0.9em;">${Yf().use(Wn).use(eg).processSync(le.data.prescriptionForUnavailableDrugs).toString()}</div>
                        </td>
                      </tr>
                    `),se+_e}).join("")}
              </tbody>
            </table>
          `:"<p>No pharmacy orders.</p>"}
        </div>
        <div class="print-section">
          <h3>Lab History (Orders & Reports)</h3>
          ${ts.length>0?`
            ${ts.map(le=>{const se=le.data.tests.map(Oe=>Oe.name).join(", ");let _e="";return le.data.report&&(_e=`
                  <div class="lab-report-print-container">
                    <h4>Lab Report (${new Date(le.data.report.report_date).toLocaleDateString()})</h4>
                    ${Os(le.data.report,le.data.report.tests)}
                  </div>
                `),`
                <div class="lab-history-item">
                  <p><strong>Order Date:</strong> ${new Date(le.originalDateString).toLocaleDateString()}</p>
                  <p><strong>Status:</strong> ${le.data.status}</p>
                  <p><strong>Tests:</strong> ${se}</p>
                  ${_e}
                </div>
              `}).join("")}
          `:"<p>No lab history.</p>"}
        </div>
      `;bc(K)}else bc("")},[y,E,ia,ra,ts,Os]);const Qn=()=>{mi&&Hl(mi,`Patient Details - ${y==null?void 0:y.name}`)},Bi=K=>{h(K),yc(null),hi([]),setTimeout(()=>{Is(K)},0)},xa=J||Se||ge||pe||xe||gn||ti||I||jn||Vu||Ei||Gu||xm||Wa||fa||oi||Pa||cc||Pr||ac||Pi||zr||Es||Q,Vl=xa,Gl=()=>{h("reports came,please anaylse"),setTimeout(()=>{Is()},0)},Ql=K=>{ym(le=>({...le,[K]:!le[K]}))},Ui=K=>{K.key==="Enter"&&!K.shiftKey&&(K.preventDefault(),!xa&&d.trim()&&i&&Is())};x.useEffect(()=>{const K=window.SpeechRecognition||window.webkitSpeechRecognition;if(!K){lc("Speech recognition not supported in this browser.");return}const le=new K;return le.continuous=!0,le.interimResults=!0,le.lang="en-US",le.onresult=se=>{let _e="";for(let Oe=se.resultIndex;Oe<se.results.length;++Oe)se.results[Oe].isFinal&&(_e+=se.results[Oe][0].transcript);_e&&h(Oe=>Oe+(Oe.endsWith(" ")||Oe===""?"":" ")+_e)},le.onerror=se=>{lc(`Speech error: ${se.error}`),jm(!1)},le.onend=()=>{},Fl.current=le,()=>{Fl.current&&Fl.current.stop()}},[]);const md=async()=>{if(f)if(Ts){Tl(!0);try{const K=await Z(`/api/patients/${f}/discharge`,{method:"POST"});if(!K.ok){const le=await K.json().catch(()=>({}));throw new Error(le.message||`Failed to discharge patient: ${K.status}`)}es(f)}catch(K){B(`Discharge Error: ${K.message}`)}finally{Tl(!1)}}else{Ju(!0);try{const K=await Z(`/api/patients/${f}/admit`,{method:"POST"});if(!K.ok){const le=await K.json().catch(()=>({}));throw new Error(le.message||`Failed to admit patient: ${K.status}`)}es(f)}catch(K){B(`Admit Error: ${K.message}`)}finally{Ju(!1)}}},Yl=async K=>{if(f){si(!0);try{const se=await Z("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:f})});if(!se.ok){const _e=await se.json().catch(()=>({}));throw new Error(_e.message||`Failed to add patient to ${K} queue: ${se.status}`)}alert(`Patient added to ${K} queue successfully!`),f&&(es(f),Vr(f))}catch(le){B(`Add to Queue Error: ${le.message}`)}finally{si(!1)}}},qi=async()=>{if(i){sc(!0),B(null);try{const K=await Z(`/api/queue/${i}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"seen"})});if(!K.ok){const le=await K.json().catch(()=>({}));throw new Error(le.message||"Failed to complete consultation")}alert("Consultation completed successfully!"),f&&(es(f),Vr(f))}catch(K){B(`Error completing consultation: ${K.message}`)}finally{sc(!1)}}},Tm=async()=>{if(!f){hs("Missing Patient ID.");return}if(!y){hs("Patient details not loaded.");return}ii(!0),hs(null);try{const K={};let le=!1;if(Lr!==y.name&&(K.name=Lr,le=!0),Al!==y.age&&(K.age=Al,le=!0),Li!==y.gender&&(K.gender=Li,le=!0),$n!==y.phone&&(K.phone=$n,le=!0),!le){hs("No changes detected."),ii(!1),Ii(!1);return}const se=await Z(`/api/patients/${f}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(K)});if(!se.ok){const Oe=await se.json().catch(()=>({}));throw new Error(Oe.message||`Failed to update patient details: ${se.statusText}`)}const _e=await se.json();b(_e),w(_e.age),_(_e.gender),zi(_e.name),Fi(_e.age),Pl(_e.gender),ds(_e.phone),Ii(!1)}catch(K){hs(`Save Error: ${K.message}`)}finally{ii(!1)}},la=x.useCallback(()=>{if(!y)return null;const K={token_number:y.patient_token_number||"N/A",name:y.name||"N/A",age:y.age||"N/A",gender:y.gender||"N/A",phone:y.phone||"N/A"};return ia.length>0?K.complaints_history=ia.map(le=>`${le.data.complaint} (${new Date(le.originalDateString).toLocaleDateString()})`).join("; "):K.complaints_history="No past complaints.",ra.length>0?K.pharmacy_orders_history=ra.map(le=>`Order: ${le.data.medications.map(_e=>{let Oe=`${_e.name}`;return _e.pack_quantity!==void 0&&_e.pack_quantity>0&&(Oe+=` Packs: ${_e.pack_quantity}`),_e.loose_quantity!==void 0&&_e.loose_quantity>0&&(Oe+=` Loose: ${_e.loose_quantity}`),Oe}).join(", ")} (${le.data.status}, ${new Date(le.originalDateString).toLocaleDateString()})`).join("; "):K.pharmacy_orders_history="No pharmacy orders.",ts.length>0?K.lab_orders_history=ts.map(le=>{let _e=`Lab Order: ${le.data.tests.map(Oe=>Oe.name).join(", ")} (${le.data.status}, ${new Date(le.originalDateString).toLocaleDateString()})`;return le.data.report&&(_e+=` - Report: ${le.data.report.report_content} (${new Date(le.data.report.report_date).toLocaleDateString()})`),_e}).join("; "):K.lab_orders_history="No lab history.",Fe.length>0?K.recurring_medications=Fe.map((le,se)=>{let _e=`${se+1}. ${le.medicationName} (${le.frequencyDays} days, ${le.status})`;return le.tabletsPerDay&&(_e+=` - ${le.tabletsPerDay} tabs/day`),le.numberOfDays&&(_e+=` for ${le.numberOfDays} days`),_e}).join("; "):K.recurring_medications="No recurring medications.",K},[y,ia,ra,ts,Fe]),wc=()=>{if(!y){lc("Patient details are required to use the Live API.");return}oc(!0)},fs=()=>{var K;(K=Ll.current)==null||K.click()},pd=K=>{var se;const le=(se=K.target.files)==null?void 0:se[0];le&&Zu(le)},Hi=x.useRef(!1),Oa=x.useRef(null),zs=x.useRef(null),Yn=x.useRef({response:!0,pharmacy:!1,recurring:!1,labs:!1,history:!1,summary:!1}),[ns,Ia]=x.useState("response"),Fs=K=>{Hi.current=!0,Ia(K),Oa.current&&clearTimeout(Oa.current),Oa.current=setTimeout(()=>{Hi.current=!1},1e3);const le={behavior:"smooth",block:"start"};K==="response"&&ht.current?ht.current.scrollIntoView(le):K==="meds"?ke.current?ke.current.scrollIntoView(le):zs.current&&zs.current.scrollIntoView(le):K==="labs"&&Me.current?Me.current.scrollIntoView(le):K==="history"&&De.current?De.current.scrollIntoView(le):K==="summary"&&qe.current&&qe.current.scrollIntoView(le)};return x.useEffect(()=>{const K=new IntersectionObserver(le=>{Hi.current||(le.forEach(se=>{se.target===ht.current?Yn.current.response=se.isIntersecting:se.target===ke.current?Yn.current.pharmacy=se.isIntersecting:se.target===zs.current?Yn.current.recurring=se.isIntersecting:se.target===Me.current?Yn.current.labs=se.isIntersecting:se.target===De.current?Yn.current.history=se.isIntersecting:se.target===qe.current&&(Yn.current.summary=se.isIntersecting)}),Yn.current.response?Ia("response"):Yn.current.pharmacy||Yn.current.recurring?Ia("meds"):Yn.current.labs?Ia("labs"):Yn.current.history?Ia("history"):Yn.current.summary&&Ia("summary"))},{root:null,threshold:0,rootMargin:"-10% 0px -50% 0px"});return ht.current&&K.observe(ht.current),ke.current&&K.observe(ke.current),Me.current&&K.observe(Me.current),De.current&&K.observe(De.current),qe.current&&K.observe(qe.current),zs.current&&K.observe(zs.current),()=>{K.disconnect(),Oa.current&&clearTimeout(Oa.current)}},[]),e.jsxs("div",{className:"edit-complaint-page",style:{height:`${W}px`},children:[e.jsx(QF,{ref:$i,recordId:i,patientId:f,patientDetails:y,caseSummary:E,caseSummaryUpdatedAt:z,clinicSettings:Xt,userMessages:m,selectedImageFile:Ur,pendingLabOrders:Ti,labReports:ie,pastComplaints:L,pharmacyOrders:me,pharmacyInventory:ea,labInventory:On,recurringMedications:Fe,currentComplaint:d,setCurrentComplaint:h,setAiResponse:Ne,setAiResponseText:T,setAiResponseJsonString:Ue,setShowAiJsonDetails:de,setIsLoadingAi:ee,setAiError:()=>{},setIsSubmittingAiOrder:Hu,setAiOrderSubmissionStatus:()=>{},setIsSubmittingAiLabOrder:ei,setAiLabOrderSubmissionStatus:()=>{},setIsSubmittingAiComplaint:gm,setAiComplaintSubmissionStatus:()=>{},setIsUpdatingCaseSummary:Qu,setAiCaseSummaryUpdateStatus:()=>{},setCaseSummary:D,setCaseSummaryUpdatedAt:F,setIsUpdatingAiMemoryByAI:Sl,setAiMemoryUpdateByAIStatus:()=>{},setFollowUpQuestion:yc,setFollowUpOptions:hi,setError:B,setIsSavingAiResponse:q,setSaveAiResponseError:()=>{},fetchPharmacyOrdersData:ps,fetchPendingLabOrdersData:ci,fetchLabReportsData:Mi,fetchPastComplaintsData:rd,fetchPatientDetails:es,fetchRecurringMedicationsData:ui,setClinicSettings:hc,setEditedAiMemory:mc,handleDeleteItem:di,setCanUndo:sd,onAiActionSuccess:dt,addMessage:Xu}),ed&&y&&e.jsx(dm,{onClose:()=>oc(!1),patientData:la(),tokenNumber:y.patient_token_number?String(y.patient_token_number):null,onAiSummaryChange:K=>{K&&(h(K),Is(K),oc(!1))}}),e.jsxs("div",{className:"edit-complaint-header",children:[e.jsx("button",{onClick:()=>c(-1),disabled:xa,className:"back-button",title:"Go Back",children:e.jsx(Et,{size:20})}),e.jsx("span",{ref:ue,style:{position:"absolute",visibility:"hidden",height:"auto",width:"auto",whiteSpace:"nowrap"}}),!y&&J&&e.jsxs("div",{className:"edit-complaint-patient-details",style:{display:"flex",alignItems:"center",gap:"12px",padding:"8px 12px"},children:[e.jsx(U,{width:"120px",height:"18px",style:{marginRight:"8px"}}),e.jsx(U,{width:"60px",height:"16px"}),e.jsx(U,{width:"80px",height:"16px"}),e.jsx(U,{width:"90px",height:"16px"})]}),y&&e.jsx("div",{className:"edit-complaint-patient-details",children:y&&!Xa?e.jsx(e.Fragment,{children:e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{Ii(!0),zi(y.name||""),Fi(y.age),Pl(y.gender),ds(y.phone),hs(null)},className:"edit-button mr-2",title:"Edit Patient Details",disabled:fa,children:e.jsx(ys,{size:14})}),e.jsxs("div",{className:"patient-info-text-wrapper",children:[e.jsx("span",{className:"patient-name",children:y.name??"N/A"}),e.jsxs("span",{className:"patient-meta",children:[y.patient_token_number!==null&&y.patient_token_number!==void 0&&` (#${y.patient_token_number})`," - ",y.age??"N/A"," / ",y.gender??"N/A"]}),y.phone&&e.jsxs("span",{className:"patient-phone",children:[" / ",y.phone]}),uc!==null&&uc>0&&e.jsxs("span",{className:"patient-debt-badge",style:{marginLeft:"8px",padding:"2px 8px",backgroundColor:"rgba(220, 53, 69, 0.15)",color:"#dc3545",borderRadius:"12px",fontSize:"0.75em",fontWeight:"bold",border:"1px solid rgba(220, 53, 69, 0.3)",cursor:"pointer"},onClick:()=>c("/dashboard/patient-debts"),title:"Click to manage patient debts",children:["Debt: ",uc.toFixed(2)]})]}),e.jsx("button",{onClick:K=>{K.stopPropagation(),Qn()},disabled:!mi,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900 flex-shrink-0",children:e.jsx(Ys,{size:14})})]})}):y&&Xa?e.jsxs("div",{className:"patient-details-edit-form",children:[e.jsx("input",{type:"text",value:Lr,onChange:K=>zi(K.target.value),placeholder:"Name",className:"edit-input",disabled:fa}),e.jsx("input",{type:"number",value:Al??"",onChange:K=>Fi(K.target.value?parseInt(K.target.value):null),placeholder:"Age",className:"edit-input",disabled:fa}),e.jsxs("select",{value:Li??"",onChange:K=>Pl(K.target.value||null),className:"edit-input",disabled:fa,children:[e.jsx("option",{value:"",children:"Select Gender"}),e.jsx("option",{value:"M",children:"Male"}),e.jsx("option",{value:"F",children:"Female"}),e.jsx("option",{value:"O",children:"Other"})]}),e.jsx("input",{type:"text",value:$n??"",onChange:K=>ds(K.target.value||null),placeholder:"Phone Number",className:"edit-input",disabled:fa}),e.jsxs("div",{className:"edit-actions",children:[e.jsx("button",{onClick:()=>{Ii(!1),hs(null)},className:"button-secondary",disabled:fa,children:"Cancel"}),e.jsx("button",{onClick:Tm,className:"button-primary blue",disabled:fa,children:fa?"Saving...":"Save"})]}),Ku&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:Ku})]}):e.jsxs("div",{className:"edit-complaint-patient-details",children:[v??"N/A"," / ",S??"N/A",e.jsx("button",{onClick:K=>{K.stopPropagation(),Qn()},disabled:!mi,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900",children:e.jsx(Ys,{size:14})})]})}),!y&&v!==void 0&&S!==void 0&&e.jsxs("div",{className:"edit-complaint-patient-details",children:[v??"N/A"," / ",S??"N/A",e.jsx("button",{onClick:K=>{K.stopPropagation(),Qn()},disabled:!mi,title:"Print Patient Details",className:"icon-button small ml-2 text-gray-600 hover:text-gray-900",children:e.jsx(Ys,{size:14})})]}),e.jsx("div",{style:{minWidth:"64px",display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{onClick:t,className:"icon-button small text-gray-600 hover:text-gray-900 bg-gray-100 hover:bg-gray-200",title:"Open Command Bar (Ctrl+K)",style:{padding:"0.2rem",borderRadius:"8px"},children:e.jsx(fn,{size:24})})})]}),e.jsxs("div",{className:"edit-complaint-content-area",ref:ct,children:[Wu.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"edit-complaint-chat-column",style:{width:"30%",minWidth:"320px",maxWidth:"40%",flexShrink:0},children:e.jsx(o5,{messages:Wu})}),e.jsx("div",{className:"draggable-divider",onMouseDown:()=>{}})]}),e.jsxs("div",{ref:ht,className:"edit-complaint-main-column",style:{flex:1,minWidth:0},children:[re&&e.jsxs("div",{className:"general-error-message",children:["Error: ",re]}),Se&&e.jsxs("div",{className:"ai-response-container",style:{padding:"16px"},children:[e.jsx(U,{width:"100%",height:"18px",style:{marginBottom:"10px"}}),e.jsx(U,{width:"95%",height:"16px",style:{marginBottom:"8px"}}),e.jsx(U,{width:"85%",height:"16px",style:{marginBottom:"8px"}}),e.jsx(U,{width:"90%",height:"16px",style:{marginBottom:"8px"}}),e.jsx(U,{width:"70%",height:"16px"})]}),!Se&&(Ae||Ce)&&e.jsxs("div",{ref:Je,className:`${Ce?"ai-function-call-block":"ai-response-container"} group`,children:[Ae&&e.jsx(qa,{remarkPlugins:[Wn],children:Ae}),Ce&&e.jsxs("div",{className:"ai-json-details-container",children:[e.jsxs("button",{onClick:()=>de(!Pe),className:"ai-json-toggle-button",children:[Pe?e.jsx(lg,{size:14,className:"mr-1"}):e.jsx(og,{size:14,className:"mr-1"}),Pe?"Hide":"Show"," AI Function Call Details"]}),Pe&&e.jsx("pre",{className:"ai-json-pre",children:e.jsx("code",{children:JSON.stringify(JSON.parse(Ce),null,2)})})]}),e.jsxs("div",{className:"ai-response-actions",children:[e.jsx("button",{onClick:()=>Ra(k),disabled:!k,title:"Copy Full AI Response",children:e.jsx(NC,{size:12})}),e.jsx("button",{onClick:ga,disabled:!k,title:"Print AI Response",children:e.jsx(Ys,{size:12})})]})]})]}),e.jsx("div",{className:"draggable-divider",onMouseDown:dd}),e.jsx("div",{ref:Ze,className:"edit-complaint-context-column",style:{flexBasis:`calc(${100-jt}% - 5px)`},children:e.jsxs("div",{className:"ai-context-container",children:[e.jsxs("h3",{className:"ai-context-header",children:[e.jsx("span",{children:"AI Context:"}),(y==null?void 0:y.insurance_type)&&e.jsx("div",{className:"insurance-type-container mt-2",children:e.jsxs("select",{ref:be,value:y.insurance_type,onChange:K=>Hr(y.id,K.target.value),className:"insurance-type-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"insurance",children:"Insurance"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})})]}),e.jsxs("div",{ref:je,className:"ai-context-section",children:[e.jsx("h4",{className:"ai-context-section-title",children:"Admission Status"}),oe?e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{width:"60%",height:"1.2em"}),e.jsx(U,{width:"50%",height:"1.2em"}),e.jsx(U,{width:"40%",height:"1.2em"}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx(U,{width:"80px",height:"30px"}),e.jsx(U,{width:"100px",height:"30px"})]})]}):e.jsxs(e.Fragment,{children:[(y==null?void 0:y.admission_date)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Admitted:"})," ",new Date(y.admission_date).toLocaleDateString()]}),(y==null?void 0:y.discharge_date)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Discharged:"})," ",new Date(y.discharge_date).toLocaleDateString()]}),(y==null?void 0:y.current_status)&&e.jsxs("p",{className:"ai-context-text",children:[e.jsx("strong",{children:"Current Status:"})," ",e.jsx("span",{className:"font-semibold",children:y.current_status})]}),e.jsxs("div",{className:"flex space-x-2 mt-2",children:[e.jsx("button",{onClick:md,className:`admit-discharge-button ${Ts?"discharge":"admit"}`,title:Ts?"Discharge Patient":"Admit Patient",disabled:!f||ac||Pi,children:ac?"Admitting...":Pi?"Discharging...":Ts?"Discharge":"Admit"}),e.jsxs("button",{onClick:()=>c(`/patient/${encodeURIComponent(f??"")}/admission-billing`),className:"queue-status-button",style:{backgroundColor:"#e0f2fe",color:"#0369a1",border:"1px solid #bae6fd",display:"flex",alignItems:"center",gap:"4px"},title:"Go to Admission Billing",disabled:!f,children:[e.jsx(Cr,{size:14})," Billing"]}),e.jsx("button",{onClick:()=>Yl("doctor"),className:`queue-status-button ${Ri?"in-queue":"add-to-queue"}`,title:Ri?"Patient is in Doctor Queue":"Add Patient to Doctor Queue",disabled:!f||zr||Ri,children:zr?"Adding...":Ri?"In Queue":"Add to Queue"}),e.jsx("button",{onClick:qi,className:"complete-consultation-button",title:"Mark Consultation as Complete",disabled:Es,children:Es?"Completing...":"Complete Consultation"})]})]})]}),e.jsx("div",{ref:ke,children:e.jsx(Jf,{title:"Pharmacy Order History",headerAction:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Cm,className:"button-primary blue text-xs px-2 py-1",disabled:cc||me.filter(K=>K.status==="pending").length<2,title:"Merge all pending orders into one",children:cc?"Merging...":"Merge Orders"}),e.jsxs("button",{onClick:()=>Yu(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new pharmacy order",disabled:!f,children:[e.jsx(bn,{size:12,className:"mr-1"})," Create Order"]})]}),items:ra,isLoading:J||oe,loadingText:"Loading...",noDataText:"No orders.",renderItemContent:(K,le)=>e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("span",{className:"ai-context-text flex items-center",children:[" ",ra.length-le,". Order Status: (",K.data.status,")",e.jsx("span",{className:"text-gray-400 ml-1 flex items-center",children:Fr===K.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",children:e.jsx("input",{type:"datetime-local",defaultValue:tg(K.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:se=>{se.target.value&&gc(K.data.id,se.target.value),Za(null)},onKeyDown:se=>{if(se.key==="Enter"){const _e=se.target;_e.value&&gc(K.data.id,_e.value),Za(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:()=>Za(K.data.id),title:"Click to edit date",children:["(",new Date(K.originalDateString).toLocaleDateString(),")",e.jsx(ys,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),e.jsxs("div",{className:"inline-flex space-x-2 ml-2",children:[" ",e.jsx("button",{onClick:()=>xc(K.data.id),className:"icon-button small",title:"Edit Pharmacy Order",children:e.jsx(ys,{size:12})}),K.data.prescriptionForUnavailableDrugs&&e.jsx("button",{onClick:()=>{const se=Yf().use(Wn).use(eg).processSync(K.data.prescriptionForUnavailableDrugs).toString();Hl(se,"Unavailable Drugs Prescription")},className:"icon-button small",title:"Print Unavailable Drugs Prescription",children:e.jsx(Ys,{size:12})}),K.data.status==="dispensed"||K.data.status==="billed"?e.jsx("button",{onClick:()=>c(`/dashboard/pharmacy-billing/${K.data.id}`),className:"icon-button small text-blue-600",title:"View Pharmacy Bill",children:e.jsx(_s,{size:12})}):e.jsx("button",{onClick:()=>di({type:"Pharmacy Order",data:K.data}),className:"icon-button small text-red-500",title:"Delete Pharmacy Order",children:e.jsx(Jt,{size:12})}),K.data.status==="pending"&&e.jsx("button",{onClick:()=>wm(K.data.id),className:"icon-button small",title:"Bill this pharmacy order",disabled:Wa,children:e.jsx(Cr,{size:12})}),K.data.status==="billed"&&e.jsx("button",{onClick:()=>Sm(K.data.id,"dispensed"),className:"icon-button small",title:"Dispense this pharmacy order",disabled:Wa,children:e.jsx(ka,{size:12})}),e.jsx("button",{onClick:()=>Nm(K.data),className:"icon-button small group-hover:block",title:"Add to Recurring Medications",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-repeat",children:[e.jsx("path",{d:"m17 2 4 4-4 4"}),e.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),e.jsx("path",{d:"m7 22-4-4 4-4"}),e.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]})})]})]}),e.jsx("div",{className:"pharmacy-order-drugs-table-container mobile-edge-to-edge-table-container mt-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1",onClick:()=>xc(K.data.id),title:"Click to edit order",children:e.jsxs("table",{className:"pharmacy-order-drugs-table mobile-edge-to-edge-table w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-2 text-left",children:"Drug Name"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Quantity"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Dosage"}),e.jsx("th",{className:"py-1 px-2 text-left",children:"Directions"})]})}),e.jsx("tbody",{children:K.data.medications.map((se,_e)=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-1 px-2",children:e.jsx("strong",{children:se.name})}),e.jsxs("td",{className:"py-1 px-2",children:[se.pack_quantity!==void 0&&se.pack_quantity>0&&`Packs: ${se.pack_quantity}`,se.pack_quantity!==void 0&&se.pack_quantity>0&&se.loose_quantity!==void 0&&se.loose_quantity>0&&", ",se.loose_quantity!==void 0&&se.loose_quantity>0&&`Loose: ${se.loose_quantity}`]}),e.jsx("td",{className:"py-1 px-2",children:se.tabletsPerDay&&se.numberOfDays?`${se.tabletsPerDay} tab/day for ${se.numberOfDays} days`:"N/A"}),e.jsx("td",{className:"py-1 px-2",children:se.directions_to_use||"N/A"})]},se.drug_id||se.name||_e))})]})}),K.data.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"unavailable-drugs-markdown mt-2",children:[e.jsx("span",{className:"font-semibold text-xs text-gray-600 block mb-1",children:"Prescription for Unavailable Drugs:"}),e.jsx(qa,{remarkPlugins:[Wn],children:K.data.prescriptionForUnavailableDrugs})]})]})})}),e.jsxs("div",{ref:zs,className:"ai-context-section mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"ai-context-section-title mb-0",children:"Recurring Medications"}),e.jsxs("button",{onClick:()=>{Ka([]),Ai(!0)},className:"text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 px-2 py-1 rounded flex items-center gap-1",children:[e.jsx(bn,{size:12})," Add"]})]}),Fe.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"py-1 px-2",children:"#"}),e.jsx("th",{className:"py-1 px-2",children:"Medication"}),e.jsx("th",{className:"py-1 px-2",children:"Qty"}),e.jsx("th",{className:"py-1 px-2",children:"Frequency"}),e.jsx("th",{className:"py-1 px-2",children:"Next Delivery"}),e.jsx("th",{className:"py-1 px-2",children:"Status"}),e.jsx("th",{className:"py-1 px-2"})]})}),e.jsx("tbody",{children:Fe.map((K,le)=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[e.jsx("td",{className:"py-1 px-2 font-medium text-gray-500",children:le+1}),e.jsxs("td",{className:"py-1 px-2 font-medium",children:[K.medicationName,e.jsxs("div",{className:"text-[10px] text-gray-500 font-normal",children:[K.tabletsPerDay?`${K.tabletsPerDay} tabs/day`:"",K.tabletsPerDay&&K.numberOfDays?"  ":"",K.numberOfDays?`${K.numberOfDays} days`:"",K.directions?`  ${K.directions}`:""]})]}),e.jsx("td",{className:"py-1 px-2",children:K.quantity}),e.jsxs("td",{className:"py-1 px-2",children:[K.frequencyDays," days"]}),e.jsx("td",{className:"py-1 px-2",children:new Date(K.nextDeliveryDate).toLocaleDateString()}),e.jsx("td",{className:"py-1 px-2",children:e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${K.status==="active"?"bg-green-100 text-green-800":K.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:K.status})}),e.jsx("td",{className:"py-1 px-2 text-right",children:e.jsx("button",{onClick:()=>{Ir(K),Dl(!0)},className:"text-gray-400 hover:text-blue-600 p-1",title:"Edit",children:e.jsx(ys,{size:12})})})]},K.id))})]})}):J||oe?e.jsx("div",{style:{marginTop:"8px"},children:[1,2,3].map(K=>e.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"10px"},children:[e.jsx(U,{width:"30px",height:"14px"}),e.jsx(U,{width:"120px",height:"14px"}),e.jsx(U,{width:"40px",height:"14px"}),e.jsx(U,{width:"60px",height:"14px"}),e.jsx(U,{width:"80px",height:"14px"})]},K))}):e.jsx("p",{className:"text-gray-500 text-sm italic",children:"No recurring medications."})]}),Or&&e.jsx(i5,{isOpen:Or,onClose:()=>Yu(!1),patientId:f,pharmacyInventory:ea,fetchPharmacyOrdersData:ps,isLoadingInventory:gn}),e.jsxs("div",{ref:Me,children:[e.jsx(Jf,{title:"Lab History (Orders & Reports)",headerAction:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:Gl,className:"button-primary blue text-xs px-2 py-1",title:"Tell AI to analyse the reports",disabled:Vl,children:"Analyse Reports"}),e.jsxs("button",{onClick:()=>Zo(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new lab order",disabled:!f,children:[e.jsx(bn,{size:12,className:"mr-1"})," Create Lab Order"]})]}),items:ts,onDeleteItem:void 0,onEditLabOrder:void 0,onSaveLabOrder:ud,onCancelEditLabOrder:km,onLabOrderTestChange:sa,onLabOrderStatusChange:Qr,onBillLabOrder:void 0,onUpdateLabOrderStatus:void 0,onEnterLabReport:void 0,labInventory:On,isSavingLabOrder:Wa,isLoading:ti||pe||oe,loadingText:"Loading...",noDataText:"No lab Hx.",expandedLabReports:Rr,toggleLabReport:Ql,renderItemContent:(K,le)=>{const se=mF(K.data.report?K.data.report.status:K.data.status),_e=(K.data.tests||[]).reduce((Oe,rt)=>Oe+(Number(rt.price)||0),0).toFixed(2);return e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"ai-context-text flex items-center flex-wrap",children:[e.jsxs("span",{className:"font-medium cursor-pointer hover:text-blue-600 transition-colors mr-2",onClick:()=>Ul(K.data),title:"Click to enter report",children:["#",K.data.serialNumber," [Order]"]}),e.jsx("span",{className:`mr-2 ${se.className}`,children:se.text}),e.jsx("span",{className:"text-gray-400 inline-flex items-center",children:ic===K.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:Oe=>Oe.stopPropagation(),children:e.jsx("input",{type:"datetime-local",defaultValue:tg(K.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:Oe=>{Oe.target.value&&Gr(K.data.id,"order",Oe.target.value),ri(null)},onKeyDown:Oe=>{if(Oe.key==="Enter"){const rt=Oe.target;rt.value&&Gr(K.data.id,"order",rt.value),ri(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:Oe=>{Oe.stopPropagation(),ri(K.data.id)},title:"Click to edit order date",children:["(",new Date(K.originalDateString).toLocaleDateString(),")",e.jsx(ys,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})})]}),!K.data.isEditing&&e.jsxs("div",{className:"flex space-x-1 items-center",children:[e.jsx("button",{onClick:()=>ld(K.data.id),className:"icon-button small",title:"Edit",disabled:Wa,children:e.jsx(ys,{size:12})}),K.data.status==="pending"?e.jsx("button",{onClick:()=>od(K.data),className:"icon-button small font-medium text-green-600 w-auto px-1",title:`Pay total of ${_e}`,disabled:Wa,children:e.jsx(T1,{size:12})}):e.jsx("button",{onClick:()=>c(`/dashboard/lab-billing/${K.data.id}`),className:"icon-button small text-blue-600",title:"View Lab Bill",children:e.jsx(em,{size:12})}),["pending","billed","collected","processing","report_ready","reported","completed"].includes(K.data.status)&&e.jsx("button",{onClick:()=>Ul(K.data),className:"icon-button small text-indigo-600",title:"Enter Report",disabled:Wa,children:e.jsx(_s,{size:12})}),(K.data.status==="report_ready"||K.data.status==="reported")&&e.jsx("button",{onClick:()=>cd(K.data.id,"completed"),className:"icon-button small text-green-600",title:"Mark Completed",disabled:Wa,children:e.jsx(ka,{size:12})}),e.jsx("button",{onClick:()=>di({type:"Lab Order",data:K.data}),className:"icon-button small text-red-500",title:"Delete",disabled:Wa,children:e.jsx(Jt,{size:12})})]})]}),e.jsx("div",{className:"lab-order-tests-table-container mobile-edge-to-edge-table-container mt-1 mb-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1 border border-gray-100",onClick:()=>{K.data.status==="pending"?ld(K.data.id):Ul(K.data)},title:K.data.status==="pending"?"Click to edit order":"Click to enter report",children:e.jsxs("table",{className:"lab-order-tests-table mobile-edge-to-edge-table w-full text-xs text-left",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b bg-gray-50",children:[e.jsx("th",{className:"py-1 px-2 font-medium text-gray-600",children:"Test Name"}),e.jsx("th",{className:"py-1 px-2 text-right font-medium text-gray-600",children:"Price"})]})}),e.jsxs("tbody",{children:[K.data.tests&&K.data.tests.length>0?K.data.tests.map(Oe=>e.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-100",children:[e.jsx("td",{className:"py-1 px-2",children:Oe.name}),e.jsxs("td",{className:"py-1 px-2 text-right",children:["",Oe.price]})]},Oe.id||Oe.name)):e.jsx("tr",{children:e.jsx("td",{colSpan:2,className:"py-1 px-2 italic text-gray-500",children:"No tests specified"})}),e.jsxs("tr",{className:"bg-gray-50 font-semibold",children:[e.jsx("td",{className:"py-1 px-2 text-right text-gray-700",children:"Total:"}),e.jsxs("td",{className:"py-1 px-2 text-right text-gray-900",children:["",_e]})]})]})]})}),K.data.report&&e.jsxs("div",{className:"ml-4 mt-1 p-2 border-l-2 border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium text-sm text-gray-700",children:"[Report]"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-gray-400 ml-1 flex items-center text-xs",children:Rl===K.data.id?e.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:Oe=>Oe.stopPropagation(),children:e.jsx("input",{type:"datetime-local",defaultValue:tg(K.data.report.report_date),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:Oe=>{Oe.target.value&&Gr(K.data.id,"report",Oe.target.value),Ol(null)},onKeyDown:Oe=>{if(Oe.key==="Enter"){const rt=Oe.target;rt.value&&Gr(K.data.id,"report",rt.value),Ol(null)}},autoFocus:!0})}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/reportDate ml-1",onClick:Oe=>{Oe.stopPropagation(),Ol(K.data.id)},title:"Click to edit report date",children:["(",new Date(K.data.report.report_date).toLocaleDateString(),")",e.jsx(ys,{size:12,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),e.jsx("button",{onClick:()=>Ql(K.data.report.reportId),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400 ml-2",title:Rr[K.data.report.reportId]?"Collapse Report":"Expand Report",children:Rr[K.data.report.reportId]?e.jsx(lg,{size:14}):e.jsx(og,{size:14})}),e.jsx("button",{onClick:()=>di({type:"Lab Report",data:K.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400 ml-1",title:"Delete Report",children:e.jsx(Jt,{size:12})})]})]}),Rr[K.data.report.reportId]&&(()=>{try{const Oe=JSON.parse(K.data.report.report_content||"{}");return typeof Oe=="object"&&Oe!==null&&K.data.report.tests?K.data.report.tests.map(rt=>e.jsxs("div",{style:{marginBottom:"10px"},children:[e.jsx("h5",{className:"font-semibold text-xs mt-2 mb-1 text-gray-700",children:rt.name}),Oe[rt.id]?e.jsx("div",{className:"mobile-edge-to-edge-table-container",children:e.jsxs("table",{className:"lab-inventory-table mobile-edge-to-edge-table w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Parameter"}),e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Value"}),e.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Normal Range"})]})}),e.jsx("tbody",{children:Object.entries(Oe[rt.id]).map(([gt,Ht])=>{var nn;const _t=(nn=rt.default_parameters)==null?void 0:nn.find(zt=>zt.name===gt);return e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"py-1 px-2",children:gt}),e.jsxs("td",{className:"py-1 px-2",children:[String(Ht)," ",(_t==null?void 0:_t.unit)||""]}),e.jsx("td",{className:"py-1 px-2 text-gray-500",children:(()=>{if(_t&&_t.type==="number"&&(_t.lower_limit!=null||_t.upper_limit!=null)){let zt="";return _t.lower_limit!=null&&(zt+=` > ${_t.lower_limit}`),_t.lower_limit!=null&&_t.upper_limit!=null&&(zt+=" - "),_t.upper_limit!=null&&(zt+=` < ${_t.upper_limit}`),zt.trim()||"N/A"}else if((_t==null?void 0:_t.type)==="boolean")return"N/A";return(_t==null?void 0:_t.normal_range)||"N/A"})()})]},gt)})})]})}):e.jsx("p",{className:"italic text-gray-500 text-xs",children:"No parameters reported for this test."})]},rt.id)):e.jsx("div",{className:"text-xs prose",children:e.jsx(qa,{remarkPlugins:[Wn],children:K.data.report.report_content})})}catch{return e.jsx("div",{className:"text-xs prose",children:e.jsx(qa,{remarkPlugins:[Wn],children:K.data.report.report_content||"*No findings recorded.*"})})}})()]})]})}}),e.jsx(MF,{isOpen:Cl,onClose:()=>Zo(!1),patientId:f,labInventory:On,fetchPendingLabOrdersData:ci,isLoadingInventory:gn}),e.jsx("div",{ref:De,children:e.jsx(Jf,{title:"Complaints History",items:ia,isLoading:xe||oe,loadingText:"Loading...",noDataText:"No past Hx.",renderItemContent:(K,le)=>e.jsx("div",{className:"ai-context-text w-full",children:bm===K.data.id?e.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[e.jsx("input",{type:"text",value:As,onChange:se=>Ps(se.target.value),className:"border rounded px-2 py-1 text-sm w-full",autoFocus:!0,onKeyDown:async se=>{if(se.key==="Enter"&&As.trim()){zl(!0);try{await Z(`/api/patients/complaints/${K.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:As.trim()})}),K.data.complaint=As.trim(),$r(null),Ps("")}catch(_e){console.error("Error updating complaint:",_e)}zl(!1)}se.key==="Escape"&&($r(null),Ps(""))},disabled:Il}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:async()=>{if(As.trim()){zl(!0);try{await Z(`/api/patients/complaints/${K.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:As.trim()})}),K.data.complaint=As.trim(),$r(null),Ps("")}catch(se){console.error("Error updating complaint:",se)}zl(!1)}},className:"text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",disabled:Il||!As.trim(),children:Il?"Saving...":"Save"}),e.jsx("button",{onClick:()=>{$r(null),Ps("")},className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",disabled:Il,children:"Cancel"})]})]}):e.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 rounded px-1 -mx-1 transition-colors inline-block",onClick:()=>{$r(K.data.id),Ps(K.data.complaint)},title:"Click to edit",children:[K.data.complaint,e.jsxs("span",{className:"text-gray-400 ml-1",children:["(",new Date(K.originalDateString).toLocaleDateString(),")"]})]})}),onDeleteItem:di})}),e.jsxs("div",{className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"ai-context-section-title",children:[e.jsx(vl,{size:16,className:"text-purple-600"})," Clinic-wide System Prompt"]}),!Bl&&e.jsx("button",{onClick:Nc,className:"edit-button",title:"Edit System Prompt",disabled:nd||oi||Pa,children:e.jsx(ys,{size:14})})]}),Bl&&Xt?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:li,onChange:K=>ms(K.target.value),className:"context-edit-textarea",placeholder:"Enter clinic system prompt...",disabled:oi||Pa}),e.jsxs("div",{className:"context-edit-actions",children:[e.jsx("button",{onClick:hd,disabled:oi||Pa,className:"button-secondary",children:"Cancel"}),e.jsxs("button",{onClick:Em,disabled:oi||Pa||Ml===Xt.aiMemory&&li===Xt.clinicWideSystemPrompt,className:"button-primary purple",children:[e.jsx(ks,{size:14,className:"mr-1"}),Pa||oi?"Saving...":"Save Settings"]})]})]}):e.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:Nc,title:"Click to edit system prompt",children:nd?e.jsxs("div",{style:{marginTop:"4px"},children:[e.jsx(U,{width:"100%",height:"14px",style:{marginBottom:"6px"}}),e.jsx(U,{width:"90%",height:"14px",style:{marginBottom:"6px"}}),e.jsx(U,{width:"70%",height:"14px"})]}):Xt!=null&&Xt.clinicWideSystemPrompt?e.jsx(qa,{remarkPlugins:[Wn],children:Xt.clinicWideSystemPrompt}):e.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),!Bl&&(Xt==null?void 0:Xt.clinicWideSystemPromptUpdatedAt)&&e.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Prompt Last Updated: ",new Date(Xt.clinicWideSystemPromptUpdatedAt).toLocaleDateString()]})]}),e.jsxs("div",{ref:qe,className:"ai-context-section",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"ai-context-section-title",children:"Case Summary"}),!O&&e.jsx("button",{onClick:vc,className:"edit-button",title:"Edit Case Summary",disabled:J||Q,children:e.jsx(ys,{size:14})})]}),O?e.jsxs("div",{className:"mt-2",children:[e.jsx("textarea",{value:A,onChange:K=>P(K.target.value),className:"context-edit-textarea",rows:4,placeholder:"Enter case summary...",disabled:Q}),C&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C}),e.jsxs("div",{className:"context-edit-actions",children:[e.jsx("button",{onClick:_m,disabled:Q,className:"button-secondary",children:"Cancel"}),e.jsx("button",{onClick:Dm,disabled:Q||A===E,className:"button-primary blue",children:Q?"Saving...":"Save"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:vc,title:"Click to edit case summary",children:J?e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx(U,{width:"100%",height:"16px",style:{marginBottom:"8px"}}),e.jsx(U,{width:"85%",height:"16px",style:{marginBottom:"8px"}}),e.jsx(U,{width:"65%",height:"16px"})]}):E?e.jsx(qa,{remarkPlugins:[Wn],components:{},children:E}):e.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),z&&e.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Last Edited: ",new Date(z).toLocaleDateString()]})]})]}),ia.length===0&&ts.length===0&&ra.length===0&&!(xe||ti||pe)&&e.jsx("p",{className:"ai-context-text italic mt-4",children:"No recent history for this patient."}),Pr&&e.jsx("p",{className:"text-yellow-600 text-xs mt-2 ai-context-text",children:"Deleting..."}),Xo&&e.jsx("p",{className:"text-red-600 text-xs mt-2 ai-context-text",children:Xo})]})]})})]}),e.jsxs("div",{className:"edit-complaint-input-area",children:[e.jsxs("div",{className:"status-messages-container",children:[We&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:We}),we&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:we}),ni&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:ni}),Ya&&e.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Ya})]}),i&&!I&&e.jsxs(x.Fragment,{children:[ql&&e.jsxs("div",{className:"follow-up-question-container",children:[e.jsx("p",{className:"question-text",children:ql}),Rs.length>0&&e.jsx("div",{className:"options-grid",children:Rs.map((K,le)=>e.jsx("button",{onClick:()=>Bi(K),className:"option-button",children:K},le))})]}),rc&&e.jsx("div",{className:"speech-error-display",children:rc}),Ur&&e.jsxs("div",{className:"selected-file-display",children:[e.jsxs("span",{children:["Selected: ",Ur.name]}),e.jsx("button",{onClick:()=>{Zu(null),Ll.current&&(Ll.current.value="")},className:"remove-file-button",title:"Remove image",children:""})]}),e.jsxs("div",{className:"input-section-selector",children:[e.jsx("button",{onClick:()=>Fs("response"),className:`selector-button ${ns==="response"?"active":""}`,children:"AI"}),e.jsx("button",{onClick:()=>Fs("meds"),className:`selector-button ${ns==="meds"?"active":""}`,children:"Meds"}),e.jsx("button",{onClick:()=>Fs("labs"),className:`selector-button ${ns==="labs"?"active":""}`,children:"Labs"}),e.jsx("button",{onClick:()=>Fs("history"),className:`selector-button ${ns==="history"?"active":""}`,children:"Hx"}),e.jsx("button",{onClick:()=>Fs("summary"),className:`selector-button ${ns==="summary"?"active":""}`,children:"Sum"})]}),e.jsx("div",{className:"input-wrapper",children:e.jsxs("div",{className:"main-input-container",children:[e.jsx("input",{type:"file",ref:Ll,onChange:pd,accept:"image/*",className:"hidden"}),e.jsx("textarea",{ref:ot,className:"complaint-textarea",value:d,onChange:K=>h(K.target.value),onKeyDown:Ui,placeholder:"Name, Age, Sex... Chat with Patient Manager AI",disabled:xa||!i||Mr}),e.jsxs("div",{className:"chat-input-actions-container",children:[f&&e.jsx("button",{onClick:()=>c("/inventory"),disabled:gn,className:"icon-button",title:"View Inventory",children:e.jsx(xl,{size:14})}),e.jsx("button",{type:"button",onClick:fs,disabled:xa||!i||Mr,className:"icon-button",title:"Attach Image",children:e.jsx(Kh,{size:14})}),e.jsx("button",{type:"button",onClick:wc,disabled:xa||!i||!Fl.current,className:`mic-button ${Mr?"listening":""}`,title:Mr?"Stop":"Mic",children:e.jsx(Ru,{size:14})}),e.jsx("button",{onClick:()=>Is(),disabled:xa||!d.trim()||!i||Mr,className:"send-button",title:xa?"Processing...":"Save & Ask AI",children:xa?e.jsx("div",{className:"custom-loader-circle",role:"status","aria-label":"loading"}):e.jsx(dg,{size:14})}),vm&&e.jsx("button",{type:"button",onClick:id,disabled:xa,className:"icon-button text-red-500",title:"Undo Last AI Actions",children:e.jsx(Jt,{size:14})})]})]})})]})]}),ec&&f&&e.jsx(r5,{isOpen:ec,onClose:()=>Ai(!1),onSuccess:()=>{f&&ui(f),Ai(!1),Ka([])},patientId:f,initialItems:tc}),ai&&nc&&e.jsx(l5,{isOpen:ai,onClose:()=>Dl(!1),onSuccess:()=>{f&&ui(f),Dl(!1),Ir(void 0)},medication:nc}),aa&&e.jsx(_S,{isOpen:aa,onClose:()=>{_l(!1),Ir(void 0),Ka([])},onSuccess:()=>{f&&ui(f),_l(!1),Ir(void 0),Ka([])},initialItems:tc,medication:nc,initialPatient:y?{id:y.id,name:y.name,phone:y.phone||"",patient_token_number:String(y.patient_token_number||"")}:void 0})]})},c5=()=>{const{patientId:t}=Fn(),a=ft(),[n,i]=x.useState([]),[l,c]=x.useState(null),[o,d]=x.useState(!1),[h,m]=x.useState(null);x.useEffect(()=>{(async()=>{if(!t){m("Patient ID not provided.");return}d(!0),m(null);try{const y=await Z(`/api/patients/${t}`);if(!y.ok)throw new Error(`Failed to fetch patient details: ${y.status}`);const b=await y.json();c({name:b.name,age:b.age,gender:b.gender});const v=await Z(`/api/patients/${t}/complaints`);if(v.ok){const S=(await v.json()).sort((_,E)=>new Date(E.createdAt).getTime()-new Date(_.createdAt).getTime());i(S)}else if(v.status===404)i([]);else throw new Error(`Failed to fetch complaints: ${v.status}`)}catch(y){console.error("Error fetching past complaints or patient info:",y),m(`Failed to load data. ${y.message}`),i([]),c(null)}finally{d(!1)}})()},[t]);const f=g=>{navigator.clipboard.writeText(g).then(()=>console.log("Complaint copied to clipboard")).catch(y=>console.error("Failed to copy complaint: ",y))};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-1 px-3 rounded text-sm",children:"< Back"}),e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-center flex-grow",children:"Past Complaints"}),e.jsx("div",{className:"w-16"})," "]}),l&&e.jsxs("div",{className:"mb-4 p-2 bg-gray-100 rounded text-center text-sm sm:text-base",children:["Patient: ",e.jsx("strong",{children:l.name})," (",l.age??"N/A"," / ",l.gender??"N/A",")"]}),h&&e.jsxs("div",{className:"text-red-500 p-3 mb-4 border border-red-500 rounded bg-red-50 text-sm",children:["Error: ",h]}),o&&e.jsx("p",{className:"text-center text-gray-500",children:"Loading..."}),!o&&n.length===0&&!h&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No past complaints found for this patient."}),!o&&n.length>0&&e.jsx("div",{className:"space-y-4",children:n.map(g=>e.jsxs("div",{className:"p-3 border rounded shadow-sm bg-white group relative",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:new Date(g.createdAt).toLocaleString()}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:g.complaint}),e.jsx("button",{onClick:()=>f(g.complaint),className:"absolute top-1 right-1 bg-gray-200 hover:bg-gray-300 text-gray-600 text-xs p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Copy complaint text",children:""})]},g.id))})]})};var u5=Object.defineProperty,Jh=Object.getOwnPropertySymbols,DS=Object.prototype.hasOwnProperty,ES=Object.prototype.propertyIsEnumerable,a1=(t,a,n)=>a in t?u5(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,Wg=(t,a)=>{for(var n in a||(a={}))DS.call(a,n)&&a1(t,n,a[n]);if(Jh)for(var n of Jh(a))ES.call(a,n)&&a1(t,n,a[n]);return t},Xg=(t,a)=>{var n={};for(var i in t)DS.call(t,i)&&a.indexOf(i)<0&&(n[i]=t[i]);if(t!=null&&Jh)for(var i of Jh(t))a.indexOf(i)<0&&ES.call(t,i)&&(n[i]=t[i]);return n};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var bl;(t=>{const a=class Bt{constructor(h,m,f,g){if(this.version=h,this.errorCorrectionLevel=m,this.modules=[],this.isFunction=[],h<Bt.MIN_VERSION||h>Bt.MAX_VERSION)throw new RangeError("Version value out of range");if(g<-1||g>7)throw new RangeError("Mask value out of range");this.size=h*4+17;let y=[];for(let v=0;v<this.size;v++)y.push(!1);for(let v=0;v<this.size;v++)this.modules.push(y.slice()),this.isFunction.push(y.slice());this.drawFunctionPatterns();const b=this.addEccAndInterleave(f);if(this.drawCodewords(b),g==-1){let v=1e9;for(let w=0;w<8;w++){this.applyMask(w),this.drawFormatBits(w);const S=this.getPenaltyScore();S<v&&(g=w,v=S),this.applyMask(w)}}l(0<=g&&g<=7),this.mask=g,this.applyMask(g),this.drawFormatBits(g),this.isFunction=[]}static encodeText(h,m){const f=t.QrSegment.makeSegments(h);return Bt.encodeSegments(f,m)}static encodeBinary(h,m){const f=t.QrSegment.makeBytes(h);return Bt.encodeSegments([f],m)}static encodeSegments(h,m,f=1,g=40,y=-1,b=!0){if(!(Bt.MIN_VERSION<=f&&f<=g&&g<=Bt.MAX_VERSION)||y<-1||y>7)throw new RangeError("Invalid value");let v,w;for(v=f;;v++){const D=Bt.getNumDataCodewords(v,m)*8,O=o.getTotalBits(h,v);if(O<=D){w=O;break}if(v>=g)throw new RangeError("Data too long")}for(const D of[Bt.Ecc.MEDIUM,Bt.Ecc.QUARTILE,Bt.Ecc.HIGH])b&&w<=Bt.getNumDataCodewords(v,D)*8&&(m=D);let S=[];for(const D of h){n(D.mode.modeBits,4,S),n(D.numChars,D.mode.numCharCountBits(v),S);for(const O of D.getData())S.push(O)}l(S.length==w);const _=Bt.getNumDataCodewords(v,m)*8;l(S.length<=_),n(0,Math.min(4,_-S.length),S),n(0,(8-S.length%8)%8,S),l(S.length%8==0);for(let D=236;S.length<_;D^=253)n(D,8,S);let E=[];for(;E.length*8<S.length;)E.push(0);return S.forEach((D,O)=>E[O>>>3]|=D<<7-(O&7)),new Bt(v,m,E,y)}getModule(h,m){return 0<=h&&h<this.size&&0<=m&&m<this.size&&this.modules[m][h]}getModules(){return this.modules}drawFunctionPatterns(){for(let f=0;f<this.size;f++)this.setFunctionModule(6,f,f%2==0),this.setFunctionModule(f,6,f%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const h=this.getAlignmentPatternPositions(),m=h.length;for(let f=0;f<m;f++)for(let g=0;g<m;g++)f==0&&g==0||f==0&&g==m-1||f==m-1&&g==0||this.drawAlignmentPattern(h[f],h[g]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(h){const m=this.errorCorrectionLevel.formatBits<<3|h;let f=m;for(let y=0;y<10;y++)f=f<<1^(f>>>9)*1335;const g=(m<<10|f)^21522;l(g>>>15==0);for(let y=0;y<=5;y++)this.setFunctionModule(8,y,i(g,y));this.setFunctionModule(8,7,i(g,6)),this.setFunctionModule(8,8,i(g,7)),this.setFunctionModule(7,8,i(g,8));for(let y=9;y<15;y++)this.setFunctionModule(14-y,8,i(g,y));for(let y=0;y<8;y++)this.setFunctionModule(this.size-1-y,8,i(g,y));for(let y=8;y<15;y++)this.setFunctionModule(8,this.size-15+y,i(g,y));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let h=this.version;for(let f=0;f<12;f++)h=h<<1^(h>>>11)*7973;const m=this.version<<12|h;l(m>>>18==0);for(let f=0;f<18;f++){const g=i(m,f),y=this.size-11+f%3,b=Math.floor(f/3);this.setFunctionModule(y,b,g),this.setFunctionModule(b,y,g)}}drawFinderPattern(h,m){for(let f=-4;f<=4;f++)for(let g=-4;g<=4;g++){const y=Math.max(Math.abs(g),Math.abs(f)),b=h+g,v=m+f;0<=b&&b<this.size&&0<=v&&v<this.size&&this.setFunctionModule(b,v,y!=2&&y!=4)}}drawAlignmentPattern(h,m){for(let f=-2;f<=2;f++)for(let g=-2;g<=2;g++)this.setFunctionModule(h+g,m+f,Math.max(Math.abs(g),Math.abs(f))!=1)}setFunctionModule(h,m,f){this.modules[m][h]=f,this.isFunction[m][h]=!0}addEccAndInterleave(h){const m=this.version,f=this.errorCorrectionLevel;if(h.length!=Bt.getNumDataCodewords(m,f))throw new RangeError("Invalid argument");const g=Bt.NUM_ERROR_CORRECTION_BLOCKS[f.ordinal][m],y=Bt.ECC_CODEWORDS_PER_BLOCK[f.ordinal][m],b=Math.floor(Bt.getNumRawDataModules(m)/8),v=g-b%g,w=Math.floor(b/g);let S=[];const _=Bt.reedSolomonComputeDivisor(y);for(let D=0,O=0;D<g;D++){let M=h.slice(O,O+w-y+(D<v?0:1));O+=M.length;const A=Bt.reedSolomonComputeRemainder(M,_);D<v&&M.push(0),S.push(M.concat(A))}let E=[];for(let D=0;D<S[0].length;D++)S.forEach((O,M)=>{(D!=w-y||M>=v)&&E.push(O[D])});return l(E.length==b),E}drawCodewords(h){if(h.length!=Math.floor(Bt.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let m=0;for(let f=this.size-1;f>=1;f-=2){f==6&&(f=5);for(let g=0;g<this.size;g++)for(let y=0;y<2;y++){const b=f-y,w=(f+1&2)==0?this.size-1-g:g;!this.isFunction[w][b]&&m<h.length*8&&(this.modules[w][b]=i(h[m>>>3],7-(m&7)),m++)}}l(m==h.length*8)}applyMask(h){if(h<0||h>7)throw new RangeError("Mask value out of range");for(let m=0;m<this.size;m++)for(let f=0;f<this.size;f++){let g;switch(h){case 0:g=(f+m)%2==0;break;case 1:g=m%2==0;break;case 2:g=f%3==0;break;case 3:g=(f+m)%3==0;break;case 4:g=(Math.floor(f/3)+Math.floor(m/2))%2==0;break;case 5:g=f*m%2+f*m%3==0;break;case 6:g=(f*m%2+f*m%3)%2==0;break;case 7:g=((f+m)%2+f*m%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[m][f]&&g&&(this.modules[m][f]=!this.modules[m][f])}}getPenaltyScore(){let h=0;for(let y=0;y<this.size;y++){let b=!1,v=0,w=[0,0,0,0,0,0,0];for(let S=0;S<this.size;S++)this.modules[y][S]==b?(v++,v==5?h+=Bt.PENALTY_N1:v>5&&h++):(this.finderPenaltyAddHistory(v,w),b||(h+=this.finderPenaltyCountPatterns(w)*Bt.PENALTY_N3),b=this.modules[y][S],v=1);h+=this.finderPenaltyTerminateAndCount(b,v,w)*Bt.PENALTY_N3}for(let y=0;y<this.size;y++){let b=!1,v=0,w=[0,0,0,0,0,0,0];for(let S=0;S<this.size;S++)this.modules[S][y]==b?(v++,v==5?h+=Bt.PENALTY_N1:v>5&&h++):(this.finderPenaltyAddHistory(v,w),b||(h+=this.finderPenaltyCountPatterns(w)*Bt.PENALTY_N3),b=this.modules[S][y],v=1);h+=this.finderPenaltyTerminateAndCount(b,v,w)*Bt.PENALTY_N3}for(let y=0;y<this.size-1;y++)for(let b=0;b<this.size-1;b++){const v=this.modules[y][b];v==this.modules[y][b+1]&&v==this.modules[y+1][b]&&v==this.modules[y+1][b+1]&&(h+=Bt.PENALTY_N2)}let m=0;for(const y of this.modules)m=y.reduce((b,v)=>b+(v?1:0),m);const f=this.size*this.size,g=Math.ceil(Math.abs(m*20-f*10)/f)-1;return l(0<=g&&g<=9),h+=g*Bt.PENALTY_N4,l(0<=h&&h<=2568888),h}getAlignmentPatternPositions(){if(this.version==1)return[];{const h=Math.floor(this.version/7)+2,m=this.version==32?26:Math.ceil((this.version*4+4)/(h*2-2))*2;let f=[6];for(let g=this.size-7;f.length<h;g-=m)f.splice(1,0,g);return f}}static getNumRawDataModules(h){if(h<Bt.MIN_VERSION||h>Bt.MAX_VERSION)throw new RangeError("Version number out of range");let m=(16*h+128)*h+64;if(h>=2){const f=Math.floor(h/7)+2;m-=(25*f-10)*f-55,h>=7&&(m-=36)}return l(208<=m&&m<=29648),m}static getNumDataCodewords(h,m){return Math.floor(Bt.getNumRawDataModules(h)/8)-Bt.ECC_CODEWORDS_PER_BLOCK[m.ordinal][h]*Bt.NUM_ERROR_CORRECTION_BLOCKS[m.ordinal][h]}static reedSolomonComputeDivisor(h){if(h<1||h>255)throw new RangeError("Degree out of range");let m=[];for(let g=0;g<h-1;g++)m.push(0);m.push(1);let f=1;for(let g=0;g<h;g++){for(let y=0;y<m.length;y++)m[y]=Bt.reedSolomonMultiply(m[y],f),y+1<m.length&&(m[y]^=m[y+1]);f=Bt.reedSolomonMultiply(f,2)}return m}static reedSolomonComputeRemainder(h,m){let f=m.map(g=>0);for(const g of h){const y=g^f.shift();f.push(0),m.forEach((b,v)=>f[v]^=Bt.reedSolomonMultiply(b,y))}return f}static reedSolomonMultiply(h,m){if(h>>>8||m>>>8)throw new RangeError("Byte out of range");let f=0;for(let g=7;g>=0;g--)f=f<<1^(f>>>7)*285,f^=(m>>>g&1)*h;return l(f>>>8==0),f}finderPenaltyCountPatterns(h){const m=h[1];l(m<=this.size*3);const f=m>0&&h[2]==m&&h[3]==m*3&&h[4]==m&&h[5]==m;return(f&&h[0]>=m*4&&h[6]>=m?1:0)+(f&&h[6]>=m*4&&h[0]>=m?1:0)}finderPenaltyTerminateAndCount(h,m,f){return h&&(this.finderPenaltyAddHistory(m,f),m=0),m+=this.size,this.finderPenaltyAddHistory(m,f),this.finderPenaltyCountPatterns(f)}finderPenaltyAddHistory(h,m){m[0]==0&&(h+=this.size),m.pop(),m.unshift(h)}};a.MIN_VERSION=1,a.MAX_VERSION=40,a.PENALTY_N1=3,a.PENALTY_N2=3,a.PENALTY_N3=40,a.PENALTY_N4=10,a.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],a.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],t.QrCode=a;function n(d,h,m){if(h<0||h>31||d>>>h)throw new RangeError("Value out of range");for(let f=h-1;f>=0;f--)m.push(d>>>f&1)}function i(d,h){return(d>>>h&1)!=0}function l(d){if(!d)throw new Error("Assertion error")}const c=class Sn{constructor(h,m,f){if(this.mode=h,this.numChars=m,this.bitData=f,m<0)throw new RangeError("Invalid argument");this.bitData=f.slice()}static makeBytes(h){let m=[];for(const f of h)n(f,8,m);return new Sn(Sn.Mode.BYTE,h.length,m)}static makeNumeric(h){if(!Sn.isNumeric(h))throw new RangeError("String contains non-numeric characters");let m=[];for(let f=0;f<h.length;){const g=Math.min(h.length-f,3);n(parseInt(h.substring(f,f+g),10),g*3+1,m),f+=g}return new Sn(Sn.Mode.NUMERIC,h.length,m)}static makeAlphanumeric(h){if(!Sn.isAlphanumeric(h))throw new RangeError("String contains unencodable characters in alphanumeric mode");let m=[],f;for(f=0;f+2<=h.length;f+=2){let g=Sn.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f))*45;g+=Sn.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f+1)),n(g,11,m)}return f<h.length&&n(Sn.ALPHANUMERIC_CHARSET.indexOf(h.charAt(f)),6,m),new Sn(Sn.Mode.ALPHANUMERIC,h.length,m)}static makeSegments(h){return h==""?[]:Sn.isNumeric(h)?[Sn.makeNumeric(h)]:Sn.isAlphanumeric(h)?[Sn.makeAlphanumeric(h)]:[Sn.makeBytes(Sn.toUtf8ByteArray(h))]}static makeEci(h){let m=[];if(h<0)throw new RangeError("ECI assignment value out of range");if(h<128)n(h,8,m);else if(h<16384)n(2,2,m),n(h,14,m);else if(h<1e6)n(6,3,m),n(h,21,m);else throw new RangeError("ECI assignment value out of range");return new Sn(Sn.Mode.ECI,0,m)}static isNumeric(h){return Sn.NUMERIC_REGEX.test(h)}static isAlphanumeric(h){return Sn.ALPHANUMERIC_REGEX.test(h)}getData(){return this.bitData.slice()}static getTotalBits(h,m){let f=0;for(const g of h){const y=g.mode.numCharCountBits(m);if(g.numChars>=1<<y)return 1/0;f+=4+y+g.bitData.length}return f}static toUtf8ByteArray(h){h=encodeURI(h);let m=[];for(let f=0;f<h.length;f++)h.charAt(f)!="%"?m.push(h.charCodeAt(f)):(m.push(parseInt(h.substring(f+1,f+3),16)),f+=2);return m}};c.NUMERIC_REGEX=/^[0-9]*$/,c.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,c.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let o=c;t.QrSegment=c})(bl||(bl={}));(t=>{(a=>{const n=class{constructor(l,c){this.ordinal=l,this.formatBits=c}};n.LOW=new n(0,1),n.MEDIUM=new n(1,0),n.QUARTILE=new n(2,3),n.HIGH=new n(3,2),a.Ecc=n})(t.QrCode||(t.QrCode={}))})(bl||(bl={}));(t=>{(a=>{const n=class{constructor(l,c){this.modeBits=l,this.numBitsCharCount=c}numCharCountBits(l){return this.numBitsCharCount[Math.floor((l+7)/17)]}};n.NUMERIC=new n(1,[10,12,14]),n.ALPHANUMERIC=new n(2,[9,11,13]),n.BYTE=new n(4,[8,16,16]),n.KANJI=new n(8,[8,10,12]),n.ECI=new n(7,[0,0,0]),a.Mode=n})(t.QrSegment||(t.QrSegment={}))})(bl||(bl={}));var Do=bl;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var d5={L:Do.QrCode.Ecc.LOW,M:Do.QrCode.Ecc.MEDIUM,Q:Do.QrCode.Ecc.QUARTILE,H:Do.QrCode.Ecc.HIGH},TS=128,AS="L",PS="#FFFFFF",RS="#000000",OS=!1,IS=1,h5=4,m5=0,p5=.1;function zS(t,a=0){const n=[];return t.forEach(function(i,l){let c=null;i.forEach(function(o,d){if(!o&&c!==null){n.push(`M${c+a} ${l+a}h${d-c}v1H${c+a}z`),c=null;return}if(d===i.length-1){if(!o)return;c===null?n.push(`M${d+a},${l+a} h1v1H${d+a}z`):n.push(`M${c+a},${l+a} h${d+1-c}v1H${c+a}z`);return}o&&c===null&&(c=d)})}),n.join("")}function FS(t,a){return t.slice().map((n,i)=>i<a.y||i>=a.y+a.h?n:n.map((l,c)=>c<a.x||c>=a.x+a.w?l:!1))}function f5(t,a,n,i){if(i==null)return null;const l=t.length+n*2,c=Math.floor(a*p5),o=l/a,d=(i.width||c)*o,h=(i.height||c)*o,m=i.x==null?t.length/2-d/2:i.x*o,f=i.y==null?t.length/2-h/2:i.y*o,g=i.opacity==null?1:i.opacity;let y=null;if(i.excavate){let v=Math.floor(m),w=Math.floor(f),S=Math.ceil(d+m-v),_=Math.ceil(h+f-w);y={x:v,y:w,w:S,h:_}}const b=i.crossOrigin;return{x:m,y:f,h,w:d,excavation:y,opacity:g,crossOrigin:b}}function g5(t,a){return a!=null?Math.max(Math.floor(a),0):t?h5:m5}function LS({value:t,level:a,minVersion:n,includeMargin:i,marginSize:l,imageSettings:c,size:o,boostLevel:d}){let h=on.useMemo(()=>{const v=(Array.isArray(t)?t:[t]).reduce((w,S)=>(w.push(...Do.QrSegment.makeSegments(S)),w),[]);return Do.QrCode.encodeSegments(v,d5[a],n,void 0,void 0,d)},[t,a,n,d]);const{cells:m,margin:f,numCells:g,calculatedImageSettings:y}=on.useMemo(()=>{let b=h.getModules();const v=g5(i,l),w=b.length+v*2,S=f5(b,o,v,c);return{cells:b,margin:v,numCells:w,calculatedImageSettings:S}},[h,o,c,i,l]);return{qrcode:h,margin:f,cells:m,numCells:g,calculatedImageSettings:y}}var x5=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),cs=on.forwardRef(function(a,n){const i=a,{value:l,size:c=TS,level:o=AS,bgColor:d=PS,fgColor:h=RS,includeMargin:m=OS,minVersion:f=IS,boostLevel:g,marginSize:y,imageSettings:b}=i,w=Xg(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:S}=w,_=Xg(w,["style"]),E=b==null?void 0:b.src,D=on.useRef(null),O=on.useRef(null),M=on.useCallback(J=>{D.current=J,typeof n=="function"?n(J):n&&(n.current=J)},[n]),[A,P]=on.useState(!1),{margin:Q,cells:G,numCells:C,calculatedImageSettings:R}=LS({value:l,level:o,minVersion:f,boostLevel:g,includeMargin:m,marginSize:y,imageSettings:b,size:c});on.useEffect(()=>{if(D.current!=null){const J=D.current,H=J.getContext("2d");if(!H)return;let I=G;const V=O.current,re=R!=null&&V!==null&&V.complete&&V.naturalHeight!==0&&V.naturalWidth!==0;re&&R.excavation!=null&&(I=FS(G,R.excavation));const B=window.devicePixelRatio||1;J.height=J.width=c*B;const k=c/C*B;H.scale(k,k),H.fillStyle=d,H.fillRect(0,0,C,C),H.fillStyle=h,x5?H.fill(new Path2D(zS(I,Q))):G.forEach(function(Ne,Ae){Ne.forEach(function(T,Ce){T&&H.fillRect(Ce+Q,Ae+Q,1,1)})}),R&&(H.globalAlpha=R.opacity),re&&H.drawImage(V,R.x+Q,R.y+Q,R.w,R.h)}}),on.useEffect(()=>{P(!1)},[E]);const z=Wg({height:c,width:c},S);let F=null;return E!=null&&(F=on.createElement("img",{src:E,key:E,style:{display:"none"},onLoad:()=>{P(!0)},ref:O,crossOrigin:R==null?void 0:R.crossOrigin})),on.createElement(on.Fragment,null,on.createElement("canvas",Wg({style:z,height:c,width:c,ref:M,role:"img"},_)),F)});cs.displayName="QRCodeCanvas";var y5=on.forwardRef(function(a,n){const i=a,{value:l,size:c=TS,level:o=AS,bgColor:d=PS,fgColor:h=RS,includeMargin:m=OS,minVersion:f=IS,boostLevel:g,title:y,marginSize:b,imageSettings:v}=i,w=Xg(i,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:S,cells:_,numCells:E,calculatedImageSettings:D}=LS({value:l,level:o,minVersion:f,boostLevel:g,includeMargin:m,marginSize:b,imageSettings:v,size:c});let O=_,M=null;v!=null&&D!=null&&(D.excavation!=null&&(O=FS(_,D.excavation)),M=on.createElement("image",{href:v.src,height:D.h,width:D.w,x:D.x+S,y:D.y+S,preserveAspectRatio:"none",opacity:D.opacity,crossOrigin:D.crossOrigin}));const A=zS(O,S);return on.createElement("svg",Wg({height:c,width:c,viewBox:`0 0 ${E} ${E}`,ref:n,role:"img"},w),!!y&&on.createElement("title",null,y),on.createElement("path",{fill:d,d:`M0,0 h${E}v${E}H0z`,shapeRendering:"crispEdges"}),on.createElement("path",{fill:h,d:A,shapeRendering:"crispEdges"}),M)});y5.displayName="QRCodeSVG";const b5=t=>{if(t===0)return"Zero";const a=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],n=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],i=d=>d===0?"":d<20?a[d]:d<100?n[Math.floor(d/10)]+(d%10?" "+a[d%10]:""):a[Math.floor(d/100)]+" Hundred"+(d%100?" and "+i(d%100):""),l=Math.floor(t),c=Math.round((t-l)*100);let o="";return l>=1e7&&(o+=i(Math.floor(l/1e7))+" Crore "),l>=1e5&&(o+=i(Math.floor(l%1e7/1e5))+" Lakh "),l>=1e3&&(o+=i(Math.floor(l%1e5/1e3))+" Thousand "),l>=100&&(o+=i(Math.floor(l%1e3/100))+" Hundred "),l%100&&(o+=(o?"and ":"")+i(l%100)),o=o.trim()+" Rupees",c>0&&(o+=" and "+i(c)+" Paise"),o+" Only"},j5=t=>{const a=typeof t=="string"?parseInt(t,10):t;return`INV-${String(a).padStart(6,"0")}`},ng=500,s1="defaultConsultationFee",v5=({patientId:t,billId:a,queueId:n,onBillCreated:i,onBillUpdated:l,initialItems:c=[],billType:o="other",relatedId:d,initialStatus:h="pending",initialDiscountPercentage:m=0,readOnlyMode:f=!1,doctorId:g,labOrderId:y,patientInsuranceType:b})=>{const[v,w]=x.useState(null),[S,_]=x.useState([]),E=x.useRef([]),[D,O]=x.useState(""),[M,A]=x.useState(""),[P,Q]=x.useState(1),[G,C]=x.useState(m),[R,z]=x.useState("cash"),[F,J]=x.useState(!1),[H,I]=x.useState(null),[V,re]=x.useState(!1),[B,k]=x.useState(!1),[Ne,Ae]=x.useState(!1),[T,Ce]=x.useState(null),[,Ue]=x.useState([]),[Pe,de]=x.useState(null),[Se,ee]=x.useState(""),[oe,fe]=x.useState("cash"),[ge,q]=x.useState(!1),[W,Y]=x.useState(null),[ie,ce]=x.useState(!1),[pe,He]=x.useState(ng),[We,st]=x.useState(ng.toString()),[me,ve]=x.useState(""),[Fe,Ee]=x.useState(""),[L,ne]=x.useState(""),[xe,ae]=x.useState(""),[we,Le]=x.useState(""),Je=a?"view_pay":"create";x.useEffect(()=>{const Ye=localStorage.getItem(s1),it=Ye?parseFloat(Ye):ng;isNaN(it)||(He(it),st(it.toString()))},[]);const ot=c.length===0;x.useEffect(()=>{t?(async()=>{J(!0),I(null);try{const it=await Z(`/api/patients/${t}`);if(!it.ok){const ht=await it.json().catch(()=>({}));throw new Error(ht.message||"Failed to fetch patient details")}const Ze=await it.json();w(Ze)}catch(it){I(`Failed to load patient details: ${it.message}`),w(null)}finally{J(!1)}})():w(null)},[t]),x.useEffect(()=>{a?(async()=>{Ae(!0),I(null),Ce(null),Ue([]),de(null);try{const it=await Z(`/api/bills/${a}`);if(!it.ok){const ht=await it.json().catch(()=>({}));throw new Error(ht.message||"Failed to fetch bill details")}const Ze=await it.json();if(!Ze.bill||!Ze.payments||!Ze.calculated)throw new Error("Invalid bill details structure.");Ce(Ze.bill),Ue(Ze.payments),de(Ze.calculated),C(Ze.bill.discount_percentage!==void 0&&Ze.bill.discount_percentage!==null?parseFloat(Ze.bill.discount_percentage.toString()):0),Ze.bill.payment_mode&&z(Ze.bill.payment_mode),!v&&Ze.bill.patient_id&&xt(Ze.bill.patient_id.toString())}catch(it){I(`Failed to load bill details: ${it.message}`),Ce(null),Ue([]),de(null)}finally{Ae(!1)}})():(Ce(null),Ue([]),de(null))},[a]),x.useEffect(()=>{(async()=>{try{const it=await Z("/api/clinics/settings");if(!it.ok)throw new Error("Failed to fetch clinic settings");const Ze=await it.json();ve(Ze.upi_id||""),Ee(Ze.name||""),ne(Ze.address||""),ae(Ze.notes||"")}catch(it){console.error("Error fetching clinic settings:",it)}})()},[]);const xt=async Ye=>{J(!0);try{const it=await Z(`/api/patients/${Ye}`);if(!it.ok)throw new Error("Failed to fetch patient");const Ze=await it.json();w(Ze)}catch(it){console.error("Error fetching patient details:",it),w(null)}finally{J(!1)}},be=x.useCallback(async Ye=>{k(!0),I(null);const it=Ye.filter(Ze=>Ze.drug_id!=null).map(async Ze=>{try{const ht=await Z(`/api/drugs/${Ze.drug_id}`);if(!ht.ok)throw new Error(`Drug ${Ze.drug_id} not found.`);const ct=await ht.json();return{...Ze,price:ct.price,total:ct.price*Ze.quantity}}catch{return I(ct=>`${ct?ct+"; ":""}Failed to fetch price for ${Ze.name}`),Ze}});try{const Ze=await Promise.all(it);_(ht=>{const ct=new Map(Ze.map(ut=>[ut.id,ut]));return ht.map(ut=>ct.get(ut.id)||ut)})}catch{}finally{k(!1)}},[Z]);x.useEffect(()=>{if(a){_([]),E.current=[];return}JSON.stringify(c)===JSON.stringify(E.current)||(async()=>{let Ze=[];if(c&&c.length>0)Ze=c.map((ht,ct)=>({...ht,id:`initial-${ct}-${Date.now()}`})),z(h==="paid"?"cash":b==="no_cash_insurance"?"no_cash_insurance":"cash"),C(m),o==="pharmacy"&&!f&&await be(Ze);else if(t&&ot&&o==="consultation"){let ht=pe;if(g)try{const ct=await Z(`/api/staff/${g}`);if(!ct.ok){const Kt=await ct.json().catch(()=>({}));throw new Error(Kt.message||"Doctor not found or error fetching fee")}const ut=await ct.json();ut.opd_fee!=null&&!isNaN(parseFloat(String(ut.opd_fee)))&&parseFloat(String(ut.opd_fee))>=0&&(ht=parseFloat(String(ut.opd_fee)))}catch(ct){I(ut=>`${ut?ut+"; ":""}Could not fetch doctor's fee, using default. (${ct.message})`)}Ze=[{id:Date.now(),name:"Consultation Fee",price:ht,quantity:1,total:ht*1,drug_id:null}],z(b==="no_cash_insurance"?"no_cash_insurance":"cash")}else Ze=[],z(b==="no_cash_insurance"?"no_cash_insurance":"cash");_(Ze),E.current=c})()},[a,t,g,c,o,pe,ot,h,f,be,m,b]);const ue=()=>{const Ye=parseFloat(M);if(!f)if(D&&!isNaN(Ye)&&Ye>=0&&P>0){if(D.trim().toLowerCase()==="consultation fee"&&S.some(Ze=>Ze.name.toLowerCase()==="consultation fee")){alert("Consultation Fee already added.");return}const it={id:Date.now(),name:D.trim(),price:Ye,quantity:P,total:Ye*P,drug_id:null};_([...S,it]),O(""),A(""),Q(1)}else alert("Invalid item details.")},je=Ye=>{f||_(S.filter(it=>it.id!==Ye))},ke=x.useMemo(()=>{let Ye=S.reduce((it,Ze)=>it+Ze.total,0);return Je==="create"&&G>0&&(Ye=Ye*(1-G/100)),(Pe==null?void 0:Pe.totalDue)!==void 0&&(Pe==null?void 0:Pe.totalDue)!==null?Pe.totalDue:Ye},[S,Pe,G,Je]),Me=x.useMemo(()=>S.reduce((Ye,it)=>Ye+it.total,0),[S]),De=x.useMemo(()=>Me*(G/100),[Me,G]),qe=x.useMemo(()=>(Pe==null?void 0:Pe.totalPaid)??0,[Pe]),te=x.useMemo(()=>(Pe==null?void 0:Pe.balance)!==void 0&&(Pe==null?void 0:Pe.balance)!==null?Pe.balance:ke-qe,[Pe,ke,qe]);x.useEffect(()=>{if(ke>0&&me){const Ye=`upi://pay?pa=${me}&pn=${encodeURIComponent(Fe)}&am=${ke.toFixed(2)}&cu=INR`;Le(Ye)}else Le("")},[ke,me,Fe]),x.useEffect(()=>{(async()=>{if(R==="credit"&&t){ce(!0);try{const it=await Z(`/api/patient-debts/${t}/balance`);if(it.ok){const Ze=await it.json();Y(Ze.netDebt||0)}else Y(0)}catch(it){console.error("Error fetching patient debt:",it),Y(0)}finally{ce(!1)}}})()},[R,t]);const Re=()=>{const Ye=parseFloat(We);!isNaN(Ye)&&Ye>=0?(He(Ye),localStorage.setItem(s1,Ye.toString()),alert(`Default Fee set to ${Ye.toFixed(2)}`)):alert("Invalid fee amount.")},lt=async(Ye,it)=>{re(!0),I(null);try{const Ze=await Z("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:it,billId:Ye})}),ht=await Ze.json();if(!Ze.ok||!ht.order)throw new Error(ht.message||"Failed to create Razorpay order.");const{key_id:ct,order:ut}=ht,Kt={key:ct,amount:ut.amount,currency:ut.currency,name:"Newtons Ai HMS Clinic",description:`Bill Payment for Patient ID: ${t}`,order_id:ut.id,handler:async function(ea){try{const ta=await Z("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_payment_id:ea.razorpay_payment_id,razorpay_order_id:ea.razorpay_order_id,razorpay_signature:ea.razorpay_signature,billId:Ye})}),On=await ta.json();if(ta.ok&&On.success)alert("Payment Successful!"),i&&i(Ye),l&&l(),setTimeout(()=>window.print(),200);else throw new Error(On.message||"Payment verification failed.")}catch(ta){I(`Payment verification failed: ${ta.message}. Contact support.`)}finally{re(!1)}},prefill:{name:(v==null?void 0:v.name)||""},notes:{bill_id:Ye,patient_id:t},theme:{color:"#3399cc"},modal:{ondismiss:function(){I("Payment cancelled."),re(!1)}}};if(window.Razorpay)new window.Razorpay(Kt).open();else throw new Error("Razorpay SDK not loaded.")}catch(Ze){I(`Failed to initiate online payment: ${Ze.message}`),re(!1)}},Xe=async()=>{if(!a){I("Bill ID is missing.");return}if(!Se||isNaN(parseFloat(Se))||parseFloat(Se)<=0){I("Please enter a valid positive payment amount.");return}q(!0),I(null);const Ye={amount_paid:parseFloat(Se),payment_mode:oe};try{const it=await Z(`/api/bills/${a}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ye)}),Ze=await it.json();if(!it.ok)throw new Error(Ze.message||`Failed to record payment (Status: ${it.status})`);alert(`Payment of ${Ye.amount_paid.toFixed(2)} recorded.`),ee(""),l?l():console.log("Payment recorded.")}catch(it){I(`Failed to record payment: ${it.message}`)}finally{q(!1)}},dt=async()=>{if(Je==="view_pay")return;if(!t){I("Patient ID is missing for creating a bill.");return}if(S.length===0){I("Cannot finalize an empty bill.");return}re(!0),I(null);const Ye=ke,it=S.map(({id:Ze,...ht})=>ht);if(R==="online"){const Ze={patientId:t,queueId:n||null,items:it,amount:Ye,paymentMode:"online",type:o,related_id:d||y||null,status:"pending",discountPercentage:G,labOrderId:y||null};try{const ht=await Z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ze)}),ct=await ht.json();if(!ht.ok)throw new Error(ct.message||"Failed to create pending bill.");lt(ct.id,Math.round(Ye*100))}catch(ht){I(`Failed to create pending bill: ${ht.message}`),re(!1)}}else{const Ze="paid";if(!R){I("Payment mode required."),re(!1);return}const ht={patientId:t,queueId:n||null,items:it,amount:Ye,paymentMode:R,type:o,related_id:d||y||null,status:Ze,discountPercentage:G,labOrderId:y||null};setTimeout(()=>window.print(),200);try{const ct=await Z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ht)}),ut=await ct.json();if(!ct.ok)throw new Error(ut.message||"Failed to create bill.");if(R==="credit"&&t)try{await Z(`/api/patient-debts/${t}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:Ye,related_bill_id:ut.id,notes:`Bill #${ut.id}`})})}catch(Kt){console.error("Failed to create debt entry:",Kt)}alert("Bill marked as paid!"),i&&i(ut.id),re(!1)}catch(ct){I(`Failed to process bill: ${ct.message}`),re(!1)}}},jt=(T==null?void 0:T.status)??h,At=Je==="view_pay"&&T&&jt==="pending";return!t&&!a?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow text-gray-500",children:"Select patient or provide Bill ID."}):F||Je==="view_pay"&&Ne?e.jsx("div",{className:"p-6 bg-white rounded-lg shadow",children:"Loading..."}):Je==="view_pay"&&!T&&!Ne&&H?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading bill: ",H]}):Je==="create"&&!v&&!F&&H?e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow text-red-600",children:["Error loading patient: ",H]}):e.jsxs("div",{className:"pharmacy-billing-page",children:[" ",e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"TAX INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:Fe?`${Fe}`:"Bill"}),(L||xe)&&e.jsxs("div",{className:"clinic-details-print",children:[L&&e.jsx("span",{className:"small-text clinic-address",children:L}),xe&&e.jsx("span",{className:"small-text clinic-notes",children:xe})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient"]})," ",(v==null?void 0:v.name)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Date"]})," ",new Date().toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})]}),T&&e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"# Invoice"})," ",j5(T.id)]})]})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",v==null?void 0:v.name]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," ID"]})," ",v==null?void 0:v.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Age/Gender"]})," ",(v==null?void 0:v.age)??"N/A"," / ",(v==null?void 0:v.gender)??"N/A"]}),Je==="view_pay"&&T&&e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(kr,{size:16})," Bill ID"]})," ",T.id]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h2",{children:"Bill Items"}),Je==="create"&&o==="pharmacy"&&!f&&S.some(Ye=>Ye.drug_id!=null)&&e.jsxs("button",{onClick:()=>be(S),disabled:B,className:"refresh-prices-button",title:"Refresh item prices from inventory",children:[e.jsx(hg,{size:14,className:`lucide ${B?"animate-spin":""}`}),B?"Refreshing...":"Refresh"]})]}),e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"}),Je==="create"&&!f&&e.jsx("th",{className:"no-print",children:"Action"})]})}),e.jsxs("tbody",{children:[Je==="create"&&S.map((Ye,it)=>e.jsxs("tr",{children:[e.jsx("td",{children:it+1}),e.jsx("td",{children:Ye.name}),e.jsx("td",{children:Ye.quantity}),e.jsxs("td",{children:["",Ye.price.toFixed(2)]}),e.jsxs("td",{children:["",Ye.total.toFixed(2)]}),!f&&e.jsx("td",{className:"no-print",children:typeof Ye.id=="number"&&Ye.name!=="Consultation Fee"?e.jsxs("button",{onClick:()=>je(Ye.id),className:"remove-item-button",title:"Remove",children:[" ",e.jsx(St,{size:16})," "]}):e.jsxs("span",{className:"lock-icon",title:"Cannot remove",children:[" ",e.jsx(wC,{size:14})," "]})})]},Ye.id)),Je==="view_pay"&&T&&T.items.map((Ye,it)=>e.jsxs("tr",{children:[e.jsx("td",{children:it+1}),e.jsx("td",{children:Ye.name}),e.jsx("td",{children:Ye.quantity}),e.jsxs("td",{children:["",Ye.price.toFixed(2)]}),e.jsxs("td",{children:["",(Ye.total??Ye.price*Ye.quantity).toFixed(2)]})]},it)),(Je==="create"&&S.length===0||Je==="view_pay"&&(T==null?void 0:T.items.length)===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",padding:"20px"},children:"No items added."})})]})]}),Je==="create"&&!f&&e.jsxs("div",{className:"add-item-form no-print",style:{padding:"15px",borderTop:"1px solid #eee"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Item Description"}),e.jsx("input",{type:"text",value:D,onChange:Ye=>O(Ye.target.value),placeholder:"Service Name",className:"custom-text-input"})]}),e.jsxs("div",{className:"form-group",style:{maxWidth:"80px"},children:[e.jsx("label",{children:"Qty"}),e.jsx("input",{type:"number",min:"1",value:P,onChange:Ye=>Q(parseInt(Ye.target.value)||1),placeholder:"1",className:"custom-text-input"})]}),e.jsxs("div",{className:"form-group",style:{maxWidth:"100px"},children:[e.jsx("label",{children:"Price ()"}),e.jsx("input",{type:"number",value:M,onChange:Ye=>A(Ye.target.value),placeholder:"0.00",className:"custom-text-input"})]}),e.jsx("button",{onClick:ue,className:"add-item-button",children:"Add Item"}),o==="consultation"&&e.jsxs("div",{className:"default-fee-section",style:{marginLeft:"auto",display:"flex",alignItems:"flex-end",gap:"5px"},children:[e.jsxs("div",{className:"form-group",style:{marginBottom:0},children:[e.jsx("label",{children:"Default Fee"}),e.jsx("input",{type:"number",value:We,onChange:Ye=>st(Ye.target.value),style:{width:"80px",padding:"10px",borderRadius:"6px",border:"1px solid #ccc"}})]}),e.jsx("button",{onClick:Re,className:"secondary-button",style:{padding:"10px"},children:e.jsx(ks,{size:16})})]})]})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Me.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Discount (",G,"%)"]}),e.jsxs("span",{children:["- ",De.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",ke.toFixed(2)]})})]}),we&&e.jsxs("div",{className:"qr-code-container qr-code-printable-section",children:[e.jsx(cs,{value:we,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Me.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount"}),Je==="create"&&!f?e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:G,onChange:Ye=>C(parseFloat(Ye.target.value)||0),min:"0",max:"100",className:"discount-input-total"}),"%"]}):e.jsxs("span",{children:[G,"%"]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Amount"}),e.jsxs("span",{children:["- ",De.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",ke.toFixed(2)]})]}),Je==="view_pay"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"summary-row",style:{color:"green"},children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{children:["",qe.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",style:{color:"red",fontWeight:"bold"},children:[e.jsx("span",{children:"Balance Due"}),e.jsxs("span",{children:["",te.toFixed(2)]})]})]}),e.jsx("div",{className:"qr-code-container",children:we?e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:we,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available."})}),Je==="create"&&e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:R,onChange:Ye=>z(Ye.target.value),className:"payment-mode-select",disabled:f||V,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt to Patient)"}),e.jsx("option",{value:"online",children:"Online (Razorpay)"})]})]}),Je==="create"&&R==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:" Debt to Patient"}),ie?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:W&&W>0?"#dc3545":"#28a745"},children:["",(W||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ",ke.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["",((W||0)+ke).toFixed(2)]})]})]})]}),Je==="create"&&!f&&e.jsx("div",{className:"bill-actions",children:e.jsx("button",{onClick:dt,className:"primary-button",disabled:V||S.length===0,children:V?"Processing...":"Finalise and Bill"})}),Je==="view_pay"&&e.jsxs("div",{className:"bill-actions",children:[e.jsx("button",{onClick:()=>window.print(),className:"secondary-button",children:"Print Bill"}),At&&te>0&&e.jsxs("div",{className:"payment-recording-section",style:{marginTop:"20px",borderTop:"1px dashed #ccc",paddingTop:"15px"},children:[e.jsx("h3",{style:{fontSize:"1em",marginBottom:"10px"},children:"Record Payment"}),e.jsxs("div",{style:{display:"flex",gap:"5px",marginBottom:"10px"},children:[e.jsx("input",{type:"number",value:Se,onChange:Ye=>ee(Ye.target.value),placeholder:"Amount",className:"custom-text-input",style:{flex:1}}),e.jsxs("select",{value:oe,onChange:Ye=>fe(Ye.target.value),className:"custom-select-input",style:{width:"auto"},children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),e.jsx("button",{onClick:Xe,disabled:ge,className:"primary-button",style:{width:"100%",fontSize:"0.9em"},children:ge?"Recording...":"Record Payment"})]})]})]})})]}),e.jsxs("div",{className:"amount-in-words-print print-only",children:[e.jsx("strong",{children:"Amount in Words:"})," ",b5(Je==="view_pay"&&T?T.amount:ke)]}),e.jsxs("div",{className:"terms-conditions-print print-only",children:[e.jsx("h4",{children:"Terms & Conditions"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Goods once sold will not be taken back or exchanged."}),e.jsx("li",{children:"All disputes are subject to local jurisdiction."}),e.jsx("li",{children:"Please retain this bill for future reference."})]})]}),e.jsxs("div",{className:"signature-section-print print-only",children:[e.jsx("div",{className:"receiver-sign",children:e.jsx("div",{className:"sign-line",children:"Receiver's Signature"})}),e.jsxs("div",{className:"authorized-sign",children:[e.jsxs("div",{className:"for-clinic",children:["For ",Fe||"Clinic"]}),e.jsx("div",{className:"sign-line",children:"Authorised Signatory"})]})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{className:"thank-you",children:"Thank you for your visit!"}),e.jsx("p",{className:"computer-generated",children:"This is a computer generated invoice and does not require a physical signature."})]})]})]})},N5=()=>{const t=ft(),a=Qa(),{patientId:n,queueId:i,patientName:l,initialItems:c,billType:o,relatedId:d,initialStatus:h,initialDiscountPercentage:m,doctorId:f,billId:g,labOrderId:y}=a.state||{},[b,v]=x.useState(null),[w,S]=x.useState(null),[_,E]=x.useState(null),[D,O]=x.useState(null),[M,A]=x.useState(null),[P,Q]=x.useState(null),[G,C]=x.useState(null),[R,z]=x.useState(null),[F,J]=x.useState(!0),[H,I]=x.useState(null),[V,re]=x.useState(l||"");x.useEffect(()=>{if(!n){console.error("BillingPage loaded without required patientId in location state."),t("/");return}(async()=>{J(!0),I(null);try{let Ce=n,Ue=c||null,Pe=h||null,de=o||null,Se=d||null,ee=m!==void 0?parseFloat(m):null,oe=l||null,fe=null;if(g){console.log(`Fetching details for Bill ID: ${g}`);const ge=await Z(`/api/bills/${g}`);if(!ge.ok){const W=await ge.json().catch(()=>({message:`Failed to fetch bill details for ID ${g}`}));throw new Error(W.message||`Failed to fetch bill details (Status: ${ge.status})`)}const q=await ge.json();if(console.log("Fetched Bill Data:",q),Ue=q.bill.items||[],Pe=q.bill.status||"pending",de=q.bill.type||null,Se=q.bill.related_id||null,ee=q.bill.discount_percentage!==void 0&&q.bill.discount_percentage!==null?parseFloat(q.bill.discount_percentage):0,Ce=q.bill.patient_id,O(Ue),A(Pe),Q(de),C(Se),z(ee),Ce){const W=await Z(`/api/patients/${Ce}`);if(W.ok){const Y=await W.json();oe=Y.name,fe=Y.phone??null,E(Y.insurance_type??null),re(oe),S(fe)}else console.warn(`Could not fetch patient details for ID ${Ce} from bill.`),re("Patient (Not Found)")}else console.warn(`Bill ${g} does not have an associated patient_id.`),re("Patient (Unknown)")}else if(y){console.log(`Fetching details for Lab Order ID: ${y}`);const ge=await Z(`/api/lab/${y}`);if(!ge.ok){let W=`Failed to fetch lab order details (Status: ${ge.status} ${ge.statusText})`;try{W=(await ge.json()).message||W}catch{console.error("Response was not valid JSON:",await ge.text())}throw new Error(W)}const q=await ge.json();if(console.log("Fetched Lab Order Data:",JSON.stringify(q,null,2)),Ue=(q.tests||[]).filter(W=>W&&typeof W.name=="string"&&W.price!==void 0&&W.id!==void 0).map(W=>{const Y=parseFloat(W.price||"0"),ie=!isNaN(Y)&&isFinite(Y)?Y:0;return{item_id:W.id,name:W.name,price:ie,quantity:1,total:ie*1,type:"lab_test"}}),Ue&&Ue.length===0&&(q.tests||[]).length>0&&(console.warn("Warning: Some tests from the lab order were filtered out due to missing id, name, or price.",q.tests),I(W=>`${W?W+"; ":""}Warning: Some lab items could not be added to the bill due to missing details.`)),Pe="pending",de="lab",Se=y,Ce=q.patient_id,O(Ue),A(Pe),Q(de),C(Se),Ce){const W=await Z(`/api/patients/${Ce}`);if(W.ok){const Y=await W.json();oe=Y.name,fe=Y.phone??null,E(Y.insurance_type??null),re(oe),S(fe)}else console.warn(`Could not fetch patient details for ID ${Ce} from lab order.`),re("Patient (Not Found)")}else console.warn(`Lab Order ${y} does not have an associated patient_id.`),re("Patient (Unknown)")}else if(O(c||null),A(h||null),Q(o||null),C(d||null),z(m!==void 0?parseFloat(m):null),re(l||`ID ${n}`),Ce){const ge=await Z(`/api/patients/${Ce}`);if(ge.ok){const q=await ge.json();S(q.phone??null),E(q.insurance_type??null)}else console.warn(`Could not fetch patient details for ID ${Ce}.`)}if(i){const ge=await Z(`/api/queue/${i}`);if(ge.ok){const q=await ge.json();v(q.token_number)}else console.warn(`Could not fetch queue details for ID ${i}.`)}}catch(Ce){console.error("Error fetching billing page details:",Ce),I(`Failed to load details: ${Ce.message}`),O(null),A(null),Q(null),C(null),re(l||""),S(null),v(null)}finally{J(!1)}})()},[n,g,y,i,t]);const B=T=>{console.log(`Billing process completed for patient ID ${n}. New Bill ID: ${T}`),t(-1)},k=()=>{console.log(`Bill updated for patient ID ${n}.`),t(-1)};if(!n)return e.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-gray-600",children:[e.jsx(Hj,{size:48,className:"mb-4 text-red-500"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Missing Patient Information"}),e.jsx("p",{className:"text-sm",children:"Cannot load the billing page without a patient ID."}),e.jsx("button",{onClick:()=>t("/"),className:"mt-4 px-4 py-2 bg-teal-600 text-white rounded hover:bg-teal-700",children:"Go to Dashboard"})]});if(F)return e.jsxs("div",{className:"billing-page-container",children:[e.jsx("div",{className:"back-button-container",children:e.jsx(U,{width:80,height:32})}),e.jsxs("div",{className:"billing-content-wrapper",children:[e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx(U,{width:300,height:32})}),e.jsxs("div",{className:"patient-info-bar mb-6",style:{display:"flex",gap:"1rem",padding:"10px",background:"#f9fafb",borderRadius:"8px"},children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:120,height:20}),e.jsx(U,{width:140,height:20})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 space-y-4",children:[e.jsx(U,{width:"100%",height:200,className:"rounded-lg"}),e.jsx(U,{width:"100%",height:150,className:"rounded-lg"})]}),e.jsx("div",{className:"space-y-4",children:e.jsx(U,{width:"100%",height:300,className:"rounded-lg"})})]})]})]});if(H)return e.jsxs("div",{className:"min-h-screen bg-neutral-light flex flex-col items-center justify-center text-red-600 p-4",children:[e.jsx(Hj,{size:48,className:"mb-4"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Error Loading Billing Details"}),e.jsx("p",{className:"text-sm text-center mb-4",children:H}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Retry"}),e.jsx("button",{onClick:()=>t(-1),className:"mt-2 text-sm text-gray-600 hover:text-teal-700",children:"Go Back"})]});const Ae=(M??h)==="paid";return e.jsxs("div",{className:"billing-page-container",children:[e.jsx("div",{className:"back-button-container",children:e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Go Back",children:[e.jsx(Et,{size:20,className:"lucide"})," Back"]})}),e.jsxs("div",{className:"billing-content-wrapper",children:[e.jsxs("h3",{className:"billing-page-title",children:[g?"Bill Details":y?"Create Lab Bill":"Create Bill"," for Patient: ",V||`ID ${n}`]}),e.jsxs("div",{className:"patient-info-bar",children:[b!==null&&e.jsxs("span",{children:[e.jsx(Ns,{size:14,className:"lucide"})," Token: ",b]}),w&&e.jsxs("span",{children:[e.jsx(nx,{size:14,className:"lucide"})," Phone: ",w]}),y&&e.jsxs("span",{className:"lab-order-info",children:[e.jsx(Cs,{size:14,className:"lucide"})," Lab Order: ",y.substring(0,8),"..."]}),!w&&b===null&&!y&&e.jsx("span",{className:"placeholder-text",children:"(Token/Phone not available)"}),_&&e.jsxs("span",{className:"insurance-info",children:[e.jsx(SC,{size:14,className:"lucide"})," Insurance: ",_.replace(/_/g," ").replace(/\b\w/g,T=>T.toUpperCase())]}),!w&&b===null&&!y&&!_&&e.jsx("span",{className:"placeholder-text",children:"(Token/Phone not available)"})]}),e.jsx(v5,{patientId:n,labOrderId:y,queueId:i,onBillCreated:B,onBillUpdated:k,initialItems:D??c,billType:P??o,relatedId:G??d,initialStatus:M??h,initialDiscountPercentage:R??m,readOnlyMode:Ae,doctorId:f,patientInsuranceType:_??void 0})]})]})},w5=()=>{const{patientId:t}=Fn(),a=ft(),[n,i]=x.useState([]),[l,c]=x.useState(!1),[o,d]=x.useState(null),[h,m]=x.useState("");return x.useEffect(()=>{(async()=>{if(!t){d("Patient ID not provided in URL.");return}c(!0),d(null),i([]);try{try{const b=await Z(`/api/patients/${t}`);if(b.ok){const v=await b.json();m(v.name)}}catch(b){console.warn("Could not fetch patient name:",b)}console.log(`Fetching pharmacy orders for patient ID: ${t}`);const g=await Z(`/api/pharmacy-orders/patient/${t}`);if(!g.ok){const b=await g.json().catch(()=>({}));throw new Error(b.message||`HTTP error! status: ${g.status}`)}const y=await g.json();console.log("Fetched Pharmacy Orders:",y),i(y||[])}catch(g){console.error("Error fetching pharmacy orders:",g),d(`Failed to load pharmacy orders: ${g.message}`)}finally{c(!1)}})()},[t]),e.jsxs("div",{className:"p-4 md:p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 border-b pb-3",children:[e.jsxs("button",{onClick:()=>a(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(Et,{size:16,className:"mr-1"}),"Back"]}),e.jsxs("h2",{className:"text-xl font-semibold text-gray-800 flex items-center",children:[e.jsx(xl,{size:20,className:"mr-2 text-purple-600"}),"Pharmacy Order History ",h&&`for ${h}`]}),e.jsx("div",{})," "]}),l&&e.jsx("div",{className:"space-y-4",children:[1,2,3].map(f=>e.jsxs("div",{className:"p-4 border rounded bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(U,{width:150,height:20}),e.jsx(U,{width:100,height:20})]}),e.jsx(U,{width:200,height:20,className:"mb-2"}),e.jsx(U,{width:180,height:20,className:"mb-3"}),e.jsx(U,{width:120,height:24,className:"mb-2"}),e.jsxs("div",{className:"space-y-1 ml-4",children:[e.jsx(U,{width:"80%",height:16}),e.jsx(U,{width:"70%",height:16}),e.jsx(U,{width:"60%",height:16})]})]},f))}),o&&e.jsx("p",{className:"text-center text-red-500 bg-red-100 p-3 rounded border border-red-300",children:o}),!l&&n.length===0&&!o&&e.jsx("p",{className:"text-center text-gray-500",children:"No pharmacy orders found for this patient."}),!l&&n.length>0&&e.jsx("div",{className:"space-y-4",children:n.map(f=>e.jsxs("div",{className:"p-4 border rounded bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",new Date(f.date).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm font-medium capitalize",children:[e.jsx("strong",{children:"Status:"})," ",f.status]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Prescribed By:"})," ",f.prescribedBy||"N/A"]}),f.dispensedBy&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Dispensed By:"})," ",f.dispensedBy]}),e.jsx("h4",{className:"text-md font-semibold mt-3 mb-1",children:"Medications:"}),e.jsx("ul",{className:"list-disc list-inside ml-4 text-sm text-gray-700 space-y-1",children:f.medications.map((g,y)=>e.jsxs("li",{children:[g.name," - Qty: ",g.quantity,g.tabletsPerDay&&` (${g.tabletsPerDay} per day`,g.numberOfDays&&` for ${g.numberOfDays} days)`,!g.tabletsPerDay&&g.numberOfDays&&` (for ${g.numberOfDays} days)`,g.tabletsPerDay&&!g.numberOfDays&&")"]},y))})]},f.id))})]})},S5=()=>{const t=ft(),a=Qa(),[n,i]=x.useState(null),[l,c]=x.useState([]),[o,d]=x.useState([]),[h,m]=x.useState(""),[f,g]=x.useState([]),[y,b]=x.useState(null),[v,w]=x.useState(!1),[S,_]=x.useState(null),[E,D]=x.useState(!0),[O,M]=x.useState(""),[A,P]=x.useState([]),[Q,G]=x.useState(!1),[C,R]=x.useState(null),[z,F]=x.useState(!1),[J,H]=x.useState(!1),[I,V]=x.useState([]),[re,B]=x.useState(!1),[k,Ne]=x.useState(null),Ae=/^\+?[0-9\s\-().]{7,20}$/,T=/^[a-zA-Z\s'-]{2,}$/,Ce=x.useCallback(async()=>{try{const me=await Z("/api/drugs");if(!me.ok)throw new Error("Failed to fetch drugs");const ve=await me.json(),Fe=ve.drugs||ve||[];c(Fe)}catch(me){console.error("Failed to fetch available drugs:",me),b("Could not load drug list. "+me.message)}},[]),Ue=x.useCallback(async me=>{B(!0),Ne(null);try{const ve=await Z(`/api/pharmacy-orders/patient/${me}`);if(!ve.ok){const Ee=await ve.json().catch(()=>({}));throw new Error(Ee.message||`HTTP error! status: ${ve.status}`)}const Fe=await ve.json();V(Fe||[])}catch(ve){console.error("Failed to fetch previous pharmacy orders:",ve),Ne(`Could not load previous orders: ${ve.message}`)}finally{B(!1)}},[]);x.useEffect(()=>{var me;Ce(),(me=a.state)!=null&&me.patient?ee(a.state.patient):D(!0)},[Ce,a.state]),x.useEffect(()=>{n!=null&&n.id?Ue(n.id):V([])},[n,Ue]);const Pe=x.useMemo(()=>new Da(l,{keys:["name","brand_name"],threshold:.3}),[l]);x.useEffect(()=>{if(!h){g([]);return}const me=Pe.search(h).map(ve=>ve.item);g(me.slice(0,10))},[h,Pe]);const de=x.useMemo(()=>$u(async me=>{if(me.trim().length<2){P([]),G(!1),R(null);return}G(!0),R(null);try{const ve=new URLSearchParams({search:encodeURIComponent(me),page:"1",limit:"10",sortBy:"name",sortOrder:"asc"}),Fe=await Z(`/api/patients?${ve.toString()}`);if(!Fe.ok){const L=await Fe.text();throw new Error(`API Error (${Fe.status}): ${L||Fe.statusText}`)}const Ee=await Fe.json();P(Ee.patients)}catch(ve){console.error("Error searching patients:",ve),R(ve.message||"Failed to search patients."),P([])}finally{G(!1)}},300),[Ae]),Se=me=>{const ve=me.target.value;M(ve),F(Ae.test(ve)),H(T.test(ve)&&!Ae.test(ve)),G(!0),de(ve)},ee=x.useCallback(me=>{i(me),D(!1),M(""),P([]),R(null)},[]),oe=x.useCallback(async me=>{if(!O||me==="phone"&&!z||me==="name"&&!J){R(`Invalid ${me} to create a new patient.`);return}G(!0),R(null);try{const Fe=await Z("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:me==="name"?O:"direct pharmacy",phone:me==="phone"?O:null,age:null,gender:null,token:null})});if(!Fe.ok){const L=await Fe.json();throw new Error(L.message||`Failed to create patient: ${Fe.statusText}`)}const Ee=await Fe.json();alert(`New patient "${Ee.name}" created with ${me==="phone"?`phone ${Ee.phone}`:`name ${Ee.name}`}.`),ee(Ee)}catch(ve){console.error("Error creating new patient:",ve),R(ve.message||"Failed to create new patient.")}finally{G(!1)}},[O,z,J,ee]),fe=()=>{i(null),D(!0),d([]),b(null),V([])},ge=me=>{if(o.some(ve=>ve.drug_id===me.id)){const ve=me.name||me.brand_name||"This drug";b(`${ve} is already in the order.`),setTimeout(()=>b(null),3e3),m(""),g([]);return}d(ve=>[...ve,{drug_id:me.id,name:me.name||me.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,tabletsPerDay:1,numberOfDays:1,mrp:Number(me.mrp)||0,originalMrp:Number(me.mrp)||0,stock:me.stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(me.mrp)||0)/(W(me.pack)||1),pack:me.pack}]),m(""),g([])},q=()=>{const me=h.trim();if(!me){b("Please enter a drug name to navigate to the add drug page."),setTimeout(()=>b(null),3e3);return}t("/dashboard/inventory/add",{state:{initialDrugName:me}}),m(""),g([])},W=me=>{if(!me)return null;const ve=me.match(/(?:\d+x)?(\d+)/);return ve?parseInt(ve[1],10):null},Y=me=>{d(ve=>ve.filter(Fe=>(Fe.drug_id??Fe.name)!==me))},ie=(me,ve)=>{d(Fe=>Fe.map(Ee=>{if((Ee.drug_id??Ee.name)===me&&Ee.isLoose){const ne=W(Ee.pack),xe=Math.max(0,ve),ae=xe*(ne??1)+(Ee.looseUnits??0);return{...Ee,loosePacks:xe,looseQuantity:ae,pack_quantity:xe}}return Ee}))},ce=(me,ve)=>{d(Fe=>Fe.map(Ee=>{if((Ee.drug_id??Ee.name)===me&&Ee.isLoose){const ne=W(Ee.pack),xe=Math.max(0,ve),ae=(Ee.loosePacks??0)*(ne??1)+xe;return{...Ee,looseUnits:xe,looseQuantity:ae}}return Ee}))},pe=me=>{const ve=[];me.medications.forEach(Fe=>{if(o.find(L=>L.drug_id&&Fe.drug_id&&L.drug_id===Fe.drug_id||L.name.toLowerCase()===Fe.name.toLowerCase()))d(L=>L.map(ne=>{if(ne.drug_id&&Fe.drug_id&&ne.drug_id===Fe.drug_id||ne.name.toLowerCase()===Fe.name.toLowerCase()){const xe=(ne.pack_quantity??0)+(Fe.pack_quantity??0),ae=(ne.loose_quantity??0)+(Fe.loose_quantity??0),we=Fe.tabletsPerDay??ne.tabletsPerDay,Le=Fe.numberOfDays??ne.numberOfDays,Je=W(ne.pack),ot=xe*(Je??1)+ae;return{...ne,pack_quantity:xe,loose_quantity:ae,directions_to_use:Fe.directions_to_use??ne.directions_to_use,tabletsPerDay:we,numberOfDays:Le,looseQuantity:ot,loosePacks:Math.floor(ot/(Je??1)),looseUnits:ot%(Je??1)}}return ne}));else{let L=Fe.drug_id,ne=Fe.drug_id?l.find(xe=>xe.id===Fe.drug_id):void 0;if(!L&&Fe.name){const xe=l.find(ae=>ae.name&&ae.name.toLowerCase()===Fe.name.toLowerCase());xe&&(L=xe.id,ne=xe)}ve.push({drug_id:L,name:Fe.name,pack_quantity:Fe.pack_quantity??0,loose_quantity:Fe.loose_quantity??0,directions_to_use:Fe.directions_to_use,tabletsPerDay:Fe.tabletsPerDay??1,numberOfDays:Fe.numberOfDays??1,mrp:ne?ne.mrp:Fe.pack_price,originalMrp:ne?ne.mrp:Fe.pack_price,stock:ne?ne.stock:Fe.stock,isLoose:!0,loosePacks:0,looseUnits:(Fe.pack_quantity??0)*(W((ne==null?void 0:ne.pack)||Fe.pack)??1)+(Fe.loose_quantity??0),looseQuantity:(Fe.pack_quantity??0)*(W((ne==null?void 0:ne.pack)||Fe.pack)??1)+(Fe.loose_quantity??0),pricePerLooseUnit:(ne?Number(ne.mrp):Number(Fe.pack_price)||0)/(W((ne==null?void 0:ne.pack)||Fe.pack)||1),pack:(ne==null?void 0:ne.pack)||Fe.pack})}}),d(Fe=>[...Fe,...ve]),me.prescriptionForUnavailableDrugs&&(!S||!S.includes(me.prescriptionForUnavailableDrugs))&&_(Fe=>Fe?`${Fe}

-- From Order ${me.id.substring(0,8)} --
${me.prescriptionForUnavailableDrugs}`:me.prescriptionForUnavailableDrugs),b("Medications from previous order added to current order."),setTimeout(()=>b(null),3e3)},He=async me=>{if(me.preventDefault(),b(null),w(!0),!n){b("No patient selected for the order."),w(!1);return}if(o.length===0&&!(S!=null&&S.trim())){b("Please add at least one medication or provide a prescription for unavailable drugs."),w(!1);return}const ve=o.filter(Ee=>{const L=Ee.looseQuantity??0;return L<=0||Ee.stock!==void 0&&L>Ee.stock});if(ve.length>0){b(`Invalid quantity or insufficient stock for: ${ve.map(Ee=>Ee.name).join(", ")}`),w(!1);return}const Fe={patient_id:n.id,items:o.map(Ee=>{const L=Ee.mrp??0,ne=Ee.pricePerLooseUnit??0,xe=ne*(Ee.looseQuantity??0);return{drug_id:Ee.drug_id===void 0?null:Ee.drug_id,name:Ee.name,pack_quantity:Ee.loosePacks??0,loose_quantity:Ee.looseUnits??0,pack_price:L,loose_price:ne,total_price:xe,price:Ee.originalMrp??0,directions_to_use:Ee.directions_to_use===void 0?null:Ee.directions_to_use,tabletsPerDay:Ee.tabletsPerDay??1,numberOfDays:Ee.numberOfDays??1}}),order_total:We,prescription_for_unavailable_drugs:S};try{const Ee=await Z("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Fe)});if(!Ee.ok){const L=await Ee.json();throw new Error(L.message||`Failed to create order: ${Ee.statusText}`)}alert(`Pharmacy order created successfully for ${n.name}!`),t(-1)}catch(Ee){console.error("Failed to create pharmacy order:",Ee),b(Ee.message||"Failed to create order. Please try again.")}finally{w(!1)}},We=x.useMemo(()=>o.reduce((me,ve)=>{const Fe=ve.isLoose?ve.pricePerLooseUnit??0:ve.mrp??0,Ee=ve.isLoose?ve.looseQuantity??0:ve.quantity??0;return me+Fe*Ee},0),[o]),st=(Number(We)||0).toFixed(2);return e.jsxs("div",{className:"add-pharmacy-order-page p-4 md:p-6 max-w-5xl mx-auto",children:[" ",e.jsxs("div",{className:"page-header flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 pb-4",children:[" ",e.jsxs("div",{className:"flex items-center mb-2 sm:mb-0",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button p-2 rounded-full mr-3",title:"Go Back",children:[e.jsx(Et,{size:20})," "]}),e.jsx("h2",{className:"text-2xl",children:"Create New Pharmacy Order"})," "]})]}),E&&e.jsxs("div",{className:"content-section",children:[" ",e.jsx("h3",{className:"section-title",children:"Select Patient"})," ",e.jsxs("div",{className:"mb-3 relative",children:[e.jsx("label",{htmlFor:"patient-search",className:"form-label",children:"Search Patient (Name, Token, or Phone)"})," ",e.jsx("input",{type:"text",id:"patient-search",placeholder:"Search by Name, Token No, or Phone No (min 2 chars)...",value:O,onChange:Se,className:"custom-text-input mt-1",autoFocus:!0})]}),C&&e.jsx("div",{className:"ai-function-status error mb-3 p-3",children:C})," ",Q?e.jsx("div",{className:"patient-search-results items-loading mt-1",children:[1,2,3].map(me=>e.jsx("div",{className:"px-4 py-3 border-b border-gray-100 last:border-0",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx(U,{width:40,height:20}),e.jsx(U,{width:120,height:20})]}),e.jsx("div",{className:"mt-1 sm:mt-0",children:e.jsx(U,{width:150,height:16})})]})},me))}):A.length>0&&e.jsxs("div",{className:"patient-search-results max-h-64 overflow-y-auto rounded-md shadow-sm mt-1 z-10",children:[" ",e.jsxs("ul",{children:[" ",A.map(me=>e.jsxs("li",{onClick:()=>ee({id:me.id,name:me.name,token:me.token,age:me.age,gender:me.gender,phone:me.phone}),children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center",children:[e.jsxs("div",{className:"font-medium",children:[e.jsxs("span",{className:"patient-token mr-2",children:["#",me.token]}),me.name]}),e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:mt-0",children:[me.age?`${me.age} yrs`:"Age N/A",me.gender?` / ${me.gender}`:" / Gender N/A",me.phone&&e.jsxs("span",{className:"hidden sm:inline",children:[" / ",me.phone]})]})]}),me.phone&&e.jsxs("div",{className:"patient-details-text text-xs mt-1 sm:hidden",children:["Phone: ",me.phone]})]},me.id))]})]}),O.length>=2&&!Q&&A.length===0&&!C&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-400 mt-2 text-sm",children:['No patients found matching "',O,'".']}),z&&e.jsx("button",{type:"button",onClick:()=>oe("phone"),className:"create-patient-button mt-3 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",disabled:Q,children:'Create "direct pharmacy" Patient with this Phone'}),J&&e.jsx("button",{type:"button",onClick:()=>oe("name"),className:"create-patient-button mt-3 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ml-2",disabled:Q,children:"Create Patient with this Name"})]}),O.length<2&&!Q&&e.jsx("p",{className:"text-gray-400 mt-2 text-sm",children:"Enter at least 2 characters to search."})]}),n&&!E&&e.jsxs("form",{onSubmit:He,children:[e.jsxs("div",{className:"selected-patient-info content-section flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[" ",e.jsxs("div",{children:[e.jsxs("h3",{className:"section-title",children:[" ","Patient: ",e.jsx("span",{className:"font-normal",children:n.name})]}),e.jsxs("p",{className:"text-sm mt-1",children:["Token: ",e.jsx("span",{className:"font-medium",children:n.token??"N/A"}),n.age&&`    Age: ${n.age}`,n.gender&&`    Gender: ${n.gender}`,n.phone&&`    Phone: ${n.phone}`]}),e.jsxs("p",{className:"text-xs mt-1",title:`Patient UUID: ${n.id}`,children:["ID: ",n.id.substring(0,12),"..."]})]}),e.jsx("button",{type:"button",onClick:fe,className:"change-patient-button mt-2 sm:mt-0 px-3 py-1.5 border rounded-md text-sm font-medium focus:outline-none focus:ring-2",children:"Change Patient"})]}),y&&e.jsx("div",{className:"ai-function-status error mb-4 p-3",children:y})," ",re?e.jsxs("div",{className:"content-section mt-4",children:[e.jsx("h3",{className:"section-title",children:"Previous Orders"}),e.jsx("div",{className:"space-y-4",children:[1,2].map(me=>e.jsxs("div",{className:"previous-order-card p-4 border rounded-lg shadow-sm bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(U,{width:180,height:20}),e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(U,{width:"90%",height:16}),e.jsx(U,{width:"70%",height:16})]}),e.jsx(U,{width:"100%",height:36,style:{borderRadius:"6px"}})]},me))})]}):k?e.jsx("div",{className:"ai-function-status error mb-4 p-3",children:k}):I.length>0?e.jsxs("div",{className:"content-section mt-4",children:[e.jsx("h3",{className:"section-title",children:"Previous Orders"}),e.jsx("div",{className:"space-y-4",children:I.map(me=>e.jsxs("div",{className:"previous-order-card p-4 border rounded-lg shadow-sm bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:["Order Date: ",new Date(me.date).toLocaleDateString()]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${me.status==="dispensed"?"bg-green-100 text-green-800":me.status==="pending"?"bg-yellow-100 text-yellow-800":me.status==="cancelled"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:me.status.charAt(0).toUpperCase()+me.status.slice(1)})]}),e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-700 mb-3",children:me.medications.map((ve,Fe)=>e.jsxs("li",{children:[e.jsx("strong",{children:ve.name}),": ",ve.quantity," Qty",ve.directions_to_use&&` - Directions: ${ve.directions_to_use}`]},Fe))}),me.prescriptionForUnavailableDrugs&&e.jsxs("div",{className:"text-sm text-gray-600 mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Prescription for Unavailable:"}),e.jsxs("div",{className:"prose prose-sm max-w-none",children:[" ",e.jsx(qa,{remarkPlugins:[Wn],children:me.prescriptionForUnavailableDrugs})]})]}),e.jsxs("button",{type:"button",onClick:()=>pe(me),className:"add-previous-meds-button mt-3 px-3 py-1.5 text-sm font-medium rounded-md flex items-center justify-center",children:[e.jsx(bn,{size:16,className:"mr-1"})," Add Medications to Current Order"]})]},me.id))})]}):n&&e.jsx("div",{className:"content-section text-center py-4 mt-4",children:e.jsx("p",{className:"text-gray-500",children:"No previous orders found for this patient."})}),e.jsxs("div",{className:"mb-4 content-section",children:[e.jsx("label",{htmlFor:"prescription-unavailable",className:"form-label",children:"Prescription for Unavailable Drugs (Optional)"}),e.jsx("textarea",{id:"prescription-unavailable",rows:3,value:S??"",onChange:me=>_(me.target.value||null),placeholder:"Enter prescription details for any drugs that are currently unavailable...",className:"custom-text-input mt-1 w-full"})]}),e.jsxs("div",{className:"mb-4 relative content-section",children:[" ",e.jsx("label",{htmlFor:"drug-search",className:"form-label",children:"Add Medication"})," ",e.jsx("input",{type:"text",id:"drug-search",placeholder:"Search for drug name or type to add custom...",value:h,onChange:me=>m(me.target.value),className:"custom-text-input mt-1"}),h&&e.jsxs("div",{className:"drug-search-dropdown mt-1 w-full max-h-60 rounded-md border shadow-lg overflow-auto focus:outline-none sm:text-sm z-20",children:[" ",f.length>0&&e.jsxs("ul",{children:[" ",f.map(me=>e.jsxs("li",{onClick:()=>ge(me),className:"cursor-pointer select-none relative",children:[e.jsx("span",{className:"font-medium block truncate",children:me.name||me.brand_name}),e.jsxs("span",{className:"drug-stock-price text-xs",children:[" ","(Stock: ",me.stock??"N/A",", MRP: ",Number(me.mrp||0).toFixed(2),")"]})]},me.id))]}),h.trim()&&!l.some(me=>me.name&&me.name.toLowerCase()===h.trim().toLowerCase()||me.brand_name&&me.brand_name.toLowerCase()===h.trim().toLowerCase())&&e.jsxs("div",{onClick:q,className:"add-custom-drug-button cursor-pointer text-sm font-medium",role:"button",children:['Add "',h.trim(),'" as new item']}),h.trim()&&f.length===0&&l.some(me=>me.name&&me.name.toLowerCase()===h.trim().toLowerCase()||me.brand_name&&me.brand_name.toLowerCase()===h.trim().toLowerCase())&&e.jsx("p",{className:"text-gray-400 py-2.5 px-4 text-sm",children:"Drug already selected or no new matches."})]})]}),e.jsxs("div",{className:"order-items-section content-section max-h-96 overflow-y-auto",children:[" ",e.jsx("h4",{className:"section-title",children:"Order Items"})," ",o.length===0&&e.jsx("p",{className:"text-sm text-gray-400 text-center py-4",children:"No medications added yet."}),o.length>0&&e.jsx("ul",{className:"space-y-4",children:o.map(me=>{const ve=me.drug_id??me.name,Fe=!me.drug_id;return e.jsxs("li",{className:"order-item-card text-sm",children:[" ",e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:[e.jsxs("div",{className:"flex-grow mb-2 md:mb-0",children:[e.jsxs("span",{className:`item-name block text-base ${Fe?"custom":""}`,children:[" ",me.name,Fe?" (custom)":""]}),!Fe&&me.pricePerLooseUnit!==void 0&&e.jsxs("span",{className:"item-details text-xs",children:[" ","@ ",(Number(me.pricePerLooseUnit)||0).toFixed(2)," per loose unit"]}),me.stock!==void 0&&e.jsxs("span",{className:`item-details text-xs ml-2 ${me.stock<=10?"item-stock low":""}`,children:[" ","(Stock: ",me.stock,")"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2",children:[e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`loose-packs-${ve}`,className:"dosage-label",children:"Packs:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>ie(ve,(me.loosePacks??0)-1),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`loose-packs-${ve}`,min:"0",value:me.loosePacks||"",onChange:Ee=>{const L=parseInt(Ee.target.value,10);ie(ve,isNaN(L)?0:L)},onFocus:Ee=>Ee.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>ie(ve,(me.loosePacks??0)+1),className:"quantity-btn",children:"+"})]})]}),e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`loose-units-${ve}`,className:"dosage-label",children:"Loose:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>ce(ve,(me.looseUnits??0)-1),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`loose-units-${ve}`,min:"0",value:me.looseUnits||"",onChange:Ee=>{const L=parseInt(Ee.target.value,10);ce(ve,isNaN(L)?0:L)},onFocus:Ee=>Ee.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>ce(ve,(me.looseUnits??0)+1),className:"quantity-btn",children:"+"})]}),me.pack&&e.jsxs("span",{className:"ml-2 text-sm text-gray-400",children:["(",me.pack.split("x")[1]||me.pack," per pack)"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between md:justify-end gap-3 mt-2 md:mt-0 md:flex-col md:items-end",children:[e.jsxs("div",{className:"w-28 text-right font-semibold",children:[" ","",(Number((me.pricePerLooseUnit??0)*(me.looseQuantity??0))||0).toFixed(2)]}),e.jsx("button",{type:"button",onClick:()=>Y(ve),className:"remove-item-button p-1.5 -m-1.5 rounded-full",title:"Remove Item",children:e.jsx(Jt,{size:18})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-x-4 gap-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:`tablets-per-day-${ve}`,className:"dosage-label",children:"Per Day:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>d(Ee=>Ee.map(L=>L.drug_id===ve?{...L,tabletsPerDay:Math.max(1,(L.tabletsPerDay??1)-1)}:L)),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`tablets-per-day-${ve}`,min:"1",value:me.tabletsPerDay??1,onChange:Ee=>{const L=parseInt(Ee.target.value,10);d(ne=>ne.map(xe=>xe.drug_id===ve?{...xe,tabletsPerDay:isNaN(L)?1:Math.max(1,L)}:xe))},onFocus:Ee=>Ee.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>d(Ee=>Ee.map(L=>L.drug_id===ve?{...L,tabletsPerDay:(L.tabletsPerDay??1)+1}:L)),className:"quantity-btn",children:"+"})]})]}),e.jsxs("div",{className:"flex items-center mt-1 sm:mt-0",children:[e.jsx("label",{htmlFor:`number-of-days-${ve}`,className:"dosage-label",children:"No. Days:"}),e.jsxs("div",{className:"quantity-control",children:[e.jsx("button",{type:"button",onClick:()=>d(Ee=>Ee.map(L=>L.drug_id===ve?{...L,numberOfDays:Math.max(1,(L.numberOfDays??1)-1)}:L)),className:"quantity-btn",children:"-"}),e.jsx("input",{type:"number",id:`number-of-days-${ve}`,min:"1",value:me.numberOfDays??1,onChange:Ee=>{const L=parseInt(Ee.target.value,10);d(ne=>ne.map(xe=>xe.drug_id===ve?{...xe,numberOfDays:isNaN(L)?1:Math.max(1,L)}:xe))},onFocus:Ee=>Ee.target.select(),className:"dosage-input text-sm text-right"}),e.jsx("button",{type:"button",onClick:()=>d(Ee=>Ee.map(L=>L.drug_id===ve?{...L,numberOfDays:(L.numberOfDays??1)+1}:L)),className:"quantity-btn",children:"+"})]})]})]}),e.jsx("div",{className:"flex items-center mt-2",children:me.pack&&W(me.pack)&&e.jsx("span",{className:"ml-4 text-sm text-gray-400",children:(()=>{const Ee=W(me.pack),L=me.looseQuantity??0;if(Ee&&Ee>0){const ne=Math.floor(L/Ee),xe=L%Ee;return`(Subtract: ${ne} packs, ${xe} loose)`}return""})()})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("label",{htmlFor:`directions-${ve}`,className:"dosage-label",children:"Directions:"}),e.jsx("input",{type:"text",id:`directions-${ve}`,placeholder:"e.g., 'After food', 'Twice a day'",value:me.directions_to_use??"",onChange:Ee=>{const L=Ee.target.value;d(ne=>ne.map(xe=>(xe.drug_id??xe.name)===ve?{...xe,directions_to_use:L}:xe))},className:"dosage-input text-sm w-full mt-1"})]})]},ve)})})]}),o.length>0&&e.jsx("div",{className:"mt-6 text-right pr-4",children:e.jsxs("span",{className:"grand-total font-bold",children:[" ","Grand Total: ",st]})}),e.jsx("div",{className:"mt-8 flex justify-end",children:e.jsx("button",{type:"submit",disabled:v||o.length===0&&!(S!=null&&S.trim()),className:`submit-order-button inline-flex items-center justify-center text-base shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 ${v||o.length===0&&!(S!=null&&S.trim())?"":"hover:opacity-90"}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner animate-spin rounded-full h-5 w-5 border-2 mr-3"})," ","Creating Order..."]}):"Create Order"})})]})]})},$S=()=>{const{orderId:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState(null),[o,d]=x.useState([]),[h,m]=x.useState([]),[f,g]=x.useState(""),[y,b]=x.useState([]),[v,w]=x.useState(null),[S,_]=x.useState(!1),[E,D]=x.useState(null),[O,M]=x.useState(!0);us();const A=x.useCallback(async()=>{M(!0);try{const I=await Z(`/api/pharmacy-orders/${t}`);if(!I.ok)throw new Error("Failed to fetch order details");const V=await I.json();i(V),c({id:V.patientId,name:V.patientName||"N/A",token:V.patientTokenNumber}),D(V.prescriptionForUnavailableDrugs);const re=V.medications.map(B=>{const k=G(B.pack),Ne=B.pack_quantity*(k??1)+B.loose_quantity;return{...B,isLoose:!0,loosePacks:B.pack_quantity,looseUnits:B.loose_quantity,looseQuantity:Ne,pack_price:B.pack_price,loose_price:B.loose_price,total_price:B.total_price,pricePerLooseUnit:B.loose_price,originalPrice:B.pack_price,box_number:B.box_number,pack:B.pack,batch:B.batch,expiry_date:B.expiry_date,discount_percentage:B.discount_percentage}});m(re)}catch(I){w("Could not load order details. "+I.message)}finally{M(!1)}},[t]),P=x.useCallback(async()=>{try{const I=await Z("/api/drugs");if(!I.ok)throw new Error("Failed to fetch drugs");const V=await I.json(),re=V.drugs||V||[];d(re)}catch(I){w("Could not load drug list. "+I.message)}},[]);x.useEffect(()=>{A(),P()},[A,P]);const Q=x.useMemo(()=>new Da(o,{keys:["name","brand_name"],threshold:.3}),[o]);x.useEffect(()=>{if(!f){b([]);return}const I=Q.search(f).map(V=>V.item);b(I.slice(0,10))},[f,Q]);const G=I=>{if(!I)return null;const V=I.match(/(?:\d+x)?(\d+)/);return V?parseInt(V[1],10):null},C=I=>{if(h.some(V=>V.drug_id===I.id)){w(`${I.name||I.brand_name} is already in the order.`),setTimeout(()=>w(null),3e3),g(""),b([]);return}m(V=>[...V,{drug_id:I.id,name:I.name||I.brand_name||"Unnamed Drug",pack_quantity:0,loose_quantity:1,pack_price:Number(I.mrp)||0,loose_price:(Number(I.mrp)||0)/(G(I.pack)||1),total_price:(Number(I.mrp)||0)/(G(I.pack)||1),discount_percentage:0,directions_to_use:"",tabletsPerDay:1,numberOfDays:1,stock:I.stock,isLoose:!0,looseQuantity:1,loosePacks:0,looseUnits:1,pricePerLooseUnit:(Number(I.mrp)||0)/(G(I.pack)||1),originalPrice:Number(I.mrp)||0,pack:I.pack}]),g(""),b([])},R=I=>{m(V=>V.filter(re=>(re.drug_id??re.name)!==I))},z=(I,V)=>{m(re=>re.map(B=>{if((B.drug_id??B.name)===I&&B.isLoose){const k=G(B.pack),Ne=Math.max(0,V),Ae=Ne*(k??1)+(B.looseUnits??0);return{...B,loosePacks:Ne,looseQuantity:Ae,pack_quantity:Ne}}return B}))},F=(I,V)=>{m(re=>re.map(B=>{if((B.drug_id??B.name)===I&&B.isLoose){const k=G(B.pack),Ne=Math.max(0,V),Ae=(B.loosePacks??0)*(k??1)+Ne;return{...B,looseUnits:Ne,looseQuantity:Ae,loose_quantity:Ne}}return B}))},J=async I=>{if(I.preventDefault(),w(null),_(!0),h.length===0&&!(E!=null&&E.trim())){w("Please add at least one medication or provide a prescription."),_(!1);return}const V=h.filter(B=>{const k=B.looseQuantity??0;return k<=0||B.stock!==void 0&&k>B.stock});if(V.length>0){w(`Invalid quantity or insufficient stock for: ${V.map(B=>B.name).join(", ")}`),_(!1);return}const re={items:h.map(B=>({drug_id:B.drug_id??null,name:B.name,pack_quantity:B.loosePacks??0,loose_quantity:B.looseUnits??0,pack_price:B.pack_price??0,loose_price:B.loose_price??0,total_price:(B.loose_price??0)*(B.looseQuantity??0),discount_percentage:B.discount_percentage??0,directions_to_use:B.directions_to_use??null,tabletsPerDay:B.tabletsPerDay??1,numberOfDays:B.numberOfDays??1})),prescription_for_unavailable_drugs:E,order_total:H};try{const B=await Z(`/api/pharmacy-orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(re)});if(!B.ok){const k=await B.json();throw new Error(k.message||"Failed to update order")}alert("Pharmacy order updated successfully!"),a(-1)}catch(B){w(B.message||"Failed to update order. Please try again.")}finally{_(!1)}},H=x.useMemo(()=>h.reduce((I,V)=>{const re=V.loose_price??0,B=V.looseQuantity??0;return I+re*B},0),[h]);return O?e.jsxs("div",{className:"edit-pharmacy-order-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"header-left",style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(U,{variant:"circular",width:40,height:40}),e.jsx(U,{width:300,height:32})]}),e.jsx("div",{className:"header-right",children:e.jsx(U,{width:100,height:32,style:{borderRadius:"16px"}})})]}),e.jsx("div",{className:"order-meta",style:{display:"flex",gap:"1rem",margin:"1rem 0"},children:e.jsx(U,{width:200,height:24})}),e.jsxs("div",{className:"main-layout",children:[e.jsxs("div",{className:"left-column",children:[e.jsxs("div",{className:"card search-section",children:[e.jsx("div",{className:"card-header",children:e.jsx(U,{width:200,height:24})}),e.jsx("div",{style:{padding:"1.5rem"},children:e.jsx(U,{height:42})})]}),e.jsxs("div",{className:"card medications-list-section",children:[e.jsx("div",{className:"card-header",children:e.jsx(U,{width:250,height:24})}),e.jsxs("div",{className:"table-container",style:{padding:"0 1rem 1rem"},children:[e.jsxs("div",{className:"table-header-row",style:{display:"flex",gap:"1rem",padding:"1rem"},children:[e.jsx(U,{width:"30%",height:20}),e.jsx(U,{width:"20%",height:20}),e.jsx(U,{width:"20%",height:20}),e.jsx(U,{width:"15%",height:20}),e.jsx(U,{width:"5%",height:20})]}),e.jsx("div",{className:"table-body",children:[1,2,3].map(I=>e.jsxs("div",{className:"table-row",style:{display:"flex",gap:"1rem",padding:"1rem",borderBottom:"1px solid #eee"},children:[e.jsxs("div",{style:{width:"30%"},children:[e.jsx(U,{width:"80%",height:20,className:"mb-2"}),e.jsx(U,{width:"40%",height:14})]}),e.jsx(U,{width:"20%",height:36}),e.jsx(U,{width:"20%",height:36}),e.jsx(U,{width:"15%",height:20,style:{alignSelf:"center"}}),e.jsx(U,{width:"5%",height:24,style:{alignSelf:"center"}})]},I))})]})]})]}),e.jsxs("div",{className:"right-column",children:[e.jsxs("div",{className:"card notes-card",children:[e.jsx("div",{className:"card-header border-b-0 pb-2",children:e.jsx(U,{width:180,height:24})}),e.jsx("div",{style:{padding:"1rem"},children:e.jsx(U,{height:80})})]}),e.jsx("div",{style:{marginTop:"20px"},children:e.jsx(U,{height:48,width:"100%"})})]})]})]}):n?e.jsxs("div",{className:"edit-pharmacy-order-container",children:[e.jsxs("div",{className:"page-header",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("button",{onClick:()=>a(-1),className:"back-button",title:"Go Back",children:e.jsx(Et,{size:20})}),e.jsxs("h2",{className:"page-title",children:["EDIT ORDER ",e.jsxs("span",{className:"text-gray-500 text-lg font-normal ml-2",children:[l==null?void 0:l.name," #",n.id.substring(0,4)]})]})]}),e.jsx("div",{className:"header-right",children:e.jsx("span",{className:"status-badge",children:n.status.toUpperCase()})})]}),e.jsx("div",{className:"order-meta",children:e.jsxs("span",{className:"order-date",children:[" Order Date: ",new Date(n.date).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})]})}),e.jsxs("form",{onSubmit:J,className:"main-layout",children:[e.jsxs("div",{className:"left-column",children:[e.jsxs("div",{className:"card search-section",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{children:" Find & Add Medication"})}),e.jsxs("div",{className:"search-wrapper",children:[e.jsx("input",{type:"text",placeholder:"Search by name or brand...",value:f,onChange:I=>g(I.target.value),className:"search-input"}),f&&e.jsx("div",{className:"dropdown-results",children:y.length>0?e.jsx("ul",{children:y.map(I=>e.jsxs("li",{onClick:()=>C(I),className:"dropdown-item",children:[e.jsx("span",{className:"drug-name",children:I.name||I.brand_name}),e.jsxs("span",{className:"drug-meta",children:["(Stock: ",I.stock??"N/A",", MRP: ",Number(I.mrp||0).toFixed(2),")"]})]},I.id))}):e.jsxs("div",{className:"p-3 text-gray-500 text-sm",children:['No drugs found matching "',f,'"']})})]})]}),e.jsxs("div",{className:"card medications-list-section",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{children:[" Medications in Order ",e.jsxs("span",{className:"item-count",children:[h.length," items"]})]})}),h.length>0?e.jsxs("div",{className:"table-container",children:[e.jsxs("div",{className:"table-header-row",children:[e.jsx("div",{className:"col-medication",children:"MEDICATION"}),e.jsx("div",{className:"col-directions",children:"DIRECTIONS"}),e.jsx("div",{className:"col-quantity",children:"QUANTITY"}),e.jsx("div",{className:"col-subtotal",children:"SUBTOTAL"}),e.jsx("div",{className:"col-action"})]}),e.jsx("div",{className:"table-body",children:h.map(I=>{const V=I.drug_id??I.name;return e.jsxs("div",{className:"table-row",children:[e.jsxs("div",{className:"col-medication",children:[e.jsx("span",{className:"med-name",children:I.name}),I.pack&&e.jsx("span",{className:"med-unit text-xs text-gray-500 block",children:I.pack}),e.jsxs("div",{className:"stock-info",children:[" Stock: ",e.jsxs("span",{className:"stock-value",children:[" ",I.stock!==void 0?I.pack?`BOX OF ${G(I.pack)}`:I.stock:"N/A"]})]})]}),e.jsx("div",{className:"col-directions",children:e.jsx("input",{type:"text",placeholder:"1 tablet twice daily...",value:I.directions_to_use??"",onChange:re=>{const B=re.target.value;m(k=>k.map(Ne=>(Ne.drug_id??Ne.name)===V?{...Ne,directions_to_use:B}:Ne))},className:"directions-input"})}),e.jsx("div",{className:"col-quantity",children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"10px",fontWeight:"bold",color:"#9ca3af",display:"block",marginBottom:"2px"},children:"PACKS"}),e.jsx("input",{type:"number",min:"0",value:I.loosePacks||"",onChange:re=>z(V,re.target.value===""?0:parseInt(re.target.value)),className:"qty-input",style:{width:"100%",textAlign:"center"}})]}),e.jsxs("div",{style:{flex:1},children:[e.jsx("label",{style:{fontSize:"10px",fontWeight:"bold",color:"#9ca3af",display:"block",marginBottom:"2px"},children:"LOOSE"}),e.jsx("input",{type:"number",min:"0",value:I.looseUnits||"",onChange:re=>F(V,re.target.value===""?0:parseInt(re.target.value)),className:"qty-input",style:{width:"100%",textAlign:"center"}})]})]})}),e.jsxs("div",{className:"col-subtotal",children:["",(Number((I.pricePerLooseUnit??0)*(I.looseQuantity??0))||0).toFixed(2)]}),e.jsx("div",{className:"col-action",children:e.jsx("button",{type:"button",onClick:()=>R(V),className:"delete-btn",title:"Remove Item",children:e.jsx(Jt,{size:18,strokeWidth:2.5})})})]},V)})})]}):e.jsx("div",{className:"empty-state",children:"No medications added. Search above to add."})]})]}),e.jsxs("div",{className:"right-column",children:[e.jsxs("div",{className:"card notes-card",children:[e.jsx("div",{className:"card-header border-b-0 pb-2",children:e.jsx("h3",{children:" Prescription Notes"})}),e.jsx("textarea",{rows:3,value:E??"",onChange:I=>D(I.target.value||null),placeholder:"Add notes about unavailable drugs...",className:"notes-input"})]}),e.jsxs("button",{type:"submit",disabled:S,className:"confirm-btn",style:{width:"100%",margin:"20px 0 0 0"},children:[e.jsx("span",{className:"check-icon",children:""})," ",S?"Updating...":"Confirm Changes"]}),v&&e.jsx("div",{className:"error-alert mt-4",children:v})]})]})]}):e.jsx("div",{className:"p-6 text-red-500 flex justify-center items-center h-screen",children:"Order not found or failed to load."})},k5=(t,a,n,i="non-black")=>{if(isNaN(t)||isNaN(a)||t<=0||a<=0)return null;let l;return n==="female"?t<=.7?l=141*Math.pow(t/.7,-.329)*Math.pow(.993,a):l=141*Math.pow(t/.7,-1.209)*Math.pow(.993,a):t<=.9?l=141*Math.pow(t/.9,-.411)*Math.pow(.993,a):l=141*Math.pow(t/.9,-1.209)*Math.pow(.993,a),i==="black"&&(l*=1.018),parseFloat(l.toFixed(2))},C5=(t,a,n)=>{if(isNaN(t)||isNaN(a)||isNaN(n)||t<0||a<0||n<0||n>=400)return null;const i=t-a-n/5;return parseFloat(i.toFixed(2))},_5=(t,a)=>{if(isNaN(t)||isNaN(a)||t<0||a<0)return null;const n=t-a;return parseFloat(n.toFixed(2))},D5=(t,a)=>{if(isNaN(t)||isNaN(a)||t<0||a<0)return null;const n=t-a;return parseFloat(n.toFixed(2))},E5=(t,a,n)=>{if(isNaN(t)||isNaN(a)||isNaN(n)||t<0||a<0||n<0)return null;const i=t-(a+n);return parseFloat(i.toFixed(2))},T5=(t,a,n)=>{if(isNaN(t)||isNaN(a)||isNaN(n)||t<0||a<0||n<0)return null;const i=2*t+a/18+n/2.8;return parseFloat(i.toFixed(2))},A5=t=>["eGFR","LDL Cholesterol","Indirect Bilirubin","Globulin","Anion Gap","Osmolality"].includes(t),i1=()=>{var fe,ge;const{orderId:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState({}),[o,d]=x.useState(!0),[h,m]=x.useState(!1),[f,g]=x.useState(null),[y,b]=x.useState(null),[v,w]=x.useState(null),[S,_]=x.useState({}),[E,D]=x.useState(null),[O,M]=x.useState(!1),[A,P]=x.useState(""),[Q,G]=x.useState(!1),[C,R]=x.useState(""),[z,F]=x.useState(""),[J,H]=x.useState(!1),[I,V]=x.useState(""),re=x.useCallback(async q=>{var W;try{const Y=await Z(`/api/patients/${q}`);if(!Y.ok)throw new Error(`Failed to fetch patient details: ${Y.status}`);const ie=await Y.json();b(ie.age),w(((W=ie.sex)==null?void 0:W.toLowerCase())==="female"?"female":"male"),ie.phone&&i(ce=>ce?{...ce,Patient:{...ce.Patient,phone:ie.phone}}:null)}catch(Y){console.error("Error fetching patient details:",Y),b(null),w(null)}},[]),B=x.useCallback(async()=>{if(t){d(!0),g(null);try{const q=await Z(`/api/lab/${t}`);if(!q.ok){const ie=await q.json().catch(()=>({message:`HTTP error! status: ${q.status}`}));throw new Error(ie.message||`HTTP error! status: ${q.status}`)}const W=await q.json();if(i(W),W.createdAt)try{const ie=new Date(W.createdAt),ce=new Date(ie.getTime()-ie.getTimezoneOffset()*6e4).toISOString().slice(0,16);P(ce)}catch(ie){console.error("Error formatting date for edit:",ie)}if(W.report_date)try{const ie=new Date(W.report_date),ce=new Date(ie.getTime()-ie.getTimezoneOffset()*6e4).toISOString().slice(0,16);R(ce)}catch(ie){console.error("Error formatting report date for edit:",ie)}else{const ie=new Date,ce=new Date(ie.getTime()-ie.getTimezoneOffset()*6e4).toISOString().slice(0,16);R(ce)}W.referral_doctor&&V(W.referral_doctor),W.patient_id&&re(W.patient_id);const Y={};if(W.tests&&W.tests.forEach(ie=>{Y[ie.id]={},ie.default_parameters&&ie.default_parameters.length>0?ie.default_parameters.forEach(ce=>{Y[ie.id][ce.name]=ce.defaultValue}):Y[ie.id].report_content=""}),W.report_content)try{const ie=JSON.parse(W.report_content);typeof ie=="object"&&ie!==null&&!Array.isArray(ie)?c(ie):(console.warn("Legacy or unexpected report content format detected. Initializing with defaults."),c(Y))}catch{console.warn("Legacy report content detected (not JSON). Initializing with defaults."),c(Y)}else c({})}catch(q){console.error("Failed to fetch lab order details:",q),g(q instanceof Error?q.message:"An unknown error occurred while fetching order details.")}finally{d(!1)}}},[t,re]);x.useEffect(()=>{t?B():(g("No Order ID provided in the URL."),d(!1))},[t,B]),x.useEffect(()=>{(async()=>{try{const W=await Z("/api/clinics/settings");if(W.ok){const Y=await W.json();F(Y.labLetterheadUrl||"")}}catch(W){console.error("Error fetching clinic settings:",W)}})()},[]);const k=(q,W,Y)=>{c(ie=>{var ot,xt,be,ue,je,ke,Me,De,qe,te,Re,lt,Xe,dt,jt,At,Ye,it,Ze;const ce={...ie,[q]:{...ie[q],[W]:Y}},pe=parseFloat((ot=ce[q])==null?void 0:ot.Creatinine),He=y,We=v;if(W==="Creatinine"&&!isNaN(pe)&&He!==null&&We!==null){const ht=k5(pe,He,We);ht!==null&&((xt=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&xt.default_parameters.find(ut=>ut.name==="eGFR"))&&(ce[q].eGFR=ht)}const st=parseFloat((be=ce[q])==null?void 0:be["Total Cholesterol"]),me=parseFloat((ue=ce[q])==null?void 0:ue["HDL Cholesterol"]),ve=parseFloat((je=ce[q])==null?void 0:je.Triglycerides);if((W==="Total Cholesterol"||W==="HDL Cholesterol"||W==="Triglycerides")&&!isNaN(st)&&!isNaN(me)&&!isNaN(ve)){const ht=C5(st,me,ve);ht!==null&&((ke=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&ke.default_parameters.find(ut=>ut.name==="LDL Cholesterol"))&&(ce[q]["LDL Cholesterol"]=ht)}const Fe=parseFloat((Me=ce[q])==null?void 0:Me["Total Bilirubin"]),Ee=parseFloat((De=ce[q])==null?void 0:De["Direct Bilirubin"]);if((W==="Total Bilirubin"||W==="Direct Bilirubin")&&!isNaN(Fe)&&!isNaN(Ee)){const ht=_5(Fe,Ee);ht!==null&&((qe=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&qe.default_parameters.find(ut=>ut.name==="Indirect Bilirubin"))&&(ce[q]["Indirect Bilirubin"]=ht)}const L=parseFloat((te=ce[q])==null?void 0:te["Total Protein"]),ne=parseFloat((Re=ce[q])==null?void 0:Re.Albumin);if((W==="Total Protein"||W==="Albumin")&&!isNaN(L)&&!isNaN(ne)){const ht=D5(L,ne);ht!==null&&((lt=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&lt.default_parameters.find(ut=>ut.name==="Globulin"))&&(ce[q].Globulin=ht)}const xe=parseFloat((Xe=ce[q])==null?void 0:Xe.Sodium),ae=parseFloat((dt=ce[q])==null?void 0:dt.Chloride),we=parseFloat((jt=ce[q])==null?void 0:jt.Bicarbonate);if((W==="Sodium"||W==="Chloride"||W==="Bicarbonate")&&!isNaN(xe)&&!isNaN(ae)&&!isNaN(we)){const ht=E5(xe,ae,we);ht!==null&&((At=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&At.default_parameters.find(ut=>ut.name==="Anion Gap"))&&(ce[q]["Anion Gap"]=ht)}const Le=parseFloat((Ye=ce[q])==null?void 0:Ye.Glucose),Je=parseFloat((it=ce[q])==null?void 0:it.BUN);if((W==="Sodium"||W==="Glucose"||W==="BUN")&&!isNaN(xe)&&!isNaN(Le)&&!isNaN(Je)){const ht=T5(xe,Le,Je);ht!==null&&((Ze=n==null?void 0:n.tests.find(ut=>ut.id===q))!=null&&Ze.default_parameters.find(ut=>ut.name==="Osmolality"))&&(ce[q].Osmolality=ht)}return ce})},Ne=async q=>{const W=l[q]||{},Y=n==null?void 0:n.tests.find(He=>He.id===q);if(!Y)return;const ie={};Y.default_parameters&&Y.default_parameters.forEach(He=>{ie[He.name]=He.defaultValue});const ce={...ie,...W},pe={...l,[q]:ce};c(pe),m(!0),g(null);try{const He=await Z(`/api/lab/${t}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(pe),isPartial:!0})});if(!He.ok)throw new Error(`Save failed: ${He.status}`);alert(`Report for ${Y.name} saved successfully!`)}catch(He){console.error("Error saving test report:",He),alert("Failed to save test report.")}finally{m(!1)}},Ae=async(q=null)=>{if(!n||!n.tests||!t){alert("Order details not loaded.");return}m(!0),g(null);try{let W;if(q===null){const ie={};n.tests.forEach(ce=>{const pe=l[ce.id]||{},He={};ce.default_parameters&&ce.default_parameters.forEach(We=>{We.defaultValue!==void 0&&We.defaultValue!==null&&(He[We.name]=We.defaultValue)}),ie[ce.id]={...He,...pe},(!ce.default_parameters||ce.default_parameters.length===0)&&!ie[ce.id].report_content&&(ie[ce.id].report_content="")}),W=ie,c(ie)}else{const ie=l[q]||{},ce=n.tests.find(We=>We.id===q);if(!ce){m(!1);return}const pe={};ce.default_parameters&&ce.default_parameters.forEach(We=>{pe[We.name]=We.defaultValue});const He={...pe,...ie};W={...l,[q]:He},c(W)}const Y=await Z(`/api/lab/${t}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(W),isPartial:q!==null})});if(!Y.ok)throw new Error(`Save failed: ${Y.status}`);D(q),setTimeout(()=>{window.print()},100)}catch(W){console.error("Error saving before print:",W),alert("Failed to save report before printing.")}finally{m(!1)}},T=()=>{n&&Px(n)},Ce=async()=>{if(!n||!n.tests){alert("Order details not loaded.");return}if(!t){alert("Cannot submit report without an Order ID.");return}const q={};if(n.tests.forEach(W=>{const Y=l[W.id]||{},ie={};W.default_parameters&&W.default_parameters.forEach(ce=>{ce.defaultValue!==void 0&&ce.defaultValue!==null&&(ie[ce.name]=ce.defaultValue)}),q[W.id]={...ie,...Y},(!W.default_parameters||W.default_parameters.length===0)&&!q[W.id].report_content&&(q[W.id].report_content="")}),Object.keys(q).length===0){alert("Report content cannot be empty.");return}c(q),m(!0),g(null);try{const W=await Z(`/api/lab/${t}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(q)})});if(!W.ok){const Y=await W.json().catch(()=>({message:`Submission failed: ${W.status}`}));throw new Error(Y.message||`Submission failed: ${W.status}`)}alert("Report submitted successfully!"),a(-1)}catch(W){console.error("Error submitting report:",W),g(W instanceof Error?W.message:"An unknown error occurred during submission.")}finally{m(!1)}},Ue=async()=>{if(!(!t||!A))try{const q=await Z(`/api/lab/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:new Date(A).toISOString()})});if(!q.ok)throw new Error("Failed to update date");const W=await q.json();W.order&&i(Y=>Y?{...Y,createdAt:W.order.createdAt}:null),M(!1)}catch(q){console.error("Failed to update date:",q),alert("Failed to update date")}},Pe=async()=>{if(!(!t||!C))try{const q=await Z(`/api/lab/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({reportDate:new Date(C).toISOString()})});if(!q.ok)throw new Error("Failed to update report date");const W=await q.json();W.order&&i(Y=>Y?{...Y,report_date:W.order.report_date}:null),G(!1)}catch(q){console.error("Failed to update report date:",q),alert("Failed to update report date")}},de=async()=>{if(t)try{const q=await Z(`/api/lab/orders/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({referralDoctor:I})});if(!q.ok)throw new Error("Failed to update referral doctor");const W=await q.json();W.order&&(V(W.order.referral_doctor||""),i(Y=>Y?{...Y,referral_doctor:W.order.referral_doctor}:null)),H(!1)}catch(q){console.error("Failed to update referral doctor:",q),alert("Failed to update referral doctor")}};if(o)return e.jsx("div",{className:"lab-inventory-container enter-lab-report-page",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1rem"},children:[e.jsx(U,{width:200,height:28}),e.jsxs("div",{className:"header-actions",style:{display:"flex",gap:"8px"},children:[e.jsx(U,{width:80,height:32}),e.jsx(U,{width:80,height:32}),e.jsx(U,{width:80,height:32})]})]}),e.jsxs("div",{className:"lab-inventory-card no-print summary-card",style:{margin:"1rem",padding:"0"},children:[e.jsx("div",{className:"lab-inventory-header summary-header",style:{padding:"0.75rem 1rem",borderBottom:"1px solid #eee"},children:e.jsx(U,{width:120,height:20})}),e.jsxs("div",{className:"summary-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",padding:"1rem"},children:[e.jsx(U,{height:24}),e.jsx(U,{height:24}),e.jsx(U,{height:24}),e.jsx(U,{height:24})]})]}),e.jsx("div",{className:"lab-tests-container no-print",style:{padding:"1rem"},children:[1,2].map(q=>e.jsxs("div",{className:"test-card",style:{marginBottom:"1.5rem",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"1rem",background:"white"},children:[e.jsxs("div",{className:"test-header",style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsx(U,{width:250,height:24}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsx(U,{width:70,height:30}),e.jsx(U,{width:36,height:30})]})]}),e.jsx("div",{className:"parameter-grid",style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[1,2,3,4].map(W=>e.jsxs("div",{className:"parameter-item",children:[e.jsx(U,{width:"30%",height:16,style:{marginBottom:"0.5rem"}}),e.jsx(U,{height:40})]},W))})]},q))})]})});if(f&&!n)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card error-message-container",style:{textAlign:"center",padding:"30px"},children:[e.jsx(Nn,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("h3",{className:"error-title",style:{borderBottom:"none"},children:"Error Loading Details"}),e.jsx("p",{className:"error-text",children:f}),e.jsxs("button",{onClick:()=>a(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"20px"},children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});if(!n)return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(Ks,{size:48,className:"mb-3",style:{margin:"0 auto"}}),e.jsx("p",{className:"no-data-message",style:{fontSize:"1.1em"},children:`Lab order not found for ID: ${t}.`}),e.jsxs("button",{onClick:()=>a(-1),className:"lab-inventory-button lab-inventory-button-secondary",style:{marginTop:"15px"},children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}}),"Back"]})]})});const Se=(fe=n==null?void 0:n.Patient)==null?void 0:fe.name,ee=(ge=n==null?void 0:n.Patient)==null?void 0:ge.patient_token_number;return e.jsx("div",{className:"lab-inventory-container enter-lab-report-page",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",children:[e.jsx("h2",{children:"Enter Lab Report"}),e.jsxs("div",{className:"header-actions",children:[e.jsxs("button",{onClick:()=>a(-1),className:"lab-inventory-button lab-inventory-button-secondary compact-btn",disabled:h,children:[e.jsx(Et,{size:16}),e.jsx("span",{className:"btn-text",children:"Back"})]}),e.jsxs("button",{onClick:()=>Ae(null),className:"lab-inventory-button compact-btn",title:"Print Full Report",children:[e.jsx(Ys,{size:16}),e.jsx("span",{className:"btn-text",children:"Print"})]}),e.jsxs("button",{onClick:T,className:"lab-inventory-button whatsapp-btn compact-btn",title:"Share via WhatsApp",children:[e.jsx(A1,{size:16}),e.jsx("span",{className:"btn-text",children:"Share"})]})]})]}),n&&e.jsxs("div",{className:"lab-inventory-card no-print summary-card",children:[e.jsxs("h3",{className:"lab-inventory-header summary-header",children:[e.jsx(Ks,{size:14})," Summary"]}),e.jsxs("div",{className:"summary-grid",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx(Rn,{size:13,className:"icon"}),e.jsx("strong",{children:"Patient:"})," ",Se??"N/A"," (",ee??"N/A",")"]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Vj,{size:13,className:"icon"}),e.jsx("strong",{children:"Ordered:"})," ",O?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"datetime-local",value:A,onChange:q=>P(q.target.value),className:"lab-inventory-input date-input"}),e.jsx("button",{onClick:Ue,className:"icon-btn save",children:e.jsx(Eo,{size:12})}),e.jsx("button",{onClick:()=>M(!1),className:"icon-btn cancel",children:e.jsx(St,{size:12})})]}):e.jsxs(e.Fragment,{children:[gl(new Date(n.createdAt),"dd MMM, HH:mm"),e.jsx("button",{onClick:()=>M(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(_o,{size:11})})]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Vj,{size:13,className:"icon"}),e.jsx("strong",{children:"Reported:"})," ",Q?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"datetime-local",value:C,onChange:q=>R(q.target.value),className:"lab-inventory-input date-input"}),e.jsx("button",{onClick:Pe,className:"icon-btn save",children:e.jsx(Eo,{size:12})}),e.jsx("button",{onClick:()=>G(!1),className:"icon-btn cancel",children:e.jsx(St,{size:12})})]}):e.jsxs(e.Fragment,{children:[n.report_date?gl(new Date(n.report_date),"dd MMM, HH:mm"):"Not Set",e.jsx("button",{onClick:()=>G(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(_o,{size:11})})]})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx(Rn,{size:13,className:"icon"}),e.jsx("strong",{children:"Ref. Doctor:"})," ",J?e.jsxs("span",{className:"date-edit-wrapper",children:[e.jsx("input",{type:"text",value:I,onChange:q=>V(q.target.value),className:"lab-inventory-input date-input",placeholder:"Enter referral doctor name"}),e.jsx("button",{onClick:de,className:"icon-btn save",children:e.jsx(Eo,{size:12})}),e.jsx("button",{onClick:()=>H(!1),className:"icon-btn cancel",children:e.jsx(St,{size:12})})]}):e.jsxs(e.Fragment,{children:[I||"Not Set",e.jsx("button",{onClick:()=>H(!0),className:"icon-btn edit",title:"Edit",children:e.jsx(_o,{size:11})})]})]})]})]}),e.jsxs("div",{className:"lab-tests-container no-print",children:[n==null?void 0:n.tests.map(q=>{var W;return e.jsxs("div",{className:"test-card",children:[e.jsxs("div",{className:"test-header",children:[e.jsx("h4",{children:q.name}),e.jsxs("div",{style:{display:"flex",gap:"6px"},children:[e.jsxs("button",{type:"button",onClick:Y=>{Y.stopPropagation(),Ne(q.id)},className:"lab-inventory-button lab-inventory-button-secondary compact-btn",disabled:h,children:[e.jsx(ks,{size:14}),e.jsx("span",{className:"btn-text",children:"Save"})]}),e.jsx("button",{type:"button",onClick:Y=>{Y.stopPropagation(),Ae(q.id)},className:"lab-inventory-button compact-btn",title:"Print",children:e.jsx(Ys,{size:14})})]})]}),e.jsx("div",{className:"test-parameters-body",children:q.default_parameters&&q.default_parameters.length>0?e.jsx("div",{className:"parameter-grid",children:q.default_parameters.map(Y=>{var st,me;const ie=(st=l[q.id])==null?void 0:st[Y.name],ce=ie!==void 0?ie:Y.defaultValue??"",pe=Y.type==="number"&&ce!==""&&(Y.lower_limit!=null&&parseFloat(String(ce))<Y.lower_limit||Y.upper_limit!=null&&parseFloat(String(ce))>Y.upper_limit),He=A5(Y.name),We=(me=S[q.id])==null?void 0:me[Y.name];return e.jsxs("div",{className:"parameter-item",children:[e.jsxs("label",{className:"parameter-label",htmlFor:`${q.id}-${Y.name}`,children:[Y.name," ",Y.unit&&e.jsxs("span",{className:"parameter-unit",children:["(",Y.unit,")"]})]}),e.jsxs("div",{className:"input-wrapper",children:[Y.type==="boolean"?e.jsxs("select",{id:`${q.id}-${Y.name}`,value:(ce==null?void 0:ce.toString())??"false",onChange:ve=>k(q.id,Y.name,ve.target.value==="true"),className:"lab-inventory-input parameter-input",disabled:h,children:[e.jsx("option",{value:"true",children:"Reactive"}),e.jsx("option",{value:"false",children:"Non-Reactive"})]}):e.jsx("input",{id:`${q.id}-${Y.name}`,type:Y.type==="number"?"number":"text",value:ce,onChange:ve=>k(q.id,Y.name,ve.target.value),className:`lab-inventory-input parameter-input ${pe?"abnormal-result":""} ${He?"calculated-input":""}`,disabled:h||He&&!We,placeholder:Y.lower_limit!=null&&Y.upper_limit!=null?`${Y.lower_limit}-${Y.upper_limit}`:""}),He&&e.jsx("button",{type:"button",onClick:()=>_(ve=>({...ve,[q.id]:{...ve[q.id]||{},[Y.name]:!We}})),className:"edit-calculated-btn",title:We?"Lock":"Edit",children:e.jsx(_o,{size:11})})]})]},Y.name)})}):e.jsxs("div",{className:"parameter-item",style:{width:"100%"},children:[e.jsx("label",{className:"parameter-label",htmlFor:`${q.id}-report_content`,children:"Results / Observations"}),e.jsx("textarea",{id:`${q.id}-report_content`,value:((W=l[q.id])==null?void 0:W.report_content)??"",onChange:Y=>k(q.id,"report_content",Y.target.value),className:"lab-inventory-input parameter-textarea",rows:3,placeholder:`Enter results for ${q.name}...`,disabled:h})]})})]},q.id)}),f&&e.jsxs("p",{className:"error-text",style:{marginTop:"10px"},children:[e.jsx(Nn,{size:15,className:"inline mr-1"}),f]})]}),e.jsx("div",{className:"form-actions-footer no-print",children:e.jsx("button",{type:"button",onClick:Ce,disabled:h,className:"lab-inventory-button lab-inventory-button-primary submit-btn",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ci,{className:"animate-spin",size:16})," Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ks,{size:16})," Save All"]})})}),e.jsxs("div",{className:"printable-only",children:[z&&e.jsx("div",{className:"print-letterhead-container",children:e.jsx("img",{src:z,alt:"Lab Letterhead",className:"print-letterhead-image"})}),n&&n.Patient&&e.jsxs("div",{style:{marginBottom:"20px",borderBottom:"1px solid #ccc",paddingBottom:"10px"},children:[e.jsx("h2",{style:{textAlign:"center",marginBottom:"15px"},children:"Lab Report"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",fontSize:"12px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Patient Name:"})," ",n.Patient.name]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Age/Sex:"})," ",y??"N/A"," / ",v??"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ref. Doctor:"})," ",I||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date:"})," ",gl(new Date(n.createdAt),"PPpp")]})]})]}),n==null?void 0:n.tests.filter(q=>E===null||q.id===E).map(q=>{var W;return e.jsxs("div",{style:{marginBottom:"20px",pageBreakInside:"avoid"},children:[e.jsx("h3",{style:{borderBottom:"1px solid #eee",paddingBottom:"5px"},children:q.name}),q.default_parameters&&q.default_parameters.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f9f9f9"},children:[e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Parameter"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Result"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Units"}),e.jsx("th",{style:{textAlign:"left",padding:"5px",borderBottom:"1px solid #ddd"},children:"Normal Range"})]})}),e.jsx("tbody",{children:q.default_parameters.map(Y=>{var st;const ie=(st=l[q.id])==null?void 0:st[Y.name],ce=typeof ie=="string"?parseFloat(ie):typeof ie=="number"?ie:NaN,pe=Y.type==="number"&&!isNaN(ce)&&ie!==""&&(Y.lower_limit!=null&&ce<Y.lower_limit||Y.upper_limit!=null&&ce>Y.upper_limit),He=Y.type==="boolean"&&(ie===!0||ie==="true"),We=Y.type==="boolean"?ie===!0||ie==="true"?"Reactive":"Non-Reactive":ie??"";return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:Y.name}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee",fontWeight:pe||He?"bold":"normal",color:pe?"red":He?"green":"inherit"},children:We}),e.jsx("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:Y.unit??""}),e.jsxs("td",{style:{padding:"5px",borderBottom:"1px solid #eee"},children:[Y.lower_limit!==null&&Y.lower_limit!==void 0&&`> ${Y.lower_limit}`,Y.lower_limit!==null&&Y.lower_limit!==void 0&&Y.upper_limit!==null&&Y.upper_limit!==void 0&&" - ",Y.upper_limit!==null&&Y.upper_limit!==void 0&&`< ${Y.upper_limit}`]})]},Y.name)})})]}):e.jsx("div",{style:{whiteSpace:"pre-wrap",fontSize:"12px",padding:"10px"},children:((W=l[q.id])==null?void 0:W.report_content)||"No report content entered."})]},q.id)})]})]})})},P5=()=>{const{orderId:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState(!0),[o,d]=x.useState(null),[h,m]=x.useState(""),f=x.useCallback(async y=>{if(!y){d("No Order ID specified in the URL."),c(!1),i(null);return}c(!0),d(null),i(null);try{console.log(`Fetching order details for ID: ${y}`);const b=await Z(`/api/lab/orders/${y}/report`);if(!b.ok){let w;try{w=await b.json()}catch{w={message:`Server returned status ${b.status}`}}throw console.error("Fetch order details error response:",w),new Error(w.message||`Failed to fetch order details: ${b.status}`)}const v=await b.json();if(console.log("Received order data:",v),!v)throw console.error("Invalid order data structure:",v),new Error("Invalid order data received from server.");i(v)}catch(b){console.error("Error fetching order details:",b),d(b instanceof Error?b.message:"An unknown error occurred while fetching the order details")}finally{c(!1)}},[Z]);x.useEffect(()=>{f(t)},[t,f]),x.useEffect(()=>{(async()=>{try{const b=await Z("/api/clinics/settings");if(b.ok){const v=await b.json();m(v.labLetterheadUrl||"")}}catch(b){console.error("Error fetching clinic settings:",b)}})()},[]);const g=()=>{n&&Px(n)};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:0,paddingBottom:0,borderBottom:"none"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.5em"},children:"Lab Report Viewer"})," ",e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs(Ss,{to:"/lab/search-report",className:"lab-inventory-button","aria-label":"Search for other reports",children:[e.jsx(fn,{size:16,style:{marginRight:"5px"}}),"Search Reports"]}),e.jsxs("button",{onClick:()=>a(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}}),"Back"]}),e.jsxs("button",{onClick:()=>window.print(),className:"lab-inventory-button","aria-label":"Print report",children:[e.jsx(Ys,{size:16,style:{marginRight:"5px"}}),"Print"]}),e.jsxs("button",{onClick:g,className:"lab-inventory-button","aria-label":"Share report via WhatsApp",style:{backgroundColor:"#25D366",borderColor:"#25D366",color:"white"},children:[e.jsx(A1,{size:16,style:{marginRight:"5px"}}),"WhatsApp"]})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsxs("h3",{className:"lab-inventory-header",children:["Report Details (Order ID: ",t||"None Specified",")"]}),l&&e.jsx("div",{className:"loading-text",children:"Loading report..."}),o&&!l&&e.jsxs("div",{className:"error-message-container",style:{textAlign:"center"},children:[e.jsx(Nn,{size:48}),e.jsx("h3",{className:"error-title",children:"Error Loading Report"}),e.jsx("p",{children:o}),t&&e.jsx("button",{onClick:()=>f(t),className:"retry-button",children:"Retry"})]}),e.jsxs("div",{className:"printable-section",children:[h&&e.jsx("div",{className:"print-only print-letterhead-container",children:e.jsx("img",{src:h,alt:"Lab Letterhead",className:"print-letterhead-image"})}),!l&&!o&&(n==null?void 0:n.Patient)&&e.jsxs("div",{className:"lab-inventory-card",style:{marginBottom:"20px"},children:[e.jsxs("h3",{className:"lab-inventory-header",children:[e.jsx(Rn,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Patient Information"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",fontSize:"0.9em"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Name:"})," ",n.Patient.name||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Age:"})," ",n.Patient.age??"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Gender:"})," ",n.Patient.gender||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Token No:"})," ",n.Patient.patient_token_number||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Patient ID:"})," ",n.Patient.id]}),n.Patient.phone&&e.jsxs("div",{children:[e.jsx("strong",{children:"Phone:"})," ",n.Patient.phone]})]})]}),!l&&!o&&(n==null?void 0:n.report_content)&&e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("h3",{className:"lab-inventory-header",children:[e.jsx(_s,{size:16,style:{marginRight:"8px",verticalAlign:"middle"}})," Report Findings"]}),e.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6"},children:(()=>{try{const y=JSON.parse(n.report_content||"{}");return typeof y=="object"&&y!==null&&n.tests?n.tests.map(b=>e.jsxs("div",{style:{marginBottom:"20px"},children:[e.jsx("h4",{className:"lab-inventory-header",style:{fontSize:"1.1em"},children:b.name}),y[b.id]?e.jsxs("table",{className:"lab-inventory-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Parameter"}),e.jsx("th",{children:"Value"}),e.jsx("th",{children:"Normal Range"})]})}),e.jsx("tbody",{children:Object.entries(y[b.id]).map(([v,w])=>{var M;const S=(M=b.default_parameters)==null?void 0:M.find(A=>A.name===v),_=typeof w=="string"?parseFloat(w):typeof w=="number"?w:NaN,E=(S==null?void 0:S.type)==="number"&&!isNaN(_)&&(S.lower_limit!=null&&_<S.lower_limit||S.upper_limit!=null&&_>S.upper_limit),D=(S==null?void 0:S.type)==="boolean"?w===!0||w==="true"?"Reactive":"Non-Reactive":String(w),O=(S==null?void 0:S.type)==="boolean"&&(w===!0||w==="true");return e.jsxs("tr",{children:[e.jsx("td",{children:v}),e.jsxs("td",{className:`${E?"abnormal-result":""} ${O?"reactive-result":""}`,children:[D," ",S==null?void 0:S.unit]}),e.jsx("td",{children:S&&S.type==="number"&&(S.lower_limit!==null||S.upper_limit!==null)?e.jsxs(e.Fragment,{children:[S.lower_limit!=null&&` > ${S.lower_limit}`,S.lower_limit!=null&&S.upper_limit!=null&&" - ",S.upper_limit!=null&&` < ${S.upper_limit}`,S.unit&&` ${S.unit}`]}):((S==null?void 0:S.type)==="boolean","N/A")})]},v)})})]}):e.jsx("p",{children:"No parameters reported for this test."})]},b.id)):e.jsx(qa,{remarkPlugins:[Wn],children:n.report_content})}catch{return e.jsx(qa,{remarkPlugins:[Wn],children:n.report_content||"*No findings recorded.*"})}})()})]})]}),!l&&!o&&!(n!=null&&n.report_content)&&!(n!=null&&n.Patient)&&t&&e.jsxs("div",{className:"no-data-message",children:["No report content or patient details found for Order ID: ",t,". The order might be processing, does not exist, or the ID is incorrect."]}),!t&&!l&&!o&&e.jsxs("div",{className:"no-data-message",children:["No order ID specified in the URL.",e.jsx(Ss,{to:"/lab/search-report",className:"lab-inventory-link",style:{display:"block",marginTop:"10px"},children:"Go to Search Page"})]})]})]})})},R5=()=>{const t=ft(),[a,n]=x.useState(""),[i,l]=x.useState(!1),[c,o]=x.useState([]),[d,h]=x.useState(null),[m,f]=x.useState(a);us(),x.useEffect(()=>{const w=setTimeout(()=>{f(a)},500);return()=>{clearTimeout(w)}},[a]),x.useEffect(()=>{g()},[m]);const g=async()=>{const w=a.trim();if(!w){o([]),h(null);return}l(!0),h(null),o([]),console.log(`Searching for: ${w}`);try{const S=await Z("/api/lab");if(!S.ok){let A;try{A=await S.json()}catch{A={message:`Server returned status ${S.status}`}}throw console.error("Search fetch error response:",A),new Error(A.message||`HTTP error! status: ${S.status}`)}const{orders:_}=await S.json();console.log("Received lab orders for search:",_);const D=_.filter(A=>!!A.report_content).map(A=>{var P,Q;return{id:A.id,labTokenNumber:String(A.lab_token_number??"N/A"),patientName:((P=A.Patient)==null?void 0:P.name)||"N/A",patientId:A.patient_id,patientTokenNumber:String(((Q=A.Patient)==null?void 0:Q.patient_token_number)??"N/A"),tests:(A.tests||[]).map(G=>G.name||"Unknown Test"),date:gl(new Date(A.createdAt),"yyyy-MM-dd"),status:A.status}}),O=new Da(D,{keys:["patientName","labTokenNumber","patientTokenNumber","tests","id","patientId"],threshold:.3,ignoreLocation:!0}),M=a.trim()?O.search(a).map(A=>A.item):D;console.log("Filtered search results:",M),o(M),M.length===0&&w?h(`No matching reports found for "${w}".`):h(null)}catch(S){console.error("Failed to search lab reports:",S),h(S instanceof Error?S.message:"An unknown error occurred during search")}finally{l(!1)}},y=w=>{console.log(`Result clicked, navigating to view report for order ID: ${w}`),t(`/lab/view-report/${w}`)},b=w=>{switch(w){case"pending":return{text:"Sample Pending",color:"text-red-600 bg-red-100"};case"collected":return{text:"Sample Collected",color:"text-yellow-600 bg-yellow-100"};case"processing":return{text:"Processing",color:"text-blue-600 bg-blue-100"};case"completed":return{text:"Completed",color:"text-green-600 bg-green-100"};case"cancelled":return{text:"Cancelled",color:"text-gray-600 bg-gray-100 line-through"};case"reported":return{text:"Reported",color:"text-purple-600 bg-purple-100"};default:return{text:w,color:"text-gray-600 bg-gray-100"}}},v=w=>{switch(w){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{style:{margin:0},children:"Search Lab Reports"}),e.jsxs("button",{onClick:()=>t(-1),className:"lab-inventory-button lab-inventory-button-secondary","aria-label":"Go back",children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}}),"Back"]})]}),e.jsxs("div",{className:"lab-inventory-form-group",style:{marginTop:"20px",position:"relative"},children:[e.jsx("label",{htmlFor:"report-search",children:"Enter Search Term"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",position:"relative"},children:[e.jsx(fn,{size:20,style:{position:"absolute",left:"10px",color:"#777"}}),e.jsx("input",{id:"report-search",type:"text",placeholder:"Patient name, ID, token, report ID, test name...",value:a,onChange:w=>n(w.target.value),className:"lab-inventory-input",style:{paddingLeft:"40px",marginBottom:"0"}})]})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[i&&e.jsx("div",{className:"loading-text",children:"Searching..."}),d&&!i&&e.jsxs("div",{className:"error-text",children:[e.jsx(Nn,{size:20,className:"inline mr-2"})," ",d]}),c.length>0&&!i&&e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:c.map(w=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>y(w.id),style:{marginBottom:"15px",cursor:"pointer",padding:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:[e.jsx(kC,{size:18,style:{marginRight:"8px",verticalAlign:"middle"}}),w.patientName," (Token: ",w.patientTokenNumber,")"]}),e.jsx("span",{className:v(w.status),children:b(w.status).text})]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:[e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(_s,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Order ID: ",w.id]}),e.jsxs("div",{style:{marginBottom:"5px"},children:[e.jsx(CC,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Tests: ",w.tests.join(", ")]}),e.jsxs("div",{children:[e.jsx(_C,{size:16,style:{marginRight:"5px",verticalAlign:"middle"}}),"Date: ",w.date]})]})]},w.id))}),!i&&c.length===0&&!d&&a.trim()&&e.jsxs("div",{className:"no-data-message",children:['No results found for "',a,'".']}),!i&&c.length===0&&!d&&!a.trim()&&e.jsx("div",{className:"no-data-message",style:{backgroundColor:"transparent",border:"none",textAlign:"left",padding:"5px 0"},children:"Enter a search term above to find lab reports."})]})]})})},O5=()=>{const{patientId:t}=Fn(),a=ft(),[n,i]=x.useState([]),[l,c]=x.useState(!0),[o,d]=x.useState(null),[h,m]=x.useState(null),[f,g]=x.useState(null);x.useEffect(()=>{(async()=>{if(!t){d("Patient ID is missing from the URL."),c(!1);return}c(!0),d(null),i([]),g(null);try{const v=await Z(`/api/patients/${t}`);if(v.ok){const _=await v.json();g(_.name||`Patient ID: ${t}`)}else console.warn(`Failed to fetch patient name for ID ${t}`),g(`Patient ID: ${t}`);const w=await Z(`/api/lab/patient/${t}`);if(!w.ok){const _=await w.json().catch(()=>({}));throw new Error(_.message||`HTTP error! status: ${w.status}`)}const S=await w.json();i(S||[])}catch(v){console.error("Error fetching data:",v),d(`Failed to load data: ${v.message}`)}finally{c(!1)}})()},[t]);const y=b=>{b.report_content?a(`/lab/view-report/${b.id}`):a(`/lab/enter-report/${b.id}`)};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0},children:["Lab Reports ",f?`for ${f}`:`for Patient ID: ${t}`]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("button",{onClick:async()=>{if(!t){alert("Patient ID is missing. Cannot create a new report.");return}try{const b=await Z("/api/lab/create-empty-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:t})});if(!b.ok){const w=await b.json().catch(()=>({message:`Failed to create new lab order: ${b.status}`}));throw new Error(w.message||`Failed to create new lab order: ${b.status}`)}const v=await b.json();a(`/lab/enter-report/${v.newOrderId}`)}catch(b){console.error("Error creating new lab order:",b),alert(`Error creating new lab order: ${b.message}`)}},className:"lab-inventory-button",disabled:!t,title:t?"Enter a new lab report for this patient":"Patient ID missing",children:[e.jsx(wa,{size:16,style:{marginRight:"5px"}}),"Enter New Report"]}),e.jsxs("button",{onClick:()=>a(-1),className:"lab-inventory-button lab-inventory-button-secondary",children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}}),"Back"]})]})]}),e.jsx("div",{style:{marginTop:"20px"},children:l?e.jsx("div",{className:"skeleton-reports-list",children:[1,2,3].map(b=>e.jsxs("div",{className:"lab-inventory-card",style:{marginBottom:"15px",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(U,{variant:"circular",width:24,height:24,style:{marginRight:"15px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx(U,{width:"40%",height:20,style:{marginBottom:"8px"}}),e.jsx(U,{width:"60%",height:16})]})]}),e.jsx("div",{style:{marginLeft:"10px"},children:e.jsx(U,{width:80,height:24,style:{borderRadius:"12px"}})})]},b))}):o?e.jsxs("div",{className:"error-text",style:{textAlign:"center",padding:"20px"},children:[e.jsx(DC,{size:40,style:{marginBottom:"10px",color:"#721c24"}}),e.jsx("h3",{style:{fontSize:"1.2em",color:"#721c24",margin:"10px 0"},children:"Error Loading Reports"}),e.jsx("p",{children:o})]}):n.length===0?e.jsxs("div",{className:"no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(_s,{size:48,className:"mb-3",style:{margin:"0 auto 15px auto",display:"block"}}),e.jsx("p",{children:"No lab reports found for this patient."}),e.jsxs("p",{children:["You can ",e.jsx(Ss,{to:`/lab/create-order/${t}`,className:"lab-inventory-link",children:"create a new lab order"}),"."]})]}):h?e.jsxs("div",{className:"lab-inventory-card",style:{backgroundColor:"#fdfdfd"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.3em",borderBottom:"none",margin:0},children:["Report from: ",h.report_date?gl(new Date(h.report_date),"PPP p"):"N/A"]}),e.jsxs("button",{onClick:()=>m(null),className:"lab-inventory-button lab-inventory-button-secondary",style:{fontSize:"0.9em",padding:"8px 12px"},children:[e.jsx(Et,{size:16,style:{marginRight:"5px"}})," Back to List"]})]}),e.jsxs("p",{style:{marginBottom:"15px",fontSize:"1em"},children:[e.jsx("strong",{children:"Tests Ordered:"})," ",(h.tests||[]).map(b=>b.name).join(", ")]}),e.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6",border:"1px solid #eee",padding:"15px",borderRadius:"4px",background:"#fff"},children:e.jsx(qa,{remarkPlugins:[Wn],children:h.report_content||"*No findings recorded.*"})})]}):e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:n.map(b=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>y(b),tabIndex:0,onKeyPress:v=>v.key==="Enter"&&y(b),style:{marginBottom:"15px",cursor:"pointer",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(_s,{size:24,style:{marginRight:"15px",color:"#007bff"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:["Order Date: ",gl(new Date(b.createdAt),"PPP")]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:["Tests: ",b.tests&&b.tests.length>0?b.tests.map(v=>v.name).join(", "):"N/A"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[b.status&&e.jsx("span",{className:z5(b.status),children:I5(b.status)}),e.jsx(jl,{size:20,style:{color:"#6c757d"}})]})]},b.id))})})]})})},I5=t=>{if(!t)return"Unknown";switch(t.toLowerCase()){case"pending":return"Pending Sample";case"collected":return"Sample Collected";case"processing":return"Processing";case"report_ready":return"Report Ready";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return t.charAt(0).toUpperCase()+t.slice(1)}},z5=t=>{if(!t)return"status-badge";switch(t.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}},MS=()=>{const t=ft(),[a]=v1(),n=a.get("search")||"",[i,l]=x.useState("pharmacy");return us(void 0,300),e.jsxs("div",{className:"inventory-management-container",style:{padding:"10px 15px",backgroundColor:"var(--background-color)",minHeight:"100vh"},children:[e.jsxs("div",{className:"inventory-header",style:{marginBottom:"10px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"8px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>t(-1),className:"action-icon-button",title:"Go Back",style:{background:"none",border:"none",cursor:"pointer",color:"var(--text-primary)"},children:e.jsx(Et,{size:20})}),e.jsx("h1",{style:{margin:0,fontSize:"1.4rem",fontWeight:"700",color:"var(--text-primary)"},children:"Inventory Management"})]}),e.jsxs("div",{className:"inventory-tabs",style:{display:"flex",gap:"4px",backgroundColor:"var(--card-bg, #f3f4f6)",padding:"3px",borderRadius:"8px",border:"1px solid var(--border-color, #e5e7eb)"},children:[e.jsxs("button",{onClick:()=>l("pharmacy"),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 16px",border:"1px solid",borderColor:i==="pharmacy"?"var(--primary-color-20, #e0e7ff)":"transparent",borderRadius:"6px",backgroundColor:i==="pharmacy"?"var(--card-bg-active, #fff)":"transparent",boxShadow:i==="pharmacy"?"0 1px 2px rgba(0,0,0,0.05)":"none",color:i==="pharmacy"?"var(--primary-color)":"var(--text-secondary, #6b7280)",fontWeight:i==="pharmacy"?"600":"500",cursor:"pointer",transition:"all 0.2s ease",fontSize:"0.85rem"},children:[e.jsx(kr,{size:16}),"Pharmacy Stock"]}),e.jsxs("button",{onClick:()=>l("lab"),style:{display:"flex",alignItems:"center",gap:"6px",padding:"6px 16px",border:"1px solid",borderColor:i==="lab"?"var(--primary-color-20, #e0e7ff)":"transparent",borderRadius:"6px",backgroundColor:i==="lab"?"var(--card-bg-active, #fff)":"transparent",boxShadow:i==="lab"?"0 1px 2px rgba(0,0,0,0.05)":"none",color:i==="lab"?"var(--primary-color)":"var(--text-secondary, #6b7280)",fontWeight:i==="lab"?"600":"500",cursor:"pointer",transition:"all 0.2s ease",fontSize:"0.85rem"},children:[e.jsx(Cs,{size:16}),"Lab Stock"]})]})]}),e.jsx("div",{className:"inventory-content",style:{backgroundColor:"var(--card-bg, #fff)",borderRadius:"16px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",overflow:"hidden"},children:i==="pharmacy"?e.jsx(Sw,{isEmbedded:!0,initialSearch:n}):e.jsx(Ax,{isEmbedded:!0})})]})},F5=({fetchWithAuth:t})=>{const a=ft(),[n,i]=x.useState(!0),[l,c]=x.useState([]),[o,d]=x.useState(null),[h,m]=x.useState(null),f=x.useCallback(async()=>{i(!0),d(null);try{const v=await(await t("/staff")).json();c(v.map(w=>({...w,id:w._id||w.id})))}catch(b){d(`Failed to load staff data: ${b.message}`),c([])}finally{i(!1)}},[t]);x.useEffect(()=>{f()},[f]),x.useEffect(()=>{if(h){const b=setTimeout(()=>m(null),5e3);return()=>clearTimeout(b)}},[h]);const g=b=>{switch(b){case"doctor":return"admin-pill-info";case"receptionist":return"admin-pill-success";case"pharmacy":return"admin-pill-primary";case"lab":return"admin-pill-warning";case"admin":return"admin-pill-neutral";default:return"admin-pill-neutral"}},y=b=>{switch(b){case"doctor":return e.jsx(ix,{size:16,className:"mr-2 text-blue-600"});case"receptionist":return e.jsx(ax,{size:16,className:"mr-2 text-green-600"});case"pharmacy":return e.jsx(kr,{size:16,className:"mr-2 text-purple-600"});case"lab":return e.jsx(Cs,{size:16,className:"mr-2 text-yellow-600"});case"admin":return e.jsx(vl,{size:16,className:"mr-2 text-teal-600"});default:return e.jsx(Vo,{size:16,className:"mr-2 text-gray-500"})}};return n?e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(U,{width:40,height:40,variant:"circular"}),e.jsx(U,{width:200,height:32})]}),e.jsx(U,{width:150,height:40})]}),e.jsx("div",{className:"staff-table-container",children:e.jsxs("table",{className:"staff-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{className:"hidden md:table-cell",children:"OPD Fee ()"}),e.jsx("th",{className:"hidden md:table-cell",children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(b=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:60,height:20})}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx(U,{width:60,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{children:e.jsx(U,{width:80,height:32})})]},b))})]})})]}):e.jsxs("div",{className:"staff-page-container",children:[h&&e.jsxs("div",{className:`mb-4 p-3 rounded-md flex items-center ${h.type==="success"?"bg-green-100 border border-green-400 text-green-700":"bg-red-100 border border-red-400 text-red-700"}`,role:"alert",children:[h.type==="success"?e.jsx(ka,{size:18,className:"mr-2"}):e.jsx(Nn,{size:18,className:"mr-2"}),e.jsx("span",{children:h.message}),e.jsx("button",{onClick:()=>m(null),className:"ml-auto text-xl font-bold",children:""})]}),o&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",role:"alert",children:[e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),o,e.jsx("button",{onClick:()=>d(null),className:"ml-auto text-red-600 hover:text-red-800 text-xl font-bold",children:""})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>a(-1),className:"p-2 rounded-md hover:bg-gray-200",children:e.jsx(Et,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Staff"})]}),e.jsxs("button",{onClick:()=>a("/dashboard/staff/add"),className:"bg-teal-600 text-white px-4 py-2 rounded-md hover:bg-teal-700 flex items-center",children:[e.jsx(bn,{size:16,className:"mr-2"})," Add New Staff"]})]}),e.jsx("div",{className:"staff-table-container",children:e.jsxs("table",{className:"staff-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{className:"hidden md:table-cell",children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{className:"hidden md:table-cell",children:"OPD Fee ()"}),e.jsx("th",{className:"hidden md:table-cell",children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:l.length===0&&!n?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4",children:"No staff members found."})}):l.map(b=>e.jsxs("tr",{children:[e.jsx("td",{children:b.name}),e.jsx("td",{className:"hidden md:table-cell",children:b.email}),e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${g(b.role)}`,children:[y(b.role),b.role.charAt(0).toUpperCase()+b.role.slice(1)]})}),e.jsx("td",{className:"hidden md:table-cell",children:b.role==="doctor"?b.opd_fee?parseFloat(String(b.opd_fee)).toFixed(2):"Not Set":"N/A"}),e.jsx("td",{className:"hidden md:table-cell",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:b.status==="active"?"Active":"Inactive"})}),e.jsx("td",{className:"actions",children:e.jsxs("button",{onClick:()=>a(`/dashboard/staff/edit/${b.id}`),className:"edit-link",disabled:b.role==="admin",title:"Edit Staff",children:[e.jsx(ma,{size:16})," Edit"]})})]},b.id))})]})})]})},r1=()=>{var Ce,Ue,Pe,de,Se,ee,oe,fe,ge,q,W,Y,ie,ce,pe,He,We,st,me;const{patientId:t,billId:a}=Fn(),n=ft(),[i,l]=x.useState(null),[c,o]=x.useState(!0),[d,h]=x.useState(null),[m,f]=x.useState(""),[g,y]=x.useState("cash"),[b,v]=x.useState(!1),[w,S]=x.useState(""),[_,E]=x.useState(""),[D,O]=x.useState(""),[M,A]=x.useState(""),[P,Q]=x.useState([]),[G,C]=x.useState(""),[R,z]=x.useState([]),[F,J]=x.useState(0),H=((Ce=i==null?void 0:i.patient)==null?void 0:Ce.insurance_type)==="no_cash_insurance";x.useEffect(()=>{y(H?"no_cash_insurance":"cash")},[H]),x.useEffect(()=>{a&&(async()=>{o(!0),h(null);try{const[Fe,Ee,L]=await Promise.all([Z(`/api/bills/${a}`),Z("/api/clinics/settings").catch(()=>null),Z(`/api/bills?patientId=${t}`).catch(()=>null)]);if(!Fe.ok)throw new Error(`HTTP error! status: ${Fe.status}`);const ne=await Fe.json();if(!ne||!ne.bill||!ne.calculated)throw new Error("Incomplete data structure received from backend.");if(ne.bill.type!=="admission")throw new Error(`Unexpected bill type: ${ne.bill.type}. Expected 'admission'.`);const xe=Array.isArray(ne.admissionPayments)?ne.admissionPayments:[];if(l({...ne.bill,amount:ne.bill.amount,created_at:ne.bill.createdAt||ne.bill.created_at,items:(ne.bill.items||[]).map(ae=>({...ae,price:parseFloat(ae.price)||0,quantity:parseInt(ae.quantity)||1})),AdmissionPayments:xe,calculated:ne.calculated,admissionRecord:ne.admissionRecord,patient:ne.bill.Patient?{id:ne.bill.Patient.id,name:ne.bill.Patient.name,admission_date:ne.bill.Patient.admission_date,discharge_date:ne.bill.Patient.discharge_date,token:ne.bill.Patient.patient_token_number||ne.bill.Patient.token,insurance_type:ne.bill.Patient.insurance_type}:void 0}),Ee&&Ee.ok){const ae=await Ee.json();S(ae.name||""),E(ae.address||""),O(ae.notes||""),A(ae.upi_id||"")}try{const ae=await Z(`/api/patients/${t}/admission-payments`);if(ae.ok){const we=await ae.json();Q(we)}}catch(ae){console.error("Failed to fetch payment history:",ae)}if(L&&L.ok){const we=((await L.json()).bills||[]).filter(Je=>Je.type==="admission"&&Je.id!==a).map(Je=>{var xt,be;const ot=Je.AdmissionRecord;return{id:Je.id,amount:ot?parseFloat(ot.total_amount):parseFloat(Je.amount)||0,status:ot?ot.balance<=0||ot.status==="discharged"&&ot.balance<=0?"paid":"pending":Je.status,created_at:Je.createdAt||Je.created_at,admission_date:ot?ot.admission_date:((xt=Je.Patient)==null?void 0:xt.admission_date)||Je.admission_date,discharge_date:ot?ot.discharge_date:((be=Je.Patient)==null?void 0:be.discharge_date)||Je.discharge_date,admissionRecord:ot}});z(we);const Le=we.filter(Je=>Je.admissionRecord?Je.admissionRecord.balance>0:Je.status!=="paid").reduce((Je,ot)=>ot.admissionRecord?Je+(typeof ot.admissionRecord.balance=="string"?parseFloat(ot.admissionRecord.balance):ot.admissionRecord.balance):Je+ot.amount,0);J(Le)}}catch(Fe){console.error("Failed to fetch admission bill details:",Fe),h(Fe instanceof Error?Fe.message:"An unknown error occurred")}finally{o(!1)}})()},[a,t]),x.useEffect(()=>{(async()=>{if(!a){if(!t){h("Patient ID is missing."),o(!1);return}try{o(!0);const Fe=await Z(`/api/patients/${t}`);if(Fe.ok){const Ee=await Fe.json();if(Ee){if(Ee.admission_date&&!Ee.discharge_date){const ne=await Z(`/api/patients/${t}/active-bill?type=admission`);if(ne.ok){const xe=await ne.json();if(xe&&xe.id){n(`/patient/${t}/admission-bill/${xe.id}`,{replace:!0});return}}}l({id:0,patient_id:Ee.id,type:"admission",amount:"0",status:"pending",created_at:new Date().toISOString(),AdmissionPayments:[],calculated:{totalPaid:0,totalDue:0,balance:0,daysStayed:0,perDayCharge:0},patient:{id:Ee.id,name:Ee.name,admission_date:Ee.admission_date,discharge_date:Ee.discharge_date,token:Ee.token,insurance_type:Ee.insurance_type}});const L=await Z(`/api/bills?patientId=${t}`);if(L.ok){const xe=((await L.json()).bills||[]).filter(ae=>ae.type==="admission").map(ae=>{var Le,Je;const we=ae.AdmissionRecord;return{id:ae.id,amount:we?parseFloat(we.total_amount):parseFloat(ae.amount)||0,status:we?we.balance<=0||we.status==="discharged"&&we.balance<=0?"paid":"pending":ae.status,created_at:ae.createdAt||ae.created_at,admission_date:we?we.admission_date:((Le=ae.Patient)==null?void 0:Le.admission_date)||ae.admission_date,discharge_date:we?we.discharge_date:((Je=ae.Patient)==null?void 0:Je.discharge_date)||ae.discharge_date,admissionRecord:we}});z(xe)}}else h("Patient not found")}}catch(Fe){console.error("Error fetching patient status:",Fe),h("Failed to load patient details")}finally{o(!1)}}})()},[t,a,n]);const I=async()=>{if(t){v(!0);try{const ve=await Z(`/api/patients/${t}/admit`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!ve.ok){const Ee=await ve.json();throw new Error(Ee.message||"Failed to admit patient")}const Fe=await ve.json();Fe.bill&&Fe.bill.id?n(`/patient/${t}/admission-bill/${Fe.bill.id}`):window.location.reload()}catch(ve){h(ve instanceof Error?ve.message:"Failed to admit patient"),v(!1)}}},V=async()=>{if(t&&window.confirm("Are you sure you want to discharge this patient? This will finalize the bill.")){v(!0);try{const ve=await Z(`/api/patients/${t}/discharge`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!ve.ok){const Fe=await ve.json();throw new Error(Fe.message||"Failed to discharge patient")}window.location.reload()}catch(ve){h(ve instanceof Error?ve.message:"Failed to discharge patient"),v(!1)}}},re=((Ue=i==null?void 0:i.patient)==null?void 0:Ue.admission_date)&&!((Pe=i==null?void 0:i.patient)!=null&&Pe.discharge_date),B=!!((de=i==null?void 0:i.patient)!=null&&de.discharge_date);x.useEffect(()=>{var Ee,L;const Fe=Number(((Ee=i==null?void 0:i.calculated)==null?void 0:Ee.balance)??((L=i==null?void 0:i.admissionRecord)==null?void 0:L.balance)??0)+F;if(Fe>0&&M){const ne=`upi://pay?pa=${M}&pn=${encodeURIComponent(w||"Clinic")}&am=${Fe.toFixed(2)}&cu=INR`;C(ne)}else C("")},[i,F,M,w]);const k=async ve=>{var L,ne;ve.preventDefault();const Ee=Number(((L=i==null?void 0:i.calculated)==null?void 0:L.balance)??((ne=i==null?void 0:i.admissionRecord)==null?void 0:ne.balance)??0)+F;if(!t||!m||isNaN(parseFloat(m))||parseFloat(m)<=0||parseFloat(m)>Ee){h("Please enter a valid payment amount within the total outstanding.");return}h(null),v(!0);try{const xe=await Z(`/api/patients/${t}/admission-payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount_paid:parseFloat(m),payment_mode:g})});if(!xe.ok){const Le=await xe.json();throw new Error(Le.message||`HTTP error! status: ${xe.status}`)}const we=await(await Z(`/api/bills/${a}`)).json();if(we&&we.bill&&we.calculated&&we.admissionPayments)l({...we.bill,amount:parseFloat(we.bill.amount),AdmissionPayments:we.admissionPayments,calculated:we.calculated,patient:we.bill.Patient?{id:we.bill.Patient.id,name:we.bill.Patient.name,admission_date:we.bill.Patient.admission_date,discharge_date:we.bill.Patient.discharge_date,token:we.bill.Patient.token,insurance_type:we.bill.Patient.insurance_type}:void 0});else throw new Error("Invalid data structure received after payment submission.");f(""),setTimeout(()=>{window.print()},100)}catch(xe){console.error("Failed to submit payment:",xe),h(xe instanceof Error?xe.message:"Failed to record payment")}finally{v(!1)}},Ne=()=>{window.print()};if(c)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("div",{className:"billing-header no-print",children:[e.jsx("div",{className:"back-button",children:e.jsx(U,{width:100,height:40,style:{borderRadius:"8px"}})}),e.jsx(U,{width:300,height:40})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsx("main",{className:"order-content",children:e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx("div",{className:"info-item",children:e.jsx(U,{width:200,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:150,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:180,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:150,height:20})})]})]})}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:160,height:24})})}),e.jsxs("div",{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]})]})]})})]})]})});if(d)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>n(-1),className:"back-button",children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Admission Bill"})]}),e.jsxs("div",{className:"error-message-box",children:["Error: ",d]})]})});if(!i||!i.calculated)return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsx("div",{className:"error-message-box",children:"No bill details found or data is incomplete."})});const Ae=Number(i.calculated&&i.calculated.balance!==void 0?i.calculated.balance:i.admissionRecord?i.admissionRecord.balance:0),T=i.status==="paid"||Ae<=0;return e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"ADMISSION BILL"}),e.jsx("h2",{className:"clinic-name-print",children:w||"Hospital"}),(_||D)&&e.jsxs("div",{className:"clinic-details-print",children:[_&&e.jsx("span",{className:"small-text clinic-address",children:_}),D&&e.jsx("span",{className:"small-text clinic-notes",children:D})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient"]})," ",((Se=i.patient)==null?void 0:Se.name)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",((ee=i.patient)==null?void 0:ee.token)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Date"]})," ",new Date(i.created_at).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>n(-1),className:"back-button",children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Admission Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsxs("div",{className:"card-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h2",{children:"Patient Information"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[!re&&!B&&e.jsxs("button",{onClick:I,disabled:b,className:"primary-button",style:{fontSize:"0.85em",padding:"6px 12px"},children:[e.jsx(Xh,{size:16})," Admit Patient"]}),re&&e.jsxs("button",{onClick:V,disabled:b,className:"secondary-button",style:{fontSize:"0.85em",padding:"6px 12px",background:"#dc3545",color:"white"},children:[e.jsx(EC,{size:16})," Discharge"]}),B&&e.jsxs("button",{onClick:I,disabled:b,className:"primary-button",style:{fontSize:"0.85em",padding:"6px 12px"},children:[e.jsx(TC,{size:16})," Re-Admit"]})]})]}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",((oe=i.patient)==null?void 0:oe.name)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",((fe=i.patient)==null?void 0:fe.token)??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(AC,{size:16})," Bill ID"]})," ",i.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Created"]})," ",new Date(i.created_at).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Admission Charges Breakdown"})}),e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"AMOUNT"})]})}),e.jsxs("tbody",{children:[i.admissionRecord?e.jsxs(e.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"1"}),e.jsx("td",{children:"Admission Charge"}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["",Number(i.admissionRecord.admission_charge).toFixed(2)]}),e.jsxs("td",{children:["",Number(i.admissionRecord.admission_charge).toFixed(2)]})]}),i.admissionRecord.days_stayed?e.jsxs("tr",{children:[e.jsx("td",{children:"2"}),e.jsxs("td",{children:["Per Day Charges",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",new Date(i.admissionRecord.admission_date).toLocaleDateString(),i.admissionRecord.discharge_date?` - ${new Date(i.admissionRecord.discharge_date).toLocaleDateString()}`:" - Ongoing",")"]})]}),e.jsxs("td",{children:[i.admissionRecord.days_stayed," days"]}),e.jsxs("td",{children:["",Number(i.admissionRecord.per_day_charge).toFixed(2)]}),e.jsxs("td",{children:["",(Number(i.admissionRecord.days_stayed)*Number(i.admissionRecord.per_day_charge)).toFixed(2)]})]}):i.calculated.daysStayed&&i.calculated.perDayCharge&&i.calculated.perDayCharge>0?e.jsxs("tr",{children:[e.jsx("td",{children:"2"}),e.jsxs("td",{children:["Per Day Charges (Ongoing)",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",new Date(i.admissionRecord.admission_date).toLocaleDateString()," - Today)"]})]}),e.jsxs("td",{children:[i.calculated.daysStayed," days"]}),e.jsxs("td",{children:["",i.calculated.perDayCharge.toFixed(2)]}),e.jsxs("td",{children:["",(i.calculated.daysStayed*i.calculated.perDayCharge).toFixed(2)]})]}):null]}):e.jsxs(e.Fragment,{children:[i.items&&i.items.length>0?i.items.map((ve,Fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:Fe+1}),e.jsx("td",{children:ve.name}),e.jsx("td",{children:ve.quantity}),e.jsxs("td",{children:["",ve.price.toFixed(2)]}),e.jsxs("td",{children:["",(ve.price*ve.quantity).toFixed(2)]})]},`item-${Fe}`)):e.jsxs("tr",{children:[e.jsx("td",{children:"1"}),e.jsx("td",{children:"Initial Admission Charge"}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["",parseFloat(i.amount).toFixed(2)]}),e.jsxs("td",{children:["",parseFloat(i.amount).toFixed(2)]})]}),i.calculated.daysStayed&&i.calculated.perDayCharge&&i.calculated.perDayCharge>0&&e.jsxs("tr",{children:[e.jsx("td",{children:(((ge=i.items)==null?void 0:ge.length)||1)+1}),e.jsxs("td",{children:["Per Day Charges",e.jsxs("small",{style:{display:"block",color:"#6b7280",fontSize:"0.75em"},children:["(",(q=i.patient)!=null&&q.admission_date?new Date(i.patient.admission_date).toLocaleDateString():"",(W=i.patient)!=null&&W.discharge_date?` - ${new Date(i.patient.discharge_date).toLocaleDateString()}`:" - Ongoing",")"]})]}),e.jsxs("td",{children:[i.calculated.daysStayed," days"]}),e.jsxs("td",{children:["",i.calculated.perDayCharge.toFixed(2)]}),e.jsxs("td",{children:["",(i.calculated.daysStayed*i.calculated.perDayCharge).toFixed(2)]})]})]}),e.jsxs("tr",{className:"subtotal-row current-admission-row",children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"Current Admission Total"}),e.jsxs("td",{children:["",Number(((Y=i.calculated)==null?void 0:Y.totalDue)??((ie=i.admissionRecord)==null?void 0:ie.total_amount)??0).toFixed(2)]})]}),R.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("tr",{className:"section-header-row previous-admissions-header",children:e.jsx("td",{colSpan:5,style:{fontWeight:600,textAlign:"center"},children:"Previous Admissions"})}),R.map((ve,Fe)=>e.jsxs("tr",{className:ve.status!=="paid"?"bill-row-unpaid":"bill-row-paid",children:[e.jsx("td",{children:Fe+1}),e.jsxs("td",{children:["Admission - ",ve.admission_date?new Date(ve.admission_date).toLocaleDateString():"N/A",ve.discharge_date&&e.jsxs("small",{style:{display:"block",color:"inherit",opacity:.8,fontSize:"0.75em"},children:["Discharged: ",new Date(ve.discharge_date).toLocaleDateString()]})]}),e.jsx("td",{children:"1"}),e.jsxs("td",{children:["",ve.amount.toFixed(2)]}),e.jsxs("td",{className:ve.status!=="paid"?"text-danger":"text-success",children:["",ve.amount.toFixed(2),ve.status==="paid"&&e.jsx("small",{style:{marginLeft:"4px"},children:"(Paid)"})]})]},ve.id)),F>0&&e.jsxs("tr",{className:"subtotal-row unpaid-balance-row",children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"Previous Unpaid Balance"}),e.jsxs("td",{children:["",F.toFixed(2)]})]})]}),e.jsxs("tr",{className:`grand-total-row-dynamic ${F>0?"grand-total-unpaid":"grand-total-paid"}`,children:[e.jsx("td",{colSpan:4,style:{textAlign:"right"},children:"GRAND TOTAL"}),e.jsxs("td",{style:{fontSize:"1.1em"},children:["",(Number(((ce=i.calculated)==null?void 0:ce.totalDue)??((pe=i.admissionRecord)==null?void 0:pe.total_amount)??0)+F).toFixed(2)]})]})]})]})]}),P.length>0&&e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Payment History"})}),e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DATE"}),e.jsx("th",{children:"MODE"}),e.jsx("th",{children:"AMOUNT"})]})}),e.jsx("tbody",{children:P.map((ve,Fe)=>{var Ee;return e.jsxs("tr",{children:[e.jsx("td",{children:Fe+1}),e.jsx("td",{children:ve.payment_date?new Date(ve.payment_date).toLocaleDateString():"N/A"}),e.jsx("td",{style:{textTransform:"capitalize"},children:((Ee=ve.payment_mode)==null?void 0:Ee.replace(/_/g," "))||"N/A"}),e.jsxs("td",{children:["",(Number(ve.amount_paid)||0).toFixed(2)]})]},ve.id)})})]})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{children:["",Number(((He=i.calculated)==null?void 0:He.totalDue)??((We=i.admissionRecord)==null?void 0:We.total_amount)??0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{children:["",Number(((st=i.calculated)==null?void 0:st.totalPaid)??((me=i.admissionRecord)==null?void 0:me.total_paid)??0).toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Balance Due: ",Ae.toFixed(2)]})})]}),G&&Ae>0&&e.jsxs("div",{className:"qr-code-container qr-code-printable-section",children:[e.jsx(cs,{value:G,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Due"}),e.jsxs("span",{children:["",(i.calculated.totalDue||0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Days Stayed"}),e.jsx("span",{children:i.calculated.daysStayed??0})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Paid"}),e.jsxs("span",{style:{color:"#28a745"},children:["",(i.calculated.totalPaid||0).toFixed(2)]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Balance Due"}),e.jsxs("strong",{style:{color:Ae>0?"#dc3545":"#28a745"},children:["",Ae.toFixed(2)]})]}),R.length>0&&e.jsxs("div",{style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px dashed #dee2e6"},children:[e.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem",color:"#495057"},children:"Previous Admissions"}),R.map(ve=>e.jsxs("div",{className:"summary-row",style:{fontSize:"0.8rem"},children:[e.jsxs("span",{style:{color:"#6c757d"},children:[ve.admission_date?new Date(ve.admission_date).toLocaleDateString():"N/A",ve.status!=="paid"&&e.jsx("span",{style:{color:"#dc3545",marginLeft:"4px"},children:"(Unpaid)"})]}),e.jsxs("span",{style:{color:ve.status!=="paid"?"#dc3545":"#28a745"},children:["",ve.amount.toFixed(2)]})]},ve.id)),F>0&&e.jsxs("div",{className:"summary-row",style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid #e9ecef"},children:[e.jsx("strong",{style:{color:"#dc3545",fontSize:"0.875rem"},children:"Previous Balance"}),e.jsxs("strong",{style:{color:"#dc3545"},children:["",F.toFixed(2)]})]})]}),F>0&&e.jsxs("div",{className:"summary-row grand-total-row",style:{marginTop:"0.75rem",background:"#fff3cd"},children:[e.jsx("strong",{style:{color:"#856404"},children:"Total Outstanding"}),e.jsxs("strong",{style:{color:"#856404"},children:["",(Ae+F).toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:G&&Ae>0?e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:G,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):Ae<=0?e.jsxs("div",{style:{padding:"20px",textAlign:"center",color:"#28a745"},children:[e.jsx(PC,{size:48}),e.jsx("p",{style:{marginTop:"10px",fontWeight:600},children:"Fully Paid"})]}):e.jsx("p",{children:"UPI QR code not available."})}),!T&&e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentAmount",className:"info-item",children:e.jsx("strong",{children:"Payment Amount ()"})}),e.jsx("input",{type:"number",id:"paymentAmount",value:m,onChange:ve=>f(ve.target.value),placeholder:`Max ${Ae.toFixed(2)}`,min:"0.01",step:"0.01",max:Ae,className:"payment-mode-select",required:!0})]}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:g,onChange:ve=>y(ve.target.value),className:"payment-mode-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),H&&e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})]}),e.jsxs("div",{className:"bill-actions",children:[e.jsx("button",{type:"button",onClick:Ne,className:"secondary-button print-preview-button",children:"Print Preview"}),e.jsx("button",{type:"submit",className:"primary-button",disabled:b||!m||parseFloat(m)<=0||parseFloat(m)>Ae+F,children:b?"Processing...":"Record Payment & Print"})]})]}),T&&e.jsx("div",{className:"bill-actions",children:e.jsx("button",{onClick:Ne,className:"secondary-button",children:"Print Bill"})})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for choosing our hospital!"}),e.jsx("p",{children:"This is a computer-generated bill and does not require a signature."})]})]})})},L5=t=>{switch(t){case"pending":return{text:"text-orange-700",bg:"bg-orange-100"};case"billed":return{text:"text-blue-700",bg:"bg-blue-100"};case"dispensed":return{text:"text-green-700",bg:"bg-green-100"};case"cancelled":return{text:"text-red-700",bg:"bg-red-100"};default:return{text:"text-gray-600",bg:"bg-gray-100"}}},$5=()=>{const{orderId:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState(!0),[o,d]=x.useState(null),[h,m]=x.useState(!1),[f,g]=x.useState({}),[y,b]=x.useState(""),[v,w]=x.useState(""),[S,_]=x.useState("cash"),E=x.useMemo(()=>(n==null?void 0:n.medications.reduce((R,z)=>{const F=z.total_price??0,J=F*(z.discount_percentage??0)/100;return R+F-J},0))??0,[n==null?void 0:n.medications]),D=5,O=x.useMemo(()=>!n||!n.medications?0:n.medications.reduce((R,z,F)=>{var B,k;const J=z.drug_id??`index-${F}`,H=((B=f[J])==null?void 0:B.pack)||0,I=((k=f[J])==null?void 0:k.loose)||0,V=z.pack_price??0,re=z.loose_price??0;return R+H*V+I*re},0),[n,f]),M=x.useCallback(async()=>{if(!t){d("Order ID is missing."),c(!1);return}c(!0),d(null);try{const R=await Z(`/api/pharmacy-orders/${t}`);if(!R.ok)throw R.status===404?new Error(`Order with ID ${t} not found.`):new Error(`Failed to fetch order details: ${R.statusText} (${R.status})`);const z=await R.json();console.log("Fetched order data after return:",z);const J=z.medications.map(I=>I.pack_price&&I.loose_price&&I.loose_price>0?{...I,unitsPerPack:Math.round(I.pack_price/I.loose_price)}:{...I,unitsPerPack:0}).map(I=>({...I,discount_percentage:I.discount_percentage??0}));i({...z,medications:J});const H={};J.forEach((I,V)=>{const re=I.drug_id??`index-${V}`;H[re]={pack:0,loose:0}}),g(H)}catch(R){console.error("Failed to fetch order details:",R),d(R.message||"Failed to load order details.")}finally{c(!1)}},[t]);x.useEffect(()=>{M()},[M]),x.useEffect(()=>{(async()=>{try{const z=await Z("/api/clinics/settings");if(!z.ok)throw new Error("Failed to fetch clinic settings");const F=await z.json();console.log("Fetched clinic settings:",F),b(F.upi_id||"")}catch(z){console.error("Error fetching clinic settings:",z)}})()},[]),x.useEffect(()=>{if((n==null?void 0:n.order_total)!==void 0&&n.order_total>0&&y){const R=`upi://pay?pa=${y}&pn=ClinicName&am=${n.order_total.toFixed(2)}&cu=INR`;w(R)}else w("")},[n==null?void 0:n.order_total,y]);const A=(R,z)=>{i(F=>{if(!F)return null;const J=F.medications.map((I,V)=>(I.drug_id??`index-${V}`)===R?{...I,discount_percentage:isNaN(z)?0:z}:I),H=J.reduce((I,V)=>{const re=V.total_price??0,B=re*(V.discount_percentage??0)/100;return I+re-B},0);return{...F,medications:J,order_total:H}})},P=(R,z,F)=>{g(J=>{const H=F.unitsPerPack||0,V=F.pack_quantity*H+F.loose_quantity,re=Math.max(0,Math.min(z,V));let B=0,k=re;return H>0&&(B=Math.floor(re/H),k=re%H),{...J,[R]:{pack:B,loose:k}}})},Q=async()=>{const R=n==null?void 0:n.medications.map((z,F)=>{var V,re;const J=z.drug_id??`index-${F}`,H=((V=f[J])==null?void 0:V.pack)||0,I=((re=f[J])==null?void 0:re.loose)||0;return H>0||I>0?{drug_id:z.drug_id,name:z.name,pack_quantity:z.pack_quantity,loose_quantity:z.loose_quantity,returnPackQuantity:H,returnLooseQuantity:I}:null}).filter(z=>z!==null);if(!R||R.length===0){alert("Please select a quantity greater than 0 for at least one item to return.");return}if(!t){alert("Order ID is missing. Cannot process return.");return}if(!R){alert("Could not prepare items for return.");return}m(!0),d(null);try{const z=await Z(`/api/pharmacy-orders/${t}/return`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itemsToReturn:R})}),F=await z.json();if(!z.ok)throw new Error(F.message||`Failed to process return: ${z.statusText}`);alert("Return processed successfully! Stock has been updated.");const J={};n==null||n.medications.forEach((H,I)=>{const V=H.drug_id??`index-${I}`;J[V]={pack:0,loose:0}}),g(J),M()}catch(z){console.error("Failed to process return:",z),d(z.message||"An error occurred while processing the return."),alert(`Error processing return: ${z.message||"Unknown error"}`)}finally{m(!1)}};if(l)return e.jsx("div",{className:"text-center p-6 text-gray-500 animate-pulse",children:"Loading Order Details..."});if(o)return e.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>a(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(Et,{size:14,className:"mr-1.5"})," Back"]}),e.jsxs("div",{className:"bg-red-50 border border-red-300 text-red-700 rounded p-4",children:["Error: ",o]})]});if(!n)return e.jsxs("div",{className:"p-6 max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>a(-1),className:"mb-4 inline-flex items-center px-3 py-1.5 border border-gray-300 text-xs font-medium rounded shadow-sm text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e.jsx(Et,{size:14,className:"mr-1.5"})," Back"]}),e.jsx("div",{className:"text-center py-10 px-4 text-gray-500 bg-white rounded-lg shadow",children:"Order details could not be loaded."})]});const G=()=>{window.print()},C=L5(n.status);return e.jsx("div",{className:"pharmacy-order-details-page",children:e.jsxs("div",{className:"order-details-container printable-section",children:[e.jsxs("div",{className:"order-details-header no-print",children:[e.jsx("h1",{children:"Pharmacy Order Details"}),e.jsxs("div",{className:"actions",children:[e.jsxs("button",{onClick:()=>a(-1),className:"back-button",children:[e.jsx(Et,{size:18})," Back to Queue"]}),e.jsxs("button",{onClick:G,className:"print-button",children:[e.jsx(Ys,{size:18})," Print Bill"]})]})]}),e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{children:"Mahajan Pharmacy"}),e.jsxs("div",{className:"clinic-details-print",children:[e.jsx("span",{className:"small-text clinic-address",children:"D.No: 3-1-289, Plot No. 101, Kabela Center, RR Nagar, Vijayawada  520012."}),e.jsx("span",{className:"small-text clinic-notes",children:"Phone: 93919 44733"}),e.jsx("span",{className:"small-text clinic-license",children:"Licence No:RLF20AP2025003328"})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Patient Name:"})," RESHMA"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Token:"})," 12"]}),e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Order Date:"})," 31/10/2025"]})]})]}),e.jsxs("div",{className:"order-info-section no-print",children:[e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Order ID:"})," ",n.id]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Patient:"})," ",n.patientName||"N/A"," (",n.patientTokenNumber||"N/A",")"]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Date:"})," ",new Date(n.date).toLocaleString()]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Prescribed By:"})," ",n.prescribedBy||"N/A"]}),e.jsxs("div",{className:"order-info-item",children:[e.jsx("strong",{children:"Status:"})," ",e.jsx("span",{className:`status-pill ${C.text} ${C.bg}`,children:n.status})]})]}),e.jsxs("div",{className:"medications-section",children:[e.jsx("h2",{children:"Medications Ordered"}),n.medications.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"PACK QTY"}),e.jsx("th",{children:"PACK PRICE"}),e.jsx("th",{children:"LOOSE QTY"}),e.jsx("th",{children:"LOOSE PRICE"}),e.jsx("th",{children:"MRP"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"GST%"}),e.jsx("th",{children:"AMT"}),(n.status==="dispensed"||n.status==="billed")&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"no-print",children:"RETURN PACK QTY"}),e.jsx("th",{className:"no-print",children:"RETURN LOOSE QTY"})]})]})}),e.jsx("tbody",{children:n.medications.map((R,z)=>{var B,k;const F=R.drug_id??`index-${z}`,J=R.total_price??0,H=J*(R.discount_percentage??0)/100,I=J-H,V=((B=f[F])==null?void 0:B.pack)||0,re=((k=f[F])==null?void 0:k.loose)||0;return e.jsxs("tr",{children:[e.jsx("td",{children:R.name}),e.jsx("td",{children:R.pack_quantity??0}),e.jsx("td",{children:R.pack_price!=null?Number(R.pack_price).toFixed(2):"N/A"}),e.jsx("td",{children:R.loose_quantity??0}),e.jsx("td",{children:R.loose_price!=null?Number(R.loose_price).toFixed(2):"N/A"}),e.jsx("td",{children:R.price!=null?Number(R.price).toFixed(2):"N/A"})," ",e.jsx("td",{children:R.price!=null?Number(R.price).toFixed(2):"N/A"})," ",e.jsxs("td",{children:[e.jsx("input",{type:"number",value:R.discount_percentage??0,onChange:Ne=>A(F,parseFloat(Ne.target.value)),min:"0",max:"100",className:"discount-input-table no-print"}),e.jsxs("span",{className:"print-only",children:[R.discount_percentage??0,"%"]})]}),e.jsxs("td",{children:[D.toFixed(1),"%"]}),e.jsx("td",{children:I.toFixed(2)}),(n.status==="dispensed"||n.status==="billed")&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"no-print",children:e.jsx("input",{type:"number",min:"0",max:R.pack_quantity,value:V,onChange:Ne=>{const T=(parseInt(Ne.target.value,10)||0)*(R.unitsPerPack||0)+re;P(F,T,R)},className:"return-quantity-input"})}),e.jsx("td",{className:"no-print",children:e.jsx("input",{type:"number",min:"0",max:R.loose_quantity+R.pack_quantity*(R.unitsPerPack||0)-V*(R.unitsPerPack||0),value:re,onChange:Ne=>{const Ae=parseInt(Ne.target.value,10)||0,T=V*(R.unitsPerPack||0)+Ae;P(F,T,R)},className:"return-quantity-input"})})]})]},F)})})]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No medications listed for this order."})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",E.toFixed(2)]})}),e.jsxs("div",{className:"order-total-section no-print",children:[e.jsx("span",{className:"total-label",children:"Order Total:"}),e.jsxs("span",{className:"total-amount",children:["",E.toFixed(2)]})]}),e.jsxs("div",{className:"payment-section no-print",children:[e.jsxs("div",{className:"payment-mode-group",children:[e.jsx("label",{htmlFor:"paymentMode",children:"Payment Mode:"}),e.jsxs("select",{id:"paymentMode",value:S,onChange:R=>_(R.target.value),className:"payment-mode-select",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit"})]})]}),v&&e.jsxs("div",{className:"qr-code-container",children:[e.jsx(cs,{value:v,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]})]}),(n.status==="dispensed"||n.status==="billed")&&n.medications.length>0&&e.jsxs("div",{className:"return-action-section no-print",children:[O>0&&e.jsxs("div",{className:"total-refund-display",children:["Total Refund: ",O.toFixed(2)]}),e.jsx("button",{onClick:Q,disabled:Object.values(f).every(R=>R.pack===0&&R.loose===0)||h,className:"process-return-button",children:h?e.jsxs(e.Fragment,{children:[e.jsx(hg,{size:16,className:"mr-2 animate-spin"})," Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hg,{size:16,className:"mr-2"})," Process Return"]})})]})]})})},M5=async()=>{const t=await Z("/subscriptions");if(!t.ok)throw new Error("Failed to fetch subscription plans");return await t.json()},B5=async t=>{const a=await Z(`/subscriptions/${t}`);if(!a.ok){const n=await a.json().catch(()=>({message:"Failed to fetch subscription plan details"}));throw new Error(n.message||"Failed to fetch subscription plan details")}return await a.json()},U5=async t=>{const a=await Z("/subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const n=await a.json().catch(()=>({message:"Failed to create subscription plan"}));throw new Error(n.message||"Failed to create subscription plan")}return await a.json()},q5=async(t,a)=>{const n=await Z(`/subscriptions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const i=await n.json().catch(()=>({message:"Failed to update subscription plan"}));throw new Error(i.message||"Failed to update subscription plan")}return await n.json()},H5=async t=>{const a=await Z(`/subscriptions/${t}`,{method:"DELETE"});if(!a.ok){const n=await a.json().catch(()=>({message:"Failed to deactivate subscription plan"}));throw new Error(n.message||"Failed to deactivate subscription plan")}return await a.json()},V5=async(t,a)=>{const n=await Z("/api/payment/razorpay-subscription",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:t,planId:a})});if(!n.ok){const i=await n.json().catch(()=>({message:"Failed to initiate Razorpay subscription"}));throw new Error(i.message||"Failed to initiate Razorpay subscription")}return await n.json()},G5=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState(null),m=x.useCallback(async()=>{l(!0),o(null);try{const g=await M5();n(g)}catch(g){o(g.message||"Failed to fetch subscription plans."),h({type:"error",message:g.message||"Failed to fetch plans."})}finally{l(!1)}},[]);x.useEffect(()=>{m()},[m]),x.useEffect(()=>{if(d){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[d]);const f=async g=>{if(h(null),o(null),window.confirm("Are you sure you want to deactivate this plan? This action cannot be undone directly.")){l(!0),o(null),h(null);try{await H5(g),h({type:"success",message:"Plan deactivated successfully!"}),m()}catch(y){o(y.message||"Failed to deactivate plan."),h({type:"error",message:y.message||"Failed to deactivate plan."})}finally{l(!1)}}};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(ka,{size:18,className:"mr-2 text-green-500"}):e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>h(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(St,{size:16})})]}),e.jsxs("div",{children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(Et,{size:16}),"Back"]}),e.jsx("h1",{children:"Manage Subscription Plans"}),e.jsxs("button",{onClick:()=>t("/dashboard/subscriptions/add"),className:"subscription-btn",children:[e.jsx(bn,{size:16,className:"mr-1 inline-block"})," Add New Plan"]})]}),i&&a.length===0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3].map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:60,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{className:"text-right",children:e.jsx(U,{width:80,height:32})})]},g))})]})}),!i&&c&&a.length===0&&e.jsx("p",{className:"text-center text-red-500",children:c}),a.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:g.name}),e.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),e.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),e.jsx("td",{children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),e.jsxs("td",{className:"actions-cell text-right",children:[e.jsx("button",{onClick:()=>t(`/dashboard/subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:e.jsx(ma,{size:16,className:"inline-block"})}),g.status==="active"&&e.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:i,children:e.jsx(Jt,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!i&&a.length===0&&!c&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No subscription plans found. Add one to get started!"})]})]})},Q5=()=>{const t=ft(),[a,n]=x.useState({name:"",description:"",price:"",period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState(null);x.useEffect(()=>{if(d){const y=setTimeout(()=>h(null),5e3);return()=>clearTimeout(y)}},[d]);const m=y=>{const{name:b,value:v}=y.target;n(w=>({...w,[b]:v}))},f=async y=>{if(y.preventDefault(),l(!0),o(null),h(null),!a.name||!a.price||!a.period||a.interval===void 0||a.interval<=0){o("Please fill in all required fields (Name, Price, Period, Interval > 0)."),l(!1);return}try{await U5(a),h({type:"success",message:"Plan created successfully! Redirecting..."}),setTimeout(()=>{t("/dashboard/subscriptions")},2e3)}catch(b){const v=b.message||"Failed to create plan.";o(v),h({type:"error",message:v})}finally{l(!1)}},g=()=>{t(-1)};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(ka,{size:18,className:"mr-2 text-green-500"}):e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>h(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Add New Subscription Plan"}),c&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:c}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description||"",onChange:m})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:a.price!==void 0?a.price:"",onChange:m,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:a.period||"monthly",onChange:m,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:a.interval||1,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:a.razorpay_plan_id||"",onChange:m})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:i,className:"subscription-btn",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,i?"Creating...":"Create Plan"]})]})]})]})]})},Y5=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState({}),[o,d]=x.useState(!1),[h,m]=x.useState(!0),[f,g]=x.useState(null),[y,b]=x.useState(null),v=x.useCallback(async()=>{if(!t){g("Plan ID is missing."),m(!1);return}m(!0),g(null);try{const E=await B5(t);i(E),c({name:E.name,description:E.description||"",price:E.price,period:E.period,interval:E.interval,razorpay_plan_id:E.razorpay_plan_id||"",status:E.status})}catch(E){g(E.message||"Failed to fetch plan details."),b({type:"error",message:E.message||"Failed to fetch plan details."})}finally{m(!1)}},[t]);x.useEffect(()=>{v()},[v]),x.useEffect(()=>{if(y){const E=setTimeout(()=>b(null),5e3);return()=>clearTimeout(E)}},[y]);const w=E=>{const{name:D,value:O}=E.target;c(M=>({...M,[D]:O}))},S=async E=>{if(E.preventDefault(),!t){g("Plan ID is missing.");return}if(d(!0),g(null),b(null),!l.name||!l.price||!l.period||l.interval===void 0||l.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),d(!1);return}try{await q5(t,l),b({type:"success",message:"Plan updated successfully! Redirecting..."}),setTimeout(()=>{a(-1)},2e3)}catch(D){const O=D.message||"Failed to update plan.";g(O),b({type:"error",message:O})}finally{d(!1)}},_=()=>{a(-1)};return h?e.jsx("div",{className:"p-6 text-center",children:"Loading plan details..."}):f&&!n?e.jsx("div",{className:"p-6 text-center text-red-500",children:f}):n?e.jsxs("div",{className:"subscription-page-container",children:[y&&e.jsxs("div",{className:`${y.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[y.type==="success"?e.jsx(ka,{size:18,className:"mr-2"}):e.jsx(Nn,{size:18,className:"mr-2"}),e.jsx("span",{children:y.message})]}),e.jsx("button",{onClick:()=>b(null),className:"ml-4",children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Edit Subscription Plan"}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name||"",onChange:w,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:l.description||"",onChange:w})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:l.price!==void 0?l.price:"",onChange:w,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:l.period||"monthly",onChange:w,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:l.interval||1,onChange:w,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:l.razorpay_plan_id||"",onChange:w})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:l.status||"active",onChange:w,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:_,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:o,className:"subscription-btn",children:[o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,o?"Saving...":"Save Changes"]})]})]})]})]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Plan not found."})},J5=()=>{const{patientId:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState([]),[o,d]=x.useState(""),[h,m]=x.useState(!0),[f,g]=x.useState(null),[y,b]=x.useState("manual"),[v,w]=x.useState(!1),[S,_]=x.useState(null),E=x.useCallback(async()=>{m(!0),g(null);try{const M=await Z(`/api/patients/${t}`);if(!M.ok){const G=await M.json();throw new Error(G.message||"Failed to fetch patient details")}const A=await M.json();i(A);const P=await Z("/api/subscriptions");if(!P.ok){const G=await P.json();throw new Error(G.message||"Failed to fetch subscription plans")}const Q=await P.json();c(Q.filter(G=>G.status==="active"))}catch(M){console.error("Error fetching data:",M),g(`Failed to load data: ${M.message}`)}finally{m(!1)}},[t]);x.useEffect(()=>{t?E():(g("Patient ID is missing."),m(!1))},[t,E]);const D=(M,A)=>{const P=new Date(M),Q=A.interval||1;switch(A.period){case"daily":P.setDate(M.getDate()+Q);break;case"weekly":P.setDate(M.getDate()+Q*7);break;case"monthly":P.setMonth(M.getMonth()+Q);break;case"yearly":P.setFullYear(M.getFullYear()+Q);break;default:console.warn(`Unknown subscription period: ${A.period}. Defaulting to 1 month.`),P.setMonth(M.getMonth()+1)}return P},O=async()=>{if(!t||!o){_("Please select a subscription plan.");return}const M=l.find(A=>A.id===o);if(!M){_("Selected plan details not found.");return}w(!0),_(null);try{const A=new Date,P=D(A,M);if(y==="manual"){const Q={subscription_plan_id:o,subscription_status:"active",subscription_start_date:A.toISOString(),subscription_end_date:P.toISOString(),subscription_payment_method:"manual"},G=await Z(`/api/patients/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Q)});if(!G.ok){const C=await G.json();throw new Error(C.message||"Failed to start subscription manually")}alert(`Subscription started successfully for ${n==null?void 0:n.name} (Manual Payment)!`),a("/all-patients")}else if(y==="razorpay"){console.log("Initiating Razorpay subscription for plan:",M);const Q=await V5(t,o);if(Q&&Q.short_url)window.location.href=Q.short_url;else throw new Error("Failed to get Razorpay subscription link from backend.")}}catch(A){console.error("Error starting subscription:",A),_(`Failed to start subscription: ${A.message}`),w(!1)}};return h?e.jsx("div",{className:"loading-state-subscription",children:"Loading patient and plans..."}):f?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:f})]}),e.jsxs("button",{onClick:()=>a(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16})," ","Back"]})]}):n?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("button",{onClick:()=>a(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16})," ","Back"]}),e.jsxs("h1",{children:[e.jsx(Rn,{size:28})," ","Start Subscription for ",n.name]}),S&&e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[" ",e.jsx("span",{children:S})]}),e.jsxs("div",{className:"subscription-form",children:[" ",e.jsx("h2",{children:"Available Subscription Plans"}),l.length===0?e.jsx("p",{className:"empty-state",children:"No active subscription plans found."}):e.jsx("div",{className:"subscription-plan-list",children:l.map(M=>e.jsxs("div",{className:`subscription-plan-card ${o===M.id?"selected-plan":""}`,onClick:()=>d(M.id),children:[e.jsx("h3",{children:M.name}),e.jsxs("p",{className:"price",children:["",M.price]}),e.jsxs("p",{className:"duration",children:["Every ",M.interval," ",M.period,M.interval>1?"s":""]}),M.description&&e.jsx("p",{children:M.description})]},M.id))})]}),e.jsxs("div",{className:"subscription-form mb-6",children:[" ",e.jsx("h2",{children:"Select Payment Method"}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"manual",checked:y==="manual",onChange:()=>b("manual"),className:"mr-2"}),e.jsx("span",{children:"Cash (Manual)"})]})}),e.jsx("div",{className:"form-group",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"razorpay",checked:y==="razorpay",onChange:()=>b("razorpay"),className:"mr-2"}),e.jsx("span",{children:"Razorpay"})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:O,disabled:!o||v||l.length===0,className:"subscription-btn",children:[v&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),v?"Starting...":"Start Subscription"]})})]}):e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Warning: "}),e.jsx("span",{children:"Patient not found."})]}),e.jsxs("button",{onClick:()=>a(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16}),"Back"]})]})},Yx=async()=>{const t=await Z("/api/clinic-subscriptions/plans",{method:"GET"});if(!t.ok){const a=await t.json();throw new Error(a.message||"Failed to fetch clinic subscription plans")}return t.json()},K5=async t=>{const a=await Z(`/api/clinic-subscriptions/cancel/${t}`,{method:"PUT"});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to cancel clinic subscription")}return a.json()},W5=async t=>{const a=await Z(`/api/clinics/${t}/subscription-status`,{method:"GET"});if(!a.ok){const n=await a.json();throw new Error(n.message||`Failed to fetch subscription status for clinic ${t}`)}return a.json()},X5=async t=>{const a=await Z(`/api/clinic-subscriptions/plans/${t}`,{method:"GET"});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to fetch clinic subscription plan")}return a.json()},Z5=async t=>{const a=await Z("/api/clinic-subscriptions/plans",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to create clinic subscription plan")}return a.json()},eM=async(t,a)=>{const n=await Z(`/api/clinic-subscriptions/plans/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const i=await n.json();throw new Error(i.message||"Failed to update clinic subscription plan")}return n.json()},tM=async t=>{const a=await Z(`/api/clinic-subscriptions/plans/${t}`,{method:"DELETE"});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to deactivate clinic subscription plan")}return a.json()},nM=async t=>{const a=await Z("/api/clinic-subscriptions/initiate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({planId:t})});if(!a.ok){const n=await a.json();throw new Error(n.message||"Failed to initiate clinic subscription")}return a.json()},aM=async()=>{try{const t=await Z("/api/clinic-subscriptions/pending",{method:"GET"});return t.ok?t.json():null}catch(t){return console.error("Error checking for pending subscription:",t),null}},sM=async()=>{const t=await Z("/api/clinics/subscription-status",{method:"GET"});if(!t.ok){const a=await t.json();throw new Error(a.message||"Failed to fetch clinic subscription status")}return t.json()},iM=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState(null),m=x.useCallback(async()=>{l(!0),o(null);try{const g=await Yx();n(g)}catch(g){o(g.message||"Failed to fetch clinic subscription plans."),h({type:"error",message:g.message||"Failed to fetch plans."})}finally{l(!1)}},[]);x.useEffect(()=>{m()},[m]),x.useEffect(()=>{if(d){const g=setTimeout(()=>h(null),5e3);return()=>clearTimeout(g)}},[d]);const f=async g=>{if(h(null),o(null),window.confirm("Are you sure you want to deactivate this clinic plan? This action cannot be undone directly.")){l(!0),o(null),h(null);try{await tM(g),h({type:"success",message:"Clinic plan deactivated successfully!"}),m()}catch(y){o(y.message||"Failed to deactivate clinic plan."),h({type:"error",message:y.message||"Failed to deactivate plan."})}finally{l(!1)}}};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"} 
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(ka,{size:18,className:"mr-2 text-green-500"}):e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>h(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(St,{size:16})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 pb-4 border-b",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>t(-1),className:"p-2 rounded-md hover:bg-gray-200",children:e.jsx(Et,{size:20})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Manage Clinic Subscription Plans"})]}),e.jsxs("button",{onClick:()=>t("/dashboard/clinic-subscriptions/add"),className:"subscription-btn",children:[e.jsx(bn,{size:16,className:"mr-1 inline-block"})," Add New Clinic Plan"]})]}),i&&a.length===0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3].map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:60,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{className:"text-right",children:e.jsx(U,{width:80,height:32})})]},g))})]})}),!i&&c&&a.length===0&&e.jsx("p",{className:"text-center text-red-500",children:c}),a.length>0&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"subscription-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Billing Cycle"}),e.jsx("th",{children:"Status"}),e.jsx("th",{className:"text-right",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(g=>e.jsxs("tr",{children:[e.jsx("td",{children:g.name}),e.jsxs("td",{children:["",Number(g.price).toFixed(2)]}),e.jsxs("td",{children:["Every ",g.interval>1?g.interval:""," ",g.period,g.interval>1?"s":""]}),e.jsx("td",{children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:g.status})}),e.jsxs("td",{className:"actions-cell text-right",children:[e.jsx("button",{onClick:()=>t(`/dashboard/clinic-subscriptions/edit/${g.id}`),className:"subscription-btn subscription-btn-secondary",title:"Edit Plan",children:e.jsx(ma,{size:16,className:"inline-block"})}),g.status==="active"&&e.jsx("button",{onClick:()=>f(g.id),className:"subscription-btn subscription-btn-danger",title:"Deactivate Plan",disabled:i,children:e.jsx(Jt,{size:16,className:"inline-block"})})]})]},g.id))})]})}),!i&&a.length===0&&!c&&e.jsx("p",{className:"text-center text-gray-500 mt-6",children:"No clinic subscription plans found. Add one to get started!"})]})]})},rM=()=>{const t=ft(),[a,n]=x.useState({name:"",description:"",price:0,period:"monthly",interval:1,razorpay_plan_id:"",status:"active"}),[i,l]=x.useState(!1),[c,o]=x.useState(null),[d,h]=x.useState(null);x.useEffect(()=>{if(d){const y=setTimeout(()=>h(null),5e3);return()=>clearTimeout(y)}},[d]);const m=y=>{const{name:b,value:v,type:w}=y.target;n(S=>({...S,[b]:w==="number"?parseFloat(v):v}))},f=async y=>{if(y.preventDefault(),l(!0),o(null),h(null),!a.name||!a.price||!a.period||a.interval===void 0||a.interval<=0){o("Please fill in all required fields (Name, Price, Period, Interval > 0)."),l(!1);return}try{await Z5(a),h({type:"success",message:"Clinic plan created successfully! Redirecting..."}),setTimeout(()=>{t("/dashboard/clinic-subscriptions")},2e3)}catch(b){const v=b.message||"Failed to create clinic plan.";o(v),h({type:"error",message:v})}finally{l(!1)}},g=()=>{t(-1)};return e.jsxs("div",{className:"subscription-page-container",children:[d&&e.jsxs("div",{className:`${d.type==="success"?"bg-green-50 border-green-400 text-green-700":"bg-red-50 border-red-400 text-red-700"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[d.type==="success"?e.jsx(ka,{size:18,className:"mr-2 text-green-500"}):e.jsx(Nn,{size:18,className:"mr-2 text-red-500"}),e.jsx("span",{children:d.message})]}),e.jsx("button",{onClick:()=>h(null),className:`${d.type==="success"?"text-green-600 hover:text-green-800":"text-red-600 hover:text-red-800"} ml-4`,children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Add New Clinic Subscription Plan"}),c&&e.jsx("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:c}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name||"",onChange:m,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:a.description||"",onChange:m})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:a.price!==void 0?a.price:"",onChange:m,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:a.period||"monthly",onChange:m,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:a.interval||1,onChange:m,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:a.razorpay_plan_id||"",onChange:m})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:g,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:i,className:"subscription-btn",children:[i?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,i?"Creating...":"Create Plan"]})]})]})]})]})},lM=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState({}),[o,d]=x.useState(!1),[h,m]=x.useState(!0),[f,g]=x.useState(null),[y,b]=x.useState(null),v=x.useCallback(async()=>{if(!t){g("Plan ID is missing."),m(!1);return}m(!0),g(null);try{const E=await X5(t);i(E),c({name:E.name,description:E.description||"",price:Number(E.price),period:E.period,interval:Number(E.interval),razorpay_plan_id:E.razorpay_plan_id||"",status:E.status})}catch(E){g(E.message||"Failed to fetch clinic plan details."),b({type:"error",message:E.message||"Failed to fetch plan details."})}finally{m(!1)}},[t]);x.useEffect(()=>{v()},[v]),x.useEffect(()=>{if(y){const E=setTimeout(()=>b(null),5e3);return()=>clearTimeout(E)}},[y]);const w=E=>{const{name:D,value:O,type:M}=E.target;c(A=>({...A,[D]:M==="number"?parseFloat(O):O}))},S=async E=>{if(E.preventDefault(),!t){g("Plan ID is missing.");return}if(d(!0),g(null),b(null),!l.name||!l.price||!l.period||l.interval===void 0||l.interval<=0){g("Please fill in all required fields (Name, Price, Period, Interval > 0)."),d(!1);return}try{await eM(t,l),b({type:"success",message:"Clinic plan updated successfully! Redirecting..."}),setTimeout(()=>{a(-1)},2e3)}catch(D){const O=D.message||"Failed to update clinic plan.";g(O),b({type:"error",message:O})}finally{d(!1)}},_=()=>{a(-1)};return h?e.jsx("div",{className:"p-6 text-center",children:"Loading clinic plan details..."}):f&&!n?e.jsx("div",{className:"p-6 text-center text-red-500",children:f}):n?e.jsxs("div",{className:"subscription-page-container",children:[y&&e.jsxs("div",{className:`${y.type==="success"?"bg-green-100 border-green-400 text-green-800":"bg-red-100 border-red-400 text-red-800"}
                  px-4 py-3 rounded-md border mb-4 flex items-center justify-between shadow-sm fixed top-20 right-4 z-[100]`,role:"alert",children:[e.jsxs("div",{className:"flex items-center",children:[y.type==="success"?e.jsx(ka,{size:18,className:"mr-2"}):e.jsx(Nn,{size:18,className:"mr-2"}),e.jsx("span",{children:y.message})]}),e.jsx("button",{onClick:()=>b(null),className:"ml-4",children:e.jsx(St,{size:16})})]}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h1",{children:"Edit Clinic Subscription Plan"}),f&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-2 rounded-md mb-4 text-sm",role:"alert",children:f}),e.jsxs("form",{onSubmit:S,children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Plan Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.name||"",onChange:w,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description"}),e.jsx("textarea",{id:"description",name:"description",rows:3,value:l.description||"",onChange:w})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"price",children:["Price (INR) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:l.price!==void 0?l.price:"",onChange:w,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"period",children:["Billing Period ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{id:"period",name:"period",value:l.period||"monthly",onChange:w,required:!0,children:[e.jsx("option",{value:"daily",children:"Daily"}),e.jsx("option",{value:"weekly",children:"Weekly"}),e.jsx("option",{value:"monthly",children:"Monthly"}),e.jsx("option",{value:"yearly",children:"Yearly"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"interval",children:["Interval ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",id:"interval",name:"interval",min:"1",value:l.interval!==void 0?l.interval:"",onChange:w,required:!0})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"razorpay_plan_id",children:"Razorpay Plan ID (Optional)"}),e.jsx("input",{type:"text",id:"razorpay_plan_id",name:"razorpay_plan_id",value:l.razorpay_plan_id||"",onChange:w})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsxs("select",{id:"status",name:"status",value:l.status||"active",onChange:w,children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:_,className:"subscription-btn subscription-btn-secondary",children:"Back"}),e.jsxs("button",{type:"submit",disabled:o,className:"subscription-btn",children:[o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}):null,o?"Saving...":"Save Changes"]})]})]})]})]}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"Clinic plan not found."})},oM=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(""),[c,o]=x.useState(!0),[d,h]=x.useState(null),[m,f]=x.useState(!1),[g,y]=x.useState(null),b=x.useCallback(async()=>{h(null);try{const S=(await Yx()).filter(_=>_.status==="active");n(S),S.length>0&&!i&&l(S[0].id)}catch(w){console.error("Error fetching plans:",w),h(`Failed to load subscription plans: ${w.message}`)}},[]);x.useEffect(()=>{(async()=>{o(!0);try{const S=await aM();if(S&&S.short_url){window.location.href=S.short_url,h("You have a pending subscription. Redirecting to payment...");return}await b()}catch(S){console.error("Error during initial page load:",S),h(`An unexpected error occurred: ${S.message}`)}finally{o(!1)}})()},[b]);const v=async()=>{if(!i){y("Please select a clinic subscription plan.");return}const w=a.find(S=>S.id===i);if(!w){y("Selected plan details not found.");return}f(!0),y(null);try{console.log("Initiating Razorpay clinic subscription for plan:",w);const S=await nM(i);if(S&&S.short_url)window.location.href=S.short_url;else throw new Error("Failed to get Razorpay clinic subscription link from backend.")}catch(S){console.error("Error starting clinic subscription:",S),y(`Failed to start clinic subscription: ${S.message}`),f(!1)}};return c?e.jsx("div",{className:"loading-state-subscription",children:"Loading clinic plans..."}):d?e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("div",{className:"error-alert-subscription",role:"alert",children:[e.jsx("strong",{children:"Error: "}),e.jsx("span",{children:d})]}),e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16}),"Back"]})]}):e.jsxs("div",{className:"subscription-page-container",children:[e.jsxs("button",{onClick:()=>t(-1),className:"all-patients-back-button",children:[e.jsx(Et,{size:16}),"Back"]}),e.jsxs("h1",{children:[e.jsx(RC,{size:28}),"Buy Pro Plan for Clinic"]}),g&&e.jsx("div",{className:"error-alert-subscription",role:"alert",children:e.jsx("span",{children:g})}),e.jsxs("div",{className:"subscription-form",children:[e.jsx("h2",{children:"Available Pro Plans"}),a.length===0?e.jsx("p",{className:"empty-state",children:"No active clinic subscription plans found."}):e.jsx("div",{className:"subscription-plan-list",children:a.map(w=>e.jsxs("div",{className:`subscription-plan-card ${i===w.id?"selected-plan":""}`,onClick:()=>l(w.id),children:[e.jsx("h3",{children:w.name}),e.jsxs("p",{className:"price",children:["",Number(w.price).toFixed(2)]}),e.jsxs("p",{className:"duration",children:["Every ",w.interval," ",w.period,w.interval>1?"s":""]}),w.description&&e.jsx("p",{children:w.description})]},w.id))})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:v,disabled:!i||m||a.length===0,className:"subscription-btn",children:[m&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-t-2 border-b-2 border-white mr-2 inline-block"}),m?"Initiating Payment...":"Buy Pro Plan"]})})]})},cM=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[c,o]=x.useState(!0),[d,h]=x.useState(null),[m,f]=x.useState(!1),[g,y]=x.useState(!1),[b,v]=x.useState(null),[w,S]=x.useState({name:"",email:"",password:"",role:"user"}),[_,E]=x.useState({name:"",email:"",role:"",password:"",confirmPassword:""}),[D,O]=x.useState(""),[M,A]=x.useState(""),[P,Q]=x.useState({}),[G,C]=x.useState(!1),[R,z]=x.useState(null),[F,J]=x.useState([]),[H,I]=x.useState(""),[V,re]=x.useState(!1),[B,k]=x.useState(null);x.useEffect(()=>{const oe=setTimeout(()=>{A(D)},500);return()=>{clearTimeout(oe)}},[D]),x.useEffect(()=>{Ne(M)},[M]);const Ne=async(oe="")=>{l(!0);try{const fe=oe?`/api/users?search=${encodeURIComponent(oe)}`:"/api/users",q=await(await Z(fe)).json();if(n(q),q.length>0){const W=[...new Set(q.map(ie=>ie.clinic_id).filter(ie=>!!ie))],Y={};await Promise.all(W.map(async ie=>{try{const ce=await W5(ie);Y[ie]=ce}catch(ce){console.error(`Failed to fetch subscription status for clinic ${ie}`,ce),Y[ie]={hasProPlan:!1}}})),Q(Y)}h(null)}catch(fe){h("Failed to fetch users."),console.error(fe)}finally{l(!1),o(!1)}},Ae=async oe=>{oe.preventDefault();try{await Z("/users",{method:"POST",body:JSON.stringify(w)}),f(!1),S({name:"",email:"",password:"",role:"user"}),Ne()}catch(fe){h("Failed to add user."),console.error(fe)}},T=async oe=>{if(oe.preventDefault(),!b)return;const{password:fe,confirmPassword:ge,...q}=_,W={...q};if(fe){if(fe.length<6){h("Password must be at least 6 characters long.");return}if(fe!==ge){h("Passwords do not match.");return}W.password=fe}try{await Z(`/users/${b.id}`,{method:"PUT",body:JSON.stringify(W)}),y(!1),v(null),E({..._,password:"",confirmPassword:""}),Ne()}catch(Y){h("Failed to update user."),console.error(Y)}},Ce=async oe=>{if(window.confirm("Are you sure you want to delete this user?"))try{await Z(`/users/${oe}`,{method:"DELETE"}),Ne()}catch(fe){h("Failed to delete user."),console.error(fe)}},Ue=oe=>{v(oe),E({name:oe.name,email:oe.email,role:oe.role,password:"",confirmPassword:""}),y(!0)},Pe=async()=>{re(!0);try{const oe=await Yx();J(oe),oe.length>0&&I(oe[0].id),k(null)}catch(oe){k("Failed to fetch subscription plans."),console.error(oe)}finally{re(!1)}},de=oe=>{z(oe),C(!0),Pe()},Se=async oe=>{if(oe.preventDefault(),!R||!H){h("Please select a clinic and a plan.");return}try{await Z("/clinic-subscriptions/manual-activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clinicId:R,planId:H})}),C(!1),z(null),I(""),Ne(),h(null)}catch(fe){h("Failed to manually activate clinic subscription."),console.error(fe)}},ee=async oe=>{if(window.confirm("Are you sure you want to cancel this clinic's subscription? This action cannot be undone."))try{await K5(oe),Ne(),h(null)}catch(fe){h("Failed to cancel subscription."),console.error(fe)}};return i&&c?e.jsxs("div",{className:"user-management-page",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsx("div",{className:"back-button",style:{width:80,height:32},children:e.jsx(U,{width:80,height:32})}),e.jsx("h1",{children:e.jsx(U,{width:200,height:32})})]}),e.jsxs("div",{className:"controls-container",children:[e.jsx(U,{width:"100%",height:40,style:{maxWidth:"300px"}}),e.jsx(U,{width:150,height:40})]}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Clinic ID"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(oe=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:24,style:{borderRadius:"16px"}})}),e.jsx("td",{children:e.jsx(U,{width:150,height:32})})]},oe))})]})]}):d&&c?e.jsx("div",{className:"error-message",children:d}):e.jsxs("div",{className:"user-management-page",children:[e.jsxs("div",{className:"user-management-header",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(Et,{size:16}),"Back"]}),e.jsx("h1",{children:"User Management"})]}),e.jsxs("div",{className:"controls-container",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:D,onChange:oe=>O(oe.target.value),className:"search-input"}),e.jsx("button",{onClick:()=>f(!0),className:"add-user-button",children:"Add New User"})]}),m&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>f(!1),children:""}),e.jsx("h2",{children:"Add New User"}),e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:w.name,onChange:oe=>S({...w,name:oe.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:w.email,onChange:oe=>S({...w,email:oe.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password:"}),e.jsx("input",{type:"password",value:w.password,onChange:oe=>S({...w,password:oe.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:w.role,onChange:oe=>S({...w,role:oe.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsx("button",{type:"submit",children:"Add User"})]})]})}),g&&b&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>y(!1),children:""}),e.jsx("h2",{children:"Edit User"}),e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Name:"}),e.jsx("input",{type:"text",value:_.name,onChange:oe=>E({..._,name:oe.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email:"}),e.jsx("input",{type:"email",value:_.email,onChange:oe=>E({..._,email:oe.target.value}),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role:"}),e.jsxs("select",{value:_.role,onChange:oe=>E({..._,role:oe.target.value}),children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"super_admin",children:"Super Admin"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"New Password (optional):"}),e.jsx("input",{type:"password",value:_.password,onChange:oe=>E({..._,password:oe.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Confirm New Password:"}),e.jsx("input",{type:"password",value:_.confirmPassword,onChange:oe=>E({..._,confirmPassword:oe.target.value})})]}),e.jsx("button",{type:"submit",children:"Update User"})]})]})}),G&&e.jsx("div",{className:"modal",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("span",{className:"close-button",onClick:()=>C(!1),children:""}),e.jsx("h2",{children:"Select Subscription Plan for Clinic"}),V&&e.jsx("div",{children:"Loading plans..."}),B&&e.jsx("div",{className:"error-message",children:B}),!V&&!B&&F.length===0&&e.jsx("div",{children:"No active subscription plans available."}),!V&&!B&&F.length>0&&e.jsxs("form",{onSubmit:Se,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Plan:"}),e.jsx("select",{value:H,onChange:oe=>I(oe.target.value),required:!0,children:F.map(oe=>e.jsxs("option",{value:oe.id,children:[oe.name," - $",oe.price,"/",oe.interval," ",oe.period]},oe.id))})]}),e.jsx("button",{type:"submit",children:"Activate Selected Plan"})]})]})}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Clinic ID"}),e.jsx("th",{children:"Subscription Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.map(oe=>{const fe=oe.clinic_id||"N/A",ge=fe!=="N/A"?P[fe]:null,q=(ge==null?void 0:ge.hasProPlan)??!1,W=q?"PRO":"Standard";return e.jsxs("tr",{children:[e.jsx("td",{children:oe.name}),e.jsx("td",{children:oe.email}),e.jsx("td",{children:oe.role}),e.jsx("td",{children:fe}),e.jsx("td",{children:fe!=="N/A"?e.jsx("span",{className:q?"pro-badge":"standard-badge",children:W}):"N/A"}),e.jsxs("td",{children:[e.jsx("button",{onClick:()=>Ue(oe),className:"edit-button",children:"Edit"}),e.jsx("button",{onClick:()=>Ce(oe.id),className:"delete-button",children:"Delete"}),oe.clinic_id&&!q&&e.jsx("button",{onClick:()=>de(oe.clinic_id),className:"start-subscription-button",children:"Start Subscription"}),oe.clinic_id&&q&&e.jsx("button",{onClick:()=>ee(oe.clinic_id),className:"cancel-subscription-button",children:"Cancel Subscription"})]})]},oe.id)})})]})]})},uM="_modalOverlay_1spz3_3",dM="_modalContent_1spz3_29",hM="_modalHeader_1spz3_53",mM="_modalTitle_1spz3_71",pM="_modalCloseButton_1spz3_83",fM="_modalBody_1spz3_111",gM="_formGroup_1spz3_119",xM="_inputField_1spz3_141",yM="_errorText_1spz3_175",bM="_successText_1spz3_193",jM="_modalFooter_1spz3_211",vM="_button_1spz3_227",NM="_buttonPrimary_1spz3_247",wM="_buttonSecondary_1spz3_265",ca={modalOverlay:uM,modalContent:dM,modalHeader:hM,modalTitle:mM,modalCloseButton:pM,modalBody:fM,formGroup:gM,inputField:xM,errorText:yM,successText:bM,modalFooter:jM,button:vM,buttonPrimary:NM,buttonSecondary:wM},SM=({isOpen:t,onClose:a})=>{const[n,i]=x.useState(""),[l,c]=x.useState(!1),[o,d]=x.useState(!1),[h,m]=x.useState(null),[f,g]=x.useState(null);us(void 0,t?200:99999),x.useEffect(()=>{t&&y()},[t]);const y=async()=>{c(!0),m(null);try{const v=await Z("/api/global-settings/app_gemini_api_key");if(v.ok){const w=await v.json();i(w.value||"")}else v.status}catch(v){console.warn("Could not fetch existing key:",v)}finally{c(!1)}},b=async()=>{d(!0),m(null),g(null);try{if(!(await Z("/api/global-settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:"app_gemini_api_key",value:n})})).ok)throw new Error("Failed to save API Key");g("API Key updated successfully!"),setTimeout(()=>{a(),g(null)},1500)}catch(v){m(v.message||"Error saving key")}finally{d(!1)}};return t?e.jsx("div",{className:ca.modalOverlay,children:e.jsxs("div",{className:ca.modalContent,children:[e.jsxs("div",{className:ca.modalHeader,children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(P1,{size:24}),e.jsx("h3",{className:ca.modalTitle,children:"App Gemini API Key"})]}),e.jsx("button",{onClick:a,className:ca.modalCloseButton,children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:ca.modalBody,children:[h&&e.jsx("div",{className:ca.errorText,children:h}),f&&e.jsx("div",{className:ca.successText,children:f}),e.jsxs("div",{className:ca.formGroup,children:[e.jsx("label",{htmlFor:"gemini-key",children:"Gemini API Key"}),l?e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}}):e.jsx("input",{type:"text",id:"gemini-key",value:n,onChange:v=>i(v.target.value),className:ca.inputField,placeholder:"Enter Gemini API Key (AIza...)",disabled:o})]}),e.jsx("p",{style:{fontSize:"0.9em",color:"var(--secondary-text-color, #666)"},children:"This key will be used as a fallback for all clinics if their specific Gemini API key is not configured."})]}),e.jsxs("div",{className:ca.modalFooter,children:[e.jsx("button",{onClick:a,className:`${ca.button} ${ca.buttonSecondary}`,disabled:o,children:"Cancel"}),e.jsx("button",{onClick:b,className:`${ca.button} ${ca.buttonPrimary}`,disabled:o,children:o?"Saving...":"Save Key"})]})]})}):null},kM=()=>{const[t,a]=x.useState(!1);return e.jsxs("div",{className:"admin-panel-container",children:[e.jsxs("h1",{className:"admin-panel-title",children:[e.jsx(vl,{size:32,className:"icon-margin"}),"Super Admin Dashboard"]}),e.jsxs("div",{className:"admin-panel-grid",children:[e.jsxs(Ss,{to:"/dashboard/clinic-subscriptions",className:"admin-panel-card",children:[e.jsx(Cr,{size:48,className:"card-icon"}),e.jsx("h2",{children:"Manage Clinic Subscription Plans"}),e.jsx("p",{children:"Add, edit, and view clinic subscription plans."})]}),e.jsxs(Ss,{to:"/dashboard/users",className:"admin-panel-card",children:[e.jsx(Vo,{size:48,className:"card-icon"}),e.jsx("h2",{children:"User Management"}),e.jsx("p",{children:"Add, edit, and delete users; manage user roles."})]}),e.jsxs("div",{className:"admin-panel-card",onClick:()=>a(!0),style:{cursor:"pointer"},children:[e.jsx(P1,{size:48,className:"card-icon"}),e.jsx("h2",{children:"Manage App Gemini API Key"}),e.jsx("p",{children:"Update the fallback Gemini API key used by the application."})]})]}),e.jsx(SM,{isOpen:t,onClose:()=>a(!1)})]})},ag="tutorialCurrentStep",CM=({onActionComplete:t})=>{const[a,n]=x.useState(!1),[i,l]=x.useState(!1),[c,o]=x.useState(null),d=async()=>{var h,m;n(!0);try{const f=await Z("/api/drugs/import-defaults",{method:"POST"}),g=await f.json();if(f.ok){l(!0);const y=((h=g.details)==null?void 0:h.added)||0,b=((m=g.details)==null?void 0:m.updated)||0,v=`Added: ${y}, Updated: ${b}`;o(v),t(!0,"Default medications imported successfully!","pharmacyImport")}else t(!1,"Failed to import medications.")}catch{t(!1,"Error importing medications.")}finally{n(!1)}};return e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"One click to populate your inventory."}),i?e.jsxs("div",{className:"success-badge flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Eo,{size:16})," Imported"]}),c&&e.jsx("span",{className:"text-xs opacity-80 mt-1",children:c})]}):e.jsx("button",{onClick:d,className:"tutorial-button primary",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ci,{size:18,className:"animate-spin"})," Importing ~80 items..."]}):e.jsxs(e.Fragment,{children:[e.jsx(tx,{size:18})," Import Drugs"]})})]})},_M=({onActionComplete:t})=>{const[a,n]=x.useState(!1),[i,l]=x.useState(!1),[c,o]=x.useState(null),d=async()=>{var h,m;n(!0);try{const f=await Z("/api/lab-tests/import-defaults",{method:"POST"}),g=await f.json();if(f.ok){l(!0);const y=((h=g.details)==null?void 0:h.added)||0,b=((m=g.details)==null?void 0:m.updated)||0,v=`Added: ${y}, Updated: ${b}`;o(v),t(!0,"Default lab tests imported successfully!","labImport")}else t(!1,"Failed to import lab tests.")}catch{t(!1,"Error importing lab tests.")}finally{n(!1)}};return e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"Setup your lab with common tests."}),i?e.jsxs("div",{className:"success-badge flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Eo,{size:16})," Imported"]}),c&&e.jsx("span",{className:"text-xs opacity-80 mt-1",children:c})]}):e.jsx("button",{onClick:d,className:"tutorial-button primary",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Ci,{size:18,className:"animate-spin"})," Importing ~25 items..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Cs,{size:18})," Import Tests"]})})]})},DM=({onOpenCommandBar:t})=>e.jsxs("div",{className:"tutorial-interactive-component center-content",children:[e.jsx("p",{className:"action-hint",children:"Ready to experience the power? Open the command bar to start."}),e.jsx("button",{onClick:t,className:"tutorial-button primary large-button",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Open Command Bar ",e.jsx("span",{className:"shortcut-hint-badge",children:"Ctrl+K"})]})})]}),sg=[{title:"Welcome to Newtons Ai HMS",description:"Your all-in-one clinic management solution. Let's get your clinic ready in less than 2 minutes.",icon:e.jsx(k1,{size:48,className:"step-icon welcome"}),component:null,actionText:"Get Started"},{title:"Pharmacy Setup",description:"Start by populating your pharmacy. We can import a standard list of medicines for you.",icon:e.jsx(tx,{size:48,className:"step-icon pharmacy"}),component:CM,actionText:"Next",showSkip:!0},{title:"Lab Configuration",description:"Next, let's set up your lab. Import common lab tests to start generating reports immediately.",icon:e.jsx(Cs,{size:48,className:"step-icon lab"}),component:_M,actionText:"Next",showSkip:!0},{title:"Power at Your Fingertips",description:"The Command Bar is your central hub for everything. Search patients, add orders, or use AI tools instantly.",icon:e.jsx(OC,{size:48,className:"step-icon ai"}),component:DM,actionText:null,isLast:!0}],EM=({onClose:t,onMarkAsSeen:a})=>{const{openCommandBar:n}=qo(),[i,l]=x.useState(()=>{const S=localStorage.getItem(ag);return S?parseInt(S,10):0}),[c,o]=x.useState(!1),[d,h]=x.useState(null),[m,f]=x.useState(null);x.useEffect(()=>{localStorage.setItem(ag,i.toString()),h(null)},[i]);const g=()=>{o(!0),setTimeout(()=>{l(S=>Math.min(S+1,sg.length-1)),o(!1)},300)},y=(S,_,E)=>{f(S),h(_),S&&(E==="pharmacyImport"||E==="labImport")&&setTimeout(g,1e3)},b=()=>{a(),t(),localStorage.removeItem(ag)},v=()=>{b(),setTimeout(()=>{n()},100)},w=sg[i];return e.jsx("div",{className:"tutorial-overlay",children:e.jsxs("div",{className:`tutorial-card ${c?"fade-out":"fade-in"}`,children:[e.jsxs("div",{className:"tutorial-visual",children:[e.jsx("div",{className:"icon-circle",children:w.icon}),e.jsx("div",{className:"step-indicators",children:sg.map((S,_)=>e.jsx("div",{className:`step-dot ${_===i?"active":""} ${_<i?"completed":""}`},_))})]}),e.jsxs("div",{className:"tutorial-content",children:[e.jsx("button",{className:"close-button",onClick:b,title:"Close Tutorial",children:e.jsx(St,{size:20})}),e.jsxs("div",{className:"text-content",children:[e.jsx("h2",{children:w.title}),e.jsx("p",{className:"description",children:w.description})]}),e.jsxs("div",{className:"interactive-area",children:[w.component?e.jsx(w.component,{onActionComplete:y,onOpenCommandBar:v}):null,d&&e.jsx("div",{className:`status-message ${m?"success":"error"}`,children:d})]}),e.jsxs("div",{className:"action-footer",children:[w.showSkip&&e.jsx("button",{onClick:g,className:"tutorial-button text-only",children:"Skip for now"}),w.actionText&&e.jsxs("button",{onClick:g,className:"tutorial-button primary",children:[w.actionText," ",e.jsx(jl,{size:16})]})]})]})]})})},TM=()=>{const[t,a]=x.useState([]),[n,i]=x.useState(!0),[l,c]=x.useState(null),[o,d]=x.useState(""),[h,m]=x.useState(1),[f,g]=x.useState(1),[y,b]=x.useState(0),[v,w]=x.useState(!1),[S,_]=x.useState(void 0),E=10,D=x.useRef(null);us();const O=x.useCallback(async(R,z)=>{i(!0),c(null);try{let F=`/api/recurring-medications?page=${R}&limit=${E}`;z&&(F+=`&search=${encodeURIComponent(z)}`);const J=await Z(F);if(!J.ok)throw new Error("Failed to fetch recurring medications.");const H=await J.json();a(H.medications),g(H.totalPages),b(H.total),m(H.page)}catch(F){console.error(F),c(F.message||"An error occurred while fetching data.")}finally{i(!1)}},[]);x.useEffect(()=>(D.current&&clearTimeout(D.current),D.current=setTimeout(()=>{O(h,o)},500),()=>{D.current&&clearTimeout(D.current)}),[o,h,O]);const M=R=>{d(R.target.value),m(1)},A=R=>{R>=1&&R<=f&&m(R)},P=R=>{_(R),w(!0)},Q=()=>{O(h,o),w(!1),_(void 0)},G=R=>R===30?"Every 30 Days (Monthly)":R===15?"Every 15 Days":`Every ${R} Days`,C=R=>{switch(R){case"active":return"status-pill status-pill-active";case"paused":return"status-pill status-pill-paused";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill"}};return e.jsxs("div",{className:"refill-reminders-container",children:[e.jsxs("div",{className:"refill-header",children:[e.jsx("h3",{className:"refill-title",children:"Recurring Medications"}),e.jsxs("div",{className:"refill-actions",children:[e.jsxs("button",{className:"refill-action-button btn-add",onClick:()=>{_(void 0),w(!0)},children:[e.jsx(wa,{size:16})," Add New"]}),e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search patient, phone, medication...",value:o,onChange:M}),e.jsx(fn,{size:18,className:"search-icon"})]})]})]}),l&&e.jsx("div",{className:"error-message-box",children:l}),e.jsx("div",{className:"refill-table-container",children:n?e.jsx("div",{className:"loading-pulse",children:"Loading..."}):t.length===0?e.jsx("div",{className:"empty-state",children:"No recurring medications found."}):e.jsx("div",{className:"refill-grouped-list",children:Object.values(t.reduce((R,z)=>{const F=z.patientId;return R[F]||(R[F]={patientId:z.patientId,patientName:z.patientName,patientPhone:z.patientPhone,patientToken:z.patientToken,medications:[]}),R[F].medications.push(z),R},{})).map(R=>e.jsxs("div",{className:"patient-medication-group-card",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("h4",{className:"patient-name",children:R.patientName}),e.jsxs("span",{className:"patient-meta",children:["Token: ",R.patientToken,"  Phone: ",R.patientPhone]})]}),e.jsx("div",{className:"group-actions"})]}),e.jsxs("table",{className:"refill-table group-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Medication"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Frequency"}),e.jsx("th",{children:"Next Delivery"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:R.medications.map(z=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"med-name",children:z.medicationName}),(z.tabletsPerDay||z.numberOfDays||z.directions)&&e.jsxs("div",{className:"med-usage-details",style:{fontSize:"0.8em",color:"#666"},children:[z.tabletsPerDay&&e.jsxs("span",{children:[z.tabletsPerDay," tabs/day  "]}),z.numberOfDays&&e.jsxs("span",{children:[z.numberOfDays," days "]})]}),z.notes&&e.jsxs("div",{className:"med-notes",children:["Note: ",z.notes]})]}),e.jsx("td",{children:z.quantity}),e.jsx("td",{children:e.jsx("span",{className:"frequency-badge",children:G(z.frequencyDays)})}),e.jsx("td",{children:e.jsx("div",{className:"date-display",children:new Date(z.nextDeliveryDate).toLocaleDateString()})}),e.jsx("td",{children:e.jsx("span",{className:C(z.status),children:z.status})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit",title:"Edit",onClick:()=>P(z),children:e.jsx(ma,{size:16})}),e.jsx("button",{className:"action-btn delete",title:"Delete/Cancel",children:e.jsx(Jt,{size:16})})]})})]},z.id))})]})]},R.patientId))})}),!n&&f>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("span",{className:"pagination-info",children:["Page ",h," of ",f," (Total ",y,")"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("button",{onClick:()=>A(h-1),disabled:h===1,className:"page-btn",children:[e.jsx(Zh,{size:16})," Prev"]}),e.jsxs("button",{onClick:()=>A(h+1),disabled:h===f,className:"page-btn",children:["Next ",e.jsx(jl,{size:16})]})]})]}),e.jsx(_S,{isOpen:v,onClose:()=>{w(!1),_(void 0)},onSuccess:Q,medication:S})]})},AM=()=>{const t=ft(),a=Qa();return x.useEffect(()=>{const n=new URLSearchParams(a.search),i=n.get("token"),l=n.get("caseDetails");i?(async()=>{try{const o=await Z(`/api/patients?search=${i}&limit=1`);if(!o.ok)throw new Error("Failed to fetch patient by token");const h=(await o.json()).patients[0];if(!h)throw new Error("Patient with the given token not found");const m=await Z(`/api/queue/patient/${h.id}/latest`);if(m.ok){const y=await m.json();if(y!=null&&y._id){t(`/dashboard/edit-complaint/${y._id}`,{state:{initialComplaint:l}});return}}const f=await Z("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:h.id,complaint:l})});if(!f.ok)throw new Error("Failed to create queue entry");const g=await f.json();if(g!=null&&g.id)t(`/dashboard/edit-complaint/${g.id}`,{state:{initialComplaint:l}});else throw new Error("Failed to get ID from new queue entry.")}catch(o){console.error("Error handling complaint URL:",o),t("/dashboard/search-patient")}})():t("/dashboard/search-patient")},[a,t]),e.jsx("div",{children:"Loading..."})},l1=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[c,o]=x.useState(null),[d,h]=x.useState(!1),[m,f]=x.useState(!1),[g,y]=x.useState(!1),[b,v]=x.useState(!1),[w,S]=x.useState(!1),[_,E]=x.useState(!1),[D,O]=x.useState(null),[M,A]=x.useState([]),[P,Q]=x.useState(null),[G,C]=x.useState(""),[R,z]=x.useState(""),[F,J]=x.useState(""),[H,I]=x.useState(""),[V,re]=x.useState(""),[B,k]=x.useState(""),[Ne,Ae]=x.useState(""),[T,Ce]=x.useState(""),[Ue,Pe]=x.useState(""),[de,Se]=x.useState(""),[ee,oe]=x.useState(""),[fe,ge]=x.useState("cash"),q=x.useCallback(async()=>{l(!0),o(null);try{const ae=await Z("/api/distributors");if(!ae.ok)throw new Error(`Failed to fetch distributors: ${ae.statusText}`);const we=await ae.json();n(we)}catch(ae){console.error("Failed to fetch distributors:",ae),o(ae.message||"Failed to load distributors.")}finally{l(!1)}},[]);x.useEffect(()=>{q()},[q]);const W=async ae=>{ae.preventDefault(),o(null);try{const we=await Z("/api/distributors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:G,contact_person:R,phone:F,email:H,address:V,gst_number:B,drug_license_number:Ne})});if(!we.ok){const Le=await we.json();throw new Error(Le.message||"Failed to add distributor.")}alert("Distributor added successfully!"),We(),q()}catch(we){console.error("Error adding distributor:",we),o(we.message||"Failed to add distributor.")}},Y=async ae=>{if(ae.preventDefault(),o(null),!!D)try{const we=await Z(`/api/distributors/${D.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:G,contact_person:R,phone:F,email:H,address:V,gst_number:B,drug_license_number:Ne})});if(!we.ok){const Le=await we.json();throw new Error(Le.message||"Failed to update distributor.")}alert("Distributor updated successfully!"),me(),q()}catch(we){console.error("Error updating distributor:",we),o(we.message||"Failed to update distributor.")}},ie=async()=>{if(o(null),!!D)try{const ae=await Z(`/api/distributors/${D.id}`,{method:"DELETE"});if(!ae.ok){const we=await ae.json();throw new Error(we.message||"Failed to delete distributor.")}alert("Distributor deleted successfully!"),Fe(),q()}catch(ae){console.error("Error deleting distributor:",ae),o(ae.message||"Failed to delete distributor.")}},ce=x.useCallback(async ae=>{o(null);try{const we=await Z(`/api/distributors/${ae}/payments`);if(!we.ok)throw new Error(`Failed to fetch payments: ${we.statusText}`);const Je=(await we.json()).map(be=>({...be,order_value:parseFloat(be.order_value),amount_paid:parseFloat(be.amount_paid),balance_remaining:parseFloat(be.balance_remaining)}));A(Je);const ot=await Z(`/api/distributors/${ae}/balance`);if(!ot.ok)throw new Error(`Failed to fetch balance: ${ot.statusText}`);const xt=await ot.json();Q({totalOrderValue:parseFloat(xt.totalOrderValue),totalAmountPaid:parseFloat(xt.totalAmountPaid),remainingBalance:parseFloat(xt.remainingBalance)})}catch(we){console.error("Error fetching payments/balance:",we),o(we.message||"Failed to load payments or balance.")}},[]),pe=async ae=>{if(ae.preventDefault(),o(null),!!D)try{const we=await Z(`/api/distributors/${D.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:T,order_value:parseFloat(Ue||"0"),amount_paid:parseFloat(de||"0"),notes:ee,payment_mode:fe})});if(!we.ok){const Le=await we.json();throw new Error(Le.message||"Failed to add payment.")}alert("Payment added successfully!"),xe(),ce(D.id)}catch(we){console.error("Error adding payment:",we),o(we.message||"Failed to add payment.")}},He=()=>{C(""),z(""),J(""),I(""),re(""),k(""),Ae(""),o(null),f(!0)},We=()=>{f(!1)},st=ae=>{O(ae),C(ae.name),z(ae.contact_person||""),J(ae.phone||""),I(ae.email||""),re(ae.address||""),k(ae.gst_number||""),Ae(ae.drug_license_number||""),o(null),y(!0)},me=()=>{y(!1),O(null)},ve=ae=>{O(ae),o(null),v(!0)},Fe=()=>{v(!1),O(null)},Ee=ae=>{O(ae),ce(ae.id),o(null),S(!0)},L=()=>{S(!1),O(null),A([]),Q(null)},ne=ae=>{O(ae),Ce(new Date().toISOString().split("T")[0]),Pe("0"),Se("0"),oe(""),ge("cash"),o(null),E(!0)},xe=()=>{E(!1),O(null)};return i?e.jsxs("div",{className:"distributor-management-page",children:[e.jsxs("div",{className:"distributor-management-header",style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(U,{width:80,height:36}),e.jsx(U,{width:200,height:32})]}),e.jsxs("div",{className:"header-controls",children:[e.jsx(U,{width:150,height:36}),e.jsx(U,{width:150,height:36}),e.jsx(U,{width:180,height:36})]})]}),e.jsx("div",{className:"distributor-table-container",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(ae=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:120,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:80,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:30})})]},ae))})]})})]}):c?e.jsxs("div",{className:"error-indicator",children:["Error: ",c]}):e.jsxs("div",{className:"distributor-management-page",children:[e.jsxs("div",{className:"distributor-management-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Go Back",children:[e.jsx(Et,{size:20})," Back"]}),e.jsx("h2",{children:"Distributor Management"})]}),e.jsxs("div",{className:"header-controls",children:[(()=>{const ae=a.reduce((Le,Je)=>Le+parseFloat(Je.remainingBalance||"0"),0),we=ae>=0?"balance-positive":"balance-negative";return e.jsxs("div",{className:`total-balance-display ${we}`,children:[e.jsx(R1,{size:18}),e.jsx("strong",{children:"Total Balance:"})," ",ae.toFixed(2)]})})(),e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>h(!1),className:`view-mode-btn ${d?"":"active"}`,title:"List View",children:[e.jsx(Ou,{size:18})," List"]}),e.jsxs("button",{onClick:()=>h(!0),className:`view-mode-btn ${d?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(Iu,{size:18})," Excel"]})]}),e.jsxs("button",{onClick:He,className:"add-distributor-button",children:[e.jsx(wa,{size:18}),"Add Distributor"]})]})]}),e.jsx("div",{className:"distributor-table-container",children:d?e.jsx(Mu,{columns:[{key:"name",label:"Name",editable:!0,type:"text"},{key:"contact_person",label:"Contact Person",editable:!0,type:"text"},{key:"phone",label:"Phone",editable:!0,type:"text"},{key:"email",label:"Email",editable:!0,type:"text"},{key:"address",label:"Address",editable:!0,type:"text"},{key:"gst_number",label:"GST Number",editable:!0,type:"text"},{key:"drug_license_number",label:"Drug License",editable:!0,type:"text"}],data:a,editable:!0,showRowNumbers:!0,title:"Distributors",onSave:async ae=>{const we=ae.map(async Le=>{const Je=a.find(ot=>ot.id===Le.id);if(Je&&JSON.stringify(Je)!==JSON.stringify(Le))return Z(`/api/distributors/${Le.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Le)})});try{await Promise.all(we),alert("Changes saved successfully"),q()}catch(Le){alert("Error saving changes"),console.error(Le)}}}):e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"GST Number"}),e.jsx("th",{children:"Drug License"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{className:"actions-cell",children:"Actions"})]})}),e.jsx("tbody",{children:a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"no-results-message",children:"No distributors found."})}):a.map(ae=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Name",style:{fontWeight:600},children:ae.name}),e.jsx("td",{"data-label":"Contact Person",children:ae.contact_person||"-"}),e.jsx("td",{"data-label":"Phone",children:ae.phone||"-"}),e.jsx("td",{"data-label":"Email",children:ae.email||"-"}),e.jsx("td",{"data-label":"Address",children:ae.address||"-"}),e.jsx("td",{"data-label":"GST Number",children:ae.gst_number||"-"}),e.jsx("td",{"data-label":"Drug License",children:ae.drug_license_number||"-"}),e.jsxs("td",{"data-label":"Balance",className:parseFloat(ae.remainingBalance||"0")>0?"balance-positive":"balance-negative",style:{fontWeight:600},children:["",ae.remainingBalance||"0.00"]}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsxs("button",{onClick:()=>Ee(ae),className:"action-text-button view-button",title:"View Payments & Balance",children:[e.jsx(em,{size:16})," View"]}),e.jsxs("button",{onClick:()=>ne(ae),className:"action-text-button add-payment-button-small",title:"Add Payment",children:[e.jsx(wa,{size:16})," Pay"]}),e.jsx("button",{onClick:()=>st(ae),className:"action-icon-button edit-button",title:"Edit Distributor",children:e.jsx(ma,{size:16})}),e.jsx("button",{onClick:()=>ve(ae),className:"action-icon-button delete-button",title:"Delete Distributor",children:e.jsx(Jt,{size:16})})]})})]},ae.id))})]})}),m&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:We,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Add New Distributor"}),c&&e.jsx("div",{className:"modal-error-message",children:c}),e.jsxs("form",{onSubmit:W,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Name:"}),e.jsx("input",{type:"text",id:"name",value:G,onChange:ae=>C(ae.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"contact_person",value:R,onChange:ae=>z(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",value:F,onChange:ae=>J(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",value:H,onChange:ae=>I(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address:"}),e.jsx("textarea",{id:"address",value:V,onChange:ae=>re(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"gst_number",value:B,onChange:ae=>k(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"drug_license_number",value:Ne,onChange:ae=>Ae(ae.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:We,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Distributor"})]})]})]})}),g&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:me,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Edit Distributor"}),c&&e.jsx("div",{className:"modal-error-message",children:c}),e.jsxs("form",{onSubmit:Y,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-name",children:"Name:"}),e.jsx("input",{type:"text",id:"edit-name",value:G,onChange:ae=>C(ae.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"edit-contact_person",value:R,onChange:ae=>z(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"edit-phone",value:F,onChange:ae=>J(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-email",children:"Email:"}),e.jsx("input",{type:"email",id:"edit-email",value:H,onChange:ae=>I(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-address",children:"Address:"}),e.jsx("textarea",{id:"edit-address",value:V,onChange:ae=>re(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"edit-gst_number",value:B,onChange:ae=>k(ae.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"edit-drug_license_number",value:Ne,onChange:ae=>Ae(ae.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:me,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Save Changes"})]})]})]})}),b&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Fe,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Confirm Delete"}),e.jsxs("p",{children:['Are you sure you want to delete distributor "',D.name,'"?']}),c&&e.jsx("div",{className:"modal-error-message",children:c}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Fe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:ie,className:"button-delete",children:"Delete"})]})]})}),w&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsx("button",{onClick:L,className:"modal-close-button",children:""}),e.jsxs("h3",{className:"modal-title",children:["Payments & Balance for ",D.name]}),c&&e.jsx("div",{className:"modal-error-message",children:c}),P&&e.jsxs("div",{className:"balance-summary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Order Value"})," ",e.jsxs("span",{children:["",P.totalOrderValue.toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount Paid"})," ",e.jsxs("span",{children:["",P.totalAmountPaid.toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Remaining Balance"})," ",e.jsxs("span",{children:["",P.remainingBalance.toFixed(2)]})]})]}),e.jsx("h4",{children:"Payment History"}),M.length===0?e.jsx("p",{children:"No payments recorded for this distributor."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Order Value"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Balance Remaining"}),e.jsx("th",{children:"Payment Mode"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:M.map(ae=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Date",children:new Date(ae.payment_date).toLocaleDateString()}),e.jsxs("td",{"data-label":"Order Value",children:["",ae.order_value.toFixed(2)]}),e.jsxs("td",{"data-label":"Amount Paid",children:["",ae.amount_paid.toFixed(2)]}),e.jsxs("td",{"data-label":"Balance Remaining",children:["",ae.balance_remaining.toFixed(2)]}),e.jsx("td",{"data-label":"Payment Mode",children:ae.payment_mode?ae.payment_mode.charAt(0).toUpperCase()+ae.payment_mode.slice(1):"-"}),e.jsx("td",{"data-label":"Notes",children:ae.notes||"-"})]},ae.id))})]})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:L,className:"button-cancel",children:"Close"})})]})}),_&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content compact-modal",children:[e.jsx("button",{onClick:xe,className:"modal-close-button",children:""}),e.jsx("h3",{className:"modal-title",children:"Add Payment"}),c&&e.jsx("div",{className:"modal-error-message",children:c}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_date",children:"Date:"}),e.jsx("input",{type:"date",id:"payment_date",value:T,onChange:ae=>Ce(ae.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_mode",children:"Mode:"}),e.jsxs("select",{id:"payment_mode",value:fe,onChange:ae=>ge(ae.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"order_value",children:"Order Value:"}),e.jsx("input",{type:"number",id:"order_value",value:Ue,onChange:ae=>Pe(ae.target.value),step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount_paid",children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount_paid",value:de,onChange:ae=>Se(ae.target.value),step:"0.01"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_notes",children:"Notes:"}),e.jsx("textarea",{id:"payment_notes",value:ee,onChange:ae=>oe(ae.target.value),rows:2,style:{resize:"none"}})]}),e.jsxs("div",{className:"modal-actions compact-actions",children:[e.jsx("button",{type:"button",onClick:xe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Payment"})]})]})]})})]})},PM=({isOpen:t,onClose:a,excelHeaders:n,onConfirm:i,availableFields:l})=>{const[c,o]=x.useState({});if(x.useEffect(()=>{t&&h()},[t,n,l]),!t)return null;const d=(f,g)=>{o(y=>({...y,[f]:g}))},h=()=>{const f={};n.forEach(g=>{const y=l.map(v=>({name:v})),b=gr(g,y);b&&(f[g]=b.name)}),o(f)},m=()=>{const f={};for(const g in c)c[g]&&c[g]!=="none"&&(f[g]=c[g]);i(f),a()};return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:a,className:"modal-close-button",children:e.jsx(St,{size:20})}),e.jsx("h3",{className:"modal-title",children:"Match File Columns"}),e.jsx("p",{className:"modal-description",children:'Please match the columns from your uploaded file to the corresponding fields in the drug inventory. You can use the "Auto Match" button for suggestions.'}),e.jsx("div",{className:"modal-actions-top",children:e.jsx("button",{type:"button",onClick:h,className:"button-auto-match",children:"Auto Match"})}),e.jsxs("div",{className:"column-mapping-grid",children:[e.jsx("div",{className:"grid-header",children:"Excel Column"}),e.jsx("div",{className:"grid-header",children:"App Field"}),n.map((f,g)=>e.jsxs(on.Fragment,{children:[e.jsx("div",{className:"excel-header-cell",children:f}),e.jsx("div",{className:"app-field-cell",children:e.jsxs("select",{value:c[f]||"",onChange:y=>d(f,y.target.value),className:"app-field-select",children:[e.jsx("option",{value:"",children:"-- Select Field --"}),e.jsx("option",{value:"none",children:"None (Ignore Column)"}),l.map((y,b)=>e.jsxs("option",{value:y,children:[y==="name"?"Composition Name":y==="brand_name"?"Brand Name":y==="price"?"MRP":y==="buying_price"?"Rate":y==="unit"?"Pack":y==="batch"?"Batch":y==="hsn_code"?"HSN Code":y==="mfg"?"MFG":y==="loose_quantity"?"Loose":y.replace(/_/g," ").replace(/\b\w/g,v=>v.toUpperCase())," "]},b))]})})]},g))]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:a,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:m,className:"button-submit",children:"Confirm Mapping"})]})]})})},RM=({entityType:t,config:a,values:n,onChange:i,className:l=""})=>{const o=(a[t]||[]).filter(h=>h.type!=="computed");if(o.length===0)return null;const d=h=>{const m=n[h.key]??"";switch(h.type){case"number":return e.jsx("input",{type:"number",id:`custom_${h.key}`,name:`custom_${h.key}`,value:m,onChange:f=>i(h.key,f.target.value===""?null:parseFloat(f.target.value)),className:"custom-text-input mt-1",placeholder:h.label,required:h.required});case"date":return e.jsx("input",{type:"date",id:`custom_${h.key}`,name:`custom_${h.key}`,value:m,onChange:f=>i(h.key,f.target.value||null),className:"custom-text-input mt-1",required:h.required});case"boolean":return e.jsx("input",{type:"checkbox",id:`custom_${h.key}`,name:`custom_${h.key}`,checked:!!m,onChange:f=>i(h.key,f.target.checked),className:"custom-checkbox mt-1"});case"text":default:return e.jsx("input",{type:"text",id:`custom_${h.key}`,name:`custom_${h.key}`,value:m,onChange:f=>i(h.key,f.target.value||null),className:"custom-text-input mt-1",placeholder:h.label,required:h.required})}};return e.jsxs("div",{className:`custom-fields-section ${l}`,children:[e.jsx("h4",{className:"custom-fields-title",children:"Custom Fields"}),e.jsx("div",{className:"custom-fields-grid",children:o.map(h=>e.jsxs("div",{className:"custom-field-item",children:[e.jsxs("label",{htmlFor:`custom_${h.key}`,className:"form-label",children:[h.label,h.required&&e.jsx("span",{className:"required-star",children:"*"})]}),d(h)]},h.key))})]})},OM=({isOpen:t,onClose:a,onDrugAddedToPurchase:n,customColumnsConfig:i={}})=>{const[l,c]=x.useState({name:"",composition:"",description:"",mrp:0,stock:0,pack:"",expiry_date:"",rate:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null,custom_fields:{}}),[o,d]=x.useState(null),[h,m]=x.useState(!1),[f,g]=x.useState(!1),y=x.useRef(null),b=x.useRef(null),v=x.useRef(null);x.useEffect(()=>{t&&(c({name:"",composition:"",description:"",mrp:0,stock:0,pack:"",expiry_date:"",rate:null,box_number:"",gst:5,margin:null,discount:null,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:null,custom_fields:{}}),d(null),m(!1),g(!1))},[t]),x.useEffect(()=>{const E=O=>{O.key==="Tab"&&b.current===document.activeElement&&(f||(g(!0),setTimeout(()=>{var M;(M=v.current)==null||M.focus()},0),O.preventDefault()))},D=O=>{y.current&&!y.current.contains(O.target)&&g(!1)};return document.addEventListener("keydown",E),document.addEventListener("mousedown",D),()=>{document.removeEventListener("keydown",E),document.removeEventListener("mousedown",D)}},[f]);const w=E=>{const{name:D,value:O,type:M}=E.target;c(A=>({...A,[D]:M==="number"?parseFloat(O)||null:O}))},S=(E,D)=>{c(O=>({...O,custom_fields:{...O.custom_fields,[E]:D}}))},_=E=>{if(E.preventDefault(),d(null),m(!0),l.mrp===void 0||l.stock===void 0){d("MRP and Stock Quantity are required."),m(!1);return}const D={...l,name:l.name===""?null:l.name,composition:l.composition===""?null:l.composition,rate:l.rate===0?null:l.rate,expiry_date:l.expiry_date===""?null:l.expiry_date,gst:l.gst===0?null:l.gst,margin:l.margin===0?null:l.margin,discount:l.discount===0?null:l.discount,brand_name:l.brand_name===""?null:l.brand_name,batch:l.batch===""?null:l.batch,hsn_code:l.hsn_code===""?null:l.hsn_code,mfg:l.mfg===""?null:l.mfg,loose:l.loose===0?null:l.loose,custom_fields:l.custom_fields||{}};n(D),m(!1),a()};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content add-drug-form-container max-w-2xl mx-auto",children:[e.jsxs("div",{className:"add-drug-form-header",children:[e.jsx("h2",{children:"Add New Drug"}),e.jsx("button",{onClick:a,className:"cancel-button",title:"Close",children:e.jsx(St,{size:24})})]}),o&&e.jsx("div",{className:"error-message",children:o}),e.jsxs("form",{onSubmit:_,className:"add-drug-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"Composition Name"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"name",id:"name",value:l.name||"",onChange:w,className:"custom-text-input mt-1",placeholder:"e.g., Paracetamol",tabIndex:1})]}),e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"brand_name",className:"form-label",children:"Brand Name"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"brand_name",id:"brand_name",value:l.brand_name||"",onChange:w,className:"custom-text-input mt-1",placeholder:"e.g., Calpol",tabIndex:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"mrp",className:"form-label",children:"MRP () *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),e.jsx("input",{type:"number",name:"mrp",id:"mrp",required:!0,step:"0.01",min:"0",value:l.mrp||"",onChange:w,className:"custom-text-input mt-1",placeholder:"e.g., 500",tabIndex:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"stock",className:"form-label",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(Ks,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),e.jsx("input",{type:"number",name:"stock",id:"stock",required:!0,step:"1",min:"0",value:l.stock||"",onChange:w,className:"custom-text-input mt-1",placeholder:"e.g., 5",tabIndex:4})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"pack",className:"form-label",children:"Pack (e.g., strip, bottle)"}),e.jsx("input",{type:"text",name:"pack",id:"pack",value:l.pack||"",onChange:w,className:"custom-text-input mt-1",placeholder:"e.g., strip, bottle",tabIndex:5})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"expiry_date",className:"form-label",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",id:"expiry_date",value:l.expiry_date||"",onChange:w,className:"custom-text-input mt-1",tabIndex:6})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"box_number",className:"form-label",children:"Box Number"}),e.jsx("input",{type:"text",name:"box_number",id:"box_number",value:l.box_number||"",onChange:w,className:"custom-text-input mt-1",tabIndex:7})]}),e.jsxs("div",{className:"relative sm-col-span-2",ref:y,children:[e.jsx("button",{type:"button",onClick:()=>g(!f),className:"form-button w-full text-left",tabIndex:8,ref:b,children:"Others"}),f&&e.jsxs("div",{className:"others-fields-grid",children:[" ",e.jsxs("div",{className:"sm-col-span-2",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",id:"description",rows:3,value:l.description||"",onChange:w,className:"custom-text-input mt-1",tabIndex:9})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"rate",className:"form-label",children:"Rate ()"}),e.jsx("input",{type:"number",name:"rate",id:"rate",step:"0.01",min:"0",value:l.rate??"",onChange:w,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:10,ref:v})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gst",className:"form-label",children:"GST (%)"}),e.jsx("input",{type:"number",name:"gst",id:"gst",step:"0.01",min:"0",max:"100",value:l.gst??"",onChange:w,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:11})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"margin",className:"form-label",children:"Margin (%)"}),e.jsx("input",{type:"number",name:"margin",id:"margin",step:"0.01",min:"0",max:"100",value:l.margin??"",onChange:w,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:12})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"discount",className:"form-label",children:"Discount (%)"}),e.jsx("input",{type:"number",name:"discount",id:"discount",step:"0.01",min:"0",max:"100",value:l.discount??"",onChange:w,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:13})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batch",className:"form-label",children:"Batch"}),e.jsx("input",{type:"text",name:"batch",id:"batch",value:l.batch||"",onChange:w,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:14})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"hsn_code",className:"form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsn_code",id:"hsn_code",value:l.hsn_code||"",onChange:w,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:15})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mfg",className:"form-label",children:"MFG"}),e.jsx("input",{type:"text",name:"mfg",id:"mfg",value:l.mfg||"",onChange:w,className:"custom-text-input mt-1",placeholder:"Optional",tabIndex:16})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"loose",className:"form-label",children:"Loose Quantity"}),e.jsx("input",{type:"number",name:"loose",id:"loose",step:"1",min:"0",value:l.loose??"",onChange:w,placeholder:"Optional",className:"custom-text-input mt-1",tabIndex:17})]})]})]})]}),e.jsx(RM,{entityType:"drugs",config:i,values:l.custom_fields||{},onChange:S}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:a,disabled:h,className:"form-button cancel-form-button",tabIndex:18,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:h,className:"form-button submit-form-button inline-flex justify-center",tabIndex:19,children:h?"Adding...":"Add Drug"})]})]})]})}):null},IM=({purchaseRows:t,onCellChange:a,onRemoveDrug:n,onAddEmptyRow:i})=>{const l=x.useRef(new Map),c=["name","mrp","stock","pack","expiry_date","rate","brand_name","box_number","gst","discount","batch","hsn_code","mfg","loose"],o=(d,h,m)=>{if(d.key==="Tab"){d.preventDefault();const f=c.indexOf(m);if(f!==-1){const g=(f+1)%c.length,y=c[g],b=l.current.get(`${h}-${y}`);b==null||b.focus()}}};return t.length===0?e.jsxs("div",{className:"no-drugs-message",children:[e.jsx("p",{children:"No drugs added to the purchase list yet."}),e.jsxs("button",{onClick:i,className:"action-button add-drug-to-table-button",children:[e.jsx(wa,{size:18,className:"button-icon"}),"Add the first drug"]})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"purchase-drugs-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Composition Name"}),e.jsx("th",{children:"MRP ()"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Pack"}),e.jsx("th",{children:"Supplier"}),e.jsx("th",{children:"Expiry Date"}),e.jsx("th",{children:"Rate ()"}),e.jsx("th",{children:"Brand Name"}),e.jsx("th",{children:"Box Number"}),e.jsx("th",{children:"GST (%)"}),e.jsx("th",{children:"Discount (%)"}),e.jsx("th",{children:"Margin (%)"}),e.jsx("th",{children:"Batch"}),e.jsx("th",{children:"HSN Code"}),e.jsx("th",{children:"MFG"}),e.jsx("th",{children:"Loose"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.map((d,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("input",{type:"text",value:d.name||"",onChange:m=>a(m,d.id,"name"),onKeyDown:m=>o(m,d.id,"name"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-name`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.mrp||"",onChange:m=>a(m,d.id,"mrp"),onKeyDown:m=>o(m,d.id,"mrp"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-mrp`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.stock||"",onChange:m=>a(m,d.id,"stock"),onKeyDown:m=>o(m,d.id,"stock"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-stock`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.pack||"",onChange:m=>a(m,d.id,"pack"),onKeyDown:m=>o(m,d.id,"pack"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-pack`,m)}})}),e.jsx("td",{children:d.supplier||"N/A"}),e.jsx("td",{children:e.jsx("input",{type:"date",value:d.expiry_date||"",onChange:m=>a(m,d.id,"expiry_date"),onKeyDown:m=>o(m,d.id,"expiry_date"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-expiry_date`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.rate||"",onChange:m=>a(m,d.id,"rate"),onKeyDown:m=>o(m,d.id,"rate"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-rate`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.brand_name||"",onChange:m=>a(m,d.id,"brand_name"),onKeyDown:m=>o(m,d.id,"brand_name"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-brand_name`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.box_number||"",onChange:m=>a(m,d.id,"box_number"),onKeyDown:m=>o(m,d.id,"box_number"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-box_number`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.gst||"",onChange:m=>a(m,d.id,"gst"),onKeyDown:m=>o(m,d.id,"gst"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-gst`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.discount||"",onChange:m=>a(m,d.id,"discount"),onKeyDown:m=>o(m,d.id,"discount"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-discount`,m)}})}),e.jsx("td",{children:(()=>{const m=d.mrp||0,f=d.rate||0,g=d.gst!==null&&d.gst!==void 0?d.gst/100*f:0,y=d.discount!==null&&d.discount!==void 0?d.discount/100*m:0,b=m-(f+g)-y;return`${(m>0?b/m*100:0).toFixed(2)}%`})()}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.batch||"",onChange:m=>a(m,d.id,"batch"),onKeyDown:m=>o(m,d.id,"batch"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-batch`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.hsn_code||"",onChange:m=>a(m,d.id,"hsn_code"),onKeyDown:m=>o(m,d.id,"hsn_code"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-hsn_code`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"text",value:d.mfg||"",onChange:m=>a(m,d.id,"mfg"),onKeyDown:m=>o(m,d.id,"mfg"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-mfg`,m)}})}),e.jsx("td",{children:e.jsx("input",{type:"number",value:d.loose||"",onChange:m=>a(m,d.id,"loose"),onKeyDown:m=>o(m,d.id,"loose"),className:"editable-cell-input",ref:m=>{d.id&&l.current.set(`${d.id}-loose`,m)}})}),e.jsx("td",{children:e.jsx("button",{onClick:()=>n(d.id),className:"delete-button",title:"Remove Item",children:e.jsx(Jt,{size:16})})})]},d.id||h))})]})})},zM="_container_7ak2k_7",FM="_header_7ak2k_207",LM="_backButton_7ak2k_221",$M="_title_7ak2k_265",MM="_stickyActionBar_7ak2k_287",BM="_actionRow_7ak2k_317",UM="_inputWrapper_7ak2k_335",qM="_inputIcon_7ak2k_345",HM="_input_7ak2k_335",VM="_quickDistributors_7ak2k_401",GM="_distributorChip_7ak2k_417",QM="_distributorChipIcon_7ak2k_463",YM="_selectedInfo_7ak2k_473",JM="_resultsDropdown_7ak2k_503",KM="_resultItem_7ak2k_537",WM="_buttonGroup_7ak2k_565",XM="_button_7ak2k_565",ZM="_buttonPrimary_7ak2k_609",e8="_buttonSecondary_7ak2k_631",t8="_buttonAccent_7ak2k_653",n8="_buttonDisabled_7ak2k_675",a8="_tableSection_7ak2k_691",s8="_cardTitle_7ak2k_707",i8="_cardIcon_7ak2k_727",r8="_footer_7ak2k_947",l8="_totalValue_7ak2k_981",o8="_footerControls_7ak2k_1005",c8="_paidInputGroup_7ak2k_1017",u8="_paidLabel_7ak2k_1029",d8="_paidInput_7ak2k_1017",h8="_errorMsg_7ak2k_1075",Rt={container:zM,header:FM,backButton:LM,title:$M,stickyActionBar:MM,actionRow:BM,inputWrapper:UM,inputIcon:qM,input:HM,quickDistributors:VM,distributorChip:GM,distributorChipIcon:QM,selectedInfo:YM,resultsDropdown:JM,resultItem:KM,buttonGroup:WM,button:XM,buttonPrimary:ZM,buttonSecondary:e8,buttonAccent:t8,buttonDisabled:n8,tableSection:a8,cardTitle:s8,cardIcon:i8,footer:r8,totalValue:l8,footerControls:o8,paidInputGroup:c8,paidLabel:u8,paidInput:d8,errorMsg:h8},o1=()=>{const t=ft(),{purchaseRows:a,setPurchaseRows:n,selectedDistributor:i,setSelectedDistributor:l,searchTerm:c,setSearchTerm:o,amountPaidToDistributor:d,setAmountPaidToDistributor:h,distributors:m,setDistributors:f}=K1(),[g,y]=x.useState(!1),[b,v]=x.useState(!0),w=x.useRef(null),S=x.useRef(null),[_,E]=x.useState(!1),D=x.useRef(null),[O,M]=x.useState(!1),[A,P]=x.useState([]),[Q,G]=x.useState(null),[C,R]=x.useState(null),[z,F]=x.useState(!1),[J,H]=x.useState([]),I=["name","description","mrp","stock","pack","supplier","expiry_date","rate","box_number","gst","margin","discount","brand_name","batch","hsn_code","mfg","loose"];x.useEffect(()=>{(async()=>{v(!0);try{const ie=await Z("/api/distributors?limit=4");if(ie.ok){const ce=await ie.json();H(Array.isArray(ce)?ce.slice(0,4):[])}}catch(ie){console.error("Failed to fetch initial distributors",ie)}finally{v(!1)}})()},[]);const V=()=>{const ie={id:Date.now().toString()+Math.random().toString(36).substring(2,9),name:"",composition:"",description:"",mrp:0,stock:0,pack:"",supplier:i?i.name:"",expiry_date:"",rate:0,box_number:"",gst:0,margin:0,discount:0,brand_name:"",batch:"",hsn_code:"",mfg:"",loose:0,last_updated:"",created_at:""};n(ce=>[...ce,ie])},re=async(Y,ie)=>{if(!Y){R("No file provided for import.");return}if(!i){R("Please select a distributor before importing.");return}y(!0),R(null);const ce=new FormData;ce.append("inventoryFile",Y),ce.append("columnMapping",JSON.stringify(ie));try{const pe=await Z("/api/drugs/parse-excel",{method:"POST",body:ce});if(!pe.ok){const We=await pe.json();throw new Error(We.message||`Failed to parse Excel file: ${pe.statusText}`)}const He=await pe.json();n(We=>[...We,...He.map(st=>({...st,id:Date.now().toString()+Math.random().toString(36).substring(2,9),supplier:i?i.name:st.supplier}))]),alert(`Successfully parsed ${He.length} drugs from Excel. They have been added to the purchase list.`)}catch(pe){console.error("Failed to parse Excel file:",pe),R(pe.message||"Failed to parse Excel file. Please check the file format and try again.")}finally{w.current&&(w.current.value=""),y(!1),G(null)}},B=async Y=>{if(Y.target.files&&Y.target.files[0]){const ie=Y.target.files[0];G(ie),R(null),y(!0);const ce=new FormData;ce.append("inventoryFile",ie);try{const pe=await Z("/api/drugs/get-file-headers",{method:"POST",body:ce});if(!pe.ok){const We=await pe.json();throw new Error(We.message||`Failed to get file headers: ${pe.statusText}`)}const{headers:He}=await pe.json();P(He),M(!0)}catch(pe){console.error("Failed to get file headers:",pe),R(pe.message||"Failed to read file headers. Please check the file format and try again."),G(null)}finally{y(!1)}}else G(null)},k=Y=>{Q?re(Q,Y):R("No file selected for import after mapping."),M(!1)},Ne=()=>{M(!1),P([]),G(null),w.current&&(w.current.value="")},Ae=()=>{var Y;(Y=w.current)==null||Y.click()},T=async Y=>{if(Y.target.files&&Y.target.files[0]){const ie=Y.target.files[0];R(null),y(!0);const ce=new FormData;ce.append("file",ie),ce.append("output_type","csv");const He={Authorization:"Bearer 00841ac4-b279-11f0-ab55-0a3a41e3fad1"};try{const We=await fetch("https://extraction-api.nanonets.com/extract",{method:"POST",headers:He,body:ce});if(!We.ok){const xe=await We.json();throw new Error(xe.message||`Failed to extract data from image/PDF: ${We.statusText}`)}const st=await We.json();if(!st.success||!st.content)throw new Error(st.detail||"Nanonets API did not return expected content.");let me=st.content;me=me.split(`
`).filter(xe=>!xe.startsWith("#")&&xe.trim()!=="").join(`
`);const Fe=new File([me],"extracted_data.csv",{type:"text/csv"}),Ee=new FormData;Ee.append("inventoryFile",Fe);const L=await Z("/api/drugs/get-file-headers",{method:"POST",body:Ee});if(!L.ok){const xe=await L.json();throw new Error(xe.message||`Failed to get headers from extracted CSV: ${L.statusText}`)}const{headers:ne}=await L.json();P(ne),G(Fe),M(!0)}catch(We){console.error("Failed to extract data from image/PDF:",We),R(We.message||"Failed to extract data from image/PDF. Please check the file and try again.")}finally{S.current&&(S.current.value=""),y(!1)}}},Ce=()=>{var Y;(Y=S.current)==null||Y.click()},Ue=()=>{if(!i){R("Please select a distributor before adding a drug manually.");return}F(!0)},Pe=()=>{F(!1),R(null)},de=Y=>{n(ie=>[...ie,{...Y,id:Date.now().toString(),supplier:i?i.name:Y.supplier}]),Pe()},Se=Y=>{n(ie=>ie.filter(ce=>ce.id!==Y))},ee=(Y,ie,ce)=>{const{value:pe}=Y.target;n(He=>He.map(We=>{if(We.id===ie){let st=pe;ce==="expiry_date"?st=pe.trim()===""?null:pe:["mrp","stock","rate","gst","margin","discount","loose"].includes(ce)&&(st=parseFloat(pe),isNaN(st)&&(st=null));const me={...We,[ce]:st};return ce==="name"&&i&&!me.supplier&&(me.supplier=i.name),me}return We}))},oe=x.useCallback(()=>a.reduce((Y,ie)=>{const ce=ie.stock||0,pe=ie.rate||0,He=ie.gst||0,We=ie.discount||0;let st=pe*(1-We/100),me=ce*st;return me+=me*(He/100),Y+me},0),[a]),fe=async()=>{if(!i){R("Please select a distributor before submitting the purchase.");return}const Y=a.filter(ie=>Object.values(ie).some(ce=>typeof ce=="string"&&ce.trim()!==""||typeof ce=="number"&&ce!==0||ce!=null&&typeof ce!="string"&&typeof ce!="number"));if(Y.length===0){R("No valid drugs to submit. Please fill in at least one field for a row, or remove empty rows."),y(!1);return}y(!0),R(null);try{for(const He of Y){const We={...He,expiry_date:He.expiry_date===""?null:He.expiry_date,distributorId:i.id},st=await Z("/api/drugs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(We)});if(!st.ok){const me=await st.json();throw new Error(me.message||`Failed to add drug ${He.name}: ${st.statusText}`)}}const ie=oe(),ce=new Date().toISOString().split("T")[0],pe=await Z(`/api/distributors/${i.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:ce,order_value:ie,amount_paid:d,notes:"Payment from purchase page."})});if(!pe.ok){const He=await pe.json();throw new Error(He.message||`Failed to record distributor payment: ${pe.statusText}`)}alert("All valid drugs added to inventory and distributor payment recorded successfully!"),n([]),l(null),o(""),h(0),t("/dashboard/inventory")}catch(ie){console.error("Failed to submit purchase:",ie),R(ie.message||"Failed to submit purchase. Please try again.")}finally{y(!1)}},ge=x.useCallback(async Y=>{if(Y.trim()===""){f([]);return}try{const ie=await Z(`/api/distributors?search=${encodeURIComponent(Y)}`);if(!ie.ok)throw new Error(`Failed to fetch distributors: ${ie.statusText}`);const ce=await ie.json();f(ce)}catch(ie){console.error("Failed to fetch distributors:",ie),R(ie.message||"Failed to load distributors.")}},[]),q=Y=>{const ie=Y.target.value;o(ie),l(null),D.current&&clearTimeout(D.current),ie.trim()!==""?D.current=setTimeout(()=>{ge(ie),E(!0)},300):(f([]),E(!1))},W=Y=>{l(Y),o(Y.name),E(!1),f([])};return x.useEffect(()=>{const Y=ie=>{ie.target instanceof HTMLElement&&!ie.target.closest(`.${Rt.inputWrapper}`)&&E(!1)};return document.addEventListener("mousedown",Y),()=>{document.removeEventListener("mousedown",Y),D.current&&clearTimeout(D.current)}},[]),e.jsxs("div",{className:Rt.container,children:[e.jsxs("div",{className:Rt.header,children:[e.jsx("button",{onClick:()=>t(-1),className:Rt.backButton,title:"Go Back",children:e.jsx(Et,{size:24})}),e.jsx("h2",{className:Rt.title,children:"Purchase Inventory"})]}),C&&e.jsxs("div",{className:Rt.errorMsg,children:[e.jsx(Nn,{size:20}),C]}),e.jsx("div",{className:Rt.stickyActionBar,children:e.jsxs("div",{className:Rt.actionRow,children:[e.jsxs("div",{style:{flex:1,minWidth:"300px",position:"relative"},children:[e.jsxs("div",{className:Rt.inputWrapper,children:[e.jsx(fn,{className:Rt.inputIcon,size:20}),e.jsx("input",{type:"text",placeholder:"Search distributor...",value:c,onChange:q,onFocus:()=>c.trim()!==""&&E(!0),className:Rt.input}),_&&m.length>0&&e.jsx("ul",{className:Rt.resultsDropdown,children:m.map(Y=>e.jsx("li",{onClick:()=>W(Y),className:Rt.resultItem,children:Y.name},Y.id))})]}),b?e.jsx("div",{className:Rt.quickDistributors,children:[1,2,3,4].map(Y=>e.jsx(U,{width:100,height:32,style:{borderRadius:"16px"}},Y))}):J.length>0&&!i&&e.jsx("div",{className:Rt.quickDistributors,children:J.map(Y=>e.jsxs("button",{className:Rt.distributorChip,onClick:()=>W(Y),children:[e.jsx(Rn,{className:Rt.distributorChipIcon}),Y.name]},Y.id))}),i&&e.jsxs("div",{className:Rt.selectedInfo,style:{marginTop:"0.5rem",marginBottom:0},children:[e.jsx(ka,{size:18}),e.jsxs("span",{children:["Selected: ",e.jsx("strong",{children:i.name})]})]})]}),e.jsxs("div",{className:Rt.buttonGroup,children:[e.jsx("input",{ref:w,type:"file",className:"sr-only",style:{display:"none"},accept:".xlsx, .xls, .csv",onChange:B}),e.jsx("input",{ref:S,type:"file",className:"sr-only",style:{display:"none"},accept:".pdf, .png, .jpg, .jpeg",onChange:T}),e.jsxs("button",{onClick:Ae,disabled:g||!i,className:`${Rt.button} ${Rt.buttonPrimary} ${g||!i?Rt.buttonDisabled:""}`,title:i?"":"Select a distributor to import",children:[e.jsx(IC,{size:18}),g?"Processing...":"Import Excel/CSV"]}),e.jsxs("button",{onClick:Ce,disabled:g||!i,className:`${Rt.button} ${Rt.buttonSecondary} ${g||!i?Rt.buttonDisabled:""}`,title:i?"":"Select a distributor",children:[e.jsx(_s,{size:18}),"Scan Image/PDF"]}),e.jsxs("button",{onClick:Ue,disabled:!i,className:`${Rt.button} ${Rt.buttonAccent} ${i?"":Rt.buttonDisabled}`,title:i?"":"Select a distributor",children:[e.jsx(wa,{size:18}),"Add Manually"]})]})]})}),e.jsx(PM,{isOpen:O,onClose:Ne,excelHeaders:A,onConfirm:k,availableFields:I}),z&&e.jsx(OM,{isOpen:z,onClose:Pe,onDrugAddedToPurchase:de}),e.jsxs("div",{className:Rt.tableSection,children:[e.jsxs("div",{className:Rt.cardTitle,children:[e.jsx(tm,{className:Rt.cardIcon,size:24}),"Purchase Items (",a.length,")"]}),e.jsx(IM,{purchaseRows:a,onCellChange:ee,onRemoveDrug:Se,onAddEmptyRow:V})]}),e.jsxs("div",{className:Rt.footer,children:[e.jsxs("button",{onClick:V,className:`${Rt.button} ${Rt.buttonSecondary}`,children:[e.jsx(wa,{size:18}),"Add New Row"]}),e.jsxs("div",{className:Rt.footerControls,children:[e.jsxs("div",{className:Rt.paidInputGroup,children:[e.jsx("label",{htmlFor:"amount-paid",className:Rt.paidLabel,children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount-paid",value:d,onChange:Y=>h(parseFloat(Y.target.value)||0),placeholder:"0.00",className:Rt.paidInput,step:"0.01",disabled:!i})]}),e.jsxs("div",{className:Rt.totalValue,children:["Total: ",e.jsxs("span",{children:["",oe().toFixed(2)]})]}),e.jsx("button",{onClick:fe,disabled:g||a.length===0||!i,className:`${Rt.button} ${Rt.buttonPrimary} ${Rt.submitButton} ${g||!i||a.length===0?Rt.buttonDisabled:""}`,style:{padding:"0.8rem 1.5rem",fontSize:"1rem"},children:g?"Submitting...":"Complete Purchase"})]})]})]})},m8=t=>{if(!t)return 1;const a=t.match(/(?:\d+x)?(\d+)/);return a&&a[1]?parseInt(a[1],10):1},p8=()=>{const t=ft(),a=Qa(),[n,i]=x.useState(null),[l,c]=x.useState([]),[o,d]=x.useState(!0),[h,m]=x.useState(null),[f,g]=x.useState(!1),[y,b]=x.useState("cash"),[v,w]=x.useState(""),[S,_]=x.useState(""),[E,D]=x.useState(""),[O,M]=x.useState(""),[A,P]=x.useState(""),[Q,G]=x.useState(0),C=x.useRef(!1),[R,z]=x.useState(null),[F,J]=x.useState(!1),H=Ce=>{const Ue=Math.max(0,Math.min(100,isNaN(Ce)?0:Ce));C.current=!0,G(Ue);const Pe=l.map(de=>({...de,discount_percentage:Ue}));c(Pe)},I=(Ce,Ue)=>{const Pe=[...l];Pe[Ce].discount_percentage=isNaN(Ue)?0:Ue,c(Pe)};x.useEffect(()=>{if(C.current){C.current=!1;return}const Ce=l.reduce((de,Se)=>de+(Se.total_price??0),0);if(Ce===0){G(0);return}const Pe=l.reduce((de,Se)=>{const oe=(Se.total_price??0)*((Se.discount_percentage??0)/100);return de+oe},0)/Ce*100;G(de=>Math.abs(de-Pe)>.01?Pe:de)},[l]);const V=async()=>{if(!n)return m("No order data available to bill."),null;if(l.length===0)return m("Cannot bill an empty order."),null;g(!0),m(null);try{const Ce=l.map(ee=>{const oe=(ee.pricePerLooseUnit??0)*(ee.looseQuantity??0),fe=oe*((ee.discount_percentage??0)/100),ge=oe-fe;return{name:ee.name,pack_quantity:ee.loosePacks??0,loose_quantity:ee.looseUnits??0,price:ee.originalPrice??0,pack_price:ee.originalPrice??0,loose_price:ee.pricePerLooseUnit??0,total:ge,drug_id:ee.drug_id,discount_percentage:ee.discount_percentage??0,batch:ee.batch,expiry_date:ee.expiry_date}}),Ue={patientId:n.patientId,queueId:n.id,items:Ce,amount:T,paymentMode:y,type:"pharmacy",related_id:n.id,status:"paid",discountPercentage:Q},Pe=await Z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ue)}),de=await Pe.json();if(!Pe.ok||!de.id)throw new Error(de.message||"Failed to create bill.");const Se=await Z(`/api/pharmacy-orders/${n.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:de.id,medications:l})});if(!Se.ok){const ee=await Se.text();throw new Error(`Failed to update pharmacy order status: ${Se.statusText} - ${ee}`)}if(i(ee=>ee?{...ee,status:"billed",bill_id:de.id}:null),y==="credit")try{await Z(`/api/patient-debts/${n.patientId}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:T,related_bill_id:de.id,notes:`Pharmacy Bill #${de.id}`})})}catch(ee){console.error("Failed to create debt entry:",ee)}return alert(`Order ${n.patientName}'s bill created (ID: ${de.id}) and marked as billed.`),t(`/dashboard/pharmacy-billing/${n.id}`,{replace:!0,state:{order:{...n,status:"billed",bill_id:de.id},initialItems:l}}),de.id}catch(Ce){return console.error("Billing process failed:",Ce),m(Ce.message||"Failed to mark order as billed. Please try again."),null}finally{g(!1)}},re=async()=>{if(n)try{const Ce=await Z(`/api/pharmacy-orders/${n.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"dispensed",medications:l})});if(!Ce.ok){const Ue=await Ce.text();console.error("Failed to dispense order:",Ue)}}catch(Ce){console.error("Error dispensing order:",Ce)}},B=()=>{window.print()},k=async()=>{await V()&&(window.print(),await re(),t(-1))};x.useEffect(()=>{const Ce=a.pathname.split("/"),Ue=Ce[Ce.length-1];Ue?(async()=>{try{d(!0);const[de,Se,ee]=await Promise.all([Z(`/api/pharmacy-orders/${Ue}`),Z("/api/drugs").then(q=>q.ok?q.json():null).catch(()=>null),Z("/api/clinics/settings").then(q=>q.ok?q.json():null).catch(()=>null)]);if(!de.ok)throw new Error("Failed to fetch pharmacy order details");const oe=await de.json();i(oe);let fe=[];Se&&(fe=Se.drugs||Se||[]),ee&&(_(ee.upi_id||""),D(ee.name||""),M(ee.address||""),P(ee.notes||""));const ge=oe.medications.map(q=>{const W=m8(q.unit),Y=(q.pack_quantity??0)*W+(q.loose_quantity??0),ie=fe.find(me=>q.drug_id&&String(me.id)===String(q.drug_id)||me.name.toLowerCase()===q.name.toLowerCase()),ce=q.batch||(ie==null?void 0:ie.batch)||(ie==null?void 0:ie.batch_number),pe=q.expiry_date||(ie==null?void 0:ie.expiry_date),He=Number(q.pack_price)||Number(ie==null?void 0:ie.mrp)||0,We=Number(ie==null?void 0:ie.rate)||0;let st=Number(q.loose_price)||0;return st===0&&(He>0&&W>0?st=He/W:We>0&&(st=We)),{...q,isLoose:!0,loosePacks:q.pack_quantity??0,looseUnits:q.loose_quantity??0,looseQuantity:Y,pack_price:He,loose_price:st,total_price:Number(q.total_price)||st*Y,pricePerLooseUnit:st,originalPrice:He,discount_percentage:Number(q.discount_percentage)??0,directions_to_use:q.directions_to_use,tabletsPerDay:q.tabletsPerDay,numberOfDays:q.numberOfDays,batch:ce,expiry_date:pe}});c(ge)}catch(de){console.error("Failed to fetch data:",de),m(de.message||"Failed to load order details.")}finally{d(!1)}})():(m("No pharmacy order ID provided."),d(!1))},[a.pathname]);const Ne=x.useMemo(()=>l.reduce((Ce,Ue)=>Ce+(Ue.total_price??0),0),[l]),Ae=x.useMemo(()=>l.reduce((Ce,Ue)=>{const de=(Ue.total_price??0)*(Ue.discount_percentage??0)/100;return Ce+de},0),[l]),T=x.useMemo(()=>Ne-Ae,[Ne,Ae]);return x.useEffect(()=>{if(T>0&&S){const Ce=`upi://pay?pa=${S}&pn=ClinicName&am=${T.toFixed(2)}&cu=INR`;w(Ce)}else w("")},[T,S]),x.useEffect(()=>{(async()=>{if(y==="credit"&&(n!=null&&n.patientId)){J(!0);try{const Ue=await Z(`/api/patient-debts/${n.patientId}/balance`);if(Ue.ok){const Pe=await Ue.json();z(Pe.netDebt||0)}else z(0)}catch(Ue){console.error("Error fetching patient debt:",Ue),z(0)}finally{J(!1)}}})()},[y,n==null?void 0:n.patientId]),o?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("div",{className:"billing-header no-print",children:[e.jsx("div",{className:"back-button",children:e.jsx(U,{width:100,height:40,style:{borderRadius:"8px"}})}),e.jsx(U,{width:300,height:40})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx("div",{className:"info-item",children:e.jsx(U,{width:200,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:150,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:180,height:20})}),e.jsx("div",{className:"info-item",children:e.jsx(U,{width:150,height:20})})]})]}),e.jsxs("div",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:120,height:24})})}),e.jsx("div",{className:"p-4",children:e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(U,{width:30,height:20})}),e.jsx("th",{children:e.jsx(U,{width:150,height:20})}),e.jsx("th",{children:e.jsx(U,{width:80,height:20})}),e.jsx("th",{children:e.jsx(U,{width:80,height:20})}),e.jsx("th",{children:e.jsx(U,{width:100,height:20})}),e.jsx("th",{children:e.jsx(U,{width:60,height:20})})]})}),e.jsx("tbody",{children:[1,2,3,4].map(Ce=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:20,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:20})}),e.jsx("td",{children:e.jsx(U,{width:70,height:20})}),e.jsx("td",{children:e.jsx(U,{width:70,height:20})}),e.jsx("td",{children:e.jsx(U,{width:90,height:20})}),e.jsx("td",{children:e.jsx(U,{width:60,height:20})})]},Ce))})]})})]})]}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:160,height:24})})}),e.jsxs("div",{className:"space-y-4 p-5",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:120,height:28}),e.jsx(U,{width:100,height:28})]}),e.jsx("div",{style:{display:"flex",justifyContent:"center",padding:"20px 0"},children:e.jsx(U,{width:150,height:150})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(U,{width:"100%",height:45,style:{borderRadius:"8px"}}),e.jsx(U,{width:"100%",height:45,style:{borderRadius:"8px"}}),e.jsx(U,{width:"100%",height:45,style:{borderRadius:"8px"}})]})]})]})})]})]})}):h?e.jsxs("div",{className:"error-message-box",children:["Error: ",h]}):n?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:E?`${E} Pharmacy`:"Pharmacy Bill"}),(O||A)&&e.jsxs("div",{className:"clinic-details-print",children:[O&&e.jsx("span",{className:"small-text clinic-address",children:O}),A&&e.jsx("span",{className:"small-text clinic-notes",children:A})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",n.patientName]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",n.patientTokenNumber??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Order Date"]})," ",new Date(n.date).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Pharmacy Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",n.patientName]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",n.patientTokenNumber??"N/A"]}),e.jsxs("div",{className:"info-item no-print",children:[e.jsxs("strong",{children:[e.jsx(kr,{size:16})," Order ID"]})," ",n.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Order Date"]})," ",new Date(n.date).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Medications"})}),l.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"BATCH"}),e.jsx("th",{children:"EXPIRY"}),e.jsx("th",{children:"QUANTITY"}),e.jsx("th",{children:"MRP"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"GST%"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:l.map((Ce,Ue)=>{var oe;const Pe=Ce.total_price??0,de=Pe*(Ce.discount_percentage??0)/100,Se=Pe-de;return e.jsxs("tr",{children:[e.jsx("td",{children:Ue+1}),e.jsx("td",{children:Ce.name}),e.jsx("td",{children:Ce.batch||"N/A"}),e.jsx("td",{children:Ce.expiry_date?new Date(Ce.expiry_date).toLocaleDateString():"N/A"}),e.jsxs("td",{children:[e.jsxs("div",{children:["Packs: ",Ce.loosePacks??0]}),e.jsxs("div",{children:["Loose: ",Ce.looseUnits??0]})]}),e.jsx("td",{children:((oe=Ce.originalPrice)==null?void 0:oe.toFixed(2))??"N/A"}),e.jsx("td",{children:((Ce.pricePerLooseUnit??0)*(1-(Ce.discount_percentage??0)/100)).toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:Ce.discount_percentage===0?"":Ce.discount_percentage,onChange:fe=>I(Ue,parseFloat(fe.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsxs("td",{children:[5 .toFixed(1),"%"]}),e.jsx("td",{children:Se.toFixed(2)})]},Ue)})})]}):e.jsx("p",{children:"No medications in this order."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Ne.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Total Discount (",Q.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ",Ae.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"GST (Included)"}),e.jsxs("span",{children:["",(T*.05).toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",T.toFixed(2)]})})]}),v&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${y!=="upi"?"hide-on-screen":""}`,children:[e.jsx(cs,{value:v,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Ne.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ",Ae.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:Q===0?"":Q,onChange:Ce=>H(parseFloat(Ce.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:f||n.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",T.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:v?e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:v,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:y,onChange:Ce=>b(Ce.target.value),className:"payment-mode-select",disabled:f||n.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt to Patient)"})]})]}),y==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:" Debt to Patient"}),F?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:R&&R>0?"#dc3545":"#28a745"},children:["",(R||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ",T.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["",((R||0)+T).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bill-actions",children:[n.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:B,className:"secondary-button print-preview-button no-print",disabled:f||l.length===0,children:"Print Preview"}),e.jsx("button",{onClick:k,className:"primary-button",disabled:f||l.length===0,children:f?"Processing...":"Finalise and Bill"})]}),n.status==="billed"&&e.jsx("button",{onClick:()=>t(`/dashboard/bills/${n.bill_id}`),className:"secondary-button",children:"View Bill"})]})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})}):e.jsx("div",{className:"error-message-box",children:"No order data available."})},f8=()=>{const t=ft(),a=Qa(),[n,i]=x.useState(null),[l,c]=x.useState(""),[o,d]=x.useState(""),[h,m]=x.useState([]),[f,g]=x.useState(!0),[y,b]=x.useState(null),[v,w]=x.useState(!1),[S,_]=x.useState("cash"),[E,D]=x.useState(""),[O,M]=x.useState(""),[A,P]=x.useState(""),[Q,G]=x.useState(""),[C,R]=x.useState(""),[z,F]=x.useState(""),[J,H]=x.useState(0),I=x.useRef(!1),[V,re]=x.useState(null),[B,k]=x.useState(!1),Ne=ee=>{const oe=Math.max(0,Math.min(100,isNaN(ee)?0:ee));I.current=!0,H(oe);const fe=h.map(ge=>({...ge,discount_percentage:oe}));m(fe)},Ae=(ee,oe)=>{const fe=[...h];fe[ee].discount_percentage=isNaN(oe)?0:oe,m(fe)};x.useEffect(()=>{if(I.current){I.current=!1;return}const ee=h.reduce((ge,q)=>ge+(q.price??0),0);if(ee===0){H(0);return}const fe=h.reduce((ge,q)=>{const Y=(q.price??0)*((q.discount_percentage??0)/100);return ge+Y},0)/ee*100;H(ge=>Math.abs(ge-fe)>.01?fe:ge)},[h]);const T=async()=>{if(!n)return b("No order data available to bill."),null;if(h.length===0)return b("Cannot bill an empty order."),null;w(!0),b(null);try{const ee=h.map(W=>{const Y=W.price,ie=Y*((W.discount_percentage??0)/100),ce=Y-ie;return{name:W.name,price:W.price,quantity:1,total:ce,item_id:W.id,type:"lab_test",discount_percentage:W.discount_percentage??0}}),oe={patientId:n.patient_id,items:ee,amount:Se,paymentMode:S,type:"lab",related_id:n.id,status:"paid",discountPercentage:J},fe=await Z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(oe)}),ge=await fe.json();if(!fe.ok||!ge.id)throw new Error(ge.message||"Failed to create bill.");const q=await Z(`/api/lab/${n.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:ge.id})});if(!q.ok){const W=await q.text();throw new Error(`Failed to update lab order status: ${q.statusText} - ${W}`)}if(i(W=>W?{...W,status:"billed",bill_id:ge.id}:null),S==="credit")try{await Z(`/api/patient-debts/${n.patient_id}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:Se,related_bill_id:ge.id,notes:`Lab Bill #${ge.id}`})})}catch(W){console.error("Failed to create debt entry:",W)}return alert(`Lab Order bill created (ID: ${ge.id}) and marked as billed.`),t(`/dashboard/lab-billing/${n.id}`,{replace:!0,state:{...a.state,order:{...n,status:"billed",bill_id:ge.id}}}),ge.id}catch(ee){return console.error("Billing process failed:",ee),b(ee.message||"Failed to mark order as billed. Please try again."),null}finally{w(!1)}},Ce=()=>{window.print()},Ue=async()=>{await T()&&(window.print(),t(-1))};x.useEffect(()=>{const ee=a.pathname.split("/"),oe=ee[ee.length-1];oe?(async()=>{try{const[ge,q]=await Promise.all([Z(`/api/lab/${oe}`),Z("/api/clinics/settings").catch(()=>({ok:!1}))]);if(!ge.ok)throw new Error("Failed to fetch lab order details");const W=await ge.json();i(W);const Y=W.patient_id?Z(`/api/patients/${W.patient_id}`).catch(()=>({ok:!1})):Promise.resolve({ok:!1});if(q.ok&&"json"in q){const pe=await q.json();M(pe.upi_id||""),P(pe.name||""),G(pe.address||""),R(pe.notes||""),F(pe.labLetterheadUrl||"")}const ie=await Y;if(ie.ok&&"json"in ie){const pe=await ie.json();c(pe.name),d(pe.patient_token_number)}const ce=W.tests.map(pe=>({...pe,price:typeof pe.price=="string"?parseFloat(pe.price):Number(pe.price)||0,discount_percentage:0,total_price:typeof pe.price=="string"?parseFloat(pe.price):Number(pe.price)||0}));m(ce)}catch(ge){console.error("Failed to fetch data:",ge),b(ge.message||"Failed to load order details.")}finally{g(!1)}})():(b("No lab order ID provided."),g(!1))},[a.pathname]);const Pe=x.useMemo(()=>h.reduce((ee,oe)=>ee+(oe.price??0),0),[h]),de=x.useMemo(()=>h.reduce((ee,oe)=>{const ge=(oe.price??0)*(oe.discount_percentage??0)/100;return ee+ge},0),[h]),Se=x.useMemo(()=>Pe-de,[Pe,de]);return x.useEffect(()=>{if(Se>0&&O){const ee=`upi://pay?pa=${O}&pn=ClinicName&am=${Se.toFixed(2)}&cu=INR`;D(ee)}else D("")},[Se,O]),x.useEffect(()=>{(async()=>{if(S==="credit"&&(n!=null&&n.patient_id)){k(!0);try{const oe=await Z(`/api/patient-debts/${n.patient_id}/balance`);if(oe.ok){const fe=await oe.json();re(fe.netDebt||0)}else re(0)}catch(oe){console.error("Error fetching patient debt:",oe),re(0)}finally{k(!1)}}})()},[S,n==null?void 0:n.patient_id]),f?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("div",{className:"billing-header no-print",children:[e.jsx("div",{className:"back-button",children:e.jsx(U,{width:80,height:32})}),e.jsx("h1",{children:e.jsx(U,{width:200,height:32})})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx(U,{width:200,height:20}),e.jsx(U,{width:150,height:20}),e.jsx(U,{width:180,height:20}),e.jsx(U,{width:150,height:20})]})]}),e.jsxs("div",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:100,height:24})})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40})]})]})]}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:120,height:24}),e.jsx(U,{width:100,height:24})]}),e.jsx(U,{width:"100%",height:150})," ",e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40})]})]})})]})]})}):y?e.jsxs("div",{className:"error-message-box",children:["Error: ",y]}):n?e.jsxs("div",{className:"pharmacy-billing-page",children:[" ",e.jsxs("div",{className:"billing-container printable-section",children:[z&&e.jsx("div",{className:"print-only print-letterhead-container",children:e.jsx("img",{src:z,alt:"Lab Letterhead",className:"print-letterhead-image"})}),e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:A?`${A} Lab`:"Lab Bill"}),(Q||C)&&e.jsxs("div",{className:"clinic-details-print",children:[Q&&e.jsx("span",{className:"small-text clinic-address",children:Q}),C&&e.jsx("span",{className:"small-text clinic-notes",children:C})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",l]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",o??"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Order Date"]})," ",new Date(n.createdAt).toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Lab Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",l]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",o??"N/A"]}),e.jsxs("div",{className:"info-item no-print",children:[e.jsxs("strong",{children:[e.jsx(Cs,{size:16})," Order ID"]})," ",n.id]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Order Date"]})," ",new Date(n.createdAt).toLocaleDateString()]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Lab Tests"})}),h.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"TEST DESCRIPTION"}),e.jsx("th",{children:"PRICE"}),e.jsx("th",{children:"DIS %"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:h.map((ee,oe)=>{const fe=ee.price??0,ge=fe*(ee.discount_percentage??0)/100,q=fe-ge;return e.jsxs("tr",{children:[e.jsx("td",{children:oe+1}),e.jsx("td",{children:ee.name}),e.jsx("td",{children:typeof ee.price=="number"?ee.price.toFixed(2):Number(ee.price||0).toFixed(2)}),e.jsxs("td",{children:[e.jsx("input",{type:"number",value:ee.discount_percentage||"",onChange:W=>Ae(oe,parseFloat(W.target.value)),min:"0",max:"100",className:"discount-input-table"}),"%"]}),e.jsx("td",{children:q.toFixed(2)})]},oe)})})]}):e.jsx("p",{children:"No tests in this order."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Pe.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Total Discount (",J.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ",de.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",Se.toFixed(2)]})})]}),E&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${S!=="upi"?"hide-on-screen":""}`,children:[e.jsx(cs,{value:E,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Pe.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Total Discount"}),e.jsxs("span",{children:["- ",de.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:J===0?"":J,onChange:ee=>Ne(parseFloat(ee.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:v||n.status==="billed"}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",Se.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:E?e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:E,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:S,onChange:ee=>_(ee.target.value),className:"payment-mode-select",disabled:v||n.status==="billed",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt to Patient)"})]})]}),S==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:" Debt to Patient"}),B?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:V&&V>0?"#dc3545":"#28a745"},children:["",(V||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ",Se.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["",((V||0)+Se).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bill-actions",children:[e.jsx("button",{onClick:Ce,className:"secondary-button print-preview-button no-print",disabled:v||h.length===0,children:"Print Preview"}),n.status!=="billed"&&e.jsx("button",{onClick:Ue,className:"primary-button",disabled:v||h.length===0,children:v?"Processing...":"Finalise and Bill"}),n.status==="billed"&&n.bill_id&&e.jsx("button",{onClick:()=>t("/billing",{state:{billId:n.bill_id}}),className:"secondary-button",children:"View Bill"})]})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for your business!"}),e.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})]}):e.jsx("div",{className:"error-message-box",children:"No order data available."})},g8=500,x8=()=>{const t=ft(),{queueId:a}=Fn(),[n]=v1(),i=n.get("doctorId"),[l,c]=x.useState(null),[o,d]=x.useState(null),[h,m]=x.useState(null),[f,g]=x.useState(null),[y,b]=x.useState([]),[v,w]=x.useState(!0),[S,_]=x.useState(null),[E,D]=x.useState(!1),[O,M]=x.useState(!1),[A,P]=x.useState(null),[Q,G]=x.useState("cash"),[C,R]=x.useState(""),[z,F]=x.useState(""),[J,H]=x.useState(""),[I,V]=x.useState(""),[re,B]=x.useState(""),[k,Ne]=x.useState(0),[Ae,T]=x.useState(null),[Ce,Ue]=x.useState(!1);x.useEffect(()=>{(async()=>{if(!a){_("No queue ID provided."),w(!1);return}try{w(!0),_(null);const[W,Y]=await Promise.all([Z(`/api/queue/${a}`),Z("/api/clinics/settings").catch(()=>({ok:!1}))]);if(!W.ok)throw new Error("Failed to fetch queue entry");const ie=await W.json();if(c(ie),Y.ok&&"json"in Y){const st=await Y.json();F(st.upi_id||""),H(st.name||""),V(st.address||""),B(st.notes||"")}const ce=i||ie.doctor_id,[pe,He]=await Promise.all([ie.patient_id?Z(`/api/patients/${ie.patient_id}`).catch(()=>({ok:!1})):Promise.resolve({ok:!1}),ce?Z(`/api/staff/${ce}`).catch(()=>({ok:!1})):Promise.resolve({ok:!1})]);if(pe.ok&&"json"in pe){const st=await pe.json();d(st)}let We=g8;if(ce&&(g(ce),He.ok&&"json"in He)){const st=await He.json();m(st),st.opd_fee!=null&&!isNaN(parseFloat(String(st.opd_fee)))&&(We=parseFloat(String(st.opd_fee)))}b([{name:"Consultation Fee",quantity:1,price:We,total:We,discount_percentage:0}])}catch(W){console.error("Failed to fetch data:",W),_(W.message||"Failed to load billing details.")}finally{w(!1)}})()},[a,i]);const Pe=x.useMemo(()=>y.reduce((q,W)=>q+W.total,0),[y]),de=x.useMemo(()=>Pe*(k/100),[Pe,k]),Se=x.useMemo(()=>Pe-de,[Pe,de]);x.useEffect(()=>{if(Se>0&&z){const q=`upi://pay?pa=${z}&pn=${encodeURIComponent(J)}&am=${Se.toFixed(2)}&cu=INR`;R(q)}else R("")},[Se,z,J]),x.useEffect(()=>{(async()=>{if(Q==="credit"&&(o!=null&&o.id)){Ue(!0);try{const W=await Z(`/api/patient-debts/${o.id}/balance`);if(W.ok){const Y=await W.json();T(Y.netDebt||0)}else T(0)}catch(W){console.error("Error fetching patient debt:",W),T(0)}finally{Ue(!1)}}})()},[Q,o==null?void 0:o.id]);const ee=q=>{const W=Math.max(0,Math.min(100,isNaN(q)?0:q));Ne(W)},oe=async()=>{if(!l||!o)return _("Missing queue or patient data."),null;if(y.length===0)return _("Cannot create an empty bill."),null;D(!0),_(null);try{const q=y.map(ce=>({name:ce.name,quantity:ce.quantity,price:ce.price,total:ce.total*(1-k/100)})),W={patientId:o.id,queueId:l.id,items:q,amount:Se,paymentMode:Q,type:"consultation",related_id:l.id,status:"paid",discountPercentage:k},Y=await Z("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(W)}),ie=await Y.json();if(!Y.ok||!ie.id)throw new Error(ie.message||"Failed to create bill.");if(Q==="credit")try{await Z(`/api/patient-debts/${o.id}/debts`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:new Date().toISOString().split("T")[0],debt_value:Se,related_bill_id:ie.id,notes:`Consultation Bill #${ie.id}`})})}catch(ce){console.error("Failed to create debt entry:",ce)}if(f&&l.id)try{const ce={status:"waiting",doctorId:f},pe=await Z(`/api/queue/${l.id}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(ce)});if(pe.ok)console.log(`Doctor ${f} assigned to queue ${l.id} after billing.`);else{const He=await pe.json();console.error("Failed to assign doctor to queue:",He.message)}}catch(ce){console.error("Error assigning doctor to queue:",ce)}return M(!0),P(ie.id),alert(`Bill created successfully (ID: ${ie.id})`),ie.id}catch(q){return console.error("Billing process failed:",q),_(q.message||"Failed to create bill. Please try again."),null}finally{D(!1)}},fe=()=>{window.print()},ge=async()=>{await oe()&&(window.print(),t(-1))};return v?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container",children:[e.jsxs("div",{className:"billing-header no-print",children:[e.jsx("div",{className:"back-button",children:e.jsx(U,{width:80,height:32})}),e.jsx("h1",{children:e.jsx(U,{width:200,height:32})})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("div",{className:"order-details-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsx(U,{width:200,height:20}),e.jsx(U,{width:150,height:20}),e.jsx(U,{width:180,height:20}),e.jsx(U,{width:150,height:20})]})]}),e.jsxs("div",{className:"medications-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:100,height:24})})}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40})]})]})]}),e.jsx("aside",{className:"billing-sidebar",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:e.jsx(U,{width:150,height:24})})}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:100,height:20}),e.jsx(U,{width:80,height:20})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx(U,{width:120,height:24}),e.jsx(U,{width:100,height:24})]}),e.jsx(U,{width:"100%",height:150})," ",e.jsx(U,{width:"100%",height:40}),e.jsx(U,{width:"100%",height:40})]})]})})]})]})}):S?e.jsxs("div",{className:"error-message-box",children:["Error: ",S]}):l?e.jsx("div",{className:"pharmacy-billing-page",children:e.jsxs("div",{className:"billing-container printable-section",children:[e.jsxs("div",{className:"billing-header print-only",children:[e.jsx("div",{className:"clinic-header-left",children:e.jsx("div",{className:"clinic-info-print",children:e.jsxs("div",{className:"clinic-name-and-details-print",children:[e.jsx("h1",{className:"bill-title",children:"TAX INVOICE"}),e.jsx("h2",{className:"clinic-name-print",children:J||"Clinic Bill"}),(I||re)&&e.jsxs("div",{className:"clinic-details-print",children:[I&&e.jsx("span",{className:"small-text clinic-address",children:I}),re&&e.jsx("span",{className:"small-text clinic-notes",children:re})]})]})})}),e.jsxs("div",{className:"patient-info-grid print-only-patient-details",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",(o==null?void 0:o.name)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",l.token_no]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Date"]})," ",new Date().toLocaleDateString()]})]})]}),e.jsxs("header",{className:"billing-header no-print",children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",children:[e.jsx(Et,{size:20}),e.jsx("span",{children:"Back"})]}),e.jsx("h1",{children:"Consultation Bill"})]}),e.jsxs("div",{className:"billing-layout",children:[e.jsxs("main",{className:"order-content",children:[e.jsxs("section",{className:"order-details-card no-print",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Patient Information"})}),e.jsxs("div",{className:"patient-info-grid",children:[e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Rn,{size:16})," Patient Name"]})," ",(o==null?void 0:o.name)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Token"]})," ",l.token_no]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(Ns,{size:16})," Patient ID"]})," ",(o==null?void 0:o.id)||"N/A"]}),e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(pa,{size:16})," Date"]})," ",new Date().toLocaleDateString()]}),h&&e.jsxs("div",{className:"info-item",children:[e.jsxs("strong",{children:[e.jsx(ix,{size:16})," Doctor"]})," ",h.name]}),l.complaint&&e.jsxs("div",{className:"info-item",children:[e.jsx("strong",{children:"Complaint"})," ",l.complaint]})]})]}),e.jsxs("section",{className:"medications-card",children:[e.jsx("div",{className:"card-header no-print",children:e.jsx("h2",{children:"Bill Items"})}),y.length>0?e.jsxs("table",{className:"medications-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No."}),e.jsx("th",{children:"DESCRIPTION"}),e.jsx("th",{children:"QTY"}),e.jsx("th",{children:"RATE"}),e.jsx("th",{children:"AMT"})]})}),e.jsx("tbody",{children:y.map((q,W)=>{const Y=q.total*(k/100),ie=q.total-Y;return e.jsxs("tr",{children:[e.jsx("td",{children:W+1}),e.jsx("td",{children:q.name}),e.jsx("td",{children:q.quantity}),e.jsxs("td",{children:["",q.price.toFixed(2)]}),e.jsxs("td",{children:["",ie.toFixed(2)]})]},W)})})]}):e.jsx("p",{children:"No items in this bill."})]}),e.jsxs("div",{className:"bill-summary-print print-only",children:[e.jsxs("div",{className:"bill-summary-details",children:[e.jsxs("div",{className:"summary-row-print",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Pe.toFixed(2)]})]}),k>0&&e.jsxs("div",{className:"summary-row-print",children:[e.jsxs("span",{children:["Discount (",k.toFixed(2),"%)"]}),e.jsxs("span",{children:["- ",de.toFixed(2)]})]}),e.jsx("div",{className:"print-only-total",children:e.jsxs("strong",{children:["Grand Total: ",Se.toFixed(2)]})})]}),C&&e.jsxs("div",{className:`qr-code-container qr-code-printable-section ${Q!=="upi"?"hide-on-screen":""}`,children:[e.jsx(cs,{value:C,size:100}),e.jsx("p",{className:"print-only-upi-text",children:"Scan to pay using UPI"})]})]})]}),e.jsx("aside",{className:"billing-sidebar no-print",children:e.jsxs("div",{className:"billing-summary-card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{children:"Billing Summary"})}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Subtotal"}),e.jsxs("span",{children:["",Pe.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["- ",de.toFixed(2)]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsx("span",{children:"Discount Percentage"}),e.jsxs("div",{className:"discount-input-wrapper",children:[e.jsx("input",{type:"number",value:k===0?"":k,onChange:q=>ee(parseFloat(q.target.value)),min:"0",max:"100",className:"discount-input-total",disabled:E||O}),"%"]})]}),e.jsxs("div",{className:"summary-row grand-total-row",children:[e.jsx("strong",{children:"Grand Total"}),e.jsxs("strong",{children:["",Se.toFixed(2)]})]}),e.jsx("div",{className:"qr-code-container",children:C?e.jsxs(e.Fragment,{children:[e.jsx(cs,{value:C,size:128}),e.jsx("p",{children:"Scan to pay using UPI"})]}):e.jsx("p",{children:"UPI QR code not available. Please ensure UPI ID is configured."})}),e.jsxs("div",{className:"payment-mode-section",children:[e.jsx("label",{htmlFor:"paymentMode",className:"info-item",children:e.jsx("strong",{children:"Payment Mode"})}),e.jsxs("select",{id:"paymentMode",value:Q,onChange:q=>G(q.target.value),className:"payment-mode-select",disabled:E||O,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"}),e.jsx("option",{value:"credit",children:"Credit (Debt to Patient)"})]})]}),Q==="credit"&&e.jsxs("div",{className:"debt-info-section",style:{marginTop:"10px",padding:"12px",backgroundColor:"rgba(220, 53, 69, 0.1)",borderRadius:"8px",border:"1px solid rgba(220, 53, 69, 0.3)"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#dc3545",marginBottom:"8px"},children:" Debt to Patient"}),Ce?e.jsx("div",{style:{fontSize:"0.9em",color:"#666"},children:"Loading debt info..."}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"Current Debt:"}),e.jsxs("strong",{style:{color:Ae&&Ae>0?"#dc3545":"#28a745"},children:["",(Ae||0).toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{children:"This Bill:"}),e.jsxs("strong",{children:["+ ",Se.toFixed(2)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid rgba(220, 53, 69, 0.3)",paddingTop:"8px",marginTop:"8px"},children:[e.jsx("span",{children:e.jsx("strong",{children:"New Total Debt:"})}),e.jsxs("strong",{style:{color:"#dc3545"},children:["",((Ae||0)+Se).toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bill-actions",children:[!O&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:fe,className:"secondary-button print-preview-button no-print",disabled:E||y.length===0,children:"Print Preview"}),e.jsx("button",{onClick:ge,className:"primary-button",disabled:E||y.length===0,children:E?"Processing...":"Finalise and Bill"})]}),O&&A&&e.jsx("button",{onClick:()=>t(`/dashboard/bills/${A}`),className:"secondary-button",children:"View Bill"})]})]})})]}),e.jsxs("footer",{className:"billing-footer print-only",children:[e.jsx("p",{children:"Thank you for your visit!"}),e.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})}):e.jsx("div",{className:"error-message-box",children:"No queue data available."})},y8=()=>{const t=ft(),[a,n]=x.useState(!0),[i,l]=x.useState([]),[c,o]=x.useState(""),[d,h]=x.useState(!0),[m,f]=x.useState(!1),[g,y]=x.useState({admissionCharge:"0.00",perDayCharge:"0.00",otherCharges:"0.00",aiMemory:"",clinicWideSystemPrompt:"",gemini_api_key:"",low_stock_threshold:"10",name:"",logoUrl:"",labLetterheadUrl:"",upi_id:"",address:"",notes:"",voice_ai_language:"en-US"}),[b,v]=x.useState(null),[w,S]=x.useState(!1),_=(C,R)=>{v({type:C,message:R}),setTimeout(()=>v(null),3e3)},E=C=>{switch(C){case"doctor":return e.jsx(ix,{size:14,className:"text-blue-600"});case"receptionist":return e.jsx(ax,{size:14,className:"text-green-600"});case"pharmacy":return e.jsx(kr,{size:14,className:"text-purple-600"});case"lab":return e.jsx(Cs,{size:14,className:"text-yellow-600"});default:return e.jsx(vl,{size:14,className:"text-gray-500"})}},D=C=>{switch(C){case"doctor":return"avatar-blue";case"receptionist":return"avatar-green";case"pharmacy":return"avatar-purple";case"lab":return"avatar-yellow";default:return"avatar-gray"}},O=x.useCallback(async()=>{n(!0);try{const C=await Z("/staff");if(C.ok){const R=await C.json();l(R.map(z=>({...z,id:z._id||z.id})))}}catch(C){console.error("Error fetching staff:",C),_("error","Failed to load staff list")}finally{n(!1)}},[]),M=x.useCallback(async()=>{h(!0);try{const C=await Z("/api/clinics/settings");if(C.ok){const R=await C.json();y({admissionCharge:parseFloat(R.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(R.perDayCharge||0).toFixed(2),otherCharges:parseFloat(R.otherCharges||0).toFixed(2),aiMemory:R.aiMemory||"",clinicWideSystemPrompt:R.clinicWideSystemPrompt||"",gemini_api_key:R.gemini_api_key||"",low_stock_threshold:R.low_stock_threshold!==void 0&&R.low_stock_threshold!==null?String(R.low_stock_threshold):"10",name:R.name||"",logoUrl:R.logoUrl||"",labLetterheadUrl:R.labLetterheadUrl||"",upi_id:R.upi_id||"",address:R.address||"",notes:R.notes||"",clinic_id:R.clinic_id,voice_ai_language:R.voice_ai_language||"en-US"})}}catch(C){console.error("Error fetching settings:",C),_("error","Failed to load settings")}finally{h(!1)}},[]);x.useEffect(()=>{O(),M()},[O,M]);const A=C=>{const{name:R,value:z}=C.target;y(F=>({...F,[R]:z}))},P=async()=>{f(!0);try{const C=parseFloat(g.admissionCharge),R=parseFloat(g.perDayCharge),z=parseFloat(g.otherCharges),F=parseInt(g.low_stock_threshold);if((await Z("/api/clinics/settings",{method:"PUT",body:JSON.stringify({name:g.name,admissionCharge:C,perDayCharge:R,otherCharges:z,aiMemory:g.aiMemory,clinicWideSystemPrompt:g.clinicWideSystemPrompt,gemini_api_key:g.gemini_api_key,low_stock_threshold:F,logoUrl:g.logoUrl,labLetterheadUrl:g.labLetterheadUrl,upi_id:g.upi_id,address:g.address,notes:g.notes,voice_ai_language:g.voice_ai_language})})).ok)_("success","Changes saved successfully");else throw new Error("Failed to save")}catch(C){console.error("Error saving settings:",C),_("error","Failed to save settings")}finally{f(!1)}},Q=i.filter(C=>C.name.toLowerCase().includes(c.toLowerCase())||C.role.toLowerCase().includes(c.toLowerCase())),G=async C=>{for(const R of C){const z=document.getElementById(R);z&&(z.scrollIntoView({behavior:"smooth",block:"center"}),z.classList.add("ai-feedback-glow"),await new Promise(F=>setTimeout(F,1500)),z.classList.remove("ai-feedback-glow"))}};return e.jsxs("div",{className:"clinic-hub-container",children:[e.jsxs("header",{className:"clinic-hub-header",children:[e.jsxs("div",{className:"clinic-hub-title",children:[e.jsx("h1",{children:"Clinic Hub"}),e.jsx("p",{className:"clinic-hub-subtitle",children:"Manage your ecosystem"})]}),e.jsxs("div",{className:"clinic-hub-actions",children:[b&&e.jsx("div",{className:`px-4 py-2 rounded-md text-sm font-medium ${b.type==="success"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:b.message}),e.jsxs("button",{className:"btn-add-staff",onClick:()=>t("/dashboard/staff/add"),children:[e.jsx(bn,{size:16})," Add Staff"]}),e.jsxs("button",{className:"btn-save-changes",onClick:P,disabled:m,children:[e.jsx(ks,{size:16})," ",m?"Saving...":"Save Changes"]})]})]}),e.jsxs("main",{className:"clinic-hub-content",children:[e.jsxs("div",{className:"team-directory-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(Vo,{size:18,className:"text-gray-500"}),e.jsxs("span",{className:"panel-title",children:["Team Directory (",i.length,")"]})]}),e.jsx("div",{className:"search-container",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(fn,{size:16,className:"search-icon"}),e.jsx("input",{type:"text",placeholder:"Find member...",className:"search-input",value:c,onChange:C=>o(C.target.value)})]})}),e.jsx("div",{className:"team-list",children:a?e.jsx("div",{className:"p-4 space-y-4",children:[1,2,3,4].map(C=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{variant:"circular",width:40,height:40}),e.jsxs("div",{className:"flex-1",children:[e.jsx(U,{width:120,height:16,className:"mb-1"}),e.jsx(U,{width:80,height:12})]})]},C))}):Q.length===0?e.jsx("div",{className:"empty-state",children:"No staff found."}):Q.map(C=>e.jsxs("div",{id:`staff-member-${C.id}`,className:"team-member-item",children:[e.jsx("div",{className:`member-avatar ${D(C.role)}`,children:C.name.charAt(0).toUpperCase()}),e.jsxs("div",{className:"member-info",children:[e.jsx("div",{className:"member-name",children:C.name}),e.jsxs("div",{className:"member-role",children:[E(C.role),C.role]})]}),e.jsx("span",{className:`member-status ${C.active?"status-active":"status-inactive"}`,children:C.active?"Active":"Inactive"}),e.jsx("button",{className:"btn-edit-member",onClick:()=>t(`/dashboard/staff/edit/${C.id}`),children:e.jsx(ma,{size:16})})]},C.id))})]}),e.jsxs("div",{className:"config-console-panel",children:[e.jsxs("div",{className:"panel-header",children:[e.jsx(_1,{size:18,className:"text-gray-500"}),e.jsx("span",{className:"panel-title",children:"Configuration Console"})]}),d?e.jsxs("div",{className:"p-6 space-y-8",children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(U,{variant:"circular",width:24,height:24}),e.jsx(U,{width:200,height:20})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:80,style:{borderRadius:"8px"}})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(U,{variant:"circular",width:24,height:24}),e.jsx(U,{width:200,height:20})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx(U,{width:120,height:14,style:{marginBottom:"8px"}}),e.jsx(U,{width:"100%",height:40,style:{borderRadius:"8px"}})]})]})]})]}):e.jsxs("div",{className:"config-content",children:[e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(D1,{size:16})," CLINIC IDENTITY & LOCATION"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Clinic Name"}),e.jsx("input",{type:"text",className:"form-input",name:"name",id:"setting-name",value:g.name,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Logo URL"}),e.jsx("input",{type:"url",className:"form-input",placeholder:"https://",name:"logoUrl",id:"setting-logoUrl",value:g.logoUrl,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Lab Letterhead URL"}),e.jsx("input",{type:"url",className:"form-input",placeholder:"https://",name:"labLetterheadUrl",id:"setting-labLetterheadUrl",value:g.labLetterheadUrl,onChange:A})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("textarea",{className:"form-textarea",placeholder:"Full physical address",name:"address",id:"setting-address",value:g.address,onChange:A})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(Cr,{size:16})," FINANCIAL OPERATIONS"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Admission Charge ()"}),e.jsx("input",{type:"number",className:"form-input",name:"admissionCharge",id:"setting-admissionCharge",value:g.admissionCharge,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Per Day Charge ()"}),e.jsx("input",{type:"number",className:"form-input",name:"perDayCharge",id:"setting-perDayCharge",value:g.perDayCharge,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Other Charges ()"}),e.jsx("input",{type:"number",className:"form-input",name:"otherCharges",id:"setting-otherCharges",value:g.otherCharges,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"UPI ID"}),e.jsx("input",{type:"text",className:"form-input",name:"upi_id",id:"setting-upi_id",value:g.upi_id,onChange:A})]})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx(E1,{size:16})," INVENTORY & AI"]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Low Stock Threshold"}),e.jsx("input",{type:"number",className:"form-input",name:"low_stock_threshold",id:"setting-low_stock_threshold",value:g.low_stock_threshold,onChange:A})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Voice AI Language"}),e.jsxs("select",{className:"form-input",name:"voice_ai_language",id:"setting-voice_ai_language",value:g.voice_ai_language,onChange:C=>y(R=>({...R,voice_ai_language:C.target.value})),children:[e.jsx("option",{value:"en-US",children:"English"}),e.jsx("option",{value:"hi-IN",children:"Hindi"}),e.jsx("option",{value:"te-IN",children:"Telugu"}),e.jsx("option",{value:"bn-IN",children:"Bengali"}),e.jsx("option",{value:"mr-IN",children:"Marathi"}),e.jsx("option",{value:"ta-IN",children:"Tamil"}),e.jsx("option",{value:"gu-IN",children:"Gujarati"}),e.jsx("option",{value:"kn-IN",children:"Kannada"}),e.jsx("option",{value:"ml-IN",children:"Malayalam"}),e.jsx("option",{value:"pa-IN",children:"Punjabi"}),e.jsx("option",{value:"es-ES",children:"Spanish"}),e.jsx("option",{value:"fr-FR",children:"French"}),e.jsx("option",{value:"de-DE",children:"German"}),e.jsx("option",{value:"it-IT",children:"Italian"}),e.jsx("option",{value:"pt-PT",children:"Portuguese"}),e.jsx("option",{value:"ru-RU",children:"Russian"}),e.jsx("option",{value:"ja-JP",children:"Japanese"}),e.jsx("option",{value:"ko-KR",children:"Korean"}),e.jsx("option",{value:"zh-CN",children:"Chinese (Simplified)"}),e.jsx("option",{value:"ar-SA",children:"Arabic"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"form-label",children:"Gemini API Key"}),e.jsx("input",{type:"password",className:"form-input",name:"gemini_api_key",id:"setting-gemini_api_key",value:g.gemini_api_key,onChange:A,placeholder:"******************"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"Clinic-Wide System Prompt"}),e.jsx("textarea",{className:"form-textarea",name:"clinicWideSystemPrompt",id:"setting-clinicWideSystemPrompt",value:g.clinicWideSystemPrompt,onChange:A,placeholder:"Instructions for the AI..."})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{className:"form-label",children:"AI Memory (Context)"}),e.jsx("textarea",{className:"form-textarea",name:"aiMemory",id:"setting-aiMemory",value:g.aiMemory,onChange:A,placeholder:"Shared context for the AI..."})]})]})]})]})]})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex justify-end",children:e.jsx("div",{className:"w-96 bg-white h-full shadow-2xl animate-slide-in-right",children:e.jsx(sw,{onClose:()=>S(!1),settings:g,staffList:i,onSettingsUpdate:M,onStaffUpdate:O,onHighlight:G})})})]})},b8="_container_13uqm_121",j8="_header_13uqm_141",v8="_title_13uqm_187",N8="_controls_13uqm_203",w8="_dateInputGroup_13uqm_231",S8="_dateInputLabel_13uqm_255",k8="_dateInput_13uqm_231",C8="_section_13uqm_297",_8="_sectionTitle_13uqm_325",D8="_statsGrid_13uqm_351",E8="_statCard_13uqm_365",T8="_statTitle_13uqm_397",A8="_statValue_13uqm_415",P8="_statSubtitle_13uqm_431",R8="_revenueGrid_13uqm_443",O8="_revenueCard_13uqm_469",I8="_revenueCardTitle_13uqm_485",z8="_revenueCardList_13uqm_505",F8="_revenueCardListItem_13uqm_517",L8="_tableContainer_13uqm_557",$8="_table_13uqm_557",M8="_textRight_13uqm_639",B8="_textGreen_13uqm_647",U8="_textRed_13uqm_655",q8="_loadingContainer_13uqm_673",H8="_errorAlert_13uqm_693",V8="_backButton_13uqm_759",G8="_chartsGrid_13uqm_797",Q8="_chartCard_13uqm_823",Y8="_chartWrapper_13uqm_873",et={container:b8,header:j8,title:v8,controls:N8,dateInputGroup:w8,dateInputLabel:S8,dateInput:k8,section:C8,sectionTitle:_8,statsGrid:D8,statCard:E8,statTitle:T8,statValue:A8,statSubtitle:P8,revenueGrid:R8,revenueCard:O8,revenueCardTitle:I8,revenueCardList:z8,revenueCardListItem:F8,tableContainer:L8,table:$8,textRight:M8,textGreen:B8,textRed:U8,loadingContainer:q8,errorAlert:H8,backButton:V8,chartsGrid:G8,chartCard:Q8,chartWrapper:Y8},c1=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"],ig=({active:t,payload:a,label:n})=>t&&a&&a.length?e.jsxs("div",{className:"bg-white p-3 border border-gray-200 rounded-lg shadow-lg",children:[e.jsx("p",{className:"font-semibold text-gray-800",children:n}),a.map((i,l)=>e.jsxs("p",{style:{color:i.color},className:"text-sm",children:[i.name,": ",new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(i.value)]},l))]}):null,J8=()=>{const t=ft(),a=Qa(),n=new URLSearchParams(a.search),i=n.get("startDate"),l=n.get("endDate"),c=new Date().toISOString().split("T")[0],[o,d]=x.useState(i||c),[h,m]=x.useState(l||c),[f,g]=x.useState(!1),[y,b]=x.useState(null),{setAnalysisDateRange:v,analysisDateRange:w,setAnalysisData:S,registerAnalysisNavigator:_,registerAnalysisRefresher:E}=sm(),[D,O]=x.useState(0),[M,A]=x.useState(0),[P,Q]=x.useState(0),[G,C]=x.useState(null),[R,z]=x.useState(null),[F,J]=x.useState(null),[H,I]=x.useState({reception:{},pharmacy:{},lab:{}}),[V,re]=x.useState(0),[B,k]=x.useState(null),[Ne,Ae]=x.useState([]),[T,Ce]=x.useState(null),Ue=x.useCallback(async(ee,oe)=>{g(!0),b(null);const fe=ee||o,ge=oe||h;if(O(0),A(0),Q(0),C(null),z(null),J(null),I({reception:{},pharmacy:{},lab:{}}),Ce(null),Ce(null),re(0),k(null),Ae([]),!fe||!ge){b("Please select both start and end dates."),g(!1);return}try{const q=M_(),[W,Y,ie,ce,pe,He]=await Promise.all([Z(`/api/bills?startDate=${o}&endDate=${h}`),Z(`/api/payment/admission?startDate=${o}&endDate=${h}`),Z(`/api/subscriptions/transactions/manual?startDate=${o}&endDate=${h}`),Z(`/api/patient-debts/collections/analysis?startDate=${o}&endDate=${h}`),q?Z(`/api/inventory/comprehensive-analysis?startDate=${o}&endDate=${h}&clinicId=${q}`):Promise.resolve(null),Z(`/api/distributors/payments/analysis?startDate=${o}&endDate=${h}`)]);if(W.ok&&Y.ok&&ie.ok){const We=await W.json(),st=await Y.json(),me=await ie.json(),ve=We.bills||[],Fe=st.admissionPayments||[],Ee=me||[];let L={totalRevenue:0,totalCashCollected:0,revenueByType:{consultation:0,pharmacy:0,lab:0,other:0},cashByMode:{},revenueByMode:{},detailedRevenue:{reception:{},pharmacy:{},lab:{}},dailyRevenue:new Map,pharmacyReturns:0};const ne=(we,Le)=>{const Je=we.split("T")[0];L.dailyRevenue.set(Je,(L.dailyRevenue.get(Je)||0)+Le)},xe=(we,Le,Je,ot,xt=!0)=>{const be=Le.toLowerCase()==="credit";xt&&(L.totalRevenue+=we,L.revenueByType.hasOwnProperty(Je)?L.revenueByType[Je]+=we:L.revenueByType.other=(L.revenueByType.other||0)+we,ne(ot,we),L.revenueByMode[Le]=(L.revenueByMode[Le]||0)+we),be||(L.totalCashCollected+=we,L.cashByMode[Le]=(L.cashByMode[Le]||0)+we),xt&&(Je==="pharmacy"?L.detailedRevenue.pharmacy[Le]=(L.detailedRevenue.pharmacy[Le]||0)+we:Je==="lab"?L.detailedRevenue.lab[Le]=(L.detailedRevenue.lab[Le]||0)+we:Je!=="debt"&&(L.detailedRevenue.reception[Le]=(L.detailedRevenue.reception[Le]||0)+we)),Je==="debt"&&(L.detailedRevenue.debt=L.detailedRevenue.debt||{},L.detailedRevenue.debt[Le]=(L.detailedRevenue.debt[Le]||0)+we)};if(ve.forEach(we=>{if(we.status==="paid"||we.type==="pharmacy_return"){let Le=parseFloat(we.amount.toString()),Je=we.type||"other";const ot=we.payment_mode||"Unknown";Je==="pharmacy_return"&&(L.pharmacyReturns+=Le,Je="pharmacy"),xe(Le,ot,Je,we.createdAt,!0)}}),Fe.forEach(we=>{xe(parseFloat(we.amount_paid.toString()),we.payment_mode||"Unknown","consultation",we.payment_date,!0)}),Ee.forEach(we=>{var ot,xt;const Le=parseFloat(((xt=(ot=we.subscriptionPlan)==null?void 0:ot.price)==null?void 0:xt.toString())??"0"),Je=we.subscription_payment_method||"manual";xe(Le,Je,"consultation",we.subscription_start_date,!0)}),ce.ok){const Le=(await ce.json()).paymentModeBreakdown||{};Object.entries(Le).forEach(([Je,ot])=>{const xt=Number(ot);xe(xt,Je,"debt","",!1)})}if(A(L.totalCashCollected),O(L.totalRevenue),Q(L.pharmacyReturns),C(L.cashByMode),z(L.revenueByMode),J(L.revenueByType),I(L.detailedRevenue),He&&He.ok){const we=await He.json();re(we.totalPaid||0),k(we.paymentModeBreakdown||{})}const ae=Array.from(L.dailyRevenue.entries()).sort((we,Le)=>new Date(we[0]).getTime()-new Date(Le[0]).getTime()).map(([we,Le])=>({date:we,amount:Le}));Ae(ae)}if(pe&&pe.ok){const We=await pe.json();Ce(We)}}catch(q){console.error("Analysis Fetch Error:",q),b("Failed to fetch analysis data. Please try again.")}finally{g(!1)}},[o,h]);x.useEffect(()=>{_(ee=>{const oe=`analysis-${ee}`,fe=document.getElementById(oe);fe&&(fe.scrollIntoView({behavior:"smooth",block:"center"}),fe.classList.add("ai-highlight-glow"),setTimeout(()=>fe.classList.remove("ai-highlight-glow"),2e3))})},[_]),x.useEffect(()=>{E(async()=>(await Ue(),null))},[E,Ue]),x.useEffect(()=>{if(w.startDate&&w.endDate){const ee=w.startDate.toISOString().split("T")[0],oe=w.endDate.toISOString().split("T")[0];(ee!==o||oe!==h)&&(d(ee),m(oe))}},[w]),x.useEffect(()=>{const ee=new URLSearchParams(a.search),oe=ee.get("section"),fe=ee.get("startDate"),ge=ee.get("endDate");if(fe&&ge){d(fe),m(ge);const q=w.startDate?w.startDate.toISOString().split("T")[0]:null,W=w.endDate?w.endDate.toISOString().split("T")[0]:null;(q!==fe||W!==ge)&&v({startDate:new Date(fe),endDate:new Date(ge)})}if(oe){const q=`analysis-${oe}`;setTimeout(()=>{const W=document.getElementById(q);W&&(W.scrollIntoView({behavior:"smooth",block:"center"}),W.classList.add("ai-highlight-glow"),setTimeout(()=>W.classList.remove("ai-highlight-glow"),2e3))},500)}},[a.search]),x.useEffect(()=>{Ue()},[o,h,Ue]),x.useEffect(()=>{!f&&(M>0||T)&&S({totalRevenue:D,totalCashFlow:M,totalExpenses:V,netCashFlow:M-V,collectionsBreakdown:G,revenueBreakdown:R,inventoryValue:0,pharmacyRevenue:(F==null?void 0:F.pharmacy)||0,labRevenue:(F==null?void 0:F.lab)||0,receptionRevenue:((F==null?void 0:F.consultation)||0)+((F==null?void 0:F.other)||0),inventorySummary:T?{totalItemsAnalyzed:T.pharmacyAnalysis.length,netPositiveItems:T.pharmacyAnalysis.filter(ee=>ee.net_change>0).length}:null})},[D,M,V,G,R,T,F,f,S]);const Pe=ee=>new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(ee),de=x.useMemo(()=>R?Object.entries(R).map(([ee,oe])=>({name:ee,value:oe})):[],[R]),Se=x.useMemo(()=>F?[{name:"Consultation",value:F.consultation},{name:"Pharmacy",value:F.pharmacy},{name:"Lab",value:F.lab},{name:"Debt Collections",value:F.debt||0},{name:"Other",value:F.other||0}].filter(ee=>ee.value>0):[],[F]);return e.jsxs("div",{className:et.container,children:[e.jsxs("div",{className:et.header,children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>t(-1),className:et.backButton,title:"Go Back",children:[e.jsx(Et,{size:20})," Back"]}),e.jsx("h1",{className:et.title,children:"Analysis Dashboard"})]}),e.jsxs("div",{className:et.controls,children:[e.jsxs("div",{className:et.dateInputGroup,children:[e.jsx("label",{className:et.dateInputLabel,children:"From:"}),e.jsx("input",{type:"date",className:et.dateInput,value:o,onChange:ee=>{d(ee.target.value),h&&v({startDate:new Date(ee.target.value),endDate:new Date(h)})}})]}),e.jsxs("div",{className:et.dateInputGroup,children:[e.jsx("label",{className:et.dateInputLabel,children:"To:"}),e.jsx("input",{type:"date",className:et.dateInput,value:h,onChange:ee=>{m(ee.target.value),o&&v({startDate:new Date(o),endDate:new Date(ee.target.value)})}})]})]})]}),y&&e.jsxs("div",{className:et.errorAlert,children:[e.jsx(Nn,{size:20}),e.jsx("span",{children:y})]}),!f&&e.jsxs("div",{children:[e.jsxs("section",{className:et.section,id:"analysis-expenses",children:[e.jsxs("div",{className:et.sectionTitle,children:[e.jsx(R1,{style:{color:"var(--accent-primary)"},size:24}),e.jsx("h2",{children:"Cash Flow Analysis"})]}),e.jsxs("div",{className:et.statsGrid,children:[e.jsxs("div",{className:et.statCard,children:[e.jsx("div",{className:et.statTitle,children:"Total Cash Inflow"}),e.jsx("div",{className:et.statValue,style:{color:"var(--accent-success)"},children:Pe(M)}),e.jsx("div",{className:et.statSubtitle,children:"Collections (Cash, UPI, etc.)"})]}),e.jsxs("div",{className:et.statCard,children:[e.jsx("div",{className:et.statTitle,children:"Total Expenses"}),e.jsx("div",{className:et.statValue,style:{color:"var(--accent-danger)"},children:Pe(V)}),e.jsx("div",{className:et.statSubtitle,children:"Distributor Payments"})]}),e.jsxs("div",{className:et.statCard,children:[e.jsx("div",{className:et.statTitle,children:"Net Cash Flow"}),e.jsx("div",{className:et.statValue,style:{color:M-V>=0?"var(--accent-success)":"var(--accent-danger)"},children:Pe(M-V)}),e.jsx("div",{className:et.statSubtitle,children:"Inflow - Outflow"})]})]}),e.jsxs("div",{className:et.revenueGrid,style:{marginTop:"1rem"},children:[G&&Object.keys(G).length>0&&e.jsxs("div",{className:et.revenueCard,children:[e.jsx("h3",{className:et.revenueCardTitle,children:"Collections Breakdown"}),e.jsx("ul",{className:et.revenueCardList,children:Object.entries(G).map(([ee,oe])=>e.jsxs("li",{className:et.revenueCardListItem,children:[e.jsx("span",{children:ee}),e.jsx("span",{children:Pe(oe)})]},ee))})]}),B&&Object.keys(B).length>0&&e.jsxs("div",{className:et.revenueCard,children:[e.jsx("h3",{className:et.revenueCardTitle,children:"Expense Breakdown"}),e.jsx("ul",{className:et.revenueCardList,children:Object.entries(B).map(([ee,oe])=>e.jsxs("li",{className:et.revenueCardListItem,children:[e.jsx("span",{children:ee}),e.jsx("span",{children:Pe(oe)})]},ee))})]})]})]}),e.jsxs("section",{className:et.section,id:"analysis-financial",children:[e.jsxs("div",{className:et.sectionTitle,children:[e.jsx(Cr,{style:{color:"var(--accent-primary)"},size:24}),e.jsx("h2",{children:"Financial Performance"})]}),e.jsx("div",{className:et.statsGrid,children:e.jsxs("div",{className:et.statCard,children:[e.jsx("div",{className:et.statTitle,children:"Total Revenue Generated"}),e.jsx("div",{className:et.statValue,style:{color:"var(--accent-primary)"},children:Pe(D)}),e.jsx("div",{className:et.statSubtitle,children:"Billings & Services (Accrual)"})]})}),e.jsxs("div",{className:et.chartsGrid,children:[e.jsxs("div",{className:et.chartCard,style:{gridColumn:"1 / -1"},children:[e.jsx("h3",{children:"Revenue Trend (Daily)"}),e.jsx("div",{className:et.chartWrapper,children:e.jsx(_h,{width:"100%",height:300,children:e.jsxs(HC,{data:Ne,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorRevenue",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--accent-primary)",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"var(--accent-primary)",stopOpacity:.05})]})}),e.jsx(zh,{strokeDasharray:"3 3",vertical:!1,stroke:"var(--border-subtle)"}),e.jsx(Fh,{dataKey:"date",tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Lh,{tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:!1,tickLine:!1,tickFormatter:ee=>`${ee/1e3}k`}),e.jsx(To,{content:e.jsx(ig,{})}),e.jsx(VC,{type:"monotone",dataKey:"amount",stroke:"var(--accent-primary)",fillOpacity:1,fill:"url(#colorRevenue)"})]})})})]}),e.jsxs("div",{className:et.chartCard,children:[e.jsx("h3",{children:"Payment Method Distribution"}),e.jsx("div",{className:et.chartWrapper,children:e.jsx(_h,{width:"100%",height:300,children:e.jsxs(z1,{children:[e.jsx(F1,{data:de,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:de.map((ee,oe)=>e.jsx(L1,{fill:c1[oe%c1.length]},`cell-${oe}`))}),e.jsx(To,{content:e.jsx(ig,{})}),e.jsx(mg,{verticalAlign:"bottom",height:36,formatter:ee=>e.jsx("span",{style:{color:"var(--text-primary)"},children:ee})})]})})})]}),e.jsxs("div",{className:et.chartCard,children:[e.jsx("h3",{children:"Revenue by Source"}),e.jsx("div",{className:et.chartWrapper,children:e.jsx(_h,{width:"100%",height:300,children:e.jsxs($1,{data:Se,children:[e.jsx(zh,{strokeDasharray:"3 3",vertical:!1,stroke:"var(--border-subtle)"}),e.jsx(Fh,{dataKey:"name",tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:!1,tickLine:!1}),e.jsx(Lh,{tick:{fill:"var(--text-secondary)",fontSize:12},axisLine:!1,tickLine:!1,tickFormatter:ee=>`${ee/1e3}k`}),e.jsx(To,{content:e.jsx(ig,{}),cursor:{fill:"var(--bg-primary)"}}),e.jsx(M1,{dataKey:"value",fill:"var(--accent-success)",radius:[4,4,0,0]})]})})})]})]}),H&&e.jsxs("div",{className:et.sectionTitle,style:{marginTop:"2rem"},children:[e.jsx(zC,{style:{color:"var(--text-secondary)"},size:20}),e.jsx("h3",{children:"Detailed Breakdown"})]}),H&&e.jsxs("div",{className:et.revenueGrid,children:[e.jsxs("div",{className:et.revenueCard,children:[e.jsx("h3",{className:et.revenueCardTitle,children:"Reception / Clinic"}),e.jsx("div",{className:et.statValue,style:{fontSize:"1.5rem",marginBottom:"1rem"},children:Pe(((F==null?void 0:F.consultation)||0)+((F==null?void 0:F.other)||0))}),e.jsx("ul",{className:et.revenueCardList,children:Object.entries(H.reception).map(([ee,oe])=>e.jsxs("li",{className:et.revenueCardListItem,children:[e.jsx("span",{children:ee}),e.jsx("span",{children:Pe(oe)})]},ee))})]}),e.jsxs("div",{className:et.revenueCard,children:[e.jsx("h3",{className:et.revenueCardTitle,children:"Pharmacy"}),e.jsx("div",{className:et.statValue,style:{fontSize:"1.5rem",marginBottom:"1rem"},children:Pe((F==null?void 0:F.pharmacy)||0)}),P<0&&e.jsxs("div",{className:`${et.textRed} text-sm mb-2`,children:["Returns: ",Pe(P)]}),e.jsx("ul",{className:et.revenueCardList,children:Object.entries(H.pharmacy).map(([ee,oe])=>e.jsxs("li",{className:et.revenueCardListItem,children:[e.jsx("span",{children:ee}),e.jsx("span",{children:Pe(oe)})]},ee))})]}),e.jsxs("div",{className:et.revenueCard,children:[e.jsx("h3",{className:et.revenueCardTitle,children:"Laboratory"}),e.jsx("div",{className:et.statValue,style:{fontSize:"1.5rem",marginBottom:"1rem"},children:Pe((F==null?void 0:F.lab)||0)}),e.jsx("ul",{className:et.revenueCardList,children:Object.entries(H.lab).map(([ee,oe])=>e.jsxs("li",{className:et.revenueCardListItem,children:[e.jsx("span",{children:ee}),e.jsx("span",{children:Pe(oe)})]},ee))})]})]})]}),e.jsxs("section",{className:et.section,id:"analysis-inventory",children:[e.jsxs("div",{className:et.sectionTitle,children:[e.jsx(xl,{style:{color:"var(--accent-success)"},size:24}),e.jsx("h2",{children:"Inventory Movement"})]}),T&&T.pharmacyAnalysis.length>0?e.jsx("div",{className:et.tableContainer,children:e.jsxs("table",{className:et.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Item Name"}),e.jsx("th",{children:"Stock In"}),e.jsx("th",{children:"Stock Out"}),e.jsx("th",{children:"Net Change"}),e.jsx("th",{className:et.textRight,children:"Est. Revenue"}),e.jsx("th",{className:et.textRight,children:"Est. Profit"})]})}),e.jsx("tbody",{children:T.pharmacyAnalysis.map(ee=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{style:{fontWeight:600},children:ee.name}),e.jsx("div",{style:{fontSize:"0.75rem",opacity:.7},children:ee.supplier})]}),e.jsxs("td",{className:et.textGreen,children:["+",ee.quantity_in,Object.entries(ee.quantity_in_by_reason).map(([oe,fe])=>e.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8},children:[oe,": ",fe]},oe))]}),e.jsxs("td",{className:et.textRed,children:["-",ee.quantity_out,Object.entries(ee.quantity_out_by_reason).map(([oe,fe])=>e.jsxs("div",{style:{fontSize:"0.75rem",opacity:.8},children:[oe,": ",fe]},oe))]}),e.jsx("td",{children:e.jsxs("span",{style:{fontWeight:600},className:ee.net_change>=0?et.textGreen:et.textRed,children:[ee.net_change>0?"+":"",ee.net_change]})}),e.jsx("td",{className:et.textRight,children:Pe(ee.revenue)}),e.jsx("td",{className:`${et.textRight} ${ee.profit>=0?et.textGreen:et.textRed}`,children:Pe(ee.profit)})]},ee.drug_id))})]})}):e.jsx("div",{className:"text-center py-8 opacity-50 mb-4 bg-transparent rounded-lg border border-dashed border-gray-300",children:"No inventory movement recorded for this period."})]})]}),f&&e.jsxs("div",{className:et.loadingContainer,style:{display:"block"},children:[e.jsxs("div",{className:et.sectionTitle,children:[e.jsx(U,{variant:"circular",width:24,height:24}),e.jsx(U,{width:200,height:24})]}),e.jsxs("div",{className:et.statsGrid,children:[e.jsxs("div",{className:et.statCard,children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"80%",height:32}),e.jsx(U,{width:"40%",height:16})]}),e.jsxs("div",{className:et.statCard,children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"80%",height:32}),e.jsx(U,{width:"40%",height:16})]}),e.jsxs("div",{className:et.statCard,children:[e.jsx(U,{width:"60%",height:20}),e.jsx(U,{width:"80%",height:32}),e.jsx(U,{width:"40%",height:16})]})]}),e.jsx("div",{style:{marginTop:"2rem"},children:e.jsxs("div",{className:et.chartsGrid,children:[e.jsxs("div",{className:et.chartCard,style:{gridColumn:"1 / -1"},children:[e.jsx(U,{width:180,height:24,className:"mb-4"}),e.jsx(U,{width:"100%",height:250})]}),e.jsxs("div",{className:et.chartCard,children:[e.jsx(U,{width:180,height:24,className:"mb-4"}),e.jsx(U,{width:"100%",height:200,variant:"circular",style:{margin:"0 auto"}})]}),e.jsxs("div",{className:et.chartCard,children:[e.jsx(U,{width:180,height:24,className:"mb-4"}),e.jsx(U,{width:"100%",height:250})]})]})})]})]})},u1=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[c,o]=x.useState(null),[d,h]=x.useState(""),[m,f]=x.useState("debtHighToLow"),[g,y]=x.useState(!0),[b,v]=x.useState(""),[w,S]=x.useState(!1),[_,E]=x.useState(!1),[D,O]=x.useState(null),[M,A]=x.useState([]),[P,Q]=x.useState(null),[G,C]=x.useState(""),[R,z]=x.useState(""),[F,J]=x.useState(""),[H,I]=x.useState("cash"),[V,re]=x.useState(0),B=x.useMemo(()=>{let de=[...a];g&&(de=de.filter(ee=>parseFloat(ee.netDebt)>0));const Se=parseFloat(b);switch(!isNaN(Se)&&Se>0&&(de=de.filter(ee=>parseFloat(ee.netDebt)>=Se)),m){case"name":de.sort((ee,oe)=>ee.name.localeCompare(oe.name));break;case"debtHighToLow":de.sort((ee,oe)=>parseFloat(oe.netDebt)-parseFloat(ee.netDebt));break;case"debtLowToHigh":de.sort((ee,oe)=>parseFloat(ee.netDebt)-parseFloat(oe.netDebt));break}return de},[a,g,b,m]),k=x.useCallback(async()=>{l(!0),o(null);try{const de=d?`/api/patient-debts?search=${encodeURIComponent(d)}`:"/api/patient-debts",Se=await Z(de);if(!Se.ok)throw new Error(`Failed to fetch patients with debt: ${Se.statusText}`);const ee=await Se.json();n(ee);const oe=ee.reduce((fe,ge)=>fe+parseFloat(ge.netDebt||"0"),0);re(oe)}catch(de){console.error("Failed to fetch patients with debt:",de),o(de.message||"Failed to load patients with debt.")}finally{l(!1)}},[d]);x.useEffect(()=>{k()},[k]);const Ne=x.useCallback(async de=>{o(null);try{const Se=await Z(`/api/patient-debts/${de}/transactions`);if(!Se.ok)throw new Error(`Failed to fetch transactions: ${Se.statusText}`);const oe=(await Se.json()).map(q=>({...q,debt_value:parseFloat(q.debt_value),amount_paid:parseFloat(q.amount_paid),balance_remaining:parseFloat(q.balance_remaining)}));A(oe);const fe=await Z(`/api/patient-debts/${de}/balance`);if(!fe.ok)throw new Error(`Failed to fetch balance: ${fe.statusText}`);const ge=await fe.json();Q({patientId:ge.patientId,patientName:ge.patientName,totalDebtValue:parseFloat(ge.totalDebtValue),totalAmountPaid:parseFloat(ge.totalAmountPaid),netDebt:parseFloat(ge.netDebt)})}catch(Se){console.error("Error fetching transactions/balance:",Se),o(Se.message||"Failed to load transactions or balance.")}},[]),Ae=async de=>{if(de.preventDefault(),o(null),!D)return;const Se=parseFloat(R||"0");if(Se<=0){o("Payment amount must be greater than 0");return}try{const ee=await Z(`/api/patient-debts/${D.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transaction_date:G,amount_paid:Se,notes:F,payment_mode:H})});if(!ee.ok){const oe=await ee.json();throw new Error(oe.message||"Failed to add payment.")}alert("Payment recorded successfully!"),Pe(),Ne(D.id),k()}catch(ee){console.error("Error adding payment:",ee),o(ee.message||"Failed to add payment.")}},T=de=>{O(de),Ne(de.id),o(null),S(!0)},Ce=()=>{S(!1),O(null),A([]),Q(null)},Ue=de=>{O(de),C(new Date().toISOString().split("T")[0]),z(""),J(""),I("cash"),o(null),E(!0)},Pe=()=>{E(!1),O(null)};return i?e.jsxs("div",{className:"patient-debt-management-page",children:[e.jsxs("div",{className:"patient-debt-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(U,{width:80,height:36}),e.jsx(U,{width:200,height:32})]}),e.jsx(U,{width:250,height:36})]}),e.jsxs("div",{className:"filter-container",children:[e.jsx(U,{width:200,height:40}),e.jsx(U,{width:120,height:40}),e.jsx(U,{width:100,height:40}),e.jsx(U,{width:150,height:40})]}),e.jsx("div",{className:"debt-table-container",children:e.jsxs("table",{className:"debt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient Name"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Total Debt Value"}),e.jsx("th",{children:"Total Paid"}),e.jsx("th",{children:"Net Debt (Outstanding)"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5,6].map(de=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(U,{width:150,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:100,height:20})}),e.jsx("td",{children:e.jsx(U,{width:180,height:32})})]},de))})]})})]}):e.jsxs("div",{className:"patient-debt-management-page",children:[e.jsxs("div",{className:"patient-debt-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsxs("button",{onClick:()=>t(-1),className:"back-button",title:"Go Back",children:[e.jsx(Et,{size:20})," Back"]}),e.jsx("h2",{children:"Patient Debt Management"})]}),e.jsxs("div",{className:`total-debt-display ${V>0?"debt-positive":"debt-zero"}`,children:[e.jsx(Cr,{size:20}),e.jsx("strong",{children:"Total Outstanding Debt:"})," ",V.toFixed(2)]})]}),c&&e.jsx("div",{className:"error-message",children:c}),e.jsxs("div",{className:"filter-container",children:[e.jsx("input",{type:"text",placeholder:"Search by name or phone...",value:d,onChange:de=>h(de.target.value),className:"filter-search-input"}),e.jsxs("select",{id:"sortBy",value:m,onChange:de=>f(de.target.value),className:"filter-select",title:"Sort by",children:[e.jsx("option",{value:"debtHighToLow",children:"Debt "}),e.jsx("option",{value:"debtLowToHigh",children:"Debt "}),e.jsx("option",{value:"name",children:"Name A-Z"})]}),e.jsx("input",{type:"number",id:"minDebt",value:b,onChange:de=>v(de.target.value),placeholder:"Min ",min:"0",className:"filter-number-input",title:"Minimum debt amount"}),e.jsxs("label",{className:"filter-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:g,onChange:de=>y(de.target.checked)}),"Outstanding only"]}),e.jsxs("span",{className:"filter-count",children:[B.length,"/",a.length]})]}),e.jsx("div",{className:"debt-table-container",children:e.jsxs("table",{className:"debt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{children:[e.jsx(Rn,{size:14})," Patient Name"]}),e.jsxs("th",{children:[e.jsx(nx,{size:14})," Phone"]}),e.jsxs("th",{children:[e.jsx(Rh,{size:14})," Total Debt Value"]}),e.jsx("th",{children:"Total Paid"}),e.jsx("th",{children:"Net Debt (Outstanding)"}),e.jsx("th",{className:"actions-cell",children:"Actions"})]})}),e.jsx("tbody",{children:B.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"no-results-message",children:d?"No patients found matching your search.":"No patients with outstanding debt."})}):B.map(de=>e.jsxs("tr",{onClick:()=>t(`/dashboard/edit-complaint/patient/${de.id}`),style:{cursor:"pointer"},title:"Click to view patient details",children:[e.jsx("td",{"data-label":"Patient Name",children:e.jsxs("div",{className:"patient-name-cell",children:[e.jsx("strong",{children:de.name}),de.age&&de.gender&&e.jsxs("span",{className:"patient-meta",children:[de.age,"y / ",de.gender]})]})}),e.jsx("td",{"data-label":"Phone",children:de.phone||"-"}),e.jsxs("td",{"data-label":"Total Debt Value",children:["",de.totalDebtValue]}),e.jsxs("td",{"data-label":"Total Paid",className:"amount-paid",children:["",de.totalAmountPaid]}),e.jsxs("td",{"data-label":"Net Debt",className:parseFloat(de.netDebt)>0?"debt-outstanding":"debt-clear",children:["",de.netDebt]}),e.jsx("td",{className:"actions-cell",onClick:Se=>Se.stopPropagation(),children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsxs("button",{onClick:()=>T(de),className:"action-text-button view-button",title:"View Transactions",children:[e.jsx(em,{size:16})," View History"]}),e.jsxs("button",{onClick:()=>Ue(de),className:"action-text-button add-payment-button",title:"Record Payment",children:[e.jsx(wa,{size:16})," Record Payment"]})]})})]},de.id))})]})}),w&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsx("button",{onClick:Ce,className:"modal-close-button",children:""}),e.jsxs("h3",{className:"modal-title",children:["Debt History for ",D.name]}),c&&e.jsx("div",{className:"modal-error-message",children:c}),P&&e.jsxs("div",{className:"balance-summary",children:[e.jsxs("div",{className:"balance-row",children:[e.jsx("span",{children:"Total Debt Value:"}),e.jsxs("strong",{children:["",P.totalDebtValue.toFixed(2)]})]}),e.jsxs("div",{className:"balance-row",children:[e.jsx("span",{children:"Total Amount Paid:"}),e.jsxs("strong",{className:"amount-paid",children:["",P.totalAmountPaid.toFixed(2)]})]}),e.jsxs("div",{className:"balance-row net-debt-row",children:[e.jsx("span",{children:e.jsx("strong",{children:"Net Outstanding Debt:"})}),e.jsxs("strong",{className:P.netDebt>0?"debt-outstanding":"debt-clear",children:["",P.netDebt.toFixed(2)]})]})]}),e.jsx("h4",{children:"Transaction History"}),M.length===0?e.jsx("p",{children:"No transactions recorded for this patient."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"debt-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Debt Added"}),e.jsx("th",{children:"Payment Received"}),e.jsx("th",{children:"Balance After"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Payment Mode"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:M.map(de=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Date",children:new Date(de.transaction_date).toLocaleDateString()}),e.jsx("td",{"data-label":"Debt Added",className:de.debt_value>0?"debt-added":"",children:de.debt_value>0?`+ ${de.debt_value.toFixed(2)}`:"-"}),e.jsx("td",{"data-label":"Payment Received",className:de.amount_paid>0?"payment-received":"",children:de.amount_paid>0?`- ${de.amount_paid.toFixed(2)}`:"-"}),e.jsxs("td",{"data-label":"Balance After",children:["",de.balance_remaining.toFixed(2)]}),e.jsx("td",{"data-label":"Due Date",children:de.due_date?new Date(de.due_date).toLocaleDateString():"-"}),e.jsx("td",{"data-label":"Payment Mode",children:de.payment_mode?de.payment_mode.charAt(0).toUpperCase()+de.payment_mode.slice(1):"-"}),e.jsx("td",{"data-label":"Notes",children:de.notes||"-"})]},de.id))})]})}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>{Ce(),Ue(D)},className:"button-submit",children:"Record Payment"}),e.jsx("button",{type:"button",onClick:Ce,className:"button-cancel",children:"Close"})]})]})}),_&&D&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:Pe,className:"modal-close-button",children:""}),e.jsxs("h3",{className:"modal-title",children:["Record Payment for ",D.name]}),e.jsxs("div",{className:"current-debt-info",children:[e.jsx("span",{children:"Current Outstanding Debt:"}),e.jsxs("strong",{className:"debt-outstanding",children:["",D.netDebt]})]}),c&&e.jsx("div",{className:"modal-error-message",children:c}),e.jsxs("form",{onSubmit:Ae,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_date",children:"Payment Date:"}),e.jsx("input",{type:"date",id:"payment_date",value:G,onChange:de=>C(de.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount_paid",children:"Amount Paid ():"}),e.jsx("input",{type:"number",id:"amount_paid",value:R,onChange:de=>z(de.target.value),step:"0.01",min:"0.01",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_mode",children:"Payment Mode:"}),e.jsxs("select",{id:"payment_mode",value:H,onChange:de=>I(de.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_notes",children:"Notes:"}),e.jsx("textarea",{id:"payment_notes",value:F,onChange:de=>J(de.target.value),placeholder:"e.g., Partial payment via cash"})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:Pe,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Record Payment"})]})]})]})})]})},K8=()=>{const t=ft(),[a,n]=x.useState([]),[i,l]=x.useState(!0),[,c]=x.useState(null),[o,d]=x.useState(!1),[h,m]=x.useState(null),[f,g]=x.useState({name:"",description:"",columns:[]}),y=async()=>{l(!0);try{const D=await Z("/api/custom-tables");if(!D.ok)throw new Error("Failed to fetch tables");const O=await D.json();n(O)}catch(D){c(D.message)}finally{l(!1)}};x.useEffect(()=>{y()},[]);const b=D=>{D?(m(D),g({name:D.name,description:D.description,columns:[...D.columns]})):(m(null),g({name:"",description:"",columns:[]})),d(!0)},v=async()=>{try{const D=h?`/api/custom-tables/${h.id}`:"/api/custom-tables";if(!(await Z(D,{method:h?"PUT":"POST",body:JSON.stringify(f)})).ok)throw new Error("Failed to save table");d(!1),y()}catch(D){alert(D.message)}},w=async D=>{if(confirm("Are you sure? This will delete all data in this table!"))try{await Z(`/api/custom-tables/${D}`,{method:"DELETE"}),y()}catch(O){alert(O.message)}},S=()=>{g(D=>({...D,columns:[...D.columns,{key:`col_${Date.now()}`,label:"New Column",type:"text"}]}))},_=(D,O,M)=>{const A=[...f.columns];A[D]={...A[D],[O]:M},O==="label"&&(A[D].key=M.toLowerCase().replace(/[^a-z0-9]/g,"_")),g(P=>({...P,columns:A}))},E=D=>{g(O=>({...O,columns:O.columns.filter((M,A)=>A!==D)}))};return e.jsxs("div",{className:"custom-tables-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsxs("h1",{children:[e.jsx(tm,{size:24})," Custom Tables Manager"]}),e.jsxs("button",{className:"primary-button",onClick:()=>b(),children:[e.jsx(bn,{size:16})," Create New Table"]})]}),i?e.jsx("p",{children:"Loading..."}):e.jsx("div",{className:"tables-grid",children:a.map(D=>e.jsxs("div",{className:"table-card",children:[e.jsxs("div",{className:"card-header",children:[e.jsx("h3",{children:D.name}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{onClick:()=>b(D),children:e.jsx(ma,{size:16})}),e.jsx("button",{onClick:()=>w(D.id),className:"danger",children:e.jsx(Jt,{size:16})})]})]}),e.jsx("p",{className:"description",children:D.description||"No description"}),e.jsxs("div",{className:"column-preview",children:[D.columns.length," columns defined"]}),e.jsx("button",{className:"secondary-button",onClick:()=>t(`/custom-tables/${D.id}`),children:"View Data & Records"})]},D.id))}),o&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:h?"Edit Table":"Create New Table"}),e.jsx("button",{onClick:()=>d(!1),children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Table Name"}),e.jsx("input",{value:f.name,onChange:D=>g({...f,name:D.target.value}),placeholder:"e.g., Equipment Log"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:f.description,onChange:D=>g({...f,description:D.target.value})})]}),e.jsxs("div",{className:"columns-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h3",{children:"Columns"}),e.jsx("button",{onClick:S,className:"icon-button",children:e.jsx(bn,{size:16})})]}),f.columns.map((D,O)=>e.jsxs("div",{className:"column-row",children:[e.jsx("input",{value:D.label,onChange:M=>_(O,"label",M.target.value),placeholder:"Column Name"}),e.jsxs("select",{value:D.type,onChange:M=>_(O,"type",M.target.value),children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),e.jsx("button",{onClick:()=>E(O),className:"danger",children:e.jsx(Jt,{size:14})})]},O))]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{onClick:v,className:"primary-button",children:"Save Table"})})]})})]})},W8=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState(null),[l,c]=x.useState([]),[o,d]=x.useState(!0),[h,m]=x.useState(null),[f,g]=x.useState(!1),[y,b]=x.useState(!1),[v,w]=x.useState(null),[S,_]=x.useState({});x.useEffect(()=>{t&&E()},[t]);const E=async()=>{d(!0);try{const P=await Z(`/api/custom-tables/${t}`);if(!P.ok)throw new Error("Failed to fetch table definition");const Q=await P.json();i(Q);const G=await Z(`/api/custom-tables/${t}/records`);if(!G.ok)throw new Error("Failed to fetch records");const C=await G.json();c(C)}catch(P){m(P.message)}finally{d(!1)}},D=P=>{P?(w(P),_({...P.data})):(w(null),_({})),b(!0)},O=async()=>{try{const P=v?`/api/custom-tables/records/${v.id}`:`/api/custom-tables/${t}/records`;if(!(await Z(P,{method:v?"PUT":"POST",body:JSON.stringify({data:S})})).ok)throw new Error("Failed to save record");b(!1),E()}catch(P){alert(P.message)}},M=async P=>{if(confirm("Delete this record?"))try{await Z(`/api/custom-tables/records/${P}`,{method:"DELETE"}),E()}catch(Q){alert(Q.message)}},A=P=>{const Q=S[P.key]||"";switch(P.type){case"boolean":return e.jsxs("select",{value:Q,onChange:G=>_({...S,[P.key]:G.target.value}),children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]});case"number":return e.jsx("input",{type:"number",value:Q,onChange:G=>_({...S,[P.key]:G.target.value})});case"date":return e.jsx("input",{type:"date",value:Q,onChange:G=>_({...S,[P.key]:G.target.value})});default:return e.jsx("input",{type:"text",value:Q,onChange:G=>_({...S,[P.key]:G.target.value})})}};return o?e.jsx("div",{className:"p-4",children:"Loading..."}):h||!n?e.jsxs("div",{className:"p-4 error",children:["Error: ",h||"Table not found"]}):e.jsxs("div",{className:"custom-tables-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("button",{onClick:()=>a("/custom-tables"),className:"icon-button",children:e.jsx(Et,{size:20})}),e.jsx("h1",{children:n.name})]}),e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>g(!1),className:`view-mode-btn ${f?"":"active"}`,title:"List View",children:[e.jsx(Ou,{size:18})," List"]}),e.jsxs("button",{onClick:()=>g(!0),className:`view-mode-btn ${f?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(Iu,{size:18})," Excel"]})]}),e.jsxs("button",{className:"primary-button",onClick:()=>D(),children:[e.jsx(bn,{size:16})," Add Record"]})]}),e.jsx("div",{className:"table-wrapper",style:{background:"var(--bg-card)",borderRadius:"12px",padding:"20px",overflowX:"auto"},children:f?e.jsx(Mu,{columns:n.columns.map(P=>({key:P.key,label:P.label,editable:!0,type:P.type})),data:l.map(P=>({...P.data,id:P.id})),editable:!0,showRowNumbers:!0,title:n.name,onSave:async P=>{const Q=P.map(async G=>{const C=l.find(R=>R.id===G.id);if(C&&JSON.stringify(C.data)!==JSON.stringify(G)){const{id:R,...z}=G;if(JSON.stringify(C.data)!==JSON.stringify(z))return Z(`/api/custom-tables/records/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:z})})}});try{await Promise.all(Q),alert("Changes saved successfully"),E()}catch(G){alert("Error saving changes"),console.error(G)}}}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[n.columns.map(P=>e.jsx("th",{style:{textAlign:"left",padding:"12px",borderBottom:"1px solid var(--border-color)"},children:P.label},P.key)),e.jsx("th",{style:{width:"100px",padding:"12px",borderBottom:"1px solid var(--border-color)"},children:"Actions"})]})}),e.jsx("tbody",{children:l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:n.columns.length+1,style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"No records yet"})}):l.map(P=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[n.columns.map(Q=>e.jsx("td",{style:{padding:"12px"},children:Q.type==="boolean"?P.data[Q.key]==="true"?"Yes":"No":String(P.data[Q.key]||"-")},Q.key)),e.jsx("td",{style:{padding:"12px"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>D(P),className:"icon-button",children:e.jsx(ma,{size:16})}),e.jsx("button",{onClick:()=>M(P.id),className:"icon-button",style:{color:"#dc3545"},children:e.jsx(Jt,{size:16})})]})})]},P.id))})]})}),y&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:v?"Edit Record":"Add New Record"}),e.jsx("button",{onClick:()=>b(!1),children:e.jsx(St,{size:20})})]}),e.jsx("div",{className:"modal-body",children:n.columns.map(P=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:P.label}),A(P)]},P.key))}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{onClick:O,className:"primary-button",children:"Save Record"})})]})})]})},X8=()=>{const[t,a]=x.useState([]),[n,i]=x.useState(!0),[l,c]=x.useState(""),o=ft();x.useEffect(()=>{d()},[]);const d=async()=>{try{const g=await Z("/api/dashboards");if(g.ok){const y=await g.json();a(y)}}catch(g){console.error("Error fetching dashboards:",g)}finally{i(!1)}},h=async(g,y)=>{if(g.stopPropagation(),!!confirm("Are you sure you want to delete this dashboard?"))try{await Z(`/api/dashboards/${y}`,{method:"DELETE"}),a(t.filter(b=>b.id!==y))}catch(b){console.error("Error deleting dashboard:",b)}},m=g=>{try{const y=new Date(g);return y.toLocaleDateString("en-US",{month:"short",day:"numeric",year:y.getFullYear()!==new Date().getFullYear()?"numeric":void 0})}catch{return""}},f=t.filter(g=>g.name.toLowerCase().includes(l.toLowerCase())||g.description&&g.description.toLowerCase().includes(l.toLowerCase()));return e.jsxs("div",{className:"custom-dashboards-container",children:[e.jsxs("div",{className:"cdp-header",children:[e.jsxs("div",{className:"cdp-title-row",children:[e.jsxs("div",{className:"cdp-title",children:[e.jsx("div",{className:"cdp-icon",children:e.jsx(Iu,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{children:"Custom Dashboards"}),e.jsxs("span",{className:"cdp-subtitle",children:[t.length," dashboard",t.length!==1?"s":""]})]})]}),e.jsxs("button",{className:"cdp-create-btn",onClick:()=>o("/dashboards/new"),children:[e.jsx(bn,{size:16}),e.jsx("span",{className:"cdp-btn-text",children:"Create"})]})]}),t.length>0&&e.jsxs("div",{className:"cdp-search",children:[e.jsx(fn,{size:16}),e.jsx("input",{type:"text",placeholder:"Search dashboards...",value:l,onChange:g=>c(g.target.value)})]})]}),e.jsx("div",{className:"cdp-content",children:n?e.jsx("div",{className:"cdp-grid",children:[1,2,3,4,5,6].map(g=>e.jsxs("div",{className:"cdp-card",style:{cursor:"default"},children:[e.jsxs("div",{className:"cdp-card-header",children:[e.jsx(U,{width:18,height:18,variant:"circular"}),e.jsx(U,{width:80,height:12})]}),e.jsxs("div",{className:"cdp-card-body",children:[e.jsx(U,{width:"70%",height:24,style:{marginBottom:"8px"}}),e.jsx(U,{width:"90%",height:16})]}),e.jsxs("div",{className:"cdp-card-footer",style:{borderTop:"none"},children:[e.jsx(U,{width:60,height:32}),e.jsx(U,{width:60,height:32}),e.jsx(U,{width:32,height:32})]})]},g))}):f.length===0?e.jsxs("div",{className:"cdp-empty",children:[e.jsx("div",{className:"cdp-empty-icon",children:e.jsx(wu,{size:48})}),l?e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"No results found"}),e.jsx("p",{children:"Try a different search term"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"No dashboards yet"}),e.jsx("p",{children:"Create your first custom dashboard to get started"}),e.jsxs("button",{className:"cdp-create-btn",onClick:()=>o("/dashboards/new"),children:[e.jsx(bn,{size:16})," Create Dashboard"]})]})]}):e.jsx("div",{className:"cdp-grid",children:f.map(g=>e.jsxs("div",{className:"cdp-card",onClick:()=>o(`/dashboards/${g.id}`),children:[e.jsxs("div",{className:"cdp-card-header",children:[e.jsx("div",{className:"cdp-card-icon",children:e.jsx(wu,{size:18})}),e.jsx("div",{className:"cdp-card-meta",children:g.created_at&&e.jsxs("span",{className:"cdp-card-date",children:[e.jsx(pa,{size:12}),m(g.created_at)]})})]}),e.jsxs("div",{className:"cdp-card-body",children:[e.jsx("h3",{children:g.name}),e.jsx("p",{children:g.description||"No description"})]}),e.jsxs("div",{className:"cdp-card-footer",children:[e.jsxs("button",{className:"cdp-action-btn cdp-view-btn",onClick:y=>{y.stopPropagation(),o(`/dashboards/${g.id}`)},children:[e.jsx(em,{size:14}),e.jsx("span",{children:"View"})]}),e.jsxs("button",{className:"cdp-action-btn cdp-edit-btn",onClick:y=>{y.stopPropagation(),o(`/dashboards/${g.id}/edit`)},children:[e.jsx(ma,{size:14}),e.jsx("span",{children:"Edit"})]}),e.jsx("button",{className:"cdp-action-btn cdp-delete-btn",onClick:y=>h(y,g.id),children:e.jsx(Jt,{size:14})})]})]},g.id))})})]})},Z8=({isOpen:t,onClose:a,onConfirm:n})=>{const[i,l]=x.useState({}),[c,o]=x.useState(""),[d,h]=x.useState(""),[m,f]=x.useState([]),[g,y]=x.useState([]),[b,v]=x.useState(!1);x.useEffect(()=>{t&&w()},[t]);const w=async()=>{v(!0);try{const P=await Z("/api/dashboards/table-relations");if(P.ok){const Q=await P.json();l(Q);const G=Object.keys(Q);G.length>0&&o(G[0])}}catch(P){console.error("Error fetching table relations:",P)}finally{v(!1)}},S=P=>{o(P),h(""),f([]),y([])},_=P=>{h(P),y([])},E=(P,Q,G)=>{P.includes(G)?Q(P.filter(C=>C!==G)):Q([...P,G])},D=()=>{var P,Q;if(!c||!d){alert("Please select both primary and related tables");return}if(m.length===0&&g.length===0){alert("Please select at least one column");return}n({primary:c,related:d,primaryColumns:m,relatedColumns:g,primaryLabel:((P=i[c])==null?void 0:P.label)||c,relatedLabel:((Q=i[d])==null?void 0:Q.label)||d}),a()};if(!t)return null;const O=i[c],M=(O==null?void 0:O.relations)||{},A=i[d];return e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px"},children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:[e.jsx(O1,{size:18})," Join Tables Builder"]}),e.jsx("button",{onClick:a,className:"close-button",children:e.jsx(St,{size:20})})]}),b?e.jsx("div",{children:"Loading tables..."}):e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px",padding:"20px"},children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("strong",{children:"Step 1:"})," Select Primary Table"]}),e.jsx("select",{value:c,onChange:P=>S(P.target.value),style:{width:"100%",padding:"8px"},children:Object.entries(i).filter(([P,Q])=>Object.keys(Q.relations).length>0).map(([P,Q])=>e.jsx("option",{value:P,children:Q.label},P))})]}),c&&Object.keys(M).length>0&&e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx("strong",{children:"Step 2:"})," Select Related Table"]}),e.jsxs("select",{value:d,onChange:P=>_(P.target.value),style:{width:"100%",padding:"8px"},children:[e.jsx("option",{value:"",children:"-- Select --"}),Object.entries(M).map(([P,Q])=>e.jsxs("option",{value:P,children:[Q.label," (via ",Q.foreignKey,")"]},P))]})]}),c&&O&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:e.jsxs("strong",{children:["Columns from ",O.label,":"]})}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:O.columns.map(P=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",background:m.includes(P)?"#e0f0ff":"#f0f0f0",padding:"4px 8px",borderRadius:"4px"},children:[e.jsx("input",{type:"checkbox",checked:m.includes(P),onChange:()=>E(m,f,P)}),P]},P))})]}),d&&A&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:e.jsxs("strong",{children:["Columns from ",A.label,":"]})}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:A.columns.map(P=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer",background:g.includes(P)?"#e0ffe0":"#f0f0f0",padding:"4px 8px",borderRadius:"4px"},children:[e.jsx("input",{type:"checkbox",checked:g.includes(P),onChange:()=>E(g,y,P)}),P]},P))})]}),m.length>0||g.length>0?e.jsxs("div",{style:{background:"#f8f9fa",padding:"10px",borderRadius:"4px"},children:[e.jsx("strong",{children:"Preview Columns:"}),e.jsxs("div",{style:{marginTop:"5px",fontSize:"0.9em"},children:[m.map(P=>e.jsxs("span",{style:{marginRight:"8px",color:"#0066cc"},children:[O==null?void 0:O.label,".",P]},P)),g.map(P=>e.jsxs("span",{style:{marginRight:"8px",color:"#009900"},children:[A==null?void 0:A.label,".",P]},P))]})]}):null]}),e.jsxs("div",{className:"modal-actions",style:{padding:"15px",borderTop:"1px solid #eee"},children:[e.jsx("button",{onClick:a,children:"Cancel"}),e.jsx("button",{className:"primary-button",onClick:D,disabled:!d,children:"Create Joined Widget"})]})]})})},eB=({isOpen:t,onClose:a,onCreated:n})=>{const[i,l]=x.useState(""),[c,o]=x.useState(""),[d,h]=x.useState([{key:"name",label:"Name",type:"text"}]),[m,f]=x.useState(!1),g=()=>{h([...d,{key:"",label:"",type:"text"}])},y=w=>{h(d.filter((S,_)=>_!==w))},b=(w,S,_)=>{const E=[...d];E[w]={...E[w],[S]:_},S==="label"&&!E[w].key&&(E[w].key=_.toLowerCase().replace(/\s+/g,"_")),h(E)},v=async()=>{if(!i.trim()){alert("Table name is required");return}if(d.length===0||d.some(w=>!w.key||!w.label)){alert("All columns must have a key and label");return}f(!0);try{(await Z("/api/custom-tables",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,description:c,columns:d})})).ok?(alert("Table created successfully!"),n(),a(),l(""),o(""),h([{key:"name",label:"Name",type:"text"}])):alert("Failed to create table")}catch(w){console.error("Error creating table:",w),alert("Error creating table")}finally{f(!1)}};return t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content create-table-modal-content",children:[e.jsxs("div",{className:"create-table-header",children:[e.jsxs("h3",{children:[e.jsx(tm,{size:20})," Create Custom Table"]}),e.jsx("button",{onClick:a,className:"close-btn",children:e.jsx(St,{size:20})})]}),e.jsxs("div",{className:"form-content",children:[e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{children:"Table Name *"}),e.jsx("input",{type:"text",value:i,onChange:w=>l(w.target.value),placeholder:"e.g., Patient Notes, Appointments",className:"modal-input"})]}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:c,onChange:w=>o(w.target.value),placeholder:"Optional description",className:"modal-input"})]}),e.jsxs("div",{className:"form-field-group",children:[e.jsx("label",{children:"Columns"}),e.jsx("div",{className:"columns-container",children:d.map((w,S)=>e.jsxs("div",{className:"column-row",children:[e.jsx("input",{type:"text",value:w.label,onChange:_=>b(S,"label",_.target.value),placeholder:"Column label",className:"modal-input column-label-input"}),e.jsx("input",{type:"text",value:w.key,onChange:_=>b(S,"key",_.target.value),placeholder:"key",className:"modal-input column-key-input"}),e.jsxs("select",{value:w.type,onChange:_=>b(S,"type",_.target.value),className:"column-type-select",children:[e.jsx("option",{value:"text",children:"Text"}),e.jsx("option",{value:"number",children:"Number"}),e.jsx("option",{value:"date",children:"Date"}),e.jsx("option",{value:"boolean",children:"Yes/No"})]}),e.jsx("button",{onClick:()=>y(S),className:"remove-col-btn",disabled:d.length<=1,children:e.jsx(Jt,{size:16})})]},S))}),e.jsxs("button",{onClick:g,className:"add-col-btn",children:[e.jsx(bn,{size:14})," Add Column"]})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:a,className:"cancel-button",children:"Cancel"}),e.jsx("button",{onClick:v,disabled:m,className:"create-button",children:m?"Creating...":"Create Table"})]})]})}):null},d1=()=>{const{id:t}=Fn(),a=ft(),n=!!t,[i,l]=x.useState(""),[c,o]=x.useState(""),[d,h]=x.useState([]),[m,f]=x.useState(!1),[g,y]=x.useState([]),[b,v]=x.useState(!1),[w,S]=x.useState("stat"),[_,E]=x.useState(""),[D,O]=x.useState("api:patients"),[M,A]=x.useState([]),[P,Q]=x.useState(!1),[G,C]=x.useState(!1);x.useEffect(()=>{R(),n&&z()},[t]);const R=async()=>{try{const B=await Z("/api/dashboards/data-sources");if(B.ok){const k=await B.json();y(k),k.length>0&&O(k[0].key)}}catch(B){console.error("Error fetching data sources:",B)}},z=async()=>{try{const B=await Z(`/api/dashboards/${t}`);if(B.ok){const k=await B.json();l(k.name),o(k.description),h(k.widgets||[])}}catch(B){console.error("Error fetching dashboard:",B)}},F=async()=>{if(!i.trim())return alert("Name is required");f(!0);try{const B={name:i,description:c,widgets:d},k=n?`/api/dashboards/${t}`:"/api/dashboards";(await Z(k,{method:n?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)})).ok?a("/dashboards"):alert("Failed to save dashboard")}catch(B){console.error("Error saving dashboard:",B)}finally{f(!1)}},J=()=>{var Ne;const B=g.find(Ae=>Ae.key===D),k={id:Date.now().toString(),type:w,title:_||(B==null?void 0:B.label)||"New Widget",dataSource:D,config:{columns:M.length>0?M:((Ne=B==null?void 0:B.columns)==null?void 0:Ne.slice(0,3))||[]}};h([...d,k]),v(!1),E(""),A([])},H=B=>{h(d.filter(k=>k.id!==B))},I=B=>{O(B),A([])},V=g.find(B=>B.key===D),re=B=>{const k={id:Date.now().toString(),type:"table",title:`${B.primaryLabel} + ${B.relatedLabel}`,dataSource:`dynamic:${B.primary}:${B.related}`,config:{primaryColumns:B.primaryColumns,relatedColumns:B.relatedColumns}};h([...d,k])};return e.jsxs("div",{className:"dashboard-builder-container",children:[e.jsxs("div",{className:"builder-header",children:[e.jsxs("button",{className:"back-btn",onClick:()=>a("/dashboards"),children:[e.jsx(Et,{size:16})," Back"]}),e.jsxs("div",{className:"title-inputs",children:[e.jsx("input",{type:"text",placeholder:"Dashboard Name",value:i,onChange:B=>l(B.target.value),className:"dashboard-name-input"}),e.jsx("input",{type:"text",placeholder:"Description (Optional)",value:c,onChange:B=>o(B.target.value),className:"dashboard-desc-input"})]}),e.jsxs("button",{className:"primary-button",onClick:F,disabled:m,children:[e.jsx(ks,{size:16})," ",m?"Saving...":"Save Dashboard"]})]}),e.jsx("div",{className:"widgets-area",children:d.length===0?e.jsxs("div",{className:"empty-canvas",children:[e.jsx("p",{children:"Canvas is empty. Add a widget to start."}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>v(!0),className:"add-widget-btn",children:[e.jsx(bn,{size:16})," Add Widget"]}),e.jsxs("button",{onClick:()=>Q(!0),className:"add-widget-btn",style:{background:"#2196F3"},children:[e.jsx(O1,{size:16})," Create Joined Widget"]}),e.jsxs("button",{onClick:()=>C(!0),className:"add-widget-btn",style:{background:"#4CAF50"},children:[e.jsx(tm,{size:16})," Create Custom Table"]})]})]}):e.jsxs("div",{className:"widgets-grid",children:[d.map(B=>e.jsxs("div",{className:"widget-wrapper",children:[e.jsx("div",{className:"widget-actions-overlay",children:e.jsx("button",{onClick:()=>H(B.id),className:"remove-widget-btn",children:e.jsx(Jt,{size:14})})}),e.jsx(Dx,{widget:B})]},B.id)),e.jsxs("div",{className:"add-more-card",onClick:()=>v(!0),children:[e.jsx(bn,{size:24}),e.jsx("span",{children:"Add Widget"})]})]})}),b&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h3",{children:"Add Widget"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title (Optional)"}),e.jsx("input",{type:"text",placeholder:"Leave blank for auto-title",value:_,onChange:B=>E(B.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Type"}),e.jsxs("select",{value:w,onChange:B=>S(B.target.value),children:[e.jsx("option",{value:"stat",children:"Statistic (Count)"}),e.jsx("option",{value:"table",children:"Table (List)"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Data Source"}),e.jsxs("select",{value:D,onChange:B=>I(B.target.value),children:[e.jsx("optgroup",{label:"Single Tables",children:g.filter(B=>!B.isCustom&&!B.isJoin).map(B=>e.jsx("option",{value:B.key,children:B.label},B.key))}),g.some(B=>B.isJoin)&&e.jsx("optgroup",{label:"Joined Tables (Multi-Table)",children:g.filter(B=>B.isJoin).map(B=>e.jsx("option",{value:B.key,children:B.label},B.key))}),g.some(B=>B.isCustom)&&e.jsx("optgroup",{label:"Custom Tables",children:g.filter(B=>B.isCustom).map(B=>e.jsx("option",{value:B.key,children:B.label},B.key))})]}),V&&e.jsx("small",{style:{color:"#666"},children:V.description})]}),w==="table"&&(V==null?void 0:V.columns)&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Columns to Display (select multiple)"}),e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:V.columns.map(B=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"4px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:M.includes(B),onChange:k=>{k.target.checked?A([...M,B]):A(M.filter(Ne=>Ne!==B))}}),B]},B))})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{onClick:()=>v(!1),children:"Cancel"}),e.jsx("button",{className:"primary-button",onClick:J,children:"Add"})]})]})}),e.jsx(Z8,{isOpen:P,onClose:()=>Q(!1),onConfirm:re}),e.jsx(eB,{isOpen:G,onClose:()=>C(!1),onCreated:()=>R()})]})},tB=()=>{const{id:t}=Fn(),a=ft(),[n,i]=x.useState(null);if(x.useEffect(()=>{(async()=>{try{const o=await Z(`/api/dashboards/${t}`);if(o.ok){const d=await o.json();i(d)}}catch(o){console.error("Error fetching dashboard:",o)}})()},[t]),!n)return e.jsx("div",{className:"temp-dash-empty",children:"Loading..."});const l=n.widgets||[];return e.jsxs("div",{className:"saved-dash-container",children:[e.jsxs("div",{className:"saved-dash-header",children:[e.jsxs("div",{className:"saved-dash-title-group",children:[e.jsx("button",{className:"saved-dash-back-btn",onClick:()=>a("/dashboards"),children:e.jsx(Et,{size:16})}),e.jsx("div",{className:"saved-dash-icon",children:e.jsx(wu,{size:16})}),e.jsxs("div",{className:"saved-dash-title-text",children:[e.jsx("h2",{children:n.name}),n.description&&e.jsx("span",{className:"saved-dash-description",children:n.description})]})]}),e.jsx("div",{className:"saved-dash-actions",children:e.jsxs("button",{className:"saved-dash-edit-btn",onClick:()=>a(`/dashboards/${t}/edit`),children:[e.jsx(ma,{size:12})," Edit"]})})]}),e.jsx("div",{className:"saved-dash-body",children:l.length===0?e.jsx("div",{className:"temp-dash-empty",children:"No widgets in this dashboard. Click Edit to add some!"}):e.jsx("div",{className:"temp-dash-grid",children:l.map((c,o)=>e.jsx(Dx,{widget:c,autoHideEmptyColumns:!0},c.id||`view-widget-${o}`))})})]})},rg=["#8b5cf6","#3b82f6","#06b6d4","#10b981","#22c55e","#f59e0b","#f97316","#ef4444","#ec4899","#a855f7"],nB=()=>{const[t,a]=x.useState([]),[n,i]=x.useState(!0),[l,c]=x.useState(null),[o,d]=x.useState(null),[h,m]=x.useState(!1),[f,g]=x.useState({name:"",key:"",color:"#6b7280",description:""}),[y,b]=x.useState(!1),v=async()=>{i(!0),c(null);try{const G=await Z("/api/clinic-roles");if(G.ok){const C=await G.json();a(C)}else c("Failed to load roles")}catch{c("Failed to connect to server")}finally{i(!1)}};x.useEffect(()=>{v()},[]);const w=G=>G.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),S=G=>{g(C=>({...C,name:G,key:o?C.key:w(G)}))},_=async()=>{if(f.name.trim()){b(!0);try{const G=await Z("/api/clinic-roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f.name.trim(),key:f.key||w(f.name),color:f.color,description:f.description.trim()||null})});if(G.ok)await v(),m(!1),g({name:"",key:"",color:"#6b7280",description:""});else{const C=await G.json();c(C.message||"Failed to create role")}}catch{c("Failed to create role")}finally{b(!1)}}},E=async()=>{if(!(!o||!f.name.trim())){b(!0);try{const G=await Z(`/api/clinic-roles/${o.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:f.name.trim(),color:f.color,description:f.description.trim()||null})});if(G.ok)await v(),d(null),g({name:"",key:"",color:"#6b7280",description:""});else{const C=await G.json();c(C.message||"Failed to update role")}}catch{c("Failed to update role")}finally{b(!1)}}},D=async G=>{if(!G.isSystem&&window.confirm(`Delete role "${G.name}"? This cannot be undone.`))try{const C=await Z(`/api/clinic-roles/${G.id}`,{method:"DELETE"});if(C.ok)await v();else{const R=await C.json();c(R.message||"Failed to delete role")}}catch{c("Failed to delete role")}},O=G=>{d(G),g({name:G.name,key:G.key,color:G.color,description:G.description||""}),m(!1)},M=()=>{m(!0),d(null),g({name:"",key:"",color:rg[Math.floor(Math.random()*rg.length)],description:""})},A=()=>{m(!1),d(null),g({name:"",key:"",color:"#6b7280",description:""})},P=t.filter(G=>G.isSystem),Q=t.filter(G=>!G.isSystem);return e.jsxs("div",{className:"role-management-page",children:[e.jsxs("div",{className:"role-management-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx(Oh,{size:28}),e.jsxs("div",{children:[e.jsx("h1",{children:"Role Management"}),e.jsx("p",{children:"Manage custom roles for your clinic staff"})]})]}),e.jsxs("button",{className:"create-role-btn",onClick:M,disabled:h,children:[e.jsx(bn,{size:18}),"Create Custom Role"]})]}),l&&e.jsxs("div",{className:"role-error-banner",children:[e.jsx(Nn,{size:18}),l,e.jsx("button",{onClick:()=>c(null),children:e.jsx(St,{size:16})})]}),(h||o)&&e.jsxs("div",{className:"role-form-card",children:[e.jsx("h3",{children:o?"Edit Role":"Create New Role"}),e.jsxs("div",{className:"role-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name *"}),e.jsx("input",{type:"text",value:f.name,onChange:G=>S(G.target.value),placeholder:"e.g., Senior Doctor, Ward Nurse"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Key"}),e.jsx("input",{type:"text",value:f.key,onChange:G=>g(C=>({...C,key:G.target.value})),placeholder:"auto-generated",disabled:!!o})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:f.description,onChange:G=>g(C=>({...C,description:G.target.value})),placeholder:"Brief description of role responsibilities"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(FC,{size:14}),"Color"]}),e.jsxs("div",{className:"color-picker",children:[rg.map(G=>e.jsx("button",{className:`color-option ${f.color===G?"selected":""}`,style:{background:G},onClick:()=>g(C=>({...C,color:G}))},G)),e.jsx("input",{type:"color",value:f.color,onChange:G=>g(C=>({...C,color:G.target.value})),className:"custom-color-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:A,children:"Cancel"}),e.jsxs("button",{className:"save-btn",onClick:o?E:_,disabled:y||!f.name.trim(),children:[e.jsx(Eo,{size:16}),y?"Saving...":o?"Update Role":"Create Role"]})]})]})]}),e.jsxs("div",{className:"roles-container",children:[e.jsxs("div",{className:"roles-section",children:[e.jsx("h3",{children:"System Roles"}),e.jsx("p",{className:"section-desc",children:"Default roles - can be customized but not deleted"}),n?e.jsx("div",{className:"roles-grid",children:[1,2,3].map(G=>e.jsxs("div",{className:"role-card system",children:[e.jsxs("div",{className:"role-header",style:{marginBottom:"10px"},children:[e.jsx(U,{variant:"circular",width:12,height:12,style:{marginRight:"8px"}}),e.jsx(U,{width:100,height:20})]}),e.jsx(U,{width:80,height:16,style:{marginBottom:"10px"}}),e.jsx(U,{width:"100%",height:20}),e.jsx("div",{className:"role-actions",style:{marginTop:"15px"},children:e.jsx(U,{width:60,height:24})})]},G))}):e.jsx("div",{className:"roles-grid",children:P.map(G=>e.jsxs("div",{className:"role-card system",children:[e.jsxs("div",{className:"role-header",children:[e.jsx("span",{className:"role-color-dot",style:{background:G.color}}),e.jsx("span",{className:"role-name",children:G.name}),e.jsx("span",{className:"system-badge",children:"System"})]}),e.jsx("div",{className:"role-key",children:G.key}),G.description&&e.jsx("div",{className:"role-description",children:G.description}),e.jsx("div",{className:"role-actions",children:e.jsxs("button",{className:"edit-role-btn",onClick:()=>O(G),children:[e.jsx(_o,{size:14}),"Edit"]})})]},G.id))})]}),e.jsxs("div",{className:"roles-section",children:[e.jsx("h3",{children:"Custom Roles"}),e.jsx("p",{className:"section-desc",children:"Roles created for your clinic"}),Q.length===0?e.jsxs("div",{className:"no-roles",children:[e.jsx(Oh,{size:32}),e.jsx("p",{children:"No custom roles created yet"}),e.jsxs("button",{onClick:M,children:[e.jsx(bn,{size:16}),"Create your first custom role"]})]}):e.jsx("div",{className:"roles-grid",children:Q.map(G=>e.jsxs("div",{className:"role-card custom",children:[e.jsxs("div",{className:"role-header",children:[e.jsx("span",{className:"role-color-dot",style:{background:G.color}}),e.jsx("span",{className:"role-name",children:G.name})]}),e.jsx("div",{className:"role-key",children:G.key}),G.description&&e.jsx("div",{className:"role-description",children:G.description}),e.jsxs("div",{className:"role-actions",children:[e.jsxs("button",{className:"edit-role-btn",onClick:()=>O(G),children:[e.jsx(_o,{size:14}),"Edit"]}),e.jsxs("button",{className:"delete-role-btn",onClick:()=>D(G),children:[e.jsx(Jt,{size:14}),"Delete"]})]})]},G.id))})]})]})]})};function aB(){const[t,a]=x.useState(!1),[n,i]=x.useState(null),[l,c]=x.useState(!0),[o,d]=x.useState(null),[h,m]=x.useState(!1),f=D=>{i(D),a(!0),D.role==="admin"&&!D.has_seen_tutorial&&m(!0)},g=()=>{a(!1),i(null),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")};x.useEffect(()=>{const D=localStorage.getItem("authToken"),O=localStorage.getItem("currentUser");if(D&&O)try{const M=JSON.parse(O);i(M),a(!0),M.role==="admin"&&!M.has_seen_tutorial&&m(!0)}catch(M){console.error("Error parsing stored user data:",M),localStorage.removeItem("authToken"),localStorage.removeItem("currentUser")}c(!1)},[]),x.useEffect(()=>{(async()=>{if(t&&n)try{const O=await sM();d(O)}catch(O){console.error("Error fetching clinic pro plan status:",O),d({hasProPlan:!1})}else d(null)})()},[t,n]);const[y,b]=x.useState(null),[v,w]=x.useState(!1);x.useEffect(()=>{const D=O=>{O.preventDefault(),b(O),w(!0),console.log("beforeinstallprompt event fired")};return window.addEventListener("beforeinstallprompt",D),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone)&&(console.log("App is already installed (standalone)."),w(!1)),()=>{window.removeEventListener("beforeinstallprompt",D)}},[]),x.useEffect(()=>{const D=window.matchMedia("(prefers-color-scheme: dark)"),O=()=>{D.matches?document.body.classList.add("dark-mode"):document.body.classList.remove("dark-mode")};return O(),D.addEventListener("change",O),()=>{D.removeEventListener("change",O),document.body.classList.remove("dark-mode")}},[]);const S=x.useCallback(async()=>{if(!y){console.log("Install prompt event not available.");return}const D=y;D.prompt();const{outcome:O}=await D.userChoice;console.log(`User response to the install prompt: ${O}`),b(null),w(!1)},[y]),_=async()=>{if(n)try{(await Z(`/api/users/${n.id}/tutorial-seen`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({has_seen_tutorial:!0})})).ok?(i(O=>O?{...O,has_seen_tutorial:!0}:null),localStorage.setItem("currentUser",JSON.stringify({...n,has_seen_tutorial:!0})),m(!1)):console.error("Failed to update tutorial status on backend.")}catch(D){console.error("Error marking tutorial as seen:",D)}};return l?e.jsx(E_,{}):e.jsx(A_,{clientId:"277898779560-33obduhn8r758rini4qagetdrupvisri.apps.googleusercontent.com",children:e.jsx($_,{children:e.jsx(F_,{children:e.jsx(L_,{children:e.jsxs(rC,{children:[e.jsx(z_,{children:e.jsxs(So,{children:[e.jsx(at,{path:"/login",element:t?e.jsx(Pt,{to:"/dashboard"}):e.jsx(QR,{onLoginSuccess:f})}),e.jsx(at,{path:"/register",element:t?e.jsx(Pt,{to:"/dashboard"}):e.jsx(YR,{})}),e.jsx(at,{path:"/handle-complaint-url",element:t?e.jsx(AM,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/live-api",element:t?e.jsx(G3,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/create-lab-order",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(ww,{currentUser:n})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/manage-admission",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(Ex,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/lab/report/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(i1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/lab/enter-report/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(i1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/add-patient",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(Fg,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/billing",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(N5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/edit-complaint/:recordId",element:t&&n?e.jsx(n1,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/edit-complaint/patient/:patientId",element:t&&n?e.jsx(n1,{}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/edit-pharmacy-order/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx($S,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/*",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:sB(n.role,n,Z)}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/lab/view-report/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(P5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/lab/search-report",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(R5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/patient/:patientId/lab-reports",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(O5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/patient/:patientId/pharmacy-orders",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(w5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/inventory",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(MS,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/inventory/add",element:t&&n?e.jsx(Pt,{to:"/dashboard/purchase",replace:!0}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/inventory/edit/:id",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(kw,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/lab-inventory",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(Ax,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/patient/:patientId/complaints",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(c5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/patient/:patientId/admission-bill/:billId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(r1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/patient/:patientId/admission-billing",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(r1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/start-subscription/:patientId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(J5,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/start-clinic-subscription",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(oM,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/refill-reminders",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(TM,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/create-custom-bill",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(Nw,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/pharmacy-billing/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(p8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/lab-billing/:orderId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(f8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/doctor-billing/:queueId",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(x8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/custom-tables",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(K8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/custom-tables/:id",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(W8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboards",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(X8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboards/new",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(d1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboards/:id",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(tB,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboards/:id/edit",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(d1,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/analysis",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(J8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"/dashboard/clinic-hub",element:t&&n?e.jsx(Qt,{user:n,onLogout:g,showInstallPrompt:v,onInstallClick:S,clinicProPlanStatus:o,children:e.jsx(y8,{})}):e.jsx(Pt,{to:"/login"})}),e.jsx(at,{path:"*",element:e.jsx(Pt,{to:t?"/dashboard":"/login"})})]})}),h&&(n==null?void 0:n.role)==="admin"&&e.jsx(EM,{onClose:()=>m(!1),onMarkAsSeen:_}),t&&n&&e.jsx(iB,{user:n}),t&&n&&e.jsx(GR,{})]})})})})})}const sB=(t,a,n)=>{switch(t){case"superadmin":return e.jsxs(So,{children:[e.jsx(at,{index:!0,element:e.jsx(kM,{})}),e.jsx(at,{path:"clinic-subscriptions",element:e.jsx(iM,{})}),e.jsx(at,{path:"clinic-subscriptions/add",element:e.jsx(rM,{})}),e.jsx(at,{path:"clinic-subscriptions/edit/:id",element:e.jsx(lM,{})}),e.jsx(at,{path:"users",element:e.jsx(cM,{})})," ",e.jsx(at,{path:"*",element:e.jsx("div",{children:"Unknown Super Admin Section"})})]});case"admin":return e.jsxs(So,{children:[e.jsxs(at,{path:"/",element:e.jsx(eO,{fetchWithAuth:n}),children:[e.jsx(at,{index:!0,element:e.jsx(NO,{})}),e.jsx(at,{path:"search-patient",element:e.jsx(gu,{})}),e.jsx(at,{path:"patients",element:e.jsx(zg,{})})]}),e.jsx(at,{path:"staff",element:e.jsx(F5,{fetchWithAuth:n})}),e.jsx(at,{path:"staff/add",element:e.jsx(TO,{clinicId:a==null?void 0:a.clinic_id})}),e.jsx(at,{path:"staff/edit/:id",element:e.jsx(AO,{})}),e.jsx(at,{path:"roles",element:e.jsx(nB,{})}),e.jsx(at,{path:"patients/add",element:e.jsx(Fg,{})}),e.jsx(at,{path:"inventory",element:e.jsx(Sw,{})}),e.jsx(at,{path:"inventory/edit/:id",element:e.jsx(kw,{})}),e.jsx(at,{path:"distributors",element:e.jsx(l1,{})}),e.jsx(at,{path:"patient-debts",element:e.jsx(u1,{})})," ",e.jsx(at,{path:"purchase",element:e.jsx(o1,{})})," ",e.jsx(at,{path:"queue",element:e.jsx(If,{})}),e.jsx(at,{path:"subscriptions",element:e.jsx(G5,{})}),e.jsx(at,{path:"subscriptions/add",element:e.jsx(Q5,{})}),e.jsx(at,{path:"subscriptions/edit/:id",element:e.jsx(Y5,{})}),e.jsx(at,{path:"manage-admission",element:e.jsx(Ex,{})}),e.jsx(at,{path:"reception",element:e.jsx(h0,{currentUser:a})}),e.jsx(at,{path:"lab",element:e.jsx(m0,{})}),e.jsx(at,{path:"pharmacy-queue",element:e.jsx(p0,{})}),e.jsx(at,{path:"*",element:e.jsx("div",{children:"Unknown Admin Section"})})," "]});case"doctor":return e.jsxs(So,{children:[e.jsx(at,{index:!0,element:e.jsx(Pt,{to:"search-patient",replace:!0})}),e.jsx(at,{path:"search-patient",element:e.jsx(gu,{})}),e.jsx(at,{path:"queue",element:e.jsx(If,{})}),e.jsx(at,{path:":patientId",element:e.jsx(If,{})}),e.jsx(at,{path:"add-patient",element:e.jsx(Fg,{})}),e.jsx(at,{path:"*",element:e.jsx("div",{children:"Unknown Doctor Section"})})]});case"receptionist":return e.jsxs(So,{children:[e.jsx(at,{index:!0,element:e.jsx(h0,{currentUser:a})}),e.jsx(at,{path:"all-patients",element:e.jsx(zg,{})}),e.jsx(at,{path:"search-patient",element:e.jsx(gu,{})}),e.jsx(at,{path:"*",element:e.jsx("div",{children:"Unknown Reception Section"})})," "]});case"lab":return e.jsx(m0,{});case"pharmacy":return e.jsxs(So,{children:[e.jsx(at,{index:!0,element:e.jsx(p0,{})}),e.jsx(at,{path:"inventory",element:e.jsx(MS,{})}),e.jsx(at,{path:"settings",element:e.jsx(EO,{})}),e.jsx(at,{path:"add-order",element:e.jsx(S5,{})}),e.jsx(at,{path:"edit-pharmacy-order/:orderId",element:e.jsx($S,{})}),e.jsx(at,{path:"orders/:orderId",element:e.jsx($5,{})}),e.jsx(at,{path:"search-patient-records",element:e.jsx(gu,{})}),e.jsx(at,{path:"distributors",element:e.jsx(l1,{})}),e.jsx(at,{path:"patient-debts",element:e.jsx(u1,{})})," ",e.jsx(at,{path:"purchase",element:e.jsx(o1,{})})," ",e.jsx(at,{path:"*",element:e.jsx(Pt,{to:"/dashboard",replace:!0})})]});default:return e.jsxs("div",{children:["Unknown role (",t,") or dashboard not implemented."]},t)}},Qt=({user:t,onLogout:a,children:n,showInstallPrompt:i,onInstallClick:l,clinicProPlanStatus:c})=>{const o=ft(),[d,h]=x.useState(!1),[m,f]=x.useState(window.innerWidth<=768),[g,y]=x.useState(null),[b,v]=x.useState(!1);x.useEffect(()=>yg.subscribe(E=>{v(E)}),[]),x.useEffect(()=>{const E=()=>{f(window.innerWidth<=768)};return window.addEventListener("resize",E),()=>window.removeEventListener("resize",E)},[]),x.useEffect(()=>{(async()=>{if(t!=null&&t.clinic_id)try{const D=await Z("/api/clinics/settings");if(D.ok){const O=await D.json();y(O.logoUrl)}else console.error("Failed to fetch clinic details for display:",D.statusText),y(null)}catch(D){console.error("Error fetching clinic details for display:",D),y(null)}else y(null)})()},[t==null?void 0:t.clinic_id]);const w=()=>{h(!d)},{toggleCommandBar:S,isOpen:_}=qo();return e.jsxs("div",{className:"dashboard-layout",children:[" ",e.jsxs("nav",{className:"app-header no-print",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("a",{href:"#",onClick:E=>{E.preventDefault(),o("/dashboard")},className:"logo-container",children:e.jsx("img",{src:g||"/logo.png",alt:"App Logo",className:"logo-image"})}),e.jsxs("div",{className:"title-section",children:[e.jsx("span",{className:"app-title-link",children:"Newtons Ai"}),e.jsxs("span",{className:"user-role-panel",children:["(",t.role.charAt(0).toUpperCase()+t.role.slice(1)," Panel)"]})]})]}),e.jsxs("div",{className:"header-right",children:[i&&e.jsxs("button",{onClick:l,className:"install-button",title:"Install App",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),e.jsx("span",{children:"Install"})]}),e.jsxs("a",{href:"https://store.newtons.in",target:"_blank",rel:"noopener noreferrer",className:"shop-button",title:"Visit Store",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z"})}),e.jsx("span",{children:"Shop"})]}),c&&(c.hasProPlan?e.jsx("span",{className:"pro-badge",children:"PRO"}):e.jsx("button",{onClick:()=>o("/start-clinic-subscription"),className:"go-pro-button",children:"GoPro"})),!_&&e.jsx("button",{onClick:S,className:"command-bar-button",title:"Search & Commands (Ctrl+K)",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]})}),e.jsx("button",{className:"hamburger-icon",onClick:w,"aria-label":"Open navigation",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 6h16M4 12h16M4 18h16"})})})]}),b&&e.jsx("div",{className:"global-loading-bar"})]}),e.jsxs("main",{className:"main-content",children:[e.jsx(ZR,{}),n]}),m?e.jsx(WR,{user:t,onLogout:a,userRole:t.role,isOpen:d,onClose:w,roleNavigation:jw}):e.jsx(KR,{user:t,onLogout:a,userRole:t.role,isOpen:d,onClose:w}),!m&&d&&e.jsx("div",{className:"side-panel-overlay",onClick:w}),!m&&d&&e.jsx("div",{className:"side-panel-overlay",onClick:w})]})},iB=({user:t})=>{const{isOpen:a,closeAssistant:n}=sm(),i=ft(),[l,c]=x.useState(null),[o,d]=x.useState([]);return x.useEffect(()=>{(async()=>{if(t!=null&&t.clinic_id)try{const[m,f]=await Promise.all([Z("/api/clinics/settings"),Z("/api/staff")]);m.ok&&c(await m.json()),f.ok&&d(await f.json())}catch(m){console.error("Failed to fetch initial AI context",m)}})()},[t.clinic_id]),a?e.jsx("div",{className:"ai-assistant-wrapper",children:e.jsx(sw,{onClose:n,settings:l,staffList:o,onSettingsUpdate:()=>{},onStaffUpdate:()=>{},onHighlight:h=>{h.forEach(m=>{if(m.startsWith("navigate_")){const f=m.replace("navigate_","");i(`/dashboard/analysis?section=${f}`)}else{const f=document.getElementById(m);f&&(f.scrollIntoView({behavior:"smooth",block:"center"}),f.classList.add("ai-highlight-glow"),setTimeout(()=>f.classList.remove("ai-highlight-glow"),2e3))}})}})}):null};XC.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(__,{client:D_,children:e.jsx(aB,{})})}));
