import{j as e,f as g,S as o,M as P,o as S}from"./index-D_kqlrGT.js";import{j as C,u as R,r as n,L as I}from"./react-vendor-Cc0P4_ZX.js";/* empty css                        *//* empty css                           */import{a0 as D,W as b,av as $,v as j,y as L}from"./ui-vendor-SmiJk_kJ.js";import{f as w}from"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const H=()=>{const{patientId:s}=C(),l=R(),[x,h]=n.useState([]),[v,c]=n.useState(!0),[u,d]=n.useState(null),[i,N]=n.useState(null),[y,p]=n.useState(null);n.useEffect(()=>{(async()=>{if(!s){d("Patient ID is missing from the URL."),c(!1);return}c(!0),d(null),h([]),p(null);try{const a=await g(`/api/patients/${s}`);if(a.ok){const m=await a.json();p(m.name||`Patient ID: ${s}`)}else console.warn(`Failed to fetch patient name for ID ${s}`),p(`Patient ID: ${s}`);const r=await g(`/api/lab/patient/${s}`);if(!r.ok){const m=await r.json().catch(()=>({}));throw new Error(m.message||`HTTP error! status: ${r.status}`)}const k=await r.json();h(k||[])}catch(a){console.error("Error fetching data:",a),d(`Failed to load data: ${a.message}`)}finally{c(!1)}})()},[s]);const f=t=>{t.report_content?l(`/lab/view-report/${t.id}`):l(`/lab/enter-report/${t.id}`)};return e.jsx("div",{className:"lab-inventory-container",children:e.jsxs("div",{className:"lab-inventory-card",children:[e.jsxs("div",{className:"lab-inventory-header no-print",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("h2",{style:{margin:0},children:["Lab Reports ",y?`for ${y}`:`for Patient ID: ${s}`]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsxs("button",{onClick:async()=>{if(!s){alert("Patient ID is missing. Cannot create a new report.");return}try{const t=await g("/api/lab/create-empty-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:s})});if(!t.ok){const r=await t.json().catch(()=>({message:`Failed to create new lab order: ${t.status}`}));throw new Error(r.message||`Failed to create new lab order: ${t.status}`)}const a=await t.json();l(`/lab/enter-report/${a.newOrderId}`)}catch(t){console.error("Error creating new lab order:",t),alert(`Error creating new lab order: ${t.message}`)}},className:"lab-inventory-button",disabled:!s,title:s?"Enter a new lab report for this patient":"Patient ID missing",children:[e.jsx(D,{size:16,style:{marginRight:"5px"}}),"Enter New Report"]}),e.jsxs("button",{onClick:()=>l(-1),className:"lab-inventory-button lab-inventory-button-secondary",children:[e.jsx(b,{size:16,style:{marginRight:"5px"}}),"Back"]})]})]}),e.jsx("div",{style:{marginTop:"20px"},children:v?e.jsx("div",{className:"skeleton-reports-list",children:[1,2,3].map(t=>e.jsxs("div",{className:"lab-inventory-card",style:{marginBottom:"15px",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx(o,{variant:"circular",width:24,height:24,style:{marginRight:"15px"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx(o,{width:"40%",height:20,style:{marginBottom:"8px"}}),e.jsx(o,{width:"60%",height:16})]})]}),e.jsx("div",{style:{marginLeft:"10px"},children:e.jsx(o,{width:80,height:24,style:{borderRadius:"12px"}})})]},t))}):u?e.jsxs("div",{className:"error-text",style:{textAlign:"center",padding:"20px"},children:[e.jsx($,{size:40,style:{marginBottom:"10px",color:"#721c24"}}),e.jsx("h3",{style:{fontSize:"1.2em",color:"#721c24",margin:"10px 0"},children:"Error Loading Reports"}),e.jsx("p",{children:u})]}):x.length===0?e.jsxs("div",{className:"no-data-message",style:{textAlign:"center",padding:"30px"},children:[e.jsx(j,{size:48,className:"mb-3",style:{margin:"0 auto 15px auto",display:"block"}}),e.jsx("p",{children:"No lab reports found for this patient."}),e.jsxs("p",{children:["You can ",e.jsx(I,{to:`/lab/create-order/${s}`,className:"lab-inventory-link",children:"create a new lab order"}),"."]})]}):i?e.jsxs("div",{className:"lab-inventory-card",style:{backgroundColor:"#fdfdfd"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsxs("h3",{className:"lab-inventory-header",style:{fontSize:"1.3em",borderBottom:"none",margin:0},children:["Report from: ",i.report_date?w(new Date(i.report_date),"PPP p"):"N/A"]}),e.jsxs("button",{onClick:()=>N(null),className:"lab-inventory-button lab-inventory-button-secondary",style:{fontSize:"0.9em",padding:"8px 12px"},children:[e.jsx(b,{size:16,style:{marginRight:"5px"}})," Back to List"]})]}),e.jsxs("p",{style:{marginBottom:"15px",fontSize:"1em"},children:[e.jsx("strong",{children:"Tests Ordered:"})," ",(i.tests||[]).map(t=>t.name).join(", ")]}),e.jsx("div",{className:"report-markdown-content",style:{fontSize:"1em",lineHeight:"1.6",border:"1px solid #eee",padding:"15px",borderRadius:"4px",background:"#fff"},children:e.jsx(P,{remarkPlugins:[S],children:i.report_content||"*No findings recorded.*"})})]}):e.jsx("ul",{style:{listStyle:"none",padding:"0",margin:"0"},children:x.map(t=>e.jsxs("li",{className:"lab-inventory-card",onClick:()=>f(t),tabIndex:0,onKeyPress:a=>a.key==="Enter"&&f(t),style:{marginBottom:"15px",cursor:"pointer",padding:"15px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(j,{size:24,style:{marginRight:"15px",color:"#007bff"}}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"1.1em"},children:["Order Date: ",w(new Date(t.createdAt),"PPP")]}),e.jsxs("div",{style:{fontSize:"0.9em",color:"#555"},children:["Tests: ",t.tests&&t.tests.length>0?t.tests.map(a=>a.name).join(", "):"N/A"]})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[t.status&&e.jsx("span",{className:E(t.status),children:z(t.status)}),e.jsx(L,{size:20,style:{color:"#6c757d"}})]})]},t.id))})})]})})},z=s=>{if(!s)return"Unknown";switch(s.toLowerCase()){case"pending":return"Pending Sample";case"collected":return"Sample Collected";case"processing":return"Processing";case"report_ready":return"Report Ready";case"completed":return"Completed";case"cancelled":return"Cancelled";default:return s.charAt(0).toUpperCase()+s.slice(1)}},E=s=>{if(!s)return"status-badge";switch(s.toLowerCase()){case"pending":return"status-badge status-pending";case"collected":return"status-badge status-collected";case"processing":return"status-badge status-processing";case"completed":return"status-badge status-completed";case"cancelled":return"status-badge status-cancelled";case"reported":return"status-badge status-reported";default:return"status-badge"}};export{H as default};
