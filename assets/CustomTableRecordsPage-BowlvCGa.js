import{f as c,j as e,E as $}from"./index-CRA8Xzko.js";import{j as z,u as P,r}from"./react-vendor-Cc0P4_ZX.js";/* empty css                         */import{W as A,$ as L,az as J,e as M,m as I,aa as B,X as F}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const H=()=>{const{id:l}=z(),k=P(),[o,w]=r.useState(null),[u,S]=r.useState([]),[E,b]=r.useState(!0),[y,R]=r.useState(null),[x,j]=r.useState(!1),[C,p]=r.useState(!1),[m,g]=r.useState(null),[n,i]=r.useState({});r.useEffect(()=>{l&&h()},[l]);const h=async()=>{b(!0);try{const s=await c(`/api/custom-tables/${l}`);if(!s.ok)throw new Error("Failed to fetch table definition");const a=await s.json();w(a);const t=await c(`/api/custom-tables/${l}/records`);if(!t.ok)throw new Error("Failed to fetch records");const d=await t.json();S(d)}catch(s){R(s.message)}finally{b(!1)}},f=s=>{s?(g(s),i({...s.data})):(g(null),i({})),p(!0)},O=async()=>{try{const s=m?`/api/custom-tables/records/${m.id}`:`/api/custom-tables/${l}/records`;if(!(await c(s,{method:m?"PUT":"POST",body:JSON.stringify({data:n})})).ok)throw new Error("Failed to save record");p(!1),h()}catch(s){alert(s.message)}},T=async s=>{if(confirm("Delete this record?"))try{await c(`/api/custom-tables/records/${s}`,{method:"DELETE"}),h()}catch(a){alert(a.message)}},D=s=>{const a=n[s.key]||"";switch(s.type){case"boolean":return e.jsxs("select",{value:a,onChange:t=>i({...n,[s.key]:t.target.value}),children:[e.jsx("option",{value:"",children:"Select..."}),e.jsx("option",{value:"true",children:"Yes"}),e.jsx("option",{value:"false",children:"No"})]});case"number":return e.jsx("input",{type:"number",value:a,onChange:t=>i({...n,[s.key]:t.target.value})});case"date":return e.jsx("input",{type:"date",value:a,onChange:t=>i({...n,[s.key]:t.target.value})});default:return e.jsx("input",{type:"text",value:a,onChange:t=>i({...n,[s.key]:t.target.value})})}};return E?e.jsx("div",{className:"p-4",children:"Loading..."}):y||!o?e.jsxs("div",{className:"p-4 error",children:["Error: ",y||"Table not found"]}):e.jsxs("div",{className:"custom-tables-container",children:[e.jsxs("div",{className:"header-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[e.jsx("button",{onClick:()=>k("/custom-tables"),className:"icon-button",children:e.jsx(A,{size:20})}),e.jsx("h1",{children:o.name})]}),e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>j(!1),className:`view-mode-btn ${x?"":"active"}`,title:"List View",children:[e.jsx(L,{size:18})," List"]}),e.jsxs("button",{onClick:()=>j(!0),className:`view-mode-btn ${x?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(J,{size:18})," Excel"]})]}),e.jsxs("button",{className:"primary-button",onClick:()=>f(),children:[e.jsx(M,{size:16})," Add Record"]})]}),e.jsx("div",{className:"table-wrapper",style:{background:"var(--bg-card)",borderRadius:"12px",padding:"20px",overflowX:"auto"},children:x?e.jsx($,{columns:o.columns.map(s=>({key:s.key,label:s.label,editable:!0,type:s.type})),data:u.map(s=>({...s.data,id:s.id})),editable:!0,showRowNumbers:!0,title:o.name,onSave:async s=>{const a=s.map(async t=>{const d=u.find(v=>v.id===t.id);if(d&&JSON.stringify(d.data)!==JSON.stringify(t)){const{id:v,...N}=t;if(JSON.stringify(d.data)!==JSON.stringify(N))return c(`/api/custom-tables/records/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:N})})}});try{await Promise.all(a),alert("Changes saved successfully"),h()}catch(t){alert("Error saving changes"),console.error(t)}}}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[o.columns.map(s=>e.jsx("th",{style:{textAlign:"left",padding:"12px",borderBottom:"1px solid var(--border-color)"},children:s.label},s.key)),e.jsx("th",{style:{width:"100px",padding:"12px",borderBottom:"1px solid var(--border-color)"},children:"Actions"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:o.columns.length+1,style:{padding:"20px",textAlign:"center",color:"var(--text-secondary)"},children:"No records yet"})}):u.map(s=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border-color)"},children:[o.columns.map(a=>e.jsx("td",{style:{padding:"12px"},children:a.type==="boolean"?s.data[a.key]==="true"?"Yes":"No":String(s.data[a.key]||"-")},a.key)),e.jsx("td",{style:{padding:"12px"},children:e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>f(s),className:"icon-button",children:e.jsx(I,{size:16})}),e.jsx("button",{onClick:()=>T(s.id),className:"icon-button",style:{color:"#dc3545"},children:e.jsx(B,{size:16})})]})})]},s.id))})]})}),C&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:m?"Edit Record":"Add New Record"}),e.jsx("button",{onClick:()=>p(!1),children:e.jsx(F,{size:20})})]}),e.jsx("div",{className:"modal-body",children:o.columns.map(s=>e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:s.label}),D(s)]},s.key))}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{onClick:O,className:"primary-button",children:"Save Record"})})]})})]})};export{H as default};
