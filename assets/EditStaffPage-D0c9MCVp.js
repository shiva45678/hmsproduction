import{f as x,j as e}from"./index-DpOfI1um.js";import{j as T,u as A,r as l}from"./react-vendor-Cc0P4_ZX.js";/* empty css                        */import{n as k,W as R,E as $,z,f as O}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const J=()=>{const{id:o}=T(),g=A(),[t,d]=l.useState({name:"",email:"",role:"receptionist",opd_fee:"",active:!0}),[m,j]=l.useState(""),[C,u]=l.useState(!0),[v,f]=l.useState(!1),[b,n]=l.useState(null),[N,c]=l.useState(null),[w,F]=l.useState([]),[y,E]=l.useState(!0),D=async()=>{try{const s=await x("/api/clinic-roles");if(s.ok){const a=await s.json();F(a)}}catch(s){console.error("Failed to fetch roles:",s)}finally{E(!1)}},S=l.useCallback(async()=>{if(!o){n("Staff ID is missing."),u(!1);return}u(!0),n(null),c(null);try{const s=await x(`/staff/${o}`);if(!s.ok){const r=await s.json();throw new Error(r.message||`HTTP error! status: ${s.status}`)}const a=await s.json();d({name:a.name,email:a.email,role:a.role,opd_fee:a.opd_fee??"",active:a.active})}catch(s){n(`Failed to load staff details: ${s.message}`)}finally{u(!1)}},[o]);l.useEffect(()=>{S(),D()},[S]);const i=s=>{const{name:a,value:r,type:h}=s.target;if(h==="checkbox"){const{checked:p}=s.target;d(L=>({...L,[a]:p}))}else d(p=>({...p,[a]:r}))},P=s=>{j(s.target.value)},_=async s=>{if(s.preventDefault(),!o){n("Staff ID is missing.");return}f(!0),n(null),c(null);const a={name:t.name,email:t.email,role:t.role,active:t.active};if(t.role==="doctor"){const r=t.opd_fee?parseFloat(String(t.opd_fee)):null;if(r!==null&&isNaN(r)){n("OPD Fee must be a valid number."),f(!1);return}a.opd_fee=r}else a.opd_fee=null;m.trim()!==""&&(a.password=m.trim());try{const r=await x(`/staff/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok){const h=await r.json();throw new Error(h.message||`HTTP error! status: ${r.status}`)}c("Staff details updated successfully!"),j(""),setTimeout(()=>g(-1),1500)}catch(r){n(`Failed to update staff: ${r.message}`)}finally{f(!1)}};return C?e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx(k,{className:"h-12 w-12 animate-spin text-teal-600"}),e.jsx("span",{className:"ml-4 text-xl text-gray-700",children:"Loading Staff Details..."})]}):e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:()=>g(-1),className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(R,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Edit Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),b&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx($,{size:18,className:"mr-2 text-red-500"}),b,e.jsx("button",{onClick:()=>n(null),className:"ml-auto text-red-600 hover:text-red-800 text-xl font-bold",children:"×"})]}),N&&e.jsxs("div",{className:"success-message mb-4 p-3 bg-green-100 border border-green-400 rounded-md flex items-center",children:[e.jsx(z,{size:18,className:"mr-2 text-green-500"}),N,e.jsx("button",{onClick:()=>c(null),className:"ml-auto text-green-600 hover:text-green-800 text-xl font-bold",children:"×"})]}),e.jsxs("form",{onSubmit:_,className:"staff-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"name",children:["Full Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"name",name:"name",value:t.name||"",onChange:i,required:!0,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"email",children:["Email Address ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",id:"email",name:"email",value:t.email||"",onChange:i,required:!0,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"role",children:["Role ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"role",name:"role",value:t.role||"receptionist",onChange:i,required:!0,disabled:y,children:y?e.jsx("option",{value:"",children:"Loading roles..."}):w.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"lab",children:"Lab Technician"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"})]}):w.map(s=>e.jsx("option",{value:s.key,children:s.name},s.key))})]}),t.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Fee (₹)"}),e.jsx("input",{type:"number",id:"opd_fee",name:"opd_fee",value:t.opd_fee||"",onChange:i,min:"0",step:"0.01",placeholder:"Enter OPD consultation fee (optional)"})]}),e.jsxs("div",{className:"form-group checkbox-group",children:[e.jsx("input",{id:"active",name:"active",type:"checkbox",checked:t.active??!0,onChange:i}),e.jsxs("label",{htmlFor:"active",className:"mb-0",children:[" ","Account Active"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"New Password (optional)"}),e.jsx("input",{type:"password",id:"password",name:"password",value:m,onChange:P,placeholder:"Leave blank to keep current password",autoComplete:"new-password"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter a new password only if you want to change it. Minimum 6 characters."})]}),e.jsx("button",{type:"submit",disabled:v,children:v?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{size:16,className:"mr-2"}),"Save Changes"]})})]})]})};export{J as default};
