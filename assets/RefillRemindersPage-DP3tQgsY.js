import{f as z,j as e}from"./index-jGjkutd2.js";import{r as a}from"./react-vendor-Cc0P4_ZX.js";import{A as O}from"./AddRecurringMedicationModal-C9edk6Tg.js";import{u as q}from"./useAutoFocusSingleInput-6a_v4dYJ.js";import{Z as w,i as L,m as F,a7 as $,a0 as Q,y as U}from"./ui-vendor-B5keALZQ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const X=()=>{const[p,b]=a.useState([]),[x,j]=a.useState(!0),[f,N]=a.useState(null),[r,y]=a.useState(""),[n,h]=a.useState(1),[c,S]=a.useState(1),[P,C]=a.useState(0),[D,o]=a.useState(!1),[T,d]=a.useState(void 0),k=10,l=a.useRef(null);q();const m=a.useCallback(async(t,s)=>{j(!0),N(null);try{let i=`/api/recurring-medications?page=${t}&limit=${k}`;s&&(i+=`&search=${encodeURIComponent(s)}`);const v=await z(i);if(!v.ok)throw new Error("Failed to fetch recurring medications.");const u=await v.json();b(u.medications),S(u.totalPages),C(u.total),h(u.page)}catch(i){console.error(i),N(i.message||"An error occurred while fetching data.")}finally{j(!1)}},[]);a.useEffect(()=>(l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{m(n,r)},500),()=>{l.current&&clearTimeout(l.current)}),[r,n,m]);const M=t=>{y(t.target.value),h(1)},g=t=>{t>=1&&t<=c&&h(t)},E=t=>{d(t),o(!0)},I=()=>{m(n,r),o(!1),d(void 0)},R=t=>t===30?"Every 30 Days (Monthly)":t===15?"Every 15 Days":`Every ${t} Days`,A=t=>{switch(t){case"active":return"status-pill status-pill-active";case"paused":return"status-pill status-pill-paused";case"cancelled":return"status-pill status-pill-cancelled";default:return"status-pill"}};return e.jsxs("div",{className:"refill-reminders-container",children:[e.jsxs("div",{className:"refill-header",children:[e.jsx("h3",{className:"refill-title",children:"Recurring Medications"}),e.jsxs("div",{className:"refill-actions",children:[e.jsxs("button",{className:"refill-action-button btn-add",onClick:()=>{d(void 0),o(!0)},children:[e.jsx(w,{size:16})," Add New"]}),e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Search patient, phone, medication...",value:r,onChange:M}),e.jsx(L,{size:18,className:"search-icon"})]})]})]}),f&&e.jsx("div",{className:"error-message-box",children:f}),e.jsx("div",{className:"refill-table-container",children:x?e.jsx("div",{className:"loading-pulse",children:"Loading..."}):p.length===0?e.jsx("div",{className:"empty-state",children:"No recurring medications found."}):e.jsx("div",{className:"refill-grouped-list",children:Object.values(p.reduce((t,s)=>{const i=s.patientId;return t[i]||(t[i]={patientId:s.patientId,patientName:s.patientName,patientPhone:s.patientPhone,patientToken:s.patientToken,medications:[]}),t[i].medications.push(s),t},{})).map(t=>e.jsxs("div",{className:"patient-medication-group-card",children:[e.jsxs("div",{className:"group-header",children:[e.jsxs("div",{className:"patient-info",children:[e.jsx("h4",{className:"patient-name",children:t.patientName}),e.jsxs("span",{className:"patient-meta",children:["Token: ",t.patientToken," • Phone: ",t.patientPhone]})]}),e.jsx("div",{className:"group-actions"})]}),e.jsxs("table",{className:"refill-table group-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Medication"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Frequency"}),e.jsx("th",{children:"Next Delivery"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:t.medications.map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"med-name",children:s.medicationName}),(s.tabletsPerDay||s.numberOfDays||s.directions)&&e.jsxs("div",{className:"med-usage-details",style:{fontSize:"0.8em",color:"#666"},children:[s.tabletsPerDay&&e.jsxs("span",{children:[s.tabletsPerDay," tabs/day • "]}),s.numberOfDays&&e.jsxs("span",{children:[s.numberOfDays," days "]})]}),s.notes&&e.jsxs("div",{className:"med-notes",children:["Note: ",s.notes]})]}),e.jsx("td",{children:s.quantity}),e.jsx("td",{children:e.jsx("span",{className:"frequency-badge",children:R(s.frequencyDays)})}),e.jsx("td",{children:e.jsx("div",{className:"date-display",children:new Date(s.nextDeliveryDate).toLocaleDateString()})}),e.jsx("td",{children:e.jsx("span",{className:A(s.status),children:s.status})}),e.jsx("td",{children:e.jsxs("div",{className:"action-buttons",children:[e.jsx("button",{className:"action-btn edit",title:"Edit",onClick:()=>E(s),children:e.jsx(F,{size:16})}),e.jsx("button",{className:"action-btn delete",title:"Delete/Cancel",children:e.jsx($,{size:16})})]})})]},s.id))})]})]},t.patientId))})}),!x&&c>1&&e.jsxs("div",{className:"pagination-container",children:[e.jsxs("span",{className:"pagination-info",children:["Page ",n," of ",c," (Total ",P,")"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsxs("button",{onClick:()=>g(n-1),disabled:n===1,className:"page-btn",children:[e.jsx(Q,{size:16})," Prev"]}),e.jsxs("button",{onClick:()=>g(n+1),disabled:n===c,className:"page-btn",children:["Next ",e.jsx(U,{size:16})]})]})]}),e.jsx(O,{isOpen:D,onClose:()=>{o(!1),d(void 0)},onSuccess:I,medication:T})]})};export{X as default};
