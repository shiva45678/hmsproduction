import{o as y,f as b,j as e}from"./index-B0SGsixC.js";import{u as v,r as c}from"./react-vendor-Cc0P4_ZX.js";import{W as C,i as k,X as F}from"./ui-vendor-CZgqa0n4.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const D=()=>{const h=v(),[s,p]=c.useState(""),[r,i]=c.useState([]),[o,n]=c.useState(!1),[d,x]=c.useState(!1),[j,m]=c.useState(!1),N=/^\+?[0-9\s\-().]{7,20}$/,g=c.useMemo(()=>y(async a=>{if(a.trim().length<2){i([]),n(!1);return}n(!0);try{const t=new URLSearchParams({search:encodeURIComponent(a),page:"1",limit:"8",sortBy:"name",sortOrder:"asc"}),l=await b(`/api/patients?${t.toString()}`);if(!l.ok)throw new Error("Failed to search");const w=await l.json();i(w.patients)}catch{i([])}finally{n(!1)}},300),[]),f=a=>{const t=a.target.value;p(t),x(N.test(t)),n(!0),m(!0),g(t)},u=c.useCallback(a=>{h("/billing",{state:{patientId:a.id,patientName:a.name}})},[h]),S=c.useCallback(async()=>{if(!(!s||!d)){n(!0);try{const t=await b("/api/patients",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"Direct Patient",phone:s,age:null,gender:null,token:null})});if(!t.ok)throw new Error("Failed to create patient");const l=await t.json();u(l)}catch(a){alert(`Error: ${a.message}`)}finally{n(!1)}}},[s,d,u]),P=a=>a.slice(0,1).toUpperCase();return e.jsxs("div",{className:"ccb-container",children:[e.jsxs("div",{className:"ccb-header-section",children:[e.jsx("button",{onClick:()=>h(-1),className:"ccb-back-button",title:"Go Back",children:e.jsx(C,{size:24})}),e.jsx("h1",{className:"ccb-title",children:"Create Custom Bill"}),e.jsx("p",{className:"ccb-subtitle",children:"Search for a patient to bill manually, or create a new one instantly."})]}),e.jsxs("div",{className:"ccb-search-wrapper",children:[e.jsx(k,{className:"ccb-search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Search by Name, Phone, or Token...",value:s,onChange:f,onFocus:()=>m(!0),className:"ccb-search-input",autoFocus:!0}),s&&e.jsx("div",{className:"ccb-clear-icon",onClick:()=>{p(""),i([]),m(!1)},children:e.jsx(F,{size:18})}),e.jsxs("div",{className:`ccb-results-dropdown ${j&&(r.length>0||o||s.length>2&&r.length===0)?"open":""}`,children:[o&&e.jsx("div",{className:"p-4 flex justify-center items-center",children:e.jsx("div",{className:"ccb-spinner"})}),!o&&r.map(a=>e.jsxs("div",{onClick:()=>u(a),className:"ccb-result-item",children:[e.jsxs("div",{className:"ccb-patient-info",children:[e.jsx("div",{className:"ccb-avatar",children:P(a.name)}),e.jsxs("div",{className:"ccb-patient-details",children:[e.jsx("h4",{children:a.name}),e.jsxs("p",{className:"ccb-patient-meta",children:[a.phone||"No phone"," • ",a.gender||"-"," • ",a.age?`${a.age}y`:"-"]})]})]}),e.jsxs("span",{className:"ccb-token-badge",children:["#",a.token]})]},a.id)),!o&&r.length===0&&s.length>2&&e.jsxs("div",{className:"ccb-create-action",children:[e.jsx("p",{className:"text-gray-500 mb-3 text-sm",children:"No patients found."}),d&&e.jsxs("button",{onClick:S,className:"ccb-create-btn w-full",children:["Create Patient with Phone ",s]})]})]})]})]})};export{D as default};
