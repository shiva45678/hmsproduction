import{f as C,j as e}from"./index-B0SGsixC.js";import{j as S,u as E,r as i}from"./react-vendor-Cc0P4_ZX.js";/* empty css                */import{X as D,a7 as u}from"./ui-vendor-CZgqa0n4.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const z=()=>{const{id:p}=S(),f=E(),[t,j]=i.useState(null),[_,h]=i.useState(!0),[d,r]=i.useState(null),[x,c]=i.useState(!1),[m,g]=i.useState(!1),b=i.useRef(null),v=i.useRef(null),N=i.useRef(null),y=i.useCallback(async()=>{if(!p){r("Drug ID is missing."),h(!1);return}h(!0),r(null);try{const l=await C(`/api/drugs/${p}`);if(!l.ok){const n=await l.json();throw new Error(n.message||`Failed to fetch drug: ${l.statusText}`)}let a=await l.json();a={...a,name:a.name||"",brand_name:a.brand_name||"",mrp:parseFloat(String(a.mrp))||0,rate:a.rate!==null&&a.rate!==void 0?parseFloat(String(a.rate)):null,stock:parseInt(String(a.stock),10)||0,gst:a.gst!==null&&a.gst!==void 0?parseFloat(String(a.gst)):null,margin:a.margin!==null&&a.margin!==void 0?parseFloat(String(a.margin)):null,discount:a.discount!==null&&a.discount!==void 0?parseFloat(String(a.discount)):null,batch:a.batch||"",hsn_code:a.hsn_code||"",mfg:a.mfg||"",loose:a.loose!==null&&a.loose!==void 0?parseInt(String(a.loose),10):null},j(a)}catch(l){console.error("Failed to fetch drug:",l),r(l.message||"Failed to load drug data. Please try again.")}finally{h(!1)}},[p]);i.useEffect(()=>{y()},[y]),i.useEffect(()=>{const l=n=>{n.key==="Tab"&&v.current===document.activeElement&&(m||(g(!0),setTimeout(()=>{var o;(o=N.current)==null||o.focus()},0),n.preventDefault()))},a=n=>{b.current&&!b.current.contains(n.target)&&g(!1)};return document.addEventListener("keydown",l),document.addEventListener("mousedown",a),()=>{document.removeEventListener("keydown",l),document.removeEventListener("mousedown",a)}},[m]);const s=l=>{const{name:a,value:n,type:o}=l.target;j(k=>k?{...k,[a]:o==="number"?parseFloat(n)||null:n}:null)},F=()=>{f(-1)},I=async l=>{if(l.preventDefault(),r(null),c(!0),!t||!t.id){r("Cannot edit drug: No drug data available."),c(!1);return}if(t.mrp===void 0||t.stock===void 0){r("MRP and Stock Quantity are required."),c(!1);return}const a={...t,name:t.name===""?null:t.name,brand_name:t.brand_name===""?null:t.brand_name,rate:t.rate===0?null:t.rate,expiry_date:t.expiry_date===""?null:t.expiry_date,gst:t.gst===0?null:t.gst,margin:t.margin===0?null:t.margin,discount:t.discount===0?null:t.discount,batch:t.batch===""?null:t.batch,hsn_code:t.hsn_code===""?null:t.hsn_code,mfg:t.mfg===""?null:t.mfg,loose:t.loose===0?null:t.loose};try{const n=await C(`/api/drugs/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!n.ok){const o=await n.json();throw new Error(o.message||`Failed to update drug: ${n.statusText}`)}await n.json(),f(-1)}catch(n){console.error("Failed to update drug:",n),r(n.message||"Failed to update drug. Please try again.")}finally{c(!1)}};return _?e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"loading-message",children:"Loading drug data..."})}):d&&!t?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"error-message-load",children:["Error: ",d]})}):t?e.jsx("div",{className:"edit-drug-form-page",children:e.jsxs("div",{className:"edit-drug-form-container",children:[e.jsxs("div",{className:"edit-drug-form-header",children:[e.jsxs("h2",{children:["Edit Drug: ",t.name]}),e.jsx("button",{onClick:F,className:"cancel-button",title:"Go Back",children:e.jsx(D,{size:24})})]}),d&&e.jsx("div",{className:"error-message-submit",children:d}),e.jsxs("form",{onSubmit:I,className:"edit-drug-form",children:[e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-name",className:"form-label",children:"Composition Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(u,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's composition. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"name",id:"edit-name",value:t.name||"",onChange:s,className:"custom-text-input",placeholder:"e.g., Paracetamol",tabIndex:1})," "]}),e.jsxs("div",{className:"sm-col-span-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-brand_name",className:"form-label",children:"Brand Name"})," ",e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(u,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the drug's brand name. This field is optional."})]})]}),e.jsx("input",{type:"text",name:"brand_name",id:"edit-brand_name",value:t.brand_name||"",onChange:s,className:"custom-text-input",placeholder:"e.g., Calpol",tabIndex:2})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-mrp",className:"form-label",children:"MRP (₹) *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(u,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the price for the pack size mentioned above. For example, if the pack is 10 tablets, enter the price for all 10 tablets."})]})]}),e.jsx("input",{type:"number",name:"mrp",id:"edit-mrp",required:!0,step:"0.01",min:"0",value:t.mrp||"",onChange:s,className:"custom-text-input",placeholder:"e.g., 500",tabIndex:3})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"edit-stock",className:"form-label",children:"Stock Quantity *"}),e.jsxs("div",{className:"relative ml-2 group",children:[e.jsx(u,{size:16,className:"text-gray-400"}),e.jsx("div",{className:"tooltip",children:"Enter the number of packs you have in stock. For example, if you have 5 strips of 10 tablets each, enter 5."})]})]}),e.jsx("input",{type:"number",name:"stock",id:"edit-stock",required:!0,step:"1",min:"0",value:t.stock||"",onChange:s,className:"custom-text-input",placeholder:"e.g., 5",tabIndex:4})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-pack",className:"form-label",children:"Pack (e.g., strip, bottle)"}),e.jsx("input",{type:"text",name:"pack",id:"edit-pack",value:t.pack||"",onChange:s,className:"custom-text-input",placeholder:"e.g., strip, bottle",tabIndex:5})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-expiry_date",className:"form-label",children:"Expiry Date"}),e.jsx("input",{type:"date",name:"expiry_date",id:"edit-expiry_date",value:t.expiry_date||"",onChange:s,className:"custom-text-input",tabIndex:6})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-box_number",className:"form-label",children:"Box Number"}),e.jsx("input",{type:"text",name:"box_number",id:"edit-box_number",value:t.box_number||"",onChange:s,className:"custom-text-input",tabIndex:7})]}),e.jsxs("div",{className:"relative sm-col-span-2",ref:b,children:[e.jsx("button",{type:"button",onClick:()=>g(!m),className:"form-button w-full text-left",tabIndex:8,ref:v,children:"Others"}),m&&e.jsxs("div",{className:"others-fields-grid",children:[" ",e.jsxs("div",{className:"sm-col-span-2",children:[e.jsx("label",{htmlFor:"edit-description",className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",id:"edit-description",rows:3,value:t.description||"",onChange:s,className:"custom-text-input",tabIndex:9})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-supplier",className:"form-label",children:"Supplier"}),e.jsx("input",{type:"text",name:"supplier",id:"edit-supplier",value:t.supplier||"",onChange:s,className:"custom-text-input",placeholder:"Optional",tabIndex:10})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-rate",className:"form-label",children:"Rate (₹)"}),e.jsx("input",{type:"number",name:"rate",id:"edit-rate",step:"0.01",min:"0",value:t.rate??"",onChange:s,placeholder:"Optional",className:"custom-text-input",tabIndex:11,ref:N})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-gst",className:"form-label",children:"GST (%)"}),e.jsx("input",{type:"number",name:"gst",id:"edit-gst",step:"0.01",min:"0",max:"100",value:t.gst??"",onChange:s,placeholder:"Optional",className:"custom-text-input",tabIndex:12})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-margin",className:"form-label",children:"Margin (%)"}),e.jsx("input",{type:"number",name:"margin",id:"edit-margin",step:"0.01",min:"0",max:"100",value:t.margin??"",onChange:s,placeholder:"Optional",className:"custom-text-input",tabIndex:13})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-discount",className:"form-label",children:"Discount (%)"}),e.jsx("input",{type:"number",name:"discount",id:"edit-discount",step:"0.01",min:"0",max:"100",value:t.discount??"",onChange:s,placeholder:"Optional",className:"custom-text-input",tabIndex:14})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-batch",className:"form-label",children:"Batch"}),e.jsx("input",{type:"text",name:"batch",id:"edit-batch",value:t.batch||"",onChange:s,className:"custom-text-input",placeholder:"Optional",tabIndex:15})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-hsn_code",className:"form-label",children:"HSN Code"}),e.jsx("input",{type:"text",name:"hsn_code",id:"edit-hsn_code",value:t.hsn_code||"",onChange:s,className:"custom-text-input",placeholder:"Optional",tabIndex:16})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-mfg",className:"form-label",children:"MFG"}),e.jsx("input",{type:"text",name:"mfg",id:"edit-mfg",value:t.mfg||"",onChange:s,className:"custom-text-input",placeholder:"Optional",tabIndex:17})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-loose",className:"form-label",children:"Loose"}),e.jsx("input",{type:"number",name:"loose",id:"edit-loose",step:"1",min:"0",value:t.loose??"",onChange:s,placeholder:"Optional",className:"custom-text-input",tabIndex:18})]})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",onClick:F,disabled:x,className:"form-button cancel-form-button",tabIndex:19,children:"Back"}),e.jsx("button",{type:"submit",disabled:x,className:"form-button submit-form-button",tabIndex:20,children:x?"Saving...":"Save Changes"})]})]})]})}):e.jsx("div",{className:"edit-drug-form-page",children:e.jsx("div",{className:"not-found-message",children:"Drug not found."})})};export{z as default};
