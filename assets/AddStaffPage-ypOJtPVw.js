import{j as e,f as j}from"./index-DE8wu5Ou.js";import{u as S,r as i}from"./react-vendor-Cc0P4_ZX.js";/* empty css                        */import{W as C,E as F,n as _,e as A}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const O=({clinicId:r})=>{const c=S(),[a,g]=i.useState({name:"",email:"",role:"receptionist",password:"",opd_fee:""}),[f,n]=i.useState(null),[t,p]=i.useState(!1),[u,b]=i.useState([]),[h,v]=i.useState(!0),y=async()=>{try{const s=await j("/api/clinic-roles");if(s.ok){const o=await s.json();b(o)}}catch(s){console.error("Failed to fetch roles:",s)}finally{v(!1)}};i.useEffect(()=>{n(r?null:"Clinic information is missing. Cannot add staff. Please ensure you are logged in correctly."),y()},[r]);const d=s=>{const{name:o,value:l}=s.target;g(m=>{const x={...m,[o]:l};return o==="role"&&l!=="doctor"&&(x.opd_fee=""),x})},N=async s=>{if(s.preventDefault(),n(null),!a.name||!a.email||!a.role||!a.password){n("Name, Email, Role, and Password are required.");return}if(!r){n("Clinic information is missing. Cannot add staff.");return}const o={...a,clinic_id:r,opd_fee:a.role==="doctor"&&a.opd_fee?parseFloat(String(a.opd_fee)):null};if(o.role==="doctor"&&a.opd_fee&&isNaN(o.opd_fee)){n("Invalid OPD Fee format. Please enter a number.");return}p(!0);try{const l=await j("/api/staff",{method:"POST",body:JSON.stringify(o)});if(!l.ok){const m=await l.json();throw new Error(m.message||"Server responded with an error")}c(-1)}catch(l){n(`Failed to add staff: ${l.message}`)}finally{p(!1)}},w=()=>{c(-1)};return e.jsxs("div",{className:"staff-page-container",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:w,className:"flex items-center text-sm text-gray-600 hover:text-gray-800 transition-colors","aria-label":"Go back",children:[e.jsx(C,{size:18,className:"mr-2"}),"Back"]}),e.jsx("h1",{children:"Add New Staff Member"}),e.jsx("div",{className:"w-16"})," "]}),f&&e.jsxs("div",{className:"error-message mb-4 p-3 bg-red-100 border border-red-400 rounded-md flex items-center",children:[e.jsx(F,{size:18,className:"mr-2 text-red-500"}),f]}),e.jsxs("form",{onSubmit:N,className:`staff-form ${r?"":"opacity-50 pointer-events-none"}`,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Full Name"}),e.jsx("input",{id:"name",type:"text",name:"name",value:a.name||"",onChange:d,required:!0,disabled:t||!r,placeholder:"Enter full name"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email Address"}),e.jsx("input",{id:"email",type:"email",name:"email",value:a.email||"",onChange:d,required:!0,disabled:t||!r,placeholder:"Enter email address"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"role",children:"Assign Role"}),e.jsx("select",{id:"role",name:"role",value:a.role||"receptionist",onChange:d,required:!0,disabled:t||!r||h,children:h?e.jsx("option",{value:"",children:"Loading roles..."}):u.length===0?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"receptionist",children:"Receptionist"}),e.jsx("option",{value:"doctor",children:"Doctor"}),e.jsx("option",{value:"pharmacy",children:"Pharmacist"}),e.jsx("option",{value:"lab",children:"Lab Technician"})]}):u.map(s=>e.jsx("option",{value:s.key,children:s.name},s.key))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"password",children:"Set Initial Password"}),e.jsx("input",{id:"password",type:"password",name:"password",value:a.password||"",onChange:d,required:!0,disabled:t||!r,placeholder:"Create a password"})]}),a.role==="doctor"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"opd_fee",children:"OPD Consultation Fee (â‚¹) (Optional)"}),e.jsx("input",{id:"opd_fee",type:"number",name:"opd_fee",value:a.opd_fee||"",onChange:d,step:"0.01",min:"0",placeholder:"e.g., 150.00",disabled:t||!r}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave blank if no specific fee is set for this doctor."})]}),e.jsxs("button",{type:"submit",disabled:t||!r,children:[t?e.jsx(_,{size:18,className:"animate-spin mr-2"}):e.jsx(A,{size:18,className:"mr-2"}),t?"Adding...":"Add Staff Member"]})]})]})};export{O as default};
