import{c as Ys,g as uc,R as Ti,r as x,j as i,S as Te,P as Rn,T as yt,d as Xs,a as Zs,F as eo,X as gn,f as W,e as dc,h as Ot,C as to,i as _r,k as xr,l as no,H as ro,Q as io,m as ao,M as Gt,n as Nt,o as so,q as pt,p as pc,s as hc,u as mc,t as fc,v as gc,w as ci,D as os,x as ls,E as yc,y as cs,z as us,B as xc,G as bc,L as wc,A as kc,I as Nc,J as _c,K as jc,N as vc,O as Cc,V as Sc,W as Tc,Y as Pc,Z as Ec,_ as Ic}from"./index-CxQiEUjb.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ac=[["path",{d:"M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z",key:"3c2336"}],["path",{d:"M8 8h8",key:"1bis0t"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m13 17-5-1h1a4 4 0 0 0 0-8",key:"nu2bwa"}]],oo=Ys("badge-indian-rupee",Ac);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dc=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],gt=Ys("pencil",Dc),Oc={};function Ui(e,n){const t=Oc,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,s=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return lo(e,r,s)}function lo(e,n,t){if($c(e)){if("value"in e)return e.type==="html"&&!t?"":e.value;if(n&&"alt"in e&&e.alt)return e.alt;if("children"in e)return ds(e.children,n,t)}return Array.isArray(e)?ds(e,n,t):""}function ds(e,n,t){const r=[];let s=-1;for(;++s<e.length;)r[s]=lo(e[s],n,t);return r.join("")}function $c(e){return!!(e&&typeof e=="object")}const ps=document.createElement("i");function Mi(e){const n="&"+e+";";ps.innerHTML=n;const t=ps.textContent;return t.charCodeAt(t.length-1)===59&&e!=="semi"||t===n?!1:t}function vt(e,n,t,r){const s=e.length;let a=0,o;if(n<0?n=-n>s?0:s+n:n=n>s?s:n,t=t>0?t:0,r.length<1e4)o=Array.from(r),o.unshift(n,t),e.splice(...o);else for(t&&e.splice(n,t);a<r.length;)o=r.slice(a,a+1e4),o.unshift(n,0),e.splice(...o),a+=1e4,n+=1e4}function ht(e,n){return e.length>0?(vt(e,e.length,0,n),e):n}const hs={}.hasOwnProperty;function Lc(e){const n={};let t=-1;for(;++t<e.length;)Rc(n,e[t]);return n}function Rc(e,n){let t;for(t in n){const s=(hs.call(e,t)?e[t]:void 0)||(e[t]={}),a=n[t];let o;if(a)for(o in a){hs.call(s,o)||(s[o]=[]);const l=a[o];Fc(s[o],Array.isArray(l)?l:l?[l]:[])}}}function Fc(e,n){let t=-1;const r=[];for(;++t<n.length;)(n[t].add==="after"?e:r).push(n[t]);vt(e,0,0,r)}function co(e,n){const t=Number.parseInt(e,n);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"�":String.fromCodePoint(t)}function hn(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const jt=Mt(/[A-Za-z]/),at=Mt(/[\dA-Za-z]/),zc=Mt(/[#-'*+\--9=?A-Z^-~]/);function Pi(e){return e!==null&&(e<32||e===127)}const Ei=Mt(/\d/),Bc=Mt(/[\dA-Fa-f]/),qc=Mt(/[!-/:-@[-`{-~]/);function fe(e){return e!==null&&e<-2}function Xe(e){return e!==null&&(e<0||e===32)}function Pe(e){return e===-2||e===-1||e===32}const Uc=Mt(new RegExp("\\p{P}|\\p{S}","u")),Mc=Mt(/\s/);function Mt(e){return n;function n(t){return t!==null&&t>-1&&e.test(String.fromCharCode(t))}}function yn(e){const n=[];let t=-1,r=0,s=0;for(;++t<e.length;){const a=e.charCodeAt(t);let o="";if(a===37&&at(e.charCodeAt(t+1))&&at(e.charCodeAt(t+2)))s=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(o=String.fromCharCode(a));else if(a>55295&&a<57344){const l=e.charCodeAt(t+1);a<56320&&l>56319&&l<57344?(o=String.fromCharCode(a,l),s=1):o="�"}else o=String.fromCharCode(a);o&&(n.push(e.slice(r,t),encodeURIComponent(o)),r=t+s+1,o=""),s&&(t+=s,s=0)}return n.join("")+e.slice(r)}function $e(e,n,t,r){const s=r?r-1:Number.POSITIVE_INFINITY;let a=0;return o;function o(u){return Pe(u)?(e.enter(t),l(u)):n(u)}function l(u){return Pe(u)&&a++<s?(e.consume(u),l):(e.exit(t),n(u))}}const Hc={tokenize:Vc};function Vc(e){const n=e.attempt(this.parser.constructs.contentInitial,r,s);let t;return n;function r(l){if(l===null){e.consume(l);return}return e.enter("lineEnding"),e.consume(l),e.exit("lineEnding"),$e(e,n,"linePrefix")}function s(l){return e.enter("paragraph"),a(l)}function a(l){const u=e.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=u),t=u,o(l)}function o(l){if(l===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(l);return}return fe(l)?(e.consume(l),e.exit("chunkText"),a):(e.consume(l),o)}}const Wc={tokenize:Jc},ms={tokenize:Qc};function Jc(e){const n=this,t=[];let r=0,s,a,o;return l;function l(L){if(r<t.length){const Y=t[r];return n.containerState=Y[1],e.attempt(Y[0].continuation,u,c)(L)}return c(L)}function u(L){if(r++,n.containerState._closeFlow){n.containerState._closeFlow=void 0,s&&J();const Y=n.events.length;let z=Y,j;for(;z--;)if(n.events[z][0]==="exit"&&n.events[z][1].type==="chunkFlow"){j=n.events[z][1].end;break}D(r);let Z=Y;for(;Z<n.events.length;)n.events[Z][1].end={...j},Z++;return vt(n.events,z+1,0,n.events.slice(Y)),n.events.length=Z,c(L)}return l(L)}function c(L){if(r===t.length){if(!s)return y(L);if(s.currentConstruct&&s.currentConstruct.concrete)return P(L);n.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return n.containerState={},e.check(ms,m,d)(L)}function m(L){return s&&J(),D(r),y(L)}function d(L){return n.parser.lazy[n.now().line]=r!==t.length,o=n.now().offset,P(L)}function y(L){return n.containerState={},e.attempt(ms,p,P)(L)}function p(L){return r++,t.push([n.currentConstruct,n.containerState]),y(L)}function P(L){if(L===null){s&&J(),D(0),e.consume(L);return}return s=s||n.parser.flow(n.now()),e.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:a}),B(L)}function B(L){if(L===null){G(e.exit("chunkFlow"),!0),D(0),e.consume(L);return}return fe(L)?(e.consume(L),G(e.exit("chunkFlow")),r=0,n.interrupt=void 0,l):(e.consume(L),B)}function G(L,Y){const z=n.sliceStream(L);if(Y&&z.push(null),L.previous=a,a&&(a.next=L),a=L,s.defineSkip(L.start),s.write(z),n.parser.lazy[L.start.line]){let j=s.events.length;for(;j--;)if(s.events[j][1].start.offset<o&&(!s.events[j][1].end||s.events[j][1].end.offset>o))return;const Z=n.events.length;let me=Z,re,ce;for(;me--;)if(n.events[me][0]==="exit"&&n.events[me][1].type==="chunkFlow"){if(re){ce=n.events[me][1].end;break}re=!0}for(D(r),j=Z;j<n.events.length;)n.events[j][1].end={...ce},j++;vt(n.events,me+1,0,n.events.slice(Z)),n.events.length=j}}function D(L){let Y=t.length;for(;Y-- >L;){const z=t[Y];n.containerState=z[1],z[0].exit.call(n,e)}t.length=L}function J(){s.write([null]),a=void 0,s=void 0,n.containerState._closeFlow=void 0}}function Qc(e,n,t){return $e(e,e.attempt(this.parser.constructs.document,n,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function wr(e){if(e===null||Xe(e)||Mc(e))return 1;if(Uc(e))return 2}function Hi(e,n,t){const r=[];let s=-1;for(;++s<e.length;){const a=e[s].resolveAll;a&&!r.includes(a)&&(n=a(n,t),r.push(a))}return n}const Ii={name:"attention",resolveAll:Gc,tokenize:Kc};function Gc(e,n){let t=-1,r,s,a,o,l,u,c,m;for(;++t<e.length;)if(e[t][0]==="enter"&&e[t][1].type==="attentionSequence"&&e[t][1]._close){for(r=t;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&n.sliceSerialize(e[r][1]).charCodeAt(0)===n.sliceSerialize(e[t][1]).charCodeAt(0)){if((e[r][1]._close||e[t][1]._open)&&(e[t][1].end.offset-e[t][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[t][1].end.offset-e[t][1].start.offset)%3))continue;u=e[r][1].end.offset-e[r][1].start.offset>1&&e[t][1].end.offset-e[t][1].start.offset>1?2:1;const d={...e[r][1].end},y={...e[t][1].start};fs(d,-u),fs(y,u),o={type:u>1?"strongSequence":"emphasisSequence",start:d,end:{...e[r][1].end}},l={type:u>1?"strongSequence":"emphasisSequence",start:{...e[t][1].start},end:y},a={type:u>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[t][1].start}},s={type:u>1?"strong":"emphasis",start:{...o.start},end:{...l.end}},e[r][1].end={...o.start},e[t][1].start={...l.end},c=[],e[r][1].end.offset-e[r][1].start.offset&&(c=ht(c,[["enter",e[r][1],n],["exit",e[r][1],n]])),c=ht(c,[["enter",s,n],["enter",o,n],["exit",o,n],["enter",a,n]]),c=ht(c,Hi(n.parser.constructs.insideSpan.null,e.slice(r+1,t),n)),c=ht(c,[["exit",a,n],["enter",l,n],["exit",l,n],["exit",s,n]]),e[t][1].end.offset-e[t][1].start.offset?(m=2,c=ht(c,[["enter",e[t][1],n],["exit",e[t][1],n]])):m=0,vt(e,r-1,t-r+3,c),t=r+c.length-m-2;break}}for(t=-1;++t<e.length;)e[t][1].type==="attentionSequence"&&(e[t][1].type="data");return e}function Kc(e,n){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,s=wr(r);let a;return o;function o(u){return a=u,e.enter("attentionSequence"),l(u)}function l(u){if(u===a)return e.consume(u),l;const c=e.exit("attentionSequence"),m=wr(u),d=!m||m===2&&s||t.includes(u),y=!s||s===2&&m||t.includes(r);return c._open=!!(a===42?d:d&&(s||!y)),c._close=!!(a===42?y:y&&(m||!d)),n(u)}}function fs(e,n){e.column+=n,e.offset+=n,e._bufferIndex+=n}const Yc={name:"autolink",tokenize:Xc};function Xc(e,n,t){let r=0;return s;function s(p){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),a}function a(p){return jt(p)?(e.consume(p),o):p===64?t(p):c(p)}function o(p){return p===43||p===45||p===46||at(p)?(r=1,l(p)):c(p)}function l(p){return p===58?(e.consume(p),r=0,u):(p===43||p===45||p===46||at(p))&&r++<32?(e.consume(p),l):(r=0,c(p))}function u(p){return p===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),n):p===null||p===32||p===60||Pi(p)?t(p):(e.consume(p),u)}function c(p){return p===64?(e.consume(p),m):zc(p)?(e.consume(p),c):t(p)}function m(p){return at(p)?d(p):t(p)}function d(p){return p===46?(e.consume(p),r=0,m):p===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),n):y(p)}function y(p){if((p===45||at(p))&&r++<63){const P=p===45?y:d;return e.consume(p),P}return t(p)}}const jr={partial:!0,tokenize:Zc};function Zc(e,n,t){return r;function r(a){return Pe(a)?$e(e,s,"linePrefix")(a):s(a)}function s(a){return a===null||fe(a)?n(a):t(a)}}const uo={continuation:{tokenize:tu},exit:nu,name:"blockQuote",tokenize:eu};function eu(e,n,t){const r=this;return s;function s(o){if(o===62){const l=r.containerState;return l.open||(e.enter("blockQuote",{_container:!0}),l.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(o),e.exit("blockQuoteMarker"),a}return t(o)}function a(o){return Pe(o)?(e.enter("blockQuotePrefixWhitespace"),e.consume(o),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),n):(e.exit("blockQuotePrefix"),n(o))}}function tu(e,n,t){const r=this;return s;function s(o){return Pe(o)?$e(e,a,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o):a(o)}function a(o){return e.attempt(uo,n,t)(o)}}function nu(e){e.exit("blockQuote")}const po={name:"characterEscape",tokenize:ru};function ru(e,n,t){return r;function r(a){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(a),e.exit("escapeMarker"),s}function s(a){return qc(a)?(e.enter("characterEscapeValue"),e.consume(a),e.exit("characterEscapeValue"),e.exit("characterEscape"),n):t(a)}}const ho={name:"characterReference",tokenize:iu};function iu(e,n,t){const r=this;let s=0,a,o;return l;function l(d){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),u}function u(d){return d===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(d),e.exit("characterReferenceMarkerNumeric"),c):(e.enter("characterReferenceValue"),a=31,o=at,m(d))}function c(d){return d===88||d===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(d),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),a=6,o=Bc,m):(e.enter("characterReferenceValue"),a=7,o=Ei,m(d))}function m(d){if(d===59&&s){const y=e.exit("characterReferenceValue");return o===at&&!Mi(r.sliceSerialize(y))?t(d):(e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),e.exit("characterReference"),n)}return o(d)&&s++<a?(e.consume(d),m):t(d)}}const gs={partial:!0,tokenize:su},ys={concrete:!0,name:"codeFenced",tokenize:au};function au(e,n,t){const r=this,s={partial:!0,tokenize:z};let a=0,o=0,l;return u;function u(j){return c(j)}function c(j){const Z=r.events[r.events.length-1];return a=Z&&Z[1].type==="linePrefix"?Z[2].sliceSerialize(Z[1],!0).length:0,l=j,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),m(j)}function m(j){return j===l?(o++,e.consume(j),m):o<3?t(j):(e.exit("codeFencedFenceSequence"),Pe(j)?$e(e,d,"whitespace")(j):d(j))}function d(j){return j===null||fe(j)?(e.exit("codeFencedFence"),r.interrupt?n(j):e.check(gs,B,Y)(j)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),y(j))}function y(j){return j===null||fe(j)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),d(j)):Pe(j)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),$e(e,p,"whitespace")(j)):j===96&&j===l?t(j):(e.consume(j),y)}function p(j){return j===null||fe(j)?d(j):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),P(j))}function P(j){return j===null||fe(j)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),d(j)):j===96&&j===l?t(j):(e.consume(j),P)}function B(j){return e.attempt(s,Y,G)(j)}function G(j){return e.enter("lineEnding"),e.consume(j),e.exit("lineEnding"),D}function D(j){return a>0&&Pe(j)?$e(e,J,"linePrefix",a+1)(j):J(j)}function J(j){return j===null||fe(j)?e.check(gs,B,Y)(j):(e.enter("codeFlowValue"),L(j))}function L(j){return j===null||fe(j)?(e.exit("codeFlowValue"),J(j)):(e.consume(j),L)}function Y(j){return e.exit("codeFenced"),n(j)}function z(j,Z,me){let re=0;return ce;function ce(O){return j.enter("lineEnding"),j.consume(O),j.exit("lineEnding"),V}function V(O){return j.enter("codeFencedFence"),Pe(O)?$e(j,F,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(O):F(O)}function F(O){return O===l?(j.enter("codeFencedFenceSequence"),I(O)):me(O)}function I(O){return O===l?(re++,j.consume(O),I):re>=o?(j.exit("codeFencedFenceSequence"),Pe(O)?$e(j,ye,"whitespace")(O):ye(O)):me(O)}function ye(O){return O===null||fe(O)?(j.exit("codeFencedFence"),Z(O)):me(O)}}}function su(e,n,t){const r=this;return s;function s(o){return o===null?t(o):(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),a)}function a(o){return r.parser.lazy[r.now().line]?t(o):n(o)}}const ui={name:"codeIndented",tokenize:lu},ou={partial:!0,tokenize:cu};function lu(e,n,t){const r=this;return s;function s(c){return e.enter("codeIndented"),$e(e,a,"linePrefix",5)(c)}function a(c){const m=r.events[r.events.length-1];return m&&m[1].type==="linePrefix"&&m[2].sliceSerialize(m[1],!0).length>=4?o(c):t(c)}function o(c){return c===null?u(c):fe(c)?e.attempt(ou,o,u)(c):(e.enter("codeFlowValue"),l(c))}function l(c){return c===null||fe(c)?(e.exit("codeFlowValue"),o(c)):(e.consume(c),l)}function u(c){return e.exit("codeIndented"),n(c)}}function cu(e,n,t){const r=this;return s;function s(o){return r.parser.lazy[r.now().line]?t(o):fe(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),s):$e(e,a,"linePrefix",5)(o)}function a(o){const l=r.events[r.events.length-1];return l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?n(o):fe(o)?s(o):t(o)}}const uu={name:"codeText",previous:pu,resolve:du,tokenize:hu};function du(e){let n=e.length-4,t=3,r,s;if((e[t][1].type==="lineEnding"||e[t][1].type==="space")&&(e[n][1].type==="lineEnding"||e[n][1].type==="space")){for(r=t;++r<n;)if(e[r][1].type==="codeTextData"){e[t][1].type="codeTextPadding",e[n][1].type="codeTextPadding",t+=2,n-=2;break}}for(r=t-1,n++;++r<=n;)s===void 0?r!==n&&e[r][1].type!=="lineEnding"&&(s=r):(r===n||e[r][1].type==="lineEnding")&&(e[s][1].type="codeTextData",r!==s+2&&(e[s][1].end=e[r-1][1].end,e.splice(s+2,r-s-2),n-=r-s-2,r=s+2),s=void 0);return e}function pu(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function hu(e,n,t){let r=0,s,a;return o;function o(d){return e.enter("codeText"),e.enter("codeTextSequence"),l(d)}function l(d){return d===96?(e.consume(d),r++,l):(e.exit("codeTextSequence"),u(d))}function u(d){return d===null?t(d):d===32?(e.enter("space"),e.consume(d),e.exit("space"),u):d===96?(a=e.enter("codeTextSequence"),s=0,m(d)):fe(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),u):(e.enter("codeTextData"),c(d))}function c(d){return d===null||d===32||d===96||fe(d)?(e.exit("codeTextData"),u(d)):(e.consume(d),c)}function m(d){return d===96?(e.consume(d),s++,m):s===r?(e.exit("codeTextSequence"),e.exit("codeText"),n(d)):(a.type="codeTextData",c(d))}}class mu{constructor(n){this.left=n?[...n]:[],this.right=[]}get(n){if(n<0||n>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+n+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return n<this.left.length?this.left[n]:this.right[this.right.length-n+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(n,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(n,r):n>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-n+this.left.length).reverse():this.left.slice(n).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(n,t,r){const s=t||0;this.setCursor(Math.trunc(n));const a=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&$n(this.left,r),a.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(n){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(n)}pushMany(n){this.setCursor(Number.POSITIVE_INFINITY),$n(this.left,n)}unshift(n){this.setCursor(0),this.right.push(n)}unshiftMany(n){this.setCursor(0),$n(this.right,n.reverse())}setCursor(n){if(!(n===this.left.length||n>this.left.length&&this.right.length===0||n<0&&this.left.length===0))if(n<this.left.length){const t=this.left.splice(n,Number.POSITIVE_INFINITY);$n(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-n,Number.POSITIVE_INFINITY);$n(this.left,t.reverse())}}}function $n(e,n){let t=0;if(n.length<1e4)e.push(...n);else for(;t<n.length;)e.push(...n.slice(t,t+1e4)),t+=1e4}function mo(e){const n={};let t=-1,r,s,a,o,l,u,c;const m=new mu(e);for(;++t<m.length;){for(;t in n;)t=n[t];if(r=m.get(t),t&&r[1].type==="chunkFlow"&&m.get(t-1)[1].type==="listItemPrefix"&&(u=r[1]._tokenizer.events,a=0,a<u.length&&u[a][1].type==="lineEndingBlank"&&(a+=2),a<u.length&&u[a][1].type==="content"))for(;++a<u.length&&u[a][1].type!=="content";)u[a][1].type==="chunkText"&&(u[a][1]._isInFirstContentOfListItem=!0,a++);if(r[0]==="enter")r[1].contentType&&(Object.assign(n,fu(m,t)),t=n[t],c=!0);else if(r[1]._container){for(a=t,s=void 0;a--;)if(o=m.get(a),o[1].type==="lineEnding"||o[1].type==="lineEndingBlank")o[0]==="enter"&&(s&&(m.get(s)[1].type="lineEndingBlank"),o[1].type="lineEnding",s=a);else if(!(o[1].type==="linePrefix"||o[1].type==="listItemIndent"))break;s&&(r[1].end={...m.get(s)[1].start},l=m.slice(s,t),l.unshift(r),m.splice(s,t-s+1,l))}}return vt(e,0,Number.POSITIVE_INFINITY,m.slice(0)),!c}function fu(e,n){const t=e.get(n)[1],r=e.get(n)[2];let s=n-1;const a=[];let o=t._tokenizer;o||(o=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(o._contentTypeTextTrailing=!0));const l=o.events,u=[],c={};let m,d,y=-1,p=t,P=0,B=0;const G=[B];for(;p;){for(;e.get(++s)[1]!==p;);a.push(s),p._tokenizer||(m=r.sliceStream(p),p.next||m.push(null),d&&o.defineSkip(p.start),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(m),p._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=t;++y<l.length;)l[y][0]==="exit"&&l[y-1][0]==="enter"&&l[y][1].type===l[y-1][1].type&&l[y][1].start.line!==l[y][1].end.line&&(B=y+1,G.push(B),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(o.events=[],p?(p._tokenizer=void 0,p.previous=void 0):G.pop(),y=G.length;y--;){const D=l.slice(G[y],G[y+1]),J=a.pop();u.push([J,J+D.length-1]),e.splice(J,2,D)}for(u.reverse(),y=-1;++y<u.length;)c[P+u[y][0]]=P+u[y][1],P+=u[y][1]-u[y][0]-1;return c}const gu={resolve:xu,tokenize:bu},yu={partial:!0,tokenize:wu};function xu(e){return mo(e),e}function bu(e,n){let t;return r;function r(l){return e.enter("content"),t=e.enter("chunkContent",{contentType:"content"}),s(l)}function s(l){return l===null?a(l):fe(l)?e.check(yu,o,a)(l):(e.consume(l),s)}function a(l){return e.exit("chunkContent"),e.exit("content"),n(l)}function o(l){return e.consume(l),e.exit("chunkContent"),t.next=e.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,s}}function wu(e,n,t){const r=this;return s;function s(o){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),$e(e,a,"linePrefix")}function a(o){if(o===null||fe(o))return t(o);const l=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&l&&l[1].type==="linePrefix"&&l[2].sliceSerialize(l[1],!0).length>=4?n(o):e.interrupt(r.parser.constructs.flow,t,n)(o)}}function fo(e,n,t,r,s,a,o,l,u){const c=u||Number.POSITIVE_INFINITY;let m=0;return d;function d(D){return D===60?(e.enter(r),e.enter(s),e.enter(a),e.consume(D),e.exit(a),y):D===null||D===32||D===41||Pi(D)?t(D):(e.enter(r),e.enter(o),e.enter(l),e.enter("chunkString",{contentType:"string"}),B(D))}function y(D){return D===62?(e.enter(a),e.consume(D),e.exit(a),e.exit(s),e.exit(r),n):(e.enter(l),e.enter("chunkString",{contentType:"string"}),p(D))}function p(D){return D===62?(e.exit("chunkString"),e.exit(l),y(D)):D===null||D===60||fe(D)?t(D):(e.consume(D),D===92?P:p)}function P(D){return D===60||D===62||D===92?(e.consume(D),p):p(D)}function B(D){return!m&&(D===null||D===41||Xe(D))?(e.exit("chunkString"),e.exit(l),e.exit(o),e.exit(r),n(D)):m<c&&D===40?(e.consume(D),m++,B):D===41?(e.consume(D),m--,B):D===null||D===32||D===40||Pi(D)?t(D):(e.consume(D),D===92?G:B)}function G(D){return D===40||D===41||D===92?(e.consume(D),B):B(D)}}function go(e,n,t,r,s,a){const o=this;let l=0,u;return c;function c(p){return e.enter(r),e.enter(s),e.consume(p),e.exit(s),e.enter(a),m}function m(p){return l>999||p===null||p===91||p===93&&!u||p===94&&!l&&"_hiddenFootnoteSupport"in o.parser.constructs?t(p):p===93?(e.exit(a),e.enter(s),e.consume(p),e.exit(s),e.exit(r),n):fe(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),m):(e.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===null||p===91||p===93||fe(p)||l++>999?(e.exit("chunkString"),m(p)):(e.consume(p),u||(u=!Pe(p)),p===92?y:d)}function y(p){return p===91||p===92||p===93?(e.consume(p),l++,d):d(p)}}function yo(e,n,t,r,s,a){let o;return l;function l(y){return y===34||y===39||y===40?(e.enter(r),e.enter(s),e.consume(y),e.exit(s),o=y===40?41:y,u):t(y)}function u(y){return y===o?(e.enter(s),e.consume(y),e.exit(s),e.exit(r),n):(e.enter(a),c(y))}function c(y){return y===o?(e.exit(a),u(o)):y===null?t(y):fe(y)?(e.enter("lineEnding"),e.consume(y),e.exit("lineEnding"),$e(e,c,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),m(y))}function m(y){return y===o||y===null||fe(y)?(e.exit("chunkString"),c(y)):(e.consume(y),y===92?d:m)}function d(y){return y===o||y===92?(e.consume(y),m):m(y)}}function Fn(e,n){let t;return r;function r(s){return fe(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),t=!0,r):Pe(s)?$e(e,r,t?"linePrefix":"lineSuffix")(s):n(s)}}const ku={name:"definition",tokenize:_u},Nu={partial:!0,tokenize:ju};function _u(e,n,t){const r=this;let s;return a;function a(p){return e.enter("definition"),o(p)}function o(p){return go.call(r,e,l,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function l(p){return s=hn(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(e.enter("definitionMarker"),e.consume(p),e.exit("definitionMarker"),u):t(p)}function u(p){return Xe(p)?Fn(e,c)(p):c(p)}function c(p){return fo(e,m,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function m(p){return e.attempt(Nu,d,d)(p)}function d(p){return Pe(p)?$e(e,y,"whitespace")(p):y(p)}function y(p){return p===null||fe(p)?(e.exit("definition"),r.parser.defined.push(s),n(p)):t(p)}}function ju(e,n,t){return r;function r(l){return Xe(l)?Fn(e,s)(l):t(l)}function s(l){return yo(e,a,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(l)}function a(l){return Pe(l)?$e(e,o,"whitespace")(l):o(l)}function o(l){return l===null||fe(l)?n(l):t(l)}}const vu={name:"hardBreakEscape",tokenize:Cu};function Cu(e,n,t){return r;function r(a){return e.enter("hardBreakEscape"),e.consume(a),s}function s(a){return fe(a)?(e.exit("hardBreakEscape"),n(a)):t(a)}}const Su={name:"headingAtx",resolve:Tu,tokenize:Pu};function Tu(e,n){let t=e.length-2,r=3,s,a;return e[r][1].type==="whitespace"&&(r+=2),t-2>r&&e[t][1].type==="whitespace"&&(t-=2),e[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&e[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(s={type:"atxHeadingText",start:e[r][1].start,end:e[t][1].end},a={type:"chunkText",start:e[r][1].start,end:e[t][1].end,contentType:"text"},vt(e,r,t-r+1,[["enter",s,n],["enter",a,n],["exit",a,n],["exit",s,n]])),e}function Pu(e,n,t){let r=0;return s;function s(m){return e.enter("atxHeading"),a(m)}function a(m){return e.enter("atxHeadingSequence"),o(m)}function o(m){return m===35&&r++<6?(e.consume(m),o):m===null||Xe(m)?(e.exit("atxHeadingSequence"),l(m)):t(m)}function l(m){return m===35?(e.enter("atxHeadingSequence"),u(m)):m===null||fe(m)?(e.exit("atxHeading"),n(m)):Pe(m)?$e(e,l,"whitespace")(m):(e.enter("atxHeadingText"),c(m))}function u(m){return m===35?(e.consume(m),u):(e.exit("atxHeadingSequence"),l(m))}function c(m){return m===null||m===35||Xe(m)?(e.exit("atxHeadingText"),l(m)):(e.consume(m),c)}}const Eu=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],xs=["pre","script","style","textarea"],Iu={concrete:!0,name:"htmlFlow",resolveTo:Ou,tokenize:$u},Au={partial:!0,tokenize:Ru},Du={partial:!0,tokenize:Lu};function Ou(e){let n=e.length;for(;n--&&!(e[n][0]==="enter"&&e[n][1].type==="htmlFlow"););return n>1&&e[n-2][1].type==="linePrefix"&&(e[n][1].start=e[n-2][1].start,e[n+1][1].start=e[n-2][1].start,e.splice(n-2,2)),e}function $u(e,n,t){const r=this;let s,a,o,l,u;return c;function c(b){return m(b)}function m(b){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(b),d}function d(b){return b===33?(e.consume(b),y):b===47?(e.consume(b),a=!0,B):b===63?(e.consume(b),s=3,r.interrupt?n:w):jt(b)?(e.consume(b),o=String.fromCharCode(b),G):t(b)}function y(b){return b===45?(e.consume(b),s=2,p):b===91?(e.consume(b),s=5,l=0,P):jt(b)?(e.consume(b),s=4,r.interrupt?n:w):t(b)}function p(b){return b===45?(e.consume(b),r.interrupt?n:w):t(b)}function P(b){const De="CDATA[";return b===De.charCodeAt(l++)?(e.consume(b),l===De.length?r.interrupt?n:F:P):t(b)}function B(b){return jt(b)?(e.consume(b),o=String.fromCharCode(b),G):t(b)}function G(b){if(b===null||b===47||b===62||Xe(b)){const De=b===47,Ve=o.toLowerCase();return!De&&!a&&xs.includes(Ve)?(s=1,r.interrupt?n(b):F(b)):Eu.includes(o.toLowerCase())?(s=6,De?(e.consume(b),D):r.interrupt?n(b):F(b)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(b):a?J(b):L(b))}return b===45||at(b)?(e.consume(b),o+=String.fromCharCode(b),G):t(b)}function D(b){return b===62?(e.consume(b),r.interrupt?n:F):t(b)}function J(b){return Pe(b)?(e.consume(b),J):ce(b)}function L(b){return b===47?(e.consume(b),ce):b===58||b===95||jt(b)?(e.consume(b),Y):Pe(b)?(e.consume(b),L):ce(b)}function Y(b){return b===45||b===46||b===58||b===95||at(b)?(e.consume(b),Y):z(b)}function z(b){return b===61?(e.consume(b),j):Pe(b)?(e.consume(b),z):L(b)}function j(b){return b===null||b===60||b===61||b===62||b===96?t(b):b===34||b===39?(e.consume(b),u=b,Z):Pe(b)?(e.consume(b),j):me(b)}function Z(b){return b===u?(e.consume(b),u=null,re):b===null||fe(b)?t(b):(e.consume(b),Z)}function me(b){return b===null||b===34||b===39||b===47||b===60||b===61||b===62||b===96||Xe(b)?z(b):(e.consume(b),me)}function re(b){return b===47||b===62||Pe(b)?L(b):t(b)}function ce(b){return b===62?(e.consume(b),V):t(b)}function V(b){return b===null||fe(b)?F(b):Pe(b)?(e.consume(b),V):t(b)}function F(b){return b===45&&s===2?(e.consume(b),K):b===60&&s===1?(e.consume(b),H):b===62&&s===4?(e.consume(b),ze):b===63&&s===3?(e.consume(b),w):b===93&&s===5?(e.consume(b),de):fe(b)&&(s===6||s===7)?(e.exit("htmlFlowData"),e.check(Au,ke,I)(b)):b===null||fe(b)?(e.exit("htmlFlowData"),I(b)):(e.consume(b),F)}function I(b){return e.check(Du,ye,ke)(b)}function ye(b){return e.enter("lineEnding"),e.consume(b),e.exit("lineEnding"),O}function O(b){return b===null||fe(b)?I(b):(e.enter("htmlFlowData"),F(b))}function K(b){return b===45?(e.consume(b),w):F(b)}function H(b){return b===47?(e.consume(b),o="",Se):F(b)}function Se(b){if(b===62){const De=o.toLowerCase();return xs.includes(De)?(e.consume(b),ze):F(b)}return jt(b)&&o.length<8?(e.consume(b),o+=String.fromCharCode(b),Se):F(b)}function de(b){return b===93?(e.consume(b),w):F(b)}function w(b){return b===62?(e.consume(b),ze):b===45&&s===2?(e.consume(b),w):F(b)}function ze(b){return b===null||fe(b)?(e.exit("htmlFlowData"),ke(b)):(e.consume(b),ze)}function ke(b){return e.exit("htmlFlow"),n(b)}}function Lu(e,n,t){const r=this;return s;function s(o){return fe(o)?(e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),a):t(o)}function a(o){return r.parser.lazy[r.now().line]?t(o):n(o)}}function Ru(e,n,t){return r;function r(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),e.attempt(jr,n,t)}}const Fu={name:"htmlText",tokenize:zu};function zu(e,n,t){const r=this;let s,a,o;return l;function l(w){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(w),u}function u(w){return w===33?(e.consume(w),c):w===47?(e.consume(w),z):w===63?(e.consume(w),L):jt(w)?(e.consume(w),me):t(w)}function c(w){return w===45?(e.consume(w),m):w===91?(e.consume(w),a=0,P):jt(w)?(e.consume(w),J):t(w)}function m(w){return w===45?(e.consume(w),p):t(w)}function d(w){return w===null?t(w):w===45?(e.consume(w),y):fe(w)?(o=d,H(w)):(e.consume(w),d)}function y(w){return w===45?(e.consume(w),p):d(w)}function p(w){return w===62?K(w):w===45?y(w):d(w)}function P(w){const ze="CDATA[";return w===ze.charCodeAt(a++)?(e.consume(w),a===ze.length?B:P):t(w)}function B(w){return w===null?t(w):w===93?(e.consume(w),G):fe(w)?(o=B,H(w)):(e.consume(w),B)}function G(w){return w===93?(e.consume(w),D):B(w)}function D(w){return w===62?K(w):w===93?(e.consume(w),D):B(w)}function J(w){return w===null||w===62?K(w):fe(w)?(o=J,H(w)):(e.consume(w),J)}function L(w){return w===null?t(w):w===63?(e.consume(w),Y):fe(w)?(o=L,H(w)):(e.consume(w),L)}function Y(w){return w===62?K(w):L(w)}function z(w){return jt(w)?(e.consume(w),j):t(w)}function j(w){return w===45||at(w)?(e.consume(w),j):Z(w)}function Z(w){return fe(w)?(o=Z,H(w)):Pe(w)?(e.consume(w),Z):K(w)}function me(w){return w===45||at(w)?(e.consume(w),me):w===47||w===62||Xe(w)?re(w):t(w)}function re(w){return w===47?(e.consume(w),K):w===58||w===95||jt(w)?(e.consume(w),ce):fe(w)?(o=re,H(w)):Pe(w)?(e.consume(w),re):K(w)}function ce(w){return w===45||w===46||w===58||w===95||at(w)?(e.consume(w),ce):V(w)}function V(w){return w===61?(e.consume(w),F):fe(w)?(o=V,H(w)):Pe(w)?(e.consume(w),V):re(w)}function F(w){return w===null||w===60||w===61||w===62||w===96?t(w):w===34||w===39?(e.consume(w),s=w,I):fe(w)?(o=F,H(w)):Pe(w)?(e.consume(w),F):(e.consume(w),ye)}function I(w){return w===s?(e.consume(w),s=void 0,O):w===null?t(w):fe(w)?(o=I,H(w)):(e.consume(w),I)}function ye(w){return w===null||w===34||w===39||w===60||w===61||w===96?t(w):w===47||w===62||Xe(w)?re(w):(e.consume(w),ye)}function O(w){return w===47||w===62||Xe(w)?re(w):t(w)}function K(w){return w===62?(e.consume(w),e.exit("htmlTextData"),e.exit("htmlText"),n):t(w)}function H(w){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(w),e.exit("lineEnding"),Se}function Se(w){return Pe(w)?$e(e,de,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(w):de(w)}function de(w){return e.enter("htmlTextData"),o(w)}}const Vi={name:"labelEnd",resolveAll:Mu,resolveTo:Hu,tokenize:Vu},Bu={tokenize:Wu},qu={tokenize:Ju},Uu={tokenize:Qu};function Mu(e){let n=-1;const t=[];for(;++n<e.length;){const r=e[n][1];if(t.push(e[n]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",n+=s}}return e.length!==t.length&&vt(e,0,e.length,t),e}function Hu(e,n){let t=e.length,r=0,s,a,o,l;for(;t--;)if(s=e[t][1],a){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;e[t][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(o){if(e[t][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(a=t,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(o=t);const u={type:e[a][1].type==="labelLink"?"link":"image",start:{...e[a][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[a][1].start},end:{...e[o][1].end}},m={type:"labelText",start:{...e[a+r+2][1].end},end:{...e[o-2][1].start}};return l=[["enter",u,n],["enter",c,n]],l=ht(l,e.slice(a+1,a+r+3)),l=ht(l,[["enter",m,n]]),l=ht(l,Hi(n.parser.constructs.insideSpan.null,e.slice(a+r+4,o-3),n)),l=ht(l,[["exit",m,n],e[o-2],e[o-1],["exit",c,n]]),l=ht(l,e.slice(o+1)),l=ht(l,[["exit",u,n]]),vt(e,a,e.length,l),e}function Vu(e,n,t){const r=this;let s=r.events.length,a,o;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){a=r.events[s][1];break}return l;function l(y){return a?a._inactive?d(y):(o=r.parser.defined.includes(hn(r.sliceSerialize({start:a.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(y),e.exit("labelMarker"),e.exit("labelEnd"),u):t(y)}function u(y){return y===40?e.attempt(Bu,m,o?m:d)(y):y===91?e.attempt(qu,m,o?c:d)(y):o?m(y):d(y)}function c(y){return e.attempt(Uu,m,d)(y)}function m(y){return n(y)}function d(y){return a._balanced=!0,t(y)}}function Wu(e,n,t){return r;function r(d){return e.enter("resource"),e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),s}function s(d){return Xe(d)?Fn(e,a)(d):a(d)}function a(d){return d===41?m(d):fo(e,o,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function o(d){return Xe(d)?Fn(e,u)(d):m(d)}function l(d){return t(d)}function u(d){return d===34||d===39||d===40?yo(e,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):m(d)}function c(d){return Xe(d)?Fn(e,m)(d):m(d)}function m(d){return d===41?(e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),e.exit("resource"),n):t(d)}}function Ju(e,n,t){const r=this;return s;function s(l){return go.call(r,e,a,o,"reference","referenceMarker","referenceString")(l)}function a(l){return r.parser.defined.includes(hn(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?n(l):t(l)}function o(l){return t(l)}}function Qu(e,n,t){return r;function r(a){return e.enter("reference"),e.enter("referenceMarker"),e.consume(a),e.exit("referenceMarker"),s}function s(a){return a===93?(e.enter("referenceMarker"),e.consume(a),e.exit("referenceMarker"),e.exit("reference"),n):t(a)}}const Gu={name:"labelStartImage",resolveAll:Vi.resolveAll,tokenize:Ku};function Ku(e,n,t){const r=this;return s;function s(l){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(l),e.exit("labelImageMarker"),a}function a(l){return l===91?(e.enter("labelMarker"),e.consume(l),e.exit("labelMarker"),e.exit("labelImage"),o):t(l)}function o(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(l):n(l)}}const Yu={name:"labelStartLink",resolveAll:Vi.resolveAll,tokenize:Xu};function Xu(e,n,t){const r=this;return s;function s(o){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(o),e.exit("labelMarker"),e.exit("labelLink"),a}function a(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):n(o)}}const di={name:"lineEnding",tokenize:Zu};function Zu(e,n){return t;function t(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),$e(e,n,"linePrefix")}}const br={name:"thematicBreak",tokenize:ed};function ed(e,n,t){let r=0,s;return a;function a(c){return e.enter("thematicBreak"),o(c)}function o(c){return s=c,l(c)}function l(c){return c===s?(e.enter("thematicBreakSequence"),u(c)):r>=3&&(c===null||fe(c))?(e.exit("thematicBreak"),n(c)):t(c)}function u(c){return c===s?(e.consume(c),r++,u):(e.exit("thematicBreakSequence"),Pe(c)?$e(e,l,"whitespace")(c):l(c))}}const Ye={continuation:{tokenize:id},exit:sd,name:"list",tokenize:rd},td={partial:!0,tokenize:od},nd={partial:!0,tokenize:ad};function rd(e,n,t){const r=this,s=r.events[r.events.length-1];let a=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,o=0;return l;function l(p){const P=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(P==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:Ei(p)){if(r.containerState.type||(r.containerState.type=P,e.enter(P,{_container:!0})),P==="listUnordered")return e.enter("listItemPrefix"),p===42||p===45?e.check(br,t,c)(p):c(p);if(!r.interrupt||p===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),u(p)}return t(p)}function u(p){return Ei(p)&&++o<10?(e.consume(p),u):(!r.interrupt||o<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(e.exit("listItemValue"),c(p)):t(p)}function c(p){return e.enter("listItemMarker"),e.consume(p),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,e.check(jr,r.interrupt?t:m,e.attempt(td,y,d))}function m(p){return r.containerState.initialBlankLine=!0,a++,y(p)}function d(p){return Pe(p)?(e.enter("listItemPrefixWhitespace"),e.consume(p),e.exit("listItemPrefixWhitespace"),y):t(p)}function y(p){return r.containerState.size=a+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,n(p)}}function id(e,n,t){const r=this;return r.containerState._closeFlow=void 0,e.check(jr,s,a);function s(l){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,$e(e,n,"listItemIndent",r.containerState.size+1)(l)}function a(l){return r.containerState.furtherBlankLines||!Pe(l)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,o(l)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(nd,n,o)(l))}function o(l){return r.containerState._closeFlow=!0,r.interrupt=void 0,$e(e,e.attempt(Ye,n,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l)}}function ad(e,n,t){const r=this;return $e(e,s,"listItemIndent",r.containerState.size+1);function s(a){const o=r.events[r.events.length-1];return o&&o[1].type==="listItemIndent"&&o[2].sliceSerialize(o[1],!0).length===r.containerState.size?n(a):t(a)}}function sd(e){e.exit(this.containerState.type)}function od(e,n,t){const r=this;return $e(e,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(a){const o=r.events[r.events.length-1];return!Pe(a)&&o&&o[1].type==="listItemPrefixWhitespace"?n(a):t(a)}}const bs={name:"setextUnderline",resolveTo:ld,tokenize:cd};function ld(e,n){let t=e.length,r,s,a;for(;t--;)if(e[t][0]==="enter"){if(e[t][1].type==="content"){r=t;break}e[t][1].type==="paragraph"&&(s=t)}else e[t][1].type==="content"&&e.splice(t,1),!a&&e[t][1].type==="definition"&&(a=t);const o={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[s][1].type="setextHeadingText",a?(e.splice(s,0,["enter",o,n]),e.splice(a+1,0,["exit",e[r][1],n]),e[r][1].end={...e[a][1].end}):e[r][1]=o,e.push(["exit",o,n]),e}function cd(e,n,t){const r=this;let s;return a;function a(c){let m=r.events.length,d;for(;m--;)if(r.events[m][1].type!=="lineEnding"&&r.events[m][1].type!=="linePrefix"&&r.events[m][1].type!=="content"){d=r.events[m][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(e.enter("setextHeadingLine"),s=c,o(c)):t(c)}function o(c){return e.enter("setextHeadingLineSequence"),l(c)}function l(c){return c===s?(e.consume(c),l):(e.exit("setextHeadingLineSequence"),Pe(c)?$e(e,u,"lineSuffix")(c):u(c))}function u(c){return c===null||fe(c)?(e.exit("setextHeadingLine"),n(c)):t(c)}}const ud={tokenize:dd};function dd(e){const n=this,t=e.attempt(jr,r,e.attempt(this.parser.constructs.flowInitial,s,$e(e,e.attempt(this.parser.constructs.flow,s,e.attempt(gu,s)),"linePrefix")));return t;function r(a){if(a===null){e.consume(a);return}return e.enter("lineEndingBlank"),e.consume(a),e.exit("lineEndingBlank"),n.currentConstruct=void 0,t}function s(a){if(a===null){e.consume(a);return}return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),n.currentConstruct=void 0,t}}const pd={resolveAll:bo()},hd=xo("string"),md=xo("text");function xo(e){return{resolveAll:bo(e==="text"?fd:void 0),tokenize:n};function n(t){const r=this,s=this.parser.constructs[e],a=t.attempt(s,o,l);return o;function o(m){return c(m)?a(m):l(m)}function l(m){if(m===null){t.consume(m);return}return t.enter("data"),t.consume(m),u}function u(m){return c(m)?(t.exit("data"),a(m)):(t.consume(m),u)}function c(m){if(m===null)return!0;const d=s[m];let y=-1;if(d)for(;++y<d.length;){const p=d[y];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function bo(e){return n;function n(t,r){let s=-1,a;for(;++s<=t.length;)a===void 0?t[s]&&t[s][1].type==="data"&&(a=s,s++):(!t[s]||t[s][1].type!=="data")&&(s!==a+2&&(t[a][1].end=t[s-1][1].end,t.splice(a+2,s-a-2),s=a+2),a=void 0);return e?e(t,r):t}}function fd(e,n){let t=0;for(;++t<=e.length;)if((t===e.length||e[t][1].type==="lineEnding")&&e[t-1][1].type==="data"){const r=e[t-1][1],s=n.sliceStream(r);let a=s.length,o=-1,l=0,u;for(;a--;){const c=s[a];if(typeof c=="string"){for(o=c.length;c.charCodeAt(o-1)===32;)l++,o--;if(o)break;o=-1}else if(c===-2)u=!0,l++;else if(c!==-1){a++;break}}if(n._contentTypeTextTrailing&&t===e.length&&(l=0),l){const c={type:t===e.length||u||l<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:a?o:r.start._bufferIndex+o,_index:r.start._index+a,line:r.end.line,column:r.end.column-l,offset:r.end.offset-l},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(e.splice(t,0,["enter",c,n],["exit",c,n]),t+=2)}t++}return e}const gd={42:Ye,43:Ye,45:Ye,48:Ye,49:Ye,50:Ye,51:Ye,52:Ye,53:Ye,54:Ye,55:Ye,56:Ye,57:Ye,62:uo},yd={91:ku},xd={[-2]:ui,[-1]:ui,32:ui},bd={35:Su,42:br,45:[bs,br],60:Iu,61:bs,95:br,96:ys,126:ys},wd={38:ho,92:po},kd={[-5]:di,[-4]:di,[-3]:di,33:Gu,38:ho,42:Ii,60:[Yc,Fu],91:Yu,92:[vu,po],93:Vi,95:Ii,96:uu},Nd={null:[Ii,pd]},_d={null:[42,95]},jd={null:[]},vd=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:_d,contentInitial:yd,disable:jd,document:gd,flow:bd,flowInitial:xd,insideSpan:Nd,string:wd,text:kd},Symbol.toStringTag,{value:"Module"}));function Cd(e,n,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const s={},a=[];let o=[],l=[];const u={attempt:Z(z),check:Z(j),consume:J,enter:L,exit:Y,interrupt:Z(j,{interrupt:!0})},c={code:null,containerState:{},defineSkip:B,events:[],now:P,parser:e,previous:null,sliceSerialize:y,sliceStream:p,write:d};let m=n.tokenize.call(c,u);return n.resolveAll&&a.push(n),c;function d(V){return o=ht(o,V),G(),o[o.length-1]!==null?[]:(me(n,0),c.events=Hi(a,c.events,c),c.events)}function y(V,F){return Td(p(V),F)}function p(V){return Sd(o,V)}function P(){const{_bufferIndex:V,_index:F,line:I,column:ye,offset:O}=r;return{_bufferIndex:V,_index:F,line:I,column:ye,offset:O}}function B(V){s[V.line]=V.column,ce()}function G(){let V;for(;r._index<o.length;){const F=o[r._index];if(typeof F=="string")for(V=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===V&&r._bufferIndex<F.length;)D(F.charCodeAt(r._bufferIndex));else D(F)}}function D(V){m=m(V)}function J(V){fe(V)?(r.line++,r.column=1,r.offset+=V===-3?2:1,ce()):V!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=V}function L(V,F){const I=F||{};return I.type=V,I.start=P(),c.events.push(["enter",I,c]),l.push(I),I}function Y(V){const F=l.pop();return F.end=P(),c.events.push(["exit",F,c]),F}function z(V,F){me(V,F.from)}function j(V,F){F.restore()}function Z(V,F){return I;function I(ye,O,K){let H,Se,de,w;return Array.isArray(ye)?ke(ye):"tokenize"in ye?ke([ye]):ze(ye);function ze(Ne){return st;function st(Fe){const tt=Fe!==null&&Ne[Fe],ot=Fe!==null&&Ne.null,nt=[...Array.isArray(tt)?tt:tt?[tt]:[],...Array.isArray(ot)?ot:ot?[ot]:[]];return ke(nt)(Fe)}}function ke(Ne){return H=Ne,Se=0,Ne.length===0?K:b(Ne[Se])}function b(Ne){return st;function st(Fe){return w=re(),de=Ne,Ne.partial||(c.currentConstruct=Ne),Ne.name&&c.parser.constructs.disable.null.includes(Ne.name)?Ve():Ne.tokenize.call(F?Object.assign(Object.create(c),F):c,u,De,Ve)(Fe)}}function De(Ne){return V(de,w),O}function Ve(Ne){return w.restore(),++Se<H.length?b(H[Se]):K}}}function me(V,F){V.resolveAll&&!a.includes(V)&&a.push(V),V.resolve&&vt(c.events,F,c.events.length-F,V.resolve(c.events.slice(F),c)),V.resolveTo&&(c.events=V.resolveTo(c.events,c))}function re(){const V=P(),F=c.previous,I=c.currentConstruct,ye=c.events.length,O=Array.from(l);return{from:ye,restore:K};function K(){r=V,c.previous=F,c.currentConstruct=I,c.events.length=ye,l=O,ce()}}function ce(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function Sd(e,n){const t=n.start._index,r=n.start._bufferIndex,s=n.end._index,a=n.end._bufferIndex;let o;if(t===s)o=[e[t].slice(r,a)];else{if(o=e.slice(t,s),r>-1){const l=o[0];typeof l=="string"?o[0]=l.slice(r):o.shift()}a>0&&o.push(e[s].slice(0,a))}return o}function Td(e,n){let t=-1;const r=[];let s;for(;++t<e.length;){const a=e[t];let o;if(typeof a=="string")o=a;else switch(a){case-5:{o="\r";break}case-4:{o=`
`;break}case-3:{o=`\r
`;break}case-2:{o=n?" ":"	";break}case-1:{if(!n&&s)continue;o=" ";break}default:o=String.fromCharCode(a)}s=a===-2,r.push(o)}return r.join("")}function Pd(e){const r={constructs:Lc([vd,...(e||{}).extensions||[]]),content:s(Hc),defined:[],document:s(Wc),flow:s(ud),lazy:{},string:s(hd),text:s(md)};return r;function s(a){return o;function o(l){return Cd(r,a,l)}}}function Ed(e){for(;!mo(e););return e}const ws=/[\0\t\n\r]/g;function Id(){let e=1,n="",t=!0,r;return s;function s(a,o,l){const u=[];let c,m,d,y,p;for(a=n+(typeof a=="string"?a.toString():new TextDecoder(o||void 0).decode(a)),d=0,n="",t&&(a.charCodeAt(0)===65279&&d++,t=void 0);d<a.length;){if(ws.lastIndex=d,c=ws.exec(a),y=c&&c.index!==void 0?c.index:a.length,p=a.charCodeAt(y),!c){n=a.slice(d);break}if(p===10&&d===y&&r)u.push(-3),r=void 0;else switch(r&&(u.push(-5),r=void 0),d<y&&(u.push(a.slice(d,y)),e+=y-d),p){case 0:{u.push(65533),e++;break}case 9:{for(m=Math.ceil(e/4)*4,u.push(-2);e++<m;)u.push(-1);break}case 10:{u.push(-4),e=1;break}default:r=!0,e=1}d=y+1}return l&&(r&&u.push(-5),n&&u.push(n),u.push(null)),u}}const Ad=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function wo(e){return e.replace(Ad,Dd)}function Dd(e,n,t){if(n)return n;if(t.charCodeAt(0)===35){const s=t.charCodeAt(1),a=s===120||s===88;return co(t.slice(a?2:1),a?16:10)}return Mi(t)||e}function zn(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?ks(e.position):"start"in e||"end"in e?ks(e):"line"in e||"column"in e?Ai(e):""}function Ai(e){return Ns(e&&e.line)+":"+Ns(e&&e.column)}function ks(e){return Ai(e&&e.start)+"-"+Ai(e&&e.end)}function Ns(e){return e&&typeof e=="number"?e:1}const ko={}.hasOwnProperty;function Od(e,n,t){return typeof n!="string"&&(t=n,n=void 0),$d(t)(Ed(Pd(t).document().write(Id()(e,n,!0))))}function $d(e){const n={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(Qe),autolinkProtocol:re,autolinkEmail:re,atxHeading:a(Ct),blockQuote:a(ot),characterEscape:re,characterReference:re,codeFenced:a(nt),codeFencedFenceInfo:o,codeFencedFenceMeta:o,codeIndented:a(nt,o),codeText:a(Yt,o),codeTextData:re,data:re,codeFlowValue:re,definition:a(_),definitionDestinationString:o,definitionLabelString:o,definitionTitleString:o,emphasis:a($t),hardBreakEscape:a(Xt),hardBreakTrailing:a(Xt),htmlFlow:a(mt,o),htmlFlowData:re,htmlText:a(mt,o),htmlTextData:re,image:a(xt),label:o,link:a(Qe),listItem:a(Ht),listItemValue:y,listOrdered:a(St,d),listUnordered:a(St),paragraph:a(Zt),reference:b,referenceString:o,resourceDestinationString:o,resourceTitleString:o,setextHeading:a(Ct),strong:a(We),thematicBreak:a(Le)},exit:{atxHeading:u(),atxHeadingSequence:z,autolink:u(),autolinkEmail:tt,autolinkProtocol:Fe,blockQuote:u(),characterEscapeValue:ce,characterReferenceMarkerHexadecimal:Ve,characterReferenceMarkerNumeric:Ve,characterReferenceValue:Ne,characterReference:st,codeFenced:u(G),codeFencedFence:B,codeFencedFenceInfo:p,codeFencedFenceMeta:P,codeFlowValue:ce,codeIndented:u(D),codeText:u(O),codeTextData:ce,data:ce,definition:u(),definitionDestinationString:Y,definitionLabelString:J,definitionTitleString:L,emphasis:u(),hardBreakEscape:u(F),hardBreakTrailing:u(F),htmlFlow:u(I),htmlFlowData:ce,htmlText:u(ye),htmlTextData:ce,image:u(H),label:de,labelText:Se,lineEnding:V,link:u(K),listItem:u(),listOrdered:u(),listUnordered:u(),paragraph:u(),referenceString:De,resourceDestinationString:w,resourceTitleString:ze,resource:ke,setextHeading:u(me),setextHeadingLineSequence:Z,setextHeadingText:j,strong:u(),thematicBreak:u()}};No(n,(e||{}).mdastExtensions||[]);const t={};return r;function r(C){let S={type:"root",children:[]};const v={stack:[S],tokenStack:[],config:n,enter:l,exit:c,buffer:o,resume:m,data:t},X=[];let se=-1;for(;++se<C.length;)if(C[se][1].type==="listOrdered"||C[se][1].type==="listUnordered")if(C[se][0]==="enter")X.push(se);else{const Re=X.pop();se=s(C,Re,se)}for(se=-1;++se<C.length;){const Re=n[C[se][0]];ko.call(Re,C[se][1].type)&&Re[C[se][1].type].call(Object.assign({sliceSerialize:C[se][2].sliceSerialize},v),C[se][1])}if(v.tokenStack.length>0){const Re=v.tokenStack[v.tokenStack.length-1];(Re[1]||_s).call(v,void 0,Re[0])}for(S.position={start:Bt(C.length>0?C[0][1].start:{line:1,column:1,offset:0}),end:Bt(C.length>0?C[C.length-2][1].end:{line:1,column:1,offset:0})},se=-1;++se<n.transforms.length;)S=n.transforms[se](S)||S;return S}function s(C,S,v){let X=S-1,se=-1,Re=!1,He,ve,Je,Ge;for(;++X<=v;){const Be=C[X];switch(Be[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Be[0]==="enter"?se++:se--,Ge=void 0;break}case"lineEndingBlank":{Be[0]==="enter"&&(He&&!Ge&&!se&&!Je&&(Je=X),Ge=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ge=void 0}if(!se&&Be[0]==="enter"&&Be[1].type==="listItemPrefix"||se===-1&&Be[0]==="exit"&&(Be[1].type==="listUnordered"||Be[1].type==="listOrdered")){if(He){let ee=X;for(ve=void 0;ee--;){const T=C[ee];if(T[1].type==="lineEnding"||T[1].type==="lineEndingBlank"){if(T[0]==="exit")continue;ve&&(C[ve][1].type="lineEndingBlank",Re=!0),T[1].type="lineEnding",ve=ee}else if(!(T[1].type==="linePrefix"||T[1].type==="blockQuotePrefix"||T[1].type==="blockQuotePrefixWhitespace"||T[1].type==="blockQuoteMarker"||T[1].type==="listItemIndent"))break}Je&&(!ve||Je<ve)&&(He._spread=!0),He.end=Object.assign({},ve?C[ve][1].start:Be[1].end),C.splice(ve||X,0,["exit",He,Be[2]]),X++,v++}if(Be[1].type==="listItemPrefix"){const ee={type:"listItem",_spread:!1,start:Object.assign({},Be[1].start),end:void 0};He=ee,C.splice(X,0,["enter",ee,Be[2]]),X++,v++,Je=void 0,Ge=!0}}}return C[S][1]._spread=Re,v}function a(C,S){return v;function v(X){l.call(this,C(X),X),S&&S.call(this,X)}}function o(){this.stack.push({type:"fragment",children:[]})}function l(C,S,v){this.stack[this.stack.length-1].children.push(C),this.stack.push(C),this.tokenStack.push([S,v||void 0]),C.position={start:Bt(S.start),end:void 0}}function u(C){return S;function S(v){C&&C.call(this,v),c.call(this,v)}}function c(C,S){const v=this.stack.pop(),X=this.tokenStack.pop();if(X)X[0].type!==C.type&&(S?S.call(this,C,X[0]):(X[1]||_s).call(this,C,X[0]));else throw new Error("Cannot close `"+C.type+"` ("+zn({start:C.start,end:C.end})+"): it’s not open");v.position.end=Bt(C.end)}function m(){return Ui(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function y(C){if(this.data.expectingFirstListItemValue){const S=this.stack[this.stack.length-2];S.start=Number.parseInt(this.sliceSerialize(C),10),this.data.expectingFirstListItemValue=void 0}}function p(){const C=this.resume(),S=this.stack[this.stack.length-1];S.lang=C}function P(){const C=this.resume(),S=this.stack[this.stack.length-1];S.meta=C}function B(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function G(){const C=this.resume(),S=this.stack[this.stack.length-1];S.value=C.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function D(){const C=this.resume(),S=this.stack[this.stack.length-1];S.value=C.replace(/(\r?\n|\r)$/g,"")}function J(C){const S=this.resume(),v=this.stack[this.stack.length-1];v.label=S,v.identifier=hn(this.sliceSerialize(C)).toLowerCase()}function L(){const C=this.resume(),S=this.stack[this.stack.length-1];S.title=C}function Y(){const C=this.resume(),S=this.stack[this.stack.length-1];S.url=C}function z(C){const S=this.stack[this.stack.length-1];if(!S.depth){const v=this.sliceSerialize(C).length;S.depth=v}}function j(){this.data.setextHeadingSlurpLineEnding=!0}function Z(C){const S=this.stack[this.stack.length-1];S.depth=this.sliceSerialize(C).codePointAt(0)===61?1:2}function me(){this.data.setextHeadingSlurpLineEnding=void 0}function re(C){const v=this.stack[this.stack.length-1].children;let X=v[v.length-1];(!X||X.type!=="text")&&(X=Tt(),X.position={start:Bt(C.start),end:void 0},v.push(X)),this.stack.push(X)}function ce(C){const S=this.stack.pop();S.value+=this.sliceSerialize(C),S.position.end=Bt(C.end)}function V(C){const S=this.stack[this.stack.length-1];if(this.data.atHardBreak){const v=S.children[S.children.length-1];v.position.end=Bt(C.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&n.canContainEols.includes(S.type)&&(re.call(this,C),ce.call(this,C))}function F(){this.data.atHardBreak=!0}function I(){const C=this.resume(),S=this.stack[this.stack.length-1];S.value=C}function ye(){const C=this.resume(),S=this.stack[this.stack.length-1];S.value=C}function O(){const C=this.resume(),S=this.stack[this.stack.length-1];S.value=C}function K(){const C=this.stack[this.stack.length-1];if(this.data.inReference){const S=this.data.referenceType||"shortcut";C.type+="Reference",C.referenceType=S,delete C.url,delete C.title}else delete C.identifier,delete C.label;this.data.referenceType=void 0}function H(){const C=this.stack[this.stack.length-1];if(this.data.inReference){const S=this.data.referenceType||"shortcut";C.type+="Reference",C.referenceType=S,delete C.url,delete C.title}else delete C.identifier,delete C.label;this.data.referenceType=void 0}function Se(C){const S=this.sliceSerialize(C),v=this.stack[this.stack.length-2];v.label=wo(S),v.identifier=hn(S).toLowerCase()}function de(){const C=this.stack[this.stack.length-1],S=this.resume(),v=this.stack[this.stack.length-1];if(this.data.inReference=!0,v.type==="link"){const X=C.children;v.children=X}else v.alt=S}function w(){const C=this.resume(),S=this.stack[this.stack.length-1];S.url=C}function ze(){const C=this.resume(),S=this.stack[this.stack.length-1];S.title=C}function ke(){this.data.inReference=void 0}function b(){this.data.referenceType="collapsed"}function De(C){const S=this.resume(),v=this.stack[this.stack.length-1];v.label=S,v.identifier=hn(this.sliceSerialize(C)).toLowerCase(),this.data.referenceType="full"}function Ve(C){this.data.characterReferenceType=C.type}function Ne(C){const S=this.sliceSerialize(C),v=this.data.characterReferenceType;let X;v?(X=co(S,v==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):X=Mi(S);const se=this.stack[this.stack.length-1];se.value+=X}function st(C){const S=this.stack.pop();S.position.end=Bt(C.end)}function Fe(C){ce.call(this,C);const S=this.stack[this.stack.length-1];S.url=this.sliceSerialize(C)}function tt(C){ce.call(this,C);const S=this.stack[this.stack.length-1];S.url="mailto:"+this.sliceSerialize(C)}function ot(){return{type:"blockquote",children:[]}}function nt(){return{type:"code",lang:null,meta:null,value:""}}function Yt(){return{type:"inlineCode",value:""}}function _(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function $t(){return{type:"emphasis",children:[]}}function Ct(){return{type:"heading",depth:0,children:[]}}function Xt(){return{type:"break"}}function mt(){return{type:"html",value:""}}function xt(){return{type:"image",title:null,url:"",alt:null}}function Qe(){return{type:"link",title:null,url:"",children:[]}}function St(C){return{type:"list",ordered:C.type==="listOrdered",start:null,spread:C._spread,children:[]}}function Ht(C){return{type:"listItem",spread:C._spread,checked:null,children:[]}}function Zt(){return{type:"paragraph",children:[]}}function We(){return{type:"strong",children:[]}}function Tt(){return{type:"text",value:""}}function Le(){return{type:"thematicBreak"}}}function Bt(e){return{line:e.line,column:e.column,offset:e.offset}}function No(e,n){let t=-1;for(;++t<n.length;){const r=n[t];Array.isArray(r)?No(e,r):Ld(e,r)}}function Ld(e,n){let t;for(t in n)if(ko.call(n,t))switch(t){case"canContainEols":{const r=n[t];r&&e[t].push(...r);break}case"transforms":{const r=n[t];r&&e[t].push(...r);break}case"enter":case"exit":{const r=n[t];r&&Object.assign(e[t],r);break}}}function _s(e,n){throw e?new Error("Cannot close `"+e.type+"` ("+zn({start:e.start,end:e.end})+"): a different token (`"+n.type+"`, "+zn({start:n.start,end:n.end})+") is open"):new Error("Cannot close document, a token (`"+n.type+"`, "+zn({start:n.start,end:n.end})+") is still open")}function Rd(e){const n=this;n.parser=t;function t(r){return Od(r,{...n.data("settings"),...e,extensions:n.data("micromarkExtensions")||[],mdastExtensions:n.data("fromMarkdownExtensions")||[]})}}const js={}.hasOwnProperty;function _o(e,n){const t=n||{};function r(s,...a){let o=r.invalid;const l=r.handlers;if(s&&js.call(s,e)){const u=String(s[e]);o=js.call(l,u)?l[u]:r.unknown}if(o)return o.call(this,s,...a)}return r.handlers=t.handlers||{},r.invalid=t.invalid,r.unknown=t.unknown,r}const Fd={}.hasOwnProperty;function jo(e,n){let t=-1,r;if(n.extensions)for(;++t<n.extensions.length;)jo(e,n.extensions[t]);for(r in n)if(Fd.call(n,r))switch(r){case"extensions":break;case"unsafe":{vs(e[r],n[r]);break}case"join":{vs(e[r],n[r]);break}case"handlers":{zd(e[r],n[r]);break}default:e.options[r]=n[r]}return e}function vs(e,n){n&&e.push(...n)}function zd(e,n){n&&Object.assign(e,n)}function Bd(e,n,t,r){const s=t.enter("blockquote"),a=t.createTracker(r);a.move("> "),a.shift(2);const o=t.indentLines(t.containerFlow(e,a.current()),qd);return s(),o}function qd(e,n,t){return">"+(t?"":" ")+e}function vo(e,n){return Cs(e,n.inConstruct,!0)&&!Cs(e,n.notInConstruct,!1)}function Cs(e,n,t){if(typeof n=="string"&&(n=[n]),!n||n.length===0)return t;let r=-1;for(;++r<n.length;)if(e.includes(n[r]))return!0;return!1}function Ss(e,n,t,r){let s=-1;for(;++s<t.unsafe.length;)if(t.unsafe[s].character===`
`&&vo(t.stack,t.unsafe[s]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function Ud(e,n){const t=String(e);let r=t.indexOf(n),s=r,a=0,o=0;if(typeof n!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===s?++a>o&&(o=a):a=1,s=r+n.length,r=t.indexOf(n,s);return o}function Di(e,n){return!!(n.options.fences===!1&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}function Md(e){const n=e.options.fence||"`";if(n!=="`"&&n!=="~")throw new Error("Cannot serialize code with `"+n+"` for `options.fence`, expected `` ` `` or `~`");return n}function Hd(e,n,t,r){const s=Md(t),a=e.value||"",o=s==="`"?"GraveAccent":"Tilde";if(Di(e,t)){const d=t.enter("codeIndented"),y=t.indentLines(a,Vd);return d(),y}const l=t.createTracker(r),u=s.repeat(Math.max(Ud(a,s)+1,3)),c=t.enter("codeFenced");let m=l.move(u);if(e.lang){const d=t.enter(`codeFencedLang${o}`);m+=l.move(t.safe(e.lang,{before:m,after:" ",encode:["`"],...l.current()})),d()}if(e.lang&&e.meta){const d=t.enter(`codeFencedMeta${o}`);m+=l.move(" "),m+=l.move(t.safe(e.meta,{before:m,after:`
`,encode:["`"],...l.current()})),d()}return m+=l.move(`
`),a&&(m+=l.move(a+`
`)),m+=l.move(u),c(),m}function Vd(e,n,t){return(t?"":"    ")+e}function Wi(e){const n=e.options.quote||'"';if(n!=='"'&&n!=="'")throw new Error("Cannot serialize title with `"+n+"` for `options.quote`, expected `\"`, or `'`");return n}function Wd(e,n,t,r){const s=Wi(t),a=s==='"'?"Quote":"Apostrophe",o=t.enter("definition");let l=t.enter("label");const u=t.createTracker(r);let c=u.move("[");return c+=u.move(t.safe(t.associationId(e),{before:c,after:"]",...u.current()})),c+=u.move("]: "),l(),!e.url||/[\0- \u007F]/.test(e.url)?(l=t.enter("destinationLiteral"),c+=u.move("<"),c+=u.move(t.safe(e.url,{before:c,after:">",...u.current()})),c+=u.move(">")):(l=t.enter("destinationRaw"),c+=u.move(t.safe(e.url,{before:c,after:e.title?" ":`
`,...u.current()}))),l(),e.title&&(l=t.enter(`title${a}`),c+=u.move(" "+s),c+=u.move(t.safe(e.title,{before:c,after:s,...u.current()})),c+=u.move(s),l()),o(),c}function Jd(e){const n=e.options.emphasis||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize emphasis with `"+n+"` for `options.emphasis`, expected `*`, or `_`");return n}function Ut(e){return"&#x"+e.toString(16).toUpperCase()+";"}function kr(e,n,t){const r=wr(e),s=wr(n);return r===void 0?s===void 0?t==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}Co.peek=Qd;function Co(e,n,t,r){const s=Jd(t),a=t.enter("emphasis"),o=t.createTracker(r),l=o.move(s);let u=o.move(t.containerPhrasing(e,{after:s,before:l,...o.current()}));const c=u.charCodeAt(0),m=kr(r.before.charCodeAt(r.before.length-1),c,s);m.inside&&(u=Ut(c)+u.slice(1));const d=u.charCodeAt(u.length-1),y=kr(r.after.charCodeAt(0),d,s);y.inside&&(u=u.slice(0,-1)+Ut(d));const p=o.move(s);return a(),t.attentionEncodeSurroundingInfo={after:y.outside,before:m.outside},l+u+p}function Qd(e,n,t){return t.options.emphasis||"*"}const Ji=function(e){if(e==null)return Xd;if(typeof e=="function")return vr(e);if(typeof e=="object")return Array.isArray(e)?Gd(e):Kd(e);if(typeof e=="string")return Yd(e);throw new Error("Expected function, string, or object as test")};function Gd(e){const n=[];let t=-1;for(;++t<e.length;)n[t]=Ji(e[t]);return vr(r);function r(...s){let a=-1;for(;++a<n.length;)if(n[a].apply(this,s))return!0;return!1}}function Kd(e){const n=e;return vr(t);function t(r){const s=r;let a;for(a in e)if(s[a]!==n[a])return!1;return!0}}function Yd(e){return vr(n);function n(t){return t&&t.type===e}}function vr(e){return n;function n(t,r,s){return!!(Zd(t)&&e.call(this,t,typeof r=="number"?r:void 0,s||void 0))}}function Xd(){return!0}function Zd(e){return e!==null&&typeof e=="object"&&"type"in e}const So=[],ep=!0,Oi=!1,tp="skip";function np(e,n,t,r){let s;typeof n=="function"&&typeof t!="function"?(r=t,t=n):s=n;const a=Ji(s),o=r?-1:1;l(e,void 0,[])();function l(u,c,m){const d=u&&typeof u=="object"?u:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(y,"name",{value:"node ("+(u.type+(p?"<"+p+">":""))+")"})}return y;function y(){let p=So,P,B,G;if((!n||a(u,c,m[m.length-1]||void 0))&&(p=rp(t(u,m)),p[0]===Oi))return p;if("children"in u&&u.children){const D=u;if(D.children&&p[0]!==tp)for(B=(r?D.children.length:-1)+o,G=m.concat(D);B>-1&&B<D.children.length;){const J=D.children[B];if(P=l(J,B,G)(),P[0]===Oi)return P;B=typeof P[1]=="number"?P[1]:B+o}}return p}}}function rp(e){return Array.isArray(e)?e:typeof e=="number"?[ep,e]:e==null?So:[e]}function To(e,n,t,r){let s,a,o;typeof n=="function"?(a=void 0,o=n,s=t):(a=n,o=t,s=r),np(e,a,l,s);function l(u,c){const m=c[c.length-1],d=m?m.children.indexOf(u):void 0;return o(u,d,m)}}function Po(e,n){let t=!1;return To(e,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return t=!0,Oi}),!!((!e.depth||e.depth<3)&&Ui(e)&&(n.options.setext||t))}function ip(e,n,t,r){const s=Math.max(Math.min(6,e.depth||1),1),a=t.createTracker(r);if(Po(e,t)){const m=t.enter("headingSetext"),d=t.enter("phrasing"),y=t.containerPhrasing(e,{...a.current(),before:`
`,after:`
`});return d(),m(),y+`
`+(s===1?"=":"-").repeat(y.length-(Math.max(y.lastIndexOf("\r"),y.lastIndexOf(`
`))+1))}const o="#".repeat(s),l=t.enter("headingAtx"),u=t.enter("phrasing");a.move(o+" ");let c=t.containerPhrasing(e,{before:"# ",after:`
`,...a.current()});return/^[\t ]/.test(c)&&(c=Ut(c.charCodeAt(0))+c.slice(1)),c=c?o+" "+c:o,t.options.closeAtx&&(c+=" "+o),u(),l(),c}Eo.peek=ap;function Eo(e){return e.value||""}function ap(){return"<"}Io.peek=sp;function Io(e,n,t,r){const s=Wi(t),a=s==='"'?"Quote":"Apostrophe",o=t.enter("image");let l=t.enter("label");const u=t.createTracker(r);let c=u.move("![");return c+=u.move(t.safe(e.alt,{before:c,after:"]",...u.current()})),c+=u.move("]("),l(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(l=t.enter("destinationLiteral"),c+=u.move("<"),c+=u.move(t.safe(e.url,{before:c,after:">",...u.current()})),c+=u.move(">")):(l=t.enter("destinationRaw"),c+=u.move(t.safe(e.url,{before:c,after:e.title?" ":")",...u.current()}))),l(),e.title&&(l=t.enter(`title${a}`),c+=u.move(" "+s),c+=u.move(t.safe(e.title,{before:c,after:s,...u.current()})),c+=u.move(s),l()),c+=u.move(")"),o(),c}function sp(){return"!"}Ao.peek=op;function Ao(e,n,t,r){const s=e.referenceType,a=t.enter("imageReference");let o=t.enter("label");const l=t.createTracker(r);let u=l.move("![");const c=t.safe(e.alt,{before:u,after:"]",...l.current()});u+=l.move(c+"]["),o();const m=t.stack;t.stack=[],o=t.enter("reference");const d=t.safe(t.associationId(e),{before:u,after:"]",...l.current()});return o(),t.stack=m,a(),s==="full"||!c||c!==d?u+=l.move(d+"]"):s==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function op(){return"!"}Do.peek=lp;function Do(e,n,t){let r=e.value||"",s="`",a=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(r);)s+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++a<t.unsafe.length;){const o=t.unsafe[a],l=t.compilePattern(o);let u;if(o.atBreak)for(;u=l.exec(r);){let c=u.index;r.charCodeAt(c)===10&&r.charCodeAt(c-1)===13&&c--,r=r.slice(0,c)+" "+r.slice(u.index+1)}}return s+r+s}function lp(){return"`"}function Oo(e,n){const t=Ui(e);return!!(!n.options.resourceLink&&e.url&&!e.title&&e.children&&e.children.length===1&&e.children[0].type==="text"&&(t===e.url||"mailto:"+t===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}$o.peek=cp;function $o(e,n,t,r){const s=Wi(t),a=s==='"'?"Quote":"Apostrophe",o=t.createTracker(r);let l,u;if(Oo(e,t)){const m=t.stack;t.stack=[],l=t.enter("autolink");let d=o.move("<");return d+=o.move(t.containerPhrasing(e,{before:d,after:">",...o.current()})),d+=o.move(">"),l(),t.stack=m,d}l=t.enter("link"),u=t.enter("label");let c=o.move("[");return c+=o.move(t.containerPhrasing(e,{before:c,after:"](",...o.current()})),c+=o.move("]("),u(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(u=t.enter("destinationLiteral"),c+=o.move("<"),c+=o.move(t.safe(e.url,{before:c,after:">",...o.current()})),c+=o.move(">")):(u=t.enter("destinationRaw"),c+=o.move(t.safe(e.url,{before:c,after:e.title?" ":")",...o.current()}))),u(),e.title&&(u=t.enter(`title${a}`),c+=o.move(" "+s),c+=o.move(t.safe(e.title,{before:c,after:s,...o.current()})),c+=o.move(s),u()),c+=o.move(")"),l(),c}function cp(e,n,t){return Oo(e,t)?"<":"["}Lo.peek=up;function Lo(e,n,t,r){const s=e.referenceType,a=t.enter("linkReference");let o=t.enter("label");const l=t.createTracker(r);let u=l.move("[");const c=t.containerPhrasing(e,{before:u,after:"]",...l.current()});u+=l.move(c+"]["),o();const m=t.stack;t.stack=[],o=t.enter("reference");const d=t.safe(t.associationId(e),{before:u,after:"]",...l.current()});return o(),t.stack=m,a(),s==="full"||!c||c!==d?u+=l.move(d+"]"):s==="shortcut"?u=u.slice(0,-1):u+=l.move("]"),u}function up(){return"["}function Qi(e){const n=e.options.bullet||"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bullet`, expected `*`, `+`, or `-`");return n}function dp(e){const n=Qi(e),t=e.options.bulletOther;if(!t)return n==="*"?"-":"*";if(t!=="*"&&t!=="+"&&t!=="-")throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(t===n)throw new Error("Expected `bullet` (`"+n+"`) and `bulletOther` (`"+t+"`) to be different");return t}function pp(e){const n=e.options.bulletOrdered||".";if(n!=="."&&n!==")")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOrdered`, expected `.` or `)`");return n}function Ro(e){const n=e.options.rule||"*";if(n!=="*"&&n!=="-"&&n!=="_")throw new Error("Cannot serialize rules with `"+n+"` for `options.rule`, expected `*`, `-`, or `_`");return n}function hp(e,n,t,r){const s=t.enter("list"),a=t.bulletCurrent;let o=e.ordered?pp(t):Qi(t);const l=e.ordered?o==="."?")":".":dp(t);let u=n&&t.bulletLastUsed?o===t.bulletLastUsed:!1;if(!e.ordered){const m=e.children?e.children[0]:void 0;if((o==="*"||o==="-")&&m&&(!m.children||!m.children[0])&&t.stack[t.stack.length-1]==="list"&&t.stack[t.stack.length-2]==="listItem"&&t.stack[t.stack.length-3]==="list"&&t.stack[t.stack.length-4]==="listItem"&&t.indexStack[t.indexStack.length-1]===0&&t.indexStack[t.indexStack.length-2]===0&&t.indexStack[t.indexStack.length-3]===0&&(u=!0),Ro(t)===o&&m){let d=-1;for(;++d<e.children.length;){const y=e.children[d];if(y&&y.type==="listItem"&&y.children&&y.children[0]&&y.children[0].type==="thematicBreak"){u=!0;break}}}}u&&(o=l),t.bulletCurrent=o;const c=t.containerFlow(e,r);return t.bulletLastUsed=o,t.bulletCurrent=a,s(),c}function mp(e){const n=e.options.listItemIndent||"one";if(n!=="tab"&&n!=="one"&&n!=="mixed")throw new Error("Cannot serialize items with `"+n+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return n}function fp(e,n,t,r){const s=mp(t);let a=t.bulletCurrent||Qi(t);n&&n.type==="list"&&n.ordered&&(a=(typeof n.start=="number"&&n.start>-1?n.start:1)+(t.options.incrementListMarker===!1?0:n.children.indexOf(e))+a);let o=a.length+1;(s==="tab"||s==="mixed"&&(n&&n.type==="list"&&n.spread||e.spread))&&(o=Math.ceil(o/4)*4);const l=t.createTracker(r);l.move(a+" ".repeat(o-a.length)),l.shift(o);const u=t.enter("listItem"),c=t.indentLines(t.containerFlow(e,l.current()),m);return u(),c;function m(d,y,p){return y?(p?"":" ".repeat(o))+d:(p?a:a+" ".repeat(o-a.length))+d}}function gp(e,n,t,r){const s=t.enter("paragraph"),a=t.enter("phrasing"),o=t.containerPhrasing(e,r);return a(),s(),o}const yp=Ji(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function xp(e,n,t,r){return(e.children.some(function(o){return yp(o)})?t.containerPhrasing:t.containerFlow).call(t,e,r)}function bp(e){const n=e.options.strong||"*";if(n!=="*"&&n!=="_")throw new Error("Cannot serialize strong with `"+n+"` for `options.strong`, expected `*`, or `_`");return n}Fo.peek=wp;function Fo(e,n,t,r){const s=bp(t),a=t.enter("strong"),o=t.createTracker(r),l=o.move(s+s);let u=o.move(t.containerPhrasing(e,{after:s,before:l,...o.current()}));const c=u.charCodeAt(0),m=kr(r.before.charCodeAt(r.before.length-1),c,s);m.inside&&(u=Ut(c)+u.slice(1));const d=u.charCodeAt(u.length-1),y=kr(r.after.charCodeAt(0),d,s);y.inside&&(u=u.slice(0,-1)+Ut(d));const p=o.move(s+s);return a(),t.attentionEncodeSurroundingInfo={after:y.outside,before:m.outside},l+u+p}function wp(e,n,t){return t.options.strong||"*"}function kp(e,n,t,r){return t.safe(e.value,r)}function Np(e){const n=e.options.ruleRepetition||3;if(n<3)throw new Error("Cannot serialize rules with repetition `"+n+"` for `options.ruleRepetition`, expected `3` or more");return n}function _p(e,n,t){const r=(Ro(t)+(t.options.ruleSpaces?" ":"")).repeat(Np(t));return t.options.ruleSpaces?r.slice(0,-1):r}const jp={blockquote:Bd,break:Ss,code:Hd,definition:Wd,emphasis:Co,hardBreak:Ss,heading:ip,html:Eo,image:Io,imageReference:Ao,inlineCode:Do,link:$o,linkReference:Lo,list:hp,listItem:fp,paragraph:gp,root:xp,strong:Fo,text:kp,thematicBreak:_p},vp=[Cp];function Cp(e,n,t,r){if(n.type==="code"&&Di(n,r)&&(e.type==="list"||e.type===n.type&&Di(e,r)))return!1;if("spread"in t&&typeof t.spread=="boolean")return e.type==="paragraph"&&(e.type===n.type||n.type==="definition"||n.type==="heading"&&Po(n,r))?void 0:t.spread?1:0}const Jt=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],Sp=[{character:"	",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"	",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:`
`,inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:Jt},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:`(?:[\r
]|$)`},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:Jt},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:`(?:[ 	\r
*])`},{character:"*",inConstruct:"phrasing",notInConstruct:Jt},{atBreak:!0,character:"+",after:`(?:[ 	\r
])`},{atBreak:!0,character:"-",after:`(?:[ 	\r
-])`},{atBreak:!0,before:"\\d+",character:".",after:`(?:[ 	\r
]|$)`},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:Jt},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:Jt},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:Jt},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:Jt},{atBreak:!0,character:"~"}];function Tp(e){return e.label||!e.identifier?e.label||"":wo(e.identifier)}function Pp(e){if(!e._compiled){const n=(e.atBreak?"[\\r\\n][\\t ]*":"")+(e.before?"(?:"+e.before+")":"");e._compiled=new RegExp((n?"("+n+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(e.character)?"\\":"")+e.character+(e.after?"(?:"+e.after+")":""),"g")}return e._compiled}function Ep(e,n,t){const r=n.indexStack,s=e.children||[],a=[];let o=-1,l=t.before,u;r.push(-1);let c=n.createTracker(t);for(;++o<s.length;){const m=s[o];let d;if(r[r.length-1]=o,o+1<s.length){let P=n.handle.handlers[s[o+1].type];P&&P.peek&&(P=P.peek),d=P?P(s[o+1],e,n,{before:"",after:"",...c.current()}).charAt(0):""}else d=t.after;a.length>0&&(l==="\r"||l===`
`)&&m.type==="html"&&(a[a.length-1]=a[a.length-1].replace(/(\r?\n|\r)$/," "),l=" ",c=n.createTracker(t),c.move(a.join("")));let y=n.handle(m,e,n,{...c.current(),after:d,before:l});u&&u===y.slice(0,1)&&(y=Ut(u.charCodeAt(0))+y.slice(1));const p=n.attentionEncodeSurroundingInfo;n.attentionEncodeSurroundingInfo=void 0,u=void 0,p&&(a.length>0&&p.before&&l===a[a.length-1].slice(-1)&&(a[a.length-1]=a[a.length-1].slice(0,-1)+Ut(l.charCodeAt(0))),p.after&&(u=d)),c.move(y),a.push(y),l=y.slice(-1)}return r.pop(),a.join("")}function Ip(e,n,t){const r=n.indexStack,s=e.children||[],a=n.createTracker(t),o=[];let l=-1;for(r.push(-1);++l<s.length;){const u=s[l];r[r.length-1]=l,o.push(a.move(n.handle(u,e,n,{before:`
`,after:`
`,...a.current()}))),u.type!=="list"&&(n.bulletLastUsed=void 0),l<s.length-1&&o.push(a.move(Ap(u,s[l+1],e,n)))}return r.pop(),o.join("")}function Ap(e,n,t,r){let s=r.join.length;for(;s--;){const a=r.join[s](e,n,t,r);if(a===!0||a===1)break;if(typeof a=="number")return`
`.repeat(1+a);if(a===!1)return`

<!---->

`}return`

`}const Dp=/\r?\n|\r/g;function Op(e,n){const t=[];let r=0,s=0,a;for(;a=Dp.exec(e);)o(e.slice(r,a.index)),t.push(a[0]),r=a.index+a[0].length,s++;return o(e.slice(r)),t.join("");function o(l){t.push(n(l,s,!l))}}function $p(e,n,t){const r=(t.before||"")+(n||"")+(t.after||""),s=[],a=[],o={};let l=-1;for(;++l<e.unsafe.length;){const m=e.unsafe[l];if(!vo(e.stack,m))continue;const d=e.compilePattern(m);let y;for(;y=d.exec(r);){const p="before"in m||!!m.atBreak,P="after"in m,B=y.index+(p?y[1].length:0);s.includes(B)?(o[B].before&&!p&&(o[B].before=!1),o[B].after&&!P&&(o[B].after=!1)):(s.push(B),o[B]={before:p,after:P})}}s.sort(Lp);let u=t.before?t.before.length:0;const c=r.length-(t.after?t.after.length:0);for(l=-1;++l<s.length;){const m=s[l];m<u||m>=c||m+1<c&&s[l+1]===m+1&&o[m].after&&!o[m+1].before&&!o[m+1].after||s[l-1]===m-1&&o[m].before&&!o[m-1].before&&!o[m-1].after||(u!==m&&a.push(Ts(r.slice(u,m),"\\")),u=m,/[!-/:-@[-`{-~]/.test(r.charAt(m))&&(!t.encode||!t.encode.includes(r.charAt(m)))?a.push("\\"):(a.push(Ut(r.charCodeAt(m))),u++))}return a.push(Ts(r.slice(u,c),t.after)),a.join("")}function Lp(e,n){return e-n}function Ts(e,n){const t=/\\(?=[!-/:-@[-`{-~])/g,r=[],s=[],a=e+n;let o=-1,l=0,u;for(;u=t.exec(a);)r.push(u.index);for(;++o<r.length;)l!==r[o]&&s.push(e.slice(l,r[o])),s.push("\\"),l=r[o];return s.push(e.slice(l)),s.join("")}function Rp(e){const n=e||{},t=n.now||{};let r=n.lineShift||0,s=t.line||1,a=t.column||1;return{move:u,current:o,shift:l};function o(){return{now:{line:s,column:a},lineShift:r}}function l(c){r+=c}function u(c){const m=c||"",d=m.split(/\r?\n|\r/g),y=d[d.length-1];return s+=d.length-1,a=d.length===1?a+y.length:1+y.length+r,m}}function Fp(e,n){const t=n||{},r={associationId:Tp,containerPhrasing:Up,containerFlow:Mp,createTracker:Rp,compilePattern:Pp,enter:a,handlers:{...jp},handle:void 0,indentLines:Op,indexStack:[],join:[...vp],options:{},safe:Hp,stack:[],unsafe:[...Sp]};jo(r,t),r.options.tightDefinitions&&r.join.push(qp),r.handle=_o("type",{invalid:zp,unknown:Bp,handlers:r.handlers});let s=r.handle(e,void 0,r,{before:`
`,after:`
`,now:{line:1,column:1},lineShift:0});return s&&s.charCodeAt(s.length-1)!==10&&s.charCodeAt(s.length-1)!==13&&(s+=`
`),s;function a(o){return r.stack.push(o),l;function l(){r.stack.pop()}}}function zp(e){throw new Error("Cannot handle value `"+e+"`, expected node")}function Bp(e){const n=e;throw new Error("Cannot handle unknown node `"+n.type+"`")}function qp(e,n){if(e.type==="definition"&&e.type===n.type)return 0}function Up(e,n){return Ep(e,this,n)}function Mp(e,n){return Ip(e,this,n)}function Hp(e,n){return $p(this,e,n)}function Vp(e){const n=this;n.compiler=t;function t(r){return Fp(r,{...n.data("settings"),...e,extensions:n.data("toMarkdownExtensions")||[]})}}function Ps(e){if(e)throw e}var pi,Es;function Wp(){if(Es)return pi;Es=1;var e=Object.prototype.hasOwnProperty,n=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,s=function(c){return typeof Array.isArray=="function"?Array.isArray(c):n.call(c)==="[object Array]"},a=function(c){if(!c||n.call(c)!=="[object Object]")return!1;var m=e.call(c,"constructor"),d=c.constructor&&c.constructor.prototype&&e.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!m&&!d)return!1;var y;for(y in c);return typeof y>"u"||e.call(c,y)},o=function(c,m){t&&m.name==="__proto__"?t(c,m.name,{enumerable:!0,configurable:!0,value:m.newValue,writable:!0}):c[m.name]=m.newValue},l=function(c,m){if(m==="__proto__")if(e.call(c,m)){if(r)return r(c,m).value}else return;return c[m]};return pi=function u(){var c,m,d,y,p,P,B=arguments[0],G=1,D=arguments.length,J=!1;for(typeof B=="boolean"&&(J=B,B=arguments[1]||{},G=2),(B==null||typeof B!="object"&&typeof B!="function")&&(B={});G<D;++G)if(c=arguments[G],c!=null)for(m in c)d=l(B,m),y=l(c,m),B!==y&&(J&&y&&(a(y)||(p=s(y)))?(p?(p=!1,P=d&&s(d)?d:[]):P=d&&a(d)?d:{},o(B,{name:m,newValue:u(J,P,y)})):typeof y<"u"&&o(B,{name:m,newValue:y}));return B},pi}var Jp=Wp();const hi=uc(Jp);function $i(e){if(typeof e!="object"||e===null)return!1;const n=Object.getPrototypeOf(e);return(n===null||n===Object.prototype||Object.getPrototypeOf(n)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Qp(){const e=[],n={run:t,use:r};return n;function t(...s){let a=-1;const o=s.pop();if(typeof o!="function")throw new TypeError("Expected function as last argument, not "+o);l(null,...s);function l(u,...c){const m=e[++a];let d=-1;if(u){o(u);return}for(;++d<s.length;)(c[d]===null||c[d]===void 0)&&(c[d]=s[d]);s=c,m?Gp(m,l)(...c):o(null,...c)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return e.push(s),n}}function Gp(e,n){let t;return r;function r(...o){const l=e.length>o.length;let u;l&&o.push(s);try{u=e.apply(this,o)}catch(c){const m=c;if(l&&t)throw m;return s(m)}l||(u&&u.then&&typeof u.then=="function"?u.then(a,s):u instanceof Error?s(u):a(u))}function s(o,...l){t||(t=!0,n(o,...l))}function a(o){s(null,o)}}class Ze extends Error{constructor(n,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let s="",a={},o=!1;if(t&&("line"in t&&"column"in t?a={place:t}:"start"in t&&"end"in t?a={place:t}:"type"in t?a={ancestors:[t],place:t.position}:a={...t}),typeof n=="string"?s=n:!a.cause&&n&&(o=!0,s=n.message,a.cause=n),!a.ruleId&&!a.source&&typeof r=="string"){const u=r.indexOf(":");u===-1?a.ruleId=r:(a.source=r.slice(0,u),a.ruleId=r.slice(u+1))}if(!a.place&&a.ancestors&&a.ancestors){const u=a.ancestors[a.ancestors.length-1];u&&(a.place=u.position)}const l=a.place&&"start"in a.place?a.place.start:a.place;this.ancestors=a.ancestors||void 0,this.cause=a.cause||void 0,this.column=l?l.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=l?l.line:void 0,this.name=zn(a.place)||"1:1",this.place=a.place||void 0,this.reason=this.message,this.ruleId=a.ruleId||void 0,this.source=a.source||void 0,this.stack=o&&a.cause&&typeof a.cause.stack=="string"?a.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}Ze.prototype.file="";Ze.prototype.name="";Ze.prototype.reason="";Ze.prototype.message="";Ze.prototype.stack="";Ze.prototype.column=void 0;Ze.prototype.line=void 0;Ze.prototype.ancestors=void 0;Ze.prototype.cause=void 0;Ze.prototype.fatal=void 0;Ze.prototype.place=void 0;Ze.prototype.ruleId=void 0;Ze.prototype.source=void 0;const _t={basename:Kp,dirname:Yp,extname:Xp,join:Zp,sep:"/"};function Kp(e,n){if(n!==void 0&&typeof n!="string")throw new TypeError('"ext" argument must be a string');Un(e);let t=0,r=-1,s=e.length,a;if(n===void 0||n.length===0||n.length>e.length){for(;s--;)if(e.codePointAt(s)===47){if(a){t=s+1;break}}else r<0&&(a=!0,r=s+1);return r<0?"":e.slice(t,r)}if(n===e)return"";let o=-1,l=n.length-1;for(;s--;)if(e.codePointAt(s)===47){if(a){t=s+1;break}}else o<0&&(a=!0,o=s+1),l>-1&&(e.codePointAt(s)===n.codePointAt(l--)?l<0&&(r=s):(l=-1,r=o));return t===r?r=o:r<0&&(r=e.length),e.slice(t,r)}function Yp(e){if(Un(e),e.length===0)return".";let n=-1,t=e.length,r;for(;--t;)if(e.codePointAt(t)===47){if(r){n=t;break}}else r||(r=!0);return n<0?e.codePointAt(0)===47?"/":".":n===1&&e.codePointAt(0)===47?"//":e.slice(0,n)}function Xp(e){Un(e);let n=e.length,t=-1,r=0,s=-1,a=0,o;for(;n--;){const l=e.codePointAt(n);if(l===47){if(o){r=n+1;break}continue}t<0&&(o=!0,t=n+1),l===46?s<0?s=n:a!==1&&(a=1):s>-1&&(a=-1)}return s<0||t<0||a===0||a===1&&s===t-1&&s===r+1?"":e.slice(s,t)}function Zp(...e){let n=-1,t;for(;++n<e.length;)Un(e[n]),e[n]&&(t=t===void 0?e[n]:t+"/"+e[n]);return t===void 0?".":eh(t)}function eh(e){Un(e);const n=e.codePointAt(0)===47;let t=th(e,!n);return t.length===0&&!n&&(t="."),t.length>0&&e.codePointAt(e.length-1)===47&&(t+="/"),n?"/"+t:t}function th(e,n){let t="",r=0,s=-1,a=0,o=-1,l,u;for(;++o<=e.length;){if(o<e.length)l=e.codePointAt(o);else{if(l===47)break;l=47}if(l===47){if(!(s===o-1||a===1))if(s!==o-1&&a===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(u=t.lastIndexOf("/"),u!==t.length-1){u<0?(t="",r=0):(t=t.slice(0,u),r=t.length-1-t.lastIndexOf("/")),s=o,a=0;continue}}else if(t.length>0){t="",r=0,s=o,a=0;continue}}n&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+e.slice(s+1,o):t=e.slice(s+1,o),r=o-s-1;s=o,a=0}else l===46&&a>-1?a++:a=-1}return t}function Un(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const nh={cwd:rh};function rh(){return"/"}function Li(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function ih(e){if(typeof e=="string")e=new URL(e);else if(!Li(e)){const n=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw n.code="ERR_INVALID_ARG_TYPE",n}if(e.protocol!=="file:"){const n=new TypeError("The URL must be of scheme file");throw n.code="ERR_INVALID_URL_SCHEME",n}return ah(e)}function ah(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const n=e.pathname;let t=-1;for(;++t<n.length;)if(n.codePointAt(t)===37&&n.codePointAt(t+1)===50){const r=n.codePointAt(t+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(n)}const mi=["history","path","basename","stem","extname","dirname"];class sh{constructor(n){let t;n?Li(n)?t={path:n}:typeof n=="string"||oh(n)?t={value:n}:t=n:t={},this.cwd="cwd"in t?"":nh.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<mi.length;){const a=mi[r];a in t&&t[a]!==void 0&&t[a]!==null&&(this[a]=a==="history"?[...t[a]]:t[a])}let s;for(s in t)mi.includes(s)||(this[s]=t[s])}get basename(){return typeof this.path=="string"?_t.basename(this.path):void 0}set basename(n){gi(n,"basename"),fi(n,"basename"),this.path=_t.join(this.dirname||"",n)}get dirname(){return typeof this.path=="string"?_t.dirname(this.path):void 0}set dirname(n){Is(this.basename,"dirname"),this.path=_t.join(n||"",this.basename)}get extname(){return typeof this.path=="string"?_t.extname(this.path):void 0}set extname(n){if(fi(n,"extname"),Is(this.dirname,"extname"),n){if(n.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(n.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=_t.join(this.dirname,this.stem+(n||""))}get path(){return this.history[this.history.length-1]}set path(n){Li(n)&&(n=ih(n)),gi(n,"path"),this.path!==n&&this.history.push(n)}get stem(){return typeof this.path=="string"?_t.basename(this.path,this.extname):void 0}set stem(n){gi(n,"stem"),fi(n,"stem"),this.path=_t.join(this.dirname||"",n+(this.extname||""))}fail(n,t,r){const s=this.message(n,t,r);throw s.fatal=!0,s}info(n,t,r){const s=this.message(n,t,r);return s.fatal=void 0,s}message(n,t,r){const s=new Ze(n,t,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(n){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(n||void 0).decode(this.value)}}function fi(e,n){if(e&&e.includes(_t.sep))throw new Error("`"+n+"` cannot be a path: did not expect `"+_t.sep+"`")}function gi(e,n){if(!e)throw new Error("`"+n+"` cannot be empty")}function Is(e,n){if(!e)throw new Error("Setting `"+n+"` requires `path` to be set too")}function oh(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const lh=function(e){const r=this.constructor.prototype,s=r[e],a=function(){return s.apply(a,arguments)};return Object.setPrototypeOf(a,r),a},ch={}.hasOwnProperty;class Gi extends lh{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Qp()}copy(){const n=new Gi;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];n.use(...r)}return n.data(hi(!0,{},this.namespace)),n}data(n,t){return typeof n=="string"?arguments.length===2?(bi("data",this.frozen),this.namespace[n]=t,this):ch.call(this.namespace,n)&&this.namespace[n]||void 0:n?(bi("data",this.frozen),this.namespace=n,this):this.namespace}freeze(){if(this.frozen)return this;const n=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=t.call(n,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(n){this.freeze();const t=hr(n),r=this.parser||this.Parser;return yi("parse",r),r(String(t),t)}process(n,t){const r=this;return this.freeze(),yi("process",this.parser||this.Parser),xi("process",this.compiler||this.Compiler),t?s(void 0,t):new Promise(s);function s(a,o){const l=hr(n),u=r.parse(l);r.run(u,l,function(m,d,y){if(m||!d||!y)return c(m);const p=d,P=r.stringify(p,y);ph(P)?y.value=P:y.result=P,c(m,y)});function c(m,d){m||!d?o(m):a?a(d):t(void 0,d)}}}processSync(n){let t=!1,r;return this.freeze(),yi("processSync",this.parser||this.Parser),xi("processSync",this.compiler||this.Compiler),this.process(n,s),Ds("processSync","process",t),r;function s(a,o){t=!0,Ps(a),r=o}}run(n,t,r){As(n),this.freeze();const s=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?a(void 0,r):new Promise(a);function a(o,l){const u=hr(t);s.run(n,u,c);function c(m,d,y){const p=d||n;m?l(m):o?o(p):r(void 0,p,y)}}}runSync(n,t){let r=!1,s;return this.run(n,t,a),Ds("runSync","run",r),s;function a(o,l){Ps(o),s=l,r=!0}}stringify(n,t){this.freeze();const r=hr(t),s=this.compiler||this.Compiler;return xi("stringify",s),As(n),s(n,r)}use(n,...t){const r=this.attachers,s=this.namespace;if(bi("use",this.frozen),n!=null)if(typeof n=="function")u(n,t);else if(typeof n=="object")Array.isArray(n)?l(n):o(n);else throw new TypeError("Expected usable value, not `"+n+"`");return this;function a(c){if(typeof c=="function")u(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[m,...d]=c;u(m,d)}else o(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function o(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");l(c.plugins),c.settings&&(s.settings=hi(!0,s.settings,c.settings))}function l(c){let m=-1;if(c!=null)if(Array.isArray(c))for(;++m<c.length;){const d=c[m];a(d)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function u(c,m){let d=-1,y=-1;for(;++d<r.length;)if(r[d][0]===c){y=d;break}if(y===-1)r.push([c,...m]);else if(m.length>0){let[p,...P]=m;const B=r[y][1];$i(B)&&$i(p)&&(p=hi(!0,B,p)),r[y]=[c,p,...P]}}}}const uh=new Gi().freeze();function yi(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function xi(e,n){if(typeof n!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function bi(e,n){if(n)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function As(e){if(!$i(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Ds(e,n,t){if(!t)throw new Error("`"+e+"` finished async. Use `"+n+"` instead")}function hr(e){return dh(e)?e:new sh(e)}function dh(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function ph(e){return typeof e=="string"||hh(e)}function hh(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const wi=uh().use(Rd).use(Vp).freeze(),mh=e=>{if(!e)return"Unknown Date";try{return new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"})}catch{return"Invalid Date"}},fh=e=>{switch(e){case"pending":return{text:"Billing Pending",className:"status-badge status-pending"};case"billed":return{text:"Sample Pending",className:"status-badge status-billed"};case"collected":return{text:"Sample Collected",className:"status-badge status-collected"};case"processing":return{text:"Processing",className:"status-badge status-processing"};case"report_ready":return{text:"Report Ready",className:"status-badge status-report_ready"};case"reported":return{text:"Reported",className:"status-badge status-reported"};case"completed":return{text:"Completed",className:"status-badge status-completed"};case"cancelled":return{text:"Cancelled",className:"status-badge status-cancelled"};default:return{text:e,className:"status-badge"}}},gh=({title:e,items:n,renderItemContent:t,headerAction:r,isLoading:s,loadingText:a,noDataText:o,onDeleteItem:l,onEditLabOrder:u,onSaveLabOrder:c,onCancelEditLabOrder:m,onLabOrderTestChange:d,onLabOrderStatusChange:y,onEditPharmacyOrder:p,onPrintUnavailablePrescription:P,onBillLabOrder:B,onUpdateLabOrderStatus:G,onEnterLabReport:D,labInventory:J=[],isSavingLabOrder:L=!1,expandedLabReports:Y={},toggleLabReport:z=()=>{},selectionEnabled:j=!1,selectedIds:Z=new Set,onSelectionChange:me})=>{const re=x.useMemo(()=>{const V={};n.forEach(I=>{if(isNaN(I.date.getTime())){V["Unknown Date"]||(V["Unknown Date"]=[]),V["Unknown Date"].push(I);return}const ye=mh(I.originalDateString);V[ye]||(V[ye]=[]),V[ye].push(I)});const F=Object.keys(V);return F.sort((I,ye)=>{if(I==="Unknown Date")return 1;if(ye==="Unknown Date")return-1;try{const O=new Date(I.split(" ").reverse().join(" ")),K=new Date(ye.split(" ").reverse().join(" "));if(!isNaN(O.getTime())&&!isNaN(K.getTime()))return K.getTime()-O.getTime()}catch{}return ye.localeCompare(I)}),F.map(I=>({date:I,items:V[I]}))},[n]),ce=["pending","billed","collected","processing","report_ready","completed","cancelled","reported"];return i.jsxs("div",{className:"ai-context-section",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h4",{className:"ai-context-section-title mb-2 pb-1",children:e}),r]}),s&&i.jsx("div",{className:"space-y-3",children:[1,2,3,4].map(V=>i.jsxs("div",{style:{padding:"10px",background:"var(--glass-light)",borderRadius:"8px",marginBottom:"8px"},children:[i.jsx(Te,{width:"80px",height:"14px",style:{marginBottom:"10px"}}),i.jsx(Te,{width:"100%",height:"16px",style:{marginBottom:"6px"}}),i.jsx(Te,{width:"70%",height:"14px"})]},V))}),!s&&n.length===0&&i.jsx("p",{className:"ai-context-text italic",children:o}),!s&&n.length>0&&i.jsx("div",{className:"space-y-3",children:re.map(({date:V,items:F})=>i.jsxs("div",{children:[i.jsx("h5",{className:"grouped-history-date",children:V}),i.jsx("div",{className:"space-y-1 grouped-history-item-container",children:F.map((I,ye)=>i.jsxs("div",{className:"grouped-history-item ai-context-item flex flex-col",children:[!(I.type==="Lab Order"&&I.data.isEditing)&&i.jsxs("div",{className:"flex justify-between items-center w-full",children:[j&&me&&I.type==="Pharmacy Order"&&i.jsx("div",{className:"mr-2",children:i.jsx("input",{type:"checkbox",checked:Z.has(I.data.id),onChange:O=>me(I.data.id,O.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),i.jsx("div",{className:"flex-grow mr-2 ai-context-text",children:t(I,ye,Y,z)}),i.jsxs("div",{className:"flex items-center space-x-1",children:[I.type==="Lab Order"&&!I.data.isEditing&&u&&i.jsx("button",{onClick:()=>u(I.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this lab order",disabled:L,children:i.jsx(gt,{size:14})}),I.type==="Lab Order"&&I.data.isEditing&&i.jsx(i.Fragment,{}),I.type==="Lab Order"&&i.jsxs("div",{className:"lab-table-actions",children:[I.data.status==="pending"&&B&&(()=>{const O=I.data.tests.reduce((K,H)=>K+(Number(H.price)||0),0).toFixed(2);return i.jsx("button",{onClick:()=>B(I.data),className:"text-green-600 hover:text-green-800 p-1 rounded hover:bg-green-100 focus:outline-none focus:ring-1 focus:ring-green-400",title:`Pay total of ₹${O}`,disabled:L,children:i.jsx(oo,{size:14})})})(),I.data.status==="billed"&&G&&i.jsx("button",{onClick:()=>G(I.data.id,"collected"),className:"lab-action-button btn-collect",title:"Collect Sample",children:"Collect"}),I.data.status==="collected"&&G&&i.jsx("button",{onClick:()=>G(I.data.id,"processing"),className:"lab-action-button btn-process",title:"Mark Processing",children:"Process"}),["pending","billed","collected","processing","report_ready","reported","completed"].includes(I.data.status)&&D&&i.jsx("button",{onClick:()=>D(I.data),className:"lab-action-button btn-enter-report",title:"Enter Report",children:"Enter Report"}),(I.data.status==="report_ready"||I.data.status==="reported")&&G&&i.jsx("button",{onClick:()=>G(I.data.id,"completed"),className:"lab-action-button btn-complete",title:"Mark Completed",children:"Complete"})]}),I.type==="Pharmacy Order"&&I.data.status==="pending"&&p&&i.jsx("button",{onClick:()=>p(I.data.id),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400",title:"Edit this pharmacy order",disabled:L,children:i.jsx(gt,{size:14})}),I.type==="Pharmacy Order"&&I.data.prescriptionForUnavailableDrugs&&P&&i.jsx("button",{onClick:()=>P(I.data.prescriptionForUnavailableDrugs,`Prescription for Order ${I.data.id}`),className:"text-purple-600 hover:text-purple-800 p-1 rounded hover:bg-purple-100 focus:outline-none focus:ring-1 focus:ring-purple-400",title:"Print Prescription for Unavailable Drugs",disabled:L,children:i.jsx(Rn,{size:14})}),I.type==="Pharmacy Order"&&I.data.status==="pending"&&l&&i.jsx("button",{onClick:()=>l({type:I.type,data:I.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:"Delete this pending pharmacy order",disabled:L,children:i.jsx(yt,{size:14})}),l&&["Complaint","Lab Order","Lab Report"].includes(I.type)&&i.jsx("button",{onClick:()=>l({type:I.type,data:I.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400",title:`Delete this ${I.type.toLowerCase()}`,disabled:L,children:i.jsx(yt,{size:14})})]})]}),I.type==="Lab Order"&&I.data.isEditing&&i.jsxs("div",{className:"lab-order-edit-form w-full bg-gray-50 border rounded-md p-3",children:[i.jsxs("div",{className:"flex justify-between items-center mb-3",children:[i.jsx("h6",{className:"text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Edit Order"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("label",{className:"text-xs font-medium text-gray-600",children:"Status:"}),i.jsx("select",{value:I.data.editedStatus||I.data.status,onChange:O=>y&&y(I.data.id,O.target.value),className:"form-select text-xs py-1 pl-2 pr-6 rounded border-gray-300 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50",disabled:L,children:ce.map(O=>i.jsx("option",{value:O,children:O.replace(/_/g," ")},O))})]})]}),i.jsx("div",{className:"overflow-hidden border rounded-md bg-white mb-3",children:i.jsxs("table",{className:"w-full text-xs text-left",children:[i.jsx("thead",{className:"bg-gray-100 border-b",children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-2 px-3 font-medium text-gray-600",children:"Test Name"}),i.jsx("th",{className:"py-2 px-3 text-right font-medium text-gray-600 w-20",children:"Price"}),i.jsx("th",{className:"py-2 px-3 w-10"})]})}),i.jsxs("tbody",{className:"divide-y divide-gray-100",children:[I.data.editedTests.map((O,K)=>i.jsxs("tr",{className:"hover:bg-gray-50",children:[i.jsx("td",{className:"py-1 px-3",children:i.jsxs("select",{value:O.id,onChange:H=>{const Se=J.find(de=>String(de.id)===H.target.value);Se&&(d&&d(I.data.id,K,"id",Se.id),d&&d(I.data.id,K,"name",Se.name),d&&d(I.data.id,K,"price",Se.price))},className:"form-select w-full text-xs border-0 bg-transparent focus:ring-0 p-0",disabled:L,children:[i.jsx("option",{value:"",children:"Select Test"}),J.map(H=>i.jsx("option",{value:H.id,children:H.name},H.id))]})}),i.jsxs("td",{className:"py-1 px-3 text-right text-gray-700",children:["₹",O.price]}),i.jsx("td",{className:"py-1 px-3 text-center",children:i.jsx("button",{onClick:()=>{const H=I.data.editedTests.filter((Se,de)=>de!==K);d&&d(I.data.id,-1,"remove",H)},className:"text-red-400 hover:text-red-600 focus:outline-none",title:"Remove test",disabled:L,children:i.jsx(yt,{size:12})})})]},K)),I.data.editedTests.length===0&&i.jsx("tr",{children:i.jsx("td",{colSpan:3,className:"py-2 px-3 text-center italic text-gray-400",children:"No tests selected"})})]}),i.jsx("tfoot",{className:"bg-gray-50 border-t",children:i.jsx("tr",{children:i.jsx("td",{colSpan:3,className:"py-1 px-3",children:i.jsx("button",{onClick:()=>{d&&d(I.data.id,-1,"add",{id:"",name:"",price:0})},className:"text-blue-600 hover:text-blue-800 text-xs font-medium flex items-center py-1",disabled:L,children:"+ Add Test"})})})})]})}),i.jsxs("div",{className:"flex justify-end space-x-2 border-t border-gray-200 pt-3 mt-1",children:[i.jsx("button",{onClick:()=>m&&m(I.data.id),className:"px-3 py-1.5 rounded text-xs text-gray-600 hover:bg-white hover:text-gray-800 border border-transparent hover:border-gray-200 transition-colors",disabled:L,children:"Cancel"}),i.jsx("button",{onClick:()=>c&&c(I.data.id,I.data.editedTests,I.data.editedStatus),className:"px-3 py-1.5 rounded text-xs bg-blue-600 text-white hover:bg-blue-700 shadow-sm flex items-center space-x-1 transition-colors",disabled:L,children:L?i.jsx("span",{children:"Saving..."}):i.jsxs(i.Fragment,{children:[i.jsx(Xs,{size:12}),i.jsx("span",{children:"Save Changes"})]})})]})]})]},`${I.type}-${I.originalDateString}-${ye}`))})]},V))})]})},ki=Ti.memo(gh),yh="_modalOverlay_i1kv7_3",xh="_modalContent_i1kv7_29",bh="_modalHeader_i1kv7_63",wh="_modalTitle_i1kv7_81",kh="_modalCloseButton_i1kv7_95",Nh="_modalBody_i1kv7_123",_h="_errorText_i1kv7_141",jh="_formGroup_i1kv7_159",vh="_inputField_i1kv7_185",Ch="_searchResultsCard_i1kv7_229",Sh="_searchResultsList_i1kv7_257",Th="_searchResultItem_i1kv7_269",Ph="_searchResultPrice_i1kv7_305",Eh="_selectedTestsCard_i1kv7_315",Ih="_selectedTestsHeader_i1kv7_335",Ah="_noTestsMessage_i1kv7_353",Dh="_selectedTestsList_i1kv7_369",Oh="_selectedTestItem_i1kv7_381",$h="_selectedTestName_i1kv7_405",Lh="_selectedTestPrice_i1kv7_417",Rh="_removeTestButton_i1kv7_429",Fh="_totalAmount_i1kv7_455",zh="_modalFooter_i1kv7_473",Bh="_button_i1kv7_499",qh="_buttonPrimary_i1kv7_517",Uh="_buttonSecondary_i1kv7_539",Ae={modalOverlay:yh,modalContent:xh,modalHeader:bh,modalTitle:wh,modalCloseButton:kh,modalBody:Nh,errorText:_h,formGroup:jh,inputField:vh,searchResultsCard:Ch,searchResultsList:Sh,searchResultItem:Th,searchResultPrice:Ph,selectedTestsCard:Eh,selectedTestsHeader:Ih,noTestsMessage:Ah,selectedTestsList:Dh,selectedTestItem:Oh,selectedTestName:$h,selectedTestPrice:Lh,removeTestButton:Rh,totalAmount:Fh,modalFooter:zh,button:Bh,buttonPrimary:qh,buttonSecondary:Uh},Mh=({isOpen:e,onClose:n,patientId:t,labInventory:r,fetchPendingLabOrdersData:s,isLoadingInventory:a=!1})=>{const[o,l]=x.useState([]),[u,c]=x.useState(""),[m,d]=x.useState([]),[y,p]=x.useState(null),[P,B]=x.useState(!1);Zs(void 0,e?200:99999);const G=x.useMemo(()=>new eo(r,{keys:["name","description"],threshold:.3}),[r]);x.useEffect(()=>{if(!u){d([]);return}const Y=G.search(u).map(z=>z.item);d(Y.slice(0,10))},[u,G]);const D=async()=>{if(!t){p("Patient ID is missing.");return}if(o.length===0){p("Please select at least one lab test.");return}B(!0),p(null);try{const Y={patient_id:t,tests:o.map(j=>({id:j.id,name:j.name,price:j.price}))},z=await W("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Y)});if(!z.ok){const j=await z.json().catch(()=>({}));throw new Error(j.message||`Failed to create lab order: ${z.statusText}`)}await z.json(),s(t),n(),l([]),c("")}catch(Y){p(`Lab Order Creation Error: ${Y.message}`)}finally{B(!1)}},J=Y=>{if(o.some(z=>z.id===Y.id)){p(`${Y.name} is already in the order.`),setTimeout(()=>p(null),3e3),c(""),d([]);return}l(z=>[...z,{...Y}]),c(""),d([])},L=Y=>{l(z=>z.filter(j=>j.id!==Y))};return e?i.jsx("div",{className:Ae.modalOverlay,children:i.jsxs("div",{className:Ae.modalContent,children:[i.jsxs("div",{className:Ae.modalHeader,children:[i.jsx("h3",{className:Ae.modalTitle,children:"Create New Lab Order"}),i.jsx("button",{onClick:n,className:Ae.modalCloseButton,children:i.jsx(gn,{size:20})})]}),i.jsxs("div",{className:Ae.modalBody,children:[y&&i.jsx("div",{className:Ae.errorText,children:y}),i.jsxs("div",{className:Ae.formGroup,style:{position:"relative"},children:[i.jsx("label",{htmlFor:"lab-test-search",children:"Add Lab Test"}),i.jsx("input",{type:"text",id:"lab-test-search",placeholder:"Search available lab tests...",value:u,onChange:Y=>c(Y.target.value),className:Ae.inputField}),u&&i.jsx("div",{className:Ae.searchResultsCard,children:a?i.jsx("div",{className:"p-2 space-y-2",children:[1,2,3].map(Y=>i.jsxs("div",{className:"flex justify-between items-center py-2 px-3",children:[i.jsx(Te,{width:"60%",height:20}),i.jsx(Te,{width:"20%",height:20})]},Y))}):m.length>0?i.jsx("ul",{className:Ae.searchResultsList,children:m.map(Y=>i.jsxs("li",{onClick:()=>J(Y),className:Ae.searchResultItem,children:[i.jsx("span",{children:Y.name}),i.jsxs("span",{className:Ae.searchResultPrice,children:["(₹",parseFloat(String(Y.price)).toFixed(2),")"]})]},Y.id))}):i.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No tests found."})})]}),i.jsxs("div",{className:Ae.selectedTestsCard,children:[i.jsx("h4",{className:Ae.selectedTestsHeader,children:"Selected Tests"}),o.length===0?i.jsx("p",{className:Ae.noTestsMessage,children:"No tests added yet."}):i.jsx("ul",{className:Ae.selectedTestsList,children:o.map(Y=>i.jsxs("li",{className:Ae.selectedTestItem,children:[i.jsx("span",{className:Ae.selectedTestName,children:Y.name}),i.jsxs("span",{className:Ae.selectedTestPrice,children:["₹",parseFloat(String(Y.price)).toFixed(2)]}),i.jsx("button",{type:"button",onClick:()=>L(String(Y.id)),className:Ae.removeTestButton,title:"Remove Test",children:i.jsx(yt,{size:16})})]},Y.id))})]}),o.length>0&&i.jsxs("div",{className:Ae.totalAmount,children:["Total: ₹",o.reduce((Y,z)=>Y+parseFloat(String(z.price)),0).toFixed(2)]})]}),i.jsxs("div",{className:Ae.modalFooter,children:[i.jsx("button",{type:"button",onClick:n,className:`${Ae.button} ${Ae.buttonSecondary}`,children:" Cancel "}),i.jsxs("button",{type:"button",onClick:D,disabled:o.length===0||P,className:`${Ae.button} ${Ae.buttonPrimary} ${o.length===0||P?Ae.buttonDisabled:""}`,children:[" ",P?"Saving...":"Create Lab Order"," "]})]})]})}):null},Ni=e=>{if(!e)return 1;const n=e.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return n?parseInt(n[1],10):1},Hh=x.forwardRef(({recordId:e,patientId:n,patientDetails:t,caseSummary:r,caseSummaryUpdatedAt:s,clinicSettings:a,userMessages:o,selectedImageFile:l,pendingLabOrders:u,labReports:c,pastComplaints:m,pharmacyOrders:d,pharmacyInventory:y,labInventory:p,recurringMedications:P,currentComplaint:B,setCurrentComplaint:G,setAiResponse:D,setAiResponseText:J,setAiResponseJsonString:L,setShowAiJsonDetails:Y,setIsLoadingAi:z,setAiError:j,setIsSubmittingAiOrder:Z,setAiOrderSubmissionStatus:me,setIsSubmittingAiLabOrder:re,setAiLabOrderSubmissionStatus:ce,setIsSubmittingAiComplaint:V,setAiComplaintSubmissionStatus:F,setIsUpdatingCaseSummary:I,setAiCaseSummaryUpdateStatus:ye,setCaseSummary:O,setIsUpdatingAiMemoryByAI:K,setAiMemoryUpdateByAIStatus:H,setFollowUpQuestion:Se,setFollowUpOptions:de,setError:w,setIsSavingAiResponse:ze,setSaveAiResponseError:ke,fetchPharmacyOrdersData:b,fetchPendingLabOrdersData:De,fetchLabReportsData:Ve,fetchRecurringMedicationsData:Ne,fetchPastComplaintsData:st,fetchPatientDetails:Fe,setClinicSettings:tt,setEditedAiMemory:ot,setCanUndo:nt,onAiActionSuccess:Yt,addMessage:_,onPrintLabBill:$t,onPrintPharmacyBill:Ct},Xt)=>{const[mt,xt]=Ti.useState(null);Ti.useEffect(()=>{nt(!!mt)},[mt,nt]);let Qe;const St=async(Le,C,S,v=0)=>{let X;const Re=["AI response did not contain a recognized function call","AI response did not result in a recognized or performed function call"].some(He=>{var ve;return(ve=C.message)==null?void 0:ve.includes(He)});S&&Re?X=`AI Error: ${C.message}

${S}`:(X=`I encountered a frontend error while trying to execute the '${Le}' function. The error message is: "${C.message}". Based on this error, please analyze what went wrong and either correct the function call and try again, or explain the problem.`,(Le==="create_pharmacy_order"||Le==="edit_pharmacy_order")&&(X+=`

IMPORTANT: When ordering medication, please first check if the medication ordered matches the exact name given in the inventory. If the name itself is not given in the inventory, you can use 'prescription_for_unavailable_drugs' to write a prescription. **NOTE:** This field MUST be formatted as a Markdown table (columns: Drug Name, Quantity, Dosage, Directions).`),S&&(X+=`

The original AI response that caused the error was:
\`\`\`
${S}
\`\`\``)),_==null||_({role:"system",type:"error",content:`AI Error: ${C.message}. Retrying...`}),await Qe(X,v+1)},Ht=async Le=>{console.log("Executing Rollback for actions:",Le);for(const C of Le){const{actionType:S,undoData:v}=C;if(console.log(`Attempting to rollback ${S}`,v),!v){console.warn(`No undoData found for action ${S}, skipping.`);continue}try{if(S==="create_pharmacy_order")v!=null&&v.orderId?(console.log(`Deleting pharmacy order ${v.orderId}`),await W(`/api/pharmacy-orders/${v.orderId}`,{method:"DELETE"}),b(n)):console.error("Missing orderId for create_pharmacy_order rollback");else if(S==="create_lab_order")v!=null&&v.orderId?(console.log(`Deleting lab order ${v.orderId}`),await W(`/api/lab/orders/${v.orderId}`,{method:"DELETE"}),De(n)):console.error("Missing orderId for create_lab_order rollback");else if(S==="update_patient_details")if(v!=null&&v.patientId&&(v!=null&&v.originalDetails)){console.log(`Reverting patient details for ${v.patientId}`);const X=v.originalDetails,se={name:X.name,age:X.age,gender:X.gender,phone:X.phone,ai_response:X.ai_response};await W(`/api/patients/${v.patientId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(se)}),Fe(v.patientId)}else console.error("Missing patientId or originalDetails for update_patient_details rollback");else if(S==="add_complaint_history")v!=null&&v.recordId?(console.log(`Reverting complaint history for ${v.recordId}`),await W(`/api/queue/doctor/complaint/${v.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:v.originalComplaint||""})}),G(v.originalComplaint||"")):console.error("Missing recordId for add_complaint_history rollback");else if(S==="update_case_summary")v!=null&&v.recordId?(console.log(`Reverting case summary for ${v.recordId}`),await W(`/api/queue/doctor/complaint/${v.recordId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:v.originalSummary||""})}),O(v.originalSummary||"")):console.error("Missing recordId for update_case_summary rollback");else if(S==="update_clinic_ai_memory")(v==null?void 0:v.originalMemory)!==void 0?(console.log("Reverting AI memory"),await W("/api/clinics/settings",{method:"PUT",body:JSON.stringify({...a,aiMemory:v.originalMemory})}),ot(v.originalMemory)):console.error("Missing originalMemory for update_clinic_ai_memory rollback");else if(S==="edit_pharmacy_order")if(v!=null&&v.orderId&&(v!=null&&v.originalState)){console.log(`Reverting pharmacy order ${v.orderId}`);const X={items:v.originalState.medications||[],status:v.originalState.status,prescription_for_unavailable_drugs:v.originalState.prescription_for_unavailable_drugs,order_total:v.originalState.order_total};await W(`/api/pharmacy-orders/${v.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)}),b(n)}else console.error("Missing orderId or originalState for edit_pharmacy_order rollback");else if(S==="edit_lab_order")if(v!=null&&v.orderId&&(v!=null&&v.originalState)){console.log(`Reverting lab order ${v.orderId}`);const X={tests:v.originalState.tests,status:v.originalState.status};await W(`/api/lab/orders/${v.orderId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(X)}),De(n)}else console.error("Missing orderId or originalState for edit_lab_order rollback");else if(S==="create_recurring_medication_order")if(v!=null&&v.createdIds&&v.createdIds.length>0){console.log(`Deleting recurring medications: ${v.createdIds.join(", ")}`);for(const X of v.createdIds)await W(`/api/recurring-medications/${X}`,{method:"DELETE"});n&&Ne&&Ne(n)}else console.error("Missing createdIds for create_recurring_medication_order rollback");else S==="edit_recurring_medication_order"?v!=null&&v.medicationId&&(v!=null&&v.originalState)?(console.log(`Reverting recurring medication ${v.medicationId}`),await W(`/api/recurring-medications/${v.medicationId}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(v.originalState)}),n&&Ne&&Ne(n)):console.error("Missing medicationId or originalState for edit_recurring_medication_order rollback"):console.warn(`Unknown action type for rollback: ${S}`)}catch(X){console.error(`Failed to rollback ${S}:`,X)}}},Zt=async()=>{!mt||!window.confirm("Are you sure you want to undo the last AI actions?")||(z(!0),await Ht([...mt].reverse()),xt(null),z(!1),j("Last actions undone successfully."))},We=async(Le,C)=>{xt(null),me(null),ce(null),F(null),ye(null),H(null),Se(null),de([]),w(null);let S=null;const v=/```json\s*([\s\S]*?)\s*```/,X=Le.match(v);if(X&&X[1])S=X[1];else{const se=Le.trim();if(se.startsWith("{")&&se.endsWith("}"))S=se;else if(se.startsWith("[")&&se.endsWith("]"))S=se;else throw new Error("AI response did not contain a recognized function call.")}if(S)try{const se=JSON.parse(S),Re=T=>{const R=[],A=Array.isArray(T)?T:[T];for(const E of A)E&&(E.actions&&Array.isArray(E.actions)?R.push(...Re(E.actions)):E.sub_actions&&Array.isArray(E.sub_actions)?R.push(...Re(E.sub_actions)):E.function_calls&&Array.isArray(E.function_calls)?R.push(...Re(E.function_calls)):typeof E.action=="string"&&R.push(E));return R},He=Re(se),ve=[];let Je=null,Ge=!1;for(const T of He){if(T.action==="ask_followup_question"){Je=T,Ge=!0;continue}Ge=!0;const R=T.action;if(R==="update_clinic_ai_memory"&&typeof T.memory_content=="string")ve.push((async()=>{K(!0),H("Processing AI mem..."),_==null||_({role:"system",type:"loading",content:"Processing AI memory..."});const A=(a==null?void 0:a.aiMemory)||"";try{if(!a)throw new Error("Clinic settings not loaded.");const E={...a,aiMemory:T.memory_content.trim(),admissionCharge:a.admissionCharge,perDayCharge:a.perDayCharge,otherCharges:a.otherCharges,clinicWideSystemPrompt:a.clinicWideSystemPrompt},ne=await W("/api/clinics/settings",{method:"PUT",body:JSON.stringify(E)});if(!ne.ok){const $=await ne.json().catch(()=>({}));throw new Error($.message||`AI-triggered clinic memory update failed: ${ne.statusText}`)}const te=await ne.json();return tt($=>$?{...$,aiMemory:te.settings.aiMemory}:null),ot(te.settings.aiMemory||""),H("AI mem updated!"),_==null||_({role:"system",type:"success",content:"AI memory updated successfully."}),{success:!0,actionType:R,undoData:{originalMemory:A}}}catch(E){return H("Failed"),{success:!1,actionType:R,error:E,originalActionPayload:T}}finally{K(!1)}})());else if(R==="create_pharmacy_order")ve.push((async()=>{var A,E;Z(!0),me("Processing order..."),_==null||_({role:"system",type:"loading",content:"Processing pharmacy order..."});try{if(!n)throw new Error("Missing patient ID.");const ne=[];let te=null;if(Array.isArray(T.items))for(const ie of T.items){let he;if(ie.drug_id?he=y.find(Ee=>Ee.id===ie.drug_id):ie.name&&(he=Ot(ie.name,y)),!he){te=`Drug "${ie.name||ie.drug_id}" not found.`;break}const le=Ni(he.pack),U=Number(he.mrp),Q=U,xe=le>0?U/le:0,qe=Number(ie.pack_quantity)||0,ae=Number(ie.loose_quantity)||0,je=qe*Q+ae*xe;ne.push({drug_id:String(he.id),name:he.name,pack_quantity:qe,loose_quantity:ae,tabletsPerDay:ie.tabletsPerDay,numberOfDays:ie.numberOfDays,directions_to_use:ie.directions_to_use,group_id:ie.group_id,pack_price:Q,loose_price:xe,total_price:je,price:U,isLoose:ie.isLoose,unit:he.pack})}if(te)throw new Error(te);const $=ne.reduce((ie,he)=>ie+he.total_price,0),pe={patient_id:n,items:ne,prescription_for_unavailable_drugs:T.prescription_for_unavailable_drugs,order_total:parseFloat($.toFixed(2))},Ce=await W("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(pe)});if(!Ce.ok){const ie=await Ce.json().catch(()=>({}));throw new Error(ie.message||"Order creation failed.")}const ge=await Ce.json();return me("Order created!"),b(n),_==null||_({role:"system",type:"success",content:"Pharmacy order created successfully."}),{success:!0,actionType:R,data:ge,undoData:{orderId:((E=(A=ge.orders)==null?void 0:A[0])==null?void 0:E.id)||ge.id}}}catch(ne){return _==null||_({role:"system",type:"error",content:`Pharmacy order failed: ${ne.message}`}),{success:!1,actionType:R,error:ne,originalActionPayload:T}}finally{Z(!1)}})());else if(R==="bill_pharmacy_order")ve.push((async()=>{Z(!0),me("Billing Pharmacy Order...");try{const A=T.serialNumber;if(!A)throw new Error("Missing serial number for billing.");if(!n)throw new Error("Missing patient ID.");const E=new Map;(d??[]).forEach(U=>E.set(U.id,{...U}));const ne=Array.from(E.values()).sort((U,Q)=>new Date(Q.date).getTime()-new Date(U.date).getTime()),te=ne.length-A,$=ne[te];if(!$)throw new Error(`Pharmacy order #${A} not found.`);if($.status==="billed"||$.status==="dispensed")throw new Error(`Order #${A} is already billed.`);const pe=$.medications.map(U=>{let Q;U.drug_id?Q=y.find(Ke=>String(Ke.id)===String(U.drug_id)):Q=y.find(Ke=>Ke.name.toLowerCase()===U.name.toLowerCase());const xe=Number(U.pack_price)||Number(Q==null?void 0:Q.mrp)||0,qe=Ni(U.unit||(Q==null?void 0:Q.pack)),ae=Number(U.loose_price)||(qe>0?xe/qe:0),je=(U.pack_quantity||0)*qe+(U.loose_quantity||0);let Ee=Number(U.total_price);return Ee||(Ee=je*ae),{...U,price:Ee,mrp:xe,pack_quantity:U.pack_quantity,loose_quantity:U.loose_quantity,expiry_date:U.expiry_date||(Q==null?void 0:Q.expiry_date),batch:U.batch||(Q==null?void 0:Q.box_number)}}),Ce=pe.reduce((U,Q)=>U+Q.price,0),ge=Ce,ie={patientId:n,queueId:$.id,items:pe.map(U=>({name:U.name,pack_quantity:U.pack_quantity,loose_quantity:U.loose_quantity,price:U.mrp,pack_price:U.mrp,loose_price:U.loose_price,total:U.price,drug_id:U.drug_id,discount_percentage:0,batch:U.batch,expiry_date:U.expiry_date})),amount:ge,paymentMode:"cash",type:"pharmacy",related_id:$.id,status:"paid",discountPercentage:0},he=await W("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)}),le=await he.json();if(!he.ok)throw new Error(le.message||"Failed to create pharmacy bill");return await W(`/api/pharmacy-orders/${$.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:le.id,medications:pe})}),me("Billed Successfully!"),b(n),Ct&&Ct({billId:le.id,patientName:(t==null?void 0:t.name)||"Patient",patientToken:(t==null?void 0:t.patient_token_number)||"",orderDate:$.date,items:pe,subtotal:Ce,totalDiscount:0,grandTotal:ge,clinicName:(a==null?void 0:a.name)||"",clinicAddress:(a==null?void 0:a.address)||"",clinicNotes:(a==null?void 0:a.notes)||"",clinicUpiId:(a==null?void 0:a.upi_id)||""}),_==null||_({role:"system",type:"success",content:`Pharmacy order #${$.id} billed.`}),{success:!0,actionType:R,data:le}}catch(A){return _==null||_({role:"system",type:"error",content:`Billing failed: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{Z(!1)}})());else if(R==="create_and_bill_pharmacy_order")ve.push((async()=>{Z(!0),me("Processing & Billing..."),_==null||_({role:"system",type:"loading",content:"Prescribing and billing..."});let A=null;try{if(!n)throw new Error("Missing patient ID.");const E=[];let ne=null;if(Array.isArray(T.items))for(const Q of T.items){let xe;if(Q.drug_id?xe=y.find(ct=>ct.id===Q.drug_id):Q.name&&(xe=Ot(Q.name,y)),!xe){ne=`Drug "${Q.name}" not found.`;break}const qe=Ni(xe.pack),ae=Number(xe.mrp),je=ae,Ee=qe>0?ae/qe:0,Ke=Number(Q.pack_quantity)||0,lt=Number(Q.loose_quantity)||0,bt=Ke*je+lt*Ee;E.push({drug_id:String(xe.id),name:xe.name,pack_quantity:Ke,loose_quantity:lt,tabletsPerDay:Q.tabletsPerDay,numberOfDays:Q.numberOfDays,directions_to_use:Q.directions_to_use,group_id:Q.group_id,pack_price:je,loose_price:Ee,total_price:bt,price:ae,mrp:ae,isLoose:Q.isLoose,unit:xe.pack,batch:xe.box_number,expiry_date:xe.expiry_date})}if(ne)throw new Error(ne);const te=E.reduce((Q,xe)=>Q+xe.total_price,0),$={patient_id:n,items:E,prescription_for_unavailable_drugs:T.prescription_for_unavailable_drugs,order_total:parseFloat(te.toFixed(2))},pe=await W("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify($)});if(!pe.ok)throw new Error("Order creation failed.");const Ce=await pe.json(),ge=Ce.orders?Ce.orders[0]:Ce;A=ge.id;const ie=te,he={patientId:n,queueId:ge.id,items:E.map(Q=>({name:Q.name,pack_quantity:Q.pack_quantity,loose_quantity:Q.loose_quantity,price:Q.mrp,pack_price:Q.mrp,loose_price:Q.loose_price,total:Q.total_price,drug_id:Q.drug_id,discount_percentage:0,batch:Q.batch,expiry_date:Q.expiry_date})),amount:ie,paymentMode:"cash",type:"pharmacy",related_id:ge.id,status:"paid",discountPercentage:0},le=await W("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(he)}),U=await le.json();if(!le.ok)throw new Error("Billing failed.");return await W(`/api/pharmacy-orders/${ge.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:U.id,medications:E})}),me("Ordered & Billed!"),b(n),Ct&&Ct({billId:U.id,patientName:(t==null?void 0:t.name)||"Patient",patientToken:(t==null?void 0:t.patient_token_number)||"",orderDate:new Date().toISOString(),items:E.map(Q=>({...Q,price:Q.total_price})),subtotal:ie,totalDiscount:0,grandTotal:ie,clinicName:(a==null?void 0:a.name)||"",clinicAddress:(a==null?void 0:a.address)||"",clinicNotes:(a==null?void 0:a.notes)||"",clinicUpiId:(a==null?void 0:a.upi_id)||""}),_==null||_({role:"system",type:"success",content:`Pharmacy order #${ge.id} created and billed.`}),{success:!0,actionType:R,data:ge,undoData:{orderId:ge.id}}}catch(E){return _==null||_({role:"system",type:"error",content:`Create & Bill failed: ${E.message}`}),{success:!1,actionType:R,error:E,originalActionPayload:T,undoData:A?{orderId:A}:void 0}}finally{Z(!1)}})());else if(R==="update_patient_details")ve.push((async()=>{z(!0),_==null||_({role:"system",type:"loading",content:"Updating patient details..."});const A={...t};try{if(!n)throw new Error("Missing patient ID.");const E={};if(T.name&&(E.name=T.name),T.age&&(E.age=T.age),T.gender&&(E.gender=T.gender),T.phone_number!==void 0&&(E.phone_number=T.phone_number),!(await W(`/api/patients/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(E)})).ok)throw new Error("Patient update failed.");return Fe(n),_==null||_({role:"system",type:"success",content:"Patient details updated."}),{success:!0,actionType:R,undoData:{patientId:n,originalDetails:A}}}catch(E){return{success:!1,actionType:R,error:E,originalActionPayload:T}}finally{z(!1)}})());else if(R==="create_lab_order")ve.push((async()=>{re(!0),ce("Processing lab..."),_==null||_({role:"system",type:"loading",content:"Processing lab order..."});try{if(!n)throw new Error("Missing patient ID.");const A=[];for(const te of T.tests||[]){let $;if(te.id?$=p.find(pe=>String(pe.id)===String(te.id)):te.name&&($=Ot(te.name,p)),!$)throw new Error(`Lab test "${te.name}" not found.`);A.push({id:$.id,name:$.name,price:Number($.price)})}const E=await W("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:n,tests:A})});if(!E.ok)throw new Error("Lab order creation failed.");const ne=await E.json();return ce("Success!"),De(n),_==null||_({role:"system",type:"success",content:"Lab order created."}),{success:!0,actionType:R,data:ne.labOrder,undoData:{orderId:ne.labOrder.id}}}catch(A){return _==null||_({role:"system",type:"error",content:`Lab order failed: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{re(!1)}})());else if(R==="create_and_bill_lab_order")ve.push((async()=>{re(!0),ce("Processing & Billing..."),_==null||_({role:"system",type:"loading",content:"Creating and billing lab order..."});let A=null;try{if(!n)throw new Error("Missing patient ID.");const E=[];for(const U of T.tests||[]){let Q;if(U.id?Q=p.find(xe=>String(xe.id)===String(U.id)):U.name&&(Q=Ot(U.name,p)),!Q)throw new Error(`Lab test "${U.name}" not found.`);E.push({id:Q.id,name:Q.name,price:Number(Q.price)})}const ne=await W("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:n,tests:E})});if(!ne.ok)throw new Error("Lab order creation failed.");const $=(await ne.json()).labOrder;A=$.id,_==null||_({role:"system",type:"loading",content:`Order #${$.id} created. Generating bill...`});const pe=E.map(U=>({name:U.name,price:typeof U.price=="string"?parseFloat(U.price):U.price||0,discount_percentage:0,quantity:1,item_id:U.id,type:"lab_test"})),Ce=pe.reduce((U,Q)=>U+Q.price,0),ge=Ce,ie={patientId:n,items:pe.map(U=>({...U,total:U.price})),amount:ge,paymentMode:"cash",type:"lab",related_id:$.id,status:"paid",discountPercentage:0},he=await W("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)}),le=await he.json();if(!he.ok)throw new Error(le.message||"Failed to create bill");return await W(`/api/lab/${$.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:le.id})}),ce("Success & Billed!"),De(n),$t&&$t({billId:le.id,patientName:(t==null?void 0:t.name)||"Patient",patientToken:(t==null?void 0:t.patient_token_number)||"",orderDate:$.createdAt,items:pe,subtotal:Ce,totalDiscount:0,grandTotal:ge,clinicName:(a==null?void 0:a.name)||"",clinicAddress:(a==null?void 0:a.address)||"",clinicNotes:(a==null?void 0:a.notes)||"",clinicUpiId:(a==null?void 0:a.upi_id)||"",labLetterheadUrl:a==null?void 0:a.labLetterheadUrl}),_==null||_({role:"system",type:"success",content:`Lab order #${$.id} created and billed. Opening print dialog.`}),{success:!0,actionType:R,data:$,undoData:{orderId:$.id}}}catch(E){return _==null||_({role:"system",type:"error",content:`Create and Bill failed: ${E.message}`}),{success:!1,actionType:R,error:E,originalActionPayload:T,undoData:A?{orderId:A}:void 0}}finally{re(!1)}})());else if(R==="create_lab_report")ve.push((async()=>{re(!0),ce("Creating Report..."),_==null||_({role:"system",type:"loading",content:"Creating lab report..."});try{if(!n)throw new Error("Missing patient ID.");const A=[],E=T.tests||[];for(const ge of E){let ie;if(ge.id?ie=p.find(he=>String(he.id)===String(ge.id)):ge.name&&(ie=Ot(ge.name,p)),!ie)throw new Error(`Lab test "${ge.name}" not found.`);ge._matchedTest=ie,A.push({id:ie.id,name:ie.name,price:Number(ie.price)})}const ne=await W("/api/lab",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:n,tests:A,status:"reported"})});if(!ne.ok)throw new Error("Lab order creation failed during report generation.");const te=await ne.json(),$=te.labOrder.id,pe={};if(E.forEach(ge=>{const ie=ge._matchedTest,he=ie.id,le=ge.parameters||[],U={},Q=ie.default_parameters||[];for(const xe of Q){const qe=le.find(ae=>{if(!ae.name)return!1;if(ae.name.toLowerCase()===xe.name.toLowerCase())return!0;const je=ae.name.toLowerCase(),Ee=xe.name.toLowerCase();return je.includes(Ee)||Ee.includes(je)});qe&&qe.value!==void 0?U[xe.name]=qe.value:xe.defaultValue!==void 0&&xe.defaultValue!==null&&(U[xe.name]=xe.defaultValue)}pe[he]=U}),!(await W(`/api/lab/${$}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(pe)})})).ok)throw new Error("Report submission failed.");return ce("Report Created!"),De(n),Ve(n),_==null||_({role:"system",type:"success",content:"Lab report created successfully."}),{success:!0,actionType:R,data:te.labOrder,undoData:{orderId:$}}}catch(A){return _==null||_({role:"system",type:"error",content:`Lab report failed: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{re(!1)}})());else if(R==="edit_lab_report")ve.push((async()=>{re(!0),ce("Updating Report...");try{const A=T.serialNumber;if(!A)throw new Error("Missing serial number for lab report edit.");const E=new Map;(u??[]).forEach(le=>E.set(le.id,{...le})),(c??[]).forEach(le=>{if(E.has(le.id)){const U=E.get(le.id);U.report=le,U.status=le.status}else E.set(le.id,{...le,createdAt:le.createdAt})});const ne=Array.from(E.values());ne.sort((le,U)=>new Date(U.createdAt).getTime()-new Date(le.createdAt).getTime());const te=ne.length-A,$=ne[te];if(!$)throw new Error(`Lab report #${A} not found.`);const pe=$.id;let Ce={};if($.report&&$.report.report_content)try{Ce=typeof $.report.report_content=="string"?JSON.parse($.report.report_content):$.report.report_content}catch{}const ge={...Ce};if((T.tests||[]).forEach(le=>{let Q=($.tests||[]).find(Ee=>Ee.name.toLowerCase()===le.name.toLowerCase());if(!Q)return;const xe=Q.id,qe=le.parameters||[],ae=p.find(Ee=>String(Ee.id)===String(xe)),je=(ae==null?void 0:ae.default_parameters)||[];ge[xe]||(ge[xe]={});for(const Ee of je){const Ke=qe.find(lt=>{if(!lt.name)return!1;if(lt.name.toLowerCase()===Ee.name.toLowerCase())return!0;const bt=lt.name.toLowerCase(),ct=Ee.name.toLowerCase();return bt.includes(ct)||ct.includes(bt)});Ke&&Ke.value!==void 0&&(ge[xe][Ee.name]=Ke.value)}}),!(await W(`/api/lab/${pe}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(ge)})})).ok)throw new Error("Report update failed.");return ce("Report Updated!"),De(n),Ve(n),_==null||_({role:"system",type:"success",content:"Lab report updated successfully."}),{success:!0,actionType:R,data:{orderId:pe},undoData:{orderId:pe}}}catch(A){return _==null||_({role:"system",type:"error",content:`Update report failed: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{re(!1)}})());else if(R==="edit_lab_order_and_create_report")ve.push((async()=>{re(!0),ce("Updating Order & Report..."),_==null||_({role:"system",type:"loading",content:"Updating lab order and report..."});try{const A=T.serialNumber;if(!A)throw new Error("Missing serial number.");const E=new Map;(u??[]).forEach(ae=>E.set(ae.id,{...ae})),(c??[]).forEach(ae=>{if(E.has(ae.id)){const je=E.get(ae.id);je.report=ae,je.status=ae.status}else E.set(ae.id,{...ae,createdAt:ae.createdAt})});const ne=Array.from(E.values());ne.sort((ae,je)=>new Date(je.createdAt).getTime()-new Date(ae.createdAt).getTime());const te=ne.length-A,$=ne[te];if(!$)throw new Error(`Lab order #${A} not found.`);const pe=$.id,Ce=JSON.parse(JSON.stringify($));let ge=[];for(const ae of $.tests||[]){const je=p.find(Ee=>String(Ee.id)===String(ae.id));je?ge.push({id:je.id,name:je.name,price:Number(je.price)}):ge.push({id:ae.id,name:ae.name,price:Number(ae.price)||0})}if(T.items_to_remove&&Array.isArray(T.items_to_remove)){const ae=T.items_to_remove;ge=ge.filter(je=>!ae.some(Ee=>Ee.id&&String(Ee.id)===String(je.id)||Ee.name&&je.name.toLowerCase()===Ee.name.toLowerCase()))}const ie=T.tests||[],he={};for(const ae of ie){let je;if(ae.id?je=p.find(rt=>String(rt.id)===String(ae.id)):ae.name&&(je=Ot(ae.name,p)),!je)throw new Error(`Lab test "${ae.name}" not found.`);ge.findIndex(rt=>String(rt.id)===String(je.id))===-1&&ge.push({id:je.id,name:je.name,price:Number(je.price)});const Ke=je.id,lt=ae.parameters||[],bt={},ct=je.default_parameters||[];for(const rt of ct){const en=lt.find(tn=>{if(!tn.name)return!1;if(tn.name.toLowerCase()===rt.name.toLowerCase())return!0;const Vn=tn.name.toLowerCase(),Wn=rt.name.toLowerCase();return Vn.includes(Wn)||Wn.includes(Vn)});en&&en.value!==void 0?bt[rt.name]=en.value:rt.defaultValue!==void 0&&(bt[rt.name]=rt.defaultValue)}he[Ke]=bt}const le={tests:ge};console.log("[DEBUG] edit_lab_order_and_create_report - Order Update Payload:",JSON.stringify(le,null,2)),console.log("[DEBUG] Items to remove:",T.items_to_remove),console.log("[DEBUG] Original tests:",$.tests);const U=await W(`/api/lab/orders/${pe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(le)});if(console.log("[DEBUG] Order update response status:",U.status),!U.ok){const ae=await U.json().catch(()=>({}));throw console.error("[DEBUG] Order update failed:",ae),new Error(`Failed to update lab order tests: ${ae.message||U.statusText}`)}let Q={};if($.report&&$.report.report_content)try{Q=typeof $.report.report_content=="string"?JSON.parse($.report.report_content):$.report.report_content}catch{}const xe={...Q,...he};if(!(await W(`/api/lab/${pe}/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({report_content:JSON.stringify(xe)})})).ok)throw new Error("Failed to create/update lab report.");return ce("Order & Report Updated!"),De(n),Ve(n),_==null||_({role:"system",type:"success",content:"Lab order and report updated successfully."}),{success:!0,actionType:R,undoData:{orderId:pe,originalState:Ce}}}catch(A){return _==null||_({role:"system",type:"error",content:`Failed to edit order and report: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{re(!1)}})());else if(R==="edit_pharmacy_order")ve.push((async()=>{Z(!0);try{const A=T.serialNumber;let E;if(A?E=[...d].sort((he,le)=>new Date(he.date).getTime()-new Date(le.date).getTime())[A-1]:E=d.find(ie=>ie.status==="pending"),!E)throw new Error("Order to edit not found.");const ne=JSON.parse(JSON.stringify(E));let te=[...E.medications];const $=T.items_to_remove,pe=T.items;if(Array.isArray($)&&(te=te.filter(ie=>!$.some(he=>he.drug_id&&String(ie.drug_id)===String(he.drug_id)||he.name&&ie.name.toLowerCase()===he.name.toLowerCase()))),Array.isArray(pe))for(const ie of pe){let he;if(ie.drug_id?he=y.find(Q=>String(Q.id)===String(ie.drug_id)):ie.name&&(he=Ot(ie.name,y)),!he)throw new Error(`Drug ${ie.name} not found.`);const le=te.findIndex(Q=>Q.drug_id===String(he==null?void 0:he.id)),U={drug_id:String(he.id),name:he.name,pack_quantity:ie.pack_quantity||0,loose_quantity:ie.loose_quantity||0,pack_price:Number(he.mrp),loose_price:0,total_price:0,price:Number(he.mrp)};le>=0?te[le]={...te[le],...U}:te.push(U)}const Ce={items:te,status:T.status,prescription_for_unavailable_drugs:T.prescription_for_unavailable_drugs,order_total:0};if(!(await W(`/api/pharmacy-orders/${E.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ce)})).ok)throw new Error("Order edit failed.");return b(n),{success:!0,actionType:R,undoData:{orderId:E.id,originalState:ne}}}catch(A){return{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{Z(!1)}})());else if(R==="edit_lab_order")ve.push((async()=>{re(!0);try{const A=u.sort(($,pe)=>new Date(pe.createdAt).getTime()-new Date($.createdAt).getTime()).find($=>$.status==="pending");if(!A)throw new Error("No pending lab order to edit.");const E=JSON.parse(JSON.stringify(A)),ne={tests:[],status:T.status};if(!(await W(`/api/lab/orders/${A.id}`,{method:"PUT",body:JSON.stringify(ne),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Lab edit failed.");return De(n),{success:!0,actionType:R,undoData:{orderId:A.id,originalState:E}}}catch(A){return{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{re(!1)}})());else if(R==="add_complaint_history")ve.push((async()=>{V(!0),_==null||_({role:"system",type:"loading",content:"Updating complaint history..."});const A=B;try{if(!e)throw new Error("No record ID.");if(!(await W(`/api/queue/doctor/complaint/${e}`,{method:"PUT",body:JSON.stringify({complaint:T.complaint}),headers:{"Content-Type":"application/json"}})).ok)throw new Error("Complaint update failed.");return G(T.complaint),n&&st(n),_==null||_({role:"system",type:"success",content:"Complaint history updated."}),{success:!0,actionType:R,undoData:{recordId:e,originalComplaint:A}}}catch(E){return _==null||_({role:"system",type:"error",content:`Complaint history update failed: ${E.message}`}),{success:!1,actionType:R,error:E,originalActionPayload:T}}finally{V(!1)}})());else if(R==="update_case_summary")ve.push((async()=>{I(!0),_==null||_({role:"system",type:"loading",content:"Updating case summary..."});const A=r;try{if(!e)throw new Error("No record ID.");const E=await W(`/api/queue/doctor/complaint/${e}`,{method:"PUT",body:JSON.stringify({case_summary:T.summary}),headers:{"Content-Type":"application/json"}});if(!E.ok)throw new Error("Summary update failed.");const ne=await E.json();return O(ne.case_summary),_==null||_({role:"system",type:"success",content:"Case summary updated."}),{success:!0,actionType:R,undoData:{recordId:e,originalSummary:A}}}catch(E){return _==null||_({role:"system",type:"error",content:`Case summary update failed: ${E.message}`}),{success:!1,actionType:R,error:E,originalActionPayload:T}}finally{I(!1)}})());else if(R==="create_recurring_medication_order")ve.push((async()=>{Z(!0),me("Creating recurring medication(s)..."),_==null||_({role:"system",type:"loading",content:"Creating recurring medication(s)..."});try{if(!n)throw new Error("Missing patient ID.");if(!T.items||!Array.isArray(T.items))throw new Error("No items provided for recurring medication order.");const A=await Promise.all(T.items.map(async $=>{let pe=$.drug_id;if(!pe){const Ce=Ot($.medication_name,y);pe=Ce?Ce.id:null}if(!pe)throw new Error(`Drug "${$.medication_name}" not found in inventory for recurring medication.`);return{...$,drug_id:pe}})),E=await W("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patient_id:n,items:A})});if(!E.ok){const $=await E.json().catch(()=>({}));throw new Error($.message||"Failed to create recurring medication order")}const ne=await E.json(),te=ne.map($=>$.id);return n&&Ne&&Ne(n),me("Recurring medication(s) created."),_==null||_({role:"system",type:"success",content:`Successfully created ${te.length} recurring medication(s).`}),{success:!0,actionType:R,data:ne,undoData:{createdIds:te}}}catch(A){return _==null||_({role:"system",type:"error",content:`Error creating recurring medication: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{Z(!1)}})());else if(R==="edit_recurring_medication_order")ve.push((async()=>{Z(!0),me("Updating recurring medication..."),_==null||_({role:"system",type:"loading",content:"Updating recurring medication..."});try{if(!n)throw new Error("Missing patient ID.");if(!T.serialNumber||!T.updates)throw new Error("Missing serialNumber or updates for recurring medication edit.");if(!P||P.length===0)throw new Error("No recurring medications found to edit.");const A=T.serialNumber-1;if(A<0||A>=P.length)throw new Error(`Recurring medication with serial number ${T.serialNumber} not found.`);const E=P[A],ne=JSON.parse(JSON.stringify(E));if(T.updates.drug_id===null||T.updates.medication_name){let $=T.updates.drug_id;if(!$&&T.updates.medication_name){const pe=Ot(T.updates.medication_name,y);$=pe?pe.id:null}if(!$&&T.updates.medication_name)throw new Error(`Drug "${T.updates.medication_name}" not found in inventory for update.`);T.updates.drug_id=$}const te=await W(`/api/recurring-medications/${E.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(T.updates)});if(!te.ok){const $=await te.json().catch(()=>({}));throw new Error($.message||"Failed to update recurring medication")}return n&&Ne&&Ne(n),me("Recurring medication updated."),_==null||_({role:"system",type:"success",content:`Successfully updated recurring medication #${T.serialNumber}.`}),{success:!0,actionType:R,data:{id:E.id,...T.updates},undoData:{medicationId:E.id,originalState:ne}}}catch(A){return _==null||_({role:"system",type:"error",content:`Error updating recurring medication: ${A.message}`}),{success:!1,actionType:R,error:A,originalActionPayload:T}}finally{Z(!1)}})());else if(R==="end_task")ve.push((async()=>(_==null||_({role:"system",type:"success",content:"Task completed."}),{success:!0,actionType:R}))());else{if(R==="bill_lab_order")continue;console.warn(`Unknown action ${R}`),ve.push(Promise.resolve({success:!1,actionType:R,error:new Error(`Unknown action: ${R}`),originalActionPayload:T}))}}const Be=await Promise.all(ve),ee=Be.filter(T=>!T.success);if(ee.length>0){console.log("AI Actions Failed. Initiating Rollback...",ee);const T=Be.filter(te=>te.success),R=[...T].reverse();await Ht(R);const A=ee.map(te=>{var $;return`${te.actionType}: ${($=te.error)==null?void 0:$.message}`}).join("; "),E=T.length>0?` I successfully rolled back ${T.length} other actions that succeeded.`:"",ne=`One or more actions failed: [${A}].${E} Please analyze the failure and try again.`;await St("multiple_actions",{message:ne},Le,C)}else{const T=Be.filter(A=>A.success);T.length>0&&(xt(T),Yt&&T.forEach(A=>Yt(A.actionType)));const R=He.find(A=>A.action==="bill_lab_order");if(R&&R.serialNumber){const A=new Map;(u??[]).forEach($=>A.set($.id,{...$}));const E=Array.from(A.values());E.sort(($,pe)=>new Date(pe.createdAt).getTime()-new Date($.createdAt).getTime());const ne=E.length-R.serialNumber,te=E[ne];if(te&&te.id){_==null||_({role:"system",type:"success",content:`Processing billing for Lab Order #${R.serialNumber}...`});try{const $=te.tests.map(U=>({name:U.test_name||U.name,price:typeof U.price=="string"?parseFloat(U.price):U.price||0,discount_percentage:0,quantity:1,item_id:U.test_id||U.id,type:"lab_test"})),pe=$.reduce((U,Q)=>U+Q.price,0),Ce=0,ge=pe,ie={patientId:te.patient_id,items:$.map(U=>({...U,total:U.price})),amount:ge,paymentMode:"cash",type:"lab",related_id:te.id,status:"paid",discountPercentage:0},he=await W("/api/bills",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)}),le=await he.json();if(!he.ok)throw new Error(le.message||"Failed to create bill");await W(`/api/lab/${te.id}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"billed",bill_id:le.id})}),n&&De(n),$t&&($t({billId:le.id,patientName:(t==null?void 0:t.name)||"Patient",patientToken:(t==null?void 0:t.patient_token_number)||"",orderDate:te.createdAt,items:$,subtotal:pe,totalDiscount:Ce,grandTotal:ge,clinicName:(a==null?void 0:a.name)||"",clinicAddress:(a==null?void 0:a.address)||"",clinicNotes:(a==null?void 0:a.notes)||"",clinicUpiId:(a==null?void 0:a.upi_id)||"",labLetterheadUrl:a==null?void 0:a.labLetterheadUrl}),_==null||_({role:"system",type:"success",content:`Bill #${le.id} created. Opening print dialog.`}))}catch($){console.error("Auto-billing failed:",$),_==null||_({role:"system",type:"error",content:`Billing failed: ${$.message}`})}}else console.warn(`Could not find lab order with serialNumber ${R.serialNumber} to bill.`),_==null||_({role:"system",type:"error",content:`Could not find lab order #${R.serialNumber} to bill.`})}if(Je&&typeof Je.question=="string")Se(Je.question),de(Array.isArray(Je.options)?Je.options:[]);else if(T.length===0&&!R&&!Ge)throw new Error("AI response did not result in a recognized or performed function call.")}}catch(se){await St("parse_json_actions",se,Le,C)}else throw new Error("AI response did not contain a recognized function call.")};Qe=async(Le,C=0)=>{if(C>1){j("AI call failed after multiple retries. Please try a different prompt."),z(!1);return}z(!0),j(null);let S;const X=[...o,Le].join(`

`);try{const se=new Map;(u??[]).forEach(ee=>{se.set(ee.id,{...ee})}),(c??[]).forEach(ee=>{if(!se.has(ee.id))se.set(ee.id,{id:ee.id,patient_id:ee.patient_id,tests:ee.tests,status:ee.status,createdAt:ee.createdAt,report:ee});else{const T=se.get(ee.id);T&&(T.report=ee,T.status=ee.status)}});const Re=Array.from(se.values());Re.sort((ee,T)=>new Date(T.createdAt).getTime()-new Date(ee.createdAt).getTime());const He=Re.map((ee,T)=>{let R=null;if(ee.report)try{const A=typeof ee.report.report_content=="string"?ee.report.report_content:JSON.stringify(ee.report.report_content||{}),E=JSON.parse(A||"{}"),ne=te=>{const $=E[te.id]||{},pe=Ce=>({name:Ce.name,value:$[Ce.name]!==void 0?String($[Ce.name]):String(Ce.defaultValue),normal_range:Ce.normal_range||"N/A"});return{testId:te.id,testName:te.name,parameters:(te.default_parameters||[]).map(pe)}};R={reportId:ee.report.reportId,reportDate:ee.report.report_date,tests:(ee.tests||[]).map(ne)}}catch{R={reportId:ee.report.reportId,reportDate:ee.report.report_date,reportContent:typeof ee.report.report_content=="string"?ee.report.report_content:JSON.stringify(ee.report.report_content),error:"Failed to parse report content JSON."}}return{serialNumber:Re.length-T,orderId:ee.id,orderDate:isNaN(new Date(ee.createdAt).getTime())?ee.createdAt:new Date(ee.createdAt).toISOString(),tests:ee.tests.map(A=>({id:A.id,name:A.name,price:A.price})),status:ee.status,report:R}}),ve=m.map(ee=>{try{return{...ee,createdAt:isNaN(new Date(ee.createdAt).getTime())?ee.createdAt:new Date(ee.createdAt).toISOString()}}catch{return ee}}),Ge=[...d].sort((ee,T)=>{const R=new Date(ee.date).getTime(),A=new Date(T.date).getTime();return R-A}).map((ee,T)=>{try{return{serialNumber:T+1,...ee,date:ee.date&&!isNaN(new Date(ee.date).getTime())?new Date(ee.date).toISOString():ee.date}}catch{return{serialNumber:T+1,...ee}}}),Be={query:X,currentDateTime:new Date().toISOString(),patientName:(t==null?void 0:t.name)||"",patientAge:(t==null?void 0:t.age)||void 0,patientGender:(t==null?void 0:t.gender)||void 0,case_summary:r||"",case_summary_last_updated:s?new Date(s).toISOString():void 0,clinic_ai_memory:(a==null?void 0:a.aiMemory)||"",clinic_ai_memory_last_updated:a!=null&&a.aiMemoryUpdatedAt?new Date(a.aiMemoryUpdatedAt).toISOString():void 0,clinic_wide_system_prompt:(a==null?void 0:a.clinicWideSystemPrompt)||"",labHistory:He,pharmacyOrders:Ge,pastComplaints:ve,pharmacyInventory:y,labInventory:p,recurringMedications:P};if(console.log("DEBUG: Payload before sending to Gemini API:",JSON.stringify(Be,null,2)),S=await dc(Be,l),S){D(S),_==null||_({role:"ai",content:S});const ee=/```json\s*([\s\S]*?)\s*```/,T=S.match(ee);if(T&&T[1])J(S.replace(ee,"").trim()),L(T[1].trim());else{const R=S.trim();if(R.startsWith("{")&&R.endsWith("}"))try{JSON.parse(R),J(""),L(R)}catch{J(R),L(null)}else if(R.startsWith("[")&&R.endsWith("]"))try{JSON.parse(R),J(""),L(R)}catch{J(R),L(null)}else J(R),L(null)}Y(!1),n&&S&&await Tt(n,S),await We(S,C),G("")}else throw new Error("Invalid AI response format.")}catch(se){await St("call_generative_api",se,S,C)}finally{z(!1)}};const Tt=async(Le,C)=>{ze(!0),ke(null);try{const S={ai_response:C},v=await W(`/api/patients/${Le}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});if(!v.ok){const X=await v.json().catch(()=>({}));throw new Error(X.message||`Failed to save AI response to patient: ${v.statusText}`)}}catch(S){ke(`AI Response Save Error: ${S.message}`),_==null||_({role:"system",type:"error",content:`AI Response Save Error: ${S.message}`})}finally{ze(!1)}};return x.useImperativeHandle(Xt,()=>({callGenerativeApi:Qe,undoLastAction:Zt})),null}),zo=-1,Cr=0,Bn=1,Nr=2,Ki=3,Yi=4,Xi=5,Zi=6,Bo=7,qo=8,Os=typeof self=="object"?self:globalThis,Vh=(e,n)=>{const t=(s,a)=>(e.set(a,s),s),r=s=>{if(e.has(s))return e.get(s);const[a,o]=n[s];switch(a){case Cr:case zo:return t(o,s);case Bn:{const l=t([],s);for(const u of o)l.push(r(u));return l}case Nr:{const l=t({},s);for(const[u,c]of o)l[r(u)]=r(c);return l}case Ki:return t(new Date(o),s);case Yi:{const{source:l,flags:u}=o;return t(new RegExp(l,u),s)}case Xi:{const l=t(new Map,s);for(const[u,c]of o)l.set(r(u),r(c));return l}case Zi:{const l=t(new Set,s);for(const u of o)l.add(r(u));return l}case Bo:{const{name:l,message:u}=o;return t(new Os[l](u),s)}case qo:return t(BigInt(o),s);case"BigInt":return t(Object(BigInt(o)),s);case"ArrayBuffer":return t(new Uint8Array(o).buffer,o);case"DataView":{const{buffer:l}=new Uint8Array(o);return t(new DataView(l),o)}}return t(new Os[a](o),s)};return r},$s=e=>Vh(new Map,e)(0),pn="",{toString:Wh}={},{keys:Jh}=Object,Ln=e=>{const n=typeof e;if(n!=="object"||!e)return[Cr,n];const t=Wh.call(e).slice(8,-1);switch(t){case"Array":return[Bn,pn];case"Object":return[Nr,pn];case"Date":return[Ki,pn];case"RegExp":return[Yi,pn];case"Map":return[Xi,pn];case"Set":return[Zi,pn];case"DataView":return[Bn,t]}return t.includes("Array")?[Bn,t]:t.includes("Error")?[Bo,t]:[Nr,t]},mr=([e,n])=>e===Cr&&(n==="function"||n==="symbol"),Qh=(e,n,t,r)=>{const s=(o,l)=>{const u=r.push(o)-1;return t.set(l,u),u},a=o=>{if(t.has(o))return t.get(o);let[l,u]=Ln(o);switch(l){case Cr:{let m=o;switch(u){case"bigint":l=qo,m=o.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+u);m=null;break;case"undefined":return s([zo],o)}return s([l,m],o)}case Bn:{if(u){let y=o;return u==="DataView"?y=new Uint8Array(o.buffer):u==="ArrayBuffer"&&(y=new Uint8Array(o)),s([u,[...y]],o)}const m=[],d=s([l,m],o);for(const y of o)m.push(a(y));return d}case Nr:{if(u)switch(u){case"BigInt":return s([u,o.toString()],o);case"Boolean":case"Number":case"String":return s([u,o.valueOf()],o)}if(n&&"toJSON"in o)return a(o.toJSON());const m=[],d=s([l,m],o);for(const y of Jh(o))(e||!mr(Ln(o[y])))&&m.push([a(y),a(o[y])]);return d}case Ki:return s([l,o.toISOString()],o);case Yi:{const{source:m,flags:d}=o;return s([l,{source:m,flags:d}],o)}case Xi:{const m=[],d=s([l,m],o);for(const[y,p]of o)(e||!(mr(Ln(y))||mr(Ln(p))))&&m.push([a(y),a(p)]);return d}case Zi:{const m=[],d=s([l,m],o);for(const y of o)(e||!mr(Ln(y)))&&m.push(a(y));return d}}const{message:c}=o;return s([l,{name:u,message:c}],o)};return a},Ls=(e,{json:n,lossy:t}={})=>{const r=[];return Qh(!(n||t),!!n,new Map,r)(e),r},qn=typeof structuredClone=="function"?(e,n)=>n&&("json"in n||"lossy"in n)?$s(Ls(e,n)):structuredClone(e):(e,n)=>$s(Ls(e,n)),Uo=Ho("end"),Mo=Ho("start");function Ho(e){return n;function n(t){const r=t&&t.position&&t.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function Vo(e){const n=Mo(e),t=Uo(e);if(n&&t)return{start:n,end:t}}const Qt=["ariaDescribedBy","ariaLabel","ariaLabelledBy"],Rs={ancestors:{tbody:["table"],td:["table"],th:["table"],thead:["table"],tfoot:["table"],tr:["table"]},attributes:{a:[...Qt,"dataFootnoteBackref","dataFootnoteRef",["className","data-footnote-backref"],"href"],blockquote:["cite"],code:[["className",/^language-./]],del:["cite"],div:["itemScope","itemType"],dl:[...Qt],h2:[["className","sr-only"]],img:[...Qt,"longDesc","src"],input:[["disabled",!0],["type","checkbox"]],ins:["cite"],li:[["className","task-list-item"]],ol:[...Qt,["className","contains-task-list"]],q:["cite"],section:["dataFootnotes",["className","footnotes"]],source:["srcSet"],summary:[...Qt],table:[...Qt],ul:[...Qt,["className","contains-task-list"]],"*":["abbr","accept","acceptCharset","accessKey","action","align","alt","axis","border","cellPadding","cellSpacing","char","charOff","charSet","checked","clear","colSpan","color","cols","compact","coords","dateTime","dir","encType","frame","hSpace","headers","height","hrefLang","htmlFor","id","isMap","itemProp","label","lang","maxLength","media","method","multiple","name","noHref","noShade","noWrap","open","prompt","readOnly","rev","rowSpan","rows","rules","scope","selected","shape","size","span","start","summary","tabIndex","title","useMap","vAlign","value","width"]},clobber:["ariaDescribedBy","ariaLabelledBy","id","name"],clobberPrefix:"user-content-",protocols:{cite:["http","https"],href:["http","https","irc","ircs","mailto","xmpp"],longDesc:["http","https"],src:["http","https"]},required:{input:{disabled:!0,type:"checkbox"}},strip:["script"],tagNames:["a","b","blockquote","br","code","dd","del","details","div","dl","dt","em","h1","h2","h3","h4","h5","h6","hr","i","img","input","ins","kbd","li","ol","p","picture","pre","q","rp","rt","ruby","s","samp","section","source","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","tr","tt","ul","var"]},qt={}.hasOwnProperty;function Gh(e,n){let t={type:"root",children:[]};const r={schema:n?{...Rs,...n}:Rs,stack:[]},s=Wo(r,e);return s&&(Array.isArray(s)?s.length===1?t=s[0]:t.children=s:t=s),t}function Wo(e,n){if(n&&typeof n=="object"){const t=n;switch(typeof t.type=="string"?t.type:""){case"comment":return Kh(e,t);case"doctype":return Yh(e,t);case"element":return Xh(e,t);case"root":return Zh(e,t);case"text":return em(e,t)}}}function Kh(e,n){if(e.schema.allowComments){const t=typeof n.value=="string"?n.value:"",r=t.indexOf("-->"),a={type:"comment",value:r<0?t:t.slice(0,r)};return Mn(a,n),a}}function Yh(e,n){if(e.schema.allowDoctypes){const t={type:"doctype"};return Mn(t,n),t}}function Xh(e,n){const t=typeof n.tagName=="string"?n.tagName:"";e.stack.push(t);const r=Jo(e,n.children),s=tm(e,n.properties);e.stack.pop();let a=!1;if(t&&t!=="*"&&(!e.schema.tagNames||e.schema.tagNames.includes(t))&&(a=!0,e.schema.ancestors&&qt.call(e.schema.ancestors,t))){const l=e.schema.ancestors[t];let u=-1;for(a=!1;++u<l.length;)e.stack.includes(l[u])&&(a=!0)}if(!a)return e.schema.strip&&!e.schema.strip.includes(t)?r:void 0;const o={type:"element",tagName:t,properties:s,children:r};return Mn(o,n),o}function Zh(e,n){const r={type:"root",children:Jo(e,n.children)};return Mn(r,n),r}function em(e,n){const r={type:"text",value:typeof n.value=="string"?n.value:""};return Mn(r,n),r}function Jo(e,n){const t=[];if(Array.isArray(n)){const r=n;let s=-1;for(;++s<r.length;){const a=Wo(e,r[s]);a&&(Array.isArray(a)?t.push(...a):t.push(a))}}return t}function tm(e,n){const t=e.stack[e.stack.length-1],r=e.schema.attributes,s=e.schema.required,a=r&&qt.call(r,t)?r[t]:void 0,o=r&&qt.call(r,"*")?r["*"]:void 0,l=n&&typeof n=="object"?n:{},u={};let c;for(c in l)if(qt.call(l,c)){const m=l[c];let d=Fs(e,zs(a,c),c,m);d==null&&(d=Fs(e,zs(o,c),c,m)),d!=null&&(u[c]=d)}if(s&&qt.call(s,t)){const m=s[t];for(c in m)qt.call(m,c)&&!qt.call(u,c)&&(u[c]=m[c])}return u}function Fs(e,n,t,r){return n?Array.isArray(r)?nm(e,n,t,r):Qo(e,n,t,r):void 0}function nm(e,n,t,r){let s=-1;const a=[];for(;++s<r.length;){const o=Qo(e,n,t,r[s]);(typeof o=="number"||typeof o=="string")&&a.push(o)}return a}function Qo(e,n,t,r){if(!(typeof r!="boolean"&&typeof r!="number"&&typeof r!="string")&&rm(e,t,r)){if(typeof n=="object"&&n.length>1){let s=!1,a=0;for(;++a<n.length;){const o=n[a];if(o&&typeof o=="object"&&"flags"in o){if(o.test(String(r))){s=!0;break}}else if(o===r){s=!0;break}}if(!s)return}return e.schema.clobber&&e.schema.clobberPrefix&&e.schema.clobber.includes(t)?e.schema.clobberPrefix+r:r}}function rm(e,n,t){const r=e.schema.protocols&&qt.call(e.schema.protocols,n)?e.schema.protocols[n]:void 0;if(!r||r.length===0)return!0;const s=String(t),a=s.indexOf(":"),o=s.indexOf("?"),l=s.indexOf("#"),u=s.indexOf("/");if(a<0||u>-1&&a>u||o>-1&&a>o||l>-1&&a>l)return!0;let c=-1;for(;++c<r.length;){const m=r[c];if(a===m.length&&s.slice(0,m.length)===m)return!0}return!1}function Mn(e,n){const t=Vo(n);n.data&&(e.data=qn(n.data)),t&&(e.position=t)}function zs(e,n){let t,r=-1;if(e)for(;++r<e.length;){const s=e[r],a=typeof s=="string"?s:s[0];if(a===n)return s;a==="data*"&&(t=s)}if(n.length>4&&n.slice(0,4).toLowerCase()==="data")return t}function im(e,n){const t={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(n),!0)};return e.patch(n,t),e.applyData(n,t)}function am(e,n){const t={type:"element",tagName:"br",properties:{},children:[]};return e.patch(n,t),[e.applyData(n,t),{type:"text",value:`
`}]}function sm(e,n){const t=n.value?n.value+`
`:"",r={};n.lang&&(r.className=["language-"+n.lang]);let s={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return n.meta&&(s.data={meta:n.meta}),e.patch(n,s),s=e.applyData(n,s),s={type:"element",tagName:"pre",properties:{},children:[s]},e.patch(n,s),s}function om(e,n){const t={type:"element",tagName:"del",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function lm(e,n){const t={type:"element",tagName:"em",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function cm(e,n){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(n.identifier).toUpperCase(),s=yn(r.toLowerCase()),a=e.footnoteOrder.indexOf(r);let o,l=e.footnoteCounts.get(r);l===void 0?(l=0,e.footnoteOrder.push(r),o=e.footnoteOrder.length):o=a+1,l+=1,e.footnoteCounts.set(r,l);const u={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+s,id:t+"fnref-"+s+(l>1?"-"+l:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(o)}]};e.patch(n,u);const c={type:"element",tagName:"sup",properties:{},children:[u]};return e.patch(n,c),e.applyData(n,c)}function um(e,n){const t={type:"element",tagName:"h"+n.depth,properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function dm(e,n){if(e.options.allowDangerousHtml){const t={type:"raw",value:n.value};return e.patch(n,t),e.applyData(n,t)}}function Go(e,n){const t=n.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(n.label||n.identifier)+"]"),n.type==="imageReference")return[{type:"text",value:"!["+n.alt+r}];const s=e.all(n),a=s[0];a&&a.type==="text"?a.value="["+a.value:s.unshift({type:"text",value:"["});const o=s[s.length-1];return o&&o.type==="text"?o.value+=r:s.push({type:"text",value:r}),s}function pm(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return Go(e,n);const s={src:yn(r.url||""),alt:n.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const a={type:"element",tagName:"img",properties:s,children:[]};return e.patch(n,a),e.applyData(n,a)}function hm(e,n){const t={src:yn(n.url)};n.alt!==null&&n.alt!==void 0&&(t.alt=n.alt),n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"img",properties:t,children:[]};return e.patch(n,r),e.applyData(n,r)}function mm(e,n){const t={type:"text",value:n.value.replace(/\r?\n|\r/g," ")};e.patch(n,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return e.patch(n,r),e.applyData(n,r)}function fm(e,n){const t=String(n.identifier).toUpperCase(),r=e.definitionById.get(t);if(!r)return Go(e,n);const s={href:yn(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const a={type:"element",tagName:"a",properties:s,children:e.all(n)};return e.patch(n,a),e.applyData(n,a)}function gm(e,n){const t={href:yn(n.url)};n.title!==null&&n.title!==void 0&&(t.title=n.title);const r={type:"element",tagName:"a",properties:t,children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function ym(e,n,t){const r=e.all(n),s=t?xm(t):Ko(n),a={},o=[];if(typeof n.checked=="boolean"){const m=r[0];let d;m&&m.type==="element"&&m.tagName==="p"?d=m:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:n.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let l=-1;for(;++l<r.length;){const m=r[l];(s||l!==0||m.type!=="element"||m.tagName!=="p")&&o.push({type:"text",value:`
`}),m.type==="element"&&m.tagName==="p"&&!s?o.push(...m.children):o.push(m)}const u=r[r.length-1];u&&(s||u.type!=="element"||u.tagName!=="p")&&o.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:a,children:o};return e.patch(n,c),e.applyData(n,c)}function xm(e){let n=!1;if(e.type==="list"){n=e.spread||!1;const t=e.children;let r=-1;for(;!n&&++r<t.length;)n=Ko(t[r])}return n}function Ko(e){const n=e.spread;return n??e.children.length>1}function bm(e,n){const t={},r=e.all(n);let s=-1;for(typeof n.start=="number"&&n.start!==1&&(t.start=n.start);++s<r.length;){const o=r[s];if(o.type==="element"&&o.tagName==="li"&&o.properties&&Array.isArray(o.properties.className)&&o.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const a={type:"element",tagName:n.ordered?"ol":"ul",properties:t,children:e.wrap(r,!0)};return e.patch(n,a),e.applyData(n,a)}function wm(e,n){const t={type:"element",tagName:"p",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function km(e,n){const t={type:"root",children:e.wrap(e.all(n))};return e.patch(n,t),e.applyData(n,t)}function Nm(e,n){const t={type:"element",tagName:"strong",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}function _m(e,n){const t=e.all(n),r=t.shift(),s=[];if(r){const o={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(n.children[0],o),s.push(o)}if(t.length>0){const o={type:"element",tagName:"tbody",properties:{},children:e.wrap(t,!0)},l=Mo(n.children[1]),u=Uo(n.children[n.children.length-1]);l&&u&&(o.position={start:l,end:u}),s.push(o)}const a={type:"element",tagName:"table",properties:{},children:e.wrap(s,!0)};return e.patch(n,a),e.applyData(n,a)}function jm(e,n,t){const r=t?t.children:void 0,a=(r?r.indexOf(n):1)===0?"th":"td",o=t&&t.type==="table"?t.align:void 0,l=o?o.length:n.children.length;let u=-1;const c=[];for(;++u<l;){const d=n.children[u],y={},p=o?o[u]:void 0;p&&(y.align=p);let P={type:"element",tagName:a,properties:y,children:[]};d&&(P.children=e.all(d),e.patch(d,P),P=e.applyData(d,P)),c.push(P)}const m={type:"element",tagName:"tr",properties:{},children:e.wrap(c,!0)};return e.patch(n,m),e.applyData(n,m)}function vm(e,n){const t={type:"element",tagName:"td",properties:{},children:e.all(n)};return e.patch(n,t),e.applyData(n,t)}const Bs=9,qs=32;function Cm(e){const n=String(e),t=/\r?\n|\r/g;let r=t.exec(n),s=0;const a=[];for(;r;)a.push(Us(n.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=t.exec(n);return a.push(Us(n.slice(s),s>0,!1)),a.join("")}function Us(e,n,t){let r=0,s=e.length;if(n){let a=e.codePointAt(r);for(;a===Bs||a===qs;)r++,a=e.codePointAt(r)}if(t){let a=e.codePointAt(s-1);for(;a===Bs||a===qs;)s--,a=e.codePointAt(s-1)}return s>r?e.slice(r,s):""}function Sm(e,n){const t={type:"text",value:Cm(String(n.value))};return e.patch(n,t),e.applyData(n,t)}function Tm(e,n){const t={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(n,t),e.applyData(n,t)}const Pm={blockquote:im,break:am,code:sm,delete:om,emphasis:lm,footnoteReference:cm,heading:um,html:dm,imageReference:pm,image:hm,inlineCode:mm,linkReference:fm,link:gm,listItem:ym,list:bm,paragraph:wm,root:km,strong:Nm,table:_m,tableCell:vm,tableRow:jm,text:Sm,thematicBreak:Tm,toml:fr,yaml:fr,definition:fr,footnoteDefinition:fr};function fr(){}function Em(e,n){const t=[{type:"text",value:"↩"}];return n>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(n)}]}),t}function Im(e,n){return"Back to reference "+(e+1)+(n>1?"-"+n:"")}function Am(e){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",t=e.options.footnoteBackContent||Em,r=e.options.footnoteBackLabel||Im,s=e.options.footnoteLabel||"Footnotes",a=e.options.footnoteLabelTagName||"h2",o=e.options.footnoteLabelProperties||{className:["sr-only"]},l=[];let u=-1;for(;++u<e.footnoteOrder.length;){const c=e.footnoteById.get(e.footnoteOrder[u]);if(!c)continue;const m=e.all(c),d=String(c.identifier).toUpperCase(),y=yn(d.toLowerCase());let p=0;const P=[],B=e.footnoteCounts.get(d);for(;B!==void 0&&++p<=B;){P.length>0&&P.push({type:"text",value:" "});let J=typeof t=="string"?t:t(u,p);typeof J=="string"&&(J={type:"text",value:J}),P.push({type:"element",tagName:"a",properties:{href:"#"+n+"fnref-"+y+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(u,p),className:["data-footnote-backref"]},children:Array.isArray(J)?J:[J]})}const G=m[m.length-1];if(G&&G.type==="element"&&G.tagName==="p"){const J=G.children[G.children.length-1];J&&J.type==="text"?J.value+=" ":G.children.push({type:"text",value:" "}),G.children.push(...P)}else m.push(...P);const D={type:"element",tagName:"li",properties:{id:n+"fn-"+y},children:e.wrap(m,!0)};e.patch(c,D),l.push(D)}if(l.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...qn(o),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(l,!0)},{type:"text",value:`
`}]}}const Ri={}.hasOwnProperty,Dm={};function Om(e,n){const t=n||Dm,r=new Map,s=new Map,a=new Map,o={...Pm,...t.handlers},l={all:c,applyData:Lm,definitionById:r,footnoteById:s,footnoteCounts:a,footnoteOrder:[],handlers:o,one:u,options:t,patch:$m,wrap:Fm};return To(e,function(m){if(m.type==="definition"||m.type==="footnoteDefinition"){const d=m.type==="definition"?r:s,y=String(m.identifier).toUpperCase();d.has(y)||d.set(y,m)}}),l;function u(m,d){const y=m.type,p=l.handlers[y];if(Ri.call(l.handlers,y)&&p)return p(l,m,d);if(l.options.passThrough&&l.options.passThrough.includes(y)){if("children"in m){const{children:B,...G}=m,D=qn(G);return D.children=l.all(m),D}return qn(m)}return(l.options.unknownHandler||Rm)(l,m,d)}function c(m){const d=[];if("children"in m){const y=m.children;let p=-1;for(;++p<y.length;){const P=l.one(y[p],m);if(P){if(p&&y[p-1].type==="break"&&(!Array.isArray(P)&&P.type==="text"&&(P.value=Ms(P.value)),!Array.isArray(P)&&P.type==="element")){const B=P.children[0];B&&B.type==="text"&&(B.value=Ms(B.value))}Array.isArray(P)?d.push(...P):d.push(P)}}}return d}}function $m(e,n){e.position&&(n.position=Vo(e))}function Lm(e,n){let t=n;if(e&&e.data){const r=e.data.hName,s=e.data.hChildren,a=e.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const o="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:o}}t.type==="element"&&a&&Object.assign(t.properties,qn(a)),"children"in t&&t.children&&s!==null&&s!==void 0&&(t.children=s)}return t}function Rm(e,n){const t=n.data||{},r="value"in n&&!(Ri.call(t,"hProperties")||Ri.call(t,"hChildren"))?{type:"text",value:n.value}:{type:"element",tagName:"div",properties:{},children:e.all(n)};return e.patch(n,r),e.applyData(n,r)}function Fm(e,n){const t=[];let r=-1;for(n&&t.push({type:"text",value:`
`});++r<e.length;)r&&t.push({type:"text",value:`
`}),t.push(e[r]);return n&&e.length>0&&t.push({type:"text",value:`
`}),t}function Ms(e){let n=0,t=e.charCodeAt(n);for(;t===9||t===32;)n++,t=e.charCodeAt(n);return e.slice(n)}function zm(e,n){const t=Om(e,n),r=t.one(e,void 0),s=Am(t),a=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&a.children.push({type:"text",value:`
`},s),a}const Bm=["area","base","basefont","bgsound","br","col","command","embed","frame","hr","image","img","input","keygen","link","meta","param","source","track","wbr"];class Hn{constructor(n,t,r){this.normal=t,this.property=n,r&&(this.space=r)}}Hn.prototype.normal={};Hn.prototype.property={};Hn.prototype.space=void 0;function Yo(e,n){const t={},r={};for(const s of e)Object.assign(t,s.property),Object.assign(r,s.normal);return new Hn(t,r,n)}function Fi(e){return e.toLowerCase()}class et{constructor(n,t){this.attribute=t,this.property=n}}et.prototype.attribute="";et.prototype.booleanish=!1;et.prototype.boolean=!1;et.prototype.commaOrSpaceSeparated=!1;et.prototype.commaSeparated=!1;et.prototype.defined=!1;et.prototype.mustUseProperty=!1;et.prototype.number=!1;et.prototype.overloadedBoolean=!1;et.prototype.property="";et.prototype.spaceSeparated=!1;et.prototype.space=void 0;let qm=0;const we=Kt(),Ue=Kt(),zi=Kt(),q=Kt(),Oe=Kt(),mn=Kt(),it=Kt();function Kt(){return 2**++qm}const Bi=Object.freeze(Object.defineProperty({__proto__:null,boolean:we,booleanish:Ue,commaOrSpaceSeparated:it,commaSeparated:mn,number:q,overloadedBoolean:zi,spaceSeparated:Oe},Symbol.toStringTag,{value:"Module"})),_i=Object.keys(Bi);class ea extends et{constructor(n,t,r,s){let a=-1;if(super(n,t),Hs(this,"space",s),typeof r=="number")for(;++a<_i.length;){const o=_i[a];Hs(this,_i[a],(r&Bi[o])===Bi[o])}}}ea.prototype.defined=!0;function Hs(e,n,t){t&&(e[n]=t)}function xn(e){const n={},t={};for(const[r,s]of Object.entries(e.properties)){const a=new ea(r,e.transform(e.attributes||{},r),s,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),n[r]=a,t[Fi(r)]=r,t[Fi(a.attribute)]=r}return new Hn(n,t,e.space)}const Xo=xn({properties:{ariaActiveDescendant:null,ariaAtomic:Ue,ariaAutoComplete:null,ariaBusy:Ue,ariaChecked:Ue,ariaColCount:q,ariaColIndex:q,ariaColSpan:q,ariaControls:Oe,ariaCurrent:null,ariaDescribedBy:Oe,ariaDetails:null,ariaDisabled:Ue,ariaDropEffect:Oe,ariaErrorMessage:null,ariaExpanded:Ue,ariaFlowTo:Oe,ariaGrabbed:Ue,ariaHasPopup:null,ariaHidden:Ue,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Oe,ariaLevel:q,ariaLive:null,ariaModal:Ue,ariaMultiLine:Ue,ariaMultiSelectable:Ue,ariaOrientation:null,ariaOwns:Oe,ariaPlaceholder:null,ariaPosInSet:q,ariaPressed:Ue,ariaReadOnly:Ue,ariaRelevant:null,ariaRequired:Ue,ariaRoleDescription:Oe,ariaRowCount:q,ariaRowIndex:q,ariaRowSpan:q,ariaSelected:Ue,ariaSetSize:q,ariaSort:null,ariaValueMax:q,ariaValueMin:q,ariaValueNow:q,ariaValueText:null,role:null},transform(e,n){return n==="role"?n:"aria-"+n.slice(4).toLowerCase()}});function Zo(e,n){return n in e?e[n]:n}function el(e,n){return Zo(e,n.toLowerCase())}const Um=xn({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:mn,acceptCharset:Oe,accessKey:Oe,action:null,allow:null,allowFullScreen:we,allowPaymentRequest:we,allowUserMedia:we,alt:null,as:null,async:we,autoCapitalize:null,autoComplete:Oe,autoFocus:we,autoPlay:we,blocking:Oe,capture:null,charSet:null,checked:we,cite:null,className:Oe,cols:q,colSpan:null,content:null,contentEditable:Ue,controls:we,controlsList:Oe,coords:q|mn,crossOrigin:null,data:null,dateTime:null,decoding:null,default:we,defer:we,dir:null,dirName:null,disabled:we,download:zi,draggable:Ue,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:we,formTarget:null,headers:Oe,height:q,hidden:zi,high:q,href:null,hrefLang:null,htmlFor:Oe,httpEquiv:Oe,id:null,imageSizes:null,imageSrcSet:null,inert:we,inputMode:null,integrity:null,is:null,isMap:we,itemId:null,itemProp:Oe,itemRef:Oe,itemScope:we,itemType:Oe,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:we,low:q,manifest:null,max:null,maxLength:q,media:null,method:null,min:null,minLength:q,multiple:we,muted:we,name:null,nonce:null,noModule:we,noValidate:we,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:we,optimum:q,pattern:null,ping:Oe,placeholder:null,playsInline:we,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:we,referrerPolicy:null,rel:Oe,required:we,reversed:we,rows:q,rowSpan:q,sandbox:Oe,scope:null,scoped:we,seamless:we,selected:we,shadowRootClonable:we,shadowRootDelegatesFocus:we,shadowRootMode:null,shape:null,size:q,sizes:null,slot:null,span:q,spellCheck:Ue,src:null,srcDoc:null,srcLang:null,srcSet:null,start:q,step:null,style:null,tabIndex:q,target:null,title:null,translate:null,type:null,typeMustMatch:we,useMap:null,value:Ue,width:q,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Oe,axis:null,background:null,bgColor:null,border:q,borderColor:null,bottomMargin:q,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:we,declare:we,event:null,face:null,frame:null,frameBorder:null,hSpace:q,leftMargin:q,link:null,longDesc:null,lowSrc:null,marginHeight:q,marginWidth:q,noResize:we,noHref:we,noShade:we,noWrap:we,object:null,profile:null,prompt:null,rev:null,rightMargin:q,rules:null,scheme:null,scrolling:Ue,standby:null,summary:null,text:null,topMargin:q,valueType:null,version:null,vAlign:null,vLink:null,vSpace:q,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:we,disableRemotePlayback:we,prefix:null,property:null,results:q,security:null,unselectable:null},space:"html",transform:el}),Mm=xn({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:it,accentHeight:q,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:q,amplitude:q,arabicForm:null,ascent:q,attributeName:null,attributeType:null,azimuth:q,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:q,by:null,calcMode:null,capHeight:q,className:Oe,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:q,diffuseConstant:q,direction:null,display:null,dur:null,divisor:q,dominantBaseline:null,download:we,dx:null,dy:null,edgeMode:null,editable:null,elevation:q,enableBackground:null,end:null,event:null,exponent:q,externalResourcesRequired:null,fill:null,fillOpacity:q,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:mn,g2:mn,glyphName:mn,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:q,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:q,horizOriginX:q,horizOriginY:q,id:null,ideographic:q,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:q,k:q,k1:q,k2:q,k3:q,k4:q,kernelMatrix:it,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:q,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:q,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:q,overlineThickness:q,paintOrder:null,panose1:null,path:null,pathLength:q,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Oe,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:q,pointsAtY:q,pointsAtZ:q,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:it,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:it,rev:it,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:it,requiredFeatures:it,requiredFonts:it,requiredFormats:it,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:q,specularExponent:q,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:q,strikethroughThickness:q,string:null,stroke:null,strokeDashArray:it,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:q,strokeOpacity:q,strokeWidth:null,style:null,surfaceScale:q,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:it,tabIndex:q,tableValues:null,target:null,targetX:q,targetY:q,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:it,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:q,underlineThickness:q,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:q,values:null,vAlphabetic:q,vMathematical:q,vectorEffect:null,vHanging:q,vIdeographic:q,version:null,vertAdvY:q,vertOriginX:q,vertOriginY:q,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:q,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:Zo}),tl=xn({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,n){return"xlink:"+n.slice(5).toLowerCase()}}),nl=xn({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:el}),rl=xn({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,n){return"xml:"+n.slice(3).toLowerCase()}}),Hm=/[A-Z]/g,Vs=/-[a-z]/g,Vm=/^data[-\w.:]+$/i;function Wm(e,n){const t=Fi(n);let r=n,s=et;if(t in e.normal)return e.property[e.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&Vm.test(n)){if(n.charAt(4)==="-"){const a=n.slice(5).replace(Vs,Qm);r="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=n.slice(4);if(!Vs.test(a)){let o=a.replace(Hm,Jm);o.charAt(0)!=="-"&&(o="-"+o),n="data"+o}}s=ea}return new s(r,n)}function Jm(e){return"-"+e.toLowerCase()}function Qm(e){return e.charAt(1).toUpperCase()}const Gm=Yo([Xo,Um,tl,nl,rl],"html"),il=Yo([Xo,Mm,tl,nl,rl],"svg"),Km=/["&'<>`]/g,Ym=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,Xm=/[\x01-\t\v\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,Zm=/[|\\{}()[\]^$+*?.]/g,Ws=new WeakMap;function ef(e,n){if(e=e.replace(n.subset?tf(n.subset):Km,r),n.subset||n.escapeOnly)return e;return e.replace(Ym,t).replace(Xm,r);function t(s,a,o){return n.format((s.charCodeAt(0)-55296)*1024+s.charCodeAt(1)-56320+65536,o.charCodeAt(a+2),n)}function r(s,a,o){return n.format(s.charCodeAt(0),o.charCodeAt(a+1),n)}}function tf(e){let n=Ws.get(e);return n||(n=nf(e),Ws.set(e,n)),n}function nf(e){const n=[];let t=-1;for(;++t<e.length;)n.push(e[t].replace(Zm,"\\$&"));return new RegExp("(?:"+n.join("|")+")","g")}const rf=/[\dA-Fa-f]/;function af(e,n,t){const r="&#x"+e.toString(16).toUpperCase();return t&&n&&!rf.test(String.fromCharCode(n))?r:r+";"}const sf=/\d/;function of(e,n,t){const r="&#"+String(e);return t&&n&&!sf.test(String.fromCharCode(n))?r:r+";"}const lf=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],ji={nbsp:" ",iexcl:"¡",cent:"¢",pound:"£",curren:"¤",yen:"¥",brvbar:"¦",sect:"§",uml:"¨",copy:"©",ordf:"ª",laquo:"«",not:"¬",shy:"­",reg:"®",macr:"¯",deg:"°",plusmn:"±",sup2:"²",sup3:"³",acute:"´",micro:"µ",para:"¶",middot:"·",cedil:"¸",sup1:"¹",ordm:"º",raquo:"»",frac14:"¼",frac12:"½",frac34:"¾",iquest:"¿",Agrave:"À",Aacute:"Á",Acirc:"Â",Atilde:"Ã",Auml:"Ä",Aring:"Å",AElig:"Æ",Ccedil:"Ç",Egrave:"È",Eacute:"É",Ecirc:"Ê",Euml:"Ë",Igrave:"Ì",Iacute:"Í",Icirc:"Î",Iuml:"Ï",ETH:"Ð",Ntilde:"Ñ",Ograve:"Ò",Oacute:"Ó",Ocirc:"Ô",Otilde:"Õ",Ouml:"Ö",times:"×",Oslash:"Ø",Ugrave:"Ù",Uacute:"Ú",Ucirc:"Û",Uuml:"Ü",Yacute:"Ý",THORN:"Þ",szlig:"ß",agrave:"à",aacute:"á",acirc:"â",atilde:"ã",auml:"ä",aring:"å",aelig:"æ",ccedil:"ç",egrave:"è",eacute:"é",ecirc:"ê",euml:"ë",igrave:"ì",iacute:"í",icirc:"î",iuml:"ï",eth:"ð",ntilde:"ñ",ograve:"ò",oacute:"ó",ocirc:"ô",otilde:"õ",ouml:"ö",divide:"÷",oslash:"ø",ugrave:"ù",uacute:"ú",ucirc:"û",uuml:"ü",yacute:"ý",thorn:"þ",yuml:"ÿ",fnof:"ƒ",Alpha:"Α",Beta:"Β",Gamma:"Γ",Delta:"Δ",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Theta:"Θ",Iota:"Ι",Kappa:"Κ",Lambda:"Λ",Mu:"Μ",Nu:"Ν",Xi:"Ξ",Omicron:"Ο",Pi:"Π",Rho:"Ρ",Sigma:"Σ",Tau:"Τ",Upsilon:"Υ",Phi:"Φ",Chi:"Χ",Psi:"Ψ",Omega:"Ω",alpha:"α",beta:"β",gamma:"γ",delta:"δ",epsilon:"ε",zeta:"ζ",eta:"η",theta:"θ",iota:"ι",kappa:"κ",lambda:"λ",mu:"μ",nu:"ν",xi:"ξ",omicron:"ο",pi:"π",rho:"ρ",sigmaf:"ς",sigma:"σ",tau:"τ",upsilon:"υ",phi:"φ",chi:"χ",psi:"ψ",omega:"ω",thetasym:"ϑ",upsih:"ϒ",piv:"ϖ",bull:"•",hellip:"…",prime:"′",Prime:"″",oline:"‾",frasl:"⁄",weierp:"℘",image:"ℑ",real:"ℜ",trade:"™",alefsym:"ℵ",larr:"←",uarr:"↑",rarr:"→",darr:"↓",harr:"↔",crarr:"↵",lArr:"⇐",uArr:"⇑",rArr:"⇒",dArr:"⇓",hArr:"⇔",forall:"∀",part:"∂",exist:"∃",empty:"∅",nabla:"∇",isin:"∈",notin:"∉",ni:"∋",prod:"∏",sum:"∑",minus:"−",lowast:"∗",radic:"√",prop:"∝",infin:"∞",ang:"∠",and:"∧",or:"∨",cap:"∩",cup:"∪",int:"∫",there4:"∴",sim:"∼",cong:"≅",asymp:"≈",ne:"≠",equiv:"≡",le:"≤",ge:"≥",sub:"⊂",sup:"⊃",nsub:"⊄",sube:"⊆",supe:"⊇",oplus:"⊕",otimes:"⊗",perp:"⊥",sdot:"⋅",lceil:"⌈",rceil:"⌉",lfloor:"⌊",rfloor:"⌋",lang:"〈",rang:"〉",loz:"◊",spades:"♠",clubs:"♣",hearts:"♥",diams:"♦",quot:'"',amp:"&",lt:"<",gt:">",OElig:"Œ",oelig:"œ",Scaron:"Š",scaron:"š",Yuml:"Ÿ",circ:"ˆ",tilde:"˜",ensp:" ",emsp:" ",thinsp:" ",zwnj:"‌",zwj:"‍",lrm:"‎",rlm:"‏",ndash:"–",mdash:"—",lsquo:"‘",rsquo:"’",sbquo:"‚",ldquo:"“",rdquo:"”",bdquo:"„",dagger:"†",Dagger:"‡",permil:"‰",lsaquo:"‹",rsaquo:"›",euro:"€"},cf=["cent","copy","divide","gt","lt","not","para","times"],al={}.hasOwnProperty,qi={};let gr;for(gr in ji)al.call(ji,gr)&&(qi[ji[gr]]=gr);const uf=/[^\dA-Za-z]/;function df(e,n,t,r){const s=String.fromCharCode(e);if(al.call(qi,s)){const a=qi[s],o="&"+a;return t&&lf.includes(a)&&!cf.includes(a)&&(!r||n&&n!==61&&uf.test(String.fromCharCode(n)))?o:o+";"}return""}function pf(e,n,t){let r=af(e,n,t.omitOptionalSemicolons),s;if((t.useNamedReferences||t.useShortestReferences)&&(s=df(e,n,t.omitOptionalSemicolons,t.attribute)),(t.useShortestReferences||!s)&&t.useShortestReferences){const a=of(e,n,t.omitOptionalSemicolons);a.length<r.length&&(r=a)}return s&&(!t.useShortestReferences||s.length<r.length)?s:r}function fn(e,n){return ef(e,Object.assign({format:pf},n))}const hf=/^>|^->|<!--|-->|--!>|<!-$/g,mf=[">"],ff=["<",">"];function gf(e,n,t,r){return r.settings.bogusComments?"<?"+fn(e.value,Object.assign({},r.settings.characterReferences,{subset:mf}))+">":"<!--"+e.value.replace(hf,s)+"-->";function s(a){return fn(a,Object.assign({},r.settings.characterReferences,{subset:ff}))}}function yf(e,n,t,r){return"<!"+(r.settings.upperDoctype?"DOCTYPE":"doctype")+(r.settings.tightDoctype?"":" ")+"html>"}function Js(e,n){const t=String(e);if(typeof n!="string")throw new TypeError("Expected character");let r=0,s=t.indexOf(n);for(;s!==-1;)r++,s=t.indexOf(n,s+n.length);return r}function xf(e,n){const t=n||{};return(e[e.length-1]===""?[...e,""]:e).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}function bf(e){return e.join(" ").trim()}const wf=/[ \t\n\f\r]/g;function ta(e){return typeof e=="object"?e.type==="text"?Qs(e.value):!1:Qs(e)}function Qs(e){return e.replace(wf,"")===""}const Me=ol(1),sl=ol(-1),kf=[];function ol(e){return n;function n(t,r,s){const a=t?t.children:kf;let o=(r||0)+e,l=a[o];if(!s)for(;l&&ta(l);)o+=e,l=a[o];return l}}const Nf={}.hasOwnProperty;function ll(e){return n;function n(t,r,s){return Nf.call(e,t.tagName)&&e[t.tagName](t,r,s)}}const na=ll({body:jf,caption:vi,colgroup:vi,dd:Tf,dt:Sf,head:vi,html:_f,li:Cf,optgroup:Pf,option:Ef,p:vf,rp:Gs,rt:Gs,tbody:Af,td:Ks,tfoot:Df,th:Ks,thead:If,tr:Of});function vi(e,n,t){const r=Me(t,n,!0);return!r||r.type!=="comment"&&!(r.type==="text"&&ta(r.value.charAt(0)))}function _f(e,n,t){const r=Me(t,n);return!r||r.type!=="comment"}function jf(e,n,t){const r=Me(t,n);return!r||r.type!=="comment"}function vf(e,n,t){const r=Me(t,n);return r?r.type==="element"&&(r.tagName==="address"||r.tagName==="article"||r.tagName==="aside"||r.tagName==="blockquote"||r.tagName==="details"||r.tagName==="div"||r.tagName==="dl"||r.tagName==="fieldset"||r.tagName==="figcaption"||r.tagName==="figure"||r.tagName==="footer"||r.tagName==="form"||r.tagName==="h1"||r.tagName==="h2"||r.tagName==="h3"||r.tagName==="h4"||r.tagName==="h5"||r.tagName==="h6"||r.tagName==="header"||r.tagName==="hgroup"||r.tagName==="hr"||r.tagName==="main"||r.tagName==="menu"||r.tagName==="nav"||r.tagName==="ol"||r.tagName==="p"||r.tagName==="pre"||r.tagName==="section"||r.tagName==="table"||r.tagName==="ul"):!t||!(t.type==="element"&&(t.tagName==="a"||t.tagName==="audio"||t.tagName==="del"||t.tagName==="ins"||t.tagName==="map"||t.tagName==="noscript"||t.tagName==="video"))}function Cf(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&r.tagName==="li"}function Sf(e,n,t){const r=Me(t,n);return!!(r&&r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd"))}function Tf(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&(r.tagName==="dt"||r.tagName==="dd")}function Gs(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&(r.tagName==="rp"||r.tagName==="rt")}function Pf(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&r.tagName==="optgroup"}function Ef(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&(r.tagName==="option"||r.tagName==="optgroup")}function If(e,n,t){const r=Me(t,n);return!!(r&&r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot"))}function Af(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&(r.tagName==="tbody"||r.tagName==="tfoot")}function Df(e,n,t){return!Me(t,n)}function Of(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&r.tagName==="tr"}function Ks(e,n,t){const r=Me(t,n);return!r||r.type==="element"&&(r.tagName==="td"||r.tagName==="th")}const $f=ll({body:Ff,colgroup:zf,head:Rf,html:Lf,tbody:Bf});function Lf(e){const n=Me(e,-1);return!n||n.type!=="comment"}function Rf(e){const n=new Set;for(const r of e.children)if(r.type==="element"&&(r.tagName==="base"||r.tagName==="title")){if(n.has(r.tagName))return!1;n.add(r.tagName)}const t=e.children[0];return!t||t.type==="element"}function Ff(e){const n=Me(e,-1,!0);return!n||n.type!=="comment"&&!(n.type==="text"&&ta(n.value.charAt(0)))&&!(n.type==="element"&&(n.tagName==="meta"||n.tagName==="link"||n.tagName==="script"||n.tagName==="style"||n.tagName==="template"))}function zf(e,n,t){const r=sl(t,n),s=Me(e,-1,!0);return t&&r&&r.type==="element"&&r.tagName==="colgroup"&&na(r,t.children.indexOf(r),t)?!1:!!(s&&s.type==="element"&&s.tagName==="col")}function Bf(e,n,t){const r=sl(t,n),s=Me(e,-1);return t&&r&&r.type==="element"&&(r.tagName==="thead"||r.tagName==="tbody")&&na(r,t.children.indexOf(r),t)?!1:!!(s&&s.type==="element"&&s.tagName==="tr")}const yr={name:[[`	
\f\r &/=>`.split(""),`	
\f\r "&'/=>\``.split("")],[`\0	
\f\r "&'/<=>`.split(""),`\0	
\f\r "&'/<=>\``.split("")]],unquoted:[[`	
\f\r &>`.split(""),`\0	
\f\r "&'<=>\``.split("")],[`\0	
\f\r "&'<=>\``.split(""),`\0	
\f\r "&'<=>\``.split("")]],single:[["&'".split(""),"\"&'`".split("")],["\0&'".split(""),"\0\"&'`".split("")]],double:[['"&'.split(""),"\"&'`".split("")],['\0"&'.split(""),"\0\"&'`".split("")]]};function qf(e,n,t,r){const s=r.schema,a=s.space==="svg"?!1:r.settings.omitOptionalTags;let o=s.space==="svg"?r.settings.closeEmptyElements:r.settings.voids.includes(e.tagName.toLowerCase());const l=[];let u;s.space==="html"&&e.tagName==="svg"&&(r.schema=il);const c=Uf(r,e.properties),m=r.all(s.space==="html"&&e.tagName==="template"?e.content:e);return r.schema=s,m&&(o=!1),(c||!a||!$f(e,n,t))&&(l.push("<",e.tagName,c?" "+c:""),o&&(s.space==="svg"||r.settings.closeSelfClosing)&&(u=c.charAt(c.length-1),(!r.settings.tightSelfClosing||u==="/"||u&&u!=='"'&&u!=="'")&&l.push(" "),l.push("/")),l.push(">")),l.push(m),!o&&(!a||!na(e,n,t))&&l.push("</"+e.tagName+">"),l.join("")}function Uf(e,n){const t=[];let r=-1,s;if(n){for(s in n)if(n[s]!==null&&n[s]!==void 0){const a=Mf(e,s,n[s]);a&&t.push(a)}}for(;++r<t.length;){const a=e.settings.tightAttributes?t[r].charAt(t[r].length-1):void 0;r!==t.length-1&&a!=='"'&&a!=="'"&&(t[r]+=" ")}return t.join("")}function Mf(e,n,t){const r=Wm(e.schema,n),s=e.settings.allowParseErrors&&e.schema.space==="html"?0:1,a=e.settings.allowDangerousCharacters?0:1;let o=e.quote,l;if(r.overloadedBoolean&&(t===r.attribute||t==="")?t=!0:(r.boolean||r.overloadedBoolean)&&(typeof t!="string"||t===r.attribute||t==="")&&(t=!!t),t==null||t===!1||typeof t=="number"&&Number.isNaN(t))return"";const u=fn(r.attribute,Object.assign({},e.settings.characterReferences,{subset:yr.name[s][a]}));return t===!0||(t=Array.isArray(t)?(r.commaSeparated?xf:bf)(t,{padLeft:!e.settings.tightCommaSeparatedLists}):String(t),e.settings.collapseEmptyAttributes&&!t)?u:(e.settings.preferUnquoted&&(l=fn(t,Object.assign({},e.settings.characterReferences,{attribute:!0,subset:yr.unquoted[s][a]}))),l!==t&&(e.settings.quoteSmart&&Js(t,o)>Js(t,e.alternative)&&(o=e.alternative),l=o+fn(t,Object.assign({},e.settings.characterReferences,{subset:(o==="'"?yr.single:yr.double)[s][a],attribute:!0}))+o),u+(l&&"="+l))}const Hf=["<","&"];function cl(e,n,t,r){return t&&t.type==="element"&&(t.tagName==="script"||t.tagName==="style")?e.value:fn(e.value,Object.assign({},r.settings.characterReferences,{subset:Hf}))}function Vf(e,n,t,r){return r.settings.allowDangerousHtml?e.value:cl(e,n,t,r)}function Wf(e,n,t,r){return r.all(e)}const Jf=_o("type",{invalid:Qf,unknown:Gf,handlers:{comment:gf,doctype:yf,element:qf,raw:Vf,root:Wf,text:cl}});function Qf(e){throw new Error("Expected node, not `"+e+"`")}function Gf(e){const n=e;throw new Error("Cannot compile unknown node `"+n.type+"`")}const Kf={},Yf={},Xf=[];function Zf(e,n){const t=n||Kf,r=t.quote||'"',s=r==='"'?"'":'"';if(r!=='"'&&r!=="'")throw new Error("Invalid quote `"+r+"`, expected `'` or `\"`");return{one:eg,all:tg,settings:{omitOptionalTags:t.omitOptionalTags||!1,allowParseErrors:t.allowParseErrors||!1,allowDangerousCharacters:t.allowDangerousCharacters||!1,quoteSmart:t.quoteSmart||!1,preferUnquoted:t.preferUnquoted||!1,tightAttributes:t.tightAttributes||!1,upperDoctype:t.upperDoctype||!1,tightDoctype:t.tightDoctype||!1,bogusComments:t.bogusComments||!1,tightCommaSeparatedLists:t.tightCommaSeparatedLists||!1,tightSelfClosing:t.tightSelfClosing||!1,collapseEmptyAttributes:t.collapseEmptyAttributes||!1,allowDangerousHtml:t.allowDangerousHtml||!1,voids:t.voids||Bm,characterReferences:t.characterReferences||Yf,closeSelfClosing:t.closeSelfClosing||!1,closeEmptyElements:t.closeEmptyElements||!1},schema:t.space==="svg"?il:Gm,quote:r,alternative:s}.one(Array.isArray(e)?{type:"root",children:e}:e,void 0,void 0)}function eg(e,n,t){return Jf(e,n,t,this)}function tg(e){const n=[],t=e&&e.children||Xf;let r=-1;for(;++r<t.length;)n[r]=this.one(t[r],r,e);return n.join("")}const ng={};function Ci(e){const n=this,{handlers:t,sanitize:r,...s}=e||ng;let a=!1,o;typeof r=="boolean"?a=!r:r&&(o=r),n.compiler=l;function l(u,c){const m=zm(u,{handlers:t,allowDangerousHtml:a}),d=a?m:Gh(m,o),y=Zf(d,{...s,allowDangerousHtml:a});return c.extname&&(c.extname=".html"),u&&u.type==="root"&&y&&/[^\r\n]/.test(y.charAt(y.length-1))?y+`
`:y}}const rg="_modalOverlay_8xawn_1",ig="_modalContent_8xawn_31",ag="_modalHeader_8xawn_59",sg="_modalTitle_8xawn_77",og="_modalCloseButton_8xawn_91",lg="_modalBody_8xawn_123",cg="_formGroup_8xawn_135",ug="_inputField_8xawn_159",dg="_searchResultsCard_8xawn_193",pg="_searchResultsList_8xawn_221",hg="_searchResultItem_8xawn_233",mg="_searchResultPrice_8xawn_265",fg="_selectedTestsCard_8xawn_277",gg="_selectedTestsHeader_8xawn_293",yg="_noTestsMessage_8xawn_313",xg="_selectedTestsList_8xawn_329",bg="_selectedTestItem_8xawn_341",wg="_selectedTestName_8xawn_365",kg="_removeTestButton_8xawn_377",Ng="_quantityRow_8xawn_407",_g="_quantityGroup_8xawn_421",jg="_quantityLabel_8xawn_429",vg="_compactInput_8xawn_445",Cg="_modalFooter_8xawn_453",Sg="_button_8xawn_471",Tg="_buttonPrimary_8xawn_491",Pg="_buttonSecondary_8xawn_511",Eg="_buttonDisabled_8xawn_533",Ig="_errorText_8xawn_543",Ag="_noResults_8xawn_563",Dg="_skeletonContainer_8xawn_577",Og="_skeletonItem_8xawn_585",_e={modalOverlay:rg,modalContent:ig,modalHeader:ag,modalTitle:sg,modalCloseButton:og,modalBody:lg,formGroup:cg,inputField:ug,searchResultsCard:dg,searchResultsList:pg,searchResultItem:hg,searchResultPrice:mg,selectedTestsCard:fg,selectedTestsHeader:gg,noTestsMessage:yg,selectedTestsList:xg,selectedTestItem:bg,selectedTestName:wg,removeTestButton:kg,quantityRow:Ng,quantityGroup:_g,quantityLabel:jg,compactInput:vg,modalFooter:Cg,button:Sg,buttonPrimary:Tg,buttonSecondary:Pg,buttonDisabled:Eg,errorText:Ig,noResults:Ag,skeletonContainer:Dg,skeletonItem:Og},$g=({isOpen:e,onClose:n,patientId:t,pharmacyInventory:r,fetchPharmacyOrdersData:s,isLoadingInventory:a=!1})=>{const[o,l]=x.useState([]),[u,c]=x.useState(""),[m,d]=x.useState([]),[y,p]=x.useState(null),[P,B]=x.useState(!1);Zs(void 0,e?200:99999);const G=x.useMemo(()=>new eo(r,{keys:["name"],threshold:.3}),[r]);x.useEffect(()=>{if(!u){d([]);return}const z=G.search(u).map(j=>j.item);d(z.slice(0,10))},[u,G]);const D=async()=>{if(!t){p("Patient ID is missing.");return}if(o.length===0){p("Please select at least one drug.");return}for(const z of o)if(z.selected_pack_quantity===0&&z.selected_loose_quantity===0){p(`Please specify a quantity for ${z.name}.`);return}B(!0),p(null);try{const z={patient_id:t,items:o.map(Z=>({drug_id:Z.id,name:Z.name,pack_quantity:Z.selected_pack_quantity,loose_quantity:Z.selected_loose_quantity,pack_price:0,loose_price:0,total_price:0,tabletsPerDay:1,numberOfDays:1,directions_to_use:"As directed"})),order_total:0,prescription_for_unavailable_drugs:""},j=await W("/api/pharmacy-orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(z)});if(!j.ok){const Z=await j.json().catch(()=>({}));throw new Error(Z.message||`Failed to create pharmacy order: ${j.statusText} `)}await j.json(),s(t),n(),l([]),c("")}catch(z){p(`Order Creation Error: ${z.message} `)}finally{B(!1)}},J=z=>{if(o.some(j=>j.id===z.id)){p(`${z.name} is already in the order.`),setTimeout(()=>p(null),3e3),c(""),d([]);return}l(j=>[...j,{...z,selected_pack_quantity:0,selected_loose_quantity:0}]),c(""),d([])},L=z=>{l(j=>j.filter(Z=>Z.id!==z))},Y=(z,j,Z)=>{const me=parseInt(Z)||0;l(re=>re.map(ce=>ce.id===z?{...ce,[j==="pack"?"selected_pack_quantity":"selected_loose_quantity"]:me}:ce))};return e?i.jsx("div",{className:_e.modalOverlay,children:i.jsxs("div",{className:_e.modalContent,children:[i.jsxs("div",{className:_e.modalHeader,children:[i.jsx("h3",{className:_e.modalTitle,children:"Create Pharmacy Order"}),i.jsx("button",{onClick:n,className:_e.modalCloseButton,children:i.jsx(gn,{size:20})})]}),i.jsxs("div",{className:_e.modalBody,children:[y&&i.jsx("div",{className:_e.errorText,children:y}),i.jsxs("div",{className:_e.formGroup,style:{position:"relative"},children:[i.jsx("label",{htmlFor:"drug-search",children:"Add Drug"}),i.jsx("input",{type:"text",id:"drug-search",placeholder:"Search available drugs...",value:u,onChange:z=>c(z.target.value),className:_e.inputField,autoComplete:"off"}),u&&i.jsx("div",{className:_e.searchResultsCard,children:a?i.jsx("div",{className:_e.skeletonContainer,children:[1,2,3].map(z=>i.jsxs("div",{className:_e.skeletonItem,children:[i.jsx(Te,{width:"60%",height:20}),i.jsx(Te,{width:"30%",height:20})]},z))}):m.length>0?i.jsx("ul",{className:_e.searchResultsList,children:m.map(z=>i.jsx("li",{onClick:()=>J(z),className:_e.searchResultItem,children:i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[i.jsx("span",{children:z.name}),i.jsxs("span",{className:_e.searchResultPrice,children:["Stock: ",z.stock," (Box) / ",z.loose||0," (Loose)"]})]})},z.id))}):i.jsx("div",{className:_e.noResults,children:"No drugs found."})})]}),i.jsxs("div",{className:_e.selectedTestsCard,children:[i.jsx("h4",{className:_e.selectedTestsHeader,children:"Selected Drugs"}),o.length===0?i.jsx("p",{className:_e.noTestsMessage,children:"No drugs added yet."}):i.jsx("ul",{className:_e.selectedTestsList,children:o.map(z=>i.jsxs("li",{className:_e.selectedTestItem,children:[i.jsxs("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"},children:[i.jsx("span",{className:_e.selectedTestName,children:z.name}),i.jsx("button",{type:"button",onClick:()=>L(String(z.id)),className:_e.removeTestButton,title:"Remove Drug",children:i.jsx(yt,{size:16})})]}),i.jsxs("div",{className:_e.quantityRow,children:[i.jsxs("div",{className:_e.quantityGroup,children:[i.jsx("label",{className:_e.quantityLabel,children:"Packs"}),i.jsx("input",{type:"number",min:"0",className:`${_e.inputField} ${_e.compactInput}`,value:z.selected_pack_quantity||"",onChange:j=>Y(z.id,"pack",j.target.value),placeholder:"0"})]}),i.jsxs("div",{className:_e.quantityGroup,children:[i.jsx("label",{className:_e.quantityLabel,children:"Loose"}),i.jsx("input",{type:"number",min:"0",className:`${_e.inputField} ${_e.compactInput}`,value:z.selected_loose_quantity||"",onChange:j=>Y(z.id,"loose",j.target.value),placeholder:"0"})]})]})]},z.id))})]})]}),i.jsxs("div",{className:_e.modalFooter,children:[i.jsx("button",{type:"button",onClick:n,className:`${_e.button} ${_e.buttonSecondary}`,children:" Cancel "}),i.jsxs("button",{type:"button",onClick:D,disabled:o.length===0||P,className:`${_e.button} ${_e.buttonPrimary} ${o.length===0||P?_e.buttonDisabled:""}`,children:[" ",P?"Creating...":"Create Order"," "]})]})]})}):null},Lg=({isOpen:e,onClose:n,onSuccess:t,patientId:r,initialItems:s})=>{const[a,o]=x.useState([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]),[l,u]=x.useState(30),[c,m]=x.useState(""),[d,y]=x.useState(null),[p,P]=x.useState(""),[B,G]=x.useState([]),[D,J]=x.useState(!1),[L,Y]=x.useState(!1),[z,j]=x.useState(null),Z=x.useRef(null);x.useEffect(()=>{if(e){s&&s.length>0?o(s):o([{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:30,directions:"",notes:"",packs:0,loose:0,pack_size:1}]);const O=new Date;O.setDate(O.getDate()+30),m(O.toISOString().split("T")[0]),u(30)}},[e,s]);const me=x.useCallback(async O=>{if(!O.trim()){G([]);return}J(!0);try{const K=await W(`/api/drugs?search=${encodeURIComponent(O)}&limit=10`);if(K.ok){const H=await K.json();G(H.drugs||[])}}catch(K){console.error("Error searching drugs:",K)}finally{J(!1)}},[]);x.useEffect(()=>{Z.current&&clearTimeout(Z.current),p&&d!==null?Z.current=setTimeout(()=>me(p),300):G([])},[p,d,me]);const re=O=>{if(!O)return 1;const K=O.match(/(?:\d+x)?(\d+)(?:s|tabs)?/i);return K?parseInt(K[1],10):1},ce=(O,K)=>{const H=[...a];H[K]={...H[K],medication_name:O.name,drug_id:O.id,pack_size:re(O.pack),packs:0,loose:0,quantity:0},o(H),y(null),P(""),G([])},V=(O,K,H)=>{const Se=[...a],de={...Se[O]},w=de.pack_size||1;if(K==="packs"||K==="loose"){const ze=parseInt(H)||0;K==="packs"&&(de.packs=ze),K==="loose"&&(de.loose=ze);const ke=de.packs||0,b=de.loose||0;de.quantity=ke*w+b}else if(K==="tablets_per_day"||K==="number_of_days"){K==="tablets_per_day"&&(de.tablets_per_day=H),K==="number_of_days"&&(de.number_of_days=H);const ze=parseFloat(de.tablets_per_day.toString())||0,ke=parseInt(de.number_of_days.toString())||0,b=Math.ceil(ze*ke);de.quantity=b,de.packs=Math.floor(b/w),de.loose=b%w}else de[K]=H;Se[O]=de,o(Se)},F=()=>{o([...a,{id:Date.now(),medication_name:"",drug_id:null,quantity:1,tablets_per_day:1,number_of_days:l,directions:"",notes:"",packs:0,loose:0,pack_size:1}])},I=O=>{a.length>1&&o(a.filter((K,H)=>H!==O))},ye=async O=>{if(O.preventDefault(),j(null),!r){j("Patient ID is missing.");return}if(a.some(H=>!H.medication_name||H.quantity<=0)){j("Please ensure all items have a medication name and valid quantity.");return}Y(!0);try{const H={patient_id:r,items:a.map(de=>({medication_name:de.medication_name,drug_id:de.drug_id,quantity:de.quantity,tablets_per_day:de.tablets_per_day,number_of_days:de.number_of_days,directions:de.directions,notes:de.notes,frequency_days:l,next_delivery_date:c}))},Se=await W("/api/recurring-medications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(H)});if(!Se.ok){const de=await Se.json();throw new Error(de.message+(de.error?": "+de.error:"")||"Failed to create recurring medication.")}t(),n()}catch(H){j(H.message)}finally{Y(!1)}};return e?i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"add-recurring-modal wide-modal",children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{children:"Add Recurring Medications"}),i.jsx("button",{className:"close-btn",onClick:n,children:i.jsx(gn,{size:20})})]}),i.jsxs("div",{className:"modal-body",children:[z&&i.jsx("div",{className:"error-message",children:z}),i.jsxs("form",{onSubmit:ye,className:"recurring-form",children:[i.jsxs("div",{className:"order-settings-row",children:[i.jsxs("div",{className:"form-group flex-1",children:[i.jsxs("label",{children:[i.jsx(to,{size:16})," Frequency"]}),i.jsxs("select",{value:l,onChange:O=>{const K=parseInt(O.target.value);u(K);const H=new Date;H.setDate(H.getDate()+K),m(H.toISOString().split("T")[0]);const Se=a.map(de=>({...de,number_of_days:K}));o(Se)},children:[i.jsx("option",{value:15,children:"Every 15 Days"}),i.jsx("option",{value:30,children:"Every 30 Days"}),i.jsx("option",{value:60,children:"Every 60 Days"}),i.jsx("option",{value:90,children:"Every 90 Days"})]})]}),i.jsxs("div",{className:"form-group flex-1",children:[i.jsxs("label",{children:[i.jsx(_r,{size:16})," Next Delivery"]}),i.jsx("input",{type:"date",value:c,onChange:O=>m(O.target.value)})]})]}),i.jsx("hr",{className:"divider"}),i.jsxs("div",{className:"items-header",children:[i.jsx("h4",{children:"Medications"}),i.jsxs("button",{type:"button",className:"add-item-btn",onClick:F,children:[i.jsx(xr,{size:14})," Add Drug"]})]}),i.jsx("div",{className:"items-list",children:a.map((O,K)=>i.jsxs("div",{className:"medication-item-row",children:[i.jsxs("div",{className:"row-top",children:[i.jsxs("div",{className:"form-group med-search-group",children:[i.jsx("label",{children:"Drug Name"}),i.jsxs("div",{className:"search-wrapper",children:[i.jsx("input",{type:"text",placeholder:"Search drug...",value:d===K?p:O.medication_name,onFocus:()=>{y(K),P(O.medication_name)},onChange:H=>{P(H.target.value),V(K,"medication_name",H.target.value)}}),d===K&&D&&i.jsx("span",{className:"spinner",children:"..."}),d===K&&p&&B.length>0&&i.jsx("ul",{className:"suggestions-list",children:B.map(H=>i.jsxs("li",{onClick:()=>ce(H,K),children:[i.jsx("div",{className:"suggestion-name",children:H.name}),i.jsxs("div",{className:"suggestion-details",children:["Stock: ",H.stock]})]},H.id))})]})]}),i.jsxs("div",{className:"form-group small-input",children:[i.jsx("label",{children:"Tabs/Day"}),i.jsx("input",{type:"number",min:"0.5",step:"0.5",value:O.tablets_per_day,onChange:H=>V(K,"tablets_per_day",H.target.value)})]}),i.jsxs("div",{className:"form-group small-input",children:[i.jsx("label",{children:"Days"}),i.jsx("input",{type:"number",min:"1",value:O.number_of_days,onChange:H=>V(K,"number_of_days",H.target.value)})]}),i.jsxs("div",{className:"form-group small-input",children:[i.jsx("label",{children:"Packs"}),i.jsx("input",{type:"number",min:"0",value:O.packs||"",onChange:H=>V(K,"packs",H.target.value),placeholder:"0"})]}),i.jsxs("div",{className:"form-group small-input",children:[i.jsx("label",{children:"Loose"}),i.jsx("input",{type:"number",min:"0",value:O.loose||"",onChange:H=>V(K,"loose",H.target.value),placeholder:"0"})]}),i.jsxs("div",{className:"form-group small-input",children:[i.jsx("label",{children:"Total"}),i.jsx("input",{type:"number",value:O.quantity,disabled:!0,className:"input-disabled"})]}),i.jsx("button",{type:"button",className:"remove-btn",onClick:()=>I(K),disabled:a.length===1,children:i.jsx(yt,{size:16})})]}),i.jsxs("div",{className:"row-bottom",children:[i.jsx("div",{className:"form-group flex-1",children:i.jsx("input",{type:"text",placeholder:"Directions (e.g. 1-0-1 after food)",value:O.directions,onChange:H=>V(K,"directions",H.target.value)})}),i.jsx("div",{className:"form-group flex-1",children:i.jsx("input",{type:"text",placeholder:"Notes",value:O.notes,onChange:H=>V(K,"notes",H.target.value)})})]})]},O.id))}),i.jsxs("div",{className:"modal-actions",children:[i.jsx("button",{type:"button",className:"btn-cancel",onClick:n,children:"Cancel"}),i.jsx("button",{type:"submit",className:"btn-submit",disabled:L,children:L?"Creating...":"Create Recurring Order"})]})]})]})]})}):null},Rg=({isOpen:e,onClose:n,onSuccess:t,medication:r})=>{const[s,a]=x.useState(""),[o,l]=x.useState(0),[u,c]=x.useState(1),[m,d]=x.useState(30),[y,p]=x.useState(""),[P,B]=x.useState(""),[G,D]=x.useState(30),[J,L]=x.useState(""),[Y,z]=x.useState("active"),[j,Z]=x.useState(!1),[me,re]=x.useState(null);x.useEffect(()=>{if(e&&r){a(r.medicationName),l(r.quantity),c(r.tabletsPerDay||1),d(r.numberOfDays||30),p(r.directions||""),B(r.notes||""),D(r.frequencyDays),z(r.status);try{const F=new Date(r.nextDeliveryDate);isNaN(F.getTime())||L(F.toISOString().split("T")[0])}catch(F){console.error("Error parsing date",F)}}},[e,r]);const ce=async F=>{if(F.preventDefault(),re(null),!s||o<=0){re("Please provide a valid medication name and quantity.");return}Z(!0);try{const I={medication_name:s,quantity:o,tablets_per_day:u,number_of_days:m,directions:y,notes:P,frequency_days:G,next_delivery_date:J,status:Y},ye=await W(`/api/recurring-medications/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(I)});if(!ye.ok){const O=await ye.json();throw new Error(O.message||"Failed to update recurring medication.")}t(),n()}catch(I){re(I.message)}finally{Z(!1)}},V=async()=>{if(window.confirm("Are you sure you want to delete this recurring medication?")){Z(!0);try{if(!(await W(`/api/recurring-medications/${r.id}`,{method:"DELETE"})).ok)throw new Error("Failed to delete recurring medication.");t(),n()}catch(F){re(F.message)}finally{Z(!1)}}};return e?i.jsx("div",{className:"modal-overlay",children:i.jsxs("div",{className:"add-recurring-modal medium-modal",children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h3",{children:"Edit Recurring Medication"}),i.jsx("button",{className:"close-btn",onClick:n,children:i.jsx(gn,{size:20})})]}),i.jsxs("div",{className:"modal-body",children:[me&&i.jsx("div",{className:"error-message",children:me}),i.jsxs("form",{onSubmit:ce,className:"recurring-form",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Medication Name"}),i.jsx("input",{type:"text",value:s,onChange:F=>a(F.target.value)})]}),i.jsxs("div",{className:"order-settings-row",children:[i.jsxs("div",{className:"form-group flex-1",children:[i.jsxs("label",{children:[i.jsx(to,{size:16})," Frequency"]}),i.jsxs("select",{value:G,onChange:F=>D(parseInt(F.target.value)),children:[i.jsx("option",{value:15,children:"Every 15 Days"}),i.jsx("option",{value:30,children:"Every 30 Days"}),i.jsx("option",{value:60,children:"Every 60 Days"}),i.jsx("option",{value:90,children:"Every 90 Days"})]})]}),i.jsxs("div",{className:"form-group flex-1",children:[i.jsxs("label",{children:[i.jsx(_r,{size:16})," Next Delivery"]}),i.jsx("input",{type:"date",value:J,onChange:F=>L(F.target.value)})]})]}),i.jsxs("div",{className:"order-settings-row",children:[i.jsxs("div",{className:"form-group flex-1",children:[i.jsx("label",{children:"Tabs/Day"}),i.jsx("input",{type:"number",min:"0.5",step:"0.5",value:u,onChange:F=>c(parseFloat(F.target.value))})]}),i.jsxs("div",{className:"form-group flex-1",children:[i.jsx("label",{children:"Days"}),i.jsx("input",{type:"number",min:"1",value:m,onChange:F=>d(parseInt(F.target.value))})]}),i.jsxs("div",{className:"form-group flex-1",children:[i.jsx("label",{children:"Total Qty"}),i.jsx("input",{type:"number",min:"1",value:o,onChange:F=>l(parseInt(F.target.value))})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Directions"}),i.jsx("input",{type:"text",value:y,onChange:F=>p(F.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Notes"}),i.jsx("input",{type:"text",value:P,onChange:F=>B(F.target.value)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Status"}),i.jsxs("select",{value:Y,onChange:F=>z(F.target.value),children:[i.jsx("option",{value:"active",children:"Active"}),i.jsx("option",{value:"paused",children:"Paused"}),i.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),i.jsxs("div",{className:"modal-actions space-between",children:[i.jsxs("button",{type:"button",className:"btn-delete-text",onClick:V,children:[i.jsx(yt,{size:16})," Delete"]}),i.jsxs("div",{className:"flex-row gap-10",children:[i.jsx("button",{type:"button",className:"btn-cancel",onClick:n,children:"Cancel"}),i.jsx("button",{type:"submit",className:"btn-submit",disabled:j,children:j?"Saving...":"Save Changes"})]})]})]})]})]})}):null},Fg=({isOpen:e,onClose:n,billData:t})=>{if(x.useEffect(()=>{if(e&&t){const a=setTimeout(()=>{window.print()},500);return()=>clearTimeout(a)}},[e,t]),!e||!t)return null;const r=t.clinicUpiId&&t.grandTotal>0?`upi://pay?pa=${t.clinicUpiId}&pn=${encodeURIComponent(t.clinicName)}&am=${t.grandTotal.toFixed(2)}&cu=INR`:"",s=i.jsxs("div",{id:"print-modal-root",className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-50 print:bg-white print:static print:block",children:[i.jsxs("div",{className:"bg-white w-full max-w-4xl h-[90vh] overflow-y-auto rounded-lg shadow-xl print:shadow-none print:w-full print:max-w-none print:h-auto print:overflow-visible relative",children:[i.jsx("button",{onClick:n,className:"absolute top-4 right-4 z-50 p-2 bg-gray-100 hover:bg-gray-200 rounded-full no-print",children:i.jsx(gn,{size:24})}),i.jsx("div",{className:"pharmacy-billing-page",style:{padding:0,minHeight:"auto",background:"white"},children:i.jsx("div",{className:"billing-container printable-section",style:{border:"none",boxShadow:"none",maxWidth:"100%",margin:0},children:i.jsxs("div",{className:"p-8 print:p-0",children:[i.jsxs("div",{className:"billing-header print-only",children:[i.jsx("div",{className:"clinic-header-left",children:i.jsx("div",{className:"clinic-info-print",children:i.jsxs("div",{className:"clinic-name-and-details-print",children:[i.jsx("h1",{className:"bill-title",children:"INVOICE"}),i.jsx("h2",{className:"clinic-name-print",children:t.clinicName?`${t.clinicName} Lab`:"Lab Bill"}),(t.clinicAddress||t.clinicNotes)&&i.jsxs("div",{className:"clinic-details-print",children:[t.clinicAddress&&i.jsx("span",{className:"small-text clinic-address",children:t.clinicAddress}),t.clinicNotes&&i.jsx("span",{className:"small-text clinic-notes",children:t.clinicNotes})]})]})})}),i.jsxs("div",{className:"patient-info-grid print-only-patient-details mt-4 text-sm",style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(no,{size:16})," Patient Name"]}),t.patientName]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(ro,{size:16})," Token"]}),t.patientToken||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(_r,{size:16})," Order Date"]}),new Date(t.orderDate).toLocaleDateString()]})]})]}),i.jsx("div",{className:"medications-card mb-6",style:{border:"none",boxShadow:"none"},children:i.jsxs("table",{className:"medications-table w-full text-left collapse",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b-2 border-gray-300",children:[i.jsx("th",{className:"py-2",children:"S.No."}),i.jsx("th",{className:"py-2",children:"TEST DESCRIPTION"}),i.jsx("th",{className:"py-2 text-right",children:"PRICE"}),i.jsx("th",{className:"py-2 text-right",children:"DIS %"}),i.jsx("th",{className:"py-2 text-right",children:"AMT"})]})}),i.jsx("tbody",{children:t.items.map((a,o)=>{const l=a.price??0,u=l*(a.discount_percentage??0)/100,c=l-u;return i.jsxs("tr",{className:"border-b border-gray-100",children:[i.jsx("td",{className:"py-2",children:o+1}),i.jsx("td",{className:"py-2 font-medium",children:a.name}),i.jsx("td",{className:"py-2 text-right",children:a.price.toFixed(2)}),i.jsxs("td",{className:"py-2 text-right",children:[a.discount_percentage??0,"%"]}),i.jsx("td",{className:"py-2 text-right font-bold",children:c.toFixed(2)})]},o)})})]})}),i.jsx("div",{className:"bill-summary-print flex justify-end",children:i.jsxs("div",{className:"bill-summary-details w-1/3 bg-gray-50 p-4 rounded print:w-1/2 print:bg-transparent print:p-0",children:[i.jsxs("div",{className:"summary-row-print flex justify-between mb-1",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["₹",t.subtotal.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print flex justify-between mb-1",children:[i.jsx("span",{children:"Total Discount"}),i.jsxs("span",{children:["- ₹",t.totalDiscount.toFixed(2)]})]}),i.jsxs("div",{className:"print-only-total flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[i.jsx("span",{children:"Grand Total:"}),i.jsxs("span",{children:["₹",t.grandTotal.toFixed(2)]})]}),r&&i.jsxs("div",{className:"qr-code-container mt-4 flex flex-col items-center",style:{boxShadow:"none",background:"transparent"},children:[i.jsx(io,{value:r,size:80}),i.jsx("p",{className:"text-xs mt-1 text-center text-gray-500",children:"Scan to pay"})]})]})}),i.jsxs("footer",{className:"billing-footer mt-8 text-center text-xs text-gray-500 print:absolute print:bottom-0 print:w-full",children:[i.jsx("p",{children:"Thank you for your business!"}),i.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})})})]}),i.jsx("style",{children:`
                @media print {
                    /* Hide EVERYTHING in body */
                    body > * {
                        display: none !important;
                    }
                    
                    /* Explicitly hide #root to override any other styles */
                    #root {
                        display: none !important;
                    }

                    /* Show ONLY our portal root */
                    #print-modal-root {
                        display: block !important;
                        position: absolute !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        height: 100% !important;
                        background: white !important;
                        z-index: 99999 !important;
                    }

                     /* Reset visibility for children of the portal */
                    #print-modal-root * {
                        visibility: visible !important;
                    }
                    
                    /* IMPORTANT: Prevent style tags from being displayed by the wildcard above */
                    #print-modal-root style {
                        display: none !important;
                    }
                    
                     /* Specifically restore display for key layout containers that rely on Flex */
                    .flex { display: flex !important; }
                    .grid { display: grid !important; }
                    .table { display: table !important; }
                    tr { display: table-row !important; }
                    td, th { display: table-cell !important; }

                    /* Ensure no scrollbars in print */
                    .overflow-y-auto {
                        overflow: visible !important;
                        height: auto !important;
                    }

                    /* 
                       CRITICAL: Hide elements explicitly marked with no-print class 
                       Must be at the END to override any restoration rules above.
                    */
                    #print-modal-root .no-print, .no-print {
                        display: none !important;
                        visibility: hidden !important;
                        opacity: 0 !important;
                    }
                }
            `})]});return ao.createPortal(s,document.body)},zg=({isOpen:e,onClose:n,billData:t})=>{if(x.useEffect(()=>{if(e&&t){const a=setTimeout(()=>{window.print()},500);return()=>clearTimeout(a)}},[e,t]),!e||!t)return null;const r=t.clinicUpiId&&t.grandTotal>0?`upi://pay?pa=${t.clinicUpiId}&pn=${encodeURIComponent(t.clinicName)}&am=${t.grandTotal.toFixed(2)}&cu=INR`:"",s=i.jsxs("div",{id:"print-pharmacy-modal-root",className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black bg-opacity-50 print:bg-white print:static print:block",children:[i.jsxs("div",{className:"bg-white w-full max-w-4xl h-[90vh] overflow-y-auto rounded-lg shadow-xl print:shadow-none print:w-full print:max-w-none print:h-auto print:overflow-visible relative",children:[i.jsx("button",{onClick:n,className:"absolute top-4 right-4 z-50 p-2 bg-gray-100 hover:bg-gray-200 rounded-full no-print",children:i.jsx(gn,{size:24})}),i.jsx("div",{className:"pharmacy-billing-page",style:{padding:0,minHeight:"auto",background:"white"},children:i.jsx("div",{className:"billing-container printable-section",style:{border:"none",boxShadow:"none",maxWidth:"100%",margin:0},children:i.jsxs("div",{className:"p-8 print:p-0",children:[i.jsxs("div",{className:"billing-header print-only",children:[i.jsx("div",{className:"clinic-header-left",children:i.jsx("div",{className:"clinic-info-print",children:i.jsxs("div",{className:"clinic-name-and-details-print",children:[i.jsx("h1",{className:"bill-title",children:"INVOICE"}),i.jsx("h2",{className:"clinic-name-print",children:t.clinicName?`${t.clinicName} Pharmacy`:"Pharmacy Bill"}),(t.clinicAddress||t.clinicNotes)&&i.jsxs("div",{className:"clinic-details-print",children:[t.clinicAddress&&i.jsx("span",{className:"small-text clinic-address",children:t.clinicAddress}),t.clinicNotes&&i.jsx("span",{className:"small-text clinic-notes",children:t.clinicNotes})]})]})})}),i.jsxs("div",{className:"patient-info-grid print-only-patient-details mt-4 text-sm",style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(no,{size:16})," Patient Name"]}),t.patientName]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(ro,{size:16})," Token"]}),t.patientToken||"N/A"]}),i.jsxs("div",{className:"info-item",children:[i.jsxs("strong",{className:"flex items-center gap-2",children:[i.jsx(_r,{size:16})," Order Date"]}),new Date(t.orderDate).toLocaleDateString()]})]})]}),i.jsx("div",{className:"medications-card mb-6",style:{border:"none",boxShadow:"none"},children:i.jsxs("table",{className:"medications-table w-full text-left collapse",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b-2 border-gray-300",children:[i.jsx("th",{className:"py-2",children:"S.No."}),i.jsx("th",{className:"py-2",children:"DESCRIPTION"}),i.jsx("th",{className:"py-2",children:"BATCH"}),i.jsx("th",{className:"py-2",children:"EXPIRY"}),i.jsx("th",{className:"py-2",children:"QTY"}),i.jsx("th",{className:"py-2 text-right",children:"MRP"}),i.jsx("th",{className:"py-2 text-right",children:"DIS %"}),i.jsx("th",{className:"py-2 text-right",children:"AMT"})]})}),i.jsx("tbody",{children:t.items.map((a,o)=>i.jsxs("tr",{className:"border-b border-gray-100",children:[i.jsx("td",{className:"py-2",children:o+1}),i.jsx("td",{className:"py-2 font-medium",children:a.name}),i.jsx("td",{className:"py-2",children:a.batch||"-"}),i.jsx("td",{className:"py-2",children:a.expiry_date?new Date(a.expiry_date).toLocaleDateString():"-"}),i.jsxs("td",{className:"py-2",children:[a.pack_quantity?`${a.pack_quantity} Pkts `:"",a.loose_quantity?`${a.loose_quantity} Loose`:""]}),i.jsx("td",{className:"py-2 text-right",children:a.mrp.toFixed(2)}),i.jsxs("td",{className:"py-2 text-right",children:[a.discount_percentage??0,"%"]}),i.jsx("td",{className:"py-2 text-right font-bold",children:a.price.toFixed(2)})]},o))})]})}),i.jsx("div",{className:"bill-summary-print flex justify-end",children:i.jsxs("div",{className:"bill-summary-details w-1/3 bg-gray-50 p-4 rounded print:w-1/2 print:bg-transparent print:p-0",children:[i.jsxs("div",{className:"summary-row-print flex justify-between mb-1",children:[i.jsx("span",{children:"Subtotal"}),i.jsxs("span",{children:["₹",t.subtotal.toFixed(2)]})]}),i.jsxs("div",{className:"summary-row-print flex justify-between mb-1",children:[i.jsx("span",{children:"Total Discount"}),i.jsxs("span",{children:["- ₹",t.totalDiscount.toFixed(2)]})]}),i.jsxs("div",{className:"print-only-total flex justify-between font-bold text-lg border-t pt-2 mt-2",children:[i.jsx("span",{children:"Grand Total:"}),i.jsxs("span",{children:["₹",t.grandTotal.toFixed(2)]})]}),r&&i.jsxs("div",{className:"qr-code-container mt-4 flex flex-col items-center",style:{boxShadow:"none",background:"transparent"},children:[i.jsx(io,{value:r,size:80}),i.jsx("p",{className:"text-xs mt-1 text-center text-gray-500",children:"Scan to pay"})]})]})}),i.jsxs("footer",{className:"billing-footer mt-8 text-center text-xs text-gray-500 print:absolute print:bottom-0 print:w-full",children:[i.jsx("p",{children:"Thank you for your business!"}),i.jsx("p",{children:"This is a computer generated bill and does not require a signature."})]})]})})})]}),i.jsx("style",{children:`
                @media print {
                    body > * { display: none !important; }
                    #root { display: none !important; }
                    #print-pharmacy-modal-root {
                        display: block !important;
                        position: absolute !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        height: 100% !important;
                        background: white !important;
                        z-index: 99999 !important;
                    }
                    #print-pharmacy-modal-root * { visibility: visible !important; }
                    #print-pharmacy-modal-root style { display: none !important; }
                    
                    .flex { display: flex !important; }
                    .grid { display: grid !important; }
                    .table { display: table !important; }
                    tr { display: table-row !important; }
                    td, th { display: table-cell !important; }

                    .overflow-y-auto { overflow: visible !important; height: auto !important; }
                    #print-pharmacy-modal-root .no-print, .no-print {
                        display: none !important;
                        visibility: hidden !important;
                        opacity: 0 !important;
                    }
                }
            `})]});return ao.createPortal(s,document.body)},Bg=({messages:e})=>{const n=x.useRef(null);return x.useEffect(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[e]),i.jsxs("div",{className:"conversation-panel",children:[i.jsxs("div",{className:"conversation-header",children:[i.jsx("div",{className:"conversation-title",children:i.jsx("h3",{children:"Conversation"})}),i.jsxs("span",{className:"conversation-count",children:[e.length," messages"]})]}),i.jsxs("div",{ref:n,className:"message-list custom-scrollbar",children:[e.length===0&&i.jsx("div",{className:"empty-state",children:"Start talking to the AI..."}),e.map(t=>i.jsxs("div",{className:`message-wrapper ${t.role}`,children:[i.jsx("div",{className:`message-bubble ${t.role} ${t.role==="system"?t.type||"info":""}`,children:t.role==="ai"||t.role==="system"&&t.type==="loading"?i.jsx("div",{className:"prose prose-sm max-w-none",children:t.role==="system"&&t.type==="loading"?i.jsxs("div",{className:"typing-indicator",children:[i.jsx("span",{className:"dot"}),i.jsx("span",{className:"dot"}),i.jsx("span",{className:"dot"})]}):i.jsx(Gt,{remarkPlugins:[Nt],children:t.content})}):i.jsx("div",{className:"whitespace-pre-wrap",children:t.content})}),t.role!=="system"&&i.jsx("span",{className:"message-timestamp",children:t.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},t.id))]})]})},qg=e=>so({queryKey:pt.patients.context(e||""),queryFn:async()=>{if(!e)throw new Error("Patient ID is required");const n=await W(`/api/patients/${e}/context`);if(!n.ok)throw new Error("Failed to fetch patient context");return n.json()},enabled:!!e,staleTime:5*60*1e3}),Si=e=>{if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const t=n.getTimezoneOffset()*6e4;return new Date(n.getTime()-t).toISOString().slice(0,16)},Ug=(e,n=[])=>{const r=(L=>[1,2,3,14,15,16,17,18,19,30,31,32].includes(L)?"molar":[4,5,12,13,20,21,28,29].includes(L)?"premolar":[6,11,22,27].includes(L)?"canine":"incisor")(e),s=e<=16,a={molar:{crown:"M5,20 Q5,5 18,5 Q31,5 31,20 L29,25 Q18,28 7,25 Z",roots:["M7,25 Q5,40 10,44 Q14,40 14,26","M29,25 Q31,40 26,44 Q22,40 22,26"]},premolar:{crown:"M8,20 Q8,8 18,8 Q28,8 28,20 L26,24 Q18,27 10,24 Z",roots:["M10,24 Q16,44 18,45 Q20,44 26,24"]},canine:{crown:"M8,22 Q18,2 28,22 L26,25 Q18,28 10,25 Z",roots:["M10,25 Q18,48 26,25"]},incisor:{crown:"M10,22 L10,12 Q18,12 26,12 L26,22 L24,25 Q18,27 12,25 Z",roots:["M12,25 Q18,46 24,25"]}},{crown:o,roots:l}=a[r],u=n.includes("condition-rct"),c=n.includes("condition-filling"),m=n.includes("condition-crown"),d=n.includes("condition-bridge"),y=n.includes("condition-extraction"),p=n.includes("condition-implant"),P=u?"#e9d5ff":"#f3f4f6",B=y?"#fee2e2":m?"#fde047":d?"#67e8f9":"#ffffff",G=y?"#ef4444":d?"#0891b2":p?"#475569":m?"#b45309":"#6b7280",D=d||m||p?2:1.5;let J=`<svg viewBox="0 0 36 50" width="24" height="34" style="display:inline-block;${s?"transform:rotate(180deg);":""}">`;return l.forEach(L=>{J+=`<path d="${L}" fill="${P}" stroke="${G}" stroke-width="${D}" stroke-linejoin="round"/>`}),u&&(r==="molar"?(J+='<path d="M12,28 L11,42" fill="none" stroke="#9333ea" stroke-width="2.5" stroke-linecap="round"/>',J+='<path d="M24,28 L25,42" fill="none" stroke="#9333ea" stroke-width="2.5" stroke-linecap="round"/>'):J+='<path d="M18,25 L18,44" fill="none" stroke="#9333ea" stroke-width="2.5" stroke-linecap="round"/>'),J+=`<path d="${o}" fill="${B}" stroke="${G}" stroke-width="${D}" stroke-linejoin="round"/>`,c&&!m&&!d&&(J+='<circle cx="18" cy="16" r="4" fill="#3b82f6" stroke="#1d4ed8" stroke-width="1"/>'),y&&(J+='<line x1="8" y1="8" x2="28" y2="42" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>',J+='<line x1="28" y1="8" x2="8" y2="42" stroke="#ef4444" stroke-width="3" stroke-linecap="round"/>'),J+="</svg>",J},Hg=()=>{var as,ss;const{openCommandBar:e}=pc(),{recordId:n,patientId:t}=hc(),[r,s]=x.useState(n||void 0),a=mc(),o=fc(),l=gc(),[u,c]=x.useState(""),[m]=x.useState([]),[d,y]=x.useState(null),[p,P]=x.useState(null),[B,G]=x.useState(void 0),[D,J]=x.useState(void 0),[L,Y]=x.useState(null),[z,j]=x.useState(!1),[Z,me]=x.useState(""),[re,ce]=x.useState(!1),[V,F]=x.useState(null),[I,ye]=x.useState(null),[O,K]=x.useState(!1),[H,Se]=x.useState([]),[de,w]=x.useState(!1),[ze,ke]=x.useState(null),[b,De]=x.useState(""),[Ve,Ne]=x.useState(""),[st,Fe]=x.useState(null),[tt,ot]=x.useState(!1),[nt,Yt]=x.useState(!1),[_,$t]=x.useState(!1),[Ct,Xt]=x.useState(window.innerHeight),[mt,xt]=x.useState([]),[Qe,St]=x.useState(!1),[Ht,Zt]=x.useState(null),[We,Tt]=x.useState([]),[Le,C]=x.useState([]),[S,v]=x.useState([]),[X,se]=x.useState(!1),[Re,He]=x.useState(null),ve=x.useRef(null),Je=x.useRef(null),Ge=x.useRef(!1),Be=x.useRef(null),ee=x.useRef(null),T=x.useRef(null),R=x.useRef(null),A=x.useRef(null),E=x.useRef(null),ne=x.useRef(null),[te,$]=x.useState([]),[pe,Ce]=x.useState(!1);x.useEffect(()=>{(async()=>{if(te.length>0&&!pe){Ce(!0);const g=te[0];g.current&&(g.current.scrollIntoView({behavior:"smooth",block:"center"}),g.current.classList.add("ai-glow"),await new Promise(f=>setTimeout(f,2e3)),g.current&&g.current.classList.remove("ai-glow")),$(f=>f.slice(1)),Ce(!1)}})()},[te,pe]);const ge=h=>{let g=null;switch(h){case"update_patient_details":g=T;break;case"create_pharmacy_order":case"edit_pharmacy_order":g=R;break;case"create_lab_order":case"edit_lab_order":g=A;break;case"add_complaint_history":g=E;break;case"update_case_summary":g=ne;break}g&&$(f=>[...f,g])},[ie,he]=x.useState(55),[le,U]=x.useState(!1),Q=x.useRef(null),xe=x.useRef(null),qe=x.useRef(null),ae=x.useRef(null),je=150,[Ee,Ke]=x.useState([]),[lt,bt]=x.useState([]),[ct,rt]=x.useState(!0),[en,tn]=x.useState(null),[Vn,Wn]=x.useState(!1),[ul,dl]=x.useState(!1),[pl,hl]=x.useState(!1),[ml,fl]=x.useState(!1),[gl,yl]=x.useState(!1),[Sr,Pt]=x.useState([]),[bn,ra]=x.useState(!1),[ia,aa]=x.useState(null),[Jn,Tr]=x.useState(!1),[sa,oa]=x.useState(null),[wn,xl]=x.useState({}),[bl,la]=x.useState(!1),[ca,ua]=x.useState(!1),[da,pa]=x.useState(!1),[ha,Qn]=x.useState(!1),[ma,Pr]=x.useState(!1),[fa,kn]=x.useState([]),[Er,Gn]=x.useState(void 0),[wl,ga]=x.useState(!1),[kl,Nl]=x.useState(null),[_l,ya]=x.useState(!1),[jl,vl]=x.useState(null),[ft,xa]=x.useState(!1),[Ir,ba]=x.useState(!1),[Ar,wa]=x.useState(!1),[Dr,ka]=x.useState(!1),[Or,Na]=x.useState(!1),[Kn,Nn]=x.useState(!1),Yn=x.useMemo(()=>(p==null?void 0:p.admission_date)&&!(p!=null&&p.discharge_date),[p]),[Cl,Xn]=x.useState(!1),[_a,$r]=x.useState(null),[Lr,Rr]=x.useState(""),[Fr,zr]=x.useState(void 0),[Br,qr]=x.useState(void 0),[Ur,Mr]=x.useState(void 0),[Et,Hr]=x.useState(!1),[ja,Vt]=x.useState(null),[va,Vr]=x.useState(null),[Ca,Wr]=x.useState(null),[Sa,_n]=x.useState(null),[It,nn]=x.useState(""),[jn,Zn]=x.useState(!1),[vn,Sl]=x.useState(!1),er=x.useRef(null),[Ta,Jr]=x.useState(null),[Pa,rn]=x.useState([]),Qr=x.useCallback(h=>{rn(g=>[...g,{id:Math.random().toString(36).substr(2,9),timestamp:new Date,role:"system",content:"",...h}])},[]),[Gr,Ea]=x.useState(null),[Ia,Aa]=x.useState(!1),tr=x.useRef(null),nr=x.useRef(null),[Tl,Kr]=x.useState(!1),[rr,Da]=x.useState(!1),[ir,Oa]=x.useState(null),[Pl,ar]=x.useState(!1),[El,$a]=x.useState(!1),[Ie,Yr]=x.useState(null),[sr,Xr]=x.useState(""),[Cn,Sn]=x.useState(""),[La,Ra]=x.useState(!0),[an,Fa]=x.useState(!1),[Zr,or]=x.useState(!1),[sn,za]=x.useState(!1),[Il,Ba]=x.useState(!1),Tn=x.useRef(null),Al=async()=>{Tn.current&&(await Tn.current.undoLastAction(),Ba(!1))},Dl=h=>{vl(h),ya(!0)},on=async h=>{try{const g=await W(`/api/patients/${h}`);if(!g.ok){const k=await g.json().catch(()=>({}));throw new Error(k.message||`Failed to fetch patient details: ${g.status}`)}const f=await g.json();if(P(f),G(f.age),J(f.gender),De(f.ai_response||""),P(k=>k?{...k,current_status:f.current_status,admission_date:f.admission_date,discharge_date:f.discharge_date}:{...f,current_status:f.current_status,admission_date:f.admission_date,discharge_date:f.discharge_date}),f.insurance_type&&P(k=>k?{...k,insurance_type:f.insurance_type}:{...f}),ni(h),f.ai_response){const k=/```json\s*([\s\S]*?)\s*```/,N=f.ai_response.match(k);if(N&&N[1])Ne(f.ai_response.replace(k,"").trim()),Fe(N[1].trim());else{const M=f.ai_response.trim();if(M.startsWith("{")&&M.endsWith("}"))try{JSON.parse(M),Ne(""),Fe(M)}catch{Ne(M),Fe(null)}else if(M.startsWith("[")&&M.endsWith("]"))try{JSON.parse(M),Ne(""),Fe(M)}catch{Ne(M),Fe(null)}else Ne(M),Fe(null)}}else Ne(""),Fe(null)}catch{P(null),De(""),Ne(""),Fe(null)}},Ol=async(h,g)=>{P(f=>f?{...f,insurance_type:g}:null);try{const f=await W(`/api/patients/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({insurance_type:g})});if(!f.ok){const k=await f.json();throw new Error(k.message||"Failed to update insurance type")}}catch(f){console.error("Error updating insurance type:",f),h&&on(h)}},qa=async h=>{se(!0),He(null),v([]);try{const g=await W(`/api/queue/patient/${h}/complaints`);if(!g.ok){const k=await g.json().catch(()=>({}));throw new Error(k.message||`HTTP error! status: ${g.status}`)}const f=await g.json();v(f||[])}catch(g){He(`Past complaints error: ${g.message}`)}finally{se(!1)}},ln=async h=>{Tt([]);try{const g=await W(`/api/pharmacy-orders/patient/${h}`);if(!g.ok){const k=await g.json().catch(()=>({}));throw new Error(k.message||`HTTP error! status: ${g.status}`)}const f=await g.json();Tt(f||[])}catch{}},cn=async h=>{ra(!0),aa(null),Pt([]);try{const g=await W(`/api/lab/orders/patient/${h}`);if(!g.ok){const k=await g.json().catch(()=>({}));throw new Error(k.message||`HTTP error! status: ${g.status}`)}const f=await g.json();Pt(f||[])}catch(g){aa(`Pending labs error: ${g.message}`)}finally{ra(!1)}},Pn=async h=>{St(!0),Zt(null),xt([]);try{const g=await W(`/api/lab/patient/${h}`);if(!g.ok){const N=await g.json().catch(()=>({}));throw new Error(N.message||`HTTP error! status: ${g.status}`)}const k=(await g.json()||[]).map(N=>({...N.report,id:N.id,patient_id:N.patient_id,createdAt:N.createdAt,tests:N.tests,status:N.status}));xt(k)}catch(g){Zt(`Lab reports error: ${g.message}`)}finally{St(!1)}},{data:At,isLoading:Lt}=qg(d),En=x.useCallback(async h=>{h===d?await o.invalidateQueries({queryKey:pt.patients.context(h)}):y(h)},[d,o]);x.useEffect(()=>{if(At){console.log("EditComplaintPage: Syncing data from useQuery cache");const h=At.patient;if(h){if(P(h),G(h.age),J(h.gender),De(h.ai_response||""),h.ai_response){const g=/```json\s*([\s\S]*?)\s*```/,f=h.ai_response.match(g);if(f&&f[1])Ne(h.ai_response.replace(g,"").trim()),Fe(f[1].trim());else{const k=h.ai_response.trim();k.startsWith("{")||k.startsWith("[")?(Ne(""),Fe(k)):(Ne(k),Fe(null))}}Nn(h.current_status==="In Doctor Queue"||h.current_status==="In Consultation")}if(v(At.history||[]),Tt(At.pharmacyOrders||[]),At.labOrders){Pt(At.labOrders.filter(f=>!f.report));const g=At.labOrders.filter(f=>f.report).map(f=>({...f.report,id:f.id,patient_id:f.patient_id,createdAt:f.createdAt,tests:f.tests}));xt(g)}C(At.recurringMedications||[])}},[At]),x.useEffect(()=>{(async()=>{if(d)try{const g=await o.fetchQuery({queryKey:pt.patientDebts.balance(d),queryFn:async()=>{const f=await W(`/api/patient-debts/${d}/balance`);return f.ok?f.json():{netDebt:0}},staleTime:6e4});Oa(g.netDebt||0)}catch(g){console.error("Error fetching patient debt:",g),Oa(0)}})()},[d,o]);const ei=x.useCallback(()=>{if(!p)return;const h={id:p.id,token:p.patient_token_number??null,name:p.name,age:p.age??null,gender:p.gender==="M"||p.gender==="F"||p.gender==="O"?p.gender:null,phone:p.phone};a("/dashboard/dental",{state:{patient:h}})},[p,a]),$l=x.useCallback(()=>{if(!p)return;const h={id:p.id,token:p.patient_token_number??null,name:p.name,age:p.age??null,gender:p.gender==="M"||p.gender==="F"||p.gender==="O"?p.gender:null,phone:p.phone};a("/dashboard/medical",{state:{patient:h}})},[p,a]),{data:ti}=so({queryKey:pt.dental.records(d),queryFn:async()=>{const h=await W(`/api/dental/patient/${d}`);if(!h.ok)throw new Error("Failed to fetch dental records");return h.json()},enabled:!!d,staleTime:5*60*1e3});x.useEffect(()=>{Se(ti||[])},[ti]);const{conditions:lr,details:cr}=x.useMemo(()=>{const h={},g={},f=(N,M)=>{h[N]||(h[N]=[]);const ue=`condition-${M}`;h[N].includes(ue)||h[N].push(ue)},k=(N,M)=>{g[N]||(g[N]=[]),g[N].push(M)};return H.forEach(N=>{N.teeth&&Array.isArray(N.teeth)&&N.teeth.forEach(M=>{M.procedures.forEach(ue=>{var be;let oe=(be=N.selected_procedures)==null?void 0:be.find(kt=>kt.id===ue);oe&&oe.type!=="general"&&(f(M.toothNumber,oe.type),k(M.toothNumber,{name:oe.name,date:new Date(N.date||N.createdAt||0).toLocaleDateString(),recordId:N.id,isPast:!0}))})})}),{conditions:h,details:g}},[H]),ni=async h=>{try{const g=await o.fetchQuery({queryKey:pt.queue.latest(h),queryFn:async()=>{const f=await W(`/api/queue/patient/${h}/latest`);if(!f.ok)throw new Error("Failed");return f.json()},staleTime:5e3});if(g){const f=new Date(g.createdAt),k=new Date,N=f.getDate()===k.getDate()&&f.getMonth()===k.getMonth()&&f.getFullYear()===k.getFullYear(),M=["waiting","consulting"].includes(g.status);Nn(N&&M)}else Nn(!1)}catch(g){console.error("Error checking patient queue status:",g),Nn(!1)}},ri=x.useCallback(async(h,g)=>{try{if(!(await W(`/api/pharmacy-orders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({date:g})})).ok)throw new Error("Failed to update pharmacy order date");d&&ln(d)}catch(f){console.error("Error updating pharmacy order date:",f),ke("Failed to update pharmacy order date")}},[d]),In=x.useCallback(async(h,g,f)=>{try{const k={};if(g==="order"?k.date=f:g==="report"&&(k.reportDate=f),!(await W(`/api/lab/orders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)})).ok)throw new Error("Failed to update lab date");d&&(cn(d),Pn(d))}catch(k){console.error("Error updating lab order date:",k),ke("Failed to update lab order date")}},[d]),ii=x.useCallback(h=>{a(`/dashboard/edit-pharmacy-order/${h}`)},[a]),Ua=x.useCallback(h=>{const g=h.medications.map((f,k)=>({id:Date.now()+k,medication_name:f.name,drug_id:f.drug_id?String(f.drug_id):null,quantity:(f.pack_quantity||0)*(f.pack_size||1)+(f.loose_quantity||0),tablets_per_day:f.tabletsPerDay||1,number_of_days:f.numberOfDays||30,directions:f.directions_to_use||"",notes:"",packs:f.pack_quantity,loose:f.loose_quantity,pack_size:f.pack_size}));kn(g),Qn(!0)},[]),Ma=x.useCallback(h=>{ke(null),console.log(`Preparing billing navigation for order: ${h}`);const g=We.find(f=>f.id===h);if(g){const f=g.medications.map(k=>{const N=k.price??0;return(k.price===void 0||k.price===null)&&console.warn(`Medication "${k.name}" in order ${h} is missing a price. Defaulting to 0.`),{name:k.name,pack_quantity:k.pack_quantity,loose_quantity:k.loose_quantity,price:N,pack_price:k.pack_price,loose_price:k.loose_price,total_price:Number(k.total_price)||0,isLoose:k.isLoose,unit:k.unit,drug_id:k.drug_id?String(k.drug_id):null,tabletsPerDay:k.tabletsPerDay,numberOfDays:k.numberOfDays,directions_to_use:k.directions_to_use,discount_percentage:k.discount_percentage??0,batch:k.batch,expiry_date:k.expiry_date}});console.log("Navigating to /dashboard/pharmacy-billing with state:",{initialItems:f}),a(`/dashboard/pharmacy-billing/${h}`,{state:{initialItems:f}})}else console.error(`Order with ID ${h} not found.`),ke(`Order with ID ${h} not found.`),alert(`Error: Could not find order ${h} to bill.`)},[We,a]),Ha=x.useCallback(async(h,g)=>{ke(null);const f=We.find(N=>N.id===h);if(!f){ke(`Order with ID ${h} not found.`);return}const k={status:g,medications:f.medications};try{const N=await W(`/api/pharmacy-orders/${h}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!N.ok){const ue=await N.text();throw new Error(`Failed to update status: ${N.statusText} (${N.status}) - ${ue}`)}const M=await N.json();Tt(ue=>ue.map(oe=>oe.id===M.id?{...oe,status:M.status}:oe)),d&&ln(d)}catch(N){console.error("Failed to update order status:",N),ke(N.message||`Failed to update status for order ${h}.`),alert(`Error updating status for order ${h}: ${N.message||"Please try again."}`)}},[We,d]),ai=x.useCallback(h=>{Pt(g=>g.map(f=>f.id===h?{...f,isEditing:!0,editedTests:[...f.tests],editedStatus:f.status}:{...f,isEditing:!1}))},[]),Ll=x.useCallback(h=>{Pt(g=>g.map(f=>f.id===h?{...f,isEditing:!1,editedTests:void 0,editedStatus:void 0}:f))},[]),Rl=x.useCallback((h,g,f,k)=>{Pt(N=>N.map(M=>{if(M.id===h){const ue=M.editedTests?[...M.editedTests]:[...M.tests];if(f==="add")return{...M,editedTests:[...ue,{id:"",name:"",price:0}]};if(f==="remove")return{...M,editedTests:k};if(g!==-1){const oe={...ue[g],[f]:k};return ue[g]=oe,{...M,editedTests:ue}}}return M}))},[]),Fl=x.useCallback((h,g)=>{Pt(f=>f.map(k=>k.id===h?{...k,editedStatus:g}:k))},[]),Va=x.useCallback(async h=>{if(!h){console.error("Cannot navigate to billing: Lab Order data is missing."),alert("Could not open billing page: Lab Order information is missing.");return}a(`/dashboard/lab-billing/${h.id}`)},[a]),Wa=x.useCallback(async(h,g)=>{console.log(`Updating lab order ${h} to status ${g}`);try{const f=await W(`/api/lab/${h}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:g})});if(!f.ok){const k=await f.json();throw new Error(k.message||`Failed to update lab order status: ${f.status}`)}d&&(cn(d),Pn(d)),console.log(`Lab Order ${h} status updated to ${g}, refetching data.`)}catch(f){console.error("Error updating lab order status:",f),alert(`Failed to update lab order status: ${f instanceof Error?f.message:"Unknown error"}`)}},[d]),ur=x.useCallback(h=>{h&&h.id?a(`/lab/report/${h.id}`):(console.error("Cannot navigate: Lab Order or Lab Order ID is missing."),alert("Could not open the report entry page: Lab Order information is missing."))},[a]),zl=x.useCallback(async(h,g,f)=>{xa(!0),ke(null);try{if(!g||g.length===0)throw new Error("Lab order must have at least one test.");for(const M of g)if(!M.id||!M.name||isNaN(M.price)||M.price<0)throw new Error(`Invalid test data: ${JSON.stringify(M)}. Each test must have id, name, and a valid price.`);const k={tests:g,status:f},N=await W(`/api/lab/orders/${h}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});if(!N.ok){const M=await N.json().catch(()=>({}));throw new Error(M.message||`Failed to update lab order: ${N.statusText}`)}d&&cn(d),Pt(M=>M.map(ue=>ue.id===h?{...ue,isEditing:!1,editedTests:void 0,editedStatus:void 0}:ue))}catch(k){ke(`Lab Order Save Error: ${k.message}`)}finally{xa(!1)}},[d]),Rt=x.useCallback(async h=>{if(!window.confirm(`Are you sure you want to delete this ${h.type.toLowerCase()} record? This action cannot be undone.`))return;Tr(!0),oa(null);let f=null,k;const N=h.type;try{switch(N){case"Complaint":if(k=h.data.id,!k)throw new Error("Complaint ID is missing.");f=`/api/patients/complaints/${k}`;break;case"Lab Order":if(k=h.data.id,!k)throw new Error("Lab Order ID is missing.");f=`/api/lab/orders/${k}`;break;case"Lab Report":if(k=h.data.reportId,!k)throw new Error("Lab Report ID is missing.");f=`/api/lab/reports/${k}`;break;case"Pharmacy Order":if(k=h.data.id,!k)throw new Error("Pharmacy Order ID is missing.");f=`/api/pharmacy-orders/${k}`;break;default:throw new Error(`Deletion not supported for item type: ${N}`)}if(!f)throw new Error(`Could not determine delete URL for type: ${N}`);const M=await W(f,{method:"DELETE"});if(!M.ok){const ue=await M.json().catch(()=>({}));throw new Error(ue.message||`Failed to delete ${N}: ${M.statusText}`)}d&&(N==="Complaint"?qa(d):N==="Lab Order"?(cn(d),Pn(d)):N==="Lab Report"?Pn(d):N==="Pharmacy Order"&&ln(d))}catch(M){oa(`Delete Error (${N}): ${M.message}`),Jn&&Tr(!1)}finally{Tr(!1)}},[d,Jn]),Ja=x.useCallback(async()=>{if(!d)return;if(We.filter(g=>g.status==="pending").length<2){alert("You need at least two pending orders to merge.");return}Da(!0);try{const g=await W(`/api/pharmacy-orders/patient/${d}/merge-pending`,{method:"POST"});if(!g.ok){const f=await g.json().catch(()=>({}));throw new Error(f.message||"Failed to merge orders")}ln(d)}catch(g){ke(`Merge Error: ${g.message}`)}finally{Da(!1)}},[d,We]),Ft=x.useMemo(()=>{if(!d||!S)return[];const h=S.map(g=>({date:new Date(g.createdAt),type:"Complaint",data:g,originalDateString:g.createdAt})).filter(g=>!isNaN(g.date.getTime()));return h.sort((g,f)=>f.date.getTime()-g.date.getTime()),h},[d,S]),zt=x.useMemo(()=>{if(!d)return[];const h=new Map;(Sr??[]).forEach(f=>{h.set(f.id,{...f})}),(mt??[]).forEach(f=>{if(!h.has(f.id))h.set(f.id,{id:f.id,patient_id:f.patient_id,tests:f.tests,status:f.status,createdAt:f.createdAt,report:f});else{const k=h.get(f.id);k&&(k.report=f,k.status=f.status)}});let g=Array.from(h.values());return g.sort((f,k)=>new Date(f.createdAt).getTime()-new Date(k.createdAt).getTime()),g=g.map((f,k)=>({...f,serialNumber:k+1})),g.map(f=>({date:new Date(f.createdAt),type:"Lab Order",data:f,originalDateString:f.createdAt}))},[d,Sr,mt]),Wt=x.useCallback(async h=>{const g=h??u;if(!g.trim())return;nr.current&&(clearTimeout(nr.current),nr.current=null),Qr({role:"user",content:g});const f=Math.random().toString(36).substr(2,9);rn(k=>[...k,{id:f,role:"system",type:"loading",content:"",timestamp:new Date}]),Tn.current?(await Tn.current.callGenerativeApi(g),rn(k=>k.filter(N=>N.id!==f)),nr.current=setTimeout(()=>{rn([])},1e4)):rn(k=>k.filter(N=>N.id!==f))},[u,Qr,rn]),Qa=x.useCallback(()=>{const h="reports came,please anaylse";c(h),setTimeout(()=>{Wt(h)},0)},[Wt,c]),si=x.useCallback(h=>{xl(g=>({...g,[h]:!g[h]}))},[]),wt=x.useMemo(()=>{if(!d||!We)return[];const h=We.map(g=>({date:new Date(g.date),type:"Pharmacy Order",data:g,originalDateString:g.date})).filter(g=>!isNaN(g.date.getTime()));return h.sort((g,f)=>f.date.getTime()-g.date.getTime()),h},[d,We]),Bl=x.useCallback((h,g)=>i.jsxs("div",{className:"flex flex-col w-full",children:[i.jsxs("span",{className:"ai-context-text flex items-center",children:[wt.length-g,". Order Status: (",h.data.status,")",i.jsx("span",{className:"text-gray-400 ml-1 flex items-center",children:_a===h.data.id?i.jsx("div",{className:"flex items-center space-x-1 ml-1",children:i.jsx("input",{type:"datetime-local",defaultValue:Si(h.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:f=>{f.target.value&&ri(h.data.id,f.target.value),$r(null)},onKeyDown:f=>{if(f.key==="Enter"){const k=f.target;k.value&&ri(h.data.id,k.value),$r(null)}},autoFocus:!0})}):i.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:()=>$r(h.data.id),title:"Click to edit date",children:["(",new Date(h.originalDateString).toLocaleDateString(),")",i.jsx(gt,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),i.jsxs("div",{className:"inline-flex space-x-2 ml-2",children:[i.jsx("button",{onClick:()=>ii(h.data.id),className:"icon-button small",title:"Edit Pharmacy Order",children:i.jsx(gt,{size:12})}),h.data.prescriptionForUnavailableDrugs&&i.jsx("button",{onClick:()=>{const f=wi().use(Nt).use(Ci).processSync(h.data.prescriptionForUnavailableDrugs).toString();oi(f,"Unavailable Drugs Prescription")},className:"icon-button small",title:"Print Unavailable Drugs Prescription",children:i.jsx(Rn,{size:12})}),h.data.status==="dispensed"||h.data.status==="billed"?i.jsx("button",{onClick:()=>a(`/dashboard/pharmacy-billing/${h.data.id}`),className:"icon-button small text-blue-600",title:"View Pharmacy Bill",children:i.jsx(ci,{size:12})}):i.jsx("button",{onClick:()=>Rt({type:"Pharmacy Order",data:h.data}),className:"icon-button small text-red-500",title:"Delete Pharmacy Order",children:i.jsx(yt,{size:12})}),h.data.status==="pending"&&i.jsx("button",{onClick:()=>Ma(h.data.id),className:"icon-button small",title:"Bill this pharmacy order",disabled:ft,children:i.jsx(os,{size:12})}),h.data.status==="billed"&&i.jsx("button",{onClick:()=>Ha(h.data.id,"dispensed"),className:"icon-button small",title:"Dispense this pharmacy order",disabled:ft,children:i.jsx(ls,{size:12})}),i.jsx("button",{onClick:()=>Ua(h.data),className:"icon-button small group-hover:block",title:"Add to Recurring Medications",children:i.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-repeat",children:[i.jsx("path",{d:"m17 2 4 4-4 4"}),i.jsx("path",{d:"M3 11v-1a4 4 0 0 1 4-4h14"}),i.jsx("path",{d:"m7 22-4-4 4-4"}),i.jsx("path",{d:"M21 13v1a4 4 0 0 1-4 4H3"})]})})]})]}),i.jsx("div",{className:"pharmacy-order-drugs-table-container mobile-edge-to-edge-table-container mt-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1",onClick:()=>ii(h.data.id),title:"Click to edit order",children:i.jsxs("table",{className:"pharmacy-order-drugs-table mobile-edge-to-edge-table w-full text-xs",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-1 px-2 text-left",children:"Drug Name"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Quantity"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Dosage"}),i.jsx("th",{className:"py-1 px-2 text-left",children:"Directions"})]})}),i.jsx("tbody",{children:h.data.medications.map((f,k)=>i.jsxs("tr",{children:[i.jsx("td",{className:"py-1 px-2",children:i.jsx("strong",{children:f.name})}),i.jsxs("td",{className:"py-1 px-2",children:[f.pack_quantity!==void 0&&f.pack_quantity>0&&`Packs: ${f.pack_quantity}`,f.pack_quantity!==void 0&&f.pack_quantity>0&&f.loose_quantity!==void 0&&f.loose_quantity>0&&", ",f.loose_quantity!==void 0&&f.loose_quantity>0&&`Loose: ${f.loose_quantity}`]}),i.jsx("td",{className:"py-1 px-2",children:f.tabletsPerDay&&f.numberOfDays?`${f.tabletsPerDay} tab/day for ${f.numberOfDays} days`:"N/A"}),i.jsx("td",{className:"py-1 px-2",children:f.directions_to_use||"N/A"})]},f.drug_id||f.name||k))})]})}),h.data.prescriptionForUnavailableDrugs&&i.jsxs("div",{className:"unavailable-drugs-markdown mt-2",children:[i.jsx("span",{className:"font-semibold text-xs text-gray-600 block mb-1",children:"Prescription for Unavailable Drugs:"}),i.jsx(Gt,{remarkPlugins:[Nt],children:h.data.prescriptionForUnavailableDrugs})]})]}),[wt,_a,ri,ii,Ma,Ha,Ua,Rt,ft,a]),ql=x.useCallback((h,g)=>{const f=fh(h.data.report?h.data.report.status:h.data.status),k=(h.data.tests||[]).reduce((N,M)=>N+(Number(M.price)||0),0).toFixed(2);return i.jsxs("div",{className:"flex flex-col w-full",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsxs("div",{className:"ai-context-text flex items-center flex-wrap",children:[i.jsxs("span",{className:"font-medium cursor-pointer hover:text-blue-600 transition-colors mr-2",onClick:()=>ur(h.data),title:"Click to enter report",children:["#",h.data.serialNumber," [Order]"]}),i.jsx("span",{className:`mr-2 ${f.className}`,children:f.text}),i.jsx("span",{className:"text-gray-400 inline-flex items-center",children:va===h.data.id?i.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:N=>N.stopPropagation(),children:i.jsx("input",{type:"datetime-local",defaultValue:Si(h.originalDateString),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:N=>{N.target.value&&In(h.data.id,"order",N.target.value),Vr(null)},onKeyDown:N=>{if(N.key==="Enter"){const M=N.target;M.value&&In(h.data.id,"order",M.value),Vr(null)}},autoFocus:!0})}):i.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/date ml-1",onClick:N=>{N.stopPropagation(),Vr(h.data.id)},title:"Click to edit order date",children:["(",new Date(h.originalDateString).toLocaleDateString(),")",i.jsx(gt,{size:14,className:"ml-1 text-gray-500 hover:text-gray-700"})]})})]}),!h.data.isEditing&&i.jsxs("div",{className:"flex space-x-1 items-center",children:[i.jsx("button",{onClick:()=>ai(h.data.id),className:"icon-button small",title:"Edit",disabled:ft,children:i.jsx(gt,{size:12})}),h.data.status==="pending"?i.jsx("button",{onClick:()=>Va(h.data),className:"icon-button small font-medium text-green-600 w-auto px-1",title:`Pay total of ₹${k}`,disabled:ft,children:i.jsx(oo,{size:12})}):i.jsx("button",{onClick:()=>a(`/dashboard/lab-billing/${h.data.id}`),className:"icon-button small text-blue-600",title:"View Lab Bill",children:i.jsx(yc,{size:12})}),["pending","billed","collected","processing","report_ready","reported","completed"].includes(h.data.status)&&i.jsx("button",{onClick:()=>ur(h.data),className:"icon-button small text-indigo-600",title:"Enter Report",disabled:ft,children:i.jsx(ci,{size:12})}),(h.data.status==="report_ready"||h.data.status==="reported")&&i.jsx("button",{onClick:()=>Wa(h.data.id,"completed"),className:"icon-button small text-green-600",title:"Mark Completed",disabled:ft,children:i.jsx(ls,{size:12})}),i.jsx("button",{onClick:()=>Rt({type:"Lab Order",data:h.data}),className:"icon-button small text-red-500",title:"Delete",disabled:ft,children:i.jsx(yt,{size:12})})]})]}),i.jsx("div",{className:"lab-order-tests-table-container mobile-edge-to-edge-table-container mt-1 mb-2 cursor-pointer hover:bg-gray-50 transition-colors rounded p-1 border border-gray-100",onClick:()=>{h.data.status==="pending"?ai(h.data.id):ur(h.data)},title:h.data.status==="pending"?"Click to edit order":"Click to enter report",children:i.jsxs("table",{className:"lab-order-tests-table mobile-edge-to-edge-table w-full text-xs text-left",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b bg-gray-50",children:[i.jsx("th",{className:"py-1 px-2 font-medium text-gray-600",children:"Test Name"}),i.jsx("th",{className:"py-1 px-2 text-right font-medium text-gray-600",children:"Price"})]})}),i.jsxs("tbody",{children:[h.data.tests&&h.data.tests.length>0?h.data.tests.map(N=>i.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-100",children:[i.jsx("td",{className:"py-1 px-2",children:N.name}),i.jsxs("td",{className:"py-1 px-2 text-right",children:["₹",N.price]})]},N.id||N.name)):i.jsx("tr",{children:i.jsx("td",{colSpan:2,className:"py-1 px-2 italic text-gray-500",children:"No tests specified"})}),i.jsxs("tr",{className:"bg-gray-50 font-semibold",children:[i.jsx("td",{className:"py-1 px-2 text-right text-gray-700",children:"Total:"}),i.jsxs("td",{className:"py-1 px-2 text-right text-gray-900",children:["₹",k]})]})]})]})}),h.data.report&&i.jsxs("div",{className:"ml-4 mt-1 p-2 border-l-2 border-gray-200",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("span",{className:"font-medium text-sm text-gray-700",children:"[Report]"}),i.jsxs("div",{className:"flex items-center",children:[i.jsx("span",{className:"text-gray-400 ml-1 flex items-center text-xs",children:Ca===h.data.id?i.jsx("div",{className:"flex items-center space-x-1 ml-1",onClick:N=>N.stopPropagation(),children:i.jsx("input",{type:"datetime-local",defaultValue:Si(h.data.report.report_date),className:"border rounded px-1 py-0.5 text-xs text-black",onBlur:N=>{N.target.value&&In(h.data.id,"report",N.target.value),Wr(null)},onKeyDown:N=>{if(N.key==="Enter"){const M=N.target;M.value&&In(h.data.id,"report",M.value),Wr(null)}},autoFocus:!0})}):i.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 px-1 rounded flex items-center group/reportDate ml-1",onClick:N=>{N.stopPropagation(),Wr(h.data.id)},title:"Click to edit report date",children:["(",new Date(h.data.report.report_date).toLocaleDateString(),")",i.jsx(gt,{size:12,className:"ml-1 text-gray-500 hover:text-gray-700"})]})}),i.jsx("button",{onClick:()=>si(h.data.report.reportId),className:"text-blue-600 hover:text-blue-800 p-1 rounded hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-400 ml-2",title:wn[h.data.report.reportId]?"Collapse Report":"Expand Report",children:wn[h.data.report.reportId]?i.jsx(cs,{size:14}):i.jsx(us,{size:14})}),i.jsx("button",{onClick:()=>Rt({type:"Lab Report",data:h.data}),className:"text-red-600 hover:text-red-800 p-1 rounded hover:bg-red-100 focus:outline-none focus:ring-1 focus:ring-red-400 ml-1",title:"Delete Report",children:i.jsx(yt,{size:12})})]})]}),wn[h.data.report.reportId]&&(()=>{try{const N=JSON.parse(h.data.report.report_content||"{}");return typeof N=="object"&&N!==null&&h.data.report.tests?h.data.report.tests.map(M=>i.jsxs("div",{style:{marginBottom:"10px"},children:[i.jsx("h5",{className:"font-semibold text-xs mt-2 mb-1 text-gray-700",children:M.name}),N[M.id]?i.jsx("div",{className:"mobile-edge-to-edge-table-container",children:i.jsxs("table",{className:"lab-inventory-table mobile-edge-to-edge-table w-full text-xs",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Parameter"}),i.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Value"}),i.jsx("th",{className:"py-1 px-2 bg-gray-50",children:"Normal Range"})]})}),i.jsx("tbody",{children:Object.entries(N[M.id]).map(([ue,oe])=>{var kt;const be=(kt=M.default_parameters)==null?void 0:kt.find(dt=>dt.name===ue);return i.jsxs("tr",{className:"border-b last:border-0",children:[i.jsx("td",{className:"py-1 px-2",children:ue}),i.jsxs("td",{className:"py-1 px-2",children:[String(oe)," ",(be==null?void 0:be.unit)||""]}),i.jsx("td",{className:"py-1 px-2 text-gray-500",children:(()=>{if(be&&be.type==="number"&&(be.lower_limit!=null||be.upper_limit!=null)){let dt="";return be.lower_limit!=null&&(dt+=` > ${be.lower_limit}`),be.lower_limit!=null&&be.upper_limit!=null&&(dt+=" - "),be.upper_limit!=null&&(dt+=` < ${be.upper_limit}`),dt.trim()||"N/A"}else if((be==null?void 0:be.type)==="boolean")return"N/A";return(be==null?void 0:be.normal_range)||"N/A"})()})]},ue)})})]})}):i.jsx("p",{className:"italic text-gray-500 text-xs",children:"No parameters reported for this test."})]},M.id)):i.jsx("div",{className:"text-xs prose",children:i.jsx(Gt,{remarkPlugins:[Nt],children:h.data.report.report_content})})}catch{return i.jsx("div",{className:"text-xs prose",children:i.jsx(Gt,{remarkPlugins:[Nt],children:h.data.report.report_content||"*No findings recorded.*"})})}})()]})]})},[va,ur,In,ai,ft,Va,a,Rt,Ca,wn,si,Wa]),Ul=x.useCallback((h,g)=>i.jsx("div",{className:"ai-context-text w-full",children:Sa===h.data.id?i.jsxs("div",{className:"flex flex-col gap-2 w-full",children:[i.jsx("input",{type:"text",value:It,onChange:f=>nn(f.target.value),className:"border rounded px-2 py-1 text-sm w-full",autoFocus:!0,onKeyDown:async f=>{if(f.key==="Enter"&&It.trim()){Zn(!0);try{await W(`/api/patients/complaints/${h.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:It.trim()})}),h.data.complaint=It.trim(),_n(null),nn("")}catch(k){console.error("Error updating complaint:",k)}Zn(!1)}f.key==="Escape"&&(_n(null),nn(""))},disabled:jn}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx("button",{onClick:async()=>{if(It.trim()){Zn(!0);try{await W(`/api/patients/complaints/${h.data.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({complaint:It.trim()})}),h.data.complaint=It.trim(),_n(null),nn("")}catch(f){console.error("Error updating complaint:",f)}Zn(!1)}},className:"text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600",disabled:jn||!It.trim(),children:jn?"Saving...":"Save"}),i.jsx("button",{onClick:()=>{_n(null),nn("")},className:"text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded hover:bg-gray-300",disabled:jn,children:"Cancel"})]})]}):i.jsxs("span",{className:"cursor-pointer hover:bg-gray-100 rounded px-1 -mx-1 transition-colors inline-block",onClick:()=>{_n(h.data.id),nn(h.data.complaint)},title:"Click to edit",children:[h.data.complaint,i.jsxs("span",{className:"text-gray-400 ml-1",children:["(",new Date(h.originalDateString).toLocaleDateString(),")"]})]})}),[Sa,It,jn,Rt]),Ml=x.useMemo(()=>i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:Ja,className:"button-primary blue text-xs px-2 py-1",disabled:rr||We.filter(h=>h.status==="pending").length<2,title:"Merge all pending orders into one",children:rr?"Merging...":"Merge Orders"}),i.jsxs("button",{onClick:()=>ua(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new pharmacy order",disabled:!d,children:[i.jsx(xr,{size:12,className:"mr-1"})," Create Order"]})]}),[Ja,rr,We,d]),Hl=x.useMemo(()=>i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:Qa,className:"button-primary blue text-xs px-2 py-1",title:"Tell AI to analyse the reports",disabled:O||nt||Lt||Qe,children:"Analyse Reports"}),i.jsxs("button",{onClick:()=>la(!0),className:"button-primary green text-xs px-2 py-1",title:"Manually create a new lab order",disabled:!d,children:[i.jsx(xr,{size:12,className:"mr-1"})," Create Lab Order"]})]}),[Qa,O,nt,Lt,Qe,d]),[Ga,Ka]=x.useState(null),[Ya,Xa]=x.useState([]),[dr,Za]=x.useState(""),es=(h,g)=>{if(!h||!h.report_content||!g)return"";try{const f=JSON.parse(h.report_content||"{}");if(typeof f!="object"||f===null)return`<p class="italic text-gray-500 text-xs">Report content is not structured data.</p><pre>${h.report_content}</pre>`;let k="";return g.forEach(N=>{f[N.id]?(k+=`<h5 class="font-semibold text-sm mt-2 mb-1">${N.name}</h5>`,k+='<table class="lab-report-print-table"><thead><tr><th>Parameter</th><th>Value</th><th>Normal Range</th></tr></thead><tbody>',Object.entries(f[N.id]).map(([M,ue])=>{var kt;const oe=(kt=N.default_parameters)==null?void 0:kt.find(dt=>dt.name===M);let be="N/A";oe&&oe.type==="number"&&(oe.lower_limit!=null||oe.upper_limit!=null)?(be="",oe.lower_limit!=null&&(be+=` > ${oe.lower_limit}`),oe.lower_limit!=null&&oe.upper_limit!=null&&(be+=" - "),oe.upper_limit!=null&&(be+=` < ${oe.upper_limit}`),be=be.trim()||"N/A"):(oe==null?void 0:oe.type)==="boolean"?be="N/A":oe!=null&&oe.normal_range&&(be=oe.normal_range),k+=`<tr><td>${M}</td><td>${String(ue)} ${(oe==null?void 0:oe.unit)||""}</td><td>${be}</td></tr>`}),k+="</tbody></table>"):k+=`<p class="italic text-gray-500 text-xs">No parameters reported for ${N.name}.</p>`}),k}catch{return`<p class="italic text-gray-500 text-xs">Error parsing report content.</p><pre>${h.report_content}</pre>`}};x.useEffect(()=>{const h=()=>{Xt(window.innerHeight)};return window.addEventListener("resize",h),h(),()=>window.removeEventListener("resize",h)},[]),x.useEffect(()=>{const h=f=>{if(!le||!ae.current||!qe.current)return;const k=qe.current.getBoundingClientRect(),M=f.clientX-ae.current.x;let ue=ae.current.initialWidth+M;const oe=k.width-je-10;ue=Math.max(je,ue),ue=Math.min(ue,oe);const be=ue/k.width*100;he(be)},g=()=>{U(!1),ae.current=null,document.body.style.cursor="",document.body.style.userSelect=""};return le&&(window.addEventListener("mousemove",h),window.addEventListener("mouseup",g),document.body.style.cursor="col-resize",document.body.style.userSelect="none"),()=>{window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",g),document.body.style.cursor="",document.body.style.userSelect=""}},[le]);const Vl=h=>{if(!qe.current)return;h.preventDefault();const g=qe.current.querySelector(".edit-complaint-context-column");g&&(ae.current={x:h.clientX,initialWidth:g.offsetWidth},U(!0))},ts=x.useCallback(async()=>{w(!0),ke(null);try{const h=await W("/api/queue/doctor/new",{method:"POST"});if(!h.ok){const f=await h.json().catch(()=>({}));throw new Error(f.message||`Failed to create record: ${h.statusText}`)}const g=await h.json();if(!g.recordId)throw new Error("New record ID not received from server.");a(`/edit-complaint/${g.recordId}`,{replace:!0})}catch(h){ke(`Failed to create new complaint record: ${h.message}`)}finally{w(!1)}},[a]);x.useEffect(()=>{(async()=>{Ra(!0);try{const g=await o.fetchQuery({queryKey:pt.clinicSettings,queryFn:async()=>{const f=await W("/api/clinics/settings");if(!f.ok)throw new Error("Failed to fetch clinic settings.");return f.json()},staleTime:18e5});Yr({admissionCharge:parseFloat(g.admissionCharge||0).toFixed(2),perDayCharge:parseFloat(g.perDayCharge||0).toFixed(2),otherCharges:parseFloat(g.otherCharges||0).toFixed(2),aiMemory:g.aiMemory||"",aiMemoryUpdatedAt:g.aiMemoryUpdatedAt||null,clinicWideSystemPrompt:g.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:g.clinicWideSystemPromptUpdatedAt||null,gemini_api_key:g.gemini_api_key||""}),Xr(g.aiMemory||""),Sn(g.clinicWideSystemPrompt||"")}catch{}finally{Ra(!1)}})()},[]),x.useEffect(()=>{var g;(g=l.state)!=null&&g.initialComplaint&&c(l.state.initialComplaint);const h=async f=>{K(!0),ke(null);try{const k=await o.fetchQuery({queryKey:pt.queue.entry(f),queryFn:async()=>{const N=await W(`/api/queue/doctor/complaint/${f}`);if(!N.ok){const M=await N.json().catch(()=>({}));throw new Error(M.message||`HTTP error! status: ${N.status}`)}return N.json()},staleTime:6e4});y(k.patientId),G(k.age),J(k.gender),Y(k.case_summary||null),ye(k.updatedAt||null)}catch{ke("Failed to load current complaint details."),y(null),G(void 0),J(void 0),Y(null),ye(null)}finally{K(!1)}};if(r)h(r);else if(t){const f=t;f&&(y(f),(async()=>{try{let N;try{N=await o.fetchQuery({queryKey:pt.queue.latest(f),queryFn:async()=>{const ue=await W(`/api/queue/patient/${f}/latest`);if(!ue.ok)throw new Error("Failed");return ue.json()},staleTime:5e3})}catch{}if(N!=null&&N._id){s(N._id),h(N._id);return}const M=await W("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:f,complaint:"Visit Initiated"})});if(M.ok){const ue=await M.json();if(ue!=null&&ue.id){s(ue.id),h(ue.id);return}}}catch(N){console.error("Background queue resolution failed",N),ke("Failed to initialize visit record.")}})())}else ts()},[r,ts,(as=l.state)==null?void 0:as.initialComplaint,t]),x.useEffect(()=>{d?En(d):(P(null),v([]),Tt([]),Pt([]),xt([]),ye(null),Nn(!1))},[d]),x.useEffect(()=>{var f;const h=(f=l.state)==null?void 0:f.initialComplaint;h&&r&&(!O&&!X&&!bn&&!Qe&&!ct)&&!Ge.current&&u===h&&(Ge.current=!0,Wt(),a(l.pathname,{replace:!0,state:{}}))},[(ss=l.state)==null?void 0:ss.initialComplaint,r,u,O,X,bn,Qe,ct,a]);const ns=()=>{me(L||""),j(!0),F(null)},Wl=()=>{j(!1),me(""),F(null)},Jl=async()=>{if(!r){F("Missing Record ID.");return}ce(!0),F(null);try{const h=await W(`/api/queue/doctor/complaint/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({case_summary:Z.trim()})});if(!h.ok){const f=await h.json().catch(()=>({}));throw new Error(f.message||`Failed to save case summary: ${h.statusText}`)}const g=await h.json();Y(g.case_summary||Z.trim()),ye(g.updatedAt||null),j(!1)}catch(h){F(`Save Error: ${h.message}`)}finally{ce(!1)}};x.useEffect(()=>{(async()=>{rt(!0),tn(null);try{const[g,f]=await Promise.all([o.fetchQuery({queryKey:pt.drugs.all,queryFn:async()=>{const k=await W("/api/drugs");if(!k.ok)throw new Error(`Pharmacy inventory error! status: ${k.status}`);const N=await k.json();return N.drugs||N},staleTime:6e5}),o.fetchQuery({queryKey:pt.labTests.all,queryFn:async()=>{const k=await W("/api/lab-tests");if(!k.ok)throw new Error(`Lab inventory error! status: ${k.status}`);return k.json()},staleTime:6e5})]);Ke(g),bt(f||[])}catch(g){tn(g.message)}finally{rt(!1)}})()},[]);const Ql=async()=>{if(!Ie)return;if(sr===Ie.aiMemory&&Cn===Ie.clinicWideSystemPrompt){or(!1);return}const h=sr!==Ie.aiMemory,g=Cn!==Ie.clinicWideSystemPrompt;h&&Fa(!0),g&&za(!0);try{const f={...Ie};h&&(f.aiMemory=sr),g&&(f.clinicWideSystemPrompt=Cn);const k=await W("/api/clinics/settings",{method:"PUT",body:JSON.stringify(f)});if(!k.ok){const M=await k.json().catch(()=>({}));throw new Error(M.message||"Failed to update clinic settings.")}const N=await k.json();Yr({admissionCharge:parseFloat(N.settings.admissionCharge).toFixed(2),perDayCharge:parseFloat(N.settings.perDayCharge).toFixed(2),otherCharges:parseFloat(N.settings.otherCharges).toFixed(2),aiMemory:N.settings.aiMemory||"",aiMemoryUpdatedAt:N.settings.aiMemoryUpdatedAt||(Ie==null?void 0:Ie.aiMemoryUpdatedAt)||null,clinicWideSystemPrompt:N.settings.clinicWideSystemPrompt||"",clinicWideSystemPromptUpdatedAt:N.settings.clinicWideSystemPromptUpdatedAt||(Ie==null?void 0:Ie.clinicWideSystemPromptUpdatedAt)||null}),h&&Xr(N.settings.aiMemory||""),g&&(Sn(N.settings.clinicWideSystemPrompt||""),or(!1))}catch{}finally{h&&Fa(!1),g&&za(!1)}},rs=()=>{Ie&&(Sn(Ie.clinicWideSystemPrompt||""),or(!0))},Gl=()=>{or(!1),Ie&&Sn(Ie.clinicWideSystemPrompt||"")},Kl=h=>{navigator.clipboard.writeText(h).then(()=>{}).catch(g=>{console.error("Failed to copy text: ",g)})},oi=(h,g)=>{const f=window.open("","_blank");f&&(f.document.write(`
        <html>
          <head>
            <title>${g}</title>
            <style>
              body { font-family: sans-serif; margin: 20px; }
              h2 { text-align: center; margin-bottom: 20px; }
              table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
              th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
              th { background-color: #f2f2f2; }
              pre { white-space: pre-wrap; word-wrap: break-word; }
              .ai-context-section { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 5px; }
              .ai-context-section-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: #333; }
              .ai-context-text { margin-bottom: 5px; }
              .text-gray-400 { color: #999; }
              .font-semibold { font-weight: 600; }
              .italic { font-style: italic; }
              .mt-2 { margin-top: 8px; }
              .ml-1 { margin-left: 4px; }
              .ml-2 { margin-left: 8px; }
              .flex { display: flex; }
              .flex-col { flex-direction: column; }
              .w-full { width: 100%; }
              .text-xs { font-size: 0.75rem; }
              .text-sm { font-size: 0.875rem; }
              .prose { max-width: 65ch; }
              .prose table { display: table; } /* Ensure tables in markdown render correctly */
            </style>
          </head>
          <body>
            <h2>${g}</h2>
            <div id="print-content">${h}</div>
          </body>
        </html>
      `),f.document.close(),f.print())},Yl=()=>{if(b){const h=wi().use(Nt).use(Ci).processSync(Ve).toString();oi(`<div class="prose">${h}</div>`,"Summary")}};x.useEffect(()=>{if(p){let h=`
        <div class="print-section">
          <h3>Patient Details</h3>
          <p><strong>Name:</strong> ${p.name||"N/A"}</p>
          <p><strong>Token:</strong> ${p.patient_token_number||"N/A"}</p>
          <p><strong>Age:</strong> ${p.age||"N/A"}</p>
          <p><strong>Gender:</strong> ${p.gender||"N/A"}</p>
          <p><strong>Phone:</strong> ${p.phone||"N/A"}</p>
          <p><strong>Insurance:</strong> ${p.insurance_type||"N/A"}</p>
          <p><strong>Status:</strong> ${p.current_status||"N/A"}</p>
          <p><strong>Admitted:</strong> ${p.admission_date?new Date(p.admission_date).toLocaleDateString():"N/A"}</p>
          <p><strong>Discharged:</strong> ${p.discharge_date?new Date(p.discharge_date).toLocaleDateString():"N/A"}</p>
        </div>
        <div class="print-section">
          <h3>Case Summary</h3>
          <p>${L||"No summary available."}</p>
        </div>
        <div class="print-section">
          <h3>Complaints History</h3>
          ${Ft.length>0?`
            <ul>
              ${Ft.map(g=>`<li>${new Date(g.originalDateString).toLocaleDateString()}: ${g.data.complaint}</li>`).join("")}
            </ul>
          `:"<p>No past complaints.</p>"}
        </div>
        <div class="print-section">
          <h3>Pharmacy Orders</h3>
          ${wt.length>0?`
            <table class="print-table">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Drug Name</th>
                  <th>Quantity</th>
                  <th>Dosage</th>
                  <th>Directions</th>
                </tr>
              </thead>
              <tbody>
                ${wt.map(g=>{const f=g.data.medications.map((N,M)=>`
                    <tr>
                      ${M===0?`<td rowspan="${g.data.medications.length+(g.data.prescriptionForUnavailableDrugs?1:0)}">${new Date(g.originalDateString).toLocaleDateString()}</td>`:""}
                      ${M===0?`<td rowspan="${g.data.medications.length+(g.data.prescriptionForUnavailableDrugs?1:0)}">${g.data.status}</td>`:""}
                      <td><strong>${N.name}</strong></td>
                      <td>
                        ${N.pack_quantity!==void 0&&N.pack_quantity>0?`Packs: ${N.pack_quantity}`:""}
                        ${N.pack_quantity!==void 0&&N.pack_quantity>0&&N.loose_quantity!==void 0&&N.loose_quantity>0?", ":""}
                        ${N.loose_quantity!==void 0&&N.loose_quantity>0?`Loose: ${N.loose_quantity}`:""}
                      </td>
                      <td>${N.tabletsPerDay&&N.numberOfDays?`${N.tabletsPerDay} tab/day for ${N.numberOfDays} days`:"N/A"}</td>
                      <td>${N.directions_to_use||"N/A"}</td>
                    </tr>
                  `).join("");let k="";return g.data.prescriptionForUnavailableDrugs&&(k=`
                      <tr>
                        <td colspan="4" style="background-color: #f9f9f9; padding: 10px;">
                          <div style="font-style: italic; margin-bottom: 5px; font-weight: 600;">Prescription for Unavailable Drugs:</div>
                          <div class="prose" style="font-size: 0.9em;">${wi().use(Nt).use(Ci).processSync(g.data.prescriptionForUnavailableDrugs).toString()}</div>
                        </td>
                      </tr>
                    `),f+k}).join("")}
              </tbody>
            </table>
          `:"<p>No pharmacy orders.</p>"}
        </div>
        <div class="print-section">
          <h3>Lab History (Orders & Reports)</h3>
          ${zt.length>0?`
            ${zt.map(g=>{const f=g.data.tests.map(N=>N.name).join(", ");let k="";return g.data.report&&(k=`
                  <div class="lab-report-print-container">
                    <h4>Lab Report (${new Date(g.data.report.report_date).toLocaleDateString()})</h4>
                    ${es(g.data.report,g.data.report.tests)}
                  </div>
                `),`
                <div class="lab-history-item">
                  <p><strong>Order Date:</strong> ${new Date(g.originalDateString).toLocaleDateString()}</p>
                  <p><strong>Status:</strong> ${g.data.status}</p>
                  <p><strong>Tests:</strong> ${f}</p>
                  ${k}
                </div>
              `}).join("")}
          `:"<p>No lab history.</p>"}
        </div>
      `;if(Object.keys(cr).length>0){const g=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],f=[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17],k=(oe,be)=>{const kt=lr[oe]||[],dt=Ug(oe,kt);return`
            <div style="display:inline-flex;flex-direction:column;align-items:center;margin:2px;">
              ${be?`<span style="font-size:8px;color:#666;margin-bottom:2px;">${oe}</span>`:""}
              ${dt}
              ${be?"":`<span style="font-size:8px;color:#666;margin-top:2px;">${oe}</span>`}
            </div>
          `},N=g.map(oe=>k(oe,!0)).join(""),M=f.map(oe=>k(oe,!1)).join(""),ue=Object.entries(cr).sort(([oe],[be])=>Number(oe)-Number(be)).map(([oe,be])=>{const dt=(lr[Number(oe)]||[]).map(pr=>pr.replace("condition-","")).join(", "),cc=be.map(pr=>`${pr.name} (${pr.date})`).join("; ");return`
              <tr>
                <td><strong>Tooth ${oe}</strong></td>
                <td>${dt||"N/A"}</td>
                <td>${cc||"N/A"}</td>
              </tr>
            `}).join("");h+=`
          <div class="print-section">
            <h3>Dental Chart</h3>
            <div style="text-align:center;margin-bottom:15px;padding:10px;background:#f9f9f9;border-radius:8px;">
              <div style="margin-bottom:8px;">
                <div style="font-size:10px;color:#666;margin-bottom:4px;">Upper Arch</div>
                <div style="display:flex;justify-content:center;flex-wrap:nowrap;">${N}</div>
              </div>
              <div style="border-top:1px solid #ddd;padding-top:8px;">
                <div style="display:flex;justify-content:center;flex-wrap:nowrap;">${M}</div>
                <div style="font-size:10px;color:#666;margin-top:4px;">Lower Arch</div>
              </div>
            </div>
            <h4 style="margin-top:15px;margin-bottom:8px;">Procedure Details</h4>
            <table class="print-table">
              <thead>
                <tr>
                  <th>Tooth</th>
                  <th>Conditions</th>
                  <th>Procedures</th>
                </tr>
              </thead>
              <tbody>
                ${ue}
              </tbody>
            </table>
          </div>
        `}Za(h)}else Za("")},[p,L,Ft,wt,zt,es,cr,lr]);const is=()=>{dr&&oi(dr,`Patient Details - ${p==null?void 0:p.name}`)},Xl=h=>{c(h),Ka(null),Xa([]),setTimeout(()=>{Wt(h)},0)},Dt=O||nt||_||Qe||X||ct||bn||de||Vn||ul||pl||ml||gl||ft||Et||an||sn||rr||Jn||Ir||Ar||Dr||Or||re,Zl=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),!Dt&&u.trim()&&r&&Wt())};x.useEffect(()=>{const h=window.SpeechRecognition||window.webkitSpeechRecognition;if(!h){Jr("Speech recognition not supported in this browser.");return}const g=new h;return g.continuous=!0,g.interimResults=!0,g.lang="en-US",g.onresult=f=>{let k="";for(let N=f.resultIndex;N<f.results.length;++N)f.results[N].isFinal&&(k+=f.results[N][0].transcript);k&&c(N=>N+(N.endsWith(" ")||N===""?"":" ")+k)},g.onerror=f=>{Jr(`Speech error: ${f.error}`),Sl(!1)},g.onend=()=>{},er.current=g,()=>{er.current&&er.current.stop()}},[]);const ec=async()=>{if(d)if(Yn){wa(!0);try{const h=await W(`/api/patients/${d}/discharge`,{method:"POST"});if(!h.ok){const g=await h.json().catch(()=>({}));throw new Error(g.message||`Failed to discharge patient: ${h.status}`)}on(d)}catch(h){ke(`Discharge Error: ${h.message}`)}finally{wa(!1)}}else{ba(!0);try{const h=await W(`/api/patients/${d}/admit`,{method:"POST"});if(!h.ok){const g=await h.json().catch(()=>({}));throw new Error(g.message||`Failed to admit patient: ${h.status}`)}on(d)}catch(h){ke(`Admit Error: ${h.message}`)}finally{ba(!1)}}},tc=async h=>{if(d){ka(!0);try{const f=await W("/api/queue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({patientId:d})});if(!f.ok){const k=await f.json().catch(()=>({}));throw new Error(k.message||`Failed to add patient to ${h} queue: ${f.status}`)}d&&(on(d),ni(d))}catch(g){ke(`Add to Queue Error: ${g.message}`)}finally{ka(!1)}}},nc=async()=>{if(r){Na(!0),ke(null);try{const h=await W(`/api/queue/${r}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"seen"})});if(!h.ok){const f=await h.json().catch(()=>({}));throw new Error(f.message||"Failed to complete consultation")}d&&(on(d),ni(d));const g=localStorage.getItem("currentUser");if(o.removeQueries({queryKey:pt.queue.all}),g){const f=JSON.parse(g);f.role==="receptionist"?a("/dashboard"):f.role==="doctor"||f.role==="admin"?a("/dashboard/queue"):a("/dashboard")}else a("/dashboard")}catch(h){ke(`Error completing consultation: ${h.message}`)}finally{Na(!1)}}},rc=async()=>{if(!d){Vt("Missing Patient ID.");return}if(!p){Vt("Patient details not loaded.");return}Hr(!0),Vt(null);try{const h={};let g=!1;if(Lr!==p.name&&(h.name=Lr,g=!0),Fr!==p.age&&(h.age=Fr,g=!0),Br!==p.gender&&(h.gender=Br,g=!0),Ur!==p.phone&&(h.phone=Ur,g=!0),!g){Vt("No changes detected."),Hr(!1),Xn(!1);return}const f=await W(`/api/patients/${d}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});if(!f.ok){const N=await f.json().catch(()=>({}));throw new Error(N.message||`Failed to update patient details: ${f.statusText}`)}const k=await f.json();P(k),G(k.age),J(k.gender),Rr(k.name),zr(k.age),qr(k.gender),Mr(k.phone),Xn(!1)}catch(h){Vt(`Save Error: ${h.message}`)}finally{Hr(!1)}},ic=async(h,g,f)=>{h.stopPropagation();const k=[null,"red","green","blue"],N=k.indexOf(f||null),M=k[(N+1)%k.length];P(ue=>ue?{...ue,color_code:M}:null);try{await W(`/api/patients/${g}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({color_code:M})})}catch(ue){console.error("Error updating color code:",ue),P(oe=>oe?{...oe,color_code:f||null}:null)}},ac=x.useCallback(()=>{if(!p)return null;const h={token_number:p.patient_token_number||"N/A",name:p.name||"N/A",age:p.age||"N/A",gender:p.gender||"N/A",phone:p.phone||"N/A"};return Ft.length>0?h.complaints_history=Ft.map(g=>`${g.data.complaint} (${new Date(g.originalDateString).toLocaleDateString()})`).join("; "):h.complaints_history="No past complaints.",wt.length>0?h.pharmacy_orders_history=wt.map(g=>`Order: ${g.data.medications.map(k=>{let N=`${k.name}`;return k.pack_quantity!==void 0&&k.pack_quantity>0&&(N+=` Packs: ${k.pack_quantity}`),k.loose_quantity!==void 0&&k.loose_quantity>0&&(N+=` Loose: ${k.loose_quantity}`),N}).join(", ")} (${g.data.status}, ${new Date(g.originalDateString).toLocaleDateString()})`).join("; "):h.pharmacy_orders_history="No pharmacy orders.",zt.length>0?h.lab_orders_history=zt.map(g=>{let k=`Lab Order: ${g.data.tests.map(N=>N.name).join(", ")} (${g.data.status}, ${new Date(g.originalDateString).toLocaleDateString()})`;return g.data.report&&(k+=` - Report: ${g.data.report.report_content} (${new Date(g.data.report.report_date).toLocaleDateString()})`),k}).join("; "):h.lab_orders_history="No lab history.",Le.length>0?h.recurring_medications=Le.map((g,f)=>{let k=`${f+1}. ${g.medicationName} (${g.frequencyDays} days, ${g.status})`;return g.tabletsPerDay&&(k+=` - ${g.tabletsPerDay} tabs/day`),g.numberOfDays&&(k+=` for ${g.numberOfDays} days`),k}).join("; "):h.recurring_medications="No recurring medications.",h},[p,Ft,wt,zt,Le]),sc=()=>{if(!p){Jr("Patient details are required to use the Live API.");return}Kr(!0)},oc=()=>{var h;(h=tr.current)==null||h.click()},lc=async h=>{var f;const g=(f=h.target.files)==null?void 0:f[0];if(g&&d){Ea(g),Aa(!0);try{const k=new FormData;k.append("files",g),(await W(`/api/patient-files/${d}`,{method:"POST",body:k})).ok||ke("Image upload failed. Please try again.")}catch(k){console.error("Image upload error:",k),ke("Image upload failed. Please try again.")}finally{Aa(!1)}}},li=x.useRef(!1),An=x.useRef(null),un=x.useRef(null),ut=x.useRef({response:!0,pharmacy:!1,recurring:!1,labs:!1,history:!1,summary:!1}),[Dn,dn]=x.useState("response"),On=h=>{li.current=!0,dn(h),An.current&&clearTimeout(An.current),An.current=setTimeout(()=>{li.current=!1},1e3);const g={behavior:"smooth",block:"start"};h==="response"&&xe.current?xe.current.scrollIntoView(g):h==="meds"?R.current?R.current.scrollIntoView(g):un.current&&un.current.scrollIntoView(g):h==="labs"&&A.current?A.current.scrollIntoView(g):h==="history"&&E.current?E.current.scrollIntoView(g):h==="summary"&&ne.current&&ne.current.scrollIntoView(g)};return x.useEffect(()=>{const h=new IntersectionObserver(g=>{li.current||(g.forEach(f=>{f.target===xe.current?ut.current.response=f.isIntersecting:f.target===R.current?ut.current.pharmacy=f.isIntersecting:f.target===un.current?ut.current.recurring=f.isIntersecting:f.target===A.current?ut.current.labs=f.isIntersecting:f.target===E.current?ut.current.history=f.isIntersecting:f.target===ne.current&&(ut.current.summary=f.isIntersecting)}),ut.current.response?dn("response"):ut.current.pharmacy||ut.current.recurring?dn("meds"):ut.current.labs?dn("labs"):ut.current.history?dn("history"):ut.current.summary&&dn("summary"))},{root:null,threshold:0,rootMargin:"-10% 0px -50% 0px"});return xe.current&&h.observe(xe.current),R.current&&h.observe(R.current),A.current&&h.observe(A.current),E.current&&h.observe(E.current),ne.current&&h.observe(ne.current),un.current&&h.observe(un.current),()=>{h.disconnect(),An.current&&clearTimeout(An.current)}},[]),i.jsxs("div",{className:"edit-complaint-page",style:{height:`${Ct}px`},children:[i.jsx(Hh,{ref:Tn,recordId:r,patientId:d,patientDetails:p,caseSummary:L,caseSummaryUpdatedAt:I,clinicSettings:Ie,userMessages:m,selectedImageFile:Gr,pendingLabOrders:Sr,labReports:mt,pastComplaints:S,pharmacyOrders:We,pharmacyInventory:Ee,labInventory:lt,recurringMedications:Le,currentComplaint:u,setCurrentComplaint:c,setAiResponse:De,setAiResponseText:Ne,setAiResponseJsonString:Fe,setShowAiJsonDetails:ot,setIsLoadingAi:Yt,setAiError:()=>{},setIsSubmittingAiOrder:Wn,setAiOrderSubmissionStatus:()=>{},setIsSubmittingAiLabOrder:dl,setAiLabOrderSubmissionStatus:()=>{},setIsSubmittingAiComplaint:hl,setAiComplaintSubmissionStatus:()=>{},setIsUpdatingCaseSummary:fl,setAiCaseSummaryUpdateStatus:()=>{},setCaseSummary:Y,setCaseSummaryUpdatedAt:ye,setIsUpdatingAiMemoryByAI:yl,setAiMemoryUpdateByAIStatus:()=>{},setFollowUpQuestion:Ka,setFollowUpOptions:Xa,setError:ke,setIsSavingAiResponse:$t,setSaveAiResponseError:()=>{},fetchPharmacyOrdersData:ln,fetchPendingLabOrdersData:cn,fetchLabReportsData:Pn,fetchPastComplaintsData:qa,fetchPatientDetails:on,fetchRecurringMedicationsData:En,setClinicSettings:Yr,setEditedAiMemory:Xr,handleDeleteItem:Rt,setCanUndo:Ba,onAiActionSuccess:ge,addMessage:Qr,onPrintLabBill:h=>{Nl(h),ga(!0)},onPrintPharmacyBill:Dl}),i.jsx(Fg,{isOpen:wl,onClose:()=>ga(!1),billData:kl}),i.jsx(zg,{isOpen:_l,onClose:()=>ya(!1),billData:jl}),d&&p&&i.jsxs(i.Fragment,{children:[i.jsx(xc,{isOpen:Pl,onClose:()=>ar(!1),patientId:d,patientName:p.name,onRecordPayment:()=>{ar(!1),$a(!0)}}),i.jsx(bc,{isOpen:El,onClose:()=>$a(!1),patientId:d,patientName:p.name,currentDebt:ir||0,onPaymentSuccess:()=>{o.invalidateQueries({queryKey:pt.patientDebts.balance(d)}),ar(!0)}})]}),Tl&&p&&i.jsx(wc,{onClose:()=>Kr(!1),patientData:ac(),tokenNumber:p.patient_token_number?String(p.patient_token_number):null,onAiSummaryChange:h=>{h&&(c(h),Wt(h),Kr(!1))}}),i.jsxs("div",{className:"edit-complaint-header",children:[i.jsx("button",{onClick:()=>a(-1),disabled:Dt,className:"back-button",title:"Go Back",children:i.jsx(kc,{size:20})}),i.jsx("span",{ref:ee,style:{position:"absolute",visibility:"hidden",height:"auto",width:"auto",whiteSpace:"nowrap"}}),!p&&Lt&&i.jsx("div",{className:"patient-header-details",children:i.jsxs("div",{className:"patient-info-display skeleton",children:[i.jsx(Te,{width:"120px",height:"18px"}),i.jsx(Te,{width:"60px",height:"16px"}),i.jsx(Te,{width:"80px",height:"16px"}),i.jsx(Te,{width:"90px",height:"16px"})]})}),p&&i.jsx("div",{className:"patient-header-details",children:Cl?i.jsxs("div",{className:"patient-details-edit-form",children:[i.jsx("input",{type:"text",value:Lr,onChange:h=>Rr(h.target.value),placeholder:"Name",className:"edit-input",disabled:Et}),i.jsx("input",{type:"number",value:Fr??"",onChange:h=>zr(h.target.value?parseInt(h.target.value):null),placeholder:"Age",className:"edit-input age",disabled:Et}),i.jsxs("select",{value:Br??"",onChange:h=>qr(h.target.value||null),className:"edit-input gender",disabled:Et,children:[i.jsx("option",{value:"",children:"Gender"}),i.jsx("option",{value:"M",children:"M"}),i.jsx("option",{value:"F",children:"F"}),i.jsx("option",{value:"O",children:"O"})]}),i.jsx("input",{type:"text",value:Ur??"",onChange:h=>Mr(h.target.value||null),placeholder:"Phone",className:"edit-input phone",disabled:Et}),i.jsxs("div",{className:"edit-form-actions",children:[i.jsx("button",{onClick:()=>{Xn(!1),Vt(null)},className:"cancel-btn",disabled:Et,children:"Cancel"}),i.jsx("button",{onClick:rc,className:"save-btn",disabled:Et,children:Et?"...":"Save"})]}),ja&&i.jsx("div",{className:"error-note",children:ja})]}):i.jsxs("div",{className:"patient-info-display",children:[i.jsx("button",{onClick:()=>{Xn(!0),Rr(p.name||""),zr(p.age),qr(p.gender),Mr(p.phone),Vt(null)},className:"patient-edit-trigger",title:"Edit Patient Details",disabled:Et,children:i.jsx(gt,{size:14})}),i.jsxs("div",{className:"patient-ident-group",children:[i.jsx("span",{className:"patient-name",children:p.name??"N/A"}),i.jsxs("span",{className:"patient-id-badge",children:["#",p.patient_token_number??"N/A"]}),i.jsxs("span",{className:"patient-demographics",children:[p.age??"N/A"," / ",p.gender??"N/A"]}),i.jsx("div",{className:`patient-color-indicator status-color-${p.color_code||"none"}`,onClick:h=>ic(h,p.id,p.color_code),title:"Click to cycle status color"}),p.phone&&i.jsxs("span",{className:"patient-phone-display",children:["(",p.phone,")"]}),ir!==null&&ir>0&&i.jsxs("div",{className:"patient-debt-indicator",onClick:()=>ar(!0),title:"Manage Debts",style:{cursor:"pointer"},children:["₹",ir.toFixed(2)]})]}),i.jsxs("div",{className:"patient-action-group",children:[i.jsxs("button",{onClick:ei,className:"action-icon-btn indigo",title:"Dental Overview",children:[i.jsx(Nc,{toothNumber:30,style:{width:"14px",height:"14px"}}),i.jsx("span",{className:"btn-label",children:"Dental"})]}),i.jsxs("button",{onClick:$l,className:"action-icon-btn indigo",title:"Medical Procedures",children:[i.jsx(_c,{size:14}),i.jsx("span",{className:"btn-label",children:"Medical"})]}),i.jsxs("button",{onClick:()=>{p&&a("/dashboard/files",{state:{patient:{id:p.id,name:p.name,token:p.patient_token_number,age:p.age,gender:p.gender,phone:p.phone}}})},className:"action-icon-btn indigo",title:"Files",children:[i.jsx(ci,{size:14}),i.jsx("span",{className:"btn-label",children:"Files"})]}),i.jsxs("button",{onClick:h=>{h.stopPropagation(),is()},disabled:!dr,className:"action-icon-btn gray",title:"Print Summary",children:[i.jsx(Rn,{size:14}),i.jsx("span",{className:"btn-label",children:"Print"})]})]})]})}),!p&&B!==void 0&&D!==void 0&&i.jsx("div",{className:"patient-header-details",children:i.jsxs("div",{className:"patient-info-display",children:[i.jsxs("span",{className:"patient-demographics",children:[B??"N/A"," / ",D??"N/A"]}),i.jsx("button",{onClick:h=>{h.stopPropagation(),is()},disabled:!dr,className:"action-icon-btn gray",title:"Print Summary",children:i.jsx(Rn,{size:14})})]})}),i.jsx("div",{style:{minWidth:"64px",display:"flex",justifyContent:"flex-end"},children:i.jsx("button",{onClick:e,className:"icon-button small text-gray-600 hover:text-gray-900 bg-gray-100 hover:bg-gray-200",title:"Open Command Bar (Ctrl+K)",style:{padding:"0.2rem",borderRadius:"8px"},children:i.jsx(jc,{size:24})})})]}),i.jsxs("div",{className:"edit-complaint-content-area",ref:qe,children:[Pa.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"edit-complaint-chat-column",style:{width:"30%",minWidth:"320px",maxWidth:"40%",flexShrink:0},children:i.jsx(Bg,{messages:Pa})}),i.jsx("div",{className:"draggable-divider",onMouseDown:()=>{}})]}),i.jsxs("div",{ref:xe,className:"edit-complaint-main-column",style:{flex:1,minWidth:0},children:[ze&&i.jsxs("div",{className:"general-error-message",children:["Error: ",ze]}),nt&&i.jsxs("div",{className:"ai-response-container",style:{padding:"16px"},children:[i.jsx(Te,{width:"100%",height:"18px",style:{marginBottom:"10px"}}),i.jsx(Te,{width:"95%",height:"16px",style:{marginBottom:"8px"}}),i.jsx(Te,{width:"85%",height:"16px",style:{marginBottom:"8px"}}),i.jsx(Te,{width:"90%",height:"16px",style:{marginBottom:"8px"}}),i.jsx(Te,{width:"70%",height:"16px"})]}),!nt&&(Ve||st)&&i.jsxs("div",{ref:ve,className:`${st?"ai-function-call-block":"ai-response-container"} group`,children:[Ve&&i.jsx(Gt,{remarkPlugins:[Nt],children:Ve}),st&&i.jsxs("div",{className:"ai-json-details-container",children:[i.jsxs("button",{onClick:()=>ot(!tt),className:"ai-json-toggle-button",children:[tt?i.jsx(cs,{size:14,className:"mr-1"}):i.jsx(us,{size:14,className:"mr-1"}),tt?"Hide":"Show"," AI Function Call Details"]}),tt&&i.jsx("pre",{className:"ai-json-pre",children:i.jsx("code",{children:JSON.stringify(JSON.parse(st),null,2)})})]}),i.jsxs("div",{className:"ai-response-actions",children:[i.jsx("button",{onClick:()=>Kl(b),disabled:!b,title:"Copy Full AI Response",children:i.jsx(vc,{size:12})}),i.jsx("button",{onClick:Yl,disabled:!b,title:"Print AI Response",children:i.jsx(Rn,{size:12})})]})]})]}),i.jsx("div",{className:"draggable-divider",onMouseDown:Vl}),i.jsx("div",{ref:Q,className:"edit-complaint-context-column",style:{flexBasis:`calc(${100-ie}% - 5px)`},children:i.jsxs("div",{className:"ai-context-container",children:[i.jsxs("h3",{className:"ai-context-header",children:[i.jsx("span",{children:"AI Context:"}),(p==null?void 0:p.insurance_type)&&i.jsx("div",{className:"insurance-type-container mt-2",children:i.jsxs("select",{ref:Be,value:p.insurance_type,onChange:h=>Ol(p.id,h.target.value),className:"insurance-type-select",children:[i.jsx("option",{value:"cash",children:"Cash"}),i.jsx("option",{value:"insurance",children:"Insurance"}),i.jsx("option",{value:"no_cash_insurance",children:"No Cash Insurance"})]})})]}),H.length>0&&i.jsxs("div",{className:"ai-context-section",children:[i.jsx("div",{className:"flex justify-between items-center mb-2",children:i.jsx("h4",{className:"ai-context-section-title mb-0",children:"Dental Overview"})}),i.jsx("div",{onClick:ei,style:{cursor:"pointer",transform:"scale(0.8)",transformOrigin:"top left",width:"125%",height:"350px",overflow:"hidden",pointerEvents:"auto"},title:"Click to open full Dental Page",children:i.jsx(Cc,{selectedTeeth:[],onToothClick:()=>ei(),toothConditions:lr,toothDetails:cr,numberingSystem:localStorage.getItem("dentalNumberingSystem")||"universal"})})]}),i.jsxs("div",{ref:T,className:"ai-context-section",children:[i.jsx("h4",{className:"ai-context-section-title",children:"Admission Status"}),Lt?i.jsxs("div",{className:"space-y-2",children:[i.jsx(Te,{width:"60%",height:"1.2em"}),i.jsx(Te,{width:"50%",height:"1.2em"}),i.jsx(Te,{width:"40%",height:"1.2em"}),i.jsxs("div",{className:"flex space-x-2 mt-2",children:[i.jsx(Te,{width:"80px",height:"30px"}),i.jsx(Te,{width:"100px",height:"30px"})]})]}):i.jsxs(i.Fragment,{children:[(p==null?void 0:p.admission_date)&&i.jsxs("p",{className:"ai-context-text",children:[i.jsx("strong",{children:"Admitted:"})," ",new Date(p.admission_date).toLocaleDateString()]}),(p==null?void 0:p.discharge_date)&&i.jsxs("p",{className:"ai-context-text",children:[i.jsx("strong",{children:"Discharged:"})," ",new Date(p.discharge_date).toLocaleDateString()]}),(p==null?void 0:p.current_status)&&i.jsxs("p",{className:"ai-context-text",children:[i.jsx("strong",{children:"Current Status:"})," ",i.jsx("span",{className:"font-semibold",children:p.current_status})]}),i.jsxs("div",{className:"flex space-x-2 mt-2",children:[i.jsx("button",{onClick:ec,className:`admit-discharge-button ${Yn?"discharge":"admit"}`,title:Yn?"Discharge Patient":"Admit Patient",disabled:!d||Ir||Ar,children:Ir?"Admitting...":Ar?"Discharging...":Yn?"Discharge":"Admit"}),i.jsxs("button",{onClick:()=>a(`/patient/${encodeURIComponent(d??"")}/admission-billing`),className:"queue-status-button",style:{backgroundColor:"#e0f2fe",color:"#0369a1",border:"1px solid #bae6fd",display:"flex",alignItems:"center",gap:"4px"},title:"Go to Admission Billing",disabled:!d,children:[i.jsx(os,{size:14})," Billing"]}),i.jsx("button",{onClick:()=>tc("doctor"),className:`queue-status-button ${Kn?"in-queue":"add-to-queue"}`,title:Kn?"Patient is in Doctor Queue":"Add Patient to Doctor Queue",disabled:!d||Dr||Kn,children:Dr?"Adding...":Kn?"In Queue":"Add to Queue"}),i.jsx("button",{onClick:nc,className:"complete-consultation-button",title:"Mark Consultation as Complete",disabled:Or,children:Or?"Completing...":"Complete Consultation"})]})]})]}),i.jsx("div",{ref:R,children:i.jsx(ki,{title:"Pharmacy Order History",headerAction:Ml,items:wt,isLoading:O||Lt,loadingText:"Loading...",noDataText:"No orders.",renderItemContent:Bl})}),i.jsxs("div",{ref:un,className:"ai-context-section mt-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("h4",{className:"ai-context-section-title mb-0",children:"Recurring Medications"}),i.jsxs("button",{onClick:()=>{kn([]),Qn(!0)},className:"text-xs bg-blue-50 text-blue-600 hover:bg-blue-100 px-2 py-1 rounded flex items-center gap-1",children:[i.jsx(xr,{size:12})," Add"]})]}),Le.length>0?i.jsx("div",{className:"overflow-x-auto",children:i.jsxs("table",{className:"w-full text-xs text-left",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b",children:[i.jsx("th",{className:"py-1 px-2",children:"#"}),i.jsx("th",{className:"py-1 px-2",children:"Medication"}),i.jsx("th",{className:"py-1 px-2",children:"Qty"}),i.jsx("th",{className:"py-1 px-2",children:"Frequency"}),i.jsx("th",{className:"py-1 px-2",children:"Next Delivery"}),i.jsx("th",{className:"py-1 px-2",children:"Status"}),i.jsx("th",{className:"py-1 px-2"})]})}),i.jsx("tbody",{children:Le.map((h,g)=>i.jsxs("tr",{className:"border-b last:border-0 hover:bg-gray-50",children:[i.jsx("td",{className:"py-1 px-2 font-medium text-gray-500",children:g+1}),i.jsxs("td",{className:"py-1 px-2 font-medium",children:[h.medicationName,i.jsxs("div",{className:"text-[10px] text-gray-500 font-normal",children:[h.tabletsPerDay?`${h.tabletsPerDay} tabs/day`:"",h.tabletsPerDay&&h.numberOfDays?" • ":"",h.numberOfDays?`${h.numberOfDays} days`:"",h.directions?` • ${h.directions}`:""]})]}),i.jsx("td",{className:"py-1 px-2",children:h.quantity}),i.jsxs("td",{className:"py-1 px-2",children:[h.frequencyDays," days"]}),i.jsx("td",{className:"py-1 px-2",children:new Date(h.nextDeliveryDate).toLocaleDateString()}),i.jsx("td",{className:"py-1 px-2",children:i.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] ${h.status==="active"?"bg-green-100 text-green-800":h.status==="paused"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:h.status})}),i.jsx("td",{className:"py-1 px-2 text-right",children:i.jsx("button",{onClick:()=>{Gn(h),Pr(!0)},className:"text-gray-400 hover:text-blue-600 p-1",title:"Edit",children:i.jsx(gt,{size:12})})})]},h.id))})]})}):O||Lt?i.jsx("div",{style:{marginTop:"8px"},children:[1,2,3].map(h=>i.jsxs("div",{style:{display:"flex",gap:"12px",marginBottom:"10px"},children:[i.jsx(Te,{width:"30px",height:"14px"}),i.jsx(Te,{width:"120px",height:"14px"}),i.jsx(Te,{width:"40px",height:"14px"}),i.jsx(Te,{width:"60px",height:"14px"}),i.jsx(Te,{width:"80px",height:"14px"})]},h))}):i.jsx("p",{className:"text-gray-500 text-sm italic",children:"No recurring medications."})]}),ca&&i.jsx($g,{isOpen:ca,onClose:()=>ua(!1),patientId:d,pharmacyInventory:Ee,fetchPharmacyOrdersData:ln,isLoadingInventory:ct}),i.jsxs("div",{ref:A,children:[i.jsx(ki,{title:"Lab History (Orders & Reports)",headerAction:Hl,items:zt,onDeleteItem:void 0,onEditLabOrder:void 0,onSaveLabOrder:zl,onCancelEditLabOrder:Ll,onLabOrderTestChange:Rl,onLabOrderStatusChange:Fl,onBillLabOrder:void 0,onUpdateLabOrderStatus:void 0,onEnterLabReport:void 0,labInventory:lt,isSavingLabOrder:ft,isLoading:bn||Qe||Lt,loadingText:"Loading...",noDataText:"No lab Hx.",expandedLabReports:wn,toggleLabReport:si,renderItemContent:ql}),i.jsx(Mh,{isOpen:bl,onClose:()=>la(!1),patientId:d,labInventory:lt,fetchPendingLabOrdersData:cn,isLoadingInventory:ct}),i.jsx("div",{ref:E,children:i.jsx(ki,{title:"Complaints History",items:Ft,isLoading:X||Lt,loadingText:"Loading...",noDataText:"No past Hx.",renderItemContent:Ul,onDeleteItem:Rt})}),i.jsxs("div",{className:"ai-context-section",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("h4",{className:"ai-context-section-title",children:[i.jsx(Sc,{size:16,className:"text-purple-600"})," Clinic-wide System Prompt"]}),!Zr&&i.jsx("button",{onClick:rs,className:"edit-button",title:"Edit System Prompt",disabled:La||an||sn,children:i.jsx(gt,{size:14})})]}),Zr&&Ie?i.jsxs("div",{className:"mt-2",children:[i.jsx("textarea",{value:Cn,onChange:h=>Sn(h.target.value),className:"context-edit-textarea",placeholder:"Enter clinic system prompt...",disabled:an||sn}),i.jsxs("div",{className:"context-edit-actions",children:[i.jsx("button",{onClick:Gl,disabled:an||sn,className:"button-secondary",children:"Cancel"}),i.jsxs("button",{onClick:Ql,disabled:an||sn||sr===Ie.aiMemory&&Cn===Ie.clinicWideSystemPrompt,className:"button-primary purple",children:[i.jsx(Xs,{size:14,className:"mr-1"}),sn||an?"Saving...":"Save Settings"]})]})]}):i.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:rs,title:"Click to edit system prompt",children:La?i.jsxs("div",{style:{marginTop:"4px"},children:[i.jsx(Te,{width:"100%",height:"14px",style:{marginBottom:"6px"}}),i.jsx(Te,{width:"90%",height:"14px",style:{marginBottom:"6px"}}),i.jsx(Te,{width:"70%",height:"14px"})]}):Ie!=null&&Ie.clinicWideSystemPrompt?i.jsx(Gt,{remarkPlugins:[Nt],children:Ie.clinicWideSystemPrompt}):i.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),!Zr&&(Ie==null?void 0:Ie.clinicWideSystemPromptUpdatedAt)&&i.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Prompt Last Updated: ",new Date(Ie.clinicWideSystemPromptUpdatedAt).toLocaleDateString()]})]}),i.jsxs("div",{ref:ne,className:"ai-context-section",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("h4",{className:"ai-context-section-title",children:"Case Summary"}),!z&&i.jsx("button",{onClick:ns,className:"edit-button",title:"Edit Case Summary",disabled:O||re,children:i.jsx(gt,{size:14})})]}),z?i.jsxs("div",{className:"mt-2",children:[i.jsx("textarea",{value:Z,onChange:h=>me(h.target.value),className:"context-edit-textarea",rows:4,placeholder:"Enter case summary...",disabled:re}),V&&i.jsx("p",{className:"text-red-500 text-xs mt-1",children:V}),i.jsxs("div",{className:"context-edit-actions",children:[i.jsx("button",{onClick:Wl,disabled:re,className:"button-secondary",children:"Cancel"}),i.jsx("button",{onClick:Jl,disabled:re||Z===L,className:"button-primary blue",children:re?"Saving...":"Save"})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"ai-context-text whitespace-pre-wrap mt-1 prose prose-sm max-w-none cursor-pointer hover:bg-gray-50 rounded p-1 -m-1 transition-colors",onClick:ns,title:"Click to edit case summary",children:O?i.jsxs("div",{style:{marginTop:"8px"},children:[i.jsx(Te,{width:"100%",height:"16px",style:{marginBottom:"8px"}}),i.jsx(Te,{width:"85%",height:"16px",style:{marginBottom:"8px"}}),i.jsx(Te,{width:"65%",height:"16px"})]}):L?i.jsx(Gt,{remarkPlugins:[Nt],components:{},children:L}):i.jsx("span",{className:"italic text-gray-400",children:"N/A - Click to add."})}),I&&i.jsxs("p",{className:"ai-context-text text-gray-400 mt-1",style:{fontSize:"0.625rem"},children:["Last Edited: ",new Date(I).toLocaleDateString()]})]})]}),Ft.length===0&&zt.length===0&&wt.length===0&&!(X||bn||Qe)&&i.jsx("p",{className:"ai-context-text italic mt-4",children:"No recent history for this patient."}),Jn&&i.jsx("p",{className:"text-yellow-600 text-xs mt-2 ai-context-text",children:"Deleting..."}),sa&&i.jsx("p",{className:"text-red-600 text-xs mt-2 ai-context-text",children:sa})]})]})})]}),i.jsxs("div",{className:"edit-complaint-input-area",children:[i.jsxs("div",{className:"status-messages-container",children:[Ht&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Ht}),Re&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:Re}),ia&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:ia}),en&&i.jsx("p",{className:"text-center text-red-500 text-xs mb-1",children:en})]}),r&&!de&&i.jsxs(x.Fragment,{children:[Ga&&i.jsxs("div",{className:"follow-up-question-container",children:[i.jsx("p",{className:"question-text",children:Ga}),Ya.length>0&&i.jsx("div",{className:"options-grid",children:Ya.map((h,g)=>i.jsx("button",{onClick:()=>Xl(h),className:"option-button",children:h},g))})]}),Ta&&i.jsx("div",{className:"speech-error-display",children:Ta}),Ia&&i.jsx("div",{className:"selected-file-display",children:i.jsx("span",{children:"Uploading image..."})}),Gr&&!Ia&&i.jsxs("div",{className:"selected-file-display",children:[i.jsxs("span",{children:["Selected: ",Gr.name]}),i.jsx("button",{onClick:()=>{Ea(null),tr.current&&(tr.current.value="")},className:"remove-file-button",title:"Remove image",children:"×"})]}),i.jsxs("div",{className:"input-section-selector",children:[i.jsx("button",{onClick:()=>On("response"),className:`selector-button ${Dn==="response"?"active":""}`,children:"AI"}),i.jsx("button",{onClick:()=>On("meds"),className:`selector-button ${Dn==="meds"?"active":""}`,children:"Meds"}),i.jsx("button",{onClick:()=>On("labs"),className:`selector-button ${Dn==="labs"?"active":""}`,children:"Labs"}),i.jsx("button",{onClick:()=>On("history"),className:`selector-button ${Dn==="history"?"active":""}`,children:"Hx"}),i.jsx("button",{onClick:()=>On("summary"),className:`selector-button ${Dn==="summary"?"active":""}`,children:"Sum"})]}),i.jsx("div",{className:"input-wrapper",children:i.jsxs("div",{className:"main-input-container",children:[i.jsx("input",{type:"file",ref:tr,onChange:lc,accept:"image/*",className:"hidden"}),i.jsx("textarea",{ref:Je,className:"complaint-textarea",value:u,onChange:h=>c(h.target.value),onKeyDown:Zl,placeholder:"Name, Age, Sex... Chat with Patient Manager AI",disabled:Dt||!r||vn}),i.jsxs("div",{className:"chat-input-actions-container",children:[i.jsx("button",{type:"button",onClick:oc,disabled:Dt||!r||vn,className:"icon-button",title:"Attach Image",children:i.jsx(Tc,{size:14})}),i.jsx("button",{type:"button",onClick:sc,disabled:Dt||!r||!er.current,className:`mic-button ${vn?"listening":""}`,title:vn?"Stop":"Mic",children:i.jsx(Pc,{size:14})}),i.jsx("button",{onClick:()=>Wt(),disabled:Dt||!u.trim()||!r||vn,className:"send-button",title:Dt?"Processing...":"Save & Ask AI",children:Dt?i.jsx("div",{className:"custom-loader-circle",role:"status","aria-label":"loading"}):i.jsx(Ec,{size:14})}),Il&&i.jsx("button",{type:"button",onClick:Al,disabled:Dt,className:"icon-button text-red-500",title:"Undo Last AI Actions",children:i.jsx(yt,{size:14})})]})]})})]})]}),ha&&d&&i.jsx(Lg,{isOpen:ha,onClose:()=>Qn(!1),onSuccess:()=>{d&&En(d),Qn(!1),kn([])},patientId:d,initialItems:fa}),ma&&Er&&i.jsx(Rg,{isOpen:ma,onClose:()=>Pr(!1),onSuccess:()=>{d&&En(d),Pr(!1),Gn(void 0)},medication:Er}),da&&i.jsx(Ic,{isOpen:da,onClose:()=>{pa(!1),Gn(void 0),kn([])},onSuccess:()=>{d&&En(d),pa(!1),Gn(void 0),kn([])},initialItems:fa,medication:Er,initialPatient:p?{id:p.id,name:p.name,phone:p.phone||"",patient_token_number:String(p.patient_token_number||"")}:void 0})]})};export{Hg as default};
