import{j as e,S as n,f as x}from"./index-CRA8Xzko.js";import{r as o}from"./react-vendor-Cc0P4_ZX.js";import{x as C,e as R,E as $,X as L,aP as _,aq as A,ar as S,aa as B}from"./ui-vendor-SmiJk_kJ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const j=["#8b5cf6","#3b82f6","#06b6d4","#10b981","#22c55e","#f59e0b","#f97316","#ef4444","#ec4899","#a855f7"],I=()=>{const[p,w]=o.useState([]),[E,u]=o.useState(!0),[g,l]=o.useState(null),[r,c]=o.useState(null),[y,d]=o.useState(!1),[t,i]=o.useState({name:"",key:"",color:"#6b7280",description:""}),[f,m]=o.useState(!1),h=async()=>{u(!0),l(null);try{const s=await x("/api/clinic-roles");if(s.ok){const a=await s.json();w(a)}else l("Failed to load roles")}catch{l("Failed to connect to server")}finally{u(!1)}};o.useEffect(()=>{h()},[]);const N=s=>s.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""),z=s=>{i(a=>({...a,name:s,key:r?a.key:N(s)}))},F=async()=>{if(t.name.trim()){m(!0);try{const s=await x("/api/clinic-roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name.trim(),key:t.key||N(t.name),color:t.color,description:t.description.trim()||null})});if(s.ok)await h(),d(!1),i({name:"",key:"",color:"#6b7280",description:""});else{const a=await s.json();l(a.message||"Failed to create role")}}catch{l("Failed to create role")}finally{m(!1)}}},D=async()=>{if(!(!r||!t.name.trim())){m(!0);try{const s=await x(`/api/clinic-roles/${r.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name.trim(),color:t.color,description:t.description.trim()||null})});if(s.ok)await h(),c(null),i({name:"",key:"",color:"#6b7280",description:""});else{const a=await s.json();l(a.message||"Failed to update role")}}catch{l("Failed to update role")}finally{m(!1)}}},T=async s=>{if(!s.isSystem&&window.confirm(`Delete role "${s.name}"? This cannot be undone.`))try{const a=await x(`/api/clinic-roles/${s.id}`,{method:"DELETE"});if(a.ok)await h();else{const O=await a.json();l(O.message||"Failed to delete role")}}catch{l("Failed to delete role")}},v=s=>{c(s),i({name:s.name,key:s.key,color:s.color,description:s.description||""}),d(!1)},b=()=>{d(!0),c(null),i({name:"",key:"",color:j[Math.floor(Math.random()*j.length)],description:""})},P=()=>{d(!1),c(null),i({name:"",key:"",color:"#6b7280",description:""})},M=p.filter(s=>s.isSystem),k=p.filter(s=>!s.isSystem);return e.jsxs("div",{className:"role-management-page",children:[e.jsxs("div",{className:"role-management-header",children:[e.jsxs("div",{className:"header-title",children:[e.jsx(C,{size:28}),e.jsxs("div",{children:[e.jsx("h1",{children:"Role Management"}),e.jsx("p",{children:"Manage custom roles for your clinic staff"})]})]}),e.jsxs("button",{className:"create-role-btn",onClick:b,disabled:y,children:[e.jsx(R,{size:18}),"Create Custom Role"]})]}),g&&e.jsxs("div",{className:"role-error-banner",children:[e.jsx($,{size:18}),g,e.jsx("button",{onClick:()=>l(null),children:e.jsx(L,{size:16})})]}),(y||r)&&e.jsxs("div",{className:"role-form-card",children:[e.jsx("h3",{children:r?"Edit Role":"Create New Role"}),e.jsxs("div",{className:"role-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Name *"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>z(s.target.value),placeholder:"e.g., Senior Doctor, Ward Nurse"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Role Key"}),e.jsx("input",{type:"text",value:t.key,onChange:s=>i(a=>({...a,key:s.target.value})),placeholder:"auto-generated",disabled:!!r})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("input",{type:"text",value:t.description,onChange:s=>i(a=>({...a,description:s.target.value})),placeholder:"Brief description of role responsibilities"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{children:[e.jsx(_,{size:14}),"Color"]}),e.jsxs("div",{className:"color-picker",children:[j.map(s=>e.jsx("button",{className:`color-option ${t.color===s?"selected":""}`,style:{background:s},onClick:()=>i(a=>({...a,color:s}))},s)),e.jsx("input",{type:"color",value:t.color,onChange:s=>i(a=>({...a,color:s.target.value})),className:"custom-color-input"})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{className:"cancel-btn",onClick:P,children:"Cancel"}),e.jsxs("button",{className:"save-btn",onClick:r?D:F,disabled:f||!t.name.trim(),children:[e.jsx(A,{size:16}),f?"Saving...":r?"Update Role":"Create Role"]})]})]})]}),e.jsxs("div",{className:"roles-container",children:[e.jsxs("div",{className:"roles-section",children:[e.jsx("h3",{children:"System Roles"}),e.jsx("p",{className:"section-desc",children:"Default roles - can be customized but not deleted"}),E?e.jsx("div",{className:"roles-grid",children:[1,2,3].map(s=>e.jsxs("div",{className:"role-card system",children:[e.jsxs("div",{className:"role-header",style:{marginBottom:"10px"},children:[e.jsx(n,{variant:"circular",width:12,height:12,style:{marginRight:"8px"}}),e.jsx(n,{width:100,height:20})]}),e.jsx(n,{width:80,height:16,style:{marginBottom:"10px"}}),e.jsx(n,{width:"100%",height:20}),e.jsx("div",{className:"role-actions",style:{marginTop:"15px"},children:e.jsx(n,{width:60,height:24})})]},s))}):e.jsx("div",{className:"roles-grid",children:M.map(s=>e.jsxs("div",{className:"role-card system",children:[e.jsxs("div",{className:"role-header",children:[e.jsx("span",{className:"role-color-dot",style:{background:s.color}}),e.jsx("span",{className:"role-name",children:s.name}),e.jsx("span",{className:"system-badge",children:"System"})]}),e.jsx("div",{className:"role-key",children:s.key}),s.description&&e.jsx("div",{className:"role-description",children:s.description}),e.jsx("div",{className:"role-actions",children:e.jsxs("button",{className:"edit-role-btn",onClick:()=>v(s),children:[e.jsx(S,{size:14}),"Edit"]})})]},s.id))})]}),e.jsxs("div",{className:"roles-section",children:[e.jsx("h3",{children:"Custom Roles"}),e.jsx("p",{className:"section-desc",children:"Roles created for your clinic"}),k.length===0?e.jsxs("div",{className:"no-roles",children:[e.jsx(C,{size:32}),e.jsx("p",{children:"No custom roles created yet"}),e.jsxs("button",{onClick:b,children:[e.jsx(R,{size:16}),"Create your first custom role"]})]}):e.jsx("div",{className:"roles-grid",children:k.map(s=>e.jsxs("div",{className:"role-card custom",children:[e.jsxs("div",{className:"role-header",children:[e.jsx("span",{className:"role-color-dot",style:{background:s.color}}),e.jsx("span",{className:"role-name",children:s.name})]}),e.jsx("div",{className:"role-key",children:s.key}),s.description&&e.jsx("div",{className:"role-description",children:s.description}),e.jsxs("div",{className:"role-actions",children:[e.jsxs("button",{className:"edit-role-btn",onClick:()=>v(s),children:[e.jsx(S,{size:14}),"Edit"]}),e.jsxs("button",{className:"delete-role-btn",onClick:()=>T(s),children:[e.jsx(B,{size:14}),"Delete"]})]})]},s.id))})]})]})]})};export{I as default};
