import{f as c,j as e,S as o,E as De}from"./index-jGjkutd2.js";import{u as Ce,r as a}from"./react-vendor-Cc0P4_ZX.js";import{Q as _e,aH as we,Y as Pe,aw as Fe,Z as le,ad as Se,m as Ee,a7 as ke}from"./ui-vendor-B5keALZQ.js";import"./utils-vendor-azd6ta8e.js";import"./ai-vendor-CB5T-uN5.js";import"./chart-vendor-BcjzKorn.js";const Le=()=>{const re=Ce(),[h,ie]=a.useState([]),[oe,V]=a.useState(!0),[i,n]=a.useState(null),[k,L]=a.useState(!1),[de,$]=a.useState(!1),[ce,z]=a.useState(!1),[ue,G]=a.useState(!1),[me,I]=a.useState(!1),[he,R]=a.useState(!1),[r,d]=a.useState(null),[J,q]=a.useState([]),[j,U]=a.useState(null),[b,p]=a.useState(""),[g,y]=a.useState(""),[v,N]=a.useState(""),[f,D]=a.useState(""),[C,_]=a.useState(""),[w,P]=a.useState(""),[F,S]=a.useState(""),[W,H]=a.useState(""),[Q,Y]=a.useState(""),[Z,K]=a.useState(""),[X,ee]=a.useState(""),[te,se]=a.useState("cash"),u=a.useCallback(async()=>{V(!0),n(null);try{const t=await c("/api/distributors");if(!t.ok)throw new Error(`Failed to fetch distributors: ${t.statusText}`);const s=await t.json();ie(s)}catch(t){console.error("Failed to fetch distributors:",t),n(t.message||"Failed to load distributors.")}finally{V(!1)}},[]);a.useEffect(()=>{u()},[u]);const xe=async t=>{t.preventDefault(),n(null);try{const s=await c("/api/distributors",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b,contact_person:g,phone:v,email:f,address:C,gst_number:w,drug_license_number:F})});if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to add distributor.")}alert("Distributor added successfully!"),A(),u()}catch(s){console.error("Error adding distributor:",s),n(s.message||"Failed to add distributor.")}},je=async t=>{if(t.preventDefault(),n(null),!!r)try{const s=await c(`/api/distributors/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:b,contact_person:g,phone:v,email:f,address:C,gst_number:w,drug_license_number:F})});if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to update distributor.")}alert("Distributor updated successfully!"),M(),u()}catch(s){console.error("Error updating distributor:",s),n(s.message||"Failed to update distributor.")}},be=async()=>{if(n(null),!!r)try{const t=await c(`/api/distributors/${r.id}`,{method:"DELETE"});if(!t.ok){const s=await t.json();throw new Error(s.message||"Failed to delete distributor.")}alert("Distributor deleted successfully!"),O(),u()}catch(t){console.error("Error deleting distributor:",t),n(t.message||"Failed to delete distributor.")}},ae=a.useCallback(async t=>{n(null);try{const s=await c(`/api/distributors/${t}/payments`);if(!s.ok)throw new Error(`Failed to fetch payments: ${s.statusText}`);const m=(await s.json()).map(E=>({...E,order_value:parseFloat(E.order_value),amount_paid:parseFloat(E.amount_paid),balance_remaining:parseFloat(E.balance_remaining)}));q(m);const x=await c(`/api/distributors/${t}/balance`);if(!x.ok)throw new Error(`Failed to fetch balance: ${x.statusText}`);const B=await x.json();U({totalOrderValue:parseFloat(B.totalOrderValue),totalAmountPaid:parseFloat(B.totalAmountPaid),remainingBalance:parseFloat(B.remainingBalance)})}catch(s){console.error("Error fetching payments/balance:",s),n(s.message||"Failed to load payments or balance.")}},[]),pe=async t=>{if(t.preventDefault(),n(null),!!r)try{const s=await c(`/api/distributors/${r.id}/payments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({payment_date:W,order_value:parseFloat(Q||"0"),amount_paid:parseFloat(Z||"0"),notes:X,payment_mode:te})});if(!s.ok){const l=await s.json();throw new Error(l.message||"Failed to add payment.")}alert("Payment added successfully!"),T(),ae(r.id)}catch(s){console.error("Error adding payment:",s),n(s.message||"Failed to add payment.")}},ge=()=>{p(""),y(""),N(""),D(""),_(""),P(""),S(""),n(null),$(!0)},A=()=>{$(!1)},ye=t=>{d(t),p(t.name),y(t.contact_person||""),N(t.phone||""),D(t.email||""),_(t.address||""),P(t.gst_number||""),S(t.drug_license_number||""),n(null),z(!0)},M=()=>{z(!1),d(null)},ve=t=>{d(t),n(null),G(!0)},O=()=>{G(!1),d(null)},Ne=t=>{d(t),ae(t.id),n(null),I(!0)},ne=()=>{I(!1),d(null),q([]),U(null)},fe=t=>{d(t),H(new Date().toISOString().split("T")[0]),Y("0"),K("0"),ee(""),se("cash"),n(null),R(!0)},T=()=>{R(!1),d(null)};return oe?e.jsxs("div",{className:"distributor-management-page",children:[e.jsxs("div",{className:"distributor-management-header",style:{marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx(o,{width:80,height:36}),e.jsx(o,{width:200,height:32})]}),e.jsxs("div",{className:"header-controls",children:[e.jsx(o,{width:150,height:36}),e.jsx(o,{width:150,height:36}),e.jsx(o,{width:180,height:36})]})]}),e.jsx("div",{className:"distributor-table-container",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:[1,2,3,4,5].map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(o,{width:150,height:20})}),e.jsx("td",{children:e.jsx(o,{width:120,height:20})}),e.jsx("td",{children:e.jsx(o,{width:100,height:20})}),e.jsx("td",{children:e.jsx(o,{width:180,height:20})}),e.jsx("td",{children:e.jsx(o,{width:80,height:20})}),e.jsx("td",{children:e.jsx(o,{width:100,height:30})})]},t))})]})})]}):i?e.jsxs("div",{className:"error-indicator",children:["Error: ",i]}):e.jsxs("div",{className:"distributor-management-page",children:[e.jsxs("div",{className:"distributor-management-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("button",{onClick:()=>re(-1),className:"back-button",title:"Go Back",children:e.jsx(_e,{size:20})}),e.jsx("h2",{children:"Distributor Management"})]}),e.jsxs("div",{className:"header-controls",children:[(()=>{const t=h.reduce((l,m)=>l+parseFloat(m.remainingBalance||"0"),0),s=t>=0?"balance-positive":"balance-negative";return e.jsxs("div",{className:`total-balance-display ${s}`,children:[e.jsx(we,{size:18}),e.jsx("strong",{children:"Total Balance:"})," ₹",t.toFixed(2)]})})(),e.jsxs("div",{className:"view-mode-toggle",children:[e.jsxs("button",{onClick:()=>L(!1),className:`view-mode-btn ${k?"":"active"}`,title:"List View",children:[e.jsx(Pe,{size:18})," List"]}),e.jsxs("button",{onClick:()=>L(!0),className:`view-mode-btn ${k?"active":""}`,title:"Excel Mode (Edit)",children:[e.jsx(Fe,{size:18})," Excel"]})]}),e.jsxs("button",{onClick:ge,className:"add-distributor-button",children:[e.jsx(le,{size:18}),"Add Distributor"]})]})]}),e.jsx("div",{className:"distributor-table-container",children:k?e.jsx(De,{columns:[{key:"name",label:"Name",editable:!0,type:"text"},{key:"contact_person",label:"Contact Person",editable:!0,type:"text"},{key:"phone",label:"Phone",editable:!0,type:"text"},{key:"email",label:"Email",editable:!0,type:"text"},{key:"address",label:"Address",editable:!0,type:"text"},{key:"gst_number",label:"GST Number",editable:!0,type:"text"},{key:"drug_license_number",label:"Drug License",editable:!0,type:"text"}],data:h,editable:!0,showRowNumbers:!0,title:"Distributors",onSave:async t=>{const s=t.map(async l=>{const m=h.find(x=>x.id===l.id);if(m&&JSON.stringify(m)!==JSON.stringify(l))return c(`/api/distributors/${l.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})});try{await Promise.all(s),alert("Changes saved successfully"),u()}catch(l){alert("Error saving changes"),console.error(l)}}}):e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact Person"}),e.jsx("th",{children:"Phone"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"GST Number"}),e.jsx("th",{children:"Drug License"}),e.jsx("th",{children:"Balance"}),e.jsx("th",{className:"actions-cell",children:"Actions"})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"no-results-message",children:"No distributors found."})}):h.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Name",style:{fontWeight:600},children:t.name}),e.jsx("td",{"data-label":"Contact Person",children:t.contact_person||"-"}),e.jsx("td",{"data-label":"Phone",children:t.phone||"-"}),e.jsx("td",{"data-label":"Email",children:t.email||"-"}),e.jsx("td",{"data-label":"Address",children:t.address||"-"}),e.jsx("td",{"data-label":"GST Number",children:t.gst_number||"-"}),e.jsx("td",{"data-label":"Drug License",children:t.drug_license_number||"-"}),e.jsxs("td",{"data-label":"Balance",className:parseFloat(t.remainingBalance||"0")>0?"balance-positive":"balance-negative",style:{fontWeight:600},children:["₹",t.remainingBalance||"0.00"]}),e.jsx("td",{className:"actions-cell",children:e.jsxs("div",{className:"actions-buttons-group",children:[e.jsxs("button",{onClick:()=>Ne(t),className:"action-text-button view-button",title:"View Payments & Balance",children:[e.jsx(Se,{size:16})," View"]}),e.jsxs("button",{onClick:()=>fe(t),className:"action-text-button add-payment-button-small",title:"Add Payment",children:[e.jsx(le,{size:16})," Pay"]}),e.jsx("button",{onClick:()=>ye(t),className:"action-icon-button edit-button",title:"Edit Distributor",children:e.jsx(Ee,{size:16})}),e.jsx("button",{onClick:()=>ve(t),className:"action-icon-button delete-button",title:"Delete Distributor",children:e.jsx(ke,{size:16})})]})})]},t.id))})]})}),de&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:A,className:"modal-close-button",children:"×"}),e.jsx("h3",{className:"modal-title",children:"Add New Distributor"}),i&&e.jsx("div",{className:"modal-error-message",children:i}),e.jsxs("form",{onSubmit:xe,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"name",children:"Name:"}),e.jsx("input",{type:"text",id:"name",value:b,onChange:t=>p(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"contact_person",value:g,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"phone",value:v,onChange:t=>N(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"email",children:"Email:"}),e.jsx("input",{type:"email",id:"email",value:f,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"address",children:"Address:"}),e.jsx("textarea",{id:"address",value:C,onChange:t=>_(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"gst_number",value:w,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"drug_license_number",value:F,onChange:t=>S(t.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:A,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Distributor"})]})]})]})}),ce&&r&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:M,className:"modal-close-button",children:"×"}),e.jsx("h3",{className:"modal-title",children:"Edit Distributor"}),i&&e.jsx("div",{className:"modal-error-message",children:i}),e.jsxs("form",{onSubmit:je,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-name",children:"Name:"}),e.jsx("input",{type:"text",id:"edit-name",value:b,onChange:t=>p(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-contact_person",children:"Contact Person:"}),e.jsx("input",{type:"text",id:"edit-contact_person",value:g,onChange:t=>y(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-phone",children:"Phone:"}),e.jsx("input",{type:"text",id:"edit-phone",value:v,onChange:t=>N(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-email",children:"Email:"}),e.jsx("input",{type:"email",id:"edit-email",value:f,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-address",children:"Address:"}),e.jsx("textarea",{id:"edit-address",value:C,onChange:t=>_(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-gst_number",children:"GST Number:"}),e.jsx("input",{type:"text",id:"edit-gst_number",value:w,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"edit-drug_license_number",children:"Drug License Number:"}),e.jsx("input",{type:"text",id:"edit-drug_license_number",value:F,onChange:t=>S(t.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:M,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Save Changes"})]})]})]})}),ue&&r&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("button",{onClick:O,className:"modal-close-button",children:"×"}),e.jsx("h3",{className:"modal-title",children:"Confirm Delete"}),e.jsxs("p",{children:['Are you sure you want to delete distributor "',r.name,'"?']}),i&&e.jsx("div",{className:"modal-error-message",children:i}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:O,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:be,className:"button-delete",children:"Delete"})]})]})}),me&&r&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content large-modal",children:[e.jsx("button",{onClick:ne,className:"modal-close-button",children:"×"}),e.jsxs("h3",{className:"modal-title",children:["Payments & Balance for ",r.name]}),i&&e.jsx("div",{className:"modal-error-message",children:i}),j&&e.jsxs("div",{className:"balance-summary",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Order Value"})," ",e.jsxs("span",{children:["₹",j.totalOrderValue.toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount Paid"})," ",e.jsxs("span",{children:["₹",j.totalAmountPaid.toFixed(2)]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Remaining Balance"})," ",e.jsxs("span",{children:["₹",j.remainingBalance.toFixed(2)]})]})]}),e.jsx("h4",{children:"Payment History"}),J.length===0?e.jsx("p",{children:"No payments recorded for this distributor."}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"distributor-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Order Value"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Balance Remaining"}),e.jsx("th",{children:"Payment Mode"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:J.map(t=>e.jsxs("tr",{children:[e.jsx("td",{"data-label":"Date",children:new Date(t.payment_date).toLocaleDateString()}),e.jsxs("td",{"data-label":"Order Value",children:["₹",t.order_value.toFixed(2)]}),e.jsxs("td",{"data-label":"Amount Paid",children:["₹",t.amount_paid.toFixed(2)]}),e.jsxs("td",{"data-label":"Balance Remaining",children:["₹",t.balance_remaining.toFixed(2)]}),e.jsx("td",{"data-label":"Payment Mode",children:t.payment_mode?t.payment_mode.charAt(0).toUpperCase()+t.payment_mode.slice(1):"-"}),e.jsx("td",{"data-label":"Notes",children:t.notes||"-"})]},t.id))})]})}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:ne,className:"button-cancel",children:"Close"})})]})}),he&&r&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content compact-modal",children:[e.jsx("button",{onClick:T,className:"modal-close-button",children:"×"}),e.jsx("h3",{className:"modal-title",children:"Add Payment"}),i&&e.jsx("div",{className:"modal-error-message",children:i}),e.jsxs("form",{onSubmit:pe,children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_date",children:"Date:"}),e.jsx("input",{type:"date",id:"payment_date",value:W,onChange:t=>H(t.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_mode",children:"Mode:"}),e.jsxs("select",{id:"payment_mode",value:te,onChange:t=>se(t.target.value),children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"upi",children:"UPI"}),e.jsx("option",{value:"card",children:"Card"}),e.jsx("option",{value:"online",children:"Online"}),e.jsx("option",{value:"bank_transfer",children:"Bank Transfer"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"order_value",children:"Order Value:"}),e.jsx("input",{type:"number",id:"order_value",value:Q,onChange:t=>Y(t.target.value),step:"0.01"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"amount_paid",children:"Amount Paid:"}),e.jsx("input",{type:"number",id:"amount_paid",value:Z,onChange:t=>K(t.target.value),step:"0.01"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"payment_notes",children:"Notes:"}),e.jsx("textarea",{id:"payment_notes",value:X,onChange:t=>ee(t.target.value),rows:2,style:{resize:"none"}})]}),e.jsxs("div",{className:"modal-actions compact-actions",children:[e.jsx("button",{type:"button",onClick:T,className:"button-cancel",children:"Cancel"}),e.jsx("button",{type:"submit",className:"button-submit",children:"Add Payment"})]})]})]})})]})};export{Le as default};
